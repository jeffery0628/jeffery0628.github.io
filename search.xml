<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>è¿‡å»ã€ç°åœ¨ã€æœªæ¥</title>
    <url>/2020/03/20/past-present-future/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">è¯·è¾“å…¥å¯†ç ä»¥é˜…è¯»è¿™ç¯‡ç§å¯†æ–‡ç« ã€‚</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="6f4e3df6304fa045dbe732f35aeca22f66b1fadeb40764fe46213fbe78dafe89">56e7118cb91cb57efe73888c23093e729f419eecdeccbf7727e2f4e8353c778c85a615fda438e8e4b97764d9746602fbb748080c761037a92d129bf1207fe230e5a4474e76fd6816b23483f9ec1d4d052e77db84672c6e034985b68e9d77bee270c2f6f15ca159ab26d6e1a7a682a77c99a11e413191fd870b2bde9e7de35ff7064e0d84bba08e70054cf16586b6ae003935f4385f2aa7a84b6f0b38ef664ece7e92c2458ec76780ee3c28fe9726497a7dde4cf41a3d74a9faaf1bae7977ac96a11794c9ecff23831171ab84447931cbe0571f2d2fd9b5374585773c34257dec78710d4e4f77af774b1a36816f05003b4a3ac7617e0f5637a2c1a28b3673567a0626c240289ff666f14acf7b4cc56623f3c0d7744dd43c2ba0043be4b2c72e4305628b34bf3354901ee77d07e7d43d4c7f246b3a6cb71727e7ce576a4e78a0afd694a58918b25f37ef676788445fa293efb892c45322392f33ebf2b9761f973a4fc1b154e9f60faf5754940e7b19f929f082cf76271f938cd56212a6dc503f2bb5b1c5704c254c6199be20681158dbeed70ae9a92fd809aa20e2da801db091f8cd44064c96b2280b4cfa8c010b897cb06f39369be045a283a12e1afeb8a40b7e3b71783eda82741d661cafd86101be4c81059f6f6e3cde754f518b7b45dd28c56a8434cbb1fb45e39aa1e658cfb97b6516f52c463a48f291567ccf186653f381a1785f716f4f8ff0a3a42085f964fab822f3e56bea8ca21694402edd7e46f8b62c274ebd22b91a90468baf6b75cd56272e29978839d776a61207829d991aac4b3cd621e8fe1ed03cb67354dc8424076efbdd95d4f6f2183644e62dede9605fde15166006af8b063cd4bdd6389fb2ef5f7ff9df6f2f51fe39dba9e185288dab15de83622a5aa3d45c4fe2d20526122a3021bc16581a095fd5c79f691b055dec89940beaedb974f416ff8c05d06da288a5f1b4fa4c5eea41b33872105191ee9914c9bd320cf0ac860ad3aca3fff5eadf3c408dc102468d2f32bef63b7a437cf0cff76d74b0ce6065bb33b06359b1af41004b1e7162f48cfbe37447f12b7ee7d92aafff945d5002bbc60c86b8d085c1bf779efb1add9bc66ee8127a2773d89ca5c0a21ec7b2a3b437fea6a11ba55d386c3bc7b322f9383864ce6953208668b173b8e58702a331d43fdb6c159e65baaaf2e76ebab45346ca6bea2454edcb5e14e5e2e0bdcbb4b79bf36b354f804fcac1b8fa05c71824de9b0e3fc9a9d00ba05d0c9b7d3a58a1d699c80a29ae3846408abce34b4eb9a014bf3c255203491698604e3c54c43ff3ae60f0796b96cdd9b31071ca8d01043bbcc2dcf3bbb2fd6617c659a6d6ba7f794d23ba155b92d7bbe74b8ad4ea3be525c98ae68b30798605ba3ad350924ddab19d7f18d24a18544f18b41b8c8f1162edb3b1c7759edd8baf4533badcb98c8d3df3d06123e7ba47e76c25de2ca886c6809cda4a79153170cee1bfbcd6fa575f2361e311c7e60e5211c936b18a9dbea2584f1aade45e044fbdbe12a2a0a92def8da51cd8a72fd2f01e8f8694aa8a62b61ba092c2e21f7f754cda4be7d177c171bd7e88e66ee9908a7b53f8efd75e75e6ce2b3a79a3ab9acf8e3cc2562300ccfb154b8661a66dc1a6d758d62d9b6793a7a97f2007bcbacef53e226c66cf27c8ad394566e4c80616261686899054f6fe9b6786bb174ba716d370abb2c1ecfa60cc3c65591eab29d235cbe06deb6ff06f134f0f5383c66547af321507543189ddab842129ab65d3b6a8dc033a4c0d245d9678584f61eac9a1647f5e175ce36fab6a1c1943153ba72e008caf5806a6cf78e3354560d3d0a7d7a41212fc918e506ec53dc93316459bf2b568064f79af2d6a32579404189ad7088e7108306bbb18b8cee0dd4d0165fa7026529f236b1176457e4fcf75b4d51c5e671d43b1120b64c3661c908d5ebf3012404e37a1d58f5146e27b5d8b0041ba3b0de0ea35efd1f6093d7b62cf3e3e876f89788984985848dc304e5dc48ded8a360ccebd9df25a5353750adb893294bdb002490c0b990801218985e51e35afc2f7ddc5e579ebfc2dc29ef5a68c86f4b30519299cd8b9c22fd4cfbfbb9c7646c507b8a67f92477c26ab19046281abf19862635e11486c0cd69adb62afc2343683478c353cceda84189e0fae0824c2a7219e58d2f383d18e45d16a18754e279af57431c52ac4aefc1420130654f4d64b7b1ea80260990ad3c2888a208dec804968c36019357f01e4125e145c361c9cb5235980140001c062be4859d3aeeb4cd8634c6b410db0aeefff1660497fd7ee55f9baced977193c5fd0870cb9dada23a2bb47688c3da2e97fde5f5609bbe14a7bb37e5d8393044aad3883e7c1a112a0857497f6cd95fa3a0008b1423811ba10b2cf2ce042acc61087813469f0aab0a7ba5f950c85b729a7e789b1d25d4ccf3cf96c36ace62db7f1b24d9823207638997e960b4bf46ff05724578205fb220398327269be8661f858229ff17f7554707b464f7eecd6b2f1ed64da2c8c769097957874d5c2d1494d9e9214c8be96a056bfd475e32a64cde4baddf89294e3fdcdaed5e4bed79cf4c9d7ecb91a1f2dd688ed88ac6166839d005d744314f25c977fe385ac822248a580111fa8a34bb3272429390203dcd0be9038badf7aece96edcca265cb20f1d44c059d652aaad6df94331048b4e0faa284cd7dfecd2b9e46aea2f1ff0d81b8fdb1def834ca71d55c4af2d9a0db38058d7c7aa4acd8cad46b7b8feb545cf5cf285060b7adc980aca2b7d20c642e2154d7a87b92485a3411980ab43278e91285821512767a5c27514fc76c79c24ab21c649cad79d19757f01865ea6feeae5101983dc4fec07e1bd1a94269a567bc3b0e6ef7bdb7e09d60052bed4793ff103af0c1432b9aaf5658cdc01228e1b6430cbd0035e943c11ab350cf2f578178a04d7861873a7615f5ba10760a16f8fa41742717484e20f5c59c1030226cc0c67ba9d246e88f2674dec76a27910d1052bb4699e03cd2a93cb16307f417d53bc821bbd5a725820a3b11700c4f7ac44b7a932cdcbf8ad040703816f49d5d5837e2b21216341fd20cfe668b5d6958a05f2e8aeec5878869ee93c352cf532f4c2ef9bd37e9d073bdbe136db1cfd6295b0a66975d59bc6085c36fadb082bcc6392f30e84adce8edcf2c823615171f168a51f92a5a877a66e835488efcd4451c31c4aa49c6ad8ad8a54236f6cbff8c3390908835c59f036d0a334c8e3101f02f866d6dbb6051974d0f07f1bdf5043f20cc5b5015b8bab8b8ea911401db6642914b598613642eedb66bc650290bc46a0e6691caffefcc9fd522e8cec1064827515fbbd4e2687cf92843d62395e6914216d438dd8fd7edb2bf47e19aa43ac7d8a5c06bfda616e8699600bec1a77079e2e292d5c3f1687e18398f9cfa9b505f833150f727a11fd3e31760b08eb61f5b040127fad95c97f6304a7ab9205b9afdff3760f2826eefcdaa05d48e845031ecf1c597a66b71571caa1998cf15bdbdb6124453d1b331d8d4aa51036dde1926101e27bf4f626fc458e3d2523fad0fb67e5c0c574b603fb28001333467c1f617d3fc9da695baeb6eed9f8fbbf41c9673d7417bc5602814b7acad9282930453b93eafe54aebe71a780f3417cdcb019bc3e5faa8efd200c08e132feb13ede2976ab0181237e002cdb31bb89330b7248553a78a6a0c0c100ee738c6922470f99a9cb7bbfddb6cbae0b982a1aee9e4bdd374afbe7b0be59cc1ec44117fa8c278a5b03b990d0346e77751049fb10a89009abafc96a9804c85da1374d00fa3e5a092d352a40f76248a8953730b10a485e76a21487b66b744bccac66cd4798533d55e5367f496d5b8d0c0d113a3742f66c671928804c259b5ccf0cf88fe882e3426704670c3d3c8b4d4eaf9ed7a5c601187390ec527536e39477096e6d04bb0191be798eea5cf02f464b7a001e2ad52c62e314b1e9ba182d91be17d4f5f05f7cd3113c308556665cd9d235930c4f601c8d08de73d45180dba8e52cdb8f5a52e9b5baeab25bbdc7e011807f1c3212382307673c4bd3c47e13c78796294037ff3457c4e16b10fcd56dae9742e342d66ea95492321743804cd7e148ff3e05aa5b58b74309415f72dc4c78e1f9cbf039e593da6d66585f8cd23ce4b2c3dd0b94c6f250e7b6395b6e357f0be8af7909c028027290a3ff1d1acc8151958740f02d91ace69545355854639cbc382fbab21509e7645d3245ef369859786a294d47cf7ce0ede683547a9f230700105a553a3fb28f503d9562b64a6dd7d02c5784f32cc931a7bd43c5fb1fc9bd60b95cd913fec366bf57d341d974ee64dd89ea9bccbca9bdee05d4e097f07138c6ac8e677c0e6768fab89410db5d859884fc9e9f81088e74cccfe49d23f1a573b335ed378c3482b5c51571e646cd31cb57fdfa6f76e13c079a92b6b5efe4b7dde88f79f799ec8ba3f9122c767cacee562f1a77a460d26ab82c838ef2e17a66e98b107e67191cde974b7e2f451bf749ffefbd36034ad43d211e</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>ç”Ÿæ´»/æˆé•¿</category>
      </categories>
      <tags>
        <tag>æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>Transformer</title>
    <url>/2020/05/11/transformer/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2020/05/11/transformer/transformer.jpeg" alt></p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>è‡ª2017å¹´æå‡ºä»¥æ¥ï¼ŒTransformeråœ¨ä¼—å¤šè‡ªç„¶è¯­è¨€å¤„ç†é—®é¢˜ä¸­å–å¾—äº†éå¸¸å¥½çš„æ•ˆæœã€‚å®ƒä¸ä½†è®­ç»ƒé€Ÿåº¦æ›´å¿«ï¼Œè€Œä¸”æ›´é€‚åˆå»ºæ¨¡é•¿è·ç¦»ä¾èµ–å…³ç³»ï¼Œå› æ­¤å¤§æœ‰å–ä»£å¾ªç¯æˆ–å·ç§¯ç¥ç»ç½‘ç»œï¼Œä¸€ç»Ÿè‡ªç„¶è¯­è¨€å¤„ç†çš„æ·±åº¦æ¨¡å‹æ±Ÿæ¹–ä¹‹åŠ¿ã€‚æœ¬æ–‡ç»“åˆ<a href="https://arxiv.org/abs/1706.03762" target="_blank" rel="noopener">ã€ŠAttention is all you needã€‹</a>è®ºæ–‡ä¸Harvardçš„ä»£ç <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html" target="_blank" rel="noopener">ã€ŠAnnotated Transformerã€‹</a>æ·±å…¥ç†è§£transformeræ¨¡å‹ã€‚ </p>
<a id="more"></a>
<h1 id="Transformer"><a href="#Transformer" class="headerlink" title="Transformer"></a>Transformer</h1><p>Transformerçš„æ•´ä½“ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨Encoderå’ŒDecoderä¸­éƒ½ä½¿ç”¨äº†Self-attention, Point-wiseå’Œå…¨è¿æ¥å±‚ã€‚Encoderå’Œdecoderçš„å¤§è‡´ç»“æ„åˆ†åˆ«å¦‚ä¸‹å›¾çš„å·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†æ‰€ç¤ºã€‚</p>
<p><img src="/2020/05/11/transformer/over_all.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_model</span><span class="params">(src_vocab, tgt_vocab, N=<span class="number">6</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">               d_model=<span class="number">512</span>, d_ff=<span class="number">2048</span>, h=<span class="number">8</span>, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Helper: Construct a model from hyperparameters.</span></span><br><span class="line"><span class="string">    src_vocab: è¾“å…¥è¯æ±‡è¡¨å¤§å°</span></span><br><span class="line"><span class="string">    tgt_vocab:è¾“å‡ºè¯æ±‡è¡¨å¤§å°</span></span><br><span class="line"><span class="string">    Nï¼šå †å ä¸ªæ•°</span></span><br><span class="line"><span class="string">    d_model:embedding_size</span></span><br><span class="line"><span class="string">    d_ff: çº¿å½¢å±‚è¾“å‡ºç»´åº¦</span></span><br><span class="line"><span class="string">    h:multi-headä¸­ head çš„ä¸ªæ•°</span></span><br><span class="line"><span class="string">    dropoutï¼š</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    c = copy.deepcopy</span><br><span class="line">    attn = MultiHeadedAttention(h, d_model)</span><br><span class="line">    ff = PositionwiseFeedForward(d_model, d_ff, dropout)</span><br><span class="line">    position = PositionalEncoding(d_model, dropout)</span><br><span class="line">    model = EncoderDecoder(</span><br><span class="line">        Encoder(EncoderLayer(d_model, c(attn), c(ff), dropout), N), <span class="comment"># encoder</span></span><br><span class="line">        Decoder(DecoderLayer(d_model, c(attn), c(attn), c(ff), dropout), N), <span class="comment"># decoder</span></span><br><span class="line">        nn.Sequential(Embeddings(d_model, src_vocab), c(position)), <span class="comment"># src_embed</span></span><br><span class="line">        nn.Sequential(Embeddings(d_model, tgt_vocab), c(position)), <span class="comment"># tgt_embed</span></span><br><span class="line">        Generator(d_model, tgt_vocab) <span class="comment"># generator</span></span><br><span class="line">    		)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># This was important from their code. </span></span><br><span class="line">    <span class="comment"># Initialize parameters with Glorot / fan_avg.</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> model.parameters():</span><br><span class="line">        <span class="keyword">if</span> p.dim() &gt; <span class="number">1</span>:</span><br><span class="line">            nn.init.xavier_uniform(p)</span><br><span class="line">    <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure>
<h2 id="Embedding"><a href="#Embedding" class="headerlink" title="Embedding"></a>Embedding</h2><p>transformerçš„è¾“å…¥æ˜¯<strong>Word Embedding + Position Embedding</strong>ã€‚</p>
<h3 id="Word-Embedding"><a href="#Word-Embedding" class="headerlink" title="Word Embedding"></a>Word Embedding</h3><p>Word embeddingåœ¨pytorchä¸­é€šå¸¸ç”¨ nn.Embedding å®ç°ï¼Œå…¶æƒé‡çŸ©é˜µé€šå¸¸æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<ol>
<li>ä½¿ç”¨ Pre-trainedçš„<strong>Embeddingså¹¶freeze</strong>ï¼Œè¿™ç§æƒ…å†µä¸‹å®é™…å°±æ˜¯ä¸€ä¸ª Lookup Tableã€‚</li>
<li>å¯¹å…¶è¿›è¡Œéšæœºåˆå§‹åŒ–(å½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹© Pre-trained çš„ç»“æœ)ï¼Œä½†<strong>è®¾ä¸º Trainable</strong>ã€‚è¿™æ ·åœ¨ training è¿‡ç¨‹ä¸­ä¸æ–­åœ°å¯¹ Embeddings è¿›è¡Œæ”¹è¿›ã€‚</li>
</ol>
<p>transformeré€‰æ‹©åè€…ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><figcaption><span>word_embedding</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Embeddings</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, vocab)</span>:</span></span><br><span class="line">        super(Embeddings, self).__init__()</span><br><span class="line">        self.lut = nn.Embedding(vocab, d_model) <span class="comment"># vocab è¯æ±‡è¡¨å¤§å°</span></span><br><span class="line">        self.d_model = d_model  <span class="comment">#è¡¨ç¤ºembeddingçš„ç»´åº¦</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.lut(x) * math.sqrt(self.d_model)</span><br></pre></td></tr></table></figure>
<h3 id="Positional-Embedding"><a href="#Positional-Embedding" class="headerlink" title="Positional Embedding"></a>Positional Embedding</h3><p>åœ¨RNNä¸­ï¼Œå¯¹å¥å­çš„å¤„ç†æ˜¯ä¸€ä¸ªä¸ªwordæŒ‰é¡ºåºè¾“å…¥çš„ã€‚ä½†åœ¨ Transformer ä¸­ï¼Œè¾“å…¥å¥å­çš„æ‰€æœ‰wordæ˜¯åŒæ—¶å¤„ç†çš„ï¼Œæ²¡æœ‰è€ƒè™‘è¯çš„æ’åºå’Œä½ç½®ä¿¡æ¯ã€‚å› æ­¤ï¼ŒTransformer çš„ä½œè€…æå‡ºäº†åŠ å…¥ <code>positional encoding</code>çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<code>positional encoding</code>ä½¿å¾— Transformer å¯ä»¥è¡¡é‡ word ä½ç½®æœ‰å…³çš„ä¿¡æ¯ã€‚</p>
<p><strong>å¦‚ä½•å®ç°å…·æœ‰ä½ç½®ä¿¡æ¯çš„encodingï¼Ÿ</strong></p>
<p>ä½œè€…æä¾›äº†ä¸¤ç§æ€è·¯ï¼š</p>
<ul>
<li>é€šè¿‡è®­ç»ƒå­¦ä¹  positional encoding å‘é‡ï¼›</li>
<li>ä½¿ç”¨å…¬å¼æ¥è®¡ç®— positional encodingå‘é‡ã€‚</li>
</ul>
<p>è¯•éªŒåå‘ç°ä¸¤ç§é€‰æ‹©çš„ç»“æœæ˜¯ç›¸ä¼¼çš„ï¼Œæ‰€ä»¥é‡‡ç”¨äº†ç¬¬2ç§æ–¹æ³•ï¼Œä¼˜ç‚¹æ˜¯ä¸éœ€è¦è®­ç»ƒå‚æ•°ï¼Œè€Œä¸”å³ä½¿<strong>åœ¨è®­ç»ƒé›†ä¸­æ²¡æœ‰å‡ºç°è¿‡çš„å¥å­é•¿åº¦ä¸Šä¹Ÿèƒ½ç”¨</strong>ã€‚Positional Encodingçš„å…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
P E_{(p o s, 2 i)} &=\sin \left(p o s / 10000^{2 i / d_{\text {model }}}\right) \\
P E_{(p o s, 2 i+1)} &=\cos \left(p o s / 10000^{2 i / d_{\text {model }}}\right.
\end{aligned}</script><p>å…¶ä¸­ï¼Œ$pos$æŒ‡çš„æ˜¯è¿™ä¸ª word åœ¨è¿™ä¸ªå¥å­ä¸­çš„ä½ç½®ï¼›$2i$æŒ‡çš„æ˜¯ embedding è¯å‘é‡çš„å¶æ•°ç»´åº¦ï¼Œ$2i+1$æŒ‡çš„æ˜¯embedding è¯å‘é‡çš„å¥‡æ•°ç»´åº¦ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><figcaption><span>PositionalEncoding</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PositionalEncoding</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Implement the PE function."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, dropout, max_len=<span class="number">5000</span>)</span>:</span></span><br><span class="line">        super(PositionalEncoding, self).__init__()</span><br><span class="line">        self.dropout = nn.Dropout(p=dropout)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Compute the positional encodings once in log space.</span></span><br><span class="line">        pe = torch.zeros(max_len, d_model)</span><br><span class="line">        position = torch.arange(<span class="number">0</span>, max_len).unsqueeze(<span class="number">1</span>) <span class="comment"># [max_len, 1]</span></span><br><span class="line">        div_term = torch.exp(torch.arange(<span class="number">0</span>, d_model, <span class="number">2</span>) * -(math.log(<span class="number">10000.0</span>) / d_model)) </span><br><span class="line">        pe[:, <span class="number">0</span>::<span class="number">2</span>] = torch.sin(position * div_term) <span class="comment"># å¶æ•°åˆ—</span></span><br><span class="line">        pe[:, <span class="number">1</span>::<span class="number">2</span>] = torch.cos(position * div_term) <span class="comment"># å¥‡æ•°åˆ—</span></span><br><span class="line">        pe = pe.unsqueeze(<span class="number">0</span>)         <span class="comment"># [1, max_len, d_model]</span></span><br><span class="line">        self.register_buffer(<span class="string">'pe'</span>, pe) <span class="comment"># ä¸Šè¿°ä»£ç åªéœ€è®¡ç®—ä¸€æ¬¡ï¼Œç„¶åæ”¾åˆ°å¯„å­˜å™¨é‡Œï¼Œéšç”¨éšå–ã€‚</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x = x + Variable(self.pe[:, :x.size(<span class="number">1</span>)], </span><br><span class="line">                         requires_grad=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> self.dropout(x) <span class="comment"># æ®è¯´dropout=0.1</span></span><br></pre></td></tr></table></figure>
<p><code>x = x + Variable(self.pe[:, :x.size(1)], requires_grad=False)</code> è¿™è¡Œä»£ç è¡¨ç¤ºï¼›è¾“å…¥æ¨¡å‹çš„æ•´ä¸ªEmbeddingæ˜¯Word Embeddingä¸Positional Embeddingç›´æ¥ç›¸åŠ ä¹‹åçš„ç»“æœã€‚</p>
<p>ä¸ºä»€ä¹ˆä¸Šé¢çš„ä¸¤ä¸ªå…¬å¼èƒ½ä½“ç°å•è¯çš„ç›¸å¯¹ä½ç½®ä¿¡æ¯å‘¢ï¼Ÿ</p>
<p>ä¸‹é¢ä¸€æ®µä»£ç å–è¯å‘é‡çš„4ä¸ªç»´åº¦ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ä½ç½®ç¼–ç ä¸‹æ–¹ï¼Œå°†åŸºäºä½ç½®æ·»åŠ æ­£å¼¦æ³¢ã€‚å¯¹äºæ¯ä¸ªç»´åº¦ï¼Œæ³¢çš„é¢‘ç‡å’Œåç§»éƒ½ä¸åŒã€‚</span></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>, <span class="number">5</span>))</span><br><span class="line">pe = PositionalEncoding(<span class="number">20</span>, <span class="number">0</span>)</span><br><span class="line">y = pe.forward(Variable(torch.zeros(<span class="number">1</span>, <span class="number">100</span>, <span class="number">20</span>))) <span class="comment"># [bs=1,seq_len=100,embed_size=20]</span></span><br><span class="line">plt.plot(np.arange(<span class="number">100</span>), y[<span class="number">0</span>, :, <span class="number">4</span>:<span class="number">8</span>].data.numpy())</span><br><span class="line">plt.legend([<span class="string">"dim %d"</span> %p <span class="keyword">for</span> p <span class="keyword">in</span> [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]])</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/11/transformer/position_embedding.png" alt></p>
<p>å¯ä»¥çœ‹åˆ°æŸä¸ªåºåˆ—ä¸­ä¸åŒä½ç½®çš„å•è¯ï¼Œåœ¨æŸä¸€ç»´åº¦ä¸Šçš„ä½ç½®ç¼–ç æ•°å€¼ä¸ä¸€æ ·ï¼Œå³åŒä¸€åºåˆ—çš„ä¸åŒå•è¯åœ¨å•ä¸ªçº¬åº¦ç¬¦åˆæŸä¸ªæ­£å¼¦æˆ–è€…ä½™å¼¦ï¼Œå¯è®¤ä¸ºä»–ä»¬çš„å…·æœ‰ç›¸å¯¹å…³ç³»ã€‚</p>
<h2 id="Encoder"><a href="#Encoder" class="headerlink" title="Encoder"></a>Encoder</h2><p>Encoderéƒ¨åˆ†æ˜¯ç”±ä¸ªå±‚ç›¸åŒå°Encoder Layerä¸²è”è€Œæˆã€‚å°Encoder Layerå¯ä»¥ç®€åŒ–ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>Multi-Head Self Attention</li>
<li>Feed-Forward Network</li>
</ol>
<p><code>Multi-Head Self Attention</code> å’Œ<code>Feed-Forward Network</code>ä¹‹åéƒ½æ¥äº†ä¸€å±‚<code>Add</code> å’Œ<code>Norm</code></p>
<p>ç¤ºæ„å›¾å¦‚ä¸‹:</p>
<p><img src="/2020/05/11/transformer/encoder_layer.png" alt></p>
<h3 id="Muti-Head-Attention"><a href="#Muti-Head-Attention" class="headerlink" title="Muti-Head-Attention"></a>Muti-Head-Attention</h3><p>Multi-Head Self Attention å®é™…ä¸Šæ˜¯<strong>ç”±hä¸ªSelf Attention å±‚å¹¶è¡Œç»„æˆï¼ŒåŸæ–‡ä¸­h=8</strong>ã€‚</p>
<h4 id="Self-Attention"><a href="#Self-Attention" class="headerlink" title="Self-Attention"></a>Self-Attention</h4><p>self-attentionçš„è¾“å…¥æ˜¯åºåˆ—è¯å‘é‡<code>x</code>ã€‚<code>x</code>ç»è¿‡ä¸€ä¸ªçº¿æ€§å˜æ¢å¾—åˆ°<code>query(Q)</code>, <code>x</code>ç»è¿‡ç¬¬äºŒä¸ªçº¿æ€§å˜æ¢å¾—åˆ°<code>key(K)</code>,<code>x</code>ç»è¿‡ç¬¬ä¸‰ä¸ªçº¿æ€§å˜æ¢å¾—åˆ°<code>value(V)</code>ã€‚ä¹Ÿå°±æ˜¯ï¼š</p>
<ul>
<li>Q = linear_q(x)</li>
<li>K = linear_k(x)</li>
<li>V = linear_v(x)</li>
</ul>
<p>å³ï¼š</p>
<p><img src="/2020/05/11/transformer/qkv.png" alt></p>
<p>linear_k, linear_q, linear_væ˜¯ç›¸äº’ç‹¬ç«‹ã€æƒé‡$ğ‘Š^ğ‘„,ğ‘Š^ğ¾,W^V$)æ˜¯ä¸åŒçš„ï¼Œé€šè¿‡è®­ç»ƒå¯å¾—åˆ°ã€‚å¾—åˆ°query(Q)ï¼Œkey(K)ï¼Œvalue(V)ä¹‹åæŒ‰ç…§ä¸‹é¢çš„å…¬å¼è®¡ç®—attention(Q, K, V)ï¼š</p>
<script type="math/tex; mode=display">
\text {Attention}(Q, K, V)=\text {Softmax}\left(\frac{Q K^{T}}{\sqrt{d_{k}}}\right) V</script><p><img src="/2020/05/11/transformer/attention.png" alt></p>
<p>è¿™é‡Œ<code>Z</code>å°±æ˜¯<code>attention(Q, K, V)</code>ï¼Œ$ğ‘‘_ğ‘˜=\frac{ğ‘‘_{ğ‘šğ‘œğ‘‘ğ‘’ğ‘™}}{â„}=\frac{512}{8}=64$ã€‚</p>
<ol>
<li><p>ä¸ºä»€ä¹ˆè¦ç”¨$\sqrt{d_k}$ å¯¹ $ğ‘„ğ¾^ğ‘‡$è¿›è¡Œç¼©æ”¾å‘¢ï¼Ÿ</p>
<p>$d_k$å®é™…ä¸Šæ˜¯<code>Q/K/V</code>çš„æœ€åä¸€ä¸ªç»´åº¦ï¼Œå½“$d_k$è¶Šå¤§ï¼Œ$QK^T$å°±è¶Šå¤§ï¼Œå¯èƒ½ä¼šå°†softmaxå‡½æ•°æ¨å…¥æ¢¯åº¦æå°çš„åŒºåŸŸã€‚</p>
</li>
<li><p>softmaxä¹‹åå€¼éƒ½ä»‹äº0åˆ°1ä¹‹é—´ï¼Œå¯ä»¥ç†è§£æˆå¾—åˆ°äº† attention weightsã€‚ç„¶ååŸºäºè¿™ä¸ª attention weights å¯¹ V æ±‚ weighted sum å€¼ Attention(Q, K, V)ã€‚ </p>
</li>
</ol>
<p>Multi-Head-Attention å°±æ˜¯å°†<code>embedding</code>ä¹‹åçš„XæŒ‰ç»´åº¦$ğ‘‘_{ğ‘šğ‘œğ‘‘ğ‘’ğ‘™}=512$ åˆ‡å‰²æˆ$â„=8$ä¸ªï¼Œåˆ†åˆ«åšself-attentionä¹‹åå†åˆå¹¶åœ¨ä¸€èµ·ã€‚</p>
<p><img src="/2020/05/11/transformer/attention_1.png" alt></p>
<figure class="highlight python"><figcaption><span>Attention</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attention</span><span class="params">(query, key, value, mask=None, dropout=None)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Compute 'Scaled Dot Product Attention</span></span><br><span class="line"><span class="string">    qkv :[batch, h, seq_len, embed_size/h(d_k)]</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    d_k = query.size(<span class="number">-1</span>)</span><br><span class="line">    scores = torch.matmul(query, key.transpose(<span class="number">-2</span>, <span class="number">-1</span>)) / math.sqrt(d_k)</span><br><span class="line">    <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        scores = scores.masked_fill(mask == <span class="number">0</span>, <span class="number">-1e9</span>)  <span class="comment"># mask </span></span><br><span class="line">    p_attn = F.softmax(scores, dim = <span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">if</span> dropout <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        p_attn = dropout(p_attn)     <span class="comment"># dropout=0.1</span></span><br><span class="line">    <span class="keyword">return</span> torch.matmul(p_attn, value), p_attn</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/11/transformer/multi_head.png" alt></p>
<figure class="highlight python"><figcaption><span>MultiHeadedAttention</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MultiHeadedAttention</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, h, d_model, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">        <span class="string">"Take in model size and number of heads."</span></span><br><span class="line">        super(MultiHeadedAttention, self).__init__()</span><br><span class="line">        <span class="keyword">assert</span> d_model % h == <span class="number">0</span></span><br><span class="line">        <span class="comment"># We assume d_v always equals d_k</span></span><br><span class="line">        self.d_k = d_model // h</span><br><span class="line">        self.h = h</span><br><span class="line">        self.linears = clones(nn.Linear(d_model, d_model), <span class="number">4</span>)</span><br><span class="line">        self.attn = <span class="literal">None</span></span><br><span class="line">        self.dropout = nn.Dropout(p=dropout)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, query, key, value, mask=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å®ç°MultiHeadedAttentionã€‚</span></span><br><span class="line"><span class="string">           è¾“å…¥çš„qï¼Œkï¼Œvæ˜¯å½¢çŠ¶ [batch, seq_len, embed_size(d_model)]ã€‚</span></span><br><span class="line"><span class="string">           è¾“å‡ºçš„x çš„å½¢çŠ¶åŒä¸Šã€‚</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># Same mask applied to all h heads.</span></span><br><span class="line">            mask = mask.unsqueeze(<span class="number">1</span>)</span><br><span class="line">        nbatches = query.size(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1) Do all the linear projections in batch from d_model =&gt; h x d_k </span></span><br><span class="line">        <span class="comment">#    [batch, seq_len, embed_size] -&gt;[batch, h, seq_len, embed_size/h]</span></span><br><span class="line">        query, key, value = [l(x).view(nbatches, <span class="number">-1</span>, self.h, self.d_k).transpose(<span class="number">1</span>, <span class="number">2</span>) <span class="keyword">for</span> l, x <span class="keyword">in</span> zip(self.linears, (query, key, value))]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2) Apply attention on all the projected vectors in batch.</span></span><br><span class="line">        <span class="comment">#    è®¡ç®—æ³¨æ„åŠ›attn å¾—åˆ°attn*v ä¸attn </span></span><br><span class="line">        <span class="comment">#    qkv :[batch, h, seq_len, embed_size/h] --&gt;</span></span><br><span class="line">        <span class="comment">#              x:[batch, h, seq_len, embed_size/h], attn[batch, h, seq_len, seq_len]</span></span><br><span class="line">        x, self.attn = attention(query, key, value, mask=mask, dropout=self.dropout)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3) "Concat" using a view and apply a final linear.</span></span><br><span class="line">        <span class="comment">#     ä¸Šä¸€æ­¥çš„ç»“æœåˆå¹¶åœ¨ä¸€èµ·è¿˜åŸæˆåŸå§‹è¾“å…¥åºåˆ—çš„å½¢çŠ¶</span></span><br><span class="line">        x = x.transpose(<span class="number">1</span>, <span class="number">2</span>).contiguous().view(nbatches, <span class="number">-1</span>, self.h * self.d_k)</span><br><span class="line">        <span class="keyword">return</span> self.linears[<span class="number">-1</span>](x)  <span class="comment"># æœ€åå†è¿‡ä¸€ä¸ªçº¿æ€§å±‚</span></span><br></pre></td></tr></table></figure>
<h4 id="Self-Attentionçš„ä¼˜ç‚¹"><a href="#Self-Attentionçš„ä¼˜ç‚¹" class="headerlink" title="Self-Attentionçš„ä¼˜ç‚¹"></a>Self-Attentionçš„ä¼˜ç‚¹</h4><ol>
<li>å› ä¸ºæ¯ä¸ªè¯éƒ½å’Œå‘¨å›´æ‰€æœ‰è¯åšattentionï¼Œæ‰€ä»¥ä»»æ„ä¸¤ä¸ªä½ç½®éƒ½ç›¸å½“äºæœ‰ç›´è¿çº¿è·¯ï¼Œå¯æ•è·é•¿è·ç¦»ä¾èµ–ã€‚</li>
<li>Attentionçš„å¯è§£é‡Šæ€§æ›´å¥½ï¼Œæ ¹æ®Attention scoreå¯ä»¥çŸ¥é“ä¸€ä¸ªè¯å’Œå“ªäº›è¯çš„å…³ç³»æ¯”è¾ƒå¤§ã€‚</li>
<li>æ˜“äºå¹¶è¡ŒåŒ–ï¼Œå½“å‰å±‚çš„Attentionè®¡ç®—åªå’Œå‰ä¸€å±‚çš„å€¼æœ‰å…³ï¼Œæ‰€ä»¥ä¸€å±‚çš„æ‰€æœ‰èŠ‚ç‚¹å¯å¹¶è¡Œæ‰§è¡Œself-attentionæ“ä½œã€‚è®¡ç®—æ•ˆç‡é«˜ï¼Œä¸€æ¬¡Self-Attentionåªéœ€è¦ä¸¤æ¬¡çŸ©é˜µè¿ç®—ï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚</li>
</ol>
<h3 id="Add-amp-Norm"><a href="#Add-amp-Norm" class="headerlink" title="Add &amp; Norm"></a>Add &amp; Norm</h3><p><code>x</code> åºåˆ—ç»è¿‡<code>Multi-Head-Self-Attention</code> ä¹‹åå®é™…ç»è¿‡ä¸€ä¸ª<code>Add+Norm</code>å±‚ï¼Œå†è¿›å…¥<code>feed-forward network(FFN)</code>ï¼Œåœ¨<code>FFN</code>ä¹‹ååˆç»è¿‡ä¸€ä¸ª<code>norm</code>å†è¾“å…¥ä¸‹ä¸€ä¸ªencoder layerã€‚å‡ ä¹æ¯ä¸ªsub layerä¹‹åéƒ½ä¼šç»è¿‡ä¸€ä¸ªå½’ä¸€åŒ–ï¼Œç„¶åå†åŠ åœ¨åŸæ¥çš„è¾“å…¥ä¸Šã€‚</p>
<figure class="highlight python"><figcaption><span>Norm</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LayerNorm</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Construct a layernorm module (See citation for details)."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, features, eps=<span class="number">1e-6</span>)</span>:</span></span><br><span class="line">        super(LayerNorm, self).__init__()</span><br><span class="line">        self.a_2 = nn.Parameter(torch.ones(features)) </span><br><span class="line">        self.b_2 = nn.Parameter(torch.zeros(features)) </span><br><span class="line">        self.eps = eps</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        mean = x.mean(<span class="number">-1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        std = x.std(<span class="number">-1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> self.a_2 * (x - mean) / (std + self.eps) + self.b_2</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><figcaption><span>Add</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SublayerConnection</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A residual connection followed by a layer norm.</span></span><br><span class="line"><span class="string">    Note for code simplicity the norm is first as opposed to last.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size, dropout)</span>:</span></span><br><span class="line">        super(SublayerConnection, self).__init__()</span><br><span class="line">        self.norm = LayerNorm(size)</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, sublayer)</span>:</span></span><br><span class="line">        <span class="string">"Apply residual connection to any sublayer with the same size."</span></span><br><span class="line">        <span class="comment"># sublayer &lt;-- encoder layer</span></span><br><span class="line">        <span class="keyword">return</span> x + self.dropout(sublayer(self.norm(x)))</span><br></pre></td></tr></table></figure>
<h3 id="Feed-Forward-Network"><a href="#Feed-Forward-Network" class="headerlink" title="Feed-Forward Network"></a>Feed-Forward Network</h3><p>Feed-Forward Networkå¯ä»¥ç»†åˆ†ä¸ºæœ‰ä¸¤å±‚ï¼Œç¬¬ä¸€å±‚æ˜¯ä¸€ä¸ªçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œç¬¬äºŒå±‚æ˜¯æ¿€æ´»å‡½æ•°æ˜¯ReLUã€‚å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<script type="math/tex; mode=display">
F F N=\max \left(0, x W_{1}+b_{1}\right) W_{2}+b_{2}</script><figure class="highlight python"><figcaption><span>PositionwiseFeedForward</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PositionwiseFeedForward</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"""Implements FFN equation.</span></span><br><span class="line"><span class="string">    positionwiseä½“ç°æ¯ä¸ªå•è¯ä¸Šåšlinearï¼Œå•è¯ä¹‹é—´å„ä¸ç›¸åŒ</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, d_ff, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">      <span class="string">"""</span></span><br><span class="line"><span class="string">      d_model: embedding_size</span></span><br><span class="line"><span class="string">      d_ff: çº¿å½¢å±‚è¾“å‡ºç»´åº¦</span></span><br><span class="line"><span class="string">      """</span></span><br><span class="line">        super(PositionwiseFeedForward, self).__init__()</span><br><span class="line">        self.w_1 = nn.Linear(d_model, d_ff)</span><br><span class="line">        self.w_2 = nn.Linear(d_ff, d_model)</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.w_2(self.dropout(F.relu(self.w_1(x))))</span><br></pre></td></tr></table></figure>
<h3 id="ç»„åˆå‡ºEncoder"><a href="#ç»„åˆå‡ºEncoder" class="headerlink" title="ç»„åˆå‡ºEncoder"></a>ç»„åˆå‡ºEncoder</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clones</span><span class="params">(module, N)</span>:</span></span><br><span class="line">    <span class="string">"Produce N identical layers."</span></span><br><span class="line">    <span class="keyword">return</span> nn.ModuleList([copy.deepcopy(module) <span class="keyword">for</span> _ <span class="keyword">in</span> range(N)])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Encoder</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Core encoder is a stack of N layers"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, layer, N)</span>:</span></span><br><span class="line">        super(Encoder, self).__init__()</span><br><span class="line">        self.layers = clones(layer, N)  <span class="comment"># sub layer</span></span><br><span class="line">        self.norm = LayerNorm(layer.size)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, mask)</span>:</span></span><br><span class="line">        <span class="string">"Pass the input (and mask) through each layer in turn."</span></span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.layers:</span><br><span class="line">            x = layer(x, mask)</span><br><span class="line">        <span class="keyword">return</span> self.norm(x)</span><br></pre></td></tr></table></figure>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>æ€»çš„æ¥è¯´Encoder æ˜¯ç”±ä¸Šè¿°å°encoder layer 6ä¸ªä¸²è¡Œå åŠ ç»„æˆã€‚encoder sub layerä¸»è¦åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>SubLayer-1 åš Multi-Headed Attention</li>
<li>SubLayer-2 åš Feed Forward Neural Network</li>
</ul>
<h2 id="Decoder"><a href="#Decoder" class="headerlink" title="Decoder"></a>Decoder</h2><p>Decoderä¸Encoderæœ‰æ‰€ä¸åŒï¼ŒEncoderä¸Decoderçš„å…³ç³»å¯ä»¥ç”¨ä¸‹å›¾æè¿°ï¼š</p>
<p><img src="/2020/05/11/transformer/decoder.png" alt></p>
<figure class="highlight python"><figcaption><span>Decoder</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Decoder</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Generic N layer decoder with masking."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, layer, N)</span>:</span></span><br><span class="line">        super(Decoder, self).__init__()</span><br><span class="line">        self.layers = clones(layer, N)</span><br><span class="line">        self.norm = LayerNorm(layer.size)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, memory, src_mask, tgt_mask)</span>:</span> </span><br><span class="line">      	<span class="comment"># memory Encoderæœ€åçš„è¾“å‡ºã€‚ </span></span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.layers:</span><br><span class="line">            x = layer(x, memory, src_mask, tgt_mask)</span><br><span class="line">        <span class="keyword">return</span> self.norm(x)</span><br></pre></td></tr></table></figure>
<p>Decoder å­ç»“æ„ï¼ˆsub layerï¼‰ï¼š</p>
<p><img src="/2020/05/11/transformer/decoder_layer.png" alt></p>
<p>Decoder ä¹Ÿæ˜¯N=6å±‚å †å çš„ç»“æ„ã€‚è¢«åˆ†ä¸º3ä¸ª SubLayerï¼ŒEncoderä¸Decoderæœ‰ä¸‰å¤§ä¸»è¦çš„ä¸åŒï¼š</p>
<ol>
<li>Decoder SubLayer-1 ä½¿ç”¨çš„æ˜¯ â€œMaskedâ€ Multi-Headed Attention æœºåˆ¶ï¼Œé˜²æ­¢ä¸ºäº†æ¨¡å‹çœ‹åˆ°è¦é¢„æµ‹çš„æ•°æ®ï¼Œé˜²æ­¢æ³„éœ²ã€‚</li>
<li>SubLayer-2 æ˜¯ä¸€ä¸ª Encoder-Decoder Multi-head Attentionã€‚</li>
<li>LinearLayer å’Œ SoftmaxLayer ä½œç”¨äº SubLayer-3 çš„è¾“å‡ºåé¢ï¼Œæ¥é¢„æµ‹å¯¹åº”çš„ word çš„ probabilities ã€‚</li>
</ol>
<h3 id="Mask-Multi-Head-Attention"><a href="#Mask-Multi-Head-Attention" class="headerlink" title="Mask-Multi-Head-Attention"></a>Mask-Multi-Head-Attention</h3><p>Mask çš„ç›®çš„æ˜¯é˜²æ­¢ Decoder â€œseeing the futureâ€ï¼Œé˜²æ­¢æå‰çŸ¥é“é¢„æµ‹çš„å†…å®¹ï¼ˆensures that the predictions for position $i$ can depend only on the known outputs at positions less than $i$.ï¼‰,è¿™ä¹Ÿè¯´æ˜Transformeråªæ˜¯åœ¨Encoderé˜¶æ®µå¯ä»¥å¹¶è¡ŒåŒ–ï¼ŒDecoderé˜¶æ®µä¾ç„¶è¦ä¸€ä¸ªä¸ªè¯é¡ºåºç¿»è¯‘ï¼Œä¾ç„¶æ˜¯<strong>ä¸²è¡Œ</strong>çš„ã€‚è¿™é‡Œmaskæ˜¯ä¸€ä¸ªä¸‹ä¸‰è§’çŸ©é˜µï¼Œå¯¹è§’çº¿ä»¥åŠå¯¹è§’çº¿å·¦ä¸‹éƒ½æ˜¯1ï¼Œå…¶ä½™éƒ½æ˜¯0ã€‚</p>
<figure class="highlight python"><figcaption><span>subsequent_mask</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">subsequent_mask</span><span class="params">(size)</span>:</span></span><br><span class="line">    <span class="string">""""Mask out subsequent positions.</span></span><br><span class="line"><span class="string">    maskåç»­çš„ä½ç½®ï¼Œè¿”å›[size, size]å°ºå¯¸ä¸‹ä¸‰è§’Tensor</span></span><br><span class="line"><span class="string">    å¯¹è§’çº¿åŠå…¶å·¦ä¸‹è§’å…¨æ˜¯1ï¼Œå³ä¸Šè§’å…¨æ˜¯0</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    attn_shape = (<span class="number">1</span>, size, size)</span><br><span class="line">    <span class="comment"># np.triu()  Upper triangle of an array: è¿”å›çŸ©é˜µä¸Šä¸‰è§’</span></span><br><span class="line">    subsequent_mask = np.triu(np.ones(attn_shape), k=<span class="number">1</span>).astype(<span class="string">'uint8'</span>)</span><br><span class="line">    <span class="keyword">return</span> torch.from_numpy(subsequent_mask) == <span class="number">0</span> <span class="comment"># ç­‰äº0ï¼Œè¿”å›çš„æ˜¯çŸ©é˜µçš„ä¸‹ä¸‰è§’</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">5</span>,<span class="number">5</span>))</span><br><span class="line">plt.imshow(subsequent_mask(<span class="number">20</span>)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="/2020/05/11/transformer/subsequent_mask.png" alt></p>
<p>subsequent_mask è¿”å›ç»“æœï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tensor([[[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]]], dtype=torch.uint8)</span><br></pre></td></tr></table></figure>
<p>å½“maskä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œattentionè®¡ç®—éœ€è¦å°†xåšä¸€ä¸ªæ“ä½œï¼šscores = scores.masked_fill(mask == 0, -1e9)ã€‚å³å°†mask==0çš„æ›¿æ¢ä¸º-1e9,å…¶ä½™ä¸å˜ã€‚</p>
<h3 id="Encoder-Decoder-Multi-head-Attention"><a href="#Encoder-Decoder-Multi-head-Attention" class="headerlink" title="Encoder-Decoder Multi-head Attention"></a>Encoder-Decoder Multi-head Attention</h3><p>è¿™éƒ¨åˆ†å’ŒMulti-head Attentionçš„åŒºåˆ«æ˜¯è¯¥å±‚çš„è¾“å…¥æ¥è‡ªencoderå’Œä¸Šä¸€æ¬¡decoderçš„ç»“æœã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecoderLayer</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Decoder is made of self-attn, src-attn, and feed forward (defined below)"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size, self_attn, src_attn, feed_forward, dropout)</span>:</span></span><br><span class="line">        super(DecoderLayer, self).__init__()</span><br><span class="line">        self.size = size</span><br><span class="line">        self.self_attn = self_attn</span><br><span class="line">        self.src_attn = src_attn</span><br><span class="line">        self.feed_forward = feed_forward</span><br><span class="line">        self.sublayer = clones(SublayerConnection(size, dropout), <span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, memory, src_mask, tgt_mask)</span>:</span></span><br><span class="line">        <span class="string">"Follow Figure 1 (right) for connections."</span></span><br><span class="line">      	<span class="comment"># å°†decoderçš„ä¸‰ä¸ªSublayerä¸²è”èµ·æ¥</span></span><br><span class="line">        m = memory <span class="comment"># ä¸ºencoder æœ€åçš„è¾“å‡º</span></span><br><span class="line">        x = self.sublayer[<span class="number">0</span>](x, <span class="keyword">lambda</span> x: self.self_attn(x, x, x, tgt_mask))</span><br><span class="line">        x = self.sublayer[<span class="number">1</span>](x, <span class="keyword">lambda</span> x: self.src_attn(x, m, m, src_mask))</span><br><span class="line">        <span class="keyword">return</span> self.sublayer[<span class="number">2</span>](x, self.feed_forward)</span><br></pre></td></tr></table></figure>
<h3 id="Linear-and-Softmax-to-Produce-Output-Probabilities"><a href="#Linear-and-Softmax-to-Produce-Output-Probabilities" class="headerlink" title="Linear and Softmax to Produce Output Probabilities"></a>Linear and Softmax to Produce Output Probabilities</h3><p>Decoderçš„æœ€åä¸€ä¸ªéƒ¨åˆ†æ˜¯è¿‡ä¸€ä¸ªlinear layerå°†decoderçš„è¾“å‡ºæ‰©å±•åˆ°ä¸vocabulary sizeä¸€æ ·çš„ç»´åº¦ä¸Šã€‚ç»è¿‡softmax åï¼Œé€‰æ‹©æ¦‚ç‡æœ€é«˜çš„ä¸€ä¸ªwordä½œä¸ºé¢„æµ‹ç»“æœã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå·²ç»è®­ç»ƒå¥½çš„ç½‘ç»œï¼Œåœ¨åšé¢„æµ‹æ—¶ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç»™ decoder è¾“å…¥ encoder å¯¹æ•´ä¸ªå¥å­ embedding çš„ç»“æœå’Œä¸€ä¸ªç‰¹æ®Šçš„å¼€å§‹ç¬¦å· &lt;/s&gt;ã€‚decoder å°†äº§ç”Ÿé¢„æµ‹ï¼Œåœ¨ä¾‹å­ä¸­åº”è¯¥æ˜¯ <code>I</code>ã€‚</li>
<li>ç»™ decoder è¾“å…¥ encoder çš„ embedding ç»“æœå’Œ â€œ&lt;/s&gt; Iâ€ï¼Œåœ¨è¿™ä¸€æ­¥ decoder åº”è¯¥äº§ç”Ÿé¢„æµ‹ <code>am</code>ã€‚</li>
<li>ç»™ decoder è¾“å…¥ encoder çš„ embedding ç»“æœå’Œ â€œ&lt;/s&gt; I amâ€ï¼Œåœ¨è¿™ä¸€æ­¥ decoder åº”è¯¥äº§ç”Ÿé¢„æµ‹ <code>a</code>ã€‚</li>
<li>ç»™ decoder è¾“å…¥ encoder çš„ embedding ç»“æœå’Œ â€œ&lt;/s&gt; I am aâ€ï¼Œåœ¨è¿™ä¸€æ­¥ decoder åº”è¯¥äº§ç”Ÿé¢„æµ‹ <code>student</code>ã€‚</li>
<li>ç»™ decoder è¾“å…¥ encoder çš„ embedding ç»“æœå’Œ â€œ&lt;/s&gt;I am a studentâ€, decoderåº”è¯¥ç”Ÿæˆå¥å­ç»“å°¾çš„æ ‡è®°ï¼Œdecoder åº”è¯¥è¾“å‡º <code>&lt;/eos&gt;</code>ã€‚</li>
<li>ç„¶å decoder ç”Ÿæˆäº† &lt;/eos&gt;ï¼Œç¿»è¯‘å®Œæˆã€‚</li>
</ol>
<p>è¿™éƒ¨åˆ†çš„ä»£ç å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Generator</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Define standard linear + softmax generation step."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, vocab)</span>:</span></span><br><span class="line">    		<span class="string">"""</span></span><br><span class="line"><span class="string">    		d_model:decoder è¾“å‡ºçš„embedding size</span></span><br><span class="line"><span class="string">    		vocabï¼šç›®æ ‡çš„è¯æ±‡è¡¨å¤§å°</span></span><br><span class="line"><span class="string">    		"""</span></span><br><span class="line">        super(Generator, self).__init__()</span><br><span class="line">        self.proj = nn.Linear(d_model, vocab)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.proj(x), dim=<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="EncoderDecoder"><a href="#EncoderDecoder" class="headerlink" title="EncoderDecoder"></a>EncoderDecoder</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EncoderDecoder</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A standard Encoder-Decoder architecture. Base for this and many </span></span><br><span class="line"><span class="string">    other models.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, encoder, decoder, src_embed, tgt_embed, generator)</span>:</span></span><br><span class="line">        super(EncoderDecoder, self).__init__()</span><br><span class="line">        self.encoder = encoder</span><br><span class="line">        self.decoder = decoder</span><br><span class="line">        self.src_embed = src_embed <span class="comment"># embedding</span></span><br><span class="line">        self.tgt_embed = tgt_embed <span class="comment"># embedding</span></span><br><span class="line">        self.generator = generator <span class="comment"># ç”¨äºç”Ÿæˆç¿»è¯‘ç›®æ ‡ï¼ˆLinear + softmax --&gt; probï¼‰</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, src, tgt, src_mask, tgt_mask)</span>:</span></span><br><span class="line">        <span class="string">"Take in and process masked src and target sequences."</span></span><br><span class="line">        <span class="keyword">return</span> self.decode(self.encode(src, src_mask), src_mask,</span><br><span class="line">                            tgt, tgt_mask)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(self, src, src_mask)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.encoder(self.src_embed(src), src_mask)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(self, memory, src_mask, tgt, tgt_mask)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.decoder(self.tgt_embed(tgt), memory, src_mask, tgt_mask)</span><br></pre></td></tr></table></figure>
<h2 id="Full-Model"><a href="#Full-Model" class="headerlink" title="Full Model"></a>Full Model</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_model</span><span class="params">(src_vocab, tgt_vocab, N=<span class="number">6</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">               d_model=<span class="number">512</span>, d_ff=<span class="number">2048</span>, h=<span class="number">8</span>, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">    <span class="string">"Helper: Construct a model from hyperparameters."</span></span><br><span class="line">    c = copy.deepcopy</span><br><span class="line">    attn = MultiHeadedAttention(h, d_model)</span><br><span class="line">    ff = PositionwiseFeedForward(d_model, d_ff, dropout) <span class="comment"># linear(relu(linear(x)))</span></span><br><span class="line">    position = PositionalEncoding(d_model, dropout)</span><br><span class="line">    model = EncoderDecoder(</span><br><span class="line">        Encoder(EncoderLayer(d_model, c(attn), c(ff), dropout), N),</span><br><span class="line">        Decoder(DecoderLayer(d_model, c(attn), c(attn), </span><br><span class="line">                             c(ff), dropout), N),</span><br><span class="line">        nn.Sequential(Embeddings(d_model, src_vocab), c(position)),</span><br><span class="line">        nn.Sequential(Embeddings(d_model, tgt_vocab), c(position)),</span><br><span class="line">        Generator(d_model, tgt_vocab))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># This was important from their code. </span></span><br><span class="line">    <span class="comment"># Initialize parameters with Glorot / fan_avg.</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> model.parameters():</span><br><span class="line">        <span class="keyword">if</span> p.dim() &gt; <span class="number">1</span>:</span><br><span class="line">            nn.init.xavier_uniform(p)</span><br><span class="line">    <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure>
<h1 id="Training"><a href="#Training" class="headerlink" title="Training"></a>Training</h1><p>è¿™éƒ¨åˆ†ä¸»è¦æ ¹æ®è‡ªå·±çš„ç†è§£å¯¹ä»£ç åŠ æ³¨é‡Š</p>
<h2 id="Batches-and-Masking"><a href="#Batches-and-Masking" class="headerlink" title="Batches and Masking"></a>Batches and Masking</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Batch</span>:</span></span><br><span class="line">    <span class="string">"Object for holding a batch of data with mask during training."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, src, trg=None, pad=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self.src = src</span><br><span class="line">        self.src_mask = (src != pad).unsqueeze(<span class="number">-2</span>) <span class="comment"># å¯¹è¶…å‡ºå¥å­é•¿åº¦éƒ¨åˆ†mask</span></span><br><span class="line">        <span class="keyword">if</span> trg <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.trg = trg[:, :<span class="number">-1</span>]</span><br><span class="line">            self.trg_y = trg[:, <span class="number">1</span>:]</span><br><span class="line">            self.trg_mask = self.make_std_mask(self.trg, pad) <span class="comment"># mask to hide padding and future words</span></span><br><span class="line">            self.ntokens = (self.trg_y != pad).data.sum()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_std_mask</span><span class="params">(tgt, pad)</span>:</span></span><br><span class="line">        <span class="string">"Create a mask to hide padding and future words."</span></span><br><span class="line">        tgt_mask = (tgt != pad).unsqueeze(<span class="number">-2</span>)</span><br><span class="line">        tgt_mask = tgt_mask &amp; Variable(</span><br><span class="line">            subsequent_mask(tgt.size(<span class="number">-1</span>)).type_as(tgt_mask.data))</span><br><span class="line">        <span class="keyword">return</span> tgt_mask</span><br></pre></td></tr></table></figure>
<h2 id="Training-Loop"><a href="#Training-Loop" class="headerlink" title="Training Loop"></a>Training Loop</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_epoch</span><span class="params">(data_iter, model, loss_compute)</span>:</span></span><br><span class="line">    <span class="string">"Standard Training and Logging Function"</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    total_tokens = <span class="number">0</span></span><br><span class="line">    total_loss = <span class="number">0</span></span><br><span class="line">    tokens = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, batch <span class="keyword">in</span> enumerate(data_iter):</span><br><span class="line">        out = model.forward(batch.src, batch.trg, </span><br><span class="line">                            batch.src_mask, batch.trg_mask)</span><br><span class="line">        loss = loss_compute(out, batch.trg_y, batch.ntokens)</span><br><span class="line">        total_loss += loss</span><br><span class="line">        total_tokens += batch.ntokens</span><br><span class="line">        tokens += batch.ntokens</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">50</span> == <span class="number">1</span>:</span><br><span class="line">            elapsed = time.time() - start</span><br><span class="line">            print(<span class="string">"Epoch Step: %d Loss: %f Tokens per Sec: %f"</span> %</span><br><span class="line">                    (i, loss / batch.ntokens, tokens / elapsed))</span><br><span class="line">            start = time.time()</span><br><span class="line">            tokens = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> total_loss / total_tokens</span><br></pre></td></tr></table></figure>
<h2 id="Training-Data"><a href="#Training-Data" class="headerlink" title="Training Data"></a>Training Data</h2><p>ä½¿ç”¨æ ‡å‡†WMT 2014è‹±è¯­-å¾·è¯­æ•°æ®é›†è¿›è¡Œäº†è®­ç»ƒï¼Œè¯¥æ•°æ®é›†åŒ…å«å¤§çº¦450ä¸‡ä¸ªå¥å­å¯¹ã€‚ ä½¿ç”¨å­—èŠ‚å¯¹çš„ç¼–ç æ–¹æ³•å¯¹å¥å­è¿›è¡Œç¼–ç ï¼Œè¯¥ç¼–ç å…·æœ‰å¤§çº¦37000ä¸ªè¯çš„å…±äº«æº-ç›®æ ‡è¯æ±‡è¡¨ã€‚ å¯¹äºè‹±è¯­-æ³•è¯­ï¼Œä½¿ç”¨äº†WMT 2014 è‹±è¯­-æ³•è¯­æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†ç”±36Mä¸ªå¥å­ç»„æˆï¼Œå¹¶å°†è¯åˆ†æˆ32000ä¸ªè¯ç‰‡(Word-piece)çš„è¯æ±‡è¡¨ã€‚å¥å­å¯¹æŒ‰ç…§è¿‘ä¼¼çš„åºåˆ—é•¿åº¦è¿›è¡Œæ‰¹å¤„ç†ã€‚æ¯ä¸ªè®­ç»ƒæ‰¹åŒ…å«ä¸€ç»„å¥å­å¯¹ï¼ŒåŒ…å«å¤§çº¦25000ä¸ªæºè¯å’Œ25000ä¸ªç›®æ ‡è¯ã€‚</p>
<p>ä½¿ç”¨torch textæ¥åˆ›å»ºbatchã€‚åœ¨torchtextçš„ä¸€ä¸ªå‡½æ•°ä¸­åˆ›å»ºbatchï¼Œç¡®ä¿å¡«å……åˆ°æœ€å¤§batchè®­ç»ƒé•¿åº¦çš„å¤§å°ä¸è¶…è¿‡é˜ˆå€¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">global</span> max_src_in_batch, max_tgt_in_batch</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">batch_size_fn</span><span class="params">(new, count, sofar)</span>:</span></span><br><span class="line">    <span class="string">"Keep augmenting batch and calculate total number of tokens + padding."</span></span><br><span class="line">    <span class="keyword">global</span> max_src_in_batch, max_tgt_in_batch</span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>: <span class="comment"># ï¼Ÿï¼Ÿ</span></span><br><span class="line">        max_src_in_batch = <span class="number">0</span></span><br><span class="line">        max_tgt_in_batch = <span class="number">0</span></span><br><span class="line">    max_src_in_batch = max(max_src_in_batch,  len(new.src))</span><br><span class="line">    max_tgt_in_batch = max(max_tgt_in_batch,  len(new.trg) + <span class="number">2</span>)</span><br><span class="line">    src_elements = count * max_src_in_batch</span><br><span class="line">    tgt_elements = count * max_tgt_in_batch</span><br><span class="line">    <span class="keyword">return</span> max(src_elements, tgt_elements)</span><br></pre></td></tr></table></figure>
<h2 id="Optimizer"><a href="#Optimizer" class="headerlink" title="Optimizer"></a>Optimizer</h2><p>é€‰æ‹©Adamä½œä¸ºä¼˜åŒ–å™¨ï¼Œå…¶å‚æ•°ä¸º$\beta_1 = 0.9, \beta_2=0.98,\epsilon=10^{-9}$ã€‚æ ¹æ®$lrate = d_{model}^{- \frac{1}{2}} * min(step_num^{- \frac{1}{2}},step_num \cdot warmup_steps^{-1.5})$ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ”¹å˜äº†å­¦ä¹ ç‡ã€‚åœ¨<code>warm_up</code>ä¸­éšæ­¥æ•°çº¿æ€§åœ°å¢åŠ å­¦ä¹ é€Ÿç‡ï¼Œéšåä¸æ­¥æ•°çš„åå¹³æ–¹æ ¹æˆæ¯”ä¾‹åœ°å‡å°å®ƒã€‚é¢„çƒ­<code>warmup_steps</code>ä¸º4000ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoamOpt</span>:</span></span><br><span class="line">    <span class="string">"Optim wrapper that implements rate."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, model_size, factor, warmup, optimizer)</span>:</span></span><br><span class="line">        self.optimizer = optimizer</span><br><span class="line">        self._step = <span class="number">0</span></span><br><span class="line">        self.warmup = warmup</span><br><span class="line">        self.factor = factor</span><br><span class="line">        self.model_size = model_size</span><br><span class="line">        self._rate = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">step</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"Update parameters and rate"</span></span><br><span class="line">        self._step += <span class="number">1</span></span><br><span class="line">        rate = self.rate()</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> self.optimizer.param_groups:</span><br><span class="line">            p[<span class="string">'lr'</span>] = rate</span><br><span class="line">        self._rate = rate</span><br><span class="line">        self.optimizer.step()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rate</span><span class="params">(self, step = None)</span>:</span></span><br><span class="line">        <span class="string">"Implement `lrate` above"</span></span><br><span class="line">        <span class="keyword">if</span> step <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            step = self._step</span><br><span class="line">        <span class="comment"># å¯¹åº”ä¸Šé¢å…¬å¼</span></span><br><span class="line">        <span class="keyword">return</span> self.factor * (self.model_size ** (<span class="number">-0.5</span>) * min(step ** (<span class="number">-0.5</span>), step * self.warmup ** (<span class="number">-1.5</span>)))</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_std_opt</span><span class="params">(model)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> NoamOpt(model.src_embed[<span class="number">0</span>].d_model, <span class="number">2</span>, <span class="number">4000</span>,torch.optim.Adam(model.parameters(), lr=<span class="number">0</span>, betas=(<span class="number">0.9</span>, <span class="number">0.98</span>), eps=<span class="number">1e-9</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">opts = [NoamOpt(<span class="number">512</span>, <span class="number">1</span>, <span class="number">4000</span>, <span class="literal">None</span>), </span><br><span class="line">        NoamOpt(<span class="number">512</span>, <span class="number">1</span>, <span class="number">8000</span>, <span class="literal">None</span>),</span><br><span class="line">        NoamOpt(<span class="number">256</span>, <span class="number">1</span>, <span class="number">4000</span>, <span class="literal">None</span>)]</span><br><span class="line">plt.plot(np.arange(<span class="number">1</span>, <span class="number">20000</span>), [[opt.rate(i) <span class="keyword">for</span> opt <span class="keyword">in</span> opts] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">20000</span>)])</span><br><span class="line">plt.legend([<span class="string">"512:4000"</span>, <span class="string">"512:8000"</span>, <span class="string">"256:4000"</span>])</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/11/transformer/warm_up.png" alt></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<ol>
<li>åœ¨embedding sizeç›¸åŒçš„æƒ…å†µä¸‹ï¼Œwarm upæ­¥æ•°è¶Šå°‘ï¼Œå‰æœŸçš„å­¦ä¹ ç‡æ›²çº¿è¶Šé™¡å³­ï¼Œå­¦çš„è¶Šå¿«ã€‚</li>
<li>åœ¨warm upæ­¥æ•°ç›¸åŒçš„æ—¶å€™ï¼Œembedding size è¶Šå°ï¼Œå‰æœŸçš„å­¦ä¹ ç‡æ›²çº¿è¶Šé™¡å³­ï¼Œå­¦çš„è¶Šå¿«ã€‚</li>
</ol>
<h2 id="Regularization"><a href="#Regularization" class="headerlink" title="Regularization"></a>Regularization</h2><h3 id="Label-Smoothing"><a href="#Label-Smoothing" class="headerlink" title="Label Smoothing"></a>Label Smoothing</h3><h4 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h4><p>åœ¨å¤šåˆ†ç±»è®­ç»ƒä»»åŠ¡ä¸­ï¼Œè¾“å…¥ç»è¿‡ç¥çº§ç½‘ç»œçš„è®¡ç®—ï¼Œä¼šå¾—åˆ°å½“å‰è¾“å…¥å¯¹åº”äºå„ä¸ªç±»åˆ«çš„ç½®ä¿¡åº¦åˆ†æ•°ï¼Œè¿™äº›åˆ†æ•°ä¼šè¢«softmaxè¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œæœ€ç»ˆå¾—åˆ°å½“å‰è¾“å…¥å±äºæ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ã€‚</p>
<script type="math/tex; mode=display">
q_{i}=\frac{\exp \left(z_{i}\right)}{\sum_{j=1}^{K} \exp \left(z_{j}\right)}</script><p>ä¹‹ååœ¨ä½¿ç”¨äº¤å‰ç†µå‡½æ•°æ¥è®¡ç®—æŸå¤±å€¼ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
&L o s s=-\sum_{i=1}^{K} p_{i} \log q_{i}\\
&p_{i}=\left\{\begin{array}{l}
1, \text { if }(i=y) \\
0, i f(i \neq y)
\end{array}\right.
\end{aligned}</script><p>å…¶ä¸­ï¼Œiè¡¨ç¤ºå¤šç±»ä¸­çš„æŸä¸€ç±»ã€‚</p>
<p>æœ€ç»ˆåœ¨è®­ç»ƒç½‘ç»œæ—¶ï¼Œæœ€å°åŒ–é¢„æµ‹æ¦‚ç‡å’Œæ ‡ç­¾çœŸå®æ¦‚ç‡çš„äº¤å‰ç†µï¼Œä»è€Œå¾—åˆ°æœ€ä¼˜çš„é¢„æµ‹æ¦‚ç‡åˆ†å¸ƒã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†è¾¾åˆ°æœ€å¥½çš„æ‹Ÿåˆæ•ˆæœï¼Œæœ€ä¼˜çš„é¢„æµ‹æ¦‚ç‡åˆ†å¸ƒä¸ºï¼š</p>
<script type="math/tex; mode=display">
Z_{i}=\left\{\begin{array}{l}
+\infty, i f(i=y) \\
0, i f(i \neq y)
\end{array}\right.</script><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç½‘ç»œä¼šé©±ä½¿è‡ªèº«å¾€æ­£ç¡®æ ‡ç­¾å’Œé”™è¯¯æ ‡ç­¾å·®å€¼å¤§çš„æ–¹å‘å­¦ä¹ ï¼Œåœ¨è®­ç»ƒæ•°æ®ä¸è¶³ä»¥è¡¨å¾æ‰€ä»¥çš„æ ·æœ¬ç‰¹å¾çš„æƒ…å†µä¸‹ï¼Œå°±<strong>ä¼šå¯¼è‡´ç½‘ç»œè¿‡æ‹Ÿåˆ</strong>ã€‚</p>
<h4 id="label-smoothingåŸç†"><a href="#label-smoothingåŸç†" class="headerlink" title="label smoothingåŸç†"></a>label smoothingåŸç†</h4><p>label smoothingçš„æå‡ºå°±æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæ˜¯ä¸€ç§æ­£åˆ™åŒ–çš„ç­–ç•¥ã€‚å…¶é€šè¿‡â€è½¯åŒ–â€ä¼ ç»Ÿçš„one-hotç±»å‹æ ‡ç­¾ï¼Œä½¿å¾—åœ¨è®¡ç®—æŸå¤±å€¼æ—¶èƒ½å¤Ÿæœ‰æ•ˆæŠ‘åˆ¶è¿‡æ‹Ÿåˆç°è±¡ã€‚label smoothingç›¸å½“äºå‡å°‘çœŸå®æ ·æœ¬æ ‡ç­¾çš„ç±»åˆ«åœ¨è®¡ç®—æŸå¤±å‡½æ•°æ—¶çš„æƒé‡ï¼Œæœ€ç»ˆèµ·åˆ°æŠ‘åˆ¶è¿‡æ‹Ÿåˆçš„æ•ˆæœã€‚</p>
<p>1.label smoothingå°†çœŸå®æ¦‚ç‡åˆ†å¸ƒä½œå¦‚ä¸‹æ”¹å˜ï¼š</p>
<script type="math/tex; mode=display">
P_{i}=\left\{\begin{array}{l}
1, i f(i=y) \\
0, i f(i \neq y)
\end{array} \Longrightarrow  P_{i}=\left\{\begin{array}{l}
(1-\varepsilon), i f(i=y) \\
\frac{\varepsilon}{K-1}, i f(i \neq y)
\end{array}\right.\right.</script><p>å…¶å®æ›´æ–°åçš„åˆ†å¸ƒå°±ç›¸å½“äºå¾€çœŸå®åˆ†å¸ƒä¸­åŠ å…¥äº†å™ªå£°ï¼Œä¸ºäº†ä¾¿äºè®¡ç®—ï¼Œè¯¥å™ªå£°æœä»ç®€å•çš„å‡åŒ€åˆ†å¸ƒã€‚</p>
<p>2.ä¸ä¹‹å¯¹åº”ï¼Œlabel smoothingå°†äº¤å‰ç†µæŸå¤±å‡½æ•°ä½œå¦‚ä¸‹æ”¹å˜ï¼š</p>
<script type="math/tex; mode=display">
L o s s=-\sum_{i=1}^{K} p_{i} \log q_{i} \Longrightarrow \operatorname{Loss}_{i}=\left\{\begin{array}{l}
(1-\varepsilon)^{*} \operatorname{Loss}, \text {if}(i=y) \\
\varepsilon^{*} \operatorname{Loss}, \text {if}(i \neq y)
\end{array}\right.</script><p>3.ä¸ä¹‹å¯¹åº”ï¼Œlabel smoothingå°†æœ€ä¼˜çš„é¢„æµ‹æ¦‚ç‡åˆ†å¸ƒä½œå¦‚ä¸‹æ”¹å˜ï¼š</p>
<script type="math/tex; mode=display">
Z_{i}=\left\{\begin{array}{l}
+\infty, i f(i=y) \\
0, i f(i \neq y)
\end{array} \Longrightarrow Z_{i}=\left\{\begin{array}{l}
\log \frac{(k-1)(1-\varepsilon)}{\varepsilon+\alpha}, i f(i=y) \\
\alpha, i f(i \neq y)
\end{array}\right.\right.</script><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LabelSmoothing</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Implement label smoothing."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size, padding_idx, smoothing=<span class="number">0.0</span>)</span>:</span></span><br><span class="line">        super(LabelSmoothing, self).__init__()</span><br><span class="line">        self.criterion = nn.KLDivLoss(size_average=<span class="literal">False</span>)</span><br><span class="line">        self.padding_idx = padding_idx</span><br><span class="line">        self.confidence = <span class="number">1.0</span> - smoothing</span><br><span class="line">        self.smoothing = smoothing</span><br><span class="line">        self.size = size</span><br><span class="line">        self.true_dist = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, target)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> x.size(<span class="number">1</span>) == self.size</span><br><span class="line">        true_dist = x.data.clone()</span><br><span class="line">        true_dist.fill_(self.smoothing / (self.size - <span class="number">2</span>)) <span class="comment"># å‡2ï¼Œæ˜¯å‡å»ç›®æ ‡åºåˆ—çš„&lt;s&gt; &lt;e&gt;æ ‡è¯†ä½ç½®ã€‚</span></span><br><span class="line">        true_dist.scatter_(<span class="number">1</span>, target.data.unsqueeze(<span class="number">1</span>), self.confidence)</span><br><span class="line">        true_dist[:, self.padding_idx] = <span class="number">0</span></span><br><span class="line">        mask = torch.nonzero(target.data == self.padding_idx)</span><br><span class="line">        <span class="keyword">if</span> mask.dim() &gt; <span class="number">0</span>:</span><br><span class="line">            true_dist.index_fill_(<span class="number">0</span>, mask.squeeze(), <span class="number">0.0</span>)</span><br><span class="line">        self.true_dist = true_dist</span><br><span class="line">        <span class="keyword">return</span> self.criterion(x, Variable(true_dist, requires_grad=<span class="literal">False</span>))</span><br></pre></td></tr></table></figure>
<p>åœ¨è®­ç»ƒæœŸé—´ï¼Œé‡‡ç”¨äº†å€¼ $\epsilon_{ls}=0.1$çš„æ ‡ç­¾å¹³æ»‘ã€‚ è¿™ç§åšæ³•æé«˜äº†å›°æƒ‘åº¦ï¼Œå› ä¸ºæ¨¡å‹å˜å¾—æ›´åŠ ä¸ç¡®å®šï¼Œä½†æé«˜äº†å‡†ç¡®æ€§å’ŒBLEUåˆ†æ•°ã€‚ä½¿ç”¨KL div losså®ç°æ ‡ç­¾å¹³æ»‘ã€‚ ç›¸æ¯”ä½¿ç”¨ç‹¬çƒ­ç›®æ ‡åˆ†å¸ƒï¼Œå…¶åŒ…å«æ­£ç¡®å•è¯çš„ç½®ä¿¡åº¦å’Œæ•´ä¸ªè¯æ±‡è¡¨ä¸­åˆ†å¸ƒçš„å…¶ä½™å¹³æ»‘é¡¹ã€‚å¯ä»¥çœ‹åˆ°æ ‡ç­¾å¹³æ»‘çš„ç¤ºä¾‹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Example of label smoothing.</span></span><br><span class="line"><span class="comment"># embed_size = 5, padding_idx=0,smoothing=0.4</span></span><br><span class="line">crit = LabelSmoothing(<span class="number">5</span>, <span class="number">0</span>, <span class="number">0.4</span>)</span><br><span class="line">predict = torch.FloatTensor([[<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">0.7</span>, <span class="number">0.1</span>, <span class="number">0</span>],</span><br><span class="line">                             [<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">0.7</span>, <span class="number">0.1</span>, <span class="number">0</span>], </span><br><span class="line">                             [<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">0.7</span>, <span class="number">0.1</span>, <span class="number">0</span>]])</span><br><span class="line">v = crit(Variable(predict.log()), </span><br><span class="line">         Variable(torch.LongTensor([<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>])))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show the target distributions expected by the system.</span></span><br><span class="line">plt.imshow(crit.true_dist)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/11/transformer/label_smooth.png" alt></p>
<p>ä»¥ç´«è‰²ä¸ºä¾‹ï¼š0å·æ ‡ç­¾åº”è¯¥ä»¥<code>-0.5</code>ä¸ºç›®æ ‡ï¼Œ<code>1,2,3,4</code>ä»¥<code>1.5</code>ä¸ºç›®æ ‡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">crit = LabelSmoothing(<span class="number">5</span>, <span class="number">0</span>, <span class="number">0.1</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loss</span><span class="params">(x)</span>:</span></span><br><span class="line">    d = x + <span class="number">3</span> * <span class="number">1</span></span><br><span class="line">    predict = torch.FloatTensor([[<span class="number">0</span>, x / d, <span class="number">1</span> / d, <span class="number">1</span> / d, <span class="number">1</span> / d],</span><br><span class="line">                                 ])</span><br><span class="line">    <span class="comment">#print(predict)</span></span><br><span class="line">    <span class="keyword">return</span> crit(Variable(predict.log()),</span><br><span class="line">                 Variable(torch.LongTensor([<span class="number">1</span>]))).data[<span class="number">0</span>]</span><br><span class="line">plt.plot(np.arange(<span class="number">1</span>, <span class="number">100</span>), [loss(x) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>)])</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå¯¹ç»™å®šçš„é€‰æ‹©éå¸¸æœ‰ä¿¡å¿ƒï¼Œæ ‡ç­¾å¹³æ»‘å®é™…ä¸Šä¼šå¼€å§‹æƒ©ç½šæ¨¡å‹ã€‚</p>
<p><img src="/2020/05/11/transformer/penate.png" alt></p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><h3 id="Copy-Task"><a href="#Copy-Task" class="headerlink" title="Copy Task"></a>Copy Task</h3><h4 id="Synthetic-Data"><a href="#Synthetic-Data" class="headerlink" title="Synthetic Data"></a>Synthetic Data</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data_gen</span><span class="params">(V, batch, nbatches)</span>:</span></span><br><span class="line">    <span class="string">"Generate random data for a src-tgt copy task."</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(nbatches):</span><br><span class="line">        data = torch.from_numpy(np.random.randint(<span class="number">1</span>, V, size=(batch, <span class="number">10</span>)))</span><br><span class="line">        data[:, <span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">        src = Variable(data, requires_grad=<span class="literal">False</span>)</span><br><span class="line">        tgt = Variable(data, requires_grad=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">yield</span> Batch(src, tgt, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Loss-Computation"><a href="#Loss-Computation" class="headerlink" title="Loss Computation"></a>Loss Computation</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleLossCompute</span>:</span></span><br><span class="line">    <span class="string">"A simple loss compute and train function."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, generator, criterion, opt=None)</span>:</span></span><br><span class="line">        self.generator = generator</span><br><span class="line">        self.criterion = criterion</span><br><span class="line">        self.opt = opt</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, x, y, norm)</span>:</span></span><br><span class="line">        x = self.generator(x)</span><br><span class="line">        loss = self.criterion(x.contiguous().view(<span class="number">-1</span>, x.size(<span class="number">-1</span>)), </span><br><span class="line">                              y.contiguous().view(<span class="number">-1</span>)) / norm</span><br><span class="line">        loss.backward()</span><br><span class="line">        <span class="keyword">if</span> self.opt <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.opt.step()</span><br><span class="line">            self.opt.optimizer.zero_grad()</span><br><span class="line">        <span class="keyword">return</span> loss.data[<span class="number">0</span>] * norm</span><br></pre></td></tr></table></figure>
<h4 id="Greedy-Decoding"><a href="#Greedy-Decoding" class="headerlink" title="Greedy Decoding"></a>Greedy Decoding</h4><p>è´ªå¿ƒè§£ç ã€‚ã€‚ã€‚å¤§ä½¬ä»¬çœŸä¼šèµ·åå­—ï¼ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Train the simple copy task.</span></span><br><span class="line">V = <span class="number">11</span></span><br><span class="line">criterion = LabelSmoothing(size=V, padding_idx=<span class="number">0</span>, smoothing=<span class="number">0.0</span>)</span><br><span class="line">model = make_model(V, V, N=<span class="number">2</span>)</span><br><span class="line">model_opt = NoamOpt(model.src_embed[<span class="number">0</span>].d_model, <span class="number">1</span>, <span class="number">400</span>,</span><br><span class="line">        torch.optim.Adam(model.parameters(), lr=<span class="number">0</span>, betas=(<span class="number">0.9</span>, <span class="number">0.98</span>), eps=<span class="number">1e-9</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    model.train()</span><br><span class="line">    run_epoch(data_gen(V, <span class="number">30</span>, <span class="number">20</span>), model, </span><br><span class="line">              SimpleLossCompute(model.generator, criterion, model_opt))</span><br><span class="line">    model.eval()</span><br><span class="line">    print(run_epoch(data_gen(V, <span class="number">30</span>, <span class="number">5</span>), model, </span><br><span class="line">                    SimpleLossCompute(model.generator, criterion, <span class="literal">None</span>)))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greedy_decode</span><span class="params">(model, src, src_mask, max_len, start_symbol)</span>:</span></span><br><span class="line">    memory = model.encode(src, src_mask)</span><br><span class="line">    ys = torch.ones(<span class="number">1</span>, <span class="number">1</span>).fill_(start_symbol).type_as(src.data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(max_len<span class="number">-1</span>):</span><br><span class="line">        out = model.decode(memory, src_mask, </span><br><span class="line">                           Variable(ys), </span><br><span class="line">                           Variable(subsequent_mask(ys.size(<span class="number">1</span>))</span><br><span class="line">                                    .type_as(src.data)))</span><br><span class="line">        prob = model.generator(out[:, <span class="number">-1</span>])</span><br><span class="line">        _, next_word = torch.max(prob, dim = <span class="number">1</span>)</span><br><span class="line">        next_word = next_word.data[<span class="number">0</span>]</span><br><span class="line">        ys = torch.cat([ys, </span><br><span class="line">                        torch.ones(<span class="number">1</span>, <span class="number">1</span>).type_as(src.data).fill_(next_word)], dim=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> ys</span><br><span class="line"></span><br><span class="line">model.eval()</span><br><span class="line">src = Variable(torch.LongTensor([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]]) )</span><br><span class="line">src_mask = Variable(torch.ones(<span class="number">1</span>, <span class="number">1</span>, <span class="number">10</span>) )</span><br><span class="line">print(greedy_decode(model, src, src_mask, max_len=<span class="number">10</span>, start_symbol=<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><figcaption><span>result</span></figcaption><table><tr><td class="code"><pre><span class="line">  <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span>     <span class="number">4</span>     <span class="number">5</span>     <span class="number">6</span>     <span class="number">7</span>     <span class="number">8</span>     <span class="number">9</span>    <span class="number">10</span></span><br><span class="line">[torch.LongTensor of size <span class="number">1</span>x10]</span><br></pre></td></tr></table></figure>
<p>ç¿»è¯‘çš„ä¾‹å­æ¶‰åŠGPUå¹¶è¡Œæ¯”è¾ƒå¤æ‚ï¼Œä¸åšä»‹ç»ã€‚</p>
<h1 id="Attention-Visualization"><a href="#Attention-Visualization" class="headerlink" title="Attention Visualization"></a>Attention Visualization</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tgt_sent = trans.split()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw</span><span class="params">(data, x, y, ax)</span>:</span></span><br><span class="line">    seaborn.heatmap(data, </span><br><span class="line">                    xticklabels=x, square=<span class="literal">True</span>, yticklabels=y, vmin=<span class="number">0.0</span>, vmax=<span class="number">1.0</span>, </span><br><span class="line">                    cbar=<span class="literal">False</span>, ax=ax)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>):</span><br><span class="line">    fig, axs = plt.subplots(<span class="number">1</span>,<span class="number">4</span>, figsize=(<span class="number">20</span>, <span class="number">10</span>))</span><br><span class="line">    print(<span class="string">"Encoder Layer"</span>, layer+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        draw(model.encoder.layers[layer].self_attn.attn[<span class="number">0</span>, h].data, sent, sent <span class="keyword">if</span> h ==<span class="number">0</span> <span class="keyword">else</span> [], ax=axs[h])</span><br><span class="line">    plt.show()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>):</span><br><span class="line">    fig, axs = plt.subplots(<span class="number">1</span>,<span class="number">4</span>, figsize=(<span class="number">20</span>, <span class="number">10</span>))</span><br><span class="line">    print(<span class="string">"Decoder Self Layer"</span>, layer+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        draw(model.decoder.layers[layer].self_attn.attn[<span class="number">0</span>, h].data[:len(tgt_sent), :len(tgt_sent)], tgt_sent, tgt_sent <span class="keyword">if</span> h ==<span class="number">0</span> <span class="keyword">else</span> [], ax=axs[h])</span><br><span class="line">    plt.show()</span><br><span class="line">    print(<span class="string">"Decoder Src Layer"</span>, layer+<span class="number">1</span>)</span><br><span class="line">    fig, axs = plt.subplots(<span class="number">1</span>,<span class="number">4</span>, figsize=(<span class="number">20</span>, <span class="number">10</span>))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        draw(model.decoder.layers[layer].self_attn.attn[<span class="number">0</span>, h].data[:len(tgt_sent), :len(sent)],sent, tgt_sent <span class="keyword">if</span> h ==<span class="number">0</span> <span class="keyword">else</span> [], ax=axs[h])</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
<h2 id="Encoder-visualization"><a href="#Encoder-visualization" class="headerlink" title="Encoder visualization"></a>Encoder visualization</h2><div class="note info">
            <p>Encoder Layer 2</p>
          </div>
<p><img src="/2020/05/11/transformer/encoder_layer_2.png" alt></p>
<div class="note info">
            <p>Encoder Layer 2</p>
          </div>
<p><img src="/2020/05/11/transformer/encoder_layer_4.png" alt></p>
<div class="note info">
            <p>Encoder Layer 6</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511115252714.png" alt></p>
<p>åŒä¸€è¡Œï¼Œæ¯”è¾ƒä¸åŒçš„head,å¯ä»¥çœ‹å‡ºï¼Œä¸åŒçš„headï¼Œattentionåˆ°çš„å†…å®¹æ˜¯å„ä¸ç›¸åŒçš„ã€‚</p>
<h2 id="Decoder-visualization"><a href="#Decoder-visualization" class="headerlink" title="Decoder visualization"></a>Decoder visualization</h2><div class="note info">
            <p>decoder Self Layer 2 :<code>&lt;s&gt;</code>ä¼šattentionåˆ°æ‰€æœ‰å•è¯ï¼Œå•è¯å¤§å¤šä¼šattentionåˆ°è‡ªå·±ã€‚</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511120009561.png" alt></p>
<div class="note info">
            <p>decoder Src Layer 2</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511120705604.png" alt></p>
<div class="note info">
            <p>decoder Self Layer 4</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511120927309.png" alt></p>
<div class="note info">
            <p>decoder Src Layer 4</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511120946538.png" alt></p>
<div class="note info">
            <p>decoder Self Layer 6</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511121002344.png" alt></p>
<div class="note info">
            <p>decoder Src Layer 6</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511121021648.png" alt></p>
<p>ä¸Šä¸‰è§’å…¨é»‘ï¼šè¡¨ç¤ºdecoderæ˜¯ä¸€ä¸ªä¸²è¡Œè®¡ç®—ï¼Œæ¯ä¸€ä¸ªè¯åªä¼šattentionåˆ°å…¶å‰é¢çš„è¯ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="tricks"><a href="#tricks" class="headerlink" title="tricks"></a>tricks</h2><p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹æ²¡æœ‰æ”¶æ•›å¾—å¾ˆå¥½æ—¶ï¼ŒDecoderé¢„æµ‹äº§ç”Ÿçš„è¯å¾ˆå¯èƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚è¿™ä¸ªæ—¶å€™å¦‚æœå†æŠŠé”™è¯¯çš„æ•°æ®å†è¾“ç»™Decoderï¼Œå°±ä¼šè¶Šè·‘è¶Šåã€‚è¿™ä¸ªæ—¶å€™æ€ä¹ˆåŠï¼Ÿ</p>
<ul>
<li>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨ â€œteacher forcingâ€ã€‚å› ä¸ºæˆ‘ä»¬çŸ¥é“åº”è¯¥é¢„æµ‹çš„wordæ˜¯ä»€ä¹ˆï¼Œé‚£ä¹ˆå¯ä»¥ç»™Decoderå–‚ä¸€ä¸ªæ­£ç¡®çš„ç»“æœä½œä¸ºè¾“å…¥ã€‚</li>
<li>é™¤äº†é€‰æ‹©æœ€é«˜æ¦‚ç‡çš„è¯ (greedy search)ï¼Œè¿˜å¯ä»¥é€‰æ‹©æ˜¯æ¯”å¦‚ â€œBeam Searchâ€ï¼Œå¯ä»¥ä¿ç•™topKä¸ªé¢„æµ‹çš„wordã€‚ Beam Search æ–¹æ³•ä¸å†æ˜¯åªå¾—åˆ°ä¸€ä¸ªè¾“å‡ºæ”¾åˆ°ä¸‹ä¸€æ­¥å»è®­ç»ƒäº†ï¼Œæˆ‘ä»¬å¯ä»¥è®¾å®šä¸€ä¸ªå€¼ï¼Œæ‹¿å¤šä¸ªå€¼æ”¾åˆ°ä¸‹ä¸€æ­¥å»è®­ç»ƒï¼Œè¿™æ¡è·¯å¾„çš„æ¦‚ç‡ç­‰äºæ¯ä¸€æ­¥è¾“å‡ºçš„æ¦‚ç‡çš„ä¹˜ç§¯ã€‚</li>
</ul>
<h2 id="Transformerçš„ä¼˜ç¼ºç‚¹"><a href="#Transformerçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="Transformerçš„ä¼˜ç¼ºç‚¹"></a>Transformerçš„ä¼˜ç¼ºç‚¹</h2><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ol>
<li>æ¯å±‚è®¡ç®—å¤æ‚åº¦æ¯”RNNè¦ä½ã€‚</li>
<li>å¯ä»¥è¿›è¡Œ<strong>å¹¶è¡Œè®¡ç®—</strong>ã€‚</li>
<li>ä»è®¡ç®—ä¸€ä¸ªåºåˆ—é•¿åº¦ä¸ºnçš„ä¿¡æ¯è¦ç»è¿‡çš„è·¯å¾„é•¿åº¦æ¥çœ‹, CNNéœ€è¦å¢åŠ å·ç§¯å±‚æ•°æ¥æ‰©å¤§è§†é‡ï¼ŒRNNéœ€è¦ä»1åˆ°né€ä¸ªè¿›è¡Œè®¡ç®—ï¼Œè€ŒSelf-attentionåªéœ€è¦ä¸€æ­¥çŸ©é˜µè®¡ç®—å°±å¯ä»¥ã€‚Self-Attentionå¯ä»¥æ¯”RNNæ›´å¥½åœ°è§£å†³é•¿æ—¶ä¾èµ–é—®é¢˜ã€‚å½“ç„¶å¦‚æœè®¡ç®—é‡å¤ªå¤§ï¼Œæ¯”å¦‚åºåˆ—é•¿åº¦Nå¤§äºåºåˆ—ç»´åº¦Dè¿™ç§æƒ…å†µï¼Œä¹Ÿå¯ä»¥ç”¨çª—å£é™åˆ¶Self-Attentionçš„è®¡ç®—æ•°é‡ã€‚</li>
<li>ä»ä½œè€…åœ¨é™„å½•ä¸­ç»™å‡ºçš„æ —å­å¯ä»¥çœ‹å‡ºï¼ŒSelf-Attentionæ¨¡å‹æ›´å¯è§£é‡Šï¼ŒAttentionç»“æœçš„åˆ†å¸ƒè¡¨æ˜äº†è¯¥æ¨¡å‹å­¦ä¹ åˆ°äº†ä¸€äº›è¯­æ³•å’Œè¯­ä¹‰ä¿¡æ¯ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ol>
<li>å®è·µä¸Šï¼šæœ‰äº›RNNè½»æ˜“å¯ä»¥è§£å†³çš„é—®é¢˜transformeræ²¡åšåˆ°ï¼Œæ¯”å¦‚<strong>å¤åˆ¶string</strong>ï¼Œæˆ–è€…æ¨ç†æ—¶ç¢°åˆ°çš„sequenceé•¿åº¦æ¯”è®­ç»ƒæ—¶æ›´é•¿ï¼ˆå› ä¸º<strong>ç¢°åˆ°äº†æ²¡è§è¿‡çš„position embedding</strong>ï¼‰ã€‚</li>
<li>ç†è®ºä¸Šï¼štransformersä¸æ˜¯computationally universal(å›¾çµå®Œå¤‡)ï¼Œè¿™ç§éRNNå¼çš„æ¨¡å‹æ˜¯éå›¾çµå®Œå¤‡çš„çš„ï¼Œ<strong>æ— æ³•å•ç‹¬å®ŒæˆNLPä¸­æ¨ç†ã€å†³ç­–ç­‰è®¡ç®—é—®é¢˜</strong>ï¼ˆåŒ…æ‹¬ä½¿ç”¨transformerçš„bertæ¨¡å‹ç­‰ç­‰ï¼‰ã€‚</li>
</ol>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://nlp.seas.harvard.edu/2018/04/03/attention.html" target="_blank" rel="noopener">The Annotated Transformer</a></li>
<li><a href="https://www.cnblogs.com/zingp/p/11696111.html" target="_blank" rel="noopener">æ·±å…¥ç†è§£TransformeråŠå…¶æºç </a></li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯/è‡ªç„¶è¯­è¨€å¤„ç†</category>
      </categories>
      <tags>
        <tag>transformer</tag>
      </tags>
  </entry>
  <entry>
    <title>å¹³æ»‘æ–¹æ³•</title>
    <url>/2020/05/08/%E5%B9%B3%E6%BB%91%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>åœ¨ä¸€ä¸ªæ¦‚ç‡æ¨¡å‹ä¸­ï¼Œä¹Ÿå°±æ˜¯ p(e)åœ¨ event space E ä¸‹çš„æ¦‚ç‡åˆ†å¸ƒï¼Œæ¨¡å‹å¾ˆå¯èƒ½ä¼šç”¨æœ€å¤§ä¼¼ç„¶ä¼°è®¡(MLE)ï¼š</p>
<script type="math/tex; mode=display">
P_{M L E}=\frac{c(x)}{\sum_{e} c(e)}</script><p>ç„¶è€Œï¼Œç”±äºå¹¶æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®ï¼Œå¾ˆå¤šäº‹ä»¶ $x$ å¹¶æ²¡æœ‰åœ¨è®­ç»ƒæ•°æ®ä¸­å‡ºç°ï¼Œä¹Ÿå°±æ˜¯ $c(x)=0$ï¼Œ$P_{MLE}=0$è¿™æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ²¡æœ‰åœ¨è®­ç»ƒæ•°æ®ä¸­å‡ºç°çš„æ•°æ®ï¼Œå¹¶ä¸ä»£è¡¨ä¸ä¼šåœ¨æµ‹è¯•æ•°æ®ä¸­å‡ºç°ï¼Œå¦‚æœæ²¡æœ‰è€ƒè™‘åˆ°æ•°æ®ç¨€ç–æ€§ï¼Œæ¨¡å‹å°±æ˜¾å¾—å¤ªç®€å•äº†ã€‚</p>
<p>Data sparsity æ˜¯ smoothing çš„æœ€å¤§åŸå› ã€‚Chen &amp; Goodman åœ¨1998 å¹´æåˆ°è¿‡ï¼Œå‡ ä¹æ‰€æœ‰æ•°æ®ç¨€ç–çš„åœºæ™¯ä¸‹ï¼Œsmoothing éƒ½å¯ä»¥å¸®åŠ©æé«˜ performanceï¼Œè€Œæ•°æ®ç¨€ç–æ€§å‡ ä¹æ˜¯æ‰€æœ‰ç»Ÿè®¡æ¨¡å‹éƒ½ä¼šé‡åˆ°çš„é—®é¢˜ã€‚è€Œå¦‚æœä½ æœ‰è¶³å¤Ÿå¤šçš„è®­ç»ƒæ•°æ®ï¼Œæ‰€æœ‰çš„ parameters éƒ½å¯ä»¥åœ¨æ²¡æœ‰ smoothing çš„æƒ…å†µä¸‹è¢«å‡†ç¡®çš„ä¼°è®¡ï¼Œé‚£ä¹ˆä½ æ€»æ˜¯å¯ä»¥æ‰©å±•æ¨¡å‹ï¼Œå¦‚åŸæ¥æ˜¯ bigramï¼Œæ²¡æœ‰æ•°æ®ç¨€ç–ï¼Œå®Œå…¨å¯ä»¥æ‰©å±•åˆ° trigram æ¥æé«˜ performanceï¼Œå¦‚æœè¿˜æ²¡æœ‰å‡ºç°ç¨€ç–ï¼Œå°±å†å¾€é«˜å±‚æ¨ï¼Œå½“ parameters è¶Šæ¥è¶Šå¤šçš„æ—¶å€™ï¼Œæ•°æ®ç¨€ç–å†æ¬¡æˆä¸ºäº†é—®é¢˜ï¼Œè¿™æ—¶å€™ï¼Œç”¨åˆé€‚çš„å¹³æ»‘æ–¹æ³•å¯ä»¥å¾—åˆ°æ›´å‡†ç¡®çš„æ¨¡å‹ã€‚å®é™…ä¸Šï¼Œæ— è®ºæœ‰å¤šå°‘çš„æ•°æ®ï¼Œå¹³æ»‘å‡ ä¹æ€»æ˜¯å¯ä»¥ä»¥å¾ˆå°çš„ä»£ä»·æ¥æé«˜ performanceã€‚</p>
<a id="more"></a>
<h3 id="å¹³æ»‘æ–¹æ³•"><a href="#å¹³æ»‘æ–¹æ³•" class="headerlink" title="å¹³æ»‘æ–¹æ³•"></a>å¹³æ»‘æ–¹æ³•</h3><h4 id="add-one-smoothing"><a href="#add-one-smoothing" class="headerlink" title="add-one smoothing"></a>add-one smoothing</h4><p>(ä¹Ÿå«laplace smoothing),ä»¥bigramä¸ºä¾‹ï¼š</p>
<p>MLE estimateï¼š</p>
<script type="math/tex; mode=display">
P_{M L E}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1} w_{i}\right)}{c\left(w_{i-1}\right)}</script><p>Add-one estimate:</p>
<script type="math/tex; mode=display">
P_{A d d-1}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1} w_{i}\right)+1}{c\left(w_{i-1}\right)+V}</script><p>å…¶ä¸­ï¼Œ$V$è¡¨ç¤ºè¯å…¸å¤§å°ã€‚</p>
<p>å‡è®¾è¯­æ–™åº“ä¸ºï¼š</p>
<blockquote>
<ol>
<li>john read moby dick</li>
<li>mary read a different book</li>
<li>she read a book by cher</li>
</ol>
</blockquote>
<p>é‚£ä¹ˆï¼Œjohn read a book è¿™ä¸ªå¥å­çš„æ¦‚ç‡ä¸ºï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
p(\text { john read a book })&=p(\text { john } |<s>)  p(\text { read } | \text { john })  p(\text { a } | \text { read })  p(\text { book } | a )  p(<e> | \text {book}) \\
&=\frac{c(<s>,john)}{\sum_{w} c(<s>,w)} \frac{c(john,read)}{\sum_{w} c(john,w)} \frac{c(read,a)}{\sum_{w} c(read,w)} \frac{c(a,book)}{\sum_{w} c(a,w)} \frac{c(book,<e>)}{\sum_{w} c(book,w)}\\
&= \frac{1}{3} * \frac{1}{1} * \frac{2}{3} * \frac{1}{2} * \frac{1}{2} \\
&\approx 0.006
\end{aligned}</script><p>è€Œï¼Œcher read a book è¿™ä¸ªå¥å­å‡ºç°çš„æ¦‚ç‡æ˜¯ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
p(\text { cher read a book })&=p(\text { cher } |<s>)  p(\text { read } | \text { cher })  p(\text { a } | \text { read })  p(\text { book } | a )  p(<e> | \text {book}) \\
&=\frac{c(<s>,cher)}{\sum_{w} c(<s>,w)} \frac{c(cher,read)}{\sum_{w} c(cher,w)} \frac{c(read,a)}{\sum_{w} c(read,w)} \frac{c(a,book)}{\sum_{w} c(a,w)} \frac{c(book,<e>)}{\sum_{w} c(book,w)}\\
&= \frac{0}{3} * \frac{0}{1} * \frac{2}{3} * \frac{1}{2} * \frac{1}{2} \\
&\approx 0
\end{aligned}</script><p>å¦‚æœä½¿ç”¨add-one smoothingï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
p(\text { john read a book })&=p(\text { john } |<s>)  p(\text { read } | \text { john })  p(\text { a } | \text { read })  p(\text { book } | a )  p(<e> | \text {book}) \\
&= \frac{1+1}{3+11} * \frac{1+1}{1+11} * \frac{2+1}{3+11} * \frac{1+1}{2+11} * \frac{1+1}{2+11} \\
&\approx 0.0001
\end{aligned}</script><script type="math/tex; mode=display">
\begin{aligned}
p(\text { cher read a book })&=p(\text { cher } |<s>)  p(\text { read } | \text { cher })  p(\text { a } | \text { read })  p(\text { book } | a )  p(<e> | \text {book}) \\
&= \frac{0+1}{3+11} * \frac{0+1}{1+11} * \frac{2+1}{3+11} * \frac{1+1}{2+11} * \frac{1+1}{2+11} \\
&\approx 0.00003
\end{aligned}</script><p>åŠ  1 å¹³æ»‘é€šå¸¸æƒ…å†µä¸‹æ˜¯ä¸€ç§å¾ˆç³Ÿç³•çš„ç®—æ³•ï¼Œä¸å…¶ä»–å¹³æ»‘æ–¹æ³•ç›¸æ¯”æ˜¾å¾—éå¸¸å·®ï¼Œå¯ä»¥æŠŠåŠ  1 å¹³æ»‘ç”¨åœ¨å…¶ä»–ä»»åŠ¡ä¸­ï¼Œå¦‚æ–‡æœ¬åˆ†ç±»ï¼Œæˆ–è€…éé›¶è®¡æ•°æ²¡é‚£ä¹ˆå¤šçš„æƒ…å†µä¸‹ã€‚</p>
<h4 id="Additive-smoothing"><a href="#Additive-smoothing" class="headerlink" title="Additive smoothing"></a>Additive smoothing</h4><p>å¯¹åŠ  1 å¹³æ»‘çš„æ”¹è¿›å°±æ˜¯æŠŠ 1 æ”¹æˆ $\delta$ï¼Œä¸” $0&lt;\delta$</p>
<script type="math/tex; mode=display">
P_{A d d-\delta}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1} w_{i}\right)+\delta}{c\left(w_{i-1}\right)+\delta V}</script><p>å¯ä»¥æŠŠ$\delta$çœ‹ä½œæ˜¯ä¸€ä¸ªå¯ä»¥è°ƒèŠ‚çš„è¶…å‚æ•°ã€‚</p>
<h4 id="Good-Turing-smoothing"><a href="#Good-Turing-smoothing" class="headerlink" title="Good-Turing smoothing"></a>Good-Turing smoothing</h4><p><strong>åŸºæœ¬æ€æƒ³:</strong> ç”¨è§‚å¯Ÿè®¡æ•°è¾ƒé«˜çš„ N-gram æ•°é‡æ¥é‡æ–°ä¼°è®¡æ¦‚ç‡é‡å¤§å°ï¼Œå¹¶æŠŠå®ƒæŒ‡æ´¾ç»™é‚£äº›å…·æœ‰é›¶è®¡æ•°æˆ–è¾ƒä½è®¡æ•°çš„ N-gram.</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾ä½ åœ¨é’“é±¼ï¼Œç„¶åæŠ“åˆ°äº† 18 æ¡é±¼ï¼Œç§ç±»å¦‚ä¸‹ï¼š10æ¡é²¤é±¼, 3æ¡é»‘é±¼, 2æ¡åˆ€é±¼, 1æ¡é²¨é±¼, 1æ¡è‰é±¼, 1æ¡é³—é±¼ï¼Œé‚£ä¹ˆ</p>
<ol>
<li><p>ä¸‹ä¸€ä¸ªé’“åˆ°çš„é±¼æ˜¯é²¨é±¼çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ</p>
<p>1/18</p>
</li>
<li><p>ä¸‹ä¸€æ¡ä¸æ˜¯æ–°é±¼ç§ï¼ˆä¹‹å‰æ²¡æœ‰å‡ºç°è¿‡ï¼‰çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ</p>
<p>3/18(æ²¡æœ‰å‡ºç°è¿‡çš„æŒ‰å‡ºç°è¿‡ä¸€æ¬¡ç®—)</p>
</li>
<li><p>ä¸‹ä¸€æ¡æŠ“åˆ°çš„é±¼æ˜¯é²¨é±¼çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ</p>
<p>é¦–å…ˆè‚¯å®šçš„æ˜¯æ¦‚ç‡å°äº1/18  â€”&gt; good turing</p>
</li>
</ol>
<p>åœ¨good turing ä¸‹,å¯¹å‚æ•°çš„ä¼°è®¡åˆ†ä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>æ²¡æœ‰å‡ºç°è¿‡çš„ï¼š$P_{GT}=\frac{N_1}{N}$</li>
<li>å‡ºç°è¿‡çš„ï¼š$P_{GT}=\frac{(c+1)N_{c+1}}{N_c*N}$</li>
</ol>
<p>å…¶ä¸­ï¼Œ$N_c$è¡¨ç¤ºå‡ºç°cæ¬¡çš„å•è¯ä¸ªæ•°,$N$ä»£è¡¨æ ·æœ¬æ€»æ•°ã€‚<br>æ¯”å¦‚ï¼š</p>
<blockquote>
<p>sam i am i am sam i do not eat </p>
<p>samï¼š2æ¬¡</p>
<p>iï¼š3æ¬¡</p>
<p>amï¼š2æ¬¡</p>
<p>doï¼š1æ¬¡</p>
<p>notï¼š1æ¬¡</p>
<p>eatï¼š1æ¬¡</p>
</blockquote>
<p>æœ‰ï¼š$N_3=1,N_2=2,N_1=3$</p>
<p>å¯¹äºç¬¬3ä¸ªé—®é¢˜ï¼š$P_{GT}=\frac{(1+1)<em>1}{3</em>18}=\frac{1}{27}$.</p>
<h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><p>ç”±å…¬å¼ï¼š$P_{GT}=\frac{(c+1)N_{c+1}}{N_c*N}$åœ¨è®¡ç®—å½“å‰é¡¹$c$ çš„æ—¶å€™ï¼Œéœ€è¦è®¡ç®—åˆ°$c+1$çš„$N_{c+1}$,è‹¥$N_{c+1}=0$ï¼Œåˆ™ä¼šå¯¼è‡´æ¦‚ç‡ä¸º0.</p>
<p>è§£å†³æ–¹æ³•ï¼šå¯ä»¥åˆ©ç”¨æœºå™¨å­¦ä¹ ä¸­å›å½’ç®—æ³•å¯¹$N_1,N_2,\ldots,N_c,N_{c+1}$è¿›è¡Œæ‹Ÿåˆï¼Œè¿›è€Œå¾—å‡º$N_{c+1}$çš„å€¼ã€‚</p>
<h3 id="Interpolation"><a href="#Interpolation" class="headerlink" title="Interpolation"></a>Interpolation</h3><p><strong>åŸºæœ¬æ€æƒ³</strong>ï¼šåœ¨è®¡ç®—Trigramæ¦‚ç‡çš„åŒæ—¶ï¼Œè€ƒè™‘Unigramï¼ŒBigramï¼ŒTrigramå‡ºç°çš„æ¬¡æ•°ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šæœ‰</p>
<p><code>C(in the kitchen)=0</code>,<code>C(the kitchen)=3</code>,<code>C(kitchen)=4</code>,<code>C(arboretum)=0</code>.åœ¨è®¡ç®—<code>p(kitchen|in the)</code>å’Œ<code>p(arboretum|in the)</code>çš„æ—¶å€™ï¼Œä»è¯­æ–™è®¡ç®—å¾—å‡ºï¼š$p(kitchen|in,the)=p(arboretum|in,the)=0$,ä½†æ˜¯ä»ç»éªŒä¸Šæ¥è®²$p(kitchen|in,the)&gt;p(arboretum|in,the)$ï¼Œå› ä¸ºkitchenè¦æ¯”arboretumå¸¸è§çš„å¤šã€‚è¦å®ç°è¿™ä¸ªï¼Œæˆ‘ä»¬å°±å¸Œæœ›æŠŠ bigram å’Œ unigram ç»“åˆèµ·æ¥ï¼Œinterpolate å°±æ˜¯è¿™æ ·ä¸€ç§æ–¹æ³•ã€‚ç”¨çº¿æ€§å·®å€¼æŠŠä¸åŒé˜¶çš„ N-gram ç»“åˆèµ·æ¥ï¼Œè¿™é‡Œç»“åˆäº† trigramï¼Œbigram å’Œ unigramã€‚ç”¨ lambda è¿›è¡ŒåŠ æƒ</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathrm{p}\left(\mathrm{w}_{\mathrm{n}} | \mathrm{w}_{\mathrm{n}-1}, \mathrm{w}_{\mathrm{n}-2}\right)=& \lambda_{1} \mathrm{p}\left(\mathrm{w}_{\mathrm{n}} | \mathrm{w}_{\mathrm{n}-1}, \mathrm{w}_{\mathrm{n}-2}\right) \\
&+\lambda_{2} \mathrm{p}\left(\mathrm{w}_{\mathrm{n}} | \mathrm{w}_{\mathrm{n}-1}\right) \\
&+\lambda_{3} \mathrm{p}\left(\mathrm{w}_{\mathrm{n}}\right)\\
\sum_i\lambda_i=1
\end{aligned}</script><h5 id="æ€æ ·è®¾ç½®-lambdasï¼Ÿï¼Ÿï¼Ÿï¼Ÿ"><a href="#æ€æ ·è®¾ç½®-lambdasï¼Ÿï¼Ÿï¼Ÿï¼Ÿ" class="headerlink" title="æ€æ ·è®¾ç½® lambdasï¼Ÿï¼Ÿï¼Ÿï¼Ÿ"></a>æ€æ ·è®¾ç½® lambdasï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</h5>]]></content>
      <categories>
        <category>è‡ªç„¶è¯­è¨€å¤„ç†</category>
      </categories>
      <tags>
        <tag>è‡ªç„¶è¯­è¨€å¤„ç†åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†è¯ç®—æ³•</title>
    <url>/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="åˆ†è¯ç®€ä»‹"><a href="#åˆ†è¯ç®€ä»‹" class="headerlink" title="åˆ†è¯ç®€ä»‹"></a>åˆ†è¯ç®€ä»‹</h3><p>ä¸­æ–‡åˆ†è¯ç®—æ³•æ˜¯æŒ‡å°†ä¸€ä¸ªæ±‰å­—åºåˆ—åˆ‡åˆ†æˆä¸€ä¸ªä¸€ä¸ªå•ç‹¬çš„è¯ï¼Œä¸è‹±æ–‡ä»¥ç©ºæ ¼ä½œä¸ºå¤©ç„¶çš„åˆ†éš”ç¬¦ä¸åŒï¼Œä¸­æ–‡å­—ç¬¦åœ¨è¯­ä¹‰è¯†åˆ«æ—¶ï¼Œéœ€è¦æŠŠæ•°ä¸ªå­—ç¬¦ç»„åˆæˆè¯ï¼Œæ‰èƒ½è¡¨è¾¾å‡ºçœŸæ­£çš„å«ä¹‰ã€‚åˆ†è¯ç®—æ³•é€šå¸¸åº”ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ã€æœç´¢å¼•æ“ã€æ™ºèƒ½æ¨èç­‰é¢†åŸŸã€‚</p>
<p>åˆ†è¯ç®—æ³•æ ¹æ®å…¶æ ¸å¿ƒæ€æƒ³ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯åŸºäºè¯å…¸çš„åˆ†è¯ï¼Œå…ˆæŠŠå¥å­æŒ‰ç…§å­—å…¸åˆ‡åˆ†æˆè¯ï¼Œå†å¯»æ‰¾è¯çš„æœ€ä½³ç»„åˆæ–¹å¼ï¼›ç¬¬äºŒç§æ˜¯åŸºäºå­—çš„åˆ†è¯ï¼Œå³ç”±å­—æ„è¯ï¼Œå…ˆæŠŠå¥å­åˆ†æˆä¸€ä¸ªä¸ªå­—ï¼Œå†å°†å­—ç»„åˆæˆè¯ï¼Œå¯»æ‰¾æœ€ä¼˜çš„åˆ‡åˆ†ç­–ç•¥ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è½¬åŒ–æˆåºåˆ—æ ‡æ³¨é—®é¢˜ã€‚</p>
<p>å…¶åˆ†ç±»å¤§è‡´å¯åˆ†ä¸ºï¼š</p>
<ol>
<li><p>åŸºäºåŒ¹é…è§„åˆ™çš„æ–¹æ³•</p>
<ul>
<li>æ­£å‘æœ€å¤§åŒ¹é…æ³•(forward maximum matching method, FMM)</li>
<li>é€†å‘æœ€å¤§åŒ¹é…æ³•(backward maximum matching method, BMM)</li>
<li>æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•</li>
</ul>
</li>
<li><p>åŸºäºç»Ÿè®¡ä»¥åŠæœºå™¨å­¦ä¹ çš„åˆ†è¯æ–¹æ³•</p>
<ul>
<li>åŸºäºN-gramè¯­è¨€æ¨¡å‹çš„åˆ†è¯æ–¹æ³•</li>
<li>åŸºäºHMMçš„åˆ†è¯æ–¹æ³•</li>
<li>åŸºäºCRFçš„åˆ†è¯æ–¹æ³•</li>
<li>åŸºäºè¯æ„ŸçŸ¥æœºçš„åˆ†è¯æ–¹æ³•</li>
<li>åŸºäºæ·±åº¦å­¦ä¹ çš„ç«¯åˆ°ç«¯çš„åˆ†è¯æ–¹æ³•</li>
</ul>
</li>
</ol>
<p>åŸºäºè§„åˆ™åŒ¹é…çš„åˆ†è¯é€šå¸¸ä¼šåŠ å…¥ä¸€äº›å¯å‘å¼è§„åˆ™ï¼Œæ¯”å¦‚â€œæ­£å‘/åå‘æœ€å¤§åŒ¹é…â€ï¼Œâ€œé•¿è¯ä¼˜å…ˆâ€ç­‰ã€‚</p>
<p>åŸºäºç»Ÿè®¡ä»¥åŠæœºå™¨å­¦ä¹ çš„åˆ†è¯æ–¹æ³•ï¼Œå®ƒä»¬åŸºäºäººå·¥æ ‡æ³¨çš„è¯æ€§å’Œç»Ÿè®¡ç‰¹å¾ï¼Œå¯¹ä¸­æ–‡è¿›è¡Œå»ºæ¨¡ï¼Œå³æ ¹æ®è§‚æµ‹åˆ°çš„æ•°æ®(æ ‡æ³¨å¥½çš„è¯­æ–™)å¯¹æ¨¡å‹å‚æ•°è¿›è¡Œè®­ç»ƒï¼Œåœ¨åˆ†è¯é˜¶æ®µå†é€šè¿‡æ¨¡å‹è®¡ç®—å„ç§åˆ†è¯å‡ºç°çš„æ¦‚ç‡ï¼Œå°†æ¦‚ç‡æœ€å¤§çš„åˆ†è¯ç»“æœä½œä¸ºæœ€ç»ˆç»“æœã€‚è¿™ç±»åˆ†è¯ç®—æ³•èƒ½å¾ˆå¥½å¤„ç†æ­§ä¹‰å’Œæœªç™»å½•è¯é—®é¢˜ï¼Œæ•ˆæœæ¯”åŸºäºè§„åˆ™åŒ¹é…çš„æ–¹æ³•æ•ˆæœå¥½ï¼Œä½†æ˜¯éœ€è¦å¤§é‡çš„äººå·¥æ ‡æ³¨æ•°æ®ï¼Œä»¥åŠè¾ƒæ…¢çš„åˆ†è¯é€Ÿåº¦ã€‚</p>
<p><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç åŠæ•°æ®</a></p>
<a id="more"></a>
<h4 id="ä¸­æ–‡åˆ†è¯çš„åº”ç”¨"><a href="#ä¸­æ–‡åˆ†è¯çš„åº”ç”¨" class="headerlink" title="ä¸­æ–‡åˆ†è¯çš„åº”ç”¨"></a>ä¸­æ–‡åˆ†è¯çš„åº”ç”¨</h4><p>ç›®å‰åœ¨è‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯ä¸­ï¼Œä¸­æ–‡å¤„ç†æŠ€æœ¯æ¯”è¥¿æ–‡å¤„ç†æŠ€æœ¯è¦è½åå¾ˆå¤§ä¸€æ®µè·ç¦»ï¼Œè®¸å¤šè¥¿æ–‡çš„å¤„ç†æ–¹æ³•ä¸­æ–‡ä¸èƒ½ç›´æ¥é‡‡ç”¨ï¼Œå°±æ˜¯å› ä¸ºä¸­æ–‡å¿…éœ€æœ‰åˆ†è¯è¿™é“å·¥åºã€‚ä¸­æ–‡åˆ†è¯æ˜¯å…¶ä»–ä¸­æ–‡ä¿¡æ¯å¤„ç†çš„åŸºç¡€ï¼Œæœç´¢å¼•æ“åªæ˜¯ä¸­æ–‡åˆ†è¯çš„ä¸€ä¸ªåº”ç”¨ã€‚å…¶ä»–çš„æ¯”å¦‚æœºå™¨ç¿»è¯‘ï¼ˆMTï¼‰ã€è¯­éŸ³åˆæˆã€è‡ªåŠ¨åˆ†ç±»ã€è‡ªåŠ¨æ‘˜è¦ã€è‡ªåŠ¨æ ¡å¯¹ç­‰ç­‰ï¼Œéƒ½éœ€è¦ç”¨åˆ°åˆ†è¯ã€‚å› ä¸ºä¸­æ–‡éœ€è¦åˆ†è¯ï¼Œå¯èƒ½ä¼šå½±å“ä¸€äº›ç ”ç©¶ï¼Œä½†åŒæ—¶ä¹Ÿä¸ºä¸€äº›ä¼ä¸šå¸¦æ¥æœºä¼šï¼Œå› ä¸ºå›½å¤–çš„è®¡ç®—æœºå¤„ç†æŠ€æœ¯è¦æƒ³è¿›å…¥ä¸­å›½å¸‚åœºï¼Œé¦–å…ˆä¹Ÿæ˜¯è¦è§£å†³ä¸­æ–‡åˆ†è¯é—®é¢˜ã€‚åœ¨ä¸­æ–‡ç ”ç©¶æ–¹é¢ï¼Œç›¸æ¯”å¤–å›½äººæ¥è¯´ï¼Œä¸­å›½äººæœ‰ååˆ†æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚</p>
<p>åˆ†è¯å‡†ç¡®æ€§å¯¹æœç´¢å¼•æ“æ¥è¯´ååˆ†é‡è¦ï¼Œä½†å¦‚æœåˆ†è¯é€Ÿåº¦å¤ªæ…¢ï¼Œå³ä½¿å‡†ç¡®æ€§å†é«˜ï¼Œå¯¹äºæœç´¢å¼•æ“æ¥è¯´ä¹Ÿæ˜¯ä¸å¯ç”¨çš„ï¼Œå› ä¸ºæœç´¢å¼•æ“éœ€è¦å¤„ç†æ•°ä»¥äº¿è®¡çš„ç½‘é¡µï¼Œå¦‚æœåˆ†è¯è€—ç”¨çš„æ—¶é—´è¿‡é•¿ï¼Œä¼šä¸¥é‡å½±å“æœç´¢å¼•æ“å†…å®¹æ›´æ–°çš„é€Ÿåº¦ã€‚å› æ­¤å¯¹äºæœç´¢å¼•æ“æ¥è¯´ï¼Œåˆ†è¯çš„å‡†ç¡®æ€§å’Œé€Ÿåº¦ï¼ŒäºŒè€…éƒ½éœ€è¦è¾¾åˆ°å¾ˆé«˜çš„è¦æ±‚ã€‚ç›®å‰ç ”ç©¶ä¸­æ–‡åˆ†è¯çš„å¤§å¤šæ˜¯ç§‘ç ”é™¢æ ¡ï¼Œæ¸…åã€åŒ—å¤§ã€ä¸­ç§‘é™¢ã€åŒ—äº¬è¯­è¨€å­¦é™¢ã€ä¸œåŒ—å¤§å­¦ã€IBMç ”ç©¶é™¢ã€å¾®è½¯ä¸­å›½ç ”ç©¶é™¢ç­‰éƒ½æœ‰è‡ªå·±çš„ç ”ç©¶é˜Ÿä¼ï¼Œè€ŒçœŸæ­£ä¸“ä¸šç ”ç©¶ä¸­æ–‡åˆ†è¯çš„å•†ä¸šå…¬å¸é™¤äº†æµ·é‡ç§‘æŠ€ä»¥å¤–ï¼Œå‡ ä¹æ²¡æœ‰ã€‚</p>
<h3 id="åŸºäºåŒ¹é…è§„åˆ™çš„æ–¹æ³•"><a href="#åŸºäºåŒ¹é…è§„åˆ™çš„æ–¹æ³•" class="headerlink" title="åŸºäºåŒ¹é…è§„åˆ™çš„æ–¹æ³•"></a>åŸºäºåŒ¹é…è§„åˆ™çš„æ–¹æ³•</h3><p>ä¸»è¦æ˜¯äººå·¥å»ºç«‹è¯åº“ä¹Ÿå«åšè¯å…¸ï¼Œé€šè¿‡è¯å…¸åŒ¹é…çš„æ–¹å¼å¯¹å¥å­è¿›è¡Œåˆ’åˆ†ã€‚å…¶å®ç°ç®€å•é«˜æ•ˆï¼Œä½†æ˜¯å¯¹æœªç™»é™†è¯å¾ˆéš¾è¿›è¡Œå¤„ç†ã€‚ä¸»è¦æœ‰å‰å‘æœ€å¤§åŒ¹é…æ³•ï¼Œåå‘æœ€å¤§åŒ¹é…æ³•ä»¥åŠåŒå‘æœ€å¤§åŒ¹é…æ³•ã€‚</p>
<h4 id="å‰å‘æœ€å¤§åŒ¹é…ç®—æ³•"><a href="#å‰å‘æœ€å¤§åŒ¹é…ç®—æ³•" class="headerlink" title="å‰å‘æœ€å¤§åŒ¹é…ç®—æ³•"></a>å‰å‘æœ€å¤§åŒ¹é…ç®—æ³•</h4><p>å‰å‘æœ€å¤§åŒ¹é…ç®—æ³•ï¼Œæ˜¯ä»å¾…åˆ†è¯å¥å­çš„å·¦è¾¹å‘å³è¾¹æœç´¢ï¼Œå¯»æ‰¾è¯çš„æœ€å¤§åŒ¹é…ã€‚è§„å®šä¸€ä¸ªè¯çš„æœ€å¤§é•¿åº¦ï¼Œæ¯æ¬¡æ‰«æçš„æ—¶å€™å¯»æ‰¾å½“å‰å¼€å§‹çš„è¿™ä¸ªé•¿åº¦çš„è¯æ¥å’Œå­—å…¸ä¸­çš„è¯åŒ¹é…ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ç¼©çŸ­é•¿åº¦ç»§ç»­å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°å­—å…¸ä¸­çš„è¯æˆ–è€…æˆä¸ºå•å­—ã€‚</p>
<h5 id="ç®—æ³•æµç¨‹"><a href="#ç®—æ³•æµç¨‹" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h5><ol>
<li>ä»å‰å‘åæ‰«æå­—å…¸ï¼Œæµ‹è¯•è¯»å…¥çš„å­ä¸²æ˜¯å¦åœ¨å­—å…¸ä¸­</li>
<li>å¦‚æœå­˜åœ¨ï¼Œåˆ™ä»è¾“å…¥ä¸­åˆ é™¤æ‰è¯¥å­ä¸²ï¼Œé‡æ–°æŒ‰ç…§è§„åˆ™å–å­ä¸²ï¼Œé‡å¤1</li>
<li>å¦‚æœä¸å­˜åœ¨äºå­—å…¸ä¸­ï¼Œåˆ™ä»å³å‘å·¦å‡å°‘å­ä¸²é•¿åº¦ï¼Œé‡å¤1</li>
</ol>
<h5 id="åˆ†è¯å®ä¾‹ï¼š"><a href="#åˆ†è¯å®ä¾‹ï¼š" class="headerlink" title="åˆ†è¯å®ä¾‹ï¼š"></a>åˆ†è¯å®ä¾‹ï¼š</h5><p>æ¯”å¦‚è¯´è¾“å…¥ â€œåŒ—äº¬å¤§å­¦ç”Ÿå‰æ¥åº”è˜â€ï¼Œå‡è®¾è¯å…¸ä¸­æœ€é•¿çš„å•è¯ä¸º 5 ä¸ªï¼ˆMAX_LENGTHï¼‰ã€‚</p>
<ol>
<li>ç¬¬ä¸€è½®ï¼šå–å­ä¸² â€œåŒ—äº¬å¤§å­¦ç”Ÿâ€ï¼Œæ­£å‘å–è¯ï¼Œå¦‚æœåŒ¹é…å¤±è´¥ï¼Œ<strong>æ¯æ¬¡å»æ‰åŒ¹é…å­—æ®µæœ€åé¢çš„ä¸€ä¸ªå­—</strong><br>â€œåŒ—äº¬å¤§å­¦ç”Ÿâ€ï¼Œæ‰«æ 5 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œåŒ—äº¬å¤§å­¦â€<br>â€œåŒ—äº¬å¤§å­¦â€ï¼Œæ‰«æ 4 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œåŒ—äº¬å¤§å­¦â€ï¼Œè¾“å…¥å˜ä¸ºâ€œç”Ÿå‰æ¥åº”è˜â€</li>
<li>ç¬¬äºŒè½®ï¼šå–å­ä¸²â€œç”Ÿå‰æ¥åº”è˜â€<br>â€œç”Ÿå‰æ¥åº”è˜â€ï¼Œæ‰«æ 5 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œç”Ÿå‰æ¥åº”â€<br>â€œç”Ÿå‰æ¥åº”â€ï¼Œæ‰«æ 4 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œç”Ÿå‰æ¥â€<br>â€œç”Ÿå‰æ¥â€ï¼Œæ‰«æ 3 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œç”Ÿå‰â€<br>â€œç”Ÿå‰â€ï¼Œæ‰«æ 2 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œç”Ÿå‰â€ï¼Œè¾“å…¥å˜ä¸ºâ€œæ¥åº”è˜â€â€</li>
<li>ç¬¬ä¸‰è½®ï¼šå–å­ä¸²â€œæ¥åº”è˜â€<br>â€œæ¥åº”è˜â€ï¼Œæ‰«æ 3 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œæ¥åº”â€<br>â€œæ¥åº”â€ï¼Œæ‰«æ 2 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œæ¥â€<br>é¢—ç²’åº¦æœ€å°ä¸º 1ï¼Œç›´æ¥è¾“å‡ºâ€œæ¥â€ï¼Œè¾“å…¥å˜ä¸ºâ€œåº”è˜â€</li>
<li>ç¬¬å››è½®ï¼šå–å­ä¸²â€œåº”è˜â€<br>â€œåº”è˜â€ï¼Œæ‰«æ 2 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œåº”è˜â€ï¼Œè¾“å…¥å˜ä¸ºâ€œâ€<br>è¾“å…¥é•¿åº¦ä¸º0ï¼Œæ‰«æç»ˆæ­¢</li>
</ol>
<h5 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><p>æ•°æ®å‡†å¤‡ï¼šè¯åº“</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward_max_match</span><span class="params">(sentence, window_size, word_dict)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    å‰å‘æœ€å¤§åŒ¹é…ç®—æ³•ï¼š</span></span><br><span class="line"><span class="string">    ï¼ˆ1ï¼‰æ‰«æå­—å…¸ï¼Œæµ‹è¯•è¯»å…¥çš„å­ä¸²æ˜¯å¦åœ¨å­—å…¸ä¸­</span></span><br><span class="line"><span class="string">    ï¼ˆ2ï¼‰å¦‚æœå­˜åœ¨ï¼Œåˆ™ä»è¾“å…¥ä¸­åˆ é™¤æ‰è¯¥å­ä¸²ï¼Œé‡æ–°æŒ‰ç…§è§„åˆ™å–å­ä¸²ï¼Œé‡å¤ï¼ˆ1ï¼‰</span></span><br><span class="line"><span class="string">    ï¼ˆ3ï¼‰å¦‚æœä¸å­˜åœ¨äºå­—å…¸ä¸­ï¼Œåˆ™ä»å³å‘å·¦å‡å°‘å­ä¸²é•¿åº¦ï¼Œé‡å¤ï¼ˆ1ï¼‰</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param sentence: å¾…åˆ†è¯çš„å¥å­</span></span><br><span class="line"><span class="string">    :param window_size: è¯çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line"><span class="string">    :param word_dict: è¯å…¸</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    seg_words = []  <span class="comment"># å­˜æ”¾åˆ†è¯ç»“æœ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> sentence:</span><br><span class="line">        <span class="keyword">for</span> word_len <span class="keyword">in</span> range(window_size, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> sentence[:word_len] <span class="keyword">in</span> word_dict:</span><br><span class="line">                <span class="comment"># å¦‚æœè¯¥è¯å†å­—å…¸ä¸­ï¼Œå°†è¯¥è¯ä¿å­˜åˆ°åˆ†è¯ç»“æœä¸­,å¹¶å°†å…¶ä»å¥ä¸­åˆ‡å‡ºæ¥</span></span><br><span class="line">                seg_words.append(sentence[:word_len])</span><br><span class="line">                sentence = sentence[word_len:]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># å¦‚æœçª—å£ä¸­çš„è¯ä¸åœ¨å­—å…¸ä¸­ï¼Œå°†ç¬¬ä¸€ä¸ªå­—åˆ‡åˆ†å‡ºæ¥</span></span><br><span class="line">            seg_words.append(sentence[:word_len])</span><br><span class="line">            sentence = sentence[word_len:]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'/'</span>.join(seg_words)</span><br></pre></td></tr></table></figure>
<h4 id="åå‘æœ€å¤§åŒ¹é…ç®—æ³•"><a href="#åå‘æœ€å¤§åŒ¹é…ç®—æ³•" class="headerlink" title="åå‘æœ€å¤§åŒ¹é…ç®—æ³•"></a>åå‘æœ€å¤§åŒ¹é…ç®—æ³•</h4><p>åœ¨è¯å…¸ä¸­ä»å¥å°¾å‘å¥é¦–è¿›è¡Œæ‰«æï¼Œå°½å¯èƒ½åœ°é€‰æ‹©ä¸è¯å…¸ä¸­æœ€é•¿å•è¯åŒ¹é…çš„è¯ä½œä¸ºç›®æ ‡åˆ†è¯ï¼Œç„¶åè¿›è¡Œä¸‹ä¸€æ¬¡åŒ¹é…ã€‚</p>
<p>åœ¨å®è·µä¸­ï¼Œé€†å‘æœ€å¤§åŒ¹é…ç®—æ³•æ€§èƒ½ä¼˜äºæ­£å‘æœ€å¤§åŒ¹é…ç®—æ³•ã€‚ </p>
<h5 id="ç®—æ³•æµç¨‹-1"><a href="#ç®—æ³•æµç¨‹-1" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h5><ol>
<li>ä»åå‘å‰æ‰«æå­—å…¸ï¼Œæµ‹è¯•è¯»å…¥çš„å­ä¸²æ˜¯å¦åœ¨å­—å…¸ä¸­</li>
<li>å¦‚æœå­˜åœ¨ï¼Œåˆ™ä»è¾“å…¥ä¸­åˆ é™¤æ‰è¯¥å­ä¸²ï¼Œé‡æ–°æŒ‰ç…§è§„åˆ™å–å­ä¸²ï¼Œé‡å¤1</li>
<li>å¦‚æœä¸å­˜åœ¨äºå­—å…¸ä¸­ï¼Œåˆ™ä»å·¦å‘å³å‡å°‘å­ä¸²é•¿åº¦ï¼Œé‡å¤1</li>
</ol>
<h5 id="åˆ†è¯å®ä¾‹"><a href="#åˆ†è¯å®ä¾‹" class="headerlink" title="åˆ†è¯å®ä¾‹"></a>åˆ†è¯å®ä¾‹</h5><p>è¾“å…¥ â€œåŒ—äº¬å¤§å­¦ç”Ÿå‰æ¥åº”è˜â€ï¼Œå‡è®¾è¯å…¸ä¸­æœ€é•¿çš„å•è¯ä¸º 5 ä¸ªï¼ˆMAX_LENGTHï¼‰ã€‚</p>
<ol>
<li>ç¬¬ä¸€è½®ï¼šå–å­ä¸² â€œç”Ÿå‰æ¥åº”è˜â€ï¼Œé€†å‘å–è¯ï¼Œå¦‚æœåŒ¹é…å¤±è´¥ï¼Œ<strong>æ¯æ¬¡å»æ‰åŒ¹é…å­—æ®µæœ€å‰é¢çš„ä¸€ä¸ªå­—</strong><br>â€œç”Ÿå‰æ¥åº”è˜â€ï¼Œæ‰«æ 5 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œå‰æ¥åº”è˜â€<br>â€œå‰æ¥åº”è˜â€ï¼Œæ‰«æ 4 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œæ¥åº”è˜â€<br>â€œæ¥åº”è˜â€ï¼Œæ‰«æ 3 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œåº”è˜â€<br>â€œåº”è˜â€ï¼Œæ‰«æ 2 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œåº”è˜â€ï¼Œè¾“å…¥å˜ä¸ºâ€œå¤§å­¦ç”Ÿå‰æ¥â€</li>
<li>ç¬¬äºŒè½®ï¼šå–å­ä¸²â€œå¤§å­¦ç”Ÿå‰æ¥â€<br>â€œå¤§å­¦ç”Ÿå‰æ¥â€ï¼Œæ‰«æ 5 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œå­¦ç”Ÿå‰æ¥â€<br>â€œå­¦ç”Ÿå‰æ¥â€ï¼Œæ‰«æ 4 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œç”Ÿå‰æ¥â€<br>â€œç”Ÿå‰æ¥â€ï¼Œæ‰«æ 3 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œå‰æ¥â€<br>â€œå‰æ¥â€ï¼Œæ‰«æ 2 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œå‰æ¥â€ï¼Œè¾“å…¥å˜ä¸ºâ€œåŒ—äº¬å¤§å­¦ç”Ÿâ€</li>
<li>ç¬¬ä¸‰è½®ï¼šå–å­ä¸²â€œåŒ—äº¬å¤§å­¦ç”Ÿâ€<br>â€œåŒ—äº¬å¤§å­¦ç”Ÿâ€ï¼Œæ‰«æ 5 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œäº¬å¤§å­¦ç”Ÿâ€<br>â€œäº¬å¤§å­¦ç”Ÿâ€ï¼Œæ‰«æ 4 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œå¤§å­¦ç”Ÿâ€<br>â€œå¤§å­¦ç”Ÿâ€ï¼Œæ‰«æ 3 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œå¤§å­¦ç”Ÿâ€ï¼Œè¾“å…¥å˜ä¸ºâ€œåŒ—äº¬â€</li>
<li>ç¬¬å››è½®ï¼šå–å­ä¸²â€œåŒ—äº¬â€<br>â€œåŒ—äº¬â€ï¼Œæ‰«æ 2 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œåŒ—äº¬â€ï¼Œè¾“å…¥å˜ä¸ºâ€œâ€<br>è¾“å…¥é•¿åº¦ä¸º0ï¼Œæ‰«æç»ˆæ­¢</li>
</ol>
<h5 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><p>æ•°æ®å‡†å¤‡ï¼šè¯åº“</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backward_max_match</span><span class="params">(sentence, window_size, word_dict)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    åå‘æœ€å¤§åŒ¹é…ç®—æ³•ï¼š</span></span><br><span class="line"><span class="string">    ï¼ˆ1ï¼‰ä»åå‘å‰æ‰«æå­—å…¸ï¼Œæµ‹è¯•è¯»å…¥çš„å­ä¸²æ˜¯å¦åœ¨å­—å…¸ä¸­</span></span><br><span class="line"><span class="string">    ï¼ˆ2ï¼‰å¦‚æœå­˜åœ¨ï¼Œåˆ™ä»è¾“å…¥ä¸­åˆ é™¤æ‰è¯¥å­ä¸²ï¼Œé‡æ–°æŒ‰ç…§è§„åˆ™å–å­ä¸²ï¼Œé‡å¤ï¼ˆ1ï¼‰</span></span><br><span class="line"><span class="string">    ï¼ˆ3ï¼‰å¦‚æœä¸å­˜åœ¨äºå­—å…¸ä¸­ï¼Œåˆ™ä»å³å‘å·¦å‡å°‘å­ä¸²é•¿åº¦ï¼Œé‡å¤ï¼ˆ1ï¼‰</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param sentence: å¾…åˆ†è¯çš„å¥å­</span></span><br><span class="line"><span class="string">    :param window_size: è¯çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line"><span class="string">    :param word_dict: è¯å…¸</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    seg_words = []</span><br><span class="line">    <span class="keyword">while</span> sentence:</span><br><span class="line">        <span class="keyword">for</span> word_len <span class="keyword">in</span> range(window_size, <span class="number">0</span>, <span class="number">-1</span>):  <span class="comment"># æ¯æ¬¡å»æ‰åŒ¹é…å­—æ®µæœ€å‰é¢çš„ä¸€ä¸ªå­—</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> sentence[len(sentence) - word_len:] <span class="keyword">in</span> word_dict:</span><br><span class="line">                <span class="comment"># å¦‚æœè¯¥è¯å†å­—å…¸ä¸­ï¼Œå°†è¯¥è¯ä¿å­˜åˆ°åˆ†è¯ç»“æœä¸­,å¹¶å°†å…¶ä»å¥ä¸­åˆ‡å‡ºæ¥</span></span><br><span class="line">                seg_words.append(sentence[len(sentence) - word_len:])</span><br><span class="line">                sentence = sentence[:len(sentence) - word_len]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># å¦‚æœçª—å£ä¸­çš„è¯ä¸åœ¨å­—å…¸ä¸­ï¼Œå°†æœ€åä¸€ä¸ªå­—åˆ‡åˆ†å‡ºæ¥</span></span><br><span class="line">            seg_words.append(sentence[<span class="number">-1</span>:])</span><br><span class="line">            sentence = sentence[:<span class="number">-1</span>]</span><br><span class="line">    seg_words.reverse()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'/'</span>.join(seg_words)</span><br></pre></td></tr></table></figure>
<h4 id="åŒå‘æœ€å¤§åŒ¹é…æ³•"><a href="#åŒå‘æœ€å¤§åŒ¹é…æ³•" class="headerlink" title="åŒå‘æœ€å¤§åŒ¹é…æ³•"></a>åŒå‘æœ€å¤§åŒ¹é…æ³•</h4><p>å› ä¸ºåŒä¸€ä¸ªå¥å­ï¼Œåœ¨æœºæ¢°åˆ†è¯ä¸­ç»å¸¸ä¼šå‡ºç°å¤šç§åˆ†è¯çš„ç»„åˆï¼Œå› æ­¤éœ€è¦è¿›è¡Œæ­§ä¹‰æ¶ˆé™¤ï¼Œæ¥å¾—åˆ°æœ€ä¼˜çš„åˆ†è¯ç»“æœã€‚</p>
<p>ä»¥å¾ˆå¸¸è§çš„MMSEGæœºæ¢°åˆ†è¯ç®—æ³•ä¸ºä¾‹ï¼ŒMMSEGåœ¨æœç´¢å¼•æ“Solrä¸­ç»å¸¸ä½¿ç”¨åˆ°ï¼Œæ˜¯ä¸€ç§éå¸¸å¯é é«˜æ•ˆçš„åˆ†è¯ç®—æ³•ã€‚MMSEGæ¶ˆé™¤æ­§ä¹‰çš„è§„åˆ™æœ‰å››ä¸ªï¼Œå®ƒåœ¨ä½¿ç”¨ä¸­ä¾æ¬¡ç”¨è¿™å››ä¸ªè§„åˆ™è¿›è¡Œè¿‡æ»¤ï¼Œç›´åˆ°åªæœ‰ä¸€ç§ç»“æœæˆ–è€…ç¬¬å››ä¸ªè§„åˆ™ä½¿ç”¨å®Œæ¯•ã€‚è¿™ä¸ªå››ä¸ªè§„åˆ™åˆ†åˆ«æ˜¯ï¼š</p>
<ol>
<li><p>æœ€å¤§åŒ¹é…ã€‚é€‰æ‹©â€œè¯ç»„é•¿åº¦æœ€å¤§çš„â€é‚£ä¸ªè¯ç»„ï¼Œç„¶åé€‰æ‹©è¿™ä¸ªè¯ç»„çš„ç¬¬ä¸€ä¸ªè¯ï¼Œä½œä¸ºåˆ‡åˆ†å‡ºçš„ç¬¬ä¸€ä¸ªè¯ï¼Œå¦‚å¯¹äºâ€œä¸­å›½äººæ°‘ä¸‡å²â€ï¼ŒåŒ¹é…ç»“æœåˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>ä¸­/å›½/äºº</li>
<li>ä¸­å›½/äºº/æ°‘</li>
<li>ä¸­å›½/äººæ°‘/ä¸‡å²</li>
<li>ä¸­å›½äºº/æ°‘/ä¸‡å²</li>
</ul>
<p>åœ¨è¿™ä¸ªä¾‹å­â€œè¯ç»„é•¿åº¦æœ€é•¿çš„â€è¯ç»„ä¸ºåä¸¤ä¸ªï¼Œå› æ­¤é€‰æ‹©äº†â€œä¸­å›½äºº/æ°‘/ä¸‡å²â€ä¸­çš„â€œä¸­å›½äººâ€ï¼Œæˆ–è€…â€œä¸­å›½/äººæ°‘/ä¸‡å²â€ä¸­çš„â€œä¸­å›½â€ã€‚</p>
</li>
<li><p>æœ€å¤§å¹³å‡è¯è¯­é•¿åº¦ã€‚ç»è¿‡è§„åˆ™1è¿‡æ»¤åï¼Œå¦‚æœå‰©ä½™çš„è¯ç»„è¶…è¿‡1ä¸ªï¼Œé‚£å°±é€‰æ‹©å¹³å‡è¯è¯­é•¿åº¦æœ€å¤§çš„é‚£ä¸ª(å¹³å‡è¯é•¿=è¯ç»„æ€»å­—æ•°/è¯è¯­æ•°é‡)ã€‚æ¯”å¦‚â€œç”Ÿæ´»æ°´å¹³â€ï¼Œå¯èƒ½å¾—åˆ°å¦‚ä¸‹è¯ç»„ï¼š</p>
<ul>
<li>ç”Ÿ/æ´»æ°´/å¹³ (4/3=1.33)</li>
<li>ç”Ÿæ´»/æ°´/å¹³ (4/3=1.33)</li>
<li>ç”Ÿæ´»/æ°´å¹³ (4/2=2)</li>
</ul>
<p>æ ¹æ®æ­¤è§„åˆ™ï¼Œå°±å¯ä»¥ç¡®å®šé€‰æ‹©â€œç”Ÿæ´»/æ°´å¹³â€è¿™ä¸ªè¯ç»„</p>
</li>
<li><p>è¯è¯­é•¿åº¦çš„æœ€å°å˜åŒ–ç‡ã€‚è¿™ä¸ªå˜åŒ–ç‡ä¸€èˆ¬å¯ä»¥ç”±æ ‡å‡†å·®æ¥å†³å®šã€‚æ¯”å¦‚å¯¹äºâ€œä¸­å›½äººæ°‘ä¸‡å²â€è¿™ä¸ªçŸ­è¯­ï¼Œå¯ä»¥è®¡ç®—ï¼š</p>
<ul>
<li>ä¸­å›½/äººæ°‘/ä¸‡å²(æ ‡å‡†å·®=sqrt(((2-2)^2+(2-2)^2+(2-2^2))/3)=0)</li>
<li>ä¸­å›½äºº/æ°‘/ä¸‡å²(æ ‡å‡†å·®=sqrt(((2-3)^2+(2-1)^2+(2-2)^2)/3)=0.8165)</li>
</ul>
<p>äºæ˜¯é€‰æ‹©â€œä¸­å›½/äººæ°‘/ä¸‡å²â€è¿™ä¸ªè¯ç»„ã€‚</p>
</li>
<li><p>è®¡ç®—è¯ç»„ä¸­çš„æ‰€æœ‰å•å­—è¯è¯é¢‘çš„è‡ªç„¶å¯¹æ•°ï¼Œç„¶åå°†å¾—åˆ°çš„å€¼ç›¸åŠ ï¼Œå–æ€»å’Œæœ€å¤§çš„è¯ç»„ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>è®¾æ–½/å’Œæœ/åŠ¡</li>
<li>è®¾æ–½/å’Œ/æœåŠ¡</li>
</ul>
<p>è¿™ä¸¤ä¸ªè¯ç»„ä¸­åˆ†åˆ«æœ‰â€œåŠ¡â€å’Œâ€œå’Œâ€è¿™ä¸¤ä¸ªå•å­—è¯ï¼Œå‡è®¾â€œåŠ¡â€ä½œä¸ºå•å­—è¯æ—¶å€™çš„é¢‘ç‡æ˜¯5ï¼Œâ€œå’Œâ€ä½œä¸ºå•å­—è¯æ—¶å€™çš„é¢‘ç‡æ˜¯10ï¼Œå¯¹5å’Œ10å–è‡ªç„¶å¯¹æ•°ï¼Œç„¶åå–æœ€å¤§å€¼è€…ï¼Œæ‰€ä»¥å–â€œå’Œâ€å­—æ‰€åœ¨çš„è¯ç»„ï¼Œå³â€œè®¾æ–½/å’Œ/æœåŠ¡â€ã€‚</p>
</li>
</ol>
<p>åœ¨å®é™…ä¸­æ ¹æ®éœ€æ±‚ï¼Œé€‰æ‹©æˆ–åˆ¶å®šç›¸åº”çš„è§„åˆ™æ¥æ”¹å–„åˆ†è¯çš„è´¨é‡ã€‚</p>
<h5 id="ç®—æ³•æµç¨‹-2"><a href="#ç®—æ³•æµç¨‹-2" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h5><ol>
<li>æ¯”è¾ƒæ­£å‘æœ€å¤§åŒ¹é…å’Œé€†å‘æœ€å¤§åŒ¹é…ç»“æœ</li>
<li>å¦‚æœåˆ†è¯æ•°é‡ç»“æœä¸åŒï¼Œé‚£ä¹ˆå–åˆ†è¯æ•°é‡è¾ƒå°‘çš„é‚£ä¸ª</li>
<li>å¦‚æœåˆ†è¯æ•°é‡ç»“æœç›¸åŒ<ul>
<li>åˆ†è¯ç»“æœç›¸åŒï¼Œå¯ä»¥è¿”å›ä»»ä½•ä¸€ä¸ª</li>
<li>åˆ†è¯ç»“æœä¸åŒï¼Œè¿”å›å•å­—æ•°æ¯”è¾ƒå°‘çš„é‚£ä¸ª</li>
</ul>
</li>
</ol>
<p>è¿™ç§è§„åˆ™çš„å‡ºå‘ç‚¹æ¥è‡ªè¯­è¨€å­¦ä¸Šçš„å¯å‘ï¼šæ±‰è¯­ä¸­å•å­—è¯çš„æ•°é‡è¦è¿œå°äºéå•å­—è¯ã€‚å› æ­¤ï¼Œç®—æ³•åº”å½“å°½é‡å‡å°‘ç»“æœä¸­çš„å•å­—ï¼Œä¿ç•™æ›´å¤šçš„å®Œæ•´è¯è¯­ã€‚</p>
<h5 id="åˆ†è¯å®ä¾‹-1"><a href="#åˆ†è¯å®ä¾‹-1" class="headerlink" title="åˆ†è¯å®ä¾‹"></a>åˆ†è¯å®ä¾‹</h5><p>æ­£å‘åŒ¹é…æœ€ç»ˆåˆ‡åˆ†ç»“æœä¸ºï¼šåŒ—äº¬å¤§å­¦ / ç”Ÿå‰ / æ¥ / åº”è˜ï¼Œåˆ†è¯æ•°é‡ä¸º 4ï¼Œå•å­—æ•°ä¸º 1<br>é€†å‘åŒ¹é…æœ€ç»ˆåˆ‡åˆ†ç»“æœä¸ºï¼šâ€åŒ—äº¬/ å¤§å­¦ç”Ÿ/ å‰æ¥ / åº”è˜ï¼Œåˆ†è¯æ•°é‡ä¸º 4ï¼Œå•å­—æ•°ä¸º 0<br>é€†å‘åŒ¹é…å•å­—æ•°å°‘ï¼Œå› æ­¤è¿”å›é€†å‘åŒ¹é…çš„ç»“æœã€‚</p>
<h5 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><p>æ•°æ®å‡†å¤‡ï¼šè¯åº“</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_max_match</span><span class="params">(sentence,window_size,word_dict)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    1. æ¯”è¾ƒæ­£å‘æœ€å¤§åŒ¹é…å’Œé€†å‘æœ€å¤§åŒ¹é…ç»“æœ</span></span><br><span class="line"><span class="string">    2. å¦‚æœåˆ†è¯æ•°é‡ç»“æœä¸åŒï¼Œé‚£ä¹ˆå–åˆ†è¯æ•°é‡è¾ƒå°‘çš„é‚£ä¸ª</span></span><br><span class="line"><span class="string">    3. å¦‚æœåˆ†è¯æ•°é‡ç»“æœç›¸åŒ</span></span><br><span class="line"><span class="string">       * åˆ†è¯ç»“æœç›¸åŒï¼Œå¯ä»¥è¿”å›ä»»ä½•ä¸€ä¸ª</span></span><br><span class="line"><span class="string">       * åˆ†è¯ç»“æœä¸åŒï¼Œè¿”å›å•å­—æ•°æ¯”è¾ƒå°‘çš„é‚£ä¸ª</span></span><br><span class="line"><span class="string">    :param sentence: å¾…åˆ†è¯çš„å¥å­</span></span><br><span class="line"><span class="string">    :param window_size: è¯çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line"><span class="string">    :param word_dict: è¯å…¸</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    forward_seg = forward_max_match(sentence,window_size,word_dict)</span><br><span class="line">    backward_seg = backward_max_match(sentence,window_size,word_dict)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœåˆ†è¯ç»“æœä¸åŒï¼Œè¿”å›è¯æ•°è¾ƒå°çš„åˆ†è¯ç»“æœ</span></span><br><span class="line">    <span class="keyword">if</span> len(forward_seg) != len(backward_seg):</span><br><span class="line">        <span class="keyword">return</span> forward_seg <span class="keyword">if</span> len(forward_seg) &lt; len(backward_seg) <span class="keyword">else</span> backward_seg</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># å¦‚æœåˆ†è¯ç»“æœè¯æ•°ç›¸åŒï¼Œä¼˜å…ˆè€ƒè™‘è¿”å›åŒ…å«å•ä¸ªå­—ç¬¦æœ€å°‘çš„åˆ†è¯ç»“æœ</span></span><br><span class="line">        forward_single_word_count = len([filter(<span class="keyword">lambda</span> x:len(x) == <span class="number">1</span>,forward_seg)])</span><br><span class="line">        backward_single_word_count = len([filter(<span class="keyword">lambda</span> x:len(x) == <span class="number">1</span>,backward_seg)])</span><br><span class="line">        <span class="keyword">if</span> forward_single_word_count != backward_single_word_count:</span><br><span class="line">            <span class="keyword">return</span> forward_seg <span class="keyword">if</span> forward_single_word_count &lt; backward_single_word_count <span class="keyword">else</span> backward_seg</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># å¦åˆ™ï¼Œè¿”å›ä»»æ„ç»“æœ</span></span><br><span class="line">            <span class="keyword">return</span> forward_seg</span><br></pre></td></tr></table></figure>
<h5 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><p>å¯¹æ­§ä¹‰é—®é¢˜çš„è§£å†³æœ‰ç‚¹å¼±</p>
<h4 id="N-æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•"><a href="#N-æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•" class="headerlink" title="(N-)æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•"></a>(N-)æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•</h4><h5 id="åŸºæœ¬æ€æƒ³"><a href="#åŸºæœ¬æ€æƒ³" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h5><p>é¦–å…ˆåŸºäºè¯å…¸å¯¹æ–‡æœ¬è¿›è¡Œå…¨åˆ‡åˆ†(æ”¹ç¼–ç‰ˆæœ€å¤§åŒ¹é…)ï¼›ç„¶ååŸºäºè¯è¯­çš„ä¸´æ¥å…³ç³»æ„å»ºä¸€ä¸ªæœ‰å‘å›¾ï¼›ä½¿ç”¨æ¨¡å‹(æ¯”å¦‚ä¸€é˜¶é©¬å°”ç§‘å¤«æ¨¡å‹)å¯¹å›¾é‡Œçš„è¾¹åŠ æƒï¼›æœ€åä½¿ç”¨æœ€çŸ­è·¯å¾„ç®—æ³•æ±‚ï¼Œä»å¥é¦–åˆ°å¥æœ«è´¨é‡æœ€é«˜(æ¯”å¦‚æ¦‚ç‡æœ€å¤§)çš„è·¯å¾„ï¼Œå°±å¾—åˆ°äº†åˆ†è¯ç»“æœã€‚</p>
<h5 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h5><p>æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•é¦–å…ˆå°†ä¸€å¥è¯ä¸­çš„æ‰€æœ‰è¯åŒ¹é…å‡ºæ¥ï¼Œæ„æˆè¯å›¾ï¼ˆæœ‰å‘æ— ç¯å›¾DAGï¼‰ï¼Œä¹‹åå¯»æ‰¾ä»èµ·å§‹ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·¯å¾„ä½œä¸ºæœ€ä½³ç»„åˆæ–¹å¼ï¼Œä»¥â€œä»–è¯´çš„ç¡®å®åœ¨ç†â€ä¸ºä¾‹ï¼Œç»™å‡ºå¯¹è¿™å¥è¯çš„3-æœ€çŸ­è·¯ï¼š<br><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•.png" alt="avatar"></p>
<ol>
<li><p>æ„å»ºæœ‰å‘å›¾ï¼šæ ¹æ®ä¸€ä¸ªå·²æœ‰è¯å…¸æ„é€ å‡ºçš„æœ‰å‘æ— ç¯å›¾ï¼ˆå…¨åˆ‡åˆ†ï¼Œæ ¹æ®ä¸´æ¥å…³ç³»æ„å»ºæœ‰å‘å›¾ï¼‰ã€‚å®ƒå°†å­—ä¸²åˆ†ä¸ºå•ä¸ªçš„å­—ï¼Œæ¯ä¸ªå­—ç”¨å›¾ä¸­ç›¸é‚»çš„ä¸¤ä¸ªç»“ç‚¹è¡¨ç¤ºï¼Œæ•…å¯¹äºé•¿åº¦ä¸ºnçš„å­—ä¸²ï¼Œéœ€è¦n+1ä¸ªç»“ç‚¹ã€‚ä¸¤èŠ‚ç‚¹é—´è‹¥æœ‰è¾¹ï¼Œåˆ™è¡¨ç¤ºä¸¤èŠ‚ç‚¹é—´æ‰€åŒ…å«çš„æ‰€æœ‰ç»“ç‚¹æ„æˆçš„è¯ï¼Œå¦‚å›¾ä¸­ç»“ç‚¹2ã€3ã€4æ„æˆè¯â€œçš„ç¡®â€ã€‚</p>
</li>
<li><p>è®¡ç®—æƒé‡ï¼šæœ¬ä¾‹å­ä¸­æƒé‡ä¸º1ï¼ˆä¸ºäº†ç®€å•ï¼‰ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸€é˜¶é©¬å°”ç§‘å¤«æ¨¡å‹è¿›è¡Œæƒé‡è®¡ç®—ã€‚</p>
<ul>
<li>p(å®ï¼Œåœ¨)=p(å®)*p(åœ¨|å®)ã€‚æ¦‚ç‡å–å€¼è¶Šå¤§ï¼Œè¯´æ˜ä¸€ä¸ªè¾¹å‡ºç°çš„æ¦‚ç‡è¶Šå¤§ï¼Œè¿™æ¡è¾¹ä¼šæå‡æ‰€åœ¨åˆ†å¥ç»“æœçš„æ¦‚ç‡ï¼Œç”±äºæœ€åè¦è®¡ç®—æœ€çŸ­è·¯å¾„ï¼Œéœ€è¦æ„é€ ä¸€ä¸ªè¿æ¥æƒé‡ä¸åˆ†å±€ç»“æœè´¨é‡æˆåæ¯”çš„æŒ‡æ ‡ï¼Œå› æ­¤å¯¹æ¦‚ç‡å–äº†å€’ï¼šweight=1/p(å®,åœ¨)</li>
<li><p>è¿™ä¸ªæ¦‚ç‡å¯èƒ½éå¸¸å°ï¼Œå¾—åˆ°çš„æƒé‡å–å€¼éå¸¸å¤§ã€‚è€Œæˆ‘ä»¬åé¢åœ¨è®¡ç®—è·¯å¾„çš„é•¿åº¦æ—¶ï¼Œä¼šå°†è‹¥å¹²ä¸ªè¾¹çš„æƒé‡åŠ èµ·æ¥ï¼Œè¿™æ—¶å€™æœ‰ä¸Šæº¢å‡ºçš„å¯èƒ½æ€§ã€‚é¿å…ä¸Šæº¢å‡ºçš„å¸¸ç”¨ç­–ç•¥æ˜¯å–å¯¹æ•°ã€‚ï¼šweight=log(1/p(å®ï¼Œåœ¨))ã€‚</p>
</li>
<li><p>æ¦‚ç‡çš„ä¼°ç®—ï¼šæ¦‚ç‡å°±ç”¨é¢‘ç‡æ¥ä¼°è®¡ï¼Œp(å®) = ï¼ˆâ€œå®â€å­—åœ¨è¯­æ–™ä¸­å‡ºç°çš„æ¬¡æ•°ï¼‰/ï¼ˆè¯­æ–™çš„æ€»è¯æ•°ï¼‰ï¼Œ</p>
<p>p(åœ¨|å®) = p(å®åœ¨)/p(å®)=(â€œå®åœ¨â€åœ¨è¯­æ–™ä¸­å‡ºç°çš„æ¬¡æ•°)/(â€œå®â€åœ¨è¯­æ–™ä¸­å‡ºç°çš„æ¬¡æ•°)</p>
</li>
</ul>
</li>
</ol>
<h5 id="ä»£ç ï¼ˆç»´ç‰¹æ¯”ï¼‰"><a href="#ä»£ç ï¼ˆç»´ç‰¹æ¯”ï¼‰" class="headerlink" title="ä»£ç ï¼ˆç»´ç‰¹æ¯”ï¼‰"></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç ï¼ˆç»´ç‰¹æ¯”ï¼‰</a></h5><p>æ•°æ®å‡†å¤‡ï¼š1ã€è¯åº“ï¼Œ2ã€è¯è¯­ä¹‹é—´çš„æ¡ä»¶æ¦‚ç‡ï¼ˆç”¨æ¥è®¡ç®—è·¯å¾„æƒé‡ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ç»´ç‰¹æ¯”ç®—æ³•æ±‚è¯å›¾çš„æœ€çŸ­è·¯å¾„</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">viterbi</span><span class="params">(self, word_graph)</span>:</span></span><br><span class="line">    path_length_map = &#123;&#125;  <span class="comment"># ç”¨äºå­˜å‚¨æ‰€æœ‰çš„è·¯å¾„ï¼Œåé¢çš„é‚»æ¥è¯è¯­æ‰€åœ¨ä½ç½®ï¼Œä»¥åŠå¯¹åº”çš„é•¿åº¦</span></span><br><span class="line">    word_graph = [[[<span class="string">"&lt;start&gt;"</span>, <span class="number">1</span>]]] + word_graph + [[[<span class="string">"&lt;end&gt;"</span>, <span class="number">-1</span>]]]</span><br><span class="line">    <span class="comment"># è¿™æ˜¯ä¸€ç§æ¯”è¾ƒç®€å•çš„æ•°æ®ç»“æ„</span></span><br><span class="line">    path_length_map[(<span class="string">"&lt;start&gt;"</span>,)] = [<span class="number">1</span>, <span class="number">0</span>]  <span class="comment"># startå¤„ï¼Œåé¢çš„ä¸´æ¥è¯è¯­åœ¨åˆ—è¡¨çš„1å¤„ï¼Œè·¯å¾„é•¿åº¦æ˜¯0,ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(word_graph)):</span><br><span class="line">        distance_from_start2current = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> len(word_graph[i]) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> former_path <span class="keyword">in</span> list(path_length_map.keys()):  <span class="comment"># path_length_mapå†…å®¹ä¸€ç›´åœ¨å˜ï¼Œéœ€è¦æ·±æ‹·è´key,ä¹Ÿå°±æ˜¯å·²ç»ç§¯ç´¯çš„æ‰€æœ‰è·¯å¾„</span></span><br><span class="line">            <span class="comment"># å–å‡ºå·²ç»ç§¯ç´¯çš„è·¯å¾„ï¼Œåé¢çš„ä¸´æ¥è¯è¯­ä½ç½®ï¼Œä»¥åŠè·¯å¾„çš„é•¿åº¦ã€‚</span></span><br><span class="line">            [next_index_4_former_path, former_distance] = path_length_map[former_path]</span><br><span class="line">            former_word = former_path[<span class="number">-1</span>]</span><br><span class="line">            later_path = list(former_path)</span><br><span class="line">            <span class="keyword">if</span> next_index_4_former_path == i:  <span class="comment"># å¦‚æœè¿™æ¡è·¯å¾„çš„ä¸´æ¥è¯è¯­çš„ä½ç½®å°±æ˜¯å½“å‰ç´¢å¼•</span></span><br><span class="line">                <span class="keyword">for</span> current_word <span class="keyword">in</span> word_graph[i]:  <span class="comment"># éå†è¯å›¾æ•°æ®ä¸­ï¼Œè¿™ä¸ªä½ç½®ä¸Šçš„æ‰€æœ‰æ¢é€‰è¯è¯­ï¼Œç„¶åä¸former_pathæ‹¼æ¥æ–°è·¯å¾„</span></span><br><span class="line">                    current_word, next_index = current_word</span><br><span class="line">                    new_path = tuple(later_path + [current_word])  <span class="comment"># åªæœ‰int, string, tupleè¿™ç§ä¸å¯ä¿®æ”¹çš„æ•°æ®ç±»å‹å¯ä»¥hashï¼Œ</span></span><br><span class="line">                    <span class="comment"># ä¹Ÿå°±æ˜¯æˆä¸ºdictçš„key</span></span><br><span class="line">                    <span class="comment"># è®¡ç®—æ–°è·¯å¾„çš„é•¿åº¦</span></span><br><span class="line">                    new_path_len = former_distance + self.word_distance.get((former_word, current_word), <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">                    path_length_map[new_path] = [next_index, new_path_len]  <span class="comment"># å­˜å‚¨æ–°è·¯å¾„åé¢çš„ä¸´æ¥è¯è¯­ï¼Œä»¥åŠè·¯å¾„é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment"># ç»´ç‰¹æ¯”çš„éƒ¨åˆ†ã€‚é€‰æ‹©åˆ°è¾¾å½“å‰èŠ‚ç‚¹çš„è·¯å¾„ä¸­ï¼Œæœ€çŸ­çš„é‚£ä¸€æ¡</span></span><br><span class="line">                    <span class="keyword">if</span> current_word <span class="keyword">in</span> distance_from_start2current:  <span class="comment"># å¦‚æœå·²ç»æœ‰åˆ°è¾¾å½“å‰è¯è¯­çš„è·¯å¾„ï¼Œéœ€è¦æ‹©ä¼˜</span></span><br><span class="line">                        <span class="keyword">if</span> distance_from_start2current[current_word][<span class="number">1</span>] &gt; new_path_len:  <span class="comment"># å¦‚æœå½“å‰æ–°è·¯å¾„æ¯”å·²æœ‰çš„æ›´çŸ­</span></span><br><span class="line">                            distance_from_start2current[current_word] = [new_path, new_path_len]  <span class="comment"># ç”¨æ›´çŸ­çš„è·¯å¾„æ•°æ®è¦†ç›–åŸæ¥çš„</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        distance_from_start2current[current_word] = [new_path, new_path_len]  <span class="comment"># å¦‚æœè¿˜æ²¡æœ‰è¿™æ¡è·¯å¾„ï¼Œå°±è®°å½•å®ƒ</span></span><br><span class="line">    shortest_path = distance_from_start2current[<span class="string">"&lt;end&gt;"</span>][<span class="number">0</span>]</span><br><span class="line">    shortest_path = shortest_path[<span class="number">1</span>:<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> shortest_path</span><br></pre></td></tr></table></figure>
<h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ol>
<li>å¯¹æ­§ä¹‰å’Œæ–°è¯çš„å¤„ç†ä¸æ˜¯å¾ˆå¥½ï¼Œå¯¹è¯å…¸ä¸­æœªå‡ºç°çš„è¯æ²¡æ³•è¿›è¡Œå¤„ç†ã€‚</li>
<li>åˆ†è¯æ•ˆæœå–å†³äºè¯å…¸çš„è´¨é‡ã€‚</li>
</ol>
<h3 id="åŸºäºç»Ÿè®¡ä»¥åŠæœºå™¨å­¦ä¹ çš„åˆ†è¯æ–¹æ³•"><a href="#åŸºäºç»Ÿè®¡ä»¥åŠæœºå™¨å­¦ä¹ çš„åˆ†è¯æ–¹æ³•" class="headerlink" title="åŸºäºç»Ÿè®¡ä»¥åŠæœºå™¨å­¦ä¹ çš„åˆ†è¯æ–¹æ³•"></a>åŸºäºç»Ÿè®¡ä»¥åŠæœºå™¨å­¦ä¹ çš„åˆ†è¯æ–¹æ³•</h3><h4 id="åŸºäºN-gramè¯­è¨€æ¨¡å‹çš„åˆ†è¯æ–¹æ³•"><a href="#åŸºäºN-gramè¯­è¨€æ¨¡å‹çš„åˆ†è¯æ–¹æ³•" class="headerlink" title="åŸºäºN-gramè¯­è¨€æ¨¡å‹çš„åˆ†è¯æ–¹æ³•"></a>åŸºäºN-gramè¯­è¨€æ¨¡å‹çš„åˆ†è¯æ–¹æ³•</h4><h5 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h5><p>n-gramæ¨¡å‹ï¼Œç§°ä¸ºNå…ƒæ¨¡å‹ï¼Œå¯ç”¨äºå®šä¹‰å­—ç¬¦ä¸²ä¸­çš„è·ç¦»ï¼Œä¹Ÿå¯ç”¨äºä¸­æ–‡çš„åˆ†è¯ï¼›è¯¥æ¨¡å‹å‡è®¾ç¬¬nä¸ªè¯çš„å‡ºç°åªä¸å‰é¢n-1ä¸ªè¯ç›¸å…³ï¼Œä¸å…¶ä»–è¯éƒ½ä¸ç›¸å…³ï¼Œæ•´ä¸ªè¯­å¥çš„æ¦‚ç‡å°±æ˜¯å„ä¸ªè¯å‡ºç°æ¦‚ç‡çš„ä¹˜ç§¯ï¼›è€Œè¿™äº›æ¦‚ç‡ï¼Œåˆ©ç”¨è¯­æ–™ï¼Œç»Ÿè®¡åŒæ—¶å‡ºç°ç›¸å…³è¯çš„æ¦‚ç‡æ¬¡æ•°è®¡ç®—å¾—åˆ°ï¼›å¸¸ç”¨çš„æ¨¡å‹æ˜¯Bi-gramå’ŒTri-gramæ¨¡å‹ã€‚<br>å‡è®¾ä¸€ä¸ªå­—ç¬¦ä¸²sç”±mä¸ªè¯ç»„æˆï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è®¡ç®—å‡º$p(w_1,w_2,\ldots,w_m)$çš„æ¦‚ç‡ï¼Œæ ¹æ®æ¦‚ç‡è®ºä¸­çš„é“¾å¼æ³•åˆ™å¾—åˆ°å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
p(w_1,w_2,\ldots,w_m) = p(w_1)*p(w_2|w_1)*p(w_3|w_2,w_1)\ldots p(w_m|w_{m-1},\ldots,w_2,w_1)=\prod_{i}{p(w_i|w_1,w_2,\ldots,w_{i-1})}</script><p>é‚£ä¹ˆä¸‹é¢çš„é—®é¢˜æ˜¯å¦‚ä½•è®¡ç®—ä¸Šé¢æ¯ä¸€ä¸ªæ¦‚ç‡ï¼Œæ¯”å¦‚$p(w_1,w_2,w_3,w_4,w_5)$ï¼Œä¸€ç§æ¯”è¾ƒç›´è§‚çš„è®¡ç®—å°±æ˜¯è®¡æ•°ç„¶åç”¨é™¤æ³•ï¼š</p>
<script type="math/tex; mode=display">
p(w_5|w_1,w_2,w_3,w_4) = \frac{Count(w_1,w_2,w_3,w_4,w_5)}{Count(w_1,w_2,w_3,w_4)}</script><p>ç›´æ¥è®¡ç®—è¿™ä¸ªæ¦‚ç‡çš„éš¾åº¦æœ‰ç‚¹å¤§ï¼š</p>
<ol>
<li><p>ç›´æ¥è¿™æ ·è®¡ç®—ä¼šå¯¼è‡´å‚æ•°ç©ºé—´è¿‡å¤§ã€‚</p>
<p>ä¸€ä¸ªè¯­è¨€æ¨¡å‹çš„å‚æ•°å°±æ˜¯æ‰€æœ‰çš„è¿™äº›æ¡ä»¶æ¦‚ç‡ï¼Œè¯•æƒ³æŒ‰ä¸Šé¢æ–¹å¼è®¡ç®—$p(w_5|w_1,w_2,w_3,w_4)$,è¿™é‡Œ$w_5$æœ‰è¯å…¸å¤§å°å–å€¼çš„å¯èƒ½ï¼Œè®°è¯å…¸å¤§å°ï¼š$|V|$ï¼Œåˆ™è¯¥æ¨¡å‹çš„å‚æ•°ä¸ªæ•°æ˜¯$|V|^5$ï¼Œè€Œä¸”è¿™è¿˜ä¸åŒ…å«$P(w_4|w_1,w_2,w_3)$çš„ä¸ªæ•°ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ ·å»è®¡ç®—æ¡ä»¶æ¦‚ç‡ä¼šä½¿è¯­è¨€æ¨¡å‹å‚æ•°ä¸ªæ•°è¿‡å¤šè€Œæ— æ³•ä½¿ç”¨ã€‚</p>
</li>
<li><p>æ•°æ®ç¨€ç–ä¸¥é‡ã€‚æˆ‘çš„ç†è§£æ˜¯åƒä¸Šé¢é‚£æ ·è®¡æ•°è®¡ç®—ï¼Œæ¯”å¦‚è®¡æ•°åˆ†å­$w_1,w_2,w_3,w_4,w_5$,åœ¨æˆ‘ä»¬æ‰€èƒ½è§çš„æ–‡æœ¬ä¸­å‡ºç°çš„æ¬¡æ•°æ˜¯å¾ˆå°çš„ï¼Œè¿™æ ·è®¡ç®—çš„ç»“æœæ˜¯è¿‡å¤šçš„æ¡ä»¶æ¦‚ç‡ä¼šç­‰äº0ï¼Œå› ä¸ºæˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰çœ‹åˆ°è¶³å¤Ÿçš„æ–‡æœ¬æ¥ç»Ÿè®¡ï¼å‡è®¾ä¸€ä¸ªè¯­æ–™åº“ä¸­å•è¯çš„æ•°é‡ä¸º$|V|$ä¸ªï¼Œä¸€ä¸ªå¥å­ç”±$n$ä¸ªè¯ç»„æˆï¼Œé‚£ä¹ˆæ¯ä¸ªå•è¯éƒ½å¯èƒ½æœ‰$|V|$ä¸ªå–å€¼ï¼Œé‚£ä¹ˆç”±è¿™äº›è¯ç»„æˆçš„$n$å…ƒç»„åˆçš„æ•°ç›®ä¸º$|V|^n$ç§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»„åˆæ•°ä¼šéšç€$n$çš„å¢åŠ è€Œå‘ˆç°æŒ‡æ•°çº§åˆ«çš„å¢é•¿ï¼Œéšç€$n$çš„å¢åŠ ï¼Œè¯­æ–™æ•°æ®åº“èƒ½å¤Ÿæä¾›çš„æ•°æ®æ˜¯éå¸¸æœ‰é™çš„ï¼Œé™¤éæœ‰æµ·é‡çš„å„ç§ç±»å‹çš„è¯­æ–™æ•°æ®ï¼Œå¦åˆ™è¿˜æœ‰å¤§é‡çš„$n$å…ƒç»„åˆéƒ½æ²¡æœ‰åœ¨è¯­æ–™åº“ä¸­å‡ºç°è¿‡ï¼ˆå³ç”±$n$ä¸ªå•è¯æ‰€ç»„æˆçš„ä¸€äº›å¥å­æ ¹æœ¬å°±æ²¡å‡ºç°è¿‡ï¼Œå¯ä»¥ç†è§£ä¸ºå¾ˆå¤šçš„$n$å…ƒç»„æ‰€ç»„æˆçš„å¥å­ä¸èƒ½è¢«äººå¾ˆå¥½åœ°ç†è§£ï¼‰ä¹Ÿå°±æ˜¯è¯´ä¾æ®æœ€å¤§ä¼¼ç„¶ä¼°è®¡å¾—åˆ°çš„æ¦‚ç‡å°†ä¼šæ˜¯0ï¼Œæ¨¡å‹å¯èƒ½ä»…ä»…èƒ½å¤Ÿè®¡ç®—å¯¥å¯¥å‡ ä¸ªå¥å­ã€‚æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p>
</li>
</ol>
<p>è§£å†³åƒæ•°ç©ºé—´è¿‡å¤§çš„é—®é¢˜ã€‚å¼•å…¥äº†é©¬å°”ç§‘å¤«å‡è®¾ï¼š<strong>éšæ„ä¸€ä¸ªè¯å‡ºç°çš„æ¦‚ç‡åªä¸å®ƒå‰é¢å‡ºç°çš„æœ‰é™çš„ä¸€ä¸ªæˆ–è€…å‡ ä¸ªè¯æœ‰å…³ã€‚</strong>å‡è®¾ç¬¬$w_i$ä¸ªè¯è¯­åªä¸å®ƒå‰é¢çš„$n$ä¸ªè¯è¯­ç›¸å…³ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°å‰é¢çš„æ¡ä»¶æ¦‚ç‡è®¡ç®—ç®€åŒ–å¦‚ä¸‹</p>
<script type="math/tex; mode=display">
p(w_i|w_{i-1},\ldots,w_2,w_1) \approx p(w_i|w_{i-1},\ldots,w_{i-n})\\
p(w_1,w_2,\ldots,w_m) \approx \prod_{i} p(w_i|w_{i-1},\ldots,w_{i-n})</script><p>å½“n=1ï¼Œå³ä¸€å…ƒæ¨¡å‹ï¼ˆUni-gramï¼‰,å³$w_i$ä¸å®ƒå‰é¢çš„0ä¸ªè¯ç›¸å…³ï¼Œå³$w_i$ä¸ä¸ä»»ä½•è¯ç›¸å…³ï¼Œæ¯ä¸€ä¸ªè¯éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼š</p>
<script type="math/tex; mode=display">
P\left(w_{1}, w_{2}, \cdots, w_{m}\right)=\prod_{i=1}^{m} P\left(w_{i}\right)</script><p>å½“n=2ï¼Œå³äºŒå…ƒæ¨¡å‹ï¼ˆBi-gramï¼‰,æ­¤æ—¶$w_i$ä¸å®ƒå‰é¢1ä¸ªè¯ç›¸å…³ï¼š</p>
<script type="math/tex; mode=display">
P\left(w_{1}, w_{2}, \cdots, w_{m}\right)=\prod_{i=1}^{m} P\left(w_{i} | w_{i-1}\right)</script><p>å½“n=3æ—¶ï¼Œå³ä¸‰å…ƒæ¨¡å‹ï¼ˆTri-gramï¼‰,æ­¤æ—¶$w_i$ä¸å®ƒå‰é¢2ä¸ªè¯ç›¸å…³ï¼š</p>
<script type="math/tex; mode=display">
P\left(w_{1}, w_{2}, \cdots, w_{m}\right)=\prod_{i=1}^{m} P\left(w_{i} | w_{i-2} w_{i-1}\right)</script><p>ä¸€èˆ¬æ¥è¯´ï¼ŒNå…ƒæ¨¡å‹å°±æ˜¯å‡è®¾å½“å‰è¯çš„å‡ºç°æ¦‚ç‡åªä¸å®ƒå‰é¢çš„N-1ä¸ªè¯æœ‰å…³ã€‚è€Œè¿™äº›æ¦‚ç‡å‚æ•°éƒ½æ˜¯å¯ä»¥é€šè¿‡å¤§è§„æ¨¡è¯­æ–™åº“æ¥è®¡ç®—ã€‚<strong>åœ¨å®è·µä¸­ç”¨çš„æœ€å¤šçš„å°±æ˜¯bigramå’Œtrigramäº†ï¼Œé«˜äºå››å…ƒçš„ç”¨çš„éå¸¸å°‘ï¼Œç”±äºè®­ç»ƒå®ƒé¡»è¦æ›´åºå¤§çš„è¯­æ–™ï¼Œå¹¶ä¸”æ•°æ®ç¨€ç–ä¸¥é‡ï¼Œæ—¶é—´å¤æ‚åº¦é«˜ï¼Œç²¾åº¦å´æé«˜çš„ä¸å¤šã€‚</strong></p>
<h5 id="å‚æ•°ä¼°è®¡"><a href="#å‚æ•°ä¼°è®¡" class="headerlink" title="å‚æ•°ä¼°è®¡"></a>å‚æ•°ä¼°è®¡</h5><p>è¦è®¡ç®—å‡ºæ¨¡å‹ä¸­çš„æ¡ä»¶æ¦‚ç‡ï¼Œè¿™äº›æ¡ä»¶æ¦‚ç‡ä¹Ÿç§°ä¸ºæ¨¡å‹çš„å‚æ•°ï¼Œå¾—åˆ°è¿™äº›å‚æ•°çš„è¿‡ç¨‹ç§°ä¸ºè®­ç»ƒã€‚ç”¨æœ€å¤§ä¼¼ç„¶æ€§ä¼°è®¡è®¡ç®—ä¸‹é¢çš„æ¡ä»¶æ¦‚ç‡ï¼š</p>
<script type="math/tex; mode=display">
P\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1}, w_{i}\right)}{c\left(w_{i-1}\right)}</script><p>ä¸€å…ƒè¯­è¨€æ¨¡å‹ä¸­ï¼šå¥å­æ¦‚ç‡å®šä¹‰ä¸ºï¼š$P\left(s\right)=\prod_{i=1}^{m} P\left(w_{i}\right)$,è¿™ä¸ªå¼å­æˆç«‹çš„æ¡ä»¶æ˜¯æœ‰ä¸€ä¸ªå‡è®¾ï¼Œå°±æ˜¯æ¡ä»¶æ— å…³å‡è®¾ï¼Œæˆ‘ä»¬è®¤ä¸ºæ¯ä¸ªè¯éƒ½æ˜¯æ¡ä»¶æ— å…³çš„ã€‚è¿™é‡Œçš„å‚æ•°ç§ç±»æ˜¯ä¸€ç§ $P(w_n)$,ä½†æ˜¯å‚æ•°å®ä¾‹æœ‰$|V|$ä¸ª(Væ˜¯è¯å…¸å¤§å°),æˆ‘ä»¬åº”è¯¥å¦‚ä½•å¾—åˆ°æ¯ä¸ªå‚æ•°å®ä¾‹çš„å€¼ã€‚ç”¨çš„æ˜¯æå¤§ä¼¼ç„¶ä¼°è®¡æ³•ã€‚æ¯”å¦‚è®­ç»ƒè¯­æ–™æ˜¯:â€æ˜ŸæœŸäº”æ—©æ™¨ï¼Œæˆ‘ç‰¹æ„èµ·äº†ä¸ªå¤§æ—©ï¼Œä¸ºçš„å°±æ˜¯çœ‹çœ‹æ—©æ™¨çš„å¤©ç©ºã€‚â€é‚£ä¹ˆæˆ‘ä»¬çš„å­—å…¸ä¸ºï¼šæ˜Ÿ æœŸ äº” æ—© æ™¨ ï¼Œæˆ‘ ç‰¹ æ„ èµ· äº† ä¸ª å¤§ æ—© ä¸º çš„ å°± æ˜¯ çœ‹ å¤© ç©º ã€‚ 22ä¸ªä¸åŒè¯ï¼Œæ¯ä¸ªè¯è¯­çš„æ¦‚ç‡ç›´æ¥ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡æ³•ä¼°è®¡å¾—åˆ°ã€‚å¦‚ï¼šp(æ˜Ÿ) = 1/27ï¼Œp(æœŸ) = 1/27ã€‚äºæ˜¯éœ€è¦å­˜å‚¨å­¦ä¹ å¾—åˆ°çš„æ¨¡å‹å‚æ•°ï¼Œä¸€ä¸ªå‘é‡ï¼Œ22ç»´ï¼Œæ¯ä¸ªç»´åº¦ä¿å­˜ç€æ¯ä¸ªå•è¯çš„æ¦‚ç‡å€¼ã€‚å½“éœ€è¦è®¡ç®—ï¼šp(æˆ‘çœ‹çœ‹æ—©æ™¨çš„å¤©ç©º)=p(æˆ‘)p(çœ‹)p(çœ‹)p(æ—©)p(æ™¨)p(çš„)p(å¤©)p(ç©º)=$\frac{1}{27}<em>\frac{1}{27}</em>\frac{1}{27}\ldots *\frac{1}{27}$ï¼Œå¯ä»¥ç›´æ¥è®¡ç®—å‡ºæ¥ã€‚äºæ˜¯åªè¦å°†æ¯å¥è¯æ‹†å¼€ä¸ºæ¯ä¸ªå•è¯ç„¶åç”¨ç´¯ç§¯å½¢å¼è¿ç®—ï¼Œè¿™æ ·å°±èƒ½ç®—å‡ºæ¯å¥è¯çš„æ¦‚ç‡ã€‚ç¼ºç‚¹æ˜¯ï¼šä¸åŒ…å«è¯­åºä¿¡æ¯ã€‚</p>
<p>äºŒå…ƒè¯­è¨€æ¨¡å‹ä¸­ï¼šä¸ºäº†è®¡ç®—å¯¹åº”çš„äºŒå…ƒæ¨¡å‹çš„å‚æ•°ï¼Œå³$P(w_i | w_{i-1})$ï¼Œè¦å…ˆè®¡æ•°å³$c(w_{i-1},w_i)$ï¼Œç„¶åè®¡æ•°$c(w_{i-1})$,å†ç”¨é™¤æ³•å¯å¾—åˆ°è¿™äº›æ¡ä»¶æ¦‚ç‡.å¯ä»¥çœ‹åˆ°å¯¹äº$c(w_{i-1},w_i)$æ¥è¯´ï¼Œ$w_{i-1}$æœ‰è¯­æ–™åº“è¯å…¸å¤§å°ï¼ˆè®°ä½œ$|V|$ï¼‰çš„å¯èƒ½å–å€¼ï¼Œ$w_i$ä¹Ÿæ˜¯ï¼Œæ‰€ä»¥$c(w_{i-1},w_i)$è¦è®¡ç®—çš„ä¸ªæ•°æœ‰$|V|^2$ã€‚</p>
<p>$c(w_{i-1},w_i)$è®¡æ•°ç»“æœå¦‚ä¸‹:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>i</th>
<th>want</th>
<th>to</th>
<th>eat</th>
<th>chinese</th>
<th>food</th>
<th>lunch</th>
<th>english</th>
</tr>
</thead>
<tbody>
<tr>
<td>i</td>
<td>5</td>
<td>827</td>
<td>0</td>
<td>9</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
</tr>
<tr>
<td>want</td>
<td>2</td>
<td>0</td>
<td>608</td>
<td>1</td>
<td>6</td>
<td>6</td>
<td>5</td>
<td>1</td>
</tr>
<tr>
<td>to</td>
<td>2</td>
<td>0</td>
<td>4</td>
<td>686</td>
<td>2</td>
<td>0</td>
<td>6</td>
<td>211</td>
</tr>
<tr>
<td>eat</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>16</td>
<td>2</td>
<td>42</td>
<td>0</td>
</tr>
<tr>
<td>chinese</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>82</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>food</td>
<td>15</td>
<td>0</td>
<td>15</td>
<td>0</td>
<td>1</td>
<td>4</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>lunch</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>spend</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<p>$c(w_{i-1})$çš„è®¡æ•°å¦‚ä¸‹ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>i</th>
<th>want</th>
<th>to</th>
<th>eat</th>
<th>chinese</th>
<th>food</th>
<th>lunch</th>
<th>english</th>
</tr>
</thead>
<tbody>
<tr>
<td>2533</td>
<td>927</td>
<td>2417</td>
<td>746</td>
<td>158</td>
<td>1093</td>
<td>341</td>
<td>278</td>
</tr>
</tbody>
</table>
</div>
<p>é‚£ä¹ˆäºŒå…ƒæ¨¡å‹çš„å‚æ•°è®¡ç®—ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>i</th>
<th>want</th>
<th>to</th>
<th>eat</th>
<th>chinese</th>
<th>food</th>
<th>lunch</th>
<th>english</th>
</tr>
</thead>
<tbody>
<tr>
<td>i</td>
<td>0.002</td>
<td>0.33</td>
<td>0</td>
<td>0.0036</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.00079</td>
</tr>
<tr>
<td>want</td>
<td>0.0022</td>
<td>0</td>
<td>0.66</td>
<td>0.0011</td>
<td>0.0065</td>
<td>0.0065</td>
<td>0.0054</td>
<td>0.0011</td>
</tr>
<tr>
<td>to</td>
<td>0.00083</td>
<td>0</td>
<td>0.0017</td>
<td>0.28</td>
<td>0.00083</td>
<td>0</td>
<td>0.0025</td>
<td>0.087</td>
</tr>
<tr>
<td>eat</td>
<td>0</td>
<td>0</td>
<td>0.0027</td>
<td>0</td>
<td>0.021</td>
<td>0.0027</td>
<td>0.056</td>
<td>0</td>
</tr>
<tr>
<td>chinese</td>
<td>0.0063</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.52</td>
<td>0.0063</td>
<td>0</td>
</tr>
<tr>
<td>food</td>
<td>0.014</td>
<td>0</td>
<td>0.0014</td>
<td>0</td>
<td>0.00092</td>
<td>0.0037</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>lunch</td>
<td>0.0059</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0029</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>spend</td>
<td>0.0036</td>
<td>0</td>
<td>0.0036</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<p>æ¯”å¦‚è®¡ç®—å…¶ä¸­çš„P(want | i) = 0.33å¦‚:$p(want|i) = \frac{c(i,want)}{c(i)}=\frac{827}{2533} \approx0.33$,é’ˆå¯¹è¿™ä¸ªè¯­æ–™åº“çš„äºŒå…ƒæ¨¡å‹å»ºç«‹å¥½äº†åï¼Œå¯ä»¥è®¡ç®—ç›®æ ‡ï¼Œå³ä¸€ä¸ªå¥å­çš„æ¦‚ç‡äº†ï¼Œä¸€ä¸ªä¾‹å­å¦‚ä¸‹ï¼š</p>
<p>$p(s)=p(i want english food) = p(i|<start>)<em>p(want|i)</em>p(english|want)<em>p(food|english)</em>p(<end>|food) \approx 0.000031$</end></start></p>
<p>è¯¥äºŒå…ƒæ¨¡å‹æ‰€æ•æ‰åˆ°çš„ä¸€äº›å®é™…ä¿¡æ¯:</p>
<ul>
<li>$p(english|want) = 0.0011,p(chinese|want)=0.0065$,want chinese çš„æ¦‚ç‡æ›´é«˜ï¼Œè¿™å’ŒçœŸå®ä¸–ç•Œæƒ…å†µç›¸å¯¹åº”ï¼Œå› ä¸ºchinese food æ¯” English food æ›´å—æ¬¢è¿ã€‚</li>
<li>$p(to|want)=0.66$, want to çš„æ¦‚ç‡å¾ˆé«˜ï¼Œåæ˜ äº†è¯­æ³•ç‰¹æ€§</li>
<li>$p(food|to)=0$ ï¼Œto food æ¦‚ç‡ä¸º0ï¼Œå› ä¸ºè¿™ç§æ­é…ä¸å¸¸è§</li>
<li>$p(want|spend)=0$, spend want æ¦‚ç‡ä¸º0ï¼Œå› ä¸ºè¿™æ ·è¿åäº†è¯­æ³•ã€‚</li>
</ul>
<p>å¸¸å¸¸åœ¨å¯¹æ•°ç©ºé—´é‡Œé¢è®¡ç®—æ¦‚ç‡ï¼ŒåŸå› æœ‰ä¸¤ä¸ªï¼š</p>
<ol>
<li>é˜²æ­¢æº¢å‡ºï¼Œå¦‚æœè®¡ç®—çš„å¥å­å¾ˆé•¿ï¼Œæœ€åå¾—åˆ°çš„ç»“æœå°†éå¸¸å°ï¼Œç”šè‡³ä¼šæº¢å‡ºï¼Œæ¯”å¦‚è®¡ç®—å¾—åˆ°çš„æ¦‚ç‡æ˜¯0.001ï¼Œé‚£ä¹ˆå‡è®¾ä»¥10ä¸ºåº•å–å¯¹æ•°çš„ç»“æœå°±æ˜¯-3ï¼Œè¿™æ ·å°±ä¸ä¼šæº¢å‡ºã€‚</li>
<li>å¯¹æ•°ç©ºé—´é‡Œé¢åŠ æ³•å¯ä»¥ä»£æ›¿ä¹˜æ³•ï¼Œå› ä¸ºlog(p1p2) = logp1 + logp2ï¼Œè€Œåœ¨è®¡ç®—æœºå†…éƒ¨ï¼Œæ˜¾ç„¶åŠ æ³•æ¯”ä¹˜æ³•æ‰§è¡Œæ›´å¿«ï¼</li>
</ol>
<h5 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><p>æ•°æ®å‡†å¤‡ï¼šunigram:(word, freq),bigram:(word1,word2,freq) è¯­æ–™æ•°æ®ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="comment"># global parameter</span></span><br><span class="line">DELIMITER = <span class="string">" "</span>  <span class="comment"># åˆ†è¯ä¹‹åçš„åˆ†éš”ç¬¦</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DNASegment</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.word1_dict_prob = &#123;&#125;  <span class="comment"># è®°å½•æ¦‚ç‡,1-gram</span></span><br><span class="line">        self.word1_dict_count = &#123;&#125;  <span class="comment"># è®°å½•è¯é¢‘,1-gram</span></span><br><span class="line">        self.word1_dict_count[<span class="string">"&lt;S&gt;"</span>] = <span class="number">8310575403</span>  <span class="comment"># å¼€å§‹çš„&lt;S&gt;çš„ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">        self.word2_dict_prob = &#123;&#125;  <span class="comment"># è®°å½•æ¦‚ç‡,2-gram</span></span><br><span class="line">        self.word2_dict_count = &#123;&#125;  <span class="comment"># è®°å½•è¯é¢‘,2-gram</span></span><br><span class="line"></span><br><span class="line">        self.gmax_word_length = <span class="number">0</span></span><br><span class="line">        self.all_freq = <span class="number">0</span>  <span class="comment"># æ‰€æœ‰è¯çš„è¯é¢‘æ€»å’Œ,1-gramçš„</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¼°ç®—æœªå‡ºç°çš„è¯çš„æ¦‚ç‡,æ ¹æ®beautiful dataé‡Œé¢çš„æ–¹æ³•ä¼°ç®—</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_unkonw_word_prob</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> math.log(<span class="number">10.</span> / (self.all_freq * <span class="number">10</span> ** len(word)))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å¾—ç‰‡æ®µçš„æ¦‚ç‡</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_word_prob</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">in</span> self.word1_dict_prob:  <span class="comment"># å¦‚æœå­—å…¸åŒ…å«è¿™ä¸ªè¯</span></span><br><span class="line">            prob = self.word1_dict_prob[word]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prob = self.get_unkonw_word_prob(word)</span><br><span class="line">        <span class="keyword">return</span> prob</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å¾—ä¸¤ä¸ªè¯çš„è½¬ç§»æ¦‚ç‡(bigram)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_word_trans_prob</span><span class="params">(self, first_word, second_word)</span>:</span></span><br><span class="line">        trans_word = first_word + <span class="string">" "</span> + second_word</span><br><span class="line">        <span class="comment"># print trans_word</span></span><br><span class="line">        <span class="keyword">if</span> trans_word <span class="keyword">in</span> self.word2_dict_count:</span><br><span class="line">            trans_prob = math.log(self.word2_dict_count[trans_word] / self.word1_dict_count[first_word])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            trans_prob = self.get_word_prob(second_word)</span><br><span class="line">        <span class="keyword">return</span> trans_prob</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯»æ‰¾nodeçš„æœ€ä½³å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">    <span class="comment"># æ–¹æ³•ä¸ºå¯»æ‰¾æ‰€æœ‰å¯èƒ½çš„å‰é©±ç‰‡æ®µ</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_best_pre_node</span><span class="params">(self, sequence, node, node_state_list)</span>:</span></span><br><span class="line">        <span class="comment"># å¦‚æœnodeæ¯”æœ€å¤§è¯é•¿å°ï¼Œå–çš„ç‰‡æ®µé•¿åº¦ä»¥nodeçš„é•¿åº¦ä¸ºé™</span></span><br><span class="line">        max_seg_length = min([node, self.gmax_word_length])</span><br><span class="line">        pre_node_list = []  <span class="comment"># å‰é©±èŠ‚ç‚¹åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è·å¾—æ‰€æœ‰çš„å‰é©±ç‰‡æ®µï¼Œå¹¶è®°å½•ç´¯åŠ æ¦‚ç‡</span></span><br><span class="line">        <span class="keyword">for</span> segment_length <span class="keyword">in</span> range(<span class="number">1</span>, max_seg_length + <span class="number">1</span>):</span><br><span class="line">            segment_start_node = node - segment_length</span><br><span class="line">            segment = sequence[segment_start_node:node]  <span class="comment"># è·å–ç‰‡æ®µ</span></span><br><span class="line"></span><br><span class="line">            pre_node = segment_start_node  <span class="comment"># å–è¯¥ç‰‡æ®µï¼Œåˆ™è®°å½•å¯¹åº”çš„å‰é©±èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> pre_node == <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># å¦‚æœå‰é©±ç‰‡æ®µå¼€å§‹èŠ‚ç‚¹æ˜¯åºåˆ—çš„å¼€å§‹èŠ‚ç‚¹ï¼Œ</span></span><br><span class="line">                <span class="comment"># åˆ™æ¦‚ç‡ä¸º&lt;S&gt;è½¬ç§»åˆ°å½“å‰è¯çš„æ¦‚ç‡</span></span><br><span class="line">                <span class="comment"># segment_prob = self.get_word_prob(segment)</span></span><br><span class="line">                segment_prob = self.get_word_trans_prob(<span class="string">"&lt;S&gt;"</span>, segment)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># å¦‚æœä¸æ˜¯åºåˆ—å¼€å§‹èŠ‚ç‚¹ï¼ŒæŒ‰ç…§äºŒå…ƒæ¦‚ç‡è®¡ç®—</span></span><br><span class="line">                <span class="comment"># è·å¾—å‰é©±ç‰‡æ®µçš„å‰ä¸€ä¸ªè¯</span></span><br><span class="line">                pre_pre_node = node_state_list[pre_node][<span class="string">"pre_node"</span>]</span><br><span class="line">                pre_pre_word = sequence[pre_pre_node:pre_node]</span><br><span class="line">                segment_prob = self.get_word_trans_prob(pre_pre_word, segment)</span><br><span class="line"></span><br><span class="line">            pre_node_prob_sum = node_state_list[pre_node][<span class="string">"prob_sum"</span>]  <span class="comment"># å‰é©±èŠ‚ç‚¹çš„æ¦‚ç‡çš„ç´¯åŠ å€¼</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># å½“å‰nodeä¸€ä¸ªå€™é€‰çš„ç´¯åŠ æ¦‚ç‡å€¼</span></span><br><span class="line">            candidate_prob_sum = pre_node_prob_sum + segment_prob</span><br><span class="line"></span><br><span class="line">            pre_node_list.append((pre_node, candidate_prob_sum))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ‰¾åˆ°æœ€å¤§çš„å€™é€‰æ¦‚ç‡å€¼</span></span><br><span class="line">        (best_pre_node, best_prob_sum) = max(pre_node_list, key=<span class="keyword">lambda</span> d: d[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> (best_pre_node, best_prob_sum)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æœ€å¤§æ¦‚ç‡åˆ†è¯</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mp_seg</span><span class="params">(self, sequence)</span>:</span></span><br><span class="line">        sequence = sequence.strip()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">        node_state_list = []  <span class="comment"># è®°å½•èŠ‚ç‚¹çš„æœ€ä½³å‰é©±ï¼Œindexå°±æ˜¯ä½ç½®ä¿¡æ¯</span></span><br><span class="line">        <span class="comment"># åˆå§‹èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯0èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">        ini_state = &#123;&#125;</span><br><span class="line">        ini_state[<span class="string">"pre_node"</span>] = <span class="number">-1</span>  <span class="comment"># å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        ini_state[<span class="string">"prob_sum"</span>] = <span class="number">0</span>  <span class="comment"># å½“å‰çš„æ¦‚ç‡æ€»å’Œ</span></span><br><span class="line">        node_state_list.append(ini_state)</span><br><span class="line">        <span class="comment"># å­—ç¬¦ä¸²æ¦‚ç‡ä¸º2å…ƒæ¦‚ç‡</span></span><br><span class="line">        <span class="comment"># P(a b c) = P(a|&lt;S&gt;)P(b|a)P(c|b)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># é€ä¸ªèŠ‚ç‚¹å¯»æ‰¾æœ€ä½³å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> range(<span class="number">1</span>, len(sequence) + <span class="number">1</span>):</span><br><span class="line">            <span class="comment"># å¯»æ‰¾æœ€ä½³å‰é©±ï¼Œå¹¶è®°å½•å½“å‰æœ€å¤§çš„æ¦‚ç‡ç´¯åŠ å€¼</span></span><br><span class="line">            (best_pre_node, best_prob_sum) = self.get_best_pre_node(sequence, node, node_state_list)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ·»åŠ åˆ°é˜Ÿåˆ—</span></span><br><span class="line">            cur_node = &#123;&#125;</span><br><span class="line">            cur_node[<span class="string">"pre_node"</span>] = best_pre_node</span><br><span class="line">            cur_node[<span class="string">"prob_sum"</span>] = best_prob_sum</span><br><span class="line">            node_state_list.append(cur_node)</span><br><span class="line">            <span class="comment"># print "cur node list",node_state_list</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 2, è·å¾—æœ€ä¼˜è·¯å¾„,ä»ååˆ°å‰</span></span><br><span class="line">        best_path = []</span><br><span class="line">        node = len(sequence)  <span class="comment"># æœ€åä¸€ä¸ªç‚¹</span></span><br><span class="line">        best_path.append(node)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            pre_node = node_state_list[node][<span class="string">"pre_node"</span>]</span><br><span class="line">            <span class="keyword">if</span> pre_node == <span class="number">-1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            node = pre_node</span><br><span class="line">            best_path.append(node)</span><br><span class="line">        best_path.reverse()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 3, æ„å»ºåˆ‡åˆ†</span></span><br><span class="line">        word_list = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(best_path) - <span class="number">1</span>):</span><br><span class="line">            left = best_path[i]</span><br><span class="line">            right = best_path[i + <span class="number">1</span>]</span><br><span class="line">            word = sequence[left:right]</span><br><span class="line">            word_list.append(word)</span><br><span class="line"></span><br><span class="line">        seg_sequence = DELIMITER.join(word_list)</span><br><span class="line">        <span class="keyword">return</span> seg_sequence</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ è½½è¯å…¸ï¼Œä¸ºè¯\tè¯é¢‘çš„æ ¼å¼</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">initial_dict</span><span class="params">(self, gram1_file, gram2_file)</span>:</span></span><br><span class="line">        <span class="comment"># è¯»å–unigramæ–‡ä»¶</span></span><br><span class="line">        dict_file = open(gram1_file, <span class="string">"r"</span>)</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> dict_file:</span><br><span class="line">            sequence = line.strip()</span><br><span class="line">            key = sequence.split(<span class="string">'\t'</span>)[<span class="number">0</span>]</span><br><span class="line">            value = float(sequence.split(<span class="string">'\t'</span>)[<span class="number">1</span>])</span><br><span class="line">            self.word1_dict_count[key] = value</span><br><span class="line">        <span class="comment"># è®¡ç®—é¢‘ç‡</span></span><br><span class="line">        self.all_freq = sum(self.word1_dict_count.values())  <span class="comment"># æ‰€æœ‰è¯çš„è¯é¢‘</span></span><br><span class="line">        self.gmax_word_length = max(len(key) <span class="keyword">for</span> key <span class="keyword">in</span> self.word1_dict_count.keys())</span><br><span class="line">        self.gmax_word_length = <span class="number">20</span></span><br><span class="line">        self.all_freq = <span class="number">1024908267229.0</span></span><br><span class="line">        <span class="comment"># è®¡ç®—1gramè¯çš„æ¦‚ç‡</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> self.word1_dict_count:</span><br><span class="line">            self.word1_dict_prob[key] = math.log(self.word1_dict_count[key] / self.all_freq)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¯»å–2_gram_fileï¼ŒåŒæ—¶è®¡ç®—è½¬ç§»æ¦‚ç‡</span></span><br><span class="line">        dict_file = open(gram2_file, <span class="string">"r"</span>)</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> dict_file:</span><br><span class="line">            sequence = line.strip()</span><br><span class="line">            key = sequence.split(<span class="string">'\t'</span>)[<span class="number">0</span>]</span><br><span class="line">            value = float(sequence.split(<span class="string">'\t'</span>)[<span class="number">1</span>])</span><br><span class="line">            first_word = key.split(<span class="string">" "</span>)[<span class="number">0</span>]</span><br><span class="line">            second_word = key.split(<span class="string">" "</span>)[<span class="number">1</span>]</span><br><span class="line">            self.word2_dict_count[key] = float(value)</span><br><span class="line">            <span class="keyword">if</span> first_word <span class="keyword">in</span> self.word1_dict_count:</span><br><span class="line">                <span class="comment"># å–è‡ªç„¶å¯¹æ•°</span></span><br><span class="line">                self.word2_dict_prob[key] = math.log(value / self.word1_dict_count[first_word])  </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.word2_dict_prob[key] = self.word1_dict_prob[second_word]</span><br></pre></td></tr></table></figure>
<h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p><strong>åˆ—ä¸¾å‡ºæ‰€æœ‰å¯èƒ½çš„åˆ†è¯æ–¹å¼ï¼Œå†åˆ†åˆ«è®¡ç®—å¥å­æ¦‚ç‡ï¼Œé€‰æ‹©æ¦‚ç‡æœ€å¤§çš„ä½œä¸ºæœ€ç»ˆåˆ†è¯ç»“æœã€‚ç©·ä¸¾æ³•ï¼Œé€Ÿåº¦æ…¢ã€‚</strong></p>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>N-gramsæœ‰ä¸€äº›ä¸è¶³ï¼Œå› ä¸ºè¯­è¨€å­˜åœ¨ä¸€ä¸ªé•¿è·ç¦»ä¾èµ–å…³ç³»ï¼Œæ¯”å¦‚ï¼šâ€œThe computer which I had just put into the machine room on the fifth floor crashed.â€å‡å¦‚è¦é¢„æµ‹æœ€åä¸€ä¸ªè¯è¯­crashedå‡ºç°çš„æ¦‚ç‡ï¼Œå¦‚æœé‡‡ç”¨äºŒå…ƒæ¨¡å‹ï¼Œé‚£ä¹ˆcrashedä¸floorå®é™…å…³è”å¯èƒ½æ€§åº”è¯¥éå¸¸å°ï¼Œç›¸åçš„ï¼Œè¿™å¥å­çš„ä¸»è¯­computerä¸crashedçš„ç›¸å…³æ€§å¾ˆå¤§ï¼Œä½†æ˜¯n-gramså¹¶æ²¡æœ‰æ•æ‰åˆ°è¿™ä¸ªä¿¡æ¯ã€‚</li>
<li>ä¸€ä¸ªè¯æ˜¯ç”±å‰ä¸€ä¸ªæˆ–è€…å‡ ä¸ªè¯å†³å®šçš„ï¼Œè¿™æ ·å¯ä»¥å»é™¤ä¸€éƒ¨åˆ†æ­§ä¹‰é—®é¢˜ï¼Œä½†æ˜¯n-gramæ¨¡å‹è¿˜æ˜¯åŸºäºé©¬å°”ç§‘å¤«æ¨¡å‹çš„ï¼Œå…¶åŸºæœ¬åŸç†å°±æ˜¯æ— åæ•ˆæ€§ï¼Œå°±æ˜¯åç»­çš„èŠ‚ç‚¹çš„çŠ¶æ€ä¸å½±å“å‰é¢çš„çŠ¶æ€ï¼Œå°±æ˜¯å…ˆå‰çš„åˆ†è¯å½¢å¼ä¸€æ—¦ç¡®å®šï¼Œæ— è®ºåç»­è·Ÿçš„æ˜¯ä»€ä¹ˆè¯ï¼Œéƒ½ä¸ä¼šå†æœ‰å˜åŒ–ï¼Œè¿™åœ¨ç°å®ä¸­æ˜¾ç„¶æ˜¯ä¸æˆç«‹çš„ã€‚ã€‚å› æ­¤å°±æœ‰ä¸€äº›å¯ä»¥è€ƒè™‘åˆ°åç»­è¯çš„ç®—æ³•ï¼Œå¦‚crfç­‰æ–¹æ³•ã€‚</li>
</ol>
<h4 id="åŸºäºHMMçš„åˆ†è¯ç®—æ³•"><a href="#åŸºäºHMMçš„åˆ†è¯ç®—æ³•" class="headerlink" title="åŸºäºHMMçš„åˆ†è¯ç®—æ³•"></a>åŸºäºHMMçš„åˆ†è¯ç®—æ³•</h4><h5 id="éšé©¬å°”ç§‘å¤«æ¨¡å‹-HMM"><a href="#éšé©¬å°”ç§‘å¤«æ¨¡å‹-HMM" class="headerlink" title="éšé©¬å°”ç§‘å¤«æ¨¡å‹(HMM)"></a>éšé©¬å°”ç§‘å¤«æ¨¡å‹(HMM)</h5><p>éšé©¬å°”å¯å¤«æ¨¡å‹æ˜¯å…³äº<strong>æ—¶åº</strong>çš„æ¦‚ç‡æ¨¡å‹,æè¿°ç”±ä¸€ä¸ªéšè—çš„é©¬å°”å¯å¤«é“¾éšæœºç”Ÿæˆä¸å¯è§‚æµ‹çš„<strong>çŠ¶æ€åºåˆ—</strong>,å†ç”±å„ä¸ªçŠ¶æ€ç”Ÿæˆä¸€ä¸ªè§‚æµ‹è€Œäº§ç”Ÿ<strong>è§‚æµ‹éšæœºåºåˆ—</strong>çš„è¿‡ç¨‹.HMMæ˜¯ä¸€ç§ç”Ÿæˆå¼æ¨¡å‹ï¼Œå®ƒçš„ç†è®ºåŸºç¡€æ˜¯æœ´ç´ è´å¶æ–¯ï¼Œæœ¬è´¨ä¸Šå°±ç±»ä¼¼äºæˆ‘ä»¬å°†æœ´ç´ è´å¶æ–¯åœ¨å•æ ·æœ¬åˆ†ç±»é—®é¢˜ä¸Šçš„åº”ç”¨æ¨å¹¿åˆ°åºåˆ—æ ·æœ¬åˆ†ç±»é—®é¢˜ä¸Šã€‚</p>
<h6 id="æ¨¡å‹è¡¨ç¤º"><a href="#æ¨¡å‹è¡¨ç¤º" class="headerlink" title="æ¨¡å‹è¡¨ç¤º"></a>æ¨¡å‹è¡¨ç¤º</h6><p>è®¾Qæ˜¯æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€çš„é›†åˆ$Q=\left\{q_{1}, q_{2}, \cdots, q_{N}\right\}$,Væ˜¯æ‰€æœ‰å¯èƒ½çš„è§‚æµ‹çš„é›†åˆ$V=\left\{v_{1}, v_{2}, \cdots, v_{M}\right\}$,Iæ˜¯é•¿åº¦ä¸ºTçš„çŠ¶æ€åºåˆ—$I=\left(i_{1}, i_{2}, \cdots, i_{T}\right)$, Oæ˜¯å¯¹åº”çš„è§‚æµ‹åºåˆ—$O=\left(o_{1}, o_{2}, \cdots, o_{T}\right)$,</p>
<ol>
<li>Aæ˜¯<strong>çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µ</strong>$A=\left[a_{i j}\right]_{N \times N}$,$a_{ij}$è¡¨ç¤ºåœ¨æ—¶åˆ»tå¤„äºçŠ¶æ€$q_i$çš„æ¡ä»¶ä¸‹åœ¨æ—¶åˆ»t+1è½¬ç§»åˆ°çŠ¶æ€$q_j$çš„æ¦‚ç‡.</li>
<li>Bæ˜¯<strong>è§‚æµ‹æ¦‚ç‡çŸ©é˜µ</strong> $B=\left[b_{j}(k)\right]_{N \times M}$,$b_{ij}$æ˜¯åœ¨æ—¶åˆ»tå¤„äºçŠ¶æ€$q_j$çš„æ¡ä»¶ä¸‹ç”Ÿæˆè§‚æµ‹$v_k$çš„æ¦‚ç‡.</li>
<li>$\pi$æ˜¯<strong>åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡</strong>$\pi=\pi(x)$,$\pi_i$è¡¨ç¤ºæ—¶åˆ»t=1å¤„äºçŠ¶æ€qiçš„æ¦‚ç‡.</li>
</ol>
<p>éšé©¬å°”å¯å¤«æ¨¡å‹ç”±åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡$pi$,çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µAä»¥åŠè§‚æµ‹æ¦‚ç‡çŸ©é˜µBç¡®å®š.$\pi$å’ŒAå†³å®šå³éšè—çš„<strong>é©¬å°”å¯å¤«é“¾</strong>,ç”Ÿæˆä¸å¯è§‚æµ‹çš„<strong>çŠ¶æ€åºåˆ—</strong>.Bå†³å®šå¦‚ä½•ä»çŠ¶æ€ç”Ÿæˆè§‚æµ‹,ä¸çŠ¶æ€åºåˆ—ç»¼åˆç¡®å®šäº†<strong>è§‚æµ‹åºåˆ—</strong>.å› æ­¤,éšé©¬å°”å¯å¤«æ¨¡å‹å¯ä»¥ç”¨<strong>ä¸‰å…ƒç¬¦å·</strong>è¡¨ç¤º$\lambda = (A,B,\pi)$</p>
<h6 id="ä¸¤ä¸ªåŸºæœ¬å‡è®¾"><a href="#ä¸¤ä¸ªåŸºæœ¬å‡è®¾" class="headerlink" title="ä¸¤ä¸ªåŸºæœ¬å‡è®¾"></a>ä¸¤ä¸ªåŸºæœ¬å‡è®¾</h6><ol>
<li><strong>é½æ¬¡é©¬å°”å¯å¤«æ€§å‡è®¾</strong>:å‡è®¾éšè—çš„é©¬å°”å¯å¤«é“¾åœ¨ä»»æ„æ—¶åˆ»tçš„çŠ¶æ€åªä¾èµ–äºå…¶å‰ä¸€æ—¶åˆ»çš„çŠ¶æ€.</li>
<li><strong>è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾</strong>:å‡è®¾ä»»æ„æ—¶åˆ»çš„è§‚æµ‹åªä¾èµ–äºè¯¥æ—¶åˆ»çš„é©¬å°”å¯å¤«é“¾çš„çŠ¶æ€.</li>
</ol>
<h6 id="ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"><a href="#ä¸‰ä¸ªåŸºæœ¬é—®é¢˜" class="headerlink" title="ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"></a>ä¸‰ä¸ªåŸºæœ¬é—®é¢˜</h6><p><strong>1. æ¦‚ç‡è®¡ç®—é—®é¢˜</strong></p>
<p>ç»™å®šæ¨¡å‹$\lambda = (A,B,\pi)$å’Œè§‚æµ‹åºåˆ—,$O=\left(o_{1}, o_{2}, \cdots, o_{T}\right)$è®¡ç®—åœ¨æ¨¡å‹$\lambda$ä¸‹è§‚æµ‹åºåˆ—Oå‡ºç°çš„æ¦‚ç‡$P(O|Î»)$.</p>
<ol>
<li>ç›´æ¥è®¡ç®—ï¼šåˆ—ä¸¾æ‰€æœ‰å¯èƒ½é•¿åº¦ä¸ºTçš„çŠ¶æ€åºåˆ—,æ±‚å„ä¸ªçŠ¶æ€åºåˆ—Iä¸è§‚æµ‹åºåˆ—Oçš„è”åˆæ¦‚ç‡,ä½†è®¡ç®—é‡å¤ªå¤§,å®é™…æ“ä½œä¸å¯è¡Œ.</li>
<li><strong>å‰å‘ç®—æ³•</strong>ï¼šå®šä¹‰åˆ°æ—¶åˆ»téƒ¨åˆ†è§‚æµ‹åºåˆ—ä¸º$o_1$~$o_t$ä¸”çŠ¶æ€ä¸º$q_i$çš„æ¦‚ç‡ä¸º<strong>å‰å‘æ¦‚ç‡</strong>,è®°ä½œ$\alpha_{t}(i)=P\left(o_{1}, o_{2}, \cdots, o_{t}, i_{t}=q_{i} | \lambda\right)$.åˆå§‹åŒ–å‰å‘æ¦‚ç‡$\alpha_{1}(i)=\pi_{i} b_{i}\left(o_{1}\right), \quad i=1,2, \cdots, N$ï¼Œé€’æ¨ï¼Œå¯¹$t=1$ ~ $T-1$,$\alpha_{t+1}(i)=\left[\sum_{j=1}^{N} \alpha_{t}(j) a_{j i}\right] b_{i}\left(o_{t+1}\right), \quad i=1,2, \cdots, N$,å¾—åˆ°$P(O | \lambda)=\sum_{i=1}^{N} \alpha_{T}(i)$å‡å°‘è®¡ç®—é‡çš„åŸå› åœ¨äºæ¯ä¸€æ¬¡è®¡ç®—ç›´æ¥å¼•ç”¨å‰ä¸€ä¸ªæ—¶åˆ»çš„è®¡ç®—ç»“æœ,é¿å…é‡å¤è®¡ç®—.</li>
<li><strong>åå‘ç®—æ³•</strong>:å®šä¹‰åœ¨æ—¶åˆ»tçŠ¶æ€ä¸º$q_i$çš„æ¡ä»¶ä¸‹,ä»t+1åˆ°Tçš„éƒ¨åˆ†è§‚æµ‹åºåˆ—ä¸º$o_{i+1}$~$o_T$çš„æ¦‚ç‡ä¸º<strong>åå‘æ¦‚ç‡</strong>,è®°ä½œ$\beta_{t}(i)=P\left(o_{t+1}, o_{t+2}, \cdots, o_{r} | i_{t}=q_{i}, \lambda\right)$.åˆå§‹åŒ–åå‘æ¦‚ç‡$\beta_{r}(i)=1, \quad i=1,2, \cdots, N$,é€’æ¨,å¯¹$t=T-1$~$1$$\beta_{t}(i)=\sum_{j=1}^{N} a_{i j} b_{j}\left(o_{i+1}\right) \beta_{i+1}(j), \quad i=1,2, \cdots, N$,å¾—åˆ°$P(O | \lambda)=\sum_{i=1}^{N} \pi_{i} b_{i}\left(o_{1}\right) \beta_{1}(i)$</li>
</ol>
<p><strong>2. å­¦ä¹ ç®—æ³•</strong></p>
<p>å·²çŸ¥è§‚æµ‹åºåˆ—$O=(o_1,o_2, \cdots,o_r)$,ä¼°è®¡æ¨¡å‹$\lambda = (A,B,\pi)$,çš„å‚æ•°,ä½¿å¾—åœ¨è¯¥æ¨¡å‹ä¸‹è§‚æµ‹åºåˆ—æ¦‚ç‡$p(O|\lambda)$æœ€å¤§.æ ¹æ®è®­ç»ƒæ•°æ®æ˜¯å¦åŒ…æ‹¬è§‚å¯Ÿåºåˆ—å¯¹åº”çš„çŠ¶æ€åºåˆ—åˆ†åˆ«ç”±ç›‘ç£å­¦ä¹ ä¸éç›‘ç£å­¦ä¹ å®ç°.</p>
<ol>
<li><p>ç›‘ç£å­¦ä¹ ï¼šä¼°è®¡è½¬ç§»æ¦‚ç‡$\hat{a}_{i j}=\frac{A_{i j}}{\sum_{j=1}^{N} A_{i j}}, \quad i=1,2, \cdots, N ; \quad j=1,2, \cdots, N$ å’Œè§‚æµ‹æ¦‚ç‡$\hat{b}_{j}(k)=\frac{B_{j k}}{\sum_{k=1}^{M} B_{j k}}, \quad j=1,2, \cdots, N, k=1,2, \cdots, M$.åˆå§‹çŠ¶æ€æ¦‚ç‡$\pi_i$çš„ä¼°è®¡ä¸ºSä¸ªæ ·æœ¬ä¸­åˆå§‹çŠ¶æ€ä¸º$q_i$çš„é¢‘ç‡.</p>
</li>
<li><p><strong>éç›‘ç£å­¦ä¹ (Baum-Welchç®—æ³•)</strong>:å°†è§‚æµ‹åºåˆ—æ•°æ®çœ‹ä½œè§‚æµ‹æ•°æ®O,çŠ¶æ€åºåˆ—æ•°æ®çœ‹ä½œä¸å¯è§‚æµ‹çš„<strong>éšæ•°æ®</strong>I.é¦–å…ˆç¡®å®šå®Œå…¨æ•°æ®çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°$log p(O,I|\lambda)$,æ±‚Qå‡½æ•°</p>
</li>
</ol>
<script type="math/tex; mode=display">
   \begin{aligned}
   Q(\lambda, \bar{\lambda})=& \sum_{t} \log \pi_{i_1} P(O, I | \bar{\lambda}) \\
   &+\sum_{I}\left(\sum_{i=1}^{I-1} \log a_{i_t,i_{t+1}}\right) P(O, I | \bar{\lambda}) \\
   &+\sum_{I}\left(\sum_{i=1}^{T} \log b_{i_t}\left(o_{t}\right)\right) P(O, I | \bar{\lambda})
   \end{aligned}</script><p>   ,ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•æå¤§åŒ–Qå‡½æ•°æ±‚æ¨¡å‹å‚æ•°$\pi_{i}=\frac{P\left(O, i_{1}=i | \bar{\lambda}\right)}{P(O | \bar{\lambda})}$,$a_{i j}=\frac{\sum_{i=1}^{T-1} P\left(O, i_{t}=i, i_{t+1}=j | \bar{\lambda}\right)}{\sum_{t=1}^{T-1} P\left(O, i_{t}=i | \bar{\lambda}\right)}$,$b_{j}(k)=\frac{\sum_{i=1}^{T} P\left(O, i_{t}=j | \bar{\lambda}\right) I\left(o_{i}=v_{k}\right)}{\sum_{i=1}^{T} P\left(O, i_{t}=j | \bar{\lambda}\right)}$,</p>
<p><strong>3. é¢„æµ‹é—®é¢˜</strong></p>
<p>ä¹Ÿç§°ä¸ºè§£ç é—®é¢˜.å·²çŸ¥æ¨¡å‹$\lambda = (A,B,\pi)$å’Œè§‚æµ‹åºåˆ—$O=(O_1,O_2,\cdots,O_T)$,æ±‚å¯¹ç»™å®šè§‚æµ‹åºåˆ—æ¡ä»¶æ¦‚ç‡$P(I|O)$æœ€å¤§çš„çŠ¶æ€åºåˆ—$I=(i_1,i_2,\cdots,i_T)$</p>
<ol>
<li><p><strong>è¿‘ä¼¼ç®—æ³•</strong>: åœ¨æ¯ä¸ªæ—¶åˆ»té€‰æ‹©åœ¨è¯¥æ—¶åˆ»æœ€æœ‰å¯èƒ½å‡ºç°çš„çŠ¶æ€$i_t^<em>$,ä»è€Œå¾—åˆ°ä¸€ä¸ªçŠ¶æ€åºåˆ—ä½œä¸ºé¢„æµ‹çš„ç»“æœ.ä¼˜ç‚¹æ˜¯<em>*è®¡ç®—ç®€å•</em></em>,ç¼ºç‚¹æ˜¯ä¸èƒ½ä¿è¯çŠ¶æ€åºåˆ—æ•´ä½“æ˜¯æœ€æœ‰å¯èƒ½çš„çŠ¶æ€åºåˆ—</p>
</li>
<li><p><strong>ç»´ç‰¹æ¯”ç®—æ³•</strong>:ç”¨<strong>åŠ¨æ€è§„åˆ’</strong>æ±‚æ¦‚ç‡æœ€å¤§è·¯å¾„,è¿™ä¸€æ¡è·¯å¾„å¯¹åº”ç€ä¸€ä¸ªçŠ¶æ€åºåˆ—.ä»t=1å¼€å§‹,é€’æ¨åœ°è®¡ç®—åœ¨æ—¶åˆ»tçŠ¶æ€ä¸ºiçš„å„æ¡éƒ¨åˆ†è·¯å¾„çš„æœ€å¤§æ¦‚ç‡,ç›´è‡³å¾—åˆ°æ—¶åˆ»t=TçŠ¶æ€ä¸ºiçš„å„æ¡è·¯å¾„çš„æœ€å¤§æ¦‚ç‡.æ—¶åˆ»t=Tçš„æœ€å¤§æ¦‚ç‡å³ä¸º<strong>æœ€ä¼˜è·¯å¾„</strong>çš„æ¦‚ç‡$P^\star$,æœ€ä¼˜è·¯å¾„çš„<strong>ç»ˆç»“ç‚¹</strong>$i_t^\star$ä¹ŸåŒæ—¶å¾—åˆ°,ä¹‹åä»ç»ˆç»“ç‚¹å¼€å§‹ç”±åå‘å‰é€æ­¥æ±‚å¾—<strong>ç»“ç‚¹</strong>,å¾—åˆ°æœ€ä¼˜è·¯å¾„.</p>
</li>
</ol>
<h5 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h5><p>åœ¨åˆ†è¯ç®—æ³•ä¸­ï¼Œåˆ†è¯å¯¹åº”ç€ä¸‰å¤§é—®é¢˜ä¸­çš„é¢„æµ‹é—®é¢˜ï¼ˆè§£ç é—®é¢˜ï¼‰ï¼Œéšé©¬å°”å¯å¤«ç»å¸¸ç”¨ä½œèƒ½å¤Ÿå‘ç°æ–°è¯çš„ç®—æ³•ï¼Œé€šè¿‡æµ·é‡çš„æ•°æ®å­¦ä¹ ï¼Œèƒ½å¤Ÿå°†äººåã€åœ°åã€äº’è”ç½‘ä¸Šçš„æ–°è¯ç­‰ä¸€ä¸€è¯†åˆ«å‡ºæ¥ï¼Œå…·æœ‰å¹¿æ³›çš„åº”ç”¨åœºæ™¯ã€‚</p>
<p>å…¶åˆ†è¯è¿‡ç¨‹:</p>
<p><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/hmm_seg.png" alt="avatar"></p>
<h5 id="ä»£ç -4"><a href="#ä»£ç -4" class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><p>æ•°æ®å‡†å¤‡ï¼šåˆ†å¥½è¯çš„è¯åº“</p>
<p>step 1:é€šè¿‡ç»Ÿè®¡è¯­æ–™åº“ä¸­è¯çš„é¢‘æ¬¡ï¼Œè®¡ç®—ä¸‰ä¸ªæ¦‚ç‡ï¼šåˆå§‹çŠ¶æ€æ¦‚ç‡startï¼ŒçŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µtransï¼Œå‘å°„æ¦‚ç‡emitã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HmmTrain</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.line_index = <span class="number">-1</span></span><br><span class="line">        self.char_set = set()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">(self)</span>:</span>  <span class="comment"># åˆå§‹åŒ–å­—å…¸</span></span><br><span class="line">        trans_dict = &#123;&#125;  <span class="comment"># å­˜å‚¨çŠ¶æ€è½¬ç§»æ¦‚ç‡</span></span><br><span class="line">        emit_dict = &#123;&#125;  <span class="comment"># å‘å°„æ¦‚ç‡(çŠ¶æ€-&gt;è¯è¯­çš„æ¡ä»¶æ¦‚ç‡)</span></span><br><span class="line">        Count_dict = &#123;&#125;  <span class="comment"># å­˜å‚¨æ‰€æœ‰çŠ¶æ€åºåˆ— ï¼Œç”¨äºå½’ä¸€åŒ–åˆ†æ¯</span></span><br><span class="line">        start_dict = &#123;&#125;  <span class="comment"># å­˜å‚¨çŠ¶æ€çš„åˆå§‹æ¦‚ç‡</span></span><br><span class="line">        state_list = [<span class="string">'B'</span>, <span class="string">'M'</span>, <span class="string">'E'</span>, <span class="string">'S'</span>]  <span class="comment"># çŠ¶æ€åºåˆ—</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> state <span class="keyword">in</span> state_list:</span><br><span class="line">            trans_dict[state] = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> state1 <span class="keyword">in</span> state_list:</span><br><span class="line">                trans_dict[state][state1] = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> state <span class="keyword">in</span> state_list:</span><br><span class="line">            start_dict[state] = <span class="number">0.0</span></span><br><span class="line">            emit_dict[state] = &#123;&#125;</span><br><span class="line">            Count_dict[state] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(trans_dict) #&#123;'B': &#123;'B': 0.0, 'S': 0.0, 'M': 0.0, 'E': 0.0&#125;, 'S': &#123;'B': 0.0, 'S': 0.0, 'M': 0.0, 'E': 0.0&#125;,ã€‚ã€‚ã€‚&#125;</span></span><br><span class="line">        <span class="comment"># print(emit_dict) # &#123;'B': &#123;&#125;, 'S': &#123;&#125;, 'M': &#123;&#125;, 'E': &#123;&#125;&#125;</span></span><br><span class="line">        <span class="comment"># print(start_dict) # &#123;'B': 0.0, 'S': 0.0, 'M': 0.0, 'E': 0.0&#125;</span></span><br><span class="line">        <span class="comment"># print(Count_dict) # &#123;'B': 0, 'S': 0, 'M': 0, 'E': 0&#125;</span></span><br><span class="line">        <span class="keyword">return</span> trans_dict, emit_dict, start_dict, Count_dict</span><br><span class="line"></span><br><span class="line">    <span class="string">'''ä¿å­˜æ¨¡å‹'''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save_model</span><span class="params">(self, word_dict, model_path)</span>:</span></span><br><span class="line">        f = open(model_path, <span class="string">'w'</span>)</span><br><span class="line">        f.write(str(word_dict))</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="string">'''è¯è¯­çŠ¶æ€è½¬æ¢'''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_word_status</span><span class="params">(self, word)</span>:</span>  <span class="comment"># æ ¹æ®è¯è¯­ï¼Œè¾“å‡ºè¯è¯­å¯¹åº”çš„SBMEçŠ¶æ€</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        S:å•å­—è¯</span></span><br><span class="line"><span class="string">        B:è¯çš„å¼€å¤´</span></span><br><span class="line"><span class="string">        M:è¯çš„ä¸­é—´</span></span><br><span class="line"><span class="string">        E:è¯çš„æœ«å°¾</span></span><br><span class="line"><span class="string">        èƒ½ ['S']</span></span><br><span class="line"><span class="string">        å‰å¾€ ['B', 'E']</span></span><br><span class="line"><span class="string">        ç§‘å¨ç‰¹ ['B', 'M', 'E']</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        word_status = []</span><br><span class="line">        <span class="keyword">if</span> len(word) == <span class="number">1</span>:</span><br><span class="line">            word_status.append(<span class="string">'S'</span>)</span><br><span class="line">        <span class="keyword">elif</span> len(word) == <span class="number">2</span>:</span><br><span class="line">            word_status = [<span class="string">'B'</span>, <span class="string">'E'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            M_num = len(word) - <span class="number">2</span></span><br><span class="line">            M_list = [<span class="string">'M'</span>] * M_num</span><br><span class="line">            word_status.append(<span class="string">'B'</span>)</span><br><span class="line">            word_status.extend(M_list)</span><br><span class="line">            word_status.append(<span class="string">'E'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> word_status</span><br><span class="line"></span><br><span class="line">    <span class="string">'''åŸºäºäººå·¥æ ‡æ³¨è¯­æ–™åº“ï¼Œè®­ç»ƒå‘å°„æ¦‚ç‡ï¼Œåˆå§‹çŠ¶æ€ï¼Œ è½¬ç§»æ¦‚ç‡'''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, train_filepath, trans_path, emit_path, start_path)</span>:</span></span><br><span class="line">        trans_dict, emit_dict, start_dict, Count_dict = self.init()</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> open(train_filepath):</span><br><span class="line">            self.line_index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            line = line.strip()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            char_list = []</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(line)):</span><br><span class="line">                <span class="keyword">if</span> line[i] == <span class="string">" "</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                char_list.append(line[i])</span><br><span class="line"></span><br><span class="line">            self.char_set = set(char_list)  <span class="comment"># è®­ç»ƒé¢„æ–™åº“ä¸­æ‰€æœ‰å­—çš„é›†åˆ</span></span><br><span class="line"></span><br><span class="line">            word_list = line.split(<span class="string">" "</span>)</span><br><span class="line">            line_status = []  <span class="comment"># ç»Ÿè®¡çŠ¶æ€åºåˆ—</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> word <span class="keyword">in</span> word_list:</span><br><span class="line">                line_status.extend(self.get_word_status(word))  <span class="comment"># ä¸€å¥è¯å¯¹åº”ä¸€è¡Œè¿ç»­çš„çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> len(char_list) == len(line_status):</span><br><span class="line">                <span class="comment"># print(word_list) # ['ä½†', 'ä»', 'ç”Ÿç‰©å­¦', 'çœ¼å…‰', 'çœ‹', 'å°±', 'å¹¶é', 'å¦‚æ­¤', 'äº†', 'ã€‚']</span></span><br><span class="line">                <span class="comment"># print(line_status) # ['S', 'S', 'B', 'M', 'E', 'B', 'E', 'S', 'S', 'B', 'E', 'B', 'E', 'S', 'S']</span></span><br><span class="line">                <span class="comment"># print('******')</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(len(line_status)):</span><br><span class="line">                    <span class="keyword">if</span> i == <span class="number">0</span>:  <span class="comment"># å¦‚æœåªæœ‰ä¸€ä¸ªè¯ï¼Œåˆ™ç›´æ¥ç®—ä½œæ˜¯åˆå§‹æ¦‚ç‡</span></span><br><span class="line">                        start_dict[line_status[<span class="number">0</span>]] += <span class="number">1</span>  <span class="comment"># start_dictè®°å½•å¥å­ç¬¬ä¸€ä¸ªå­—çš„çŠ¶æ€ï¼Œç”¨äºè®¡ç®—åˆå§‹çŠ¶æ€æ¦‚ç‡</span></span><br><span class="line">                        Count_dict[line_status[<span class="number">0</span>]] += <span class="number">1</span>  <span class="comment"># è®°å½•æ¯ä¸€ä¸ªçŠ¶æ€çš„å‡ºç°æ¬¡æ•°</span></span><br><span class="line">                    <span class="keyword">else</span>:  <span class="comment"># ç»Ÿè®¡ä¸Šä¸€ä¸ªçŠ¶æ€åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œä¸¤ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬ç§»æ¦‚ç‡</span></span><br><span class="line">                        trans_dict[line_status[i - <span class="number">1</span>]][line_status[i]] += <span class="number">1</span>  <span class="comment"># ç”¨äºè®¡ç®—è½¬ç§»æ¦‚ç‡</span></span><br><span class="line">                        Count_dict[line_status[i]] += <span class="number">1</span></span><br><span class="line">                        <span class="comment"># ç»Ÿè®¡å‘å°„æ¦‚ç‡</span></span><br><span class="line">                        <span class="keyword">if</span> char_list[i] <span class="keyword">not</span> <span class="keyword">in</span> emit_dict[line_status[i]]:</span><br><span class="line">                            emit_dict[line_status[i]][char_list[i]] = <span class="number">0.0</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            emit_dict[line_status[i]][char_list[i]] += <span class="number">1</span>  <span class="comment"># ç”¨äºè®¡ç®—å‘å°„æ¦‚ç‡</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(emit_dict)#&#123;'S': &#123;'å¦': 10.0, 'æ˜”': 25.0, 'ç›´': 238.0, 'å…­': 1004.0, 'æ®–': 17.0, 'ä»—': 36.0, 'æŒª': 15.0, 'æœ—': 151.0</span></span><br><span class="line">        <span class="comment"># print(trans_dict)#&#123;'S': &#123;'S': 747969.0, 'E': 0.0, 'M': 0.0, 'B': 563988.0&#125;, 'E': &#123;'S': 737404.0, 'E': 0.0, 'M': 0.0, 'B': 651128.0&#125;,</span></span><br><span class="line">        <span class="comment"># print(start_dict) #&#123;'S': 124543.0, 'E': 0.0, 'M': 0.0, 'B': 173416.0&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿›è¡Œå½’ä¸€åŒ–</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> start_dict:  <span class="comment"># çŠ¶æ€çš„åˆå§‹æ¦‚ç‡</span></span><br><span class="line">            start_dict[key] = start_dict[key] * <span class="number">1.0</span> / self.line_index</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> trans_dict:  <span class="comment"># çŠ¶æ€è½¬ç§»æ¦‚ç‡</span></span><br><span class="line">            <span class="keyword">for</span> key1 <span class="keyword">in</span> trans_dict[key]:</span><br><span class="line">                trans_dict[key][key1] = trans_dict[key][key1] / Count_dict[key]</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> emit_dict:  <span class="comment"># å‘å°„æ¦‚ç‡(çŠ¶æ€-&gt;è¯è¯­çš„æ¡ä»¶æ¦‚ç‡)</span></span><br><span class="line">            <span class="keyword">for</span> word <span class="keyword">in</span> emit_dict[key]:</span><br><span class="line">                emit_dict[key][word] = emit_dict[key][word] / Count_dict[key]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(emit_dict)#&#123;'S': &#123;'å¦': 6.211504202703743e-06, 'æ˜”': 1.5528760506759358e-05, 'ç›´': 0.0001478338000243491,</span></span><br><span class="line">        <span class="comment"># print(trans_dict)#&#123;'S': &#123;'S': 0.46460125869921165, 'E': 0.0, 'M': 0.0, 'B': 0.3503213832274479&#125;,</span></span><br><span class="line">        <span class="comment"># print(start_dict)#&#123;'S': 0.41798844132394497, 'E': 0.0, 'M': 0.0, 'B': 0.5820149148537713&#125;</span></span><br><span class="line">        self.save_model(trans_dict, trans_path)</span><br><span class="line">        self.save_model(emit_dict, emit_path)</span><br><span class="line">        self.save_model(start_dict, start_path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> trans_dict, emit_dict, start_dict</span><br></pre></td></tr></table></figure>
<p>Step 2: ä½¿ç”¨ç»´ç‰¹æ¯”ç®—æ³•ï¼Œæ±‚è§£æ¦‚ç‡æœ€å¤§è·¯å¾„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HmmCut</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,start_model_path,trans_model_path,emit_model_path)</span>:</span></span><br><span class="line">        self.prob_trans = self.load_model(trans_model_path)</span><br><span class="line">        self.prob_emit = self.load_model(emit_model_path)</span><br><span class="line">        self.prob_start = self.load_model(start_model_path)</span><br><span class="line"></span><br><span class="line">    <span class="string">'''åŠ è½½æ¨¡å‹'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load_model</span><span class="params">(self, model_path)</span>:</span></span><br><span class="line">        f = open(model_path, <span class="string">'r'</span>)</span><br><span class="line">        a = f.read()</span><br><span class="line">        word_dict = eval(a)</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">return</span> word_dict</span><br><span class="line"></span><br><span class="line">    <span class="string">'''verterbiç®—æ³•æ±‚è§£'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">viterbi</span><span class="params">(self, obs, states, start_p, trans_p, emit_p)</span>:</span>  <span class="comment"># ç»´ç‰¹æ¯”ç®—æ³•ï¼ˆä¸€ç§é€’å½’ç®—æ³•ï¼‰</span></span><br><span class="line">        <span class="comment"># ç®—æ³•çš„å±€é™åœ¨äºè®­ç»ƒè¯­æ–™è¦è¶³å¤Ÿå¤§ï¼Œéœ€è¦ç»™æ¯ä¸ªè¯ä¸€ä¸ªå‘å°„æ¦‚ç‡,.get(obs[0], 0)çš„ç”¨æ³•æ˜¯å¦‚æœdictä¸­ä¸å­˜åœ¨è¿™ä¸ªkey,åˆ™è¿”å›0å€¼</span></span><br><span class="line">        V = [&#123;&#125;]</span><br><span class="line">        path = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">            V[<span class="number">0</span>][y] = start_p[y] * emit_p[y].get(obs[<span class="number">0</span>], <span class="number">0</span>)  <span class="comment"># åœ¨ä½ç½®0ï¼Œä»¥yçŠ¶æ€ä¸ºæœ«å°¾çš„çŠ¶æ€åºåˆ—çš„æœ€å¤§æ¦‚ç‡</span></span><br><span class="line">            path[y] = [y]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">1</span>, len(obs)):</span><br><span class="line">            V.append(&#123;&#125;)</span><br><span class="line">            newpath = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">                state_path = ([(V[t - <span class="number">1</span>][y0] * trans_p[y0].get(y, <span class="number">0</span>) * emit_p[y].get(obs[t], <span class="number">0</span>), y0) <span class="keyword">for</span> y0 <span class="keyword">in</span> states <span class="keyword">if</span> V[t - <span class="number">1</span>][y0] &gt; <span class="number">0</span>])</span><br><span class="line">                <span class="keyword">if</span> state_path == []:</span><br><span class="line">                    (prob, state) = (<span class="number">0.0</span>, <span class="string">'S'</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    (prob, state) = max(state_path)</span><br><span class="line">                V[t][y] = prob</span><br><span class="line">                newpath[y] = path[state] + [y]</span><br><span class="line"></span><br><span class="line">            path = newpath  <span class="comment"># è®°å½•çŠ¶æ€åºåˆ—</span></span><br><span class="line">        (prob, state) = max([(V[len(obs) - <span class="number">1</span>][y], y) <span class="keyword">for</span> y <span class="keyword">in</span> states])  <span class="comment"># åœ¨æœ€åä¸€ä¸ªä½ç½®ï¼Œä»¥yçŠ¶æ€ä¸ºæœ«å°¾çš„çŠ¶æ€åºåˆ—çš„æœ€å¤§æ¦‚ç‡</span></span><br><span class="line">        <span class="keyword">return</span> (prob, path[state])  <span class="comment"># è¿”å›æ¦‚ç‡å’ŒçŠ¶æ€åºåˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ†è¯ä¸»æ§å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cut</span><span class="params">(self, sent)</span>:</span></span><br><span class="line">        prob, pos_list = self.viterbi(sent, (<span class="string">'B'</span>, <span class="string">'M'</span>, <span class="string">'E'</span>, <span class="string">'S'</span>), self.prob_start, self.prob_trans, self.prob_emit)</span><br><span class="line">        seglist = list()</span><br><span class="line">        word = list()</span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> range(len(pos_list)):</span><br><span class="line">            <span class="keyword">if</span> pos_list[index] == <span class="string">'S'</span>:</span><br><span class="line">                word.append(sent[index])</span><br><span class="line">                seglist.append(word)</span><br><span class="line">                word = []</span><br><span class="line">            <span class="keyword">elif</span> pos_list[index] <span class="keyword">in</span> [<span class="string">'B'</span>, <span class="string">'M'</span>]:</span><br><span class="line">                word.append(sent[index])</span><br><span class="line">            <span class="keyword">elif</span> pos_list[index] == <span class="string">'E'</span>:</span><br><span class="line">                word.append(sent[index])</span><br><span class="line">                seglist.append(word)</span><br><span class="line">                word = []</span><br><span class="line">        seglist = [<span class="string">''</span>.join(tmp) <span class="keyword">for</span> tmp <span class="keyword">in</span> seglist]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> seglist</span><br></pre></td></tr></table></figure>
<p>å¦‚æœç”»å‡ºçŠ¶æ€è½¬ç§»å›¾åƒï¼Œå‘ç°çŠ¶æ€åªèƒ½åœ¨å±‚é—´ç‚¹è½¬ç§»ï¼Œè½¬ç§»è·¯å¾„ä¸Šçš„åˆ†æ•°ä¸ºæ¦‚ç‡ï¼Œæ±‚ä¸€æ¡æ¦‚ç‡æœ€å¤§çš„è·¯å¾„ã€‚è¿™å¯ä»¥ç”¨ç»´ç‰¹æ¯”ç®—æ³•è®¡ç®—ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªåŠ¨æ€è§„åˆ’</p>
<p><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/hmm_viterbi.png" alt="avatar"></p>
<h5 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p><strong>ä»ä¸‰æ–¹é¢æ¯”è¾ƒHMMå’ŒN-gramã€‚</strong></p>
<ol>
<li>HMMæ¨¡å‹æ˜¯ä¸€ä¸ªç”Ÿæˆæ¨¡å‹ï¼ŒåŒºåˆ«äºN-gramè¯­è¨€æ¨¡å‹ï¼ŒHMMæ²¡æœ‰ç›´æ¥å¯¹ç»™å®šè§‚æµ‹å€¼åçŠ¶æ€çš„åˆ†å¸ƒ $P(S|O)$ï¼ˆ<em>O</em> ä»£è¡¨è§‚æµ‹åºåˆ—ï¼‰è¿›è¡Œå»ºæ¨¡ï¼Œè€Œæ˜¯å¯¹çŠ¶æ€åºåˆ—æœ¬èº«çš„åˆ†å¸ƒ$P(S)$å’Œç»™å®šçŠ¶æ€åè§‚æµ‹å€¼çš„åˆ†å¸ƒ $p(O|S)$å»ºæ¨¡ ï¼›</li>
<li>å­¦ä¹ è¿‡ç¨‹ä¸N-gramç›¸åŒï¼ŒHMMåœ¨æœ‰ç›‘ç£å­¦ä¹ çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡å‚æ•°ï¼›</li>
<li>é¢„æµ‹æ—¶ï¼ŒHMMé‡‡ç”¨ç»´ç‰¹æ¯”ç®—æ³•ã€‚</li>
</ol>
<h4 id="CRFåˆ†è¯"><a href="#CRFåˆ†è¯" class="headerlink" title="CRFåˆ†è¯"></a>CRFåˆ†è¯</h4><h5 id="æ¡ä»¶éšæœºåœºCRF"><a href="#æ¡ä»¶éšæœºåœºCRF" class="headerlink" title="æ¡ä»¶éšæœºåœºCRF"></a>æ¡ä»¶éšæœºåœºCRF</h5><p>æ¡ä»¶éšæœºåœºåŸºäºæ¦‚ç‡æ— å‘å›¾æ¨¡å‹ï¼Œåˆ©ç”¨æœ€å¤§å›¢ç†è®ºï¼Œå¯¹éšæœºå˜é‡çš„è”åˆåˆ†å¸ƒ$P(Y)$è¿›è¡Œå»ºæ¨¡ã€‚</p>
<p>åœ¨åºåˆ—æ ‡æ³¨ä»»åŠ¡ä¸­çš„æ¡ä»¶éšæœºåœºï¼Œå¾€å¾€æ˜¯æŒ‡<strong>çº¿æ€§é“¾æ¡ä»¶éšæœºåœº</strong>ï¼Œè¿™æ—¶ï¼Œåœ¨æ¡ä»¶æ¦‚ç‡æ¨¡å‹$P(Y|X)$ä¸­ï¼Œ$Y$æ˜¯è¾“å‡ºå˜é‡ï¼Œè¡¨ç¤ºæ ‡è®°åºåˆ—ï¼ˆæˆ–çŠ¶æ€åºåˆ—ï¼‰ï¼Œ$X$æ˜¯è¾“å…¥å˜é‡ï¼Œè¡¨ç¤ºéœ€è¦æ ‡æ³¨çš„è§‚æµ‹åºåˆ—ã€‚å­¦ä¹ æ—¶ï¼Œåˆ©ç”¨è®­ç»ƒæ•°æ®é›†é€šè¿‡æå¤§ä¼¼ç„¶ä¼°è®¡æˆ–æ­£åˆ™åŒ–çš„æå¤§ä¼¼ç„¶ä¼°è®¡å¾—åˆ°æ¡ä»¶æ¦‚ç‡æ¨¡å‹$p(Y|X)$ï¼›é¢„æµ‹æ—¶ï¼Œå¯¹äºç»™å®šçš„è¾“å…¥åºåˆ—xï¼Œæ±‚å‡ºæ¡ä»¶æ¦‚ç‡$p(y|x)$æœ€å¤§çš„è¾“å‡ºåºåˆ—y.</p>
<h6 id="æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼"><a href="#æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼" class="headerlink" title="æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼"></a>æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼</h6><script type="math/tex; mode=display">
P(y|x)=\frac{1}{Z(x)} \exp \left(\sum_{i, k} \lambda_{k} t_{k}\left(y_{i-1}, y_{i}, x, i\right)+\sum_{i, j} \mu_{l} s_{l}\left(y_{i}, x, i\right)\right) 
\\
Z(x)=\sum_{y} \exp \left(\sum_{i, k} \lambda_{k} t_{k}\left(y_{i-1}, y_{i}, x, i\right)+\sum_{i, j} \mu_{l} s_{l}\left(y_{i}, x, i\right)\right)</script><h5 id="æ¡ä»¶éšæœºåœºåˆ†è¯æ–¹æ³•"><a href="#æ¡ä»¶éšæœºåœºåˆ†è¯æ–¹æ³•" class="headerlink" title="æ¡ä»¶éšæœºåœºåˆ†è¯æ–¹æ³•"></a>æ¡ä»¶éšæœºåœºåˆ†è¯æ–¹æ³•</h5><p>æ¡ä»¶éšæœºåœºå’Œéšé©¬å°”å¯å¤«ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä½¿ç”¨BMESå››ä¸ªçŠ¶æ€ä½æ¥è¿›è¡Œåˆ†è¯ã€‚ä»¥å¦‚ä¸‹å¥å­ä¸ºä¾‹ï¼š</p>
<p>ä¸­ å›½ æ˜¯ æ³± æ³± å¤§ å›½<br>B  B  B  B  B  B  B<br>M M M M M M M<br>E  E  E  E  E  E  E<br>S  S  S  S  S  S  S</p>
<p>æ¡ä»¶éšæœºåœºè§£ç å°±æ˜¯åœ¨ä»¥ä¸Šç”±æ ‡è®°ç»„æˆçš„æ•°ç»„ä¸­æœç´¢ä¸€æ¡æœ€ä¼˜çš„è·¯å¾„ã€‚</p>
<p>è¦æŠŠæ¯ä¸€ä¸ªå­—(å³è§‚å¯Ÿå˜é‡)å¯¹åº”çš„æ¯ä¸€ä¸ªçŠ¶æ€BMES(å³æ ‡è®°å˜é‡)çš„æ¦‚ç‡éƒ½æ±‚å‡ºæ¥ã€‚ä¾‹å¦‚å¯¹äºè§‚å¯Ÿå˜é‡â€œå›½â€ï¼Œå½“å‰æ ‡è®°å˜é‡ä¸ºEï¼Œå‰ä¸€ä¸ªè§‚å¯Ÿå˜é‡ä¸ºâ€œä¸­â€ï¼Œå‰ä¸€ä¸ªæ ‡è®°å˜é‡ä¸ºBï¼Œåˆ™ï¼št(B, E, â€˜å›½â€™) å¯¹åº”åˆ°æ¡ä»¶éšæœºåœºé‡Œç›¸é‚»æ ‡è®°å˜é‡$(y_{i-1},y_i)$çš„åŠ¿å‡½æ•°ã€‚s(E, â€˜å›½â€™) å¯¹åº”åˆ°æ¡ä»¶éšæœºåœºé‡Œå•ä¸ªæ ‡è®°å˜é‡$y_i$å¯¹åº”çš„åŠ¿å‡½æ•°$s_l(y_i,x,i)$ã€‚t(B, E, â€˜å›½â€™), s(E, â€˜å›½â€™)ç›¸åº”çš„æƒå€¼$Î»_k,\mu_l$ï¼Œ éƒ½æ˜¯ç”±æ¡ä»¶éšæœºåœºç”¨å¤§é‡çš„æ ‡æ³¨è¯­æ–™è®­ç»ƒå‡ºæ¥ã€‚å› æ­¤åˆ†è¯çš„æ ‡è®°è¯†åˆ«å°±æ˜¯æ±‚å¯¹äºå„ä¸ªè§‚å¯Ÿå˜é‡ï¼Œå®ƒä»¬çš„æ ‡è®°å˜é‡(BMES)çŠ¶æ€åºåˆ—çš„æ¦‚ç‡æœ€å¤§å€¼ï¼Œå³æ±‚ï¼šçš„æ¦‚ç‡ç»„åˆæœ€å¤§å€¼ã€‚è¿™ä¸ªè§£æ³•ä¸éšé©¬å°”å¯å¤«ç±»ä¼¼ï¼Œå¯ä»¥ç”¨viterbiç®—æ³•æ±‚è§£ã€‚</p>
<h5 id="ä»£ç -5"><a href="#ä»£ç -5" class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><p>ä½¿ç”¨crf++å®ç°å¯¹æ¨¡å‹çš„è®­ç»ƒï¼Œcrf++ å®‰è£…ã€æ•°æ®æ ¼å¼åŠæ¨¡æ¿å‚æ•°è¯·å‚è€ƒï¼š<a href="https://jeffery0628.github.io/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/">åºåˆ—æ ‡æ³¨</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> CRFPP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRFModel</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, model=<span class="string">'model_name'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: ç±»åˆå§‹åŒ–</span></span><br><span class="line"><span class="string">        :param model: æ¨¡å‹åç§°</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.model = model</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_tagger</span><span class="params">(self, tag_data)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: æ·»åŠ è¯­æ–™</span></span><br><span class="line"><span class="string">        :param tag_data: æ•°æ®</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        word_str = tag_data.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.model):</span><br><span class="line">            print(<span class="string">'æ¨¡å‹ä¸å­˜åœ¨,è¯·ç¡®è®¤æ¨¡å‹è·¯å¾„æ˜¯å¦æ­£ç¡®!'</span>)</span><br><span class="line">            exit()</span><br><span class="line">        tagger = CRFPP.Tagger(<span class="string">"-m &#123;&#125; -v 3 -n2"</span>.format(self.model))</span><br><span class="line">        tagger.clear()</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> word_str:</span><br><span class="line">            tagger.add(word)</span><br><span class="line">        tagger.parse()</span><br><span class="line">        <span class="keyword">return</span> tagger</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">text_mark</span><span class="params">(self, tag_data, begin=<span class="string">'B'</span>, middle=<span class="string">'I'</span>, end=<span class="string">'E'</span>, single=<span class="string">'S'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ–‡æœ¬æ ‡è®°</span></span><br><span class="line"><span class="string">        :param tag_data: æ•°æ®</span></span><br><span class="line"><span class="string">        :param begin: å¼€å§‹æ ‡è®°</span></span><br><span class="line"><span class="string">        :param middle: ä¸­é—´æ ‡è®°</span></span><br><span class="line"><span class="string">        :param end: ç»“æŸæ ‡è®°</span></span><br><span class="line"><span class="string">        :param single: å•å­—ç»“æŸæ ‡è®°</span></span><br><span class="line"><span class="string">        :return result: æ ‡è®°åˆ—è¡¨</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        tagger = self.add_tagger(tag_data)</span><br><span class="line">        size = tagger.size()</span><br><span class="line">        tag_text = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, size):</span><br><span class="line">            word, tag = tagger.x(i, <span class="number">0</span>), tagger.y2(i)</span><br><span class="line">            <span class="keyword">if</span> tag <span class="keyword">in</span> [begin, middle]:</span><br><span class="line">                tag_text += word</span><br><span class="line">            <span class="keyword">elif</span> tag <span class="keyword">in</span> [end, single]:</span><br><span class="line">                tag_text += word + <span class="string">"*&amp;*"</span></span><br><span class="line">        result = tag_text.split(<span class="string">'*&amp;*'</span>)</span><br><span class="line">        result.pop()</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crf_test</span><span class="params">(self, tag_data, separator=<span class="string">'/'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: crfæµ‹è¯•</span></span><br><span class="line"><span class="string">        :param tag_data:</span></span><br><span class="line"><span class="string">        :param separator:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        result = self.text_mark(tag_data)</span><br><span class="line">        data = separator.join(result)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crf_learn</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: è®­ç»ƒæ¨¡å‹</span></span><br><span class="line"><span class="string">        :param filename: å·²æ ‡æ³¨æ•°æ®æº</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        crf_bash = <span class="string">"crf_learn -f 3 -c 4.0 data/template.txt &#123;&#125; &#123;&#125;"</span>.format(filename, self.model)</span><br><span class="line">        process = subprocess.Popen(crf_bash.split(), stdout=subprocess.PIPE)</span><br><span class="line">        output = process.communicate()[<span class="number">0</span>]</span><br><span class="line">        print(output.decode(encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">    crf_model = CRFModel(model=<span class="string">'data/model_crf'</span>)</span><br><span class="line">    crf_model.crf_learn(filename=<span class="string">'data/train_file_crf.txt'</span>)</span><br><span class="line">    <span class="comment"># é¢„æµ‹</span></span><br><span class="line">    print(crf_model.crf_test(tag_data=<span class="string">'æˆ‘ä»¬ä¸€å®šè¦æˆ˜èƒœæ•Œäººï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒä»¬éƒ½æ˜¯çº¸è€è™ã€‚'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="æ¡ä»¶éšæœºåœºåˆ†è¯çš„ä¼˜ç¼ºç‚¹"><a href="#æ¡ä»¶éšæœºåœºåˆ†è¯çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="æ¡ä»¶éšæœºåœºåˆ†è¯çš„ä¼˜ç¼ºç‚¹"></a>æ¡ä»¶éšæœºåœºåˆ†è¯çš„ä¼˜ç¼ºç‚¹</h5><p>æ¡ä»¶éšæœºåœºåˆ†è¯æ˜¯ä¸€ç§ç²¾åº¦å¾ˆé«˜çš„åˆ†è¯æ–¹æ³•ï¼Œå®ƒæ¯”éšé©¬å°”å¯å¤«çš„ç²¾åº¦è¦é«˜ï¼Œæ˜¯å› ä¸ºéšé©¬å°”å¯å¤«å‡è®¾è§‚å¯Ÿå˜é‡$x_i$åªä¸å½“å‰çŠ¶æ€$y_i$æœ‰å…³ï¼Œè€Œä¸å…¶å®ƒçŠ¶æ€$y_{i-1}$ï¼Œ$y_{i+1}$æ— å…³;è€Œæ¡ä»¶éšæœºåœºå‡è®¾äº†å½“å‰è§‚å¯Ÿå˜é‡$x_i$ä¸ä¸Šä¸‹æ–‡ç›¸å…³ï¼Œå¦‚ ï¼Œå°±æ˜¯è€ƒè™‘åˆ°ä¸Šä¸€ä¸ªå­—æ ‡è®°çŠ¶æ€ä¸ºBæ—¶ï¼Œå½“å‰æ ‡è®°çŠ¶æ€ä¸ºEå¹¶ä¸”è¾“å‡ºâ€œå›½â€å­—çš„æ¦‚ç‡ã€‚å› æ­¤é€šè¿‡ä¸Šä¸‹æ–‡çš„åˆ†æï¼Œæ¡ä»¶éšæœºåœºåˆ†è¯ä¼šæå‡åˆ°æ›´é«˜çš„ç²¾åº¦ã€‚ä½†å› ä¸ºå¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œæ¡ä»¶éšæœºåœºä¸€èˆ¬è®­ç»ƒä»£ä»·éƒ½æ¯”è¾ƒå¤§ã€‚</p>
<h4 id="ç»“æ„åŒ–æ„ŸçŸ¥æœºåˆ†è¯ç®—æ³•"><a href="#ç»“æ„åŒ–æ„ŸçŸ¥æœºåˆ†è¯ç®—æ³•" class="headerlink" title="ç»“æ„åŒ–æ„ŸçŸ¥æœºåˆ†è¯ç®—æ³•"></a>ç»“æ„åŒ–æ„ŸçŸ¥æœºåˆ†è¯ç®—æ³•</h4><p>åˆ©ç”¨éšé©¬å°”ç§‘å¤«æ¨¡å‹å®ç°åŸºäºåºåˆ—æ ‡æ³¨çš„ä¸­æ–‡åˆ†è¯å™¨ï¼Œæ•ˆæœå¹¶ä¸ç†æƒ³ã€‚äº‹å®ä¸Šï¼Œéšé©¬å°”å¯å¤«æ¨¡å‹å‡è®¾äººä»¬è¯´çš„è¯ä»…ä»…å–å†³äºä¸€ä¸ªéšè—çš„BMESåºåˆ—ï¼Œè¿™ä¸ªå‡è®¾å¤ªå•çº¯äº†ï¼Œä¸ç¬¦åˆè¯­è¨€è§„å¾‹ã€‚è¯­è¨€ä¸æ˜¯ç”±è¿™ä¹ˆç®€å•çš„æ ‡ç­¾åºåˆ—ç”Ÿæˆï¼Œè¯­è¨€å«æœ‰æ›´å¤šç‰¹å¾ï¼Œè€Œéšé©¬å°”ç§‘å¤«æ¨¡å‹æ²¡æœ‰æ•æ‰åˆ°ã€‚<strong>éšé©¬å¼¥å¯å¤«æ¨¡å‹èƒ½æ•æ‰çš„ç‰¹å¾ä»…é™äºä¸¤ç§: å…¶ä¸€ï¼Œå‰ä¸€ä¸ªæ ‡ç­¾æ˜¯ä»€ä¹ˆï¼›å…¶äºŒï¼Œå½“å‰å­—ç¬¦æ˜¯ä»€ä¹ˆ</strong>ã€‚ä¸ºäº†åˆ©ç”¨æ›´å¤šçš„ç‰¹å¾ï¼Œçº¿æ€§æ¨¡å‹( linear model )åº”è¿è€Œç”Ÿã€‚çº¿æ€§æ¨¡å‹ç”±ä¸¤éƒ¨åˆ†æ„æˆ: ä¸€ç³»åˆ—ç”¨æ¥æå–ç‰¹å¾çš„ç‰¹å¾å‡½æ•°$\phi$ï¼Œä»¥åŠç›¸åº”çš„æƒé‡å‘é‡$w$ã€‚</p>
<h5 id="æ„ŸçŸ¥æœºç®—æ³•"><a href="#æ„ŸçŸ¥æœºç®—æ³•" class="headerlink" title="æ„ŸçŸ¥æœºç®—æ³•"></a>æ„ŸçŸ¥æœºç®—æ³•</h5><p>æ„ŸçŸ¥æœºç®—æ³•æ˜¯ä¸€ç§è¿­ä»£å¼çš„ç®—æ³•ï¼šåœ¨è®­ç»ƒé›†ä¸Šè¿è¡Œå¤šä¸ªè¿­ä»£ï¼Œæ¯æ¬¡è¯»å…¥ä¸€ä¸ªæ ·æœ¬ï¼Œæ‰§è¡Œé¢„æµ‹ï¼Œå°†é¢„æµ‹ç»“æœä¸æ­£ç¡®ç­”æ¡ˆè¿›è¡Œå¯¹æ¯”ï¼Œè®¡ç®—è¯¯å·®ï¼Œæ ¹æ®è¯¯å·®æ›´æ–°æ¨¡å‹å‚æ•°ï¼Œå†æ¬¡è¿›è¡Œè®­ç»ƒï¼Œç›´åˆ°è¯¯å·®æœ€å°ä¸ºæ­¢ã€‚</p>
<ul>
<li><strong>æŸå¤±å‡½æ•°</strong>: ä»æ•°å€¼ä¼˜åŒ–çš„è§’åº¦æ¥è®²ï¼Œè¿­ä»£å¼æœºå™¨å­¦ä¹ ç®—æ³•éƒ½åœ¨ä¼˜åŒ–(å‡å°)ä¸€ä¸ªæŸå¤±å‡½æ•°ã€‚æŸå¤±å‡½æ•° J(w) ç”¨æ¥è¡¡é‡æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„é”™è¯¯ç¨‹åº¦ï¼Œè‡ªå˜é‡æ˜¯æ¨¡å‹å‚æ•° $w$ï¼Œå› å˜é‡æ˜¯ä¸€ä¸ªæ ‡é‡ï¼Œè¡¨ç¤ºæ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„æŸå¤±çš„å¤§å°ã€‚</li>
<li><strong>æ¢¯åº¦ä¸‹é™</strong>: ç»™å®šæ ·æœ¬ï¼Œå…¶ç‰¹å¾å‘é‡ $x$ åªæ˜¯å¸¸æ•°ï¼Œå¯¹ $J(w)$ æ±‚å¯¼ï¼Œå¾—åˆ°ä¸€ä¸ªæ¢¯åº¦å‘é‡ $\Delta w$ï¼Œå®ƒçš„åæ–¹å‘ä¸€å®šæ˜¯å½“å‰ä½ç½®æŸå¤±å‡½æ•°å‡å°é€Ÿåº¦æœ€å¿«çš„æ–¹å‘ã€‚å¦‚æœå‚æ•°ç‚¹ $w$ åæ–¹å‘ç§»åŠ¨å°±ä¼šä½¿æŸå¤±å‡½æ•°å‡å°ï¼Œå«æ¢¯åº¦ä¸‹é™ã€‚</li>
<li><strong>å­¦ä¹ ç‡</strong>: æ¢¯åº¦ä¸‹é™çš„æ­¥é•¿å«åšå­¦ä¹ ç‡ã€‚</li>
<li><strong>éšæœºæ¢¯åº¦ä¸‹é™</strong>(SGD): å¦‚æœç®—æ³•æ¯æ¬¡è¿­ä»£éšæœºé€‰å–éƒ¨åˆ†æ ·æœ¬è®¡ç®—æŸå¤±å‡½æ•°çš„æ¢¯åº¦ï¼Œåˆ™ç§°ä¸ºéšæœºæ¢¯åº¦ä¸‹é™ã€‚</li>
</ul>
<p>å‡å¦‚æ•°æ®æœ¬èº«çº¿æ€§ä¸å¯åˆ†ï¼Œæ„ŸçŸ¥æœºæŸå¤±å‡½æ•°ä¸ä¼šæ”¶æ•›ï¼Œæ¯æ¬¡è¿­ä»£åˆ†ç¦»è¶…å¹³é¢éƒ½ä¼šå‰§çƒˆæŒ¯è¡ã€‚è¿™æ—¶å¯ä»¥å¯¹æ„ŸçŸ¥æœºç®—æ³•æ‰“è¡¥ä¸ï¼Œä½¿ç”¨æŠ•ç¥¨æ„ŸçŸ¥æœºæˆ–å¹³å‡æ„ŸçŸ¥æœºã€‚</p>
<ol>
<li><p><strong>æŠ•ç¥¨æ„ŸçŸ¥æœº</strong>ï¼šæ¯æ¬¡è¿­ä»£çš„æ¨¡å‹éƒ½ä¿ç•™ï¼Œå‡†ç¡®ç‡ä¹Ÿä¿ç•™ï¼Œé¢„æµ‹æ—¶ï¼Œæ¯ä¸ªæ¨¡å‹éƒ½ç»™å‡ºè‡ªå·±çš„ç»“æœï¼Œä¹˜ä»¥å®ƒçš„å‡†ç¡®ç‡åŠ æƒå¹³å‡å€¼ä½œä¸ºæœ€ç»ˆç»“æœã€‚</p>
</li>
<li><p>æŠ•ç¥¨æ„ŸçŸ¥æœºè¦æ±‚å­˜å‚¨å¤šä¸ªæ¨¡å‹åŠåŠ æƒï¼Œè®¡ç®—å¼€é”€è¾ƒå¤§ï¼Œæ›´å®é™…çš„åšæ³•æ˜¯å–å¤šä¸ªæ¨¡å‹çš„æƒé‡çš„å¹³å‡ï¼Œè¿™å°±æ˜¯<strong>å¹³å‡æ„ŸçŸ¥æœº</strong>ã€‚</p>
</li>
</ol>
<h5 id="ç»“æ„åŒ–é¢„æµ‹é—®é¢˜"><a href="#ç»“æ„åŒ–é¢„æµ‹é—®é¢˜" class="headerlink" title="ç»“æ„åŒ–é¢„æµ‹é—®é¢˜"></a>ç»“æ„åŒ–é¢„æµ‹é—®é¢˜</h5><p>è‡ªç„¶è¯­è¨€å¤„ç†é—®é¢˜å¤§è‡´å¯åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç§æ˜¯åˆ†ç±»é—®é¢˜ï¼Œå¦ä¸€ç§å°±æ˜¯ç»“æ„åŒ–é¢„æµ‹é—®é¢˜ï¼Œåºåˆ—æ ‡æ³¨åªæ˜¯ç»“æ„åŒ–é¢„æµ‹çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå¯¹æ„ŸçŸ¥æœºç¨ä½œæ‹“å±•ï¼Œåˆ†ç±»å™¨å°±èƒ½æ”¯æŒç»“æ„åŒ–é¢„æµ‹ã€‚<br>ä¿¡æ¯çš„å±‚æ¬¡ç»“æ„ç‰¹ç‚¹ç§°ä½œç»“æ„åŒ–ã€‚<strong>é‚£ä¹ˆç»“æ„åŒ–é¢„æµ‹</strong>(structhreï¼Œprediction)åˆ™æ˜¯é¢„æµ‹å¯¹è±¡ç»“æ„çš„ä¸€ç±»ç›‘ç£å­¦ä¹ é—®é¢˜ã€‚ç›¸åº”çš„æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ç§°ä½œ<strong>ç»“æ„åŒ–å­¦ä¹ </strong>(stutured laming )ã€‚åˆ†ç±»é—®é¢˜çš„é¢„æµ‹ç»“æœæ˜¯ä¸€ä¸ªå†³ç­–è¾¹ç•Œï¼Œ å›å½’é—®é¢˜çš„é¢„æµ‹ç»“æœæ˜¯ä¸€ä¸ªå®æ•°æ ‡é‡ï¼Œè€Œç»“æ„åŒ–é¢„æµ‹çš„ç»“æœåˆ™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç»“æ„ã€‚<br>è‡ªç„¶è¯­è¨€å¤„ç†ä¸­æœ‰è®¸å¤šä»»åŠ¡æ˜¯ç»“æ„åŒ–é¢„æµ‹ï¼Œæ¯”å¦‚åºåˆ—æ ‡æ³¨é¢„æµ‹ç»“æ„æ˜¯ä¸€æ•´ä¸ªåºåˆ—ï¼Œå¥æ³•åˆ†æé¢„æµ‹ç»“æ„æ˜¯ä¸€æ£µå¥æ³•æ ‘ï¼Œæœºå™¨ç¿»è¯‘é¢„æµ‹ç»“æ„æ˜¯ä¸€æ®µå®Œæ•´çš„è¯‘æ–‡ã€‚è¿™äº›ç»“æ„ç”±è®¸å¤šéƒ¨åˆ†æ„æˆï¼Œæœ€å°çš„éƒ¨åˆ†è™½ç„¶ä¹Ÿæ˜¯åˆ†ç±»é—®é¢˜(æ¯”å¦‚ä¸­æ–‡åˆ†è¯æ—¶æ¯ä¸ªå­—ç¬¦åˆ†ç±»ä¸º{B,M,E,S} ),ä½†å¿…é¡»è€ƒè™‘ç»“æ„æ•´ä½“çš„åˆç†ç¨‹åº¦ã€‚</p>
<h6 id="ç»“æ„åŒ–é¢„æµ‹ä¸å­¦ä¹ æµç¨‹"><a href="#ç»“æ„åŒ–é¢„æµ‹ä¸å­¦ä¹ æµç¨‹" class="headerlink" title="ç»“æ„åŒ–é¢„æµ‹ä¸å­¦ä¹ æµç¨‹"></a>ç»“æ„åŒ–é¢„æµ‹ä¸å­¦ä¹ æµç¨‹</h6><p>ç»“æ„åŒ–é¢„æµ‹çš„è¿‡ç¨‹å°±æ˜¯ç»™å®šä¸€ä¸ªæ¨¡å‹ Î» åŠæ‰“åˆ†å‡½æ•° scoreï¼Œåˆ©ç”¨æ‰“åˆ†å‡½æ•°ç»™ä¸€äº›å¤‡é€‰ç»“æ„æ‰“åˆ†ï¼Œé€‰æ‹©åˆ†æ•°æœ€é«˜çš„ç»“æ„ä½œä¸ºé¢„æµ‹è¾“å‡ºï¼Œå…¬å¼å¦‚ä¸‹:</p>
<script type="math/tex; mode=display">
\hat{y}=\arg \max _{y \in Y} \operatorname{score}({\lambda}(x, y))</script><p>å…¶ä¸­ï¼ŒY æ˜¯å¤‡é€‰ç»“æ„çš„é›†åˆã€‚æ—¢ç„¶ç»“æ„åŒ–é¢„æµ‹å°±æ˜¯æœç´¢å¾—åˆ†æœ€é«˜çš„ç»“æ„ yï¼Œé‚£ä¹ˆç»“æ„åŒ–å­¦ä¹ çš„ç›®æ ‡å°±æ˜¯æƒ³æ–¹è®¾æ³•è®©æ­£ç¡®ç­”æ¡ˆ y çš„å¾—åˆ†æœ€é«˜ã€‚ä¸åŒçš„æ¨¡å‹æœ‰ä¸åŒçš„ç®—æ³•ï¼Œå¯¹äºçº¿æ€§æ¨¡å‹ï¼Œè®­ç»ƒç®—æ³•ä¸ºç»“æ„åŒ–æ„ŸçŸ¥æœºã€‚</p>
<h5 id="ç»“æ„åŒ–æ„ŸçŸ¥æœºç®—æ³•"><a href="#ç»“æ„åŒ–æ„ŸçŸ¥æœºç®—æ³•" class="headerlink" title="ç»“æ„åŒ–æ„ŸçŸ¥æœºç®—æ³•"></a>ç»“æ„åŒ–æ„ŸçŸ¥æœºç®—æ³•</h5><p>è¦è®©çº¿æ€§æ¨¡å‹æ”¯æŒç»“æ„åŒ–é¢„æµ‹ï¼Œå¿…é¡»å…ˆè®¾è®¡æ‰“åˆ†å‡½æ•°ã€‚æ‰“åˆ†å‡½æ•°çš„è¾“å…¥æœ‰ä¸¤ä¸ªç¼ºä¸€ä¸å¯çš„å‚æ•°: ç‰¹å¾ $x$ å’Œç»“æ„$y$ã€‚ä½†ä¹‹å‰çš„çº¿æ€§æ¨¡å‹çš„â€œæ‰“åˆ†å‡½æ•°â€åªæ¥å—ä¸€ä¸ªè‡ªå˜é‡ $x$ã€‚åšæ³•æ˜¯å®šä¹‰æ–°çš„ç‰¹å¾å‡½æ•°$\phi (x,y)$ï¼ŒæŠŠç»“æ„ $y$ ä¹Ÿä½œä¸ºä¸€ç§ç‰¹å¾ï¼Œè¾“å‡ºæ–°çš„â€œç»“æ„åŒ–ç‰¹å¾å‘é‡â€ã€‚æ–°ç‰¹å¾å‘é‡ä¸æƒé‡å‘é‡åšç‚¹ç§¯åï¼Œå°±å¾—åˆ°ä¸€ä¸ªæ ‡é‡ï¼Œå°†å…¶ä½œä¸ºåˆ†æ•°:</p>
<script type="math/tex; mode=display">
\operatorname{score}(x, y)=w \cdot \phi(x, y)</script><p>æ‰“åˆ†å‡½æ•°æœ‰äº†ï¼Œå–åˆ†å€¼æœ€å¤§çš„ç»“æ„ä½œä¸ºé¢„æµ‹ç»“æœï¼Œå¾—åˆ°ç»“æ„åŒ–é¢„æµ‹å‡½æ•°:</p>
<script type="math/tex; mode=display">
\hat{y}=\arg \max _{y \in Y}(w \cdot \phi(x, y))</script><p>é¢„æµ‹å‡½æ•°ä¸çº¿æ€§åˆ†ç±»å™¨çš„å†³ç­–å‡½æ•°å¾ˆåƒï¼Œéƒ½æ˜¯æƒé‡å‘é‡ç‚¹ç§¯ç‰¹å¾å‘é‡ã€‚é‚£ä¹ˆæ„ŸçŸ¥æœºç®—æ³•ä¹Ÿå¯ä»¥æ‹“å±•å¤ç”¨ï¼Œå¾—åˆ°çº¿æ€§æ¨¡å‹çš„ç»“æ„åŒ–å­¦ä¹ ç®—æ³•:</p>
<ol>
<li>è¯»å…¥æ ·æœ¬ $(x,y)$ï¼Œè¿›è¡Œç»“æ„åŒ–é¢„æµ‹$\hat{y}=\arg \max _{y \in Y}(w \cdot \phi(x, y))$</li>
<li>ä¸æ­£ç¡®ç­”æ¡ˆç›¸æ¯”ï¼Œè‹¥ä¸ç›¸ç­‰ï¼Œåˆ™æ›´æ–°å‚æ•°: å¥–åŠ±æ­£ç¡®ç­”æ¡ˆè§¦å‘çš„ç‰¹å¾å‡½æ•°çš„æƒé‡ï¼Œå¦åˆ™è¿›è¡Œæƒ©ç½š:$w \leftarrow w+\phi\left(x^{(i)}, y\right)-\phi\left(x^{(i)}, \hat{y}\right)$</li>
<li>è°ƒæ•´å­¦ä¹ ç‡:$\boldsymbol{w} \leftarrow \boldsymbol{w}+\alpha\left(\phi\left(\boldsymbol{x}^{(i)}, \boldsymbol{y}\right)-\phi\left(\boldsymbol{x}^{(i)}, \hat{\boldsymbol{y}}\right)\right)$</li>
</ol>
<h6 id="ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸æ„ŸçŸ¥æœºç®—æ³•æ¯”è¾ƒ"><a href="#ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸æ„ŸçŸ¥æœºç®—æ³•æ¯”è¾ƒ" class="headerlink" title="ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸æ„ŸçŸ¥æœºç®—æ³•æ¯”è¾ƒ"></a>ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸æ„ŸçŸ¥æœºç®—æ³•æ¯”è¾ƒ</h6><ul>
<li>ç»“æ„åŒ–æ„ŸçŸ¥æœºä¿®æ”¹äº†ç‰¹å¾å‘é‡ã€‚</li>
<li>ç»“æ„åŒ–æ„ŸçŸ¥æœºçš„å‚æ•°æ›´æ–°èµç½šåˆ†æ˜ã€‚</li>
</ul>
<h6 id="ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸åºåˆ—æ ‡æ³¨"><a href="#ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸åºåˆ—æ ‡æ³¨" class="headerlink" title="ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸åºåˆ—æ ‡æ³¨"></a>ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸åºåˆ—æ ‡æ³¨</h6><p>åºåˆ—æ ‡æ³¨æœ€å¤§çš„ç»“æ„ç‰¹ç‚¹å°±æ˜¯æ ‡ç­¾ç›¸äº’ä¹‹é—´çš„ä¾èµ–æ€§ï¼Œè¿™ç§ä¾èµ–æ€§åˆ©ç”¨åˆå§‹çŠ¶æ€æ¦‚ç‡æƒ³ä¿©ç‹—å’ŒçŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µä½“ç³»é‚£ï¼Œé‚£ä¹ˆå¯¹äºç»“æ„åŒ–æ„ŸçŸ¥æœºï¼Œå°±å¯ä»¥ä½¿ç”¨<strong>è½¬ç§»ç‰¹å¾</strong>æ¥è¡¨ç¤º:</p>
<script type="math/tex; mode=display">
\phi_{k}\left(y_{t-1}, y_{t}\right)=\left\{\begin{array}{ll}
1, & y_{t-1}=s_{i}, and , y_{t}=s_{j} \\
0
\end{array} \quad i=0, \cdots, N ; j=1, \cdots, N\right.</script><p>å…¶ä¸­ï¼Œ$y_t$ä¸ºåºåˆ—ç¬¬ t ä¸ªæ ‡ç­¾ï¼Œ$s_i$ä¸ºæ ‡æ³¨é›†ç¬¬ i ç§æ ‡ç­¾ï¼ŒN ä¸ºæ ‡æ³¨é›†å¤§å°ã€‚</p>
<p><strong>çŠ¶æ€ç‰¹å¾</strong>ï¼Œç±»ä¼¼äºéšé©¬å°”å¯å¤«æ¨¡å‹çš„å‘å°„æ¦‚ç‡çŸ©é˜µï¼ŒçŠ¶æ€ç‰¹å¾åªä¸å½“å‰çš„çŠ¶æ€æœ‰å…³ï¼Œä¸ä¹‹å‰çš„çŠ¶æ€æ— å…³:</p>
<script type="math/tex; mode=display">
\phi_{i}\left(x_{i}, y_{i}\right)=\left\{\begin{array}{l}
1 \\
0
\end{array}\right.</script><p>äºæ˜¯ï¼Œç»“æ„åŒ–æ„ŸçŸ¥æœºçš„ç‰¹å¾å‡½æ•°å°±æ˜¯è½¬ç§»ç‰¹å¾å’ŒçŠ¶æ€ç‰¹å¾çš„åˆé›†:</p>
<script type="math/tex; mode=display">
\phi=\left[\phi_{k} ; \phi_{l}\right] \quad k=1, \cdots, N^{2}+N ; l=N^{2}+N+1, \cdots</script><p>åŸºäºä»¥ä¸Šå…¬å¼ï¼Œç»Ÿä¸€ç”¨æ‰“åˆ†å‡½æ•°æ¥è¡¨ç¤º:</p>
<script type="math/tex; mode=display">
\operatorname{score}(\boldsymbol{x}, \boldsymbol{y})=\sum_{t=1}^{T} \boldsymbol{w} \cdot \phi\left(y_{t-1}, y_{t}, \boldsymbol{x}_{t}\right)</script><p>æœ‰äº†æ‰“åˆ†å…¬å¼ï¼Œå°±å¯ä»¥åˆ©ç”¨ç»´ç‰¹æ¯”ç®—æ³•æ±‚è§£å¾—åˆ†æœ€é«˜çš„åºåˆ—ã€‚</p>
<h5 id="ä»£ç -6"><a href="#ä»£ç -6" class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CPTTrain</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, segment, train)</span>:</span></span><br><span class="line">        self.__char_type = &#123;&#125;</span><br><span class="line">        data_path = <span class="string">"data"</span></span><br><span class="line">        <span class="keyword">for</span> ind, name <span class="keyword">in</span> enumerate([<span class="string">"punc"</span>, <span class="string">"alph"</span>, <span class="string">"date"</span>, <span class="string">"num"</span>]):</span><br><span class="line">            fn = data_path + <span class="string">"/"</span> + name</span><br><span class="line">            <span class="keyword">if</span> os.path.isfile(fn):</span><br><span class="line">                <span class="keyword">for</span> line <span class="keyword">in</span> open(fn, <span class="string">"r"</span>):</span><br><span class="line">                    self.__char_type[line.strip()] = ind</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">"can't open"</span>, fn)</span><br><span class="line">                exit()</span><br><span class="line"></span><br><span class="line">        self.__train_insts = <span class="literal">None</span>  <span class="comment"># all instances for training.</span></span><br><span class="line">        self.__feats_weight = <span class="literal">None</span>  <span class="comment"># ["b", "m", "e", "s"][all the features] --&gt; weight.</span></span><br><span class="line">        self.__words_num = <span class="literal">None</span>  <span class="comment"># total words num in all the instances.</span></span><br><span class="line">        self.__insts_num = <span class="literal">None</span>  <span class="comment"># namley the sentences' num.</span></span><br><span class="line">        self.__cur_ite_ID = <span class="literal">None</span>  <span class="comment"># current iteration index.</span></span><br><span class="line">        self.__cur_inst_ID = <span class="literal">None</span>  <span class="comment"># current index_th instance.</span></span><br><span class="line">        self.__real_inst_ID = <span class="literal">None</span>  <span class="comment"># the accurate index in training instances after randimizing.</span></span><br><span class="line">        self.__last_update = <span class="literal">None</span>  <span class="comment"># ["b".."s"][feature] --&gt; [last_update_ite_ID, last_update_inst_ID]</span></span><br><span class="line">        self.__feats_weight_sum = <span class="literal">None</span>  <span class="comment"># sum of ["b".."s"][feature] from begin to end.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> segment <span class="keyword">and</span> train <span class="keyword">or</span> <span class="keyword">not</span> segment <span class="keyword">and</span> <span class="keyword">not</span> train:</span><br><span class="line">            print(<span class="string">"there is only a True and False in segment and train"</span>)</span><br><span class="line">            exit()</span><br><span class="line">        <span class="keyword">elif</span> train:</span><br><span class="line">            self.Train = self.__Train</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.__LoadModel()</span><br><span class="line">            self.Segment = self.__Segment</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__LoadModel</span><span class="params">(self)</span>:</span></span><br><span class="line">        model = <span class="string">"data/avgmodel"</span></span><br><span class="line">        print(<span class="string">"load"</span>, model, <span class="string">"..."</span>)</span><br><span class="line">        self.__feats_weight = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> os.path.isfile(model):</span><br><span class="line">            start = time.clock()</span><br><span class="line">            self.__feats_weight = pickle.load(open(model, <span class="string">"rb"</span>))</span><br><span class="line">            end = time.clock()</span><br><span class="line">            print(<span class="string">"It takes %d seconds"</span> % (end - start))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"can't open"</span>, model)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Train</span><span class="params">(self, corp_file_name, max_train_num, max_ite_num)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.__LoadCorp(corp_file_name, max_train_num):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        starttime = time.clock()</span><br><span class="line"></span><br><span class="line">        self.__feats_weight = &#123;&#125;</span><br><span class="line">        self.__last_update = &#123;&#125;</span><br><span class="line">        self.__feats_weight_sum = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> self.__cur_ite_ID <span class="keyword">in</span> range(max_ite_num):</span><br><span class="line">            <span class="keyword">if</span> self.__Iterate():</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        self.__SaveModel()</span><br><span class="line">        endtime = time.clock()</span><br><span class="line">        print(<span class="string">"total iteration times is %d seconds"</span> % (endtime - starttime))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__GenerateFeats</span><span class="params">(self, inst)</span>:</span></span><br><span class="line">        inst_feat = []</span><br><span class="line">        <span class="keyword">for</span> ind, [c, tag, t] <span class="keyword">in</span> enumerate(inst):</span><br><span class="line">            inst_feat.append([])</span><br><span class="line">            <span class="keyword">if</span> t == <span class="number">-1</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment"># Cn</span></span><br><span class="line">            <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">-2</span>, <span class="number">3</span>):</span><br><span class="line">                inst_feat[<span class="number">-1</span>].append(<span class="string">"C%d==%s"</span> % (n, inst[ind + n][<span class="number">0</span>]))</span><br><span class="line">            <span class="comment"># CnCn+1</span></span><br><span class="line">            <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">-2</span>, <span class="number">2</span>):</span><br><span class="line">                inst_feat[<span class="number">-1</span>].append(<span class="string">"C%dC%d==%s%s"</span> % (n, n + <span class="number">1</span>, inst[ind + n][<span class="number">0</span>], inst[ind + n + <span class="number">1</span>][<span class="number">0</span>]))</span><br><span class="line">            <span class="comment"># C-1C1</span></span><br><span class="line">            inst_feat[<span class="number">-1</span>].append(<span class="string">"C-1C1==%s%s"</span> % (inst[ind - <span class="number">1</span>][<span class="number">0</span>], inst[ind + <span class="number">1</span>][<span class="number">0</span>]))</span><br><span class="line">            <span class="comment"># Pu(C0)</span></span><br><span class="line">            inst_feat[<span class="number">-1</span>].append(<span class="string">"Pu(%s)==%d"</span> % (c, int(t == <span class="number">0</span>)))</span><br><span class="line">            <span class="comment"># T(C-2)T(C-1)T(C0)T(C1)T(C2)</span></span><br><span class="line">            inst_feat[<span class="number">-1</span>].append(<span class="string">"T-2...2=%d%d%d%d%d"</span> % (</span><br><span class="line">            inst[ind - <span class="number">2</span>][<span class="number">2</span>], inst[ind - <span class="number">1</span>][<span class="number">2</span>], inst[ind][<span class="number">2</span>], inst[ind + <span class="number">1</span>][<span class="number">2</span>], inst[ind + <span class="number">2</span>][<span class="number">2</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> inst_feat</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__SaveModel</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># the last time to sum all the features.</span></span><br><span class="line">        norm = float(self.__cur_ite_ID + <span class="number">1</span>) * self.__insts_num</span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> self.__feats_weight_sum:</span><br><span class="line">            last_ite_ID = self.__last_update[feat][<span class="number">0</span>]</span><br><span class="line">            last_inst_ID = self.__last_update[feat][<span class="number">1</span>]</span><br><span class="line">            c = (self.__cur_ite_ID - last_ite_ID) * self.__insts_num + self.__cur_inst_ID - last_inst_ID</span><br><span class="line">            self.__feats_weight_sum[feat] += self.__feats_weight[feat] * c</span><br><span class="line">            self.__feats_weight_sum[feat] = self.__feats_weight_sum[feat] / norm</span><br><span class="line"></span><br><span class="line">        pickle.dump(self.__feats_weight_sum, open(<span class="string">"data/avgmodel"</span>, <span class="string">"wb"</span>))</span><br><span class="line">        self.__train_insts = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__LoadCorp</span><span class="params">(self, corp_file_name, max_train_num)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(corp_file_name):</span><br><span class="line">            print(<span class="string">"can't open"</span>, corp_file_name)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        self.__train_insts = []</span><br><span class="line">        self.__words_num = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> ind, line <span class="keyword">in</span> enumerate(open(corp_file_name, <span class="string">"r"</span>)):</span><br><span class="line">            <span class="keyword">if</span> max_train_num &gt; <span class="number">0</span> <span class="keyword">and</span> ind &gt;= max_train_num:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            self.__train_insts.append(self.__PreProcess(line.strip()))</span><br><span class="line">            self.__words_num += len(self.__train_insts[<span class="number">-1</span>]) - <span class="number">4</span></span><br><span class="line">        self.__insts_num = len(self.__train_insts)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"number of total insts is"</span>, self.__insts_num)</span><br><span class="line">        print(<span class="string">"number of total characters is"</span>, self.__words_num)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__PreProcess</span><span class="params">(self, sent)</span>:</span></span><br><span class="line">        inst = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            inst.append([<span class="string">"&lt;s&gt;"</span>, <span class="string">"s"</span>, <span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> sent.split():</span><br><span class="line">            rt = word.rpartition(<span class="string">"/"</span>)</span><br><span class="line">            t = self.__char_type.get(rt[<span class="number">0</span>], <span class="number">4</span>)</span><br><span class="line">            inst.append([rt[<span class="number">0</span>], rt[<span class="number">2</span>], t])  <span class="comment"># [c, tag, t]</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            inst.append([<span class="string">"&lt;s&gt;"</span>, <span class="string">"s"</span>, <span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> inst</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Segment</span><span class="params">(self, src)</span>:</span></span><br><span class="line">        <span class="string">"""suppose there is one sentence once."""</span></span><br><span class="line">        inst = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            inst.append([<span class="string">"&lt;s&gt;"</span>, <span class="string">"s"</span>, <span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> src:</span><br><span class="line">            inst.append([c, <span class="string">""</span>, self.__char_type.get(c, <span class="number">4</span>)])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            inst.append([<span class="string">"&lt;s&gt;"</span>, <span class="string">"s"</span>, <span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">        feats = self.__GenerateFeats(inst)</span><br><span class="line">        tags = self.__DPSegment(inst, feats)</span><br><span class="line"></span><br><span class="line">        rst = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, len(tags) - <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">if</span> tags[i] <span class="keyword">in</span> [<span class="string">"s"</span>, <span class="string">"b"</span>]:</span><br><span class="line">                rst.append(inst[i][<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rst[<span class="number">-1</span>] += inst[i][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">" "</span>.join(rst)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Iterate</span><span class="params">(self)</span>:</span></span><br><span class="line">        start = time.clock()</span><br><span class="line">        print(<span class="string">"%d th iteration"</span> % self.__cur_ite_ID)</span><br><span class="line"></span><br><span class="line">        train_list = random.sample(range(self.__insts_num), self.__insts_num)</span><br><span class="line">        error_sents_num = <span class="number">0</span></span><br><span class="line">        error_words_num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> self.__cur_inst_ID, self.__real_inst_ID <span class="keyword">in</span> enumerate(train_list):</span><br><span class="line">            num = self.__TrainInstance()</span><br><span class="line">            error_sents_num += <span class="number">1</span> <span class="keyword">if</span> num &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            error_words_num += num</span><br><span class="line"></span><br><span class="line">        st = <span class="number">1</span> - float(error_sents_num) / self.__insts_num</span><br><span class="line">        wt = <span class="number">1</span> - float(error_words_num) / self.__words_num</span><br><span class="line"></span><br><span class="line">        end = time.clock()</span><br><span class="line">        print(<span class="string">"sents accuracy = %f%%, words accuracy = %f%%, it takes %d seconds"</span> % (st * <span class="number">100</span>, wt * <span class="number">100</span>, end - start))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> error_sents_num == <span class="number">0</span> <span class="keyword">and</span> error_words_num == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__TrainInstance</span><span class="params">(self)</span>:</span></span><br><span class="line">        cur_inst = self.__train_insts[self.__real_inst_ID]</span><br><span class="line">        feats = self.__GenerateFeats(cur_inst)</span><br><span class="line"></span><br><span class="line">        seg = self.__DPSegment(cur_inst, feats)</span><br><span class="line">        <span class="keyword">return</span> self.__Correct(seg, feats)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__DPSegment</span><span class="params">(self, inst, feats)</span>:</span></span><br><span class="line">        num = len(inst)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get all position's score.</span></span><br><span class="line">        value = [&#123;&#125; <span class="keyword">for</span> i <span class="keyword">in</span> range(num)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, num - <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> [<span class="string">"b"</span>, <span class="string">"m"</span>, <span class="string">"e"</span>, <span class="string">"s"</span>]:</span><br><span class="line">                value[i][t] = self.__GetScore(i, t, feats)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># find optimal path.</span></span><br><span class="line">        tags = [<span class="literal">None</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(num)]</span><br><span class="line">        best = [<span class="number">-1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(num)]  <span class="comment"># best[i]: [i, i + length(i)) is optimal segment.</span></span><br><span class="line">        length = [<span class="literal">None</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(num)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num - <span class="number">2</span> - <span class="number">1</span>, <span class="number">1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">for</span> dis <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">                <span class="keyword">if</span> i + dis &gt; num - <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                cur_score = best[i + dis]</span><br><span class="line">                self.__Tag(i, i + dis, tags)</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> range(i, i + dis):</span><br><span class="line">                    cur_score += value[k][tags[k]]</span><br><span class="line">                <span class="keyword">if</span> length[i] <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> cur_score &gt; best[i]:</span><br><span class="line">                    best[i] = cur_score</span><br><span class="line">                    length[i] = dis</span><br><span class="line"></span><br><span class="line">        i = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; num - <span class="number">2</span>:</span><br><span class="line">            self.__Tag(i, i + length[i], tags)</span><br><span class="line">            i += length[i]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tags</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__GetScore</span><span class="params">(self, pos, t, feats)</span>:</span></span><br><span class="line">        pos_feats = feats[pos]</span><br><span class="line">        score = <span class="number">0.0</span></span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> pos_feats:</span><br><span class="line">            score += self.__feats_weight.get(feat + <span class="string">"=&gt;"</span> + t, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Tag</span><span class="params">(self, f, t, tags)</span>:</span></span><br><span class="line">        <span class="string">"""tag the sequence tags in the xrange of [f, t)"""</span></span><br><span class="line">        <span class="keyword">if</span> t - f == <span class="number">1</span>:</span><br><span class="line">            tags[f] = <span class="string">"s"</span></span><br><span class="line">        <span class="keyword">elif</span> t - f &gt;= <span class="number">2</span>:</span><br><span class="line">            tags[f], tags[t - <span class="number">1</span>] = <span class="string">"b"</span>, <span class="string">"e"</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(f + <span class="number">1</span>, t - <span class="number">1</span>):</span><br><span class="line">                tags[i] = <span class="string">"m"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Correct</span><span class="params">(self, tags, feats)</span>:</span></span><br><span class="line">        updates = &#123;&#125;</span><br><span class="line">        cur_inst = self.__train_insts[self.__real_inst_ID]</span><br><span class="line">        error_words_num = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, len(cur_inst) - <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">if</span> tags[i] == cur_inst[i][<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            error_words_num += <span class="number">1</span></span><br><span class="line">            pos_feats = feats[i]</span><br><span class="line">            target = cur_inst[i][<span class="number">1</span>]</span><br><span class="line">            mine = tags[i]</span><br><span class="line">            <span class="keyword">for</span> feat <span class="keyword">in</span> pos_feats:</span><br><span class="line">                updates[feat + <span class="string">"=&gt;"</span> + target] = updates.get(feat + <span class="string">"=&gt;"</span> + target, <span class="number">0.0</span>) + <span class="number">1</span></span><br><span class="line">                updates[feat + <span class="string">"=&gt;"</span> + mine] = updates.get(feat + <span class="string">"=&gt;"</span> + mine, <span class="number">0.0</span>) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        self.__Update(updates)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> error_words_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Update</span><span class="params">(self, updates)</span>:</span></span><br><span class="line">        <span class="comment"># update the features weight.</span></span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> updates:</span><br><span class="line">            pair = self.__last_update.get(feat, [<span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">            last_ite_ID = pair[<span class="number">0</span>]</span><br><span class="line">            last_inst_ID = pair[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">            c = (self.__cur_ite_ID - last_ite_ID) * self.__insts_num + self.__cur_inst_ID - last_inst_ID</span><br><span class="line">            self.__feats_weight_sum[feat] = self.__feats_weight_sum.get(feat, <span class="number">0</span>) + c * self.__feats_weight.get(feat, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            self.__feats_weight[feat] = self.__feats_weight.get(feat, <span class="number">0</span>) + updates[feat]</span><br><span class="line">            self.__last_update[feat] = [self.__cur_ite_ID, self.__cur_inst_ID]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    train = CPTTrain(train=<span class="literal">True</span>, segment=<span class="literal">False</span>)</span><br><span class="line">    train.Train(<span class="string">"data/msr_train.txt"</span>, max_train_num=<span class="number">1000000</span>, max_ite_num=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">    srcs = [<span class="string">"å¤å¤©çš„æ¸…æ™¨"</span>,</span><br><span class="line">            <span class="string">"â€œäººä»¬å¸¸è¯´ç”Ÿæ´»æ˜¯ä¸€éƒ¨æ•™ç§‘ä¹¦ï¼Œè€Œè¡€ä¸ç«çš„æˆ˜äº‰æ›´æ˜¯ä¸å¯å¤šå¾—çš„æ•™ç§‘ä¹¦ï¼Œå¥¹ç¡®å®æ˜¯åå‰¯å…¶å®çš„â€˜æˆ‘çš„å¤§å­¦â€™ã€‚"</span>,</span><br><span class="line">            <span class="string">"å¤å¤©çš„æ¸…æ™¨å¤å¤©çœ‹è§çŒªå…«æˆ’å’Œå«¦å¨¥äº†ã€‚"</span>,</span><br><span class="line">            <span class="string">"æµ·è¿ä¸šé›„è¸å…¨çƒä¹‹é¦–ï¼ŒæŒ‰å¨ä½è®¡å ä¸–ç•Œæ€»æ•°çš„ï¼‘ï¼—ï¼…ã€‚"</span>]</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"avg"</span>)</span><br><span class="line">    seg = CPTTrain(train=<span class="literal">False</span>, segment=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> src <span class="keyword">in</span> srcs:</span><br><span class="line">        print(seg.Segment(src))</span><br></pre></td></tr></table></figure>
<h4 id="åŸºäºæ·±åº¦å­¦ä¹ çš„ç«¯åˆ°ç«¯çš„åˆ†è¯æ–¹æ³•"><a href="#åŸºäºæ·±åº¦å­¦ä¹ çš„ç«¯åˆ°ç«¯çš„åˆ†è¯æ–¹æ³•" class="headerlink" title="åŸºäºæ·±åº¦å­¦ä¹ çš„ç«¯åˆ°ç«¯çš„åˆ†è¯æ–¹æ³•"></a>åŸºäºæ·±åº¦å­¦ä¹ çš„ç«¯åˆ°ç«¯çš„åˆ†è¯æ–¹æ³•</h4><p>åœ¨ä¸­æ–‡åˆ†è¯ä¸Šï¼ŒåŸºäºç¥ç»ç½‘ç»œçš„æ–¹æ³•ï¼Œå¾€å¾€ä½¿ç”¨ã€Œå­—å‘é‡ + BiLSTM + CRFã€æ¨¡å‹ï¼Œåˆ©ç”¨ç¥ç»ç½‘ç»œæ¥å­¦ä¹ ç‰¹å¾ï¼Œå°†ä¼ ç»Ÿ CRF ä¸­çš„äººå·¥ç‰¹å¾å·¥ç¨‹é‡é™åˆ°æœ€ä½</p>
<p>BiLSTMã€BiLSTM+CRFã€BiLSTM+CNN+CRFã€BERTã€BERT+CRFã€BERT+BiLSTMã€BERT+BiLSTM+CRFï¼Œç”±äºä»¥ä¸Šæ¨¡å‹å‡å¯å¯¹åºåˆ—æ ‡æ³¨ä»»åŠ¡è¿›è¡Œå»ºæ¨¡æ±‚è§£ï¼Œæ‰€ä»¥å‡å¯æ‹¿æ¥åšä¸­æ–‡åˆ†è¯ã€‚ä»¥æ¯”è¾ƒå…¸å‹çš„ã€Œå­—å‘é‡ + BiLSTM ï¼ˆ+CNNï¼‰+ CRFã€æ¨¡å‹ä¸ºä¾‹ï¼š</p>
<p>BiLSTMèåˆä¸¤ç»„å­¦ä¹ æ–¹å‘ç›¸åï¼ˆä¸€ä¸ªæŒ‰å¥å­é¡ºåºï¼Œä¸€ä¸ªæŒ‰å¥å­é€†åºï¼‰çš„LSTMå±‚ï¼Œèƒ½å¤Ÿåœ¨ç†è®ºä¸Šå®ç°å½“å‰è¯å³åŒ…å«å†å²ä¿¡æ¯ã€åˆåŒ…å«æœªæ¥ä¿¡æ¯ï¼Œæ›´æœ‰åˆ©äºå¯¹å½“å‰è¯è¿›è¡Œæ ‡æ³¨ã€‚è™½ç„¶ä¾èµ–äºç¥ç»ç½‘ç»œå¼ºå¤§çš„éçº¿æ€§æ‹Ÿåˆèƒ½åŠ›ï¼Œç†è®ºä¸Šæˆ‘ä»¬å·²ç»èƒ½å¤Ÿå­¦ä¹ å‡ºä¸é”™çš„æ¨¡å‹ã€‚ä½†æ˜¯ï¼ŒBiLSTMåªè€ƒè™‘äº†æ ‡ç­¾ä¸Šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å¯¹äºåºåˆ—æ ‡æ³¨ä»»åŠ¡æ¥è¯´ï¼Œå½“å‰ä½ç½®çš„æ ‡ç­¾$y_t$ä¸å‰ä¸€ä¸ªä½ç½®$y_{t-1}$ã€åä¸€ä¸ªä½ç½®$y_{t+1}$éƒ½æœ‰æ½œåœ¨çš„å…³ç³»ã€‚ä¾‹å¦‚ï¼Œâ€œä¸œå—å¤§å­¦æ¬¢è¿æ‚¨â€è¢«æ ‡æ³¨ä¸ºâ€œä¸œ/S å—/M å¤§/M å­¦/E æ¬¢/B è¿/E æ‚¨/Sâ€ï¼Œç”±åˆ†è¯çš„æ ‡æ³¨è§„åˆ™å¯çŸ¥ï¼ŒBæ ‡ç­¾ååªèƒ½æ¥Må’ŒEï¼ŒBiLSTMæ²¡æœ‰åˆ©ç”¨è¿™ç§æ ‡ç­¾ä¹‹é—´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å› æ­¤ï¼Œå°±æœ‰äººæå‡ºäº†åœ¨æ¨¡å‹åæ¥ä¸€å±‚CRFå±‚ï¼Œç”¨äºåœ¨æ•´ä¸ªåºåˆ—ä¸Šå­¦ä¹ æœ€ä¼˜çš„æ ‡ç­¾åºåˆ—ï¼š</p>
<p><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/bilstm_crf.jpeg" alt="avatar"></p>
<p>BiLSTM+CNN+CRFï¼šå¯¹äºåˆ†è¯ä»»åŠ¡ï¼Œå½“å‰è¯çš„æ ‡ç­¾åŸºæœ¬ä¸Šåªä¸å‰å‡ ä¸ªå’Œå’Œå‡ ä¸ªè¯æœ‰å…³è”ã€‚BiLSTMåœ¨å­¦ä¹ è¾ƒé•¿å¥å­æ—¶ï¼Œå¯èƒ½å› ä¸ºæ¨¡å‹å®¹é‡é—®é¢˜ä¸¢å¼ƒä¸€äº›é‡è¦ä¿¡æ¯ï¼Œå› æ­¤åœ¨æ¨¡å‹ä¸­åŠ äº†ä¸€ä¸ªCNNå±‚ï¼Œç”¨äºæå–å½“å‰è¯çš„å±€éƒ¨ç‰¹å¾ã€‚ï¼ˆä¸çŸ¥æ•ˆæœæ€æ ·ï¼Ÿï¼Ÿï¼ï¼ï¼‰</p>
<p><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/bilstm_cnn_crf.png" alt="avatar"></p>
<h5 id="æ¨¡å‹æ¯”è¾ƒ"><a href="#æ¨¡å‹æ¯”è¾ƒ" class="headerlink" title="æ¨¡å‹æ¯”è¾ƒ"></a>æ¨¡å‹æ¯”è¾ƒ</h5><p>Trained and tested with pku dataset</p>
<p>CRF</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Template</th>
<th style="text-align:center">Precision</th>
<th style="text-align:center">Recall</th>
<th style="text-align:center">F1-Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">crf_template</td>
<td style="text-align:center">0.938</td>
<td style="text-align:center">0.923</td>
<td style="text-align:center">0.931</td>
</tr>
</tbody>
</table>
</div>
<p>Bi-LSTM</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Structure</th>
<th style="text-align:center">Precision</th>
<th style="text-align:center">Recall</th>
<th style="text-align:center">F1-Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">emb256_hid256_l3</td>
<td style="text-align:center">0.9252</td>
<td style="text-align:center">0.9237</td>
<td style="text-align:center">0.9243</td>
</tr>
</tbody>
</table>
</div>
<p>Bi-LSTM + CRF</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Structure</th>
<th style="text-align:center">Precision</th>
<th style="text-align:center">Recall</th>
<th style="text-align:center">F1-Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">emb256_hid256_l3</td>
<td style="text-align:center">0.9343</td>
<td style="text-align:center">0.9336</td>
<td style="text-align:center">0.9339</td>
</tr>
</tbody>
</table>
</div>
<p>BERT + Bi-LSTM</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Structure</th>
<th style="text-align:center">Precision</th>
<th style="text-align:center">Recall</th>
<th style="text-align:center">F1-Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">emb768_hid512_l2</td>
<td style="text-align:center">0.9698</td>
<td style="text-align:center">0.9650</td>
<td style="text-align:center">0.9646</td>
</tr>
</tbody>
</table>
</div>
<h5 id="ä»£ç -7"><a href="#ä»£ç -7" class="headerlink" title="ä»£ç "></a>ä»£ç </h5><p>ä»¥BERT+RNN+CRFä¸ºä¾‹ï¼Œå¯æ ¹æ®éœ€æ±‚è¿›è¡Œæ”¹åŠ¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> TorchCRF <span class="keyword">import</span> CRF </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertRNNCRF</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num_tags, rnn_type, bert_path, bert_train, seg_vocab_size,hidden_dim, n_layers, bidirectional, batch_first,</span></span></span><br><span class="line"><span class="function"><span class="params">                 dropout, restrain)</span>:</span></span><br><span class="line">        super(BertRNNCRF, self).__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line">        self.bert = BertModel.from_pretrained(bert_path)</span><br><span class="line">        <span class="comment"># å¯¹bertè¿›è¡Œè®­ç»ƒ</span></span><br><span class="line">        <span class="keyword">for</span> name, param <span class="keyword">in</span> self.bert.named_parameters():</span><br><span class="line">            param.requires_grad = bert_train</span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                               hidden_size=hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line">        self.crf = CRF(num_tags, batch_first=<span class="literal">True</span>, restrain_matrix=restrain, loss_side=<span class="number">2.5</span>)</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        <span class="keyword">if</span> self.bidirectional:</span><br><span class="line">            self.fc_tags = nn.Linear(hidden_dim*<span class="number">2</span>, num_tags)</span><br><span class="line">            <span class="comment"># self.fc_tags = nn.Linear(768, num_tags)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.fc_tags = nn.Linear(hidden_dim, num_tags)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, context, seq_len,max_seq_len, mask_bert)</span>:</span></span><br><span class="line">        <span class="comment"># context    è¾“å…¥çš„å¥å­</span></span><br><span class="line">        <span class="comment"># mask_bert  å¯¹paddingéƒ¨åˆ†è¿›è¡Œmaskï¼Œå’Œå¥å­ä¸€ä¸ªsizeï¼Œpaddingéƒ¨åˆ†ç”¨0è¡¨ç¤ºï¼Œå¦‚ï¼š[1, 1, 1, 1, 0, 0]</span></span><br><span class="line">        bert_sentence, bert_cls = self.bert(context, attention_mask=mask_bert)</span><br><span class="line">        <span class="comment"># sentence_len = bert_sentence.shape[1]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># bert_cls = bert_cls.unsqueeze(dim=1).repeat(1, sentence_len, 1)</span></span><br><span class="line">        <span class="comment"># bert_sentence = bert_sentence + bert_cls</span></span><br><span class="line">        encoder_out, sorted_seq_lengths, desorted_indices = self.prepare_pack_padded_sequence(bert_sentence, seq_len)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(encoder_out, sorted_seq_lengths,</span><br><span class="line">                                                            batch_first=self.batch_first)</span><br><span class="line">        <span class="comment"># self.rnn.flatten_parameters()</span></span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line">        <span class="comment"># unpack sequence</span></span><br><span class="line">        <span class="comment"># output = [ batch size,sent len, hidden_dim * bidirectional]</span></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first,total_length=max_seq_len)</span><br><span class="line">        output = output[desorted_indices]</span><br><span class="line">        out = self.fc_tags(self.dropout(output.contiguous()))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out[:, <span class="number">1</span>:, :]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepare_pack_padded_sequence</span><span class="params">(self, inputs_words, seq_lengths, descending=True)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param device:</span></span><br><span class="line"><span class="string">        :param inputs_words:</span></span><br><span class="line"><span class="string">        :param seq_lengths:</span></span><br><span class="line"><span class="string">        :param descending:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        sorted_seq_lengths, indices = torch.sort(seq_lengths, descending=descending)</span><br><span class="line">        _, desorted_indices = torch.sort(indices, descending=<span class="literal">False</span>)</span><br><span class="line">        sorted_inputs_words = inputs_words[indices]</span><br><span class="line">        <span class="keyword">return</span> sorted_inputs_words, sorted_seq_lengths, desorted_indices</span><br></pre></td></tr></table></figure>
<h3 id="åˆ†è¯ä¸­çš„éš¾é¢˜"><a href="#åˆ†è¯ä¸­çš„éš¾é¢˜" class="headerlink" title="åˆ†è¯ä¸­çš„éš¾é¢˜"></a>åˆ†è¯ä¸­çš„éš¾é¢˜</h3><p>ä¸­æ–‡æ˜¯ä¸€ç§ååˆ†å¤æ‚çš„è¯­è¨€ï¼Œè®©è®¡ç®—æœºç†è§£ä¸­æ–‡è¯­è¨€æ›´æ˜¯å›°éš¾ã€‚åœ¨ä¸­æ–‡åˆ†è¯è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸¤å¤§éš¾é¢˜ä¸€ç›´æ²¡æœ‰å®Œå…¨çªç ´ã€‚</p>
<h4 id="1ã€æ­§ä¹‰åˆ‡åˆ†é—®é¢˜"><a href="#1ã€æ­§ä¹‰åˆ‡åˆ†é—®é¢˜" class="headerlink" title="1ã€æ­§ä¹‰åˆ‡åˆ†é—®é¢˜"></a>1ã€æ­§ä¹‰åˆ‡åˆ†é—®é¢˜</h4><p>æ­§ä¹‰æ˜¯æŒ‡åŒæ ·çš„ä¸€å¥è¯ï¼Œå¯èƒ½æœ‰ä¸¤ç§æˆ–è€…æ›´å¤šçš„åˆ‡åˆ†æ–¹æ³•ã€‚</p>
<ul>
<li>äº¤é›†æ­§ä¹‰ï¼šâ€œç»“åˆæˆâ€ï¼Œç»“åˆ/æˆï¼Œç»“/åˆæˆ</li>
<li>ç»„åˆæ­§ä¹‰ï¼šâ€œèµ·èº«â€ï¼Œä»–ç«™èµ·/èº«/æ¥ã€‚ ä»–æ˜å¤©/èµ·èº«/å»åŒ—äº¬ã€‚</li>
<li>æ··åˆå‹æ­§ä¹‰ï¼šåŒæ—¶å…·å¤‡äº¤é›†æ­§ä¹‰å’Œç»„åˆæ­§ä¹‰çš„ç‰¹ç‚¹ã€‚1ï¼Œè¿™ç¯‡æ–‡ç« å†™å¾—å¤ªå¹³æ·¡äº†ã€‚2ï¼Œè¿™å¢™æŠ¹çš„å¤ªå¹³äº†ã€‚3ï¼Œå³ä½¿å¤ªå¹³æ—¶æœŸä¹Ÿä¸åº”è¯¥æ”¾æ¾è­¦æƒ•ã€‚â€œå¤ªå¹³æ·¡â€æ˜¯äº¤é›†å‹ï¼Œâ€œå¤ªå¹³â€æ˜¯ç»„åˆå‹ã€‚ </li>
</ul>
<p>äº¤é›†æ­§ä¹‰ç›¸å¯¹ç»„åˆæ­§ä¹‰æ¥è¯´æ˜¯è¿˜ç®—æ¯”è¾ƒå®¹æ˜“å¤„ç†ï¼Œç»„åˆæ­§ä¹‰éœ€è¦æ ¹æ®æ•´ä¸ªå¥å­æ¥åˆ¤æ–­ã€‚ï¼ˆç‰¹å¾ï¼šä¸Šä¸‹æ–‡è¯­ä¹‰åˆ†æï¼ŒéŸµå¾‹åˆ†æï¼Œè¯­æ°”ï¼Œé‡éŸ³ï¼Œåœé¡¿ï¼‰</p>
<h4 id="2ã€æœªç™»å½•è¯"><a href="#2ã€æœªç™»å½•è¯" class="headerlink" title="2ã€æœªç™»å½•è¯"></a>2ã€æœªç™»å½•è¯</h4><p>æœªç™»å½•è¯ï¼ˆç”Ÿè¯ï¼Œæ–°è¯ï¼‰ï¼š1.å·²æœ‰çš„è¯è¡¨ä¸­æ²¡æœ‰æ”¶å½•çš„è¯ã€‚2.å·²æœ‰çš„è®­ç»ƒè¯­æ–™ä¸­æœªæ›¾å‡ºç°çš„è¯ï¼ˆé›†å¤–è¯OOVï¼‰ã€‚</p>
<p>ç±»å‹ï¼š</p>
<ol>
<li>æ–°å‡ºç°çš„æ™®é€šè¯æ±‡ï¼šåšå®¢ï¼Œè¶…å¥³ï¼Œç»™åŠ›ã€‚</li>
<li>ä¸“æœ‰åè¯ï¼šäººåã€åœ°åã€ç»„ç»‡åã€æ—¶é—´ã€æ•°å­—è¡¨è¾¾ã€</li>
<li>ä¸“ä¸šåè¯å’Œç ”ç©¶é¢†åŸŸåè¯ï¼šè‹ä¸¹çº¢ï¼Œç¦½æµæ„Ÿ</li>
<li>å…¶ä»–ä¸“ç”¨åè¯ï¼šæ–°å‡ºç°çš„äº§å“åï¼Œç”µå½±ï¼Œä¹¦è®°ã€‚</li>
</ol>
<p>å¯¹äºçœŸå®æ•°æ®æ¥è¯´ï¼Œæœªç™»å½•è¯å¯¹åˆ†è¯ç²¾åº¦çš„å½±å“è¿œè¿œè¶…è¿‡äº†æ­§ä¹‰åˆ‡åˆ†ã€‚æœªç™»å½•è¯æ˜¯å¾ˆéš¾å¤„ç†çš„é—®é¢˜ï¼Œè€Œä¸”è¿™äº›åˆæ­£å¥½æ˜¯äººä»¬ç»å¸¸ä½¿ç”¨çš„è¯ï¼Œå› æ­¤å¯¹äºæœç´¢å¼•æ“æ¥è¯´ï¼Œåˆ†è¯ç³»ç»Ÿä¸­çš„æœªç™»å½•è¯è¯†åˆ«ååˆ†é‡è¦ã€‚ç›®å‰æœªç™»å½•è¯è¯†åˆ«å‡†ç¡®ç‡å·²ç»æˆä¸ºè¯„ä»·ä¸€ä¸ªåˆ†è¯ç³»ç»Ÿå¥½åçš„é‡è¦æ ‡å¿—ä¹‹ä¸€ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><p><a href="https://blog.csdn.net/selinda001/article/details/79345072" target="_blank" rel="noopener">ä¸­æ–‡åˆ†è¯å¼•æ“ java å®ç° â€” æ­£å‘æœ€å¤§ã€é€†å‘æœ€å¤§ã€åŒå‘æœ€å¤§åŒ¹é…æ³•</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/sxron/articles/6391926.html" target="_blank" rel="noopener">ä¸­æ–‡åˆ†è¯ç®—æ³•æ€»ç»“</a></p>
</li>
<li><p><a href="https://blog.csdn.net/Zh823275484/article/details/87878512" target="_blank" rel="noopener">åŸºäºn-gramæ¨¡å‹çš„ä¸­æ–‡åˆ†è¯</a></p>
</li>
<li><p><a href="https://blog.csdn.net/qq_27825451/article/details/102457058" target="_blank" rel="noopener">è¯¦è§£è¯­è¨€æ¨¡å‹NGramåŠå›°æƒ‘åº¦Perplexity</a></p>
</li>
<li><p><a href="https://blog.csdn.net/wangliang_f/article/details/17532633" target="_blank" rel="noopener">åˆ†è¯å­¦ä¹ (3)ï¼ŒåŸºäºngramè¯­è¨€æ¨¡å‹çš„nå…ƒåˆ†è¯</a></p>
</li>
<li><p><a href="https://zhuanlan.zhihu.com/p/33261835" target="_blank" rel="noopener">ä¸­æ–‡åˆ†è¯ç®—æ³•ç®€ä»‹</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/715fa597c6bc" target="_blank" rel="noopener">NLPï¼šåˆ†è¯ç®—æ³•ç»¼è¿°</a></p>
</li>
<li><p><a href="https://github.com/NLP-LOVE/Introduction-NLP/blob/master/chapter/5.%E6%84%9F%E7%9F%A5%E6%9C%BA%E5%88%86%E7%B1%BB%E4%B8%8E%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8.md" target="_blank" rel="noopener">æ„ŸçŸ¥æœºåˆ†ç±»ä¸åºåˆ—æ ‡æ³¨</a></p>
</li>
</ol>
]]></content>
      <categories>
        <category>è‡ªç„¶è¯­è¨€å¤„ç†åŸºç¡€</category>
      </categories>
      <tags>
        <tag>è‡ªç„¶è¯­è¨€å¤„ç†åŸºç¡€</tag>
        <tag>è‡ªç„¶è¯­è¨€å¤„ç†</tag>
        <tag>åˆ†è¯ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡æœ¬çº é”™</title>
    <url>/2020/04/24/%E6%96%87%E6%9C%AC%E7%BA%A0%E9%94%99/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><h4 id="å¸¸è§é”™è¯¯ç±»å‹"><a href="#å¸¸è§é”™è¯¯ç±»å‹" class="headerlink" title="å¸¸è§é”™è¯¯ç±»å‹"></a>å¸¸è§é”™è¯¯ç±»å‹</h4><ol>
<li>è°éŸ³å­—è¯ï¼Œå¦‚ é…å‰¯çœ¼ç›-é…å‰¯çœ¼é•œ</li>
<li>æ··æ·†éŸ³å­—è¯ï¼Œå¦‚ æµæµªç»‡å¥³-ç‰›éƒç»‡å¥³</li>
<li>å­—è¯é¡ºåºé¢ å€’ï¼Œå¦‚ ä¼è¿ªè‰¾ä¼¦-è‰¾ä¼¦ä¼è¿ª</li>
<li>å­—è¯è¡¥å…¨ï¼Œå¦‚ çˆ±æœ‰å¤©æ„-å‡å¦‚çˆ±æœ‰å¤©æ„</li>
<li>å½¢ä¼¼å­—é”™è¯¯ï¼Œå¦‚ é«˜æ¢-é«˜ç²±</li>
<li>ä¸­æ–‡æ‹¼éŸ³å…¨æ‹¼ï¼Œå¦‚ xingfu-å¹¸ç¦</li>
<li>ä¸­æ–‡æ‹¼éŸ³ç¼©å†™ï¼Œå¦‚ sz-æ·±åœ³</li>
<li>è¯­æ³•é”™è¯¯ï¼Œå¦‚ æƒ³è±¡éš¾ä»¥-éš¾ä»¥æƒ³è±¡</li>
</ol>
<p>é’ˆå¯¹ä¸åŒä¸šåŠ¡åœºæ™¯ï¼Œè¿™äº›é—®é¢˜å¹¶ä¸ä¸€å®šå…¨éƒ¨å­˜åœ¨ï¼Œæ¯”å¦‚è¾“å…¥æ³•ä¸­éœ€è¦å¤„ç†å‰å››ç§ï¼Œæœç´¢å¼•æ“éœ€è¦å¤„ç†æ‰€æœ‰ç±»å‹ï¼Œè¯­éŸ³è¯†åˆ«åæ–‡æœ¬çº é”™åªéœ€è¦å¤„ç†å‰ä¸¤ç§ï¼Œ å…¶ä¸­â€™å½¢ä¼¼å­—é”™è¯¯â€™ä¸»è¦é’ˆå¯¹äº”ç¬”æˆ–è€…ç¬”ç”»æ‰‹å†™è¾“å…¥ç­‰ã€‚</p>
<a id="more"></a>
<h4 id="çº é”™æ–¹æ³•"><a href="#çº é”™æ–¹æ³•" class="headerlink" title="çº é”™æ–¹æ³•"></a>çº é”™æ–¹æ³•</h4><p>çº é”™ç®—æ³•åˆ†ä¸ºä¸¤ä¸ªæ–¹å‘ï¼šåŸºäºè§„åˆ™ã€æ·±åº¦æ¨¡å‹</p>
<h5 id="è§„åˆ™çš„è§£å†³æ€è·¯"><a href="#è§„åˆ™çš„è§£å†³æ€è·¯" class="headerlink" title="è§„åˆ™çš„è§£å†³æ€è·¯"></a><strong>è§„åˆ™çš„è§£å†³æ€è·¯</strong></h5><p>ä¸­æ–‡çº é”™åˆ†ä¸ºä¸¤æ­¥èµ°ï¼Œç¬¬ä¸€æ­¥æ˜¯é”™è¯¯æ£€æµ‹ï¼Œç¬¬äºŒæ­¥æ˜¯é”™è¯¯çº æ­£ï¼›</p>
<p>é”™è¯¯æ£€æµ‹éƒ¨åˆ†å…ˆé€šè¿‡ç»“å·´ä¸­æ–‡åˆ†è¯å™¨åˆ‡è¯ï¼Œç”±äºå¥å­ä¸­å«æœ‰é”™åˆ«å­—ï¼Œæ‰€ä»¥åˆ‡è¯ç»“æœå¾€å¾€ä¼šæœ‰åˆ‡åˆ†é”™è¯¯çš„æƒ…å†µï¼Œè¿™æ ·ä»å­—ç²’åº¦å’Œè¯ç²’åº¦ä¸¤æ–¹é¢æ£€æµ‹é”™è¯¯ï¼Œ æ•´åˆè¿™ä¸¤ç§ç²’åº¦çš„ç–‘ä¼¼é”™è¯¯ç»“æœï¼Œå½¢æˆç–‘ä¼¼é”™è¯¯ä½ç½®å€™é€‰é›†ï¼›</p>
<p>é”™è¯¯çº æ­£éƒ¨åˆ†ï¼Œæ˜¯éå†æ‰€æœ‰çš„ç–‘ä¼¼é”™è¯¯ä½ç½®ï¼Œå¹¶ä½¿ç”¨éŸ³ä¼¼ã€å½¢ä¼¼è¯å…¸æ›¿æ¢é”™è¯¯ä½ç½®çš„è¯ï¼Œç„¶åé€šè¿‡è¯­è¨€æ¨¡å‹è®¡ç®—å¥å­å›°æƒ‘åº¦ï¼Œå¯¹æ‰€æœ‰å€™é€‰é›†ç»“æœæ¯”è¾ƒå¹¶æ’åºï¼Œå¾—åˆ°æœ€ä¼˜çº æ­£è¯ã€‚</p>
<h5 id="æ·±åº¦æ¨¡å‹çš„è§£å†³æ€è·¯"><a href="#æ·±åº¦æ¨¡å‹çš„è§£å†³æ€è·¯" class="headerlink" title="æ·±åº¦æ¨¡å‹çš„è§£å†³æ€è·¯"></a><strong>æ·±åº¦æ¨¡å‹çš„è§£å†³æ€è·¯</strong></h5><p>ç«¯åˆ°ç«¯çš„æ·±åº¦æ¨¡å‹å¯ä»¥é¿å…äººå·¥æå–ç‰¹å¾ï¼Œå‡å°‘äººå·¥å·¥ä½œé‡ï¼ŒRNNåºåˆ—æ¨¡å‹å¯¹æ–‡æœ¬ä»»åŠ¡æ‹Ÿåˆèƒ½åŠ›å¼ºï¼Œrnn_attentionåœ¨è‹±æ–‡æ–‡æœ¬çº é”™æ¯”èµ›ä¸­å–å¾—ç¬¬ä¸€åæˆç»©ï¼Œè¯æ˜åº”ç”¨æ•ˆæœä¸é”™ï¼›</p>
<p>CRFä¼šè®¡ç®—å…¨å±€æœ€ä¼˜è¾“å‡ºèŠ‚ç‚¹çš„æ¡ä»¶æ¦‚ç‡ï¼Œå¯¹å¥å­ä¸­ç‰¹å®šé”™è¯¯ç±»å‹çš„æ£€æµ‹ï¼Œä¼šæ ¹æ®æ•´å¥è¯åˆ¤å®šè¯¥é”™è¯¯ï¼Œé˜¿é‡Œå‚èµ›2016ä¸­æ–‡è¯­æ³•çº é”™ä»»åŠ¡å¹¶å–å¾—ç¬¬ä¸€åï¼Œè¯æ˜åº”ç”¨æ•ˆæœä¸é”™ï¼›</p>
<p>seq2seqæ¨¡å‹æ˜¯ä½¿ç”¨encoder-decoderç»“æ„è§£å†³åºåˆ—è½¬æ¢é—®é¢˜ï¼Œç›®å‰åœ¨åºåˆ—è½¬æ¢ä»»åŠ¡ä¸­ï¼ˆå¦‚æœºå™¨ç¿»è¯‘ã€å¯¹è¯ç”Ÿæˆã€æ–‡æœ¬æ‘˜è¦ã€å›¾åƒæè¿°ï¼‰ä½¿ç”¨æœ€å¹¿æ³›ã€æ•ˆæœæœ€å¥½çš„æ¨¡å‹ä¹‹ä¸€ã€‚</p>
<h3 id="ç¼–è¾‘è·ç¦»"><a href="#ç¼–è¾‘è·ç¦»" class="headerlink" title="ç¼–è¾‘è·ç¦»"></a>ç¼–è¾‘è·ç¦»</h3><h4 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>ç¼–è¾‘è·ç¦»çš„ç»å…¸åº”ç”¨å°±æ˜¯ç”¨äºæ‹¼å†™æ£€é”™ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥çš„è¯è¯­ä¸åœ¨è¯å…¸ä¸­ï¼Œè‡ªåŠ¨ä»è¯å…¸ä¸­æ‰¾å‡ºç¼–è¾‘è·ç¦»å°äºæŸä¸ªæ•°nçš„å•è¯ï¼Œè®©ç”¨æˆ·é€‰æ‹©æ­£ç¡®çš„é‚£ä¸€ä¸ªï¼Œné€šå¸¸å–åˆ°2æˆ–è€…3ã€‚</p>
<p>å­—ç¬¦ä¸²Aåˆ°Bçš„<strong>ç¼–è¾‘è·ç¦»</strong>æ˜¯æŒ‡ï¼Œåªç”¨æ’å…¥ã€åˆ é™¤å’Œæ›¿æ¢ä¸‰ç§æ“ä½œï¼Œæœ€å°‘éœ€è¦å¤šå°‘æ­¥å¯ä»¥æŠŠAå˜æˆBã€‚ä¾‹å¦‚ï¼Œä»FAMEåˆ°GATEéœ€è¦ä¸¤æ­¥ï¼ˆä¸¤æ¬¡æ›¿æ¢ï¼‰ï¼Œä»GAMEåˆ°ACMåˆ™éœ€è¦ä¸‰æ­¥ï¼ˆåˆ é™¤Gå’ŒEå†æ·»åŠ Cï¼‰ã€‚</p>
<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minDistance_recursive</span><span class="params">(self, word1, word2)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        é€’å½’è§£æ³•</span></span><br><span class="line"><span class="string">        :type word1: str</span></span><br><span class="line"><span class="string">        :type word2: str</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word1 <span class="keyword">or</span> <span class="keyword">not</span> word2:</span><br><span class="line">            <span class="comment"># é€’å½’å‡ºå£ï¼šå…¶ä¸­ä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºç©ºï¼Œè¿”å›éç©ºå­—ç¬¦ä¸²çš„é•¿åº¦</span></span><br><span class="line">            <span class="keyword">return</span> (len(word1) <span class="keyword">or</span> len(word2))</span><br><span class="line">        <span class="keyword">if</span> word1[<span class="number">-1</span>] == word2[<span class="number">-1</span>]:</span><br><span class="line">            <span class="comment"># å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²æœ€åä¸€ä¸ªå­—ç¬¦ç›¸åŒ</span></span><br><span class="line">            <span class="keyword">return</span> self.minDistance(word1[:<span class="number">-1</span>], word2[:<span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + min(self.minDistance(word1[:<span class="number">-1</span>], word2), self.minDistance(word1, word2[:<span class="number">-1</span>]),</span><br><span class="line">                       self.minDistance(word1[:<span class="number">-1</span>], word2[:<span class="number">-1</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minDistance_dp</span><span class="params">(self,word1,word2)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        åŠ¨æ€è§„åˆ’è§£æ³•</span></span><br><span class="line"><span class="string">        :param word1:</span></span><br><span class="line"><span class="string">        :param word2:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word1 <span class="keyword">or</span> <span class="keyword">not</span> word2:</span><br><span class="line">            <span class="keyword">return</span> (len(word1) <span class="keyword">or</span> len(word2))</span><br><span class="line"></span><br><span class="line">        dp = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(len(word2)+<span class="number">1</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(len(word1)+<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># dp åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(word1)+<span class="number">1</span>):</span><br><span class="line">            dp[i][<span class="number">0</span>] = i</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(word2)+<span class="number">1</span>):</span><br><span class="line">            dp[<span class="number">0</span>][i] = i</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(word1)+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,len(word2)+<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> word1[i<span class="number">-1</span>] == word2[j<span class="number">-1</span>]:</span><br><span class="line">                    dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[i][j] = <span class="number">1</span> + min(dp[i<span class="number">-1</span>][j],dp[i][j<span class="number">-1</span>],dp[i<span class="number">-1</span>][j<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[len(word1)][len(word2)]</span><br></pre></td></tr></table></figure>
<p><a href="https://leetcode-cn.com/problems/edit-distance/solution/bian-ji-ju-chi-by-leetcode-solution/" target="_blank" rel="noopener">leetcodeé¢˜è§£</a></p>
<h3 id="æ‹¼å†™è‡ªåŠ¨çº é”™ç³»ç»Ÿ"><a href="#æ‹¼å†™è‡ªåŠ¨çº é”™ç³»ç»Ÿ" class="headerlink" title="æ‹¼å†™è‡ªåŠ¨çº é”™ç³»ç»Ÿ"></a>æ‹¼å†™è‡ªåŠ¨çº é”™ç³»ç»Ÿ</h3><p>ç»™å®šä¸€å¾…çº é”™è¯w,éœ€è¦ä»ä¸€ç³»åˆ—å€™é€‰è¯ä¸­é€‰å‡ºä¸€æœ€å¯èƒ½çš„è¯cã€‚ä¹Ÿå°±æ˜¯ï¼š$argmax(p(c|w))$, c in å€™é€‰è¯è¡¨ã€‚æ ¹æ®è´å¶æ–¯åŸç†ï¼Œ$p(c|w) = p(w|c) <em> p(c) / p(w)$. åˆæœ‰å¯¹ä»»æ„å¯èƒ½çš„c,p(w)ä¸€æ ·ï¼Œæ•…ä¹Ÿå°±æ˜¯æ±‚ä½¿$argmax(p(w|c) </em> p(c))$æˆç«‹çš„c.</p>
<h4 id="Candidate-Model"><a href="#Candidate-Model" class="headerlink" title="Candidate Model:"></a>Candidate Model:</h4><p>åˆ©ç”¨ç¼–è¾‘è·ç¦»å°äº1æˆ–è€…ç¼–è¾‘è·ç¦»å°äº2ï¼Œæ¥æ„é€ åˆæ­¥å€™é€‰é›†ï¼Œç„¶ååˆ©ç”¨è¯­æ–™åº“ï¼Œè¿‡æ»¤åˆæ­¥å€™é€‰é›†ï¼Œå¾—åˆ°ç¬¦åˆè§„èŒƒçš„å€™é€‰è¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edits1</span><span class="params">(word)</span>:</span></span><br><span class="line">    <span class="string">"All edits that are one edit away from `word`."</span></span><br><span class="line">    letters    = <span class="string">'abcdefghijklmnopqrstuvwxyz'</span></span><br><span class="line">    splits     = [(word[:i], word[i:])    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(word) + <span class="number">1</span>)]</span><br><span class="line">    deletes    = [L + R[<span class="number">1</span>:]               <span class="keyword">for</span> L, R <span class="keyword">in</span> splits <span class="keyword">if</span> R]</span><br><span class="line">    transposes = [L + R[<span class="number">1</span>] + R[<span class="number">0</span>] + R[<span class="number">2</span>:] <span class="keyword">for</span> L, R <span class="keyword">in</span> splits <span class="keyword">if</span> len(R)&gt;<span class="number">1</span>]</span><br><span class="line">    replaces   = [L + c + R[<span class="number">1</span>:]           <span class="keyword">for</span> L, R <span class="keyword">in</span> splits <span class="keyword">if</span> R <span class="keyword">for</span> c <span class="keyword">in</span> letters]</span><br><span class="line">    inserts    = [L + c + R               <span class="keyword">for</span> L, R <span class="keyword">in</span> splits <span class="keyword">for</span> c <span class="keyword">in</span> letters]</span><br><span class="line">    <span class="keyword">return</span> set(deletes + transposes + replaces + inserts)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edits2</span><span class="params">(word)</span>:</span> </span><br><span class="line">  <span class="string">"ç¼–è¾‘è·ç¦»å°äº2çš„å€™é€‰è¯"</span></span><br><span class="line">  <span class="keyword">return</span> (e2 <span class="keyword">for</span> e1 <span class="keyword">in</span> edits1(word) <span class="keyword">for</span> e2 <span class="keyword">in</span> edits1(e1))</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">known</span><span class="params">(words)</span>:</span> </span><br><span class="line">  <span class="string">"åœ¨è¯­æ–™ä¸­è¿‡æ»¤å‡ºå¤åˆæ‹¼å†™è§„èŒƒçš„ï¼ˆæ­£ç¡®ï¼‰çš„è¯"</span></span><br><span class="line">  <span class="keyword">return</span> set(w <span class="keyword">for</span> w <span class="keyword">in</span> words <span class="keyword">if</span> w <span class="keyword">in</span> corpus)</span><br></pre></td></tr></table></figure>
<h4 id="Language-Model"><a href="#Language-Model" class="headerlink" title="Language Model"></a>Language Model</h4><p>å€™é€‰é›†åˆä¸­çš„è¯å†è¯­æ–™åº“ä¸­çš„å‡ºç°æ¦‚ç‡ã€‚æ¯”å¦‚ï¼šthe åœ¨è‹±æ–‡æ–‡æœ¬ä¸­å‡ºç°çš„æ¦‚ç‡ç‡ä¸º7%ï¼Œåˆ™æœ‰ï¼šp(the)=0.07</p>
<p>,å¯ä»¥é€šè¿‡ç»Ÿè®¡è¯­æ–™åº“ä¸­$p(c)$ = è¯cå‡ºç°çš„é¢‘æ¬¡/æ‰€æœ‰è¯çš„å‡ºç°æ¬¡æ•°ä¹‹å’Œã€‚ï¼ˆunigramï¼Œbigramï¼‰</p>
<h4 id="Error-Model"><a href="#Error-Model" class="headerlink" title="Error Model"></a>Error Model</h4><p>å½“æƒ³è¦è¾“å…¥theå´æ„å¤–æ‹¼å†™æˆtehçš„æ¦‚ç‡:p(teh|the)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">candidates</span><span class="params">(word)</span>:</span> </span><br><span class="line">    <span class="keyword">return</span> known([word]) <span class="keyword">or</span> known(edits1(word)) <span class="keyword">or</span> known(edits2(word)) <span class="keyword">or</span> [word]</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">correction</span><span class="params">(word)</span>:</span> </span><br><span class="line">    <span class="keyword">return</span> max(candidates(word), key=P)</span><br></pre></td></tr></table></figure>
<h4 id="Selection-Mechanism"><a href="#Selection-Mechanism" class="headerlink" title="Selection Mechanism"></a>Selection Mechanism</h4><p>ä»æ­£ç¡®çš„æ‹¼å†™å€™é€‰é›†ä¸­é€‰æ‹©æœ€æœ‰å¯èƒ½çš„æ­£ç¡®ç»“æœï¼Œargmax</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ol>
<li>åˆ©ç”¨ç¼–è¾‘è·ç¦»æ„é€ æ­£ç¡®ç»“æœå€™é€‰é›†</li>
<li>åˆ©ç”¨language model å’Œerror model æ¥è®¡ç®—æ¦‚ç‡ã€‚</li>
<li>ä»æ­£ç¡®ç»“æœå€™é€‰é›†ä¸­é€‰æ‹©æ¦‚ç‡æœ€å¤§çš„æ­£ç¡®æ‹¼å†™ã€‚</li>
</ol>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><p><a href="https://cloud.tencent.com/developer/article/1435917" target="_blank" rel="noopener">ä¸­æ–‡æ–‡æœ¬çº é”™ç®—æ³•èµ°åˆ°å¤šè¿œäº†ï¼Ÿ</a></p>
</li>
<li><p><a href="https://github.com/shibing624/pycorrector" target="_blank" rel="noopener">pycorrect</a></p>
</li>
</ol>
]]></content>
      <categories>
        <category>è‡ªç„¶è¯­è¨€å¤„ç†åŸºç¡€</category>
      </categories>
  </entry>
  <entry>
    <title>å…³é”®è¯æŠ½å–</title>
    <url>/2020/04/21/%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8A%BD%E5%8F%96/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="TF-IDF-æå–å…³é”®è¯"><a href="#TF-IDF-æå–å…³é”®è¯" class="headerlink" title="TF-IDF æå–å…³é”®è¯"></a>TF-IDF æå–å…³é”®è¯</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>TF-IDF(Term Frequency-Inverse Document Frequency, è¯é¢‘-é€†æ–‡ä»¶é¢‘ç‡).TF-IDFæ˜¯ä¸€ç§ç»Ÿè®¡æ–¹æ³•ï¼Œç”¨ä»¥è¯„ä¼°ä¸€å­—è¯å¯¹äºä¸€ä¸ªæ–‡ä»¶é›†æˆ–ä¸€ä»½æ–‡ä»¶åœ¨ä¸€ä¸ªè¯­æ–™åº“ä¸­çš„é‡è¦ç¨‹åº¦ã€‚å­—è¯çš„é‡è¦æ€§éšç€å®ƒåœ¨æ–‡ä»¶ä¸­å‡ºç°çš„æ¬¡æ•°æˆæ­£æ¯”å¢åŠ ï¼Œä½†åŒæ—¶ä¼šéšç€å®ƒåœ¨è¯­æ–™åº“ä¸­å‡ºç°çš„é¢‘ç‡æˆåæ¯”ä¸‹é™ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼š<strong>ä¸€ä¸ªè¯è¯­åœ¨ä¸€ç¯‡æ–‡ç« ä¸­å‡ºç°æ¬¡æ•°è¶Šå¤š, åŒæ—¶åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­å‡ºç°æ¬¡æ•°è¶Šå°‘, è¶Šèƒ½å¤Ÿä»£è¡¨è¯¥æ–‡ç« ã€‚</strong></p>
<blockquote>
<p>TF-IDF ç®—æ³•ä¸»è¦é€‚ç”¨äºè‹±æ–‡ï¼Œä¸­æ–‡é¦–å…ˆè¦åˆ†è¯ï¼Œåˆ†è¯åè¦è§£å†³å¤šè¯ä¸€ä¹‰ï¼Œä»¥åŠä¸€è¯å¤šä¹‰é—®é¢˜ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜é€šè¿‡ç®€å•çš„tf-idfæ–¹æ³•ä¸èƒ½å¾ˆå¥½çš„è§£å†³ã€‚äºæ˜¯å°±æœ‰äº†åæ¥çš„è¯åµŒå…¥æ–¹æ³•ï¼Œç”¨å‘é‡æ¥è¡¨å¾ä¸€ä¸ªè¯ã€‚</p>
</blockquote>
<a id="more"></a>
<h3 id="TF-IDF"><a href="#TF-IDF" class="headerlink" title="TF-IDF"></a>TF-IDF</h3><h4 id="TF"><a href="#TF" class="headerlink" title="TF"></a>TF</h4><p>è¡¨ç¤ºè¯æ¡ï¼ˆå…³é”®å­—ï¼‰åœ¨æ–‡æœ¬ä¸­å‡ºç°çš„æ¬¡æ•°ï¼ˆfrequencyï¼‰(ä¸€èˆ¬ä¸ç”¨)ã€‚TF èƒŒåçš„éšå«çš„å‡è®¾æ˜¯ï¼ŒæŸ¥è¯¢å…³é”®å­—ä¸­çš„å•è¯åº”è¯¥ç›¸å¯¹äºå…¶ä»–å•è¯æ›´åŠ é‡è¦ï¼Œè€Œæ–‡æ¡£çš„é‡è¦ç¨‹åº¦ï¼Œä¹Ÿå°±æ˜¯ç›¸å…³åº¦ï¼Œä¸å•è¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°æˆæ­£æ¯”ã€‚æ¯”å¦‚ï¼Œâ€œCarâ€ è¿™ä¸ªå•è¯åœ¨æ–‡æ¡£ A é‡Œå‡ºç°äº† 5 æ¬¡ï¼Œè€Œåœ¨æ–‡æ¡£ B é‡Œå‡ºç°äº† 20 æ¬¡ï¼Œé‚£ä¹ˆ TF è®¡ç®—å°±è®¤ä¸ºæ–‡æ¡£ B å¯èƒ½æ›´ç›¸å…³ã€‚</p>
<h5 id="å˜ç§ä¸€-é€šè¿‡å¯¹æ•°å‡½æ•°é¿å…-TF-çº¿æ€§å¢é•¿"><a href="#å˜ç§ä¸€-é€šè¿‡å¯¹æ•°å‡½æ•°é¿å…-TF-çº¿æ€§å¢é•¿" class="headerlink" title="å˜ç§ä¸€:é€šè¿‡å¯¹æ•°å‡½æ•°é¿å… TF çº¿æ€§å¢é•¿"></a>å˜ç§ä¸€:é€šè¿‡å¯¹æ•°å‡½æ•°é¿å… TF çº¿æ€§å¢é•¿</h5><p>ç†ç”±ï¼šè™½ç„¶æˆ‘ä»¬ä¸€èˆ¬è®¤ä¸ºä¸€ä¸ªæ–‡æ¡£åŒ…å«æŸ¥è¯¢å…³é”®è¯å¤šæ¬¡ç›¸å¯¹æ¥è¯´è¡¨è¾¾äº†æŸç§ç›¸å…³åº¦ï¼Œä½†è¿™æ ·çš„å…³ç³»å¾ˆéš¾è¯´æ˜¯çº¿æ€§çš„ã€‚ä»¥ â€œCar Insuranceâ€ ä¸ºä¾‹ï¼Œæ–‡æ¡£ A å¯èƒ½åŒ…å« â€œCarâ€ è¿™ä¸ªè¯ 100 æ¬¡ï¼Œè€Œæ–‡æ¡£ B å¯èƒ½åŒ…å« 200 æ¬¡ï¼Œæ˜¯ä¸æ˜¯è¯´æ–‡æ¡£ B çš„ç›¸å…³åº¦å°±æ˜¯æ–‡æ¡£ A çš„ 2 å€å‘¢ï¼Ÿå…¶å®ï¼Œå½“è¿™ç§é¢‘æ¬¡è¶…è¿‡äº†æŸä¸ªé˜ˆå€¼ä¹‹åï¼Œè¿™ä¸ª TF ä¹Ÿå°±æ²¡é‚£ä¹ˆæœ‰åŒºåˆ†åº¦äº†ã€‚</p>
<p><strong>ç”¨ Logï¼Œä¹Ÿå°±æ˜¯å¯¹æ•°å‡½æ•°ï¼Œå¯¹ TF è¿›è¡Œå˜æ¢ï¼Œå°±æ˜¯ä¸€ä¸ªä¸è®© TF çº¿æ€§å¢é•¿çš„æŠ€å·§</strong>ã€‚å…·ä½“æ¥è¯´ï¼Œäººä»¬å¸¸å¸¸ç”¨ 1+Log(TF) è¿™ä¸ªå€¼æ¥ä»£æ›¿åŸæ¥çš„ TF å–å€¼ã€‚åœ¨è¿™æ ·æ–°çš„è®¡ç®—ä¸‹ï¼Œå‡è®¾ â€œCarâ€ å‡ºç°ä¸€æ¬¡ï¼Œæ–°çš„å€¼æ˜¯ 1ï¼Œå‡ºç° 100 æ¬¡ï¼Œæ–°çš„å€¼æ˜¯ $log 100=5.6$ï¼Œè€Œå‡ºç° 200 æ¬¡ï¼Œæ–°çš„å€¼æ˜¯$log 200 = 6.3$ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™æ ·çš„è®¡ç®—ä¿æŒäº†ä¸€ä¸ªå¹³è¡¡ï¼Œæ—¢æœ‰åŒºåˆ†åº¦ï¼Œä½†ä¹Ÿä¸è‡³äºå®Œå…¨çº¿æ€§å¢é•¿ã€‚</p>
<h5 id="å˜ç§äºŒï¼šæ ‡å‡†åŒ–è§£å†³é•¿æ–‡æ¡£ã€çŸ­æ–‡æ¡£é—®é¢˜"><a href="#å˜ç§äºŒï¼šæ ‡å‡†åŒ–è§£å†³é•¿æ–‡æ¡£ã€çŸ­æ–‡æ¡£é—®é¢˜" class="headerlink" title="å˜ç§äºŒï¼šæ ‡å‡†åŒ–è§£å†³é•¿æ–‡æ¡£ã€çŸ­æ–‡æ¡£é—®é¢˜"></a>å˜ç§äºŒï¼šæ ‡å‡†åŒ–è§£å†³é•¿æ–‡æ¡£ã€çŸ­æ–‡æ¡£é—®é¢˜</h5><p>ç»å…¸çš„è®¡ç®—å¹¶æ²¡æœ‰è€ƒè™‘ â€œé•¿æ–‡æ¡£â€ å’Œâ€œçŸ­æ–‡æ¡£â€çš„åŒºåˆ«ã€‚ä¸€ä¸ªæ–‡æ¡£ A æœ‰ 3,000 ä¸ªå•è¯ï¼Œä¸€ä¸ªæ–‡æ¡£ B æœ‰ 250 ä¸ªå•è¯ï¼Œå¾ˆæ˜æ˜¾ï¼Œå³ä¾¿ â€œCarâ€ åœ¨è¿™ä¸¤ä¸ªæ–‡æ¡£ä¸­éƒ½åŒæ ·å‡ºç°è¿‡ 20 æ¬¡ï¼Œä¹Ÿä¸èƒ½è¯´è¿™ä¸¤ä¸ªæ–‡æ¡£éƒ½åŒç­‰ç›¸å…³ã€‚<strong>å¯¹ TF è¿›è¡Œ â€œæ ‡å‡†åŒ–â€ï¼ˆNormalizationï¼‰ï¼Œç‰¹åˆ«æ˜¯æ ¹æ®æ–‡æ¡£çš„æœ€å¤§ TF å€¼è¿›è¡Œçš„æ ‡å‡†åŒ–ï¼Œæˆäº†å¦å¤–ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„æŠ€å·§</strong>ã€‚</p>
<script type="math/tex; mode=display">
tf_{ij} = \frac{n_{i,j}}{\sum_k n_{k,j}}</script><p>å…¶ä¸­$n_{i,j}$æ˜¯è¯$w_i$åœ¨æ–‡æ¡£$d_j$ä¸­å‡ºç°çš„æ¬¡æ•°ï¼Œåˆ†æ¯æ˜¯æ–‡æ¡£$d_j$ä¸­æ‰€æœ‰è¯æ±‡å‡ºç°çš„æ¬¡æ•°æ€»å’Œã€‚</p>
<h4 id="IDF"><a href="#IDF" class="headerlink" title="IDF"></a>IDF</h4><p>ä»…æœ‰ TF ä¸èƒ½æ¯”è¾ƒå®Œæ•´åœ°æè¿°æ–‡æ¡£çš„ç›¸å…³åº¦ã€‚å› ä¸ºè¯­è¨€çš„å› ç´ ï¼Œæœ‰ä¸€äº›å•è¯å¯èƒ½ä¼šæ¯”è¾ƒè‡ªç„¶åœ°åœ¨å¾ˆå¤šæ–‡æ¡£ä¸­åå¤å‡ºç°ï¼Œæ¯”å¦‚è‹±è¯­ä¸­çš„ â€œTheâ€ã€â€œAnâ€ã€â€œButâ€ ç­‰ç­‰ã€‚è¿™äº›è¯å¤§å¤šèµ·åˆ°äº†é“¾æ¥è¯­å¥çš„ä½œç”¨ï¼Œæ˜¯ä¿æŒè¯­è¨€è¿è´¯ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬è¦æœç´¢ â€œHow to Build A Carâ€ è¿™ä¸ªå…³é”®è¯ï¼Œå…¶ä¸­çš„ â€œHowâ€ã€â€œToâ€ ä»¥åŠ â€œAâ€ éƒ½æå¯èƒ½åœ¨ç»å¤§å¤šæ•°çš„æ–‡æ¡£ä¸­å‡ºç°ï¼Œè¿™ä¸ªæ—¶å€™ TF å°±æ— æ³•å¸®åŠ©æˆ‘ä»¬åŒºåˆ†æ–‡æ¡£çš„ç›¸å…³åº¦äº†ã€‚</p>
<p>é€†æ–‡æ¡£é¢‘ç‡çš„æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦å» â€œæƒ©ç½šâ€ï¼ˆPenalizeï¼‰é‚£äº›å‡ºç°åœ¨å¤ªå¤šæ–‡æ¡£ä¸­çš„å•è¯ã€‚</p>
<h5 id="å˜ç§ä¸‰ï¼šå¯¹æ•°å‡½æ•°å¤„ç†-IDF"><a href="#å˜ç§ä¸‰ï¼šå¯¹æ•°å‡½æ•°å¤„ç†-IDF" class="headerlink" title="å˜ç§ä¸‰ï¼šå¯¹æ•°å‡½æ•°å¤„ç† IDF"></a>å˜ç§ä¸‰ï¼šå¯¹æ•°å‡½æ•°å¤„ç† IDF</h5><p>æŸä¸€ç‰¹å®šè¯è¯­çš„IDFï¼Œå¯ä»¥ç”±æ€»æ–‡ä»¶æ•°ç›®é™¤ä»¥åŒ…å«è¯¥è¯è¯­çš„æ–‡ä»¶çš„æ•°ç›®ï¼Œå†å°†å¾—åˆ°çš„å•†å–å¯¹æ•°å¾—åˆ°ã€‚å¦‚æœåŒ…å«è¯æ¡tçš„æ–‡æ¡£è¶Šå°‘, IDFè¶Šå¤§ï¼Œåˆ™è¯´æ˜è¯æ¡å…·æœ‰å¾ˆå¥½çš„ç±»åˆ«åŒºåˆ†èƒ½åŠ›ã€‚</p>
<script type="math/tex; mode=display">
idf_w = log{\frac{|D|}{|j:t_i \in d_j|}}</script><p>å…¶ä¸­ï¼Œ$|D|$è¡¨ç¤ºè¯­æ–™åº“ä¸­æ–‡æ¡£æ€»æ•°ï¼Œåˆ†æ¯ä¸ºåŒ…å«è¯wçš„æ–‡æ¡£æ•°+1ï¼Œåˆ†æ¯åŠ 1æ˜¯ä¸ºäº†é¿å…å‡ºç°åˆ†æ¯ä¸ºé›¶çš„æƒ…å†µã€‚</p>
<p>æ ·åšçš„å¥½å¤„å°±æ˜¯ï¼Œç¬¬ä¸€ï¼Œä½¿ç”¨äº†æ–‡æ¡£æ€»æ•°æ¥åšæ ‡å‡†åŒ–ï¼Œå¾ˆç±»ä¼¼ä¸Šé¢æåˆ°çš„æ ‡å‡†åŒ–çš„æ€è·¯ï¼›ç¬¬äºŒï¼Œåˆ©ç”¨å¯¹æ•°æ¥è¾¾åˆ°éçº¿æ€§å¢é•¿çš„ç›®çš„ã€‚</p>
<h5 id="å˜ç§å››ï¼šæŸ¥è¯¢è¯åŠæ–‡æ¡£å‘é‡æ ‡å‡†åŒ–"><a href="#å˜ç§å››ï¼šæŸ¥è¯¢è¯åŠæ–‡æ¡£å‘é‡æ ‡å‡†åŒ–" class="headerlink" title="å˜ç§å››ï¼šæŸ¥è¯¢è¯åŠæ–‡æ¡£å‘é‡æ ‡å‡†åŒ–"></a>å˜ç§å››ï¼šæŸ¥è¯¢è¯åŠæ–‡æ¡£å‘é‡æ ‡å‡†åŒ–</h5><p>å¯¹æŸ¥è¯¢å…³é”®å­—å‘é‡ï¼Œä»¥åŠæ–‡æ¡£å‘é‡è¿›è¡Œæ ‡å‡†åŒ–ï¼Œä½¿å¾—è¿™äº›å‘é‡èƒ½å¤Ÿä¸å—å‘é‡é‡Œæœ‰æ•ˆå…ƒç´ å¤šå°‘çš„å½±å“ï¼Œä¹Ÿå°±æ˜¯ä¸åŒçš„æ–‡æ¡£å¯èƒ½æœ‰ä¸åŒçš„é•¿åº¦ã€‚åœ¨çº¿æ€§ä»£æ•°é‡Œï¼Œå¯ä»¥æŠŠå‘é‡éƒ½æ ‡å‡†åŒ–ä¸ºä¸€ä¸ªå•ä½å‘é‡çš„é•¿åº¦ã€‚è¿™ä¸ªæ—¶å€™å†è¿›è¡Œç‚¹ç§¯è¿ç®—ï¼Œå°±ç›¸å½“äºåœ¨åŸæ¥çš„å‘é‡ä¸Šè¿›è¡Œä½™å¼¦ç›¸ä¼¼åº¦çš„è¿ç®—ã€‚æ‰€ä»¥ï¼Œå¦å¤–ä¸€ä¸ªè§’åº¦åˆ©ç”¨è¿™ä¸ªè§„åˆ™å°±æ˜¯ç›´æ¥åœ¨å¤šæ•°æ—¶å€™è¿›è¡Œä½™å¼¦ç›¸ä¼¼åº¦è¿ç®—ï¼Œä»¥ä»£æ›¿ç‚¹ç§¯è¿ç®—ã€‚</p>
<h4 id="TF-IDF-1"><a href="#TF-IDF-1" class="headerlink" title="TF-IDF"></a>TF-IDF</h4><p>æŸä¸€ç‰¹å®šæ–‡ä»¶å†…çš„é«˜è¯è¯­é¢‘ç‡ï¼Œä»¥åŠè¯¥è¯è¯­åœ¨æ•´ä¸ªæ–‡ä»¶é›†åˆä¸­çš„ä½æ–‡ä»¶é¢‘ç‡ï¼Œå¯ä»¥äº§ç”Ÿå‡ºé«˜æƒé‡çš„TF-IDFã€‚å› æ­¤ï¼ŒTF-IDFå€¾å‘äºè¿‡æ»¤æ‰å¸¸è§çš„è¯è¯­ï¼Œä¿ç•™é‡è¦çš„è¯è¯­(å…³é”®è¯)ã€‚</p>
<script type="math/tex; mode=display">
TF-IDF = TF * IDF</script><h3 id="TF-IDF-çš„åº”ç”¨"><a href="#TF-IDF-çš„åº”ç”¨" class="headerlink" title="TF-IDF çš„åº”ç”¨"></a>TF-IDF çš„åº”ç”¨</h3><ol>
<li>æœç´¢å¼•æ“</li>
<li>å…³é”®è¯æå–</li>
<li>æ–‡æœ¬ç›¸ä¼¼æ€§</li>
<li>æ–‡æœ¬æ‘˜è¦</li>
</ol>
<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>å…·ä½“å®ç°ï¼Œç§»æ­¥<a href="https://github.com/jeffery0628/keyword_extraction" target="_blank" rel="noopener">GitHub</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf_idf</span><span class="params">(document, corpus)</span>:</span>  <span class="comment"># è®¡ç®—TF-IDF,å¹¶è¿”å›å­—å…¸</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param document: è®¡ç®—documenté‡Œé¢æ¯ä¸ªè¯çš„tfidfå€¼ï¼Œdocumentä¸ºæ–‡æœ¬åˆ†è¯åçš„å½¢å¼ï¼Œ</span></span><br><span class="line"><span class="string">    å¦‚:[6 æœˆ 19 æ—¥ 2012 å¹´åº¦ ä¸­å›½ çˆ±å¿ƒ åŸå¸‚ å…¬ç›Šæ´»åŠ¨ æ–°é—» å‘å¸ƒä¼š åœ¨äº¬ä¸¾è¡Œ]</span></span><br><span class="line"><span class="string">    å¦‚æœæ˜¯å¯¹ä¸€ç¯‡æ–‡æ¡£è¿›è¡Œå…³é”®è¯æå–ï¼Œåˆ™éœ€è¦å¯¹æ–‡æ¡£è¿›è¡Œåˆ†å¥ï¼ŒæŠŠæ¯å¥è¯çœ‹æˆä¸€ä¸ªdocumentï¼Œcorpusåˆ™å­˜æ”¾çš„æ˜¯æ•´ç¯‡æ–‡æ¡£åˆ†è¯åçš„æ‰€æœ‰å¥å­ï¼ˆå¥å­ä¸ºåˆ†è¯åçš„ç»“æœï¼‰ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param corpus:  corpusä¸ºæ‰€æœ‰é—®å½“åˆ†è¯åçš„åˆ—è¡¨ï¼š[document1,document2,document3,...]</span></span><br><span class="line"><span class="string">    :return:dictç±»å‹ï¼ŒæŒ‰ç…§tfidfå€¼ä»å¤§åˆ°å°æ’åºï¼š orderdict[word] = tfidf_value</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    word_tfidf = &#123;&#125;</span><br><span class="line">    <span class="comment"># è®¡ç®—è¯é¢‘</span></span><br><span class="line">    freq_words = Counter(document)</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> freq_words:</span><br><span class="line">        <span class="comment"># è®¡ç®—TFï¼šæŸä¸ªè¯åœ¨æ–‡ç« ä¸­å‡ºç°çš„æ¬¡æ•°/æ–‡ç« æ€»è¯æ•°</span></span><br><span class="line">        tf = freq_words[word] / len(document)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—IDFï¼šlog(è¯­æ–™åº“çš„æ–‡æ¡£æ€»æ•°/(åŒ…å«è¯¥è¯çš„æ–‡æ¡£æ•°+1))</span></span><br><span class="line">        idf = math.log(len(corpus) / (wordinfilecount(word, corpus) + <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—æ¯ä¸ªè¯çš„TFIDFå€¼</span></span><br><span class="line">        tfidf = tf * idf  <span class="comment"># è®¡ç®—TF-IDF</span></span><br><span class="line">        word_tfidf[word] = tfidf</span><br><span class="line"></span><br><span class="line">    orderdic = sorted(word_tfidf.items(), key=<span class="keyword">lambda</span> item: item[<span class="number">1</span>], reverse=<span class="literal">True</span>)  <span class="comment"># ç»™å­—å…¸æ’åº</span></span><br><span class="line">    <span class="keyword">return</span> orderdic</span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    stop_words_path = <span class="string">r'stop_words.txt'</span>  <span class="comment"># åœç”¨è¯è¡¨è·¯å¾„</span></span><br><span class="line">    stop_words = get_stopwords(stop_words_path)  <span class="comment"># è·å–åœç”¨è¯è¡¨åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">    documents_dir = <span class="string">'data'</span></span><br><span class="line">    filelist = get_documents(documents_dir)  <span class="comment"># è·å–æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">    corpus = get_corpus(filelist, stop_words)  <span class="comment"># å»ºç«‹è¯­æ–™åº“</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx,document <span class="keyword">in</span> enumerate(corpus):</span><br><span class="line">        word_tfidf = tf_idf(document, corpus)  <span class="comment"># è®¡ç®—TF-IDF</span></span><br><span class="line">        <span class="comment"># è¾“å‡ºå‰åå…³é”®è¯</span></span><br><span class="line">        print(<span class="string">'document &#123;&#125;,top 10 key words&#123;&#125;'</span>.format(idx+<span class="number">1</span>,word_tfidf[:<span class="number">10</span>]))</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨scikit-learn è®¡ç®—tfidf<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfTransformer, TfidfVectorizer</span><br><span class="line"><span class="comment"># å¯¹è¯­æ–™è¿›è¡Œç¨å¾®å¤„ç†</span></span><br><span class="line">corpus = [*map(<span class="keyword">lambda</span> x:<span class="string">" "</span>.join(x), corpus)]</span><br><span class="line">tfidf_model = TfidfVectorizer()</span><br><span class="line">tfidf_matrix = tfidf_model.fit_transform(corpus)  <span class="comment"># è®¡ç®—æ¯ä¸ªè¯çš„tfidfå€¼</span></span><br><span class="line">words = tfidf_model.get_feature_names()<span class="comment"># æ‰€æœ‰è¯çš„é›†åˆ</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(corpus)):</span><br><span class="line">  	word_tfidf = &#123;&#125;</span><br><span class="line">  	<span class="keyword">for</span> j <span class="keyword">in</span> range(len(words)):</span><br><span class="line">        word_tfidf[words[j]] = tfidf_matrix[i, j]</span><br><span class="line">        word_tfidf = sorted(word_tfidf.items(),key=<span class="keyword">lambda</span> item:item[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br><span class="line">        print(<span class="string">'document &#123;&#125;,top 10 key words&#123;&#125;'</span>.format(i+<span class="number">1</span>, word_tfidf[:<span class="number">10</span>]))</span><br></pre></td></tr></table></figure></p>
<h2 id="TextRank-æå–å…³é”®è¯"><a href="#TextRank-æå–å…³é”®è¯" class="headerlink" title="TextRank æå–å…³é”®è¯"></a>TextRank æå–å…³é”®è¯</h2><h3 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>TF-IDF ç®—æ³•å¯¹æœ‰å¤šæ®µæ–‡æœ¬çš„å…³é”®è¯æå–éå¸¸æœ‰æ•ˆï¼Œä½†æ˜¯å¯¹äºå•ç¯‡æˆ–è€…æ–‡æ¡£åˆ†å‰²è¾ƒå°‘çš„æ–‡æœ¬è¡¨ç°å¾—ä¸æ˜¯ç‰¹åˆ«å¥½ã€‚å¦‚æœéœ€è¦æå–å…³é”®è¯çš„è¯­å¥åªæœ‰ä¸€å¥è¯ï¼Œé‚£ä¹ˆåŸºäºTF-IDFå¯ä»¥çŸ¥é“ï¼Œæ‰€æœ‰å…³é”®è¯çš„é‡è¦åº¦éƒ½ä¸º0(å› ä¸ºIDFå€¼ä¸º0)ï¼Œè¿™ç§æƒ…å†µä¸‹ä½¿ç”¨TextRankæ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚</p>
<p>TextRankæ˜¯ä¸€ç§åŸºäºå›¾æ’åºçš„ç®—æ³•ï¼ŒåŸºæœ¬æ€æƒ³æ˜¯(æ¥æºäºPageRank)ï¼šé€šè¿‡æŠŠæ–‡æœ¬åˆ†å‰²æˆè‹¥å¹²ç»„æˆå•å…ƒ(å•è¯ã€å¥å­)å¹¶å»ºç«‹å›¾æ¨¡å‹ï¼Œåˆ©ç”¨æŠ•ç¥¨æœºåˆ¶å¯¹æ–‡æœ¬ä¸­çš„é‡è¦æˆåˆ†è¿›è¡Œæ’åºï¼Œ<strong>ä»…åˆ©ç”¨å•ç¯‡æ–‡æ¡£æœ¬èº«çš„ä¿¡æ¯å°±å¯ä»¥å®ç°å…³é”®è¯æå–ã€æ–‡æœ¬æ‘˜è¦</strong>ã€‚å’Œ LDAã€HMM ç­‰æ¨¡å‹ä¸åŒ, TextRankä¸éœ€è¦äº‹å…ˆå¯¹å¤šç¯‡æ–‡æ¡£è¿›è¡Œå­¦ä¹ è®­ç»ƒ, å› å…¶ç®€æ´æœ‰æ•ˆè€Œå¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</p>
<h3 id="PageRank"><a href="#PageRank" class="headerlink" title="PageRank"></a>PageRank</h3><h4 id="PageRank-çš„ç®€åŒ–æ¨¡å‹"><a href="#PageRank-çš„ç®€åŒ–æ¨¡å‹" class="headerlink" title="PageRank çš„ç®€åŒ–æ¨¡å‹"></a>PageRank çš„ç®€åŒ–æ¨¡å‹</h4><p>å‡è®¾ä¸€å…±æœ‰ 4 ä¸ªç½‘é¡µ Aã€Bã€Cã€Dã€‚å®ƒä»¬ä¹‹é—´çš„é“¾æ¥ä¿¡æ¯å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/04/21/%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8A%BD%E5%8F%96/pagerank.png" alt="avatar"></p>
<p>å‡ºé“¾æŒ‡çš„æ˜¯é“¾æ¥å‡ºå»çš„é“¾æ¥ã€‚å…¥é“¾æŒ‡çš„æ˜¯é“¾æ¥è¿›æ¥çš„é“¾æ¥ã€‚æ¯”å¦‚å›¾ä¸­ A æœ‰ 2 ä¸ªå…¥é“¾ï¼Œ3 ä¸ªå‡ºé“¾ã€‚ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªç½‘é¡µçš„å½±å“åŠ› = æ‰€æœ‰å…¥é“¾é›†åˆçš„é¡µé¢çš„åŠ æƒå½±å“åŠ›ä¹‹å’Œï¼Œç”¨å…¬å¼è¡¨ç¤ºä¸ºï¼š</p>
<script type="math/tex; mode=display">
P R(u)=\sum_{v \in B_{u}} \frac{P R(v)}{L(v)}</script><p>u ä¸ºå¾…è¯„ä¼°çš„é¡µé¢ï¼Œ $B_{u}$ ä¸ºé¡µé¢ $u$ çš„å…¥é“¾é›†åˆã€‚é’ˆå¯¹å…¥é“¾é›†åˆä¸­çš„ä»»æ„é¡µé¢ $v$ï¼Œå®ƒèƒ½ç»™ $u$ å¸¦æ¥çš„å½±å“åŠ›æ˜¯å…¶è‡ªèº«çš„å½±å“åŠ› $PR(v)$ é™¤ä»¥ $v$ é¡µé¢çš„å‡ºé“¾æ•°é‡ï¼Œå³é¡µé¢ $v$ æŠŠå½±å“åŠ› $PR(v)$ å¹³å‡åˆ†é…ç»™äº†å®ƒçš„å‡ºé“¾ï¼Œè¿™æ ·ç»Ÿè®¡æ‰€æœ‰èƒ½ç»™ $u$ å¸¦æ¥é“¾æ¥çš„é¡µé¢ $v$ï¼Œå¾—åˆ°çš„æ€»å’Œå°±æ˜¯ç½‘é¡µ $u$ çš„å½±å“åŠ›ï¼Œå³ä¸º $PR(u)$ã€‚æ‰€ä»¥å‡ºé“¾ä¼šç»™è¢«é“¾æ¥çš„é¡µé¢èµ‹äºˆå½±å“åŠ›ï¼Œå½“æˆ‘ä»¬ç»Ÿè®¡äº†ä¸€ä¸ªç½‘é¡µé“¾å‡ºå»çš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯ç»Ÿè®¡äº†è¿™ä¸ªç½‘é¡µçš„è·³è½¬æ¦‚ç‡ã€‚</p>
<p>åœ¨ä¾‹å­ä¸­ï¼ŒA æœ‰ä¸‰ä¸ªå‡ºé“¾åˆ†åˆ«é“¾æ¥åˆ°äº† Bã€Cã€D ä¸Šã€‚é‚£ä¹ˆå½“ç”¨æˆ·è®¿é—® A çš„æ—¶å€™ï¼Œå°±æœ‰è·³è½¬åˆ° Bã€C æˆ–è€… D çš„å¯èƒ½æ€§ï¼Œè·³è½¬æ¦‚ç‡å‡ä¸º 1/3ã€‚B æœ‰ä¸¤ä¸ªå‡ºé“¾ï¼Œé“¾æ¥åˆ°äº† A å’Œ D ä¸Šï¼Œè·³è½¬æ¦‚ç‡ä¸º 1/2ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° Aã€Bã€Cã€D è¿™å››ä¸ªç½‘é¡µçš„è½¬ç§»çŸ©é˜µ Mï¼š</p>
<script type="math/tex; mode=display">
M=\left[\begin{array}{cccc}
0 & 1 / 2 & 1 & 0 \\
1 / 3 & 0 & 0 & 1 / 2 \\
1 / 3 & 0 & 0 & 1 / 2 \\
1 / 3 & 1 / 2 & 0 & 0
\end{array}\right]</script><p>å‡è®¾ Aã€Bã€Cã€D å››ä¸ªé¡µé¢çš„åˆå§‹å½±å“åŠ›éƒ½æ˜¯ç›¸åŒçš„ï¼Œå³ï¼š</p>
<script type="math/tex; mode=display">
w_{0}=\left[\begin{array}{l}
1 / 4 \\
1 / 4 \\
1 / 4 \\
1 / 4
\end{array}\right]</script><p>å½“è¿›è¡Œç¬¬ä¸€æ¬¡è½¬ç§»ä¹‹åï¼Œå„é¡µé¢çš„å½±å“åŠ› $w_{1}$ å˜ä¸ºï¼š</p>
<script type="math/tex; mode=display">
w_1=Mw_0=\left[\begin{array}{cccc}
0 & 1 / 2 & 1 & 0 \\
1 / 3 & 0 & 0 & 1 / 2 \\
1 / 3 & 0 & 0 & 1 / 2 \\
1 / 3 & 1 / 2 & 0 & 0
\end{array}\right]\left[\begin{array}{c}
1 / 4 \\
1 / 4 \\
1 / 4 \\
1 / 4
\end{array}\right]=\left[\begin{array}{c}
9 / 24 \\
5 / 24 \\
5 / 24 \\
5 / 24
\end{array}\right]</script><p>ç„¶åå†ç”¨è½¬ç§»çŸ©é˜µä¹˜ä»¥ $w_{1}$ å¾—åˆ° $w_{2}$ ç»“æœï¼Œç›´åˆ°ç¬¬ $n$ æ¬¡è¿­ä»£å $w_{n}$ å½±å“åŠ›ä¸å†å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥æ”¶æ•›åˆ° $(0.3333,0.2222,0.2222,0.2222$ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç€ Aã€Bã€Cã€D å››ä¸ªé¡µé¢æœ€ç»ˆå¹³è¡¡çŠ¶æ€ä¸‹çš„å½±å“åŠ›ã€‚èƒ½çœ‹å‡º A é¡µé¢ç›¸æ¯”äºå…¶ä»–é¡µé¢æ¥è¯´æƒé‡æ›´å¤§ï¼Œä¹Ÿå°±æ˜¯ PR å€¼æ›´é«˜ã€‚è€Œ Bã€Cã€D é¡µé¢çš„ PR å€¼ç›¸ç­‰ã€‚</p>
<h4 id="ç­‰çº§æ³„éœ²ï¼ˆRank-Leakï¼‰"><a href="#ç­‰çº§æ³„éœ²ï¼ˆRank-Leakï¼‰" class="headerlink" title="ç­‰çº§æ³„éœ²ï¼ˆRank Leakï¼‰"></a>ç­‰çº§æ³„éœ²ï¼ˆRank Leakï¼‰</h4><p>å¦‚æœä¸€ä¸ªç½‘é¡µæ²¡æœ‰å‡ºé“¾ï¼Œå°±åƒæ˜¯ä¸€ä¸ªé»‘æ´ä¸€æ ·ï¼Œå¸æ”¶äº†å…¶ä»–ç½‘é¡µçš„å½±å“åŠ›è€Œä¸é‡Šæ”¾ï¼Œæœ€ç»ˆä¼šå¯¼è‡´å…¶ä»–ç½‘é¡µçš„ PR å€¼ä¸º 0ã€‚</p>
<p><img src="/2020/04/21/%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8A%BD%E5%8F%96/rank_leak.png" alt="avatar"></p>
<h4 id="ç­‰çº§æ²‰æ²¡ï¼ˆRank-Sinkï¼‰"><a href="#ç­‰çº§æ²‰æ²¡ï¼ˆRank-Sinkï¼‰" class="headerlink" title="ç­‰çº§æ²‰æ²¡ï¼ˆRank Sinkï¼‰"></a>ç­‰çº§æ²‰æ²¡ï¼ˆRank Sinkï¼‰</h4><p>å¦‚æœä¸€ä¸ªç½‘é¡µåªæœ‰å‡ºé“¾ï¼Œæ²¡æœ‰å…¥é“¾ï¼Œè®¡ç®—çš„è¿‡ç¨‹è¿­ä»£ä¸‹æ¥ï¼Œä¼šå¯¼è‡´<strong>è¿™ä¸ªç½‘é¡µ</strong>çš„ PR å€¼ä¸º 0ï¼ˆä¹Ÿå°±æ˜¯ä¸å­˜åœ¨å…¬å¼ä¸­çš„ Vï¼‰ã€‚</p>
<p><img src="/2020/04/21/%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8A%BD%E5%8F%96/rank_sink.png" alt="avatar"></p>
<h4 id="è§£å†³æ–¹æ¡ˆï¼šéšæœºæµè§ˆ"><a href="#è§£å†³æ–¹æ¡ˆï¼šéšæœºæµè§ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼šéšæœºæµè§ˆ"></a>è§£å†³æ–¹æ¡ˆï¼šéšæœºæµè§ˆ</h4><p>ä¸ºäº†è§£å†³ç®€åŒ–æ¨¡å‹ä¸­å­˜åœ¨çš„ç­‰çº§æ³„éœ²å’Œç­‰çº§æ²‰æ²¡çš„é—®é¢˜ï¼Œæ‹‰é‡ŒÂ·ä½©å¥‡æå‡ºäº† PageRank çš„éšæœºæµè§ˆæ¨¡å‹ã€‚ä»–å‡è®¾äº†è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šç”¨æˆ·å¹¶ä¸éƒ½æ˜¯æŒ‰ç…§è·³è½¬é“¾æ¥çš„æ–¹å¼æ¥ä¸Šç½‘ï¼Œè¿˜æœ‰ä¸€ç§å¯èƒ½æ˜¯ä¸è®ºå½“å‰å¤„äºå“ªä¸ªé¡µé¢ï¼Œéƒ½æœ‰æ¦‚ç‡è®¿é—®åˆ°å…¶ä»–ä»»æ„çš„é¡µé¢ï¼Œæ¯”å¦‚è¯´ç”¨æˆ·å°±æ˜¯è¦ç›´æ¥è¾“å…¥ç½‘å€è®¿é—®å…¶ä»–é¡µé¢ï¼Œè™½ç„¶è¿™ä¸ªæ¦‚ç‡æ¯”è¾ƒå°ã€‚</p>
<p>æ‰€ä»¥ä»–å®šä¹‰äº†é˜»å°¼å› å­ dï¼Œè¿™ä¸ªå› å­ä»£è¡¨äº†ç”¨æˆ·æŒ‰ç…§è·³è½¬é“¾æ¥æ¥ä¸Šç½‘çš„æ¦‚ç‡ï¼Œé€šå¸¸å¯ä»¥å–ä¸€ä¸ªå›ºå®šå€¼ 0.85ï¼Œè€Œ 1-d=0.15 åˆ™ä»£è¡¨äº†ç”¨æˆ·ä¸æ˜¯é€šè¿‡è·³è½¬é“¾æ¥çš„æ–¹å¼æ¥è®¿é—®ç½‘é¡µçš„ï¼Œæ¯”å¦‚ç›´æ¥è¾“å…¥ç½‘å€ã€‚</p>
<script type="math/tex; mode=display">
P R(u)=\frac{1-d}{N}+d \sum_{v \in B_{u}} \frac{P R(v)}{L(v)}</script><p>å…¶ä¸­ $N$ ä¸ºç½‘é¡µæ€»æ•°ï¼Œè¿™æ ·æˆ‘ä»¬åˆå¯ä»¥é‡æ–°è¿­ä»£ç½‘é¡µçš„æƒé‡è®¡ç®—äº†ï¼ŒåŠ å…¥äº†é˜»å°¼å› å­ $d$ï¼Œä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†ç­‰çº§æ³„éœ²å’Œç­‰çº§æ²‰æ²¡çš„é—®é¢˜ã€‚é€šè¿‡æ•°å­¦å®šç†ä¹Ÿå¯ä»¥è¯æ˜ï¼Œæœ€ç»ˆ PageRank éšæœºæµè§ˆæ¨¡å‹æ˜¯å¯ä»¥æ”¶æ•›çš„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¾—åˆ°ä¸€ä¸ªç¨³å®šæ­£å¸¸çš„ PR å€¼ã€‚</p>
<h3 id="TextRank"><a href="#TextRank" class="headerlink" title="TextRank"></a>TextRank</h3><p>TextRanké€šè¿‡è¯ä¹‹é—´çš„ç›¸é‚»å…³ç³»æ„å»ºç½‘ç»œï¼Œç„¶åç”¨PageRankè¿­ä»£è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„rankå€¼ï¼Œæ’åºrankå€¼å³å¯å¾—åˆ°å…³é”®è¯ã€‚PageRankè¿­ä»£è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
P R\left(V_{i}\right)=(1-d)+d * \sum_{j \in \operatorname{In}\left(V_{i}\right)} \frac{1}{\left|O u t\left(V_{j}\right)\right|} P R\left(V_{j}\right)</script><p>å…¶ä¸­ï¼Œd:è¡¨ç¤ºé˜»å°¼ç³»æ•°ï¼Œä¸€èˆ¬ä¸º0.85ã€‚$V_i$ï¼šè¡¨ç¤ºå›¾ä¸­ä»»ä¸€èŠ‚ç‚¹ã€‚$In(V_i)$:è¡¨ç¤ºæŒ‡å‘é¡¶ç‚¹$V_i$çš„æ‰€æœ‰é¡¶ç‚¹çš„é›†åˆã€‚$|Out(V_j)|$ï¼šè¡¨ç¤ºç”±é¡¶ç‚¹$V_j$è¿æ¥å‡ºå»çš„æ‰€æœ‰é¡¶ç‚¹é›†åˆä¸ªæ•°ã€‚$PR(V_i)$ï¼šè¡¨ç¤ºé¡¶ç‚¹$V_i$çš„æœ€ç»ˆæ’åºæƒé‡ã€‚(ä¸pagerankå…¬å¼åŸºæœ¬ä¸€è‡´ã€‚)</p>
<p>ç½‘é¡µä¹‹é—´çš„é“¾æ¥å…³ç³»å¯ä»¥ç”¨å›¾è¡¨ç¤ºï¼Œé‚£ä¹ˆæ€ä¹ˆæŠŠä¸€ä¸ªå¥å­ï¼ˆå¯ä»¥çœ‹ä½œè¯çš„åºåˆ—ï¼‰æ„å»ºæˆå›¾å‘¢ï¼ŸTextRankå°†æŸä¸€ä¸ªè¯ä¸å…¶å‰é¢çš„Nä¸ªè¯ã€ä»¥åŠåé¢çš„Nä¸ªè¯å‡å…·æœ‰å›¾ç›¸é‚»å…³ç³»ï¼ˆç±»ä¼¼äºN-gramè¯­æ³•æ¨¡å‹ï¼‰ã€‚å…·ä½“å®ç°ï¼šè®¾ç½®ä¸€ä¸ªé•¿åº¦ä¸ºNçš„æ»‘åŠ¨çª—å£ï¼Œæ‰€æœ‰åœ¨è¿™ä¸ªçª—å£ä¹‹å†…çš„è¯éƒ½è§†ä½œè¯ç»“ç‚¹çš„ç›¸é‚»ç»“ç‚¹ï¼›åˆ™TextRankæ„å»ºçš„è¯å›¾ä¸ºæ— å‘å›¾ã€‚ä¸‹å›¾ç»™å‡ºäº†ç”±ä¸€ä¸ªæ–‡æ¡£æ„å»ºçš„è¯å›¾ï¼ˆå»æ‰äº†åœç”¨è¯å¹¶æŒ‰è¯æ€§åšäº†ç­›é€‰ï¼‰ï¼š</p>
<p><img src="/2020/04/21/%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8A%BD%E5%8F%96/textrank.png" alt="avatar"></p>
<p>è€ƒè™‘åˆ°ä¸åŒè¯å¯¹å¯èƒ½æœ‰ä¸åŒçš„å…±ç°ï¼ˆco-occurrenceï¼‰ï¼ŒTextRankå°†å…±ç°ä½œä¸ºæ— å‘å›¾è¾¹çš„æƒå€¼ã€‚é‚£ä¹ˆï¼ŒTextRankçš„è¿­ä»£è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
W S\left(V_{i}\right)=(1-d)+d * \sum_{j \in \operatorname{In}\left(V_{i}\right)} \frac{w_{ij}}{\left|O u t\left(V_{j}\right)\right|} W S\left(V_{j}\right)</script><p>è¯¥å…¬å¼ä»…ä»…æ¯”PageRankå¤šäº†ä¸€ä¸ªæƒé‡é¡¹$w_{ij}$ï¼Œç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è¾¹è¿æ¥æœ‰ä¸åŒçš„é‡è¦ç¨‹åº¦ã€‚</p>
<h4 id="TextRank-å…³é”®è¯-çŸ­è¯­-æå–ç®—æ³•"><a href="#TextRank-å…³é”®è¯-çŸ­è¯­-æå–ç®—æ³•" class="headerlink" title="TextRank å…³é”®è¯(çŸ­è¯­)æå–ç®—æ³•"></a>TextRank å…³é”®è¯(çŸ­è¯­)æå–ç®—æ³•</h4><ol>
<li>æŠŠç»™å®šçš„æ–‡æœ¬$T$æŒ‰ç…§å®Œæ•´å¥å­è¿›è¡Œåˆ†å‰²ï¼Œå³$T = [S_1,S_2,\ldots,S_n]$.</li>
<li>æ–‡æœ¬$T$ä¸­æ¯ä¸ªå¥å­$S_i$ï¼Œè¿›è¡Œåˆ†è¯å’Œè¯æ€§æ ‡æ³¨å¤„ç†ï¼Œå¹¶è¿‡æ»¤æ‰åœç”¨è¯ï¼Œåªä¿ç•™æŒ‡å®šè¯æ€§çš„å•è¯ï¼Œå¦‚åè¯ã€åŠ¨è¯ã€å½¢å®¹è¯ï¼Œå³$S_i = [t_{i,1},t_{i,2},\ldots,t_{i,\pi}]$,å…¶ä¸­$t_{ij}$æ˜¯ä¿ç•™åçš„å€™é€‰å…³é”®è¯ã€‚</li>
<li>æ„å»ºå€™é€‰å…³é”®è¯å›¾$G = (V,E)$ï¼Œå…¶ä¸­$V$ä¸ºèŠ‚ç‚¹é›†ï¼Œç”±æ­¥éª¤2ç”Ÿæˆçš„å€™é€‰å…³é”®è¯ç»„æˆï¼Œç„¶åé‡‡ç”¨å…±ç°å…³ç³»ï¼ˆco-occurrenceï¼‰æ„é€ ä»»ä¸¤ç‚¹ä¹‹é—´çš„è¾¹ï¼Œä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´å­˜åœ¨è¾¹ä»…å½“å®ƒä»¬å¯¹åº”çš„è¯æ±‡åœ¨é•¿åº¦ä¸ºKçš„çª—å£ä¸­å…±ç°ï¼ŒKè¡¨ç¤ºçª—å£å¤§å°ï¼Œå³æœ€å¤šå…±ç°Kä¸ªå•è¯ã€‚</li>
<li>æ ¹æ®ä¸Šé¢å…¬å¼ï¼Œè¿­ä»£ä¼ æ’­å„èŠ‚ç‚¹çš„æƒé‡ï¼Œç›´è‡³æ”¶æ•›ã€‚</li>
<li>å¯¹èŠ‚ç‚¹æƒé‡è¿›è¡Œå€’åºæ’åºï¼Œä»è€Œå¾—åˆ°æœ€é‡è¦çš„Tä¸ªå•è¯ï¼Œä½œä¸ºå€™é€‰å…³é”®è¯ã€‚</li>
<li>ç”±æ­¥éª¤5å¾—åˆ°æœ€é‡è¦çš„Tä¸ªå•è¯ï¼Œåœ¨åŸå§‹æ–‡æœ¬ä¸­è¿›è¡Œæ ‡è®°ï¼Œè‹¥å½¢æˆç›¸é‚»è¯ç»„ï¼Œåˆ™ç»„åˆæˆå¤šè¯å…³é”®è¯ã€‚</li>
</ol>
<h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">import</span> jieba.posseg <span class="keyword">as</span> pseg</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">textrank_graph</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.graph = defaultdict(list) <span class="comment"># key:[(),(),(),...] å¦‚ï¼šæ˜¯ [('æ˜¯', 'å…¨å›½', 1), ('æ˜¯', 'è°ƒæŸ¥', 1), ('æ˜¯', 'å¤±ä¸šç‡', 1), ('æ˜¯', 'åŸé•‡', 1)]</span></span><br><span class="line">        self.d = <span class="number">0.85</span>  <span class="comment"># dæ˜¯é˜»å°¼ç³»æ•°ï¼Œä¸€èˆ¬è®¾ç½®ä¸º0.85</span></span><br><span class="line">        self.min_diff = <span class="number">1e-5</span>  <span class="comment"># è®¾å®šæ”¶æ•›é˜ˆå€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ·»åŠ èŠ‚ç‚¹ä¹‹é—´çš„è¾¹</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addEdge</span><span class="params">(self, start, end, weight)</span>:</span></span><br><span class="line">        self.graph[start].append((start, end, weight))</span><br><span class="line">        self.graph[end].append((end, start, weight))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># èŠ‚ç‚¹æ’åº</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rank</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># ä¸€å…±æœ‰14ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        print(len(self.graph))</span><br><span class="line">        <span class="comment"># é»˜è®¤åˆå§‹åŒ–æƒé‡</span></span><br><span class="line">        weight_deault = <span class="number">1.0</span> / (len(self.graph) <span class="keyword">or</span> <span class="number">1.0</span>)</span><br><span class="line">        <span class="comment"># nodeweight_dict, å­˜å‚¨èŠ‚ç‚¹çš„æƒé‡</span></span><br><span class="line">        nodeweight_dict = defaultdict(float)</span><br><span class="line">        <span class="comment"># outsumï¼Œå­˜å‚¨èŠ‚ç‚¹çš„å‡ºåº¦æƒé‡</span></span><br><span class="line">        outsum_node_dict = defaultdict(float)</span><br><span class="line">        <span class="comment"># æ ¹æ®å›¾ä¸­çš„è¾¹ï¼Œæ›´æ–°èŠ‚ç‚¹æƒé‡</span></span><br><span class="line">        <span class="keyword">for</span> node, out_edge <span class="keyword">in</span> self.graph.items():</span><br><span class="line">            <span class="comment"># æ˜¯ [('æ˜¯', 'å…¨å›½', 1), ('æ˜¯', 'è°ƒæŸ¥', 1), ('æ˜¯', 'å¤±ä¸šç‡', 1), ('æ˜¯', 'åŸé•‡', 1)]</span></span><br><span class="line">            nodeweight_dict[node] = weight_deault <span class="comment"># åˆå§‹åŒ–èŠ‚ç‚¹æƒé‡</span></span><br><span class="line">            outsum_node_dict[node] = sum((edge[<span class="number">2</span>] <span class="keyword">for</span> edge <span class="keyword">in</span> out_edge), <span class="number">0.0</span>) <span class="comment"># ç»Ÿè®¡nodeèŠ‚ç‚¹çš„å‡ºåº¦</span></span><br><span class="line">        <span class="comment"># åˆå§‹çŠ¶æ€ä¸‹çš„textranké‡è¦æ€§æƒé‡</span></span><br><span class="line">        sorted_keys = sorted(self.graph.keys())</span><br><span class="line">        <span class="comment"># è®¾å®šè¿­ä»£æ¬¡æ•°ï¼Œ</span></span><br><span class="line">        step_dict = [<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> step <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">            <span class="keyword">for</span> node <span class="keyword">in</span> sorted_keys:</span><br><span class="line">                s = <span class="number">0</span></span><br><span class="line">                <span class="comment"># è®¡ç®—å…¬å¼ï¼š(edge_weight/outsum_node_dict[edge_node])*node_weight[edge_node]</span></span><br><span class="line">                <span class="keyword">for</span> e <span class="keyword">in</span> self.graph[node]:</span><br><span class="line">                    s += e[<span class="number">2</span>] / outsum_node_dict[e[<span class="number">1</span>]] * nodeweight_dict[e[<span class="number">1</span>]]</span><br><span class="line">                <span class="comment"># è®¡ç®—å…¬å¼ï¼š(1-d) + d*s</span></span><br><span class="line">                nodeweight_dict[node] = (<span class="number">1</span> - self.d) + self.d * s</span><br><span class="line">            step_dict.append(sum(nodeweight_dict.values()))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> abs(step_dict[step] - step_dict[step - <span class="number">1</span>]) &lt;= self.min_diff:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆ©ç”¨Z-scoreè¿›è¡Œæƒé‡å½’ä¸€åŒ–ï¼Œä¹Ÿç§°ä¸ºç¦»å·®æ ‡å‡†åŒ–ï¼Œæ˜¯å¯¹åŸå§‹æ•°æ®çš„çº¿æ€§å˜æ¢ï¼Œä½¿ç»“æœå€¼æ˜ å°„åˆ°[0 - 1]ä¹‹é—´ã€‚</span></span><br><span class="line">        <span class="comment"># å…ˆè®¾å®šæœ€å¤§å€¼ä¸æœ€å°å€¼å‡ä¸ºç³»ç»Ÿå­˜å‚¨çš„æœ€å¤§å€¼å’Œæœ€å°å€¼</span></span><br><span class="line">        (min_rank, max_rank) = (sys.float_info[<span class="number">0</span>], sys.float_info[<span class="number">3</span>])</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> nodeweight_dict.values():</span><br><span class="line">            <span class="keyword">if</span> w &lt; min_rank:</span><br><span class="line">                min_rank = w</span><br><span class="line">            <span class="keyword">if</span> w &gt; max_rank:</span><br><span class="line">                max_rank = w</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> n, w <span class="keyword">in</span> nodeweight_dict.items(): <span class="comment"># å½’ä¸€åŒ–</span></span><br><span class="line">            nodeweight_dict[n] = (w - min_rank / <span class="number">10.0</span>) / (max_rank - min_rank / <span class="number">10.0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> nodeweight_dict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextRank</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.candi_pos = [<span class="string">'n'</span>, <span class="string">'v'</span>, <span class="string">'a'</span>] <span class="comment"># å…³é”®è¯çš„è¯æ€§ï¼šåè¯ï¼ŒåŠ¨è¯ï¼Œå½¢å®¹è¯</span></span><br><span class="line">        self.span = <span class="number">5</span> <span class="comment"># çª—å£å¤§å°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_keywords</span><span class="params">(self, text, num_keywords)</span>:</span></span><br><span class="line">        g = textrank_graph()</span><br><span class="line">        cm = defaultdict(int)</span><br><span class="line">        word_list = [[word.word, word.flag] <span class="keyword">for</span> word <span class="keyword">in</span> pseg.cut(text)] <span class="comment"># ä½¿ç”¨jiebaåˆ†è¯å¹¶ä¸”å¯¹è¯æ€§è¿›è¡Œæ ‡æ³¨</span></span><br><span class="line">        <span class="keyword">for</span> i, word <span class="keyword">in</span> enumerate(word_list): <span class="comment"># è¯¥å¾ªç¯ç”¨äºç»Ÿè®¡åœ¨çª—å£èŒƒå›´å†…ï¼Œè¯çš„å…±ç°æ¬¡æ•°</span></span><br><span class="line">            <span class="keyword">if</span> word[<span class="number">1</span>][<span class="number">0</span>] <span class="keyword">in</span> self.candi_pos <span class="keyword">and</span> len(word[<span class="number">0</span>]) &gt; <span class="number">1</span>: <span class="comment">#</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(i + <span class="number">1</span>, i + self.span):</span><br><span class="line">                    <span class="keyword">if</span> j &gt;= len(word_list):<span class="comment"># é˜²æ­¢ä¸‹æ ‡è¶Šç•Œ</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    <span class="keyword">if</span> word_list[j][<span class="number">1</span>][<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> self.candi_pos <span class="keyword">or</span> len(word_list[j][<span class="number">0</span>]) &lt; <span class="number">2</span>: <span class="comment"># æ’é™¤è¯æ€§ä¸åœ¨å…³é”®è¯è¯æ€§åˆ—è¡¨ä¸­çš„è¯æˆ–è€…è¯é•¿åº¦å°äº2çš„è¯</span></span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    pair = tuple((word[<span class="number">0</span>], word_list[j][<span class="number">0</span>]))</span><br><span class="line">                    cm[(pair)] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> terms, w <span class="keyword">in</span> cm.items():</span><br><span class="line">            g.addEdge(terms[<span class="number">0</span>], terms[<span class="number">1</span>], w)</span><br><span class="line">        nodes_rank = g.rank()</span><br><span class="line">        nodes_rank = sorted(nodes_rank.items(), key=<span class="keyword">lambda</span> asd:asd[<span class="number">1</span>], reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> nodes_rank[:num_keywords]</span><br></pre></td></tr></table></figure>
<h2 id="LDA-Latent-Dirichlet-Allocation-æå–å…³é”®è¯"><a href="#LDA-Latent-Dirichlet-Allocation-æå–å…³é”®è¯" class="headerlink" title="LDA (Latent Dirichlet Allocation) æå–å…³é”®è¯"></a>LDA (Latent Dirichlet Allocation) æå–å…³é”®è¯</h2><h3 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>TF-IDF å’Œ TextRank ä¸¤ç§ç®—æ³•æ›´å¤šåæ˜ çš„æ˜¯æ–‡æœ¬çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå¯¹äºæ–‡æœ¬ä¹‹é—´çš„è¯­ä¹‰å…³ç³»è€ƒè™‘å¾—æ¯”è¾ƒå°‘ã€‚LDAæ˜¯ä¸€ç§èƒ½å¤Ÿä½“æ–‡æœ¬è¯­ä¹‰å…³ç³»çš„å…³é”®è¯æå–æ–¹æ³•ã€‚</p>
<blockquote>
<p>äºŒé¡¹åˆ†å¸ƒï¼ˆBinomial Distributionï¼‰ï¼Œå³é‡å¤næ¬¡çš„ä¼¯åŠªåˆ©è¯•éªŒï¼ˆBernoulli Experimentï¼‰ï¼Œç”¨$\xi$è¡¨ç¤ºéšæœºè¯•éªŒçš„ç»“æœã€‚å¦‚æœäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡æ˜¯P,åˆ™ä¸å‘ç”Ÿçš„æ¦‚ç‡$q=1-p$ï¼Œ$N$æ¬¡ç‹¬ç«‹é‡å¤è¯•éªŒä¸­å‘ç”ŸKæ¬¡çš„æ¦‚ç‡æ˜¯$P(\xi=K)= C(n,k) <em> p^k </em> (1-p)^{n-k}$ï¼Œå…¶ä¸­$C(n, k) =\frac{n!}{(k!(n-k)!)}$. æœŸæœ›ï¼š$E(Î¾)=np$,æ–¹å·®ï¼š$D(Î¾)=npq$å…¶ä¸­$q=1-p$</p>
<p>å¤šé¡¹åˆ†å¸ƒï¼ˆMultinomial Distributionï¼‰ï¼šå¤šé¡¹å¼åˆ†å¸ƒæ˜¯äºŒé¡¹å¼åˆ†å¸ƒçš„æ¨å¹¿ã€‚äºŒé¡¹åˆ†å¸ƒçš„å…¸å‹ä¾‹å­æ˜¯æ‰”ç¡¬å¸ï¼Œç¡¬å¸æ­£é¢æœä¸Šæ¦‚ç‡ä¸ºp, é‡å¤æ‰”næ¬¡ç¡¬å¸ï¼Œkæ¬¡ä¸ºæ­£é¢çš„æ¦‚ç‡å³ä¸ºä¸€ä¸ªäºŒé¡¹åˆ†å¸ƒæ¦‚ç‡ã€‚æŠŠäºŒé¡¹åˆ†å¸ƒå…¬å¼æ¨å¹¿è‡³å¤šç§çŠ¶æ€ï¼Œå°±å¾—åˆ°äº†å¤šé¡¹åˆ†å¸ƒã€‚<br>æŸéšæœºå®éªŒå¦‚æœæœ‰kä¸ªå¯èƒ½ç»“å±€$A_1,A_2,\ldots,A_k$ï¼Œåˆ†åˆ«å°†ä»–ä»¬çš„å‡ºç°æ¬¡æ•°è®°ä¸ºéšæœºå˜é‡$X_1,X_2,\ldots,X_k$ï¼Œå®ƒä»¬çš„æ¦‚ç‡åˆ†å¸ƒåˆ†åˆ«æ˜¯$p_1,p_2,\ldots,p_k$é‚£ä¹ˆåœ¨$n$æ¬¡é‡‡æ ·çš„æ€»ç»“æœä¸­ï¼Œ$A_1$å‡ºç°$n_1$æ¬¡ã€$A_2$å‡ºç°$n_2$æ¬¡,$\dots$,$A_k$å‡ºç°$n_k$æ¬¡çš„è¿™ç§äº‹ä»¶çš„å‡ºç°æ¦‚ç‡$P$æœ‰ä¸‹é¢å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
P\left(X_{1}=n_{1}, \cdots, X_{k}=n_{k}\right)=\left\{\begin{array}{ll}
\frac{n !}{n_{1} ! \cdots n_{k} !} p_{1}^{n_{1}} \cdots p_{k}^{n_{k}} & , \sum_{i=1}^{k} n_{i}=n \\
0 & , \text { otherwise }
\end{array}\right.</script><p>Betaåˆ†å¸ƒä¸Dirichletåˆ†å¸ƒçš„å®šä¹‰åŸŸå‡ä¸º[0,1]ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œé€šå¸¸å°†ä¸¤è€…ä½œä¸ºæ¦‚ç‡çš„åˆ†å¸ƒï¼ŒBetaåˆ†å¸ƒæè¿°çš„æ˜¯å•å˜é‡åˆ†å¸ƒï¼ŒDirichletåˆ†å¸ƒæè¿°çš„æ˜¯å¤šå˜é‡åˆ†å¸ƒï¼Œå› æ­¤ï¼ŒBetaåˆ†å¸ƒå¯ä½œä¸ºäºŒé¡¹åˆ†å¸ƒçš„å…ˆéªŒæ¦‚ç‡ï¼ŒDirichletåˆ†å¸ƒå¯ä½œä¸ºå¤šé¡¹åˆ†å¸ƒçš„å…ˆéªŒæ¦‚ç‡ã€‚</p>
</blockquote>
<p>åœ¨ä¸»é¢˜æ¨¡å‹ä¸­ï¼Œä¸»é¢˜è¡¨ç¤ºä¸€ä¸ªæ¦‚å¿µï¼Œè¡¨ç°ä¸ºä¸€ç³»åˆ—ç›¸å…³çš„å•è¯ï¼Œæ˜¯è¿™äº›å•è¯çš„æ¡ä»¶æ¦‚ç‡ã€‚å½¢è±¡æ¥è¯´ï¼Œä¸»é¢˜å°±æ˜¯ä¸€ä¸ªæ¡¶ï¼Œé‡Œé¢è£…äº†å‡ºç°æ¦‚ç‡è¾ƒé«˜çš„å•è¯ï¼Œè¿™äº›å•è¯ä¸è¿™ä¸ªä¸»é¢˜æœ‰å¾ˆå¼ºçš„ç›¸å…³æ€§ã€‚</p>
<h3 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a>ç†è®º</h3><p>æ€æ ·æ‰èƒ½ç”Ÿæˆä¸»é¢˜ï¼Ÿå¯¹æ–‡ç« çš„ä¸»é¢˜åº”è¯¥æ€ä¹ˆåˆ†æï¼Ÿè¿™æ˜¯ä¸»é¢˜æ¨¡å‹è¦è§£å†³çš„é—®é¢˜ã€‚</p>
<p> é¦–å…ˆï¼Œå¯ä»¥ç”¨ç”Ÿæˆæ¨¡å‹æ¥çœ‹æ–‡æ¡£å’Œä¸»é¢˜è¿™ä¸¤ä»¶äº‹ã€‚æ‰€è°“ç”Ÿæˆæ¨¡å‹ï¼Œå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è®¤ä¸º<strong>ä¸€ç¯‡æ–‡ç« çš„æ¯ä¸ªè¯éƒ½æ˜¯é€šè¿‡â€œä»¥ä¸€å®šæ¦‚ç‡é€‰æ‹©äº†æŸä¸ªä¸»é¢˜ï¼Œå¹¶ä»è¿™ä¸ªä¸»é¢˜ä¸­ä»¥ä¸€å®šæ¦‚ç‡é€‰æ‹©æŸä¸ªè¯è¯­â€</strong>è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹å¾—åˆ°çš„ã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬è¦ç”Ÿæˆä¸€ç¯‡æ–‡æ¡£ï¼Œå®ƒé‡Œé¢çš„æ¯ä¸ªè¯è¯­å‡ºç°çš„æ¦‚ç‡ä¸ºï¼š</p>
<script type="math/tex; mode=display">
p(W|D) = \sum_T P(W|T)P(T|D)</script><p>å…¶ä¸­ï¼Œ$W$è¡¨ç¤ºè¯ï¼Œ$T$è¡¨ç¤ºä¸»é¢˜ï¼Œ$D$è¡¨ç¤ºæ–‡æ¡£ã€‚</p>
<p><img src="/2020/04/21/%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8A%BD%E5%8F%96/lda.png" alt="avatar"></p>
<p>å…¶ä¸­â€æ–‡æ¡£-è¯è¯­â€çŸ©é˜µè¡¨ç¤ºæ¯ä¸ªå•è¯åœ¨æ¯ä¸ªæ–‡æ¡£ä¸­çš„è¯é¢‘ï¼Œå³å‡ºç°çš„æ¦‚ç‡ï¼›â€ä¸»é¢˜-è¯è¯­â€çŸ©é˜µè¡¨ç¤ºæ¯ä¸ªä¸»é¢˜ä¸­æ¯ä¸ªå•è¯çš„å‡ºç°æ¦‚ç‡ï¼›â€æ–‡æ¡£-ä¸»é¢˜â€çŸ©é˜µè¡¨ç¤ºæ¯ä¸ªä¸»é¢˜åœ¨æ¯ä¸ªæ–‡æ¡£ä¸­å‡ºç°çš„æ¦‚ç‡ã€‚</p>
<p>å•è¯å¯¹äºä¸»é¢˜çš„æ¦‚ç‡å’Œä¸»é¢˜å¯¹äºæ–‡æ¡£çš„æ¦‚ç‡ï¼Œå¯ä»¥é€šè¿‡Gibbsé‡‡æ ·æ³•ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼‰æ¥è¿›è¡Œæ¦‚ç‡çš„è®¡ç®—ã€‚</p>
<p>ä¸»é¢˜$T_k$ä¸‹å„ä¸ªè¯$W_i$çš„æƒé‡è®¡ç®—å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
P(W_i|T_k) = \frac{C_{ik}+\beta}{\sum_{i=1}^N{C_{ik}+N*\beta}} = \phi_i^{t=k}</script><p>å…¶ä¸­ï¼Œ$w_i$ï¼šè¡¨ç¤ºå•è¯é›†åˆä¸­çš„ä»»ä¸€å•è¯ã€‚$T_k$:è¡¨ç¤ºä¸»é¢˜é›†åˆä¸­ä»»ä¸€ä¸»é¢˜ã€‚$P(w_i|T_k)$:è¡¨ç¤ºåœ¨ä¸»é¢˜ä¸º$k$æ—¶ï¼Œå•è¯$i$å‡ºç°çš„æ¦‚ç‡ï¼Œå…¶ç®€è®°ä¸º$\phi_i^{t=k}$ï¼Œ$C_{ik}$:è¡¨ç¤ºè¯­æ–™åº“ä¸­å•è¯$i$è¢«èµ‹äºˆä¸»é¢˜$k$çš„æ¬¡æ•°ã€‚$N$:è¡¨ç¤ºè¯æ±‡è¡¨çš„å¤§å°ã€‚$\beta$ï¼šè¡¨ç¤ºè¶…å‚æ•°ã€‚</p>
<p>æ–‡æ¡£$D_m$ä¸‹å„ä¸ªè¯$T_k$çš„æƒé‡è®¡ç®—å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
P(T_k|D_m) = \frac{C_{km}+\alpha}{\sum^K_{k=1}C_{km}+K*\alpha}=\theta^m_{t=k}</script><p>å…¶ä¸­ï¼Œ$D_m$:è¡¨ç¤ºæ–‡æ¡£é›†åˆä¸­ä»»ä¸€æ–‡æ¡£ã€‚$T_k$:è¡¨ç¤ºä¸»é¢˜é›†åˆä¸­ä»»ä¸€ä¸»é¢˜ã€‚$P(T_k|D_m)$:è¡¨ç¤ºè¯­æ–™åº“ä¸­æ–‡æ¡£mä¸­å•è¯è¢«èµ‹äºˆä¸»é¢˜$k$çš„æ¬¡æ•°ã€‚$K$ï¼šè¡¨ç¤ºä¸»é¢˜çš„æ•°é‡ã€‚$\alpha$è¡¨ç¤ºè¶…å‚æ•°ã€‚</p>
<p>å¾—åˆ°äº†æŒ‡å®šæ–‡æ¡£ä¸‹æŸä¸»é¢˜å‡ºç°çš„æ¦‚ç‡ï¼Œä»¥åŠæŒ‡å®šä¸»é¢˜ä¸‹ã€æŸå•è¯å‡ºç°çš„æ¦‚ç‡ã€‚é‚£ä¹ˆç”±è”åˆæ¦‚ç‡åˆ†å¸ƒå¯ä»¥çŸ¥é“ï¼Œå¯¹äºæŒ‡å®šæ–‡æ¡£æŸå•è¯å‡ºç°çš„æ¦‚ç‡ï¼š</p>
<script type="math/tex; mode=display">
P(W_i|D_m) = \sum_{k=1}^K{\phi_i^{t=k}*\theta_{t=k}^m}</script><p>åŸºäºä¸Šè¿°å…¬å¼ï¼Œå¯ä»¥è®¡ç®—å‡ºå•è¯$i$å¯¹äºæ–‡æ¡£$m$çš„ä¸»é¢˜é‡è¦æ€§ã€‚</p>
<p>ä½†æ˜¯ç”±äºåœ¨LDAä¸»é¢˜æ¦‚ç‡æ¨¡å‹ä¸­ï¼Œæ‰€æœ‰çš„è¯æ±‡éƒ½ä¼šä»¥ä¸€å®šçš„æ¦‚ç‡å‡ºç°åœ¨æ¯ä¸ªä¸»é¢˜ï¼Œæ‰€ä»¥è¿™æ ·ä¼šå¯¼è‡´æœ€ç»ˆè®¡ç®—çš„å•è¯å¯¹äºæ–‡æ¡£çš„ä¸»é¢˜é‡è¦æ€§åŒºåˆ†åº¦å—å½±å“ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬ä¼šå°†å•è¯ç›¸å¯¹äºä¸»é¢˜æ¦‚ç‡å°äºä¸€å®šé˜ˆå€¼çš„æ¦‚ç‡ç½®ä¸º0.</p>
<h3 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ä¸»é¢˜æ¨¡å‹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TopicModel</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># ä¸‰ä¸ªä¼ å…¥å‚æ•°ï¼šå¤„ç†åçš„æ•°æ®é›†ï¼Œå…³é”®è¯æ•°é‡ï¼Œå…·ä½“æ¨¡å‹ï¼ˆLSIã€LDAï¼‰ï¼Œä¸»é¢˜æ•°é‡</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, doc_list, keyword_num, model=<span class="string">'LDA'</span>, num_topics=<span class="number">4</span>)</span>:</span></span><br><span class="line">        <span class="comment"># ä½¿ç”¨gensimçš„æ¥å£ï¼Œå°†æ–‡æœ¬è½¬ä¸ºå‘é‡åŒ–è¡¨ç¤º</span></span><br><span class="line">        <span class="comment"># å…ˆæ„å»ºè¯ç©ºé—´</span></span><br><span class="line">        self.dictionary = corpora.Dictionary(doc_list)</span><br><span class="line">        <span class="comment"># ä½¿ç”¨BOWæ¨¡å‹å‘é‡åŒ– (token_id,freq)</span></span><br><span class="line">        corpus = [self.dictionary.doc2bow(doc) <span class="keyword">for</span> doc <span class="keyword">in</span> doc_list]  <span class="comment"># (token_id,freq)</span></span><br><span class="line">        <span class="comment"># å¯¹æ¯ä¸ªè¯ï¼Œæ ¹æ®tf-idfè¿›è¡ŒåŠ æƒï¼Œå¾—åˆ°åŠ æƒåçš„å‘é‡è¡¨ç¤º</span></span><br><span class="line">        self.tfidf_model = models.TfidfModel(corpus)</span><br><span class="line">        self.tfidf_corpus = self.tfidf_model[corpus]</span><br><span class="line"></span><br><span class="line">        self.keyword_num = keyword_num</span><br><span class="line">        self.num_topics = num_topics</span><br><span class="line">        <span class="comment"># é€‰æ‹©åŠ è½½èƒ¡æ¨¡å‹</span></span><br><span class="line">        <span class="keyword">if</span> model == <span class="string">'LSI'</span>:</span><br><span class="line">            self.model = self.train_lsi()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.model = self.train_lda()</span><br><span class="line">        <span class="comment"># å¾—åˆ°æ•°æ®é›†çš„ä¸»é¢˜-è¯åˆ†å¸ƒ</span></span><br><span class="line">        word_dic = self.word_dictionary(doc_list)</span><br><span class="line">        self.wordtopic_dic = self.get_wordtopic(word_dic)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å‘é‡åŒ–</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">doc2bowvec</span><span class="params">(self, word_list)</span>:</span></span><br><span class="line">        vec_list = [<span class="number">1</span> <span class="keyword">if</span> word <span class="keyword">in</span> word_list <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> word <span class="keyword">in</span> self.dictionary]</span><br><span class="line">        print(<span class="string">"vec_list"</span>, vec_list)</span><br><span class="line">        <span class="keyword">return</span> vec_list</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯ç©ºé—´æ„å»ºæ–¹æ³•å’Œå‘é‡åŒ–æ–¹æ³•ï¼Œåœ¨æ²¡æœ‰gensimæ¥å£æ—¶çš„ä¸€èˆ¬å¤„ç†æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">word_dictionary</span><span class="params">(self, doc_list)</span>:</span></span><br><span class="line">        dictionary = []</span><br><span class="line">        <span class="comment"># 2åŠå˜1åŠç»“æ„</span></span><br><span class="line">        <span class="keyword">for</span> doc <span class="keyword">in</span> doc_list:</span><br><span class="line">            <span class="comment"># extend he append æ–¹æ³•æœ‰ä½•å¼‚åŒ å®¹æ˜“å‡ºé”™</span></span><br><span class="line">            dictionary.extend(doc)</span><br><span class="line"></span><br><span class="line">        dictionary = list(set(dictionary))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dictionary</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¾—åˆ°æ•°æ®é›†çš„ä¸»é¢˜ - è¯åˆ†å¸ƒ</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_wordtopic</span><span class="params">(self, word_dic)</span>:</span></span><br><span class="line">        wordtopic_dic = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> word_dic:</span><br><span class="line">            singlist = [word]</span><br><span class="line">            <span class="comment"># è®¡ç®—æ¯ä¸ªè¯èƒ¡åŠ æƒå‘é‡</span></span><br><span class="line">            word_corpus = self.tfidf_model[self.dictionary.doc2bow(singlist)]</span><br><span class="line">            <span class="comment"># è®¡ç®—æ¯ä¸ªè¯deä¸»é¢˜å‘é‡</span></span><br><span class="line">            word_topic = self.model[word_corpus]</span><br><span class="line">            wordtopic_dic[word] = word_topic</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wordtopic_dic</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train_lsi</span><span class="params">(self)</span>:</span></span><br><span class="line">        lsi = models.LsiModel(self.tfidf_corpus, id2word=self.dictionary, num_topics=self.num_topics)</span><br><span class="line">        <span class="keyword">return</span> lsi</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train_lda</span><span class="params">(self)</span>:</span></span><br><span class="line">        lda = models.LdaModel(self.tfidf_corpus, id2word=self.dictionary, num_topics=self.num_topics)</span><br><span class="line">        <span class="keyword">return</span> lda</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¡ç®—è¯çš„åˆ†å¸ƒå’Œæ–‡æ¡£çš„åˆ†å¸ƒçš„ç›¸ä¼¼åº¦ï¼Œå–ç›¸ä¼¼åº¦æœ€é«˜çš„keyword_numä¸ªè¯ä½œä¸ºå…³é”®è¯</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_simword</span><span class="params">(self, word_list)</span>:</span></span><br><span class="line">        <span class="comment"># æ–‡æ¡£çš„åŠ æƒå‘é‡</span></span><br><span class="line">        sentcorpus = self.tfidf_model[self.dictionary.doc2bow(word_list)]</span><br><span class="line">        <span class="comment"># æ–‡æ¡£ä¸»é¢˜ å‘é‡</span></span><br><span class="line">        senttopic = self.model[sentcorpus]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># senttopic [(0, 0.03457821), (1, 0.034260772), (2, 0.8970413), (3, 0.034119748)]</span></span><br><span class="line">        <span class="comment"># ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">calsim</span><span class="params">(l1, l2)</span>:</span></span><br><span class="line">            a, b, c = <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span></span><br><span class="line">            <span class="keyword">for</span> t1, t2 <span class="keyword">in</span> zip(l1, l2):</span><br><span class="line">                x1 = t1[<span class="number">1</span>]</span><br><span class="line">                x2 = t2[<span class="number">1</span>]</span><br><span class="line">                a += x1 * x1</span><br><span class="line">                b += x1 * x1</span><br><span class="line">                c += x2 * x2</span><br><span class="line">            sim = a / math.sqrt(b * c) <span class="keyword">if</span> <span class="keyword">not</span> (b * c) == <span class="number">0.0</span> <span class="keyword">else</span> <span class="number">0.0</span></span><br><span class="line">            <span class="keyword">return</span> sim</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—è¾“å…¥æ–‡æœ¬å’Œæ¯ä¸ªè¯çš„ä¸»é¢˜åˆ†å¸ƒç›¸ä¼¼åº¦</span></span><br><span class="line">        sim_dic = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> self.wordtopic_dic.items():</span><br><span class="line">            <span class="comment"># è¿˜æ˜¯è®¡ç®—æ¯ä¸ªå†æœ¬æ–‡æ¡£ä¸­çš„è¯  å’Œæ–‡æ¡£çš„ç›¸è¯†åº¦</span></span><br><span class="line">            <span class="keyword">if</span> k <span class="keyword">not</span> <span class="keyword">in</span> word_list:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment">#</span></span><br><span class="line">            sim = calsim(v, senttopic)</span><br><span class="line">            sim_dic[k] = sim</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> sorted(sim_dic.items(), key=<span class="keyword">lambda</span> item:item[<span class="number">1</span>], reverse=<span class="literal">True</span>)[:self.keyword_num]:</span><br><span class="line">            print(k, v)</span><br><span class="line">        print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">topic_extract</span><span class="params">(word_list, model, pos=False, keyword_num=<span class="number">10</span>)</span>:</span></span><br><span class="line">    doc_list = load_data(pos)</span><br><span class="line">    topic_model = TopicModel(doc_list, keyword_num, model=model)</span><br><span class="line">    topic_model.get_simword(word_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">textrank_extract</span><span class="params">(text, pos=False, keyword_num=<span class="number">10</span>)</span>:</span></span><br><span class="line">    textrank = analyse.textrank</span><br><span class="line">    keywords = textrank(text, keyword_num)</span><br><span class="line">    <span class="comment"># è¾“å‡ºæŠ½å–å‡ºçš„å…³é”®è¯</span></span><br><span class="line">    <span class="keyword">for</span> keyword <span class="keyword">in</span> keywords:</span><br><span class="line">        print(keyword + <span class="string">"/ "</span>, end=<span class="string">''</span>)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    text = <span class="string">'6æœˆ19æ—¥,ã€Š2012å¹´åº¦â€œä¸­å›½çˆ±å¿ƒåŸå¸‚â€å…¬ç›Šæ´»åŠ¨æ–°é—»å‘å¸ƒä¼šã€‹åœ¨äº¬ä¸¾è¡Œã€‚'</span> + \</span><br><span class="line">           <span class="string">'ä¸­åç¤¾ä¼šæ•‘åŠ©åŸºé‡‘ä¼šç†äº‹é•¿è®¸å˜‰ç’åˆ°ä¼šè®²è¯ã€‚åŸºé‡‘ä¼šé«˜çº§é¡¾é—®æœ±å‘å¿ ,å…¨å›½è€é¾„'</span> + \</span><br><span class="line">           <span class="string">'åŠå‰¯ä¸»ä»»æœ±å‹‡,æ°‘æ”¿éƒ¨ç¤¾ä¼šæ•‘åŠ©å¸åŠ©ç†å·¡è§†å‘˜å‘¨è,ä¸­åç¤¾ä¼šæ•‘åŠ©åŸºé‡‘ä¼šå‰¯ç†äº‹é•¿è€¿å¿—è¿œ,'</span> + \</span><br><span class="line">           <span class="string">'é‡åº†å¸‚æ°‘æ”¿å±€å·¡è§†å‘˜è°­æ˜æ”¿ã€‚æ™‹æ±Ÿå¸‚äººå¤§å¸¸å§”ä¼šä¸»ä»»é™ˆå¥å€©,ä»¥åŠ10ä½™ä¸ªçœã€å¸‚ã€è‡ªæ²»åŒºæ°‘æ”¿å±€'</span> + \</span><br><span class="line">           <span class="string">'é¢†å¯¼åŠå››åå¤šå®¶åª’ä½“å‚åŠ äº†å‘å¸ƒä¼šã€‚îŒä¸­åç¤¾ä¼šæ•‘åŠ©åŸºé‡‘ä¼šç§˜ä¹¦é•¿æ—¶æ­£æ–°ä»‹ç»æœ¬å¹´åº¦â€œä¸­å›½çˆ±å¿ƒåŸ'</span> + \</span><br><span class="line">           <span class="string">'å¸‚â€å…¬ç›Šæ´»åŠ¨å°†ä»¥â€œçˆ±å¿ƒåŸå¸‚å®£ä¼ ã€å­¤è€å…³çˆ±æ•‘åŠ©é¡¹ç›®åŠç¬¬äºŒå±Šä¸­å›½çˆ±å¿ƒåŸå¸‚å¤§ä¼šâ€ä¸ºä¸»è¦å†…å®¹,é‡åº†å¸‚'</span> + \</span><br><span class="line">           <span class="string">'ã€å‘¼å’Œæµ©ç‰¹å¸‚ã€é•¿æ²™å¸‚ã€å¤ªåŸå¸‚ã€èšŒåŸ å¸‚ã€å—æ˜Œå¸‚ã€æ±•å¤´å¸‚ã€æ²§å·å¸‚ã€æ™‹æ±Ÿå¸‚åŠéµåŒ–å¸‚å°†ä¼šç§¯æå‚åŠ '</span> + \</span><br><span class="line">           <span class="string">'è¿™ä¸€å…¬ç›Šæ´»åŠ¨ã€‚îŒä¸­å›½é›…è™å‰¯æ€»ç¼–å¼ é“¶ç”Ÿå’Œå‡¤å‡°ç½‘åŸå¸‚é¢‘é“æ€»ç›‘èµµè€€åˆ†åˆ«ä»¥å„è‡ªåª’ä½“ä¼˜åŠ¿ä»‹ç»äº†æ´»åŠ¨'</span> + \</span><br><span class="line">           <span class="string">'çš„å®£ä¼ æ–¹æ¡ˆã€‚îŒä¼šä¸Š,ä¸­åç¤¾ä¼šæ•‘åŠ©åŸºé‡‘ä¼šä¸â€œç¬¬äºŒå±Šä¸­å›½çˆ±å¿ƒåŸå¸‚å¤§ä¼šâ€æ‰¿åŠæ–¹æ™‹æ±Ÿå¸‚ç­¾çº¦,è®¸å˜‰ç’ç†'</span> + \</span><br><span class="line">           <span class="string">'äº‹é•¿æ¥å—æ™‹æ±Ÿå¸‚å‚ä¸â€œç™¾ä¸‡å­¤è€å…³çˆ±è¡ŒåŠ¨â€å‘å›½å®¶é‡ç‚¹æ‰¶è´«åœ°åŒºæèµ çš„ä»·å€¼400ä¸‡å…ƒçš„æ¬¾ç‰©ã€‚æ™‹æ±Ÿå¸‚äººå¤§'</span> + \</span><br><span class="line">           <span class="string">'å¸¸å§”ä¼šä¸»ä»»é™ˆå¥å€©ä»‹ç»äº†å¤§ä¼šçš„ç­¹å¤‡æƒ…å†µã€‚'</span></span><br><span class="line"></span><br><span class="line">    pos = <span class="literal">False</span></span><br><span class="line">    seg_list = seg_to_list(text, pos)</span><br><span class="line">    filter_list = word_filter(seg_list, pos)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'LDAæ¨¡å‹ç»“æœï¼š'</span>)</span><br><span class="line">    topic_extract(filter_list, <span class="string">'LDA'</span>, pos)</span><br></pre></td></tr></table></figure>
<h4 id="LDA-æ­¥éª¤æ€»ç»“"><a href="#LDA-æ­¥éª¤æ€»ç»“" class="headerlink" title="LDA æ­¥éª¤æ€»ç»“"></a>LDA æ­¥éª¤æ€»ç»“</h4><p>æ•°æ®é›†å¤„ç†</p>
<ol>
<li>å…ˆæ„å»ºè¯ç©ºé—´  Dictionary(4064 unique tokens: [â€˜ä¸Šå°†â€™, â€˜ä¸“é—¨â€™, â€˜ä¹˜å®¢â€™, â€˜ä»ªå¼â€™, â€˜ä½“éªŒâ€™]â€¦)</li>
<li>ä½¿ç”¨BOWæ¨¡å‹å‘é‡åŒ–   corpus [[(0, 1), (1, 1), (2, 2), (3, 1),ã€‚ã€‚</li>
<li>å¯¹æ¯ä¸ªè¯ï¼Œæ ¹æ®tf-idfè¿›è¡ŒåŠ æƒï¼Œå¾—åˆ°åŠ æƒåçš„å‘é‡è¡¨ç¤º</li>
</ol>
<p>æ ¹æ®æ•°æ®é›†è·å¾—æ¨¡å‹</p>
<ol>
<li>å¾—åˆ°æ•°æ®é›†çš„ä¸»é¢˜-è¯åˆ†å¸ƒ  model (å¾—åˆ°æ¯ä¸ªè¯çš„å‘é‡ï¼‰ï¼ˆæ–‡æ¡£è½¬åˆ—è¡¨ å†è½¬é›†åˆå»é‡ï¼Œå†è½¬åˆ—è¡¨ï¼‰{â€˜ç™½è¡€ç—…â€™: [(0, 0.1273009), (1, 0.6181468), (2, 0.12732704), (3, 0.12722531)], â€˜å©´å„¿â€™: [ã€‚ã€‚ã€‚</li>
<li>æ±‚æ–‡æ¡£çš„åˆ†å¸ƒ:è¯ã€‹å‘é‡ã€‹tf/idfåŠ æƒã€‹åŒç¬¬4æ­¥å¾—åˆ°æ–‡æ¡£çš„åˆ†å¸ƒå‘é‡ [(0, 0.033984687), (1, 0.033736005), (2, 0.8978361), (3, 0.03444325)]</li>
<li>è®¡ç®—ä½™å¼¦è·ç¦»å¾—åˆ°ç»“æœ</li>
</ol>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol>
<li><p>ä¸ºä»€ä¹ˆè¦ç”¨æµ…å±‚è¯­ä¹‰åˆ†æï¼Ÿ</p>
<p>æˆ‘è§‰ç€ä¸€æ–¹é¢æ˜¯è€ƒè™‘æ–‡æœ¬çš„è¯­ä¹‰ä¿¡æ¯ã€‚è¿˜æœ‰å°±æ˜¯ç”¨è¯è¢‹æ¨¡å‹æ‰€è¡¨ç¤ºçš„å•è¯-æ–‡æœ¬çŸ©é˜µä¸€æ–¹é¢å­˜åœ¨æ•°æ®ç¨€ç–çš„é—®é¢˜ï¼Œå¦ä¸€æ–¹é¢å°±æ˜¯è¯æœ¬èº«ä¸€è¯å¤šä¹‰å’Œå¤šè¯ä¸€ä¹‰ç°è±¡åœ¨è¿›è¡Œæ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—çš„æ—¶å€™æœªå¿…èƒ½å¤Ÿå‡†ç¡®çš„è¡¨è¾¾ä¸¤ä¸ªæ–‡æœ¬çš„è¯­ä¹‰ç›¸ä¼¼åº¦ã€‚</p>
</li>
<li><p>æ½œåœ¨è¯­ä¹‰åˆ†æç®—æ³•</p>
<ol>
<li>çŸ©é˜µå¥‡å¼‚å€¼åˆ†è§£ç®—æ³•</li>
<li>éè´ŸçŸ©é˜µåˆ†è§£ç®—æ³•</li>
</ol>
</li>
</ol>
<p><a href="https://github.com/jeffery0628/keyword_extraction" target="_blank" rel="noopener">github ä»£ç </a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="https://www.cnblogs.com/jpcflyer/p/11180263.html" target="_blank" rel="noopener">æœºå™¨å­¦ä¹ ç»å…¸ç®—æ³•ä¹‹PageRank</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/41091116" target="_blank" rel="noopener">é€šä¿—æ˜“æ‡‚ç†è§£â€”â€”TF-IDFä¸TextRank</a></li>
</ol>
]]></content>
      <categories>
        <category>è‡ªç„¶è¯­è¨€å¤„ç†åŸºç¡€</category>
      </categories>
  </entry>
  <entry>
    <title>bertç³»åˆ—</title>
    <url>/2020/04/13/bert%E7%B3%BB%E5%88%97/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="BERT-åŠå…¶åç»­æ¨¡å‹"><a href="#BERT-åŠå…¶åç»­æ¨¡å‹" class="headerlink" title="BERT åŠå…¶åç»­æ¨¡å‹"></a>BERT åŠå…¶åç»­æ¨¡å‹</h2><p>äº†è§£è¿™äº›åç»­çš„æ¨¡å‹ï¼Œæ–¹ä¾¿åœ¨åç»­çš„ç ”ç©¶å’Œåº”ç”¨ä¸­æ¥æ›´å¥½çš„é€‰æ‹©æ¨¡å‹ã€‚</p>
<h3 id="BERT"><a href="#BERT" class="headerlink" title="BERT"></a>BERT</h3><p>BERTæ¨¡å‹çš„ä¸»è¦åˆ›æ–°ç‚¹éƒ½åœ¨pre-trainæ–¹æ³•ä¸Šï¼Œå³ç”¨äº†Masked LMå’ŒNext Sentence Predictionä¸¤ç§æ–¹æ³•åˆ†åˆ«æ•æ‰è¯è¯­å’Œå¥å­çº§åˆ«çš„representationã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert.jpg" alt="avatar"></p>
<p>å¯¹æ¯”OpenAI GPT(Generative pre-trained transformer)ï¼ŒBERTæ˜¯åŒå‘çš„Transformer blockè¿æ¥ï¼›å°±åƒå•å‘rnnå’ŒåŒå‘rnnçš„åŒºåˆ«ï¼Œç›´è§‰ä¸Šæ¥è®²æ•ˆæœä¼šå¥½ä¸€äº›ã€‚</p>
<p>å¯¹æ¯”ELMoï¼Œè™½ç„¶éƒ½æ˜¯â€œåŒå‘â€ï¼Œä½†ç›®æ ‡å‡½æ•°å…¶å®æ˜¯ä¸åŒçš„ã€‚ELMoæ˜¯åˆ†åˆ«ä»¥ $P(w_i|w_1,\cdots,w_{i-1})$ å’Œ$P(w_i|w_{i+1},\cdots,w_n)$ä½œä¸ºç›®æ ‡å‡½æ•°ï¼Œç‹¬ç«‹è®­ç»ƒå¤„ä¸¤ä¸ªrepresentationç„¶åæ‹¼æ¥ï¼Œè€ŒBERTåˆ™æ˜¯ä»¥$P(w_i|w_1,\cdots,w_{i-1},w_{i+1}\cdots,w_n)$  ä½œä¸ºç›®æ ‡å‡½æ•°è®­ç»ƒLMã€‚</p>
<a id="more"></a>
<h4 id="Task-1-MLM"><a href="#Task-1-MLM" class="headerlink" title="Task 1: MLM"></a>Task 1: MLM</h4><p>ç”±äºBERTéœ€è¦é€šè¿‡ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¥é¢„æµ‹ä¸­å¿ƒè¯çš„ä¿¡æ¯ï¼ŒåŒæ—¶åˆä¸å¸Œæœ›æ¨¡å‹æå‰çœ‹è§ä¸­å¿ƒè¯çš„ä¿¡æ¯ï¼Œå› æ­¤æå‡ºäº†ä¸€ç§ Masked Language Model çš„é¢„è®­ç»ƒæ–¹å¼ï¼Œå³éšæœºä»è¾“å…¥é¢„æ–™ä¸Š mask æ‰ä¸€äº›å•è¯ï¼Œç„¶åé€šè¿‡çš„ä¸Šä¸‹æ–‡é¢„æµ‹è¯¥å•è¯ï¼Œç±»ä¼¼äºä¸€ä¸ªå®Œå½¢å¡«ç©ºä»»åŠ¡ã€‚</p>
<p>åœ¨é¢„è®­ç»ƒä»»åŠ¡ä¸­ï¼Œ15%çš„ Word Piece ä¼šè¢«maskï¼Œè¿™15%çš„ Word Piece ä¸­ï¼Œ80%çš„æ—¶å€™ä¼šç›´æ¥æ›¿æ¢ä¸º [Mask] ï¼Œ10%çš„æ—¶å€™å°†å…¶æ›¿æ¢ä¸ºå…¶å®ƒä»»æ„å•è¯ï¼Œ10%çš„æ—¶å€™ä¼šä¿ç•™åŸå§‹Token</p>
<ul>
<li>æ²¡æœ‰100%maskçš„åŸå› <ul>
<li>å¦‚æœå¥å­ä¸­çš„æŸä¸ªToken100%éƒ½ä¼šè¢«maskæ‰ï¼Œé‚£ä¹ˆåœ¨fine-tuningçš„æ—¶å€™æ¨¡å‹å°±ä¼šæœ‰ä¸€äº›æ²¡æœ‰è§è¿‡çš„å•è¯</li>
</ul>
</li>
<li>åŠ å…¥10%éšæœºtokençš„åŸå› <ul>
<li>Transformerè¦ä¿æŒå¯¹æ¯ä¸ªè¾“å…¥tokençš„åˆ†å¸ƒå¼è¡¨å¾ï¼Œå¦åˆ™æ¨¡å‹å°±ä¼šè®°ä½è¿™ä¸ª[mask]æ˜¯token â€™hairyâ€˜</li>
<li>å¦å¤–ç¼–ç å™¨ä¸çŸ¥é“å“ªäº›è¯éœ€è¦é¢„æµ‹çš„ï¼Œå“ªäº›è¯æ˜¯é”™è¯¯çš„ï¼Œå› æ­¤è¢«è¿«éœ€è¦å­¦ä¹ æ¯ä¸€ä¸ªtokençš„è¡¨ç¤ºå‘é‡</li>
</ul>
</li>
<li>å¦å¤–ï¼Œæ¯ä¸ªbatchsizeåªæœ‰15%çš„å•è¯è¢«maskçš„åŸå› ï¼Œæ˜¯å› ä¸ºæ€§èƒ½å¼€é”€çš„é—®é¢˜ï¼ŒåŒå‘ç¼–ç å™¨æ¯”å•é¡¹ç¼–ç å™¨è®­ç»ƒè¦æ›´æ…¢</li>
</ul>
<h4 id="Task-2-NSP"><a href="#Task-2-NSP" class="headerlink" title="Task 2: NSP"></a>Task 2: NSP</h4><p>ä»…ä»…ä¸€ä¸ªMLMä»»åŠ¡æ˜¯ä¸è¶³ä»¥è®© BERT è§£å†³é˜…è¯»ç†è§£ç­‰å¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡çš„ï¼Œå› æ­¤æ·»åŠ äº†é¢å¤–çš„ä¸€ä¸ªé¢„è®­ç»ƒä»»åŠ¡ï¼Œå³ Next Sequence Predictionã€‚</p>
<p>å…·ä½“ä»»åŠ¡å³ä¸ºä¸€ä¸ªå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡ï¼Œå³åˆ¤æ–­å¥å­Bæ˜¯å¦æ˜¯å¥å­Açš„ä¸‹æ–‡ï¼Œå¦‚æœæ˜¯çš„è¯è¾“å‡ºâ€™IsNextâ€˜ï¼Œå¦åˆ™è¾“å‡ºâ€™NotNextâ€˜ã€‚</p>
<p>è®­ç»ƒæ•°æ®çš„ç”Ÿæˆæ–¹å¼æ˜¯ä»å¹³è¡Œè¯­æ–™ä¸­éšæœºæŠ½å–çš„è¿ç»­ä¸¤å¥è¯ï¼Œå…¶ä¸­50%ä¿ç•™æŠ½å–çš„ä¸¤å¥è¯ï¼Œå®ƒä»¬ç¬¦åˆIsNextå…³ç³»ï¼Œå¦å¤–50%çš„ç¬¬äºŒå¥è¯æ˜¯éšæœºä»é¢„æ–™ä¸­æå–çš„ï¼Œå®ƒä»¬çš„å…³ç³»æ˜¯NotNextçš„ã€‚è¿™ä¸ªå…³ç³»ä¿å­˜åœ¨å›¾4ä¸­çš„[CLS]ç¬¦å·ä¸­.</p>
<h4 id="è¾“å…¥"><a href="#è¾“å…¥" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert_input.jpg" alt="avatar"></p>
<ul>
<li>Token Embeddingsï¼šå³ä¼ ç»Ÿçš„è¯å‘é‡å±‚ï¼Œæ¯ä¸ªè¾“å…¥æ ·æœ¬çš„é¦–å­—ç¬¦éœ€è¦è®¾ç½®ä¸º[CLS]ï¼Œå¯ä»¥ç”¨äºä¹‹åçš„åˆ†ç±»ä»»åŠ¡ï¼Œè‹¥æœ‰ä¸¤ä¸ªä¸åŒçš„å¥å­ï¼Œéœ€è¦ç”¨[SEP]åˆ†éš”ï¼Œä¸”æœ€åä¸€ä¸ªå­—ç¬¦éœ€è¦ç”¨[SEP]è¡¨ç¤ºç»ˆæ­¢</li>
<li>Segment Embeddingsï¼šä¸º[0,1]åºåˆ—ï¼Œç”¨æ¥åœ¨NSPä»»åŠ¡ä¸­åŒºåˆ«ä¸¤ä¸ªå¥å­ï¼Œä¾¿äºåšå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡</li>
<li>Position Embeddingsï¼šä¸Transformerä¸­çš„ä½ç½®å‘é‡ä¸åŒï¼ŒBERTä¸­çš„ä½ç½®å‘é‡æ˜¯ç›´æ¥è®­ç»ƒå‡ºæ¥çš„</li>
</ul>
<h4 id="Fine-tunninng"><a href="#Fine-tunninng" class="headerlink" title="Fine-tunninng"></a>Fine-tunninng</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert_finetune.jpg" alt="avatar"></p>
<p>å¯¹äºä¸åŒçš„ä¸‹æ¸¸ä»»åŠ¡ï¼Œæˆ‘ä»¬ä»…éœ€è¦å¯¹BERTä¸åŒä½ç½®çš„è¾“å‡ºè¿›è¡Œå¤„ç†å³å¯ï¼Œæˆ–è€…ç›´æ¥å°†BERTä¸åŒä½ç½®çš„è¾“å‡ºç›´æ¥è¾“å…¥åˆ°ä¸‹æ¸¸æ¨¡å‹å½“ä¸­ã€‚å…·ä½“çš„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>å¯¹äºæƒ…æ„Ÿåˆ†æç­‰å•å¥åˆ†ç±»ä»»åŠ¡ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥å•ä¸ªå¥å­ï¼ˆä¸éœ€è¦[SEP]åˆ†éš”åŒå¥ï¼‰ï¼Œå°†[CLS]çš„è¾“å‡ºç›´æ¥è¾“å…¥åˆ°åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»</li>
<li>å¯¹äºå¥å­å¯¹ä»»åŠ¡ï¼ˆå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡ï¼‰ï¼Œéœ€è¦ç”¨[SEP]åˆ†éš”ä¸¤ä¸ªå¥å­è¾“å…¥åˆ°æ¨¡å‹ä¸­ï¼Œç„¶ååŒæ ·ä»…é¡»å°†[CLS]çš„è¾“å‡ºé€åˆ°åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»</li>
<li>å¯¹äºé—®ç­”ä»»åŠ¡ï¼Œå°†é—®é¢˜ä¸ç­”æ¡ˆæ‹¼æ¥è¾“å…¥åˆ°BERTæ¨¡å‹ä¸­ï¼Œç„¶åå°†ç­”æ¡ˆä½ç½®çš„è¾“å‡ºå‘é‡è¿›è¡ŒäºŒåˆ†ç±»å¹¶åœ¨å¥å­æ–¹å‘ä¸Šè¿›è¡Œsoftmaxï¼ˆåªéœ€é¢„æµ‹å¼€å§‹å’Œç»“æŸä½ç½®å³å¯ï¼‰</li>
<li>å¯¹äºå‘½åå®ä½“è¯†åˆ«ä»»åŠ¡ï¼Œå¯¹æ¯ä¸ªä½ç½®çš„è¾“å‡ºè¿›è¡Œåˆ†ç±»å³å¯ï¼Œå¦‚æœå°†æ¯ä¸ªä½ç½®çš„è¾“å‡ºä½œä¸ºç‰¹å¾è¾“å…¥åˆ°CRFå°†å–å¾—æ›´å¥½çš„æ•ˆæœã€‚</li>
</ul>
<h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><ul>
<li>è€ƒè™‘åŒå‘ä¿¡æ¯ï¼ˆä¸Šä¸‹æ–‡ä¿¡æ¯ï¼‰</li>
<li>ä¸ç”¨è€ƒè™‘å¾ˆé•¿çš„æ—¶åºé—®é¢˜ï¼ˆæ¢¯åº¦å¼¥æ•£ï¼Œæ¢¯åº¦çˆ†ç‚¸ï¼‰ï¼šlong-term dependency</li>
</ul>
<h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ul>
<li>BERTçš„é¢„è®­ç»ƒä»»åŠ¡MLMä½¿å¾—èƒ½å¤Ÿå€ŸåŠ©ä¸Šä¸‹æ–‡å¯¹åºåˆ—è¿›è¡Œç¼–ç ï¼Œä½†åŒæ—¶ä¹Ÿä½¿å¾—å…¶é¢„è®­ç»ƒè¿‡ç¨‹ä¸ä¸­çš„æ•°æ®ä¸å¾®è°ƒçš„æ•°æ®ä¸åŒ¹é…ï¼Œéš¾ä»¥é€‚åº”ç”Ÿæˆå¼ä»»åŠ¡(è®­ç»ƒæ•°æ®ç¼ºä¹mask)</li>
<li>ç¼ºä¹ç”Ÿæˆèƒ½åŠ›</li>
<li>å¦å¤–ï¼ŒBERTæ²¡æœ‰è€ƒè™‘é¢„æµ‹[MASK]ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œæ˜¯å¯¹è¯­è¨€æ¨¡å‹è”åˆæ¦‚ç‡çš„æœ‰åä¼°è®¡ã€‚ï¼ˆæœ´ç´ è´å¶æ–¯ï¼Œnaiveï¼‰</li>
<li>ç”±äºæœ€å¤§è¾“å…¥é•¿åº¦çš„é™åˆ¶ï¼Œé€‚åˆå¥å­å’Œæ®µè½çº§åˆ«çš„ä»»åŠ¡ï¼Œä¸é€‚ç”¨äºæ–‡æ¡£çº§åˆ«çš„ä»»åŠ¡ï¼ˆå¦‚é•¿æ–‡æœ¬åˆ†ç±»ï¼‰</li>
<li>é€‚åˆå¤„ç†è‡ªç„¶è¯­ä¹‰ç†è§£ç±»ä»»åŠ¡(NLU)ï¼Œè€Œä¸é€‚åˆè‡ªç„¶è¯­è¨€ç”Ÿæˆç±»ä»»åŠ¡(NLG)</li>
</ul>
<h4 id="torchä½¿ç”¨"><a href="#torchä½¿ç”¨" class="headerlink" title="torchä½¿ç”¨"></a>torchä½¿ç”¨</h4><ol>
<li>å¯¼å…¥ç›¸å…³åº“</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> transformers <span class="keyword">as</span> ppb <span class="comment"># pytorch transformers</span></span><br></pre></td></tr></table></figure>
<ol>
<li>å¯¼å…¥é¢„è®­ç»ƒå¥½çš„ DistilBERT æ¨¡å‹ä¸åˆ†è¯å™¨</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">model_class, tokenizer_class, pretrained_weights = (ppb.DistilBertModel, ppb.DistilBertTokenizer, <span class="string">'distilbert-base-uncased'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Want BERT instead of distilBERT? Uncomment the following line:</span></span><br><span class="line"><span class="comment">#model_class, tokenizer_class, pretrained_weights = (ppb.BertModel, ppb.BertTokenizer, 'bert-base-uncased')# </span></span><br><span class="line"></span><br><span class="line">Load pretrained model/tokenizertokenizer = tokenizer_class.from_pretrained(pretrained_weights)</span><br><span class="line">model = model_class.from_pretrained(pretrained_weights)</span><br></pre></td></tr></table></figure>
<ol>
<li>tokenizeï¼šåˆ†è¯+[cls]+[sep]<br><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert_tokenize.png" alt="avatar"></li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tokenizer.encode(<span class="string">'a visually stunning rumination on love'</span>, add_special_tokens=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>padding</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">max_len = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tokenized.values:</span><br><span class="line"> <span class="keyword">if</span> len(i) &gt; max_len:</span><br><span class="line">     max_len = len(i)</span><br><span class="line">padded = np.array([i + [<span class="number">0</span>]*(max_len-len(i)) <span class="keyword">for</span> i <span class="keyword">in</span> tokenized.values])</span><br></pre></td></tr></table></figure>
<ol>
<li>masking</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">attention_mask = np.where(padded != <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>ä½¿ç”¨bertè¿›è¡Œç¼–ç </li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    <span class="comment"># last_hidden_states = [batch_size, max_sentence_len, 768]</span></span><br><span class="line">    last_hidden_states = model(input_ids, attention_mask=attention_mask)</span><br></pre></td></tr></table></figure>
<p><a href="http://fancyerii.github.io/2019/03/09/bert-codes/#dataprocessor" target="_blank" rel="noopener">bertä»£ç é˜…è¯»</a></p>
<hr>
<p>è°·æ­Œå¯¹BERTè¿›è¡Œäº†æ”¹ç‰ˆï¼Œä¸‹é¢å°†å¯¹æ”¹ç‰ˆåçš„bertè¿›è¡Œå­¦ä¹ ï¼Œå¯¹æ¯”æ”¹ç‰ˆå‰åä¸»è¦çš„ç›¸ä¼¼ç‚¹å’Œä¸åŒç‚¹ï¼Œä»¥ä¾¿å¯ä»¥é€‰æ‹©åœ¨ç ”ç©¶æˆ–åº”ç”¨ä¸­ä½¿ç”¨å“ªä¸€ç§ã€‚æå‡ºçš„å‡ ç§æ–¹æ³•æ”¹è¿›BERTçš„é¢„æµ‹æŒ‡æ ‡æˆ–è®¡ç®—é€Ÿåº¦ï¼Œä½†æ˜¯å§‹ç»ˆè¾¾ä¸åˆ°ä¸¤è€…å…¼é¡¾ã€‚<strong>XLNetå’ŒRoBERTaæ”¹å–„äº†æ€§èƒ½ï¼Œè€ŒDistilBERTæé«˜äº†æ¨ç†é€Ÿåº¦</strong>ã€‚</p>
<h3 id="BERT-WWM"><a href="#BERT-WWM" class="headerlink" title="BERT-WWM"></a><strong>BERT-WWM</strong></h3><p><a href>è®ºæ–‡</a></p>
<h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>wwm å³ Whole Word Maskingï¼ˆå¯¹å…¨è¯è¿›è¡ŒMaskï¼‰ã€‚ç›¸æ¯”äºbertçš„æ”¹è¿›æ˜¯ç”¨Maskæ ‡ç­¾æ›¿æ¢ä¸€ä¸ªå®Œæ•´çš„è¯è€Œä¸æ˜¯å­—ï¼Œä¸­æ–‡å’Œè‹±æ–‡ä¸åŒï¼Œè‹±æ–‡æœ€å°çš„tokenæ˜¯ä¸€ä¸ªå•è¯ï¼Œè€Œä¸­æ–‡ä¸­æœ€å°çš„tokenå´æ˜¯å­—ï¼Œè¯æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç»„æˆï¼Œä¸”æ¯ä¸ªè¯ä¹‹é—´æ²¡æœ‰æ˜æ˜¾çš„åˆ†å‰²ï¼ŒåŒ…å«æ›´å¤šä¿¡æ¯çš„æ˜¯è¯ï¼Œå¯¹å…¨è¯maskå°±æ˜¯å¯¹æ•´ä¸ªè¯éƒ½é€šè¿‡maskè¿›è¡Œæ©ç ã€‚<br><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert_wwm_exam.png" alt="avatar"></p>
<h4 id="Bert-wwm-ext"><a href="#Bert-wwm-ext" class="headerlink" title="Bert-wwm-ext"></a><strong>Bert-wwm-ext</strong></h4><p>å®ƒæ˜¯BERT-wwmçš„ä¸€ä¸ªå‡çº§ç‰ˆï¼Œç›¸æ¯”äºBERT-wwmçš„æ”¹è¿›æ˜¯å¢åŠ äº†è®­ç»ƒæ•°æ®é›†åŒæ—¶ä¹Ÿå¢åŠ äº†è®­ç»ƒæ­¥æ•°ã€‚<br>BERT-wwm-extä¸»è¦æ˜¯æœ‰ä¸¤ç‚¹æ”¹è¿›ï¼š<br>1ï¼‰é¢„è®­ç»ƒæ•°æ®é›†åšäº†å¢åŠ ï¼Œè¾¾åˆ°5.4Bï¼›<br>2ï¼‰è®­ç»ƒæ­¥æ•°å¢å¤§ï¼Œè®­ç»ƒç¬¬ä¸€é˜¶æ®µ1Mæ­¥ï¼Œè®­ç»ƒç¬¬äºŒé˜¶æ®µ400Kæ­¥ã€‚</p>
<p><a href="https://github.com/ymcui/Chinese-BERT-wwm" target="_blank" rel="noopener">æ¨¡å‹ä¸‹è½½</a></p>
<h3 id="XLNet"><a href="#XLNet" class="headerlink" title="XLNet"></a>XLNet</h3><p>XLNetä½œä¸ºbertçš„å‡çº§æ¨¡å‹ï¼Œä¸»è¦åœ¨ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢è¿›è¡Œäº†ä¼˜åŒ–:</p>
<ul>
<li>é‡‡ç”¨ARæ¨¡å‹æ›¿ä»£AEæ¨¡å‹ï¼Œè§£å†³maskå¸¦æ¥çš„è´Ÿé¢å½±å“</li>
<li>åŒæµæ³¨æ„åŠ›æœºåˆ¶</li>
<li>å¼•å…¥transformer-xl</li>
</ul>
<h4 id="ARä¸AEè¯­è¨€æ¨¡å‹"><a href="#ARä¸AEè¯­è¨€æ¨¡å‹" class="headerlink" title="ARä¸AEè¯­è¨€æ¨¡å‹"></a>ARä¸AEè¯­è¨€æ¨¡å‹</h4><p>ç›®å‰ä¸»æµçš„nlpé¢„è®­ç»ƒæ¨¡å‹åŒ…æ‹¬ä¸¤ç±» Auto Regressive (<strong>AR</strong>) Language Model ä¸Auto Encoding (AE) Language Modelã€‚</p>
<h5 id="ARæ¨¡å‹"><a href="#ARæ¨¡å‹" class="headerlink" title="ARæ¨¡å‹"></a>ARæ¨¡å‹</h5><p>ARæ¨¡å‹çš„ä¸»è¦ä»»åŠ¡åœ¨äºè¯„ä¼°è¯­æ–™çš„æ¦‚ç‡åˆ†å¸ƒï¼Œä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªåºåˆ— $X=(x_1, \cdots ,x_T)$ ï¼ŒARæ¨¡å‹å°±æ˜¯åœ¨è®¡ç®—å…¶æå¤§ä¼¼ç„¶ä¼°è®¡$p(X)=\prod_{t=1}^Tp(x_tâˆ£x_{<t})$å³å·²çŸ¥$x_t$ä¹‹å‰çš„åºåˆ—ï¼Œé¢„æµ‹$x_t$ çš„å€¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åç€æ¥$p(x)="\prod_{t=1}^Tp(x_tâˆ£x_{">t})$å³å·²çŸ¥$x_t$ä¹‹åçš„åºåˆ—ï¼Œé¢„æµ‹$x_t$çš„å€¼ã€‚ARæ¨¡å‹ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„ç¼ºç‚¹å°±æ˜¯ï¼šæ¨¡å‹æ˜¯å•å‘çš„ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›çš„æ˜¯æ ¹æ®ä¸Šä¸‹æ–‡æ¥é¢„æµ‹ç›®æ ‡ï¼Œè€Œä¸å•æ˜¯ä¸Šæ–‡æˆ–è€…ä¸‹æ–‡ï¼Œä¹‹å‰open AIæå‡ºçš„GPTå°±æ˜¯é‡‡ç”¨çš„ARæ¨¡å¼ï¼ŒåŒ…æ‹¬GPT2.0ä¹Ÿæ˜¯è¯¥æ¨¡å¼ã€‚</t})$å³å·²çŸ¥$x_t$ä¹‹å‰çš„åºåˆ—ï¼Œé¢„æµ‹$x_t$></p>
<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>å…·å¤‡ç”Ÿæˆèƒ½åŠ›</li>
<li>è€ƒè™‘äº†ç›¸å…³æ€§</li>
<li>æ— ç›‘ç£</li>
<li>ä¸¥æ ¼çš„æ•°å­¦è¡¨è¾¾</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>å•å‘çš„</li>
<li>ï¼ˆéš¾è€ƒè™‘ long term dependencyï¼‰</li>
</ol>
<h5 id="AEæ¨¡å‹"><a href="#AEæ¨¡å‹" class="headerlink" title="AEæ¨¡å‹"></a>AEæ¨¡å‹</h5><p>AEæ¨¡å‹é‡‡ç”¨çš„å°±æ˜¯ä»¥ä¸Šä¸‹æ–‡çš„æ–¹å¼ï¼Œæœ€å…¸å‹çš„æˆåŠŸæ¡ˆä¾‹å°±æ˜¯bertã€‚ç®€å•å›é¡¾ä¸‹bertçš„é¢„è®­ç»ƒé˜¶æ®µï¼Œé¢„è®­ç»ƒåŒ…æ‹¬äº†ä¸¤ä¸ªä»»åŠ¡ï¼ŒMasked Language Modelä¸Next Sentence Predictionï¼ŒNext Sentence Predictionå³åˆ¤æ–­ä¸¤ä¸ªåºåˆ—çš„æ¨æ–­å…³ç³»ï¼ŒMasked Language Modelé‡‡ç”¨äº†ä¸€ä¸ªæ ‡å¿—ä½[MASK]æ¥éšæœºæ›¿æ¢ä¸€äº›è¯ï¼Œå†ç”¨[MASK]çš„ä¸Šä¸‹æ–‡æ¥é¢„æµ‹[MASK]çš„çœŸå®å€¼ï¼Œbertçš„æœ€å¤§é—®é¢˜ä¹Ÿæ˜¯å¤„åœ¨è¿™ä¸ªMASKçš„ç‚¹ï¼Œå› ä¸ºåœ¨å¾®è°ƒé˜¶æ®µï¼Œæ²¡æœ‰MASKè¿™å°±å¯¼è‡´é¢„è®­ç»ƒå’Œå¾®è°ƒæ•°æ®çš„ä¸ç»Ÿä¸€ï¼Œä»è€Œå¼•å…¥äº†ä¸€äº›äººä¸ºè¯¯å·®ã€‚</p>
<p>åœ¨xlnetä¸­ï¼Œé‡‡ç”¨äº†<strong>ARæ¨¡å‹</strong>ï¼Œä½†æ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªä¸Šä¸‹æ–‡çš„é—®é¢˜å‘¢ï¼Ÿ</p>
<h4 id="æ’åˆ—è¯­è¨€æ¨¡å‹-ä¸ºäº†è€ƒè™‘ä¸Šä¸‹æ–‡ä¿¡æ¯"><a href="#æ’åˆ—è¯­è¨€æ¨¡å‹-ä¸ºäº†è€ƒè™‘ä¸Šä¸‹æ–‡ä¿¡æ¯" class="headerlink" title="æ’åˆ—è¯­è¨€æ¨¡å‹(ä¸ºäº†è€ƒè™‘ä¸Šä¸‹æ–‡ä¿¡æ¯)"></a>æ’åˆ—è¯­è¨€æ¨¡å‹(ä¸ºäº†è€ƒè™‘ä¸Šä¸‹æ–‡ä¿¡æ¯)</h4><p>ä¸ºäº†è§£å†³ä¸Šæ–‡æåˆ°çš„é—®é¢˜ï¼Œä½œè€…æå‡ºäº†æ’åˆ—è¯­è¨€æ¨¡å‹ï¼Œè¯¥æ¨¡å‹ä¸å†å¯¹ä¼ ç»Ÿçš„ARæ¨¡å‹çš„åºåˆ—çš„å€¼æŒ‰é¡ºåºè¿›è¡Œå»ºæ¨¡ï¼Œè€Œæ˜¯æœ€å¤§åŒ–æ‰€æœ‰å¯èƒ½çš„åºåˆ—çš„å› å¼åˆ†è§£é¡ºåºçš„æœŸæœ›å¯¹æ•°ä¼¼ç„¶ï¼Œè¿™å¥è¯å¯èƒ½æœ‰ç‚¹ä¸å¥½ç†è§£ï¼Œä¸¾ä¸ªæ —å­ï¼Œå‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªåºåˆ—$[1,2,3,4]$ï¼Œå¦‚æœæˆ‘ä»¬çš„é¢„æµ‹ç›®æ ‡æ˜¯3ï¼Œå¯¹äºä¼ ç»Ÿçš„ARæ¨¡å‹æ¥è¯´ï¼Œç»“æœæ˜¯$p(3)=\prod^3_{t=1}p(3|x_{&lt;t})$ï¼Œå¦‚æœé‡‡ç”¨æœ¬æ–‡çš„æ–¹æ³•ï¼Œå…ˆå¯¹è¯¥åºåˆ—è¿›è¡Œå› å¼åˆ†è§£ï¼Œæœ€ç»ˆä¼šæœ‰24ç§æ’åˆ—æ–¹å¼ï¼Œä¸‹å›¾æ˜¯å…¶ä¸­å¯èƒ½çš„å››ç§æƒ…å†µï¼Œå¯¹äºç¬¬ä¸€ç§æƒ…å†µå› ä¸º3çš„å·¦è¾¹æ²¡æœ‰å…¶ä»–çš„å€¼ï¼Œæ‰€ä»¥è¯¥æƒ…å†µæ— éœ€åšå¯¹åº”çš„è®¡ç®—ï¼Œç¬¬äºŒç§æƒ…å†µ3çš„å·¦è¾¹è¿˜åŒ…æ‹¬äº†2ä¸4ï¼Œæ‰€ä»¥å¾—åˆ°çš„ç»“æœæ˜¯$p(3)=p(3|2)p(3|2,4)$ï¼Œåç»­çš„æƒ…å†µç±»ä¼¼ï¼Œè¿™æ ·å¤„ç†è¿‡åä¸ä½†ä¿ç•™äº†åºåˆ—çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¹Ÿ<strong>é¿å…äº†é‡‡ç”¨maskæ ‡è®°ä½ï¼Œå·§å¦™çš„æ”¹è¿›äº†bertä¸ä¼ ç»ŸARæ¨¡å‹çš„ç¼ºç‚¹</strong>ã€‚<br><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/xlnet.png" alt="avatar"></p>
<h5 id="å¦‚ä½•è®­ç»ƒï¼Ÿ"><a href="#å¦‚ä½•è®­ç»ƒï¼Ÿ" class="headerlink" title="å¦‚ä½•è®­ç»ƒï¼Ÿ"></a>å¦‚ä½•è®­ç»ƒï¼Ÿ</h5><ol>
<li>å‡å¦‚å¥å­é•¿åº¦ä¸º20ï¼Œåˆ™ä¼šäº§ç”Ÿ$20$!ç§æ’åˆ—ï¼Œåœ¨è¿™$20$!ç§æ’åˆ—ä¸­éšæœºæŠ½æ ·ï¼Œå¾—åˆ°è®­ç»ƒæ ·æœ¬ã€‚</li>
<li>ä¸ºè·å¾—ä¸°å¯Œçš„ä¸Šä¸‹æ–‡è¯­ä¹‰ä¿¡æ¯ï¼Œå¯¹æŠ½å–çš„æ ·æœ¬æœ€åçš„å‡ ä¸ªå•è¯è¿›è¡Œé¢„æµ‹ã€‚</li>
</ol>
<h4 id="åŸºäºç›®æ ‡æ„ŸçŸ¥è¡¨å¾çš„åŒæµè‡ªæ³¨æ„åŠ›-ä¸ºäº†è§£å†³ä½ç½®ä¿¡æ¯"><a href="#åŸºäºç›®æ ‡æ„ŸçŸ¥è¡¨å¾çš„åŒæµè‡ªæ³¨æ„åŠ›-ä¸ºäº†è§£å†³ä½ç½®ä¿¡æ¯" class="headerlink" title="åŸºäºç›®æ ‡æ„ŸçŸ¥è¡¨å¾çš„åŒæµè‡ªæ³¨æ„åŠ›(ä¸ºäº†è§£å†³ä½ç½®ä¿¡æ¯)"></a>åŸºäºç›®æ ‡æ„ŸçŸ¥è¡¨å¾çš„<strong>åŒæµè‡ªæ³¨æ„åŠ›</strong>(ä¸ºäº†è§£å†³ä½ç½®ä¿¡æ¯)</h4><p>è™½ç„¶æ’åˆ—è¯­è¨€æ¨¡å‹èƒ½æ»¡è¶³ç›®å‰çš„ç›®æ ‡ï¼Œä½†æ˜¯å¯¹äºæ™®é€šçš„transformerç»“æ„æ¥è¯´æ˜¯å­˜åœ¨ä¸€å®šçš„é—®é¢˜çš„ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œå‡è®¾æˆ‘ä»¬è¦æ±‚è¿™æ ·çš„ä¸€ä¸ªå¯¹æ•°ä¼¼ç„¶ï¼Œ$p_\theta(X_{z_t}|x_{z_{&lt;t}})$ï¼Œå¦‚æœé‡‡ç”¨æ ‡å‡†çš„softmaxçš„è¯ï¼Œé‚£ä¹ˆ</p>
<script type="math/tex; mode=display">
p_{\theta}\left(X_{z_t} | x_{z_{<t}}\right)=\frac{\exp \left(e(x)^{T} h_{\theta}\left(x_{z_{<t}}\right)\right)}{\sum_{x^{\prime}} \exp \left(e\left(x^{\prime}\right)^{T} h_{\theta}\left(x_{z_{<t}}\right)\right)}</script><p>å…¶ä¸­$h_\theta (x_{z_{&lt;t}})$è¡¨ç¤ºçš„æ˜¯æ·»åŠ äº†maskåçš„transformerçš„è¾“å‡ºå€¼ï¼Œå¯ä»¥å‘ç°$h_\theta (x_{z_{&lt;t}})$å¹¶ä¸ä¾èµ–äºå…¶è¦é¢„æµ‹çš„å†…å®¹çš„ä½ç½®ä¿¡æ¯ï¼Œå› ä¸ºæ— è®ºé¢„æµ‹ç›®æ ‡çš„ä½ç½®åœ¨å“ªé‡Œï¼Œå› å¼åˆ†è§£åå¾—åˆ°çš„æ‰€æœ‰æƒ…å†µéƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”transformerçš„æƒé‡å¯¹äºä¸åŒçš„æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤æ— è®ºç›®æ ‡ä½ç½®æ€ä¹ˆå˜éƒ½èƒ½å¾—åˆ°ç›¸åŒçš„åˆ†å¸ƒç»“æœï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‡å¦‚æˆ‘ä»¬çš„åºåˆ—indexè¡¨ç¤ºä¸º[1,2,3]ï¼Œå¯¹äºç›®æ ‡2ä¸3æ¥è¯´ï¼Œå…¶å› å¼åˆ†è§£åçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆç»è¿‡transformerä¹‹åå¾—åˆ°çš„ç»“æœè‚¯å®šä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚<br><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/123.png" alt="avatar"></p>
<p>è¿™å°±å¯¼è‡´æ¨¡å‹æ²¡æ³•å¾—åˆ°æ­£ç¡®çš„è¡¨è¿°ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®ºæ–‡ä¸­æå‡ºæ¥æ–°çš„åˆ†å¸ƒè®¡ç®—æ–¹æ³•ï¼Œæ¥å®ç°ç›®æ ‡ä½ç½®æ„ŸçŸ¥</p>
<script type="math/tex; mode=display">
p_{\theta}\left(X_{zt}=x | x_{z<t}\right)=\frac{\exp \left(e(x)^{T} g_{\theta}\left(x_{z<t}, z_{t}\right)\right)}{\sum_{x^{\prime}} \exp \left(e\left(x^{\prime}\right)^{T} g_{\theta}\left(x_{z<t}, z_{t}\right)\right)}</script><p>å…¶ä¸­$g_{\theta}\left(x_{z_{&lt;t}}, z_{t}\right)$æ˜¯æ–°çš„è¡¨ç¤ºå½¢å¼ï¼Œå¹¶ä¸”æŠŠä½ç½®ä¿¡æ¯$z_t$ä½œä¸ºäº†å…¶è¾“å…¥ã€‚<br>è¿™ä¸ªæ–°çš„è¡¨ç¤ºå½¢å¼ï¼Œè®ºæ–‡æŠŠè¯¥æ–¹æ³•ç§°ä¸ºTwo-Stream Self-Attentionï¼ŒåŒæµè‡ªæ³¨æ„åŠ›ï¼Œè¯¥æœºåˆ¶éœ€è¦è§£å†³äº†ä¸¤ä¸ªé—®é¢˜:</p>
<ul>
<li>å¦‚æœç›®æ ‡æ˜¯é¢„æµ‹$x_{z_t}$ï¼Œ$g_\theta (x_{z&lt;t},z_t)$é‚£ä¹ˆåªèƒ½æœ‰å…¶ä½ç½®ä¿¡æ¯$z_t$ è€Œä¸èƒ½åŒ…å«å†…å®¹ä¿¡æ¯$x_{z_t}$</li>
<li>å¦‚æœç›®æ ‡æ˜¯é¢„æµ‹å…¶ä»–tokenså³$x_{z_j}$é‚£ä¹ˆåº”è¯¥åŒ…å«$x_{z_t}$çš„å†…å®¹ä¿¡æ¯è¿™æ ·æ‰æœ‰å®Œæ•´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</li>
</ul>
<p>ä¼ ç»Ÿçš„transformerå¹¶ä¸æ»¡è¶³è¿™æ ·çš„éœ€æ±‚ï¼Œå› æ­¤ä½œè€…é‡‡ç”¨äº†ä¸¤ç§è¡¨è¿°æ¥ä»£æ›¿åŸæ¥çš„è¡¨è¿°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç§°ä¸º<strong>åŒæµ</strong>çš„åŸå› :</p>
<ul>
<li><p>content representationå†…å®¹è¡¨è¿°ï¼Œå³$h_\theta (x_{z_{\leq t}})$ä¸‹æ–‡ç”¨$h_{z_t}$è¡¨ç¤ºï¼Œè¯¥è¡¨è¿°å’Œä¼ ç»Ÿçš„transformerä¸€æ ·ï¼ŒåŒæ—¶ç¼–ç äº†ä¸Šä¸‹æ–‡å’Œ$x_{z_t}$è‡ªèº«</p>
<script type="math/tex; mode=display">
h_{z_{t}}^{(m)}=\text {Attention}\left(Q=h_{z_{t}}^{(m-1)}, K V=h_{z \leq t}^{(m-1)} ; \theta\right)</script><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/content_representation.png" alt="avatar"></p>
</li>
<li><p>query representationæŸ¥è¯¢è¡¨è¿°ï¼Œå³$g_\theta (x_{z_{&lt;t}})$ï¼Œä¸‹æ–‡ç”¨$g_{z_t}$ è¡¨ç¤ºï¼Œè¯¥è¡¨è¿°åŒ…å«ä¸Šä¸‹æ–‡çš„å†…å®¹ä¿¡æ¯$x_{z_{&lt;t}}$ å’Œç›®æ ‡çš„ä½ç½®ä¿¡æ¯$z_t$ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬ç›®æ ‡çš„å†…å®¹ä¿¡æ¯$x_{z_{t}}$ ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒKä¸Vçš„è®¡ç®—å¹¶æ²¡æœ‰åŒ…æ‹¬Qï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•è·å–åˆ°ç›®æ ‡çš„å†…å®¹ä¿¡æ¯ï¼Œä½†æ˜¯ç›®æ ‡çš„ä½ç½®ä¿¡æ¯åœ¨è®¡ç®—Qçš„æ—¶å€™ä¿ç•™äº†ä¸‹æ¥ï¼Œ</p>
<script type="math/tex; mode=display">
g_{z_{t}}^{(m)}=\text {Attention}\left(Q=g_{z_{t}}^{(m-1)}, K V=h_{z<t}^{(m-1)} ; \theta\right)</script></li>
</ul>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/query_representation.png" alt="avatar"></p>
<p>æ€»çš„è®¡ç®—è¿‡ç¨‹ï¼Œé¦–å…ˆï¼Œç¬¬ä¸€å±‚çš„æŸ¥è¯¢æµæ˜¯éšæœºåˆå§‹åŒ–äº†ä¸€ä¸ªå‘é‡å³$g_i^{0}=w$ï¼Œå†…å®¹æµæ˜¯é‡‡ç”¨çš„è¯å‘é‡å³$h_i^{0}=e(x_i)$ï¼Œself-attentionçš„è®¡ç®—è¿‡ç¨‹ä¸­ä¸¤ä¸ªæµçš„ç½‘ç»œæƒé‡æ˜¯å…±äº«çš„ï¼Œæœ€ååœ¨å¾®è°ƒé˜¶æ®µï¼Œåªéœ€è¦ç®€å•çš„æŠŠquery streamç§»é™¤ï¼Œåªé‡‡ç”¨content streamå³å¯ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/two_stream.png" alt="avatar"></p>
<h4 id="å¼•å…¥transformer-XL"><a href="#å¼•å…¥transformer-XL" class="headerlink" title="å¼•å…¥transformer XL"></a>å¼•å…¥transformer XL</h4><p>ä½œè€…è¿˜å°†transformer-xlçš„ä¸¤ä¸ªæœ€é‡è¦çš„æŠ€æœ¯ç‚¹åº”ç”¨äº†è¿›æ¥ï¼Œå³ç‰‡æ®µå¾ªç¯æœºåˆ¶ä¸ç›¸å¯¹ä½ç½®ç¼–ç ã€‚</p>
<h5 id="ç‰‡æ®µå¾ªç¯æœºåˆ¶"><a href="#ç‰‡æ®µå¾ªç¯æœºåˆ¶" class="headerlink" title="ç‰‡æ®µå¾ªç¯æœºåˆ¶"></a>ç‰‡æ®µå¾ªç¯æœºåˆ¶</h5><p>ransformer-xlçš„æå‡ºä¸»è¦æ˜¯ä¸ºäº†è§£å†³è¶…é•¿åºåˆ—çš„ä¾èµ–é—®é¢˜ï¼Œå¯¹äºæ™®é€šçš„transformerç”±äºæœ‰ä¸€ä¸ªæœ€é•¿åºåˆ—çš„è¶…å‚æ•°æ§åˆ¶å…¶é•¿åº¦ï¼ˆå¦‚æœä¸å¯¹æ–‡æœ¬æ§åˆ¶ï¼Œåˆ™ä¼šæå¤§æ¶ˆè€—å†…å­˜ï¼Œå› ä¸ºåœ¨è®¡ç®—scoreçŸ©é˜µçš„æ—¶å€™ï¼Œä¼šå¼€è¾Ÿ$n^2$å¤§å°çš„çŸ©é˜µï¼Œå¯¹äºä¸€ç¯‡æ–‡æœ¬ï¼Œé•¿åº¦ä¸º$10^5$,åˆ™éœ€è¦å¼€è¾Ÿ$10^5 * 10^5 = 10^10$å¤§å°çš„scoreçŸ©é˜µï¼Œæå…¶æ¶ˆè€—å†…å­˜ã€‚ï¼‰ï¼Œå¯¹äºç‰¹åˆ«é•¿çš„åºåˆ—å°±ä¼šå¯¼è‡´ä¸¢å¤±ä¸€äº›ä¿¡æ¯ï¼Œtransformer-xlå°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬çœ‹ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé•¿åº¦ä¸º1000çš„åºåˆ—ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®transformerçš„æœ€å¤§åºåˆ—é•¿åº¦æ˜¯100ï¼Œé‚£ä¹ˆè¿™ä¸ª1000é•¿åº¦çš„åºåˆ—éœ€è¦è®¡ç®—åæ¬¡ï¼Œå¹¶ä¸”æ¯ä¸€æ¬¡çš„è®¡ç®—éƒ½æ²¡æ³•è€ƒè™‘åˆ°æ¯ä¸€ä¸ªæ®µä¹‹é—´çš„å…³ç³»ï¼Œå¦‚æœé‡‡ç”¨transformer-xlï¼Œé¦–å…ˆå–ç¬¬ä¸€ä¸ªæ®µè¿›è¡Œè®¡ç®—ï¼Œç„¶åæŠŠå¾—åˆ°çš„ç»“æœçš„éšè—å±‚çš„å€¼è¿›è¡Œç¼“å­˜ï¼Œç¬¬äºŒä¸ªæ®µè®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼ŒæŠŠç¼“å­˜çš„å€¼æ‹¼æ¥èµ·æ¥å†è¿›è¡Œè®¡ç®—ï¼ˆRNNï¼‰ã€‚è¯¥æœºåˆ¶ä¸ä½†èƒ½ä¿ç•™é•¿ä¾èµ–å…³ç³»è¿˜èƒ½åŠ å¿«è®­ç»ƒï¼Œå› ä¸ºæ¯ä¸€ä¸ªå‰ç½®ç‰‡æ®µéƒ½ä¿ç•™äº†ä¸‹æ¥ï¼Œä¸éœ€è¦å†é‡æ–°è®¡ç®—ï¼Œåœ¨transformer-xlçš„è®ºæ–‡ä¸­ï¼Œç»è¿‡è¯•éªŒå…¶é€Ÿåº¦æ¯”transformerå¿«äº†1800å€ã€‚<br>åœ¨xlnetä¸­å¼•å…¥ç‰‡æ®µå¾ªç¯æœºåˆ¶å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨è®¡ç®—KVçš„æ—¶å€™åšç®€å•çš„ä¿®æ”¹ï¼Œå…¶ä¸­$\tilde{h}^{m-1}$è¡¨ç¤ºçš„æ˜¯ç¼“å­˜å€¼ã€‚</p>
<script type="math/tex; mode=display">
h_{z_{t}}^{(m)}=\text {Attention}\left(Q=h_{z_{t}}^{(m-1)}, K V=\left[\tilde{h}^{(m-1)}, h_{z \leq t}^{(m-1)}\right] ; \theta\right)</script><h5 id="ç›¸å¯¹ä½ç½®ç¼–ç "><a href="#ç›¸å¯¹ä½ç½®ç¼–ç " class="headerlink" title="ç›¸å¯¹ä½ç½®ç¼–ç "></a>ç›¸å¯¹ä½ç½®ç¼–ç </h5><p>bertçš„position embeddingé‡‡ç”¨çš„æ˜¯ç»å¯¹ä½ç½®ç¼–ç ï¼Œä½†æ˜¯ç»å¯¹ä½ç½®ç¼–ç åœ¨transformer-xlä¸­æœ‰ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œå› ä¸ºæ²¡æ³•åŒºåˆ†åˆ°åº•æ˜¯å“ªä¸€ä¸ªç‰‡æ®µé‡Œçš„ï¼Œè¿™å°±å¯¼è‡´äº†ä¸€äº›ä½ç½®ä¿¡æ¯çš„æŸå¤±ï¼Œè¿™é‡Œè¢«æ›¿æ¢ä¸ºäº†transformer-xlä¸­çš„ç›¸å¯¹ä½ç½®ç¼–ç ã€‚å‡è®¾ç»™å®šä¸€å¯¹ä½ç½®$i$ä¸$j$ï¼Œå¦‚æœ$i$ä¸$j$æ˜¯åŒä¸€ä¸ªç‰‡æ®µé‡Œçš„é‚£ä¹ˆæˆ‘ä»¬ä»¤è¿™ä¸ªç‰‡æ®µç¼–ç $s_{ij}=s_+$ï¼Œå¦‚æœä¸åœ¨ä¸€ä¸ªç‰‡æ®µé‡Œåˆ™ä»¤è¿™ä¸ªç‰‡æ®µç¼–ç ä¸º$s_{ij}=s_-$ï¼Œè¿™ä¸ªå€¼æ˜¯åœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­å¾—åˆ°çš„ï¼Œä¹Ÿæ˜¯ç”¨æ¥è®¡ç®—attention weightæ—¶å€™ç”¨åˆ°çš„ï¼Œåœ¨ä¼ ç»Ÿçš„transformerä¸­$\text {attention weight}= softmax(\frac{Qâ‹…K}{d}V)$ï¼Œåœ¨å¼•å…¥ç›¸å¯¹ä½ç½®ç¼–ç åï¼Œé¦–å…ˆè¦è®¡ç®—å‡º$a_{ij}=(q_i+b)^T_{s_{sj}}$ï¼Œå…¶ä¸­$b$ä¹Ÿæ˜¯ä¸€ä¸ªéœ€è¦è®­ç»ƒå¾—åˆ°çš„åæ‰§é‡ï¼Œæœ€åæŠŠå¾—åˆ°çš„$a_ij$ä¸ä¼ ç»Ÿçš„transformerçš„weightç›¸åŠ ä»è€Œå¾—åˆ°æœ€ç»ˆçš„attention weightã€‚</p>
<p><a href="https://github.com/huggingface/transformers/blob/master/src/transformers/modeling_xlnet.py" target="_blank" rel="noopener">æºç </a></p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>åœ¨å®éªŒä¸­å‘ç°ï¼Œxlnetæ›´å¤šè¿˜æ˜¯åœ¨é•¿æ–‡æœ¬çš„é˜…è¯»ç†è§£ç±»çš„ä»»åŠ¡ä¸Šæå‡æ›´æ˜æ˜¾ä¸€äº›ï¼Œè¿™ä¹Ÿå¾ˆç¬¦åˆä¸Šæ–‡ä¸­ä»‹ç»çš„è¿™äº›ä¼˜åŒ–ç‚¹ï¼Œåœ¨å®é™…å·¥ä¸šåœºæ™¯ä¸­ï¼Œæœºå™¨ç¿»è¯‘ã€æœ¬æ–‡æ‘˜è¦ç±»çš„ä»»åŠ¡åº”è¯¥ä¼šæœ‰æ›´å¥½çš„æ•ˆæœï¼Œå½“ç„¶åœ¨å…¶ä»–çš„æ–‡æœ¬åˆ†ç±»ã€è‡ªç„¶è¯­è¨€æ¨ç†ç­‰ä»»åŠ¡ä¸Šxlnetä¹Ÿæœ‰ä¸€å®šçš„æ•ˆæœæå‡ã€‚nlpé¢†åŸŸçš„æ¨¡å‹ç›®å‰å·²ç»å®Œå…¨é‡‡ç”¨äº†pretrain+fine tuningçš„æ¨¡å¼ï¼ŒGPT2.0çš„å•å‘æ¨¡å¼åœ¨å¢å¤§è®­ç»ƒè¯­æ–™çš„æƒ…å†µä¸‹æ•ˆæœå°±å·²ç»è¶…è¶Šäº†bertï¼Œå¯æƒ³è€ŒçŸ¥è¯¥é¢†åŸŸçš„ç ”ç©¶è¿˜æœ‰å¾ˆå¤§çš„ä¸Šå‡ç©ºé—´</p>
<h3 id="RoBERTa"><a href="#RoBERTa" class="headerlink" title="RoBERTa"></a>RoBERTa</h3><h4 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>åœ¨XLNetå…¨é¢è¶…è¶ŠBertåæ²¡å¤šä¹…ï¼ŒFacebookæå‡ºäº†RoBERTaï¼ˆa Robustly Optimized BERT Pretraining Approachï¼‰ã€‚å†åº¦åœ¨å¤šä¸ªä»»åŠ¡ä¸Šè¾¾åˆ°SOTAã€‚</p>
<p>å®ƒåœ¨æ¨¡å‹å±‚é¢æ²¡æœ‰æ”¹å˜Googleçš„Bertï¼Œ<strong>æ”¹å˜çš„åªæ˜¯é¢„è®­ç»ƒçš„æ–¹æ³•</strong>ã€‚</p>
<h4 id="åŠ¨æœº"><a href="#åŠ¨æœº" class="headerlink" title="åŠ¨æœº"></a>åŠ¨æœº</h4><p>Yinhan Liuç­‰äºº[6]è®¤ä¸ºè¶…å‚æ•°çš„é€‰æ‹©å¯¹æœ€ç»ˆç»“æœæœ‰é‡å¤§å½±å“ï¼Œä¸ºæ­¤ä»–ä»¬æå‡ºäº†BERTé¢„è®­ç»ƒçš„é‡å¤ç ”ç©¶ï¼Œå…¶ä¸­åŒ…æ‹¬å¯¹è¶…å‚æ•°è°ƒæ•´å’Œè®­ç»ƒé›†å¤§å°çš„å½±å“çš„ä»”ç»†è¯„ä¼°ã€‚<strong>æœ€ç»ˆï¼Œä»–ä»¬å‘ç°äº†BERTçš„è®­ç»ƒä¸è¶³</strong>ï¼Œå¹¶æå‡ºäº†ä¸€ç§æ”¹è¿›çš„æ¨¡å‹æ¥è®­ç»ƒBERTæ¨¡å‹ã€‚</p>
<h4 id="æ”¹è¿›"><a href="#æ”¹è¿›" class="headerlink" title="æ”¹è¿›"></a>æ”¹è¿›</h4><h5 id="é™æ€Masking-vs-åŠ¨æ€Masking"><a href="#é™æ€Masking-vs-åŠ¨æ€Masking" class="headerlink" title="é™æ€Masking vs åŠ¨æ€Masking"></a>é™æ€Masking vs åŠ¨æ€Masking</h5><p>åŸæ¥Bertå¯¹æ¯ä¸€ä¸ªåºåˆ—éšæœºé€‰æ‹©15%çš„Tokensæ›¿æ¢æˆ[MASK]ï¼Œä¸ºäº†æ¶ˆé™¤ä¸ä¸‹æ¸¸ä»»åŠ¡çš„ä¸åŒ¹é…ï¼Œè¿˜å¯¹è¿™15%çš„Tokensè¿›è¡Œï¼ˆ1ï¼‰80%çš„æ¦‚ç‡æ›¿æ¢æˆ[MASK]ï¼›ï¼ˆ2ï¼‰10%çš„æ¦‚ç‡ä¸å˜ï¼›ï¼ˆ3ï¼‰10%çš„æ¦‚ç‡æ›¿æ¢æˆå…¶ä»–è¯ã€‚ä½†æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ï¼Œè¿™15%çš„Tokensä¸€æ—¦è¢«é€‰æ‹©å°±ä¸å†æ”¹å˜ï¼Œä¹Ÿå°±æ˜¯è¯´ä»ä¸€å¼€å§‹éšæœºé€‰æ‹©äº†è¿™15%çš„Tokensï¼Œä¹‹åçš„Nä¸ªepoché‡Œéƒ½ä¸å†æ”¹å˜äº†ã€‚è¿™å°±å«åšé™æ€Maskingã€‚</p>
<p>è€ŒRoBERTaä¸€å¼€å§‹æŠŠé¢„è®­ç»ƒçš„æ•°æ®å¤åˆ¶10ä»½ï¼Œæ¯ä¸€ä»½éƒ½éšæœºé€‰æ‹©15%çš„Tokensè¿›è¡ŒMaskingï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒæ ·çš„ä¸€å¥è¯æœ‰10ç§ä¸åŒçš„maskæ–¹å¼ã€‚ç„¶åæ¯ä»½æ•°æ®éƒ½è®­ç»ƒN/10ä¸ªepochã€‚è¿™å°±ç›¸å½“äºåœ¨è¿™Nä¸ªepochçš„è®­ç»ƒä¸­ï¼Œæ¯ä¸ªåºåˆ—çš„è¢«maskçš„tokensæ˜¯ä¼šå˜åŒ–çš„ã€‚è¿™å°±å«åšåŠ¨æ€Maskingã€‚ä½œè€…åœ¨åªå°†é™æ€Maskingæ”¹æˆåŠ¨æ€Maskingï¼Œå…¶ä»–å‚æ•°ä¸å˜çš„æƒ…å†µä¸‹åšäº†å®éªŒï¼ŒåŠ¨æ€Maskingç¡®å®èƒ½æé«˜æ€§èƒ½ã€‚</p>
<h5 id="with-NSP-vs-without-NSP"><a href="#with-NSP-vs-without-NSP" class="headerlink" title="with NSP vs without NSP"></a>with NSP vs without NSP</h5><p>åŸæœ¬çš„Bertä¸ºäº†æ•æ‰å¥å­ä¹‹é—´çš„å…³ç³»ï¼Œä½¿ç”¨äº†NSPä»»åŠ¡è¿›è¡Œé¢„è®­ç»ƒï¼Œå°±æ˜¯è¾“å…¥ä¸€å¯¹å¥å­Aå’ŒBï¼Œåˆ¤æ–­è¿™ä¸¤ä¸ªå¥å­æ˜¯å¦æ˜¯è¿ç»­çš„ã€‚åœ¨è®­ç»ƒçš„æ•°æ®ä¸­ï¼Œ50%çš„Bæ˜¯Açš„ä¸‹ä¸€ä¸ªå¥å­ï¼Œ50%çš„Bæ˜¯éšæœºæŠ½å–çš„ã€‚</p>
<p>è€ŒRoBERTaå»é™¤äº†NSPï¼Œè€Œæ˜¯æ¯æ¬¡è¾“å…¥è¿ç»­çš„å¤šä¸ªå¥å­ï¼Œç›´åˆ°æœ€å¤§é•¿åº¦512ï¼ˆå¯ä»¥è·¨æ–‡ç« ï¼‰ã€‚è¿™ç§è®­ç»ƒæ–¹å¼å«åšï¼ˆFULL - SENTENCESï¼‰ï¼Œè€ŒåŸæ¥çš„Bertæ¯æ¬¡åªè¾“å…¥ä¸¤ä¸ªå¥å­ã€‚å®éªŒè¡¨æ˜åœ¨MNLIè¿™ç§æ¨æ–­å¥å­å…³ç³»çš„ä»»åŠ¡ä¸ŠRoBERTaä¹Ÿèƒ½æœ‰æ›´å¥½æ€§èƒ½ã€‚ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼‰</p>
<h5 id="æ›´å¤§çš„mini-batch"><a href="#æ›´å¤§çš„mini-batch" class="headerlink" title="æ›´å¤§çš„mini-batch"></a>æ›´å¤§çš„mini-batch</h5><p>åŸæœ¬çš„BERTbase çš„batch sizeæ˜¯256ï¼Œè®­ç»ƒ1Mä¸ªstepsã€‚RoBERTaçš„batch sizeä¸º8kã€‚ä¸ºä»€ä¹ˆè¦ç”¨æ›´å¤§çš„batch sizeå‘¢ï¼Ÿä½œè€…å€Ÿé‰´äº†åœ¨æœºå™¨ç¿»è¯‘ä¸­ï¼Œç”¨æ›´å¤§çš„batch sizeé…åˆæ›´å¤§å­¦ä¹ ç‡èƒ½æå‡æ¨¡å‹ä¼˜åŒ–é€Ÿç‡å’Œæ¨¡å‹æ€§èƒ½çš„ç°è±¡ï¼Œå¹¶ä¸”ä¹Ÿç”¨å®éªŒè¯æ˜äº†ç¡®å®Bertè¿˜èƒ½ç”¨æ›´å¤§çš„batch sizeã€‚</p>
<h5 id="æ›´å¤šçš„æ•°æ®ï¼Œæ›´é•¿çš„è®­ç»ƒæ—¶é—´"><a href="#æ›´å¤šçš„æ•°æ®ï¼Œæ›´é•¿çš„è®­ç»ƒæ—¶é—´" class="headerlink" title="æ›´å¤šçš„æ•°æ®ï¼Œæ›´é•¿çš„è®­ç»ƒæ—¶é—´"></a>æ›´å¤šçš„æ•°æ®ï¼Œæ›´é•¿çš„è®­ç»ƒæ—¶é—´</h5><p>å€Ÿé‰´XLNetç”¨äº†æ¯”Bertå¤š10å€çš„æ•°æ®ï¼ŒRoBERTaä¹Ÿç”¨äº†æ›´å¤šçš„æ•°æ®ã€‚æ€§èƒ½ç¡®å®å†æ¬¡å½ªå‡ã€‚å½“ç„¶ï¼Œä¹Ÿéœ€è¦é…åˆæ›´é•¿æ—¶é—´çš„è®­ç»ƒã€‚</p>
<h5 id="Byte-Pair-Encoding-BPE-å­—ç¬¦ç¼–ç "><a href="#Byte-Pair-Encoding-BPE-å­—ç¬¦ç¼–ç " class="headerlink" title="Byte-Pair Encoding (BPE)å­—ç¬¦ç¼–ç "></a>Byte-Pair Encoding (BPE)å­—ç¬¦ç¼–ç </h5><p>ä½¿ç”¨Sennrich[8]ç­‰äººæå‡ºçš„Byte-Pair Encoding (BPE)å­—ç¬¦ç¼–ç ï¼Œå®ƒæ˜¯å­—ç¬¦çº§å’Œå•è¯çº§è¡¨ç¤ºä¹‹é—´çš„æ··åˆä½“ï¼Œå¯ä»¥å¤„ç†è‡ªç„¶è¯­è¨€è¯­æ–™åº“ä¸­å¸¸è§çš„å¤§è¯æ±‡ï¼Œé¿å…è®­ç»ƒæ•°æ®å‡ºç°æ›´å¤šçš„â€œ[UNK]â€æ ‡å¿—ç¬¦å·ï¼Œä»è€Œå½±å“é¢„è®­ç»ƒæ¨¡å‹çš„æ€§èƒ½ã€‚å…¶ä¸­ï¼Œâ€œ[UNK]â€æ ‡è®°ç¬¦è¡¨ç¤ºå½“åœ¨BERTè‡ªå¸¦å­—å…¸vocab.txtæ‰¾ä¸åˆ°æŸä¸ªå­—æˆ–è€…è‹±æ–‡å•è¯æ—¶ï¼Œåˆ™ç”¨â€œ[UNK]â€è¡¨ç¤ºã€‚</p>
<h3 id="SpanBERT"><a href="#SpanBERT" class="headerlink" title="SpanBERT"></a>SpanBERT</h3><p><a href="https://arxiv.org/pdf/1907.10529.pdf" target="_blank" rel="noopener">è®ºæ–‡</a></p>
<h4 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>åœ¨è®¸å¤š NLP ä»»åŠ¡ä¸­éƒ½æ¶‰åŠå¯¹å¤šä¸ªæ–‡æœ¬åˆ†è¯é—´å…³ç³»çš„æ¨ç†ã€‚ä¾‹å¦‚ï¼Œåœ¨æŠ½å–å¼é—®ç­”ä»»åŠ¡ä¸­ï¼Œåœ¨å›ç­”é—®é¢˜â€œWhich NFL team won Super Bown 50?â€æ—¶ï¼Œåˆ¤æ–­â€œDenver Broncosâ€ æ˜¯å¦å±äºâ€œNFL teamâ€æ˜¯éå¸¸é‡è¦çš„æ­¥éª¤ã€‚ç›¸æ¯”äºåœ¨å·²çŸ¥â€œBroncosâ€é¢„æµ‹â€œDenverâ€çš„æƒ…å†µï¼Œç›´æ¥é¢„æµ‹â€œDenver Broncosâ€éš¾åº¦æ›´å¤§ï¼Œè¿™æ„å‘³ç€è¿™ç±»åˆ†è¯å¯¹è‡ªç›‘ç£ä»»åŠ¡æå‡ºäº†æ›´å¤šçš„æŒ‘æˆ˜ã€‚</p>
<p>SpanBertå¯¹ BERT æ¨¡å‹è¿›è¡Œäº†å¦‚ä¸‹æ”¹è¿›ï¼š</p>
<ol>
<li>æ²¡æœ‰segment embeddingï¼Œåªæœ‰ä¸€ä¸ªé•¿çš„å¥å­ï¼Œç±»ä¼¼RoBERTaã€‚</li>
<li><strong>Span Masking</strong>:å¯¹éšæœºçš„é‚»æ¥åˆ†è¯ï¼ˆspanï¼‰è€Œééšæœºçš„å•ä¸ªè¯è¯­ï¼ˆtokenï¼‰æ·»åŠ maskï¼›</li>
<li>MLM+SBO:é€šè¿‡ä½¿ç”¨åˆ†è¯è¾¹ç•Œçš„è¡¨ç¤ºæ¥é¢„æµ‹è¢«æ·»åŠ maskçš„åˆ†è¯çš„å†…å®¹ï¼Œä¸å†ä¾èµ–åˆ†è¯å†…å•ä¸ª token çš„è¡¨ç¤ºã€‚</li>
</ol>
<p>SpanBERT èƒ½å¤Ÿå¯¹åˆ†è¯è¿›è¡Œæ›´å¥½åœ°è¡¨ç¤ºå’Œé¢„æµ‹ã€‚è¯¥æ¨¡å‹å’Œ BERT åœ¨maskæœºåˆ¶å’Œè®­ç»ƒç›®æ ‡ä¸Šå­˜åœ¨å·®åˆ«ã€‚é¦–å…ˆï¼ŒSpanBERT ä¸å†å¯¹éšæœºçš„å•ä¸ª token æ·»åŠ maskï¼Œè€Œæ˜¯å¯¹éšæœºå¯¹é‚»æ¥åˆ†è¯æ·»åŠ maskã€‚å…¶æ¬¡ï¼ŒSpanBertæå‡ºäº†ä¸€ä¸ªæ–°çš„è®­ç»ƒç›®æ ‡ span-boundary objective (SBO) è¿›è¡Œæ¨¡å‹è®­ç»ƒã€‚é€šè¿‡å¯¹åˆ†è¯æ·»åŠ maskï¼Œä½œè€…èƒ½å¤Ÿä½¿æ¨¡å‹ä¾æ®å…¶æ‰€åœ¨è¯­å¢ƒé¢„æµ‹æ•´ä¸ªåˆ†è¯ã€‚å¦å¤–ï¼ŒSBO èƒ½ä½¿æ¨¡å‹åœ¨è¾¹ç•Œè¯ä¸­å­˜å‚¨å…¶åˆ†è¯çº§åˆ«çš„ä¿¡æ¯ï¼Œä½¿å¾—æ¨¡å‹çš„è°ƒä¼˜æ›´ä½³å®¹æ˜“ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/spanbert.png" alt="avatar"></p>
<p>æ¨¡å‹ä½¿ç”¨è¾¹ç•Œè¯ waså’Œ toæ¥é¢„æµ‹åˆ†è¯ä¸­çš„æ¯ä¸ªå•è¯ã€‚</p>
<p>ä¸ºäº†æ­å»º SpanBERT ï¼Œä½œè€…é¦–å…ˆæ„å»ºäº†ä¸€ä¸ª BERT æ¨¡å‹çš„å¹¶è¿›è¡Œäº†å¾®è°ƒï¼ŒSpanBERTçš„è¡¨ç°ä¼˜äºåŸå§‹ BERT æ¨¡å‹ã€‚åœ¨æ­å»ºbaselineçš„æ—¶å€™ï¼Œä½œè€…å‘ç°å¯¹å•ä¸ªéƒ¨åˆ†è¿›è¡Œé¢„è®­ç»ƒçš„æ•ˆæœï¼Œæ¯”ä½¿ç”¨ next sentence prediction (NSP) ç›®æ ‡å¯¹ä¸¤ä¸ªé•¿åº¦ä¸ºä¸€åŠçš„éƒ¨åˆ†è¿›è¡Œè®­ç»ƒçš„æ•ˆæœæ›´ä¼˜ï¼Œåœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸­è¡¨ç°å°¤å…¶æ˜æ˜¾ã€‚å› æ­¤ï¼Œä½œè€…åœ¨ç»è¿‡è°ƒä¼˜çš„ BERT æ¨¡å‹çš„é¡¶ç«¯å¯¹æ¨¡å‹è¿›è¡Œäº†æ”¹è¿›ã€‚</p>
<h4 id="Span-Masking"><a href="#Span-Masking" class="headerlink" title="Span Masking(????)"></a>Span Masking(????)</h4><p>å¯¹äºæ¯ä¸€ä¸ªå•è¯åºåˆ— $X = (x_1, \ldots , x_n )$ï¼Œä½œè€…é€šè¿‡è¿­ä»£åœ°é‡‡æ ·æ–‡æœ¬çš„åˆ†è¯é€‰æ‹©å•è¯ï¼Œç›´åˆ°è¾¾åˆ°æ©è†œè¦æ±‚çš„å¤§å°ï¼ˆä¾‹å¦‚ X çš„ 15%ï¼‰ï¼Œå¹¶å½¢æˆ X çš„å­é›† Yã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œä½œè€…é¦–å…ˆä»å‡ ä½•åˆ†å¸ƒ $l \sim Geo(p)$ä¸­é‡‡æ ·å¾—åˆ°åˆ†è¯çš„é•¿åº¦ï¼Œè¯¥å‡ ä½•åˆ†å¸ƒæ˜¯åæ€åˆ†å¸ƒï¼Œåå‘äºè¾ƒçŸ­çš„åˆ†è¯ã€‚ä¹‹åï¼Œä½œè€…éšæœºï¼ˆå‡åŒ€åœ°ï¼‰é€‰æ‹©åˆ†è¯çš„èµ·ç‚¹ã€‚</p>
<p>æ ¹æ®å‡ ä½•åˆ†å¸ƒï¼Œå…ˆéšæœºé€‰æ‹©ä¸€æ®µï¼ˆspanï¼‰çš„é•¿åº¦ï¼Œä¹‹åå†æ ¹æ®å‡åŒ€åˆ†å¸ƒéšæœºé€‰æ‹©è¿™ä¸€æ®µçš„èµ·å§‹ä½ç½®ï¼Œæœ€åæŒ‰ç…§é•¿åº¦é®ç›–ã€‚ä½œè€…è®¾å®šå‡ ä½•åˆ†å¸ƒå– p=0.2ï¼Œå¹¶è£å‰ªæœ€å¤§é•¿åº¦åªèƒ½æ˜¯ 10ï¼ˆä¸åº”å½“æ˜¯é•¿åº¦ 10 ä»¥ä¸Šä¿®å‰ªï¼Œè€Œåº”å½“ä¸ºä¸¢å¼ƒï¼‰ï¼Œåˆ©ç”¨æ­¤æ–¹æ¡ˆè·å¾—å¹³å‡é‡‡æ ·é•¿åº¦åˆ†å¸ƒã€‚å› æ­¤åˆ†è¯çš„å¹³å‡é•¿åº¦ä¸º 3.8 ã€‚ä½œè€…è¿˜æµ‹é‡äº†è¯è¯­ï¼ˆwordï¼‰ä¸­çš„åˆ†è¯ç¨‹åº¦ï¼Œä½¿å¾—æ·»åŠ æ©è†œçš„åˆ†è¯æ›´é•¿ã€‚ä¸‹å›¾å±•ç¤ºäº†åˆ†è¯æ©è†œé•¿åº¦çš„åˆ†å¸ƒæƒ…å†µã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/spanbert_fenci.png" alt="avatar"></p>
<p>å’Œåœ¨ BERT ä¸­ä¸€æ ·ï¼Œä½œè€…å°† Y çš„è§„æ¨¡è®¾å®šä¸º X çš„15%ï¼Œå…¶ä¸­ 80% ä½¿ç”¨ [MASK] è¿›è¡Œæ›¿æ¢ï¼Œ10% ä½¿ç”¨éšæœºå•è¯æ›¿æ¢ï¼Œ10%ä¿æŒä¸å˜ã€‚ä¸ä¹‹ä¸åŒçš„æ˜¯ï¼Œä½œè€…æ˜¯åœ¨åˆ†è¯çº§åˆ«è¿›è¡Œçš„è¿™ä¸€æ›¿æ¢ï¼Œè€Œéå°†æ¯ä¸ªå•è¯å•ç‹¬æ›¿æ¢ã€‚</p>
<h4 id="åˆ†è¯è¾¹ç•Œç›®æ ‡-SBO"><a href="#åˆ†è¯è¾¹ç•Œç›®æ ‡-SBO" class="headerlink" title="åˆ†è¯è¾¹ç•Œç›®æ ‡(SBO)???"></a>åˆ†è¯è¾¹ç•Œç›®æ ‡(SBO)???</h4><p>åˆ†è¯é€‰æ‹©æ¨¡å‹ä¸€èˆ¬ä½¿ç”¨å…¶è¾¹ç•Œè¯åˆ›å»ºä¸€ä¸ªå›ºå®šé•¿åº¦çš„åˆ†è¯è¡¨ç¤ºã€‚ä¸ºäº†äºè¯¥æ¨¡å‹ç›¸é€‚åº”ï¼Œä½œè€…å¸Œæœ›ç»“å°¾åˆ†è¯çš„è¡¨ç¤ºçš„æ€»å’Œä¸ä¸­é—´åˆ†è¯çš„å†…å®¹å°½é‡ç›¸åŒã€‚ä¸ºæ­¤ï¼Œä½œè€…å¼•å…¥äº† SBO ï¼Œå…¶ä»…ä½¿ç”¨è§‚æµ‹åˆ°çš„è¾¹ç•Œè¯æ¥é¢„æµ‹å¸¦æ©è†œçš„åˆ†è¯çš„å†…å®¹ã€‚</p>
<p>å…·ä½“åšæ³•æ˜¯ï¼Œåœ¨è®­ç»ƒæ—¶å– Span å‰åè¾¹ç•Œçš„ä¸¤ä¸ªè¯ï¼Œå€¼å¾—æŒ‡å‡ºï¼Œè¿™ä¸¤ä¸ªè¯ä¸åœ¨ Span å†…ï¼Œç„¶å<strong>ç”¨è¿™ä¸¤ä¸ªè¯å‘é‡åŠ ä¸Š Span ä¸­è¢«é®ç›–æ‰è¯çš„ä½ç½®å‘é‡ï¼Œæ¥é¢„æµ‹åŸè¯</strong>ã€‚</p>
<script type="math/tex; mode=display">
\mathbf{y}_{i}=f\left(\mathbf{x}_{s-1}, \mathbf{x}_{e+1}, \mathbf{p}_{i}\right)</script><p>è¯¦ç»†åšæ³•æ˜¯å°†è¯å‘é‡å’Œä½ç½®å‘é‡æ‹¼æ¥èµ·æ¥ï¼Œä½œè€…ä½¿ç”¨ä¸€ä¸ªä¸¤å±‚çš„å‰é¦ˆç¥ç»ç½‘ç»œä½œä¸ºè¡¨ç¤ºå‡½æ•°ï¼Œè¯¥ç½‘ç»œä½¿ç”¨ GeLu æ¿€æ´»å‡½æ•°ï¼Œå¹¶ä½¿ç”¨å±‚æ­£åˆ™åŒ–ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathbf{h} &=\text { LayerNorm }\left(\operatorname{GeLU}\left(W_{1} \cdot\left[\mathbf{x}_{s-1} ; \mathbf{x}_{e+1} ; \mathbf{p}_{i}\right]\right)\right) \\
f(\cdot) &=\text { LayerNorm }\left(\operatorname{GeLU}\left(W_{2} \cdot \mathbf{h}\right)\right)
\end{aligned}</script><p>ä½œè€…ä½¿ç”¨å‘é‡è¡¨ç¤º$y_i$æ¥é¢„æµ‹$x_i$ï¼Œå¹¶å’Œ MLM ä¸€æ ·ä½¿ç”¨äº¤å‰ç†µä½œä¸ºæŸå¤±å‡½æ•°ï¼Œå°±æ˜¯ SBO ç›®æ ‡çš„æŸå¤±ï¼Œä¹‹åå°†è¿™ä¸ªæŸå¤±å’Œ BERT çš„ <strong>Mased Language Model ï¼ˆMLMï¼‰</strong>çš„æŸå¤±åŠ èµ·æ¥ï¼Œä¸€èµ·ç”¨äºè®­ç»ƒæ¨¡å‹ã€‚</p>
<script type="math/tex; mode=display">
\mathcal{L}(\text { football })=\mathcal{L}_{\mathrm{MLM}}\left(\mathbf{x}_{7}\right)+\mathcal{L}_{\mathrm{SBO}}\left(\mathbf{x}_{4}, \mathbf{x}_{9}, \mathbf{p}_{7}\right)</script><h4 id="å•åºåˆ—è®­ç»ƒ"><a href="#å•åºåˆ—è®­ç»ƒ" class="headerlink" title="å•åºåˆ—è®­ç»ƒ"></a>å•åºåˆ—è®­ç»ƒ</h4><p>SpanBERT æ²¡ç”¨ Next Sentence Prediction (NSP) ä»»åŠ¡ï¼Œè€Œæ˜¯ç›´æ¥ç”¨ Single-Sequence Trainingï¼Œä¹Ÿå°±æ˜¯ä¸åŠ å…¥ NSP ä»»åŠ¡æ¥åˆ¤æ–­æ˜¯å¦ä¸¤å¥æ˜¯ä¸Šä¸‹å¥ï¼Œç›´æ¥ç”¨ä¸€å¥æ¥è®­ç»ƒï¼Œç‰‡æ®µé•¿åº¦æœ€å¤šä¸º512ä¸ªå•è¯ã€‚</p>
<h4 id="ç»†èŠ‚"><a href="#ç»†èŠ‚" class="headerlink" title="ç»†èŠ‚"></a>ç»†èŠ‚</h4><ol>
<li>è®­ç»ƒæ—¶ç”¨äº† <strong>Dynamic Masking</strong> è€Œä¸æ˜¯åƒ BERT åœ¨é¢„å¤„ç†æ—¶åš é™æ€Maskã€‚</li>
<li><strong>å–æ¶ˆ BERT ä¸­éšæœºé‡‡æ ·çŸ­å¥çš„ç­–ç•¥</strong></li>
<li>å¯¹Adamä¼˜åŒ–å™¨ä¸­çš„ä¸€äº›å‚æ•°åšäº†æ”¹å˜ã€‚</li>
</ol>
<h5 id="maskæœºåˆ¶"><a href="#maskæœºåˆ¶" class="headerlink" title="maskæœºåˆ¶"></a>maskæœºåˆ¶</h5><p>ä½œè€…åœ¨å­å•è¯ã€å®Œæ•´è¯è¯­ã€å‘½åå®ä½“ã€åè¯çŸ­è¯­å’Œéšæœºåˆ†è¯æ–¹é¢è¿›è¡Œäº†æ¯”è¾ƒï¼šå‘ç°ä½¿ç”¨éšæœºåˆ†è¯æ©è†œæœºåˆ¶æ•ˆæœæ›´ä¼˜ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/spanbert_token.png" alt="avatar"></p>
<h5 id="è¾…åŠ©ç›®æ ‡"><a href="#è¾…åŠ©ç›®æ ‡" class="headerlink" title="è¾…åŠ©ç›®æ ‡"></a>è¾…åŠ©ç›®æ ‡</h5><p>ä½¿ç”¨ SBO æ›¿æ¢ NSP å¹¶ä½¿ç”¨å•åºåˆ—è¿›è¡Œé¢„æµ‹çš„æ•ˆæœæ›´ä¼˜ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/spanbert_a_o.png" alt="avatar"></p>
<h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>SpanBERTæ˜¯åŸºäºåˆ†è¯çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œåœ¨å¤šä¸ªè¯„æµ‹ä»»åŠ¡ä¸­çš„å¾—åˆ†éƒ½è¶…è¶Šäº† BERT ä¸”åœ¨åˆ†è¯é€‰æ‹©ç±»ä»»åŠ¡ä¸­çš„æå‡å°¤å…¶æ˜æ˜¾ã€‚</p>
<h3 id="ERNIE"><a href="#ERNIE" class="headerlink" title="ERNIE"></a>ERNIE</h3><p><a href="https://arxiv.org/pdf/1905.07129" target="_blank" rel="noopener">è®ºæ–‡</a></p>
<h4 id="ç®€ä»‹-3"><a href="#ç®€ä»‹-3" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>æ— è®ºæ˜¯Elmoã€GPT, è¿˜æ˜¯èƒ½åŠ›æ›´å¼ºçš„ BERT æ¨¡å‹ï¼Œå…¶å»ºæ¨¡å¯¹è±¡ä¸»è¦èšç„¦åœ¨åŸå§‹è¯­è¨€ä¿¡å·ä¸Šï¼Œè¾ƒå°‘åˆ©ç”¨è¯­ä¹‰çŸ¥è¯†å•å…ƒå»ºæ¨¡ã€‚è¿™ä¸ªé—®é¢˜åœ¨ä¸­æ–‡æ–¹é¢å°¤ä¸ºæ˜æ˜¾ï¼Œä¾‹å¦‚ï¼ŒBERT åœ¨å¤„ç†ä¸­æ–‡è¯­è¨€æ—¶ï¼Œé€šè¿‡é¢„æµ‹æ±‰å­—è¿›è¡Œå»ºæ¨¡ï¼Œæ¨¡å‹å¾ˆéš¾å­¦å‡ºæ›´å¤§è¯­ä¹‰å•å…ƒçš„å®Œæ•´è¯­ä¹‰è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¹’ [mask] çƒï¼Œæ¸…æ˜ä¸Š [mask] å›¾ï¼Œ[mask] é¢œå…­è‰²è¿™äº›è¯ï¼ŒBERT æ¨¡å‹é€šè¿‡å­—çš„æ­é…ï¼Œå¾ˆå®¹æ˜“æ¨æµ‹å‡ºæ©ç çš„å­—ä¿¡æ¯ï¼Œä½†æ²¡æœ‰æ˜¾å¼åœ°å¯¹è¯­ä¹‰æ¦‚å¿µå•å…ƒ (å¦‚ä¹’ä¹“çƒã€æ¸…æ˜ä¸Šæ²³å›¾) ä»¥åŠå…¶å¯¹åº”çš„è¯­ä¹‰å…³ç³»è¿›è¡Œå»ºæ¨¡ã€‚å¦‚æœèƒ½å¤Ÿè®©æ¨¡å‹å­¦ä¹ åˆ°æµ·é‡æ–‡æœ¬ä¸­è•´å«çš„æ½œåœ¨çŸ¥è¯†ï¼ŒåŠ¿å¿…ä¼šè¿›ä¸€æ­¥æå‡å„ä¸ª NLP ä»»åŠ¡æ•ˆæœã€‚</p>
<p>ERNIE æ¨¡å‹é€šè¿‡å»ºæ¨¡æµ·é‡æ•°æ®ä¸­çš„å®ä½“æ¦‚å¿µç­‰å…ˆéªŒè¯­ä¹‰çŸ¥è¯†ï¼Œå­¦ä¹ çœŸå®ä¸–ç•Œçš„è¯­ä¹‰å…³ç³»ã€‚å…·ä½“æ¥è¯´ï¼ŒERNIE æ¨¡å‹é€šè¿‡å¯¹è¯ã€å®ä½“ç­‰è¯­ä¹‰å•å…ƒçš„æ©ç ï¼Œä½¿å¾—æ¨¡å‹å­¦ä¹ å®Œæ•´æ¦‚å¿µçš„è¯­ä¹‰è¡¨ç¤ºã€‚ç›¸è¾ƒäº BERT å­¦ä¹ åŸå§‹è¯­è¨€ä¿¡å·ï¼ŒERNIE ç›´æ¥å¯¹å…ˆéªŒè¯­ä¹‰çŸ¥è¯†å•å…ƒè¿›è¡Œå»ºæ¨¡ï¼Œå¢å¼ºäº†æ¨¡å‹è¯­ä¹‰è¡¨ç¤ºèƒ½åŠ›ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/ernie.png" alt="avatar"></p>
<p>åœ¨ BERT æ¨¡å‹ä¸­ï¼Œé€šè¿‡ã€å“ˆã€ä¸ã€æ»¨ã€çš„å±€éƒ¨å…±ç°ï¼Œå³å¯åˆ¤æ–­å‡ºã€å°”ã€å­—ï¼Œæ¨¡å‹æ²¡æœ‰å­¦ä¹ ä¸ã€å“ˆå°”æ»¨ã€ç›¸å…³çš„çŸ¥è¯†ã€‚è€Œ ERNIE é€šè¿‡å­¦ä¹ è¯ä¸å®ä½“çš„è¡¨è¾¾ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿå»ºæ¨¡å‡ºã€å“ˆå°”æ»¨ã€ä¸ã€é»‘é¾™æ±Ÿã€çš„å…³ç³»ï¼Œå­¦åˆ°ã€å“ˆå°”æ»¨ã€æ˜¯ã€é»‘é¾™æ±Ÿã€çš„çœä¼šä»¥åŠã€å“ˆå°”æ»¨ã€æ˜¯ä¸ªå†°é›ªåŸå¸‚ã€‚</p>
<h4 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/ernie_ar.png" alt="avatar"></p>
<p>æ¨¡å‹ä¸Šä¸»è¦çš„æ”¹è¿›æ˜¯åœ¨bertçš„åæ®µåŠ å…¥äº†å®ä½“å‘é‡å’Œç»è¿‡bertç¼–ç åçš„å‘é‡æ‹¼æ¥ï¼Œå¦å¤–åœ¨è¾“å‡ºæ—¶å¤šåŠ äº†å®ä½“è‡ªç¼–ç çš„ä»»åŠ¡ï¼Œä»è€Œå¸®åŠ©æ¨¡å‹æ³¨å…¥å®ä½“çŸ¥è¯†ä¿¡æ¯ã€‚</p>
<h5 id="T-Encoder"><a href="#T-Encoder" class="headerlink" title="T-Encoder"></a>T-Encoder</h5><p>è¿™éƒ¨åˆ†å°±æ˜¯çº¯ç²¹çš„bertç»“æ„ï¼Œåœ¨è¯¥éƒ¨åˆ†æ¨¡å‹ä¸­ä¸»è¦è´Ÿè´£å¯¹è¾“å…¥å¥å­ï¼ˆtoken embedding, segment embeddingå’Œpositional embeddingï¼‰è¿›è¡Œç¼–ç .</p>
<h5 id="K-Encoder"><a href="#K-Encoder" class="headerlink" title="K-Encoder"></a>K-Encoder</h5><p>å¼•å…¥å®ä½“ä¿¡æ¯ï¼Œä½¿ç”¨äº†TransEè®­ç»ƒå®ä½“å‘é‡ï¼Œå†é€šè¿‡å¤šå¤´Attentionè¿›è¡Œç¼–ç ï¼Œç„¶åé€šè¿‡å®ä½“å¯¹é½æŠ€æœ¯ï¼Œå°†å®ä½“å‘é‡åŠ å…¥åˆ°å¯¹åº”å®ä½“çš„ç¬¬ä¸€ä¸ªtokenç¼–ç åçš„å‘é‡ä¸Šã€‚ï¼ˆä¾‹å¦‚å§šæ˜æ˜¯ä¸€ä¸ªå®ä½“ï¼Œåœ¨è¾“å…¥æ—¶ä¼šè¢«åˆ†å‰²æˆå§šã€æ˜ï¼Œæœ€ååœ¨è¿™éƒ¨åˆ†å¼•å…¥çš„å§šæ˜è¿™ä¸ªå®ä½“çš„å‘é‡ä¼šè¢«åŠ å…¥åˆ°â€œå§šâ€è¿™ä¸ªå­—ç»è¿‡bertä¹‹åçš„å‘é‡ä¸Šå»ï¼‰</p>
<script type="math/tex; mode=display">
\begin{aligned}
\left\{\tilde{\boldsymbol{w}}_{1}^{(i)}, \ldots, \tilde{\boldsymbol{w}}_{n}^{(i)}\right\} &=\mathrm{MH}-\mathrm{ATT}\left(\left\{\boldsymbol{w}_{1}^{(i-1)}, \ldots, \boldsymbol{w}_{n}^{(i-1)}\right\}\right) \\
\left\{\tilde{\boldsymbol{e}}_{1}^{(i)}, \ldots, \tilde{\boldsymbol{e}}_{m}^{(i)}\right\} &=\mathrm{MH}-\mathrm{ATT}\left(\left\{\boldsymbol{e}_{1}^{(i-1)}, \ldots, \boldsymbol{e}_{m}^{(i-1)}\right\}\right)
\end{aligned}</script><p>ç”±äºç›´æ¥æ‹¼æ¥åå‘é‡ç»´åº¦ä¼šä¸å…¶ä»–æœªæ‹¼æ¥çš„å‘é‡ç»´åº¦ä¸åŒï¼Œæ‰€ä»¥åŠ å…¥information fusion layerï¼Œå¦å¤–è€ƒè™‘åˆ°åé¢çš„å®ä½“è‡ªç¼–ç ä»»åŠ¡ï¼Œæ‰€ä»¥è¿™é‡Œåœ¨èåˆä¿¡æ¯ä¹‹åï¼Œæœ‰å®ä½“å‘é‡åŠ å…¥çš„éƒ¨åˆ†éœ€è¦å¦å¤–å¤šè¾“å‡ºä¸€ä¸ªå®ä½“å‘é‡ã€‚</p>
<p>åŠ å…¥å®ä½“ä¿¡æ¯ä¹‹åçš„èåˆè¾“å‡ºè¿‡ç¨‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
\boldsymbol{h}_{j} &=\sigma\left(\tilde{\boldsymbol{W}}_{t}^{(i)} \tilde{\boldsymbol{w}}_{j}^{(i)}+\tilde{\boldsymbol{W}}_{e}^{(i)} \tilde{\boldsymbol{e}}_{k}^{(i)}+\tilde{\boldsymbol{b}}^{(i)}\right) \\
\boldsymbol{w}_{j}^{(i)} &=\sigma\left(\boldsymbol{W}_{t}^{(i)} \boldsymbol{h}_{j}+\boldsymbol{b}_{t}^{(i)}\right) \\
\boldsymbol{e}_{k}^{(i)} &=\sigma\left(\boldsymbol{W}_{e}^{(i)} \boldsymbol{h}_{j}+\boldsymbol{b}_{e}^{(i)}\right)
\end{aligned}</script><p>æœªåŠ å…¥å®ä½“ä¿¡æ¯ä¹‹åçš„èåˆè¾“å‡ºè¿‡ç¨‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
\boldsymbol{h}_{j} &=\sigma\left(\tilde{\boldsymbol{W}}_{t}^{(i)} \tilde{\boldsymbol{w}}_{j}^{(i)}+\tilde{\boldsymbol{b}}^{(i)}\right) \\
\boldsymbol{w}_{j}^{(i)} &=\sigma\left(\boldsymbol{W}_{t}^{(i)} \boldsymbol{h}_{j}+\boldsymbol{b}_{t}^{(i)}\right)
\end{aligned}</script><h5 id="å®ä½“è‡ªç¼–ç "><a href="#å®ä½“è‡ªç¼–ç " class="headerlink" title="å®ä½“è‡ªç¼–ç ????"></a>å®ä½“è‡ªç¼–ç ????</h5><p>ä¸ºäº†æ›´å¥½åœ°ä½¿ç”¨å®ä½“ä¿¡æ¯ï¼Œä½œè€…åœ¨è¿™é‡Œå¤šåŠ å…¥äº†ä¸€ä¸ªé¢„è®­ç»ƒä»»åŠ¡ entity auto-encoder(dEA)ã€‚</p>
<script type="math/tex; mode=display">
p\left(e_{j} | w_{i}\right)=\frac{\exp \left(\operatorname{linear}\left(\boldsymbol{w}_{i}^{o}\right) \cdot \boldsymbol{e}_{j}\right)}{\sum_{k=1}^{m} \exp \left(\operatorname{linear}\left(\boldsymbol{w}_{i}^{o}\right) \cdot \boldsymbol{e}_{k}\right)}</script><p>è¯¥é¢„è®­ç»ƒä»»åŠ¡å’Œbertç›¸ä¼¼ï¼ŒæŒ‰ä»¥ä¸‹æ–¹å¼è¿›è¡Œè®­ç»ƒï¼š</p>
<ol>
<li>15% çš„æƒ…å†µä¸‹ï¼šç”¨ [MASK] æ›¿æ¢è¢«é€‰æ‹©çš„å•è¯ï¼Œä¾‹å¦‚ï¼Œmy dog is hairy â†’ my dog is [MASK]</li>
<li>5% çš„æƒ…å†µä¸‹ï¼šç”¨ä¸€ä¸ªéšæœºå•è¯æ›¿æ¢è¢«é€‰æ‹©çš„å•è¯ï¼Œä¾‹å¦‚ï¼Œmy dog is hairy â†’ my dog is apple</li>
<li>80% çš„æƒ…å†µä¸‹ï¼šä¿æŒè¢«é€‰æ‹©çš„å•è¯ä¸å˜ï¼Œä¾‹å¦‚ï¼Œmy dog is hairy â†’ my dog is hairy</li>
</ol>
<h5 id="Extra-task"><a href="#Extra-task" class="headerlink" title="Extra-task"></a>Extra-task</h5><p>é™¤äº†æ­£å¸¸çš„ä»»åŠ¡ä¹‹å¤–ï¼ŒERNIEå¼•å…¥äº†ä¸¤ä¸ªæ–°ä»»åŠ¡Entity Typingå’ŒRelation Classification</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/ernie_extra_task.png" alt="avatar"></p>
<h5 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/ernie_experiment.png" alt="avatar"></p>
<p>ERNIEåœ¨é€šç”¨ä»»åŠ¡å…¶å®ç›¸æ¯”bertä¼˜åŠ¿ä¸å¤§ï¼Œå°½ç®¡æ–‡ç« æåˆ°äº†ERNIEæ›´é²æ£’ä»¥åŠGLUEçš„è¯„ä¼°å¯¹ERNIEä¸æ˜¯å¾ˆå‹å¥½ï¼Œåœ¨å¢åŠ å¤æ‚åº¦çš„åŒæ—¶ï¼Œå¹¶æ²¡æœ‰å–å¾—æœŸå¾…çš„æ•ˆæœã€‚ERNIEæä¾›äº†ä¸€ç§å¾ˆå¥½çš„å®ä½“ä¿¡æ¯å¼•å…¥æ€è·¯ï¼Œå¹¶ä¸”å…¶æ–°æå‡ºçš„é¢„è®­ç»ƒæ–¹æ³•ä¹Ÿç»™å¸Œæœ›å°†bertè¿™ä¸€æ¨¡å‹å¼•å…¥å…³ç³»æŠ½å–é¢†åŸŸæä¾›äº†å¾ˆå¥½çš„ä¾‹å­ã€‚</p>
<h3 id="MT-DNNï¼ˆé¢„è®­ç»ƒ-å¤šä»»åŠ¡ï¼‰"><a href="#MT-DNNï¼ˆé¢„è®­ç»ƒ-å¤šä»»åŠ¡ï¼‰" class="headerlink" title="MT-DNNï¼ˆé¢„è®­ç»ƒ+å¤šä»»åŠ¡ï¼‰"></a>MT-DNNï¼ˆé¢„è®­ç»ƒ+å¤šä»»åŠ¡ï¼‰</h3><p><a href="https://arxiv.org/pdf/1901.11504.pdf" target="_blank" rel="noopener">è®ºæ–‡</a>,<a href="https://github.com/namisan/mt-dnn" target="_blank" rel="noopener">æºç </a></p>
<h4 id="ç®€ä»‹-4"><a href="#ç®€ä»‹-4" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>å­¦ä¹ æ–‡æœ¬çš„å‘é‡ç©ºé—´è¡¨ç¤ºï¼Œæ˜¯è®¸å¤šè‡ªç„¶è¯­è¨€ç†è§£(NLU)ä»»åŠ¡çš„åŸºç¡€ã€‚ä¸¤ç§æµè¡Œçš„æ–¹æ³•æ˜¯<strong>å¤šä»»åŠ¡å­¦ä¹ </strong>å’Œ<strong>è¯­è¨€æ¨¡å‹çš„é¢„è®­ç»ƒ</strong>ã€‚MT-DNNé€šè¿‡æå‡ºä¸€ç§æ–°çš„å¤šä»»åŠ¡æ·±åº¦ç¥ç»ç½‘ç»œï¼ˆMT-DNNï¼‰æ¥ç»¼åˆä¸¤ç§æ–¹æ³•çš„ä¼˜ç‚¹ã€‚</p>
<p><strong>é¢„è®­ç»ƒ</strong>ï¼Œå¦‚BERTã€GPTç­‰ï¼Œå°±ä¸å¤šè¯´äº†ã€‚</p>
<p><strong>å¤šä»»åŠ¡</strong>å­¦ä¹ ( MTL )çš„çµæ„Ÿæ¥è‡ªäºäººçš„å­¦ä¹ æ´»åŠ¨ã€‚åœ¨äººç±»çš„å­¦ä¹ æ´»åŠ¨ä¸­ï¼Œäººä»¬ç»å¸¸åº”ç”¨ä»ä»¥å‰çš„ä»»åŠ¡ä¸­å­¦åˆ°çš„çŸ¥è¯†æ¥å¸®åŠ©å­¦ä¹ æ–°çš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œåœ¨å­¦ä¹ æ»‘å†°è¿™ä»¶äº‹æƒ…ä¸Šï¼Œä¸€ä¸ªçŸ¥é“å¦‚ä½•æ»‘é›ªçš„äººæ¯”ä»€ä¹ˆéƒ½ä¸çŸ¥é“çš„äººå®¹æ˜“ã€‚åŒæ ·ï¼Œ<strong>è”åˆå­¦ä¹ å¤šä¸ª(ç›¸å…³)</strong>ä»»åŠ¡ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œè¿™æ ·åœ¨ä¸€ä¸ªä»»åŠ¡ä¸­å­¦ä¹ åˆ°çš„çŸ¥è¯†æœ‰ç›Šäºå…¶ä»–ä»»åŠ¡ã€‚å¯¹äºMTLï¼ˆMulti-task Learningï¼Œå¤šä»»åŠ¡å­¦ä¹ ï¼‰æ¥è¯´ï¼Œå…¶ä¼˜ç‚¹æœ‰ä¸¤ä¸ªï¼š1ï¼‰å¼¥è¡¥äº†æœ‰äº›ä»»åŠ¡çš„æ•°æ®ä¸è¶³é—®é¢˜ï¼›2ï¼‰æœ‰æ­£åˆ™çš„ä½œç”¨ï¼Œé˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆã€‚</p>
<p><strong>ä¸¤è€…ç»“åˆ</strong>ï¼ˆå¼ºå¼ºè”æ‰‹ï¼ï¼‰ï¼šMT-DNNè®¤ä¸ºï¼ŒMTLå’Œpretrainæœ‰å¾ˆå¥½çš„äº’è¡¥ä½œç”¨ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯å¯ä»¥ç»“åˆä¸€ä¸‹ï¼Œå‘æŒ¥ä¸¤è€…çš„ä½œç”¨ã€‚æ›´å…·ä½“çš„å°±æ˜¯ï¼Œå…ˆç”¨BERTè¿›è¡Œpretrainï¼Œç„¶åç”¨MTLè¿›è¡Œfinetuneï¼Œè¿™å°±å½¢æˆäº†MT-DNNã€‚å¯è§ï¼Œä¸BERTçš„ä¸åŒåœ¨äºfinetuneçš„è¿‡ç¨‹ï¼Œè¿™é‡Œç”¨MTLä½œä¸ºç›®æ ‡ã€‚</p>
<h4 id="æ¨¡å‹-1"><a href="#æ¨¡å‹-1" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/mtdnn.png" alt="avatar"></p>
<p>è¡¨å¾å­¦ä¹  MT-DNN æ¨¡å‹çš„æ¶æ„ã€‚ä¸‹é¢çš„ç½‘ç»œå±‚åœ¨æ‰€æœ‰ä»»åŠ¡ä¸­éƒ½å…±äº«ï¼Œä¸Šé¢çš„ä¸¤å±‚æ˜¯é’ˆå¯¹ç‰¹å®šä»»åŠ¡ã€‚è¾“å…¥$X$(ä¸€å¥è¯æˆ–å¥å­å¯¹)é¦–å…ˆè¡¨å¾ä¸ºä¸€ä¸ªåºåˆ—çš„åµŒå…¥å‘é‡ï¼Œåœ¨$l_1$  ä¸­æ¯ä¸ªè¯å¯¹åº”ä¸€ä¸ªå‘é‡ã€‚ç„¶å Transformer ç¼–ç å™¨æ•æ‰æ¯ä¸ªå•è¯çš„è¯­å¢ƒä¿¡æ¯å¹¶åœ¨$l_2$ä¸­ç”Ÿæˆå…±äº«çš„è¯­å¢ƒåµŒå…¥å‘é‡ã€‚æœ€åï¼Œé’ˆå¯¹æ¯ä¸ªä»»åŠ¡ï¼Œç‰¹å®šä»»åŠ¡å±‚ç”Ÿæˆç‰¹å®šä»»åŠ¡çš„è¡¨å¾ï¼Œè€Œåæ˜¯åˆ†ç±»ã€ç›¸ä¼¼æ€§æ‰“åˆ†ã€å…³è”æ’åºç­‰å¿…éœ€çš„æ“ä½œã€‚</p>
<h5 id="å¤šä»»åŠ¡"><a href="#å¤šä»»åŠ¡" class="headerlink" title="å¤šä»»åŠ¡"></a>å¤šä»»åŠ¡</h5><p>MT-DNNæ˜¯ç»“åˆäº†4ç§ç±»å‹çš„NLUä»»åŠ¡ï¼šå•å¥åˆ†ç±»ã€å¥å­å¯¹åˆ†ç±»ã€æ–‡æœ¬ç›¸ä¼¼åº¦æ‰“åˆ†å’Œç›¸å…³åº¦æ’åºã€‚</p>
<ul>
<li>å•å¥åˆ†ç±»ï¼šCoLAä»»åŠ¡æ˜¯é¢„æµ‹è‹±è¯­å¥å­æ˜¯å¦åˆä¹è¯­æ³•ï¼ŒSST-2ä»»åŠ¡é¢„æµ‹ç”µå½±è¯„è®ºæ˜¯æ­£å‘è¿˜æ˜¯è´Ÿå‘ã€‚</li>
<li>æ–‡æœ¬ç›¸ä¼¼åº¦ï¼šè¿™æ˜¯ä¸€ä¸ªå›å½’ä»»åŠ¡ã€‚å¯¹äºç»™å®šçš„å¥å­å¯¹ï¼Œæ¨¡å‹è®¡ç®—äºŒè€…ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚åœ¨GLUEä¸­åªæœ‰STS-Bè¿™ä¸ªä»»åŠ¡æ˜¯å¤„ç†æ–‡æœ¬ç›¸ä¼¼åº¦ã€‚</li>
<li>æˆå¯¹æ–‡æœ¬åˆ†ç±»ï¼ˆæ–‡æœ¬è•´å«ï¼‰ï¼šå¯¹äºç»™å®šçš„å¥å­å¯¹ï¼Œæ¨ç†ä¸¤ä¸ªå¥å­ä¹‹é—´çš„å…³ç³»ã€‚RETå’ŒMNLIæ˜¯è¯­è¨€æ¨ç†ä»»åŠ¡ï¼Œæ¨ç†å¥å­ä¹‹é—´æ˜¯å¦å­˜åœ¨è•´å«å…³ç³»ã€çŸ›ç›¾çš„å…³ç³»æˆ–è€…ä¸­ç«‹å…³ç³»ã€‚QQPå’ŒMRPCæ˜¯é¢„æµ‹å¥å­æ˜¯å¦è¯­ä¹‰ç­‰ä»·ã€‚</li>
<li>ç›¸å…³æ€§æ’åºï¼šç»™å®šä¸€ä¸ªé—®é¢˜å’Œä¸€ç³»åˆ—å€™é€‰ç­”æ¡ˆï¼Œæ¨¡å‹æ ¹æ®é—®é¢˜å¯¹æ‰€æœ‰å€™é€‰ç­”æ¡ˆè¿›è¡Œæ’åºã€‚QNLIæ˜¯æ–¯å¦ç¦é—®ç­”æ•°æ®é›†çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œä»»åŠ¡æ˜¯é¢„æµ‹å€™é€‰ç­”æ¡ˆä¸­æ˜¯å¦åŒ…å«å¯¹é—®é¢˜çš„æ­£ç¡®ç­”æ¡ˆã€‚å°½ç®¡è¿™æ˜¯ä¸€ä¸ªäºŒåˆ†ç±»ä»»åŠ¡ï¼Œä½†æˆ‘ä»¬ä¾æ—§æŠŠå®ƒå½“ä½œæ’åºä»»åŠ¡ï¼Œå› ä¸ºæ¨¡å‹é‡æ’äº†å€™é€‰ç­”æ¡ˆï¼Œå°†æ­£ç¡®ç­”æ¡ˆæ’åœ¨æ›´å‰ã€‚</li>
</ul>
<h6 id="å•å¥åˆ†ç±»"><a href="#å•å¥åˆ†ç±»" class="headerlink" title="å•å¥åˆ†ç±»"></a>å•å¥åˆ†ç±»</h6><p>ç”¨[CLS]çš„è¡¨å¾ä½œä¸ºç‰¹å¾ï¼Œè®¾ä¸º$x$ï¼Œåˆ™å¯¹äºå•å¥çš„åˆ†ç±»ä»»åŠ¡ï¼Œç›´æ¥åœ¨åé¢æ¥å…¥ä¸€ä¸ªåˆ†ç±»å±‚å³å¯.</p>
<script type="math/tex; mode=display">
P_{r}(c | X)=\operatorname{softmax}\left(W^{T} \cdot x\right)</script><p>lossæ˜¯äº¤å‰ç†µæŸå¤±ï¼š</p>
<script type="math/tex; mode=display">
-\sum_{c} I(X, c) \log \left(P_{r}(c | X)\right)</script><h6 id="å¥å­ç›¸ä¼¼åº¦"><a href="#å¥å­ç›¸ä¼¼åº¦" class="headerlink" title="å¥å­ç›¸ä¼¼åº¦"></a>å¥å­ç›¸ä¼¼åº¦</h6><p>å°†ä¸¤å¥è¯packåé€è¿›å»ï¼Œå¾—åˆ°çš„[CLS]çš„è¡¨å¾ï¼Œå¯æ‹¿å‡ºæ¥è®¡ç®—åˆ†æ•°ï¼š</p>
<script type="math/tex; mode=display">
\operatorname{sim}\left(X_{1}, X_{2}\right)=\operatorname{sigmoid}\left(w^{T} \cdot x\right)</script><p>lossæ˜¯MSEï¼š</p>
<script type="math/tex; mode=display">
\left(y-\operatorname{Sim}\left(X_{1}, X_{2}\right)\right)^{2}</script><h6 id="å¥å­å¯¹åˆ†ç±»"><a href="#å¥å­å¯¹åˆ†ç±»" class="headerlink" title="å¥å­å¯¹åˆ†ç±»"></a>å¥å­å¯¹åˆ†ç±»</h6><p>å¯¹è¿™ä¸ªä»»åŠ¡ä¸ç†Ÿæ‚‰ã€‚ã€‚ã€‚</p>
<h6 id="ç›¸å…³æ€§æ’åº"><a href="#ç›¸å…³æ€§æ’åº" class="headerlink" title="ç›¸å…³æ€§æ’åº"></a>ç›¸å…³æ€§æ’åº</h6><p>å…ˆè®¡ç®—ä¸¤ä¸ªå¥å­ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œè¾“å…¥ä¸¤ä¸ªå¥å­packï¼Œé‡‡ç”¨[CLS]çš„è¾“å‡ºä½œä¸ºè¡¨å¾ã€‚</p>
<script type="math/tex; mode=display">
\operatorname{Rel}(Q, A)=g\left(w^{T} \cdot x\right)</script><p>lossé‡‡ç”¨æ’åºæŸå¤±ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
&-\sum_{Q, A^{+}} P_{r}\left(A^{+} | Q\right) \\
P_{r}\left(A^{+} | Q\right) &=\frac{\exp \left(\gamma \operatorname{Rel}\left(Q, A^{+}\right)\right)}{\sum_{A^{\prime} \in A} \exp \left(\gamma \operatorname{Rel}\left(Q, A^{\prime}\right)\right)}
\end{aligned}</script><h5 id="è®­ç»ƒè¿‡ç¨‹"><a href="#è®­ç»ƒè¿‡ç¨‹" class="headerlink" title="è®­ç»ƒè¿‡ç¨‹"></a>è®­ç»ƒè¿‡ç¨‹</h5><p>MT-DNN çš„è®­ç»ƒç¨‹åºåŒ…å«ä¸¤ä¸ªé˜¶æ®µï¼šé¢„è®­ç»ƒå’Œå¤šä»»åŠ¡å¾®è°ƒã€‚</p>
<ol>
<li>é¢„è®­ç»ƒé˜¶æ®µéµå¾ª BERT æ¨¡å‹çš„æ–¹å¼ã€‚lexicon encoderå’ŒTransformer encoderå‚æ•°çš„å­¦ä¹ æ˜¯é€šè¿‡ä¸¤ä¸ªæ— ç›‘ç£é¢„æµ‹ä»»åŠ¡ï¼šæ©ç è¯­è¨€å»ºæ¨¡(masked language modeling)å’Œä¸‹ä¸€å¥é¢„æµ‹(next sentence pre-<br>diction)ã€‚</li>
<li>åœ¨å¤šä»»åŠ¡å¾®è°ƒé˜¶æ®µï¼Œä½¿ç”¨åŸºäºminibatchçš„éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰æ¥å­¦ä¹ æ¨¡å‹å‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ï¼Œæ‰€æœ‰å…±äº«å±‚å’Œä»»åŠ¡ç‰¹å®šå±‚çš„å‚æ•°ï¼‰ï¼Œç®—æ³•æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ¯ä¸ªepochï¼Œé€‰æ‹©ä¸€ä¸ªmini-batch $b_t$(åœ¨9ä¸ªGLUEä»»åŠ¡ä¸­)ï¼Œå†å¯¹ç‰¹å®šä»»åŠ¡$k$è¿›è¡Œæ¨¡å‹å‚æ•°çš„æ›´æ–°ã€‚è¿™è¿‘ä¼¼åœ°ä¼˜åŒ–æ‰€æœ‰å¤šä»»åŠ¡çš„å’Œã€‚</li>
</ol>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/mtdnn_al.png" alt="avatar"></p>
<h3 id="DistilBERT"><a href="#DistilBERT" class="headerlink" title="DistilBERT"></a>DistilBERT</h3><p><a href="https://arxiv.org/pdf/1910.01108" target="_blank" rel="noopener">è®ºæ–‡</a></p>
<h4 id="åŠ¨æœº-1"><a href="#åŠ¨æœº-1" class="headerlink" title="åŠ¨æœº"></a>åŠ¨æœº</h4><p>é¢„è®­ç»ƒçš„è¯­è¨€æ¨¡å‹æ­£å˜å¾—æ—¥ç›Šåºå¤§ï¼Œè¿™äº›åºå¤§çš„æ¨¡å‹å°½ç®¡èƒ½å¤Ÿå¸¦æ¥å‡†ç¡®ç‡çš„æå‡ï¼Œä½†æ˜¯åœ¨è¿™äº›é¢„è®­ç»ƒæ¨¡å‹æŠ•å…¥ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€éœ€è¦å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œè€Œè¿™éœ€è¦å¤§é‡çš„èµ„æºï¼Œè€Œä¸”æ¨¡å‹æŠ•å…¥ä½¿ç”¨çš„æ—¶å€™ï¼Œç”±äºè®¡ç®—é‡å·¨å¤§ï¼Œæ¨¡å‹å¤„ç†æ•°æ®çš„æ—¶å»¶è¿‡é•¿ã€‚ä¸€ç§æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯å¯¹æ¨¡å‹è¿›è¡Œå‹ç¼©ã€‚</p>
<h4 id="æ¨¡å‹å‹ç¼©çš„æ–¹æ³•"><a href="#æ¨¡å‹å‹ç¼©çš„æ–¹æ³•" class="headerlink" title="æ¨¡å‹å‹ç¼©çš„æ–¹æ³•"></a>æ¨¡å‹å‹ç¼©çš„æ–¹æ³•</h4><ol>
<li><p>é‡åŒ–</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/quantization.jpg" alt="avatar"></p>
</li>
</ol>
<p>é‡åŒ–æ–¹æ³•æ„å‘³ç€é™ä½æ¨¡å‹æƒé‡çš„ç²¾åº¦ã€‚æ¯”å¦‚K-means é‡åŒ–æ–¹æ³•ï¼šå¯¹æ¨¡å‹æƒé‡çŸ©é˜µWè¿›è¡Œåˆ†ç»„ï¼Œåˆ†æˆnç°‡ï¼Œç„¶åæŠŠæƒé‡çŸ©é˜µé‡Œçš„å€¼è½¬åŒ–æˆ$1,\cdots,n$çš„æ­£æ•°ã€‚é€šè¿‡è¿™ç§æ–¹å¼æŠŠçŸ©é˜µä¸­çš„32ä½çš„floatå‹è½¬åŒ–æˆåªæœ‰8ä½ï¼ˆæˆ–è€…1ä½ï¼Œbinarizing matrixï¼‰çš„æ•´æ•°ã€‚</p>
<h5 id="è£å‰ªï¼ˆPruningï¼‰"><a href="#è£å‰ªï¼ˆPruningï¼‰" class="headerlink" title="è£å‰ªï¼ˆPruningï¼‰"></a>è£å‰ªï¼ˆPruningï¼‰</h5><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/Pruning.png" alt="avatar"></p>
<h6 id="weight-pruning"><a href="#weight-pruning" class="headerlink" title="weight pruning"></a>weight pruning</h6><p>   æŠŠæƒé‡çŸ©é˜µä¸­æ•°å€¼è¾ƒå¤§çš„å€¼è®¾ç½®ä¸º0ï¼Œä»è€Œæ„é€ ç¨€ç–çŸ©é˜µã€‚ï¼ˆç†è®ºä¸Šç¨€ç–çŸ©é˜µä¹˜æ³•é€Ÿåº¦å¿«äºnormal(danse)çŸ©é˜µä¹˜æ³•ã€‚ï¼‰</p>
<h6 id="Removing-neurons"><a href="#Removing-neurons" class="headerlink" title="Removing neurons"></a>Removing neurons</h6><p>   ç›´æ¥åˆ é™¤æƒé‡çŸ©é˜µä¸­ä¸é‡è¦çš„çš„æŸä¸€è¡Œæˆ–æŸä¸€åˆ—ã€‚ï¼ˆåˆ é™¤å’Œfine-tuneäº¤æ›¿è¿›è¡Œï¼Œè¿™æ ·å‰©ä¸‹çš„ç¥ç»å…ƒåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥å¼¥è¡¥è¢«åˆ é™¤çš„ç¥ç»å…ƒï¼‰</p>
<h6 id="Removing-weight-matrices"><a href="#Removing-weight-matrices" class="headerlink" title="Removing weight matrices"></a>Removing weight matrices</h6><p>   [10]ä»big transformersä¸­ç›´æ¥åˆ é™¤å¯¹accuracyè´¡çŒ®ä¸å¤§çš„æ•´ä¸ªattention headã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¸èƒ½ä¿è¯èƒ½å¤Ÿå¹¶è¡ŒåŠ é€Ÿï¼Œå› ä¸ºç›¸é‚»çš„æƒé‡çŸ©é˜µçš„sizeå˜çš„ä¸åŒäº†ã€‚</p>
<h5 id="çŸ¥è¯†è’¸é¦"><a href="#çŸ¥è¯†è’¸é¦" class="headerlink" title="çŸ¥è¯†è’¸é¦"></a>çŸ¥è¯†è’¸é¦</h5><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/Knowledge-distillation.jpg" alt="avatar"></p>
<p>DistilBertä½¿ç”¨æ¨¡å‹è’¸é¦æŠ€æœ¯ï¼šè¿™æ˜¯ä¸€ç§èƒ½å¤Ÿå°†å¤§å‹æ¨¡å‹ï¼ˆè¢«ç§°ä¸ºã€Œè€å¸ˆã€ï¼‰å‹ç¼©ä¸ºè¾ƒå°æ¨¡å‹ï¼ˆå³ã€Œå­¦ç”Ÿã€ï¼‰çš„æŠ€æœ¯ã€‚</p>
<p><a href="https://blog.csdn.net/nature553863/article/details/80568658" target="_blank" rel="noopener">çŸ¥è¯†è’¸é¦æ–¹æ³•</a></p>
<h6 id="çŸ¥è¯†è’¸é¦ï¼šè¿ç§»æ³›åŒ–èƒ½åŠ›"><a href="#çŸ¥è¯†è’¸é¦ï¼šè¿ç§»æ³›åŒ–èƒ½åŠ›" class="headerlink" title="çŸ¥è¯†è’¸é¦ï¼šè¿ç§»æ³›åŒ–èƒ½åŠ›"></a>çŸ¥è¯†è’¸é¦ï¼šè¿ç§»æ³›åŒ–èƒ½åŠ›</h6><p>çŸ¥è¯†è’¸é¦æ˜¯ä¸€ç§å‹ç¼©æŠ€æœ¯ï¼Œè¦æ±‚å¯¹å°å‹æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œä»¥ä½¿å…¶æ‹¥æœ‰ç±»ä¼¼äºå¤§å‹æ¨¡å‹çš„è¡Œä¸ºç‰¹å¾ã€‚åœ¨ç›‘ç£å­¦ä¹ é¢†åŸŸï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒåˆ†ç±»æ¨¡å‹æ—¶å¾€å¾€ä¼šåˆ©ç”¨å¯¹æ•°ä¼¼ç„¶ä¿¡å·å®ç°æ¦‚ç‡æœ€å¤§åŒ–ï¼ˆlogits çš„ softmaxï¼‰ï¼Œè¿›è€Œé¢„æµ‹å‡ºæ­£ç¡®ç±»ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ€§èƒ½è‰¯å¥½çš„æ¨¡å‹èƒ½å¤Ÿåˆ©ç”¨å…·æœ‰é«˜æ¦‚ç‡çš„æ­£ç¡®ç±»é¢„æµ‹è¾“å‡ºåˆ†å¸ƒï¼ŒåŒæ—¶å…¶å®ƒç±»çš„å‘ç”Ÿæ¦‚ç‡åˆ™æ¥è¿‘äºé›¶ã€‚</p>
<p><strong>ä½†æ˜¯ï¼ŒæŸäº›â€œæ¥è¿‘äºé›¶â€çš„æ¦‚ç‡è¦æ¯”å…¶å®ƒæ¦‚ç‡æ›´å¤§ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šåæ˜ å‡ºæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›</strong>ã€‚ä¾‹å¦‚ï¼ŒæŠŠæ™®é€šæ¤…å­è¯¯è®¤ä¸ºæ‰¶æ‰‹æ¤…è™½ç„¶å±äºé”™è¯¯ï¼Œä½†è¿™ç§é”™è¯¯è¿œæ¯”å°†å…¶è¯¯è®¤ä¸ºè˜‘è‡æ¥å¾—è½»å¾®ã€‚è¿™ç§ä¸ç¡®å®šæ€§ï¼Œæœ‰æ—¶è¢«ç§°ä¸ºâ€œæš—çŸ¥è¯†â€ã€‚ä¹Ÿå¯ä»¥ä»å¦ä¸€ä¸ªè§’åº¦æ¥ç†è§£è’¸é¦â€”â€”ç”¨äºé˜²æ­¢æ¨¡å‹å¯¹é¢„æµ‹ç»“æœå¤ªè¿‡ç¡®å®šï¼ˆç±»ä¼¼äºæ ‡ç­¾å¹³æ»‘ï¼‰ã€‚</p>
<p>åœ¨è¯­è¨€å»ºæ¨¡å½“ä¸­ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹è¯æ±‡è¡¨ä¸­çš„åˆ†å¸ƒè½»æ¾è§‚å¯Ÿåˆ°è¿™ç§ä¸ç¡®å®šæ€§ã€‚ä¸‹å›¾ä¸º BERT å¯¹ã€Šå¡è¨å¸ƒå…°å¡ã€‹ç”µå½±å½“ä¸­ç»å…¸å°è¯ä¸‹ä¸€å¥ç”¨è¯çš„çŒœæµ‹ï¼š</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/next_word.png" alt="avatar"></p>
<p>BERT æå‡ºçš„ 20 å¤§é«˜æ¦‚ç‡ç”¨è¯çŒœæµ‹ç»“æœã€‚è¯­è¨€æ¨¡å‹ç¡®å®šäº†ä¸¤ä¸ªå¯èƒ½æ€§æœ€é«˜çš„é€‰é¡¹ï¼ˆday ä¸ lifeï¼‰ï¼Œæ¥ä¸‹æ¥çš„è¯æ±‡ç›¸æ¯”ä¹‹ä¸‹æ¦‚ç‡è¦ä½å¾—å¤šã€‚</p>
<h6 id="å¦‚ä½•å¤åˆ¶è¿™äº›â€œæš—çŸ¥è¯†â€"><a href="#å¦‚ä½•å¤åˆ¶è¿™äº›â€œæš—çŸ¥è¯†â€" class="headerlink" title="å¦‚ä½•å¤åˆ¶è¿™äº›â€œæš—çŸ¥è¯†â€"></a>å¦‚ä½•å¤åˆ¶è¿™äº›â€œæš—çŸ¥è¯†â€</h6><p>åœ¨è®­ç»ƒå½“ä¸­ï¼Œé€šè¿‡è®­ç»ƒå­¦ç”Ÿç½‘ç»œï¼Œæ¥æ¨¡æ‹Ÿè€å¸ˆç½‘ç»œçš„å…¨éƒ¨è¾“å‡ºåˆ†å¸ƒï¼ˆä¹Ÿå°±æ˜¯çŸ¥è¯†ï¼‰ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡åŒ¹é…è¾“å‡ºåˆ†å¸ƒçš„æ–¹å¼è®­ç»ƒå­¦ç”Ÿç½‘ç»œï¼Œä»è€Œå®ç°ä¸è€å¸ˆç½‘ç»œç›¸åŒçš„æ³›åŒ–æ–¹å¼ï¼Œå³é€šè¿‡è½¯ç›®æ ‡ï¼ˆè€å¸ˆæ¦‚ç‡ï¼‰å°†äº¤å‰ç†µä»è€å¸ˆå¤„ä¼ é€’ç»™å­¦ç”Ÿã€‚</p>
<script type="math/tex; mode=display">
L=-\sum_{i} t_{i} * \log \left(s_{i}\right)</script><p>å…¶ä¸­ $t_i$ä¸ºæ¥è‡ªè€å¸ˆçš„ $logit$ï¼Œ$s_i$ ä¸ºå­¦ç”Ÿçš„ $logit$ã€‚ä»¥è€å¸ˆçš„è¡Œä¸º$t_i$ä½œä¸ºæ ‡ç­¾ï¼Œè®©å­¦ç”Ÿå»å­¦ä¹ è€å¸ˆçš„è¡Œä¸ºã€‚<strong>è¿™ä¸ªæŸå¤±å‡½æ•°å±äºæ›´ä¸°å¯Œçš„è®­ç»ƒä¿¡å·ï¼Œå› ä¸ºå•ä¸€ç¤ºä¾‹è¦æ¯”å•ä¸€ç¡¬ç›®æ ‡æ‹¥æœ‰æ›´é«˜çš„å¼ºåˆ¶çº¦æŸæ•ˆæœã€‚</strong>ä¸ºäº†è¿›ä¸€æ­¥æ­ç¤ºåˆ†ç±»ç»“æœçš„è´¨é‡ï¼ŒHinton ç­‰äººæå‡ºäº† softmax æ¸©åº¦çš„æ¦‚å¿µï¼š</p>
<script type="math/tex; mode=display">
p_{i}=\frac{\exp \left(z_{i} / T\right)}{\sum_{j} \exp \left(z_{j} / T\right)}</script><p>T ä¸ºæ¸©åº¦å‚æ•°ã€‚å½“$T \rightarrow 0$æ—¶ï¼Œåˆ†å¸ƒå˜ä¸º Kroneckerï¼ˆç›¸å½“äºç‹¬çƒ­ç›®æ ‡çŸ¢é‡ï¼‰ï¼›å½“ $T \rightarrow +\infty$æ—¶ï¼Œåˆ™å˜ä¸ºå‡åŒ€åˆ†å¸ƒã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå°†ç›¸åŒçš„æ¸©åº¦å‚æ•°åº”ç”¨äºå­¦ç”Ÿä¸è€å¸ˆç½‘ç»œï¼Œå³å¯è¿›ä¸€æ­¥ä¸ºæ¯ä¸ªè®­ç»ƒç¤ºä¾‹æ­ç¤ºæ›´å¤šä¿¡å·ã€‚T è¢«è®¾ç½®ä¸º 1 å³ä¸ºæ ‡å‡† Softmaxã€‚</p>
<p>åœ¨è’¸é¦æ–¹é¢ï¼Œä½¿ç”¨ Kullback-Leibler æŸå¤±å‡½æ•°ï¼Œå› ä¸ºå…¶æ‹¥æœ‰ç›¸åŒçš„ä¼˜åŒ–æ•ˆæœï¼š</p>
<script type="math/tex; mode=display">
K L(p \| q)=\mathbb{E}_{p}\left(\log \left(\frac{p}{q}\right)\right)=\sum_{i} p_{i} * \log \left(p_{i}\right)-\sum_{i} p_{i} * \log \left(q_{i}\right)</script><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> torch.optim <span class="keyword">import</span> Optimizer</span><br><span class="line"></span><br><span class="line">KD_loss = nn.KLDivLoss(reduction=<span class="string">'batchmean'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kd_step</span><span class="params">(teacher: nn.Module,</span></span></span><br><span class="line"><span class="function"><span class="params">            student: nn.Module,</span></span></span><br><span class="line"><span class="function"><span class="params">            temperature: float,</span></span></span><br><span class="line"><span class="function"><span class="params">            inputs: torch.tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            optimizer: Optimizer)</span>:</span></span><br><span class="line">    teacher.eval()</span><br><span class="line">    student.train()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        logits_t = teacher(inputs=inputs) <span class="comment"># è€å¸ˆçš„è¾“å‡º</span></span><br><span class="line">    logits_s = student(inputs=inputs) <span class="comment"># å­¦ç”Ÿçš„è¾“å‡º</span></span><br><span class="line">    <span class="comment"># è®¡ç®—kd_loss</span></span><br><span class="line">    loss = KD_loss(input=F.log_softmax(logits_s/temperature, dim=<span class="number">-1</span>),</span><br><span class="line">                   target=F.softmax(logits_t/temperature, dim=<span class="number">-1</span>))</span><br><span class="line">    </span><br><span class="line">    loss.backward()</span><br><span class="line">    optimizer.step()</span><br><span class="line">    optimizer.zero_grad()</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨è€å¸ˆä¿¡å·ï¼Œèƒ½å¤Ÿè®­ç»ƒå‡ºä¸€å¥—è¾ƒå°çš„è¯­è¨€æ¨¡å‹ DistilBERTï¼Œå±äº BERT çš„ç›‘ç£äº§ç‰©ã€‚</p>
<h4 id="æ¨¡å‹ç»“æ„"><a href="#æ¨¡å‹ç»“æ„" class="headerlink" title="æ¨¡å‹ç»“æ„"></a>æ¨¡å‹ç»“æ„</h4><p>DistilBERTæƒ³è¾ƒäºBERTåˆ é™¤äº† token-type åµŒå…¥ä¸ poolerï¼ˆç”¨äºä¸‹ä¸€å¥åˆ†ç±»ä»»åŠ¡ï¼‰ï¼Œä½†å…¶ä½™éƒ¨åˆ†æ¶æ„ä¿æŒä¸å˜ï¼Œè€Œå±‚æ•°ä¹Ÿå‡å°‘è‡³åŸæœ¬çš„äºŒåˆ†ä¹‹ä¸€ã€‚æ€»ä½“è€Œè¨€ï¼Œè’¸é¦æ¨¡å‹ DistilBERT åœ¨æ€»ä½“å‚æ•°æ•°é‡ä¸Šçº¦ä¸º BERT çš„ä¸€åŠï¼Œä½†åœ¨ GLUE è¯­è¨€ç†è§£åŸºå‡†æµ‹è¯•ä¸­èƒ½å¤Ÿä¿ç•™ 95% çš„ BERT æ€§èƒ½è¡¨ç°ã€‚</p>
<ol>
<li><strong>ä¸ºä»€ä¹ˆä¸é™ä½éšè—å±‚çš„å¤§å°ï¼Ÿ</strong><br>å°† 768 å‡è‡³ 512 ï¼Œæ„å‘³ç€æ€»å‚æ•°é‡çº¦ä¸‹é™è‡³åŸæœ¬çš„äºŒåˆ†ä¹‹ä¸€ã€‚åœ¨ç°ä»£æ¡†æ¶å½“ä¸­ï¼Œå¤§å¤šæ•°è¿ç®—éƒ½ç»è¿‡é«˜åº¦ä¼˜åŒ–ï¼Œè€Œä¸”å¼ é‡çš„æœ€ç»ˆç»´åº¦ï¼ˆéšè—ç»´åº¦ï¼‰çš„å˜åŒ–ä¼šå¯¹ Transformer æ¶æ„ï¼ˆçº¿æ€§åˆ†å±‚ä¸å±‚è§„èŒƒåŒ–ï¼‰ä¸­çš„å¤§éƒ¨åˆ†è¿ç®—äº§ç”Ÿå°å¹…å½±å“ã€‚å®éªŒä¸­å‘ç°ï¼Œå±‚æ•°å¯¹äºæ¨ç†æ—¶é—´çš„å½±å“è¦è¿œé«˜äºéšè—å±‚çš„å¤§å°ã€‚å› æ­¤ï¼Œæ›´å°å¹¶ä¸ä»£è¡¨ç€ä¸€å®šæ›´å¿«ã€‚</li>
</ol>
<p>è®­ç»ƒå­ç½‘ç»œçš„æ ¸å¿ƒä¸åªæ˜¯å»ºç«‹æ¶æ„ï¼Œè¿˜è¦æ±‚ä¸ºå­ç½‘ç»œæ‰¾åˆ°æ­£ç¡®çš„åˆå§‹åŒ–æ–¹å¼ä»¥å®ç°æ”¶æ•›ã€‚ DistilBERT ä½¿ç”¨bertçš„å‚æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œå°†å±‚æ•°å‰Šå‡ä¸€åŠï¼Œå¹¶é‡‡ç”¨ç›¸åŒçš„éšè—å¤§å°ã€‚DistilBERTè¿˜ç”¨åˆ°äº†æœ€è¿‘ RoBERTa è®ºæ–‡å½“ä¸­æåˆ°çš„ä¸€äº›è®­ç»ƒæŠ€å·§ï¼Œè¿™ä¹Ÿå†æ¬¡è¯æ˜ BERT æ¨¡å‹çš„è®­ç»ƒæ–¹å¼å¯¹å…¶æœ€ç»ˆè¡¨ç°æœ‰ç€è‡³å…³é‡è¦çš„å½±å“ã€‚ä¸ RoBERTa ç±»ä¼¼ï¼Œå¯¹ DIstilBERT è¿›è¡Œå¤§æ‰¹æ¬¡è®­ç»ƒï¼Œä½¿ç”¨æ¢¯åº¦ç´¯ç§¯ï¼ˆæ¯æ‰¹æœ€å¤š 4000 ä¸ªä¾‹å­ï¼‰ã€é…åˆåŠ¨æ€é®æŒ¡å¹¶åˆ é™¤äº†ä¸‹ä¸€å¥é¢„æµ‹ç›®æ ‡ã€‚</p>
<h4 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>DistilBERT çš„è¡¨ç°ï¼šä¿ç•™äº†BERT  95% ä»¥ä¸Šçš„æ€§èƒ½ï¼ŒåŒæ—¶å°†å‚æ•°å‡å°‘äº† 40%ã€‚æ¨ç†æ—¶é—´æ–¹é¢ï¼ŒDistilBERT æ¯” BERT å¿« 60%ï¼Œä½“ç§¯æ¯” BERT å° 60%ã€‚</p>
<h3 id="ALBERT"><a href="#ALBERT" class="headerlink" title="ALBERT"></a>ALBERT</h3><p><a href="[PDF](https://arxiv.org/pdf/1909.11942">è®ºæ–‡</a>)</p>
<h4 id="ç®€ä»‹-5"><a href="#ç®€ä»‹-5" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>è‡ªBERTçš„æˆåŠŸä»¥æ¥ï¼Œé¢„è®­ç»ƒæ¨¡å‹éƒ½é‡‡ç”¨äº†å¾ˆå¤§çš„å‚æ•°é‡ä»¥å–å¾—æ›´å¥½çš„æ¨¡å‹è¡¨ç°ã€‚ä½†æ˜¯æ¨¡å‹å‚æ•°é‡è¶Šæ¥è¶Šå¤§ä¹Ÿå¸¦æ¥äº†å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚å¯¹ç®—åŠ›è¦æ±‚è¶Šæ¥è¶Šé«˜ã€æ¨¡å‹éœ€è¦æ›´é•¿çš„æ—¶é—´å»è®­ç»ƒã€ç”šè‡³æœ‰äº›æƒ…å†µä¸‹å‚æ•°é‡æ›´å¤§çš„æ¨¡å‹è¡¨ç°å´æ›´å·®ã€‚ä¸ºäº†è§£å†³ç›®å‰é¢„è®­ç»ƒæ¨¡å‹å‚æ•°é‡è¿‡å¤§çš„é—®é¢˜ï¼Œalbertæå‡ºäº†ä¸¤ç§èƒ½å¤Ÿå¤§å¹…å‡å°‘é¢„è®­ç»ƒæ¨¡å‹å‚æ•°é‡çš„æ–¹æ³•ï¼Œæ­¤å¤–è¿˜æå‡ºç”¨Sentence-order predictionï¼ˆSOPï¼‰ä»»åŠ¡ä»£æ›¿BERTä¸­çš„Next-sentence predictionï¼ˆNSPï¼‰ä»»åŠ¡ã€‚</p>
<h4 id="æ¨¡å‹-2"><a href="#æ¨¡å‹-2" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><h5 id="åµŒå…¥å‘é‡å› å¼åˆ†è§£ï¼ˆFactorized-embedding-parameterizationï¼‰"><a href="#åµŒå…¥å‘é‡å› å¼åˆ†è§£ï¼ˆFactorized-embedding-parameterizationï¼‰" class="headerlink" title="åµŒå…¥å‘é‡å› å¼åˆ†è§£ï¼ˆFactorized embedding parameterizationï¼‰"></a>åµŒå…¥å‘é‡å› å¼åˆ†è§£ï¼ˆFactorized embedding parameterizationï¼‰</h5><p>åœ¨BERTã€XLNetã€RoBERTaç­‰æ¨¡å‹ä¸­ï¼Œç”±äºæ¨¡å‹ç»“æ„çš„é™åˆ¶ï¼ŒWordePiece embeddingçš„å¤§å°$E$ æ€»æ˜¯ä¸éšå±‚å¤§å°$H$ç›¸åŒï¼Œå³ $E \equiv H$ ã€‚ä»å»ºæ¨¡çš„è§’åº¦è€ƒè™‘ï¼Œè¯åµŒå…¥å­¦ä¹ çš„æ˜¯å•è¯ä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¡¨ç¤ºï¼Œè€Œéšå±‚åˆ™æ˜¯å­¦ä¹ ä¸ä¸Šä¸‹æ–‡ç›¸å…³çš„è¡¨ç¤ºã€‚æ˜¾ç„¶åè€…æ›´åŠ å¤æ‚ï¼Œéœ€è¦æ›´å¤šçš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æ¨¡å‹åº”å½“å¢å¤§éšå±‚å¤§å°$H$ï¼Œæˆ–è€…è¯´æ»¡è¶³ $H \gg E$ã€‚ä½†å®é™…ä¸Šè¯æ±‡è¡¨çš„å¤§å°$V$é€šå¸¸éå¸¸å¤§ï¼Œå¦‚æœ$E=H$çš„è¯ï¼Œå¢åŠ éšå±‚å¤§å°$H$åå°†ä¼šä½¿embedding matrixçš„ç»´åº¦$V \times E$éå¸¸å·¨å¤§ã€‚</p>
<p>å› æ­¤ALBERTæƒ³è¦æ‰“ç ´$E$ä¸$H$ ä¹‹é—´çš„ç»‘å®šå…³ç³»ï¼Œä»è€Œå‡å°æ¨¡å‹çš„å‚æ•°é‡ï¼ŒåŒæ—¶æå‡æ¨¡å‹è¡¨ç°ã€‚å…·ä½“åšæ³•æ˜¯å°†embedding matrixåˆ†è§£ä¸ºä¸¤ä¸ªå¤§å°åˆ†åˆ«ä¸º$V \times  E$ å’Œ$E \times H$ çŸ©é˜µï¼Œä¹Ÿå°±æ˜¯è¯´å…ˆå°†å•è¯æŠ•å½±åˆ°ä¸€ä¸ªä½ç»´çš„embeddingç©ºé—´ $E$ ï¼Œå†å°†å…¶æŠ•å½±åˆ°é«˜ç»´çš„éšè—ç©ºé—´$H$  ã€‚è¿™ä½¿å¾—embedding matrixçš„ç»´åº¦ä»$O(V \times H)$  å‡å°åˆ°$O(v \times E + E \times H)$ ã€‚å½“ $H \gg E$æ—¶ï¼Œå‚æ•°é‡å‡å°‘éå¸¸æ˜æ˜¾ã€‚åœ¨å®ç°æ—¶ï¼Œéšæœºåˆå§‹åŒ–$V\times E$å’Œ$E\times H$çš„çŸ©é˜µï¼Œè®¡ç®—æŸä¸ªå•è¯çš„è¡¨ç¤ºéœ€ç”¨ä¸€ä¸ªå•è¯çš„one-hotå‘é‡ä¹˜ä»¥$V\times E$ç»´çš„çŸ©é˜µï¼ˆä¹Ÿå°±æ˜¯lookupï¼‰ï¼Œå†ç”¨å¾—åˆ°çš„ç»“æœä¹˜$E\times H$ç»´çš„çŸ©é˜µå³å¯ã€‚ä¸¤ä¸ªçŸ©é˜µçš„å‚æ•°é€šè¿‡æ¨¡å‹å­¦ä¹ ã€‚</p>
<p>ä»ä¸‹å›¾å®éªŒç»“æœå¯è§ï¼Œå¯¹äºä¸å…±äº«å‚æ•°çš„æƒ…å†µï¼Œ$E$å‡ ä¹æ˜¯ä¸å¤§è¶Šå¥½ï¼›è€Œå…±äº«å‚æ•°ä¹‹åï¼Œ $E$å¤ªå¤§åè€Œä¼šä½¿æ¨¡å‹è¡¨ç°å˜å·®ï¼Œ$E=128$æ¨¡å‹è¡¨ç°æœ€å¥½ï¼Œå› æ­¤ALBERTçš„é»˜è®¤å‚æ•°è®¾ç½®ä¸­$E=128$.</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_embedding.png" alt="avatar"></p>
<p>è€ƒè™‘åˆ°ALBERT-baseçš„ $h=768$ï¼Œé‚£ä¹ˆ $E=768$æ—¶ï¼Œæ¨¡å‹åº”è¯¥å¯ä»¥çœ‹ä½œæ²¡æœ‰å‡å°‘embeddingå‚æ•°é‡çš„æƒ…å†µã€‚è€Œä¸å…±äº«å‚æ•°çš„å®éªŒç»“æœè¡¨æ˜æ­¤æ—¶æ¨¡å‹è¡¨ç°æ›´å¥½ï¼Œé‚£ä¹ˆä¼¼ä¹è¯´æ˜äº†Factorized embeddingåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†æ¨¡å‹çš„è¡¨ç°ã€‚</p>
<h5 id="è·¨å±‚å‚æ•°å…±äº«ï¼ˆå‚æ•°é‡å‡å°‘ä¸»è¦å…±äº«ï¼‰"><a href="#è·¨å±‚å‚æ•°å…±äº«ï¼ˆå‚æ•°é‡å‡å°‘ä¸»è¦å…±äº«ï¼‰" class="headerlink" title="è·¨å±‚å‚æ•°å…±äº«ï¼ˆå‚æ•°é‡å‡å°‘ä¸»è¦å…±äº«ï¼‰"></a>è·¨å±‚å‚æ•°å…±äº«ï¼ˆå‚æ•°é‡å‡å°‘ä¸»è¦å…±äº«ï¼‰</h5><p>å¦ä¸€ä¸ªå‡å°‘å‚æ•°é‡çš„æ–¹æ³•å°±æ˜¯å±‚ä¹‹é—´çš„å‚æ•°å…±äº«ï¼Œå³å¤šä¸ªå±‚ä½¿ç”¨ç›¸åŒçš„å‚æ•°ã€‚å‚æ•°å…±äº«æœ‰ä¸‰ç§æ–¹å¼ï¼šåªå…±äº«feed-forward networkçš„å‚æ•°ã€åªå…±äº«attentionçš„å‚æ•°ã€å…±äº«å…¨éƒ¨å‚æ•°ã€‚ALBERTé»˜è®¤æ˜¯å…±äº«å…¨éƒ¨å‚æ•°çš„ã€‚å®éªŒè¡¨æ˜åŠ å…¥å‚æ•°å…±äº«ä¹‹åï¼Œæ¯ä¸€å±‚çš„è¾“å…¥embeddingå’Œè¾“å‡ºembeddingçš„L2è·ç¦»å’Œä½™å¼¦ç›¸ä¼¼åº¦éƒ½æ¯”BERTç¨³å®šäº†å¾ˆå¤šã€‚è¿™è¯æ˜å‚æ•°å…±äº«èƒ½å¤Ÿä½¿æ¨¡å‹å‚æ•°æ›´åŠ ç¨³å®šã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/cross.png" alt="avatar"></p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹å‡ºå‚æ•°å…±äº«å‡ ä¹ä¹Ÿæ˜¯å¯¹æ¨¡å‹ç»“æœæœ‰è´Ÿé¢å½±å“çš„ã€‚ä½†æ˜¯è€ƒè™‘åˆ°å…¶èƒ½å¤Ÿå¤§å¹…å‰Šå‡å‚æ•°é‡ï¼Œå¹¶ä¸”å¯¹ç»“æœå½±å“ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œå› æ­¤æƒè¡¡ä¹‹ä¸‹é€‰æ‹©äº†å‚æ•°å…±äº«ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_crosslayer.png" alt="avatar"></p>
<h5 id="å¥é—´è¿è´¯æ€§"><a href="#å¥é—´è¿è´¯æ€§" class="headerlink" title="å¥é—´è¿è´¯æ€§"></a>å¥é—´è¿è´¯æ€§</h5><ul>
<li><strong>NSP</strong>ï¼šä¸‹ä¸€å¥é¢„æµ‹ï¼Œ æ­£æ ·æœ¬=ä¸Šä¸‹ç›¸é‚»çš„2ä¸ªå¥å­ï¼Œè´Ÿæ ·æœ¬=éšæœº2ä¸ªå¥å­</li>
<li><strong>SOP</strong>ï¼šå¥å­é¡ºåºé¢„æµ‹ï¼Œæ­£æ ·æœ¬=æ­£å¸¸é¡ºåºçš„2ä¸ªç›¸é‚»å¥å­ï¼Œè´Ÿæ ·æœ¬=è°ƒæ¢é¡ºåºçš„2ä¸ªç›¸é‚»å¥å­</li>
</ul>
<p>NSPä»»åŠ¡è¿‡äºç®€å•ï¼Œåªè¦æ¨¡å‹å‘ç°ä¸¤ä¸ªå¥å­çš„ä¸»é¢˜ä¸ä¸€æ ·å°±è¡Œäº†ï¼Œæ‰€ä»¥SOPé¢„æµ‹ä»»åŠ¡èƒ½å¤Ÿè®©æ¨¡å‹å­¦ä¹ åˆ°æ›´å¤šçš„ä¿¡æ¯ã€‚</p>
<p>é™¤äº†å‡å°‘æ¨¡å‹å‚æ•°å¤–ï¼Œè¿˜å¯¹BERTçš„é¢„è®­ç»ƒä»»åŠ¡Next-sentence prediction (NSP)è¿›è¡Œäº†æ”¹è¿›ã€‚åœ¨BERTä¸­ï¼ŒNSPä»»åŠ¡çš„æ­£ä¾‹æ˜¯æ–‡ç« ä¸­è¿ç»­çš„ä¸¤ä¸ªå¥å­ï¼Œè€Œè´Ÿä¾‹åˆ™æ˜¯ä»ä¸¤ç¯‡æ–‡æ¡£ä¸­å„é€‰ä¸€ä¸ªå¥å­æ„é€ è€Œæˆã€‚åœ¨å…ˆå‰çš„ç ”ç©¶ä¸­ï¼Œå·²ç»è¯æ˜NSPæ˜¯å¹¶ä¸æ˜¯ä¸€ä¸ªåˆé€‚çš„é¢„è®­ç»ƒä»»åŠ¡ã€‚ä½œè€…æ¨æµ‹å…¶åŸå› æ˜¯æ¨¡å‹åœ¨åˆ¤æ–­ä¸¤ä¸ªå¥å­çš„å…³ç³»æ—¶ä¸ä»…è€ƒè™‘äº†ä¸¤ä¸ªå¥å­ä¹‹é—´çš„è¿è´¯æ€§ï¼ˆcoherenceï¼‰ï¼Œè¿˜ä¼šè€ƒè™‘åˆ°ä¸¤ä¸ªå¥å­çš„è¯é¢˜ï¼ˆtopicï¼‰ã€‚è€Œä¸¤ç¯‡æ–‡æ¡£çš„è¯é¢˜é€šå¸¸ä¸åŒï¼Œæ¨¡å‹ä¼šæ›´å¤šçš„é€šè¿‡è¯é¢˜å»åˆ†æä¸¤ä¸ªå¥å­çš„å…³ç³»ï¼Œè€Œä¸æ˜¯å¥å­é—´çš„è¿è´¯æ€§ï¼Œè¿™ä½¿å¾—NSPä»»åŠ¡å˜æˆäº†ä¸€ä¸ªç›¸å¯¹ç®€å•çš„ä»»åŠ¡ã€‚</p>
<p>å› æ­¤æœ¬æ–‡æå‡ºäº†Sentence-order prediction (SOP)æ¥å–ä»£NSPã€‚å…·ä½“æ¥è¯´ï¼Œå…¶æ­£ä¾‹ä¸NSPç›¸åŒï¼Œä½†è´Ÿä¾‹æ˜¯é€šè¿‡é€‰æ‹©ä¸€ç¯‡æ–‡æ¡£ä¸­çš„ä¸¤ä¸ªè¿ç»­çš„å¥å­å¹¶å°†å®ƒä»¬çš„é¡ºåºäº¤æ¢æ„é€ çš„ã€‚è¿™æ ·ä¸¤ä¸ªå¥å­å°±ä¼šæœ‰ç›¸åŒçš„è¯é¢˜ï¼Œæ¨¡å‹å­¦ä¹ åˆ°çš„å°±æ›´å¤šæ˜¯å¥å­é—´çš„è¿è´¯æ€§ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_sop.png" alt="avatar"></p>
<p>å¦‚ä¸Šå®éªŒç»“æœæ‰€ç¤ºï¼Œå¦‚æœä¸ä½¿ç”¨NSPæˆ–SOPä½œä¸ºé¢„è®­ç»ƒä»»åŠ¡çš„è¯ï¼Œæ¨¡å‹åœ¨NSPå’ŒSOPä¸¤ä¸ªä»»åŠ¡ä¸Šè¡¨ç°éƒ½å¾ˆå·®ï¼›å¦‚æœä½¿ç”¨NSPä½œä¸ºé¢„è®­ç»ƒä»»åŠ¡çš„è¯ï¼Œæ¨¡å‹ç¡®å®èƒ½å¾ˆå¥½çš„è§£å†³NSPé—®é¢˜ï¼Œä½†æ˜¯åœ¨SOPé—®é¢˜ä¸Šè¡¨ç°å´å¾ˆå·®ï¼Œå‡ ä¹ç›¸å½“äºéšæœºçŒœï¼Œå› æ­¤è¯´æ˜NSPä»»åŠ¡ç¡®å®å¾ˆéš¾å­¦åˆ°å¥å­é—´çš„è¿è´¯æ€§ï¼›è€Œå¦‚æœç”¨SOPä½œä¸ºé¢„è®­ç»ƒä»»åŠ¡ï¼Œåˆ™æ¨¡å‹ä¹Ÿå¯ä»¥è¾ƒå¥½çš„è§£å†³NSPé—®é¢˜ï¼ŒåŒæ—¶æ¨¡å‹åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸Šè¡¨ç°ä¹Ÿæ›´å¥½ã€‚è¯´æ˜SOPç¡®å®æ˜¯æ›´å¥½çš„é¢„è®­ç»ƒä»»åŠ¡ã€‚</p>
<h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><h5 id="é¢å¤–çš„è®­ç»ƒæ•°æ®å’Œdropout"><a href="#é¢å¤–çš„è®­ç»ƒæ•°æ®å’Œdropout" class="headerlink" title="é¢å¤–çš„è®­ç»ƒæ•°æ®å’Œdropout"></a>é¢å¤–çš„è®­ç»ƒæ•°æ®å’Œdropout</h5><p>ALBERTè®­ç»ƒæ—¶è¿˜åŠ å…¥äº†XLNetå’ŒRoBERTaè®­ç»ƒæ—¶ç”¨çš„é¢å¤–æ•°æ®ï¼Œå®éªŒè¡¨æ˜åŠ å…¥é¢å¤–æ•°æ®ï¼ˆW additional dataï¼‰ç¡®å®ä¼šæå‡æ¨¡å‹è¡¨ç°ã€‚æ­¤å¤–ï¼Œä½œè€…è¿˜è§‚å¯Ÿåˆ°æ¨¡å‹ä¼¼ä¹ä¸€ç›´æ²¡æœ‰è¿‡æ‹Ÿåˆæ•°æ®ï¼Œå› æ­¤å»é™¤äº†Dropoutï¼Œä»å¯¹æ¯”è¯•éªŒå¯ä»¥çœ‹å‡ºï¼Œå»é™¤Dropoutï¼ˆW/O Dropoutï¼‰åæ¨¡å‹è¡¨ç°ç¡®å®æ›´å¥½ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_dropout.png" alt="avatar"></p>
<h4 id="æ€»ç»“-4"><a href="#æ€»ç»“-4" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_bert.png" alt="avatar"></p>
<p>ALBERTçš„è®­ç»ƒé€Ÿåº¦æ˜æ˜¾æ¯”BERTå¿«ï¼ŒALBERT-xxlargeçš„è¡¨ç°æ›´æ˜¯å…¨æ–¹é¢è¶…è¿‡äº†BERTã€‚</p>
<p>æœ¬æ–‡æœ‰ä¸¤ä¸ªå°ç»†èŠ‚å¯ä»¥å­¦ä¹ ï¼Œä¸€ä¸ªæ˜¯åœ¨æ¨¡å‹ä¸ä¼šè¿‡æ‹Ÿåˆçš„æƒ…å†µä¸‹ä¸ä½¿ç”¨dropoutï¼›å¦ä¸€ä¸ªåˆ™æ˜¯warm-startï¼Œå³åœ¨è®­ç»ƒæ·±å±‚ç½‘ç»œï¼ˆä¾‹å¦‚12å±‚ï¼‰æ—¶ï¼Œå¯ä»¥å…ˆè®­ç»ƒæµ…å±‚ç½‘ç»œï¼ˆä¾‹å¦‚6å±‚ï¼‰ï¼Œå†åœ¨å…¶åŸºç¡€ä¸Šåšfine-tuneï¼Œè¿™æ ·å¯ä»¥åŠ å¿«æ·±å±‚æ¨¡å‹çš„æ”¶æ•›ã€‚</p>
<h3 id="TinyBERT"><a href="#TinyBERT" class="headerlink" title="TinyBERT"></a>TinyBERT</h3><p><a href="https://arxiv.org/abs/1909.10351" target="_blank" rel="noopener">è®ºæ–‡</a></p>
<h4 id="ç®€ä»‹-6"><a href="#ç®€ä»‹-6" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>åœ¨ NLP é¢†åŸŸï¼ŒBERT ç”±äºæ¨¡å‹è¿‡äºåºå¤§ï¼Œå•ä¸ªæ ·æœ¬è®¡ç®—ä¸€æ¬¡çš„å¼€é”€åŠ¨è¾„ä¸Šç™¾æ¯«ç§’ï¼Œå¾ˆéš¾åº”ç”¨åˆ°å®é™…ç”Ÿäº§ä¸­ã€‚ä¸­ç§‘æŠ€å¤§å­¦ã€åä¸ºè¯ºäºšæ–¹èˆŸå®éªŒå®¤çš„ç ”ç©¶è€…æå‡ºäº† TinyBERTï¼Œè¿™æ˜¯ä¸€ç§ä¸ºåŸºäº transformer çš„æ¨¡å‹ä¸“é—¨è®¾è®¡çš„çŸ¥è¯†è’¸é¦æ–¹æ³•ï¼Œæ¨¡å‹å¤§å°ä¸º BERT çš„ 13.3%ï¼Œæ¨ç†é€Ÿåº¦æ˜¯ BERT çš„ 9.4 å€ï¼Œè€Œä¸”æ€§èƒ½æ²¡æœ‰å‡ºç°æ˜æ˜¾ä¸‹é™ã€‚</p>
<p>ç›®å‰ä¸»æµçš„å‡ ç§è’¸é¦æ–¹æ³•å¤§æ¦‚åˆ†æˆ 1. åˆ©ç”¨ transformer ç»“æ„è’¸é¦, 2. åˆ©ç”¨å…¶å®ƒç®€å•çš„ç»“æ„æ¯”å¦‚ BiLSTM ç­‰è’¸é¦ã€‚ç”±äº BiLSTM ç­‰ç»“æ„ç®€å•ï¼Œä¸”ä¸€èˆ¬æ˜¯ç”¨ BERT æœ€åä¸€å±‚çš„è¾“å‡ºç»“æœè¿›è¡Œè’¸é¦ï¼Œä¸èƒ½å­¦åˆ° transformer ä¸­é—´å±‚çš„ä¿¡æ¯ï¼Œå¯¹äºå¤æ‚çš„è¯­ä¹‰åŒ¹é…ä»»åŠ¡ï¼Œæ•ˆæœæœ‰ç‚¹ä¸å°½äººæ„ã€‚</p>
<p>åŸºäº transformer ç»“æ„çš„è’¸é¦æ–¹æ³•ç›®å‰æ¯”è¾ƒå‡ºåçš„æœ‰å¾®è½¯çš„ BERT-PKD (Patient Knowledge Distillation for BERT)ï¼Œhuggingface çš„ DistilBERTï¼Œä»¥åŠåä¸ºçš„ TinyBERTã€‚ä»–ä»¬çš„åŸºæœ¬æ€è·¯éƒ½æ˜¯å‡å°‘ transformer encoding çš„å±‚æ•°å’Œ hidden size å¤§å°ï¼Œå®ç°ç»†èŠ‚ä¸Šå„æœ‰ä¸åŒï¼Œä¸»è¦å·®å¼‚ä½“ç°åœ¨ loss çš„è®¾è®¡ä¸Šã€‚</p>
<h4 id="æ¨¡å‹-3"><a href="#æ¨¡å‹-3" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/tinyBert.jpg" alt="avatar"></p>
<p>æ•´ä¸ª TinyBERT çš„ loss è®¾è®¡åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p>
<h5 id="Embedding-layer-Distillation"><a href="#Embedding-layer-Distillation" class="headerlink" title="Embedding-layer Distillation"></a>Embedding-layer Distillation</h5><script type="math/tex; mode=display">
\mathcal{L}_{\mathrm{embd}}=\operatorname{MSE}\left(\boldsymbol{E}^{S} \boldsymbol{W}_{e}, \boldsymbol{E}^{T}\right)</script><p>å…¶ä¸­ï¼Œ$E^s \in R^{l \times ds}$,$E^T \ in R^{l \times dt}$åˆ†åˆ«è¡¨ç¤º student ç½‘ç»œçš„ embedding å’Œ teacher ç½‘ç»œçš„ embedding. å…¶ä¸­ l ä»£è¡¨ sequence length, ds ä»£è¡¨ student embedding ç»´åº¦ï¼Œ dt ä»£è¡¨ teacher embedding ç»´åº¦ã€‚ç”±äº student ç½‘ç»œçš„ embedding å±‚é€šå¸¸è¾ƒ teacher ä¼šå˜å°ä»¥è·å¾—æ›´å°çš„æ¨¡å‹å’ŒåŠ é€Ÿï¼Œæ‰€ä»¥ $W_e$ æ˜¯ä¸€ä¸ª $d_s \times d_t$ç»´çš„å¯è®­ç»ƒçš„çº¿æ€§å˜æ¢çŸ©é˜µï¼ŒæŠŠ student çš„ embedding æŠ•å½±åˆ° teacher embedding æ‰€åœ¨çš„ç©ºé—´ã€‚æœ€åå†ç®— MSEï¼Œå¾—åˆ° embedding loss.</p>
<h5 id="Transformer-layer-Distillation"><a href="#Transformer-layer-Distillation" class="headerlink" title="Transformer-layer Distillation"></a>Transformer-layer Distillation</h5><p>TinyBERT çš„ transformer è’¸é¦é‡‡ç”¨éš” k å±‚è’¸é¦çš„æ–¹å¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œteacher BERT ä¸€å…±æœ‰ 12 å±‚ï¼Œè‹¥æ˜¯è®¾ç½® student BERT ä¸º 4 å±‚ï¼Œå°±æ˜¯æ¯éš” 3 å±‚è®¡ç®—ä¸€ä¸ª transformer loss. æ˜ å°„å‡½æ•°ä¸º g(m) = 3 * m(???), m ä¸º student encoder å±‚æ•°ã€‚å…·ä½“å¯¹åº”ä¸º student ç¬¬ 1 å±‚ transformer å¯¹åº” teacher ç¬¬ 3 å±‚ï¼Œç¬¬ 2 å±‚å¯¹åº”ç¬¬ 6 å±‚ï¼Œç¬¬ 3 å±‚å¯¹åº”ç¬¬ 9 å±‚ï¼Œç¬¬ 4 å±‚å¯¹åº”ç¬¬ 12 å±‚ã€‚æ¯ä¸€å±‚çš„ transformer loss åˆåˆ†ä¸ºä¸¤éƒ¨åˆ†ç»„æˆï¼Œattention based distillation å’Œ hidden states based distillation.</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/transormers_distillation.jpg" alt="avatar"></p>
<h6 id="Attention-based-loss"><a href="#Attention-based-loss" class="headerlink" title="Attention based loss"></a>Attention based loss</h6><script type="math/tex; mode=display">
\mathcal{L}_{\mathrm{attn}}=\frac{1}{h} \sum_{i=1}^{h} \operatorname{MSE}\left(\boldsymbol{A}_{i}^{S}, \boldsymbol{A}_{i}^{T}\right)</script><p>å…¶ä¸­ï¼Œ$A_i \in R^{l \times l}$ $h$ä»£è¡¨attentionçš„å¤´æ•°ï¼Œ$l$ä»£è¡¨è¾“å…¥é•¿åº¦ï¼Œ$A_i^S$ä»£è¡¨studentç½‘ç»œç¬¬iä¸ªattentionå¤´çš„attention scoreçŸ©é˜µã€‚$A_i^T$ä»£è¡¨teacherç½‘ç»œçš„ç¬¬iä¸ªattentionå¤´çš„attention score çŸ©é˜µã€‚ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªæŸå¤±ï¼Ÿåœ¨What Does BERT Look At? An Analysis of BERTâ€™s Attention [12]ä¸­ç ”ç©¶äº†attention æƒé‡åˆ°åº•å­¦åˆ°äº†ä»€ä¹ˆï¼Œå®éªŒå‘ç°ä¸è¯­ä¹‰è¿˜æœ‰è¯­æ³•ç›¸å…³çš„è¯æ¯”å¦‚ç¬¬ä¸€ä¸ªåŠ¨è¯å®¾è¯­ï¼Œç¬¬ä¸€ä¸ªä»‹è¯å®¾è¯­ï¼Œä»¥åŠ[CLS], [SEP], é€—å·ç­‰ tokenï¼Œæœ‰å¾ˆé«˜çš„æ³¨æ„åŠ›æƒé‡ã€‚ä¸ºäº†ç¡®ä¿è¿™éƒ¨åˆ†ä¿¡æ¯èƒ½è¢« student ç½‘ç»œå­¦åˆ°ï¼ŒTinyBERT åœ¨ loss è®¾è®¡ä¸­åŠ ä¸Šäº† student å’Œ teacher çš„ attention matrix çš„ MSEã€‚è¿™æ ·è¯­è¨€çŸ¥è¯†å¯ä»¥å¾ˆå¥½çš„ä» teacher BERT è½¬ç§»åˆ° student BERT.</p>
<h6 id="hidden-states-based-distillation"><a href="#hidden-states-based-distillation" class="headerlink" title="hidden states based distillation"></a>hidden states based distillation</h6><script type="math/tex; mode=display">
\mathcal{L}_{\mathrm{hidn}}=\mathrm{MSE}\left(\boldsymbol{H}^{S} \boldsymbol{W}_{h}, \boldsymbol{H}^{T}\right)</script><p>å…¶ä¸­ï¼Œ$H^S \in R^{l \times ds}$,$H^T \in R^{l \times dt}$åˆ†åˆ«æ˜¯ student transformer å’Œ teacher transformer çš„éšå±‚è¾“å‡ºã€‚å’Œ embedding loss åŒç†ï¼Œ$W_h$æŠŠ$H^S$æŠ•å½±åˆ°$H^T$æ‰€åœ¨çš„ç©ºé—´ã€‚</p>
<h6 id="Prediction-Layer-Distillation"><a href="#Prediction-Layer-Distillation" class="headerlink" title="Prediction-Layer Distillation"></a>Prediction-Layer Distillation</h6><script type="math/tex; mode=display">
\mathcal{L}_{\text {pred }}=-\operatorname{softmax}\left(\boldsymbol{z}^{T}\right) \cdot \log \_ \left(\boldsymbol{z}^{S} / t\right)</script><p>å…¶ä¸­ t æ˜¯ temperature valueï¼Œæš‚æ—¶è®¾ä¸º 1.é™¤äº†æ¨¡ä»¿ä¸­é—´å±‚çš„è¡Œä¸ºå¤–ï¼Œè¿™ä¸€å±‚ç”¨æ¥æ¨¡æ‹Ÿ teacher ç½‘ç»œåœ¨ predict å±‚çš„è¡¨ç°ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™ä¸€å±‚è®¡ç®—äº† teacher è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒå’Œ student è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒçš„ softmax äº¤å‰ç†µã€‚è¿™ä¸€å±‚çš„å®ç°å’Œå…·ä½“ä»»åŠ¡ç›¸å…³.</p>
<p> prediction loss æœ‰å¾ˆå¤šå˜åŒ–ã€‚</p>
<ol>
<li>åœ¨ TinyBERT ä¸­ï¼Œè¿™ä¸ª loss æ˜¯ teacher BERT é¢„æµ‹çš„æ¦‚ç‡å’Œ student BERT é¢„æµ‹æ¦‚ç‡çš„ softmax äº¤å‰ç†µ.</li>
<li>åœ¨ BERT-PKD æ¨¡å‹ä¸­ï¼Œè¿™ä¸ª loss æ˜¯ teacher BERT å’Œ student BERT çš„äº¤å‰ç†µå’Œ student BERT å’Œ hard target( one-hot)çš„äº¤å‰ç†µçš„åŠ æƒå¹³å‡ã€‚</li>
</ol>
<p>ç›´æ¥ç”¨ hard target lossï¼Œæ•ˆæœæ¯”ä½¿ç”¨ teacher student softmax äº¤å‰ç†µä¸‹é™ 5-6 ä¸ªç‚¹ã€‚å› ä¸º softmax æ¯” one-hot ç¼–ç äº†æ›´å¤šæ¦‚ç‡åˆ†å¸ƒçš„ä¿¡æ¯ã€‚å¹¶ä¸”softmax cross-entropy loss å®¹æ˜“å‘ç”Ÿä¸æ”¶æ•›çš„æƒ…å†µï¼ŒæŠŠ softmax äº¤å‰ç†µæ”¹æˆ MSE, æ”¶æ•›æ•ˆæœå˜å¥½ï¼Œä½†æ³›åŒ–æ•ˆæœå˜å·®ã€‚è¿™æ˜¯å› ä¸ºä½¿ç”¨ softmax cross-entropy éœ€è¦å­¦åˆ°æ•´ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œæ›´éš¾æ”¶æ•›ï¼Œå› ä¸ºæ‹Ÿåˆäº† teacher BERT çš„æ¦‚ç‡åˆ†å¸ƒï¼Œæœ‰æ›´å¼ºçš„æ³›åŒ–æ€§ã€‚MSE å¯¹æå€¼æ•æ„Ÿï¼Œæ”¶æ•›çš„æ›´å¿«ï¼Œä½†æ³›åŒ–æ•ˆæœä¸å¦‚å‰è€…ã€‚</p>
<p>æ‰€ä»¥æ€»çš„lossï¼š</p>
<script type="math/tex; mode=display">
\mathcal{L}_{\text {model }}=\sum_{m=0}^{M+1} \lambda_{m} \mathcal{L}_{\text {layer }}\left(S_{m}, T_{g(m)}\right)</script><p>å…¶ä¸­</p>
<script type="math/tex; mode=display">
\mathcal{L}_{\text {layer }}\left(S_{m}, T_{g(m)}\right)=\left\{\begin{array}{ll}
\mathcal{L}_{\text {embd }}\left(S_{0}, T_{0}\right), & m=0 \\
\mathcal{L}_{\text {hidn }}\left(S_{m}, T_{g(m)}\right)+\mathcal{L}_{\text {attn }}\left(S_{m}, T_{g(m)}\right), & M \geq m>0 \\
\mathcal{L}_{\text {pred }}\left(S_{M+1}, T_{N+1}\right), & m=M+1
\end{array}\right.</script><h4 id="ä¸¤é˜¶æ®µå­¦ä¹ æ¡†æ¶"><a href="#ä¸¤é˜¶æ®µå­¦ä¹ æ¡†æ¶" class="headerlink" title="ä¸¤é˜¶æ®µå­¦ä¹ æ¡†æ¶"></a>ä¸¤é˜¶æ®µå­¦ä¹ æ¡†æ¶</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/two_step.jpg" alt="avatar"></p>
<p>ç±»ä¼¼äºåŸç”Ÿçš„ BERT å…ˆ pre-train, æ ¹æ®å…·ä½“ä»»åŠ¡å† fine-tineã€‚TinyBERT å…ˆåœ¨ general domain æ•°æ®é›†ä¸Šç”¨æœªç»å¾®è°ƒçš„ BERT å……å½“æ•™å¸ˆè’¸é¦å‡ºä¸€ä¸ª base æ¨¡å‹ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œå…·ä½“ä»»åŠ¡é€šè¿‡æ•°æ®å¢å¼ºï¼Œåˆ©ç”¨å¾®è°ƒåçš„ BERT å†è¿›è¡Œé‡æ–°æ‰§è¡Œè’¸é¦ã€‚è¿™ç§ä¸¤é˜¶æ®µçš„æ–¹æ³•ç»™ TinyBERT æä¾›äº†åƒ BERT ä¸€æ ·çš„æ³›åŒ–èƒ½åŠ›ã€‚ </p>
<h4 id="æ€»ç»“-5"><a href="#æ€»ç»“-5" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p> TinyBERT ä½œä¸ºä¸€ç§è’¸é¦æ–¹æ³•ï¼Œèƒ½æœ‰æ•ˆçš„æå– BERT transformer ç»“æ„ä¸­ä¸°å¯Œçš„è¯­æ„ä¿¡æ¯ï¼Œåœ¨ä¸ç‰ºç‰²æ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œé€Ÿåº¦èƒ½è·å¾— 8 åˆ° 9 å€çš„æå‡ã€‚</p>
<h3 id="FastBert"><a href="#FastBert" class="headerlink" title="FastBert"></a>FastBert</h3><h4 id="ç®€ä»‹-7"><a href="#ç®€ä»‹-7" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>FastBERTçš„åˆ›æ–°ç‚¹å¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯åœ¨æ¯å±‚Transformeråéƒ½å»é¢„æµ‹æ ·æœ¬æ ‡ç­¾ï¼Œå¦‚æœæŸæ ·æœ¬é¢„æµ‹ç»“æœçš„ç½®ä¿¡åº¦å¾ˆé«˜ï¼Œå°±ä¸ç”¨ç»§ç»­è®¡ç®—äº†ã€‚è®ºæ–‡æŠŠè¿™ä¸ªé€»è¾‘ç§°ä¸ºæ ·æœ¬è‡ªé€‚åº”æœºåˆ¶ï¼ˆSample-wise adaptive mechanismï¼‰ï¼Œå°±æ˜¯è‡ªé€‚åº”è°ƒæ•´æ¯ä¸ªæ ·æœ¬çš„è®¡ç®—é‡ï¼Œå®¹æ˜“çš„æ ·æœ¬é€šè¿‡ä¸€ä¸¤å±‚å°±å¯ä»¥é¢„æµ‹å‡ºæ¥ï¼Œè¾ƒéš¾çš„æ ·æœ¬åˆ™éœ€è¦èµ°å®Œå…¨ç¨‹ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ text_a = â€˜åŒ—äº¬é²œèŠ±å¿«é€’â€™ text_b = â€˜åŒ—äº¬é²œèŠ±é€Ÿé€’â€™ è¿™ç§caseå¯èƒ½æµ…å±‚çš„bertå°±å·²ç»èƒ½å¤Ÿå¾ˆå¥½çš„ç®—å‡ºå…¶ç›¸å…³æ€§æ‰“åˆ†ï¼Œæ‰€ä»¥ç®—å®Œä¸¤å±‚bertçš„æ‰“åˆ†å’Œ12å±‚çš„ç»“æœåŸºæœ¬ä¸€è‡´ï¼Œè€Œtext_a = â€˜åŒ—äº¬é²œèŠ±å¿«é€’â€™ text_b = â€˜æœ‰æ²¡æœ‰å“ªä¸ªåœ°æ–¹å–èŠ±å‰ï¼Œè€Œä¸”åŒ…é€ï¼Œä½ç½®åŒ—äº¬â€™ è¿™ç§caseå¯èƒ½éœ€è¦æ·±å±‚çš„bertå»æŠ½å–ä¸¤è¾¹çš„è¯­ä¹‰ç‰¹å¾ï¼Œå¹¶è®¡ç®—å…¶æ˜¯å¦åŒ¹é…ï¼Œæ‰€ä»¥åœ¨inferenceé˜¶æ®µå°±éœ€è¦ç®—å®Œ12å±‚ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/fastbert.jpg" alt="avatar"></p>
<p>ä½œè€…å°†åŸBERTæ¨¡å‹ç§°ä¸ºä¸»å¹²ï¼ˆBackboneï¼‰ï¼Œæ¯ä¸ªåˆ†ç±»å™¨ç§°ä¸ºåˆ†æ”¯ï¼ˆBranchï¼‰ã€‚è¿™é‡Œçš„åˆ†æ”¯Classifieréƒ½æ˜¯æœ€åä¸€å±‚çš„åˆ†ç±»å™¨è’¸é¦æ¥çš„ï¼Œä½œè€…å°†è¿™ç§°ä¸ºè‡ªè’¸é¦ï¼ˆSelf-distillationï¼‰ã€‚å°±æ˜¯åœ¨é¢„è®­ç»ƒå’Œç²¾è°ƒé˜¶æ®µéƒ½åªæ›´æ–°ä¸»å¹²å‚æ•°ï¼Œç²¾è°ƒå®Œå<strong>freezeä¸»å¹²å‚æ•°ï¼Œç”¨åˆ†æ”¯åˆ†ç±»å™¨ï¼ˆå›¾ä¸­çš„studentï¼‰è’¸é¦ä¸»å¹²åˆ†ç±»å™¨ï¼ˆå›¾ä¸­çš„teacherï¼‰çš„æ¦‚ç‡åˆ†å¸ƒ</strong>ã€‚ä¹‹æ‰€ä»¥å«è‡ªè’¸é¦ï¼Œæ˜¯å› ä¸ºä¹‹å‰çš„è’¸é¦éƒ½æ˜¯ç”¨ä¸¤ä¸ªæ¨¡å‹å»åšï¼Œä¸€ä¸ªæ¨¡å‹å­¦ä¹ å¦ä¸€ä¸ªæ¨¡å‹çš„çŸ¥è¯†ï¼Œè€ŒFastBERTæ˜¯è‡ªå·±ï¼ˆåˆ†æ”¯ï¼‰è’¸é¦è‡ªå·±ï¼ˆä¸»å¹²ï¼‰çš„çŸ¥è¯†ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè’¸é¦æ—¶éœ€è¦freezeä¸»å¹²éƒ¨åˆ†ï¼Œä¿è¯pretrainå’Œfinetuneé˜¶æ®µå­¦ä¹ çš„çŸ¥è¯†ä¸è¢«å½±å“ï¼Œä»…ç”¨brach æ¥å°½å¯èƒ½çš„æ‹Ÿåˆteacherçš„åˆ†å¸ƒã€‚åŒæ—¶ï¼Œä½¿ç”¨è‡ªè’¸é¦è¿˜æœ‰ä¸€ç‚¹é‡è¦çš„å¥½å¤„ï¼Œå°±æ˜¯<strong>ä¸å†ä¾èµ–äºæ ‡æ³¨æ•°æ®</strong>ã€‚è’¸é¦çš„æ•ˆæœå¯ä»¥é€šè¿‡æºæºä¸æ–­çš„æ— æ ‡ç­¾æ•°æ®æ¥æå‡ã€‚</p>
<h4 id="æ€»ç»“-6"><a href="#æ€»ç»“-6" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>FastBERTé€šè¿‡æå‰è¾“å‡ºç®€å•æ ·æœ¬çš„é¢„æµ‹ç»“æœï¼Œå‡å°‘æ¨¡å‹çš„è®¡ç®—è´Ÿæ‹…ï¼Œä»è€Œæé«˜æ¨ç†é€Ÿåº¦ã€‚è™½ç„¶æ¯å±‚éƒ½å¤šäº†ä¸€ä¸ªåˆ†ç±»å™¨ï¼Œä½†åˆ†ç±»å™¨çš„è®¡ç®—é‡ä¹Ÿæ¯”Transformerå°äº†ä¸¤ä¸ªæ•°é‡çº§ï¼Œå¯¹é€Ÿåº¦å½±å“è¾ƒå°ã€‚åç»­çš„åˆ†æ”¯è‡ªè’¸é¦ä¹Ÿè®¾è®¡çš„æ¯”è¾ƒå·§å¦™ï¼Œå¯ä»¥åˆ©ç”¨æ— ç›‘ç£æ•°æ®ä¸æ–­æå‡åˆ†æ”¯åˆ†ç±»å™¨çš„æ•ˆæœã€‚</p>
<h3 id="æ€»ç»“-7"><a href="#æ€»ç»“-7" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ€§èƒ½ï¼š</p>
<ol>
<li>BERT-WWM</li>
<li>XLNetï¼ˆé•¿æ–‡æœ¬è¡¨ç°æ›´å¥½ä¸€äº›ï¼‰</li>
<li>RoBERTaï¼ˆåŠ¨æ€maskã€without NSPã€æ›´å¤§batchï¼Œæ›´å¤šæ•°æ®ï¼Œæ›´é•¿è®­ç»ƒæ—¶é—´ï¼‰</li>
<li>SpanBERT(åŸºäºåˆ†è¯çš„é¢„è®­ç»ƒæ¨¡å‹)</li>
<li>MT-DNN(é¢„è®­ç»ƒ+å¤šä»»åŠ¡)</li>
<li>ERNIRï¼ˆå¼•å…¥å®ä½“ä¿¡æ¯ï¼‰</li>
</ol>
<p>æ•ˆç‡ï¼š</p>
<ol>
<li>DistilBertï¼ˆçŸ¥è¯†è’¸é¦ï¼‰</li>
<li>ALBertï¼ˆå› å¼åˆ†è§£ã€è·¨å±‚æƒé‡å…±äº«ï¼‰</li>
<li>TinyBertï¼ˆçŸ¥è¯†è’¸é¦ï¼‰</li>
</ol>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://zhuanlan.zhihu.com/p/46652512" target="_blank" rel="noopener">ã€NLPã€‘Google BERTè¯¦è§£</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/81157740" target="_blank" rel="noopener">å¸¦ä½ è¯»è®ºæ–‡ä¸¨8ç¯‡è®ºæ–‡æ¢³ç†BERTç›¸å…³æ¨¡å‹è¿›å±•ä¸åæ€</a></li>
<li><a href="https://blog.csdn.net/u012526436/article/details/93196139" target="_blank" rel="noopener">æœ€é€šä¿—æ˜“æ‡‚çš„XLNETè¯¦è§£</a></li>
<li><a href="https://www.jianshu.com/p/eddf04ba8545" target="_blank" rel="noopener">æ”¹è¿›ç‰ˆçš„RoBERTaåˆ°åº•æ”¹è¿›äº†ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="https://www.bilibili.com/video/av73657563/" target="_blank" rel="noopener">ã€AIæ¨¡å‹ã€‘æœ€é€šä¿—æ˜“æ‡‚çš„XLNetè¯¦è§£</a></li>
<li>Liu Y, Ott M, Goyal N, et al. Roberta: A robustly optimized bert pretraining approach[J]. arXiv preprint arXiv:1907.11692, 2019</li>
<li>Sennrich R, Haddow B, Birch A. Neural machine translation of rare words with subword units[J]. arXiv preprint arXiv:1508.07909, 2015.</li>
<li><a href="http://fancyerii.github.io/2019/03/09/bert-codes/#dataprocessor" target="_blank" rel="noopener">bertä»£ç é˜…è¯»</a></li>
<li><a href="https://www.infoq.cn/article/STabowUeFupgc4gRqRQj" target="_blank" rel="noopener">æ›´å°ã€æ›´å¿«ã€æ›´ä¾¿å®œã€æ›´è½»é‡ï¼šå¼€æº DistilBERTï¼ŒBERT çš„ç²¾ç®€ç‰ˆæœ¬</a></li>
<li>Michel, P., Levy, O., &amp; Neubig, G. (2019). Are Sixteen Heads Really Better than One? Retrieved from <a href="https://arxiv.org/abs/1905.10650" target="_blank" rel="noopener">https://arxiv.org/abs/1905.10650</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/94359189" target="_blank" rel="noopener">æ¯” Bert ä½“ç§¯æ›´å°é€Ÿåº¦æ›´å¿«çš„ TinyBERT</a></li>
<li><a href="https://arxiv.org/abs/1906.04341" target="_blank" rel="noopener">https://arxiv.org/abs/1906.04341</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/87562926" target="_blank" rel="noopener">ã€è®ºæ–‡é˜…è¯»ã€‘ALBERT</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/59436589" target="_blank" rel="noopener">ä¸­æ–‡ä»»åŠ¡å…¨é¢è¶…è¶ŠBERTï¼šç™¾åº¦æ­£å¼å‘å¸ƒNLPé¢„è®­ç»ƒæ¨¡å‹ERNIE</a></li>
<li><a href="https://www.jianshu.com/p/5e12e6edbd59" target="_blank" rel="noopener">BERTæ³›è¯»ç³»åˆ—ï¼ˆä¸‰ï¼‰â€”â€” ERNIE: Enhanced Language Representation with Informative Entitiesè®ºæ–‡ç¬”è®°</a></li>
<li><a href="https://blog.csdn.net/ljp1919/article/details/90269059" target="_blank" rel="noopener">æ–‡çŒ®é˜…è¯»ï¼šMT-DNNæ¨¡å‹</a></li>
<li><a href="https://blog.csdn.net/Magical_Bubble/article/details/89517709" target="_blank" rel="noopener">MT-DNNè§£è¯»(è®ºæ–‡ + PyTorchæºç )</a></li>
</ol>
]]></content>
      <categories>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>BERT</tag>
        <tag>BERT-WWM</tag>
        <tag>XLNet</tag>
        <tag>RoBERTa</tag>
        <tag>SpanBERT</tag>
        <tag>ernie</tag>
        <tag>MT-DNN</tag>
        <tag>DistillBERT</tag>
        <tag>ALBERT</tag>
        <tag>TinyBERT</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»</title>
    <url>/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å¯¹äºäº‹ä»¶æŠ½å–ä¸­å•å¥å¤šäº‹ä»¶çš„é—®é¢˜ï¼Œæ‰“ç®—ç”¨æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»æ¥è¿›è¡Œè§£å†³ã€‚</p>
<h3 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h3><ol>
<li>ç±»æ ‡æ•°é‡ä¸ç¡®å®šï¼Œæœ‰äº›æ ·æœ¬å¯èƒ½åªæœ‰ä¸€ä¸ªç±»æ ‡ï¼Œæœ‰äº›æ ·æœ¬çš„ç±»æ ‡å¯èƒ½é«˜è¾¾å‡ åç”šè‡³ä¸Šç™¾ä¸ªã€‚â€‚</li>
<li>ç±»æ ‡ä¹‹é—´ç›¸äº’ä¾èµ–ï¼Œä¾‹å¦‚åŒ…å«è“å¤©ç±»æ ‡çš„æ ·æœ¬å¾ˆå¤§æ¦‚ç‡ä¸ŠåŒ…å«ç™½äº‘ï¼Œå¦‚ä½•è§£å†³ç±»æ ‡ä¹‹é—´çš„ä¾èµ–æ€§é—®é¢˜ä¹Ÿæ˜¯ä¸€å¤§éš¾ç‚¹ã€‚</li>
<li>å¤šæ ‡ç­¾çš„è®­ç»ƒé›†æ¯”è¾ƒéš¾ä»¥è·å–ã€‚</li>
</ol>
<a id="more"></a>
<h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><p>å‰æœ‰å¾ˆå¤šå…³äºå¤šæ ‡ç­¾çš„å­¦ä¹ ç®—æ³•ï¼Œä¾æ®è§£å†³é—®é¢˜çš„è§’åº¦ï¼Œè¿™äº›ç®—æ³•å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»:ä¸€æ˜¯åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•ï¼ŒäºŒæ˜¯åŸºäºç®—æ³•é€‚ç”¨çš„æ–¹æ³•ã€‚åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•æ˜¯è½¬åŒ–é—®é¢˜æ•°æ®ï¼Œä½¿ä¹‹ä½¿ç”¨ç°æœ‰ç®—æ³•ï¼›åŸºäºç®—æ³•é€‚ç”¨çš„æ–¹æ³•æ˜¯æŒ‡é’ˆå¯¹æŸä¸€ç‰¹å®šçš„ç®—æ³•è¿›è¡Œæ‰©å±•ï¼Œä»è€Œèƒ½å¤Ÿå¤„ç†å¤šæ ‡è®°æ•°æ®ï¼Œæ”¹è¿›ç®—æ³•ï¼Œé€‚ç”¨æ•°æ®ã€‚</p>
<h4 id="åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•"><a href="#åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•" class="headerlink" title="åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•"></a><strong>åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•</strong></h4><p>åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•ä¸­æœ‰çš„è€ƒè™‘æ ‡ç­¾ä¹‹é—´çš„å…³è”æ€§ï¼Œæœ‰çš„ä¸è€ƒè™‘æ ‡ç­¾çš„å…³è”æ€§ã€‚æœ€ç®€å•çš„ä¸è€ƒè™‘å…³è”æ€§çš„ç®—æ³•å°†å¤šæ ‡ç­¾ä¸­çš„æ¯ä¸€ä¸ªæ ‡ç­¾å½“æˆæ˜¯å•æ ‡ç­¾ï¼Œå¯¹æ¯ä¸€ä¸ªæ ‡ç­¾å®æ–½å¸¸è§çš„åˆ†ç±»ç®—æ³•ã€‚å…·ä½“è€Œè¨€ï¼Œåœ¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ çš„æ¨¡å‹ä¸­å¯¹æ¯ä¸€ç±»æ ‡ç­¾åšäºŒåˆ†ç±»ï¼Œå¯ä»¥ä½¿ç”¨SVMã€DTã€NaÃ¯ve Bayesã€DTã€Xgboostç­‰ç®—æ³•ï¼›åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œå¯¹æ¯ä¸€ç±»è®­ç»ƒä¸€ä¸ªæ–‡æœ¬åˆ†ç±»æ¨¡å‹(å¦‚ï¼štextCNNã€textRNNç­‰)ã€‚è€ƒè™‘å¤šæ ‡ç­¾çš„ç›¸å…³æ€§æ—¶å€™å¯ä»¥å°†ä¸Šä¸€ä¸ªè¾“å‡ºçš„æ ‡ç­¾å½“æˆæ˜¯ä¸‹ä¸€ä¸ªæ ‡ç­¾åˆ†ç±»å™¨çš„è¾“å…¥ã€‚åœ¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹ä¸­å¯ä»¥ä½¿ç”¨<strong>åˆ†ç±»å™¨é“¾</strong>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªåˆ†ç±»å™¨åªåœ¨è¾“å…¥æ•°æ®ä¸Šè¿›è¡Œè®­ç»ƒï¼Œç„¶åæ¯ä¸ªåˆ†ç±»å™¨éƒ½åœ¨è¾“å…¥ç©ºé—´å’Œé“¾ä¸Šçš„æ‰€æœ‰ä¹‹å‰çš„åˆ†ç±»å™¨ä¸Šè¿›è¡Œè®­ç»ƒã€‚è®©æˆ‘ä»¬è¯•ç€é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£è¿™ä¸ªé—®é¢˜ã€‚åœ¨ä¸‹é¢ç»™å‡ºçš„æ•°æ®é›†é‡Œï¼Œæˆ‘ä»¬å°†Xä½œä¸ºè¾“å…¥ç©ºé—´ï¼Œè€ŒYä½œä¸ºæ ‡ç­¾ã€‚åœ¨åˆ†ç±»å™¨é“¾ä¸­ï¼Œè¿™ä¸ªé—®é¢˜å°†è¢«è½¬æ¢æˆ4ä¸ªä¸åŒçš„æ ‡ç­¾é—®é¢˜ï¼Œå°±åƒä¸‹é¢æ‰€ç¤ºã€‚é»„è‰²éƒ¨åˆ†æ˜¯è¾“å…¥ç©ºé—´ï¼Œç™½è‰²éƒ¨åˆ†ä»£è¡¨ç›®æ ‡å˜é‡ã€‚</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/1.png" alt="avatar"></p>
<p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œäºè¾“å‡ºå±‚åŠ ä¸Šä¸€ä¸ªæ—¶åºæ¨¡å‹ï¼Œå°†æ¯ä¸€æ—¶åˆ»è¾“å…¥çš„æ•°æ®åºåˆ—ä¸­åŠ å…¥ä¸Šä¸€æ—¶åˆ»è¾“å‡ºçš„ç»“æœå€¼ã€‚åœ¨è·å¾—æ–‡ç« çš„æ•´ä½“è¯­ä¹‰(Text feature vector)åï¼Œå°†Text feature vectorè¾“å…¥åˆ°ä¸€ä¸ªRNNçš„åºåˆ—ä¸­ä½œä¸ºåˆå§‹å€¼ï¼Œæ¯ä¸€æ—¶åˆ»è¾“å…¥æ˜¯ä¸Šä¸€æ—¶åˆ»çš„è¾“å‡ºã€‚ä»æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ï¼Œä¸‹å›¾æ‰€ç¤ºçš„æ¨¡å‹å°†å¤šæ ‡ç­¾ä»»åŠ¡å½“æˆäº†åºåˆ—ç”Ÿæˆä»»åŠ¡æ¥å¤„ç†ã€‚</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/cnn_rnn.png" alt="avatar"></p>
<p>é™¤äº†å°†æ ‡ç­¾åˆ†å¼€çœ‹ä¹‹å¤–ï¼Œè¿˜æœ‰å°†æ ‡ç­¾ç»Ÿä¸€æ¥çœ‹(Label Powerset)ã€‚åœ¨è¿™æ–¹é¢ï¼Œæˆ‘ä»¬å°†é—®é¢˜è½¬åŒ–ä¸ºä¸€ä¸ªå¤šç±»é—®é¢˜ï¼Œä¸€ä¸ªå¤šç±»åˆ†ç±»å™¨åœ¨è®­ç»ƒæ•°æ®ä¸­å‘ç°çš„æ‰€æœ‰å”¯ä¸€çš„æ ‡ç­¾ç»„åˆä¸Šè¢«è®­ç»ƒã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£å®ƒã€‚</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/multi_one.png" alt="avatar"></p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å‘ç°x1å’Œx4æœ‰ç›¸åŒçš„æ ‡ç­¾ã€‚åŒæ ·çš„ï¼Œx3å’Œx6æœ‰ç›¸åŒçš„æ ‡ç­¾ã€‚å› æ­¤ï¼Œæ ‡ç­¾powersetå°†è¿™ä¸ªé—®é¢˜è½¬æ¢ä¸ºä¸€ä¸ªå•ä¸€çš„å¤šç±»é—®é¢˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/multi_two.png" alt="avatar"></p>
<p>å› æ­¤ï¼Œæ ‡ç­¾powersetç»™è®­ç»ƒé›†ä¸­çš„æ¯ä¸€ä¸ªå¯èƒ½çš„æ ‡ç­¾ç»„åˆæä¾›äº†ä¸€ä¸ªç‹¬ç‰¹çš„ç±»ã€‚è½¬åŒ–ä¸ºå•æ ‡ç­¾åå°±å¯ä»¥ä½¿ç”¨SVMã€textCNNã€textRNNç­‰åˆ†ç±»ç®—æ³•è®­ç»ƒæ¨¡å‹äº†ã€‚</p>
<p>æ„Ÿè§‰Label Powersetåªé€‚åˆæ ‡ç­¾æ•°å°‘çš„æ•°æ®ï¼Œä¸€æ—¦æ ‡ç­¾æ•°ç›®å¤ªå¤š(å‡è®¾æœ‰nä¸ª)ï¼Œä½¿ç”¨Label Powersetåå¯èƒ½çš„æ•°æ®é›†å°†åˆ†å¸ƒåœ¨[0,$2^{n-1}$]ç©ºé—´å†…ï¼Œæ•°æ®ä¼šå¾ˆç¨€ç–ã€‚</p>
<h4 id="åŸºäºç®—æ³•é€‚ç”¨çš„æ–¹æ³•"><a href="#åŸºäºç®—æ³•é€‚ç”¨çš„æ–¹æ³•" class="headerlink" title="åŸºäºç®—æ³•é€‚ç”¨çš„æ–¹æ³•"></a><strong>åŸºäºç®—æ³•é€‚ç”¨çš„æ–¹æ³•</strong></h4><p>æ”¹å˜ç®—æ³•æ¥ç›´æ¥æ‰§è¡Œå¤šæ ‡ç­¾åˆ†ç±»ï¼Œè€Œä¸æ˜¯å°†é—®é¢˜è½¬åŒ–ä¸ºä¸åŒçš„é—®é¢˜å­é›†ã€‚åœ¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹ä¸­é€‚ç”¨äºçš„å¤šæ ‡ç­¾åˆ†ç±»æ¨¡å‹æœ‰:kNNå¤šæ ‡ç­¾ç‰ˆæœ¬MLkNNï¼ŒSVMçš„å¤šæ ‡ç­¾ç‰ˆæœ¬Rank-SVMç­‰ã€‚åœ¨æ·±åº¦å­¦ä¹ ä¸­å¸¸å¸¸æ˜¯ä¿®æ”¹å¤šåˆ†ç±»æ¨¡å‹çš„è¾“å‡ºå±‚ï¼Œä½¿å…¶é€‚ç”¨äºå¤šæ ‡ç­¾çš„åˆ†ç±»ï¼Œå¦‚ï¼šåœ¨è¾“å‡ºå±‚å¯¹æ¯ä¸€ä¸ªæ ‡ç­¾çš„è¾“å‡ºå€¼ä½¿ç”¨sigmodå‡½æ•°è¿›è¡Œ2åˆ†ç±»(æ ‡ç­¾ä¹‹é—´æ— å…³è”ä¿¡æ¯)ã€‚æˆ–è€…ä½¿ç”¨ä¸€èˆ¬çš„CNNæå–å¥å­çš„è¯­ä¹‰ä¿¡æ¯ï¼Œä½†è€ƒè™‘åˆ°å¥å­è¡¨ç¤ºçš„ä¸åŒéƒ¨åˆ†åœ¨å¥å­åˆ†ç±»çš„è¿‡ç¨‹ä¸­ä¼šèµ·ä¸åŒçš„ä½œç”¨ï¼Œæ•…åœ¨è¿›è¡Œåˆ†ç±»æ—¶å€™ä½¿ç”¨äº†Attentionæœºåˆ¶(è§å›¾)ï¼Œä½¿å¾—åœ¨é¢„æµ‹æ¯ä¸€ç±»æ—¶å€™å¥å­çš„ä¸åŒéƒ¨åˆ†çš„è¡¨ç¤ºèµ·ä¸åŒçš„ä½œç”¨ã€‚</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/3.png" alt="avatar"></p>
<h3 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h3><ol>
<li><a href="https://ai.baidu.com/tech/nlp/doctagger" target="_blank" rel="noopener">ç™¾åº¦AIå¼€æ”¾å¹³å°(æ–‡ç« æ ‡ç­¾)</a></li>
<li><a href="https://github.com/inspirehep/magpie" target="_blank" rel="noopener">Magpie(å¤šæ ‡ç­¾åˆ†ç±»å·¥å…·)</a></li>
<li><a href="https://biendata.com/competition/zhihu/" target="_blank" rel="noopener">2017çŸ¥ä¹â€œçœ‹å±±æ¯â€æ¯”èµ›</a></li>
<li>[è‹±æ–‡æ–°é—»å¤š æ ‡ç­¾åˆ†ç±»æ•°æ®é›†](<a href="https://drive.google.com/file/d/18-JOCIj9v5bZCrn9CIsk23W4wyhroCp_/view?usp=sharing" target="_blank" rel="noopener">https://drive.google.com/file/d/18-JOCIj9v5bZCrn9CIsk23W4wyhroCp_/view?usp=sharing</a></li>
<li>[ç½‘ä¸Šå¯é‡‡é›†çš„ã€è´¨é‡è¾ƒé«˜çš„å¤šæ ‡ç­¾åˆ†ç±»æ•°æ®é›†(<a href="https://movie.douban.com/" target="_blank" rel="noopener">è±†ç“£ç”µå½±è¯„è®º</a>)</li>
<li>GitHubä¸Šæ¯”è¾ƒå®Œå–„çš„<a href="https://github.com/brightmart/text_classification" target="_blank" rel="noopener">æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»é¡¹ç›®</a></li>
<li>NLPCC2018ï¼Œtask6å’Œtesk8å‡å¯ä»¥å½“æˆæ˜¯å¤šæ ‡ç­¾çš„åˆ†ç±»ä»»åŠ¡ï¼›</li>
</ol>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://www.cnblogs.com/cxf-zzj/p/10049613.html" target="_blank" rel="noopener">å¤šæ ‡ç­¾åˆ†ç±»(multi-label classification)ç»¼è¿°</a></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>pythonæ•°æ®ç§‘å­¦é€ŸæŸ¥</title>
    <url>/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="é€ŸæŸ¥è¡¨"><a href="#é€ŸæŸ¥è¡¨" class="headerlink" title="é€ŸæŸ¥è¡¨"></a>é€ŸæŸ¥è¡¨</h2><h3 id="python-åŸºç¡€"><a href="#python-åŸºç¡€" class="headerlink" title="python åŸºç¡€"></a>python åŸºç¡€</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/python.png" alt="avatar"></p>
<a id="more"></a>
<h3 id="å¯¼å…¥æ•°æ®"><a href="#å¯¼å…¥æ•°æ®" class="headerlink" title="å¯¼å…¥æ•°æ®"></a>å¯¼å…¥æ•°æ®</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/import_data.png" alt="avatar"></p>
<h3 id="jupyter-notebook"><a href="#jupyter-notebook" class="headerlink" title="jupyter notebook"></a>jupyter notebook</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/jupyter_notebook.png" alt="avatar"></p>
<h3 id="numpy"><a href="#numpy" class="headerlink" title="numpy"></a>numpy</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/numpy.png" alt="avatar"></p>
<h3 id="pandas"><a href="#pandas" class="headerlink" title="pandas"></a>pandas</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/pandas_1.png" alt="avatar"></p>
<p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/pandas_2.png" alt="avatar"></p>
<h3 id="matplotlib"><a href="#matplotlib" class="headerlink" title="matplotlib"></a>matplotlib</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/matplotlib.png" alt="avatar"></p>
<h3 id="Seaborn"><a href="#Seaborn" class="headerlink" title="Seaborn"></a>Seaborn</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/seaborn.png" alt="avatar"></p>
<h3 id="SciPy"><a href="#SciPy" class="headerlink" title="SciPy"></a>SciPy</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/scipy.png" alt="avatar"></p>
<h3 id="scikit-learn"><a href="#scikit-learn" class="headerlink" title="scikit-learn"></a>scikit-learn</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/scikit_learn.png" alt="avatar"></p>
<h3 id="keras"><a href="#keras" class="headerlink" title="keras"></a>keras</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/kearas.png" alt="avatar"></p>
<h3 id="bokeh"><a href="#bokeh" class="headerlink" title="bokeh"></a>bokeh</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/bokeh.png" alt="avatar"></p>
<h3 id="PySpark"><a href="#PySpark" class="headerlink" title="PySpark"></a>PySpark</h3><h4 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h4><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/spark_sql.png" alt="avatar"></p>
<h4 id="RDD"><a href="#RDD" class="headerlink" title="RDD"></a>RDD</h4><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/spark_rdd.png" alt="avatar"></p>
<h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><h3 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:     <span class="comment"># Runs main() if file wasn't imported.</span></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = &lt;list&gt;[from_inclusive : to_exclusive : Â±step_size]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt;.append(&lt;el&gt;)            <span class="comment"># Or: &lt;list&gt; += [&lt;el&gt;]</span></span><br><span class="line">&lt;list&gt;.extend(&lt;collection&gt;)    <span class="comment"># Or: &lt;list&gt; += &lt;collection&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt;.sort()</span><br><span class="line">&lt;list&gt;.reverse()</span><br><span class="line">&lt;list&gt; = sorted(&lt;collection&gt;)</span><br><span class="line">&lt;iter&gt; = reversed(&lt;list&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sum_of_elements  = sum(&lt;collection&gt;)</span><br><span class="line">elementwise_sum  = [sum(pair) <span class="keyword">for</span> pair <span class="keyword">in</span> zip(list_a, list_b)]</span><br><span class="line">sorted_by_second = sorted(&lt;collection&gt;, key=<span class="keyword">lambda</span> el: el[<span class="number">1</span>])</span><br><span class="line">sorted_by_both   = sorted(&lt;collection&gt;, key=<span class="keyword">lambda</span> el: (el[<span class="number">1</span>], el[<span class="number">0</span>]))</span><br><span class="line">flatter_list     = list(itertools.chain.from_iterable(&lt;list&gt;))</span><br><span class="line">product_of_elems = functools.reduce(<span class="keyword">lambda</span> out, x: out * x, &lt;collection&gt;)</span><br><span class="line">list_of_chars    = list(&lt;str&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">index = &lt;list&gt;.index(&lt;el&gt;)     <span class="comment"># Returns index of first occurrence or raises ValueError.</span></span><br><span class="line">&lt;list&gt;.insert(index, &lt;el&gt;)     <span class="comment"># Inserts item at index and moves the rest to the right.</span></span><br><span class="line">&lt;el&gt; = &lt;list&gt;.pop([index])     <span class="comment"># Removes and returns item at index or from the end.</span></span><br><span class="line">&lt;list&gt;.remove(&lt;el&gt;)            <span class="comment"># Removes first occurrence of item or raises ValueError.</span></span><br><span class="line">&lt;list&gt;.clear()                 <span class="comment"># Removes all items. Also works on dict and set.</span></span><br></pre></td></tr></table></figure>
<h3 id="Dictionary"><a href="#Dictionary" class="headerlink" title="Dictionary"></a>Dictionary</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;view&gt; = &lt;dict&gt;.keys()                          <span class="comment"># Coll. of keys that reflects changes.</span></span><br><span class="line">&lt;view&gt; = &lt;dict&gt;.values()                        <span class="comment"># Coll. of values that reflects changes.</span></span><br><span class="line">&lt;view&gt; = &lt;dict&gt;.items()                         <span class="comment"># Coll. of key-value tuples.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">value  = &lt;dict&gt;.get(key, default=<span class="literal">None</span>)          <span class="comment"># Returns default if key does not exist.</span></span><br><span class="line">value  = &lt;dict&gt;.setdefault(key, default=<span class="literal">None</span>)   <span class="comment"># Same, but also adds default to dict.</span></span><br><span class="line">&lt;dict&gt; = collections.defaultdict(&lt;type&gt;)        <span class="comment"># Creates a dict with default value of type.</span></span><br><span class="line">&lt;dict&gt; = collections.defaultdict(<span class="keyword">lambda</span>: <span class="number">1</span>)     <span class="comment"># Creates a dict with default value 1.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;dict&gt;.update(&lt;dict&gt;)</span><br><span class="line">&lt;dict&gt; = dict(&lt;collection&gt;)                     <span class="comment"># Creates a dict from coll. of key-value pairs.</span></span><br><span class="line">&lt;dict&gt; = dict(zip(keys, values))                <span class="comment"># Creates a dict from two collections.</span></span><br><span class="line">&lt;dict&gt; = dict.fromkeys(keys [, value])          <span class="comment"># Creates a dict from collection of keys.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">value = &lt;dict&gt;.pop(key)                         <span class="comment"># Removes item from dictionary.</span></span><br><span class="line">&#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> &lt;dict&gt;.items() <span class="keyword">if</span> k <span class="keyword">in</span> keys&#125;  <span class="comment"># Filters dictionary by keys.</span></span><br></pre></td></tr></table></figure>
<h3 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>colors = [<span class="string">'red'</span>, <span class="string">'blue'</span>, <span class="string">'yellow'</span>, <span class="string">'blue'</span>, <span class="string">'red'</span>, <span class="string">'blue'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = Counter(colors)</span><br><span class="line">Counter(&#123;<span class="string">'blue'</span>: <span class="number">3</span>, <span class="string">'red'</span>: <span class="number">2</span>, <span class="string">'yellow'</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter.most_common()[<span class="number">0</span>]</span><br><span class="line">(<span class="string">'blue'</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;set&gt; = set()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;set&gt;.add(&lt;el&gt;)                               <span class="comment"># Or: &lt;set&gt; |= &#123;&lt;el&gt;&#125;</span></span><br><span class="line">&lt;set&gt;.update(&lt;collection&gt;)                    <span class="comment"># Or: &lt;set&gt; |= &lt;set&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;set&gt;  = &lt;set&gt;.union(&lt;coll.&gt;)                 <span class="comment"># Or: &lt;set&gt; | &lt;set&gt;</span></span><br><span class="line">&lt;set&gt;  = &lt;set&gt;.intersection(&lt;coll.&gt;)          <span class="comment"># Or: &lt;set&gt; &amp; &lt;set&gt;</span></span><br><span class="line">&lt;set&gt;  = &lt;set&gt;.difference(&lt;coll.&gt;)            <span class="comment"># Or: &lt;set&gt; - &lt;set&gt;</span></span><br><span class="line">&lt;set&gt;  = &lt;set&gt;.symmetric_difference(&lt;coll.&gt;)  <span class="comment"># Or: &lt;set&gt; ^ &lt;set&gt;</span></span><br><span class="line">&lt;bool&gt; = &lt;set&gt;.issubset(&lt;coll.&gt;)              <span class="comment"># Or: &lt;set&gt; &lt;= &lt;set&gt;</span></span><br><span class="line">&lt;bool&gt; = &lt;set&gt;.issuperset(&lt;coll.&gt;)            <span class="comment"># Or: &lt;set&gt; &gt;= &lt;set&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;set&gt;.remove(&lt;el&gt;)                            <span class="comment"># Raises KeyError.</span></span><br><span class="line">&lt;set&gt;.discard(&lt;el&gt;)                           <span class="comment"># Doesn't raise an error.</span></span><br></pre></td></tr></table></figure>
<h4 id="Frozen-Set"><a href="#Frozen-Set" class="headerlink" title="Frozen Set"></a>Frozen Set</h4><ul>
<li><strong>Is immutable and hashable.</strong></li>
<li><strong>That means it can be used as a key in a dictionary or as an element in a set.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;frozenset&gt; = frozenset(&lt;collection&gt;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Tuple"><a href="#Tuple" class="headerlink" title="Tuple"></a>Tuple</h3><hr>
<p><strong>Tuple is an immutable and hashable list.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;tuple&gt; = ()</span><br><span class="line">&lt;tuple&gt; = (&lt;el&gt;, )</span><br><span class="line">&lt;tuple&gt; = (&lt;el_1&gt;, &lt;el_2&gt;, ...)</span><br></pre></td></tr></table></figure></p>
<h4 id="Named-Tuple"><a href="#Named-Tuple" class="headerlink" title="Named Tuple"></a>Named Tuple</h4><p><strong>Tupleâ€™s subclass with named elements.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Point = namedtuple(<span class="string">'Point'</span>, <span class="string">'x y'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Point(<span class="number">1</span>, y=<span class="number">2</span>)</span><br><span class="line">Point(x=<span class="number">1</span>, y=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p[<span class="number">0</span>]</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.x</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(p, <span class="string">'y'</span>)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p._fields  <span class="comment"># Or: Point._fields</span></span><br><span class="line">(<span class="string">'x'</span>, <span class="string">'y'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Range"><a href="#Range" class="headerlink" title="Range"></a>Range</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;range&gt; = range(to_exclusive)</span><br><span class="line">&lt;range&gt; = range(from_inclusive, to_exclusive)</span><br><span class="line">&lt;range&gt; = range(from_inclusive, to_exclusive, Â±step_size)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">from_inclusive = &lt;range&gt;.start</span><br><span class="line">to_exclusive   = &lt;range&gt;.stop</span><br></pre></td></tr></table></figure>
<h3 id="Enumerate"><a href="#Enumerate" class="headerlink" title="Enumerate"></a>Enumerate</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i, el <span class="keyword">in</span> enumerate(&lt;collection&gt; [, i_start]):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h3 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = iter(&lt;collection&gt;)                 <span class="comment"># Calling `iter(&lt;iter&gt;)` returns unmodified iterator.</span></span><br><span class="line">&lt;iter&gt; = iter(&lt;function&gt;, to_exclusive)     <span class="comment"># Sequence of return values until 'to_exclusive'.</span></span><br><span class="line">&lt;el&gt;   = next(&lt;iter&gt; [, default])           <span class="comment"># Raises StopIteration or returns 'default' on end.</span></span><br></pre></td></tr></table></figure>
<h4 id="Itertools"><a href="#Itertools" class="headerlink" title="Itertools"></a>Itertools</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count, repeat, cycle, chain, islice</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = count(start=<span class="number">0</span>, step=<span class="number">1</span>)             <span class="comment"># Returns incremented value endlessly.</span></span><br><span class="line">&lt;iter&gt; = repeat(&lt;el&gt; [, times])             <span class="comment"># Returns element endlessly or 'times' times.</span></span><br><span class="line">&lt;iter&gt; = cycle(&lt;collection&gt;)                <span class="comment"># Repeats the sequence indefinitely.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = chain(&lt;coll.&gt;, &lt;coll.&gt; [, ...])    <span class="comment"># Empties collections in order.</span></span><br><span class="line">&lt;iter&gt; = chain.from_iterable(&lt;collection&gt;)  <span class="comment"># Empties collections inside a collection in order.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = islice(&lt;collection&gt;, to_exclusive)</span><br><span class="line">&lt;iter&gt; = islice(&lt;collection&gt;, from_inclusive, to_exclusive)</span><br><span class="line">&lt;iter&gt; = islice(&lt;collection&gt;, from_inclusive, to_exclusive, +step_size)</span><br></pre></td></tr></table></figure>
<h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><hr>
<ul>
<li><strong>Convenient way to implement the iterator protocol.</strong></li>
<li><strong>Any function that contains a yield statement returns a generator object.</strong></li>
<li><strong>Generators and iterators are interchangeable.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(start, step)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> start</span><br><span class="line">        start += step</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = count(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(counter), next(counter), next(counter)</span><br><span class="line">(<span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h3><hr>
<ul>
<li><strong>Everything is an object.</strong></li>
<li><strong>Every object has a type.</strong></li>
<li><strong>Type and class are synonymous.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;type&gt; = type(&lt;el&gt;)                <span class="comment"># Or: &lt;el&gt;.__class__</span></span><br><span class="line">&lt;bool&gt; = isinstance(&lt;el&gt;, &lt;type&gt;)  <span class="comment"># Or: issubclass(type(&lt;el&gt;), &lt;type&gt;)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(<span class="string">'a'</span>), <span class="string">'a'</span>.__class__, str</span><br><span class="line">(&lt;class 'str'&gt;, &lt;class 'str'&gt;, &lt;class 'str'&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Some-types-do-not-have-builtin-names-so-they-must-be-imported"><a href="#Some-types-do-not-have-builtin-names-so-they-must-be-imported" class="headerlink" title="Some types do not have builtin names, so they must be imported:"></a>Some types do not have builtin names, so they must be imported:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> FunctionType, MethodType, LambdaType, GeneratorType</span><br></pre></td></tr></table></figure>
<h4 id="ABC"><a href="#ABC" class="headerlink" title="ABC"></a>ABC</h4><p><strong>An abstract base class introduces virtual subclasses, that donâ€™t inherit from it but are still recognized by isinstance() and issubclass().</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Sequence, Collection, Iterable</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], Iterable)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+------------------+----------+------------+----------+</span><br><span class="line">|                  | Sequence | Collection | Iterable |</span><br><span class="line">+------------------+----------+------------+----------+</span><br><span class="line">| list, range, str |   yes    |    yes     |   yes    |</span><br><span class="line">| dict, set        |          |    yes     |   yes    |</span><br><span class="line">| iter             |          |            |   yes    |</span><br><span class="line">+------------------+----------+------------+----------+</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> numbers <span class="keyword">import</span> Integral, Rational, Real, Complex, Number</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(<span class="number">123</span>, Number)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+--------------------+----------+----------+------+---------+--------+</span><br><span class="line">|                    | Integral | Rational | Real | Complex | Number |</span><br><span class="line">+--------------------+----------+----------+------+---------+--------+</span><br><span class="line">| int                |   yes    |   yes    | yes  |   yes   |  yes   |</span><br><span class="line">| fractions.Fraction |          |   yes    | yes  |   yes   |  yes   |</span><br><span class="line">| float              |          |          | yes  |   yes   |  yes   |</span><br><span class="line">| complex            |          |          |      |   yes   |  yes   |</span><br><span class="line">+--------------------+----------+----------+------+---------+--------+</span><br></pre></td></tr></table></figure>
<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = &lt;str&gt;.strip()                       <span class="comment"># Strips all whitespace characters from both ends.</span></span><br><span class="line">&lt;str&gt;  = &lt;str&gt;.strip(<span class="string">'&lt;chars&gt;'</span>)              <span class="comment"># Strips all passed characters from both ends.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = &lt;str&gt;.split()                       <span class="comment"># Splits on one or more whitespace characters.</span></span><br><span class="line">&lt;list&gt; = &lt;str&gt;.split(sep=<span class="literal">None</span>, maxsplit=<span class="number">-1</span>)  <span class="comment"># Splits on 'sep' str at most 'maxsplit' times.</span></span><br><span class="line">&lt;list&gt; = &lt;str&gt;.splitlines(keepends=<span class="literal">False</span>)    <span class="comment"># Splits on line breaks. Keeps them if 'keepends'.</span></span><br><span class="line">&lt;str&gt;  = &lt;str&gt;.join(&lt;coll_of_strings&gt;)       <span class="comment"># Joins elements using string as separator.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = &lt;sub_str&gt; <span class="keyword">in</span> &lt;str&gt;                  <span class="comment"># Checks if string contains a substring.</span></span><br><span class="line">&lt;bool&gt; = &lt;str&gt;.startswith(&lt;sub_str&gt;)         <span class="comment"># Pass tuple of strings for multiple options.</span></span><br><span class="line">&lt;bool&gt; = &lt;str&gt;.endswith(&lt;sub_str&gt;)           <span class="comment"># Pass tuple of strings for multiple options.</span></span><br><span class="line">&lt;int&gt;  = &lt;str&gt;.find(&lt;sub_str&gt;)               <span class="comment"># Returns start index of first match or -1.</span></span><br><span class="line">&lt;int&gt;  = &lt;str&gt;.index(&lt;sub_str&gt;)              <span class="comment"># Same but raises ValueError.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = &lt;str&gt;.replace(old, new [, count])   <span class="comment"># Replaces 'old' with 'new' at most 'count' times.</span></span><br><span class="line">&lt;bool&gt; = &lt;str&gt;.isnumeric()                   <span class="comment"># True if str contains only numeric characters.</span></span><br><span class="line">&lt;list&gt; = textwrap.wrap(&lt;str&gt;, width)         <span class="comment"># Nicely breaks string into lines.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Also: <code>&#39;lstrip()&#39;</code>, <code>&#39;rstrip()&#39;</code>.</strong></li>
<li><strong>Also: <code>&#39;lower()&#39;</code>, <code>&#39;upper()&#39;</code>, <code>&#39;capitalize()&#39;</code> and <code>&#39;title()&#39;</code>.</strong></li>
</ul>
<h4 id="Char"><a href="#Char" class="headerlink" title="Char"></a>Char</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt; = chr(&lt;int&gt;)  <span class="comment"># Converts int to unicode char.</span></span><br><span class="line">&lt;int&gt; = ord(&lt;str&gt;)  <span class="comment"># Converts unicode char to int.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ord(<span class="string">'0'</span>), ord(<span class="string">'9'</span>)</span><br><span class="line">(<span class="number">48</span>, <span class="number">57</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ord(<span class="string">'A'</span>), ord(<span class="string">'Z'</span>)</span><br><span class="line">(<span class="number">65</span>, <span class="number">90</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ord(<span class="string">'a'</span>), ord(<span class="string">'z'</span>)</span><br><span class="line">(<span class="number">97</span>, <span class="number">122</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Regex"><a href="#Regex" class="headerlink" title="Regex"></a>Regex</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">&lt;str&gt;   = re.sub(&lt;regex&gt;, new, text, count=<span class="number">0</span>)  <span class="comment"># Substitutes all occurrences.</span></span><br><span class="line">&lt;list&gt;  = re.findall(&lt;regex&gt;, text)            <span class="comment"># Returns all occurrences.</span></span><br><span class="line">&lt;list&gt;  = re.split(&lt;regex&gt;, text, maxsplit=<span class="number">0</span>)  <span class="comment"># Use brackets in regex to keep the matches.</span></span><br><span class="line">&lt;Match&gt; = re.search(&lt;regex&gt;, text)             <span class="comment"># Searches for first occurrence of pattern.</span></span><br><span class="line">&lt;Match&gt; = re.match(&lt;regex&gt;, text)              <span class="comment"># Searches only at the beginning of the text.</span></span><br><span class="line">&lt;iter&gt;  = re.finditer(&lt;regex&gt;, text)           <span class="comment"># Returns all occurrences as match objects.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Argument <code>&#39;flags=re.IGNORECASE&#39;</code> can be used with all functions.</strong></li>
<li><strong>Argument <code>&#39;flags=re.MULTILINE&#39;</code> makes <code>&#39;^&#39;</code> and <code>&#39;$&#39;</code> match the start/end of each line.</strong></li>
<li><strong>Argument <code>&#39;flags=re.DOTALL&#39;</code> makes dot also accept newline.</strong></li>
<li><strong>Use <code>r&#39;\1&#39;</code> or <code>&#39;\\1&#39;</code> for backreference.</strong></li>
<li><strong>Use <code>&#39;?&#39;</code> to make an operator non-greedy.</strong></li>
</ul>
<h4 id="Match-Object"><a href="#Match-Object" class="headerlink" title="Match Object"></a>Match Object</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;   = &lt;Match&gt;.group()   <span class="comment"># Whole match. Also group(0).</span></span><br><span class="line">&lt;str&gt;   = &lt;Match&gt;.group(<span class="number">1</span>)  <span class="comment"># Part in first bracket.</span></span><br><span class="line">&lt;tuple&gt; = &lt;Match&gt;.groups()  <span class="comment"># All bracketed parts.</span></span><br><span class="line">&lt;int&gt;   = &lt;Match&gt;.start()   <span class="comment"># Start index of a match.</span></span><br><span class="line">&lt;int&gt;   = &lt;Match&gt;.end()     <span class="comment"># Exclusive end index of a match.</span></span><br></pre></td></tr></table></figure>
<h4 id="Special-Sequences"><a href="#Special-Sequences" class="headerlink" title="Special Sequences"></a>Special Sequences</h4><ul>
<li><strong>By default digits, whitespaces and alphanumerics from all alphabets are matched, unless <code>&#39;flags=re.ASCII&#39;</code> argument is used.</strong></li>
<li><strong>Use capital letters for negation.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'\d'</span> == <span class="string">'[0-9]'</span>             <span class="comment"># Digit</span></span><br><span class="line"><span class="string">'\s'</span> == <span class="string">'[ \t\n\r\f\v]'</span>     <span class="comment"># Whitespace</span></span><br><span class="line"><span class="string">'\w'</span> == <span class="string">'[a-zA-Z0-9_]'</span>      <span class="comment"># Alphanumeric</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Format"><a href="#Format" class="headerlink" title="Format"></a>Format</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt; = <span class="string">f'<span class="subst">&#123;&lt;el_1&gt;&#125;</span>, <span class="subst">&#123;&lt;el_2&gt;&#125;</span>'</span></span><br><span class="line">&lt;str&gt; = <span class="string">'&#123;&#125;, &#123;&#125;'</span>.format(&lt;el_1&gt;, &lt;el_2&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Person = namedtuple(<span class="string">'Person'</span>, <span class="string">'name height'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person = Person(<span class="string">'Jean-Luc'</span>, <span class="number">187</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f'<span class="subst">&#123;person.height&#125;</span>'</span></span><br><span class="line"><span class="string">'187'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'&#123;p.height&#125;'</span>.format(p=person)</span><br><span class="line"><span class="string">'187'</span></span><br></pre></td></tr></table></figure>
<h4 id="General-Options"><a href="#General-Options" class="headerlink" title="General Options"></a>General Options</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&lt;el&gt;:&lt;<span class="number">10</span>&#125;       <span class="comment"># '&lt;el&gt;      '</span></span><br><span class="line">&#123;&lt;el&gt;:^<span class="number">10</span>&#125;       <span class="comment"># '   &lt;el&gt;   '</span></span><br><span class="line">&#123;&lt;el&gt;:&gt;<span class="number">10</span>&#125;       <span class="comment"># '      &lt;el&gt;'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&lt;el&gt;:.&lt;<span class="number">10</span>&#125;      <span class="comment"># '&lt;el&gt;......'</span></span><br><span class="line">&#123;&lt;el&gt;:&gt;<span class="number">0</span>&#125;        <span class="comment"># '&lt;el&gt;'</span></span><br></pre></td></tr></table></figure>
<h4 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h4><p><strong><code>&#39;!r&#39;</code> calls objectâ€™s repr() method, instead of str(), to get a string.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">'abcde'</span>!r:&lt;<span class="number">10</span>&#125;  <span class="comment"># "'abcde'   "</span></span><br><span class="line">&#123;<span class="string">'abcde'</span>:<span class="number">.3</span>&#125;     <span class="comment"># 'abc'</span></span><br><span class="line">&#123;<span class="string">'abcde'</span>:<span class="number">10.3</span>&#125;   <span class="comment"># 'abc       '</span></span><br></pre></td></tr></table></figure></p>
<h4 id="Numbers"><a href="#Numbers" class="headerlink" title="Numbers"></a>Numbers</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123; <span class="number">123456</span>:<span class="number">10</span>,&#125;    <span class="comment"># '   123,456'</span></span><br><span class="line">&#123; <span class="number">123456</span>:<span class="number">10</span>_&#125;    <span class="comment"># '   123_456'</span></span><br><span class="line">&#123; <span class="number">123456</span>:+<span class="number">10</span>&#125;    <span class="comment"># '   +123456'</span></span><br><span class="line">&#123;<span class="number">-123456</span>:=<span class="number">10</span>&#125;    <span class="comment"># '-   123456'</span></span><br><span class="line">&#123; <span class="number">123456</span>: &#125;      <span class="comment"># ' 123456'</span></span><br><span class="line">&#123;<span class="number">-123456</span>: &#125;      <span class="comment"># '-123456'</span></span><br></pre></td></tr></table></figure>
<h4 id="Floats"><a href="#Floats" class="headerlink" title="Floats"></a>Floats</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>&#125;   <span class="comment"># '      1.23'</span></span><br><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>f&#125;  <span class="comment"># '     1.235'</span></span><br><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>e&#125;  <span class="comment"># ' 1.235e+00'</span></span><br><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>%&#125;  <span class="comment"># '  123.456%'</span></span><br></pre></td></tr></table></figure>
<h4 id="Comparison-of-float-presentation-types"><a href="#Comparison-of-float-presentation-types" class="headerlink" title="Comparison of float presentation types:"></a>Comparison of float presentation types:</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|                |    &#123;&lt;float&gt;&#125;   |  &#123;&lt;float&gt;:f&#125;  |   &#123;&lt;float&gt;:e&#125;  |   &#123;&lt;float&gt;:%&#125;   |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|    0.000056789 |   &#39;5.6789e-05&#39; |    &#39;0.000057&#39; | &#39;5.678900e-05&#39; |     &#39;0.005679%&#39; |</span><br><span class="line">|    0.00056789  |   &#39;0.00056789&#39; |    &#39;0.000568&#39; | &#39;5.678900e-04&#39; |     &#39;0.056789%&#39; |</span><br><span class="line">|    0.0056789   |   &#39;0.0056789&#39;  |    &#39;0.005679&#39; | &#39;5.678900e-03&#39; |     &#39;0.567890%&#39; |</span><br><span class="line">|    0.056789    |   &#39;0.056789&#39;   |    &#39;0.056789&#39; | &#39;5.678900e-02&#39; |     &#39;5.678900%&#39; |</span><br><span class="line">|    0.56789     |   &#39;0.56789&#39;    |    &#39;0.567890&#39; | &#39;5.678900e-01&#39; |    &#39;56.789000%&#39; |</span><br><span class="line">|    5.6789      |   &#39;5.6789&#39;     |    &#39;5.678900&#39; | &#39;5.678900e+00&#39; |   &#39;567.890000%&#39; |</span><br><span class="line">|   56.789       |  &#39;56.789&#39;      |   &#39;56.789000&#39; | &#39;5.678900e+01&#39; |  &#39;5678.900000%&#39; |</span><br><span class="line">|  567.89        | &#39;567.89&#39;       |  &#39;567.890000&#39; | &#39;5.678900e+02&#39; | &#39;56789.000000%&#39; |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|                |  &#123;&lt;float&gt;:.2&#125;  | &#123;&lt;float&gt;:.2f&#125; |  &#123;&lt;float&gt;:.2e&#125; |  &#123;&lt;float&gt;:.2%&#125;  |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|    0.000056789 |   &#39;5.7e-05&#39;    |      &#39;0.00&#39;   |   &#39;5.68e-05&#39;   |       &#39;0.01%&#39;   |</span><br><span class="line">|    0.00056789  |   &#39;0.00057&#39;    |      &#39;0.00&#39;   |   &#39;5.68e-04&#39;   |       &#39;0.06%&#39;   |</span><br><span class="line">|    0.0056789   |   &#39;0.0057&#39;     |      &#39;0.01&#39;   |   &#39;5.68e-03&#39;   |       &#39;0.57%&#39;   |</span><br><span class="line">|    0.056789    |   &#39;0.057&#39;      |      &#39;0.06&#39;   |   &#39;5.68e-02&#39;   |       &#39;5.68%&#39;   |</span><br><span class="line">|    0.56789     |   &#39;0.57&#39;       |      &#39;0.57&#39;   |   &#39;5.68e-01&#39;   |      &#39;56.79%&#39;   |</span><br><span class="line">|    5.6789      |   &#39;5.7&#39;        |      &#39;5.68&#39;   |   &#39;5.68e+00&#39;   |     &#39;567.89%&#39;   |</span><br><span class="line">|   56.789       |   &#39;5.7e+01&#39;    |     &#39;56.79&#39;   |   &#39;5.68e+01&#39;   |    &#39;5678.90%&#39;   |</span><br><span class="line">|  567.89        |   &#39;5.7e+02&#39;    |    &#39;567.89&#39;   |   &#39;5.68e+02&#39;   |   &#39;56789.00%&#39;   |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br></pre></td></tr></table></figure>
<h4 id="Ints"><a href="#Ints" class="headerlink" title="Ints"></a>Ints</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="number">90</span>:c&#125;           <span class="comment"># 'Z'</span></span><br><span class="line">&#123;<span class="number">90</span>:X&#125;           <span class="comment"># '5A'</span></span><br><span class="line">&#123;<span class="number">90</span>:b&#125;           <span class="comment"># '1011010'</span></span><br></pre></td></tr></table></figure>
<h3 id="Numbers-1"><a href="#Numbers-1" class="headerlink" title="Numbers"></a>Numbers</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;int&gt;      = int(&lt;float/str/bool&gt;)    <span class="comment"># Or: math.floor(&lt;float&gt;)</span></span><br><span class="line">&lt;float&gt;    = float(&lt;int/str/bool&gt;)</span><br><span class="line">&lt;complex&gt;  = complex(real=<span class="number">0</span>, imag=<span class="number">0</span>)  <span class="comment"># Or: &lt;real&gt; + &lt;real&gt;j</span></span><br><span class="line">&lt;Fraction&gt; = fractions.Fraction(numerator=<span class="number">0</span>, denominator=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>&#39;int(&lt;str&gt;)&#39;</code> and <code>&#39;float(&lt;str&gt;)&#39;</code> raise â€˜ValueErrorâ€™ on malformed strings.</strong></li>
</ul>
<h4 id="Basic-Functions"><a href="#Basic-Functions" class="headerlink" title="Basic Functions"></a>Basic Functions</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;num&gt;  = pow(&lt;num&gt;, &lt;num&gt;)            <span class="comment"># Or: &lt;num&gt; ** &lt;num&gt;</span></span><br><span class="line">&lt;real&gt; = abs(&lt;num&gt;)</span><br><span class="line">&lt;int&gt;  = round(&lt;real&gt;)</span><br><span class="line">&lt;real&gt; = round(&lt;real&gt;, Â±ndigits)      <span class="comment"># `round(126, -1) == 130`</span></span><br></pre></td></tr></table></figure>
<h4 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> e, pi, inf, nan</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> cos, acos, sin, asin, tan, atan, degrees, radians</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> log, log10, log2</span><br></pre></td></tr></table></figure>
<h4 id="Statistics"><a href="#Statistics" class="headerlink" title="Statistics"></a>Statistics</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> statistics <span class="keyword">import</span> mean, median, variance, pvariance, pstdev</span><br></pre></td></tr></table></figure>
<h4 id="Random"><a href="#Random" class="headerlink" title="Random"></a>Random</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> random, randint, choice, shuffle</span><br><span class="line">&lt;float&gt; = random()</span><br><span class="line">&lt;int&gt;   = randint(from_inclusive, to_inclusive)</span><br><span class="line">&lt;el&gt;    = choice(&lt;list&gt;)</span><br><span class="line">shuffle(&lt;list&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Bin-Hex"><a href="#Bin-Hex" class="headerlink" title="Bin, Hex"></a>Bin, Hex</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;int&gt;     = <span class="number">0</span>b&lt;bin&gt;            <span class="comment"># Or: 0x&lt;hex&gt;</span></span><br><span class="line">&lt;int&gt;     = int(<span class="string">'0b&lt;bin&gt;'</span>, <span class="number">0</span>)  <span class="comment"># Or: int('0x&lt;hex&gt;', 0)</span></span><br><span class="line">&lt;int&gt;     = int(<span class="string">'&lt;bin&gt;'</span>, <span class="number">2</span>)    <span class="comment"># Or: int('&lt;hex&gt;', 16)</span></span><br><span class="line"><span class="string">'0b&lt;bin&gt;'</span> = bin(&lt;int&gt;)         <span class="comment"># Or: '0x&lt;hex&gt;' = hex(&lt;int&gt;)</span></span><br></pre></td></tr></table></figure>
<h4 id="Bitwise-Operators"><a href="#Bitwise-Operators" class="headerlink" title="Bitwise Operators"></a>Bitwise Operators</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;int&gt;     = &lt;int&gt; &amp; &lt;int&gt;      <span class="comment"># And</span></span><br><span class="line">&lt;int&gt;     = &lt;int&gt; | &lt;int&gt;      <span class="comment"># Or</span></span><br><span class="line">&lt;int&gt;     = &lt;int&gt; ^ &lt;int&gt;      <span class="comment"># Xor (0 if both bits equal)</span></span><br><span class="line">&lt;int&gt;     = &lt;int&gt; &lt;&lt; n_bits    <span class="comment"># Shift left</span></span><br><span class="line">&lt;int&gt;     = &lt;int&gt; &gt;&gt; n_bits    <span class="comment"># Shift right</span></span><br><span class="line">&lt;int&gt;     = ~&lt;int&gt;             <span class="comment"># Compliment (flips bits)</span></span><br></pre></td></tr></table></figure>
<h3 id="Combinatorics"><a href="#Combinatorics" class="headerlink" title="Combinatorics"></a>Combinatorics</h3><hr>
<ul>
<li><strong>Every function returns an iterator.</strong></li>
<li><strong>If you want to print the iterator, you need to pass it to the list() function!</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product, combinations, combinations_with_replacement, permutations</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>product([<span class="number">0</span>, <span class="number">1</span>], repeat=<span class="number">3</span>)</span><br><span class="line">[(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>product(<span class="string">'ab'</span>, <span class="string">'12'</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'1'</span>), (<span class="string">'a'</span>, <span class="string">'2'</span>),</span><br><span class="line"> (<span class="string">'b'</span>, <span class="string">'1'</span>), (<span class="string">'b'</span>, <span class="string">'2'</span>)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>combinations(<span class="string">'abc'</span>, <span class="number">2</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'b'</span>), (<span class="string">'a'</span>, <span class="string">'c'</span>), (<span class="string">'b'</span>, <span class="string">'c'</span>)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>combinations_with_replacement(<span class="string">'abc'</span>, <span class="number">2</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'a'</span>), (<span class="string">'a'</span>, <span class="string">'b'</span>), (<span class="string">'a'</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="string">'b'</span>, <span class="string">'b'</span>), (<span class="string">'b'</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="string">'c'</span>, <span class="string">'c'</span>)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>permutations(<span class="string">'abc'</span>, <span class="number">2</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'b'</span>), (<span class="string">'a'</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="string">'b'</span>, <span class="string">'a'</span>), (<span class="string">'b'</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="string">'c'</span>, <span class="string">'a'</span>), (<span class="string">'c'</span>, <span class="string">'b'</span>)]</span><br></pre></td></tr></table></figure>
<h3 id="Datetime"><a href="#Datetime" class="headerlink" title="Datetime"></a>Datetime</h3><hr>
<ul>
<li><strong>Module â€˜datetimeâ€™ provides â€˜dateâ€™ <code>&lt;D&gt;</code>, â€˜timeâ€™ <code>&lt;T&gt;</code>, â€˜datetimeâ€™ <code>&lt;DT&gt;</code> and â€˜timedeltaâ€™ <code>&lt;TD&gt;</code> classes. All are immutable and hashable.</strong></li>
<li><strong>Time and datetime can be â€˜awareâ€™ <code>&lt;a&gt;</code>, meaning they have defined timezone, or â€˜naiveâ€™ <code>&lt;n&gt;</code>, meaning they donâ€™t.</strong></li>
<li><strong>If object is naive it is presumed to be in systemâ€™s timezone.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date, time, datetime, timedelta</span><br><span class="line"><span class="keyword">from</span> dateutil.tz <span class="keyword">import</span> UTC, tzlocal, gettz</span><br></pre></td></tr></table></figure>
<h4 id="Constructors"><a href="#Constructors" class="headerlink" title="Constructors"></a>Constructors</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;D&gt;  = date(year, month, day)</span><br><span class="line">&lt;T&gt;  = time(hour=<span class="number">0</span>, minute=<span class="number">0</span>, second=<span class="number">0</span>, microsecond=<span class="number">0</span>, tzinfo=<span class="literal">None</span>, fold=<span class="number">0</span>)</span><br><span class="line">&lt;DT&gt; = datetime(year, month, day, hour=<span class="number">0</span>, minute=<span class="number">0</span>, second=<span class="number">0</span>, ...)</span><br><span class="line">&lt;TD&gt; = timedelta(days=<span class="number">0</span>, seconds=<span class="number">0</span>, microseconds=<span class="number">0</span>, milliseconds=<span class="number">0</span>,</span><br><span class="line">                 minutes=<span class="number">0</span>, hours=<span class="number">0</span>, weeks=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Use <code>&#39;&lt;D/DT&gt;.weekday()&#39;</code> to get the day of the week (Mon == 0).</strong></li>
<li><strong><code>&#39;fold=1&#39;</code> means second pass in case of time jumping back for one hour.</strong></li>
</ul>
<h4 id="Now"><a href="#Now" class="headerlink" title="Now"></a>Now</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;D/DTn&gt;  = D/DT.today()                     <span class="comment"># Current local date or naive datetime.</span></span><br><span class="line">&lt;DTn&gt;    = DT.utcnow()                      <span class="comment"># Naive datetime from current UTC time.</span></span><br><span class="line">&lt;DTa&gt;    = DT.now(&lt;tzinfo&gt;)                 <span class="comment"># Aware datetime from current tz time.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>To extract time use <code>&#39;&lt;DTn&gt;.time()&#39;</code>, <code>&#39;&lt;DTa&gt;.time()&#39;</code> or <code>&#39;&lt;DTa&gt;.timetz()&#39;</code>.</strong></li>
</ul>
<h4 id="Timezone"><a href="#Timezone" class="headerlink" title="Timezone"></a>Timezone</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;tzinfo&gt; = UTC                              <span class="comment"># UTC timezone. London without DST.</span></span><br><span class="line">&lt;tzinfo&gt; = tzlocal()                        <span class="comment"># Local timezone. Also gettz().</span></span><br><span class="line">&lt;tzinfo&gt; = gettz(<span class="string">'&lt;Cont.&gt;/&lt;City&gt;'</span>)          <span class="comment"># Timezone from 'Continent/City_Name' str.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;DTa&gt;    = &lt;DT&gt;.astimezone(&lt;tzinfo&gt;)        <span class="comment"># Datetime, converted to passed timezone.</span></span><br><span class="line">&lt;Ta/DTa&gt; = &lt;T/DT&gt;.replace(tzinfo=&lt;tzinfo&gt;)  <span class="comment"># Unconverted object with new timezone.</span></span><br></pre></td></tr></table></figure>
<h4 id="Encode"><a href="#Encode" class="headerlink" title="Encode"></a>Encode</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;D/T/DT&gt; = D/T/DT.fromisoformat(<span class="string">'&lt;iso&gt;'</span>)    <span class="comment"># Object from ISO string.</span></span><br><span class="line">&lt;DT&gt;     = DT.strptime(&lt;str&gt;, <span class="string">'&lt;format&gt;'</span>)   <span class="comment"># Datetime from str, according to format.</span></span><br><span class="line">&lt;D/DTn&gt;  = D/DT.fromordinal(&lt;int&gt;)          <span class="comment"># D/DTn from days since Christ, at midnight.</span></span><br><span class="line">&lt;DTn&gt;    = DT.fromtimestamp(&lt;real&gt;)         <span class="comment"># Local time DTn from seconds since Epoch.</span></span><br><span class="line">&lt;DTa&gt;    = DT.fromtimestamp(&lt;real&gt;, &lt;tz.&gt;)  <span class="comment"># Aware datetime from seconds since Epoch.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ISO strings come in following forms: <code>&#39;YYYY-MM-DD&#39;</code>, <code>&#39;HH:MM:SS.ffffff[Â±&lt;offset&gt;]&#39;</code>, or both separated by <code>&#39;T&#39;</code>. Offset is formatted as: <code>&#39;HH:MM&#39;</code>.</strong></li>
<li><strong>On Unix systems Epoch is <code>&#39;1970-01-01 00:00 UTC&#39;</code>, <code>&#39;1970-01-01 01:00 CET&#39;</code>, â€¦</strong></li>
</ul>
<h4 id="Decode"><a href="#Decode" class="headerlink" title="Decode"></a>Decode</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;    = &lt;D/T/DT&gt;.isoformat()             <span class="comment"># ISO string representation.</span></span><br><span class="line">&lt;str&gt;    = &lt;D/T/DT&gt;.strftime(<span class="string">'&lt;format&gt;'</span>)    <span class="comment"># Custom string representation.</span></span><br><span class="line">&lt;int&gt;    = &lt;D/DT&gt;.toordinal()               <span class="comment"># Days since Christ, ignoring time and tz.</span></span><br><span class="line">&lt;float&gt;  = &lt;DTn&gt;.timestamp()                <span class="comment"># Seconds since Epoch from DTn in local time.</span></span><br><span class="line">&lt;float&gt;  = &lt;DTa&gt;.timestamp()                <span class="comment"># Seconds since Epoch from DTa.</span></span><br></pre></td></tr></table></figure>
<h4 id="Format-1"><a href="#Format-1" class="headerlink" title="Format"></a>Format</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = datetime.strptime(<span class="string">'2015-05-14 23:39:00.00 +0200'</span>, <span class="string">'%Y-%m-%d %H:%M:%S.%f %z'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt.strftime(<span class="string">"%A, %dth of %B '%y, %I:%M%p %Z"</span>)</span><br><span class="line"><span class="string">"Thursday, 14th of May '15, 11:39PM UTC+02:00"</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>For abbreviated weekday and month use <code>&#39;%a&#39;</code> and <code>&#39;%b&#39;</code>.</strong></li>
<li><strong>When parsing, <code>&#39;%z&#39;</code> also accepts <code>&#39;Â±HH:MM&#39;</code>.</strong></li>
</ul>
<h4 id="Arithmetics"><a href="#Arithmetics" class="headerlink" title="Arithmetics"></a>Arithmetics</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;D/DT&gt;   = &lt;D/DT&gt; Â±  &lt;TD&gt;</span><br><span class="line">&lt;TD&gt;     = &lt;TD&gt;   Â±  &lt;TD&gt;</span><br><span class="line">&lt;TD&gt;     = &lt;TD&gt;   */ &lt;real&gt;</span><br><span class="line">&lt;float&gt;  = &lt;TD&gt;   /  &lt;TD&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Arguments"><a href="#Arguments" class="headerlink" title="Arguments"></a>Arguments</h3><hr>
<h4 id="Inside-Function-Call"><a href="#Inside-Function-Call" class="headerlink" title="Inside Function Call"></a>Inside Function Call</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;function&gt;(&lt;positional_args&gt;)                  <span class="comment"># f(0, 0)</span></span><br><span class="line">&lt;function&gt;(&lt;keyword_args&gt;)                     <span class="comment"># f(x=0, y=0)</span></span><br><span class="line">&lt;function&gt;(&lt;positional_args&gt;, &lt;keyword_args&gt;)  <span class="comment"># f(0, y=0)</span></span><br></pre></td></tr></table></figure>
<h4 id="Inside-Function-Definition"><a href="#Inside-Function-Definition" class="headerlink" title="Inside Function Definition"></a>Inside Function Definition</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(&lt;nondefault_args&gt;)</span>:</span>                      <span class="comment"># def f(x, y):</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(&lt;default_args&gt;)</span>:</span>                         <span class="comment"># def f(x=0, y=0):</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(&lt;nondefault_args&gt;, &lt;default_args&gt;)</span>:</span>      <span class="comment"># def f(x, y=0):</span></span><br></pre></td></tr></table></figure>
<h3 id="Splat-Operator"><a href="#Splat-Operator" class="headerlink" title="Splat Operator"></a>Splat Operator</h3><hr>
<h4 id="Inside-Function-Call-1"><a href="#Inside-Function-Call-1" class="headerlink" title="Inside Function Call"></a>Inside Function Call</h4><p><strong>Splat expands a collection into positional arguments, while splatty-splat expands a dictionary into keyword arguments.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">args   = (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">kwargs = &#123;<span class="string">'x'</span>: <span class="number">3</span>, <span class="string">'y'</span>: <span class="number">4</span>, <span class="string">'z'</span>: <span class="number">5</span>&#125;</span><br><span class="line">func(*args, **kwargs)</span><br></pre></td></tr></table></figure></p>
<h5 id="Is-the-same-as"><a href="#Is-the-same-as" class="headerlink" title="Is the same as:"></a>Is the same as:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, x=<span class="number">3</span>, y=<span class="number">4</span>, z=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Inside-Function-Definition-1"><a href="#Inside-Function-Definition-1" class="headerlink" title="Inside Function Definition"></a>Inside Function Definition</h4><p><strong>Splat combines zero or more positional arguments into a tuple, while splatty-splat combines zero or more keyword arguments into a dictionary.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(*a)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> sum(a)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>
<h5 id="Legal-argument-combinations"><a href="#Legal-argument-combinations" class="headerlink" title="Legal argument combinations:"></a>Legal argument combinations:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, y, z)</span>:</span>                <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3) | f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*, x, y, z)</span>:</span>             <span class="comment"># f(x=1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *, y, z)</span>:</span>             <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, y, *, z)</span>:</span>             <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*args)</span>:</span>                  <span class="comment"># f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *args)</span>:</span>               <span class="comment"># f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*args, z)</span>:</span>               <span class="comment"># f(1, 2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *args, z)</span>:</span>            <span class="comment"># f(1, 2, z=3)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(**kwargs)</span>:</span>               <span class="comment"># f(x=1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, **kwargs)</span>:</span>            <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*, x, **kwargs)</span>:</span>         <span class="comment"># f(x=1, y=2, z=3)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*args, **kwargs)</span>:</span>        <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3) | f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *args, **kwargs)</span>:</span>     <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3) | f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*args, y, **kwargs)</span>:</span>     <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *args, z, **kwargs)</span>:</span>  <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3)</span></span><br></pre></td></tr></table></figure>
<h4 id="Other-Uses"><a href="#Other-Uses" class="headerlink" title="Other Uses"></a>Other Uses</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt;  = [*&lt;collection&gt; [, ...]]</span><br><span class="line">&lt;set&gt;   = &#123;*&lt;collection&gt; [, ...]&#125;</span><br><span class="line">&lt;tuple&gt; = (*&lt;collection&gt;, [...])</span><br><span class="line">&lt;dict&gt;  = &#123;**&lt;dict&gt; [, ...]&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">head, *body, tail = &lt;collection&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Inline"><a href="#Inline" class="headerlink" title="Inline"></a>Inline</h3><hr>
<h4 id="Lambda"><a href="#Lambda" class="headerlink" title="Lambda"></a>Lambda</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;function&gt; = <span class="keyword">lambda</span>: &lt;return_value&gt;</span><br><span class="line">&lt;function&gt; = <span class="keyword">lambda</span> &lt;argument_1&gt;, &lt;argument_2&gt;: &lt;return_value&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Comprehension"><a href="#Comprehension" class="headerlink" title="Comprehension"></a>Comprehension</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = [i+<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]                   <span class="comment"># [1, 2, ..., 10]</span></span><br><span class="line">&lt;set&gt;  = &#123;i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> i &gt; <span class="number">5</span>&#125;            <span class="comment"># &#123;6, 7, 8, 9&#125;</span></span><br><span class="line">&lt;iter&gt; = (i+<span class="number">5</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>))                   <span class="comment"># (5, 6, ..., 14)</span></span><br><span class="line">&lt;dict&gt; = &#123;i: i*<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)&#125;                <span class="comment"># &#123;0: 0, 1: 2, ..., 9: 18&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">out = [i+j <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br></pre></td></tr></table></figure>
<h4 id="Is-the-same-as-1"><a href="#Is-the-same-as-1" class="headerlink" title="Is the same as:"></a>Is the same as:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">out = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        out.append(i+j)</span><br></pre></td></tr></table></figure>
<h3 id="Map-Filter-Reduce"><a href="#Map-Filter-Reduce" class="headerlink" title="Map, Filter, Reduce"></a>Map, Filter, Reduce</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line">&lt;iter&gt; = map(<span class="keyword">lambda</span> x: x + <span class="number">1</span>, range(<span class="number">10</span>))            <span class="comment"># (1, 2, ..., 10)</span></span><br><span class="line">&lt;iter&gt; = filter(<span class="keyword">lambda</span> x: x &gt; <span class="number">5</span>, range(<span class="number">10</span>))         <span class="comment"># (6, 7, 8, 9)</span></span><br><span class="line">&lt;int&gt;  = reduce(<span class="keyword">lambda</span> out, x: out + x, range(<span class="number">10</span>))  <span class="comment"># 45</span></span><br></pre></td></tr></table></figure>
<h4 id="Any-All"><a href="#Any-All" class="headerlink" title="Any, All"></a>Any, All</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = any(&lt;collection&gt;)                          <span class="comment"># False if empty.</span></span><br><span class="line">&lt;bool&gt; = all(el[<span class="number">1</span>] <span class="keyword">for</span> el <span class="keyword">in</span> &lt;collection&gt;)          <span class="comment"># True if empty.</span></span><br></pre></td></tr></table></figure>
<h4 id="If-Else"><a href="#If-Else" class="headerlink" title="If - Else"></a>If - Else</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;expression_if_true&gt; <span class="keyword">if</span> &lt;condition&gt; <span class="keyword">else</span> &lt;expression_if_false&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[a <span class="keyword">if</span> a <span class="keyword">else</span> <span class="string">'zero'</span> <span class="keyword">for</span> a <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>)]</span><br><span class="line">[<span class="string">'zero'</span>, <span class="number">1</span>, <span class="string">'zero'</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<h4 id="Namedtuple-Enum-Dataclass"><a href="#Namedtuple-Enum-Dataclass" class="headerlink" title="Namedtuple, Enum, Dataclass"></a>Namedtuple, Enum, Dataclass</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">Point     = namedtuple(<span class="string">'Point'</span>, <span class="string">'x y'</span>)</span><br><span class="line">point     = Point(<span class="number">0</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line">Direction = Enum(<span class="string">'Direction'</span>, <span class="string">'n e s w'</span>)</span><br><span class="line">direction = Direction.n</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> make_dataclass</span><br><span class="line">Creature  = make_dataclass(<span class="string">'Creature'</span>, [<span class="string">'location'</span>, <span class="string">'direction'</span>])</span><br><span class="line">creature  = Creature(Point(<span class="number">0</span>, <span class="number">0</span>), Direction.n)</span><br></pre></td></tr></table></figure>
<h3 id="Closure"><a href="#Closure" class="headerlink" title="Closure"></a>Closure</h3><hr>
<p><strong>We have a closure in Python when:</strong></p>
<ul>
<li><strong>A nested function references a value of its enclosing function and then</strong></li>
<li><strong>the enclosing function returns the nested function.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_multiplier</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(b)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> a * b</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3 = get_multiplier(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If multiple nested functions within enclosing function reference the same value, that value gets shared.</strong></li>
<li><strong>To dynamically access functionâ€™s first free variable use <code>&#39;&lt;function&gt;.__closure__[0].cell_contents&#39;</code>.</strong></li>
</ul>
<h4 id="Partial"><a href="#Partial" class="headerlink" title="Partial"></a>Partial</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line">&lt;function&gt; = partial(&lt;function&gt; [, &lt;arg_1&gt;, &lt;arg_2&gt;, ...])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> operator <span class="keyword">as</span> op</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3 = partial(op.mul, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Partial is also useful in cases when a function needs to be passed as an argument, because it enables us to set its arguments beforehand.</strong></li>
<li><strong>A few examples being <code>&#39;defaultdict(&lt;function&gt;)&#39;</code>, <code>&#39;iter(&lt;function&gt;, to_exclusive)&#39;</code> and dataclassâ€™s <code>&#39;field(default_factory=&lt;function&gt;)&#39;</code>.</strong></li>
</ul>
<h4 id="Nonlocal"><a href="#Nonlocal" class="headerlink" title="Nonlocal"></a>Nonlocal</h4><p><strong>If variable is being assigned to anywhere in the scope, it is regarded as a local variable, unless it is declared as a â€˜globalâ€™ or a â€˜nonlocalâ€™.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_counter</span><span class="params">()</span>:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = get_counter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter(), counter(), counter()</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Decorator"><a href="#Decorator" class="headerlink" title="Decorator"></a>Decorator</h3><hr>
<p><strong>A decorator takes a function, adds some functionality and returns it.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@decorator_name</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function_that_gets_passed_to_decorator</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h4 id="Debugger-Example"><a href="#Debugger-Example" class="headerlink" title="Debugger Example"></a>Debugger Example</h4><p><strong>Decorator that prints functionâ€™s name every time it gets called.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(func.__name__)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="meta">@debug</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Wraps is a helper decorator that copies metadata of function add() to function out().</strong></li>
<li><strong>Without it <code>&#39;add.__name__&#39;</code> would return <code>&#39;out&#39;</code>.</strong></li>
</ul>
<h4 id="LRU-Cache"><a href="#LRU-Cache" class="headerlink" title="LRU Cache"></a>LRU Cache</h4><p><strong>Decorator that caches functionâ€™s return values. All functionâ€™s arguments must be hashable.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"></span><br><span class="line"><span class="meta">@lru_cache(maxsize=None)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> n <span class="keyword">if</span> n &lt; <span class="number">2</span> <span class="keyword">else</span> fib(n<span class="number">-2</span>) + fib(n<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Recursion depth is limited to 1000 by default. To increase it use <code>&#39;sys.setrecursionlimit(&lt;depth&gt;)&#39;</code>.</strong></li>
</ul>
<h4 id="Parametrized-Decorator"><a href="#Parametrized-Decorator" class="headerlink" title="Parametrized Decorator"></a>Parametrized Decorator</h4><p><strong>A decorator that accepts arguments and returns a normal decorator that accepts a function.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">(print_result=False)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">        @wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            result = func(*args, **kwargs)</span><br><span class="line">            print(func.__name__, result <span class="keyword">if</span> print_result <span class="keyword">else</span> <span class="string">''</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@debug(print_result=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure></p>
<h3 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">name</span>&gt;:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        class_name = self.__class__.__name__</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'<span class="subst">&#123;class_name&#125;</span>(<span class="subst">&#123;self.a!r&#125;</span>)'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self.a)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_class_name</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.__name__</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Return value of repr() should be unambiguous and of str() readable.</strong></li>
<li><strong>If only repr() is defined, it will be also used for str().</strong></li>
</ul>
<h4 id="Str-use-cases"><a href="#Str-use-cases" class="headerlink" title="Str() use cases:"></a>Str() use cases:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(&lt;el&gt;)</span><br><span class="line">print(<span class="string">f'<span class="subst">&#123;&lt;el&gt;&#125;</span>'</span>)</span><br><span class="line"><span class="keyword">raise</span> Exception(&lt;el&gt;)</span><br><span class="line">logging.debug(&lt;el&gt;)</span><br><span class="line">csv.writer(&lt;file&gt;).writerow([&lt;el&gt;])</span><br></pre></td></tr></table></figure>
<h4 id="Repr-use-cases"><a href="#Repr-use-cases" class="headerlink" title="Repr() use cases:"></a>Repr() use cases:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print([&lt;el&gt;])</span><br><span class="line">print(<span class="string">f'<span class="subst">&#123;&lt;el&gt;!r&#125;</span>'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&lt;el&gt;</span><br><span class="line">loguru.logger.exception()</span><br><span class="line">Z = dataclasses.make_dataclass(<span class="string">'Z'</span>, [<span class="string">'a'</span>]); print(Z(&lt;el&gt;))</span><br></pre></td></tr></table></figure>
<h4 id="Constructor-Overloading"><a href="#Constructor-Overloading" class="headerlink" title="Constructor Overloading"></a>Constructor Overloading</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">name</span>&gt;:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a=None)</span>:</span></span><br><span class="line">        self.a = a</span><br></pre></td></tr></table></figure>
<h4 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age  = age</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span><span class="params">(Person)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, staff_num)</span>:</span></span><br><span class="line">        super().__init__(name, age)</span><br><span class="line">        self.staff_num = staff_num</span><br></pre></td></tr></table></figure>
<h4 id="Multiple-Inheritance"><a href="#Multiple-Inheritance" class="headerlink" title="Multiple Inheritance"></a>Multiple Inheritance</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span> <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span> <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A, B)</span>:</span> <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><strong>MRO determines the order in which parent classes are traversed when searching for a method:</strong><br><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>C.mro()</span><br><span class="line">[&lt;class 'C'&gt;, &lt;class 'A'&gt;, &lt;class 'B'&gt;, &lt;class 'object'&gt;]</span><br></pre></td></tr></table></figure></p>
<h4 id="Property"><a href="#Property" class="headerlink" title="Property"></a>Property</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._a</span><br><span class="line"></span><br><span class="line"><span class="meta">    @a.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self._a = value</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>el = MyClass()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>el.a = <span class="number">123</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>el.a</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure>
<h4 id="Dataclass"><a href="#Dataclass" class="headerlink" title="Dataclass"></a>Dataclass</h4><p><strong>Decorator that automatically generates init(), repr() and eq() special methods.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, field</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass(order=False, frozen=False)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">class_name</span>&gt;:</span></span><br><span class="line">    &lt;attr_name_1&gt;: &lt;type&gt;</span><br><span class="line">    &lt;attr_name_2&gt;: &lt;type&gt; = &lt;default_value&gt;</span><br><span class="line">    &lt;attr_name_3&gt;: list/dict/set = field(default_factory=list/dict/set)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>An object can be made sortable with <code>&#39;order=True&#39;</code> or immutable with <code>&#39;frozen=True&#39;</code>.</strong></li>
<li><strong>Function field() is needed because <code>&#39;&lt;attr_name&gt;: list = []&#39;</code> would make a list that is shared among all instances.</strong></li>
<li><strong>Default_factory can be any callable.</strong></li>
</ul>
<h4 id="Slots"><a href="#Slots" class="headerlink" title="Slots"></a>Slots</h4><p><strong>Mechanism that restricts objects to attributes listed in â€˜slotsâ€™ and significantly reduces their memory footprint.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClassWithSlots</span>:</span></span><br><span class="line">    __slots__ = [<span class="string">'a'</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.a = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="Copy"><a href="#Copy" class="headerlink" title="Copy"></a>Copy</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> copy, deepcopy</span><br><span class="line">&lt;object&gt; = copy(&lt;object&gt;)</span><br><span class="line">&lt;object&gt; = deepcopy(&lt;object&gt;)</span><br></pre></td></tr></table></figure>
<h3 id="Duck-Types"><a href="#Duck-Types" class="headerlink" title="Duck Types"></a>Duck Types</h3><hr>
<p><strong>A duck type is an implicit type that prescribes a set of special methods. Any object that has those methods defined is considered a member of that duck type.</strong></p>
<h4 id="Comparable"><a href="#Comparable" class="headerlink" title="Comparable"></a>Comparable</h4><ul>
<li><strong>If eq() method is not overridden, it returns <code>&#39;id(self) == id(other)&#39;</code>, which is the same as <code>&#39;self is other&#39;</code>.</strong></li>
<li><strong>That means all objects compare not equal by default.</strong></li>
<li><strong>Only left side object has eq() method called, unless it returns â€˜NotImplementedâ€™, in which case the right object is consulted.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComparable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(other, type(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a == other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br></pre></td></tr></table></figure>
<h4 id="Hashable"><a href="#Hashable" class="headerlink" title="Hashable"></a>Hashable</h4><ul>
<li><strong>Hashable object needs both hash() and eq() methods and its hash value should never change.</strong></li>
<li><strong>Hashable objects that compare equal must have the same hash value, meaning default hash() that returns <code>&#39;id(self)&#39;</code> will not do.</strong></li>
<li><strong>That is why Python automatically makes classes unhashable if you only implement eq().</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHashable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self._a = copy.deepcopy(a)</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(other, type(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a == other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> hash(self.a)</span><br></pre></td></tr></table></figure>
<h4 id="Sortable"><a href="#Sortable" class="headerlink" title="Sortable"></a>Sortable</h4><ul>
<li><strong>With â€˜total_orderingâ€™ decorator you only need to provide eq() and one of lt(), gt(), le() or ge() special methods.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> total_ordering</span><br><span class="line"></span><br><span class="line"><span class="meta">@total_ordering</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySortable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(other, type(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a == other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(other, type(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a &lt; other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Iterator-1"><a href="#Iterator-1" class="headerlink" title="Iterator"></a>Iterator</h4><ul>
<li><strong>Next() should return next item or raise â€˜StopIterationâ€™.</strong></li>
<li><strong>Iter() should return â€˜selfâ€™.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.i = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.i</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = Counter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(counter), next(counter), next(counter)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.i = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.i</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = Counter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter(), counter(), counter()</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Context-Manager"><a href="#Context-Manager" class="headerlink" title="Context Manager"></a>Context Manager</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOpen</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">        self.filename = filename</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.file = open(self.filename)</span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, *args)</span>:</span></span><br><span class="line">        self.file.close()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> open(<span class="string">'test.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> file:</span><br><span class="line"><span class="meta">... </span>    file.write(<span class="string">'Hello World!'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> MyOpen(<span class="string">'test.txt'</span>) <span class="keyword">as</span> file:</span><br><span class="line"><span class="meta">... </span>    print(file.read())</span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure>
<h4 id="List-of-existing-context-managers"><a href="#List-of-existing-context-managers" class="headerlink" title="List of existing context managers:"></a>List of existing context managers:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'&lt;path&gt;'</span>, ...) <span class="keyword">as</span> file: ...</span><br><span class="line"><span class="keyword">with</span> wave.open(<span class="string">'&lt;path&gt;'</span>, ...) <span class="keyword">as</span> wave_file: ...</span><br><span class="line"><span class="keyword">with</span> memoryview(&lt;bytes/bytearray/array&gt;) <span class="keyword">as</span> view: ...</span><br><span class="line">db = sqlite3.connect(<span class="string">'&lt;path&gt;'</span>); <span class="keyword">with</span> db: db.execute(<span class="string">'&lt;insert_query&gt;'</span>)</span><br><span class="line">lock = threading.RLock(); <span class="keyword">with</span> lock: ...</span><br></pre></td></tr></table></figure>
<h3 id="Iterable-Duck-Types"><a href="#Iterable-Duck-Types" class="headerlink" title="Iterable Duck Types"></a>Iterable Duck Types</h3><hr>
<h4 id="Iterable"><a href="#Iterable" class="headerlink" title="Iterable"></a>Iterable</h4><ul>
<li><strong>Only required method is iter(). It should return an iterator of objectâ€™s items.</strong></li>
<li><strong>Contains() automatically works on any object that has iter() defined.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyIterable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> el <span class="keyword">in</span> self.a:</span><br><span class="line">            <span class="keyword">yield</span> el</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = MyIterable([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iter(a)</span><br><span class="line">&lt;generator object MyIterable.__iter__ at <span class="number">0x1026c18b8</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> <span class="keyword">in</span> a</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h4 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h4><ul>
<li><strong>Only required methods are iter() and len().</strong></li>
<li><strong>This cheatsheet actually means <code>&#39;&lt;iterable&gt;&#39;</code> when it uses <code>&#39;&lt;collection&gt;&#39;</code>.</strong></li>
<li><strong>I chose not to use the name â€˜iterableâ€™ because it sounds scarier and more vague than â€˜collectionâ€™.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCollection</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> el <span class="keyword">in</span> self.a:</span><br><span class="line">            <span class="keyword">yield</span> el</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, el)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> el <span class="keyword">in</span> self.a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.a)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Sequence"><a href="#Sequence" class="headerlink" title="Sequence"></a>Sequence</h4><ul>
<li><strong>Only required methods are len() and getitem(), that should return an item at index or raise â€˜IndexErrorâ€™.</strong></li>
<li><strong>Iter() and contains() automatically work on any object that has getitem() defined.</strong></li>
<li><strong>Reversed() automatically works on any object that has getitem() and len() defined.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySequence</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> el <span class="keyword">in</span> self.a:</span><br><span class="line">            <span class="keyword">yield</span> el</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, el)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> el <span class="keyword">in</span> self.a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.a)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.a[i]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reversed__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> reversed(self.a)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Collections-abc-Sequence"><a href="#Collections-abc-Sequence" class="headerlink" title="Collections.abc.Sequence"></a>Collections.abc.Sequence</h4><ul>
<li><strong>Itâ€™s a richer interface than the basic sequence.</strong></li>
<li><strong>Extending it generates iter(), contains(), reversed(), index(), and count().</strong></li>
<li><strong>Unlike <code>&#39;abc.Iterable&#39;</code> and <code>&#39;abc.Collection&#39;</code>, it is not a duck type. That is why <code>&#39;issubclass(MySequence, collections.abc.Sequence)&#39;</code> would return â€˜Falseâ€™ even if it had all the methods defined.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyAbcSequence</span><span class="params">(collections.abc.Sequence)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.a)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.a[i]</span><br></pre></td></tr></table></figure>
<h4 id="Table-of-required-and-available-special-methods"><a href="#Table-of-required-and-available-special-methods" class="headerlink" title="Table of required and available special methods:"></a>Table of required and available special methods:</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+------------+----------+------------+----------+--------------+</span><br><span class="line">|            | Iterable | Collection | Sequence | abc.Sequence |</span><br><span class="line">+------------+----------+------------+----------+--------------+</span><br><span class="line">| iter()     |   REQ    |    REQ     |   yes    |     yes      |</span><br><span class="line">| contains() |   yes    |    yes     |   yes    |     yes      |</span><br><span class="line">| len()      |          |    REQ     |   REQ    |     REQ      |</span><br><span class="line">| getitem()  |          |            |   REQ    |     REQ      |</span><br><span class="line">| reversed() |          |            |   yes    |     yes      |</span><br><span class="line">| index()    |          |            |          |     yes      |</span><br><span class="line">| count()    |          |            |          |     yes      |</span><br><span class="line">+------------+----------+------------+----------+--------------+</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Other useful ABCs that automatically generate missing methods are: MutableSequence, Set, MutableSet, Mapping and MutableMapping.</strong></li>
</ul>
<h3 id="Enum"><a href="#Enum" class="headerlink" title="Enum"></a>Enum</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum, auto</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">enum_name</span>&gt;<span class="params">(Enum)</span>:</span></span><br><span class="line">    &lt;member_name_1&gt; = &lt;value_1&gt;</span><br><span class="line">    &lt;member_name_2&gt; = &lt;value_2_a&gt;, &lt;value_2_b&gt;</span><br><span class="line">    &lt;member_name_3&gt; = auto()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_member_names</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> [a.name <span class="keyword">for</span> a <span class="keyword">in</span> cls.__members__.values()]</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If there are no numeric values before auto(), it returns 1.</strong></li>
<li><strong>Otherwise it returns an increment of last numeric value.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;member&gt; = &lt;enum&gt;.&lt;member_name&gt;</span><br><span class="line">&lt;member&gt; = &lt;enum&gt;[<span class="string">'&lt;member_name&gt;'</span>]</span><br><span class="line">&lt;member&gt; = &lt;enum&gt;(&lt;value&gt;)</span><br><span class="line">name     = &lt;member&gt;.name</span><br><span class="line">value    = &lt;member&gt;.value</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">list_of_members = list(&lt;enum&gt;)</span><br><span class="line">member_names    = [a.name <span class="keyword">for</span> a <span class="keyword">in</span> &lt;enum&gt;]</span><br><span class="line">member_values   = [a.value <span class="keyword">for</span> a <span class="keyword">in</span> &lt;enum&gt;]</span><br><span class="line">random_member   = random.choice(list(&lt;enum&gt;))</span><br></pre></td></tr></table></figure>
<h3 id="Inline-1"><a href="#Inline-1" class="headerlink" title="Inline"></a>Inline</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Cutlery = Enum(<span class="string">'Cutlery'</span>, [<span class="string">'fork'</span>, <span class="string">'knife'</span>, <span class="string">'spoon'</span>])</span><br><span class="line">Cutlery = Enum(<span class="string">'Cutlery'</span>, <span class="string">'fork knife spoon'</span>)</span><br><span class="line">Cutlery = Enum(<span class="string">'Cutlery'</span>, &#123;<span class="string">'fork'</span>: <span class="number">1</span>, <span class="string">'knife'</span>: <span class="number">2</span>, <span class="string">'spoon'</span>: <span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="Functions-can-not-be-values-so-they-must-be-wrapped"><a href="#Functions-can-not-be-values-so-they-must-be-wrapped" class="headerlink" title="Functions can not be values, so they must be wrapped:"></a>Functions can not be values, so they must be wrapped:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line">LogicOp = Enum(<span class="string">'LogicOp'</span>, &#123;<span class="string">'AND'</span>: partial(<span class="keyword">lambda</span> l, r: l <span class="keyword">and</span> r),</span><br><span class="line">                           <span class="string">'OR'</span> : partial(<span class="keyword">lambda</span> l, r: l <span class="keyword">or</span> r)&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Another solution in this particular case, is to use <code>&#39;and_&#39;</code> and <code>&#39;or_&#39;</code> functions from module <a href="#operator">Operator</a>.</strong></li>
</ul>
<h3 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h3><hr>
<h4 id="Basic-Example"><a href="#Basic-Example" class="headerlink" title="Basic Example"></a>Basic Example</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    &lt;code&gt;</span><br><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line">    &lt;code&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Complex-Example"><a href="#Complex-Example" class="headerlink" title="Complex Example"></a>Complex Example</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    &lt;code_1&gt;</span><br><span class="line"><span class="keyword">except</span> &lt;exception_a&gt;:</span><br><span class="line">    &lt;code_2_a&gt;</span><br><span class="line"><span class="keyword">except</span> &lt;exception_b&gt;:</span><br><span class="line">    &lt;code_2_b&gt;</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    &lt;code_2_c&gt;</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    &lt;code_3&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Catching-Exceptions"><a href="#Catching-Exceptions" class="headerlink" title="Catching Exceptions"></a>Catching Exceptions</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line"><span class="keyword">except</span> &lt;exception&gt; <span class="keyword">as</span> &lt;name&gt;:</span><br><span class="line"><span class="keyword">except</span> (&lt;exception_1&gt;, &lt;exception_2&gt;, ...):</span><br><span class="line"><span class="keyword">except</span> (&lt;exception_1&gt;, &lt;exception_2&gt;, ...) <span class="keyword">as</span> &lt;name&gt;:</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Also catches subclasses of the exception.</strong></li>
</ul>
<h4 id="Raising-Exceptions"><a href="#Raising-Exceptions" class="headerlink" title="Raising Exceptions"></a>Raising Exceptions</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">raise</span> &lt;exception&gt;</span><br><span class="line"><span class="keyword">raise</span> &lt;exception&gt;()</span><br><span class="line"><span class="keyword">raise</span> &lt;exception&gt;(&lt;el&gt;)</span><br><span class="line"><span class="keyword">raise</span> &lt;exception&gt;(&lt;el_1&gt;, &lt;el_2&gt;, ...)</span><br></pre></td></tr></table></figure>
<h4 id="Useful-built-in-exceptions"><a href="#Useful-built-in-exceptions" class="headerlink" title="Useful built-in exceptions:"></a>Useful built-in exceptions:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">raise</span> ValueError(<span class="string">'Argument is of right type but inappropriate value!'</span>)</span><br><span class="line"><span class="keyword">raise</span> TypeError(<span class="string">'Argument is of wrong type!'</span>)</span><br><span class="line"><span class="keyword">raise</span> RuntimeError(<span class="string">'None of above!'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Re-raising-caught-exception"><a href="#Re-raising-caught-exception" class="headerlink" title="Re-raising caught exception:"></a>Re-raising caught exception:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line">    &lt;code&gt;</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>
<h4 id="Common-Built-in-Exceptions"><a href="#Common-Built-in-Exceptions" class="headerlink" title="Common Built-in Exceptions"></a>Common Built-in Exceptions</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">BaseException</span><br><span class="line"> +-- SystemExit                   # Raised by the sys.exit() function.</span><br><span class="line"> +-- KeyboardInterrupt            # Raised when the user hits the interrupt key.</span><br><span class="line"> +-- Exception                    # User-defined exceptions should be derived from this class.</span><br><span class="line">      +-- StopIteration           # Raised by next() when run on an empty iterator.</span><br><span class="line">      +-- ArithmeticError         # Base class for arithmetic errors.</span><br><span class="line">      |    +-- ZeroDivisionError  # Raised when dividing by zero.</span><br><span class="line">      +-- AttributeError          # Raised when an attribute is missing.</span><br><span class="line">      +-- EOFError                # Raised by input() when it hits end-of-file condition.</span><br><span class="line">      +-- LookupError             # Raised when a look-up on sequence or dict fails.</span><br><span class="line">      |    +-- IndexError         # Raised when a sequence index is out of range.</span><br><span class="line">      |    +-- KeyError           # Raised when a dictionary key is not found.</span><br><span class="line">      +-- NameError               # Raised when a variable name is not found.</span><br><span class="line">      +-- OSError                 # Failures such as â€œfile not foundâ€ or â€œdisk fullâ€.</span><br><span class="line">      |    +-- FileNotFoundError  # When a file or directory is requested but doesn&#39;t exist.</span><br><span class="line">      +-- RuntimeError            # Raised by errors that don&#39;t fall in other categories.</span><br><span class="line">      |    +-- RecursionError     # Raised when the the maximum recursion depth is exceeded.</span><br><span class="line">      +-- TypeError               # Raised when an argument is of wrong type.</span><br><span class="line">      +-- ValueError              # When an argument is of right type but inappropriate value.</span><br><span class="line">           +-- UnicodeError       # Raised when encoding&#x2F;decoding strings from&#x2F;to bytes fails.</span><br></pre></td></tr></table></figure>
<h4 id="User-defined-Exceptions"><a href="#User-defined-Exceptions" class="headerlink" title="User-defined Exceptions"></a>User-defined Exceptions</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyError</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInputError</span><span class="params">(MyError)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="Print"><a href="#Print" class="headerlink" title="Print"></a>Print</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(&lt;el_1&gt;, ..., sep=<span class="string">' '</span>, end=<span class="string">'\n'</span>, file=sys.stdout, flush=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Use <code>&#39;file=sys.stderr&#39;</code> for errors.</strong></li>
<li><strong>Use <code>&#39;flush=True&#39;</code> to forcibly flush the stream.</strong></li>
</ul>
<h4 id="Pretty-Print"><a href="#Pretty-Print" class="headerlink" title="Pretty Print"></a>Pretty Print</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pprint(dir())</span><br><span class="line">[<span class="string">'__annotations__'</span>,</span><br><span class="line"> <span class="string">'__builtins__'</span>,</span><br><span class="line"> <span class="string">'__doc__'</span>, ...]</span><br></pre></td></tr></table></figure>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><hr>
<ul>
<li><strong>Reads a line from user input or pipe if present.</strong></li>
<li><strong>Trailing newline gets stripped.</strong></li>
<li><strong>Prompt string is printed to the standard output before reading input.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt; = input(prompt=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Prints-lines-until-EOF"><a href="#Prints-lines-until-EOF" class="headerlink" title="Prints lines until EOF:"></a>Prints lines until EOF:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(input())</span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h3 id="Command-Line-Arguments"><a href="#Command-Line-Arguments" class="headerlink" title="Command Line Arguments"></a>Command Line Arguments</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">script_name = sys.argv[<span class="number">0</span>]</span><br><span class="line">arguments   = sys.argv[<span class="number">1</span>:]</span><br></pre></td></tr></table></figure>
<h4 id="Argparse"><a href="#Argparse" class="headerlink" title="Argparse"></a>Argparse</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> argparse <span class="keyword">import</span> ArgumentParser, FileType</span><br><span class="line">p = ArgumentParser(description=&lt;str&gt;)</span><br><span class="line">p.add_argument(<span class="string">'-&lt;short_name&gt;'</span>, <span class="string">'--&lt;name&gt;'</span>, action=<span class="string">'store_true'</span>)  <span class="comment"># Flag</span></span><br><span class="line">p.add_argument(<span class="string">'-&lt;short_name&gt;'</span>, <span class="string">'--&lt;name&gt;'</span>, type=&lt;type&gt;)          <span class="comment"># Option</span></span><br><span class="line">p.add_argument(<span class="string">'&lt;name&gt;'</span>, type=&lt;type&gt;, nargs=<span class="number">1</span>)                    <span class="comment"># Argument</span></span><br><span class="line">p.add_argument(<span class="string">'&lt;name&gt;'</span>, type=&lt;type&gt;, nargs=<span class="string">'+'</span>)                  <span class="comment"># Arguments</span></span><br><span class="line">args  = p.parse_args()</span><br><span class="line">value = args.&lt;name&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Use <code>&#39;help=&lt;str&gt;&#39;</code> for argument description.</strong></li>
<li><strong>Use <code>&#39;type=FileType(&lt;mode&gt;)&#39;</code> for files.</strong></li>
</ul>
<h3 id="Open"><a href="#Open" class="headerlink" title="Open"></a>Open</h3><hr>
<p><strong>Opens a file and returns a corresponding file object.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;file&gt; = open(<span class="string">'&lt;path&gt;'</span>, mode=<span class="string">'r'</span>, encoding=<span class="literal">None</span>, newline=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>&#39;encoding=None&#39;</code> means default encoding is used, which is platform dependent. Best practice is to use <code>&#39;encoding=&quot;utf-8&quot;&#39;</code> whenever possible.</strong></li>
<li><strong><code>&#39;newline=None&#39;</code> means all different end of line combinations are converted to â€˜\nâ€™ on read, while on write all â€˜\nâ€™ characters are converted to systemâ€™s default line separator.</strong></li>
<li><strong><code>&#39;newline=&quot;&quot;&#39;</code> means no conversions take place, but lines are still broken by readline() on either â€˜\nâ€™, â€˜\râ€™ or â€˜\r\nâ€™.</strong></li>
</ul>
<h4 id="Modes"><a href="#Modes" class="headerlink" title="Modes"></a>Modes</h4><ul>
<li><strong><code>&#39;r&#39;</code>  - Read (default).</strong></li>
<li><strong><code>&#39;w&#39;</code>  - Write (truncate).</strong></li>
<li><strong><code>&#39;x&#39;</code>  - Write or fail if the file already exists.</strong></li>
<li><strong><code>&#39;a&#39;</code>  - Append.</strong></li>
<li><strong><code>&#39;w+&#39;</code> - Read and write (truncate).</strong></li>
<li><strong><code>&#39;r+&#39;</code> - Read and write from the start.</strong></li>
<li><strong><code>&#39;a+&#39;</code> - Read and write from the end.</strong></li>
<li><strong><code>&#39;t&#39;</code>  - Text mode (default).</strong></li>
<li><strong><code>&#39;b&#39;</code>  - Binary mode.</strong></li>
</ul>
<h4 id="Exceptions-1"><a href="#Exceptions-1" class="headerlink" title="Exceptions"></a>Exceptions</h4><ul>
<li><strong><code>&#39;FileNotFoundError&#39;</code> can be risen when reading with <code>&#39;r&#39;</code> or <code>&#39;r+&#39;</code>.</strong>  </li>
<li><strong><code>&#39;FileExistsError&#39;</code> can be risen when writing with <code>&#39;x&#39;</code>.</strong></li>
<li><strong><code>&#39;IsADirectoryError&#39;</code> and <code>&#39;PermissionError&#39;</code> can be risen by any.</strong></li>
<li><strong><code>&#39;OSError&#39;</code> is the parent class of all listed exceptions.</strong></li>
</ul>
<h4 id="File"><a href="#File" class="headerlink" title="File"></a>File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;file&gt;.seek(<span class="number">0</span>)                      <span class="comment"># Moves to the start of the file.</span></span><br><span class="line">&lt;file&gt;.seek(offset)                 <span class="comment"># Moves 'offset' chars/bytes from the start.</span></span><br><span class="line">&lt;file&gt;.seek(<span class="number">0</span>, <span class="number">2</span>)                   <span class="comment"># Moves to the end of the file.</span></span><br><span class="line">&lt;bin_file&gt;.seek(Â±offset, &lt;anchor&gt;)  <span class="comment"># Anchor: 0 start, 1 current pos., 2 end.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str/bytes&gt; = &lt;file&gt;.read(size=<span class="number">-1</span>)  <span class="comment"># Reads 'size' chars/bytes or until EOF.</span></span><br><span class="line">&lt;str/bytes&gt; = &lt;file&gt;.readline()     <span class="comment"># Returns a line or empty string on EOF.</span></span><br><span class="line">&lt;list&gt;      = &lt;file&gt;.readlines()    <span class="comment"># Returns a list of lines or empty list.</span></span><br><span class="line">&lt;str/bytes&gt; = next(&lt;file&gt;)          <span class="comment"># Returns a line using buffer. Do not mix.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;file&gt;.write(&lt;str/bytes&gt;)           <span class="comment"># Writes a string or bytes object.</span></span><br><span class="line">&lt;file&gt;.writelines(&lt;coll.&gt;)          <span class="comment"># Writes a coll. of strings or bytes objects.</span></span><br><span class="line">&lt;file&gt;.flush()                      <span class="comment"># Flushes write buffer.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Methods do not add or strip trailing newlines, even writelines().</strong></li>
</ul>
<h4 id="Read-Text-from-File"><a href="#Read-Text-from-File" class="headerlink" title="Read Text from File"></a>Read Text from File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> file.readlines()</span><br></pre></td></tr></table></figure>
<h4 id="Write-Text-to-File"><a href="#Write-Text-to-File" class="headerlink" title="Write Text to File"></a>Write Text to File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_file</span><span class="params">(filename, text)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(text)</span><br></pre></td></tr></table></figure>
<h3 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path, listdir</span><br><span class="line"><span class="keyword">from</span> glob <span class="keyword">import</span> glob</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = path.exists(<span class="string">'&lt;path&gt;'</span>)</span><br><span class="line">&lt;bool&gt; = path.isfile(<span class="string">'&lt;path&gt;'</span>)</span><br><span class="line">&lt;bool&gt; = path.isdir(<span class="string">'&lt;path&gt;'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = listdir(<span class="string">'&lt;path&gt;'</span>)         <span class="comment"># List of filenames located at 'path'. </span></span><br><span class="line">&lt;list&gt; = glob(<span class="string">'&lt;pattern&gt;'</span>)         <span class="comment"># Filenames matching the wildcard pattern.</span></span><br></pre></td></tr></table></figure>
<h4 id="Pathlib"><a href="#Pathlib" class="headerlink" title="Pathlib"></a>Pathlib</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cwd    = Path()</span><br><span class="line">&lt;Path&gt; = Path(<span class="string">'&lt;path&gt;'</span> [, <span class="string">'&lt;path&gt;'</span>, &lt;Path&gt;, ...])</span><br><span class="line">&lt;Path&gt; = &lt;Path&gt; / <span class="string">'&lt;dir&gt;'</span> / <span class="string">'&lt;file&gt;'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = &lt;Path&gt;.exists()</span><br><span class="line">&lt;bool&gt; = &lt;Path&gt;.is_file()</span><br><span class="line">&lt;bool&gt; = &lt;Path&gt;.is_dir()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = &lt;Path&gt;.iterdir()          <span class="comment"># Iterator of filenames located at path.</span></span><br><span class="line">&lt;iter&gt; = &lt;Path&gt;.glob(<span class="string">'&lt;pattern&gt;'</span>)  <span class="comment"># Filenames matching the wildcard pattern.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = str(&lt;Path&gt;)               <span class="comment"># Returns path as a string.</span></span><br><span class="line">&lt;tup.&gt; = &lt;Path&gt;.parts              <span class="comment"># Returns all components as strings.</span></span><br><span class="line">&lt;Path&gt; = &lt;Path&gt;.resolve()          <span class="comment"># Returns absolute Path without symlinks.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = &lt;Path&gt;.name               <span class="comment"># Final component.</span></span><br><span class="line">&lt;str&gt;  = &lt;Path&gt;.stem               <span class="comment"># Final component without extension.</span></span><br><span class="line">&lt;str&gt;  = &lt;Path&gt;.suffix             <span class="comment"># Final component's extension.</span></span><br><span class="line">&lt;Path&gt; = &lt;Path&gt;.parent             <span class="comment"># Path without final component.</span></span><br></pre></td></tr></table></figure>
<h3 id="Command-Execution"><a href="#Command-Execution" class="headerlink" title="Command Execution"></a>Command Execution</h3><hr>
<h4 id="Files-and-Directories-Commands"><a href="#Files-and-Directories-Commands" class="headerlink" title="Files and Directories Commands"></a>Files and Directories Commands</h4><ul>
<li><strong>Paths can be either strings or Path objects.</strong></li>
<li><strong>All exceptions are either â€˜OSErrorâ€™ or its subclasses.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.chdir(&lt;path&gt;)                  <span class="comment"># Changes the current working directory.</span></span><br><span class="line">&lt;str&gt; = os.getcwd()               <span class="comment"># Returns current working directory.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.remove(&lt;path&gt;)                 <span class="comment"># Deletes the file.</span></span><br><span class="line">os.rmdir(&lt;path&gt;)                  <span class="comment"># Deletes empty directory.</span></span><br><span class="line">shutil.rmtree(&lt;path&gt;)             <span class="comment"># Deletes an entire directory tree.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.rename(<span class="keyword">from</span>, to)               <span class="comment"># Renames the file or directory.</span></span><br><span class="line">os.replace(<span class="keyword">from</span>, to)              <span class="comment"># Same, but overwrites 'to' if it exists.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.mkdir(&lt;path&gt;, mode=<span class="number">0o777</span>)      <span class="comment"># Creates a directory.</span></span><br><span class="line">&lt;iter&gt; = os.scandir(path=<span class="string">'.'</span>)     <span class="comment"># Returns os.DirEntry objects located at path.</span></span><br></pre></td></tr></table></figure>
<h4 id="DirEntry"><a href="#DirEntry" class="headerlink" title="DirEntry:"></a>DirEntry:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = &lt;DirEntry&gt;.name          <span class="comment"># Final component of the path.</span></span><br><span class="line">&lt;str&gt;  = &lt;DirEntry&gt;.path          <span class="comment"># Path with final component.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = &lt;DirEntry&gt;.is_file()</span><br><span class="line">&lt;bool&gt; = &lt;DirEntry&gt;.is_dir()</span><br><span class="line">&lt;bool&gt; = &lt;DirEntry&gt;.is_symlink()</span><br><span class="line">&lt;Path&gt; = Path(&lt;DirEntry&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Shell-Commands"><a href="#Shell-Commands" class="headerlink" title="Shell Commands"></a>Shell Commands</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">&lt;str&gt; = os.popen(<span class="string">'&lt;shell_command&gt;'</span>).read()</span><br></pre></td></tr></table></figure>
<h4 id="Using-subprocess"><a href="#Using-subprocess" class="headerlink" title="Using subprocess:"></a>Using subprocess:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> subprocess, shlex</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = subprocess.run(shlex.split(<span class="string">'ls -a'</span>), stdout=subprocess.PIPE)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.stdout</span><br><span class="line"><span class="string">b'.\n..\nfile1.txt\nfile2.txt\n'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.returncode</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>
<h3 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line">&lt;reader&gt; = csv.reader(&lt;file&gt;, dialect=<span class="string">'excel'</span>, delimiter=<span class="string">','</span>)</span><br><span class="line">&lt;list&gt;   = next(&lt;reader&gt;)  <span class="comment"># Returns a row as list of strings.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;writer&gt; = csv.writer(&lt;file&gt;, dialect=<span class="string">'excel'</span>, delimiter=<span class="string">','</span>)</span><br><span class="line">&lt;writer&gt;.writerow(&lt;collection&gt;)</span><br><span class="line">&lt;writer&gt;.writerows(&lt;coll_of_coll&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h4><ul>
<li><strong><code>&#39;dialect&#39;</code> - Master parameter that sets the default values.</strong></li>
<li><strong><code>&#39;delimiter&#39;</code> - A one-character string used to separate fields.</strong></li>
<li><strong><code>&#39;quotechar&#39;</code> - Character for quoting fields that contain special characters.</strong></li>
<li><strong><code>&#39;doublequote&#39;</code> - Whether quotechars inside fields get doubled or escaped.</strong></li>
<li><strong><code>&#39;skipinitialspace&#39;</code> - Whether whitespace after delimiter gets stripped.</strong></li>
<li><strong><code>&#39;lineterminator&#39;</code> - How does writer terminate lines.</strong></li>
<li><strong><code>&#39;quoting&#39;</code> - Controls the amount of quoting: 0 - as necessary, 1 - all.</strong></li>
<li><strong><code>&#39;escapechar&#39;</code> - Character for escaping quotechar if doublequote is false.</strong></li>
</ul>
<h4 id="Dialects"><a href="#Dialects" class="headerlink" title="Dialects"></a>Dialects</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+------------------+-----------+-----------+--------------+</span><br><span class="line">|                  |   excel   | excel_tab | unix_dialect |</span><br><span class="line">+------------------+-----------+-----------+--------------+</span><br><span class="line">| delimiter        |      &#39;,&#39;  |     &#39;\t&#39;  |       &#39;,&#39;    |</span><br><span class="line">| quotechar        |      &#39;&quot;&#39;  |      &#39;&quot;&#39;  |       &#39;&quot;&#39;    |</span><br><span class="line">| doublequote      |     True  |     True  |      True    |</span><br><span class="line">| skipinitialspace |    False  |    False  |     False    |</span><br><span class="line">| lineterminator   |   &#39;\r\n&#39;  |   &#39;\r\n&#39;  |      &#39;\n&#39;    |</span><br><span class="line">| quoting          |        0  |        0  |         1    |</span><br><span class="line">| escapechar       |     None  |     None  |      None    |</span><br><span class="line">+------------------+-----------+-----------+--------------+</span><br></pre></td></tr></table></figure>
<h4 id="Read-Rows-from-CSV-File"><a href="#Read-Rows-from-CSV-File" class="headerlink" title="Read Rows from CSV File"></a>Read Rows from CSV File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_csv_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, encoding=<span class="string">'utf-8'</span>, newline=<span class="string">''</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> csv.reader(file)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If <code>&#39;newline=&quot;&quot;&#39;</code> is not specified, then newlines embedded inside quoted fields will not be interpreted correctly.</strong></li>
</ul>
<h4 id="Write-Rows-to-CSV-File"><a href="#Write-Rows-to-CSV-File" class="headerlink" title="Write Rows to CSV File"></a>Write Rows to CSV File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_csv_file</span><span class="params">(filename, rows)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>, newline=<span class="string">''</span>) <span class="keyword">as</span> file:</span><br><span class="line">        writer = csv.writer(file)</span><br><span class="line">        writer.writerows(rows)</span><br></pre></td></tr></table></figure>
<h3 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">&lt;str&gt;    = json.dumps(&lt;object&gt;, ensure_ascii=<span class="literal">True</span>, indent=<span class="literal">None</span>)</span><br><span class="line">&lt;object&gt; = json.loads(&lt;str&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Read-Object-from-JSON-File"><a href="#Read-Object-from-JSON-File" class="headerlink" title="Read Object from JSON File"></a>Read Object from JSON File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_json_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> json.load(file)</span><br></pre></td></tr></table></figure>
<h4 id="Write-Object-to-JSON-File"><a href="#Write-Object-to-JSON-File" class="headerlink" title="Write Object to JSON File"></a>Write Object to JSON File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_json_file</span><span class="params">(filename, an_object)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        json.dump(an_object, file, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Pickle"><a href="#Pickle" class="headerlink" title="Pickle"></a>Pickle</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line">&lt;bytes&gt;  = pickle.dumps(&lt;object&gt;)</span><br><span class="line">&lt;object&gt; = pickle.loads(&lt;bytes&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Read-Object-from-File"><a href="#Read-Object-from-File" class="headerlink" title="Read Object from File"></a>Read Object from File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_pickle_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> pickle.load(file)</span><br></pre></td></tr></table></figure>
<h4 id="Write-Object-to-File"><a href="#Write-Object-to-File" class="headerlink" title="Write Object to File"></a>Write Object to File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_pickle_file</span><span class="params">(filename, an_object)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        pickle.dump(an_object, file)</span><br></pre></td></tr></table></figure>
<h3 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h3><hr>
<p><strong>Server-less database engine that stores each database into separate file.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line">db = sqlite3.connect(<span class="string">'&lt;path&gt;'</span>)                <span class="comment"># Also ':memory:'.</span></span><br><span class="line">...</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>New database will be created if path doesnâ€™t exist.</strong></li>
</ul>
<h4 id="Read"><a href="#Read" class="headerlink" title="Read"></a>Read</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cursor = db.execute(<span class="string">'&lt;query&gt;'</span>)</span><br><span class="line"><span class="keyword">if</span> cursor:</span><br><span class="line">    &lt;tuple&gt; = cursor.fetchone()               <span class="comment"># First row.</span></span><br><span class="line">    &lt;list&gt;  = cursor.fetchall()               <span class="comment"># Remaining rows.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Returned values can be of type str, int, float, bytes or None.</strong></li>
</ul>
<h4 id="Write"><a href="#Write" class="headerlink" title="Write"></a>Write</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">db.execute(<span class="string">'&lt;query&gt;'</span>)</span><br><span class="line">db.commit()</span><br></pre></td></tr></table></figure>
<h4 id="Placeholders"><a href="#Placeholders" class="headerlink" title="Placeholders"></a>Placeholders</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">db.execute(<span class="string">'&lt;query&gt;'</span>, &lt;list/tuple&gt;)           <span class="comment"># Replaces '?'s in query with values.</span></span><br><span class="line">db.execute(<span class="string">'&lt;query&gt;'</span>, &lt;dict/namedtuple&gt;)      <span class="comment"># Replaces ':&lt;key&gt;'s with values.</span></span><br><span class="line">db.executemany(<span class="string">'&lt;query&gt;'</span>, &lt;coll_of_above&gt;)    <span class="comment"># Runs execute() many times.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Passed values can be of type str, int, float, bytes, None, bool, datetime.date or datetime.datetme.</strong></li>
</ul>
<h4 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h4><p><strong>Has a very similar interface, with differences listed below.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install mysql-connector</span></span><br><span class="line"><span class="keyword">from</span> mysql <span class="keyword">import</span> connector</span><br><span class="line">db = connector.connect(host=&lt;str&gt;, user=&lt;str&gt;, password=&lt;str&gt;, database=&lt;str&gt;)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">cursor.execute(<span class="string">'&lt;query&gt;'</span>)                     <span class="comment"># Connector doesn't have execute method.</span></span><br><span class="line">cursor.execute(<span class="string">'&lt;query&gt;'</span>, &lt;list/tuple&gt;)       <span class="comment"># Replaces '%s's in query with values.</span></span><br><span class="line">cursor.execute(<span class="string">'&lt;query&gt;'</span>, &lt;dict/namedtuple&gt;)  <span class="comment"># Replaces '%(&lt;key&gt;)s's with values.</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Bytes"><a href="#Bytes" class="headerlink" title="Bytes"></a>Bytes</h3><hr>
<p><strong>Bytes object is an immutable sequence of single bytes. Mutable version is called â€˜bytearrayâ€™.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bytes&gt; = <span class="string">b'&lt;str&gt;'</span>                       <span class="comment"># Only accepts ASCII characters and \x00 - \xff.</span></span><br><span class="line">&lt;int&gt;   = &lt;bytes&gt;[&lt;index&gt;]               <span class="comment"># Returns int in range from 0 to 255.</span></span><br><span class="line">&lt;bytes&gt; = &lt;bytes&gt;[&lt;slice&gt;]               <span class="comment"># Returns bytes even if it has only one element.</span></span><br><span class="line">&lt;bytes&gt; = &lt;bytes&gt;.join(&lt;coll_of_bytes&gt;)  <span class="comment"># Joins elements using bytes object as separator.</span></span><br></pre></td></tr></table></figure>
<h4 id="Encode-1"><a href="#Encode-1" class="headerlink" title="Encode"></a>Encode</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bytes&gt; = &lt;str&gt;.encode(<span class="string">'utf-8'</span>)          <span class="comment"># Or: bytes(&lt;str&gt;, 'utf-8')</span></span><br><span class="line">&lt;bytes&gt; = bytes(&lt;coll_of_ints&gt;)          <span class="comment"># Ints must be in range from 0 to 255.</span></span><br><span class="line">&lt;bytes&gt; = &lt;int&gt;.to_bytes(&lt;length&gt;, byteorder=<span class="string">'big|little'</span>, signed=<span class="literal">False</span>)</span><br><span class="line">&lt;bytes&gt; = bytes.fromhex(<span class="string">'&lt;hex&gt;'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Decode-1"><a href="#Decode-1" class="headerlink" title="Decode"></a>Decode</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;   = &lt;bytes&gt;.decode(<span class="string">'utf-8'</span>)        <span class="comment"># Or: str(&lt;bytes&gt;, 'utf-8')</span></span><br><span class="line">&lt;list&gt;  = list(&lt;bytes&gt;)                  <span class="comment"># Returns ints in range from 0 to 255.</span></span><br><span class="line">&lt;int&gt;   = int.from_bytes(&lt;bytes&gt;, byteorder=<span class="string">'big|little'</span>, signed=<span class="literal">False</span>)</span><br><span class="line"><span class="string">'&lt;hex&gt;'</span> = &lt;bytes&gt;.hex()</span><br></pre></td></tr></table></figure>
<h4 id="Read-Bytes-from-File"><a href="#Read-Bytes-from-File" class="headerlink" title="Read Bytes from File"></a>Read Bytes from File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_bytes</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> file.read()</span><br></pre></td></tr></table></figure>
<h4 id="Write-Bytes-to-File"><a href="#Write-Bytes-to-File" class="headerlink" title="Write Bytes to File"></a>Write Bytes to File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_bytes</span><span class="params">(filename, bytes_obj)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(bytes_obj)</span><br></pre></td></tr></table></figure>
<h3 id="Struct"><a href="#Struct" class="headerlink" title="Struct"></a>Struct</h3><hr>
<ul>
<li><strong>Module that performs conversions between a sequence of numbers and a C struct, represented as a Python bytes object.</strong></li>
<li><strong>Machineâ€™s native type sizes and byte order are used by default.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack, unpack, iter_unpack, calcsize</span><br><span class="line">&lt;bytes&gt;  = pack(<span class="string">'&lt;format&gt;'</span>, &lt;num_1&gt; [, &lt;num_2&gt;, ...])</span><br><span class="line">&lt;tuple&gt;  = unpack(<span class="string">'&lt;format&gt;'</span>, &lt;bytes&gt;)</span><br><span class="line">&lt;tuples&gt; = iter_unpack(<span class="string">'&lt;format&gt;'</span>, &lt;bytes&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pack(<span class="string">'&gt;hhl'</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="string">b'\x00\x01\x00\x02\x00\x00\x00\x03'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>unpack(<span class="string">'&gt;hhl'</span>, <span class="string">b'\x00\x01\x00\x02\x00\x00\x00\x03'</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calcsize(<span class="string">'&gt;hhl'</span>)</span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure>
<h4 id="Format-2"><a href="#Format-2" class="headerlink" title="Format"></a>Format</h4><h5 id="For-standard-sizes-start-format-string-with"><a href="#For-standard-sizes-start-format-string-with" class="headerlink" title="For standard sizes start format string with:"></a>For standard sizes start format string with:</h5><ul>
<li><strong><code>&#39;=&#39;</code> - native byte order</strong></li>
<li><strong><code>&#39;&lt;&#39;</code> - little-endian</strong></li>
<li><strong><code>&#39;&gt;&#39;</code> - big-endian</strong></li>
</ul>
<h5 id="Integer-types-Use-capital-letter-for-unsigned-type-Standard-sizes-are-in-brackets"><a href="#Integer-types-Use-capital-letter-for-unsigned-type-Standard-sizes-are-in-brackets" class="headerlink" title="Integer types. Use capital letter for unsigned type. Standard sizes are in brackets:"></a>Integer types. Use capital letter for unsigned type. Standard sizes are in brackets:</h5><ul>
<li><strong><code>&#39;x&#39;</code> - pad byte</strong></li>
<li><strong><code>&#39;b&#39;</code> - char (1)</strong></li>
<li><strong><code>&#39;h&#39;</code> - short (2)</strong></li>
<li><strong><code>&#39;i&#39;</code> - int (4)</strong></li>
<li><strong><code>&#39;l&#39;</code> - long (4)</strong></li>
<li><strong><code>&#39;q&#39;</code> - long long (8)</strong></li>
</ul>
<h5 id="Floating-point-types"><a href="#Floating-point-types" class="headerlink" title="Floating point types:"></a>Floating point types:</h5><ul>
<li><strong><code>&#39;f&#39;</code> - float (4)</strong></li>
<li><strong><code>&#39;d&#39;</code> - double (8)</strong></li>
</ul>
<h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><hr>
<p><strong>List that can only hold numbers of predefined type. Available types and their sizes in bytes are listed above.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line">&lt;array&gt; = array(<span class="string">'&lt;typecode&gt;'</span> [, &lt;collection&gt;])</span><br></pre></td></tr></table></figure>
<h3 id="Memory-View"><a href="#Memory-View" class="headerlink" title="Memory View"></a>Memory View</h3><hr>
<p><strong>Used for accessing the internal data of an object that supports the buffer protocol.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;memoryview&gt; = memoryview(&lt;bytes&gt; / &lt;bytearray&gt; / &lt;array&gt;)</span><br><span class="line">&lt;memoryview&gt;.release()</span><br></pre></td></tr></table></figure>
<h3 id="Deque"><a href="#Deque" class="headerlink" title="Deque"></a>Deque</h3><hr>
<p><strong>A thread-safe list with efficient appends and pops from either side. Pronounced â€œdeckâ€.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line">&lt;deque&gt; = deque(&lt;collection&gt;, maxlen=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;deque&gt;.appendleft(&lt;el&gt;)</span><br><span class="line">&lt;el&gt; = &lt;deque&gt;.popleft()</span><br><span class="line">&lt;deque&gt;.extendleft(&lt;collection&gt;)            <span class="comment"># Collection gets reversed.</span></span><br><span class="line">&lt;deque&gt;.rotate(n=<span class="number">1</span>)                         <span class="comment"># Rotates elements to the right.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = deque([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], maxlen=<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.append(<span class="number">4</span>)</span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.appendleft(<span class="number">5</span>)</span><br><span class="line">[<span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.insert(<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line">IndexError: deque already at its maximum size</span><br></pre></td></tr></table></figure>
<h3 id="Threading"><a href="#Threading" class="headerlink" title="Threading"></a>Threading</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, RLock</span><br></pre></td></tr></table></figure>
<h4 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a>Thread</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">thread = Thread(target=&lt;function&gt;, args=(&lt;first_arg&gt;, ))</span><br><span class="line">thread.start()</span><br><span class="line">...</span><br><span class="line">thread.join()</span><br></pre></td></tr></table></figure>
<h4 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lock = RLock()</span><br><span class="line">lock.acquire()</span><br><span class="line">...</span><br><span class="line">lock.release()</span><br></pre></td></tr></table></figure>
<h5 id="Or"><a href="#Or" class="headerlink" title="Or:"></a>Or:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lock = RLock()</span><br><span class="line"><span class="keyword">with</span> lock:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h3 id="Introspection"><a href="#Introspection" class="headerlink" title="Introspection"></a>Introspection</h3><hr>
<p><strong>Inspecting code at runtime.</strong></p>
<h4 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = dir()      <span class="comment"># Names of variables in current scope.</span></span><br><span class="line">&lt;dict&gt; = locals()   <span class="comment"># Dict of local variables. Also vars().</span></span><br><span class="line">&lt;dict&gt; = globals()  <span class="comment"># Dict of global variables.</span></span><br></pre></td></tr></table></figure>
<h4 id="Attributes-1"><a href="#Attributes-1" class="headerlink" title="Attributes"></a>Attributes</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;dict&gt; = vars(&lt;object&gt;)</span><br><span class="line">&lt;bool&gt; = hasattr(&lt;object&gt;, <span class="string">'&lt;attr_name&gt;'</span>)</span><br><span class="line">value  = getattr(&lt;object&gt;, <span class="string">'&lt;attr_name&gt;'</span>)</span><br><span class="line">setattr(&lt;object&gt;, <span class="string">'&lt;attr_name&gt;'</span>, value)</span><br></pre></td></tr></table></figure>
<h4 id="Parameters-1"><a href="#Parameters-1" class="headerlink" title="Parameters"></a>Parameters</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> inspect <span class="keyword">import</span> signature</span><br><span class="line">&lt;sig&gt;        = signature(&lt;function&gt;)</span><br><span class="line">no_of_params = len(&lt;sig&gt;.parameters)</span><br><span class="line">param_names  = list(&lt;sig&gt;.parameters.keys())</span><br></pre></td></tr></table></figure>
<h3 id="Metaprograming"><a href="#Metaprograming" class="headerlink" title="Metaprograming"></a>Metaprograming</h3><hr>
<p><strong>Code that generates code.</strong></p>
<h4 id="Type-1"><a href="#Type-1" class="headerlink" title="Type"></a>Type</h4><p><strong>Type is the root class. If only passed an object it returns its type (class). Otherwise it creates a new class.</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;class&gt; = type(&lt;class_name&gt;, &lt;parents_tuple&gt;, &lt;attributes_dict&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Z = type(<span class="string">'Z'</span>, (), &#123;<span class="string">'a'</span>: <span class="string">'abcde'</span>, <span class="string">'b'</span>: <span class="number">12345</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>z = Z()</span><br></pre></td></tr></table></figure>
<h4 id="Meta-Class"><a href="#Meta-Class" class="headerlink" title="Meta Class"></a>Meta Class</h4><p><strong>Class that creates class.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_meta_class</span><span class="params">(name, parents, attrs)</span>:</span></span><br><span class="line">    attrs[<span class="string">'a'</span>] = <span class="string">'abcde'</span></span><br><span class="line">    <span class="keyword">return</span> type(name, parents, attrs)</span><br></pre></td></tr></table></figure>
<h5 id="Or-1"><a href="#Or-1" class="headerlink" title="Or:"></a>Or:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyMetaClass</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, name, parents, attrs)</span>:</span></span><br><span class="line">        attrs[<span class="string">'a'</span>] = <span class="string">'abcde'</span></span><br><span class="line">        <span class="keyword">return</span> type.__new__(cls, name, parents, attrs)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>New() is a class method that gets called before init(). If it returns an instance of its class, then that instance gets passed to init() as a â€˜selfâ€™ argument.</strong></li>
<li><strong>It receives the same arguments as init(), except for the first one that specifies the desired class of returned instance (</strong><code>&#39;MyMetaClass&#39;</code> <strong>in our case).</strong></li>
<li><strong>New() can also be called directly, usually from a new() method of a child class (</strong><code>def __new__(cls): return super().__new__(cls)</code><strong>), in which case init() is not called.</strong></li>
</ul>
<h4 id="Metaclass-Attribute"><a href="#Metaclass-Attribute" class="headerlink" title="Metaclass Attribute"></a>Metaclass Attribute</h4><p><strong>Right before a class is created it checks if it has metaclass defined. If not, it recursively checks if any of his parents has it defined and eventually comes to type().</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(metaclass=MyMetaClass)</span>:</span></span><br><span class="line">    b = <span class="number">12345</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>MyClass.a, MyClass.b</span><br><span class="line">(<span class="string">'abcde'</span>, <span class="number">12345</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Type-Diagram"><a href="#Type-Diagram" class="headerlink" title="Type Diagram"></a>Type Diagram</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">type(MyClass)     == MyMetaClass  <span class="comment"># MyClass is an instance of MyMetaClass.</span></span><br><span class="line">type(MyMetaClass) == type         <span class="comment"># MyMetaClass is an instance of type.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+---------+-------------+</span><br><span class="line">| Classes | Metaclasses |</span><br><span class="line">+---------+-------------|</span><br><span class="line">| MyClass &gt; MyMetaClass |</span><br><span class="line">|         |     v       |</span><br><span class="line">|  object ---&gt; type &lt;+  |</span><br><span class="line">|         |    ^ +---+  |</span><br><span class="line">|   str -------+        |</span><br><span class="line">+---------+-------------+</span><br></pre></td></tr></table></figure>
<h4 id="Inheritance-Diagram"><a href="#Inheritance-Diagram" class="headerlink" title="Inheritance Diagram"></a>Inheritance Diagram</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MyClass.__base__     == object    <span class="comment"># MyClass is a subclass of object.</span></span><br><span class="line">MyMetaClass.__base__ == type      <span class="comment"># MyMetaClass is a subclass of type.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+---------+-------------+</span><br><span class="line">| Classes | Metaclasses |</span><br><span class="line">+---------+-------------|</span><br><span class="line">| MyClass | MyMetaClass |</span><br><span class="line">|    v    |     v       |</span><br><span class="line">|  object &lt;--- type     |</span><br><span class="line">|    ^    |             |</span><br><span class="line">|   str   |             |</span><br><span class="line">+---------+-------------+</span><br></pre></td></tr></table></figure>
<h3 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> add, sub, mul, truediv, floordiv, mod, pow, neg, abs</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> eq, ne, lt, le, gt, ge</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> and_, or_, not_</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter, attrgetter, methodcaller</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> operator <span class="keyword">as</span> op</span><br><span class="line">sorted_by_second = sorted(&lt;collection&gt;, key=op.itemgetter(<span class="number">1</span>))</span><br><span class="line">sorted_by_both   = sorted(&lt;collection&gt;, key=op.itemgetter(<span class="number">1</span>, <span class="number">0</span>))</span><br><span class="line">product_of_elems = functools.reduce(op.mul, &lt;collection&gt;)</span><br><span class="line">LogicOp          = enum.Enum(<span class="string">'LogicOp'</span>, &#123;<span class="string">'AND'</span>: op.and_, <span class="string">'OR'</span> : op.or_&#125;)</span><br><span class="line">last_el          = op.methodcaller(<span class="string">'pop'</span>)(&lt;list&gt;)</span><br></pre></td></tr></table></figure>
<h3 id="Eval"><a href="#Eval" class="headerlink" title="Eval"></a>Eval</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> ast <span class="keyword">import</span> literal_eval</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>literal_eval(<span class="string">'1 + 2'</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>literal_eval(<span class="string">'[1, 2, 3]'</span>)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>literal_eval(<span class="string">'abs(1)'</span>)</span><br><span class="line">ValueError: malformed node <span class="keyword">or</span> string</span><br></pre></td></tr></table></figure>
<h3 id="Coroutine"><a href="#Coroutine" class="headerlink" title="Coroutine"></a>Coroutine</h3><hr>
<ul>
<li><strong>Similar to generator, but generator pulls data through the pipe with iteration, while coroutine pushes data into the pipeline with send().</strong></li>
<li><strong>Coroutines provide more powerful data routing possibilities than iterators.</strong></li>
<li><strong>If you build a collection of simple data processing components, you can glue them together into complex arrangements of pipes, branches, merging, etc.</strong></li>
</ul>
<h4 id="Helper-Decorator"><a href="#Helper-Decorator" class="headerlink" title="Helper Decorator"></a>Helper Decorator</h4><ul>
<li><strong>All coroutines must be â€œprimedâ€ by first calling next().</strong></li>
<li><strong>Remembering to call next() is easy to forget.</strong></li>
<li><strong>Solved by wrapping coroutines with a decorator:</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">coroutine</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        cr = func(*args, **kwargs)</span><br><span class="line">        next(cr)</span><br><span class="line">        <span class="keyword">return</span> cr</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h4 id="Pipeline-Example"><a href="#Pipeline-Example" class="headerlink" title="Pipeline Example"></a>Pipeline Example</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reader</span><span class="params">(target)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        target.send(i)</span><br><span class="line">    target.close()</span><br><span class="line"></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adder</span><span class="params">(target)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        value = (<span class="keyword">yield</span>)</span><br><span class="line">        target.send(value + <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printer</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        value = (<span class="keyword">yield</span>)</span><br><span class="line">        print(value)</span><br><span class="line"></span><br><span class="line">reader(adder(printer()))  <span class="comment"># 100, 101, ..., 109</span></span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h2 id="Libraries"><a href="#Libraries" class="headerlink" title="Libraries"></a>Libraries</h2><h3 id="Progress-Bar"><a href="#Progress-Bar" class="headerlink" title="Progress Bar"></a>Progress Bar</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install tqdm</span></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]):</span><br><span class="line">    sleep(<span class="number">0.2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">100</span>)):</span><br><span class="line">    sleep(<span class="number">0.02</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Plot"><a href="#Plot" class="headerlink" title="Plot"></a>Plot</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install matplotlib</span></span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot</span><br><span class="line">pyplot.plot(&lt;data_1&gt; [, &lt;data_2&gt;, ...])  <span class="comment"># Or: hist(&lt;data&gt;).</span></span><br><span class="line">pyplot.savefig(&lt;filename&gt;)</span><br><span class="line">pyplot.show()</span><br><span class="line">pyplot.clf()                             <span class="comment"># Clears figure.</span></span><br></pre></td></tr></table></figure>
<h3 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h3><hr>
<h4 id="Prints-a-CSV-file-as-an-ASCII-table"><a href="#Prints-a-CSV-file-as-an-ASCII-table" class="headerlink" title="Prints a CSV file as an ASCII table:"></a>Prints a CSV file as an ASCII table:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install tabulate</span></span><br><span class="line"><span class="keyword">from</span> tabulate <span class="keyword">import</span> tabulate</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(&lt;filename&gt;, encoding=<span class="string">'utf-8'</span>, newline=<span class="string">''</span>) <span class="keyword">as</span> file:</span><br><span class="line">    lines   = csv.reader(file)</span><br><span class="line">    headers = [header.title() <span class="keyword">for</span> header <span class="keyword">in</span> next(lines)]</span><br><span class="line">    table   = tabulate(lines, headers)</span><br><span class="line">    print(table)</span><br></pre></td></tr></table></figure>
<h3 id="Curses"><a href="#Curses" class="headerlink" title="Curses"></a>Curses</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> curses <span class="keyword">import</span> wrapper, ascii</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    wrapper(draw)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw</span><span class="params">(screen)</span>:</span></span><br><span class="line">    screen.clear()</span><br><span class="line">    screen.addstr(<span class="number">0</span>, <span class="number">0</span>, <span class="string">'Press ESC to quit.'</span>)</span><br><span class="line">    <span class="keyword">while</span> screen.getch() != ascii.ESC:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_border</span><span class="params">(screen)</span>:</span></span><br><span class="line">    <span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">    P = namedtuple(<span class="string">'P'</span>, <span class="string">'y x'</span>)</span><br><span class="line">    height, width = screen.getmaxyx()</span><br><span class="line">    <span class="keyword">return</span> P(height<span class="number">-1</span>, width<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h3 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install loguru</span></span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">logger.add(<span class="string">'debug_&#123;time&#125;.log'</span>, colorize=<span class="literal">True</span>)  <span class="comment"># Connects a log file.</span></span><br><span class="line">logger.add(<span class="string">'error_&#123;time&#125;.log'</span>, level=<span class="string">'ERROR'</span>)  <span class="comment"># Another file for errors or higher.</span></span><br><span class="line">logger.&lt;level&gt;(<span class="string">'A logging message.'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Levels: <code>&#39;debug&#39;</code>, <code>&#39;info&#39;</code>, <code>&#39;success&#39;</code>, <code>&#39;warning&#39;</code>, <code>&#39;error&#39;</code>, <code>&#39;critical&#39;</code>.</strong></li>
</ul>
<h4 id="Exceptions-2"><a href="#Exceptions-2" class="headerlink" title="Exceptions"></a>Exceptions</h4><p><strong>Error description, stack trace and values of variables are appended automatically.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line">    logger.exception(<span class="string">'An error happened.'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Rotation"><a href="#Rotation" class="headerlink" title="Rotation"></a>Rotation</h4><p><strong>Argument that sets a condition when a new log file is created.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rotation=&lt;int&gt;|&lt;datetime.timedelta&gt;|&lt;datetime.time&gt;|&lt;str&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong><code>&#39;&lt;int&gt;&#39;</code> - Max file size in bytes.</strong></li>
<li><strong><code>&#39;&lt;timedelta&gt;&#39;</code> - Max age of a file.</strong></li>
<li><strong><code>&#39;&lt;time&gt;&#39;</code> - Time of day.</strong></li>
<li><strong><code>&#39;&lt;str&gt;&#39;</code> - Any of above as a string: <code>&#39;100 MB&#39;</code>, <code>&#39;1 month&#39;</code>, <code>&#39;monday at 12:00&#39;</code>, â€¦</strong></li>
</ul>
<h4 id="Retention"><a href="#Retention" class="headerlink" title="Retention"></a>Retention</h4><p><strong>Sets a condition which old log files are deleted.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">retention=&lt;int&gt;|&lt;datetime.timedelta&gt;|&lt;str&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong><code>&#39;&lt;int&gt;&#39;</code> - Max number of files.</strong></li>
<li><strong><code>&#39;&lt;timedelta&gt;&#39;</code> - Max age of a file.</strong></li>
<li><strong><code>&#39;&lt;str&gt;&#39;</code> - Max age as a string: <code>&#39;1 week, 3 days&#39;</code>, <code>&#39;2 months&#39;</code>, â€¦</strong></li>
</ul>
<h3 id="Scraping"><a href="#Scraping" class="headerlink" title="Scraping"></a>Scraping</h3><hr>
<h4 id="Scrapes-and-prints-Pythonâ€™s-URL-and-version-number-from-Wikipedia"><a href="#Scrapes-and-prints-Pythonâ€™s-URL-and-version-number-from-Wikipedia" class="headerlink" title="Scrapes and prints Pythonâ€™s URL and version number from Wikipedia:"></a>Scrapes and prints Pythonâ€™s URL and version number from Wikipedia:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install requests beautifulsoup4</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">url   = <span class="string">'https://en.wikipedia.org/wiki/Python_(programming_language)'</span></span><br><span class="line">page  = requests.get(url)</span><br><span class="line">doc   = BeautifulSoup(page.text, <span class="string">'html.parser'</span>)</span><br><span class="line">table = doc.find(<span class="string">'table'</span>, class_=<span class="string">'infobox vevent'</span>)</span><br><span class="line">rows  = table.find_all(<span class="string">'tr'</span>)</span><br><span class="line">link  = rows[<span class="number">11</span>].find(<span class="string">'a'</span>)[<span class="string">'href'</span>]</span><br><span class="line">ver   = rows[<span class="number">6</span>].find(<span class="string">'div'</span>).text.split()[<span class="number">0</span>]</span><br><span class="line">print(link, ver)</span><br></pre></td></tr></table></figure>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install bottle</span></span><br><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> run, route, post, template, request, response</span><br><span class="line"><span class="keyword">import</span> json</span><br></pre></td></tr></table></figure>
<h4 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">run(host=<span class="string">'localhost'</span>, port=<span class="number">8080</span>)</span><br><span class="line">run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">80</span>, server=<span class="string">'cherrypy'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Static-Request"><a href="#Static-Request" class="headerlink" title="Static Request"></a>Static Request</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@route('/img/&lt;image&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_image</span><span class="params">(image)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> static_file(image, <span class="string">'images/'</span>, mimetype=<span class="string">'image/png'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Dynamic-Request"><a href="#Dynamic-Request" class="headerlink" title="Dynamic Request"></a>Dynamic Request</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@route('/&lt;sport&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_page</span><span class="params">(sport)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> template(<span class="string">'&lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;'</span>, title=sport)</span><br></pre></td></tr></table></figure>
<h4 id="REST-Request"><a href="#REST-Request" class="headerlink" title="REST Request"></a>REST Request</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@post('/odds/&lt;sport&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">odds_handler</span><span class="params">(sport)</span>:</span></span><br><span class="line">    team = request.forms.get(<span class="string">'team'</span>)</span><br><span class="line">    home_odds, away_odds = <span class="number">2.44</span>, <span class="number">3.29</span></span><br><span class="line">    response.headers[<span class="string">'Content-Type'</span>] = <span class="string">'application/json'</span></span><br><span class="line">    response.headers[<span class="string">'Cache-Control'</span>] = <span class="string">'no-cache'</span></span><br><span class="line">    <span class="keyword">return</span> json.dumps([team, home_odds, away_odds])</span><br></pre></td></tr></table></figure>
<h4 id="Test"><a href="#Test" class="headerlink" title="Test:"></a>Test:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install requests</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> requests</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>url  = <span class="string">'http://localhost:8080/odds/football'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = &#123;<span class="string">'team'</span>: <span class="string">'arsenal f.c.'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = requests.post(url, data=data)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.json()</span><br><span class="line">[<span class="string">'arsenal f.c.'</span>, <span class="number">2.44</span>, <span class="number">3.29</span>]</span><br></pre></td></tr></table></figure>
<h3 id="Profile"><a href="#Profile" class="headerlink" title="Profile"></a>Profile</h3><hr>
<h3 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line">start_time = time()                  <span class="comment"># Seconds since Epoch.</span></span><br><span class="line">...</span><br><span class="line">duration = time() - start_time</span><br></pre></td></tr></table></figure>
<h4 id="High-Performance"><a href="#High-Performance" class="headerlink" title="High Performance"></a>High Performance</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> perf_counter <span class="keyword">as</span> pc</span><br><span class="line">start_time = pc()                    <span class="comment"># Seconds since restart.</span></span><br><span class="line">...</span><br><span class="line">duration = pc() - start_time</span><br></pre></td></tr></table></figure>
<h4 id="Timing-a-Snippet"><a href="#Timing-a-Snippet" class="headerlink" title="Timing a Snippet"></a>Timing a Snippet</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> timeit <span class="keyword">import</span> timeit</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(<span class="string">'"-".join(str(a) for a in range(100))'</span>,</span><br><span class="line"><span class="meta">... </span>       number=<span class="number">10000</span>, globals=globals(), setup=<span class="string">'pass'</span>)</span><br><span class="line"><span class="number">0.34986</span></span><br></pre></td></tr></table></figure>
<h4 id="Line-Profiler"><a href="#Line-Profiler" class="headerlink" title="Line Profiler"></a>Line Profiler</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install line_profiler</span></span><br><span class="line"><span class="meta">@profile</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    a = [*range(<span class="number">10000</span>)]</span><br><span class="line">    b = &#123;*range(<span class="number">10000</span>)&#125;</span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<h4 id="Usage"><a href="#Usage" class="headerlink" title="Usage:"></a>Usage:</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ kernprof -lv test.py</span><br><span class="line">Line #      Hits         Time  Per Hit   % Time  Line Contents</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">     1                                           @profile</span><br><span class="line">     2                                           def main():</span><br><span class="line">     3         1       1128.0   1128.0     27.4      a &#x3D; [*range(10000)]</span><br><span class="line">     4         1       2994.0   2994.0     72.6      b &#x3D; &#123;*range(10000)&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Call-Graph"><a href="#Call-Graph" class="headerlink" title="Call Graph"></a>Call Graph</h4><h5 id="Generates-a-PNG-image-of-a-call-graph-with-highlighted-bottlenecks"><a href="#Generates-a-PNG-image-of-a-call-graph-with-highlighted-bottlenecks" class="headerlink" title="Generates a PNG image of a call graph with highlighted bottlenecks:"></a>Generates a PNG image of a call graph with highlighted bottlenecks:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install pycallgraph</span></span><br><span class="line"><span class="keyword">from</span> pycallgraph <span class="keyword">import</span> output, PyCallGraph</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">time_str = datetime.now().strftime(<span class="string">'%Y%m%d%H%M%S'</span>)</span><br><span class="line">filename = <span class="string">f'profile-<span class="subst">&#123;time_str&#125;</span>.png'</span></span><br><span class="line">drawer = output.GraphvizOutput(output_file=filename)</span><br><span class="line"><span class="keyword">with</span> PyCallGraph(drawer):</span><br><span class="line">    &lt;code_to_be_profiled&gt;</span><br></pre></td></tr></table></figure>
<h3 id="NumPy"><a href="#NumPy" class="headerlink" title="NumPy"></a>NumPy</h3><hr>
<p><strong>Array manipulation mini language. Can run up to one hundred times faster than equivalent Python code.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install numpy</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;array&gt; = np.array(&lt;list&gt;)</span><br><span class="line">&lt;array&gt; = np.arange(from_inclusive, to_exclusive, Â±step_size)</span><br><span class="line">&lt;array&gt; = np.ones(&lt;shape&gt;)</span><br><span class="line">&lt;array&gt; = np.random.randint(from_inclusive, to_exclusive, &lt;shape&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;array&gt;.shape = &lt;shape&gt;</span><br><span class="line">&lt;view&gt;  = &lt;array&gt;.reshape(&lt;shape&gt;)</span><br><span class="line">&lt;view&gt;  = np.broadcast_to(&lt;array&gt;, &lt;shape&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;array&gt; = &lt;array&gt;.sum(axis)</span><br><span class="line">indexes = &lt;array&gt;.argmin(axis)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Shape is a tuple of dimension sizes.</strong></li>
<li><strong>Axis is an index of dimension that gets collapsed. Leftmost dimension has index 0.</strong></li>
</ul>
<h4 id="Indexing"><a href="#Indexing" class="headerlink" title="Indexing"></a>Indexing</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;el&gt;       = &lt;2d_array&gt;[0, 0]        <span class="comment"># First element.</span></span><br><span class="line">&lt;1d_view&gt;  = &lt;2d_array&gt;[0]           <span class="comment"># First row.</span></span><br><span class="line">&lt;1d_view&gt;  = &lt;2d_array&gt;[:, 0]        <span class="comment"># First column. Also [..., 0].</span></span><br><span class="line">&lt;3d_view&gt;  = &lt;2d_array&gt;[None, :, :]  <span class="comment"># Expanded by dimension of size 1.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;1d_array&gt; = &lt;2d_array&gt;[&lt;1d_row_indexes&gt;, &lt;1d_column_indexes&gt;]</span><br><span class="line">&lt;2d_array&gt; = &lt;2d_array&gt;[&lt;2d_row_indexes&gt;, &lt;2d_column_indexes&gt;]</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;2d_bools&gt; = &lt;2d_array&gt; &gt; 0</span><br><span class="line">&lt;1d_array&gt; = &lt;2d_array&gt;[&lt;2d_bools&gt;]</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If row and column indexes differ in shape, they are combined with broadcasting.</strong></li>
</ul>
<h4 id="Broadcasting"><a href="#Broadcasting" class="headerlink" title="Broadcasting"></a>Broadcasting</h4><p><strong>Broadcasting is a set of rules by which NumPy functions operate on arrays of different sizes and/or dimensions.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">left  = [[<span class="number">0.1</span>], [<span class="number">0.6</span>], [<span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 1)</span></span><br><span class="line">right = [ <span class="number">0.1</span> ,  <span class="number">0.6</span> ,  <span class="number">0.8</span> ]  <span class="comment"># Shape: (3)</span></span><br></pre></td></tr></table></figure>
<h5 id="1-If-array-shapes-differ-in-length-left-pad-the-shorter-shape-with-ones"><a href="#1-If-array-shapes-differ-in-length-left-pad-the-shorter-shape-with-ones" class="headerlink" title="1. If array shapes differ in length, left-pad the shorter shape with ones:"></a>1. If array shapes differ in length, left-pad the shorter shape with ones:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">left  = [[<span class="number">0.1</span>], [<span class="number">0.6</span>], [<span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 1)</span></span><br><span class="line">right = [[<span class="number">0.1</span> ,  <span class="number">0.6</span> ,  <span class="number">0.8</span>]]  <span class="comment"># Shape: (1, 3) &lt;- !</span></span><br></pre></td></tr></table></figure>
<h5 id="2-If-any-dimensions-differ-in-size-expand-the-ones-that-have-size-1-by-duplicating-their-elements"><a href="#2-If-any-dimensions-differ-in-size-expand-the-ones-that-have-size-1-by-duplicating-their-elements" class="headerlink" title="2. If any dimensions differ in size, expand the ones that have size 1 by duplicating their elements:"></a>2. If any dimensions differ in size, expand the ones that have size 1 by duplicating their elements:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">left  = [[<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.1</span>], [<span class="number">0.6</span>, <span class="number">0.6</span>, <span class="number">0.6</span>], [<span class="number">0.8</span>, <span class="number">0.8</span>, <span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 3) &lt;- !</span></span><br><span class="line">right = [[<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>], [<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>], [<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 3) &lt;- !</span></span><br></pre></td></tr></table></figure>
<h5 id="3-If-neither-non-matching-dimension-has-size-1-rise-an-error"><a href="#3-If-neither-non-matching-dimension-has-size-1-rise-an-error" class="headerlink" title="3. If neither non-matching dimension has size 1, rise an error."></a>3. If neither non-matching dimension has size 1, rise an error.</h5><h4 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h4><h5 id="For-each-point-returns-index-of-its-nearest-point-0-1-0-6-0-8-gt-1-2-1"><a href="#For-each-point-returns-index-of-its-nearest-point-0-1-0-6-0-8-gt-1-2-1" class="headerlink" title="For each point returns index of its nearest point ([0.1, 0.6, 0.8] =&gt; [1, 2, 1]):"></a>For each point returns index of its nearest point (<code>[0.1, 0.6, 0.8] =&gt; [1, 2, 1]</code>):</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>points = np.array([<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>])</span><br><span class="line">[ <span class="number">0.1</span>,  <span class="number">0.6</span>,  <span class="number">0.8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>wrapped_points = points.reshape(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">[[ <span class="number">0.1</span>],</span><br><span class="line"> [ <span class="number">0.6</span>],</span><br><span class="line"> [ <span class="number">0.8</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances = wrapped_points - points</span><br><span class="line">[[ <span class="number">0.</span> , <span class="number">-0.5</span>, <span class="number">-0.7</span>],</span><br><span class="line"> [ <span class="number">0.5</span>,  <span class="number">0.</span> , <span class="number">-0.2</span>],</span><br><span class="line"> [ <span class="number">0.7</span>,  <span class="number">0.2</span>,  <span class="number">0.</span> ]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances = np.abs(distances)</span><br><span class="line">[[ <span class="number">0.</span> ,  <span class="number">0.5</span>,  <span class="number">0.7</span>],</span><br><span class="line"> [ <span class="number">0.5</span>,  <span class="number">0.</span> ,  <span class="number">0.2</span>],</span><br><span class="line"> [ <span class="number">0.7</span>,  <span class="number">0.2</span>,  <span class="number">0.</span> ]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>i = np.arange(<span class="number">3</span>)</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances[i, i] = np.inf</span><br><span class="line">[[ inf,  <span class="number">0.5</span>,  <span class="number">0.7</span>],</span><br><span class="line"> [ <span class="number">0.5</span>,  inf,  <span class="number">0.2</span>],</span><br><span class="line"> [ <span class="number">0.7</span>,  <span class="number">0.2</span>,  inf]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances.argmin(<span class="number">1</span>)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<h3 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install pillow</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br></pre></td></tr></table></figure>
<h4 id="Creates-a-PNG-image-of-a-rainbow-gradient"><a href="#Creates-a-PNG-image-of-a-rainbow-gradient" class="headerlink" title="Creates a PNG image of a rainbow gradient:"></a>Creates a PNG image of a rainbow gradient:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">width  = <span class="number">100</span></span><br><span class="line">height = <span class="number">100</span></span><br><span class="line">size   = width * height</span><br><span class="line">pixels = [<span class="number">255</span> * i/size <span class="keyword">for</span> i <span class="keyword">in</span> range(size)]</span><br><span class="line"></span><br><span class="line">img = Image.new(<span class="string">'HSV'</span>, (width, height))</span><br><span class="line">img.putdata([(int(a), <span class="number">255</span>, <span class="number">255</span>) <span class="keyword">for</span> a <span class="keyword">in</span> pixels])</span><br><span class="line">img.convert(mode=<span class="string">'RGB'</span>).save(<span class="string">'test.png'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Adds-noise-to-a-PNG-image"><a href="#Adds-noise-to-a-PNG-image" class="headerlink" title="Adds noise to a PNG image:"></a>Adds noise to a PNG image:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">add_noise = <span class="keyword">lambda</span> value: max(<span class="number">0</span>, min(<span class="number">255</span>, value + randint(<span class="number">-20</span>, <span class="number">20</span>)))</span><br><span class="line">img = Image.open(<span class="string">'test.png'</span>).convert(mode=<span class="string">'HSV'</span>)</span><br><span class="line">img.putdata([(add_noise(h), s, v) <span class="keyword">for</span> h, s, v <span class="keyword">in</span> img.getdata()])</span><br><span class="line">img.convert(mode=<span class="string">'RGB'</span>).save(<span class="string">'test.png'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Modes-1"><a href="#Modes-1" class="headerlink" title="Modes"></a>Modes</h4><ul>
<li><strong><code>&#39;1&#39;</code> - 1-bit pixels, black and white, stored with one pixel per byte.</strong></li>
<li><strong><code>&#39;L&#39;</code> - 8-bit pixels, greyscale.</strong></li>
<li><strong><code>&#39;RGB&#39;</code> - 3x8-bit pixels, true color.</strong></li>
<li><strong><code>&#39;RGBA&#39;</code> - 4x8-bit pixels, true color with transparency mask.</strong></li>
<li><strong><code>&#39;HSV&#39;</code> - 3x8-bit pixels, Hue, Saturation, Value color space.</strong></li>
</ul>
<h3 id="Audio"><a href="#Audio" class="headerlink" title="Audio"></a>Audio</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> wave</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack, iter_unpack</span><br></pre></td></tr></table></figure>
<h4 id="Read-Frames-from-WAV-File"><a href="#Read-Frames-from-WAV-File" class="headerlink" title="Read Frames from WAV File"></a>Read Frames from WAV File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_wav_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> wave.open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> wf:</span><br><span class="line">        frames = wf.readframes(wf.getnframes())</span><br><span class="line">        <span class="keyword">return</span> [a[<span class="number">0</span>] <span class="keyword">for</span> a <span class="keyword">in</span> iter_unpack(<span class="string">'&lt;h'</span>, frames)]</span><br></pre></td></tr></table></figure>
<h4 id="Write-Frames-to-WAV-File"><a href="#Write-Frames-to-WAV-File" class="headerlink" title="Write Frames to WAV File"></a>Write Frames to WAV File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_wav_file</span><span class="params">(filename, frames_int, mono=True)</span>:</span></span><br><span class="line">    frames_short = (pack(<span class="string">'&lt;h'</span>, a) <span class="keyword">for</span> a <span class="keyword">in</span> frames_int)</span><br><span class="line">    <span class="keyword">with</span> wave.open(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> wf:</span><br><span class="line">        wf.setnchannels(<span class="number">1</span> <span class="keyword">if</span> mono <span class="keyword">else</span> <span class="number">2</span>)</span><br><span class="line">        wf.setsampwidth(<span class="number">2</span>)</span><br><span class="line">        wf.setframerate(<span class="number">44100</span>)</span><br><span class="line">        wf.writeframes(<span class="string">b''</span>.join(frames_short))</span><br></pre></td></tr></table></figure>
<h4 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><h5 id="Saves-a-sine-wave-to-a-mono-WAV-file"><a href="#Saves-a-sine-wave-to-a-mono-WAV-file" class="headerlink" title="Saves a sine wave to a mono WAV file:"></a>Saves a sine wave to a mono WAV file:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> pi, sin</span><br><span class="line">frames_f = (sin(i * <span class="number">2</span> * pi * <span class="number">440</span> / <span class="number">44100</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100000</span>))</span><br><span class="line">frames_i = (int(a * <span class="number">30000</span>) <span class="keyword">for</span> a <span class="keyword">in</span> frames_f)</span><br><span class="line">write_to_wav_file(<span class="string">'test.wav'</span>, frames_i)</span><br></pre></td></tr></table></figure>
<h5 id="Adds-noise-to-a-mono-WAV-file"><a href="#Adds-noise-to-a-mono-WAV-file" class="headerlink" title="Adds noise to a mono WAV file:"></a>Adds noise to a mono WAV file:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">add_noise = <span class="keyword">lambda</span> value: max(<span class="number">-32768</span>, min(<span class="number">32767</span>, value + randint(<span class="number">-500</span>, <span class="number">500</span>)))</span><br><span class="line">frames_i  = (add_noise(a) <span class="keyword">for</span> a <span class="keyword">in</span> read_wav_file(<span class="string">'test.wav'</span>))</span><br><span class="line">write_to_wav_file(<span class="string">'test.wav'</span>, frames_i)</span><br></pre></td></tr></table></figure>
<h4 id="Synthesizer"><a href="#Synthesizer" class="headerlink" title="Synthesizer"></a>Synthesizer</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install simpleaudio</span></span><br><span class="line"><span class="keyword">import</span> simpleaudio, math, struct</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain, repeat</span><br><span class="line">F  = <span class="number">44100</span></span><br><span class="line">P1 = <span class="string">'71â™ª,69,,71â™ª,66,,62â™ª,66,,59â™ª,,,'</span></span><br><span class="line">P2 = <span class="string">'71â™ª,73,,74â™ª,73,,74,,71,,73â™ª,71,,73,,69,,71â™ª,69,,71,,67,,71â™ª,,,'</span></span><br><span class="line">get_pause  = <span class="keyword">lambda</span> seconds: repeat(<span class="number">0</span>, int(seconds * F))</span><br><span class="line">sin_f      = <span class="keyword">lambda</span> i, hz: math.sin(i * <span class="number">2</span> * math.pi * hz / F)</span><br><span class="line">get_wave   = <span class="keyword">lambda</span> hz, seconds: (sin_f(i, hz) <span class="keyword">for</span> i <span class="keyword">in</span> range(int(seconds * F)))</span><br><span class="line">get_hz     = <span class="keyword">lambda</span> key: <span class="number">8.176</span> * <span class="number">2</span> ** (int(key) / <span class="number">12</span>)</span><br><span class="line">parse_note = <span class="keyword">lambda</span> note: (get_hz(note[:<span class="number">2</span>]), <span class="number">0.25</span> <span class="keyword">if</span> <span class="string">'â™ª'</span> <span class="keyword">in</span> note <span class="keyword">else</span> <span class="number">0.125</span>)</span><br><span class="line">get_frames = <span class="keyword">lambda</span> note: get_wave(*parse_note(note)) <span class="keyword">if</span> note <span class="keyword">else</span> get_pause(<span class="number">0.125</span>)</span><br><span class="line">frames_f   = chain.from_iterable(get_frames(n) <span class="keyword">for</span> n <span class="keyword">in</span> <span class="string">f'<span class="subst">&#123;P1&#125;</span><span class="subst">&#123;P1&#125;</span><span class="subst">&#123;P2&#125;</span>'</span>.split(<span class="string">','</span>))</span><br><span class="line">frames_b   = <span class="string">b''</span>.join(struct.pack(<span class="string">'&lt;h'</span>, int(f * <span class="number">30000</span>)) <span class="keyword">for</span> f <span class="keyword">in</span> frames_f)</span><br><span class="line">simpleaudio.play_buffer(frames_b, <span class="number">1</span>, <span class="number">2</span>, F)</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>åºåˆ—æ ‡æ³¨</title>
    <url>/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åé¢éœ€è¦è¡¥å……åºåˆ—æ ‡æ³¨åœ¨åˆ†è¯ã€è¯æ€§æ ‡æ³¨ã€å‘½åå®ä½“è¯†åˆ«ç­‰ç›¸å…³ä»»åŠ¡çš„ä»£ç å®è·µ(èµ°è¿‡çš„å‘ã€‚ã€‚)åŠç›¸å…³ç†è®ºçŸ¥è¯†ã€‚</p>
<h3 id="æ¡ä»¶éšæœºåœº-CRF"><a href="#æ¡ä»¶éšæœºåœº-CRF" class="headerlink" title="æ¡ä»¶éšæœºåœº(CRF)"></a>æ¡ä»¶éšæœºåœº(CRF)</h3><h4 id="crf-ç”¨äºåºåˆ—æ ‡æ³¨é—®é¢˜"><a href="#crf-ç”¨äºåºåˆ—æ ‡æ³¨é—®é¢˜" class="headerlink" title="crf ç”¨äºåºåˆ—æ ‡æ³¨é—®é¢˜"></a>crf ç”¨äºåºåˆ—æ ‡æ³¨é—®é¢˜</h4><p>åœ¨ CRF çš„åºåˆ—æ ‡æ³¨é—®é¢˜ä¸­ï¼Œè¦è®¡ç®—çš„æ˜¯æ¡ä»¶æ¦‚ç‡ï¼š</p>
<script type="math/tex; mode=display">
P\left(y_{1}, \ldots, y_{n} | x_{1}, \ldots, x_{n}\right)=P\left(y_{1}, \ldots, y_{n} | \boldsymbol{x}\right), \quad \boldsymbol{x}=\left(x_{1}, \ldots, x_{n}\right) \tag{1}</script><a id="more"></a>
<p>ä¸ºäº†å¾—åˆ°è¿™ä¸ªæ¦‚ç‡çš„ä¼°è®¡ï¼ŒCRF åšäº†ä¸¤ä¸ªå‡è®¾ï¼š</p>
<h5 id="å‡è®¾ä¸€ï¼šè¯¥åˆ†å¸ƒæ˜¯æŒ‡æ•°æ—åˆ†å¸ƒã€‚"><a href="#å‡è®¾ä¸€ï¼šè¯¥åˆ†å¸ƒæ˜¯æŒ‡æ•°æ—åˆ†å¸ƒã€‚" class="headerlink" title="å‡è®¾ä¸€ï¼šè¯¥åˆ†å¸ƒæ˜¯æŒ‡æ•°æ—åˆ†å¸ƒã€‚"></a><strong>å‡è®¾ä¸€ï¼šè¯¥åˆ†å¸ƒæ˜¯æŒ‡æ•°æ—åˆ†å¸ƒã€‚</strong></h5><p>è¿™ä¸ªå‡è®¾æ„å‘³ç€å­˜åœ¨å‡½æ•° $f(y_1,â€¦,y_n;x)$ï¼Œä½¿å¾—ï¼š</p>
<script type="math/tex; mode=display">
P\left(y_{1}, \ldots, y_{n} | \boldsymbol{x}\right)=\frac{1}{Z(\boldsymbol{x})} \exp \left(f\left(y_{1}, \ldots, y_{n} ; \boldsymbol{x}\right)\right) \tag{2}</script><p>å…¶ä¸­ Z(x) æ˜¯å½’ä¸€åŒ–å› å­ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯æ¡ä»¶åˆ†å¸ƒï¼Œæ‰€ä»¥å½’ä¸€åŒ–å› å­è·Ÿ x æœ‰å…³ã€‚è¿™ä¸ª f å‡½æ•°å¯ä»¥è§†ä¸ºä¸€ä¸ªæ‰“åˆ†å‡½æ•°ï¼Œæ‰“åˆ†å‡½æ•°å–æŒ‡æ•°å¹¶å½’ä¸€åŒ–åå°±å¾—åˆ°æ¦‚ç‡åˆ†å¸ƒã€‚ </p>
<h5 id="å‡è®¾äºŒï¼šè¾“å‡ºä¹‹é—´çš„å…³è”ä»…å‘ç”Ÿåœ¨ç›¸é‚»ä½ç½®ï¼Œå¹¶ä¸”å…³è”æ˜¯æŒ‡æ•°åŠ æ€§çš„ã€‚"><a href="#å‡è®¾äºŒï¼šè¾“å‡ºä¹‹é—´çš„å…³è”ä»…å‘ç”Ÿåœ¨ç›¸é‚»ä½ç½®ï¼Œå¹¶ä¸”å…³è”æ˜¯æŒ‡æ•°åŠ æ€§çš„ã€‚" class="headerlink" title="å‡è®¾äºŒï¼šè¾“å‡ºä¹‹é—´çš„å…³è”ä»…å‘ç”Ÿåœ¨ç›¸é‚»ä½ç½®ï¼Œå¹¶ä¸”å…³è”æ˜¯æŒ‡æ•°åŠ æ€§çš„ã€‚"></a><strong>å‡è®¾äºŒï¼šè¾“å‡ºä¹‹é—´çš„å…³è”ä»…å‘ç”Ÿåœ¨ç›¸é‚»ä½ç½®ï¼Œå¹¶ä¸”å…³è”æ˜¯æŒ‡æ•°åŠ æ€§çš„ã€‚</strong></h5><p>è¿™ä¸ªå‡è®¾æ„å‘³ç€ f(y1,â€¦,yn;x) å¯ä»¥æ›´è¿›ä¸€æ­¥ç®€åŒ–ä¸ºï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
f\left(y_{1}, \ldots, y_{n} ; \boldsymbol{x}\right)=h\left(y_{1} ; \boldsymbol{x}\right) &+g\left(y_{1}, y_{2} ; \boldsymbol{x}\right)+h\left(y_{2} ; \boldsymbol{x}\right)+\ldots \\
&+g\left(y_{n-1}, y_{n} ; \boldsymbol{x}\right)+h\left(y_{n} ; \boldsymbol{x}\right)
\end{aligned} \tag{3}</script><p>è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦å¯¹æ¯ä¸€ä¸ªæ ‡ç­¾å’Œæ¯ä¸€ä¸ªç›¸é‚»æ ‡ç­¾å¯¹åˆ†åˆ«æ‰“åˆ†ï¼Œç„¶åå°†æ‰€æœ‰æ‰“åˆ†ç»“æœæ±‚å’Œå¾—åˆ°æ€»åˆ†ã€‚</p>
<h5 id="çº¿æ€§é“¾crf"><a href="#çº¿æ€§é“¾crf" class="headerlink" title="çº¿æ€§é“¾crf"></a>çº¿æ€§é“¾crf</h5><p>å°½ç®¡å·²ç»åšäº†å¤§é‡ç®€åŒ–ï¼Œä½†ä¸€èˆ¬æ¥è¯´ï¼Œ(3)å¼æ‰€è¡¨ç¤ºçš„æ¦‚ç‡æ¨¡å‹è¿˜æ˜¯è¿‡äºå¤æ‚ï¼Œéš¾ä»¥æ±‚è§£ã€‚<strong>äºæ˜¯è€ƒè™‘åˆ°å½“å‰æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­ï¼ŒRNN æˆ–è€…å±‚å  CNN ç­‰æ¨¡å‹å·²ç»èƒ½å¤Ÿæ¯”è¾ƒå……åˆ†æ•æ‰å„ä¸ª y ä¸è¾“å‡º x çš„è”ç³»</strong>ï¼Œå› æ­¤ï¼Œä¸å¦¨è€ƒè™‘å‡½æ•° g è·Ÿ x æ— å…³ï¼Œé‚£ä¹ˆï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
f\left(y_{1}, \ldots, y_{n} ; \boldsymbol{x}\right)=h\left(y_{1} ; \boldsymbol{x}\right) &+g\left(y_{1}, y_{2}\right)+h\left(y_{2} ; \boldsymbol{x}\right)+\ldots \\
&+g\left(y_{n-1}, y_{n}\right)+h\left(y_{n} ; \boldsymbol{x}\right)
\end{aligned}</script><p>è¿™æ—¶å€™ g å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæœ‰é™çš„ã€å¾…è®­ç»ƒçš„å‚æ•°çŸ©é˜µè€Œå·²ï¼Œè€Œå•æ ‡ç­¾çš„æ‰“åˆ†å‡½æ•° $h(y_i;x$) å¯ä»¥é€šè¿‡ RNN æˆ–è€… CNN æ¥å»ºæ¨¡ã€‚å› æ­¤ï¼Œè¯¥æ¨¡å‹æ˜¯å¯ä»¥å»ºç«‹çš„ï¼Œå…¶ä¸­æ¦‚ç‡åˆ†å¸ƒå˜ä¸ºï¼š</p>
<script type="math/tex; mode=display">
P\left(y_{1}, \ldots, y_{n} | x\right)=\frac{1}{Z(x)} \exp \left(h\left(y_{1} ; x\right)+\sum_{k=1}^{n-1} g\left(y_{k}, y_{k+1}\right)+h\left(y_{k+1} ; x\right)\right)</script><h5 id="å½’ä¸€åŒ–å› å­"><a href="#å½’ä¸€åŒ–å› å­" class="headerlink" title="å½’ä¸€åŒ–å› å­"></a>å½’ä¸€åŒ–å› å­</h5><p>ä¸ºäº†è®­ç»ƒ CRF æ¨¡å‹ï¼Œç”¨æœ€å¤§ä¼¼ç„¶æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç”¨ï¼š$-\log P\left(y_{1}, \ldots, y_{n} | x\right)$ï¼Œä½œä¸ºæŸå¤±å‡½æ•°ï¼Œå¯ä»¥ç®—å‡ºå®ƒç­‰äºï¼š</p>
<script type="math/tex; mode=display">
-\left(h\left(y_{1} ; \boldsymbol{x}\right)+\sum_{k=1}^{n-1} g\left(y_{k}, y_{k+1}\right)+h\left(y_{k+1} ; \boldsymbol{x}\right)\right)+\log Z(\boldsymbol{x})</script><p>å…¶ä¸­ç¬¬ä¸€é¡¹æ˜¯åŸæ¥æ¦‚ç‡å¼çš„<strong>åˆ†å­</strong>çš„å¯¹æ•°ï¼Œå®ƒæ˜¯å¯¹ç›®æ ‡çš„åºåˆ—çš„æ‰“åˆ†ï¼Œè™½ç„¶å®ƒçœ‹ä¸Šå»æŒºè¿‚å›çš„ï¼Œä½†æ˜¯å¹¶ä¸éš¾è®¡ç®—ã€‚çœŸæ­£çš„éš¾åº¦åœ¨äº<strong>åˆ†æ¯</strong>çš„å¯¹æ•° $logZ(x)$ è¿™ä¸€é¡¹ã€‚</p>
<p>å½’ä¸€åŒ–å› å­ï¼Œåœ¨ç‰©ç†ä¸Šä¹Ÿå«é…åˆ†å‡½æ•°ï¼Œåœ¨è¿™é‡Œå®ƒéœ€è¦æˆ‘ä»¬å¯¹æ‰€æœ‰å¯èƒ½çš„è·¯å¾„çš„æ‰“åˆ†è¿›è¡ŒæŒ‡æ•°æ±‚å’Œï¼Œè€Œæˆ‘ä»¬å‰é¢å·²ç»è¯´åˆ°ï¼Œè¿™æ ·çš„è·¯å¾„æ•°æ˜¯æŒ‡æ•°é‡çº§çš„ï¼ˆk^nï¼‰ï¼Œå› æ­¤ç›´æ¥æ¥ç®—å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚</p>
<p>äº‹å®ä¸Šï¼Œ<strong>å½’ä¸€åŒ–å› å­éš¾ç®—ï¼Œå‡ ä¹æ˜¯æ‰€æœ‰æ¦‚ç‡å›¾æ¨¡å‹çš„å…¬å…±éš¾é¢˜</strong>ã€‚å¹¸è¿çš„æ˜¯ï¼Œåœ¨ CRF æ¨¡å‹ä¸­ï¼Œç”±äºæˆ‘ä»¬åªè€ƒè™‘äº†ä¸´è¿‘æ ‡ç­¾çš„è”ç³»ï¼ˆé©¬å°”å¯å¤«å‡è®¾ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€’å½’åœ°ç®—å‡ºå½’ä¸€åŒ–å› å­ï¼Œè¿™ä½¿å¾—åŸæ¥æ˜¯æŒ‡æ•°çº§çš„è®¡ç®—é‡é™ä½ä¸ºçº¿æ€§çº§åˆ«ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°†è®¡ç®—åˆ°æ—¶åˆ» $t$ çš„å½’ä¸€åŒ–å› å­è®°ä¸º$Z_t$ï¼Œå¹¶å°†å®ƒåˆ†ä¸º $k$ ä¸ªéƒ¨åˆ†ï¼š</p>
<script type="math/tex; mode=display">
Z_{t}=Z_{t}^{(1)}+Z_{t}^{(2)}+\cdots+Z_{t}^{(k)}</script><p>åˆ†åˆ«æ˜¯æˆªæ­¢åˆ°å½“å‰æ—¶åˆ» $t$ ä¸­ã€ä»¥æ ‡ç­¾ $1,â€¦,k$ ä¸ºç»ˆç‚¹çš„æ‰€æœ‰è·¯å¾„çš„å¾—åˆ†æŒ‡æ•°å’Œã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥é€’å½’åœ°è®¡ç®—ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
Z_{t+1}^{(1)} &=\left(Z_{t}^{(1)} G_{11}+Z_{t}^{(2)} G_{21}+\cdots+Z_{t}^{(k)} G_{k 1}\right) h_{t+1}(1 | x) \\
Z_{t+1}^{(2)} &=\left(Z_{t}^{(1)} G_{12}+Z_{t}^{(2)} G_{22}+\cdots+Z_{t}^{(k)} G_{k 2}\right) h_{t+1}(2 | x) \\
& \vdots \\
Z_{t+1}^{(k)} &=\left(Z_{t}^{(1)} G_{1 k}+Z_{t}^{(2)} G_{2 k}+\cdots+Z_{t}^{(k)} G_{k k}\right) h_{t+1}(k | x)
\end{aligned}</script><p>å®ƒå¯ä»¥ç®€å•å†™ä¸ºçŸ©é˜µå½¢å¼ï¼š</p>
<script type="math/tex; mode=display">
\mathbf{Z}_{t+1}=\mathbf{Z}_{t} \boldsymbol{G} \otimes H\left(y_{t+1} | \boldsymbol{x}\right)</script><p>å…¶ä¸­,$Z_{t}=\left[Z_{t}^{(1)}, \ldots, Z_{t}^{(k)}\right]$,è€Œ G æ˜¯å¯¹ g(yi,yj) (çŠ¶æ€è½¬ç§»)å„ä¸ªå…ƒç´ å–æŒ‡æ•°åçš„çŸ©é˜µï¼Œå³$G=e^{g(y i, y j)}$,è€Œ$H(y_{t+1}|x)$,æ˜¯ç¼–ç æ¨¡å‹$h(y_{t+1}|x)$,ï¼ˆRNNã€CNNç­‰ï¼‰å¯¹ä½ç½® t+1 çš„å„ä¸ªæ ‡ç­¾çš„æ‰“åˆ†çš„æŒ‡æ•°ï¼Œå³$H\left(y_{t+1} | x\right)=e^{h\left(y_{t+1} | x\right)}$ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå‘é‡ã€‚$Z_tG$ è¿™ä¸€æ­¥æ˜¯çŸ©é˜µä¹˜æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªå‘é‡ï¼Œè€Œ $âŠ—$ æ˜¯ä¸¤ä¸ªå‘é‡çš„é€ä½å¯¹åº”ç›¸ä¹˜ã€‚</p>
<p><img src="/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/decode-crf.png" alt="avatar"></p>
<p>ä»tåˆ°t+1æ—¶åˆ»çš„è®¡ç®—ï¼ŒåŒ…æ‹¬è½¬ç§»æ¦‚ç‡å’Œj+1èŠ‚ç‚¹æœ¬èº«çš„æ¦‚ç‡</p>
<h5 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h5><p>å†™å‡ºæŸå¤±å‡½æ•° $-logP(y_1,â€¦,y_n|x)$ åï¼Œå°±å¯ä»¥å®Œæˆæ¨¡å‹çš„è®­ç»ƒäº†ï¼Œå› ä¸ºç›®å‰çš„æ·±åº¦å­¦ä¹ æ¡†æ¶éƒ½å·²ç»å¸¦æœ‰è‡ªåŠ¨æ±‚å¯¼çš„åŠŸèƒ½ï¼Œåªè¦æˆ‘ä»¬èƒ½å†™å‡ºå¯å¯¼çš„ lossï¼Œå°±å¯ä»¥å¸®æˆ‘ä»¬å®Œæˆä¼˜åŒ–è¿‡ç¨‹äº†ã€‚ </p>
<p>é‚£ä¹ˆå‰©ä¸‹çš„æœ€åä¸€æ­¥ï¼Œå°±æ˜¯æ¨¡å‹è®­ç»ƒå®Œæˆåï¼Œå¦‚ä½•æ ¹æ®è¾“å…¥æ‰¾å‡ºæœ€ä¼˜è·¯å¾„æ¥ã€‚è·Ÿå‰é¢ä¸€æ ·ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªä» $k^n$ æ¡è·¯å¾„ä¸­é€‰æœ€ä¼˜çš„é—®é¢˜ï¼Œè€ŒåŒæ ·åœ°ï¼Œå› ä¸ºé©¬å°”å¯å¤«å‡è®¾çš„å­˜åœ¨ï¼Œå®ƒå¯ä»¥è½¬åŒ–ä¸ºä¸€ä¸ªåŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œç”¨ viterbi ç®—æ³•è§£å†³ï¼Œè®¡ç®—é‡æ­£æ¯”äº nã€‚ </p>
<p>åŠ¨æ€è§„åˆ’åœ¨æœ¬åšå®¢å·²ç»å‡ºç°äº†å¤šæ¬¡äº†ï¼Œ<strong>å®ƒçš„é€’å½’æ€æƒ³å°±æ˜¯ï¼šä¸€æ¡æœ€ä¼˜è·¯å¾„åˆ‡æˆä¸¤æ®µï¼Œé‚£ä¹ˆæ¯ä¸€æ®µéƒ½æ˜¯ä¸€æ¡ï¼ˆå±€éƒ¨ï¼‰æœ€ä¼˜è·¯å¾„</strong>ã€‚</p>
<h5 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List, Optional</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRF</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"""Conditional random field.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This module implements a conditional random field [LMP01]_. The forward computation</span></span><br><span class="line"><span class="string">    of this class computes the log likelihood of the given sequence of tags and</span></span><br><span class="line"><span class="string">    emission score tensor. This class also has `~CRF.decode` method which finds</span></span><br><span class="line"><span class="string">    the best tag sequence given an emission score tensor using `Viterbi algorithm`_.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        num_tags: Number of tags.</span></span><br><span class="line"><span class="string">        batch_first: Whether the first dimension corresponds to the size of a minibatch.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Attributes:</span></span><br><span class="line"><span class="string">        start_transitions (`~torch.nn.Parameter`): Start transition score tensor of size</span></span><br><span class="line"><span class="string">            ``(num_tags,)``.</span></span><br><span class="line"><span class="string">        end_transitions (`~torch.nn.Parameter`): End transition score tensor of size</span></span><br><span class="line"><span class="string">            ``(num_tags,)``.</span></span><br><span class="line"><span class="string">        transitions (`~torch.nn.Parameter`): Transition score tensor of size</span></span><br><span class="line"><span class="string">            ``(num_tags, num_tags)``.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. [LMP01] Lafferty, J., McCallum, A., Pereira, F. (2001).</span></span><br><span class="line"><span class="string">       "Conditional random fields: Probabilistic models for segmenting and</span></span><br><span class="line"><span class="string">       labeling sequence data". *Proc. 18th International Conf. on Machine</span></span><br><span class="line"><span class="string">       Learning*. Morgan Kaufmann. pp. 282â€“289.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. _Viterbi algorithm: https://en.wikipedia.org/wiki/Viterbi_algorithm</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num_tags: int, batch_first: bool = False)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> num_tags &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f'invalid number of tags: <span class="subst">&#123;num_tags&#125;</span>'</span>)</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.num_tags = num_tags</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line">        self.start_transitions = nn.Parameter(torch.empty(num_tags))</span><br><span class="line">        self.end_transitions = nn.Parameter(torch.empty(num_tags))</span><br><span class="line">        self.transitions = nn.Parameter(torch.empty(num_tags, num_tags))</span><br><span class="line"></span><br><span class="line">        self.reset_parameters()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset_parameters</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">"""Initialize the transition parameters.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        The parameters will be initialized randomly from a uniform distribution</span></span><br><span class="line"><span class="string">        between -0.1 and 0.1.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        nn.init.uniform_(self.start_transitions, <span class="number">-0.1</span>, <span class="number">0.1</span>)</span><br><span class="line">        nn.init.uniform_(self.end_transitions, <span class="number">-0.1</span>, <span class="number">0.1</span>)</span><br><span class="line">        nn.init.uniform_(self.transitions, <span class="number">-0.1</span>, <span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span> -&gt; str:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'<span class="subst">&#123;self.__class__.__name__&#125;</span>(num_tags=<span class="subst">&#123;self.num_tags&#125;</span>)'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            self,</span></span></span><br><span class="line"><span class="function"><span class="params">            emissions: torch.Tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            tags: torch.LongTensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            mask: Optional[torch.ByteTensor] = None,</span></span></span><br><span class="line"><span class="function"><span class="params">            reduction: str = <span class="string">'sum'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span> -&gt; torch.Tensor:</span></span><br><span class="line">        <span class="string">"""Compute the conditional log likelihood of a sequence of tags given emission scores.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            emissions (`~torch.Tensor`): Emission score tensor of size</span></span><br><span class="line"><span class="string">                ``(seq_length, batch_size, num_tags)`` if ``batch_first`` is ``False``,</span></span><br><span class="line"><span class="string">                ``(batch_size, seq_length, num_tags)`` otherwise.</span></span><br><span class="line"><span class="string">            tags (`~torch.LongTensor`): Sequence of tags tensor of size</span></span><br><span class="line"><span class="string">                ``(seq_length, batch_size)`` if ``batch_first`` is ``False``,</span></span><br><span class="line"><span class="string">                ``(batch_size, seq_length)`` otherwise.</span></span><br><span class="line"><span class="string">            mask (`~torch.ByteTensor`): Mask tensor of size ``(seq_length, batch_size)``</span></span><br><span class="line"><span class="string">                if ``batch_first`` is ``False``, ``(batch_size, seq_length)`` otherwise.</span></span><br><span class="line"><span class="string">            reduction: Specifies  the reduction to apply to the output:</span></span><br><span class="line"><span class="string">                ``none|sum|mean|token_mean``. ``none``: no reduction will be applied.</span></span><br><span class="line"><span class="string">                ``sum``: the output will be summed over batches. ``mean``: the output will be</span></span><br><span class="line"><span class="string">                averaged over batches. ``token_mean``: the output will be averaged over tokens.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            `~torch.Tensor`: The log likelihood. This will have size ``(batch_size,)`` if</span></span><br><span class="line"><span class="string">            reduction is ``none``, ``()`` otherwise.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self._validate(emissions, tags=tags, mask=mask)</span><br><span class="line">        <span class="keyword">if</span> reduction <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">'none'</span>, <span class="string">'sum'</span>, <span class="string">'mean'</span>, <span class="string">'token_mean'</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f'invalid reduction: <span class="subst">&#123;reduction&#125;</span>'</span>)</span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            mask = torch.ones_like(tags, dtype=torch.uint8)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.batch_first:</span><br><span class="line">            emissions = emissions.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            tags = tags.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            mask = mask.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        numerator = self._compute_score(emissions, tags, mask)</span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        denominator = self._compute_normalizer(emissions, mask)</span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        llh = numerator - denominator</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> reduction == <span class="string">'none'</span>:</span><br><span class="line">            <span class="keyword">return</span> llh</span><br><span class="line">        <span class="keyword">if</span> reduction == <span class="string">'sum'</span>:</span><br><span class="line">            <span class="keyword">return</span> llh.sum()</span><br><span class="line">        <span class="keyword">if</span> reduction == <span class="string">'mean'</span>:</span><br><span class="line">            <span class="keyword">return</span> llh.mean()</span><br><span class="line">        <span class="keyword">assert</span> reduction == <span class="string">'token_mean'</span></span><br><span class="line">        <span class="keyword">return</span> llh.sum() / mask.type_as(emissions).sum()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(self, emissions: torch.Tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">               mask: Optional[torch.ByteTensor] = None)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        <span class="string">"""Find the most likely tag sequence using Viterbi algorithm.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            emissions (`~torch.Tensor`): Emission score tensor of size</span></span><br><span class="line"><span class="string">                ``(seq_length, batch_size, num_tags)`` if ``batch_first`` is ``False``,</span></span><br><span class="line"><span class="string">                ``(batch_size, seq_length, num_tags)`` otherwise.</span></span><br><span class="line"><span class="string">            mask (`~torch.ByteTensor`): Mask tensor of size ``(seq_length, batch_size)``</span></span><br><span class="line"><span class="string">                if ``batch_first`` is ``False``, ``(batch_size, seq_length)`` otherwise.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            List of list containing the best tag sequence for each batch.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self._validate(emissions, mask=mask)</span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            mask = emissions.new_ones(emissions.shape[:<span class="number">2</span>], dtype=torch.uint8)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.batch_first:</span><br><span class="line">            emissions = emissions.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            mask = mask.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self._viterbi_decode(emissions, mask)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_validate</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            self,</span></span></span><br><span class="line"><span class="function"><span class="params">            emissions: torch.Tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            tags: Optional[torch.LongTensor] = None,</span></span></span><br><span class="line"><span class="function"><span class="params">            mask: Optional[torch.ByteTensor] = None)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> emissions.dim() != <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f'emissions must have dimension of 3, got <span class="subst">&#123;emissions.dim()&#125;</span>'</span>)</span><br><span class="line">        <span class="keyword">if</span> emissions.size(<span class="number">2</span>) != self.num_tags:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(</span><br><span class="line">                <span class="string">f'expected last dimension of emissions is <span class="subst">&#123;self.num_tags&#125;</span>, '</span></span><br><span class="line">                <span class="string">f'got <span class="subst">&#123;emissions.size(<span class="number">2</span>)&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> tags <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> emissions.shape[:<span class="number">2</span>] != tags.shape:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(</span><br><span class="line">                    <span class="string">'the first two dimensions of emissions and tags must match, '</span></span><br><span class="line">                    <span class="string">f'got <span class="subst">&#123;tuple(emissions.shape[:<span class="number">2</span>])&#125;</span> and <span class="subst">&#123;tuple(tags.shape)&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> emissions.shape[:<span class="number">2</span>] != mask.shape:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(</span><br><span class="line">                    <span class="string">'the first two dimensions of emissions and mask must match, '</span></span><br><span class="line">                    <span class="string">f'got <span class="subst">&#123;tuple(emissions.shape[:<span class="number">2</span>])&#125;</span> and <span class="subst">&#123;tuple(mask.shape)&#125;</span>'</span>)</span><br><span class="line">            no_empty_seq = <span class="keyword">not</span> self.batch_first <span class="keyword">and</span> mask[<span class="number">0</span>].all()</span><br><span class="line">            no_empty_seq_bf = self.batch_first <span class="keyword">and</span> mask[:, <span class="number">0</span>].all()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> no_empty_seq <span class="keyword">and</span> <span class="keyword">not</span> no_empty_seq_bf:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">'mask of the first timestep must all be on'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_compute_score</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            self, emissions: torch.Tensor, tags: torch.LongTensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            mask: torch.ByteTensor)</span> -&gt; torch.Tensor:</span></span><br><span class="line">        <span class="comment"># emissions: (seq_length, batch_size, num_tags)</span></span><br><span class="line">        <span class="comment"># tags: (seq_length, batch_size)</span></span><br><span class="line">        <span class="comment"># mask: (seq_length, batch_size)</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.dim() == <span class="number">3</span> <span class="keyword">and</span> tags.dim() == <span class="number">2</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.shape[:<span class="number">2</span>] == tags.shape</span><br><span class="line">        <span class="keyword">assert</span> emissions.size(<span class="number">2</span>) == self.num_tags</span><br><span class="line">        <span class="keyword">assert</span> mask.shape == tags.shape</span><br><span class="line">        <span class="keyword">assert</span> mask[<span class="number">0</span>].all()</span><br><span class="line"></span><br><span class="line">        seq_length, batch_size = tags.shape</span><br><span class="line">        mask = mask.type_as(emissions)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Start transition score and first emission</span></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        score = self.start_transitions[tags[<span class="number">0</span>]]</span><br><span class="line">        score += emissions[<span class="number">0</span>, torch.arange(batch_size), tags[<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, seq_length):</span><br><span class="line">            <span class="comment"># Transition score to next tag, only added if next timestep is valid (mask == 1)</span></span><br><span class="line">            <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">            score += self.transitions[tags[i - <span class="number">1</span>], tags[i]] * mask[i]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Emission score for next tag, only added if next timestep is valid (mask == 1)</span></span><br><span class="line">            <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">            score += emissions[i, torch.arange(batch_size), tags[i]] * mask[i]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># End transition score</span></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        seq_ends = mask.long().sum(dim=<span class="number">0</span>) - <span class="number">1</span></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        last_tags = tags[seq_ends, torch.arange(batch_size)]</span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        score += self.end_transitions[last_tags]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_compute_normalizer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            self, emissions: torch.Tensor, mask: torch.ByteTensor)</span> -&gt; torch.Tensor:</span></span><br><span class="line">        <span class="comment"># emissions: (seq_length, batch_size, num_tags)</span></span><br><span class="line">        <span class="comment"># mask: (seq_length, batch_size)</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.dim() == <span class="number">3</span> <span class="keyword">and</span> mask.dim() == <span class="number">2</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.shape[:<span class="number">2</span>] == mask.shape</span><br><span class="line">        <span class="keyword">assert</span> emissions.size(<span class="number">2</span>) == self.num_tags</span><br><span class="line">        <span class="keyword">assert</span> mask[<span class="number">0</span>].all()</span><br><span class="line"></span><br><span class="line">        seq_length = emissions.size(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Start transition score and first emission; score has size of</span></span><br><span class="line">        <span class="comment"># (batch_size, num_tags) where for each batch, the j-th column stores</span></span><br><span class="line">        <span class="comment"># the score that the first timestep has tag j</span></span><br><span class="line">        <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">        score = self.start_transitions + emissions[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, seq_length):</span><br><span class="line">            <span class="comment"># Broadcast score for every possible next tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags, 1)</span></span><br><span class="line">            broadcast_score = score.unsqueeze(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Broadcast emission score for every possible current tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, 1, num_tags)</span></span><br><span class="line">            broadcast_emissions = emissions[i].unsqueeze(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Compute the score tensor of size (batch_size, num_tags, num_tags) where</span></span><br><span class="line">            <span class="comment"># for each sample, entry at row i and column j stores the sum of scores of all</span></span><br><span class="line">            <span class="comment"># possible tag sequences so far that end with transitioning from tag i to tag j</span></span><br><span class="line">            <span class="comment"># and emitting</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags, num_tags)</span></span><br><span class="line">            next_score = broadcast_score + self.transitions + broadcast_emissions</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Sum over all possible current tags, but we're in score space, so a sum</span></span><br><span class="line">            <span class="comment"># becomes a log-sum-exp: for each sample, entry i stores the sum of scores of</span></span><br><span class="line">            <span class="comment"># all possible tag sequences so far, that end in tag i</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">            next_score = torch.logsumexp(next_score, dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Set score to the next score if this timestep is valid (mask == 1)</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">            score = torch.where(mask[i].unsqueeze(<span class="number">1</span>), next_score, score)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># End transition score</span></span><br><span class="line">        <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">        score += self.end_transitions</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Sum (log-sum-exp) over all possible tags</span></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        <span class="keyword">return</span> torch.logsumexp(score, dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_viterbi_decode</span><span class="params">(self, emissions: torch.FloatTensor,</span></span></span><br><span class="line"><span class="function"><span class="params">                        mask: torch.ByteTensor)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        <span class="comment"># emissions: (seq_length, batch_size, num_tags)</span></span><br><span class="line">        <span class="comment"># mask: (seq_length, batch_size)</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.dim() == <span class="number">3</span> <span class="keyword">and</span> mask.dim() == <span class="number">2</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.shape[:<span class="number">2</span>] == mask.shape</span><br><span class="line">        <span class="keyword">assert</span> emissions.size(<span class="number">2</span>) == self.num_tags</span><br><span class="line">        <span class="keyword">assert</span> mask[<span class="number">0</span>].all()</span><br><span class="line"></span><br><span class="line">        seq_length, batch_size = mask.shape</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Start transition and first emission</span></span><br><span class="line">        <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">        score = self.start_transitions + emissions[<span class="number">0</span>]</span><br><span class="line">        history = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># score is a tensor of size (batch_size, num_tags) where for every batch,</span></span><br><span class="line">        <span class="comment"># value at column j stores the score of the best tag sequence so far that ends</span></span><br><span class="line">        <span class="comment"># with tag j</span></span><br><span class="line">        <span class="comment"># history saves where the best tags candidate transitioned from; this is used</span></span><br><span class="line">        <span class="comment"># when we trace back the best tag sequence</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Viterbi algorithm recursive case: we compute the score of the best tag sequence</span></span><br><span class="line">        <span class="comment"># for every possible next tag</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, seq_length):</span><br><span class="line">            <span class="comment"># Broadcast viterbi score for every possible next tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags, 1)</span></span><br><span class="line">            broadcast_score = score.unsqueeze(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Broadcast emission score for every possible current tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, 1, num_tags)</span></span><br><span class="line">            broadcast_emission = emissions[i].unsqueeze(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Compute the score tensor of size (batch_size, num_tags, num_tags) where</span></span><br><span class="line">            <span class="comment"># for each sample, entry at row i and column j stores the score of the best</span></span><br><span class="line">            <span class="comment"># tag sequence so far that ends with transitioning from tag i to tag j and emitting</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags, num_tags)</span></span><br><span class="line">            next_score = broadcast_score + self.transitions + broadcast_emission</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Find the maximum score over all possible current tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">            next_score, indices = next_score.max(dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Set score to the next score if this timestep is valid (mask == 1)</span></span><br><span class="line">            <span class="comment"># and save the index that produces the next score</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">            score = torch.where(mask[i].unsqueeze(<span class="number">1</span>), next_score, score)</span><br><span class="line">            history.append(indices)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># End transition score</span></span><br><span class="line">        <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">        score += self.end_transitions</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Now, compute the best path for each sample</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        seq_ends = mask.long().sum(dim=<span class="number">0</span>) - <span class="number">1</span></span><br><span class="line">        best_tags_list = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> idx <span class="keyword">in</span> range(batch_size):</span><br><span class="line">            <span class="comment"># Find the tag which maximizes the score at the last timestep; this is our best tag</span></span><br><span class="line">            <span class="comment"># for the last timestep</span></span><br><span class="line">            _, best_last_tag = score[idx].max(dim=<span class="number">0</span>)</span><br><span class="line">            best_tags = [best_last_tag.item()]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># We trace back where the best last tag comes from, append that to our best tag</span></span><br><span class="line">            <span class="comment"># sequence, and trace it back again, and so on</span></span><br><span class="line">            <span class="keyword">for</span> hist <span class="keyword">in</span> reversed(history[:seq_ends[idx]]):</span><br><span class="line">                best_last_tag = hist[idx][best_tags[<span class="number">-1</span>]]</span><br><span class="line">                best_tags.append(best_last_tag.item())</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Reverse the order because we start from the last timestep</span></span><br><span class="line">            best_tags.reverse()</span><br><span class="line">            best_tags_list.append(best_tags)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> best_tags_list</span><br></pre></td></tr></table></figure>
<h4 id="é€å¸§-softmax-å’Œ-CRF-çš„å¼‚åŒ"><a href="#é€å¸§-softmax-å’Œ-CRF-çš„å¼‚åŒ" class="headerlink" title="é€å¸§ softmax å’Œ CRF çš„å¼‚åŒ?"></a>é€å¸§ softmax å’Œ CRF çš„å¼‚åŒ?</h4><p><strong>é€å¸§softmax</strong></p>
<p>CRF ä¸»è¦ç”¨äºåºåˆ—æ ‡æ³¨é—®é¢˜ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºæ˜¯<strong>ç»™åºåˆ—ä¸­çš„æ¯ä¸€å¸§éƒ½è¿›è¡Œåˆ†ç±»</strong>ï¼Œæ—¢ç„¶æ˜¯åˆ†ç±»ï¼Œå¾ˆè‡ªç„¶æƒ³åˆ°å°†è¿™ä¸ªåºåˆ—ç”¨ CNN æˆ–è€… RNN è¿›è¡Œç¼–ç åï¼Œæ¥ä¸€ä¸ªå…¨è¿æ¥å±‚ç”¨ softmax æ¿€æ´»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/encoder.png" alt="avatar"></p>
<p>ç„¶è€Œï¼Œ<strong>é€å¸§softmaxå¹¶æ²¡æœ‰ç›´æ¥è€ƒè™‘è¾“å‡ºçš„ä¸Šä¸‹æ–‡å…³è”</strong>ã€‚æ¯”å¦‚ï¼šå½“æˆ‘ä»¬è®¾è®¡æ ‡ç­¾æ—¶ï¼Œæ¯”å¦‚ç”¨ sã€bã€mã€e çš„ 4 ä¸ªæ ‡ç­¾æ¥åšå­—æ ‡æ³¨æ³•çš„åˆ†è¯ï¼Œç›®æ ‡è¾“å‡ºåºåˆ—æœ¬èº«ä¼šå¸¦æœ‰ä¸€äº›ä¸Šä¸‹æ–‡å…³è”ï¼Œå¦‚ s åé¢å°±ä¸èƒ½æ¥ m å’Œ eï¼Œç­‰ç­‰ã€‚é€æ ‡ç­¾ softmax å¹¶æ²¡æœ‰è€ƒè™‘è¿™ç§è¾“å‡ºå±‚é¢çš„ä¸Šä¸‹æ–‡å…³è”ï¼Œæ‰€ä»¥å®ƒæ„å‘³ç€æŠŠè¿™äº›å…³è”æ”¾åˆ°äº†ç¼–ç å±‚é¢ï¼Œå¸Œæœ›æ¨¡å‹èƒ½è‡ªå·±å­¦åˆ°è¿™äº›å†…å®¹ï¼Œä½†æœ‰æ—¶å€™ä¼šâ€œå¼ºæ¨¡å‹æ‰€éš¾â€ã€‚ </p>
<p>è€Œ CRF åˆ™æ›´ç›´æ¥ä¸€ç‚¹ï¼Œå®ƒ<strong>å°†è¾“å‡ºå±‚é¢çš„å…³è”åˆ†ç¦»äº†å‡ºæ¥</strong>ï¼Œè¿™ä½¿å¾—æ¨¡å‹åœ¨å­¦ä¹ ä¸Šæ›´ä¸ºâ€œä»å®¹â€,CRFåœ¨è¾“å‡ºç«¯æ˜¾å¼åœ°è€ƒè™‘äº†ä¸Šä¸‹æ–‡å…³è”.</p>
<p><img src="/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/encoder-crf.png" alt="avatar"></p>
<p>å¦‚æœä»…ä»…æ˜¯å¼•å…¥è¾“å‡ºçš„å…³è”ï¼Œè¿˜ä¸ä»…ä»…æ˜¯ CRF çš„å…¨éƒ¨ï¼ŒCRF çš„çœŸæ­£ç²¾å·§çš„åœ°æ–¹ï¼Œæ˜¯å®ƒä»¥è·¯å¾„ä¸ºå•ä½ï¼Œè€ƒè™‘çš„æ˜¯è·¯å¾„çš„æ¦‚ç‡ã€‚ </p>
<p>å‡å¦‚ä¸€ä¸ªè¾“å…¥æœ‰ n å¸§ï¼Œæ¯ä¸€å¸§çš„æ ‡ç­¾æœ‰ k ä¸­å¯èƒ½æ€§ï¼Œé‚£ä¹ˆç†è®ºä¸Šå°±æœ‰$k^n$ä¸­ä¸åŒçš„è¾“å…¥ã€‚æˆ‘ä»¬å°†å®ƒç”¨å¦‚ä¸‹çš„ç½‘ç»œå›¾è¿›è¡Œç®€å•çš„å¯è§†åŒ–ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œæ¯ä¸ªç‚¹ä»£è¡¨ä¸€ä¸ªæ ‡ç­¾çš„å¯èƒ½æ€§ï¼Œç‚¹ä¹‹é—´çš„è¿çº¿è¡¨ç¤ºæ ‡ç­¾ä¹‹é—´çš„å…³è”ï¼Œè€Œæ¯ä¸€ç§æ ‡æ³¨ç»“æœï¼Œéƒ½å¯¹åº”ç€å›¾ä¸Šçš„ä¸€æ¡å®Œæ•´çš„è·¯å¾„ã€‚</p>
<p><img src="/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/crf-v.png" alt="avatar"></p>
<p>è€Œåœ¨åºåˆ—æ ‡æ³¨ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬çš„æ­£ç¡®ç­”æ¡ˆæ˜¯ä¸€èˆ¬æ˜¯å”¯ä¸€çš„ã€‚æ¯”å¦‚â€œä»Šå¤©å¤©æ°”ä¸é”™â€ï¼Œå¦‚æœå¯¹åº”çš„åˆ†è¯ç»“æœæ˜¯â€œä»Šå¤©/å¤©æ°”/ä¸/é”™â€ï¼Œé‚£ä¹ˆç›®æ ‡è¾“å‡ºåºåˆ—å°±æ˜¯ bebessï¼Œé™¤æ­¤ä¹‹å¤–åˆ«çš„è·¯å¾„éƒ½ä¸ç¬¦åˆè¦æ±‚ã€‚</p>
<p>æ¢è¨€ä¹‹ï¼Œåœ¨åºåˆ—æ ‡æ³¨ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬çš„ç ”ç©¶çš„åŸºæœ¬å•ä½åº”è¯¥æ˜¯è·¯å¾„ï¼Œæˆ‘ä»¬è¦åšçš„äº‹æƒ…ï¼Œæ˜¯ä» $k^n$ æ¡è·¯å¾„é€‰å‡ºæ­£ç¡®çš„ä¸€æ¡ï¼Œé‚£å°±æ„å‘³ç€ï¼Œå¦‚æœå°†å®ƒè§†ä¸ºä¸€ä¸ªåˆ†ç±»é—®é¢˜ï¼Œé‚£ä¹ˆå°†æ˜¯ $k^n$ ç±»ä¸­é€‰ä¸€ç±»çš„åˆ†ç±»é—®é¢˜ã€‚</p>
<p>è¿™å°±æ˜¯é€å¸§ softmax å’Œ CRF çš„æ ¹æœ¬ä¸åŒäº†ï¼š<strong>å‰è€…å°†åºåˆ—æ ‡æ³¨çœ‹æˆæ˜¯ n ä¸ª k åˆ†ç±»é—®é¢˜ï¼Œåè€…å°†åºåˆ—æ ‡æ³¨çœ‹æˆæ˜¯ 1 ä¸ª$ k^n$ åˆ†ç±»é—®é¢˜</strong>ã€‚</p>
<h4 id="CRF"><a href="#CRF" class="headerlink" title="CRF++"></a>CRF++</h4><h5 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h5><p>CRF++ æ˜¯C++ å®ç°çš„CRF å·¥å…·ã€‚</p>
<p><a href="https://taku910.github.io/crfpp/" target="_blank" rel="noopener">æ–‡æ¡£</a></p>
<h5 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/taku910/crfpp.git</span><br><span class="line">cd crfpp</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>å¦‚æœmakeçš„æ—¶å€™å‘ç”Ÿæ‰¾ä¸åˆ°winmain.hçš„é”™è¯¯: å¯ä»¥ä¸‹é¢è¿™ç§æ–¹å¼ä¿®å¤ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">'/#include "winmain.h"/d'</span> crf_test.cpp</span><br><span class="line">sed -i <span class="string">'/#include "winmain.h"/d'</span> crf_learn.cpp</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>åé¢éœ€è¦ç”¨åˆ°Python ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹æ‰€ä»¥ä¹Ÿä¸€èµ·å®‰è£…CRFPP, cd python ç›®å½•ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cd python</span><br><span class="line">python setup.py build</span><br><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨Python æˆ–è€…Ipython é‡Œè¾“å…¥ <code>import CRFPP</code> å¦‚æœå‘ç”Ÿå¦‚ä¸‹é”™è¯¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ImportError: libcrfpp.so<span class="number">.0</span>: cannot open shared object file: No such file <span class="keyword">or</span> directory</span><br></pre></td></tr></table></figure>
<p>å¯ç”¨ä¸‹é¢çš„æ–¹æ³•è§£å†³</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/ld.so.conf</span><br><span class="line"><span class="comment"># æ·»åŠ </span></span><br><span class="line">include /usr/local/lib</span><br><span class="line"><span class="comment"># ä¿å­˜ååŠ è½½ä¸€ä¸‹</span></span><br><span class="line">sudo /sbin/ldconfig -v</span><br></pre></td></tr></table></figure>
<h5 id="è®­ç»ƒæ•°æ®æ ¼å¼"><a href="#è®­ç»ƒæ•°æ®æ ¼å¼" class="headerlink" title="è®­ç»ƒæ•°æ®æ ¼å¼"></a>è®­ç»ƒæ•°æ®æ ¼å¼</h5><p>å¯¹äºè®­ç»ƒæ•°æ®ï¼Œé¦–å…ˆéœ€è¦å¤šåˆ—ï¼Œä½†ä¸èƒ½ä¸ä¸€è‡´ï¼Œæ—¢åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œæœ‰çš„è¡Œæ˜¯ä¸¤åˆ—ï¼Œæœ‰çš„è¡Œæ˜¯ä¸‰åˆ—ï¼ˆè¿™ç§æ ¼å¼æ˜¯é”™è¯¯çš„ï¼‰ï¼›å…¶æ¬¡ç¬¬ä¸€åˆ—ä»£è¡¨çš„æ˜¯éœ€è¦æ ‡æ³¨çš„<strong>å­—æˆ–è¯</strong>ï¼Œæœ€åä¸€åˆ—æ˜¯è¾“å‡ºä½æ ‡è®°tagï¼Œ\å¦‚æœæœ‰é¢å¤–çš„ç‰¹å¾ï¼Œä¾‹å¦‚è¯æ€§ä»€ä¹ˆçš„ï¼Œå¯ä»¥åŠ åˆ°ä¸­é—´åˆ—é‡Œï¼Œæ‰€ä»¥è®­ç»ƒé›†æˆ–è€…æµ‹è¯•é›†çš„æ–‡ä»¶æœ€å°‘è¦æœ‰ä¸¤åˆ—ã€‚ä»¥åˆ†è¯ä¸¾ä¾‹ï¼Œæ ‡ç­¾ä¸ºBMES</p>
<p>ä¸œ    N    B<br>å—    N    M<br>å¤§    N    M<br>å­¦    N    E<br>æ¬¢    V    B<br>è¿    V    E<br>æ‚¨    N    S</p>
<p>å…¶ä¸­ç¬¬3åˆ—æ˜¯æ ‡ç­¾ï¼Œä¹Ÿæ˜¯æµ‹è¯•æ–‡ä»¶ä¸­éœ€è¦é¢„æµ‹çš„ç»“æœï¼Œæœ‰BMES 4ç§çŠ¶æ€ã€‚ç¬¬äºŒåˆ—æ˜¯è¯æ€§ï¼Œä¸æ˜¯å¿…é¡»çš„ã€‚</p>
<h5 id="ç‰¹å¾æ¨¡æ¿"><a href="#ç‰¹å¾æ¨¡æ¿" class="headerlink" title="ç‰¹å¾æ¨¡æ¿"></a>ç‰¹å¾æ¨¡æ¿</h5><p>æ¯ä¸€è¡Œæ¨¡æ¿ç”Ÿæˆä¸€ç»„çŠ¶æ€ç‰¹å¾å‡½æ•°ï¼Œæ•°é‡æ˜¯$L<em>N$ ä¸ªï¼Œ$L$æ˜¯æ ‡ç­¾çŠ¶æ€æ•°æ˜¯4ä¸ªã€‚$N$æ˜¯æ­¤è¡Œæ¨¡æ¿åœ¨è®­ç»ƒé›†ä¸Šå±•å¼€åçš„å”¯ä¸€æ ·æœ¬æ•°ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€åˆ—çš„å”¯ä¸€å­—æ•°æ˜¯7ä¸ªï¼Œæ‰€ä»¥æœ‰$L</em>N = 4*7=28$ã€‚ä¾‹å¦‚ï¼šU01:%x[0,0]ï¼Œç”Ÿæˆå¦‚ä¸‹28ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">func1 = <span class="keyword">if</span> (output = B and feature=U01:<span class="string">"ä¸œ"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func2 = <span class="keyword">if</span> (output = M and feature=U01:<span class="string">"ä¸œ"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func3 = <span class="keyword">if</span> (output = E and feature=U01:<span class="string">"ä¸œ"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func4 = <span class="keyword">if</span> (output = S and feature=U01:<span class="string">"ä¸œ"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func5 = <span class="keyword">if</span> (output = B and feature=U01:<span class="string">"å—"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">...</span><br><span class="line">func25 = <span class="keyword">if</span> (output = B and feature=U01:<span class="string">"ä½ "</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func26 = <span class="keyword">if</span> (output = M and feature=U01:<span class="string">"ä½ "</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func27 = <span class="keyword">if</span> (output = E and feature=U01:<span class="string">"ä½ "</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func28 = <span class="keyword">if</span> (output = S and feature=U01:<span class="string">"ä½ "</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>è¿™äº›å‡½æ•°ç»è¿‡è®­ç»ƒåï¼Œå…¶æƒå€¼è¡¨ç¤ºå‡½æ•°å†…æ–‡å­—å¯¹åº”è¯¥æ ‡ç­¾çš„æ¦‚ç‡ï¼ˆå½¢è±¡è¯´æ³•ï¼Œæ¦‚ç‡å’Œå¯å¤§äº1ï¼‰ã€‚</p>
<h6 id="unigram"><a href="#unigram" class="headerlink" title="unigram"></a>unigram</h6><p>U00:%x[-2,0]<br>U01:%x[-1,0]<br>U02:%x[0,0]<br>U03:%x[1,0]<br>U04:%x[2,0]<br>U05:%x[-2,0]/%x[-1,0]/%x[0,0]<br>U06:%x[-1,0]/%x[0,0]/%x[1,0]<br>U07:%x[0,0]/%x[1,0]/%x[2,0]<br>U08:%x[-1,0]/%x[0,0]<br>U09:%x[0,0]/%x[1,0] </p>
<p>è¿™æ˜¯CRF++ä¾‹å­ä¸­ç»™å‡ºçš„æ¨¡æ¿ï¼Œä¸€å…±æœ‰ï¼™ä¸ªæ¨¡æ¿ï¼Œå…ˆçœ‹ç¬¬ä¸€ä¸ªæ¨¡æ¿ï¼Œè¡¨ç¤ºå½“å‰è¯å’Œå‰é¢çš„ç¬¬äºŒä¸ªè¯ç»„æˆçš„ç‰¹å¾ï¼Œä»¥â€˜å°æ˜ä»Šå¤©ç©¿äº†ä¸€ä»¶çº¢è‰²ä¸Šè¡£â€™ä¸ºä¾‹ï¼Œç¬¦åˆCRF++å¤„ç†æ ¼å¼çš„è¿™å¥è¯åº”è¯¥å˜æˆå¦‚ä¸‹å½¢å¼ï¼š<br>å°ã€€ï¼¢<br>æ˜ã€€ï¼©<br>ä»Šã€€ï¼¢   &lt;â€” current word<br>å¤©ã€€ï¼©<br>ç©¿ã€€ï¼³<br>äº†ã€€ï¼³<br>ä¸€ã€€ï¼¢<br>ä»¶ã€€ï¼©<br>çº¢ã€€ï¼¢<br>è‰²ã€€ï¼©<br>ä¸Šã€€ï¼¢<br>è¡£ã€€ï¼©<br>å‡è®¾æˆ‘ä»¬æœ‰ä¸‰ä¸ªæ ‡è®°tagï¼Œï¼¢ï¼ˆè¡¨ç¤ºä¸€ä¸ªè¯çš„å¼€å¤´é‚£ä¸ªå­—ï¼‰ï¼Œï¼©ï¼ˆè¡¨ç¤ºä¸€ä¸ªè¯çš„ç»“å°¾é‚£ä¸ªå­—ï¼‰ï¼Œï¼³ï¼ˆè¡¨ç¤ºå•ä¸ªå­—çš„è¯ï¼‰ï¼Œå…ˆçœ‹ç¬¬ä¸€ä¸ªæ¨¡æ¿ï¼µ00:%x[-2,0],ç¬¬ä¸€ä¸ªæ¨¡æ¿äº§ç”Ÿçš„ç‰¹å¾å¦‚ä¸‹ï¼š å¦‚æœå½“å‰è¯æ˜¯â€˜ä»Šâ€™ï¼Œé‚£-2ä½ç½®å¯¹åº”çš„å­—å°±æ˜¯â€˜å°â€™ï¼Œ æ¯ä¸ªç‰¹å¾å¯¹åº”çš„å­—å¦‚ä¸‹ï¼š </p>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç‰¹å¾æ¨¡æ¿</th>
<th>æ„ä¹‰</th>
<th>ä»£è¡¨ç‰¹å¾</th>
</tr>
</thead>
<tbody>
<tr>
<td>U00:%x[-2,0]</td>
<td>-2è¡Œï¼Œ0åˆ—</td>
<td>å°</td>
</tr>
<tr>
<td>U01:%x[-1,0]</td>
<td>-1è¡Œï¼Œ0åˆ—</td>
<td>æ˜</td>
</tr>
<tr>
<td>U02:%x[0,0]</td>
<td>0è¡Œï¼Œ0åˆ—</td>
<td>ä»Š</td>
</tr>
<tr>
<td>U03:%x[1,0]</td>
<td>1è¡Œï¼Œ0åˆ—</td>
<td>å¤©</td>
</tr>
<tr>
<td>U04:%x[2,0]</td>
<td>2è¡Œï¼Œ0åˆ—</td>
<td>ç©¿</td>
</tr>
<tr>
<td>U05:%x[-2,0]/%x[-1,0]/%x[0,0]</td>
<td>-2è¡Œ0åˆ—ã€-1è¡Œ0åˆ—ä¸0è¡Œ0åˆ—çš„ç»„åˆ</td>
<td>å°/æ˜/ä»Š</td>
</tr>
<tr>
<td>U06:%x[-1,0]/%x[0,0]/%x[1,0]</td>
<td>-1è¡Œ0åˆ—ã€0è¡Œ0åˆ—ä¸1è¡Œ0åˆ—çš„ç»„åˆ</td>
<td>æ˜/ä»Š/å¤©</td>
</tr>
<tr>
<td>U07:%x[0,0]/%x[1,0]/%x[2,0]</td>
<td>0è¡Œ0åˆ—ã€1è¡Œ0åˆ—ä¸2è¡Œ0åˆ—çš„ç»„åˆ</td>
<td>ä»Š/å¤©/ç©¿</td>
</tr>
<tr>
<td>U08:%x[-1,0]/%x[0,0]</td>
<td>-1è¡Œ0åˆ—ä¸0è¡Œ0åˆ—çš„ç»„åˆ</td>
<td>æ˜/ä»Š</td>
</tr>
<tr>
<td>U09:%x[0,0]/%x[1,0]</td>
<td>0è¡Œ0åˆ—ä¸1è¡Œ0åˆ—çš„ç»„åˆ</td>
<td>ä»Š/å¤©</td>
</tr>
</tbody>
</table>
</div>
<p>æ ¹æ®ç¬¬ä¸€ä¸ªæ¨¡æ¿U00:%x[-2,0]èƒ½å¾—åˆ°çš„è½¬ç§»ç‰¹å¾å‡½æ•°å¦‚ä¸‹ï¼š<br><code>func1=if(output=B and feature=&#39;U00:å°&#39; )ã€€return 1 else return 0</code><br>å…¶ä¸­output=B æŒ‡çš„æ˜¯å½“å‰è¯ï¼ˆå­—ï¼‰çš„é¢„æµ‹æ ‡è®°ï¼Œä¹Ÿå°±æ˜¯â€™ä»Šâ€˜çš„é¢„æµ‹æ ‡è®°ï¼Œæ¯ä¸ªæ¨¡æ¿ä¼šæŠŠæ‰€æœ‰å¯èƒ½çš„æ ‡è®°è¾“å‡ºéƒ½åˆ—ä¸€éï¼Œç„¶åé€šè¿‡è®­ç»ƒç¡®å®šæ¯ç§æ ‡è®°çš„æƒé‡ï¼Œåˆç†çš„æ ‡è®°åœ¨è®­ç»ƒæ ·æœ¬ä¸­å‡ºç°çš„æ¬¡æ•°å¤šï¼Œå¯¹åº”çš„æƒé‡å°±é«˜ï¼Œä¸åˆç†çš„æ ‡è®°åœ¨è®­ç»ƒæ ·æœ¬ä¸­å‡ºç°çš„å°‘ï¼Œå¯¹åº”çš„æƒé‡å°±å°‘ï¼Œä½†æ˜¯åœ¨åˆ©ç”¨æ¨¡æ¿ç”Ÿæˆè½¬ç§»ç‰¹å¾å‡½æ•°æ˜¯ä¼šæŠŠæ‰€æœ‰å¯èƒ½çš„ç‰¹å¾å‡½æ•°éƒ½åˆ—å‡ºæ¥ï¼Œç”±æ¨¡å‹é€šè¿‡è®­ç»ƒå†³å®šæ¯ä¸ªç‰¹å¾çš„é‡è¦ç¨‹åº¦ã€‚<br><code>func2=if(output=M and feature=â€™U00:å°â€™) return 1 else return 0</code><br><code>func3=if(output=E and feature=â€™U00:å°â€™) return 1 else return 0</code><br><code>func4=if(output=S and feature=â€™U00:å°) return 1 else return 0</code><br>å¾—åˆ°4ä¸ªç‰¹å¾å‡½æ•°ä¹‹åå½“å‰è¿™ä¸ªå­—â€™ä»Šâ€˜çš„ç‰¹å¾å‡½æ•°åˆ©ç”¨ç¬¬ä¸€ä¸ªæ¨¡æ¿å°±å¾—åˆ°å…¨éƒ¨äº†ï¼Œç„¶åæ‰«æä¸‹ä¸€ä¸ªå­—â€˜å¤©â€˜ï¼Œä»¥â€™å¤©â€˜å­—ä½œä¸ºå½“å‰å­—é¢„æµ‹è¿™ä¸ªå­—çš„æ ‡è®°tag,åŒæ ·ä¼šå¾—åˆ°4ä¸ªç‰¹å¾å‡½æ•°ï¼š<br><code>func5=if(output=B and feature=â€™U00:æ˜â€™) return 1 else return 0</code><br><code>func6=if(output=M and feature=â€™U00:æ˜â€™) return 1 else return 0</code><br><code>func7=if(output=E and feature=â€™U00:æ˜â€™) return 1 else return 0</code><br><code>func7=if(output=S and feature=â€™U00:æ˜â€™) return 1 else return 0</code><br>ç‰¹å¾å‡½æ•°ä¸­çš„featureæŒ‡çš„æ˜¯å½“å‰è¯çš„-2ä½ç½®å¯¹åº”çš„è¯æˆ–å¯¹åº”çš„è¯çš„ç‰¹å¾ï¼Œå› ä¸ºåœ¨è¿™é‡Œæ²¡æœ‰å…¶ä»–ç‰¹å¾äº†ï¼Œæ‰€ä»¥ç”¨å­—æœ¬èº«åšç‰¹å¾ï¼Œæœ‰çš„ä¼šæœ‰è¯æ€§ï¼Œé‚£featureå°±ä¼šæ˜¯â€™æ˜â€˜è¿™ä¸ªå­—å¯¹åº”çš„è¯æ€§è€Œä¸æ˜¯å­—æœ¬èº«äº†ã€‚ è¿™ä¸ªfeatureçš„ä½œç”¨å°±æ˜¯ç¡®å®šæ¨¡æ¿æ‰€ç¡®å®šçš„å½“å‰è¯å’Œä¸´è¿‘è¯</p>
<h6 id="bigram"><a href="#bigram" class="headerlink" title="bigram"></a>bigram</h6><p>ä¸Unigramä¸åŒçš„æ˜¯ï¼ŒBigramç±»å‹æ¨¡æ¿ç”Ÿæˆçš„å‡½æ•°ä¼šå¤šä¸€ä¸ªå‚æ•°ï¼šä¸Šä¸ªèŠ‚ç‚¹çš„æ ‡ç­¾ $y_{i-1}$ã€‚ç”Ÿæˆå‡½B01:%x[0,0] (å½“å‰è¯ä¸ºâ€œä¸œå—å¤§å­¦æ¬¢è¿æ‚¨â€ çš„â€œæ‚¨â€)ï¼š<code>func1 = if (prev_output = E and output = S and feature=B01:&quot;æ‚¨&quot;) return 1 else return 0</code></p>
<p>è¿™æ ·ï¼Œæ¯è¡Œæ¨¡æ¿åˆ™ä¼šç”Ÿæˆ $L<em>L</em>N$ ä¸ªç‰¹å¾å‡½æ•°ã€‚ç»è¿‡è®­ç»ƒåï¼Œè¿™äº›å‡½æ•°çš„æƒå€¼åæ˜ äº†ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„æ ‡ç­¾å¯¹å½“å‰èŠ‚ç‚¹çš„å½±å“ã€‚(Lè¡¨ç¤ºéšçŠ¶æ€çš„ä¸ªæ•°ï¼Œå¦‚BMESä¸ºå››ä¸ªéšçŠ¶æ€ï¼ŒNè¡¨ç¤ºè®­ç»ƒè¯­æ–™çš„å¤§å°ã€‚)</p>
<p>trigamç†è®ºä¸Šä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œè€ƒè™‘å‰$y_{i-2},y_{i-1}$å¯¹$y_i$çš„å½±å“ï¼Œä¸è¿‡crf++å¹¶æ²¡æœ‰å®ç°ï¼Œè¿™å®é™…å’ŒäºŒé˜¶HMMæ¨¡å‹ç±»ä¼¼çš„ï¼Œæœ‰è®ºæ–‡è¯¦ç»†æè¿°è¿‡å…¶æ±‚è§£ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œä½†æ˜¯å…¶æ•ˆæœæå‡å¹¶æœªå¤šå¤§ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä½¿ç”¨ã€‚</p>
<h6 id="äº§ç”Ÿç‰¹å¾å‡½æ•°"><a href="#äº§ç”Ÿç‰¹å¾å‡½æ•°" class="headerlink" title="äº§ç”Ÿç‰¹å¾å‡½æ•°"></a>äº§ç”Ÿç‰¹å¾å‡½æ•°</h6><p>è®­ç»ƒé˜¶æ®µå°†éå†æ•°æ®é€ä¸€äº§ç”Ÿç‰¹å¾å‡½æ•°ï¼Œå†™æˆä¼ªç è¿‡ç¨‹ä¸ºï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">mï¼šæ ·æœ¬ä¸ªæ•°</span><br><span class="line">kï¼šæ¨¡æ¿ä¸ªæ•°</span><br><span class="line">templatesï¼šä¸€ç»„ç‰¹å¾æ¨¡æ¿</span><br><span class="line">genFeatureFuncï¼šæ ¹æ®æ¨¡æ¿å’Œåºåˆ—xï¼Œyå’Œä½ç½®iäº§ç”Ÿç‰¹å¾å‡½æ•°</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; k; j++)&#123;</span><br><span class="line">        genFeatureFunc(templates[j],x,y,i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="ç‰¹å¾å‡½æ•°"><a href="#ç‰¹å¾å‡½æ•°" class="headerlink" title="ç‰¹å¾å‡½æ•°"></a>ç‰¹å¾å‡½æ•°</h6><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> B</span><br><span class="line"><span class="number">16</span> U00:-</span><br><span class="line"><span class="number">20</span> U00:<span class="number">0</span></span><br><span class="line"><span class="number">24</span> U00:<span class="number">1</span></span><br><span class="line"><span class="number">28</span> U00:<span class="number">2</span></span><br><span class="line"><span class="number">32</span> U00:<span class="number">3</span></span><br><span class="line"><span class="number">36</span> U00:<span class="number">4</span></span><br><span class="line"><span class="number">40</span> U00:<span class="number">5</span></span><br><span class="line"><span class="number">44</span> U00:<span class="number">6</span></span><br><span class="line"><span class="number">48</span> U00:<span class="number">7</span></span><br><span class="line"><span class="number">52</span> U00:<span class="number">8</span></span><br><span class="line"><span class="number">56</span> U00:<span class="number">9</span></span><br><span class="line"><span class="number">60</span> U00:_B<span class="number">-1</span></span><br><span class="line"><span class="number">64</span> U00:_B<span class="number">-2</span></span><br><span class="line">â€¦â€¦</span><br><span class="line"><span class="number">17404</span> U01:å¨</span><br><span class="line"><span class="number">17408</span> U01:å»</span><br><span class="line"><span class="number">17412</span> U01:å¿</span><br><span class="line"><span class="number">17416</span> U01:å‚</span><br><span class="line"><span class="number">17420</span> U01:åˆ</span><br><span class="line"><span class="number">17424</span> U01:å‰</span><br><span class="line"><span class="number">17428</span> U01:åŠ</span><br><span class="line"><span class="number">17432</span> U01:å‹</span><br><span class="line"><span class="number">17436</span> U01:åŒ</span><br><span class="line"><span class="number">17440</span> U01:å</span><br><span class="line"><span class="number">17444</span> U01:å‘</span><br><span class="line"><span class="number">17448</span> U01:å”</span><br><span class="line"><span class="number">17452</span> U01:å–</span><br><span class="line"><span class="number">17456</span> U01:å—</span><br><span class="line">â€¦â€¦</span><br><span class="line"><span class="number">77800</span> U05:_B<span class="number">-1</span>/ä¸€/ä¸ª</span><br><span class="line"><span class="number">107540</span> U05:ä¸€/æ–¹/é¢</span><br><span class="line"><span class="number">107544</span> U05:ä¸€/æ— /æ‰€</span><br><span class="line"><span class="number">107548</span> U05:ä¸€/æ—¥/ä¸‰</span><br><span class="line"><span class="number">107552</span> U05:ä¸€/æ—¥/ä¸º</span><br><span class="line"><span class="number">107556</span> U05:ä¸€/æ—¥/ä¹‹</span><br><span class="line">â€¦â€¦</span><br><span class="line"><span class="number">566536</span> U06:ä¸‡/å¨/_B+<span class="number">1</span></span><br><span class="line">â€¦â€¦</span><br><span class="line"><span class="number">2159864</span> U09:ï½–/ï½…</span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§[id] [å‚æ•°o]çš„æ ¼å¼æ’åˆ—ï¼Œæ³¨æ„åˆ°idä¸æ˜¯è¿ç»­çš„ï¼Œè€Œæ˜¯éš”äº†å››ä¸ªï¼ˆçŠ¶æ€séšè—èµ·æ¥äº†ï¼‰ï¼Œè¿™è¡¨ç¤ºè¿™å››ä¸ªæ ‡ç­¾ï¼ˆBMESï¼‰å’Œå…¬å…±çš„å‚æ•°oç»„åˆæˆäº†å››ä¸ªç‰¹å¾å‡½æ•°ã€‚ç‰¹åˆ«çš„ï¼Œ0-15ä¸ºBEMSè½¬ç§»åˆ°BEMSçš„è½¬ç§»å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯f(sâ€™, s, o=null)ã€‚_B-1è¡¨ç¤ºå¥å­ç¬¬ä¸€ä¸ªå•è¯å‰é¢çš„ä¸€ä¸ªå•è¯ï¼Œ_B+1è¡¨ç¤ºæœ«å°¾åé¢çš„ä¸€ä¸ªå•è¯.</p>
<h6 id="ç‰¹å¾å‡½æ•°æƒå€¼"><a href="#ç‰¹å¾å‡½æ•°æƒå€¼" class="headerlink" title="ç‰¹å¾å‡½æ•°æƒå€¼"></a>ç‰¹å¾å‡½æ•°æƒå€¼</h6><p>åé¢çš„å°æ•°ä¾idé¡ºåºå¯¹åº”æ¯ä¸ªç‰¹å¾å‡½æ•°çš„æƒå€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">9.0491453814148901</span></span><br><span class="line"><span class="number">7.0388286231971700</span></span><br><span class="line"><span class="number">-7.2545558164093009</span></span><br><span class="line"><span class="number">5.2799470769112835</span></span><br><span class="line"><span class="number">-8.5333633546653758</span></span><br><span class="line"><span class="number">-5.3549190735606933</span></span><br><span class="line"><span class="number">5.2575182675282477</span></span><br><span class="line"><span class="number">-5.4259109736696054</span></span><br></pre></td></tr></table></figure>
<p>æ¯”å¦‚è¯´æœ‰ä¸€ä¸ªå¥å­â€œå•†å“å’ŒæœåŠ¡â€ï¼Œå¯¹äºæ¯ä¸ªå­—éƒ½æŒ‰ç…§ä¸Šè¿°æ¨¡æ¿ç”Ÿæˆä¸€ç³»åˆ—Uç‰¹å¾å‡½æ•°çš„å‚æ•°ä»£å…¥ï¼Œå¾—åˆ°ä¸€äº›ç±»ä¼¼010101çš„å‡½æ•°è¿”å›å€¼ï¼Œä¹˜ä¸Šè¿™äº›å‡½æ•°çš„æƒå€¼æ±‚å’Œï¼Œå°±å¾—åˆ°äº†å„ä¸ªæ ‡ç­¾çš„åˆ†æ•°ï¼Œç”±å¤§åˆ°å°ä»£è¡¨è¾“å‡ºè¿™äº›æ ‡ç­¾çš„å¯èƒ½æ€§ã€‚è‡³äºBç‰¹å¾å‡½æ•°ï¼ˆè¿™é‡Œç‰¹æŒ‡ç®€å•çš„f(sâ€™, s)ï¼‰ï¼Œåœ¨Viterbiåå‘è§£ç çš„æ—¶å€™ï¼Œå‰ä¸€ä¸ªæ ‡ç­¾ç¡®å®šäº†åå°±å¯ä»¥ä»£å…¥å½“å‰çš„Bç‰¹å¾å‡½æ•°ï¼Œè®¡ç®—å‡ºæ¯ä¸ªè¾“å‡ºæ ‡ç­¾çš„åˆ†æ•°ï¼Œå†æ¬¡æ±‚å’Œæ’åºå³å¯ã€‚</p>
<h5 id="è®­ç»ƒåŠé¢„æµ‹"><a href="#è®­ç»ƒåŠé¢„æµ‹" class="headerlink" title="è®­ç»ƒåŠé¢„æµ‹"></a>è®­ç»ƒåŠé¢„æµ‹</h5><p>CRF++çš„è®­ç»ƒå‘½ä»¤ä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š<br><code>crf_learn  -f 3 -c 4.0 template train.data model -t</code><br>å…¶ä¸­ï¼Œtemplateä¸ºæ¨¡æ¿æ–‡ä»¶ï¼Œtrain.dataä¸ºè®­ç»ƒè¯­æ–™ï¼Œ-tè¡¨ç¤ºå¯ä»¥å¾—åˆ°ä¸€ä¸ªmodelæ–‡ä»¶å’Œä¸€ä¸ªmodel.txtæ–‡ä»¶ï¼Œå…¶ä»–å¯é€‰å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">-f, â€“freq=INTä½¿ç”¨å±æ€§çš„å‡ºç°æ¬¡æ•°ä¸å°‘äºINT(é»˜è®¤ä¸º<span class="number">1</span>)</span><br><span class="line">-m, â€“maxiter=INTè®¾ç½®INTä¸ºLBFGSçš„æœ€å¤§è¿­ä»£æ¬¡æ•° (é»˜è®¤<span class="number">10</span>k)</span><br><span class="line">-c, â€“cost=FLOAT    è®¾ç½®FLOATä¸ºä»£ä»·å‚æ•°ï¼Œè¿‡å¤§ä¼šè¿‡åº¦æ‹Ÿåˆ (é»˜è®¤<span class="number">1.0</span>)</span><br><span class="line">-e, â€“eta=FLOATè®¾ç½®ç»ˆæ­¢æ ‡å‡†FLOAT(é»˜è®¤<span class="number">0.0001</span>)</span><br><span class="line">-C, â€“convertå°†æ–‡æœ¬æ¨¡å¼è½¬ä¸ºäºŒè¿›åˆ¶æ¨¡å¼</span><br><span class="line">-t, â€“textmodelä¸ºè°ƒè¯•å»ºç«‹æ–‡æœ¬æ¨¡å‹æ–‡ä»¶</span><br><span class="line">-a, â€“algorithm=(CRF|MIRA)    é€‰æ‹©è®­ç»ƒç®—æ³•ï¼Œé»˜è®¤ä¸ºCRF-L2</span><br><span class="line">-p, â€“thread=INTçº¿ç¨‹æ•°(é»˜è®¤<span class="number">1</span>)ï¼Œåˆ©ç”¨å¤šä¸ªCPUå‡å°‘è®­ç»ƒæ—¶é—´</span><br><span class="line">-H, â€“shrinking-size=INT    è®¾ç½®INTä¸ºæœ€é€‚å®œçš„è·Œä»£å˜é‡æ¬¡æ•° (é»˜è®¤<span class="number">20</span>)</span><br><span class="line">-v, â€“versionæ˜¾ç¤ºç‰ˆæœ¬å·å¹¶é€€å‡º</span><br><span class="line">-h, â€“helpæ˜¾ç¤ºå¸®åŠ©å¹¶é€€å‡º</span><br></pre></td></tr></table></figure>
<p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¼šè¾“å‡ºä¸€äº›ä¿¡æ¯ï¼Œå…¶æ„ä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">iterï¼šè¿­ä»£æ¬¡æ•°ã€‚å½“è¿­ä»£æ¬¡æ•°è¾¾åˆ°maxiteræ—¶ï¼Œè¿­ä»£ç»ˆæ­¢</span><br><span class="line">terrï¼šæ ‡è®°é”™è¯¯ç‡</span><br><span class="line">serrï¼šå¥å­é”™è¯¯ç‡</span><br><span class="line">objï¼šå½“å‰å¯¹è±¡çš„å€¼ã€‚å½“è¿™ä¸ªå€¼æ”¶æ•›åˆ°ä¸€ä¸ªç¡®å®šå€¼çš„æ—¶å€™ï¼Œè®­ç»ƒå®Œæˆ</span><br><span class="line">diffï¼šä¸ä¸Šä¸€ä¸ªå¯¹è±¡å€¼ä¹‹é—´çš„ç›¸å¯¹å·®ã€‚å½“æ­¤å€¼ä½äºetaæ—¶ï¼Œè®­ç»ƒå®Œæˆ</span><br></pre></td></tr></table></figure>
<p>åœ¨è®­ç»ƒå®Œæ¨¡å‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹å¯¹æ–°æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œé¢„æµ‹å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š<br><code>crf_test -m model seg_word_predict.data &gt; predict.txt</code></p>
<p><code>-m model</code>è¡¨ç¤ºä½¿ç”¨æˆ‘ä»¬åˆšåˆšè®­ç»ƒå¥½çš„modelæ¨¡å‹ï¼Œé¢„æµ‹çš„æ•°æ®æ–‡ä»¶ä¸ºseg_word_predict.data, <code>&gt; predict.txt</code>è¡¨ç¤ºå°†é¢„æµ‹åçš„æ•°æ®å†™å…¥åˆ°predict.txtä¸­ã€‚</p>
<h6 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h6><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> CRFPP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRFModel</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, model=<span class="string">'model_name'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: ç±»åˆå§‹åŒ–</span></span><br><span class="line"><span class="string">        :param model: æ¨¡å‹åç§°</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.model = model</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_tagger</span><span class="params">(self, tag_data)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: æ·»åŠ è¯­æ–™</span></span><br><span class="line"><span class="string">        :param tag_data: æ•°æ®</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        word_str = tag_data.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.model):</span><br><span class="line">            print(<span class="string">'æ¨¡å‹ä¸å­˜åœ¨,è¯·ç¡®è®¤æ¨¡å‹è·¯å¾„æ˜¯å¦æ­£ç¡®!'</span>)</span><br><span class="line">            exit()</span><br><span class="line">        tagger = CRFPP.Tagger(<span class="string">"-m &#123;&#125; -v 3 -n2"</span>.format(self.model))</span><br><span class="line">        tagger.clear()</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> word_str:</span><br><span class="line">            tagger.add(word)</span><br><span class="line">        tagger.parse()</span><br><span class="line">        <span class="keyword">return</span> tagger</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">text_mark</span><span class="params">(self, tag_data, begin=<span class="string">'B'</span>, middle=<span class="string">'I'</span>, end=<span class="string">'E'</span>, single=<span class="string">'S'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ–‡æœ¬æ ‡è®°</span></span><br><span class="line"><span class="string">        :param tag_data: æ•°æ®</span></span><br><span class="line"><span class="string">        :param begin: å¼€å§‹æ ‡è®°</span></span><br><span class="line"><span class="string">        :param middle: ä¸­é—´æ ‡è®°</span></span><br><span class="line"><span class="string">        :param end: ç»“æŸæ ‡è®°</span></span><br><span class="line"><span class="string">        :param single: å•å­—ç»“æŸæ ‡è®°</span></span><br><span class="line"><span class="string">        :return result: æ ‡è®°åˆ—è¡¨</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        tagger = self.add_tagger(tag_data)</span><br><span class="line">        size = tagger.size()</span><br><span class="line">        tag_text = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, size):</span><br><span class="line">            word, tag = tagger.x(i, <span class="number">0</span>), tagger.y2(i)</span><br><span class="line">            <span class="keyword">if</span> tag <span class="keyword">in</span> [begin, middle]:</span><br><span class="line">                tag_text += word</span><br><span class="line">            <span class="keyword">elif</span> tag <span class="keyword">in</span> [end, single]:</span><br><span class="line">                tag_text += word + <span class="string">"*&amp;*"</span></span><br><span class="line">        result = tag_text.split(<span class="string">'*&amp;*'</span>)</span><br><span class="line">        result.pop()</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crf_test</span><span class="params">(self, tag_data, separator=<span class="string">'/'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: crfæµ‹è¯•</span></span><br><span class="line"><span class="string">        :param tag_data:</span></span><br><span class="line"><span class="string">        :param separator:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        result = self.text_mark(tag_data)</span><br><span class="line">        data = separator.join(result)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crf_learn</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: è®­ç»ƒæ¨¡å‹</span></span><br><span class="line"><span class="string">        :param filename: å·²æ ‡æ³¨æ•°æ®æº</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        crf_bash = <span class="string">"crf_learn -f 3 -c 4.0 api/template.txt &#123;&#125; &#123;&#125;"</span>.format(filename, self.model)</span><br><span class="line">        process = subprocess.Popen(crf_bash.split(), stdout=subprocess.PIPE)</span><br><span class="line">        output = process.communicate()[<span class="number">0</span>]</span><br><span class="line">        print(output.decode(encoding=<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><p><a href="https://zhuanlan.zhihu.com/p/37163081" target="_blank" rel="noopener">ç®€æ˜æ¡ä»¶éšæœºåœºCRFä»‹ç» | é™„å¸¦çº¯Keraså®ç°</a></p>
</li>
<li><p><a href="https://blog.csdn.net/qq_37667364/article/details/82919560" target="_blank" rel="noopener">CRF++/CRF/æ¡ä»¶éšæœºåœºçš„ç‰¹å¾å‡½æ•°æ¨¡æ¿</a></p>
</li>
<li><p><a href="https://www.hankcs.com/nlp/the-crf-model-format-description.html" target="_blank" rel="noopener">CRF++æ¨¡å‹æ ¼å¼è¯´æ˜</a></p>
</li>
</ol>
]]></content>
      <categories>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ·±åº¦å­¦ä¹ </tag>
        <tag>åºåˆ—æ ‡æ³¨</tag>
        <tag>æ¡ä»¶éšæœºåœº</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡æœ¬åˆ†ç±»æ¨¡å‹åŠæ¯”è¾ƒ</title>
    <url>/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p>æ–‡æœ¬åˆ†ç±»å¯ä»¥ç”¨äºæ–°é—»åˆ†ç±»ã€ç®€å†åˆ†ç±»ã€é‚®ä»¶åˆ†ç±»ã€åŠå…¬æ–‡æ¡£åˆ†ç±»ã€åŒºåŸŸåˆ†ç±»ç­‰è¯¸å¤šæ–¹é¢ï¼Œè¿˜èƒ½å¤Ÿå®ç°æ–‡æœ¬è¿‡æ»¤ï¼Œä»å¤§é‡æ–‡æœ¬ä¸­å¿«é€Ÿè¯†åˆ«å’Œè¿‡æ»¤å‡ºç¬¦åˆç‰¹æ®Šè¦æ±‚çš„ä¿¡æ¯ã€‚</p>
<h3 id="æ•°æ®é›†"><a href="#æ•°æ®é›†" class="headerlink" title="æ•°æ®é›†"></a>æ•°æ®é›†</h3><p>å‡†å¤‡äº†é•¿çŸ­æ–‡æœ¬ï¼ŒäºŒåˆ†ç±»ååˆ†ç±»è¿›è¡Œæ¯”è¾ƒ</p>
<h4 id="æƒ…æ„ŸäºŒåˆ†ç±»"><a href="#æƒ…æ„ŸäºŒåˆ†ç±»" class="headerlink" title="æƒ…æ„ŸäºŒåˆ†ç±»"></a>æƒ…æ„ŸäºŒåˆ†ç±»</h4><p>weibo_senti_100kï¼šå…±119988æ¡æ•°æ®ï¼Œæ­£ä¾‹ï¼š59993,è´Ÿä¾‹59995   </p>
<p>å¥å­æœ€å¤§é•¿åº¦ï¼š260ï¼Œæœ€å°é•¿åº¦ï¼š3ï¼Œå¹³å‡é•¿åº¦ï¼š66.04</p>
<p>éƒ¨åˆ†æ ·ä¾‹</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>label</th>
<th>review</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>æ›´åšäº†ï¼Œçˆ†ç…§äº†ï¼Œå¸…çš„å‘€ï¼Œå°±æ˜¯è¶Šæ¥è¶Šçˆ±ä½ ï¼ç”Ÿå¿«å‚»ç¼º[çˆ±ä½ ][çˆ±ä½ ][çˆ±ä½ ]</td>
</tr>
<tr>
<td>1</td>
<td>@å¼ æ™“é¹jonathan åœŸè€³å…¶çš„äº‹è¦è®¤çœŸå¯¹å¾…[å“ˆå“ˆ]ï¼Œå¦åˆ™ç›´æ¥å¼€é™¤ã€‚@ä¸ä¸çœ‹ä¸–ç•Œ å¾ˆæ˜¯ç»†å¿ƒï¼Œé…’åº—éƒ½å…¨éƒ¨OKå•¦ã€‚</td>
</tr>
<tr>
<td>1</td>
<td>å§‘å¨˜éƒ½ç¾¡æ…•ä½ å‘¢â€¦è¿˜æœ‰æ‹›è´¢çŒ«é«˜å…´â€¦â€¦//@çˆ±åœ¨è”“å»¶-JC:[å“ˆå“ˆ]å°å­¦å¾’ä¸€æšï¼Œç­‰ç€æ˜å¤©è§æ‚¨å‘¢//@ææ¬£èŠ¸SharonLee:å¤§ä½¬èŒƒå„¿[ä¹¦å‘†å­]</td>
</tr>
<tr>
<td>1</td>
<td>ç¾<del>~</del>[çˆ±ä½ ]</td>
</tr>
<tr>
<td>1</td>
<td>æ¢¦æƒ³æœ‰å¤šå¤§ï¼Œèˆå°å°±æœ‰å¤šå¤§![é¼“æŒ]</td>
</tr>
<tr>
<td>0</td>
<td>ä»Šå¤©çœŸå†·å•Šï¼Œéš¾é“åˆè¦ç©¿æ£‰è¢„äº†[æ™•]ï¼Ÿä»Šå¹´çš„æ˜¥å¤©çœŸçš„æ˜¯ç™¾å˜è«æµ‹å•Š[æŠ“ç‹‚]</td>
</tr>
<tr>
<td>0</td>
<td>[è¡°][è¡°][è¡°]åƒç»™å‰¥äº†çš®çš„è›‡</td>
</tr>
<tr>
<td>0</td>
<td>é…’é©¾çš„å±å®³ï¼Œè¿™å›æ˜¯æ½œæ°´è‰‡ã€‚//@ä¸Šæµ·è¯‘æ–‡ä¸ä¸½æ´:[æ³ª]</td>
</tr>
<tr>
<td>0</td>
<td>ç§¯å‹äº†è¿™ä¹ˆå¤šçš„æ•è¾¹ä¹¦ï¼Œæ²¡ä¸€æœ¬çœ‹å®Œäº†çš„ï¼Œç°åœ¨æˆ‘è¯»ä¹¦çš„æœ€ä½³åœ°ç‚¹å°½ç„¶æ˜¯å…¬äº¤è½¦[æ™•]</td>
</tr>
<tr>
<td>0</td>
<td>[æ³ª]é”™è¿‡äº†â€¦â€¦</td>
</tr>
</tbody>
</table>
</div>
<p><a href="https://github.com/Embedding/Chinese-Word-Vectors" target="_blank" rel="noopener">è¯å‘é‡ä¸‹è½½</a></p>
<p><a href="https://github.com/ymcui/Chinese-BERT-wwm" target="_blank" rel="noopener">ä¸­æ–‡é¢„è®­ç»ƒbertæ¨¡å‹ä¸‹è½½</a></p>
<p><a href="https://github.com/jeffery0628/text_classification" target="_blank" rel="noopener">æƒ…æ„ŸäºŒåˆ†ç±»githubä»“åº“ä»£ç </a></p>
<a id="more"></a>
<h4 id="æ–°é—»ååˆ†ç±»"><a href="#æ–°é—»ååˆ†ç±»" class="headerlink" title="æ–°é—»ååˆ†ç±»"></a>æ–°é—»ååˆ†ç±»</h4><p>ç±»åˆ«ï¼šâ€™ä½“è‚²â€™ â€˜å¨±ä¹â€™ â€˜å®¶å±…â€™ â€˜æˆ¿äº§â€™ â€˜æ•™è‚²â€™ â€˜æ—¶å°šâ€™ â€˜æ—¶æ”¿â€™ â€˜æ¸¸æˆâ€™ â€˜ç§‘æŠ€â€™ â€˜è´¢ç»â€™<br>è®­ç»ƒé›†ï¼š50000 æ¡æ•°æ®ï¼Œæœ€å¤§é•¿åº¦ï¼š27467ï¼Œæœ€å°é•¿åº¦ï¼š8ï¼Œç±»åˆ«ä¸ªæ•°ï¼š10,å¹³å‡é•¿åº¦ï¼š913.31<br>éªŒè¯é›†ï¼š5000 æ¡æ•°æ®ï¼Œæœ€å¤§é•¿åº¦ï¼š10919ï¼Œæœ€å°é•¿åº¦ï¼š15ï¼Œç±»åˆ«ä¸ªæ•°ï¼š10<br>æµ‹è¯•é›†ï¼š10000 æ¡æ•°æ®ï¼Œæœ€å¤§é•¿åº¦ï¼š14720ï¼Œæœ€å°é•¿åº¦ï¼š13ï¼Œç±»åˆ«ä¸ªæ•°ï¼š10</p>
<p>ä½¿ç”¨æ•°æ®é›†<a href="https://pan.baidu.com/s/1OOTK374IZ1DHnz5COUcfbw" target="_blank" rel="noopener">cnews</a>  å¯†ç :hf6o</p>
<p>è®­ç»ƒé›†éƒ¨åˆ†æ ·ä¾‹åŠæ¯ä¸ªç±»åˆ«çš„ç»Ÿè®¡ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>label</th>
<th>text</th>
<th>æ•°é‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä½“è‚²</td>
<td>é»„èœ‚vsæ¹–äººé¦–å‘ï¼šç§‘æ¯”å¸¦ä¼¤æˆ˜ä¿ç½— åŠ ç´¢å°”æ•‘èµä¹‹æˆ˜ æ–°æµªä½“è‚²è®¯åŒ—äº¬æ—¶é—´4æœˆ27æ—¥ï¼ŒNBAå­£åèµ›é¦–è½®æ´›æ‰çŸ¶æ¹–äººä¸»åœºè¿æˆ˜æ–°å¥¥å°”è‰¯é»„èœ‚ï¼Œæ­¤å‰çš„æ¯”èµ›ä¸­ï¼ŒåŒæ–¹æˆ˜æˆ2-2å¹³ï¼Œå› æ­¤æœ¬åœºæ¯”èµ›å¯¹äºä¸¤æ”¯çƒé˜Ÿæ¥è¯´éƒ½éå¸¸é‡è¦ï¼Œèµ›å‰åŒæ–¹ä¹Ÿå…¬å¸ƒäº†é¦–å‘é˜µå®¹ï¼šæ¹–äººé˜Ÿï¼šè´¹èˆå°”ã€ç§‘æ¯”ã€é˜¿æ³°æ–¯ç‰¹ã€åŠ ç´¢å°”ã€æ‹œçº³å§†é»„èœ‚é˜Ÿï¼šä¿ç½—ã€è´é‡Œå†…åˆ©ã€é˜¿é‡Œæ‰ã€å…°å¾·é‡Œã€å¥¥å¡ç¦[æ–°æµªNBAå®˜æ–¹å¾®åš][æ–°æµªNBAæ¹–äººæ–°é—»åŠ¨æ€å¾®åš][æ–°æµªNBAä¸“é¢˜]<a href="æ–°æµªä½“è‚²">é»„èœ‚vsæ¹–äººå›¾æ–‡ç›´æ’­å®¤</a></td>
<td>5000</td>
</tr>
<tr>
<td>å¨±ä¹</td>
<td>çš®å…‹æ–¯é¦–éƒ¨3DåŠ¨ç”»ã€Šé£å±‹å†é™©è®°ã€‹é¢„å‘Šå‘å¸ƒ(å›¾)è§†é¢‘ï¼šåŠ¨ç”»ç‰‡ã€Šé£å±‹å†é™©è®°ã€‹å…ˆè¡Œç‰ˆ43ç§’é¢„å‘Šæ–°æµªå¨±ä¹è®¯ è¿ªå£«å°¼ã€çš®å…‹æ–¯2009æš‘æœŸ3DåŠ¨ç”»åŠ›ä½œã€Šé£å±‹å†é™©è®°ã€‹(Up)å‘å¸ƒé¢„å‘Šç‰‡ï¼Œè™½ç„¶è¿™æ¬¾é¢„å‘Šç‰‡ä»…æœ‰43ç§’ï¼Œå¹¶ä¸”åªå‡ºç°äº†è¢«æ±½çƒåŠèµ·æ¥çš„æˆ¿å±‹ï¼Œä½†é—¨å‰è€çˆ·çˆ·å¡å°”çš„ä¸€å£°â€œä¸‹åˆå¥½â€ç€å®è®©äººå¿ä¿Šä¸ç¦ã€‚è¯¥ç‰‡ç”±ã€Šæ€ªå…½ç”µåŠ›å…¬å¸ã€‹å¯¼æ¼”å½¼ç‰¹Â·é“æ ¼ç‰¹(Pete Docter)æ‰§å¯¼ï¼Œæ›¾åœ¨ã€Šæµ·åº•æ€»åŠ¨å‘˜ã€‹ã€ã€Šæ–™ç†é¼ ç‹ã€‹æ‹…ä»»ç¼–å‰§çš„çš®å…‹æ–¯è€ç­åº•é²å‹ƒ-æ´¾ç‰¹æ£®(Bob Peterson)äº¦å°†åœ¨æœ¬ç‰‡æ‹…ä»»å…±åŒå¯¼æ¼”ï¼ŒçŒ®å‡ºè‡ªå·±çš„å¯¼æ¼”å¤„å¥³ä½œã€‚ã€Šé£å±‹å†é™©è®°ã€‹åŒæ—¶ä¼šæ˜¯çš®å…‹æ–¯æœ‰å²ä»¥æ¥ç¬¬ä¸€éƒ¨ä»¥3-Dç”µå½±å‘ˆç°çš„é‡Œç¨‹ç¢‘ä½œå“ï¼Œä¹‹åçš®å…‹æ–¯çš„æ‰€æœ‰å½±ç‰‡éƒ½å°†åˆ¶ä½œæˆç«‹ä½“ç”µå½±ã€‚ã€Šé£å±‹å†é™©è®°ã€‹è®²è¿°äº†ä¸€è€ä¸€å°‘çš„å†’é™©æ—…ç¨‹ã€‚78å²çš„è€ç¿å¡å°”Â·å¼—é›·å¾·é‡Œå…‹æ£®(Carl Fredricksen)ä¸€ç”Ÿä¸­éƒ½æ¢¦æƒ³ç€èƒ½ç¯æ¸¸ä¸–ç•Œã€å‡ºæ²¡äºå¼‚å¢ƒé™©åœ°ä½“éªŒï¼Œå´å¹³æ·¡åœ°æ¸¡è¿‡äº†ä¸€ç”Ÿã€‚åœ¨ä»–ç”Ÿæ´»çš„æœ€åé˜¶æ®µï¼Œå¡è€Œä»¿ä½›åœ¨å‘½è¿çš„å®‰æ’ä¸‹ï¼Œå¸¦ç€8å²çš„äºšè£”å°é¬¼å¤´Russellä¸€åŒè¸ä¸Šäº†å†’é™©çš„æ—…ç¨‹ã€‚è¿™å¯¹ä¸€è€ä¸€å°çš„å¥‡ç‰¹ç»„åˆè‚©å¹¶è‚©é—¯è¡æ±Ÿæ¹–ï¼Œå…±åŒç»å†äº†è’é‡è·‹æ¶‰ã€ä¸›æ—é‡å…½ä¸åæ´¾åè›‹çš„ç‹™å‡»ã€‚ç”°é‡/æ–‡</td>
<td>5000</td>
</tr>
<tr>
<td>å®¶å±…</td>
<td>æ©±æŸœä»·æ ¼å…³é”®åœ¨è®¡ä»·æ–¹å¼ æ•™ä½ å¦‚ä½•æŒ‘é€‰ä¹°è¿‡æ©±æŸœçš„äººéƒ½çŸ¥é“ï¼Œæ©±æŸœçš„è®¡ä»·å¾ˆå¤æ‚ï¼Œå•†å®¶çš„æŠ¥ä»·æ–¹å¼ä¹Ÿä¸å°½ç›¸åŒï¼Œé‚£ä¹ˆå“ªç§è®¡ä»·æ–¹å¼å¯¹æ¶ˆè´¹è€…æ›´æœ‰åˆ©ï¼Ÿåœ¨è®¡ä»·è¿‡ç¨‹ä¸­åº”è¯¥æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿæ¶ˆè´¹è€…åœ¨è´­ä¹°æ©±æŸœä¹‹å‰ä¸€å®šè¦äº†è§£æ¸…æ¥šã€‚ æ©±æŸœçš„ä¸»è¦è®¡ä»·æ–¹å¼â€”â€”å»¶ç±³è®¡ä»·å’Œå•å…ƒæŸœä½“è®¡ä»· ç°åœ¨å¸‚åœºä¸Šæ©±æŸœä¸»è¦æœ‰ä¸¤ç§è®¡ä»·æ–¹å¼â€”â€”å»¶ç±³è®¡ä»·å’Œå•å…ƒæŸœä½“è®¡ä»·ã€‚ å»¶ç±³è®¡ä»·æ˜¯æŒ‡åœ°æŸœå’ŒåŠæŸœå„ä¸€ç±³çš„æ€»ä»·(æœ‰äº›è¿˜åŒ…å«å°é¢)ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¦‚æœæœ‰å±€éƒ¨åŒºåŸŸåªè¦åœ°æŸœä¸è¦åŠæŸœï¼Œå°±ä¼šæŒ‰å°±ä¼šæŒ‰â€œ2/8â€æˆ–â€œ4/6â€çš„æ¯”ä¾‹æŠ˜ç®—ã€‚å¦‚æŸæ©±æŸœææ–™çš„å»¶ç±³ä»·ä¸º2000å…ƒ/å»¶ç±³ï¼ŒæŸé¡¾å®¢åš2ç±³çš„åŠæŸœã€4ç±³çš„åœ°æŸœï¼Œåˆ™åŠæŸœä»·=2000X0.4X2=1600å…ƒï¼Œåœ°æŸœä»·=2000X0.6X4=4800å…ƒ(æ­¤åŠæŸœã€åœ°æŸœä»·æŒ‰4/6çš„æ¯”ä¾‹è®¡ç®—)ï¼Œå†åŠ ä¸Šæ‰€é€‰å°é¢ã€é…ä»¶ã€ç”µå™¨ç­‰é™„åŠ è´¹ç”¨å³ä¸ºæ•´å¥—æ©±æŸœçš„ä»·æ ¼ã€‚ å»¶ç±³æŠ¥ä»·æœ‰è®¸å¤šä¸åˆç†ä¹‹å¤„ï¼Œæ°´æ§½ã€ç‡ƒæ°”ç¶ã€åµŒå…¥å¼ç”µå™¨ç­‰éƒ¨åˆ†æ‰€éœ€é—¨æ¿å¾ˆå°‘ï¼Œä½†ä»æŒ‰å»¶ç±³æ¥ç®—ä»·ï¼Œå¯¹æ¶ˆè´¹è€…æ¥è¯´å¾ˆä¸åˆ’ç®—ã€‚ä¾‹å¦‚ä¸€æ¬¾1000å…ƒ/å»¶ç±³çš„æ©±æŸœï¼Œä¸€ä¸ªæ°´æ§½çº¦0.8ç±³é•¿ï¼Œä½†æ¶ˆè´¹è€…è¿˜æ˜¯è¦æŒ‰1000å…ƒçš„å•ä»·ä¹˜ä»¥0.8ç±³ä»˜è´¹ï¼Œè¿™ä¸ªå®é™…ä¸Šåªæ˜¯å‡ å—ææ–™ç®€å•ç»„åˆçš„æ°´æ§½æŸœéœ€è¦æ¶ˆè´¹è€…èŠ±800å…ƒï¼Œè€ŒåŒæ ·æè´¨ã€åŒæ ·å¤§å°çš„æ°´æ§½æŸœä»…éœ€400å…ƒå·¦å³ï¼ŒäºŒè€…ä»·æ ¼ç›¸å·®æ•°ç™¾å…ƒã€‚ æŒ‰å»¶ç±³è®¡ä»·ï¼Œæ‰€æœ‰çš„é…ä»¶è´¹ç”¨éƒ½æ˜¯åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šå¢åŠ ï¼Œè™½ç„¶æœ‰äº›å‚å®¶å®£ç§°æŠ½å±‰ã€æ‹‰ç¯®ä¸åŠ é’±ï¼Œä½†å…¶å®é‚£æ˜¯æœ€åŸºæœ¬çš„é…ç½®ï¼Œä¸€æ—¦é¡¾å®¢è¦æ±‚è°ƒæ•´æ–¹æ¡ˆï¼Œå°±ä¼šè¦å¤šåŠ é’±ï¼Œæ­¤å¤–ä¸è¶³ä¸€ç±³çš„éƒ¨åˆ†è¦æŒ‰ä¸€ç±³è®¡ä»·ï¼Œå› æ­¤å¯¹é¡¾å®¢æ¥è¯´ï¼Œå¦‚æ­¤è®¡ä»·ä¼šå¤šèŠ±ä¸å°‘å†¤æ‰é’±ã€‚ â€œå•å…ƒæŸœä½“è®¡ä»·â€æ˜¯å›½é™…æƒ¯ä¾‹çš„æ©±æŸœè®¡ä»·æ–¹å¼ï¼Œæ˜¯æŒ‰æ¯ä¸€ä¸ªç»„æˆå¨æŸœçš„å•å…ƒæŸœä»·æ ¼è¿›è¡Œè®¡ç®—ï¼Œç„¶ååŠ å‡ºæ€»ä»·ã€‚å…·ä½“ä¸ºï¼šæŸåŠæŸœå•ä»·Ã—ä¸ªæ•°+æŸåœ°æŸœå•ä»·Ã—ä¸ªæ•°â€¦â€¦ã€‚åˆ©ç”¨å•å…ƒæŸœä½“è®¡ä»·ï¼Œæ›´ä¸ºåˆç†ã€‚ä¸¾ä¸ªä¾‹å­è¯´ï¼Œå¤–è§‚ç›¸åŒçš„æŸœä½“ï¼ŒæŠ½å±‰æ•°é‡ã€äº”é‡‘ä»¶ã€æ‰˜æ¶æ•°é‡å¦‚æœä¸åŒï¼Œåœ¨ä»¥å»¶ç±³è®¡ä»·æ—¶ï¼Œå•†å®¶å¾€å¾€åªç»™æ¶ˆè´¹è€…æœ€ç®€å•ã€æœ€çœæˆæœ¬çš„äº§å“ã€‚è€ŒæŒ‰å•å…ƒæŸœä½“è®¡ä»·ï¼Œä¸€æ¬¾å°ºå¯¸ç›¸åŒçš„æŠ½å±‰æŸœå¯æŒ‰ä¸åŒé…ç½®æŠ¥å‡ºä¸åŒä»·æ ¼ï¼šåŒæ ·æ˜¯ä¸€æ¬¾30cmå®½ã€66cmé«˜çš„å•ä½“æŸœï¼Œå¦‚æœé—¨æ”¹æˆå¼§å‹ï¼Œæ˜¯å¤šå°‘é’±ï¼›å¦‚æœæŠ½å±‰é‡ŒåŠ ä¸Šå¯æ‹†è£…çš„é‡‘å±ç¯®ï¼Œæ˜¯å¤šå°‘é’±ï¼›å¦‚æœæŠ½å±‰çš„ä¾§æ¿æ˜¯æœ¨è´¨çš„å¤šå°‘é’±â€¦â€¦æŠŠæ©±æŸœçš„æ¯ä¸ªç»†èŠ‚éƒ½åˆ†è§£å¼€æ¥ï¼Œæ¶ˆè´¹è€…å¯ä»¥åœ¨é¢„ç®—ä¹‹å†…æŠŠå¯æœ‰å¯æ— çš„é…ç½®çœæ‰ï¼ŒæŠŠé’±èŠ±åœ¨è‡ªå·±æ›´éœ€è¦çš„åŠŸèƒ½ä¸Šã€‚ ä¸¤å…¨å…¶ç¾æŠ¥ä»·æ–¹å¼â€”â€”å»¶ç±³è®¡ä»·å’Œå•å…ƒæŸœä½“è®¡ä»·ç›¸ç»“åˆ ç°åœ¨ä¸­å›½æ©±æŸœå¸‚åœºä¸Šä»æ™®éé‡‡ç”¨å»¶ç±³è®¡ä»·ï¼Œä½†è¿›å£å“ç‰ŒåŠå›½å†…ä¸€äº›å¤§å“ç‰Œæ©±æŸœéƒ½é‡‡ç”¨å•å…ƒæŸœä½“è®¡ä»·æ–¹å¼ï¼Œå¦‚å¾·å®Â·è¥¿å…‹æ›¼ã€æµ·å°”ç­‰å“ç‰Œå³æ˜¯é‡‡ç”¨å•å…ƒæŸœä½“è®¡ä»·æ–¹å¼ã€‚ä¸è¿‡å¾·å®Â·è¥¿å…‹æ›¼å¨æŸœçš„å·¥ä½œäººå‘˜ä»‹ç»åˆ°ï¼Œå¦‚æœä¸€å¼€å§‹å°±ç”¨å•å…ƒæŸœä½“è®¡ä»·æ¥è¿›è¡ŒæŠ¥ä»·ï¼Œä¸å¤Ÿç›´è§‚ï¼ŒåŒæ—¶ä¸ºäº†ä¾¿äºé¡¾å®¢è¿›è¡Œæ¯”è¾ƒï¼Œä»–ä»¬ä¼šç”¨å»¶ç±³è®¡ä»·ç»™é¡¾å®¢æ‰€é€‰å®šçš„ææ–™è¿›è¡Œä¸€ä¸ªåˆå§‹æŠ¥ä»·ï¼Œè®©é¡¾å®¢å¯¹è‡ªå·±çš„å¨æˆ¿è£…ä¿®è¦èŠ±å¤šå°‘é’±å¿ƒé‡Œå¤§æ¦‚æœ‰ä¸ªåº•ã€‚åœ¨å¯¹å¨æˆ¿è¿›è¡Œé‡å°ºåï¼Œè®¾è®¡å¸ˆä¼šæŒ‰ç…§é¡¾å®¢çš„éœ€æ±‚ï¼Œè®¾è®¡å‡ºå¨æˆ¿æ•ˆæœå›¾ã€‚è¿™æ—¶ï¼Œé”€å”®äººå‘˜ä¼šæŒ‰å•å…ƒæŸœä½“è®¡ä»·ç»™é¡¾å®¢è¿›è¡Œä¸€ä¸ªæŠ¥ä»·ã€‚å¯¹äºæ¯ä¸€ç§æ ‡å‡†æŸœä½“éƒ½æœ‰ç›¸åº”çš„æŠ¥ä»·ï¼Œé¡¾å®¢å®é™…ç”¨åˆ°å‡ ç»„æŸœå­ï¼Œå°†è¿™äº›æŸœå­ä»·æ ¼ç´¯åŠ ï¼Œå†åŠ ä¸Šå°é¢åŠå…¶ä»–ç›¸å…³è´¹ç”¨ï¼Œä¾¿æ˜¯æ•´ä¸ªæ©±æŸœçš„ä»·æ ¼ã€‚</td>
<td>5000</td>
</tr>
<tr>
<td>æˆ¿äº§</td>
<td>å†¯ä»‘ï¼šç»§ç»­å¢æŒé«˜GDPåŸå¸‚å•†ä¸šåœ°äº§ç¡®ç«‹å•†ä¸šåœ°äº§æŠ•èµ„æˆ˜ç•¥ä¸ä¹…çš„ä¸‡é€šåœ°äº§(ä¼ä¸šä¸“åŒº,æ——ä¸‹æ¥¼ç›˜)(600246)ï¼Œä»Šå¹´ä¸ŠåŠå¹´é­é‡äº†ä¸šç»©ä¸‹æ»‘ã€‚å…¬å¸æ˜¨æ—¥å…¬å¸ƒçš„åŠå¹´æŠ¥æ˜¾ç¤ºï¼Œå…¶å•†ä¸šç‰©ä¸šåœ¨æŠ¥å‘ŠæœŸå†…å®ç°çš„è¥ä¸šæ”¶å…¥åŒæ¯”ä¸‹é™33.71%ï¼Œè¥ä¸šåˆ©æ¶¦ç‡æ¯”ä¸Šå¹´åŒæœŸä¸‹é™47.29ä¸ªç™¾åˆ†ç‚¹ã€‚ä¸è¿‡ï¼Œå…¬å¸è‘£äº‹é•¿å†¯ä»‘æ—¥å‰è¡¨ç¤ºï¼Œä¾ç„¶çœ‹å¥½äººå‡GDP8000ç¾å…ƒä»¥ä¸ŠåŸå¸‚çš„å•†ä¸šåœ°äº§ï¼Œä¸‡é€šå°†ç»§ç»­å¢åŠ é«˜GDPåŸå¸‚çš„å•†ä¸šåœ°äº§ï¼›è®¡åˆ’ç”¨5-10å¹´ï¼Œå•†ä¸šç‰©ä¸šæ”¶å…¥å æ¯”è¾¾åˆ°30%-50%ã€‚é€†å‘è¿ä½œåœ°äº§æŠ•èµ„å†¯ä»‘æŒ‡å‡ºï¼Œæ ¹æ®å†å²ç»éªŒï¼ŒGDPçš„å¢é•¿ã€åŸå¸‚åŒ–çš„å¢é•¿ï¼Œå’Œæˆ¿åœ°äº§ç‰©ä¸šå½¢æ€æœ‰ä¸€å®šå…³ç³»ï¼Œå³äººå‡GDPåœ¨8000ç¾å…ƒä»¥ä¸‹æ—¶ï¼Œä½å®…æ˜¯å¸‚åœºçš„æ ¸å¿ƒï¼Œä¸»æµäº§å“éƒ½å°†å›´ç»•ä½å®…å±•å¼€ã€‚ç›®å‰ï¼Œåœ¨ä¸­å›½çš„åŸå¸‚ä¸­ï¼Œäººå‡GDP8000ç¾å…ƒçš„åŸå¸‚å¤§çº¦æœ‰åä¸ªï¼Œå¤§éƒ¨åˆ†çœä¼šåŸå¸‚ä¾ç„¶åœ¨3000ç¾å…ƒè‡³5000ç¾å…ƒä¹‹é—´ï¼Œå› æ­¤ï¼Œæœªæ¥5-10å¹´ï¼Œä¸­å›½æˆ¿åœ°äº§å¸‚åœºçš„äº§å“ç»“æ„ä»ç„¶æ˜¯ä»¥ä½å®…ä¸ºä¸»ã€‚ å†¯ä»‘è®¤ä¸ºï¼Œä¸‡é€šåœ°äº§ä»ç°åœ¨å¼€å§‹æ‰©å¤§å•†ä¸šåœ°äº§çš„æ¯”é‡ï¼Œåœ¨ç›®å‰çš„å¸‚åœºä¸­ï¼Œæ˜¯ä¸€ç§é€†å‘è¿ä½œçš„æ€ç»´ï¼Œä½†ç¬¦åˆé•¿æœŸè¶‹åŠ¿ã€‚ä»–æŒ‡å‡ºï¼Œåœ¨äººå‡GDPè¾¾åˆ°8000ç¾å…ƒçš„ç»æµå®ä½“ä¸­ï¼Œå•†ç”¨ä¸åŠ¨äº§ä¼šæˆä¸ºåœ°äº§ä¸šçš„ä¸»è§’ã€‚ä»¥ç¾å›½ä¸ºä¾‹ï¼Œå•†ä¸šåœ°äº§çš„å¸‚åœºè§„æ¨¡å¤§çº¦æ˜¯ä½å®…çš„ä¸¤å€ã€‚ä¸­å›½å•†ä¸šåœ°äº§æœªæ¥çš„å¸‚åœºç©ºé—´å¾ˆå¤§ã€‚æ ¹æ®ä¸‡é€šåœ°äº§çš„å‘å±•æˆ˜ç•¥ï¼Œé™¤äº†åœ¨ç¯æ¸¤æµ·åŒºåŸŸå†…å‘å±•ä½å®…ä»¥å¤–ï¼Œè¿˜ä¼šé‡ç‚¹å‘å±•å•†ä¸šä¸åŠ¨äº§ã€‚æœªæ¥ï¼Œå…¬å¸ä¸šåŠ¡ç»“æ„å°†é€æ­¥è°ƒæ•´ï¼Œå•†ç”¨åœ°äº§çš„æ”¶å…¥ä¼šé€å¹´å¢åŠ ï¼›ä»Šåï¼Œå…¬å¸å•†ä¸šç‰©ä¸šæ”¶å…¥å°†å åˆ°æ•´ä½“è¥ä¸šæ”¶å…¥çš„ä¸€åŠå·¦å³ã€‚å¯¹äºç›®å‰å•†ä¸šåœ°äº§é¢ä¸´çš„ä¸æ™¯æ°”å±€é¢ï¼Œä¸‡é€šåœ°äº§è‘£äº‹ä¼šç§˜ä¹¦ç¨‹æ™“?æŒ‡å‡ºï¼Œå…¬å¸æˆ˜ç•¥ä¸ä¼šå› å¸‚åœºçš„çŸ­æœŸæ³¢åŠ¨è€Œæ”¹å˜ï¼Œå…¬å¸å°†ç»§ç»­åŠ å¤§å•†ç”¨ç‰©ä¸šé¡¹ç›®çš„æŠ•èµ„åŠ›åº¦ï¼Œä»¥è¥è¿å¸¦åŠ¨å¼€å‘ï¼Œä»¥è´¢åŠ¡å®‰æ’çš„å¤šæ ·åŒ–å®æ–½å•†ç”¨ç‰©ä¸šæŠ•èµ„ã€‚æ”¹å˜å•†ä¸šæ¨¡å¼å†¯ä»‘è¡¨ç¤ºï¼Œå°±æˆ¿åœ°äº§å¼€å‘æ¨¡å¼è€Œè¨€ï¼Œè¿‡å»ä¸¤ç™¾å¹´ä¸»è¦ç»å†äº†ä¸‰æ¬¡å˜åŒ–ï¼Œå³ä»â€œåœ°ä¸»åŠ å·¥å¤´â€åˆ°â€œå‚é•¿åŠ èµ„æœ¬å®¶â€ï¼Œå†åˆ°â€œå¯¼æ¼”åŠ åˆ¶ç‰‡â€ã€‚ç›®å‰ï¼Œå›½å†…å¤šæ•°åœ°äº§å•†çš„å¼€å‘æ¨¡å¼å±äºâ€œåœ°ä¸»åŠ å·¥å¤´â€å’Œâ€œå‚é•¿åŠ èµ„æœ¬å®¶â€çš„é˜¶æ®µï¼›è€Œå•†ä¸šåœ°äº§çš„å¼€å‘æ¨¡å¼ï¼Œä¸èƒ½åœç•™åœ¨è¿™ä¸¤ä¸ªé˜¶æ®µã€‚æ‰€è°“â€œå¯¼æ¼”åŠ åˆ¶ç‰‡â€æ¨¡å¼ï¼Œå³ç”±ä¸“ä¸šçš„æˆ¿åœ°äº§æŠ•èµ„å’Œèµ„äº§ç®¡ç†å…¬å¸è´Ÿè´£è¿è¥å•†ä¸šåœ°äº§é¡¹ç›®ï¼Œå®ç°æ”¶å…¥çš„å¤šå…ƒåŒ–ã€‚è€Œè¿™ç§æ¨¡å¼éœ€è¦ç›¸åº”çš„é‡‘èåˆ›æ–°äº§å“æ”¯æŒã€‚ä¸šå†…äººå£«æŒ‡å‡ºï¼Œæˆ¿åœ°äº§é‡‘èé¢†åŸŸå†…çš„REITSã€æŠµæŠ¼è´·æ¬¾ç­‰é‡‘èäº§å“ä½“ç³»çš„å®Œå–„ï¼Œå°†æ”¯æŒå•†ç”¨åœ°äº§åœ¨ä¸€ä¸ªå¤šå…ƒåŒ–çš„ä¸åŠ¨äº§ç»è¥ç¯å¢ƒä¸­å¿«é€Ÿçš„æˆé•¿ã€‚è€Œå•†ä¸šæ¨¡å¼çš„æ”¹å˜éœ€è¦è¾ƒé•¿ä¸€æ®µæ—¶é—´ã€‚æ•°æ®æ˜¾ç¤ºï¼Œé¦™æ¸¯ä¸»æµæˆ¿åœ°äº§ä¼ä¸šåœ¨äººå‡GDP10000ç¾å…ƒçš„æ—¶å€™å¼€å§‹é€æ­¥å‘å±•å•†ä¸šåœ°äº§ï¼Œå…ˆåç»è¿‡13-15å¹´ç¡®ç«‹èµ·æ–°çš„å•†ä¸šæ¨¡å¼ã€‚å…¶ä¸­ï¼Œé•¿æ±Ÿå®ä¸šç»è¿‡13å¹´çš„å‘å±•ï¼Œå•†ä¸šåœ°äº§åœ¨ä¸šåŠ¡æœºæ„çš„æ¯”é‡å åˆ°30%ï¼Œæ–°é¸¿åŸºåˆ™ç»è¿‡15å¹´çš„è°ƒæ•´ï¼Œå•†ä¸šåœ°äº§æ¯”é‡å åˆ°50%ã€‚SOHOä¸­å›½(ä¼ä¸šä¸“åŒº,æ——ä¸‹æ¥¼ç›˜)è‘£äº‹é•¿æ½˜çŸ³å±¹ä¹ŸæŒ‡å‡ºï¼Œç°åœ¨çš„å¸‚åœºè™½ç„¶åœ¨è°ƒæ•´ï¼Œä¸è¿‡ä¹Ÿç»™ä»äº‹å•†ä¸šåœ°äº§å¼€å‘çš„ä¼ä¸šæä¾›äº†è‰¯å¥½æœºä¼šå’Œå¹³å°ï¼Œåº”åŠæ—¶åœ¨åœ°åŸŸã€å¼€å‘ç‰©ä¸šçš„å“ç§ã€å“ç‰Œçš„å»ºè®¾ã€é”€å”®å’ŒæŒæœ‰ç‰©ä¸šçš„æ¯”é‡å››ä¸ªæ–¹é¢åšå‡ºè°ƒæ•´ã€‚ æˆ‘è¦è¯„è®º</td>
<td>5000</td>
</tr>
<tr>
<td>æ•™è‚²</td>
<td>2010å¹´6æœˆè‹±è¯­å…­çº§è€ƒè¯•è€ƒåéš¾åº¦è°ƒæŸ¥2010å¹´6æœˆå¤§å­¦è‹±è¯­å…­çº§è€ƒè¯•å°†äº19æ—¥ä¸‹åˆä¸¾è¡Œï¼Œæ¬¢è¿å„ä½è€ƒç”Ÿåœ¨è€ƒè¯•åå‚åŠ éš¾åº¦è°ƒæŸ¥ï¼Œå‘è¡¨ä½ å¯¹è¿™æ¬¡è€ƒè¯•çš„çœ‹æ³•ã€‚ç‚¹å‡»è¿›å…¥è®ºå›ï¼Œå‚ä¸è€ƒåå¤§è®¨è®º</td>
<td>5000</td>
</tr>
<tr>
<td>æ—¶å°š</td>
<td>ç»„å›¾ï¼šèè‰æ½®äººç¤ºèŒƒæ˜¥å­£å¤å¤å®ç©¿å¯¼è¯­ï¼šèè‰æ½®äººç¤ºèŒƒæ˜¥å­£å¤å¤å®ç©¿ï¼Œåœ¨ä¹æš–è¿˜å¯’çš„åˆæ˜¥ï¼Œæœ‰çš„ç”œç¾ã€æœ‰çš„ä¼˜é›…ã€æœ‰çš„æ€§æ„Ÿï¼Œä½†æ— è®ºæ˜¯å“ªç§é£æ ¼éƒ½ç»™äººå¼ºçƒˆçš„è§†è§‰å†²å‡»åŠ›ï¼Œåœ¨è¿™ä¸ªç¼¤çº·çš„æ˜¥å­£æ›´åŠ è„±ä¿—åŠ¨äººã€‚</td>
<td>5000</td>
</tr>
<tr>
<td>æ—¶æ”¿</td>
<td>é¦™æ¸¯ç‰¹åŒºè¡Œæ”¿é•¿å®˜æ›¾è«æƒå°†ç¦»æ¸¯ä¼‘å‡ä¸­æ–°ç¤¾é¦™æ¸¯å…«æœˆä¸ƒæ—¥ç”µ é¦™æ¸¯ç‰¹åŒºè¡Œæ”¿é•¿å®˜æ›¾è«æƒå°†äºå…«æœˆä¹æ—¥è‡³åäº”æ—¥ç¦»æ¸¯ä¼‘å‡ã€‚ç‰¹åŒºæ”¿åºœå‘è¨€äººä¸ƒæ—¥é€éœ²ï¼Œæ›¾è«æƒç¦»æ¸¯æœŸé—´ï¼Œå…«æœˆä¹æ—¥ç”±ç‰¹åŒºè´¢æ”¿å¸å¸é•¿æ›¾ä¿Šåç½²ç†è¡Œæ”¿é•¿å®˜èŒåŠ¡ï¼›å…«æœˆåæ—¥è‡³åäº”æ—¥ç”±æ”¿åŠ¡å¸å¸é•¿å”è‹±å¹´ç½²ç†è¡Œæ”¿é•¿å®˜èŒåŠ¡ã€‚(å®Œ)</td>
<td>5000</td>
</tr>
<tr>
<td>æ¸¸æˆ</td>
<td>å…¨å›½äººå¤§å¸¸å§”ä¼šå°†å¯¹59ä»¶æ³•å¾‹ç›¸å…³æ¡æ–‡ä½œå‡ºä¿®æ”¹æ–°åç¤¾å¿«è®¯ï¼šå…¨å›½äººå¤§å¸¸å§”ä¼š27æ—¥è¡¨å†³é€šè¿‡äº†å…³äºä¿®æ”¹éƒ¨åˆ†æ³•å¾‹çš„å†³å®šï¼Œå¯¹59ä»¶æ³•å¾‹çš„ç›¸å…³æ¡æ–‡ä½œå‡ºä¿®æ”¹ã€‚</td>
<td>5000</td>
</tr>
<tr>
<td>ç§‘æŠ€</td>
<td>å…¥é—¨çº§æ—¶å°šå¡ç‰‡æœº å°¼åº·S220å¥—è£…ä»…1150å°¼åº·S220å»¶ç»­äº†Sç³»åˆ—çº¤å·§è¶…è–„çš„æœºèº«è®¾è®¡ï¼Œé‡‡ç”¨é“åˆé‡‘æè´¨æ‰“é€ ï¼Œè¡¨é¢è´¨åœ°ç»†è…»ï¼Œä¸æ˜“æ²¾æŸ“æŒ‡çº¹ã€‚S220æ‹¥æœ‰ç´«è‰²ã€æ·±è“ã€æ´‹çº¢ã€æ°´æ™¶ç»¿å’ŒæŸ”é“¶äº”æ¬¾é“ä¸½é¢œè‰²å¯ä¾›é€‰æ‹©ã€‚</td>
<td>5000</td>
</tr>
</tbody>
</table>
</div>
<p>ä½¿ç”¨æœç‹—æ–°é—»è¯å‘é‡å’Œå­—å‘é‡ï¼Œ300dï¼š<a href="https://pan.baidu.com/s/1svFOwFBKnnlsqrF1t99Lnw" target="_blank" rel="noopener">è¯å‘é‡</a>,<a href="https://pan.baidu.com/s/1tUghuTno5yOvOx4LXA9-wg" target="_blank" rel="noopener">å­—å‘é‡</a></p>
<h3 id="æ•°æ®å¤„ç†ä»£ç ï¼ˆå¾®åšï¼‰"><a href="#æ•°æ®å¤„ç†ä»£ç ï¼ˆå¾®åšï¼‰" class="headerlink" title="æ•°æ®å¤„ç†ä»£ç ï¼ˆå¾®åšï¼‰"></a>æ•°æ®å¤„ç†ä»£ç ï¼ˆå¾®åšï¼‰</h3><h4 id="DataSet"><a href="#DataSet" class="headerlink" title="DataSet"></a>DataSet</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeiboDataset</span><span class="params">(NLPDataset)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,data_path,test=False,stop_words_path=None,batch_first=False,include_lengths=False,tokenizer_language=<span class="string">'cn'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param data_path:</span></span><br><span class="line"><span class="string">        :param test: å¦‚æœä¸ºæµ‹è¯•é›†ï¼Œåˆ™ä¸åŠ è½½label</span></span><br><span class="line"><span class="string">        :param stop_words_path:</span></span><br><span class="line"><span class="string">        :param batch_first:</span></span><br><span class="line"><span class="string">        :param include_lengths:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.data = pd.read_csv(data_path)</span><br><span class="line">        print(<span class="string">'read data from &#123;&#125;'</span>.format(data_path))</span><br><span class="line">        self.text_field = <span class="string">"review"</span></span><br><span class="line">        self.label_field = <span class="string">"label"</span></span><br><span class="line">        self.test = test</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> stop_words_path:</span><br><span class="line">            stop_words = read_stop_words(stop_words_path)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            stop_words = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        self.LABEL = LabelField(sequential=<span class="literal">False</span>, use_vocab=<span class="literal">False</span>, dtype=torch.float)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># lambda x: [y for y in x]</span></span><br><span class="line">        self.TEXT = Field(sequential=<span class="literal">True</span>,stop_words=stop_words, tokenize=<span class="keyword">lambda</span> x: [y <span class="keyword">for</span> y <span class="keyword">in</span> x], batch_first=batch_first,tokenizer_language=tokenizer_language,</span><br><span class="line">                          include_lengths=include_lengths)  <span class="comment"># include_lengths=True for LSTM</span></span><br><span class="line"></span><br><span class="line">        self.fields = [(<span class="string">"text"</span>, self.TEXT), (<span class="string">"label"</span>, self.LABEL)]</span><br><span class="line"></span><br><span class="line">        self.examples = self.build_examples()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_examples</span><span class="params">(self)</span>:</span></span><br><span class="line">        examples = []</span><br><span class="line">        <span class="keyword">if</span> self.test:</span><br><span class="line">            <span class="comment"># å¦‚æœä¸ºæµ‹è¯•é›†ï¼Œåˆ™ä¸åŠ è½½label</span></span><br><span class="line">            <span class="keyword">for</span> text <span class="keyword">in</span> tqdm(self.data[self.text_field]):</span><br><span class="line">                examples.append(Example.fromlist([text, <span class="literal">None</span>], self.fields))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> text, label <span class="keyword">in</span> tqdm(zip(self.data[self.text_field], self.data[self.label_field])):</span><br><span class="line">                <span class="comment"># Example: Defines a single training or test example.</span></span><br><span class="line">                <span class="comment"># Stores each column of the example as an attribute.</span></span><br><span class="line">                examples.append(Example.fromlist([text, label], self.fields))</span><br><span class="line">        <span class="keyword">return</span> examples</span><br></pre></td></tr></table></figure>
<h4 id="dataloader"><a href="#dataloader" class="headerlink" title="dataloader"></a>dataloader</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeiboDataLoader</span><span class="params">(NLPDataLoader)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,dataset,split_ratio=None, batch_size=<span class="number">64</span>, sort_key=None, device=None,train=True, repeat=False, shuffle=None, sort=None,sort_within_batch=False,</span></span></span><br><span class="line"><span class="function"><span class="params">                 batch_size_fn=None,  use_pretrained_word_embedding=False, word_embedding_path=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å¾®åšäºŒåˆ†ç±»æ•°æ®é›†åŠ è½½å™¨</span></span><br><span class="line"><span class="string">        :param dataset:</span></span><br><span class="line"><span class="string">        :param split_ratio:</span></span><br><span class="line"><span class="string">        :param batch_size:</span></span><br><span class="line"><span class="string">        :param device:</span></span><br><span class="line"><span class="string">        :param train: Whether the iterator represents a train set</span></span><br><span class="line"><span class="string">        :param repeat:</span></span><br><span class="line"><span class="string">        :param shuffle:</span></span><br><span class="line"><span class="string">        :param sort:</span></span><br><span class="line"><span class="string">        :param sort_within_batch:</span></span><br><span class="line"><span class="string">        :param use_pretrained_word_embedding:</span></span><br><span class="line"><span class="string">        :param word_embedding_path:</span></span><br><span class="line"><span class="string">        :param vocab_size:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># æ„å»ºæ•°æ®é›†</span></span><br><span class="line">        self.dataset = dataset</span><br><span class="line">        <span class="comment"># è¿­ä»£å™¨å‚æ•°</span></span><br><span class="line">        self.split_ratio = split_ratio</span><br><span class="line">        self.batch_size = batch_size</span><br><span class="line">        self.sort_key = sort_key</span><br><span class="line">        self.device = device</span><br><span class="line">        self.batch_size_fn = batch_size_fn</span><br><span class="line">        self.train = train</span><br><span class="line">        self.repeat = repeat</span><br><span class="line">        self.shuffle = shuffle</span><br><span class="line">        self.sort = sort</span><br><span class="line">        self.sort_within_batch = sort_within_batch</span><br><span class="line">        self.use_pretrained_word_embedding = use_pretrained_word_embedding</span><br><span class="line">        self.word_embedding_path = word_embedding_path</span><br><span class="line">        self.train_iter, self.valid_iter, self.test_iter = self.get_iterators()</span><br><span class="line">        self.vocab = self.dataset.TEXT.vocab</span><br><span class="line">        self.vocab.pad_index = self.dataset.TEXT.vocab.stoi[self.dataset.TEXT.pad_token]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_iterators</span><span class="params">(self)</span>:</span></span><br><span class="line">        train_iter, valid_iter, test_iter = <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.split_ratio:</span><br><span class="line">            <span class="comment"># æ„å»ºè¯æ±‡è¡¨</span></span><br><span class="line">            <span class="keyword">if</span> self.use_pretrained_word_embedding:</span><br><span class="line">                vectors = Vectors(name=self.word_embedding_path)  <span class="comment"># ä½¿ç”¨é¢„è®­ç»ƒçš„è¯å‘é‡</span></span><br><span class="line">                self.dataset.TEXT.build_vocab(self.dataset, vectors=vectors,</span><br><span class="line">                                              unk_init=torch.Tensor.normal_)</span><br><span class="line">                self.dataset.LABEL.build_vocab(self.dataset)</span><br><span class="line">                print(<span class="string">'label types:&#123;&#125;'</span>.format(self.dataset.LABEL.vocab.stoi))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.dataset.TEXT.build_vocab(self.dataset)  <span class="comment"># ä¸ä½¿ç”¨é¢„è®­ç»ƒçš„è¯å‘é‡</span></span><br><span class="line">                self.dataset.LABEL.build_vocab(self.dataset)</span><br><span class="line">                print(<span class="string">'label types:&#123;&#125;'</span>.format(self.dataset.LABEL.vocab.stoi))</span><br><span class="line"></span><br><span class="line">            train_iter = Iterator(self.dataset, batch_size=self.batch_size, device=self.device, sort_key=self.sort_key,</span><br><span class="line">                                  sort_within_batch=self.sort_within_batch, repeat=self.repeat,</span><br><span class="line">                                  batch_size_fn=self.batch_size_fn</span><br><span class="line">                                  , train=self.train, shuffle=self.shuffle, sort=self.sort)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            train_data, valid_data, test_data = <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> isinstance(self.split_ratio, list):</span><br><span class="line">                <span class="keyword">if</span> len(self.split_ratio) == <span class="number">3</span>:</span><br><span class="line">                    train_data, valid_data, test_data = self.dataset.split(split_ratio=self.split_ratio)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    train_data, valid_data = self.dataset.split(split_ratio=self.split_ratio)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                train_data, valid_data = self.dataset.split(split_ratio=self.split_ratio)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ„å»ºè¯æ±‡è¡¨</span></span><br><span class="line">            <span class="keyword">if</span> self.use_pretrained_word_embedding:</span><br><span class="line">                vectors = Vectors(name=self.word_embedding_path)  <span class="comment"># ä½¿ç”¨é¢„è®­ç»ƒçš„è¯å‘é‡</span></span><br><span class="line">                self.dataset.TEXT.build_vocab(train_data, vectors=vectors,</span><br><span class="line">                                              unk_init=torch.Tensor.normal_)</span><br><span class="line">                self.dataset.LABEL.build_vocab(train_data)</span><br><span class="line">                print(<span class="string">'label types:&#123;&#125;'</span>.format(self.dataset.LABEL.vocab.stoi))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.dataset.TEXT.build_vocab(train_data)  <span class="comment"># ä¸ä½¿ç”¨é¢„è®­ç»ƒçš„è¯å‘é‡</span></span><br><span class="line">                self.dataset.LABEL.build_vocab(train_data)</span><br><span class="line">                print(<span class="string">'label types:&#123;&#125;'</span>.format(self.dataset.LABEL.vocab.stoi))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ„å»ºè¿­ä»£å™¨</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> train_data:</span><br><span class="line">                train_iter = Iterator(train_data, batch_size=self.batch_size, device=self.device,</span><br><span class="line">                                      sort_key=self.sort_key,</span><br><span class="line">                                      sort_within_batch=self.sort_within_batch, repeat=self.repeat,</span><br><span class="line">                                      batch_size_fn=self.batch_size_fn</span><br><span class="line">                                      , train=self.train, shuffle=self.shuffle, sort=self.sort)</span><br><span class="line">            <span class="keyword">if</span> valid_data:</span><br><span class="line">                valid_iter = Iterator(valid_data, batch_size=self.batch_size, device=self.device,</span><br><span class="line">                                      sort_key=self.sort_key,</span><br><span class="line">                                      sort_within_batch=self.sort_within_batch, repeat=self.repeat,</span><br><span class="line">                                      batch_size_fn=self.batch_size_fn</span><br><span class="line">                                      , train=self.train, shuffle=self.shuffle, sort=self.sort)</span><br><span class="line">            <span class="keyword">if</span> test_data:</span><br><span class="line">                test_iter = Iterator(test_data, batch_size=self.batch_size, device=self.device, sort_key=self.sort_key,</span><br><span class="line">                                     sort_within_batch=self.sort_within_batch, repeat=self.repeat,</span><br><span class="line">                                     batch_size_fn=self.batch_size_fn</span><br><span class="line">                                     , train=self.train, shuffle=self.shuffle, sort=self.sort)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> train_iter, valid_iter, test_iter</span><br></pre></td></tr></table></figure>
<h4 id="Vocabå±æ€§ï¼š"><a href="#Vocabå±æ€§ï¼š" class="headerlink" title="Vocabå±æ€§ï¼š"></a>Vocabå±æ€§ï¼š</h4><ol>
<li>freqs</li>
<li>itos</li>
<li>stoi</li>
<li>vectors</li>
</ol>
<h4 id="Bert-Dataprocess"><a href="#Bert-Dataprocess" class="headerlink" title="Bert Dataprocess"></a>Bert Dataprocess</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertDataProcess</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data_path, batch_size, device, processed_data_path=None, bert_model_path=None)</span>:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        self.bert_model_path = bert_model_path</span><br><span class="line">        self.bert_tokenizer = BertTokenizer.from_pretrained(bert_model_path)</span><br><span class="line">        self.CLS = self.bert_tokenizer.cls_token</span><br><span class="line">        self.data_path = data_path</span><br><span class="line">        self.batch_size = batch_size</span><br><span class="line">        self.device = device</span><br><span class="line">        self.processed_data_path = processed_data_path  <span class="comment"># ç»è¿‡load_data å¤„ç†è¿‡çš„æ•°æ®ä¿å­˜åˆ°è¯¥è·¯å¾„ä¸‹ã€‚</span></span><br><span class="line">        self.train_data,self.val_data = self.built_dataset()</span><br><span class="line">        self.train_iter = self.built_iterater(self.train_data)</span><br><span class="line">        self.val_iter = self.built_iterater(self.val_data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load_dataset</span><span class="params">(self, path)</span>:</span></span><br><span class="line">        contents = []</span><br><span class="line">        <span class="keyword">with</span> open(path, <span class="string">'r'</span>, encoding=<span class="string">'UTF-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> tqdm(f):</span><br><span class="line">                lin = line.strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="string">'label,review'</span> <span class="keyword">in</span> lin:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> lin:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                label, content = lin.split(<span class="string">','</span>,<span class="number">1</span>)</span><br><span class="line">                <span class="comment"># print("content&gt;&gt;&gt;:", content)</span></span><br><span class="line">                token = self.bert_tokenizer.tokenize(content)</span><br><span class="line">                token = [self.CLS] + token</span><br><span class="line">                seq_len = len(token)</span><br><span class="line">                token_ids = self.bert_tokenizer.convert_tokens_to_ids(token)</span><br><span class="line">                contents.append((token_ids, int(label), seq_len))</span><br><span class="line">        <span class="keyword">return</span> contents</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">built_dataset</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.processed_data_path):</span><br><span class="line">            all_data = self.load_dataset(self.data_path)</span><br><span class="line">            pickle.dump(all_data, open(self.processed_data_path,<span class="string">'wb'</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            all_data = pickle.load(open(self.processed_data_path,<span class="string">'rb'</span>))</span><br><span class="line"></span><br><span class="line">        train_data, val_data = train_test_split(all_data, test_size=<span class="number">0.3</span>, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> train_data, val_data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">built_iterater</span><span class="params">(self, dataset)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> BertDatasetIterater(dataset, self.batch_size, self.device,self.bert_model_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertDatasetIterater</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, batches, batch_size, device,bert_model_path)</span>:</span></span><br><span class="line">        self.bert_tokenizer = BertTokenizer.from_pretrained(bert_model_path)</span><br><span class="line"></span><br><span class="line">        self.batch_size = batch_size</span><br><span class="line">        self.batches = batches</span><br><span class="line">        self.n_batches = len(batches) // batch_size</span><br><span class="line">        self.residue = <span class="literal">False</span>  <span class="comment"># è®°å½•batchæ•°é‡æ˜¯å¦ä¸ºæ•´æ•°</span></span><br><span class="line">        <span class="keyword">if</span> len(batches) % self.n_batches != <span class="number">0</span>:</span><br><span class="line">            self.residue = <span class="literal">True</span></span><br><span class="line">        self.index = <span class="number">0</span></span><br><span class="line">        self.device = device</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_mask_sentence_len</span><span class="params">(self,content,max_sent_len)</span>:</span></span><br><span class="line">        pad_index = self.bert_tokenizer.pad_token_id</span><br><span class="line">        sent_len = len(content)</span><br><span class="line">        mask = [<span class="number">1</span>]*sent_len + ([<span class="number">0</span>] * (max_sent_len-sent_len))</span><br><span class="line">        content = content.extend([pad_index] * (max_sent_len-sent_len))</span><br><span class="line">        <span class="keyword">return</span> mask</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_to_tensor</span><span class="params">(self, datas)</span>:</span></span><br><span class="line">        datas = pd.DataFrame(datas,columns=[<span class="string">'content'</span>,<span class="string">'label'</span>,<span class="string">'sent len'</span>])</span><br><span class="line">        max_sent_len = max(datas[<span class="string">'sent len'</span>])</span><br><span class="line">        datas[<span class="string">"mask"</span>] = datas[<span class="string">"content"</span>].apply(self._mask_sentence_len,args=&#123;max_sent_len&#125;)</span><br><span class="line"></span><br><span class="line">        x = torch.LongTensor(pd.DataFrame(datas[<span class="string">'content'</span>].to_list()).values).to(self.device)</span><br><span class="line">        y = torch.FloatTensor(datas[<span class="string">'label'</span>].values).to(self.device)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># padå‰çš„é•¿åº¦(è¶…è¿‡pad_sizeçš„è®¾ä¸ºpad_size)</span></span><br><span class="line">        seq_len = torch.LongTensor(datas[<span class="string">'sent len'</span>]).to(self.device)</span><br><span class="line">        mask = torch.LongTensor(pd.DataFrame(datas[<span class="string">'mask'</span>].to_list()).values).to(self.device)</span><br><span class="line">        <span class="keyword">return</span> (x, seq_len, mask), y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.residue <span class="keyword">and</span> self.index == self.n_batches:</span><br><span class="line">            batches = self.batches[self.index * self.batch_size: len(self.batches)]</span><br><span class="line">            self.index += <span class="number">1</span></span><br><span class="line">            batches = self._to_tensor(batches)</span><br><span class="line">            <span class="keyword">return</span> batches</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> self.index &gt; self.n_batches:</span><br><span class="line">            self.index = <span class="number">0</span></span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            batches = self.batches[self.index * self.batch_size: (self.index + <span class="number">1</span>) * self.batch_size]</span><br><span class="line">            self.index += <span class="number">1</span></span><br><span class="line">            batches = self._to_tensor(batches)</span><br><span class="line">            <span class="keyword">return</span> batches</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.residue:</span><br><span class="line">            <span class="keyword">return</span> self.n_batches + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self.n_batches</span><br></pre></td></tr></table></figure>
<h3 id="FastText"><a href="#FastText" class="headerlink" title="FastText"></a>FastText</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>fastTextæ˜¯Facebookäº2016å¹´å¼€æºçš„ä¸€ä¸ªè¯å‘é‡è®¡ç®—å’Œæ–‡æœ¬åˆ†ç±»å·¥å…·ã€‚åœ¨æ–‡æœ¬åˆ†ç±»ä»»åŠ¡ä¸­ï¼ŒfastTextï¼ˆæµ…å±‚ç½‘ç»œï¼‰å¾€å¾€èƒ½å–å¾—å’Œæ·±åº¦ç½‘ç»œç›¸åª²ç¾çš„ç²¾åº¦ï¼Œå´åœ¨è®­ç»ƒæ—¶é—´ä¸Šæ¯”æ·±åº¦ç½‘ç»œå¿«è®¸å¤šæ•°é‡çº§ã€‚åœ¨æ ‡å‡†çš„å¤šæ ¸CPUä¸Šï¼Œ åœ¨10åˆ†é’Ÿä¹‹å†…èƒ½å¤Ÿè®­ç»ƒ10äº¿è¯çº§åˆ«è¯­æ–™åº“çš„è¯å‘é‡ï¼Œåœ¨1åˆ†é’Ÿä¹‹å†…èƒ½å¤Ÿåˆ†ç±»æœ‰ç€30ä¸‡å¤šç±»åˆ«çš„50å¤šä¸‡å¥å­ã€‚</p>
<p>fastTextæ˜¯ä¸€ä¸ªå¿«é€Ÿæ–‡æœ¬åˆ†ç±»ç®—æ³•ï¼Œä¸åŸºäºç¥ç»ç½‘ç»œçš„åˆ†ç±»ç®—æ³•ç›¸æ¯”æœ‰ä¸¤å¤§ä¼˜ç‚¹ï¼š<br>1ã€fastTextåœ¨ä¿æŒé«˜ç²¾åº¦çš„æƒ…å†µä¸‹åŠ å¿«äº†è®­ç»ƒé€Ÿåº¦å’Œæµ‹è¯•é€Ÿåº¦<br>2ã€fastTextä¸éœ€è¦é¢„è®­ç»ƒå¥½çš„è¯å‘é‡ï¼ŒfastTextä¼šè‡ªå·±è®­ç»ƒè¯å‘é‡<br>3ã€fastTextä¸¤ä¸ªé‡è¦çš„ä¼˜åŒ–ï¼šHierarchical Softmaxã€N-gram</p>
<h4 id="fastTextæ¨¡å‹æ¶æ„"><a href="#fastTextæ¨¡å‹æ¶æ„" class="headerlink" title="fastTextæ¨¡å‹æ¶æ„"></a>fastTextæ¨¡å‹æ¶æ„</h4><p>fastTextæ¨¡å‹æ¶æ„å’Œword2vecä¸­çš„CBOWå¾ˆç›¸ä¼¼ï¼Œ ä¸åŒä¹‹å¤„æ˜¯fastTexté¢„æµ‹æ ‡ç­¾è€ŒCBOWé¢„æµ‹çš„æ˜¯ä¸­é—´è¯ï¼Œå³æ¨¡å‹æ¶æ„ç±»ä¼¼ä½†æ˜¯æ¨¡å‹çš„ä»»åŠ¡ä¸åŒã€‚ä¸‹é¢æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹CBOWçš„æ¶æ„ï¼š</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/cbow.png" alt="avatar"></p>
<p>word2vecå°†ä¸Šä¸‹æ–‡å…³ç³»è½¬åŒ–ä¸ºå¤šåˆ†ç±»ä»»åŠ¡ï¼Œè¿›è€Œè®­ç»ƒé€»è¾‘å›å½’æ¨¡å‹ï¼Œè¿™é‡Œçš„ç±»åˆ«æ•°é‡|V|è¯åº“å¤§å°ã€‚é€šå¸¸çš„æ–‡æœ¬æ•°æ®ä¸­ï¼Œè¯åº“å°‘åˆ™æ•°ä¸‡ï¼Œå¤šåˆ™ç™¾ä¸‡ï¼Œåœ¨è®­ç»ƒä¸­ç›´æ¥è®­ç»ƒå¤šåˆ†ç±»é€»è¾‘å›å½’å¹¶ä¸ç°å®ã€‚word2vecä¸­æä¾›äº†ä¸¤ç§é’ˆå¯¹å¤§è§„æ¨¡å¤šåˆ†ç±»é—®é¢˜çš„ä¼˜åŒ–æ‰‹æ®µï¼Œ negative sampling å’Œhierarchical softmaxã€‚åœ¨ä¼˜åŒ–ä¸­ï¼Œnegative sampling åªæ›´æ–°å°‘é‡è´Ÿé¢ç±»ï¼Œä»è€Œå‡è½»äº†è®¡ç®—é‡ã€‚hierarchical softmax å°†è¯åº“è¡¨ç¤ºæˆå‰ç¼€æ ‘ï¼Œä»æ ‘æ ¹åˆ°å¶å­çš„è·¯å¾„å¯ä»¥è¡¨ç¤ºä¸ºä¸€ç³»åˆ—äºŒåˆ†ç±»å™¨ï¼Œä¸€æ¬¡å¤šåˆ†ç±»è®¡ç®—çš„å¤æ‚åº¦ä»|V|é™ä½åˆ°äº†æ ‘çš„é«˜åº¦<br>fastTextæ¨¡å‹æ¶æ„:å…¶ä¸­x1,x2,â€¦,xNâˆ’1,xNè¡¨ç¤ºä¸€ä¸ªæ–‡æœ¬ä¸­çš„n-gramå‘é‡ï¼Œæ¯ä¸ªç‰¹å¾æ˜¯è¯å‘é‡çš„å¹³å‡å€¼ã€‚è¿™å’Œå‰æ–‡ä¸­æåˆ°çš„cbowç›¸ä¼¼ï¼Œcbowç”¨ä¸Šä¸‹æ–‡å»é¢„æµ‹ä¸­å¿ƒè¯ï¼Œè€Œæ­¤å¤„ç”¨å…¨éƒ¨çš„n-gramå»é¢„æµ‹æŒ‡å®šç±»åˆ«</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/fasttext.png" alt="avatar"></p>
<h4 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h4><blockquote>
<p>æˆ‘ä¸å–œæ¬¢è¿™ç±»ç”µå½±ï¼Œä½†æ˜¯å–œæ¬¢è¿™ä¸€ä¸ªã€‚</p>
<p>æˆ‘å–œæ¬¢è¿™ç±»ç”µå½±ï¼Œä½†æ˜¯ä¸å–œæ¬¢è¿™ä¸€ä¸ªã€‚</p>
</blockquote>
<p><strong>è¿™æ ·çš„ä¸¤å¥å¥å­ç»è¿‡è¯å‘é‡å¹³å‡ä»¥åå·²ç»é€å…¥å•å±‚ç¥ç»ç½‘ç»œçš„æ—¶å€™å·²ç»å®Œå…¨ä¸€æ¨¡ä¸€æ ·äº†ï¼Œåˆ†ç±»å™¨ä¸å¯èƒ½åˆ†è¾¨å‡ºè¿™ä¸¤å¥è¯çš„åŒºåˆ«</strong>ï¼Œåªæœ‰æ·»åŠ n-gramç‰¹å¾ä»¥åæ‰å¯èƒ½æœ‰åŒºåˆ«ã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨çš„æ—¶å€™éœ€è¦å¯¹æ•°æ®æœ‰è¶³å¤Ÿçš„äº†è§£,ç„¶ååœ¨é€‰æ‹©æ¨¡å‹ã€‚</p>
<h4 id="æ¨¡å‹ä»£ç "><a href="#æ¨¡å‹ä»£ç " class="headerlink" title="æ¨¡å‹ä»£ç "></a>æ¨¡å‹ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FastText</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab, embedding_dim, output_dim, use_pretrain_embedding=False)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.embedding_dim = embedding_dim</span><br><span class="line">        <span class="keyword">if</span> use_pretrain_embedding:</span><br><span class="line">            self.embedding = nn.Embedding.from_pretrained(vocab.vectors)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.embedding = nn.Embedding(len(vocab), embedding_dim, padding_idx=vocab.pad_index)</span><br><span class="line">        <span class="comment"># æŠŠunknown å’Œ pad å‘é‡è®¾ç½®ä¸ºé›¶</span></span><br><span class="line">        self.embedding.weight.data[vocab.unk_index] = torch.zeros(embedding_dim)</span><br><span class="line">        self.embedding.weight.data[vocab.pad_index] = torch.zeros(embedding_dim)</span><br><span class="line"></span><br><span class="line">        self.fc = nn.Linear(embedding_dim, output_dim)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text,text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text = [sent len, batch size]</span></span><br><span class="line"></span><br><span class="line">        embedded = self.embedding(text)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [sent len, batch size, emb dim]</span></span><br><span class="line"></span><br><span class="line">        embedded = embedded.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [batch size, sent len, emb dim]</span></span><br><span class="line"></span><br><span class="line">        pooled = F.avg_pool2d(embedded, (embedded.shape[<span class="number">1</span>], <span class="number">1</span>)).squeeze(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pooled = [batch size, embedding_dim]</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.fc(pooled)</span><br></pre></td></tr></table></figure>
<h3 id="TextCNN"><a href="#TextCNN" class="headerlink" title="TextCNN"></a>TextCNN</h3><h4 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p><strong>Yoon Kim</strong>åœ¨è®ºæ–‡<a href="https://arxiv.org/abs/1408.5882" target="_blank" rel="noopener">(2014 EMNLP) Convolutional Neural Networks for Sentence Classification</a>æå‡ºTextCNNã€‚</p>
<p>å°†<strong>å·ç§¯ç¥ç»ç½‘ç»œCNN</strong>åº”ç”¨åˆ°<strong>æ–‡æœ¬åˆ†ç±»</strong>ä»»åŠ¡ï¼Œåˆ©ç”¨<strong>å¤šä¸ªä¸åŒsizeçš„kernel</strong>æ¥æå–å¥å­ä¸­çš„å…³é”®ä¿¡æ¯ï¼ˆç±»ä¼¼äºå¤šçª—å£å¤§å°çš„ngram)ï¼Œä»è€Œèƒ½å¤Ÿæ›´å¥½åœ°æ•æ‰å±€éƒ¨ç›¸å…³æ€§ã€‚</p>
<h4 id="ç½‘ç»œç»“æ„"><a href="#ç½‘ç»œç»“æ„" class="headerlink" title="ç½‘ç»œç»“æ„"></a>ç½‘ç»œç»“æ„</h4><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/textcnn.png" alt="avatar"></p>
<h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>TextCNNçš„è¯¦ç»†è¿‡ç¨‹åŸç†å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/textcnndetail.png" alt="avatar"></p>
<p>TextCNNè¯¦ç»†è¿‡ç¨‹ï¼š</p>
<ul>
<li><strong>Embedding</strong>ï¼šç¬¬ä¸€å±‚æ˜¯å›¾ä¸­æœ€å·¦è¾¹çš„7ä¹˜5çš„å¥å­çŸ©é˜µï¼Œæ¯è¡Œæ˜¯è¯å‘é‡ï¼Œç»´åº¦=5ï¼Œè¿™ä¸ªå¯ä»¥ç±»æ¯”ä¸ºå›¾åƒä¸­çš„åŸå§‹åƒç´ ç‚¹ã€‚</li>
<li><strong>Convolution</strong>ï¼šç„¶åç»è¿‡ kernel_sizes=(2,3,4) çš„ä¸€ç»´å·ç§¯å±‚ï¼Œæ¯ä¸ªkernel_size æœ‰ä¸¤ä¸ªè¾“å‡º channelã€‚</li>
<li><strong>MaxPolling</strong>ï¼šç¬¬ä¸‰å±‚æ˜¯ä¸€ä¸ª1-max poolingå±‚ï¼Œè¿™æ ·ä¸åŒé•¿åº¦å¥å­ç»è¿‡poolingå±‚ä¹‹åéƒ½èƒ½å˜æˆå®šé•¿çš„è¡¨ç¤ºã€‚</li>
<li><p><strong>FullConnection and Softmax</strong>ï¼šæœ€åæ¥ä¸€å±‚å…¨è¿æ¥çš„ softmax å±‚ï¼Œè¾“å‡ºæ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ã€‚</p>
<p>é€šé“ï¼ˆChannelsï¼‰ï¼š</p>
</li>
<li><p>å›¾åƒä¸­å¯ä»¥åˆ©ç”¨ (R, G, B) ä½œä¸ºä¸åŒchannelï¼›</p>
</li>
<li>æ–‡æœ¬çš„è¾“å…¥çš„channelé€šå¸¸æ˜¯ä¸åŒæ–¹å¼çš„embeddingæ–¹å¼ï¼ˆæ¯”å¦‚ word2vecæˆ–Gloveï¼‰ï¼Œå®è·µä¸­ä¹Ÿæœ‰åˆ©ç”¨é™æ€è¯å‘é‡å’Œfine-tunningè¯å‘é‡ä½œä¸ºä¸åŒchannelçš„åšæ³•ã€‚</li>
</ul>
<p>ä¸€ç»´å·ç§¯ï¼ˆconv-1dï¼‰ï¼š</p>
<ul>
<li>å›¾åƒæ˜¯äºŒç»´æ•°æ®ï¼›</li>
<li><strong>æ–‡æœ¬æ˜¯ä¸€ç»´æ•°æ®ï¼Œå› æ­¤åœ¨TextCNNå·ç§¯ç”¨çš„æ˜¯ä¸€ç»´å·ç§¯</strong>ï¼ˆåœ¨<strong>word-level</strong>ä¸Šæ˜¯ä¸€ç»´å·ç§¯ï¼›è™½ç„¶æ–‡æœ¬ç»è¿‡è¯å‘é‡è¡¨è¾¾åæ˜¯äºŒç»´æ•°æ®ï¼Œä½†æ˜¯åœ¨embedding-levelä¸Šçš„äºŒç»´å·ç§¯æ²¡æœ‰æ„ä¹‰ï¼‰ã€‚ä¸€ç»´å·ç§¯å¸¦æ¥çš„é—®é¢˜æ˜¯éœ€è¦<strong>é€šè¿‡è®¾è®¡ä¸åŒ kernel_size çš„ filter è·å–ä¸åŒå®½åº¦çš„è§†é‡</strong>ã€‚</li>
</ul>
<h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><p>TextCNNæ¨¡å‹æœ€å¤§çš„é—®é¢˜ä¹Ÿæ˜¯è¿™ä¸ªå…¨å±€çš„max poolingä¸¢å¤±äº†ç»“æ„ä¿¡æ¯ï¼Œå› æ­¤å¾ˆéš¾å»å‘ç°æ–‡æœ¬ä¸­çš„è½¬æŠ˜å…³ç³»ç­‰å¤æ‚æ¨¡å¼ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å°è¯•k-max poolingåšä¸€äº›ä¼˜åŒ–ï¼Œk-max poolingé’ˆå¯¹æ¯ä¸ªå·ç§¯æ ¸éƒ½ä¸åªä¿ç•™æœ€å¤§çš„å€¼ï¼Œä»–ä¿ç•™å‰kä¸ªæœ€å¤§å€¼ï¼Œå¹¶ä¸”ä¿ç•™è¿™äº›å€¼å‡ºç°çš„é¡ºåºï¼Œä¹Ÿå³æŒ‰ç…§æ–‡æœ¬ä¸­çš„ä½ç½®é¡ºåºæ¥æ’åˆ—è¿™kä¸ªæœ€å¤§å€¼ã€‚åœ¨æŸäº›æ¯”è¾ƒå¤æ‚çš„æ–‡æœ¬ä¸Šç›¸å¯¹äº1-max poolingä¼šæœ‰æå‡ã€‚</p>
<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextCNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab, embedding_dim, n_filters, filter_sizes, output_dim,</span></span></span><br><span class="line"><span class="function"><span class="params">                 dropout, use_pretrain_embedding=False)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.embedding_dim = embedding_dim</span><br><span class="line">        <span class="keyword">if</span> use_pretrain_embedding:</span><br><span class="line">            self.embedding = nn.Embedding.from_pretrained(vocab.vectors)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.embedding = nn.Embedding(len(vocab), embedding_dim, padding_idx=vocab.pad_index)</span><br><span class="line">        <span class="comment"># æŠŠunknown å’Œ pad å‘é‡è®¾ç½®ä¸ºé›¶</span></span><br><span class="line">        self.embedding.weight.data[vocab.unk_index] = torch.zeros(embedding_dim)</span><br><span class="line">        self.embedding.weight.data[vocab.pad_index] = torch.zeros(embedding_dim)</span><br><span class="line"></span><br><span class="line">        self.convs = nn.ModuleList([</span><br><span class="line">            nn.Conv2d(in_channels=<span class="number">1</span>,</span><br><span class="line">                      out_channels=n_filters,</span><br><span class="line">                      kernel_size=(fs, embedding_dim))</span><br><span class="line">            <span class="keyword">for</span> fs <span class="keyword">in</span> filter_sizes</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">        self.fc = nn.Linear(len(filter_sizes) * n_filters, output_dim)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text,text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text = [batch size, sent len]</span></span><br><span class="line"></span><br><span class="line">        embedded = self.embedding(text)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [batch size, sent len, emb dim]</span></span><br><span class="line"></span><br><span class="line">        embedded = embedded.unsqueeze(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [batch size, 1, sent len, emb dim]</span></span><br><span class="line"></span><br><span class="line">        conved = [F.relu(conv(embedded)).squeeze(<span class="number">3</span>) <span class="keyword">for</span> conv <span class="keyword">in</span> self.convs]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># conved_n = [batch size, n_filters, sent len - filter_sizes[n] + 1]</span></span><br><span class="line"></span><br><span class="line">        pooled = [F.max_pool1d(conv, conv.shape[<span class="number">2</span>]).squeeze(<span class="number">2</span>) <span class="keyword">for</span> conv <span class="keyword">in</span> conved]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pooled_n = [batch size, n_filters]</span></span><br><span class="line"></span><br><span class="line">        cat = self.dropout(torch.cat(pooled, dim=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># cat = [batch size, n_filters * len(filter_sizes)]</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.fc(cat)</span><br></pre></td></tr></table></figure>
<h3 id="HANï¼ˆHierarchy-Attention-Networkï¼‰"><a href="#HANï¼ˆHierarchy-Attention-Networkï¼‰" class="headerlink" title="HANï¼ˆHierarchy Attention Networkï¼‰"></a>HANï¼ˆHierarchy Attention Networkï¼‰</h3><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/HAN.png" alt="avatar"></p>
<p>æ•´ä¸ªç½‘ç»œç»“æ„åŒ…æ‹¬äº”ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>è¯åºåˆ—ç¼–ç å™¨</li>
<li>åŸºäºè¯çº§çš„æ³¨æ„åŠ›å±‚</li>
<li>å¥å­ç¼–ç å™¨</li>
<li>åŸºäºå¥å­çº§çš„æ³¨æ„åŠ›å±‚</li>
<li>åˆ†ç±»</li>
</ol>
<p>æ•´ä¸ªç½‘ç»œç»“æ„ç”±åŒå‘GRUç½‘ç»œå’Œæ³¨æ„åŠ›æœºåˆ¶ç»„åˆè€Œæˆã€‚</p>
<h4 id="è¯åºåˆ—ç¼–ç å™¨"><a href="#è¯åºåˆ—ç¼–ç å™¨" class="headerlink" title="è¯åºåˆ—ç¼–ç å™¨"></a>è¯åºåˆ—ç¼–ç å™¨</h4><p>ç»™å®šä¸€ä¸ªå¥å­ä¸­çš„å•è¯$w_{it}$ï¼Œå…¶ä¸­ $i$ è¡¨ç¤ºç¬¬$i$ ä¸ªå¥å­ï¼Œ$t$ è¡¨ç¤ºç¬¬ $t$ ä¸ªè¯ã€‚é€šè¿‡ä¸€ä¸ªè¯åµŒå…¥çŸ©é˜µ $W_e$ å°†å•è¯è½¬æ¢æˆå‘é‡è¡¨ç¤ºï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<script type="math/tex; mode=display">
x_{it}=W_e w_{it}</script><p>åˆ©ç”¨åŒå‘GRUå®ç°çš„æ•´ä¸ªç¼–ç æµç¨‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
x_{i t} &=W_{e} w_{i t}, t \in[1, T] \\
\overrightarrow{h}_{i t} &=\overrightarrow{\operatorname{GRU}}\left(x_{i t}\right), t \in[1, T] \\
\overleftarrow{h}_{i t} &=\overleftarrow{\operatorname{GRU}}\left(x_{i t}\right), t \in[T, 1] \\
{h}_{i t} &= [\overrightarrow{h}_{i t},\overleftarrow{h}_{i t} ]
\end{aligned}</script><h4 id="è¯çº§çš„æ³¨æ„åŠ›å±‚"><a href="#è¯çº§çš„æ³¨æ„åŠ›å±‚" class="headerlink" title="è¯çº§çš„æ³¨æ„åŠ›å±‚"></a>è¯çº§çš„æ³¨æ„åŠ›å±‚</h4><p>ä½†æ˜¯å¯¹äºä¸€å¥è¯ä¸­çš„å•è¯ï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªå•è¯å¯¹åˆ†ç±»ä»»åŠ¡éƒ½æ˜¯æœ‰ç”¨çš„ï¼Œæ¯”å¦‚åœ¨åšæ–‡æœ¬çš„æƒ…ç»ªåˆ†ç±»æ—¶ï¼Œå¯èƒ½æˆ‘ä»¬å°±ä¼šæ¯”è¾ƒå…³æ³¨â€œå¾ˆå¥½â€ã€â€œä¼¤æ„Ÿâ€è¿™äº›è¯ã€‚ä¸ºäº†èƒ½ä½¿å¾ªç¯ç¥ç»ç½‘ç»œä¹Ÿèƒ½è‡ªåŠ¨å°†â€œæ³¨æ„åŠ›â€æ”¾åœ¨è¿™äº›è¯æ±‡ä¸Šï¼Œä½œè€…è®¾è®¡äº†åŸºäºå•è¯çš„æ³¨æ„åŠ›å±‚çš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
u_{i t} &=\tanh \left(W_{w} h_{i t}+b_{w}\right) \\
\alpha_{i t} &=\frac{\exp \left(u_{i t}^{\top} u_{w}\right)}{\sum_{t} \exp \left(u_{i t}^{\top} u_{w}\right)} \\
s_{i} &=\sum_{t} \alpha_{i t} h_{i t}
\end{aligned}</script><p>ä¸Šé¢å¼å­ä¸­ï¼Œ$u_{it}$ æ˜¯ $h_{it}$ çš„éšå±‚è¡¨ç¤ºï¼Œ$a_{it}$ æ˜¯ç» softmax å‡½æ•°å¤„ç†åçš„å½’ä¸€åŒ–æƒé‡ç³»æ•°ï¼Œ$u_w$æ˜¯ä¸€ä¸ªéšæœºåˆå§‹åŒ–çš„å‘é‡ï¼Œä¹‹åä¼šä½œä¸ºæ¨¡å‹çš„å‚æ•°ä¸€èµ·è¢«è®­ç»ƒï¼Œ$s_i$ å°±æ˜¯æˆ‘ä»¬å¾—åˆ°çš„ç¬¬ i ä¸ªå¥å­çš„å‘é‡è¡¨ç¤ºã€‚</p>
<h4 id="å¥å­ç¼–ç å™¨"><a href="#å¥å­ç¼–ç å™¨" class="headerlink" title="å¥å­ç¼–ç å™¨"></a>å¥å­ç¼–ç å™¨</h4><p>å¥å­ç¼–ç å™¨ä¹Ÿæ˜¯åŸºäºåŒå‘GRUå®ç°ç¼–ç çš„ï¼Œ</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\overrightarrow{h}_{i}=\overrightarrow{\operatorname{GRU}}\left(s_{i}\right), i \in[1, L]\\
&\overleftarrow{h}_{i}=\overleftarrow{\operatorname{GRU}}\left(s_{i}\right), t \in[L, 1]
\end{aligned}</script><p>å…¬å¼å’Œè¯ç¼–ç ç±»ä¼¼ï¼Œæœ€åçš„ $h_i$ ä¹Ÿæ˜¯é€šè¿‡æ‹¼æ¥å¾—åˆ°çš„.</p>
<h4 id="å¥å­çº§æ³¨æ„åŠ›å±‚"><a href="#å¥å­çº§æ³¨æ„åŠ›å±‚" class="headerlink" title="å¥å­çº§æ³¨æ„åŠ›å±‚"></a>å¥å­çº§æ³¨æ„åŠ›å±‚</h4><p>æ³¨æ„åŠ›å±‚çš„æµç¨‹å¦‚ä¸‹ï¼Œå’Œè¯çº§çš„ä¸€è‡´:</p>
<script type="math/tex; mode=display">
\begin{aligned}
u_{i} &=\tanh \left(W_{s} h_{i}+b_{s}\right) \\
\alpha_{i} &=\frac{\exp \left(u_{i}^{\top} u_{s}\right)}{\sum_{i} \exp \left(u_{i}^{\top} u_{s}\right)} \\
v &=\sum_{i} \alpha_{i} h_{i}
\end{aligned}</script><p>æœ€åå¾—åˆ°çš„å‘é‡$v$ å°±æ˜¯æ–‡æ¡£çš„å‘é‡è¡¨ç¤ºï¼Œè¿™æ˜¯æ–‡æ¡£çš„é«˜å±‚è¡¨ç¤ºã€‚æ¥ä¸‹æ¥å°±å¯ä»¥ç”¨å¯ä»¥ç”¨è¿™ä¸ªå‘é‡è¡¨ç¤ºä½œä¸ºæ–‡æ¡£çš„ç‰¹å¾ã€‚</p>
<h4 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h4><p>ä½¿ç”¨æœ€å¸¸ç”¨çš„softmaxåˆ†ç±»å™¨å¯¹æ•´ä¸ªæ–‡æœ¬è¿›è¡Œåˆ†ç±»äº†</p>
<script type="math/tex; mode=display">
p=\operatorname{softmax}\left(W_{c} v+b_{c}\right)</script><p>æŸå¤±å‡½æ•°</p>
<script type="math/tex; mode=display">
L=-\sum_{d} \log p_{d j}</script><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><h3 id="RNNç³»åˆ—"><a href="#RNNç³»åˆ—" class="headerlink" title="RNNç³»åˆ—"></a>RNNç³»åˆ—</h3><p>é€šè¿‡å°†å‰ä¸€æ—¶åˆ»çš„è¿ç®—ç»“æœæ·»åŠ åˆ°å½“å‰çš„è¿ç®—ä¸­ï¼Œä»è€Œå®ç°äº†â€œè€ƒè™‘ä¸Šæ–‡ä¿¡æ¯â€çš„åŠŸèƒ½ã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/rnn.png" alt="avatar"></p>
<p>RNNå¯ä»¥è€ƒè™‘ä¸Šæ–‡çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå¦‚ä½•å°†ä¸‹æ–‡çš„ä¿¡æ¯ä¹Ÿæ·»åŠ è¿›å»å‘¢ï¼Ÿè¿™å°±æ˜¯BiRNNè¦åšçš„äº‹æƒ…ã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/birnn.png" alt="avatar"></p>
<h4 id="LSTM"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h4><p>å› ä¸ºRNNå­˜åœ¨æ¢¯åº¦å¼¥æ•£å’Œæ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ï¼Œæ‰€ä»¥RNNå¾ˆéš¾å®Œç¾åœ°å¤„ç†å…·æœ‰é•¿æœŸä¾èµ–çš„ä¿¡æ¯ã€‚æ—¢ç„¶ä»…ä»…ä¾é ä¸€æ¡çº¿è¿æ¥åé¢çš„ç¥ç»å…ƒä¸è¶³ä»¥è§£å†³é—®é¢˜ï¼Œé‚£ä¹ˆå°±å†åŠ ä¸€æ¡çº¿å¥½äº†ï¼Œè¿™å°±æ˜¯LSTMã€‚</p>
<p>LSTMçš„å…³é”®åœ¨äºç»†èƒçš„çŠ¶æ€å’Œç©¿è¿‡ç»†èƒçš„çº¿ï¼Œç»†èƒçŠ¶æ€ç±»ä¼¼äºä¼ é€å¸¦ã€‚ç›´æ¥åœ¨æ•´ä¸ªé“¾ä¸Šè¿è¡Œï¼Œåªæœ‰ä¸€äº›å°‘é‡çš„çº¿æ€§äº¤äº’ã€‚ä¿¡æ¯åœ¨ä¸Šé¢æµåŠ¨ä¿æŒä¸å˜ä¼šå˜å¾—å®¹æ˜“ã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/lstm_c.png" alt="avatar"></p>
<p>åœ¨LSTMä¸­ï¼Œé—¨å¯ä»¥å®ç°é€‰æ‹©æ€§çš„è®©ä¿¡æ¯é€šè¿‡ï¼Œä¸»è¦é€šè¿‡ä¸€ä¸ªsigmoidçš„ç¥ç»å±‚å’Œä¸€ä¸ªé€ç‚¹ç›¸ä¹˜çš„æ“ä½œæ¥å®ç°ã€‚LSTMé€šè¿‡ä¸‰ä¸ªè¿™æ ·çš„é—¨ç»“æ„æ¥å®ç°ä¿¡æ¯çš„ä¿æŠ¤å’Œæ§åˆ¶ï¼Œåˆ†åˆ«æ˜¯é—å¿˜é—¨ï¼ˆforget gateï¼‰ã€è¾“å…¥é—¨ï¼ˆinput gateï¼‰ä¸è¾“å‡ºé—¨ï¼ˆoutput gateï¼‰ã€‚</p>
<h5 id="é—å¿˜é—¨"><a href="#é—å¿˜é—¨" class="headerlink" title="é—å¿˜é—¨"></a><strong>é—å¿˜é—¨</strong></h5><p>åœ¨LSTMä¸­çš„ç¬¬ä¸€æ­¥æ˜¯å†³å®šä»ç»†èƒçŠ¶æ€ä¸­ä¸¢å¼ƒä»€ä¹ˆä¿¡æ¯ã€‚è¿™ä¸ªå†³å®šé€šè¿‡ä¸€ä¸ªç§°ä¸ºé—å¿˜é—¨çš„ç»“æ„æ¥å®Œæˆã€‚é—å¿˜é—¨ä¼šè¯»å–$h_{t-1}$å’Œ$x_t$ï¼Œè¾“å‡ºä¸€ä¸ª0åˆ°1ä¹‹é—´çš„æ•°å€¼ç»™ç»†èƒçš„çŠ¶æ€$c_{t-1}$ä¸­çš„æ•°å­—ã€‚1è¡¨ç¤ºå®Œå…¨ä¿ç•™ï¼Œ0è¡¨ç¤ºå®Œå…¨èˆå¼ƒã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/lstm_forget_gate.png" alt="avatar"></p>
<h5 id="è¾“å…¥é—¨"><a href="#è¾“å…¥é—¨" class="headerlink" title="è¾“å…¥é—¨"></a><strong>è¾“å…¥é—¨</strong></h5><p>é—å¿˜é—¨å†³å®šè®©å¤šå°‘æ–°çš„ä¿¡æ¯åŠ å…¥åˆ°cellçš„çŠ¶æ€ä¸­æ¥ã€‚å®ç°è¿™ä¸ªéœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><p>é¦–å…ˆä¸€ä¸ªå«â€œinput gate layerâ€çš„sigmoidå±‚å†³å®šå“ªäº›ä¿¡æ¯éœ€è¦æ›´æ–°ï¼›ä¸€ä¸ªtanhå±‚ç”Ÿæˆä¸€ä¸ªå‘é‡ï¼Œç”¨æ¥æ›´æ–°çŠ¶æ€Cã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/input_gate.png" alt="avatar"></p>
</li>
<li><p>æŠŠ 1 ä¸­çš„ä¸¤éƒ¨åˆ†è”åˆèµ·æ¥ï¼Œå¯¹cellçš„çŠ¶æ€è¿›è¡Œæ›´æ–°ï¼Œæˆ‘ä»¬æŠŠæ—§çš„çŠ¶æ€ä¸$f_t$ç›¸ä¹˜ï¼Œä¸¢å¼ƒæ‰æˆ‘ä»¬ç¡®å®šéœ€è¦ä¸¢å¼ƒçš„ä¿¡æ¯ï¼Œæ¥ç€åŠ ä¸Š$i_t * \tilde{C}_{t}$</p>
</li>
</ol>
<h5 id="è¾“å‡ºé—¨"><a href="#è¾“å‡ºé—¨" class="headerlink" title="è¾“å‡ºé—¨"></a>è¾“å‡ºé—¨</h5><p>æœ€ç»ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šè¾“å‡ºä»€ä¹ˆå€¼ï¼Œè¿™ä¸ªè¾“å‡ºå°†ä¼šåŸºäºæˆ‘ä»¬çš„ç»†èƒçš„çŠ¶æ€ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸€ä¸ªè¿‡æ»¤åçš„ç‰ˆæœ¬ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªsigmoidå±‚æ¥ç¡®å®šç»†èƒçŠ¶æ€çš„å“ªäº›éƒ¨åˆ†å°†è¾“å‡ºå‡ºå»ã€‚æ¥ç€ï¼Œæˆ‘ä»¬æŠŠç»†èƒçŠ¶æ€é€šè¿‡tanhè¿›è¡Œå¤„ç†ï¼ˆå¾—åˆ°ä¸€ä¸ª-1åˆ°1ä¹‹é—´çš„å€¼ï¼‰å¹¶å°†å®ƒå’Œsigmoidé—¨çš„è¾“å‡ºç›¸ä¹˜ï¼Œæœ€ç»ˆæˆ‘ä»¬ä»…ä»…ä¼šè¾“å‡ºæˆ‘ä»¬ç¡®å®šè¾“å‡ºçš„éƒ¨åˆ†ã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/output_gate.png" alt="avatar"></p>
<h5 id="å…¬å¼"><a href="#å…¬å¼" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h5><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/lstm_all.png" alt="avatar"></p>
<h4 id="GRU"><a href="#GRU" class="headerlink" title="GRU"></a>GRU</h4><p>åœ¨LSTMä¸­å¼•å…¥äº†ä¸‰ä¸ªé—¨å‡½æ•°ï¼šè¾“å…¥é—¨ã€é—å¿˜é—¨å’Œè¾“å‡ºé—¨æ¥æ§åˆ¶è¾“å…¥å€¼ã€è®°å¿†å€¼å’Œè¾“å‡ºå€¼ã€‚è€Œåœ¨GRUæ¨¡å‹ä¸­åªæœ‰ä¸¤ä¸ªé—¨ï¼šåˆ†åˆ«æ˜¯æ›´æ–°é—¨å’Œé‡ç½®é—¨ã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/GRU.png" alt="avatar"></p>
<p>å›¾ä¸­çš„$z_t$å’Œ$r_t$åˆ†åˆ«è¡¨ç¤ºæ›´æ–°é—¨å’Œé‡ç½®é—¨ã€‚æ›´æ–°é—¨ç”¨äºæ§åˆ¶å‰ä¸€æ—¶åˆ»çš„çŠ¶æ€ä¿¡æ¯è¢«å¸¦å…¥åˆ°å½“å‰çŠ¶æ€ä¸­çš„ç¨‹åº¦ï¼Œæ›´æ–°é—¨çš„å€¼è¶Šå¤§è¯´æ˜å‰ä¸€æ—¶åˆ»çš„çŠ¶æ€ä¿¡æ¯å¸¦å…¥è¶Šå¤šã€‚é‡ç½®é—¨æ§åˆ¶å‰ä¸€çŠ¶æ€æœ‰å¤šå°‘ä¿¡æ¯è¢«å†™å…¥åˆ°å½“å‰çš„å€™é€‰é›† $\tilde{h}_{t}$ä¸Šï¼Œé‡ç½®é—¨è¶Šå°ï¼Œå‰ä¸€çŠ¶æ€çš„ä¿¡æ¯è¢«å†™å…¥çš„è¶Šå°‘ã€‚</p>
<p>LSTMå’ŒCRUéƒ½æ˜¯é€šè¿‡å„ç§é—¨å‡½æ•°æ¥å°†é‡è¦ç‰¹å¾ä¿ç•™ä¸‹æ¥ï¼Œè¿™æ ·å°±ä¿è¯äº†åœ¨long-termä¼ æ’­çš„æ—¶å€™ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚æ­¤å¤–GRUç›¸å¯¹äºLSTMå°‘äº†ä¸€ä¸ªé—¨å‡½æ•°ï¼Œå› æ­¤åœ¨å‚æ•°çš„æ•°é‡ä¸Šä¹Ÿæ˜¯è¦å°‘äºLSTMçš„ï¼Œæ‰€ä»¥æ•´ä½“ä¸ŠGRUçš„è®­ç»ƒé€Ÿåº¦è¦å¿«äºLSTMçš„ã€‚</p>
<h4 id="Self-Attention"><a href="#Self-Attention" class="headerlink" title="Self-Attention"></a>Self-Attention</h4><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/self-attention.png" alt="avatar"></p>
<ol>
<li>Encodeæ‰€æœ‰è¾“å…¥åºåˆ—,å¾—åˆ°å¯¹åº”çš„$h_1,h_2, \cdots ,h_T$(Tä¸ºè¾“å…¥åºåˆ—é•¿åº¦)</li>
<li>Decodeè¾“å‡ºç›®æ ‡$y_t$ä¹‹å‰ï¼Œä¼šå°†ä¸Šä¸€æ­¥è¾“å‡ºçš„éšè—çŠ¶æ€$S_{t-1}$ä¸ä¹‹å‰encodeå¥½çš„$h_1,h_2,\cdots,h_T$è¿›è¡Œæ¯”å¯¹ï¼Œè®¡ç®—ç›¸ä¼¼åº¦ï¼ˆ$e_{t,j}=a(s_{t-1},h_j)$ï¼‰,$h_j$ä¸ºä¹‹å‰ç¬¬jä¸ªè¾“å…¥encodeå¾—åˆ°çš„éšè—å‘é‡ï¼Œaä¸ºä»»æ„ä¸€ç§è®¡ç®—ç›¸ä¼¼åº¦çš„æ–¹å¼</li>
<li>ç„¶åé€šè¿‡softmaxï¼Œå³$a_{t,j}=\frac{exp(e_{t,j})}{\sum^{T_x}_{k=1}exp(e_{t,k})}$å°†ä¹‹å‰å¾—åˆ°çš„å„ä¸ªéƒ¨åˆ†çš„ç›¸å…³ç³»æ•°è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¾—åˆ°$a_{t,1},a_{t,2},\cdots,a_{t,T}$</li>
<li>åœ¨å¯¹è¾“å…¥åºåˆ—çš„éšè—å±‚è¿›è¡Œç›¸å…³æ€§åŠ æƒæ±‚å’Œå¾—åˆ°æ­¤æ—¶decodeéœ€è¦çš„context vector ï¼š$</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RnnModel</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, rnn_type, vocab, embedding_dim, hidden_dim, output_dim, n_layers,</span></span></span><br><span class="line"><span class="function"><span class="params">                 bidirectional, dropout, batch_first=False,use_pretrain_embedding=False)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.embedding_dim = embedding_dim</span><br><span class="line">        <span class="keyword">if</span> use_pretrain_embedding:</span><br><span class="line">            self.embedding = nn.Embedding.from_pretrained(vocab.vectors)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.embedding = nn.Embedding(len(vocab), embedding_dim, padding_idx=vocab.pad_index)</span><br><span class="line">        <span class="comment"># æŠŠunknown å’Œ pad å‘é‡è®¾ç½®ä¸ºé›¶</span></span><br><span class="line">        self.embedding.weight.data[vocab.unk_index] = torch.zeros(embedding_dim)</span><br><span class="line">        self.embedding.weight.data[vocab.pad_index] = torch.zeros(embedding_dim)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(embedding_dim,</span><br><span class="line">                               hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(embedding_dim,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(embedding_dim,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line">        self.fc = nn.Linear(hidden_dim * n_layers, output_dim)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text, text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text = [sent len, batch size]</span></span><br><span class="line"></span><br><span class="line">        embedded = self.dropout(self.embedding(text))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [sent len, batch size, emb dim]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(embedded, text_lengths, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># unpack sequence</span></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.bidirectional:</span><br><span class="line">            hidden = torch.reshape(hidden,(hidden.shape[<span class="number">1</span>],self.hidden_dim * self.n_layers))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            hidden = torch.reshape(hidden, (<span class="number">-1</span>,hidden.shape[<span class="number">1</span>], self.hidden_dim * self.n_layers))</span><br><span class="line">            hidden = torch.mean(hidden,dim=<span class="number">0</span>)</span><br><span class="line">        output = torch.sum(output,dim=<span class="number">0</span>)</span><br><span class="line">        fc_input = self.dropout(output+hidden)</span><br><span class="line">        out = self.fc(fc_input)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h4 id="Rnn-Attenton"><a href="#Rnn-Attenton" class="headerlink" title="Rnn-Attenton"></a>Rnn-Attenton</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RnnAttentionModel</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, rnn_type, vocab, embedding_dim, hidden_dim, output_dim, n_layers,</span></span></span><br><span class="line"><span class="function"><span class="params">                 bidirectional, dropout, batch_first=False,use_pretrain_embedding=False)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.embedding_dim = embedding_dim</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> use_pretrain_embedding:</span><br><span class="line">            self.embedding = nn.Embedding.from_pretrained(vocab.vectors)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.embedding = nn.Embedding(len(vocab), embedding_dim, padding_idx=vocab.pad_index)</span><br><span class="line">        <span class="comment"># æŠŠunknown å’Œ pad å‘é‡è®¾ç½®ä¸ºé›¶</span></span><br><span class="line">        self.embedding.weight.data[vocab.unk_index] = torch.zeros(embedding_dim)</span><br><span class="line">        self.embedding.weight.data[vocab.pad_index] = torch.zeros(embedding_dim)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(embedding_dim,</span><br><span class="line">                               hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(embedding_dim,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(embedding_dim,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        self.tanh1 = nn.Tanh()</span><br><span class="line">        self.tanh2 = nn.Tanh()</span><br><span class="line">        <span class="comment"># self.u = nn.Parameter(torch.Tensor(self.hidden_dim * 2,self.hidden_dim*2))</span></span><br><span class="line">        self.w = nn.Parameter(torch.randn(hidden_dim),requires_grad=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        <span class="keyword">if</span> bidirectional:</span><br><span class="line">            self.w = nn.Parameter(torch.randn(hidden_dim * <span class="number">2</span>), requires_grad=<span class="literal">True</span>)</span><br><span class="line">            self.fc = nn.Linear(hidden_dim * <span class="number">2</span>, output_dim)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.w = nn.Parameter(torch.randn(hidden_dim), requires_grad=<span class="literal">True</span>)</span><br><span class="line">            self.fc = nn.Linear(hidden_dim, output_dim)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text, text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text = [sent len, batch size]</span></span><br><span class="line"></span><br><span class="line">        embedded = self.dropout(self.embedding(text))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [sent len, batch size, emb dim]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(embedded, text_lengths, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># unpack sequence</span></span><br><span class="line">        <span class="comment"># output = [sent len, batch size, hidden dim * num_direction]</span></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># attention</span></span><br><span class="line">        <span class="comment"># M = [sent len, batch size, hidden dim * num_direction]</span></span><br><span class="line">        <span class="comment"># M = self.tanh1(output)</span></span><br><span class="line"></span><br><span class="line">        alpha = F.softmax(torch.matmul(self.tanh1(output), self.w), dim=<span class="number">0</span>).unsqueeze(<span class="number">-1</span>) <span class="comment"># dim=0è¡¨ç¤ºé’ˆå¯¹æ–‡æœ¬ä¸­çš„æ¯ä¸ªè¯çš„è¾“å‡ºsoftmax</span></span><br><span class="line">        output_attention = output * alpha</span><br><span class="line"></span><br><span class="line">        <span class="comment"># hidden = [n_layers * num_direction,batch_size, hidden_dim]</span></span><br><span class="line">        <span class="keyword">if</span> self.bidirectional:</span><br><span class="line">            hidden = torch.mean(torch.reshape(hidden, (<span class="number">-1</span>,hidden.shape[<span class="number">1</span>], self.hidden_dim * <span class="number">2</span>)),dim=<span class="number">0</span>)  <span class="comment"># hidden = [batch_size, hidden_dim * num_direction]</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            hidden = torch.mean(torch.reshape(hidden, (<span class="number">-1</span>, hidden.shape[<span class="number">1</span>], self.hidden_dim)), dim=<span class="number">0</span>)   <span class="comment"># hidden = [batch_size, hidden_dim]</span></span><br><span class="line"></span><br><span class="line">        output_attention = torch.sum(output_attention,dim=<span class="number">0</span>)</span><br><span class="line">        output = torch.sum(output,dim=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        fc_input = self.dropout(output+output_attention+hidden)</span><br><span class="line">        <span class="comment"># fc_input = self.dropout(output_attention)</span></span><br><span class="line">        out = self.fc(fc_input)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h3 id="TextRCNN"><a href="#TextRCNN" class="headerlink" title="TextRCNN"></a>TextRCNN</h3><h4 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>å°±æ·±åº¦å­¦ä¹ é¢†åŸŸæ¥è¯´ï¼ŒRNNå’ŒCNNä½œä¸ºæ–‡æœ¬åˆ†ç±»é—®é¢˜çš„ä¸»è¦æ¨¡å‹æ¶æ„ï¼Œéƒ½å­˜åœ¨å„è‡ªçš„ä¼˜ç‚¹åŠå±€é™æ€§ã€‚RNNæ“…é•¿å¤„ç†åºåˆ—ç»“æ„ï¼Œèƒ½å¤Ÿè€ƒè™‘åˆ°å¥å­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä½†RNNå±äºâ€œbiased modelâ€ï¼Œä¸€ä¸ªå¥å­ä¸­è¶Šå¾€åçš„è¯é‡è¦æ€§è¶Šé«˜ï¼Œè¿™æœ‰å¯èƒ½å½±å“æœ€åçš„åˆ†ç±»ç»“æœï¼Œå› ä¸ºå¯¹å¥å­åˆ†ç±»å½±å“æœ€å¤§çš„è¯å¯èƒ½å¤„åœ¨å¥å­ä»»ä½•ä½ç½®ã€‚CNNå±äºæ— åæ¨¡å‹ï¼Œèƒ½å¤Ÿé€šè¿‡æœ€å¤§æ± åŒ–è·å¾—æœ€é‡è¦çš„ç‰¹å¾ï¼Œä½†æ˜¯CNNçš„æ»‘åŠ¨çª—å£å¤§å°ä¸å®¹æ˜“ç¡®å®šï¼Œé€‰çš„è¿‡å°å®¹æ˜“é€ æˆé‡è¦ä¿¡æ¯ä¸¢å¤±ï¼Œé€‰çš„è¿‡å¤§ä¼šé€ æˆå·¨å¤§å‚æ•°ç©ºé—´ã€‚ä¸ºäº†è§£å†³äºŒè€…çš„å±€é™æ€§ï¼Œè¿™ç¯‡æ–‡ç« æå‡ºäº†ä¸€ç§æ–°çš„ç½‘ç»œæ¶æ„ï¼Œç”¨åŒå‘å¾ªç¯ç»“æ„è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè¿™æ¯”ä¼ ç»Ÿçš„åŸºäºçª—å£çš„ç¥ç»ç½‘ç»œæ›´èƒ½å‡å°‘å™ªå£°ï¼Œè€Œä¸”åœ¨å­¦ä¹ æ–‡æœ¬è¡¨è¾¾æ—¶å¯ä»¥å¤§èŒƒå›´çš„ä¿ç•™è¯åºã€‚å…¶æ¬¡ä½¿ç”¨æœ€å¤§æ± åŒ–å±‚è·å–æ–‡æœ¬çš„é‡è¦éƒ¨åˆ†ï¼Œè‡ªåŠ¨åˆ¤æ–­å“ªä¸ªç‰¹å¾åœ¨æ–‡æœ¬åˆ†ç±»è¿‡ç¨‹ä¸­èµ·æ›´é‡è¦çš„ä½œç”¨ã€‚</p>
<p><a href="http://www.aaai.org/ocs/index.php/AAAI/AAAI15/paper/download/9745/9552" target="_blank" rel="noopener">è®ºæ–‡</a></p>
<h4 id="æ¨¡å‹ç»“æ„"><a href="#æ¨¡å‹ç»“æ„" class="headerlink" title="æ¨¡å‹ç»“æ„"></a>æ¨¡å‹ç»“æ„</h4><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/rcnn.png" alt="avatar"></p>
<h4 id="Word-Representation-Learning"><a href="#Word-Representation-Learning" class="headerlink" title="Word Representation Learning"></a>Word Representation Learning</h4><p>ä½œè€…æå‡ºå°†å•è¯çš„å·¦ä¸Šä¸‹æ–‡ã€å³ä¸Šä¸‹æ–‡ã€å•è¯æœ¬èº«ç»“åˆèµ·æ¥ä½œä¸ºå•è¯è¡¨ç¤ºã€‚ä½œè€…ä½¿ç”¨äº†åŒå‘RNNæ¥åˆ†åˆ«æå–å¥å­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å…¬å¼å¦‚ä¸‹:</p>
<script type="math/tex; mode=display">
\begin{array}{l}
c_{l}\left(w_{i}\right)=f\left(W^{(l)} c_{l}\left(w_{i-1}\right)+W^{(s l)} e\left(w_{i-1}\right)\right)  \\
c_{r}\left(w_{i}\right)=f\left(W^{(r)} c_{r}\left(w_{i+1}\right)+W^{(s r)} e\left(w_{i+1}\right)\right)
\end{array}</script><p>å…¶ä¸­ï¼Œ$c_l(w_i)$ä»£è¡¨å•è¯$w_i$çš„å·¦ä¸Šä¸‹æ–‡ï¼Œ$c_l(w_i)$ç”±ä¸Šä¸€ä¸ªå•è¯çš„å·¦ä¸Šä¸‹æ–‡$c_l$å’Œ$c_l(w_{i-1})$ä¸Šä¸€ä¸ªå•è¯çš„è¯åµŒå…¥å‘é‡ $e(w_{i-1})$è®¡ç®—å¾—åˆ°ï¼Œå¦‚å…¬å¼ï¼ˆ1ï¼‰æ‰€ç¤ºï¼Œæ‰€æœ‰å¥å­ç¬¬ä¸€ä¸ªå•è¯çš„å·¦ä¾§ä¸Šä¸‹æ–‡ä½¿ç”¨ç›¸åŒçš„å…±äº«å‚æ•°$c_l(w_1)$ã€‚ $W^{(l)},W^{(sl)}$ç”¨äºå°†ä¸Šä¸€ä¸ªå•è¯çš„å·¦ä¸Šä¸‹æ–‡è¯­ä¹‰å’Œä¸Šä¸€ä¸ªå•è¯çš„è¯­ä¹‰ç»“åˆåˆ°å•è¯ $w_i$çš„å·¦ä¸Šä¸‹æ–‡è¡¨ç¤ºä¸­ã€‚å³ä¸Šä¸‹æ–‡çš„å¤„ç†ä¸å·¦ä¸Šä¸‹æ–‡å®Œå…¨ç›¸åŒï¼ŒåŒæ ·æ‰€æœ‰å¥å­æœ€åä¸€ä¸ªå•è¯çš„å³ä¾§ä¸Šä¸‹æ–‡ä½¿ç”¨ç›¸åŒçš„å…±äº«å‚æ•°$c_r(w_n)$ã€‚ å¾—åˆ°å¥å­ä¸­æ¯ä¸ªå•è¯çš„å·¦ä¸Šä¸‹æ–‡è¡¨ç¤ºå’Œå³ä¸Šä¸‹æ–‡è¡¨ç¤ºåï¼Œå°±å¯ä»¥å®šä¹‰å•è¯  $w_i$çš„è¡¨ç¤ºå¦‚ä¸‹</p>
<script type="math/tex; mode=display">
\boldsymbol{x}_{i}=\left[\boldsymbol{c}_{l}\left(w_{i}\right) ; \boldsymbol{e}\left(w_{i}\right) ; \boldsymbol{c}_{r}\left(w_{i}\right)\right]</script><p>å®é™…å°±æ˜¯å•è¯$w_i$ï¼Œå•è¯çš„è¯åµŒå…¥è¡¨ç¤ºå‘é‡ $e(w_i)$ä»¥åŠå•è¯çš„å³ä¸Šä¸‹æ–‡å‘é‡$c_e(w_i)$ çš„æ‹¼æ¥åçš„ç»“æœã€‚å¾—åˆ°$w_i$çš„è¡¨ç¤º$x_i$åï¼Œå°±å¯ä»¥è¾“å…¥æ¿€æ´»å‡½æ•°å¾—åˆ°$w_i$çš„æ½œåœ¨è¯­ä¹‰å‘é‡ $y_i^{(2)}$ ã€‚</p>
<script type="math/tex; mode=display">
\boldsymbol{y}_{i}^{(2)}=\tanh \left(W^{(2)} \boldsymbol{x}_{i}+\boldsymbol{b}^{(2)}\right)</script><h4 id="Text-Representation-Learning"><a href="#Text-Representation-Learning" class="headerlink" title="Text Representation Learning"></a>Text Representation Learning</h4><p>ç»è¿‡å·ç§¯å±‚åï¼Œè·å¾—äº†æ‰€æœ‰è¯çš„è¡¨ç¤ºï¼Œé¦–å…ˆå¯¹å…¶è¿›è¡Œæœ€å¤§æ± åŒ–æ“ä½œï¼Œæœ€å¤§æ± åŒ–å¯ä»¥å¸®åŠ©æ‰¾åˆ°å¥å­ä¸­æœ€é‡è¦çš„æ½œåœ¨è¯­ä¹‰ä¿¡æ¯ã€‚</p>
<script type="math/tex; mode=display">
\boldsymbol{y}^{(3)}=\max _{i=1}^{n} \boldsymbol{y}_{i}^{(2)}</script><p>ç„¶åç»è¿‡å…¨è¿æ¥å±‚å¾—åˆ°æ–‡æœ¬çš„è¡¨ç¤ºï¼Œæœ€åé€šè¿‡softmaxå±‚è¿›è¡Œåˆ†ç±»ã€‚</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\boldsymbol{y}^{(4)}=W^{(4)} \boldsymbol{y}^{(3)}+\boldsymbol{b}^{(4)}\\
&p_{i}=\frac{\exp \left(\boldsymbol{y}_{i}^{(4)}\right)}{\sum_{k=1}^{n} \exp \left(\boldsymbol{y}_{k}^{(4)}\right)}
\end{aligned}</script><h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RCNNModel</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, rnn_type, vocab, embedding_dim, hidden_dim, output_dim, n_layers,</span></span></span><br><span class="line"><span class="function"><span class="params">                 bidirectional, dropout, pad_size=<span class="number">32</span>,batch_first=False,use_pretrain_embedding=False)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.embedding_dim = embedding_dim</span><br><span class="line">        self.pad_size = pad_size</span><br><span class="line">        <span class="keyword">if</span> use_pretrain_embedding:</span><br><span class="line">            self.embedding = nn.Embedding.from_pretrained(vocab.vectors)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.embedding = nn.Embedding(len(vocab), embedding_dim, padding_idx=vocab.pad_index)</span><br><span class="line">        <span class="comment"># æŠŠunknown å’Œ pad å‘é‡è®¾ç½®ä¸ºé›¶</span></span><br><span class="line">        self.embedding.weight.data[vocab.unk_index] = torch.zeros(embedding_dim)</span><br><span class="line">        self.embedding.weight.data[vocab.pad_index] = torch.zeros(embedding_dim)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(embedding_dim,</span><br><span class="line">                               hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(embedding_dim,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(embedding_dim,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># self.maxpool = nn.MaxPool1d()</span></span><br><span class="line">        self.fc = nn.Linear(hidden_dim * n_layers + embedding_dim, output_dim)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text, text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text = [sent len, batch size]</span></span><br><span class="line"></span><br><span class="line">        embedded = self.embedding(text)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [sent len, batch size, emb dim]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(embedded, text_lengths, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># packed_output</span></span><br><span class="line">        <span class="comment"># hidden [n_layers * bi_direction,batch_size,hidden_dim]</span></span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># unpack sequence</span></span><br><span class="line">        <span class="comment"># output [sent len, batch_size * n_layers * bi_direction]</span></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># if not self.bidirectional:</span></span><br><span class="line">        <span class="comment">#     hidden = torch.reshape(hidden,(hidden.shape[1],self.hidden_dim * self.n_layers))</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     hidden = torch.reshape(hidden, (-1,hidden.shape[1], self.hidden_dim * self.n_layers))</span></span><br><span class="line">        <span class="comment">#     hidden = torch.mean(hidden,dim=0)</span></span><br><span class="line"></span><br><span class="line">        output = torch.cat((output,embedded),<span class="number">2</span>)</span><br><span class="line">        out = output.relu().permute(<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>)</span><br><span class="line">        max_sentence_len = output_lengths[<span class="number">0</span>].item()</span><br><span class="line">        out = nn.MaxPool1d(max_sentence_len)(out).squeeze()</span><br><span class="line">        out = self.fc(out)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h3 id="DPCNN"><a href="#DPCNN" class="headerlink" title="DPCNN"></a>DPCNN</h3><h4 id="ç®€ä»‹ï¼š"><a href="#ç®€ä»‹ï¼š" class="headerlink" title="ç®€ä»‹ï¼š"></a>ç®€ä»‹ï¼š</h4><p>ACL2017å¹´ä¸­ï¼Œè…¾è®¯AI-labæå‡ºäº†Deep Pyramid Convolutional Neural Networks for Text Categorization(DPCNN)ã€‚è®ºæ–‡ä¸­æå‡ºäº†ä¸€ç§åŸºäºword-levelçº§åˆ«çš„ç½‘ç»œ-DPCNNï¼Œç”±äºTextCNN ä¸èƒ½é€šè¿‡å·ç§¯è·å¾—æ–‡æœ¬çš„é•¿è·ç¦»ä¾èµ–å…³ç³»ï¼Œè€Œè®ºæ–‡ä¸­DPCNNé€šè¿‡ä¸æ–­åŠ æ·±ç½‘ç»œï¼Œå¯ä»¥æŠ½å–é•¿è·ç¦»çš„æ–‡æœ¬ä¾èµ–å…³ç³»ã€‚å®éªŒè¯æ˜åœ¨ä¸å¢åŠ å¤ªå¤šè®¡ç®—æˆæœ¬çš„æƒ…å†µä¸‹ï¼Œå¢åŠ ç½‘ç»œæ·±åº¦å°±å¯ä»¥è·å¾—æœ€ä½³çš„å‡†ç¡®ç‡ã€‚â€</p>
<h4 id="ç½‘ç»œç»“æ„-1"><a href="#ç½‘ç»œç»“æ„-1" class="headerlink" title="ç½‘ç»œç»“æ„"></a>ç½‘ç»œç»“æ„</h4><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/DPCNN.jpg" alt="avatar"></p>
<h5 id="Region-embedding"><a href="#Region-embedding" class="headerlink" title="Region embedding"></a>Region embedding</h5><p>ä½œè€…å°†TextCNNçš„åŒ…å«å¤šå°ºå¯¸å·ç§¯æ»¤æ³¢å™¨çš„å·ç§¯å±‚çš„å·ç§¯ç»“æœç§°ä¹‹ä¸ºRegion embeddingï¼Œæ„æ€å°±æ˜¯å¯¹ä¸€ä¸ªæ–‡æœ¬åŒºåŸŸ/ç‰‡æ®µï¼ˆæ¯”å¦‚3gramï¼‰è¿›è¡Œä¸€ç»„å·ç§¯æ“ä½œåç”Ÿæˆçš„embeddingã€‚<br>å·ç§¯æ“ä½œæœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<ol>
<li>ä¿ç•™è¯åºï¼šä¹Ÿå°±æ˜¯è®¾ç½®ä¸€ç»„size=3*Dçš„äºŒç»´å·ç§¯æ ¸å¯¹3gramè¿›è¡Œå·ç§¯ï¼ˆå…¶ä¸­Dæ˜¯word embeddingç»´åº¦ï¼‰</li>
<li>ä¸ä¿ç•™è¯åºï¼ˆå³ä½¿ç”¨è¯è¢‹æ¨¡å‹ï¼‰ï¼Œå³é¦–å…ˆå¯¹3gramä¸­çš„3ä¸ªè¯çš„embeddingå–å‡å€¼å¾—åˆ°ä¸€ä¸ªsize=Dçš„å‘é‡ï¼Œç„¶åè®¾ç½®ä¸€ç»„size=Dçš„ä¸€ç»´å·ç§¯æ ¸å¯¹è¯¥3gramè¿›è¡Œå·ç§¯ã€‚</li>
</ol>
<p>TextCNNé‡Œä½¿ç”¨çš„æ˜¯ä¿ç•™è¯åºçš„åšæ³•ï¼Œè€ŒDPCNNä½¿ç”¨çš„æ˜¯è¯è¢‹æ¨¡å‹çš„åšæ³•ï¼ŒDPCNNä½œè€…argueå‰è€…åšæ³•æ›´å®¹æ˜“é€ æˆè¿‡æ‹Ÿåˆï¼Œåè€…çš„æ€§èƒ½å´è·Ÿå‰è€…å·®ä¸å¤šã€‚</p>
<h4 id="å·ç§¯å’Œå…¨è¿æ¥çš„æƒè¡¡"><a href="#å·ç§¯å’Œå…¨è¿æ¥çš„æƒè¡¡" class="headerlink" title="å·ç§¯å’Œå…¨è¿æ¥çš„æƒè¡¡"></a>å·ç§¯å’Œå…¨è¿æ¥çš„æƒè¡¡</h4><p>äº§ç”Ÿregion embeddingåï¼ŒæŒ‰ç…§ç»å…¸çš„TextCNNçš„åšæ³•çš„è¯ï¼Œå°±æ˜¯ä»æ¯ä¸ªç‰¹å¾å›¾ä¸­æŒ‘é€‰å‡ºæœ€æœ‰ä»£è¡¨æ€§çš„ç‰¹å¾ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥åº”ç”¨å…¨å±€æœ€å¤§æ± åŒ–å±‚ï¼ˆmax-over-time-pooling layerï¼‰ï¼Œè¿™æ ·å°±ç”Ÿæˆäº†è¿™æ®µæ–‡æœ¬çš„ç‰¹å¾å‘é‡ï¼ˆå‡å¦‚å·ç§¯æ»¤æ³¢å™¨çš„sizeæœ‰3ï¼Œ4ï¼Œ5è¿™ä¸‰ç§ï¼Œæ¯ç§sizeåŒ…å«100ä¸ªå·ç§¯æ ¸ï¼Œé‚£ä¹ˆå½“ç„¶å°±ä¼šäº§ç”Ÿ3<em>100å¹…ç‰¹å¾å›¾ï¼Œç„¶åå°†max-over-time-poolingæ“ä½œåº”ç”¨åˆ°æ¯ä¸ªç‰¹å¾å›¾ä¸Šï¼Œäºæ˜¯æ–‡æœ¬çš„ç‰¹å¾å‘é‡å³3</em>100=300ç»´ï¼‰ã€‚<br>TextCNNè¿™æ ·åšçš„æ„ä¹‰æœ¬è´¨ä¸Šä¸è¯è¢‹æ¨¡å‹ï¼ˆå«ngramï¼‰+weighting+NB/MaxEnt/SVMçš„ç»å…¸æ–‡æœ¬åˆ†ç±»æ¨¡å‹æ²¡æœ¬è´¨åŒºåˆ«ï¼Œåªä¸è¿‡one-hotè¡¨ç¤ºåˆ°word embeddingè¡¨ç¤ºçš„è½¬å˜é¿å…äº†è¯è¢‹æ¨¡å‹é­é‡çš„æ•°æ®ç¨€ç–é—®é¢˜ã€‚å¯ä»¥è¯´ï¼ŒTextCNNæœ¬è´¨ä¸Šæ”¶ç›Šäºè¯å‘é‡çš„å¼•å…¥å¸¦æ¥çš„â€œè¿‘ä¹‰è¯æœ‰ç›¸è¿‘å‘é‡è¡¨ç¤ºâ€çš„bonusï¼ŒåŒæ—¶TextCNNæ°å¥½å¯ä»¥è¾ƒå¥½çš„åˆ©ç”¨è¯å‘é‡ä¸­çš„çŸ¥è¯†ï¼ˆè¿‘ä¹‰å…³ç³»ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œç»å…¸æ¨¡å‹é‡Œéš¾ä»¥å­¦ä¹ çš„è¿œè·ç¦»ä¿¡æ¯ï¼ˆå¦‚12gramï¼‰åœ¨TextCNNä¸­ä¾ç„¶éš¾ä»¥å­¦ä¹ ã€‚</p>
<h5 id="ç­‰é•¿å·ç§¯"><a href="#ç­‰é•¿å·ç§¯" class="headerlink" title="ç­‰é•¿å·ç§¯"></a>ç­‰é•¿å·ç§¯</h5><p>å‡è®¾è¾“å…¥çš„åºåˆ—é•¿åº¦ä¸ºnï¼Œå·ç§¯æ ¸å¤§å°ä¸ºmï¼Œæ­¥é•¿(stride)ä¸ºs,è¾“å…¥åºåˆ—ä¸¤ç«¯å„å¡«è¡¥pä¸ªé›¶(zero padding),é‚£ä¹ˆè¯¥å·ç§¯å±‚çš„è¾“å‡ºåºåˆ—ä¸º(n-m+2p)/s+1ã€‚</p>
<ol>
<li>çª„å·ç§¯(narrow convolution):æ­¥é•¿s=1,ä¸¤ç«¯ä¸è¡¥é›¶ï¼Œå³p=0ï¼Œå·ç§¯åè¾“å‡ºé•¿åº¦ä¸ºn-m+1ã€‚</li>
<li>å®½å·ç§¯(wide onvolution) ï¼šæ­¥é•¿s=1,ä¸¤ç«¯è¡¥é›¶p=m-1ï¼Œå·ç§¯åè¾“å‡ºé•¿åº¦ n+m-1ã€‚</li>
<li>ç­‰é•¿å·ç§¯(equal-width convolution): æ­¥é•¿s=1,ä¸¤ç«¯è¡¥é›¶p=(m-1)/2ï¼Œå·ç§¯åè¾“å‡ºé•¿åº¦ä¸ºnã€‚</li>
</ol>
<p>é‚£ä¹ˆå¯¹æ–‡æœ¬ï¼Œæˆ–è€…è¯´å¯¹word embeddingåºåˆ—è¿›è¡Œç­‰é•¿å·ç§¯çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br>æ—¢ç„¶è¾“å…¥è¾“å‡ºåºåˆ—çš„ä½ç½®æ•°ä¸€æ ·å¤šï¼Œæˆ‘ä»¬å°†è¾“å…¥è¾“å‡ºåºåˆ—çš„ç¬¬nä¸ªembeddingç§°ä¸ºç¬¬nä¸ªè¯ä½ï¼Œé‚£ä¹ˆè¿™æ—¶sizeä¸ºnçš„å·ç§¯æ ¸äº§ç”Ÿçš„ç­‰é•¿å·ç§¯çš„æ„ä¹‰å°±å¾ˆæ˜æ˜¾äº†ï¼Œé‚£å°±æ˜¯å°†è¾“å…¥åºåˆ—çš„æ¯ä¸ªè¯ä½åŠå…¶å·¦å³((n-1)/2)ä¸ªè¯çš„ä¸Šä¸‹æ–‡ä¿¡æ¯å‹ç¼©ä¸ºè¯¥è¯ä½çš„embeddingï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œäº§ç”Ÿäº†æ¯ä¸ªè¯ä½çš„è¢«ä¸Šä¸‹æ–‡ä¿¡æ¯ä¿®é¥°è¿‡çš„æ›´é«˜levelæ›´åŠ å‡†ç¡®çš„è¯­ä¹‰ã€‚</p>
<p>å›åˆ°DPCNNä¸Šæ¥ï¼Œæˆ‘ä»¬æƒ³è¦å…‹æœTextCNNçš„ç¼ºç‚¹ï¼Œæ•è·é•¿è·ç¦»æ¨¡å¼ï¼Œæ˜¾ç„¶å°±è¦ç”¨åˆ°æ·±å±‚CNNå•¦ã€‚é‚£ä¹ˆç›´æ¥ç­‰é•¿å·ç§¯å †ç­‰é•¿å·ç§¯å¯ä¸å¯ä»¥å‘¢ï¼Ÿ<br>æ˜¾ç„¶è¿™æ ·ä¼šè®©æ¯ä¸ªè¯ä½åŒ…å«è¿›å»è¶Šæ¥è¶Šå¤šï¼Œè¶Šæ¥è¶Šé•¿çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä½†æ˜¯è¿™æ ·æ•ˆç‡ä¹Ÿå¤ªä½äº†ï¼Œæ˜¾ç„¶ä¼šè®©ç½‘ç»œå±‚æ•°å˜å¾—éå¸¸éå¸¸éå¸¸æ·±ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å¤ªç¬¨é‡ã€‚ä¸è¿‡ï¼Œæ—¢ç„¶ç­‰é•¿å·ç§¯å †ç­‰é•¿å·ç§¯ä¼šè®©æ¯ä¸ªè¯ä½çš„embeddingæè¿°è¯­ä¹‰æè¿°çš„æ›´åŠ ä¸°å¯Œå‡†ç¡®ï¼Œé‚£ä¹ˆå½“ç„¶æˆ‘ä»¬å¯ä»¥é€‚å½“çš„å †ä¸¤å±‚æ¥æé«˜è¯ä½embeddingçš„è¡¨ç¤ºçš„ä¸°å¯Œæ€§ã€‚<br><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/equal_cnn.png" alt="avatar"></p>
<h5 id="å›ºå®šfeature-mapçš„æ•°é‡"><a href="#å›ºå®šfeature-mapçš„æ•°é‡" class="headerlink" title="å›ºå®šfeature mapçš„æ•°é‡"></a>å›ºå®šfeature mapçš„æ•°é‡</h5><p>åœ¨è¡¨ç¤ºå¥½æ¯ä¸ªè¯ä½çš„è¯­ä¹‰åï¼Œå…¶å®å¾ˆå¤šé‚»æ¥è¯æˆ–è€…é‚»æ¥ngramçš„è¯ä¹‰æ˜¯å¯ä»¥åˆå¹¶çš„ï¼Œä¾‹å¦‚â€œå°æ˜ äºº ä¸è¦ å¤ªå¥½â€ä¸­çš„â€œä¸è¦â€å’Œâ€œå¤ªå¥½â€è™½ç„¶è¯­ä¹‰æœ¬æ¥ç¦»å¾—å¾ˆè¿œï¼Œä½†æ˜¯ä½œä¸ºé‚»æ¥è¯â€œä¸è¦å¤ªå¥½â€å‡ºç°æ—¶å…¶è¯­ä¹‰åŸºæœ¬ç­‰ä»·ä¸ºâ€œå¾ˆå¥½â€ï¼Œè¿™æ ·å®Œå…¨å¯ä»¥æŠŠâ€œä¸è¦â€å’Œâ€œå¤ªå¥½â€çš„è¯­ä¹‰è¿›è¡Œåˆå¹¶ã€‚åŒæ—¶ï¼Œåˆå¹¶çš„è¿‡ç¨‹å®Œå…¨å¯ä»¥åœ¨åŸå§‹çš„embedding spaceä¸­è¿›è¡Œçš„ï¼Œæ¯•ç«ŸåŸæ–‡ä¸­ç›´æ¥æŠŠâ€œä¸è¦å¤ªå¥½â€åˆå¹¶ä¸ºâ€œå¾ˆå¥½â€æ˜¯å¾ˆå¯ä»¥çš„ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦åŠ¨æ•´ä¸ªè¯­ä¹‰ç©ºé—´ã€‚<br>å®é™…ä¸Šï¼Œç›¸æ¯”å›¾åƒä¸­è¿™ç§ä»â€œç‚¹ã€çº¿ã€å¼§â€è¿™ç§low-levelç‰¹å¾åˆ°â€œçœ¼ç›ã€é¼»å­ã€å˜´â€è¿™ç§high-levelç‰¹å¾çš„æ˜æ˜¾å±‚æ¬¡æ€§çš„ç‰¹å¾åŒºåˆ†ï¼Œæ–‡æœ¬ä¸­çš„ç‰¹å¾è¿›é˜¶æ˜æ˜¾è¦æ‰å¹³çš„å¤šï¼Œå³ä»å•è¯ï¼ˆ1gramï¼‰åˆ°çŸ­è¯­å†åˆ°3gramã€4gramçš„å‡çº§ï¼Œå…¶å®å¾ˆå¤§ç¨‹åº¦ä¸Šå‡æ»¡è¶³â€œè¯­ä¹‰å–ä»£â€çš„ç‰¹æ€§ã€‚è€Œå›¾åƒä¸­å°±å¾ˆéš¾å‘ç”Ÿè¿™ç§â€è¯­ä¹‰å–ä»£â€œç°è±¡<br>å› æ­¤ï¼ŒDPCNNä¸ResNetå¾ˆå¤§ä¸€ä¸ªä¸åŒå°±æ˜¯ï¼Œ<strong>åœ¨DPCNNä¸­å›ºå®šæ­»äº†feature mapçš„æ•°é‡</strong>ï¼Œä¹Ÿå°±æ˜¯å›ºå®šä½äº†embedding spaceçš„ç»´åº¦ï¼ˆä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œä»¥ä¸‹ç®€ç§°è¯­ä¹‰ç©ºé—´ï¼‰ï¼Œä½¿å¾—ç½‘ç»œæœ‰å¯èƒ½è®©æ•´ä¸ªé‚»æ¥è¯ï¼ˆé‚»æ¥ngramï¼‰çš„åˆå¹¶æ“ä½œåœ¨åŸå§‹ç©ºé—´æˆ–è€…ä¸åŸå§‹ç©ºé—´ç›¸ä¼¼çš„ç©ºé—´ä¸­è¿›è¡Œï¼ˆå½“ç„¶ï¼Œç½‘ç»œåœ¨å®é™…ä¸­ä¼šä¸ä¼šè¿™æ ·åšæ˜¯ä¸ä¸€å®šçš„ï¼Œåªæ˜¯æä¾›äº†è¿™ä¹ˆä¸€ç§æ¡ä»¶ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ªç½‘ç»œè™½ç„¶å½¢çŠ¶ä¸Šæ¥çœ‹æ˜¯æ·±å±‚çš„ï¼Œä½†æ˜¯ä»è¯­ä¹‰ç©ºé—´ä¸Šæ¥çœ‹å®Œå…¨å¯ä»¥æ˜¯æ‰å¹³çš„ã€‚è€ŒResNetåˆ™æ˜¯ä¸æ–­çš„æ”¹å˜è¯­ä¹‰ç©ºé—´ï¼Œä½¿å¾—å›¾åƒçš„è¯­ä¹‰éšç€ç½‘ç»œå±‚çš„åŠ æ·±ä¹Ÿä¸æ–­çš„è·³å‘æ›´é«˜levelçš„è¯­ä¹‰ç©ºé—´ã€‚</p>
<h5 id="æ± åŒ–"><a href="#æ± åŒ–" class="headerlink" title="æ± åŒ–"></a><strong>æ± åŒ–</strong></h5><p>æ‰€ä»¥æä¾›äº†è¿™ä¹ˆå¥½çš„åˆå¹¶æ¡ä»¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨pooling layerè¿›è¡Œåˆå¹¶å•¦ã€‚æ¯ç»è¿‡ä¸€ä¸ªsize=3, stride=2ï¼ˆå¤§å°ä¸º3ï¼Œæ­¥é•¿ä¸º2ï¼‰çš„æ± åŒ–å±‚ï¼ˆä»¥ä¸‹ç®€ç§°1/2æ± åŒ–å±‚ï¼‰ï¼Œåºåˆ—çš„é•¿åº¦å°±è¢«å‹ç¼©æˆäº†åŸæ¥çš„ä¸€åŠã€‚è¿™æ ·åŒæ ·æ˜¯size=3çš„å·ç§¯æ ¸ï¼Œæ¯ç»è¿‡ä¸€ä¸ª1/2æ± åŒ–å±‚åï¼Œå…¶èƒ½æ„ŸçŸ¥åˆ°çš„æ–‡æœ¬ç‰‡æ®µå°±æ¯”ä¹‹å‰é•¿äº†ä¸€å€ã€‚ä¾‹å¦‚ä¹‹å‰æ˜¯åªèƒ½æ„ŸçŸ¥3ä¸ªè¯ä½é•¿åº¦çš„ä¿¡æ¯ï¼Œç»è¿‡1/2æ± åŒ–å±‚åå°±èƒ½æ„ŸçŸ¥6ä¸ªè¯ä½é•¿åº¦çš„ä¿¡æ¯ï¼Œè¿™æ—¶æŠŠ1/2æ± åŒ–å±‚å’Œsize=3çš„å·ç§¯å±‚ç»„åˆèµ·æ¥å¦‚å›¾ï¼š<br><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/dpcnn_pooling.png" alt="avatar"></p>
<h5 id="æ®‹å·®è¿æ¥"><a href="#æ®‹å·®è¿æ¥" class="headerlink" title="æ®‹å·®è¿æ¥"></a>æ®‹å·®è¿æ¥</h5><p>äºæˆ‘ä»¬åœ¨åˆå§‹åŒ–æ·±åº¦CNNæ—¶ï¼Œå¾€å¾€å„å±‚æƒé‡éƒ½æ˜¯åˆå§‹åŒ–ä¸ºä¸€ä¸ªå¾ˆå°çš„å€¼ï¼Œè¿™å°±å¯¼è‡´æœ€å¼€å§‹çš„ç½‘ç»œä¸­ï¼Œåç»­å‡ ä¹æ¯å±‚çš„è¾“å…¥éƒ½æ˜¯æ¥è¿‘0ï¼Œè¿™æ—¶ç½‘ç»œçš„è¾“å‡ºè‡ªç„¶æ˜¯æ²¡æ„ä¹‰çš„ï¼Œè€Œè¿™äº›å°æƒé‡åŒæ—¶ä¹Ÿé˜»ç¢äº†æ¢¯åº¦çš„ä¼ æ’­ï¼Œä½¿å¾—ç½‘ç»œçš„åˆå§‹è®­ç»ƒé˜¶æ®µå¾€å¾€è¦è¿­ä»£å¥½ä¹…æ‰èƒ½å¯åŠ¨ã€‚<br>åŒæ—¶ï¼Œå°±ç®—ç½‘ç»œå¯åŠ¨å®Œæˆï¼Œç”±äºæ·±åº¦ç½‘ç»œä¸­ä»¿å°„çŸ©é˜µï¼ˆæ¯ä¸¤å±‚é—´çš„è¿æ¥è¾¹ï¼‰è¿‘ä¼¼è¿ä¹˜ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­ç½‘ç»œä¹Ÿéå¸¸å®¹æ˜“å‘ç”Ÿæ¢¯åº¦çˆ†ç‚¸æˆ–å¼¥æ•£é—®é¢˜ï¼ˆè™½ç„¶ç”±äºéå…±äº«æƒé‡ï¼Œæ·±åº¦CNNç½‘ç»œæ¯”RNNç½‘ç»œè¦å¥½ç‚¹ï¼‰ã€‚<br>é‚£ä¹ˆå¦‚ä½•è§£å†³æ·±åº¦CNNç½‘ç»œçš„æ¢¯åº¦å¼¥æ•£é—®é¢˜å‘¢ï¼Ÿ<br>ResNetä¸­æå‡ºçš„shortcut-connection/skip-connection/residual-connectionï¼ˆæ®‹å·®è¿æ¥ï¼‰å°±æ˜¯ä¸€ç§éå¸¸ç®€å•ã€åˆç†ã€æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚<br><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/dpcnn_resnet.png" alt="avatar"><br>æ—¢ç„¶æ¯ä¸ªblockçš„è¾“å…¥åœ¨åˆå§‹é˜¶æ®µå®¹æ˜“æ˜¯0è€Œæ— æ³•æ¿€æ´»ï¼Œé‚£ä¹ˆç›´æ¥ç”¨ä¸€æ¡çº¿æŠŠregion embeddingå±‚è¿æ¥åˆ°æ¯ä¸ªblockçš„è¾“å…¥ä¹ƒè‡³æœ€ç»ˆçš„æ± åŒ–å±‚/è¾“å‡ºå±‚ä¸å°±å¯ä»¥ã€‚æœ‰äº†shortcutåï¼Œæ¢¯åº¦å°±å¯ä»¥å¿½ç•¥å·ç§¯å±‚æƒé‡çš„å‰Šå¼±ï¼Œä»shortcutä¸€è·¯æ— æŸçš„ä¼ é€’åˆ°å„ä¸ªblockæ‰‹é‡Œï¼Œç›´è‡³ç½‘ç»œå‰ç«¯ï¼Œä»è€Œæå¤§çš„ç¼“è§£äº†æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</p>
<h4 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DPCNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab, embedding_dim, num_filters, use_pretrain_embedding,num_classes)</span>:</span></span><br><span class="line">        super(DPCNN, self).__init__()</span><br><span class="line">        <span class="keyword">if</span> use_pretrain_embedding:</span><br><span class="line">            self.embedding = nn.Embedding.from_pretrained(vocab.vectors)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.embedding = nn.Embedding(len(vocab), embedding_dim, padding_idx=vocab.pad_index)</span><br><span class="line">        self.conv_region = nn.Conv2d(<span class="number">1</span>, num_filters, (<span class="number">3</span>, embedding_dim), stride=<span class="number">1</span>)</span><br><span class="line">        self.conv = nn.Conv2d(num_filters, num_filters, (<span class="number">3</span>, <span class="number">1</span>), stride=<span class="number">1</span>)</span><br><span class="line">        self.max_pool = nn.MaxPool2d(kernel_size=(<span class="number">3</span>, <span class="number">1</span>), stride=<span class="number">2</span>)</span><br><span class="line">        self.padding1 = nn.ZeroPad2d((<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>))  <span class="comment"># top bottom</span></span><br><span class="line">        self.padding2 = nn.ZeroPad2d((<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>))  <span class="comment"># bottom</span></span><br><span class="line">        self.relu = nn.ReLU()</span><br><span class="line">        self.fc = nn.Linear(num_filters, num_classes)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text,text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text [batch_size,seq_len]</span></span><br><span class="line">        x = self.embedding(text) <span class="comment"># x=[batch_size,seq_len,embedding_dim]</span></span><br><span class="line">        x = x.unsqueeze(<span class="number">1</span>)  <span class="comment"># [batch_size, 1, seq_len, embedding_dim]</span></span><br><span class="line">        x = self.conv_region(x)  <span class="comment"># x = [batch_size, num_filters, seq_len-3+1, 1]</span></span><br><span class="line"></span><br><span class="line">        x = self.padding1(x)  <span class="comment"># [batch_size, num_filters, seq_len, 1]</span></span><br><span class="line">        x = self.relu(x)</span><br><span class="line">        x = self.conv(x)  <span class="comment"># [batch_size, num_filters, seq_len-3+1, 1]</span></span><br><span class="line">        x = self.padding1(x)  <span class="comment"># [batch_size, num_filters, seq_len, 1]</span></span><br><span class="line">        x = self.relu(x)</span><br><span class="line">        x = self.conv(x)  <span class="comment"># [batch_size, num_filters, seq_len-3+1, 1]</span></span><br><span class="line">        <span class="keyword">while</span> x.size()[<span class="number">2</span>] &gt;= <span class="number">2</span>:</span><br><span class="line">            x = self._block(x) <span class="comment"># [batch_size, num_filters,1,1]</span></span><br><span class="line">        x = x.squeeze()  <span class="comment"># [batch_size, num_filters]</span></span><br><span class="line">        x = self.fc(x) <span class="comment"># [batch_size, 1]</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_block</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x = self.padding2(x)</span><br><span class="line">        px = self.max_pool(x)</span><br><span class="line"></span><br><span class="line">        x = self.padding1(px)</span><br><span class="line">        x = F.relu(x)</span><br><span class="line">        x = self.conv(x)</span><br><span class="line"></span><br><span class="line">        x = self.padding1(x)</span><br><span class="line">        x = F.relu(x)</span><br><span class="line">        x = self.conv(x)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Short Cut</span></span><br><span class="line">        x = x + px</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure>
<h3 id="Bert"><a href="#Bert" class="headerlink" title="Bert"></a>Bert</h3><h4 id="BERT"><a href="#BERT" class="headerlink" title="BERT"></a>BERT</h4><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/bert_gpt_elmo.png" alt="avatar"></p>
<h5 id="Task-1-MLM"><a href="#Task-1-MLM" class="headerlink" title="Task 1: MLM"></a>Task 1: MLM</h5><p>ç”±äºBERTéœ€è¦é€šè¿‡ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¥é¢„æµ‹ä¸­å¿ƒè¯çš„ä¿¡æ¯ï¼ŒåŒæ—¶åˆä¸å¸Œæœ›æ¨¡å‹æå‰çœ‹è§ä¸­å¿ƒè¯çš„ä¿¡æ¯ï¼Œå› æ­¤æå‡ºäº†ä¸€ç§ Masked Language Model çš„é¢„è®­ç»ƒæ–¹å¼ï¼Œå³éšæœºä»è¾“å…¥é¢„æ–™ä¸Š mask æ‰ä¸€äº›å•è¯ï¼Œç„¶åé€šè¿‡çš„ä¸Šä¸‹æ–‡é¢„æµ‹è¯¥å•è¯ï¼Œç±»ä¼¼äºä¸€ä¸ªå®Œå½¢å¡«ç©ºä»»åŠ¡ã€‚</p>
<p>åœ¨é¢„è®­ç»ƒä»»åŠ¡ä¸­ï¼Œ15%çš„ Word Piece ä¼šè¢«maskï¼Œè¿™15%çš„ Word Piece ä¸­ï¼Œ80%çš„æ—¶å€™ä¼šç›´æ¥æ›¿æ¢ä¸º [Mask] ï¼Œ10%çš„æ—¶å€™å°†å…¶æ›¿æ¢ä¸ºå…¶å®ƒä»»æ„å•è¯ï¼Œ10%çš„æ—¶å€™ä¼šä¿ç•™åŸå§‹Token</p>
<ul>
<li>æ²¡æœ‰100%maskçš„åŸå› <ul>
<li>å¦‚æœå¥å­ä¸­çš„æŸä¸ªToken100%éƒ½ä¼šè¢«maskæ‰ï¼Œé‚£ä¹ˆåœ¨fine-tuningçš„æ—¶å€™æ¨¡å‹å°±ä¼šæœ‰ä¸€äº›æ²¡æœ‰è§è¿‡çš„å•è¯</li>
</ul>
</li>
<li>åŠ å…¥10%éšæœºtokençš„åŸå› <ul>
<li>Transformerè¦ä¿æŒå¯¹æ¯ä¸ªè¾“å…¥tokençš„åˆ†å¸ƒå¼è¡¨å¾ï¼Œå¦åˆ™æ¨¡å‹å°±ä¼šè®°ä½è¿™ä¸ª[mask]æ˜¯token â€™hairyâ€˜</li>
<li>å¦å¤–ç¼–ç å™¨ä¸çŸ¥é“å“ªäº›è¯éœ€è¦é¢„æµ‹çš„ï¼Œå“ªäº›è¯æ˜¯é”™è¯¯çš„ï¼Œå› æ­¤è¢«è¿«éœ€è¦å­¦ä¹ æ¯ä¸€ä¸ªtokençš„è¡¨ç¤ºå‘é‡</li>
</ul>
</li>
<li>å¦å¤–ï¼Œæ¯ä¸ªbatchsizeåªæœ‰15%çš„å•è¯è¢«maskçš„åŸå› ï¼Œæ˜¯å› ä¸ºæ€§èƒ½å¼€é”€çš„é—®é¢˜ï¼ŒåŒå‘ç¼–ç å™¨æ¯”å•é¡¹ç¼–ç å™¨è®­ç»ƒè¦æ›´æ…¢</li>
</ul>
<h5 id="Task-2-NSP"><a href="#Task-2-NSP" class="headerlink" title="Task 2: NSP"></a>Task 2: NSP</h5><p>ä»…ä»…ä¸€ä¸ªMLMä»»åŠ¡æ˜¯ä¸è¶³ä»¥è®© BERT è§£å†³é˜…è¯»ç†è§£ç­‰å¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡çš„ï¼Œå› æ­¤æ·»åŠ äº†é¢å¤–çš„ä¸€ä¸ªé¢„è®­ç»ƒä»»åŠ¡ï¼Œå³ Next Sequence Predictionã€‚</p>
<p>å…·ä½“ä»»åŠ¡å³ä¸ºä¸€ä¸ªå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡ï¼Œå³åˆ¤æ–­å¥å­Bæ˜¯å¦æ˜¯å¥å­Açš„ä¸‹æ–‡ï¼Œå¦‚æœæ˜¯çš„è¯è¾“å‡ºâ€™IsNextâ€˜ï¼Œå¦åˆ™è¾“å‡ºâ€™NotNextâ€˜ã€‚</p>
<p>è®­ç»ƒæ•°æ®çš„ç”Ÿæˆæ–¹å¼æ˜¯ä»å¹³è¡Œè¯­æ–™ä¸­éšæœºæŠ½å–çš„è¿ç»­ä¸¤å¥è¯ï¼Œå…¶ä¸­50%ä¿ç•™æŠ½å–çš„ä¸¤å¥è¯ï¼Œå®ƒä»¬ç¬¦åˆIsNextå…³ç³»ï¼Œå¦å¤–50%çš„ç¬¬äºŒå¥è¯æ˜¯éšæœºä»é¢„æ–™ä¸­æå–çš„ï¼Œå®ƒä»¬çš„å…³ç³»æ˜¯NotNextçš„ã€‚è¿™ä¸ªå…³ç³»ä¿å­˜åœ¨å›¾4ä¸­çš„[CLS]ç¬¦å·ä¸­</p>
<h5 id="è¾“å…¥"><a href="#è¾“å…¥" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h5><ul>
<li>Token Embeddingsï¼šå³ä¼ ç»Ÿçš„è¯å‘é‡å±‚ï¼Œæ¯ä¸ªè¾“å…¥æ ·æœ¬çš„é¦–å­—ç¬¦éœ€è¦è®¾ç½®ä¸º[CLS]ï¼Œå¯ä»¥ç”¨äºä¹‹åçš„åˆ†ç±»ä»»åŠ¡ï¼Œè‹¥æœ‰ä¸¤ä¸ªä¸åŒçš„å¥å­ï¼Œéœ€è¦ç”¨[SEP]åˆ†éš”ï¼Œä¸”æœ€åä¸€ä¸ªå­—ç¬¦éœ€è¦ç”¨[SEP]è¡¨ç¤ºç»ˆæ­¢</li>
<li>Segment Embeddingsï¼šä¸º[0,1][0,1]åºåˆ—ï¼Œç”¨æ¥åœ¨NSPä»»åŠ¡ä¸­åŒºåˆ«ä¸¤ä¸ªå¥å­ï¼Œä¾¿äºåšå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡</li>
<li>Position Embeddingsï¼šä¸Transformerä¸­çš„ä½ç½®å‘é‡ä¸åŒï¼ŒBERTä¸­çš„ä½ç½®å‘é‡æ˜¯ç›´æ¥è®­ç»ƒå‡ºæ¥çš„</li>
</ul>
<h5 id="Fine-tunninng"><a href="#Fine-tunninng" class="headerlink" title="Fine-tunninng"></a>Fine-tunninng</h5><p>å¯¹äºä¸åŒçš„ä¸‹æ¸¸ä»»åŠ¡ï¼Œæˆ‘ä»¬ä»…éœ€è¦å¯¹BERTä¸åŒä½ç½®çš„è¾“å‡ºè¿›è¡Œå¤„ç†å³å¯ï¼Œæˆ–è€…ç›´æ¥å°†BERTä¸åŒä½ç½®çš„è¾“å‡ºç›´æ¥è¾“å…¥åˆ°ä¸‹æ¸¸æ¨¡å‹å½“ä¸­ã€‚å…·ä½“çš„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>å¯¹äºæƒ…æ„Ÿåˆ†æç­‰å•å¥åˆ†ç±»ä»»åŠ¡ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥å•ä¸ªå¥å­ï¼ˆä¸éœ€è¦[SEP]åˆ†éš”åŒå¥ï¼‰ï¼Œå°†[CLS]çš„è¾“å‡ºç›´æ¥è¾“å…¥åˆ°åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»</li>
<li>å¯¹äºå¥å­å¯¹ä»»åŠ¡ï¼ˆå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡ï¼‰ï¼Œéœ€è¦ç”¨[SEP]åˆ†éš”ä¸¤ä¸ªå¥å­è¾“å…¥åˆ°æ¨¡å‹ä¸­ï¼Œç„¶ååŒæ ·ä»…é¡»å°†[CLS]çš„è¾“å‡ºé€åˆ°åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»</li>
<li>å¯¹äºé—®ç­”ä»»åŠ¡ï¼Œå°†é—®é¢˜ä¸ç­”æ¡ˆæ‹¼æ¥è¾“å…¥åˆ°BERTæ¨¡å‹ä¸­ï¼Œç„¶åå°†ç­”æ¡ˆä½ç½®çš„è¾“å‡ºå‘é‡è¿›è¡ŒäºŒåˆ†ç±»å¹¶åœ¨å¥å­æ–¹å‘ä¸Šè¿›è¡Œsoftmaxï¼ˆåªéœ€é¢„æµ‹å¼€å§‹å’Œç»“æŸä½ç½®å³å¯ï¼‰</li>
<li>å¯¹äºå‘½åå®ä½“è¯†åˆ«ä»»åŠ¡ï¼Œå¯¹æ¯ä¸ªä½ç½®çš„è¾“å‡ºè¿›è¡Œåˆ†ç±»å³å¯ï¼Œå¦‚æœå°†æ¯ä¸ªä½ç½®çš„è¾“å‡ºä½œä¸ºç‰¹å¾è¾“å…¥åˆ°CRFå°†å–å¾—æ›´å¥½çš„æ•ˆæœã€‚</li>
</ul>
<h5 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul>
<li>BERTçš„é¢„è®­ç»ƒä»»åŠ¡MLMä½¿å¾—èƒ½å¤Ÿå€ŸåŠ©ä¸Šä¸‹æ–‡å¯¹åºåˆ—è¿›è¡Œç¼–ç ï¼Œä½†åŒæ—¶ä¹Ÿä½¿å¾—å…¶é¢„è®­ç»ƒè¿‡ç¨‹ä¸ä¸­çš„æ•°æ®ä¸å¾®è°ƒçš„æ•°æ®ä¸åŒ¹é…ï¼Œéš¾ä»¥é€‚åº”ç”Ÿæˆå¼ä»»åŠ¡</li>
<li>å¦å¤–ï¼ŒBERTæ²¡æœ‰è€ƒè™‘é¢„æµ‹[MASK]ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œæ˜¯å¯¹è¯­è¨€æ¨¡å‹è”åˆæ¦‚ç‡çš„æœ‰åä¼°è®¡</li>
<li>ç”±äºæœ€å¤§è¾“å…¥é•¿åº¦çš„é™åˆ¶ï¼Œé€‚åˆå¥å­å’Œæ®µè½çº§åˆ«çš„ä»»åŠ¡ï¼Œä¸é€‚ç”¨äºæ–‡æ¡£çº§åˆ«çš„ä»»åŠ¡ï¼ˆå¦‚é•¿æ–‡æœ¬åˆ†ç±»ï¼‰</li>
<li>é€‚åˆå¤„ç†è‡ªç„¶è¯­ä¹‰ç†è§£ç±»ä»»åŠ¡(NLU)ï¼Œè€Œä¸é€‚åˆè‡ªç„¶è¯­è¨€ç”Ÿæˆç±»ä»»åŠ¡(NLG)</li>
</ul>
<h5 id="ä»£ç -4"><a href="#ä»£ç -4" class="headerlink" title="ä»£ç "></a>ä»£ç </h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bert</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, bert_model_path,num_classes)</span>:</span></span><br><span class="line">        super(Bert, self).__init__()</span><br><span class="line">        self.bert = BertModel.from_pretrained(bert_model_path)</span><br><span class="line">        <span class="comment"># ä¸å¯¹bertè¿›è¡Œè®­ç»ƒ</span></span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> self.bert.parameters():</span><br><span class="line">            param.requires_grad = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        self.fc = nn.Linear(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],num_classes)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text,text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text [ batch_size,senten_len]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># context = x[0]  # è¾“å…¥çš„å¥å­</span></span><br><span class="line">        <span class="comment"># mask = x[2]  # å¯¹paddingéƒ¨åˆ†è¿›è¡Œmaskï¼Œå’Œå¥å­ä¸€ä¸ªsizeï¼Œpaddingéƒ¨åˆ†ç”¨0è¡¨ç¤ºï¼Œå¦‚ï¼š[1, 1, 1, 1, 0, 0]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># cls [batch_size, 768]</span></span><br><span class="line">        <span class="comment"># sentence [batch size,sen len,  768]</span></span><br><span class="line">        sentence, cls = self.bert(text)</span><br><span class="line"></span><br><span class="line">        out = self.fc(cls)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h4 id="bert-config-json"><a href="#bert-config-json" class="headerlink" title="bert_config.json"></a>bert_config.json</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "attention_probs_dropout_prob": 0.1, #ä¹˜æ³•attentionæ—¶ï¼Œsoftmaxådropoutæ¦‚ç‡ </span><br><span class="line">  "directionality": "bidi", </span><br><span class="line">  "hidden_act": "gelu",   #æ¿€æ´»å‡½æ•° </span><br><span class="line">  "hidden_dropout_prob": 0.1, #éšè—å±‚dropoutæ¦‚ç‡ </span><br><span class="line">  "hidden_size": 768, #éšè—å•å…ƒæ•° </span><br><span class="line">  "initializer_range": 0.02, #åˆå§‹åŒ–èŒƒå›´ </span><br><span class="line">  "intermediate_size": 3072, #å‡ç»´ç»´åº¦</span><br><span class="line">  "max_position_embeddings": 512, #ä¸€ä¸ªå¤§äºseq_lengthçš„å‚æ•°ï¼Œç”¨äºç”Ÿæˆposition_embedding</span><br><span class="line">  "num_attention_heads": 12,#æ¯ä¸ªéšè—å±‚ä¸­çš„attention headæ•° </span><br><span class="line">  "num_hidden_layers": 2, #éšè—å±‚æ•° </span><br><span class="line">  "pooler_fc_size": 768, </span><br><span class="line">  "pooler_num_attention_heads": 12, </span><br><span class="line">  "pooler_num_fc_layers": 3, </span><br><span class="line">  "pooler_size_per_head": 128, </span><br><span class="line">  "pooler_type": "first_token_transform", </span><br><span class="line">  "type_vocab_size": 2, #segment_idsç±»åˆ« [0,1] </span><br><span class="line">  "vocab_size": 21128#è¯å…¸ä¸­è¯æ•°</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¾®åšæƒ…æ„Ÿåˆ†ç±»ç»“æœæ¯”è¾ƒ"><a href="#å¾®åšæƒ…æ„Ÿåˆ†ç±»ç»“æœæ¯”è¾ƒ" class="headerlink" title="å¾®åšæƒ…æ„Ÿåˆ†ç±»ç»“æœæ¯”è¾ƒ"></a>å¾®åšæƒ…æ„Ÿåˆ†ç±»ç»“æœæ¯”è¾ƒ</h3><div class="table-container">
<table>
<thead>
<tr>
<th>æ¨¡å‹</th>
<th>é€Ÿåº¦</th>
<th style="text-align:center">æ•ˆæœ(best)ï¼š</th>
<th>æ•ˆæœï¼š</th>
<th>å‚æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>FastText</td>
<td>4.43s/epoch</td>
<td style="text-align:center">å­—å‘é‡,è®­ç»ƒé›†ï¼š97.30%,éªŒè¯é›†ï¼š96.39%ï¼Œæµ‹è¯•é›†ï¼š96.00%</td>
<td>è¯å‘é‡,é€Ÿåº¦ï¼š13.97s/epochï¼Œè®­ç»ƒé›†ï¼š95.92% éªŒè¯é›†ï¼š93.31%ï¼Œæµ‹è¯•é›†ï¼š92.19%</td>
<td>â€œembedding_dimâ€: 300, â€œoutput_dimâ€: 1</td>
</tr>
<tr>
<td>Textcnn</td>
<td>18.99s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼Œè®­ç»ƒé›†ï¼š97.28%,éªŒè¯é›†ï¼š97.68%ï¼Œæµ‹è¯•é›†ï¼š97.12%</td>
<td>è¯å‘é‡,é€Ÿåº¦ï¼š36.79s/epoch,è®­ç»ƒé›†ï¼š95.63ï¼ŒéªŒè¯é›†ï¼š94.08%ï¼Œæµ‹è¯•é›†ï¼š94.58%</td>
<td>embedding_dim: 300, n_filters: 100, filter_sizes: [3,4,5], dropout: 0.5, output_dim: 1</td>
</tr>
<tr>
<td>Rnn</td>
<td>23.33s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š97.81%,éªŒè¯é›†ï¼š97.67%ï¼Œæµ‹è¯•é›†ï¼š97.66%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š22.44s/epoch,è®­ç»ƒé›†ï¼š96.03%ï¼ŒéªŒè¯é›†ï¼š95.46%ï¼Œæµ‹è¯•é›†ï¼š95.12%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œn_layersâ€:1, â€œbidirectionalâ€: false, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Rnn</td>
<td>46.78s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š97.76%ï¼ŒéªŒè¯é›†ï¼š97.71%ï¼Œæµ‹è¯•é›†ï¼š97.65%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š32.34s/epoch,è®­ç»ƒé›†ï¼š92.49%ï¼ŒéªŒè¯é›†ï¼š95.43%ï¼Œæµ‹è¯•é›†ï¼š92.20%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œ<strong>n_layers</strong>â€œ:2, â€œ<strong>bidirectional</strong>â€œ: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Lstm</td>
<td>27.19s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š98.00%ï¼ŒéªŒè¯é›†ï¼š97.76%ï¼Œæµ‹è¯•é›†ï¼š97.68%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š24.14s/epoch,è®­ç»ƒé›†ï¼š93.99%ï¼ŒéªŒè¯é›†ï¼š96.16%ï¼Œæµ‹è¯•é›†ï¼š96.20%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œn_layersâ€:1, â€œbidirectionalâ€: false, â€œdropoutâ€: 0, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Lstm</td>
<td>65.50s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š98.03%ï¼ŒéªŒè¯é›†ï¼š97.95%ï¼Œæµ‹è¯•é›†ï¼š97.88%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š40.78s/epoch,è®­ç»ƒé›†ï¼š96.93%ï¼ŒéªŒè¯é›†ï¼š97.03%ï¼Œæµ‹è¯•é›†ï¼š96.80%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œ<strong>n_layers</strong>â€œ:2, â€œ<strong>bidirectional</strong>â€œ: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Rnn-attention</td>
<td>24.27s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š97.68%ï¼ŒéªŒè¯é›†ï¼š97.87%ï¼Œæµ‹è¯•é›†ï¼š97.66%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š22.53s/epoch,è®­ç»ƒé›†ï¼š96.18%ï¼ŒéªŒè¯é›†ï¼š95.61%ï¼Œæµ‹è¯•é›†ï¼š95.53%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œn_layersâ€: 1, â€œbidirectionalâ€: false, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Rnn-attention</td>
<td>48.73s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š98.24%ï¼ŒéªŒè¯é›†ï¼š97.89%ï¼Œæµ‹è¯•é›†ï¼š97.76%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š33.19s/epoch,è®­ç»ƒé›†ï¼š96.53%ï¼ŒéªŒè¯é›†ï¼š95.78%ï¼Œæµ‹è¯•é›†ï¼š95.50%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œ<strong>n_layers</strong>â€œ:2, â€œ<strong>bidirectional</strong>â€œ: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Rcnn</td>
<td>27.51s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š98.36%ï¼ŒéªŒè¯é›†ï¼š98.36%ï¼Œæµ‹è¯•é›†ï¼š98.30%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š23.61s/epoch,è®­ç»ƒé›†ï¼š97.66%ï¼ŒéªŒè¯é›†ï¼š97.29%ï¼Œæµ‹è¯•é›†ï¼š97.20%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œn_layersâ€:1, â€œbidirectionalâ€: false, â€œdropoutâ€: 0, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Rcnn</td>
<td>54.01s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š98.34%ï¼ŒéªŒè¯é›†ï¼š98.31%ï¼Œæµ‹è¯•é›†ï¼š98.30%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š34.92s/epoch,è®­ç»ƒé›†ï¼š95.77%ï¼ŒéªŒè¯é›†ï¼š97.57%ï¼Œæµ‹è¯•é›†ï¼š97.49%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œ<strong>n_layers</strong>â€œ:2, â€œ<strong>bidirectional</strong>â€œ: true, â€œdropoutâ€: 0, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Bert</td>
<td>143.17s/epoch</td>
<td style="text-align:center">è®­ç»ƒé›†ï¼š97.47%ï¼ŒéªŒè¯é›†ï¼š97.78%ï¼Œæµ‹è¯•é›†ï¼š97.66%</td>
<td></td>
<td>â€œnum_classesâ€: 1</td>
</tr>
<tr>
<td>Bert-cnn</td>
<td>254.66s/epoch</td>
<td style="text-align:center">è®­ç»ƒé›†ï¼š98.01ï¼ŒéªŒè¯é›†ï¼š98.32%ï¼Œæµ‹è¯•é›†ï¼š98.21%</td>
<td></td>
<td>â€œnum_filtersâ€: 100, â€œhidden_sizeâ€: 768, â€œfilter_sizesâ€: [3,4,5], â€œdropoutâ€: 0.1, â€œnum_classesâ€: 1</td>
</tr>
<tr>
<td>Bert-rnn</td>
<td>195.59s/epoch</td>
<td style="text-align:center">è®­ç»ƒé›†ï¼š97.53%ï¼ŒéªŒè¯é›†ï¼š97.83%,æµ‹è¯•é›†ï¼š97.55%</td>
<td></td>
<td>â€œrnn_typeâ€: â€œrnnâ€, â€œbert_embedding_dimâ€: 768, â€œhidden_dimâ€: 256, â€œn_layersâ€: 2, â€œbidirectionalâ€: true, â€œbatch_firstâ€: true, â€œdropoutâ€: 0.1, â€œnum_classesâ€: 1</td>
</tr>
<tr>
<td>Bert-rcnn</td>
<td>200.17s/epoch</td>
<td style="text-align:center">è®­ç»ƒé›†ï¼š98.17%ï¼ŒéªŒè¯é›†ï¼š98.15%,æµ‹è¯•é›†ï¼š98.13%</td>
<td></td>
<td>â€œrnn_typeâ€: â€œrnnâ€, â€œbert_embedding_dimâ€: 768, â€œhidden_dimâ€: 256, â€œnum_classesâ€: 1, â€œn_layersâ€:2, â€œbidirectionalâ€: true, â€œdropoutâ€: 0, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>DPCNN</td>
<td>9.76s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š97.93%ï¼ŒéªŒè¯é›†ï¼š97.72%,æµ‹è¯•é›†ï¼š97.62%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š7.62s/epoch,è®­ç»ƒé›†ï¼š93.16%ï¼ŒéªŒè¯é›†ï¼š91.70%ï¼Œæµ‹è¯•é›†ï¼š92.00%</td>
<td>â€œembedding_dimâ€: 300, â€œnum_filtersâ€: 100, â€œnum_classesâ€: 1</td>
</tr>
</tbody>
</table>
</div>
<h3 id="æ–°é—»ååˆ†ç±»ç»“æœæ¯”è¾ƒ"><a href="#æ–°é—»ååˆ†ç±»ç»“æœæ¯”è¾ƒ" class="headerlink" title="æ–°é—»ååˆ†ç±»ç»“æœæ¯”è¾ƒ"></a>æ–°é—»ååˆ†ç±»ç»“æœæ¯”è¾ƒ</h3><div class="table-container">
<table>
<thead>
<tr>
<th>æ¨¡å‹</th>
<th>é€Ÿåº¦</th>
<th>æ•ˆæœï¼š</th>
<th>æ•ˆæœï¼š</th>
<th>å‚æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fast_Text</td>
<td>17.68s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š96.57%,éªŒè¯é›†ï¼š92.87%</td>
<td>18.26s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š96.7%ï¼ŒéªŒè¯é›†ï¼š92.61%</td>
<td>â€œembedding_dimâ€: 300, â€œoutput_dimâ€: 10</td>
</tr>
<tr>
<td>TextCNN</td>
<td>143.61s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š98.13%,éªŒè¯é›†ï¼š96.42%</td>
<td>142.95s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š98.32%ï¼ŒéªŒè¯é›†ï¼š95.7%</td>
<td>â€œembedding_dimâ€: 300, â€œn_filtersâ€: 50, â€œfilter_sizesâ€: [3,4,5], â€œdropoutâ€: 0.5, â€œoutput_dimâ€: 10</td>
</tr>
<tr>
<td>TextCNN1d</td>
<td>58.45s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š99.09%,éªŒè¯é›†ï¼š96.42%</td>
<td>57.66s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š98.97%ï¼ŒéªŒè¯é›†ï¼š96.69%</td>
<td>â€œembedding_dimâ€: 300, â€œn_filtersâ€: 100, â€œfilter_sizesâ€: [3,4,5], â€œdropoutâ€: 0.5, â€œoutput_dimâ€: 10</td>
</tr>
<tr>
<td>DPCNN</td>
<td>58.19s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š97.12%,éªŒè¯é›†ï¼š93.98%</td>
<td>57.87s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š96.97%ï¼ŒéªŒè¯é›†ï¼š95.04%</td>
<td>â€œuse_pretrain_embeddingâ€: true, â€œembedding_dimâ€: 300, â€œnum_filtersâ€: 100, â€œnum_classesâ€: 10</td>
</tr>
<tr>
<td>rcnn</td>
<td>461s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š97.85%,éªŒè¯é›†ï¼š95.41%</td>
<td>461.04s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š98.5%ï¼ŒéªŒè¯é›†ï¼š95.9%</td>
<td>â€œrnn_typeâ€: â€œlstmâ€, â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 10, â€œn_layersâ€:2, â€œbidirectionalâ€: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>rnnï¼ˆ1 layerï¼‰</td>
<td>131.58s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š93.43%,éªŒè¯é›†ï¼š90.06%</td>
<td>131.04s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š98.06%ï¼ŒéªŒè¯é›†ï¼š93.19</td>
<td>â€œrnn_typeâ€: â€œrnnâ€, â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 10, â€œn_layersâ€:1, â€œbidirectionalâ€: false, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>rnnï¼ˆ2ï¼Œlayerï¼‰</td>
<td>304.57s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š96.5%,éªŒè¯é›†ï¼š92.6%</td>
<td>304s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š94.60%ï¼ŒéªŒè¯é›†ï¼š93.39%</td>
<td>â€œrnn_typeâ€: â€œrnnâ€, â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 10, â€œn_layersâ€:2, â€œbidirectionalâ€: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>lstm</td>
<td>437.34s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š98.45%,éªŒè¯é›†ï¼š96.01%</td>
<td>439.16s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š97.73%ï¼ŒéªŒè¯é›†ï¼š94.30%</td>
<td>â€œrnn_typeâ€: â€œlstmâ€, â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 10, â€œn_layersâ€:2, â€œbidirectionalâ€: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Lstm-attention</td>
<td>381.35s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š97.09%,éªŒè¯é›†ï¼š95.00%</td>
<td>380.58s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š99.15%ï¼ŒéªŒè¯é›†ï¼š96.32</td>
<td>â€œrnn_typeâ€: â€œlstmâ€, â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 10, â€œn_layersâ€: 2, â€œbidirectionalâ€: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Bert</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Bert-cnn</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Bert-rnn</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Bert-rcnn</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>HAN</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>ä½¿ç”¨bertè¿›è¡Œè®­ç»ƒï¼Œæœºå­è·‘æ­¥èµ·æ¥äº†ï¼Œè€Œä¸”å³ä½¿è·‘èµ·æ¥ä¹Ÿæ˜¯é˜‰å‰²ç‰ˆçš„ï¼Œä¼¼ä¹æ²¡ä»€ä¹ˆæ„ä¹‰ã€‚</p>
<h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="é•¿çŸ­æ–‡æœ¬åˆ†ç±»çš„æ¯”è¾ƒ"><a href="#é•¿çŸ­æ–‡æœ¬åˆ†ç±»çš„æ¯”è¾ƒ" class="headerlink" title="é•¿çŸ­æ–‡æœ¬åˆ†ç±»çš„æ¯”è¾ƒ"></a>é•¿çŸ­æ–‡æœ¬åˆ†ç±»çš„æ¯”è¾ƒ</h4><p>å¯¹äºè¯åµŒå…¥æŠ€æœ¯çš„æ–‡æœ¬è¡¨ç¤ºï¼ŒçŸ­æ–‡æœ¬å’Œé•¿æ–‡æœ¬è¡¨ç¤ºä¸Šæ²¡æœ‰å·®åˆ«ï¼Œæ­¤æ—¶åˆ†ç±»æ•ˆæœçš„ä¼˜åŠ£ä¸»è¦åœ¨åˆ†ç±»æ¨¡å‹å’Œè®­ç»ƒæ•°æ®ä¸Šã€‚</p>
<p>å¯¹äºæ•°æ®è€Œè¨€ï¼šéšç€æ–‡æœ¬è¶Šé•¿ï¼Œè¯­ä¹‰çš„é‡è¦æ€§å°±è¶Šé«˜ï¼Œåœ¨æ–‡æœ¬å¾ˆçŸ­çš„æƒ…å†µä¸‹ï¼Œè¯­ä¹‰çš„é‡è¦æ€§å°±å¾ˆå°ï¼Œæ¯”å¦‚ï¼šâ€œä»Šå¤© å¤©æ°” æ€ä¹ˆæ ·â€ï¼Œâ€œä»Šå¤© æ€ä¹ˆæ · å¤©æ°”â€ï¼Œâ€œæ€ä¹ˆæ · å¤©æ°” ä»Šå¤©â€ã€‚ä½ ç”šè‡³ä¸å¿…è¦è€ƒè™‘å¥å­æ˜¯å¦é€šé¡ºï¼ŒåŸºæœ¬ä¸Šå¯ä»¥å½“ä¸€å¥è¯å¤„ç†ï¼Œæ²¡æœ‰ç¬¬äºŒä¸ªæ„æ€ã€‚ä½†æ˜¯éšç€æ–‡æœ¬è¶Šæ¥è¶Šé•¿ï¼Œæ¯”å¦‚512ä¸ªå­—ç¬¦ï¼Œé¢ å€’ä¸€ä¸‹å¯èƒ½å°±è¦å½’ä¸ºä¸¤ç±»äº†ã€‚</p>
<p>å¯¹äºæ¨¡å‹è€Œè¨€ï¼šå¯¹äºçŸ­æ–‡æœ¬ï¼ŒCNNé…åˆMax-poolingæ± åŒ–(å¦‚TextCNNæ¨¡å‹)é€Ÿåº¦å¿«ï¼Œè€Œä¸”æ•ˆæœä¹Ÿå¾ˆå¥½ã€‚å› ä¸ºçŸ­æ–‡æœ¬ä¸Šçš„å…³é”®è¯æ¯”è¾ƒå®¹æ˜“æ‰¾åˆ°ï¼Œè€Œä¸”Max-poolingä¼šç›´æ¥è¿‡æ»¤æ‰æ¨¡å‹è®¤ä¸ºä¸é‡è¦ç‰¹å¾ã€‚å…·ä½“å·¥ä½œæœºåˆ¶æ˜¯ï¼šå·ç§¯çª—å£æ²¿ç€é•¿åº¦ä¸ºnçš„æ–‡æœ¬ä¸€ä¸ªä¸ªæ»‘åŠ¨ï¼Œç±»ä¼¼äºn-gramæœºåˆ¶å¯¹æ–‡æœ¬åˆ‡è¯ï¼Œç„¶åå’Œæ–‡æœ¬ä¸­çš„æ¯ä¸ªè¯è¿›è¡Œç›¸ä¼¼åº¦è®¡ç®—ï¼Œå› ä¸ºåé¢æ¥äº†ä¸ªMax-poolingï¼Œå› æ­¤åªä¼šä¿ç•™å’Œå·ç§¯æ ¸æœ€ç›¸è¿‘çš„è¯ã€‚å¾®åšæ•°æ®é›†å±äºæƒ…æ„Ÿåˆ†ç±»ï¼Œä¸ºäº†åˆ¤æ–­å¥å­çš„æƒ…æ„Ÿææ€§ï¼Œåªéœ€è¦è®©åˆ†ç±»å™¨èƒ½è¯†åˆ«å‡ºâ€œä¸å¼€å¿ƒâ€è¿™ç±»è¯æ˜¯ä¸ªè´Ÿææ€§çš„è¯ï¼Œâ€œé«˜å…´â€ã€â€œå¼€å¿ƒâ€ç­‰è¿™ç±»è¯æ˜¯æ­£ææ€§çš„è¯ï¼Œå…¶ä»–è¯æ˜¯åä¸­æ€§è¯å°±å¯ä»¥äº†ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬æŠŠè¯¥å¥å­ä¸­çš„å„ä¸ªè¯æ¡è¾“å…¥ç»™æ¨¡å‹å»åˆ†ç±»æ—¶ï¼Œå¹¶ä¸éœ€è¦å»â€œç»å‰é¡¾åâ€ï¼Œå› æ­¤ä½¿ç”¨ä¸€ä¸ªå…³æ³¨å±€éƒ¨çš„å‰é¦ˆç¥ç»ç½‘ç»œå¾€å¾€è¡¨ç°æ›´ä½³ã€‚è™½ç„¶Attentionä¹Ÿçªå‡ºäº†é‡ç‚¹ç‰¹å¾ï¼Œä½†æ˜¯éš¾ä»¥è¿‡æ»¤æ‰æ‰€æœ‰ä½åˆ†ç‰¹å¾ã€‚ä½†æ˜¯å¯¹äºé•¿æ–‡æœ¬ç›´æ¥ç”¨CNNå°±ä¸è¡Œäº†ï¼ŒTextCNNä¼šæ¯”HANæ¨¡å‹æ³›åŒ–èƒ½åŠ›å·®å¾ˆå¤šã€‚å¦‚æœåœ¨TextCNNå‰åŠ ä¸€å±‚LSTMï¼Œè¿™æ ·æ•ˆæœå¯ä»¥æå‡å¾ˆå¤§ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆé•¿æ–‡æœ¬åˆ†ç±»çš„å®éªŒä¸­ï¼Œcnn-å’Œ-rnn-æ²¡æœ‰æ‹‰å¼€å·®è·ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé•¿æ–‡æœ¬åˆ†ç±»çš„å®éªŒä¸­ï¼Œcnn-å’Œ-rnn-æ²¡æœ‰æ‹‰å¼€å·®è·ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé•¿æ–‡æœ¬åˆ†ç±»çš„å®éªŒä¸­ï¼Œcnn å’Œ rnn æ²¡æœ‰æ‹‰å¼€å·®è·ï¼Ÿ"></a>ä¸ºä»€ä¹ˆé•¿æ–‡æœ¬åˆ†ç±»çš„å®éªŒä¸­ï¼Œcnn å’Œ rnn æ²¡æœ‰æ‹‰å¼€å·®è·ï¼Ÿ</h4><p>cnnå’Œrnnçš„ç²¾åº¦éƒ½å¾ˆé«˜ï¼Œåˆ†æä¸»è¦è¿˜æ˜¯åˆ†ç±»çš„æ–‡ç« è§„åˆ™æ€§æ¯”è¾ƒå¼ºï¼Œä¸”å±äºç‰¹å®šé¢†åŸŸï¼Œè¯é‡ä¸å¤šï¼Œç±»åˆ«å·®å¼‚å¯èƒ½æ¯”è¾ƒæ˜æ˜¾ã€‚</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>å¤æ‚çš„æ¨¡å‹æœªå¿…ä¼šæœ‰å¾ˆå¥½çš„ç»“æœï¼Œç®€å•æ¨¡å‹æ•ˆæœæœªå¿…ä¸ç†æƒ³ï¼Œæ²¡å¿…è¦ä¸€å‘³è¿½æ±‚æ·±åº¦å­¦ä¹ ã€å¤æ‚æ¨¡å‹ä»€ä¹ˆçš„ã€‚é€‰ä»€ä¹ˆæ ·çš„æ¨¡å‹è¿˜æ˜¯è¦æ ¹æ®æ•°æ®æ¥çš„ã€‚åŒä¸€ç±»é—®é¢˜ï¼Œä¸åŒçš„æ•°æ®æ•ˆæœå·®å¼‚å¾ˆå¤§ï¼Œä¸è¦å°çœ‹ä»»ä½•ä¸€ç±»é—®é¢˜ï¼Œä¾‹å¦‚åˆ†ç±»ï¼Œæˆ‘ä»¬é€šå¸¸è§‰å¾—å®ƒå¾ˆç®€å•ï¼Œä½†æœ‰äº›æ•°æ®å¹¶éä½ æ‰€æƒ³ã€‚</p>
<h3 id="æ–‡æœ¬åˆ†ç±»tricks"><a href="#æ–‡æœ¬åˆ†ç±»tricks" class="headerlink" title="æ–‡æœ¬åˆ†ç±»tricks"></a>æ–‡æœ¬åˆ†ç±»tricks</h3><h4 id="åˆ†è¯å™¨"><a href="#åˆ†è¯å™¨" class="headerlink" title="åˆ†è¯å™¨"></a>åˆ†è¯å™¨</h4><p><strong>åˆ†è¯å™¨æ‰€åˆ†å‡ºçš„è¯ä¸è¯å‘é‡è¡¨ä¸­çš„tokenç²’åº¦matchæ˜¯æ›´é‡è¦çš„äº‹æƒ…</strong></p>
<h5 id="å·²çŸ¥é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨"><a href="#å·²çŸ¥é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨" class="headerlink" title="å·²çŸ¥é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨"></a>å·²çŸ¥é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨</h5><p>åƒword2vecã€gloveã€fasttextè¿™äº›å®˜æ–¹releaseçš„é¢„è®­ç»ƒè¯å‘é‡éƒ½ä¼šå…¬å¸ƒç›¸åº”è®­ç»ƒè¯­æ–™çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬é¢„å¤„ç†ç­–ç•¥å¦‚åˆ†è¯ï¼Œè¿™ç§æƒ…å†µä¸‹ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„è®­ç»ƒè¯¥è¯å‘é‡æ‰€ä½¿ç”¨çš„åˆ†è¯å™¨ï¼Œæ­¤åˆ†è¯å™¨åœ¨ä¸‹æ¸¸ä»»åŠ¡çš„è¡¨ç°åä¹‹å…«ä¹ä¼šæ¯”å…¶ä»–èŠ±é‡Œèƒ¡å“¨çš„åˆ†è¯å™¨å¥½ç”¨ã€‚</p>
<h5 id="ä¸çŸ¥é“é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨"><a href="#ä¸çŸ¥é“é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨" class="headerlink" title="ä¸çŸ¥é“é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨"></a>ä¸çŸ¥é“é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨</h5><p>è¿™æ—¶å°±éœ€è¦å»â€œçŒœâ€ä¸€ä¸‹åˆ†è¯å™¨ã€‚æ€ä¹ˆçŒœå‘¢ï¼Ÿ<br>é¦–å…ˆï¼Œæ‹¿åˆ°é¢„è®­ç»ƒè¯å‘é‡è¡¨åï¼Œå»é‡Œé¢searchä¸€äº›ç‰¹å®šè¯æ±‡æ¯”å¦‚ä¸€äº›ç½‘ç«™ã€é‚®ç®±ã€æˆè¯­ã€äººåç­‰ï¼Œè‹±æ–‡é‡Œè¿˜æœ‰nâ€™tç­‰ï¼Œçœ‹çœ‹è®­ç»ƒè¯å‘é‡ä½¿ç”¨çš„åˆ†è¯å™¨æ˜¯æŠŠå®ƒä»¬åˆ†æˆä»€ä¹ˆç²’åº¦ã€‚<br>ç„¶åè·‘å‡ ä¸ªåˆ†è¯å™¨ï¼Œçœ‹çœ‹å“ªä¸ªåˆ†è¯å™¨çš„ç²’åº¦è·Ÿä»–æœ€æ¥è¿‘å°±ç”¨å“ªä¸ªï¼Œå¦‚æœä¸æ”¾å¿ƒï¼Œå°±æ”¾åˆ°ä¸‹æ¸¸ä»»åŠ¡é‡Œè·‘è·‘çœ‹ã€‚</p>
<p>æœ€ç†æƒ³çš„æƒ…å†µæ˜¯ï¼šå…ˆç¡®å®šæœ€é€‚åˆå½“å‰ä»»åŠ¡æ•°æ®é›†çš„åˆ†è¯å™¨ï¼Œå†ä½¿ç”¨åŒåˆ†è¯å™¨äº§å‡ºçš„é¢„è®­ç»ƒè¯å‘é‡ã€‚å¦‚æœæ— æ³•æ»¡è¶³ç†æƒ³æƒ…å†µï¼Œåˆ™éœ€è¦è‡ªå·±åœ¨ä¸‹æ¸¸ä»»åŠ¡è®­ç»ƒé›†æˆ–è€…å¤§é‡åŒåˆ†å¸ƒæ— ç›‘ç£è¯­æ–™ä¸Šè®­ç»ƒçš„è¯å‘é‡æ›´æœ‰åˆ©äºè¿›ä¸€æ­¥å‹æ¦¨æ¨¡å‹çš„æ€§èƒ½ã€‚</p>
<h4 id="å…³äºä¸­æ–‡å­—å‘é‡"><a href="#å…³äºä¸­æ–‡å­—å‘é‡" class="headerlink" title="å…³äºä¸­æ–‡å­—å‘é‡"></a>å…³äºä¸­æ–‡å­—å‘é‡</h4><p>é¢„è®­ç»ƒä¸­æ–‡å­—å‘é‡çš„æ—¶å€™ï¼ŒæŠŠçª—å£å¼€å¤§ä¸€äº›ï¼Œä¸è¦ç›´æ¥ä½¿ç”¨word-levelçš„çª—å£å¤§å°ï¼Œæ•ˆæœä¼šæ¯”éšæœºåˆå§‹åŒ–çš„å­—å‘é‡æ˜æ˜¾çš„å¥½ã€‚</p>
<h4 id="æ•°æ®é›†å™ªå£°å¾ˆä¸¥é‡"><a href="#æ•°æ®é›†å™ªå£°å¾ˆä¸¥é‡" class="headerlink" title="æ•°æ®é›†å™ªå£°å¾ˆä¸¥é‡"></a>æ•°æ®é›†å™ªå£°å¾ˆä¸¥é‡</h4><p>é‡Œå™ªå£°ä¸¥é‡æœ‰ä¸¤ç§æƒ…å†µã€‚å¯¹äºæ•°æ®é›†D(X, Y)ï¼Œä¸€ç§æ˜¯Xå†…éƒ¨å™ªå£°å¾ˆå¤§ï¼ˆæ¯”å¦‚æ–‡æœ¬ä¸ºå£è¯­åŒ–è¡¨è¿°æˆ–ç”±äº’è”ç½‘ç”¨æˆ·ç”Ÿæˆï¼‰ï¼Œä¸€ç§æ˜¯Yçš„å™ªå£°å¾ˆå¤§ï¼ˆä¸€äº›æ ·æœ¬è¢«æ˜æ˜¾çš„é”™è¯¯æ ‡æ³¨ï¼Œä¸€äº›æ ·æœ¬äººä¹Ÿå¾ˆéš¾å®šä¹‰æ˜¯å±äºå“ªä¸€ç±»ï¼Œç”šè‡³å…·å¤‡ç±»åˆ«äºŒä¹‰æ€§ï¼‰ã€‚</p>
<h5 id="Xå†…éƒ¨å™ªå£°å¾ˆå¤§"><a href="#Xå†…éƒ¨å™ªå£°å¾ˆå¤§" class="headerlink" title="Xå†…éƒ¨å™ªå£°å¾ˆå¤§"></a>Xå†…éƒ¨å™ªå£°å¾ˆå¤§</h5><p>æ³•ä¸€ï¼šç›´æ¥å°†æ¨¡å‹çš„è¾“å…¥å˜æˆchar-levelï¼ˆä¸­æ–‡ä¸­å°±æ˜¯å­—çš„ç²’åº¦ï¼‰ï¼Œç„¶åtrain from scratchï¼ˆä¸ä½¿ç”¨é¢„è®­ç»ƒè¯å‘é‡ï¼‰å»è·Ÿword-levelçš„å¯¹æ¯”ä¸€ä¸‹ï¼Œå¦‚æœchar-levelçš„æ˜æ˜¾çš„æ•ˆæœå¥½ï¼Œé‚£ä¹ˆçŸ­æ—¶é—´ä¹‹å†…å°±ç›´æ¥åŸºäºchar-levelå»åšæ¨¡å‹ã€‚</p>
<p>æ³•äºŒï¼šä½¿ç”¨ç‰¹æ®Šè¶…å‚çš„FastTextå»è®­ç»ƒä¸€ä»½è¯å‘é‡ï¼š<br>ä¸€èˆ¬æ¥è¯´fasttextåœ¨è‹±æ–‡ä¸­çš„char ngramçš„çª—å£å¤§å°ä¸€èˆ¬å–å€¼3ï½6ï¼Œä½†æ˜¯åœ¨å¤„ç†ä¸­æ–‡æ—¶ï¼Œå¦‚æœæˆ‘ä»¬çš„ç›®çš„æ˜¯ä¸ºäº†å»é™¤è¾“å…¥ä¸­çš„å™ªå£°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªçª—å£é™åˆ¶ä¸º1ï½2ï¼Œè¿™ç§å°çª—å£æœ‰åˆ©äºæ¨¡å‹å»æ•è·é”™åˆ«å­—ï¼ˆæ¯”å¦‚ï¼Œæˆ‘ä»¬æ‰“ä¸€ä¸ªé”™è¯¯è¯çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½æ˜¯å°†å…¶ä¸­çš„ä¸€ä¸ªå­—è¾¾æˆåŒéŸ³å¼‚å½¢çš„å¦ä¸€ä¸ªå­—ï¼‰ï¼Œæ¯”å¦‚word2vecå­¦å‡ºæ¥çš„â€œä¼¼ä¹â€çš„æœ€è¿‘è¯å¯èƒ½æ˜¯â€œå¥½åƒâ€ï¼Œç„¶è€Œå°ngramçª—å£fasttextå­¦å‡ºæ¥çš„â€œä¼¼ä¹â€æœ€è¿‘è¯åˆ™å¾ˆæœ‰å¯èƒ½æ˜¯â€œæ˜¯ä¹â€ç­‰å†…éƒ¨åŒ…å«é”™åˆ«å­—çš„è¯ï¼Œè¿™æ ·å°±ä¸€ä¸‹å­è®©ä¸å¤ªè¿‡åˆ†çš„é”™åˆ«å­—æ„æˆçš„è¯ä»¬åˆé‡æ–°å›åˆ°äº†ä¸€èµ·ï¼Œç”šè‡³å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šå¯¹æŠ—åˆ†è¯å™¨äº§ç”Ÿçš„å™ªå£°ï¼ˆæŠŠä¸€ä¸ªè¯åˆ‡åˆ†æˆå¤šä¸ªå­—ï¼‰ã€‚</p>
<h5 id="Yçš„å™ªå£°å¾ˆå¤§"><a href="#Yçš„å™ªå£°å¾ˆå¤§" class="headerlink" title="Yçš„å™ªå£°å¾ˆå¤§"></a>Yçš„å™ªå£°å¾ˆå¤§</h5><p>é¦–å…ˆå¿½ç•¥è¿™ä¸ªå™ªå£°ï¼Œå¼ºè¡Œçš„æŠŠæ¨¡å‹å°½å¯èƒ½å¥½çš„è®­å‡ºæ¥ã€‚ç„¶åè®©è®­ç»ƒå¥½çš„æ¨¡å‹å»è·‘è®­ç»ƒé›†å’Œå¼€å‘é›†ï¼Œå–å‡ºè®­ç»ƒé›†ä¸­çš„é”™è¯¯æ ·æœ¬å’Œå¼€å‘é›†ä¸­é‚£äº›ä»¥å¾ˆé«˜çš„ç½®ä¿¡åº¦åšå‡ºé”™è¯¯å†³ç­–çš„æ ·æœ¬ï¼ˆæ¯”å¦‚ä»¥99%çš„æŠŠæ¡æŠŠä¸€ä¸ªæ ‡ç­¾ä¸º0çš„æ ·æœ¬é¢„æµ‹ä¸º1ï¼‰ï¼Œç„¶åå»åšè¿™äº›bad casesçš„åˆ†æï¼Œå¦‚æœå‘ç°é”™è¯¯æ ‡æ³¨æœ‰å¾ˆå¼ºçš„è§„å¾‹æ€§ï¼Œåˆ™ç›´æ¥æ’¸ä¸€ä¸ªè„šæœ¬æ‰¹é‡çº æ­£ä¸€ä¸‹ï¼ˆåªè¦ç¡®ä¿çº æ­£åçš„æ ‡æ³¨æ­£ç¡®ç‡æ¯”çº æ­£å‰æ˜æ˜¾é«˜å°±è¡Œï¼‰ã€‚<br>å¦‚æœæ²¡æœ‰ä»€ä¹ˆè§„å¾‹ï¼Œä½†æ˜¯å‘ç°æ¨¡å‹é«˜ç½®ä¿¡åº¦åšé”™çš„è¿™äº›æ ·æœ¬å¤§éƒ¨åˆ†éƒ½æ˜¯æ ‡æ³¨é”™è¯¯çš„è¯ï¼Œå°±ç›´æ¥æŠŠè¿™äº›æ ·æœ¬éƒ½åˆ æ‰ï¼Œå¸¸å¸¸ä¹Ÿå¯ä»¥æ¢æ¥æ€§èƒ½çš„å°å¹…æå‡ï¼Œæ¯•ç«Ÿæµ‹è¯•é›†éƒ½æ˜¯äººå·¥æ ‡æ³¨çš„ï¼Œå›°éš¾æ ·æœ¬å’Œé”™æ ‡æ ·æœ¬ä¸ä¼šå¤ªå¤šã€‚</p>
<h4 id="baselineé€‰ç”¨CNNè¿˜æ˜¯RNNï¼Ÿ"><a href="#baselineé€‰ç”¨CNNè¿˜æ˜¯RNNï¼Ÿ" class="headerlink" title="baselineé€‰ç”¨CNNè¿˜æ˜¯RNNï¼Ÿ"></a>baselineé€‰ç”¨CNNè¿˜æ˜¯RNNï¼Ÿ</h4><p>çœ‹æ•°æ®é›†ï¼Œå¦‚æœæ„Ÿè§‰æ•°æ®é›†é‡Œå¾ˆå¤šå¾ˆå¼ºçš„ngramå¯ä»¥ç›´æ¥å¸®åŠ©ç”Ÿæˆæ­£ç¡®å†³ç­–ï¼Œé‚£å°±CNNã€‚<br>å¦‚æœæ„Ÿè§‰å¾ˆå¤šcaseéƒ½æ˜¯é‚£ç§éœ€è¦æŠŠä¸€ä¸ªå¥å­çœ‹å®Œç”šè‡³çœ‹ä¸¤ä¸‰éæ‰å®¹æ˜“å¾—å‡ºæ­£ç¡®tagï¼Œé‚£å°±RNNã€‚<br>è¿˜å¯ä»¥CNNã€RNNçš„æ¨¡å‹éƒ½è·‘å‡ºæ¥ç®€å•é›†æˆä¸€ä¸‹ã€‚</p>
<h4 id="DropoutåŠ åœ¨å“ªé‡Œ"><a href="#DropoutåŠ åœ¨å“ªé‡Œ" class="headerlink" title="DropoutåŠ åœ¨å“ªé‡Œ"></a>DropoutåŠ åœ¨å“ªé‡Œ</h4><p>word embeddingå±‚åã€poolingå±‚åã€FCå±‚ï¼ˆå…¨è”æ¥å±‚ï¼‰åã€‚</p>
<h4 id="äºŒåˆ†ç±»"><a href="#äºŒåˆ†ç±»" class="headerlink" title="äºŒåˆ†ç±»"></a>äºŒåˆ†ç±»</h4><p>äºŒåˆ†ç±»é—®é¢˜ä¸ä¸€å®šè¦ç”¨sigmoidä½œä¸ºè¾“å‡ºå±‚çš„æ¿€æ´»å‡½æ•°ï¼Œå°è¯•ä¸€ä¸‹åŒ…å«ä¿©ç±»åˆ«çš„softmaxã€‚å¯èƒ½å¤šä¸€æ¡åˆ†æ”¯å°±å¤šä¸€ç‚¹ä¿¡æ¯ï¼Œå®è·µä¸­å¸¸å¸¸å¸¦æ¥é›¶ç‚¹å‡ ä¸ªç‚¹çš„æå‡ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒç„å­¦äº†ã€‚</p>
<h4 id="å¤šæ ‡ç­¾åˆ†ç±»"><a href="#å¤šæ ‡ç­¾åˆ†ç±»" class="headerlink" title="å¤šæ ‡ç­¾åˆ†ç±»"></a>å¤šæ ‡ç­¾åˆ†ç±»</h4><p>å¦‚æœä¸€ä¸ªæ ·æœ¬åŒæ—¶æ‹¥æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œç”šè‡³æ ‡ç­¾åŒæ—¶è¿˜æ„æˆäº†DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰ï¼Œå…ˆç”¨binary-cross-entropyè®­å‡ºä¸ªbaselineæ¥ï¼ˆå³æŠŠæ¯ä¸ªç±»åˆ«å˜æˆä¸€ä¸ªäºŒåˆ†ç±»é—®é¢˜ï¼Œè¿™æ ·Nä¸ªç±»åˆ«çš„å¤šæ ‡ç­¾åˆ†ç±»é—®é¢˜å°±å˜æˆäº†Nä¸ªäºŒåˆ†ç±»é—®é¢˜ï¼‰ï¼Œè¿™ä¸ªbaselineåšå¥½åå¥½åƒå¤šæ ‡ç­¾é—®é¢˜ä¸å¤§äº†ï¼ŒDAGé—®é¢˜è‡ªå·±ä¹ŸåŸºæœ¬è§£å†³äº†ï¼ˆè™½ç„¶æ¨¡å‹å±‚å¹¶æ²¡æœ‰ä¸“é—¨é’ˆå¯¹è¿™ä¸ªé—®é¢˜ä½œå¤„ç†ï¼‰ï¼Œç„¶åå°±å¯ä»¥å®‰å¿ƒåšæ¨¡å‹è¾£ã€‚</p>
<h4 id="æ ·æœ¬ç±»åˆ«ä¸å‡è¡¡é—®é¢˜"><a href="#æ ·æœ¬ç±»åˆ«ä¸å‡è¡¡é—®é¢˜" class="headerlink" title="æ ·æœ¬ç±»åˆ«ä¸å‡è¡¡é—®é¢˜"></a>æ ·æœ¬ç±»åˆ«ä¸å‡è¡¡é—®é¢˜</h4><p>å¦‚æœæ­£è´Ÿæ ·æœ¬æ¯”å°äº9:1çš„è¯ï¼Œç»§ç»­åšæ·±åº¦æ¨¡å‹è°ƒè¶…å‚ï¼Œæ¨¡å‹åšå¥½åä¼šå‘ç°è¿™ç‚¹ä¸å‡è¡¡å¯¹æ¨¡å‹æ¥è¯´ä¸å€¼ä¸€æï¼Œå†³ç­–é˜ˆå€¼ä¹Ÿå®Œå…¨ä¸ç”¨æ‰‹è°ƒã€‚<br>ä½†æ˜¯ï¼Œå¦‚æœç»å¸¸ä¸€ä¸ªbatchä¸­å®Œå…¨å°±æ˜¯åŒä¸€ä¸ªç±»åˆ«çš„æ ·æœ¬ï¼Œæˆ–è€…ä¸€äº›ç±»åˆ«çš„æ ·æœ¬ç»è¿‡å¥½å¤šbatchéƒ½éš¾é‡åˆ°ä¸€ä¸ªçš„è¯ï¼Œå‡è¡¡å°±éå¸¸éå¸¸æœ‰å¿…è¦äº†ã€‚<a href="https://mp.weixin.qq.com/s?__biz=MzIwNzc2NTk0NQ==&amp;mid=2247484993&amp;idx=1&amp;sn=0bd32089a638e5a1b48239656febb6e0&amp;chksm=970c2e97a07ba7818d63dddbb469486dccb369ecc11f38ffdea596452b9e5bf65772820a8ac9&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">å¦‚ä½•ä¼˜é›…è€Œæ—¶é«¦çš„è§£å†³ä¸å‡è¡¡åˆ†ç±»é—®é¢˜</a></p>
<h4 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h4><ol>
<li>åˆ«å¤ªçº ç»“æ–‡æœ¬æˆªæ–­é•¿åº¦ä½¿ç”¨120è¿˜æ˜¯150</li>
<li>åˆ«å¤ªçº ç»“å¯¹æ€§èƒ½ä¸æ•æ„Ÿçš„è¶…å‚æ•°å¸¦æ¥çš„å¼€å‘é›†æ€§èƒ½çš„å¾®å°æå‡</li>
<li>åˆ«å¤ªçº ç»“æœªç™»é™†è¯çš„embeddingæ˜¯åˆå§‹åŒ–æˆå…¨0è¿˜æ˜¯éšæœºåˆå§‹åŒ–ï¼Œåˆ«è·ŸPADå…±äº«embeddingå°±è¡Œ</li>
<li>åˆ«å¤ªçº ç»“ä¼˜åŒ–å™¨ç”¨Adamè¿˜æ˜¯MomentumSGDï¼Œå¦‚æœè·ŸSGDçš„æ„Ÿæƒ…è¿˜ä¸æ·±ï¼Œå°±æ— è„‘Adamï¼Œæœ€åå†ç”¨MomentumSGDè·‘å‡ é</li>
<li>è¿˜æ˜¯ä¸ä¼šç”¨tricksä½†æ˜¯å°±æ˜¯æƒ³è·‘å‡ºä¸ªå¥½ç»“æœï¼Œbertå¤§åŠ›å‡ºå¥‡è¿¹ã€‚</li>
</ol>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://blog.csdn.net/feilong_csdn/article/details/88655927" target="_blank" rel="noopener">fastTextåŸç†å’Œæ–‡æœ¬åˆ†ç±»å®æˆ˜ï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></li>
<li><a href="https://blog.csdn.net/asialee_bird/article/details/88813385#ä¸€ã€è®ºæ–‡ç¬”è®°" target="_blank" rel="noopener">TextCNNæ–‡æœ¬åˆ†ç±»ï¼ˆkeraså®ç°ï¼‰</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/55263066" target="_blank" rel="noopener">æµ…è°ˆåŸºäºæ·±åº¦å­¦ä¹ çš„æ–‡æœ¬åˆ†ç±»é—®é¢˜</a></li>
<li><a href="https://www.jiqizhixin.com/articles/2018-06-22-4" target="_blank" rel="noopener">ä»DPCNNå‡ºå‘ï¼Œæ’©ä¸€ä¸‹æ·±å±‚word-levelæ–‡æœ¬åˆ†ç±»æ¨¡å‹</a></li>
<li><a href="https://www.jiqizhixin.com/articles/2019-01-24-5" target="_blank" rel="noopener">æ–‡æœ¬åˆ†ç±»æœ‰å“ªäº›è®ºæ–‡ä¸­å¾ˆå°‘æåŠå´å¯¹æ€§èƒ½æœ‰é‡è¦å½±å“çš„tricksï¼Ÿ</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwNzc2NTk0NQ==&amp;mid=2247484682&amp;idx=1&amp;sn=51520138eed826ec891ac8154ee550f9&amp;chksm=970c2ddca07ba4ca33ee14542cff0457601bb16236f8edc1ff0e617051d1f063354dda0f8893&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">ä»å‰é¦ˆåˆ°åé¦ˆï¼šè§£æå¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰åŠå…¶tricks</a></li>
<li><a href="http://www.52nlp.cn/tag/é•¿æ–‡æœ¬åˆ†ç±»" target="_blank" rel="noopener"><a href="http://www.52nlp.cn/å¦‚ä½•ç”¨æ·±åº¦å­¦ä¹ åšå¥½é•¿æ–‡æœ¬åˆ†ç±»ä¸æ³•å¾‹æ–‡ä¹¦æ™ºèƒ½åŒ–" target="_blank" rel="noopener">è¾¾è§‚æ•°æ®æ›¾å½¦èƒ½ï¼šå¦‚ä½•ç”¨æ·±åº¦å­¦ä¹ åšå¥½é•¿æ–‡æœ¬åˆ†ç±»ä¸æ³•å¾‹æ–‡ä¹¦æ™ºèƒ½åŒ–å¤„ç†</a></a></li>
<li><a href="https://www.zhihu.com/question/326770917/answer/698646465" target="_blank" rel="noopener">çŸ­æ–‡æœ¬åˆ†ç±»å’Œé•¿æ–‡æœ¬åˆ†ç±»çš„æ¨¡å‹å¦‚ä½•è¿›è¡Œé€‰æ‹©ï¼Ÿ</a></li>
<li><a href="https://www.pianshen.com/article/4319299677/" target="_blank" rel="noopener">NLPå®è·µä¹ï¼šHANåŸç†ä¸æ–‡æœ¬åˆ†ç±»å®è·µ</a></li>
</ol>
]]></content>
      <categories>
        <category>æ–‡æœ¬åˆ†ç±»</category>
      </categories>
      <tags>
        <tag>è‡ªç„¶è¯­è¨€å¤„ç†</tag>
        <tag>FastText</tag>
      </tags>
  </entry>
  <entry>
    <title>BatchNormalization</title>
    <url>/2020/03/28/BatchNormalization/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœºå™¨å­¦ä¹ é¢†åŸŸæœ‰ä¸ªå¾ˆé‡è¦çš„å‡è®¾ï¼š<strong>IIDç‹¬ç«‹åŒåˆ†å¸ƒå‡è®¾</strong>ï¼Œå°±æ˜¯å‡è®¾è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®æ˜¯æ»¡è¶³ç›¸åŒåˆ†å¸ƒçš„ï¼Œè¿™æ˜¯é€šè¿‡è®­ç»ƒæ•°æ®è·å¾—çš„æ¨¡å‹èƒ½å¤Ÿåœ¨æµ‹è¯•é›†è·å¾—å¥½çš„æ•ˆæœçš„ä¸€ä¸ªåŸºæœ¬ä¿éšœã€‚</p>
<p>é‚£BatchNormçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<strong>BatchNormå°±æ˜¯åœ¨æ·±åº¦ç¥ç»ç½‘ç»œè®­ç»ƒè¿‡ç¨‹ä¸­ä½¿å¾—æ¯ä¸€å±‚ç¥ç»ç½‘ç»œçš„è¾“å…¥ä¿æŒç›¸åŒåˆ†å¸ƒçš„ã€‚</strong></p>
<a id="more"></a>
<h3 id="Internal-Covariate-Shift-é—®é¢˜"><a href="#Internal-Covariate-Shift-é—®é¢˜" class="headerlink" title="Internal Covariate Shift é—®é¢˜"></a>Internal Covariate Shift é—®é¢˜</h3><p><strong>å¦‚æœMLç³»ç»Ÿå®ä¾‹é›†åˆä¸­çš„è¾“å…¥å€¼Xçš„åˆ†å¸ƒè€æ˜¯å˜ï¼Œè¿™ä¸ç¬¦åˆIIDå‡è®¾</strong>ï¼Œç½‘ç»œæ¨¡å‹å¾ˆéš¾<strong>ç¨³å®šçš„å­¦è§„å¾‹</strong>,å¯¹äºæ·±åº¦å­¦ä¹ è¿™ç§åŒ…å«å¾ˆå¤šéšå±‚çš„ç½‘ç»œç»“æ„ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå› ä¸ºå„å±‚å‚æ•°ä¸åœåœ¨å˜åŒ–ï¼Œæ‰€ä»¥æ¯ä¸ªéšå±‚éƒ½ä¼šé¢ä¸´covariate shiftçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯<strong>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œéšå±‚çš„è¾“å…¥åˆ†å¸ƒè€æ˜¯å˜æ¥å˜å»ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œInternal Covariate Shiftâ€ï¼ŒInternalæŒ‡çš„æ˜¯æ·±å±‚ç½‘ç»œçš„éšå±‚ï¼Œæ˜¯å‘ç”Ÿåœ¨ç½‘ç»œå†…éƒ¨çš„äº‹æƒ…ï¼Œè€Œä¸æ˜¯covariate shifté—®é¢˜åªå‘ç”Ÿåœ¨è¾“å…¥å±‚</strong>ã€‚</p>
<p>ç„¶åæå‡ºäº†BatchNormçš„åŸºæœ¬æ€æƒ³ï¼šèƒ½ä¸èƒ½<strong>è®©æ¯ä¸ªéšå±‚èŠ‚ç‚¹çš„æ¿€æ´»è¾“å…¥åˆ†å¸ƒå›ºå®šä¸‹æ¥å‘¢</strong>ï¼Ÿè¿™æ ·å°±é¿å…äº†â€œInternal Covariate Shiftâ€é—®é¢˜äº†ã€‚</p>
<p>BNä¸æ˜¯å‡­ç©ºæ‹è„‘è¢‹æ‹å‡ºæ¥çš„å¥½ç‚¹å­ï¼Œå®ƒæ˜¯æœ‰å¯å‘æ¥æºçš„ï¼šä¹‹å‰çš„ç ”ç©¶è¡¨æ˜å¦‚æœåœ¨å›¾åƒå¤„ç†ä¸­å¯¹è¾“å…¥å›¾åƒè¿›è¡Œç™½åŒ–ï¼ˆWhitenï¼‰æ“ä½œçš„è¯â€”â€”æ‰€è°“<strong>ç™½åŒ–</strong>ï¼Œ<strong>å°±æ˜¯å¯¹è¾“å…¥æ•°æ®åˆ†å¸ƒå˜æ¢åˆ°0å‡å€¼ï¼Œå•ä½æ–¹å·®çš„æ­£æ€åˆ†å¸ƒ</strong>â€”â€”é‚£ä¹ˆç¥ç»ç½‘ç»œä¼šè¾ƒå¿«æ”¶æ•›ï¼Œé‚£ä¹ˆBNä½œè€…å°±å¼€å§‹æ¨è®ºäº†ï¼šå›¾åƒæ˜¯æ·±åº¦ç¥ç»ç½‘ç»œçš„è¾“å…¥å±‚ï¼Œåšç™½åŒ–èƒ½åŠ å¿«æ”¶æ•›ï¼Œé‚£ä¹ˆå…¶å®å¯¹äºæ·±åº¦ç½‘ç»œæ¥è¯´ï¼Œå…¶ä¸­æŸä¸ªéšå±‚çš„ç¥ç»å…ƒæ˜¯ä¸‹ä¸€å±‚çš„è¾“å…¥ï¼Œæ„æ€æ˜¯å…¶å®æ·±åº¦ç¥ç»ç½‘ç»œçš„æ¯ä¸€ä¸ªéšå±‚éƒ½æ˜¯è¾“å…¥å±‚ï¼Œä¸è¿‡æ˜¯ç›¸å¯¹ä¸‹ä¸€å±‚æ¥è¯´è€Œå·²ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½å¯¹æ¯ä¸ªéšå±‚éƒ½åšç™½åŒ–å‘¢ï¼Ÿè¿™å°±æ˜¯å¯å‘BNäº§ç”Ÿçš„åŸåˆæƒ³æ³•ï¼Œè€ŒBNä¹Ÿç¡®å®å°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œ<strong>å¯ä»¥ç†è§£ä¸ºå¯¹æ·±å±‚ç¥ç»ç½‘ç»œæ¯ä¸ªéšå±‚ç¥ç»å…ƒçš„æ¿€æ´»å€¼åšç®€åŒ–ç‰ˆæœ¬çš„ç™½åŒ–æ“ä½œã€‚</strong></p>
<h3 id="BatchNormçš„æœ¬è´¨æ€æƒ³"><a href="#BatchNormçš„æœ¬è´¨æ€æƒ³" class="headerlink" title="BatchNormçš„æœ¬è´¨æ€æƒ³"></a>BatchNormçš„æœ¬è´¨æ€æƒ³</h3><p>BNçš„åŸºæœ¬æ€æƒ³å…¶å®ç›¸å½“ç›´è§‚ï¼šå› ä¸ºæ·±å±‚ç¥ç»ç½‘ç»œåœ¨åšéçº¿æ€§å˜æ¢å‰çš„<strong>æ¿€æ´»è¾“å…¥å€¼</strong>ï¼ˆå°±æ˜¯é‚£ä¸ªx=WU+Bï¼ŒUæ˜¯è¾“å…¥ï¼‰<strong>éšç€ç½‘ç»œæ·±åº¦åŠ æ·±æˆ–è€…åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå…¶åˆ†å¸ƒé€æ¸å‘ç”Ÿåç§»æˆ–è€…å˜åŠ¨ï¼Œä¹‹æ‰€ä»¥è®­ç»ƒæ”¶æ•›æ…¢ï¼Œä¸€èˆ¬æ˜¯æ•´ä½“åˆ†å¸ƒé€æ¸å¾€éçº¿æ€§å‡½æ•°çš„å–å€¼åŒºé—´çš„ä¸Šä¸‹é™ä¸¤ç«¯é è¿‘</strong>ï¼ˆå¯¹äºSigmoidå‡½æ•°æ¥è¯´ï¼Œæ„å‘³ç€æ¿€æ´»è¾“å…¥å€¼WU+Bæ˜¯å¤§çš„è´Ÿå€¼æˆ–æ­£å€¼ï¼‰ï¼Œæ‰€ä»¥è¿™<strong>å¯¼è‡´åå‘ä¼ æ’­æ—¶ä½å±‚ç¥ç»ç½‘ç»œçš„æ¢¯åº¦æ¶ˆå¤±</strong>ï¼Œè¿™æ˜¯è®­ç»ƒæ·±å±‚ç¥ç»ç½‘ç»œæ”¶æ•›è¶Šæ¥è¶Šæ…¢çš„<strong>æœ¬è´¨åŸå› </strong>ï¼Œ<strong>è€ŒBNå°±æ˜¯é€šè¿‡ä¸€å®šçš„è§„èŒƒåŒ–æ‰‹æ®µï¼ŒæŠŠæ¯å±‚ç¥ç»ç½‘ç»œä»»æ„ç¥ç»å…ƒè¿™ä¸ªè¾“å…¥å€¼çš„åˆ†å¸ƒå¼ºè¡Œæ‹‰å›åˆ°å‡å€¼ä¸º0æ–¹å·®ä¸º1çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒ</strong>ï¼Œå…¶å®å°±æ˜¯æŠŠè¶Šæ¥è¶Šåçš„åˆ†å¸ƒå¼ºåˆ¶æ‹‰å›æ¯”è¾ƒæ ‡å‡†çš„åˆ†å¸ƒï¼Œè¿™æ ·ä½¿å¾—æ¿€æ´»è¾“å…¥å€¼è½åœ¨éçº¿æ€§å‡½æ•°å¯¹è¾“å…¥æ¯”è¾ƒæ•æ„Ÿçš„åŒºåŸŸï¼Œè¿™æ ·è¾“å…¥çš„å°å˜åŒ–å°±ä¼šå¯¼è‡´æŸå¤±å‡½æ•°è¾ƒå¤§çš„å˜åŒ–ï¼Œæ„æ€æ˜¯<strong>è¿™æ ·è®©æ¢¯åº¦å˜å¤§ï¼Œé¿å…æ¢¯åº¦æ¶ˆå¤±é—®é¢˜äº§ç”Ÿï¼Œè€Œä¸”æ¢¯åº¦å˜å¤§æ„å‘³ç€å­¦ä¹ æ”¶æ•›é€Ÿåº¦å¿«ï¼Œèƒ½å¤§å¤§åŠ å¿«è®­ç»ƒé€Ÿåº¦ã€‚</strong></p>
<p><strong>å¯¹äºæ¯ä¸ªéšå±‚ç¥ç»å…ƒï¼ŒæŠŠé€æ¸å‘éçº¿æ€§å‡½æ•°æ˜ å°„åå‘å–å€¼åŒºé—´æé™é¥±å’ŒåŒºé æ‹¢çš„è¾“å…¥åˆ†å¸ƒå¼ºåˆ¶æ‹‰å›åˆ°å‡å€¼ä¸º0æ–¹å·®ä¸º1çš„æ¯”è¾ƒæ ‡å‡†çš„æ­£æ€åˆ†å¸ƒï¼Œä½¿å¾—éçº¿æ€§å˜æ¢å‡½æ•°çš„è¾“å…¥å€¼è½å…¥å¯¹è¾“å…¥æ¯”è¾ƒæ•æ„Ÿçš„åŒºåŸŸï¼Œä»¥æ­¤é¿å…æ¢¯åº¦æ¶ˆå¤±é—®é¢˜</strong>ã€‚å› ä¸ºæ¢¯åº¦ä¸€ç›´éƒ½èƒ½ä¿æŒæ¯”è¾ƒå¤§çš„çŠ¶æ€ï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾å¯¹ç¥ç»ç½‘ç»œçš„å‚æ•°è°ƒæ•´æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œå°±æ˜¯å˜åŠ¨å¤§ï¼Œå°±æ˜¯è¯´å‘æŸå¤±å‡½æ•°æœ€ä¼˜å€¼è¿ˆåŠ¨çš„æ­¥å­å¤§ï¼Œä¹Ÿå°±æ˜¯è¯´æ”¶æ•›åœ°å¿«ã€‚BNè¯´åˆ°åº•å°±æ˜¯è¿™ä¹ˆä¸ªæœºåˆ¶ï¼Œæ–¹æ³•å¾ˆç®€å•ï¼Œé“ç†å¾ˆæ·±åˆ»ã€‚</p>
<h3 id="è®­ç»ƒé˜¶æ®µå¦‚ä½•åšBatchNorm"><a href="#è®­ç»ƒé˜¶æ®µå¦‚ä½•åšBatchNorm" class="headerlink" title="è®­ç»ƒé˜¶æ®µå¦‚ä½•åšBatchNorm"></a>è®­ç»ƒé˜¶æ®µå¦‚ä½•åšBatchNorm</h3><p>å‡è®¾å¯¹äºä¸€ä¸ªæ·±å±‚ç¥ç»ç½‘ç»œæ¥è¯´ï¼Œå…¶ä¸­ä¸¤å±‚ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="/2020/03/28/BatchNormalization/bn1.png" alt="avatar"></p>
<p>è¦å¯¹æ¯ä¸ªéšå±‚ç¥ç»å…ƒçš„æ¿€æ´»å€¼åšBNï¼Œå¯ä»¥æƒ³è±¡æˆæ¯ä¸ªéšå±‚åˆåŠ ä¸Šäº†ä¸€å±‚BNæ“ä½œå±‚ï¼Œå®ƒä½äºX=WU+Bæ¿€æ´»å€¼è·å¾—ä¹‹åï¼Œéçº¿æ€§å‡½æ•°å˜æ¢ä¹‹å‰ï¼Œå…¶å›¾ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="/2020/03/28/BatchNormalization/bn2.png" alt="avatar"></p>
<p>å¯¹äºMini-Batch SGDæ¥è¯´ï¼Œä¸€æ¬¡è®­ç»ƒè¿‡ç¨‹é‡Œé¢åŒ…å«mä¸ªè®­ç»ƒå®ä¾‹ï¼Œå…¶å…·ä½“BNæ“ä½œå°±æ˜¯å¯¹äºéšå±‚å†…æ¯ä¸ªç¥ç»å…ƒçš„æ¿€æ´»å€¼æ¥è¯´ï¼Œè¿›è¡Œå¦‚ä¸‹å˜æ¢ï¼š</p>
<script type="math/tex; mode=display">
\hat{x}^{(k)}=\frac{x^{(k)}-E\left[x^{(k)}\right]}{\sqrt{\operatorname{Var}\left[x^{(k)}\right]}}</script><p>æŸä¸ªç¥ç»å…ƒå¯¹åº”çš„åŸå§‹çš„æ¿€æ´»xé€šè¿‡å‡å»mini-Batchå†…mä¸ªå®ä¾‹è·å¾—çš„mä¸ªæ¿€æ´»xæ±‚å¾—çš„å‡å€¼E(x)å¹¶é™¤ä»¥æ±‚å¾—çš„æ–¹å·®Var(x)æ¥è¿›è¡Œè½¬æ¢ã€‚</p>
<p>ç»è¿‡è¿™ä¸ª<strong>å˜æ¢åæŸä¸ªç¥ç»å…ƒçš„æ¿€æ´»xå½¢æˆäº†å‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º1çš„æ­£æ€åˆ†å¸ƒï¼Œç›®çš„æ˜¯æŠŠå€¼å¾€åç»­è¦è¿›è¡Œçš„éçº¿æ€§å˜æ¢çš„çº¿æ€§åŒºæ‹‰åŠ¨ï¼Œå¢å¤§å¯¼æ•°å€¼ï¼Œå¢å¼ºåå‘ä¼ æ’­ä¿¡æ¯æµåŠ¨æ€§ï¼ŒåŠ å¿«è®­ç»ƒæ”¶æ•›é€Ÿåº¦ã€‚ ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ç½‘ç»œè¡¨è¾¾èƒ½åŠ›ä¸‹é™ï¼Œä¸ºäº†é˜²æ­¢è¿™ä¸€ç‚¹ï¼Œæ¯ä¸ªç¥ç»å…ƒå¢åŠ ä¸¤ä¸ªè°ƒèŠ‚å‚æ•°ï¼ˆscaleå’Œshiftï¼‰ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ˜¯é€šè¿‡è®­ç»ƒæ¥å­¦ä¹ åˆ°çš„ï¼Œç”¨æ¥å¯¹å˜æ¢åçš„æ¿€æ´»åå˜æ¢ï¼Œä½¿å¾—ç½‘ç»œè¡¨è¾¾èƒ½åŠ›å¢å¼ºï¼Œå³å¯¹å˜æ¢åçš„æ¿€æ´»è¿›è¡Œå¦‚ä¸‹çš„scaleå’Œshiftæ“ä½œï¼Œè¿™å…¶å®æ˜¯å˜æ¢çš„åæ“ä½œï¼š</strong></p>
<script type="math/tex; mode=display">
y^{(k)}=\gamma^{(k)} \hat{x}^{(k)}+\beta^{(k)}</script><p>ç®—æ³•æè¿°ï¼š</p>
<p><img src="/2020/03/28/BatchNormalization/bn3.png" alt="avatar"></p>
<h3 id="æ¨ç†é˜¶æ®µå¦‚ä½•åšBatchNorm"><a href="#æ¨ç†é˜¶æ®µå¦‚ä½•åšBatchNorm" class="headerlink" title="æ¨ç†é˜¶æ®µå¦‚ä½•åšBatchNorm"></a>æ¨ç†é˜¶æ®µå¦‚ä½•åšBatchNorm</h3><p>BNåœ¨è®­ç»ƒçš„æ—¶å€™å¯ä»¥æ ¹æ®Mini-Batché‡Œçš„è‹¥å¹²è®­ç»ƒå®ä¾‹è¿›è¡Œæ¿€æ´»æ•°å€¼è°ƒæ•´ï¼Œä½†æ˜¯åœ¨æ¨ç†ï¼ˆinferenceï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆæ˜æ˜¾è¾“å…¥å°±åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œçœ‹ä¸åˆ°Mini-Batchå…¶å®ƒå®ä¾‹ï¼Œé‚£ä¹ˆè¿™æ—¶å€™æ€ä¹ˆå¯¹è¾“å…¥åšBNå‘¢ï¼Ÿå› ä¸ºå¾ˆæ˜æ˜¾ä¸€ä¸ªå®ä¾‹æ˜¯æ²¡æ³•ç®—å®ä¾‹é›†åˆæ±‚å‡ºçš„å‡å€¼å’Œæ–¹å·®çš„ã€‚è¿™å¯å¦‚ä½•æ˜¯å¥½ï¼Ÿ</p>
<p>æ—¢ç„¶æ²¡æœ‰ä»Mini-Batchæ•°æ®é‡Œå¯ä»¥å¾—åˆ°çš„ç»Ÿè®¡é‡ï¼Œé‚£å°±æƒ³å…¶å®ƒåŠæ³•æ¥è·å¾—è¿™ä¸ªç»Ÿè®¡é‡ï¼Œå°±æ˜¯å‡å€¼å’Œæ–¹å·®ã€‚å¯ä»¥ç”¨ä»æ‰€æœ‰è®­ç»ƒå®ä¾‹ä¸­è·å¾—çš„ç»Ÿè®¡é‡æ¥ä»£æ›¿Mini-Batché‡Œé¢mä¸ªè®­ç»ƒå®ä¾‹è·å¾—çš„å‡å€¼å’Œæ–¹å·®ç»Ÿè®¡é‡ï¼Œå› ä¸ºæœ¬æ¥å°±æ‰“ç®—ç”¨å…¨å±€çš„ç»Ÿè®¡é‡ï¼Œåªæ˜¯å› ä¸ºè®¡ç®—é‡ç­‰å¤ªå¤§æ‰€ä»¥æ‰ä¼šç”¨Mini-Batchè¿™ç§ç®€åŒ–æ–¹å¼çš„ï¼Œé‚£ä¹ˆåœ¨æ¨ç†çš„æ—¶å€™ç›´æ¥ç”¨å…¨å±€ç»Ÿè®¡é‡å³å¯ã€‚</p>
<p>å†³å®šäº†è·å¾—ç»Ÿè®¡é‡çš„æ•°æ®èŒƒå›´ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯å¦‚ä½•è·å¾—å‡å€¼å’Œæ–¹å·®çš„é—®é¢˜ã€‚å¾ˆç®€å•ï¼Œå› ä¸ºæ¯æ¬¡åšMini-Batchè®­ç»ƒæ—¶ï¼Œéƒ½ä¼šæœ‰é‚£ä¸ªMini-Batché‡Œmä¸ªè®­ç»ƒå®ä¾‹è·å¾—çš„å‡å€¼å’Œæ–¹å·®ï¼Œç°åœ¨è¦å…¨å±€ç»Ÿè®¡é‡ï¼Œåªè¦æŠŠæ¯ä¸ªMini-Batchçš„å‡å€¼å’Œæ–¹å·®ç»Ÿè®¡é‡è®°ä½ï¼Œç„¶åå¯¹è¿™äº›å‡å€¼å’Œæ–¹å·®æ±‚å…¶å¯¹åº”çš„æ•°å­¦æœŸæœ›å³å¯å¾—å‡ºå…¨å±€ç»Ÿè®¡é‡</p>
<script type="math/tex; mode=display">
\begin{aligned}
&E[x] \leftarrow E_{\mathrm{B}}\left[\mu_{\mathrm{B}}\right] \\
&\operatorname{Var}[x] \leftarrow \frac{m}{m-1} E_{\mathrm{B}}\left[\sigma_{\mathrm{B}}^{2}\right]
\end{aligned}</script><p>æœ‰äº†å‡å€¼å’Œæ–¹å·®ï¼Œæ¯ä¸ªéšå±‚ç¥ç»å…ƒä¹Ÿå·²ç»æœ‰å¯¹åº”è®­ç»ƒå¥½çš„Scalingå‚æ•°å’ŒShiftå‚æ•°ï¼Œå°±å¯ä»¥åœ¨æ¨å¯¼çš„æ—¶å€™å¯¹æ¯ä¸ªç¥ç»å…ƒçš„æ¿€æ´»æ•°æ®è®¡ç®—NBè¿›è¡Œå˜æ¢äº†ï¼Œåœ¨æ¨ç†è¿‡ç¨‹ä¸­è¿›è¡ŒBNé‡‡å–å¦‚ä¸‹æ–¹å¼ï¼š</p>
<script type="math/tex; mode=display">
y=\frac{\gamma}{\sqrt{\operatorname{Var}[x]+\varepsilon}} \cdot x+\left(\beta-\frac{\gamma \cdot E[x]}{\sqrt{\operatorname{Var}[x]+\varepsilon})}\right)</script><p>è¿™ä¸ªå…¬å¼å…¶å®å’Œè®­ç»ƒæ—¶</p>
<script type="math/tex; mode=display">
y^{(k)}=\gamma^{(k)} \hat{x}^{(k)}+\beta^{(k)}</script><p>æ˜¯ç­‰ä»·çš„ï¼Œé€šè¿‡ç®€å•çš„åˆå¹¶è®¡ç®—æ¨å¯¼å°±å¯ä»¥å¾—å‡ºè¿™ä¸ªç»“è®ºã€‚é‚£ä¹ˆä¸ºå•¥è¦å†™æˆè¿™ä¸ªå˜æ¢å½¢å¼å‘¢ï¼Ÿä½œè€…è¿™ä¹ˆå†™çš„æ„æ€æ˜¯ï¼šåœ¨å®é™…è¿è¡Œçš„æ—¶å€™ï¼ŒæŒ‰ç…§è¿™ç§å˜ä½“å½¢å¼å¯ä»¥å‡å°‘è®¡ç®—é‡ï¼Œä¸ºå•¥å‘¢ï¼Ÿå› ä¸ºå¯¹äºæ¯ä¸ªéšå±‚èŠ‚ç‚¹æ¥è¯´ï¼š</p>
<script type="math/tex; mode=display">
\frac{\gamma}{\sqrt{\operatorname{Var}[x]+\varepsilon}} \frac{\gamma \cdot E[x]}{\sqrt{\operatorname{Var}[x]+\varepsilon}}</script><p>éƒ½æ˜¯å›ºå®šå€¼ï¼Œè¿™æ ·è¿™ä¸¤ä¸ªå€¼å¯ä»¥äº‹å…ˆç®—å¥½å­˜èµ·æ¥ï¼Œåœ¨æ¨ç†çš„æ—¶å€™ç›´æ¥ç”¨å°±è¡Œäº†ï¼Œè¿™æ ·æ¯”åŸå§‹çš„å…¬å¼æ¯ä¸€æ­¥éª¤éƒ½ç°ç®—å°‘äº†é™¤æ³•çš„è¿ç®—è¿‡ç¨‹ï¼Œä¹ä¸€çœ‹ä¹Ÿæ²¡å°‘å¤šå°‘è®¡ç®—é‡ï¼Œä½†æ˜¯å¦‚æœéšå±‚èŠ‚ç‚¹ä¸ªæ•°å¤šçš„è¯èŠ‚çœçš„è®¡ç®—é‡å°±æ¯”è¾ƒå¤šäº†ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol>
<li><strong>ä¸ä»…ä»…æå¤§æå‡äº†è®­ç»ƒé€Ÿåº¦ï¼Œæ”¶æ•›è¿‡ç¨‹å¤§å¤§åŠ å¿«</strong></li>
<li><strong>è¿˜èƒ½å¢åŠ åˆ†ç±»æ•ˆæœï¼Œä¸€ç§è§£é‡Šæ˜¯è¿™æ˜¯ç±»ä¼¼äºDropoutçš„ä¸€ç§é˜²æ­¢è¿‡æ‹Ÿåˆçš„æ­£åˆ™åŒ–è¡¨è¾¾æ–¹å¼ï¼Œæ‰€ä»¥ä¸ç”¨Dropoutä¹Ÿèƒ½è¾¾åˆ°ç›¸å½“çš„æ•ˆæœ</strong></li>
<li>å¦å¤–è°ƒå‚è¿‡ç¨‹ä¹Ÿç®€å•å¤šäº†ï¼Œå¯¹äºåˆå§‹åŒ–è¦æ±‚æ²¡é‚£ä¹ˆé«˜ï¼Œè€Œä¸”å¯ä»¥ä½¿ç”¨å¤§çš„å­¦ä¹ ç‡ç­‰ã€‚æ€»è€Œè¨€ä¹‹ï¼Œç»è¿‡è¿™ä¹ˆç®€å•çš„å˜æ¢ï¼Œå¸¦æ¥çš„å¥½å¤„å¤šå¾—å¾ˆï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä½•ç°åœ¨BNè¿™ä¹ˆå¿«æµè¡Œèµ·æ¥çš„åŸå› ã€‚</li>
</ol>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://cloud.tencent.com/developer/article/1157136" target="_blank" rel="noopener">æ·±åº¦å­¦ä¹ ã€‘æ·±å…¥ç†è§£Batch Normalizationæ‰¹æ ‡å‡†åŒ–</a></li>
</ol>
]]></content>
      <categories>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ·±åº¦å­¦ä¹ </tag>
        <tag>batch normalization</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±åº¦å­¦ä¹ æ€»ç»“</title>
    <url>/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="ç¥ç»å…ƒ-æ„ŸçŸ¥å™¨"><a href="#ç¥ç»å…ƒ-æ„ŸçŸ¥å™¨" class="headerlink" title="ç¥ç»å…ƒ(æ„ŸçŸ¥å™¨)"></a>ç¥ç»å…ƒ(æ„ŸçŸ¥å™¨)</h4><ol>
<li>æ„ŸçŸ¥å™¨æ˜¯ä¸€ç§äººå·¥<strong>ç¥ç»å…ƒ</strong>.å®ƒæ¥å—å‡ ä¸ª<strong>äºŒè¿›åˆ¶è¾“å‡º</strong>å¹¶äº§ç”Ÿä¸€ä¸ª<strong>äºŒè¿›åˆ¶è¾“å…¥</strong>.å¦‚æœå¼•å…¥<strong>æƒé‡</strong>å’Œ<strong>é˜ˆå€¼</strong>,é‚£ä¹ˆæ„ŸçŸ¥å™¨çš„å‚æ•°å¯ä»¥è¡¨ç¤ºä¸º:$f(x)=sign(wx+b)$</li>
<li>æ„ŸçŸ¥å™¨æ˜¯<strong>å•è¾“å‡º</strong>çš„,ä½†è¿™ä¸ªå•è¾“å‡ºå¯ä»¥è¢«ç”¨äº<strong>å¤šä¸ª</strong>å…¶å®ƒæ„ŸçŸ¥å™¨çš„è¾“å…¥.</li>
<li>æ„ŸçŸ¥å™¨å¯ä»¥å¾ˆå®¹æ˜“åœ°è®¡ç®—åŸºæœ¬çš„<strong>é€»è¾‘åŠŸèƒ½</strong>,å¦‚<strong>ä¸</strong>,<strong>æˆ–</strong>,<strong>ä¸é</strong>.æ‰€ä»¥æ„ŸçŸ¥å™¨ç½‘ç»œå¯ä»¥è®¡ç®—ä»»ä½•é€»è¾‘åŠŸèƒ½</li>
<li>ä½¿æ„ŸçŸ¥å™¨èƒ½å¤Ÿè‡ªåŠ¨è°ƒæ•´æƒé‡å’Œåç½®çš„<strong>å­¦ä¹ ç®—æ³•</strong>æ˜¯ç¥ç»ç½‘ç»œæœ‰åˆ«äºä¼ ç»Ÿé€»è¾‘é—¨çš„å…³é”®.</li>
</ol>
<h4 id="Så‹ç¥ç»å…ƒ"><a href="#Så‹ç¥ç»å…ƒ" class="headerlink" title="Så‹ç¥ç»å…ƒ"></a>Så‹ç¥ç»å…ƒ</h4><ol>
<li>ç½‘ç»œä¸­å•ä¸ªæ„ŸçŸ¥å™¨ä¸Šæƒé‡æˆ–åç½®çš„<strong>å¾®å°æ”¹åŠ¨</strong>å¯èƒ½ä¼šå¼•èµ·<strong>è¾“å‡ºç¿»è½¬</strong>,ä»è€Œå¯¼è‡´å…¶ä½™ç½‘ç»œçš„è¡Œä¸ºæ”¹å˜.æ‰€ä»¥<strong>é€æ­¥ä¿®æ”¹</strong>æƒé‡å’Œåç½®æ¥è®©è¾“å‡ºæ¥è¿‘æœŸæœ›å¾ˆå›°éš¾,æ‰€ä»¥å¼•å…¥äº†<strong>Så‹ç¥ç»å…ƒ(é€»è¾‘ç¥ç»å…ƒ)</strong></li>
<li>Så‹ç¥ç»å…ƒå’Œæ„ŸçŸ¥å™¨ç±»ä¼¼,ä½†æ˜¯æƒé‡å’Œåç½®çš„å¾®å°æ”¹åŠ¨åªå¼•èµ·è¾“å‡ºçš„<strong>å¾®å°å˜åŒ–</strong>.Så‹ç¥ç»å…ƒçš„è¾“å…¥å¯ä»¥æ˜¯<strong>0å’Œ1ä¸­çš„ä»»æ„å€¼</strong>,è¾“å‡ºæ˜¯$Ïƒ(wx+b)$,å…¶ä¸­$Ïƒ$è¢«ç§°ä¸ºså‹å‡½æ•°(é€»è¾‘å‡½æ•°).</li>
<li>Ïƒå‡½æ•°æ˜¯é˜¶è·ƒå‡½æ•°çš„<strong>å¹³æ»‘</strong>ç‰ˆæœ¬.è¿™æ„å‘³ç€æƒé‡å’Œåç½®çš„å¾®å°å˜åŒ–ä¼šäº§ç”Ÿä¸€ä¸ªå¾®å°çš„è¾“å‡ºå˜åŒ–,$\Delta output \approx \sum_{j} \frac{\partial \text { output }}{\partial w_{j}} \Delta w_{j}+\frac{\partial \text { output }}{\partial b} \Delta b$,è¿™æ„å‘³ç€è¾“å‡ºçš„å˜åŒ–æ˜¯æƒé‡å’Œåç½®çš„å˜åŒ–çš„<strong>çº¿æ€§å‡½æ•°</strong>.</li>
</ol>
<a id="more"></a>
<h4 id="æ¢¯åº¦ä¸‹é™ç®—æ³•"><a href="#æ¢¯åº¦ä¸‹é™ç®—æ³•" class="headerlink" title="æ¢¯åº¦ä¸‹é™ç®—æ³•"></a>æ¢¯åº¦ä¸‹é™ç®—æ³•</h4><ol>
<li><p>ç¥ç»ç½‘ç»œä¸­ç»å¸¸éœ€è¦<strong>å¤§é‡</strong>å˜é‡,å› æ­¤é‡‡ç”¨<strong>æ¢¯åº¦ä¸‹é™æ³•</strong>æ¥è®¡ç®—ä»£ä»·å‡½æ•°æœ€å°å€¼:é‡å¤è®¡ç®—æ¢¯åº¦,ç„¶åæ²¿ç€<strong>ç›¸å</strong>çš„æ–¹å‘ç§»åŠ¨$v \rightarrow v^{\prime}=v-\eta \nabla C$</p>
</li>
<li><p>å‡å¦‚éœ€è¦è®¡ç®—æ¯ä¸ªè®­ç»ƒè¾“å…¥çš„æ¢¯åº¦å€¼,è®­ç»ƒé€Ÿåº¦ä¼šç›¸å½“ç¼“æ…¢.å› æ­¤å¼•å…¥äº†<strong>éšæœºæ¢¯åº¦ä¸‹é™</strong>,åªè®¡ç®—å°æ‰¹é‡æ•°æ®(mini-batch)çš„æ¢¯åº¦å€¼æ¥æ±‚å¹³å‡å€¼</p>
<script type="math/tex; mode=display">
\begin{aligned}
w_{k} \rightarrow w_{k}^{\prime} &=w_{k}-\frac{\eta}{m} \sum_{j} \frac{\partial C_{X_{j}}}{\partial w_{k}} \\
b_{l} \rightarrow b_{l}^{\prime} &=b_{l}-\frac{\eta}{m} \sum_{j} \frac{\partial C_{X_{j}}}{\partial b_{l}}
\end{aligned}</script></li>
<li><p>éšæœºæœºæ¢¯åº¦ä¸‹é™ä¸æ–­åœ°é€‰å®šå°æ‰¹é‡æ•°æ®æ¥è¿›è¡Œè®­ç»ƒ,ç›´åˆ°ç”¨å®Œäº†æ‰€æœ‰çš„è®­ç»ƒè¾“å…¥,å°±ç§°ä¸ºå®Œæˆäº†ä¸€ä¸ª<strong>è¿­ä»£æœŸ(epoch)</strong>,ç„¶åä¼šå¼€å§‹ä¸€ä¸ªæ–°çš„è¿­ä»£æœŸ.</p>
</li>
</ol>
<h4 id="åå‘ä¼ æ’­-BP-ç®—æ³•"><a href="#åå‘ä¼ æ’­-BP-ç®—æ³•" class="headerlink" title="åå‘ä¼ æ’­(BP)ç®—æ³•"></a>åå‘ä¼ æ’­(BP)ç®—æ³•</h4><h5 id="ç¥ç»ç½‘ç»œä¸­ä½¿ç”¨çŸ©é˜µå¿«é€Ÿè®¡ç®—è¾“å‡ºçš„æ–¹æ³•"><a href="#ç¥ç»ç½‘ç»œä¸­ä½¿ç”¨çŸ©é˜µå¿«é€Ÿè®¡ç®—è¾“å‡ºçš„æ–¹æ³•" class="headerlink" title="ç¥ç»ç½‘ç»œä¸­ä½¿ç”¨çŸ©é˜µå¿«é€Ÿè®¡ç®—è¾“å‡ºçš„æ–¹æ³•"></a>ç¥ç»ç½‘ç»œä¸­ä½¿ç”¨çŸ©é˜µå¿«é€Ÿè®¡ç®—è¾“å‡ºçš„æ–¹æ³•</h5><ol>
<li>$w^l_{jk}$è¡¨ç¤ºä»ç¬¬$(l-1)$å±‚çš„ç¬¬$k$ä¸ªç¥ç»å…ƒåˆ°ç¬¬$l$å±‚çš„ç¬¬$j$ä¸ªç¥ç»å…ƒçš„é“¾æ¥ä¸Šçš„<strong>æƒé‡</strong>,$b^l_j$è¡¨ç¤ºåœ¨ç¬¬lå±‚ç¬¬jä¸ªç¥ç»å…ƒçš„<strong>åç½®</strong>.$a^l_j$è¡¨ç¤ºç¬¬lå±‚ç¬¬jä¸ªç¥ç»å…ƒçš„<strong>æ¿€æ´»å€¼</strong>.ç”±æ­¤å¾—åˆ°äº†æ¿€æ´»å€¼ä¹‹é—´çš„å…³ç³»$a_{j}^{l}=\sigma\left(\sum_{k} w_{j k}^{l} a_{k}^{l-1}+b_{j}^{l}\right)$</li>
<li>å¯¹æ¯ä¸€å±‚lå®šä¹‰<strong>æƒé‡çŸ©é˜µ</strong>(å…¶ä¸­ç¬¬jè¡Œç¬¬kåˆ—çš„å…ƒç´ æ˜¯$w^l_{jk}$,<strong>åç½®å‘é‡</strong>(æ¯ä¸ªå…ƒç´ æ˜¯$b^l_j$)å’Œ<strong>æ¿€æ´»å‘é‡</strong>(æ¯ä¸ªå…ƒç´ æ˜¯$a^l_j$).æ‰€ä»¥ä¸Šå¼å¯ä»¥æ”¹å†™ä¸º$a^{l}=\sigma\left(w^{l} a^{l-1}+b^{l}\right)$,å…¶ä¸­Ïƒæ˜¯<strong>å‘é‡åŒ–å‡½æ•°</strong>(ä½œç”¨Ïƒåˆ°å‘é‡ä¸­çš„æ¯ä¸ªå…ƒç´ ).ä¸­é—´é‡$z^{l} \equiv w^{l} a^{l-1}+b^{l}$ç§°ä¸º<strong>å¸¦æƒè¾“</strong>å…¥(æ¯ä¸ªå…ƒç´ æ˜¯ç¬¬lå±‚ç¬¬jä¸ªç¥ç»å…ƒçš„æ¿€æ´»å‡½æ•°çš„å¸¦æƒè¾“å…¥<strong>)</strong>.</li>
</ol>
<h5 id="å…³äºä»£ä»·å‡½æ•°çš„ä¸¤ä¸ªå‡è®¾"><a href="#å…³äºä»£ä»·å‡½æ•°çš„ä¸¤ä¸ªå‡è®¾" class="headerlink" title="å…³äºä»£ä»·å‡½æ•°çš„ä¸¤ä¸ªå‡è®¾"></a>å…³äºä»£ä»·å‡½æ•°çš„ä¸¤ä¸ªå‡è®¾</h5><p><strong>åå‘ä¼ æ’­</strong>çš„ç›®æ ‡æ˜¯è®¡ç®—ä»£ä»·å‡½æ•°å…³äºwå’Œbçš„<strong>åå¯¼æ•°</strong>.ä¸ºäº†è®©åå‘ä¼ æ’­å¯è¡Œ,éœ€è¦ä½œå‡ºä¸¤ä¸ªä¸»è¦å‡è®¾</p>
<ol>
<li>ä»£ä»·å‡½æ•°å¯ä»¥è¢«å†™æˆä¸€ä¸ªåœ¨æ¯ä¸ªè®­ç»ƒæ ·æœ¬xä¸Šçš„ä»£ä»·å‡½æ•°çš„<strong>å‡å€¼</strong>$C=\frac{1}{n} \sum_{x} C_{x}$</li>
<li>ä»£ä»·å¯ä»¥å†™æˆç¥ç»ç½‘ç»œè¾“å‡ºçš„å‡½æ•°,ä»¥äºŒæ¬¡ä»£ä»·å‡½æ•°ä¸ºä¾‹$C=\frac{1}{2}\left|y-a^{L}\right|^{2}=\frac{1}{2} \sum_{j}\left(y_{j}-a_{j}^{L}\right)^{2}$</li>
</ol>
<h5 id="Hadamardä¹˜ç§¯-sâŠ™t"><a href="#Hadamardä¹˜ç§¯-sâŠ™t" class="headerlink" title="Hadamardä¹˜ç§¯,sâŠ™t"></a>Hadamardä¹˜ç§¯,sâŠ™t</h5><p>å‡è®¾så’Œtæ˜¯ä¸¤ä¸ªåŒæ ·ç»´åº¦çš„å‘é‡,é‚£ä¹ˆsâŠ™tè¡¨ç¤º<strong>æŒ‰å…ƒç´ çš„ä¹˜ç§¯</strong>,ç§°ä¸º<strong>Hadamardä¹˜ç§¯</strong></p>
<h5 id="åå‘ä¼ æ’­çš„å››ä¸ªåŸºæœ¬æ–¹ç¨‹"><a href="#åå‘ä¼ æ’­çš„å››ä¸ªåŸºæœ¬æ–¹ç¨‹" class="headerlink" title="åå‘ä¼ æ’­çš„å››ä¸ªåŸºæœ¬æ–¹ç¨‹"></a>åå‘ä¼ æ’­çš„å››ä¸ªåŸºæœ¬æ–¹ç¨‹</h5><p>åœ¨ç¬¬lå±‚ç¬¬jä¸ªç¥ç»å…ƒä¸Šçš„<strong>è¯¯å·®</strong>,è¢«å®šä¹‰ä¸º$\delta_{j}^{l} \equiv \frac{\partial C}{\partial z_{j}^{l}}$</p>
<p><strong>å››ä¸ªåŸºæœ¬æ–¹ç¨‹</strong></p>
<ol>
<li><p>è¾“å‡ºå±‚è¯¯å·®çš„æ–¹ç¨‹: $\delta_{j}^{L} = \frac{\partial C}{\partial a^L_j}\frac{\partial a^L_j}{\partial z^l_j} = \frac{\partial C}{\partial a_{j}^{L}} \sigma^{\prime}\left(z_{j}^{L}\right)$ </p>
<p> å³å¼ç¬¬â¼€ä¸ªé¡¹ $\frac{\partial C}{\partial a^L_j}$ è¡¨â½°ä»£ä»·éšç€ $j^{th}$è¾“å‡ºæ¿€æ´»å€¼çš„å˜åŒ–â½½ å˜åŒ–çš„é€Ÿåº¦ã€‚å‡å¦‚ $C$ ä¸å¤ªä¾èµ–â¼€ä¸ªç‰¹å®šçš„è¾“å‡ºç¥ç»å…ƒ $j$ï¼Œé‚£ä¹ˆ$\delta^L_j$å°±ä¼šå¾ˆâ¼©ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚å³å¼ç¬¬â¼†é¡¹ $\sigma^\prime(Z^L_j)$åˆ»ç”»äº†åœ¨$z^L_j$ å¤„æ¿€æ´»å‡½æ•° $\sigma$ å˜åŒ–çš„é€Ÿåº¦ã€‚</p>
</li>
<li><p>ä½¿ç”¨ä¸‹ä¸€å±‚çš„è¯¯å·®æ¥è¡¨ç¤ºå½“å‰å±‚çš„è¯¯å·®:$\delta^{l}=\left(\left(w^{l+1}\right)^{T} \delta^{l+1}\right) \odot \sigma^{\prime}\left(z^{l}\right)$</p>
<p> ç”±é€’æ¨å…¬å¼</p>
<script type="math/tex; mode=display">
\begin{aligned}
\frac{\partial  C}{\partial  z^l_j} &=\delta^l_j \\
& = \sum_i{\frac{\partial  C}{\partial  z^{l+1}_i}\frac{\partial  z^{l+1}_i}{\partial  z^l_j}} \\ 
&=\sum_i{\delta ^{l+1}_i \frac{\partial  z^{l+1}_i}{\partial  a^l_j}\frac{\partial  a^l_j}{\partial  z^l_j}} \\ 
&=\sum_i{\delta^{l+1}_i w^{l+1}_{ji} \sigma \prime (z^l_j)} \\
&=(w^{l+1}_j)^T\delta^{l+1}\sigma \prime(z^l_j) \\
&=(w^{l+1})^T \sigma^{l+1}\bigodot \sigma \prime (z^l)
\end{aligned}</script></li>
<li><p>ä»£ä»·å‡½æ•°å…³äºç½‘ç»œä¸­ä»»æ„åç½®çš„æ”¹å˜ç‡:$\frac{\partial C}{\partial b_{j}^{l}}=\delta_{j}^{l}$</p>
</li>
<li><p>ä»£ä»·å‡½æ•°å…³äºä»»ä½•ä¸€ä¸ªæƒé‡çš„æ”¹å˜ç‡:$\frac{\partial C}{\partial w_{j k}^{l}}=a_{k}^{l-1} \delta_{j}^{l}$ï¼ˆå› ä¸º$z^l = w^la^{l-1}+b^l$ï¼‰</p>
</li>
</ol>
<h5 id="ç®—æ³•æè¿°"><a href="#ç®—æ³•æè¿°" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h5><p>åå‘ä¼ æ’­æ–¹ç¨‹ç»™å‡ºäº†ä¸€ç§è®¡ç®—ä»£ä»·å‡½æ•°æ¢¯åº¦çš„æ–¹æ³•:</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/bp.png" alt="avatar"></p>
<ol>
<li><strong>è¾“å…¥x</strong>:ä¸ºè¾“å…¥å±‚è®¾ç½®å¯¹åº”çš„æ¿€æ´»å€¼$a1$</li>
<li><strong>å‰å‘ä¼ æ’­</strong>:å¯¹ä»å‰å¾€åå¯¹æ¯å±‚è®¡ç®—ç›¸åº”çš„$z=wa+b$å’Œ$a=Ïƒ(z)$</li>
<li><strong>è¾“å‡ºå±‚è¯¯å·®</strong>:æ ¹æ®BP1è®¡ç®—è¯¯å·®å‘é‡</li>
<li><strong>åå‘è¯¯å·®ä¼ æ’­</strong>:å¯¹åå¾€å‰æ ¹æ®BP2å¯¹æ¯å±‚è®¡ç®—è¯¯å·®å‘é‡</li>
<li><strong>è¾“å‡º</strong>:æ ¹æ®BP3å’ŒBP4è®¡ç®—ä»£ä»·å‡½æ•°çš„æ¢¯åº¦.</li>
</ol>
<h5 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Network</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">backprop</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">    <span class="string">"""Return a tuple "(nabla_b, nabla_w)" representing the</span></span><br><span class="line"><span class="string">    gradient for the cost function C_x.</span></span><br><span class="line"><span class="string">    "nabla_b" and "nabla_w" are layer-by-layer lists of numpy arrays, similar</span></span><br><span class="line"><span class="string">    to "self.biases" and "self.weights"."""</span></span><br><span class="line"></span><br><span class="line">    nabla_b = [np.zeros(b.shape) <span class="keyword">for</span> b <span class="keyword">in</span> self.biases]</span><br><span class="line">    nabla_w = [np.zeros(w.shape) <span class="keyword">for</span> w <span class="keyword">in</span> self.weights]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># feedforward</span></span><br><span class="line">    activation = x</span><br><span class="line">    activations = [x] <span class="comment"># list to store all the activations, layer by layer</span></span><br><span class="line">    zs = [] <span class="comment"># list to store all the z vectors, layer by layer</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> b, w <span class="keyword">in</span> zip(self.biases, self.weights):</span><br><span class="line">      z = np.dot(w, activation)+b</span><br><span class="line">      zs.append(z)</span><br><span class="line">      activation = sigmoid(z)</span><br><span class="line">      activations.append(activation)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># backward pass</span></span><br><span class="line">    delta = self.cost_derivative(activations[<span class="number">-1</span>], y) * sigmoid_prime(zs[<span class="number">-1</span>])</span><br><span class="line">    nabla_b[<span class="number">-1</span>] = delta</span><br><span class="line">    nabla_w[<span class="number">-1</span>] = np.dot(delta, activations[<span class="number">-2</span>].transpose())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Note that the variable l in the loop below is used a little</span></span><br><span class="line"><span class="comment"># differently to the notation in Chapter 2 of the book.</span></span><br><span class="line"><span class="comment"># Here,l = 1 means the last layer of neurons, l = 2 is the</span></span><br><span class="line"><span class="comment"># second-last layer, and so on.It's a renumbering of the</span></span><br><span class="line"><span class="comment"># scheme in the book, used here to take advantage of the fact</span></span><br><span class="line"><span class="comment"># that Python can use negative indices in lists.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> xrange(<span class="number">2</span>, self.num_layers):</span><br><span class="line">    	z = zs[-l]</span><br><span class="line">      sp = sigmoid_prime(z)</span><br><span class="line">    	delta = np.dot(self.weights[-l+<span class="number">1</span>].transpose(), delta) * sp</span><br><span class="line">    	nabla_b[-l] = delta</span><br><span class="line">    	nabla_w[-l] = np.dot(delta, activations[-l<span class="number">-1</span>].transpose())</span><br><span class="line">    <span class="keyword">return</span> (nabla_b, nabla_w)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cost_derivative</span><span class="params">(self, output_activations, y)</span>:</span></span><br><span class="line">  <span class="string">"""Return the vector of partial derivatives \partial C_x /</span></span><br><span class="line"><span class="string">  \partial a for the output activations."""</span></span><br><span class="line">  	<span class="keyword">return</span> (output_activations-y)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid</span><span class="params">(z)</span>:</span></span><br><span class="line"><span class="string">"""The sigmoid function."""</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">1.0</span>/(<span class="number">1.0</span>+np.exp(-z))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid_prime</span><span class="params">(z)</span>:</span></span><br><span class="line"><span class="string">"""Derivative of the sigmoid function."""</span></span><br><span class="line">  <span class="keyword">return</span> sigmoid(z)*(<span class="number">1</span>-sigmoid(z))</span><br></pre></td></tr></table></figure>
<h4 id="äº¤å‰ç†µä»£ä»·å‡½æ•°"><a href="#äº¤å‰ç†µä»£ä»·å‡½æ•°" class="headerlink" title="äº¤å‰ç†µä»£ä»·å‡½æ•°"></a>äº¤å‰ç†µä»£ä»·å‡½æ•°</h4><p>äººç±»é€šå¸¸åœ¨<strong>çŠ¯é”™æ¯”è¾ƒæ˜æ˜¾</strong>çš„æ—¶å€™å­¦ä¹ çš„<strong>é€Ÿåº¦æœ€å¿«</strong>.è€Œç¥ç»å…ƒåœ¨è¿™ç§<strong>é¥±å’Œ</strong>æƒ…å†µä¸‹å­¦ä¹ å¾ˆæœ‰<strong>éš¾åº¦</strong>(ä¹Ÿå°±æ˜¯åå¯¼æ•°å¾ˆå°),è¿™æ˜¯å› ä¸º<strong>äºŒæ¬¡ä»£ä»·å‡½æ•°</strong>å…³äºæƒé‡å’Œåç½®çš„<strong>åå¯¼æ•°</strong>æ˜¯$\frac{\partial C}{\partial w}=(a-y) \sigma^{\prime}(z) x=a \sigma^{\prime}(z)$å’Œ$\frac{\partial C}{\partial b}=(a-y) \sigma^{\prime}(z)=a \sigma^{\prime}(z)$è€ŒÏƒå‡½æ•°çš„<strong>å¯¼æ•°</strong>åœ¨æ¥è¿‘0å’Œ1æ—¶éƒ½å¾ˆå°ã€‚</p>
<p>è§£å†³ä¸Šè¿°é—®é¢˜çš„æ–¹æ³•æ˜¯å¼•å…¥<strong>äº¤å‰ç†µä»£ä»·å‡½æ•°</strong>:$C=-\frac{1}{n} \sum_{x}[y \ln a+(1-y) \ln (1-a)]$</p>
<ol>
<li>å®ƒæ˜¯<strong>éè´Ÿ</strong>çš„,å¹¶ä¸”å½“å®é™…è¾“å‡ºæ¥è¿‘ç›®æ ‡å€¼æ—¶å®ƒ<strong>æ¥è¿‘0</strong>,å› æ­¤å¯ä»¥ä½œä¸ºä»£ä»·å‡½æ•°.</li>
<li>å®ƒå…³äºæƒé‡çš„<strong>åå¯¼æ•°</strong>æ˜¯$\frac{\partial C}{\partial w_{j}}=\frac{1}{n} \sum_{x} x_{j}(\sigma(z)-y)$,ä¹Ÿå°±æ˜¯è¯¯å·®è¶Šå¤§,å­¦ä¹ é€Ÿåº¦è¶Šå¿«.</li>
<li>å¦‚æœè¾“å‡ºå±‚æ˜¯<strong>çº¿æ€§ç¥ç»å…ƒ</strong>,é‚£ä¹ˆ<strong>äºŒæ¬¡ä»£ä»·å‡½æ•°</strong>ä¸å†ä¼šå¯¼è‡´å­¦ä¹ é€Ÿåº¦ä¸‹é™çš„é—®é¢˜,å¯ä»¥é€‰ç”¨.å¦‚æœè¾“å‡ºç¥ç»å…ƒæ˜¯<strong>Så‹ç¥ç»å…ƒ</strong>,<strong>äº¤å‰ç†µ</strong>ä¸€èˆ¬éƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©. </li>
<li>å¯¹äºå¤šåˆ†ç±»äº¤å‰ç†µä»£ä»·å‡½æ•°ä¸ºï¼š$C=-\sum_{j=1}^{T} y_{j} \log {p_j}$,</li>
</ol>
<h4 id="è¿‡æ‹Ÿåˆ"><a href="#è¿‡æ‹Ÿåˆ" class="headerlink" title="è¿‡æ‹Ÿåˆ"></a>è¿‡æ‹Ÿåˆ</h4><ol>
<li>æœ€å¥½çš„é™ä½è¿‡æ‹Ÿåˆçš„æ–¹å¼å°±æ˜¯<strong>å¢åŠ è®­ç»ƒæ ·æœ¬é‡</strong>,ä½†è®­ç»ƒæ•°æ®å…¶å®æ˜¯å¾ˆ<strong>éš¾å¾—</strong>çš„èµ„æº.</li>
<li><strong>è§„èŒƒåŒ–</strong>ä¹Ÿæ˜¯ä¸€ç§ç¼“è§£è¿‡æ‹Ÿåˆçš„æŠ€æœ¯.æ•ˆæœæ˜¯è®©ç½‘ç»œå€¾å‘äºå­¦ä¹ <strong>å°ä¸€ç‚¹çš„æƒé‡</strong>,å®ƒæ˜¯å¯»æ‰¾å°çš„æƒé‡å’Œæœ€å°åŒ–åŸå§‹ä»£ä»·å‡½æ•°ä¹‹é—´çš„æŠ˜ä¸­,ç›¸å¯¹é‡è¦æ€§ç”±Î»æ§åˆ¶.<ol>
<li><strong>L2è§„èŒƒåŒ–(æƒé‡è¡°å‡)</strong>çš„æƒ³æ³•æ˜¯å¢åŠ ä¸€ä¸ªé¢å¤–çš„<strong>è§„èŒƒåŒ–é¡¹</strong>ï¼š$\frac{\lambda}{2 n} \sum_{w} w^{2}$åˆ°ä»£ä»·å‡½æ•°ä¸Š.å…¶ä¸­Î»æ˜¯<strong>è§„èŒƒåŒ–å‚æ•°</strong>,æ³¨æ„è§„èŒƒåŒ–é¡¹é‡Œ<strong>ä¸åŒ…å«åç½®</strong>.</li>
<li><strong>L1è§„èŒƒåŒ–</strong>çš„è§„èŒƒåŒ–é¡¹ä¸ºï¼š$\frac{\lambda}{n} \sum_{w}|w|$åœ¨L1è§„èŒƒåŒ–ä¸­,æƒé‡é€šè¿‡ä¸€ä¸ªå¸¸é‡<strong>å‘0</strong>è¿›è¡Œç¼©å°,åœ¨L2è§„èŒƒåŒ–ä¸­,æƒé‡é€šè¿‡ä¸€ä¸ªå’Œwæˆ<strong>æ¯”ä¾‹</strong>çš„é‡è¿›è¡Œç¼©å°.æ‰€ä»¥L1è§„èŒƒåŒ–å€¾å‘äº<strong>èšé›†</strong>ç½‘ç»œçš„æƒé‡åœ¨<strong>ç›¸å¯¹å°‘é‡</strong>çš„é«˜é‡è¦åº¦è¿æ¥ä¸Š.</li>
</ol>
</li>
<li><strong>dropout</strong></li>
<li><strong>äººä¸ºæ‰©å±•è®­ç»ƒæ•°æ®</strong></li>
</ol>
<h4 id="è°ƒå‚"><a href="#è°ƒå‚" class="headerlink" title="è°ƒå‚"></a>è°ƒå‚</h4><ol>
<li><strong>å­¦ä¹ é€Ÿç‡Î·</strong></li>
<li><strong>æ—©åœ</strong></li>
<li><strong>è§„èŒƒåŒ–å‚æ•°Î»</strong></li>
<li><strong>å°æ‰¹é‡æ•°æ®å¤§å°</strong></li>
<li><strong>ç½‘æ ¼æœç´¢(grid search)</strong></li>
</ol>
<h3 id="å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œ"></a>å¾ªç¯ç¥ç»ç½‘ç»œ</h3><h4 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h4><p>å¯¹äºå‰é¦ˆç¥ç»ç½‘ç»œæ¥è¯´å…¶å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
O=f(W*X+b)</script><p>å…¶ä¸­$W$å’Œ$b$æ˜¯æ¨¡å‹çš„å‚æ•°ï¼Œ$X$æ˜¯å½“å‰çš„è¾“å…¥ï¼Œ$f(Â·)$æ˜¯æ¿€æ´»å‡½æ•°ï¼Œ$*$æ˜¯çŸ©é˜µä¹˜æ³•ï¼Œ$O$æ˜¯å½“å‰çš„è¾“å‡ºã€‚å³è¾“å‡ºç­‰äºè¾“å…¥ç»è¿‡çº¿æ€§ä¸éçº¿æ€§æ˜ å°„åçš„ç»“æœã€‚</p>
<p>è€ŒRNNé€šè¿‡å°†å‰ä¸€æ—¶åˆ»çš„è¿ç®—ç»“æœæ·»åŠ åˆ°å½“å‰çš„è¿ç®—ä¸­ï¼Œä»è€Œå®ç°äº†â€œè€ƒè™‘ä¸Šæ–‡ä¿¡æ¯â€çš„åŠŸèƒ½ã€‚</p>
<script type="math/tex; mode=display">
\mathrm{O}_{\mathrm{t}}=\mathrm{f}\left(\mathrm{X} * \mathrm{W}+\mathrm{O}_{\mathrm{t}-1} * \mathrm{V}+\mathrm{b}\right)</script><p>å…¶ä¸­$W,V,b$æ˜¯æ¨¡å‹çš„å‚æ•°ï¼Œä¸‹æ ‡$t$ä»£è¡¨å½“å‰çš„åºåˆ—ä½ç½®ï¼æ—¶é—´ç‚¹ï¼Œ$t-1$ä»£è¡¨ä¸Šä¸ªä½ç½®/ä¸Šä¸ªæ—¶é—´ç‚¹ï¼Œ$X$æ˜¯å½“å‰çš„è¾“å…¥ï¼Œ$f(Â·)$æ˜¯æ¿€æ´»å‡½æ•°ï¼Œ$*$æ˜¯çŸ©é˜µä¹˜æ³•ï¼Œ$O$æ˜¯æ¨¡å‹è¾“å‡ºã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/rnn.png" alt="avatar"></p>
<p>BiRnn:RNNå¯ä»¥è€ƒè™‘ä¸Šæ–‡çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå¦‚ä½•å°†ä¸‹æ–‡çš„ä¿¡æ¯ä¹Ÿæ·»åŠ è¿›å»å‘¢ï¼Ÿè¿™å°±æ˜¯BiRNNè¦åšçš„äº‹æƒ…ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/birnn.png" alt="avatar"></p>
<h5 id="RNNå­˜åœ¨çš„é—®é¢˜"><a href="#RNNå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="RNNå­˜åœ¨çš„é—®é¢˜"></a>RNNå­˜åœ¨çš„é—®é¢˜</h5><p>é¦–å…ˆï¼Œä»RNNçš„å‰å‘è¿‡ç¨‹æ¥çœ‹ï¼Œå¯ä»¥è®¤ä¸ºå®ƒåªæœ‰ä¸€å±‚æƒé‡çŸ©é˜µWï¼ˆå…ˆä¸ç®¡Vï¼‰ã€‚ç”±æ­¤å¯è§ä»æ·±å±‚çš„è§’åº¦å»çœ‹RNNçš„å‰å‘è¿‡ç¨‹ï¼Œå°±å¯ä»¥è®¤ä¸ºRNNæ˜¯<strong>å„ä¸ªå±‚çš„æƒé‡çŸ©é˜µç›¸åŒ</strong>çš„æ·±å±‚ç½‘ç»œã€‚å¿½ç•¥Vå’Œæ¿€æ´»å‡½æ•°ï¼Œå°±å¯ä»¥è¿‘ä¼¼çš„è®¤ä¸ºç½‘ç»œä¸€å…±æœ‰Tå±‚ï¼ˆTç­‰äºåºåˆ—çš„é•¿åº¦ï¼‰ï¼Œé‚£ä¹ˆç¬¬tå±‚çš„è¾“å‡ºå°±æ˜¯è¿ä¹˜tæ¬¡Wï¼Œä¹Ÿå°±æ˜¯$W^t$ï¼,ç”±äº<strong>çŸ©é˜µå¯ä»¥ç”¨å®ƒçš„ç‰¹å¾å€¼çŸ©é˜µå’Œç‰¹å¾å‘é‡çŸ©é˜µå»è¿‘ä¼¼</strong>ï¼Œå³</p>
<script type="math/tex; mode=display">
W = V diag(\lambda) V^{-1}  \\
W^t = (V diag(\lambda) V^{-1})(V diag(\lambda) V^{-1})\cdots(V diag(\lambda) V^{-1})=V{ diag(\lambda)}^t V^{-1}</script><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ç‰¹å¾å€¼çŸ©é˜µä¸­çš„æ¯ä¸ªç‰¹å¾å€¼éƒ½ä¼šéšç€tçš„å¢å¤§å‘ç”ŸæŒ‡æ•°çº§å˜åŒ–ï¼</strong>æ‰€ä»¥æŸä¸ªç‰¹å¾å€¼å¤§äº1æ—¶ï¼Œå°±å®¹æ˜“å¯¼è‡´è¿™ä¸ªç»´åº¦çš„å€¼çˆ†ç‚¸æ€§å¢é•¿ï¼›å½“ç‰¹å¾å€¼å°äº1æ—¶ï¼Œä¼šå°±ä¼šå¯¼è‡´è¿™ä¸ªç»´åº¦çš„å€¼æŒ‡æ•°çº§é€Ÿåº¦è¡°å‡ä¸º0ï¼</p>
<p>å‰å‘è¿‡ç¨‹å¦‚æ­¤ï¼Œè¯¯å·®åå‘ä¼ æ’­çš„è¿‡ç¨‹ä¹Ÿå¿…ç„¶è¿‘ä¼¼ä¸ºè¾“å‡ºå±‚çš„è¯¯å·®ä¼šä¹˜ä»¥$W^t$æ¥å¾—åˆ°å€’æ•°ç¬¬tå±‚çš„æ¢¯åº¦ï¼Œç„¶è€Œç”±äºåˆšå„ä¸ªç»´åº¦ä¸æ˜¯æŒ‡æ•°çº§è¡°å‡å°±æ˜¯æŒ‡æ•°çº§çˆ†ç‚¸ï¼Œå¾ˆå®¹æ˜“çœ‹å‡ºå½“æ›´æ–°RNNçš„é å‰çš„å±‚çš„æ—¶å€™ï¼ˆå³ç¦»ç€è¾“å‡ºå±‚è¾ƒè¿œçš„é‚£äº›å±‚ï¼Œæˆ–è€…è¯´ä¸åºåˆ—æœ«ç«¯ç¦»å¾—è¿œçš„ä½ç½®ï¼‰ï¼Œè®¡ç®—å‡ºçš„æ¢¯åº¦è¦ä¹ˆå¤§çš„å“äººï¼Œè¦ä¹ˆå°çš„å¿½ç•¥ã€‚å°çš„å¿½ç•¥çš„å€¼ä¸ä¼šå¯¹Wçš„æ›´æ–°æœ‰ä»»ä½•æŒ‡å¯¼ä½œç”¨ï¼Œå¤§çš„å“äººçš„å€¼ä¸€ä¸‹å­å°±æŠŠWä¸­çš„æŸäº›å€¼å¼„çš„å¤§çš„å“äººäº†ï¼Œå®³å¾—å‰é¢çš„ä¼˜åŒ–éƒ½ç™½åšäº†ã€‚</p>
<p>ä¸€ä¸ªå¾ˆç®€å•çš„æƒ³æ³•æ˜¯è¿›è¡Œ<strong>æ¢¯åº¦æˆªæ–­</strong>ï¼Œåœ¨ä¼˜åŒ–RNNçš„å‚æ•°çš„æ—¶å€™ï¼Œç»™æ¢¯åº¦å€¼è®¾ç½®ä¸€ä¸ªä¸Šé™ã€‚ä½†æ˜¯è¿™æ ·æ˜¾ç„¶å°±ä¼šå¯¼è‡´æ¨¡å‹éš¾ä»¥å†é¡¾åŠå¾ˆé å‰çš„å†å²ä¿¡æ¯äº†ï¼Œå› æ­¤ç†è®ºä¸ŠRNNå¯ä»¥ä¿å­˜ä»»æ„é•¿çš„å†å²ä¿¡æ¯æ¥è¾…åŠ©å½“å‰æ—¶é—´ç‚¹çš„å†³ç­–ï¼Œç„¶è€Œç”±äºåœ¨ä¼˜åŒ–æ—¶ï¼ˆè®­ç»ƒRNNæ—¶ï¼‰ï¼Œæ¢¯åº¦æ— æ³•å‡†ç¡®åˆç†çš„ä¼ åˆ°å¾ˆé å‰çš„æ—¶é—´ç‚¹ï¼Œå› æ­¤RNNå®é™…ä¸Šåªèƒ½è®°ä½å¹¶ä¸é•¿çš„åºåˆ—ä¿¡æ¯ï¼ˆåœ¨NLPä¸­ï¼Œç»éªŒä¸Šè®¤ä¸ºåºåˆ—å¤§äº30çš„æ—¶å€™ï¼ŒRNNåŸºæœ¬è®°ä¸ä½å¤šäº30çš„éƒ¨åˆ†ï¼Œè€Œä»å¤šäº10çš„ä½ç½®å¼€å§‹å°±å˜å¾—è®°æ€§å¾ˆå·®äº†ï¼‰ï¼Œå› æ­¤RNNç›¸æ¯”å‰é¦ˆç½‘ç»œï¼Œå¯ä»¥è®°ä½çš„å†å²ä¿¡æ¯è¦é•¿ä¸€äº›ï¼Œä½†æ˜¯æ— æ³•è®°ä½é•¿è·ç¦»çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚æ®µè½çº§çš„åºåˆ—ç”šè‡³ç¯‡ç« çº§çš„åºåˆ—ï¼Œç”¨RNNå°±é¸¡è‚‹äº†ï¼‰ã€‚</p>
<h4 id="LSTM"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h4><p>å› ä¸ºRNNå­˜åœ¨æ¢¯åº¦å¼¥æ•£å’Œæ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ï¼Œæ‰€ä»¥RNNå¾ˆéš¾å®Œç¾åœ°å¤„ç†å…·æœ‰é•¿æœŸä¾èµ–çš„ä¿¡æ¯ã€‚æ—¢ç„¶ä»…ä»…ä¾é ä¸€æ¡çº¿è¿æ¥åé¢çš„ç¥ç»å…ƒä¸è¶³ä»¥è§£å†³é—®é¢˜ï¼Œé‚£ä¹ˆå°±å†åŠ ä¸€æ¡çº¿å¥½äº†ï¼Œè¿™å°±æ˜¯LSTMã€‚</p>
<p>LSTMçš„å…³é”®åœ¨äºç»†èƒçš„çŠ¶æ€å’Œç©¿è¿‡ç»†èƒçš„çº¿ï¼Œç»†èƒçŠ¶æ€ç±»ä¼¼äºä¼ é€å¸¦ã€‚ç›´æ¥åœ¨æ•´ä¸ªé“¾ä¸Šè¿è¡Œï¼Œåªæœ‰ä¸€äº›å°‘é‡çš„çº¿æ€§äº¤äº’ã€‚ä¿¡æ¯åœ¨ä¸Šé¢æµåŠ¨ä¿æŒä¸å˜ä¼šå˜å¾—å®¹æ˜“ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/lstm_c.png" alt="avatar"></p>
<p>åœ¨LSTMä¸­ï¼Œé—¨å¯ä»¥å®ç°é€‰æ‹©æ€§çš„è®©ä¿¡æ¯é€šè¿‡ï¼Œä¸»è¦é€šè¿‡ä¸€ä¸ªsigmoidçš„ç¥ç»å±‚å’Œä¸€ä¸ªé€ç‚¹ç›¸ä¹˜çš„æ“ä½œæ¥å®ç°ã€‚LSTMé€šè¿‡ä¸‰ä¸ªè¿™æ ·çš„é—¨ç»“æ„æ¥å®ç°ä¿¡æ¯çš„ä¿æŠ¤å’Œæ§åˆ¶ï¼Œåˆ†åˆ«æ˜¯é—å¿˜é—¨ï¼ˆforget gateï¼‰ã€è¾“å…¥é—¨ï¼ˆinput gateï¼‰ä¸è¾“å‡ºé—¨ï¼ˆoutput gateï¼‰ã€‚</p>
<h5 id="é—å¿˜é—¨"><a href="#é—å¿˜é—¨" class="headerlink" title="é—å¿˜é—¨"></a><strong>é—å¿˜é—¨</strong></h5><p>åœ¨LSTMä¸­çš„ç¬¬ä¸€æ­¥æ˜¯å†³å®šä»ç»†èƒçŠ¶æ€ä¸­ä¸¢å¼ƒä»€ä¹ˆä¿¡æ¯ã€‚è¿™ä¸ªå†³å®šé€šè¿‡ä¸€ä¸ªç§°ä¸ºé—å¿˜é—¨çš„ç»“æ„æ¥å®Œæˆã€‚é—å¿˜é—¨ä¼šè¯»å–$h_{t-1}$å’Œ$x_t$ï¼Œè¾“å‡ºä¸€ä¸ª0åˆ°1ä¹‹é—´çš„æ•°å€¼ç»™ç»†èƒçš„çŠ¶æ€$c_{t-1}$ä¸­çš„æ•°å­—ã€‚1è¡¨ç¤ºå®Œå…¨ä¿ç•™ï¼Œ0è¡¨ç¤ºå®Œå…¨èˆå¼ƒã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/lstm_forget_gate.png" alt="avatar"></p>
<h5 id="è¾“å…¥é—¨"><a href="#è¾“å…¥é—¨" class="headerlink" title="è¾“å…¥é—¨"></a><strong>è¾“å…¥é—¨</strong></h5><p>é—å¿˜é—¨å†³å®šè®©å¤šå°‘æ–°çš„ä¿¡æ¯åŠ å…¥åˆ°cellçš„çŠ¶æ€ä¸­æ¥ã€‚å®ç°è¿™ä¸ªéœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><p>é¦–å…ˆä¸€ä¸ªå«â€œinput gate layerâ€çš„sigmoidå±‚å†³å®šå“ªäº›ä¿¡æ¯éœ€è¦æ›´æ–°ï¼›ä¸€ä¸ªtanhå±‚ç”Ÿæˆä¸€ä¸ªå‘é‡ï¼Œç”¨æ¥æ›´æ–°çŠ¶æ€Cã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/input_gate.png" alt="avatar"></p>
</li>
<li><p>æŠŠ 1 ä¸­çš„ä¸¤éƒ¨åˆ†è”åˆèµ·æ¥ï¼Œå¯¹cellçš„çŠ¶æ€è¿›è¡Œæ›´æ–°ï¼Œæˆ‘ä»¬æŠŠæ—§çš„çŠ¶æ€ä¸$f_t$ç›¸ä¹˜ï¼Œä¸¢å¼ƒæ‰æˆ‘ä»¬ç¡®å®šéœ€è¦ä¸¢å¼ƒçš„ä¿¡æ¯ï¼Œæ¥ç€åŠ ä¸Š$i_t * \tilde{C}_{t}$</p>
</li>
</ol>
<h5 id="è¾“å‡ºé—¨"><a href="#è¾“å‡ºé—¨" class="headerlink" title="è¾“å‡ºé—¨"></a>è¾“å‡ºé—¨</h5><p>æœ€ç»ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šè¾“å‡ºä»€ä¹ˆå€¼ï¼Œè¿™ä¸ªè¾“å‡ºå°†ä¼šåŸºäºæˆ‘ä»¬çš„ç»†èƒçš„çŠ¶æ€ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸€ä¸ªè¿‡æ»¤åçš„ç‰ˆæœ¬ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªsigmoidå±‚æ¥ç¡®å®šç»†èƒçŠ¶æ€çš„å“ªäº›éƒ¨åˆ†å°†è¾“å‡ºå‡ºå»ã€‚æ¥ç€ï¼Œæˆ‘ä»¬æŠŠç»†èƒçŠ¶æ€é€šè¿‡tanhè¿›è¡Œå¤„ç†ï¼ˆå¾—åˆ°ä¸€ä¸ª-1åˆ°1ä¹‹é—´çš„å€¼ï¼‰å¹¶å°†å®ƒå’Œsigmoidé—¨çš„è¾“å‡ºç›¸ä¹˜ï¼Œæœ€ç»ˆæˆ‘ä»¬ä»…ä»…ä¼šè¾“å‡ºæˆ‘ä»¬ç¡®å®šè¾“å‡ºçš„éƒ¨åˆ†ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/output_gate.png" alt="avatar"></p>
<h5 id="å…¬å¼"><a href="#å…¬å¼" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h5><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/lstm_all.png" alt="avatar"></p>
<h4 id="GRU"><a href="#GRU" class="headerlink" title="GRU"></a>GRU</h4><p>åœ¨LSTMä¸­å¼•å…¥äº†ä¸‰ä¸ªé—¨å‡½æ•°ï¼šè¾“å…¥é—¨ã€é—å¿˜é—¨å’Œè¾“å‡ºé—¨æ¥æ§åˆ¶è¾“å…¥å€¼ã€è®°å¿†å€¼å’Œè¾“å‡ºå€¼ã€‚è€Œåœ¨GRUæ¨¡å‹ä¸­åªæœ‰ä¸¤ä¸ªé—¨ï¼šåˆ†åˆ«æ˜¯æ›´æ–°é—¨å’Œé‡ç½®é—¨ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/GRU.png" alt="avatar"></p>
<p>å›¾ä¸­çš„$z_t$å’Œ$r_t$åˆ†åˆ«è¡¨ç¤ºæ›´æ–°é—¨å’Œé‡ç½®é—¨ã€‚æ›´æ–°é—¨ç”¨äºæ§åˆ¶å‰ä¸€æ—¶åˆ»çš„çŠ¶æ€ä¿¡æ¯è¢«å¸¦å…¥åˆ°å½“å‰çŠ¶æ€ä¸­çš„ç¨‹åº¦ï¼Œæ›´æ–°é—¨çš„å€¼è¶Šå¤§è¯´æ˜å‰ä¸€æ—¶åˆ»çš„çŠ¶æ€ä¿¡æ¯å¸¦å…¥è¶Šå¤šã€‚é‡ç½®é—¨æ§åˆ¶å‰ä¸€çŠ¶æ€æœ‰å¤šå°‘ä¿¡æ¯è¢«å†™å…¥åˆ°å½“å‰çš„å€™é€‰é›† $\tilde{h}_{t}$ä¸Šï¼Œé‡ç½®é—¨è¶Šå°ï¼Œå‰ä¸€çŠ¶æ€çš„ä¿¡æ¯è¢«å†™å…¥çš„è¶Šå°‘ã€‚</p>
<p>LSTMå’ŒGRUéƒ½æ˜¯é€šè¿‡å„ç§é—¨å‡½æ•°æ¥å°†é‡è¦ç‰¹å¾ä¿ç•™ä¸‹æ¥ï¼Œè¿™æ ·å°±ä¿è¯äº†åœ¨long-termä¼ æ’­çš„æ—¶å€™ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚æ­¤å¤–GRUç›¸å¯¹äºLSTMå°‘äº†ä¸€ä¸ªé—¨å‡½æ•°ï¼Œå› æ­¤åœ¨å‚æ•°çš„æ•°é‡ä¸Šä¹Ÿæ˜¯è¦å°‘äºLSTMçš„ï¼Œæ‰€ä»¥æ•´ä½“ä¸ŠGRUçš„è®­ç»ƒé€Ÿåº¦è¦å¿«äºLSTMçš„ã€‚</p>
<h3 id="Self-Attention"><a href="#Self-Attention" class="headerlink" title="Self-Attention"></a>Self-Attention</h3><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention.png" alt="avatar"></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåœ¨decodingé˜¶æ®µå¯¹inputä¸­çš„ä¿¡æ¯èµ‹äºˆä¸åŒæƒé‡ã€‚</p>
<ol>
<li>Encodeæ‰€æœ‰è¾“å…¥åºåˆ—,å¾—åˆ°å¯¹åº”çš„$h_1,h_2, \cdots ,h_T$(Tä¸ºè¾“å…¥åºåˆ—é•¿åº¦)</li>
<li>Decodeè¾“å‡ºç›®æ ‡$y_t$ä¹‹å‰ï¼Œä¼šå°†ä¸Šä¸€æ­¥è¾“å‡ºçš„éšè—çŠ¶æ€$S_{t-1}$ä¸ä¹‹å‰encodeå¥½çš„$h_1,h_2,\cdots,h_T$è¿›è¡Œæ¯”å¯¹ï¼Œè®¡ç®—ç›¸ä¼¼åº¦ï¼ˆ$e_{t,j}=a(s_{t-1},h_j)$ï¼‰,$h_j$ä¸ºä¹‹å‰ç¬¬jä¸ªè¾“å…¥encodeå¾—åˆ°çš„éšè—å‘é‡ï¼Œaä¸ºä»»æ„ä¸€ç§è®¡ç®—ç›¸ä¼¼åº¦çš„æ–¹å¼</li>
<li>ç„¶åé€šè¿‡softmaxï¼Œå³$a_{t,j}=\frac{exp(e_{t,j})}{\sum^{T_x}_{k=1}exp(e_{t,k})}$å°†ä¹‹å‰å¾—åˆ°çš„å„ä¸ªéƒ¨åˆ†çš„ç›¸å…³ç³»æ•°è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¾—åˆ°$a_{t,1},a_{t,2},\cdots,a_{t,T}$</li>
<li>åœ¨å¯¹è¾“å…¥åºåˆ—çš„éšè—å±‚è¿›è¡Œç›¸å…³æ€§åŠ æƒæ±‚å’Œå¾—åˆ°æ­¤æ—¶decodeéœ€è¦çš„context vector ï¼š$c_j=\sum^{T_x}_{j=1}a_{i,j}h_j$</li>
</ol>
<h3 id="è¯å‘é‡æ¨¡å‹"><a href="#è¯å‘é‡æ¨¡å‹" class="headerlink" title="è¯å‘é‡æ¨¡å‹"></a>è¯å‘é‡æ¨¡å‹</h3><p>onehotç¼–ç æ–¹å¼çš„ç¼ºç‚¹ï¼š</p>
<ol>
<li>å®ƒæ˜¯ä¸€ä¸ªè¯è¢‹æ¨¡å‹ï¼Œä¸è€ƒè™‘è¯ä¸è¯ä¹‹é—´çš„é¡ºåºï¼ˆæ–‡æœ¬ä¸­è¯çš„é¡ºåºä¿¡æ¯ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼‰</li>
<li>å®ƒå‡è®¾è¯ä¸è¯ç›¸äº’ç‹¬ç«‹ï¼ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯ä¸è¯æ˜¯ç›¸äº’å½±å“çš„ï¼‰</li>
<li>å®ƒå¾—åˆ°çš„ç‰¹å¾æ˜¯ç¦»æ•£ç¨€ç–çš„ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œé¢ä¸´ç€å·¨å¤§çš„ç»´åº¦ç¾éš¾é—®é¢˜</li>
</ol>
<p>å°†é«˜ç»´è¯å‘é‡åµŒå…¥åˆ°ä¸€ä¸ªä½ç»´ç©ºé—´ã€‚word2vecæ˜¯è¯åµŒå…¥æ–¹å¼çš„ä¸€ç§ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/word_embedding.png" alt="avatar"></p>
<p>ä¸»è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>ä¸€ä¸ªæ˜¯ç»Ÿè®¡è¯­è¨€æ¨¡å‹é‡Œå…³æ³¨çš„æ¡ä»¶æ¦‚ç‡$ğ‘(ğ‘¤ğ‘¡|ğ‘ğ‘œğ‘›ğ‘¡ğ‘’ğ‘¥ğ‘¡)$çš„è®¡ç®—</li>
<li>ä¸€ä¸ªæ˜¯å‘é‡ç©ºé—´æ¨¡å‹é‡Œå…³æ³¨çš„è¯å‘é‡çš„è¡¨è¾¾</li>
</ol>
<h4 id="word2vec"><a href="#word2vec" class="headerlink" title="word2vec"></a>word2vec</h4><h5 id="CBoWæ¨¡å‹"><a href="#CBoWæ¨¡å‹" class="headerlink" title="CBoWæ¨¡å‹"></a><strong>CBoWæ¨¡å‹</strong></h5><p>CBOWæ˜¯å·²çŸ¥ä¸Šä¸‹æ–‡ï¼Œä¼°ç®—å½“å‰è¯è¯­çš„è¯­è¨€æ¨¡å‹ã€‚å…¶å­¦ä¹ ç›®æ ‡æ˜¯æœ€å¤§åŒ–å¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼š</p>
<script type="math/tex; mode=display">
\mathcal{L}=\sum_{w \in \mathcal{C}} \log p(w | \text {Context}(w))</script><p>å…¶ä¸­ï¼Œwè¡¨ç¤ºè¯­æ–™åº“Cä¸­ä»»æ„ä¸€ä¸ªè¯ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/CBOW.png" alt="avatar"></p>
<ol>
<li><strong>è¾“å…¥å±‚</strong>æ˜¯ä¸Šä¸‹æ–‡çš„è¯è¯­çš„è¯å‘é‡ï¼ˆåœ¨è®­ç»ƒCBOWæ¨¡å‹ï¼Œè¯å‘é‡åªæ˜¯ä¸ªå‰¯äº§å“ï¼Œç¡®åˆ‡æ¥è¯´ï¼Œæ˜¯CBOWæ¨¡å‹çš„ä¸€ä¸ªå‚æ•°ã€‚è®­ç»ƒå¼€å§‹çš„æ—¶å€™ï¼Œè¯å‘é‡æ˜¯ä¸ªéšæœºå€¼ï¼Œéšç€è®­ç»ƒçš„è¿›è¡Œä¸æ–­è¢«æ›´æ–°ï¼‰ã€‚</li>
<li><strong>æŠ•å½±å±‚</strong>å¯¹å…¶æ±‚å’Œï¼Œæ‰€è°“æ±‚å’Œï¼Œå°±æ˜¯ç®€å•çš„å‘é‡åŠ æ³•ã€‚</li>
<li><strong>è¾“å‡ºå±‚</strong>è¾“å‡ºæœ€å¯èƒ½çš„wã€‚ç”±äºè¯­æ–™åº“ä¸­è¯æ±‡é‡æ˜¯å›ºå®šçš„|C|ä¸ªï¼Œæ‰€ä»¥ä¸Šè¿°è¿‡ç¨‹å…¶å®å¯ä»¥çœ‹åšä¸€ä¸ªå¤šåˆ†ç±»é—®é¢˜ã€‚ç»™å®šç‰¹å¾ï¼Œä»|C|ä¸ªåˆ†ç±»ä¸­æŒ‘ä¸€ä¸ªã€‚</li>
</ol>
<p>å¯¹äºç¥ç»ç½‘ç»œæ¨¡å‹å¤šåˆ†ç±»ï¼Œæœ€æœ´ç´ çš„åšæ³•æ˜¯softmaxå›å½’ï¼š</p>
<script type="math/tex; mode=display">
h_{\theta}\left(x^{(i)}\right)=\left[\begin{array}{c}
p\left(y^{(i)}=1 | x^{(i)} ; \theta\right) \\
p\left(y^{(i)}=2 | x^{(i)} ; \theta\right) \\
\vdots \\
p\left(y^{(i)}=k | x^{(i)} ; \theta\right)
\end{array}\right]=\frac{1}{\sum_{j=1}^{k} e^{\theta_{j}^{T} x^{(i)}}}\left[\begin{array}{c}
e^{\theta_{1}^{T} x^{(i)}} \\
e^{\theta_{2}^{T} x^{(i)}} \\
\vdots \\
e^{\theta_{k}^{T} x^{(i)}}
\end{array}\right]</script><h5 id="skip-gramæ¨¡å‹"><a href="#skip-gramæ¨¡å‹" class="headerlink" title="skip-gramæ¨¡å‹"></a>skip-gramæ¨¡å‹</h5><p><strong>target wordå¯¹contextçš„é¢„æµ‹ä¸­å­¦ä¹ word vector</strong></p>
<script type="math/tex; mode=display">
p(\text {Context}(w) | w)=\prod_{u \in \text {Context}(w)} p(u | w)</script><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/skipgram.png" alt="avatar"></p>
<p>å¦‚ä½•å°†Skip-gramæ¨¡å‹çš„å‰å‘è®¡ç®—è¿‡ç¨‹å†™æˆæ•°å­¦å½¢å¼ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š</p>
<script type="math/tex; mode=display">
p\left(w_{o} | w_{i}\right)=\frac{e^{U_{o} \cdot V_{i}}}{\sum_{j} e^{U_{j} V_{i}}}</script><p>å…¶ä¸­ï¼Œå…¶ä¸­ï¼Œ$V_i$æ˜¯Embeddingå±‚çŸ©é˜µé‡Œçš„åˆ—å‘é‡ï¼Œä¹Ÿè¢«ç§°ä¸º$w_i$çš„input vectorã€‚$U_j$æ˜¯softmaxå±‚çŸ©é˜µé‡Œçš„è¡Œå‘é‡ï¼Œä¹Ÿè¢«ç§°ä¸º$w_i$çš„output vectorã€‚å› æ­¤ï¼ŒSkip-gramæ¨¡å‹çš„æœ¬è´¨æ˜¯<strong>è®¡ç®—è¾“å…¥wordçš„input vectorä¸ç›®æ ‡wordçš„output vectorä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œå¹¶è¿›è¡Œsoftmaxå½’ä¸€åŒ–</strong>ã€‚æˆ‘ä»¬è¦å­¦ä¹ çš„æ¨¡å‹å‚æ•°æ­£æ˜¯è¿™ä¸¤ç±»è¯å‘é‡ã€‚</p>
<p>ç„¶è€Œï¼Œç›´æ¥å¯¹è¯å…¸é‡Œçš„Vä¸ªè¯è®¡ç®—ç›¸ä¼¼åº¦å¹¶å½’ä¸€åŒ–ï¼Œæ˜¾ç„¶æ˜¯ä¸€ä»¶æå…¶è€—æ—¶çš„impossible missionã€‚å¼•å…¥äº†ä¸¤ç§ä¼˜åŒ–ç®—æ³•ï¼š<strong>å±‚æ¬¡Softmaxï¼ˆHierarchical Softmaxï¼‰</strong>å’Œ<strong>è´Ÿé‡‡æ ·ï¼ˆNegative Samplingï¼‰</strong>ã€‚</p>
<h5 id="Hierarchical-Softmax"><a href="#Hierarchical-Softmax" class="headerlink" title="Hierarchical Softmax"></a>Hierarchical Softmax</h5><p>softmaxå›å½’éœ€è¦å¯¹è¯­æ–™åº“ä¸­æ¯ä¸ªè¯è¯­ï¼ˆç±»ï¼‰éƒ½è®¡ç®—ä¸€éè¾“å‡ºæ¦‚ç‡å¹¶è¿›è¡Œå½’ä¸€åŒ–ï¼Œåœ¨å‡ åä¸‡è¯æ±‡é‡çš„è¯­æ–™ä¸Šæ— ç–‘æ˜¯ä»¤äººå¤´ç–¼çš„ã€‚åœ¨SVMä¸­çš„å¤šåˆ†ç±»ï¼Œå…¶å¤šåˆ†ç±»æ˜¯ç”±äºŒåˆ†ç±»ç»„åˆè€Œæ¥çš„ï¼š</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/svm_hierarchical.gif" alt="avatar"></p>
<p>è¿™æ˜¯ä¸€ç§äºŒå‰æ ‘ç»“æ„ï¼Œåº”ç”¨åˆ°word2vecä¸­è¢«ä½œè€…ç§°ä¸ºHierarchical Softmaxï¼š</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/cbow_hierarchical.jpg" alt="avatar"></p>
<p>ä¸Šå›¾è¾“å‡ºå±‚çš„æ ‘å½¢ç»“æ„å³ä¸ºHierarchical Softmaxã€‚éå¶å­èŠ‚ç‚¹ç›¸å½“äºä¸€ä¸ªç¥ç»å…ƒï¼ˆæ„ŸçŸ¥æœºï¼Œé€»è¾‘æ–¯è°›å›å½’å°±æ˜¯æ„ŸçŸ¥æœºçš„è¾“å‡ºä»£å…¥$f(x)=\frac{1}{1+e^x}$ï¼ŒäºŒåˆ†ç±»å†³ç­–è¾“å‡º1æˆ–0ï¼Œåˆ†åˆ«ä»£è¡¨å‘ä¸‹å·¦è½¬æˆ–å‘ä¸‹å³è½¬ï¼›æ¯ä¸ªå¶å­èŠ‚ç‚¹ä»£è¡¨è¯­æ–™åº“ä¸­çš„ä¸€ä¸ªè¯è¯­ï¼Œäºæ˜¯æ¯ä¸ªè¯è¯­éƒ½å¯ä»¥è¢«01å”¯ä¸€åœ°ç¼–ç ï¼Œå¹¶ä¸”å…¶ç¼–ç åºåˆ—å¯¹åº”ä¸€ä¸ªäº‹ä»¶åºåˆ—ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥è®¡ç®—æ¡ä»¶æ¦‚ç‡$p(w|Context(x))$ã€‚</p>
<p>åœ¨å¼€å§‹è®¡ç®—ä¹‹å‰ï¼Œè¿˜æ˜¯å¾—å¼•å…¥ä¸€äº›ç¬¦å·ï¼š</p>
<ol>
<li>$p^w$ä»æ ¹ç»“ç‚¹å‡ºå‘åˆ°è¾¾wå¯¹åº”å¶å­ç»“ç‚¹çš„è·¯å¾„.</li>
<li>$l^w$è·¯å¾„ä¸­åŒ…å«ç»“ç‚¹çš„ä¸ªæ•°</li>
<li>$p^w_1,p^w_2,\cdots,p^w_{l^w}$è·¯å¾„$p^w$ä¸­çš„å„ä¸ªèŠ‚ç‚¹</li>
<li>$d^w_2,d^w_3,\cdots,d^w_{l^w} \in {0,1}$è¯wçš„ç¼–ç ï¼Œ$d^w_j$è¡¨ç¤ºè·¯å¾„$p^w$ç¬¬jä¸ªèŠ‚ç‚¹å¯¹åº”çš„ç¼–ç ï¼ˆæ ¹èŠ‚ç‚¹æ— ç¼–ç ï¼‰</li>
<li>$\theta^w_1,\theta^w_2,\cdots,\theta^w_{l^w-1} \in R^m$è·¯å¾„$p^w$ä¸­éå¶èŠ‚ç‚¹å¯¹åº”çš„å‚æ•°å‘é‡</li>
</ol>
<p>äºæ˜¯å¯ä»¥ç»™å‡º$w$çš„æ¡ä»¶æ¦‚ç‡ï¼š</p>
<script type="math/tex; mode=display">
p(w | \text { Context }(w))=\prod_{j=2}^{l^{w}} p\left(d_{j}^{w} | \mathbf{x}_{w}, \theta_{j-1}^{w}\right)</script><p>è¿™æ˜¯ä¸ªç®€å•æ˜äº†çš„å¼å­ï¼Œä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹ç»è¿‡äº†$l^w-1$ä¸ªèŠ‚ç‚¹ï¼Œç¼–ç ä»ä¸‹æ ‡2å¼€å§‹ï¼ˆæ ¹èŠ‚ç‚¹æ— ç¼–ç ï¼‰ï¼Œå¯¹åº”çš„å‚æ•°å‘é‡ä¸‹æ ‡ä»1å¼€å§‹ï¼ˆæ ¹èŠ‚ç‚¹ä¸º1ï¼‰ã€‚å…¶ä¸­ï¼Œæ¯ä¸€é¡¹æ˜¯ä¸€ä¸ªé€»è¾‘æ–¯è°›å›å½’ï¼š</p>
<script type="math/tex; mode=display">
p\left(d_{j}^{w} | \mathbf{x}_{w}, \theta_{j-1}^{w}\right)=\left\{\begin{array}{ll}
\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right), & d_{j}^{w}=0 \\
1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right), & d_{j}^{w}=1
\end{array}\right.</script><p>è€ƒè™‘åˆ°dåªæœ‰0å’Œ1ä¸¤ç§å–å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æŒ‡æ•°å½¢å¼æ–¹ä¾¿åœ°å°†å…¶å†™åˆ°ä¸€èµ·ï¼š</p>
<script type="math/tex; mode=display">
p\left(d_{j}^{w} | \mathbf{x}_{w}, \theta_{j-1}^{w}\right)=\left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]^{1-d^w_{j}} \cdot\left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]^{d^w_{j}}</script><p>æˆ‘ä»¬çš„ç›®æ ‡å‡½æ•°å–å¯¹æ•°ä¼¼ç„¶ï¼š</p>
<script type="math/tex; mode=display">
\mathcal{L}=\sum_{w \in \mathcal{C}} \log p(w | \text { Context }(w))</script><p>å°†$p(w|Context(w))$ä»£å…¥ä¸Šå¼ï¼Œæœ‰</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathcal{L} &=\sum_{w \in \mathcal{C}} \log \prod_{j=2}^{l^{w}}\left\{\left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]^{1-d_{j}^{v}} \cdot\left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]^{d_{j}}\right\} \\
&=\sum_{w \in \mathcal{C}} \sum_{j=2}^{l^{w}}\left\{\left(1-d_{j}^{w}\right) \cdot \log \left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]+d_{j}^{w} \cdot \log \left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]\right\}
\end{aligned}</script><p>è¿™ä¹Ÿå¾ˆç›´ç™½ï¼Œè¿ä¹˜çš„å¯¹æ•°æ¢æˆæ±‚å’Œã€‚ä¸è¿‡è¿˜æ˜¯æœ‰ç‚¹é•¿ï¼Œæˆ‘ä»¬æŠŠæ¯ä¸€é¡¹ç®€è®°ä¸ºï¼š</p>
<script type="math/tex; mode=display">
\mathcal{L}(w, j)=\left(1-d_{j}^{w}\right) \cdot \log \left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]+d_{j}^{w} \cdot \log \left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]</script><p>æ€ä¹ˆæœ€å¤§åŒ–å¯¹æ•°ä¼¼ç„¶å‡½æ•°å‘¢ï¼Ÿåˆ†åˆ«æœ€å¤§åŒ–æ¯ä¸€é¡¹å³å¯ï¼ˆè¿™åº”è¯¥æ˜¯ä¸€ç§è¿‘ä¼¼ï¼Œæœ€å¤§åŒ–æŸä¸€é¡¹ä¸ä¸€å®šä½¿æ•´ä½“å¢å¤§ï¼Œå…·ä½“æ”¶æ•›çš„è¯æ˜è¿˜ä¸æ¸…æ¥šï¼‰ã€‚æ€ä¹ˆæœ€å¤§åŒ–æ¯ä¸€é¡¹å‘¢ï¼Ÿå…ˆæ±‚å‡½æ•°å¯¹æ¯ä¸ªå˜é‡çš„åå¯¼æ•°ï¼Œå¯¹æ¯ä¸€ä¸ªæ ·æœ¬ï¼Œä»£å…¥åå¯¼æ•°è¡¨è¾¾å¼å¾—åˆ°å‡½æ•°åœ¨è¯¥ç»´åº¦çš„å¢é•¿æ¢¯åº¦ï¼Œç„¶åè®©å¯¹åº”å‚æ•°åŠ ä¸Šè¿™ä¸ªæ¢¯åº¦ï¼Œå‡½æ•°åœ¨è¿™ä¸ªç»´åº¦ä¸Šå°±å¢é•¿äº†ã€‚</p>
<p>æ¯ä¸€é¡¹æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„å‚æ•°å‘é‡$\theta^w_{j-1}$ï¼Œå¦ä¸€ä¸ªæ˜¯è¾“å‡ºå±‚çš„è¾“å…¥$X_w$ï¼Œæˆ‘ä»¬åˆ†åˆ«å¯¹å…¶æ±‚åå¯¼æ•°ï¼š</p>
<script type="math/tex; mode=display">
\frac{\partial \mathcal{L}(w, j)}{\partial \theta_{j-1}^{w}}=\frac{\partial}{\partial \theta_{j-1}^{w}}\left\{\left(1-d_{j}^{w}\right) \cdot \log \left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]+d_{j}^{w} \cdot \log \left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]\right\}</script><p>å› ä¸ºsigmoidå‡½æ•°çš„å¯¼æ•°æœ‰ä¸ªå¾ˆæ£’çš„å½¢å¼ï¼š</p>
<script type="math/tex; mode=display">
\sigma^{\prime}(x)=\sigma(x)[1-\sigma(x)]</script><p>äºæ˜¯ä»£å…¥ä¸Šä¸Šå¼å¾—åˆ°ï¼š</p>
<script type="math/tex; mode=display">
\left(1-d_{j}^{w}\right)\left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right] \mathbf{x}_{w}-d_{j}^{w} \sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right) \mathbf{x}_{w}</script><p>åˆå¹¶åŒç±»é¡¹å¾—åˆ°ï¼š</p>
<script type="math/tex; mode=display">
\left[1-d_{j}^{w}-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right] \mathbf{x}_{w}</script><p>äºæ˜¯$\theta^w_{j-1}$çš„æ›´æ–°è¡¨è¾¾å¼å°±å¾—åˆ°äº†ï¼š</p>
<script type="math/tex; mode=display">
\theta_{j-1}^{w}:=\theta_{j-1}^{w}+\eta\left[1-d_{j}^{w}-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right] \mathbf{x}_{w}</script><p>å†æ¥$X_w$çš„åå¯¼æ•°ï¼Œæ³¨æ„åˆ°$\mathcal{L}(w, j)=\left(1-d_{j}^{w}\right) \cdot \log \left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]+d_{j}^{w} \cdot \log \left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]$ä¸­$X_w$å’Œ$\theta^w_{j-1}$æ˜¯å¯¹ç§°çš„ï¼Œæ‰€æœ‰ç›´æ¥å°†$\theta^w_{j-1}$çš„åå¯¼æ•°ä¸­çš„$\theta^w_{j-1}$æ›¿æ¢ä¸º$X_w$ï¼Œå¾—åˆ°å…³äº$X_w$çš„åå¯¼æ•°ï¼š</p>
<script type="math/tex; mode=display">
\frac{\partial \mathcal{L}(w, j)}{\partial \mathbf{x}_{w}}=\left[1-d_{j}^{w}-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right] \theta_{j-1}^{w}</script><p>ä¸è¿‡$X_w$æ˜¯ä¸Šä¸‹æ–‡çš„è¯å‘é‡çš„å’Œï¼Œä¸æ˜¯ä¸Šä¸‹æ–‡å•ä¸ªè¯çš„è¯å‘é‡ã€‚æ€ä¹ˆæŠŠè¿™ä¸ªæ›´æ–°é‡åº”ç”¨åˆ°å•ä¸ªè¯çš„è¯å‘é‡ä¸Šå»å‘¢ï¼Ÿword2vecé‡‡å–çš„æ˜¯ç›´æ¥å°†$X_w$çš„æ›´æ–°é‡æ•´ä¸ªåº”ç”¨åˆ°æ¯ä¸ªå•è¯çš„è¯å‘é‡ä¸Šå»ï¼š</p>
<script type="math/tex; mode=display">
\mathbf{v}(\tilde{w}):=\mathbf{v}(\tilde{w})+\eta \sum_{j=2}^{l^{w}} \frac{\partial \mathcal{L}(w, j)}{\partial \mathbf{x}_{w}}, \quad \tilde{w} \in \text { Context }(w)</script><p>å…¶ä¸­ï¼Œ$V(\tilde w)$ä»£è¡¨ä¸Šä¸‹æ–‡ä¸­æŸä¸€ä¸ªå•è¯çš„è¯å‘é‡ã€‚</p>
<h4 id="glove"><a href="#glove" class="headerlink" title="glove"></a>glove</h4><p>CBOWå’Œskip-gramè™½ç„¶å¯ä»¥å¾ˆå¥½åœ°è¿›è¡Œè¯æ±‡ç±»æ¯”ï¼Œä½†æ˜¯å› ä¸ºè¿™ä¸¤ç§æ–¹æ³•æ˜¯åŸºäºä¸€ä¸ªä¸ªå±€éƒ¨çš„ä¸Šä¸‹æ–‡çª—å£æ–¹æ³•ï¼Œå› æ­¤ï¼Œæ²¡æœ‰æœ‰æ•ˆåœ°åˆ©ç”¨å…¨å±€çš„è¯æ±‡å…±ç°ç»Ÿè®¡ä¿¡æ¯ã€‚ä¸ºäº†å…‹æœå…¨å±€çŸ©é˜µåˆ†è§£å’Œå±€éƒ¨ä¸Šä¸‹æ–‡çª—å£çš„ç¼ºé™·ï¼ŒGloVeæ–¹æ³•åŸºäºå…¨å±€è¯æ±‡å…±ç°çš„ç»Ÿè®¡ä¿¡æ¯æ¥å­¦ä¹ è¯å‘é‡ï¼Œä»è€Œå°†ç»Ÿè®¡ä¿¡æ¯ä¸å±€éƒ¨ä¸Šä¸‹æ–‡çª—å£æ–¹æ³•çš„ä¼˜ç‚¹éƒ½ç»“åˆèµ·æ¥ï¼Œå¹¶å‘ç°å…¶æ•ˆæœç¡®å®å¾—åˆ°äº†æå‡ã€‚</p>
<h5 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h5><p>å‡è®¾i=ice,j=steamå¹¶å¯¹kå–ä¸åŒçš„è¯æ±‡ï¼Œå¦‚â€œsolidâ€ï¼Œâ€œgasâ€ï¼Œâ€œwaterâ€ï¼Œâ€œfashionâ€ï¼Œæ ¹æ®ä¸Šé¢çš„å®šä¹‰ï¼Œæˆ‘ä»¬åˆ†åˆ«è®¡ç®—ä»–ä»¬çš„æ¦‚ç‡$P(kâˆ£ice)$ã€$P(kâˆ£steam)$ï¼Œå¹¶è®¡ç®—ä¸¤è€…çš„æ¯”ç‡$P(kâˆ£ice)/P(kâˆ£steam)$ï¼Œå¯ä»¥å‘ç°ï¼Œå¯¹äºâ€œsolidâ€ï¼Œå…¶å‡ºç°åœ¨â€œiceâ€ä¸Šä¸‹æ–‡çš„æ¦‚ç‡åº”è¯¥æ¯”è¾ƒå¤§ï¼Œå‡ºç°åœ¨â€œsteamâ€ä¸Šä¸‹æ–‡çš„æ¦‚ç‡åº”è¯¥æ¯”è¾ƒå°ï¼Œå› æ­¤ï¼Œä»–ä»¬çš„æ¯”å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ•°ï¼Œåœ¨ä¸‹è¡¨ä¸­æ˜¯8.9ï¼Œè€Œå¯¹äºâ€œgasâ€ï¼Œå‡ºç°åœ¨â€œiceâ€ä¸Šä¸‹æ–‡çš„æ¦‚ç‡åº”è¯¥æ¯”è¾ƒå°ï¼Œè€Œå‡ºç°åœ¨â€œsteamâ€ä¸Šä¸‹æ–‡çš„æ¦‚ç‡åº”è¯¥æ¯”è¾ƒå¤§ï¼Œå› æ­¤ï¼Œä¸¤è€…çš„æ¯”å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°ï¼Œåœ¨ä¸‹è¡¨ä¸­æ˜¯$8.5Ã—10^{-2}$ ï¼Œè€Œå¯¹äºâ€œwaterã€fashionâ€è¿™ä¸¤ä¸ªè¯æ±‡ï¼Œä»–ä»¬ä¸â€œiceâ€å’Œsteamâ€œçš„ç›¸å…³æ€§åº”è¯¥æ¯”è¾ƒå°ï¼Œå› æ­¤ï¼Œä»–ä»¬çš„æ¯”å€¼åº”è¯¥éƒ½æ˜¯æ¥è¿‘1ã€‚å› æ­¤ï¼Œè¿™æ ·æ¥çœ‹å¯ä»¥å‘ç°ï¼Œæ¯”å€¼$P(kâˆ£ice)/P(kâˆ£steam)$åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥åæ˜ è¯æ±‡ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œå½“ç›¸å…³æ€§æ¯”è¾ƒä½æ—¶ï¼Œå…¶å€¼åº”è¯¥åœ¨1é™„è¿‘ï¼Œå½“ç›¸å…³æ€§æ¯”è¾ƒé«˜æ—¶ï¼Œæ¯”å€¼åº”è¯¥åç¦»1æ¯”è¾ƒè¿œã€‚<br><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/glove.png" alt="avatar"></p>
<h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>åŸºäºè¿™æ ·çš„æ€æƒ³ï¼Œä½œè€…æå‡ºäº†è¿™æ ·ä¸€ç§çŒœæƒ³ï¼Œèƒ½ä¸èƒ½é€šè¿‡è®­ç»ƒè¯å‘é‡ï¼Œä½¿å¾—è¯å‘é‡ç»è¿‡æŸç§å‡½æ•°è®¡ç®—ä¹‹åå¯ä»¥å¾—åˆ°ä¸Šé¢çš„æ¯”å€¼ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
F\left(w_{i}, w_{j}, \tilde{w}_{k}\right)=\frac{P_{i k}}{P_{j k}}</script><p>å…¶ä¸­ï¼Œ$w_i$,$w_j$,$\tilde{w}_{k}$ ä¸ºè¯æ±‡i,j,kå¯¹åº”çš„è¯å‘é‡ï¼Œå…¶ç»´åº¦éƒ½ä¸ºdï¼Œè€Œ$P_{ik}$ï¼Œ$P_{jk}$ åˆ™å¯ä»¥ç›´æ¥é€šè¿‡è¯­æ–™è®¡ç®—å¾—åˆ°ï¼Œè¿™é‡ŒFä¸ºä¸€ä¸ªæœªçŸ¥çš„å‡½æ•°ã€‚ç”±äºè¯å‘é‡éƒ½æ˜¯åœ¨ä¸€ä¸ªçº¿æ€§å‘é‡ç©ºé—´ï¼Œå› æ­¤ï¼Œå¯ä»¥å¯¹$w_i$,$w_j$è¿›è¡Œå·®åˆ†ï¼Œå°†ä¸Šå¼è½¬å˜ä¸ºå¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
F\left(w_{i}-w_{j}, \tilde{w}_{k}\right)=\frac{P_{i k}}{P_{j k}}</script><p>ç”±äºä¸Šå¼ä¸­å·¦ä¾§æ‹¬å·ä¸­æ˜¯ä¸¤ä¸ªç»´åº¦ä¸ºdçš„è¯å‘é‡ï¼Œè€Œå³ä¾§æ˜¯ä¸€ä¸ªæ ‡é‡ï¼Œå› æ­¤ï¼Œå¾ˆå®¹æ˜“ä¼šæƒ³åˆ°å‘é‡çš„å†…ç§¯ï¼Œå› æ­¤ï¼Œä¸Šå¼å¯ä»¥è¿›ä¸€æ­¥æ”¹å˜ä¸º:</p>
<script type="math/tex; mode=display">
F\left(\left(w_{i}-w_{j}\right)^{T} \tilde{w}_{k}\right)=F\left(w_{i}^{T} w_{k}-w_{j}^{T} w_{k}\right)=\frac{P_{i k}}{P_{j k}}</script><p>ç”±äºä¸Šå¼ä¸­å·¦ä¾§æ˜¯ä¸€ç§å‡æ³•ï¼Œè€Œå³ä¾§æ˜¯ä¸€ç§é™¤æ³•ï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°æŒ‡æ•°è®¡ç®—ï¼Œå› æ­¤ï¼Œå¯ä»¥æŠŠFé™å®šä¸ºæŒ‡æ•°å‡½æ•°ï¼Œæ­¤æ—¶æœ‰ï¼š</p>
<script type="math/tex; mode=display">
\exp \left(w_{i}^{T} w_{k}-w_{j}^{T} w_{k}\right)=\frac{\exp \left(w_{i}^{T} w_{k}\right)}{\exp \left(w_{j}^{T} w_{k}\right)}=\frac{P_{i k}}{P_{j k}}</script><p>å› æ­¤ï¼Œæ­¤æ—¶åªè¦ç¡®ä¿ç­‰å¼ä¸¤è¾¹åˆ†å­åˆ†æ¯ç›¸ç­‰å³å¯ï¼Œå³ï¼š</p>
<script type="math/tex; mode=display">
\exp \left(w_{i}^{T} w_{k}\right)=P_{i k}, \exp \left(w_{j}^{T} w_{k}\right)=P_{j k}</script><p>è¿›ä¸€æ­¥çš„ï¼Œå¯ä»¥è½¬åŒ–ä¸ºå¯¹è¯­æ–™ä¸­çš„æ‰€æœ‰è¯æ±‡ï¼Œè€ƒå¯Ÿ$exp(w^T_iw_k)$=$P_{ik}$=$\frac{X_{ik}}{X_i}$ ï¼Œå³ï¼š</p>
<script type="math/tex; mode=display">
w_{i}^{T} w_{k}=\log \left(\frac{X_{i k}}{X_{i}}\right)=\log X_{i k}-\log X_{i}</script><p>ç”±äºä¸Šå¼å·¦ä¾§$w^T_iw_k$ä¸­ï¼Œè°ƒæ¢iå’Œkçš„å€¼ä¸ä¼šæ”¹å˜å…¶ç»“æœï¼Œå³å…·æœ‰å¯¹ç§°æ€§ï¼Œå› æ­¤ï¼Œä¸ºäº†ç¡®ä¿ç­‰å¼å³ä¾§ä¹Ÿå…·å¤‡å¯¹ç§°æ€§ï¼Œå¼•å…¥äº†ä¸¤ä¸ªåç½®é¡¹ï¼Œå³</p>
<script type="math/tex; mode=display">
w_{i}^{T} w_{k}=\log X_{i k}-b_{i}-b_{k}</script><p>æ­¤æ—¶ï¼Œ$logX_i$å·²ç»åŒ…å«åœ¨$bi$å½“ä¸­ã€‚å› æ­¤ï¼Œæ­¤æ—¶æ¨¡å‹çš„ç›®æ ‡å°±è½¬åŒ–ä¸ºé€šè¿‡å­¦ä¹ è¯å‘é‡çš„è¡¨ç¤ºï¼Œä½¿å¾—ä¸Šå¼ä¸¤è¾¹å°½é‡æ¥è¿‘ï¼Œå› æ­¤ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—ä¸¤è€…ä¹‹é—´çš„å¹³æ–¹å·®æ¥ä½œä¸ºç›®æ ‡å‡½æ•°ï¼Œå³ï¼š</p>
<script type="math/tex; mode=display">
J=\sum_{i, k=1}^{V}\left(w_{i}^{T} \tilde{w}_{k}+b_{i}+b_{k}-\log X_{i k}\right)^{2}</script><p>ä½†æ˜¯è¿™æ ·çš„ç›®æ ‡å‡½æ•°æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å¯¹æ‰€æœ‰çš„å…±ç°è¯æ±‡éƒ½æ˜¯é‡‡ç”¨åŒæ ·çš„æƒé‡ï¼Œå› æ­¤ï¼Œä½œè€…å¯¹ç›®æ ‡å‡½æ•°è¿›è¡Œäº†è¿›ä¸€æ­¥çš„ä¿®æ­£ï¼Œé€šè¿‡è¯­æ–™ä¸­çš„è¯æ±‡å…±ç°ç»Ÿè®¡ä¿¡æ¯æ¥æ”¹å˜ä»–ä»¬åœ¨ç›®æ ‡å‡½æ•°ä¸­çš„æƒé‡ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
J=\sum_{i, k=1}^{V} f\left(X_{i k}\right)\left(w_{i}^{T} \tilde{w}_{k}+b_{i}+b_{k}-\log X_{i k}\right)^{2}</script><p>è¿™é‡Œ$V$è¡¨ç¤ºè¯æ±‡çš„æ•°é‡ï¼Œå¹¶ä¸”æƒé‡å‡½æ•°$f$å¿…é¡»å…·å¤‡ä»¥ä¸‹çš„ç‰¹æ€§</p>
<ul>
<li>$f(0)=0$ï¼Œå½“è¯æ±‡å…±ç°çš„æ¬¡æ•°ä¸º0æ—¶ï¼Œæ­¤æ—¶å¯¹åº”çš„æƒé‡åº”è¯¥ä¸º0ã€‚</li>
<li>f(x)å¿…é¡»æ˜¯ä¸€ä¸ªéå‡å‡½æ•°ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯å½“è¯æ±‡å…±ç°çš„æ¬¡æ•°è¶Šå¤§æ—¶ï¼Œå…¶æƒé‡ä¸ä¼šå‡ºç°ä¸‹é™çš„æƒ…å†µã€‚</li>
<li>å¯¹äºé‚£äº›å¤ªé¢‘ç¹çš„è¯ï¼Œ$f(x)$åº”è¯¥èƒ½ç»™äºˆä»–ä»¬ä¸€ä¸ªç›¸å¯¹å°çš„æ•°å€¼ï¼Œè¿™æ ·æ‰ä¸ä¼šå‡ºç°è¿‡åº¦åŠ æƒã€‚</li>
</ul>
<p>ç»¼åˆä»¥ä¸Šä¸‰ç‚¹ç‰¹æ€§ï¼Œä½œè€…æå‡ºäº†ä¸‹é¢çš„æƒé‡å‡½æ•°ï¼š</p>
<script type="math/tex; mode=display">
f(x)=\left\{\begin{array}{cc}
\left(x / x_{\max }\right)^{\alpha} & \text { if } x<x_{\max } \\
1 & \text { otherwise }
\end{array}\right.</script><h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><ol>
<li>Gloveç»¼åˆäº†å…¨å±€è¯æ±‡å…±ç°çš„ç»Ÿè®¡ä¿¡æ¯å’Œå±€éƒ¨çª—å£ä¸Šä¸‹æ–‡æ–¹æ³•çš„ä¼˜ç‚¹ï¼Œå¯ä»¥è¯´æ˜¯ä¸¤ä¸ªä¸»æµæ–¹æ³•çš„ä¸€ç§ç»¼åˆï¼Œä½†æ˜¯ç›¸æ¯”äºå…¨å±€çŸ©é˜µåˆ†è§£æ–¹æ³•ï¼Œç”±äºGloVeä¸éœ€è¦è®¡ç®—é‚£äº›å…±ç°æ¬¡æ•°ä¸º0çš„è¯æ±‡ï¼Œå› æ­¤ï¼Œå¯ä»¥æå¤§çš„å‡å°‘è®¡ç®—é‡å’Œæ•°æ®çš„å­˜å‚¨ç©ºé—´ã€‚</li>
<li>ä½†æ˜¯GloVeæŠŠè¯­æ–™ä¸­çš„è¯é¢‘å…±ç°æ¬¡æ•°ä½œä¸ºè¯å‘é‡å­¦ä¹ é€¼è¿‘çš„ç›®æ ‡ï¼Œå½“è¯­æ–™æ¯”è¾ƒå°‘æ—¶ï¼Œæœ‰äº›è¯æ±‡å…±ç°çš„æ¬¡æ•°å¯èƒ½æ¯”è¾ƒå°‘ï¼Œç¬”è€…è§‰å¾—å¯èƒ½ä¼šå‡ºç°ä¸€ç§è¯¯å¯¼è¯å‘é‡è®­ç»ƒæ–¹å‘çš„ç°è±¡ã€‚</li>
</ol>
<h4 id="ELMO"><a href="#ELMO" class="headerlink" title="ELMO"></a>ELMO</h4><h5 id="é’ˆå¯¹çš„é—®é¢˜"><a href="#é’ˆå¯¹çš„é—®é¢˜" class="headerlink" title="é’ˆå¯¹çš„é—®é¢˜"></a>é’ˆå¯¹çš„é—®é¢˜</h5><p>word2vecä¸­ï¼Œåªæœ‰appleä¸€ä¸ªè¯å‘é‡ï¼Œæ— æ³•å¯¹ä¸€è¯å¤šä¹‰è¿›è¡Œå»ºæ¨¡ã€‚</p>
<h5 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h5><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/EMLO.png" alt="avatar"></p>
<p>ELMoçš„ä¸»è¦åšæ³•æ˜¯å…ˆè®­ç»ƒä¸€ä¸ªå®Œæ•´çš„è¯­è¨€æ¨¡å‹ï¼Œå†ç”¨è¿™ä¸ªè¯­è¨€æ¨¡å‹å»å¤„ç†éœ€è¦è®­ç»ƒçš„æ–‡æœ¬ï¼Œç”Ÿæˆç›¸åº”çš„è¯å‘é‡ï¼Œæ‰€ä»¥åœ¨æ–‡ä¸­ä¸€ç›´å¼ºè°ƒELMoçš„æ¨¡å‹å¯¹åŒä¸€ä¸ªå­—åœ¨ä¸åŒå¥å­ä¸­èƒ½ç”Ÿæˆä¸åŒçš„è¯å‘é‡ã€‚</p>
<p>åœ¨è¿›è¡Œæœ‰ç›‘ç£çš„NLPä»»åŠ¡æ—¶ï¼Œå¯ä»¥å°†ELMoç›´æ¥å½“åšç‰¹å¾æ‹¼æ¥åˆ°å…·ä½“ä»»åŠ¡æ¨¡å‹çš„è¯å‘é‡è¾“å…¥æˆ–è€…æ˜¯æ¨¡å‹çš„æœ€é«˜å±‚è¡¨ç¤ºä¸Šã€‚ä¸åƒä¼ ç»Ÿçš„è¯å‘é‡ï¼Œæ¯ä¸€ä¸ªè¯åªå¯¹åº”ä¸€ä¸ªè¯å‘é‡ï¼ŒELMoåˆ©ç”¨é¢„è®­ç»ƒå¥½çš„åŒå‘è¯­è¨€æ¨¡å‹ï¼Œç„¶åæ ¹æ®å…·ä½“è¾“å…¥ä»è¯¥è¯­è¨€æ¨¡å‹ä¸­å¯ä»¥å¾—åˆ°ä¸Šä¸‹æ–‡ä¾èµ–çš„å½“å‰è¯è¡¨ç¤ºï¼ˆ<strong>å¯¹äºä¸åŒä¸Šä¸‹æ–‡çš„åŒä¸€ä¸ªè¯çš„è¡¨ç¤ºæ˜¯ä¸ä¸€æ ·çš„</strong>ï¼‰ï¼Œå†å½“æˆç‰¹å¾åŠ å…¥åˆ°å…·ä½“çš„NLPæœ‰ç›‘ç£æ¨¡å‹é‡Œã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/emlo_embedding.png" alt="avatar"></p>
<p>EMLOä½¿ç”¨çš„æ˜¯ä¸€ä¸ª<strong>åŒå‘çš„LSTMè¯­è¨€æ¨¡å‹</strong>ï¼Œç”±ä¸€ä¸ªå‰å‘å’Œä¸€ä¸ªåå‘è¯­è¨€æ¨¡å‹æ„æˆï¼Œç›®æ ‡å‡½æ•°å°±æ˜¯å–è¿™ä¸¤ä¸ªæ–¹å‘è¯­è¨€æ¨¡å‹çš„æœ€å¤§ä¼¼ç„¶ã€‚</p>
<p>å‰å‘LSTMç»“æ„ï¼š</p>
<script type="math/tex; mode=display">
p\left(t_{1}, t_{2}, \ldots, t_{N}\right)=\prod_{k=1}^{N} p\left(t_{k} | t_{1}, t_{2}, \ldots, t_{k-1}\right)</script><p>åå‘LSTMç»“æ„ï¼š</p>
<script type="math/tex; mode=display">
p\left(t_{1}, t_{2}, \ldots, t_{N}\right)=\prod_{k=1}^{N} p\left(t_{k} | t_{k+1}, t_{k+2}, \ldots, t_{N}\right)</script><p>æœ€å¤§ä¼¼ç„¶å‡½æ•°ï¼š</p>
<script type="math/tex; mode=display">
\sum_{k=1}^{N}\left(\log p\left(t_{k} | t_{1}, t_{2}, \ldots, t_{k-1}\right)+\log p\left(t_{k} | t_{k+1}, t_{k+2}, \ldots, t_{N}\right)\right)</script><h5 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><ol>
<li>ELMoçš„å‡è®¾å‰æä¸€ä¸ªè¯çš„è¯å‘é‡ä¸åº”è¯¥æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥åœ¨ä¸€è¯å¤šæ„æ–¹é¢ELMoçš„æ•ˆæœä¸€å®šæ¯”word2vecè¦å¥½ã€‚</li>
<li>word2vecçš„å­¦ä¹ è¯å‘é‡çš„è¿‡ç¨‹æ˜¯é€šè¿‡ä¸­å¿ƒè¯çš„ä¸Šä¸‹çª—å£å»å­¦ä¹ ï¼Œå­¦ä¹ çš„èŒƒå›´å¤ªå°äº†ï¼Œè€ŒELMoåœ¨å­¦ä¹ è¯­è¨€æ¨¡å‹çš„æ—¶å€™æ˜¯ä»æ•´ä¸ªè¯­æ–™åº“å»å­¦ä¹ çš„ï¼Œè€Œåå†é€šè¿‡è¯­è¨€æ¨¡å‹ç”Ÿæˆçš„è¯å‘é‡å°±ç›¸å½“äºåŸºäºæ•´ä¸ªè¯­æ–™åº“å­¦ä¹ çš„è¯å‘é‡ï¼Œæ›´åŠ å‡†ç¡®ä»£è¡¨ä¸€ä¸ªè¯çš„æ„æ€ã€‚</li>
</ol>
<h4 id="GPT"><a href="#GPT" class="headerlink" title="GPT"></a>GPT</h4><p>ç”¨Transformerç½‘ç»œä»£æ›¿äº†LSTMä½œä¸ºè¯­è¨€æ¨¡å‹æ¥æ›´å¥½çš„æ•è·é•¿è·ç¦»è¯­è¨€ç»“æ„ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/gpt_1.png" alt="avatar"></p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/gpt_2.png" alt="avatar"></p>
<h5 id="Masked-Attention"><a href="#Masked-Attention" class="headerlink" title="Masked Attention"></a>Masked Attention</h5><p>åœ¨transformerä¸­ï¼ŒEncoderå› ä¸ºè¦ç¼–ç æ•´ä¸ªå¥å­ï¼Œæ‰€ä»¥æ¯ä¸ªè¯éƒ½éœ€è¦è€ƒè™‘ä¸Šä¸‹æ–‡çš„å…³ç³»ã€‚æ‰€ä»¥æ¯ä¸ªè¯åœ¨è®¡ç®—çš„è¿‡ç¨‹ä¸­éƒ½æ˜¯å¯ä»¥çœ‹åˆ°å¥å­ä¸­æ‰€æœ‰çš„è¯çš„ã€‚ä½†æ˜¯Decoderä¸Seq2Seqä¸­çš„è§£ç å™¨ç±»ä¼¼ï¼Œæ¯ä¸ªè¯éƒ½åªèƒ½çœ‹åˆ°å‰é¢è¯çš„çŠ¶æ€ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªå•å‘çš„Self-Attentionç»“æ„ã€‚Masked Attentionçš„å®ç°ä¹Ÿéå¸¸ç®€å•ï¼Œåªè¦åœ¨æ™®é€šçš„Self Attentionçš„Softmaxæ­¥éª¤ä¹‹å‰ï¼Œä¸æŒ‰ä½ä¹˜ä¸Šä¸€ä¸ªä¸‹ä¸‰è§’çŸ©é˜µMå°±å¥½äº†</p>
<p>attentionï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
Q &=X W_{Q} \\
K &=X W_{K} \\
V &=X W_{V} \\
\text {Attention}(Q, K, V) &=\operatorname{Softmax}\left(\frac{Q K^{T}}{\sqrt{d_{k}}}\right) V
\end{aligned}</script><p>masked-attention</p>
<script type="math/tex; mode=display">
\text { Attention }(Q, K, V)=\operatorname{Softmax}\left(\frac{Q K^{T} \Theta M}{\sqrt{d_{k}}}\right) V</script><h4 id="BERT"><a href="#BERT" class="headerlink" title="BERT"></a>BERT</h4><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/bert_gpt_elmo.png" alt="avatar"></p>
<h5 id="Task-1-MLM"><a href="#Task-1-MLM" class="headerlink" title="Task 1: MLM"></a>Task 1: MLM</h5><p>ç”±äºBERTéœ€è¦é€šè¿‡ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¥é¢„æµ‹ä¸­å¿ƒè¯çš„ä¿¡æ¯ï¼ŒåŒæ—¶åˆä¸å¸Œæœ›æ¨¡å‹æå‰çœ‹è§ä¸­å¿ƒè¯çš„ä¿¡æ¯ï¼Œå› æ­¤æå‡ºäº†ä¸€ç§ Masked Language Model çš„é¢„è®­ç»ƒæ–¹å¼ï¼Œå³éšæœºä»è¾“å…¥é¢„æ–™ä¸Š mask æ‰ä¸€äº›å•è¯ï¼Œç„¶åé€šè¿‡çš„ä¸Šä¸‹æ–‡é¢„æµ‹è¯¥å•è¯ï¼Œç±»ä¼¼äºä¸€ä¸ªå®Œå½¢å¡«ç©ºä»»åŠ¡ã€‚</p>
<p>åœ¨é¢„è®­ç»ƒä»»åŠ¡ä¸­ï¼Œ15%çš„ Word Piece ä¼šè¢«maskï¼Œè¿™15%çš„ Word Piece ä¸­ï¼Œ80%çš„æ—¶å€™ä¼šç›´æ¥æ›¿æ¢ä¸º [Mask] ï¼Œ10%çš„æ—¶å€™å°†å…¶æ›¿æ¢ä¸ºå…¶å®ƒä»»æ„å•è¯ï¼Œ10%çš„æ—¶å€™ä¼šä¿ç•™åŸå§‹Token</p>
<ul>
<li>æ²¡æœ‰100%maskçš„åŸå› <ul>
<li>å¦‚æœå¥å­ä¸­çš„æŸä¸ªToken100%éƒ½ä¼šè¢«maskæ‰ï¼Œé‚£ä¹ˆåœ¨fine-tuningçš„æ—¶å€™æ¨¡å‹å°±ä¼šæœ‰ä¸€äº›æ²¡æœ‰è§è¿‡çš„å•è¯</li>
</ul>
</li>
<li>åŠ å…¥10%éšæœºtokençš„åŸå› <ul>
<li>Transformerè¦ä¿æŒå¯¹æ¯ä¸ªè¾“å…¥tokençš„åˆ†å¸ƒå¼è¡¨å¾ï¼Œå¦åˆ™æ¨¡å‹å°±ä¼šè®°ä½è¿™ä¸ª[mask]æ˜¯token â€™hairyâ€˜</li>
<li>å¦å¤–ç¼–ç å™¨ä¸çŸ¥é“å“ªäº›è¯éœ€è¦é¢„æµ‹çš„ï¼Œå“ªäº›è¯æ˜¯é”™è¯¯çš„ï¼Œå› æ­¤è¢«è¿«éœ€è¦å­¦ä¹ æ¯ä¸€ä¸ªtokençš„è¡¨ç¤ºå‘é‡</li>
</ul>
</li>
<li>å¦å¤–ï¼Œæ¯ä¸ªbatchsizeåªæœ‰15%çš„å•è¯è¢«maskçš„åŸå› ï¼Œæ˜¯å› ä¸ºæ€§èƒ½å¼€é”€çš„é—®é¢˜ï¼ŒåŒå‘ç¼–ç å™¨æ¯”å•é¡¹ç¼–ç å™¨è®­ç»ƒè¦æ›´æ…¢</li>
</ul>
<h5 id="Task-2-NSP"><a href="#Task-2-NSP" class="headerlink" title="Task 2: NSP"></a>Task 2: NSP</h5><p>ä»…ä»…ä¸€ä¸ªMLMä»»åŠ¡æ˜¯ä¸è¶³ä»¥è®© BERT è§£å†³é˜…è¯»ç†è§£ç­‰å¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡çš„ï¼Œå› æ­¤æ·»åŠ äº†é¢å¤–çš„ä¸€ä¸ªé¢„è®­ç»ƒä»»åŠ¡ï¼Œå³ Next Sequence Predictionã€‚</p>
<p>å…·ä½“ä»»åŠ¡å³ä¸ºä¸€ä¸ªå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡ï¼Œå³åˆ¤æ–­å¥å­Bæ˜¯å¦æ˜¯å¥å­Açš„ä¸‹æ–‡ï¼Œå¦‚æœæ˜¯çš„è¯è¾“å‡ºâ€™IsNextâ€˜ï¼Œå¦åˆ™è¾“å‡ºâ€™NotNextâ€˜ã€‚</p>
<p>è®­ç»ƒæ•°æ®çš„ç”Ÿæˆæ–¹å¼æ˜¯ä»å¹³è¡Œè¯­æ–™ä¸­éšæœºæŠ½å–çš„è¿ç»­ä¸¤å¥è¯ï¼Œå…¶ä¸­50%ä¿ç•™æŠ½å–çš„ä¸¤å¥è¯ï¼Œå®ƒä»¬ç¬¦åˆIsNextå…³ç³»ï¼Œå¦å¤–50%çš„ç¬¬äºŒå¥è¯æ˜¯éšæœºä»é¢„æ–™ä¸­æå–çš„ï¼Œå®ƒä»¬çš„å…³ç³»æ˜¯NotNextçš„ã€‚è¿™ä¸ªå…³ç³»ä¿å­˜åœ¨å›¾4ä¸­çš„[CLS]ç¬¦å·ä¸­</p>
<h5 id="è¾“å…¥"><a href="#è¾“å…¥" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h5><ul>
<li>Token Embeddingsï¼šå³ä¼ ç»Ÿçš„è¯å‘é‡å±‚ï¼Œæ¯ä¸ªè¾“å…¥æ ·æœ¬çš„é¦–å­—ç¬¦éœ€è¦è®¾ç½®ä¸º[CLS]ï¼Œå¯ä»¥ç”¨äºä¹‹åçš„åˆ†ç±»ä»»åŠ¡ï¼Œè‹¥æœ‰ä¸¤ä¸ªä¸åŒçš„å¥å­ï¼Œéœ€è¦ç”¨[SEP]åˆ†éš”ï¼Œä¸”æœ€åä¸€ä¸ªå­—ç¬¦éœ€è¦ç”¨[SEP]è¡¨ç¤ºç»ˆæ­¢</li>
<li>Segment Embeddingsï¼šä¸º[0,1]åºåˆ—ï¼Œç”¨æ¥åœ¨NSPä»»åŠ¡ä¸­åŒºåˆ«ä¸¤ä¸ªå¥å­ï¼Œä¾¿äºåšå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡</li>
<li>Position Embeddingsï¼šä¸Transformerä¸­çš„ä½ç½®å‘é‡ä¸åŒï¼ŒBERTä¸­çš„ä½ç½®å‘é‡æ˜¯ç›´æ¥è®­ç»ƒå‡ºæ¥çš„</li>
</ul>
<h5 id="Fine-tunninng"><a href="#Fine-tunninng" class="headerlink" title="Fine-tunninng"></a>Fine-tunninng</h5><p>å¯¹äºä¸åŒçš„ä¸‹æ¸¸ä»»åŠ¡ï¼Œæˆ‘ä»¬ä»…éœ€è¦å¯¹BERTä¸åŒä½ç½®çš„è¾“å‡ºè¿›è¡Œå¤„ç†å³å¯ï¼Œæˆ–è€…ç›´æ¥å°†BERTä¸åŒä½ç½®çš„è¾“å‡ºç›´æ¥è¾“å…¥åˆ°ä¸‹æ¸¸æ¨¡å‹å½“ä¸­ã€‚å…·ä½“çš„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>å¯¹äºæƒ…æ„Ÿåˆ†æç­‰å•å¥åˆ†ç±»ä»»åŠ¡ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥å•ä¸ªå¥å­ï¼ˆä¸éœ€è¦[SEP]åˆ†éš”åŒå¥ï¼‰ï¼Œå°†[CLS]çš„è¾“å‡ºç›´æ¥è¾“å…¥åˆ°åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»</li>
<li>å¯¹äºå¥å­å¯¹ä»»åŠ¡ï¼ˆå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡ï¼‰ï¼Œéœ€è¦ç”¨[SEP]åˆ†éš”ä¸¤ä¸ªå¥å­è¾“å…¥åˆ°æ¨¡å‹ä¸­ï¼Œç„¶ååŒæ ·ä»…é¡»å°†[CLS]çš„è¾“å‡ºé€åˆ°åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»</li>
<li>å¯¹äºé—®ç­”ä»»åŠ¡ï¼Œå°†é—®é¢˜ä¸ç­”æ¡ˆæ‹¼æ¥è¾“å…¥åˆ°BERTæ¨¡å‹ä¸­ï¼Œç„¶åå°†ç­”æ¡ˆä½ç½®çš„è¾“å‡ºå‘é‡è¿›è¡ŒäºŒåˆ†ç±»å¹¶åœ¨å¥å­æ–¹å‘ä¸Šè¿›è¡Œsoftmaxï¼ˆåªéœ€é¢„æµ‹å¼€å§‹å’Œç»“æŸä½ç½®å³å¯ï¼‰</li>
<li>å¯¹äºå‘½åå®ä½“è¯†åˆ«ä»»åŠ¡ï¼Œå¯¹æ¯ä¸ªä½ç½®çš„è¾“å‡ºè¿›è¡Œåˆ†ç±»å³å¯ï¼Œå¦‚æœå°†æ¯ä¸ªä½ç½®çš„è¾“å‡ºä½œä¸ºç‰¹å¾è¾“å…¥åˆ°CRFå°†å–å¾—æ›´å¥½çš„æ•ˆæœã€‚</li>
</ul>
<h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul>
<li>BERTçš„é¢„è®­ç»ƒä»»åŠ¡MLMä½¿å¾—èƒ½å¤Ÿå€ŸåŠ©ä¸Šä¸‹æ–‡å¯¹åºåˆ—è¿›è¡Œç¼–ç ï¼Œä½†åŒæ—¶ä¹Ÿä½¿å¾—å…¶é¢„è®­ç»ƒè¿‡ç¨‹ä¸ä¸­çš„æ•°æ®ä¸å¾®è°ƒçš„æ•°æ®ä¸åŒ¹é…ï¼Œéš¾ä»¥é€‚åº”ç”Ÿæˆå¼ä»»åŠ¡</li>
<li>å¦å¤–ï¼ŒBERTæ²¡æœ‰è€ƒè™‘é¢„æµ‹[MASK]ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œæ˜¯å¯¹è¯­è¨€æ¨¡å‹è”åˆæ¦‚ç‡çš„æœ‰åä¼°è®¡</li>
<li>ç”±äºæœ€å¤§è¾“å…¥é•¿åº¦çš„é™åˆ¶ï¼Œé€‚åˆå¥å­å’Œæ®µè½çº§åˆ«çš„ä»»åŠ¡ï¼Œä¸é€‚ç”¨äºæ–‡æ¡£çº§åˆ«çš„ä»»åŠ¡ï¼ˆå¦‚é•¿æ–‡æœ¬åˆ†ç±»ï¼‰</li>
<li>é€‚åˆå¤„ç†è‡ªç„¶è¯­ä¹‰ç†è§£ç±»ä»»åŠ¡(NLU)ï¼Œè€Œä¸é€‚åˆè‡ªç„¶è¯­è¨€ç”Ÿæˆç±»ä»»åŠ¡(NLG)</li>
</ul>
<h5 id="torchä½¿ç”¨"><a href="#torchä½¿ç”¨" class="headerlink" title="torchä½¿ç”¨"></a>torchä½¿ç”¨</h5><ol>
<li>å¯¼å…¥ç›¸å…³åº“</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> transformers <span class="keyword">as</span> ppb <span class="comment"># pytorch transformers</span></span><br></pre></td></tr></table></figure>
<ol>
<li>å¯¼å…¥é¢„è®­ç»ƒå¥½çš„ DistilBERT æ¨¡å‹ä¸åˆ†è¯å™¨</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">model_class, tokenizer_class, pretrained_weights = (ppb.DistilBertModel, ppb.DistilBertTokenizer, <span class="string">'distilbert-base-uncased'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Want BERT instead of distilBERT? Uncomment the following line:</span></span><br><span class="line"><span class="comment">#model_class, tokenizer_class, pretrained_weights = (ppb.BertModel, ppb.BertTokenizer, 'bert-base-uncased')# </span></span><br><span class="line"></span><br><span class="line">Load pretrained model/tokenizertokenizer = tokenizer_class.from_pretrained(pretrained_weights)</span><br><span class="line">model = model_class.from_pretrained(pretrained_weights)</span><br></pre></td></tr></table></figure>
<ol>
<li>tokenizeï¼šåˆ†è¯+[cls]+[sep]<br><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/bert_tokenize.png" alt="avatar"></li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tokenizer.encode(<span class="string">"a visually stunning rumination on love"</span>, add_special_tokens=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>padding</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">   max_len = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tokenized.values:</span><br><span class="line">    <span class="keyword">if</span> len(i) &gt; max_len:</span><br><span class="line">        max_len = len(i)</span><br><span class="line">padded = np.array([i + [<span class="number">0</span>]*(max_len-len(i)) <span class="keyword">for</span> i <span class="keyword">in</span> tokenized.values])</span><br></pre></td></tr></table></figure>
<ol>
<li>masking</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">attention_mask = np.where(padded != <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>ä½¿ç”¨bertè¿›è¡Œç¼–ç </li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    <span class="comment"># last_hidden_states = [batch_size, max_sentence_len, 768]</span></span><br><span class="line">    last_hidden_states = model(input_ids, attention_mask=attention_mask)</span><br></pre></td></tr></table></figure>
<h3 id="transformer"><a href="#transformer" class="headerlink" title="transformer"></a>transformer</h3><p>æ— è®ºæ˜¯RNNè¿˜æ˜¯CNNï¼Œåœ¨å¤„ç†NLPä»»åŠ¡æ—¶éƒ½æœ‰ç¼ºé™·ã€‚CNNæ˜¯å…¶å…ˆå¤©çš„å·ç§¯æ“ä½œä¸å¾ˆé€‚åˆåºåˆ—åŒ–çš„æ–‡æœ¬ï¼ŒRNNæ˜¯å…¶æ²¡æœ‰å¹¶è¡ŒåŒ–ï¼Œå¾ˆå®¹æ˜“è¶…å‡ºå†…å­˜é™åˆ¶ï¼ˆæ¯”å¦‚50tokensé•¿åº¦çš„å¥å­å°±ä¼šå æ®å¾ˆå¤§çš„å†…å­˜ï¼‰ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/transformer.png" alt="avatar"></p>
<h4 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h4><ol>
<li>å¦‚ä½•å®ç°å¹¶è¡Œè®¡ç®—åŒæ—¶ç¼©çŸ­ä¾èµ–è·ç¦»ï¼Ÿé‡‡ç”¨è‡ªæ³¨æ„æœºåˆ¶</li>
<li>å¦‚ä½•å‘CNNä¸€æ ·è€ƒè™‘å¤šé€šé“ä¿¡æ¯ï¼Ÿé‡‡ç”¨å¤šå¤´æ³¨æ„åŠ›</li>
<li>è‡ªæ³¨æ„åŠ›æœºåˆ¶æŸå¤±äº†ä½ç½®ä¿¡æ¯ï¼Œå¦‚ä½•è¡¥å¿? ä½ç½®åµŒå…¥</li>
<li>åé¢çš„å±‚ä¸­ä½ç½®ä¿¡æ¯æ¶ˆæ•£ï¼Ÿ æ®‹å·®è¿æ¥</li>
</ol>
<h4 id="self-attention"><a href="#self-attention" class="headerlink" title="self-attention"></a>self-attention</h4><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention-1.png" alt="avatar"></p>
<h5 id="å¹¶è¡ŒåŒ–"><a href="#å¹¶è¡ŒåŒ–" class="headerlink" title="å¹¶è¡ŒåŒ–"></a>å¹¶è¡ŒåŒ–</h5><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention-2.png" alt="avatar" style="zoom:67%;"></p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention-3.png" alt="avatar" style="zoom: 67%;"></p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention-4.png" alt="avatar" style="zoom: 67%;"></p>
<h5 id="multi-head-self-attention"><a href="#multi-head-self-attention" class="headerlink" title="multi-head self-attention"></a>multi-head self-attention</h5><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/multi-head.png" alt="avatar" style="zoom:67%;"></p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/multi-head-1.png" alt="avatar"></p>
<h4 id="encoder"><a href="#encoder" class="headerlink" title="encoder"></a>encoder</h4><p>Encoderç”±N=6ä¸ªç›¸åŒçš„layerç»„æˆï¼ŒlayeræŒ‡çš„å°±æ˜¯ä¸Šå›¾å·¦ä¾§çš„å•å…ƒï¼Œæœ€å·¦è¾¹æœ‰ä¸ªâ€œNxâ€ï¼Œè¿™é‡Œæ˜¯x6ä¸ªã€‚æ¯ä¸ªLayerç”±ä¸¤ä¸ªsub-layerç»„æˆï¼Œåˆ†åˆ«æ˜¯multi-head self-attention mechanismå’Œfully connected feed-forward networkã€‚å…¶ä¸­æ¯ä¸ªsub-layeréƒ½åŠ äº†residual connectionå’Œnormalisationï¼Œå› æ­¤å¯ä»¥å°†sub-layerçš„è¾“å‡ºè¡¨ç¤ºä¸ºï¼š</p>
<script type="math/tex; mode=display">
sub_layer_output=LayerNorm(x+(\text {SubLayer}(x)))</script><h5 id="Multi-head-self-attention"><a href="#Multi-head-self-attention" class="headerlink" title="Multi-head self-attention"></a>Multi-head self-attention</h5><p>ç”±äºattentionï¼š</p>
<script type="math/tex; mode=display">
attention_output=Attention(Q, K, V)</script><p>multi-head attentionåˆ™æ˜¯é€šè¿‡hä¸ªä¸åŒçš„<strong>çº¿æ€§å˜æ¢</strong>å¯¹Qï¼ŒKï¼ŒVè¿›è¡ŒæŠ•å½±ï¼Œæœ€åå°†ä¸åŒçš„attentionç»“æœæ‹¼æ¥èµ·æ¥ï¼š</p>
<script type="math/tex; mode=display">
\begin{array}{l}\text { MultiHead(Q,K,V)}= Concat(head_1,\ldots,head_h)W^{O}  \\ head_i = Attention(QW_i\left.^{Q}, K W_{i}^{K}, V W_{i}^{V}\right) \\ \text { Attention }(Q, K, V)=\operatorname{softmax}\left(\frac{Q K^{T}}{\sqrt{d_{k}}}\right) V\end{array}</script><p>å¤šä¸ªheadå¸¦æ¥çš„ä¼˜åŠ¿æ˜¯ï¼šä¸åŒçš„headï¼Œæ‰€attentionçš„å†…å®¹ä¸åŒï¼Œæ¯”å¦‚ï¼š$head_1$ attention å…¨å±€çš„å†…å®¹ï¼Œ$head_2$ attention localçš„å†…å®¹ã€‚</p>
<h5 id="Position-wise-feed-forward-networks"><a href="#Position-wise-feed-forward-networks" class="headerlink" title="Position-wise feed-forward networks"></a>Position-wise feed-forward networks</h5><p>è¿™å±‚ä¸»è¦æ˜¯æä¾›éçº¿æ€§å˜æ¢ã€‚Attentionè¾“å‡ºçš„ç»´åº¦æ˜¯[bsz<em>seq_len, num_heads</em>head_size]ï¼Œç¬¬äºŒä¸ªsub-layeræ˜¯ä¸ªå…¨è¿æ¥å±‚ï¼Œä¹‹æ‰€ä»¥æ˜¯position-wiseæ˜¯å› ä¸ºè¿‡çº¿æ€§å±‚æ—¶æ¯ä¸ªä½ç½®içš„å˜æ¢å‚æ•°æ˜¯ä¸€æ ·çš„.</p>
<h4 id="Decoder"><a href="#Decoder" class="headerlink" title="Decoder"></a><strong>Decoder</strong></h4><p>Decoderå’ŒEncoderçš„ç»“æ„å·®ä¸å¤šï¼Œä½†æ˜¯å¤šäº†ä¸€ä¸ªattentionçš„sub-layer,decoderçš„è¾“å…¥è¾“å‡ºå’Œè§£ç è¿‡ç¨‹:</p>
<ul>
<li>è¾“å‡ºï¼šå¯¹åº”iä½ç½®çš„è¾“å‡ºè¯çš„æ¦‚ç‡åˆ†å¸ƒ</li>
<li>è¾“å…¥ï¼šencoderçš„è¾“å‡º &amp; å¯¹åº”i-1ä½ç½®decoderçš„è¾“å‡ºã€‚æ‰€ä»¥ä¸­é—´çš„attentionä¸æ˜¯self-attentionï¼Œå®ƒçš„Kï¼ŒVæ¥è‡ªencoderï¼ŒQæ¥è‡ªä¸Šä¸€ä½ç½®decoderçš„è¾“å‡º</li>
<li>è§£ç ï¼š<strong>ç¼–ç å¯ä»¥å¹¶è¡Œè®¡ç®—ï¼Œä¸€æ¬¡æ€§å…¨éƒ¨encodingå‡ºæ¥ï¼Œä½†è§£ç ä¸æ˜¯ä¸€æ¬¡æŠŠæ‰€æœ‰åºåˆ—è§£å‡ºæ¥çš„ï¼Œè€Œæ˜¯åƒrnnä¸€æ ·ä¸€ä¸ªä¸€ä¸ªè§£å‡ºæ¥çš„</strong>ï¼Œå› ä¸ºè¦ç”¨ä¸Šä¸€ä¸ªä½ç½®çš„è¾“å…¥å½“ä½œattentionçš„query</li>
</ul>
<h4 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ol>
<li><p>ä¸èƒ½ä¸€æ¬¡å¯¹å¾ˆé•¿æ–‡æœ¬è¿›è¡Œå»ºæ¨¡ï¼ˆå‡å¦‚æ–‡æœ¬é•¿åº¦ä¸º$10^5$,åœ¨ä¸€ä¸ªforwardçš„æ¨¡å—ä¸­éœ€è¦$10^5 * 10^5 = 10^{10}$å¤§å°çš„çŸ©é˜µæ¥ä¿å­˜scoreï¼Œå¾ˆå®¹æ˜“å¯¼è‡´ out of memory é—®é¢˜ï¼‰ã€‚è§£å†³æ–¹æ³•ï¼šdivide long sequence into smaller sequence. ä½†æ˜¯è¿™æ ·å¯¼è‡´smaller sequence ä¹‹é—´æ˜¯æ²¡æœ‰è”ç³»çš„ã€‚ï¼ˆä½¿ç”¨rnnçš„æ–¹å¼æ¥å»ºç«‹smaller sequence ä¹‹é—´çš„è”ç³»â€”&gt; transformer XLï¼‰</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/transformer-xl.png" alt="avatar"></p>
<p>åœ¨å¼•å…¥rnnçš„æ—¶å€™ï¼Œé‡åˆ°äº†absolute positionçš„é—®é¢˜ï¼Œç”¨relative positionè¿›è¡Œäº†è§£å†³ã€‚</p>
</li>
</ol>
<h5 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p>å¼•å…¥Self Attentionåä¼šæ›´å®¹æ˜“æ•è·å¥å­ä¸­é•¿è·ç¦»çš„ç›¸äº’ä¾èµ–çš„ç‰¹å¾ï¼Œå› ä¸ºå¦‚æœæ˜¯RNNæˆ–è€…LSTMï¼Œéœ€è¦ä¾æ¬¡åºåºåˆ—è®¡ç®—ï¼Œå¯¹äºè¿œè·ç¦»çš„ç›¸äº’ä¾èµ–çš„ç‰¹å¾ï¼Œè¦ç»è¿‡è‹¥å¹²æ—¶é—´æ­¥æ­¥éª¤çš„ä¿¡æ¯ç´¯ç§¯æ‰èƒ½å°†ä¸¤è€…è”ç³»èµ·æ¥ï¼Œè€Œè·ç¦»è¶Šè¿œï¼Œæœ‰æ•ˆæ•è·çš„å¯èƒ½æ€§è¶Šå°ã€‚</p>
<p>ä½†æ˜¯Self Attentionåœ¨è®¡ç®—è¿‡ç¨‹ä¸­ä¼šç›´æ¥å°†å¥å­ä¸­ä»»æ„ä¸¤ä¸ªå•è¯çš„è”ç³»é€šè¿‡ä¸€ä¸ªè®¡ç®—æ­¥éª¤ç›´æ¥è”ç³»èµ·æ¥ï¼Œæ‰€ä»¥è¿œè·ç¦»ä¾èµ–ç‰¹å¾ä¹‹é—´çš„è·ç¦»è¢«æå¤§ç¼©çŸ­ï¼Œæœ‰åˆ©äºæœ‰æ•ˆåœ°åˆ©ç”¨è¿™äº›ç‰¹å¾ã€‚é™¤æ­¤å¤–ï¼ŒSelf Attentionå¯¹äºå¢åŠ è®¡ç®—çš„å¹¶è¡Œæ€§ä¹Ÿæœ‰ç›´æ¥å¸®åŠ©ä½œç”¨ã€‚è¿™æ˜¯ä¸ºä½•Self Attentioné€æ¸è¢«å¹¿æ³›ä½¿ç”¨çš„ä¸»è¦åŸå› ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwNzc2NTk0NQ==&amp;mid=2247484682&amp;idx=1&amp;sn=51520138eed826ec891ac8154ee550f9&amp;chksm=970c2ddca07ba4ca33ee14542cff0457601bb16236f8edc1ff0e617051d1f063354dda0f8893&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">ä»å‰é¦ˆåˆ°åé¦ˆï¼šè§£æå¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰åŠå…¶tricks</a></li>
<li><a href="https://www.jiqizhixin.com/articles/2018-07-06-7" target="_blank" rel="noopener">Step-by-step to LSTM: è§£æLSTMç¥ç»ç½‘ç»œè®¾è®¡åŸç†</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/43493999" target="_blank" rel="noopener">AttentionåŸç†å’Œæºç è§£æ</a></li>
<li><a href="https://www.jiqizhixin.com/articles/2019-12-28?from=synced&amp;keyword=bert" target="_blank" rel="noopener">BERTæ¨¡å‹è¶…é…·ç‚«ï¼Œä¸Šæ‰‹åˆå¤ªéš¾ï¼Ÿè¯·æŸ¥æ”¶è¿™ä»½BERTå¿«é€Ÿå…¥é—¨æŒ‡å—ï¼</a></li>
</ol>
]]></content>
      <categories>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ·±åº¦å­¦ä¹ </tag>
        <tag>è‡ªç„¶è¯­è¨€å¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>æœºå™¨å­¦ä¹ å¤§æ€»ç»“</title>
    <url>/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="æœºå™¨å­¦ä¹ å¤§æ€»ç»“"><a href="#æœºå™¨å­¦ä¹ å¤§æ€»ç»“" class="headerlink" title="æœºå™¨å­¦ä¹ å¤§æ€»ç»“"></a>æœºå™¨å­¦ä¹ å¤§æ€»ç»“</h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹"></a><strong>è¿›ç¨‹å’Œçº¿ç¨‹</strong></h4><p>è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯ä¸€ä¸ªæ—¶é—´æ®µçš„æè¿°ï¼Œæ˜¯CPUå·¥ä½œæ—¶é—´æ®µçš„æè¿°ï¼Œä¸è¿‡æ˜¯é¢—ç²’å¤§å°ä¸åŒ.è¿›ç¨‹å°±æ˜¯åŒ…æ¢ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ç¨‹åºæ‰§è¡Œæ—¶é—´æ€»å’Œ = CPUåŠ è½½ä¸Šä¸‹æ–‡+CPUæ‰§è¡Œ+CPUä¿å­˜ä¸Šä¸‹æ–‡.çº¿ç¨‹æ˜¯å…±äº«äº†è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ç¯å¢ƒçš„æ›´ä¸ºç»†å°çš„CPUæ—¶é—´æ®µã€‚</p>
<h4 id="åˆ¤åˆ«å¼æ¨¡å‹å’Œç”Ÿæˆå¼æ¨¡å‹"><a href="#åˆ¤åˆ«å¼æ¨¡å‹å’Œç”Ÿæˆå¼æ¨¡å‹" class="headerlink" title="åˆ¤åˆ«å¼æ¨¡å‹å’Œç”Ÿæˆå¼æ¨¡å‹:"></a><strong>åˆ¤åˆ«å¼æ¨¡å‹å’Œç”Ÿæˆå¼æ¨¡å‹</strong>:</h4><ol>
<li>åˆ¤åˆ«å¼æ¨¡å‹ç›´æ¥å­¦ä¹ å†³ç­–å‡½æ•°$f(X)$æˆ–æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ$P(Y|X)$ä½œä¸ºé¢„æµ‹çš„æ¨¡å‹.å¾€å¾€å‡†ç¡®ç‡æ›´é«˜,å¹¶ä¸”å¯ä»¥ç®€åŒ–å­¦ä¹ é—®é¢˜.<ol>
<li>kè¿‘é‚»æ³•ã€æ„ŸçŸ¥æœºã€å†³ç­–æ ‘ã€æœ€å¤§ç†µæ¨¡å‹ã€Logisticå›å½’ã€çº¿æ€§åˆ¤åˆ«åˆ†æ(LDA)ã€æ”¯æŒå‘é‡æœº(SVM)ã€Boostingã€CRFã€çº¿æ€§å›å½’ã€ç¥ç»ç½‘ç»œ</li>
</ol>
</li>
<li>ç”Ÿæˆå¼æ¨¡å‹ç”±æ•°æ®å­¦ä¹ <strong>è”åˆæ¦‚ç‡åˆ†å¸ƒP(X,Y)</strong>,ç„¶åç”±P(Y|X)=P(X,Y)/P(X)æ±‚å‡ºæ¡ä»¶æ¦‚ç‡åˆ†å¸ƒä½œä¸ºé¢„æµ‹çš„æ¨¡å‹,å³ç”Ÿæˆæ¨¡å‹.å½“å­˜åœ¨éšå˜é‡æ—¶åªèƒ½ç”¨ç”Ÿæˆæ–¹æ³•å­¦ä¹ .<ol>
<li>æ··åˆé«˜æ–¯æ¨¡å‹å’Œå…¶ä»–æ··åˆæ¨¡å‹ã€éšé©¬å°”å¯å¤«æ¨¡å‹(HMM)ã€æœ´ç´ è´å¶æ–¯ã€ä¾èµ–è´å¶æ–¯(AODE)ã€LDAæ–‡æ¡£ä¸»é¢˜ç”Ÿæˆæ¨¡å‹</li>
</ol>
</li>
</ol>
<a id="more"></a>
<h4 id="æ¦‚ç‡è´¨é‡å‡½æ•°-æ¦‚ç‡å¯†åº¦å‡½æ•°-ç´¯ç§¯åˆ†å¸ƒå‡½æ•°"><a href="#æ¦‚ç‡è´¨é‡å‡½æ•°-æ¦‚ç‡å¯†åº¦å‡½æ•°-ç´¯ç§¯åˆ†å¸ƒå‡½æ•°" class="headerlink" title="æ¦‚ç‡è´¨é‡å‡½æ•°,æ¦‚ç‡å¯†åº¦å‡½æ•°,ç´¯ç§¯åˆ†å¸ƒå‡½æ•°:"></a><strong>æ¦‚ç‡è´¨é‡å‡½æ•°,æ¦‚ç‡å¯†åº¦å‡½æ•°,ç´¯ç§¯åˆ†å¸ƒå‡½æ•°</strong>:</h4><ol>
<li>æ¦‚ç‡è´¨é‡å‡½æ•° (probability mass functionï¼ŒPMF)æ˜¯ç¦»æ•£éšæœºå˜é‡åœ¨å„ç‰¹å®šå–å€¼ä¸Šçš„æ¦‚ç‡ã€‚</li>
<li>æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆprobability density functionï¼ŒPDF)æ˜¯å¯¹ è¿ç»­éšæœºå˜é‡ å®šä¹‰çš„ï¼Œæœ¬èº«ä¸æ˜¯æ¦‚ç‡ï¼Œåªæœ‰å¯¹è¿ç»­éšæœºå˜é‡çš„å–å€¼è¿›è¡Œç§¯åˆ†åæ‰æ˜¯æ¦‚ç‡ã€‚</li>
<li><p>ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆcumulative distribution functionï¼ŒCDF)èƒ½å®Œæ•´æè¿°ä¸€ä¸ªå®æ•°éšæœºå˜é‡Xçš„æ¦‚ç‡åˆ†å¸ƒï¼Œæ˜¯æ¦‚ç‡å¯†åº¦å‡½æ•°çš„ç§¯åˆ†ã€‚å¯¹æ–¼æ‰€æœ‰å®æ•°x ï¼Œä¸pdfç›¸å¯¹ã€‚</p>
<h4 id="æå¤§ä¼¼ç„¶ä¼°è®¡"><a href="#æå¤§ä¼¼ç„¶ä¼°è®¡" class="headerlink" title="æå¤§ä¼¼ç„¶ä¼°è®¡"></a><strong>æå¤§ä¼¼ç„¶ä¼°è®¡</strong></h4></li>
</ol>
<p>å·²çŸ¥æŸä¸ªå‚æ•°èƒ½ä½¿è¿™ä¸ªæ ·æœ¬å‡ºç°çš„æ¦‚ç‡æœ€å¤§ï¼Œæˆ‘ä»¬å½“ç„¶ä¸ä¼šå†å»é€‰æ‹©å…¶ä»–å°æ¦‚ç‡çš„æ ·æœ¬ï¼Œæ‰€ä»¥å¹²è„†å°±æŠŠè¿™ä¸ªå‚æ•°ä½œä¸ºä¼°è®¡çš„çœŸå®å€¼ã€‚</p>
<h4 id="æœ€å°äºŒä¹˜æ³•"><a href="#æœ€å°äºŒä¹˜æ³•" class="headerlink" title="æœ€å°äºŒä¹˜æ³•"></a>æœ€å°äºŒä¹˜æ³•</h4><p>äºŒä¹˜çš„è‹±æ–‡æ˜¯least square,æ‰¾ä¸€ä¸ªï¼ˆç»„ï¼‰ä¼°è®¡å€¼,ä½¿å¾—å®é™…å€¼ä¸ä¼°è®¡å€¼ä¹‹å·®çš„å¹³æ–¹åŠ æ€»ä¹‹åçš„å€¼æœ€å°$Q=\min \sum_{i}^{n}\left(y_{i e}-y_{i}\right)^{2}$.æ±‚è§£æ–¹å¼æ˜¯å¯¹å‚æ•°æ±‚åå¯¼,ä»¤åå¯¼ä¸º0å³å¯.æ ·æœ¬é‡å°æ—¶é€Ÿåº¦å¿«.</p>
<h4 id="æ¢¯åº¦ä¸‹é™æ³•"><a href="#æ¢¯åº¦ä¸‹é™æ³•" class="headerlink" title="æ¢¯åº¦ä¸‹é™æ³•"></a><strong>æ¢¯åº¦ä¸‹é™æ³•</strong></h4><p>è´Ÿæ¢¯åº¦æ–¹å‘æ˜¯å‡½æ•°å€¼ä¸‹é™æœ€å¿«çš„æ–¹å‘,æ¯æ¬¡æ›´æ–°å€¼éƒ½ç­‰äºåŸå€¼åŠ å­¦ä¹ ç‡(<strong>æ­¥é•¿</strong>)ä¹˜æŸå¤±å‡½æ•°çš„<strong>æ¢¯åº¦</strong>.æ¯æ¬¡éƒ½è¯•ä¸€ä¸ªæ­¥é•¿çœ‹ä¼šä¸ä¼šä¸‹é™ä¸€å®šçš„ç¨‹åº¦,å¦‚æœæ²¡æœ‰çš„è¯å°±æŒ‰æ¯”ä¾‹å‡å°æ­¥é•¿.ä¸æ–­åº”ç”¨å‚æ•°æ›´æ–°å…¬å¼ç›´åˆ°æ”¶æ•›,å¯ä»¥å¾—åˆ°å±€éƒ¨æœ€å°å€¼.åˆå§‹å€¼çš„ä¸åŒç»„åˆå¯ä»¥å¾—åˆ°ä¸åŒå±€éƒ¨æœ€å°å€¼.åœ¨æœ€ä¼˜ç‚¹æ—¶ä¼šæœ‰éœ‡è¡.</p>
<ol>
<li><p><strong>æ‰¹é‡æ¢¯åº¦ä¸‹é™(BGD)</strong>:æ¯æ¬¡éƒ½ä½¿ç”¨æ‰€æœ‰çš„mä¸ªæ ·æœ¬æ¥æ›´æ–°,å®¹æ˜“æ‰¾åˆ°å…¨å±€æœ€ä¼˜è§£,ä½†æ˜¯mè¾ƒå¤§æ—¶é€Ÿåº¦è¾ƒæ…¢ã€‚$\theta_{j}^{\prime}=\theta_{j}+\frac{1}{m} \sum_{i=1}^{m}\left(y^{i}-h_{\theta}\left(x^{i}\right)\right) x_{j}^{i}$</p>
</li>
<li><p><strong>éšæœºæ¢¯åº¦ä¸‹é™(SGD)</strong>ï¼šæ¯æ¬¡åªä½¿ç”¨ä¸€ä¸ªæ ·æœ¬æ¥æ›´æ–°,è®­ç»ƒé€Ÿåº¦å¿«,ä½†æ˜¯å™ªéŸ³è¾ƒå¤š,ä¸å®¹æ˜“æ‰¾åˆ°å…¨å±€æœ€ä¼˜è§£,ä»¥æŸå¤±å¾ˆå°çš„ä¸€éƒ¨åˆ†ç²¾ç¡®åº¦å’Œå¢åŠ ä¸€å®šæ•°é‡çš„è¿­ä»£æ¬¡æ•°ä¸ºä»£ä»·,æ¢å–äº†æ€»ä½“çš„ä¼˜åŒ–æ•ˆç‡çš„æå‡.æ³¨æ„æ§åˆ¶æ­¥é•¿ç¼©å°,å‡å°‘éœ‡è¡.</p>
</li>
</ol>
<script type="math/tex; mode=display">
\theta_{j}=\theta_{j}+\left(y^{i}-h_{\theta}\left(x^{i}\right)\right) x_{j}^{i}</script><ol>
<li><strong>å°æ‰¹é‡æ¢¯åº¦ä¸‹é™(MBGD)</strong>:æ¯æ¬¡ä½¿ç”¨ä¸€éƒ¨åˆ†æ ·æœ¬æ¥æ›´æ–°.</li>
</ol>
<h4 id="ç‰›é¡¿æ³•"><a href="#ç‰›é¡¿æ³•" class="headerlink" title="ç‰›é¡¿æ³•"></a><strong>ç‰›é¡¿æ³•</strong></h4><p>ç‰›é¡¿æ³•æ˜¯<strong>äºŒæ¬¡æ”¶æ•›</strong>,å› æ­¤æ”¶æ•›é€Ÿåº¦å¿«.ä»å‡ ä½•ä¸Šçœ‹æ˜¯æ¯æ¬¡ç”¨ä¸€ä¸ªäºŒæ¬¡æ›²é¢æ¥æ‹Ÿåˆå½“å‰æ‰€å¤„ä½ç½®çš„å±€éƒ¨æ›²é¢,è€Œæ¢¯åº¦ä¸‹é™æ³•æ˜¯ç”¨ä¸€ä¸ªå¹³é¢æ¥æ‹Ÿåˆ.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/newton.png" alt="avatar"></p>
<ol>
<li><strong>é»‘å¡çŸ©é˜µ</strong>æ˜¯ç”±ç›®æ ‡å‡½æ•°f(x)åœ¨ç‚¹Xå¤„çš„äºŒé˜¶åå¯¼æ•°ç»„æˆçš„n*né˜¶å¯¹ç§°çŸ©é˜µã€‚</li>
<li><strong>ç‰›é¡¿æ³•</strong>:å°†f(x)åœ¨x(k)é™„è¿‘è¿›è¡Œ<strong>äºŒé˜¶æ³°å‹’å±•å¼€</strong>:$f(x)=f\left(x^{(k)}\right)+g_{k}^{\top}\left(x-x^{(k)}\right)+\frac{1}{2}\left(x-x^{(k)}\right)^{\mathrm{T}} H\left(x^{(k)}\right)\left(x-x^{(k)}\right)$ã€‚å…¶ä¸­$g_k$æ˜¯$f(x)$çš„æ¢¯åº¦å‘é‡åœ¨$x^{(k)}$çš„å€¼,$H(x^{(k)})$æ˜¯$f(x)$çš„é»‘å¡çŸ©é˜µåœ¨ç‚¹$x^k$çš„å€¼.ç‰›é¡¿æ³•åˆ©ç”¨æå°ç‚¹çš„å¿…è¦æ¡ä»¶$f(x)$å¤„çš„æ¢¯åº¦ä¸º0,æ¯æ¬¡è¿­ä»£ä¸­ä»ç‚¹$x^{(k)}$å¼€å§‹,å‡è®¾$\nabla f\left(x^{(k+1)}\right)=0$ï¼Œå¯¹äºŒé˜¶æ³°å‹’å±•å¼€æ±‚åå¯¼æœ‰ $\nabla f(x)=g_{k}+H_{k}\left(x-x^{(k)}\right)$ï¼Œä»£å…¥å¾—åˆ°$g_{k}+H_{k}\left(x^{(k+1)}-x^{(k)}\right)=0$,å³$\quad x^{(k+1)}=x^{(k)}-H_{k}^{-1} g_{k}$,ä»¥æ­¤ä¸ºè¿­ä»£å…¬å¼å°±æ˜¯ç‰›é¡¿æ³•.</li>
</ol>
<h4 id="æ‹Ÿç‰›é¡¿æ³•"><a href="#æ‹Ÿç‰›é¡¿æ³•" class="headerlink" title="æ‹Ÿç‰›é¡¿æ³•"></a>æ‹Ÿç‰›é¡¿æ³•</h4><p>ç”¨ä¸€ä¸ª<strong>né˜¶æ­£å®šçŸ©é˜µGk</strong>=G(x(k))æ¥<strong>è¿‘ä¼¼ä»£æ›¿</strong>é»‘å¡çŸ©é˜µçš„<strong>é€†çŸ©é˜µ</strong>å°±æ˜¯æ‹Ÿç‰›é¡¿æ³•çš„åŸºæœ¬æ€æƒ³.åœ¨ç‰›é¡¿æ³•ä¸­é»‘å¡çŸ©é˜µæ»¡è¶³çš„æ¡ä»¶å¦‚ä¸‹:$g_{k+1}-g_{k}=H_{k}\left(x^{(k+1)}-x^{(k)}\right)$,ä»¤$ {y_{k}}=g_{k+1}-g_{k}, \quad \delta_{k}=x^{(k+1)}-x^{(k)}$ï¼Œåˆ™æœ‰  $ H_{k}^{-1} y_{k}=\delta_{k}$,ç§°ä¸ºæ‹Ÿç‰›é¡¿æ¡ä»¶.</p>
<ol>
<li><strong>DFPç®—æ³•</strong>:å‡è®¾æ¯ä¸€æ­¥$G_{k+1}=G_{k}+P_{k}+Q_{k}$ï¼Œä¸ºä½¿$G_{k+1}$æ»¡è¶³æ‹Ÿç‰›é¡¿æ¡ä»¶,å¯ä½¿$P_k$å’Œ$Q_k$æ»¡è¶³$P_{k} y_{k}=\delta_{k}, Q_{k} y_{k}=-G_{k} y_{k}$,ä¾‹å¦‚å–$P_{k}=\frac{\delta_{k} \delta_{k}^{\tau}}{\delta_{k}^{\top} y_{k}} \quad Q_{k}=-\frac{G_{k} y_{k} y_{k}^{\top} G_{k}}{y_{k}^{\top} G_{k} y_{k}}$ï¼Œå°±å¾—åˆ°è¿­ä»£å…¬å¼$G_{k+1}=G_{k}+\frac{\delta_{k} \delta_{k}^{\top}}{\delta_{k}^{\tau} y_{k}}-\frac{G_{k} y_{k} y_{k}^{\top} G_{k}}{y_{k}^{T} G_{k} y_{k}}$</li>
<li><strong>BFGSç®—æ³•</strong>: æœ€æµè¡Œçš„æ‹Ÿç‰›é¡¿ç®—æ³•.å®ƒç”¨$B_k$é€¼è¿‘é»‘å¡çŸ©é˜µ,æ­¤æ—¶ç›¸åº”çš„æ‹Ÿç‰›é¡¿æ¡ä»¶æ˜¯$B_{k+1} \delta_{k}=y_{k}$,å‡è®¾æ¯ä¸€æ­¥$B_{k+1}=B_{k}+P_{k}+Q_{k}$ï¼Œåˆ™ $P_k$ å’Œ $Q_k$ æ»¡è¶³$P_{k} \delta_{k}=y_{k}, \quad Q_{k} \delta_{k}=-B_{k} \delta_{k}$ï¼Œç±»ä¼¼å¾—åˆ°è¿­ä»£å…¬å¼$B_{k+1}=B_{k}+\frac{y_{k} y_{k}^{\top}}{y_{k}^{\top} \delta_{k}}-\frac{B_{k} \delta_{k} \delta_{k}^{\mathrm{T}} B_{k}}{\delta_{k}^{\top} B_{k} \delta_{k}}$</li>
</ol>
<h4 id="å…ˆéªŒæ¦‚ç‡å’ŒåéªŒæ¦‚ç‡"><a href="#å…ˆéªŒæ¦‚ç‡å’ŒåéªŒæ¦‚ç‡" class="headerlink" title="å…ˆéªŒæ¦‚ç‡å’ŒåéªŒæ¦‚ç‡"></a><strong>å…ˆéªŒæ¦‚ç‡å’ŒåéªŒæ¦‚ç‡</strong></h4><ol>
<li>å…ˆéªŒæ¦‚ç‡å°±æ˜¯äº‹æƒ…å‘ç”Ÿå‰çš„é¢„æµ‹æ¦‚ç‡.</li>
<li>åéªŒæ¦‚ç‡æ˜¯ä¸€ç§æ¡ä»¶æ¦‚ç‡ï¼Œå®ƒé™å®šäº†äº‹ä»¶ä¸ºéšå˜é‡å–å€¼ï¼Œè€Œæ¡ä»¶ä¸ºè§‚æµ‹ç»“æœã€‚ä¸€èˆ¬çš„æ¡ä»¶æ¦‚ç‡ï¼Œæ¡ä»¶å’Œäº‹ä»¶å¯ä»¥æ˜¯ä»»æ„çš„.</li>
<li>è´å¶æ–¯å…¬å¼$P(y|x) = ( P(x|y) * P(y) ) / P(x)$ä¸­,$P(y|x)$æ˜¯åéªŒæ¦‚ç‡,$P(x|y)$æ˜¯æ¡ä»¶æ¦‚ç‡,$P(y)$æ˜¯å…ˆéªŒæ¦‚ç‡.</li>
</ol>
<h4 id="åå·®-æ–¹å·®-å™ªå£°"><a href="#åå·®-æ–¹å·®-å™ªå£°" class="headerlink" title="åå·®,æ–¹å·®,å™ªå£°"></a><strong>åå·®,æ–¹å·®,å™ªå£°</strong></h4><ol>
<li>åå·®:åº¦é‡äº†å­¦ä¹ ç®—æ³•çš„æœŸæœ›é¢„æµ‹å’ŒçœŸå®ç»“æœåç¦»ç¨‹åº¦</li>
<li>æ–¹å·®:åº¦é‡äº†åŒæ ·å¤§å°çš„è®­ç»ƒé›†çš„å˜åŠ¨æ‰€å¯¼è‡´çš„å­¦ä¹ æ€§èƒ½çš„å˜åŒ–ï¼Œå³åˆ»ç”»äº†æ•°æ®æ‰°åŠ¨æ‰€é€ æˆçš„å½±å“</li>
<li>å™ªå£°:å¯ä»¥è®¤ä¸ºæ˜¯æ•°æ®è‡ªèº«çš„æ³¢åŠ¨æ€§ï¼Œè¡¨è¾¾äº†ç›®å‰ä»»ä½•å­¦ä¹ ç®—æ³•æ‰€èƒ½è¾¾åˆ°æ³›åŒ–è¯¯å·®çš„ä¸‹é™</li>
<li><p><strong>æ³›åŒ–è¯¯å·®</strong>å¯ä»¥åˆ†è§£ä¸ºåå·®ã€æ–¹å·®ä¸å™ªå£°ä¹‹å’Œ</p>
<h4 id="å¯¹å¶åŸç†"><a href="#å¯¹å¶åŸç†" class="headerlink" title="å¯¹å¶åŸç†"></a><strong>å¯¹å¶åŸç†</strong></h4></li>
</ol>
<p>ä¸€ä¸ªä¼˜åŒ–é—®é¢˜å¯ä»¥ä»ä¸»é—®é¢˜å’Œå¯¹å¶é—®é¢˜ä¸¤ä¸ªæ–¹é¢è€ƒè™‘.åœ¨æ¨å¯¼å¯¹å¶é—®é¢˜æ—¶,é€šè¿‡å°†æ‹‰æ ¼æœ—æ—¥å‡½æ•°å¯¹$x$æ±‚å¯¼å¹¶ä½¿å¯¼æ•°ä¸º0æ¥è·å¾—å¯¹å¶å‡½æ•°.å¯¹å¶å‡½æ•°ç»™å‡ºäº†ä¸»é—®é¢˜æœ€ä¼˜è§£çš„ä¸‹ç•Œ,å› æ­¤å¯¹å¶é—®é¢˜ä¸€èˆ¬æ˜¯å‡¸é—®é¢˜,é‚£ä¹ˆåªéœ€æ±‚è§£å¯¹å¶å‡½æ•°çš„æœ€ä¼˜è§£å°±å¯ä»¥äº†.</p>
<h4 id="KKTæ¡ä»¶"><a href="#KKTæ¡ä»¶" class="headerlink" title="KKTæ¡ä»¶"></a><strong>KKTæ¡ä»¶</strong></h4><p>é€šå¸¸æˆ‘ä»¬è¦æ±‚è§£çš„æœ€ä¼˜åŒ–æ¡ä»¶æœ‰å¦‚ä¸‹ä¸‰ç§:</p>
<ol>
<li>æ— çº¦æŸä¼˜åŒ–é—®é¢˜:é€šå¸¸ä½¿ç”¨æ±‚å¯¼,ä½¿å¯¼æ•°ä¸ºé›¶,æ±‚è§£å€™é€‰æœ€ä¼˜å€¼</li>
<li>æœ‰ç­‰å¼çº¦æŸçš„ä¼˜åŒ–é—®é¢˜:é€šå¸¸ä½¿ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•,å³æŠŠç­‰å¼çº¦æŸç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜å­å’Œä¼˜åŒ–é—®é¢˜åˆå¹¶ä¸ºä¸€ä¸ªå¼å­,é€šè¿‡å¯¹å„ä¸ªå˜é‡æ±‚å¯¼ä½¿å…¶ä¸ºé›¶,æ±‚è§£å€™é€‰æœ€ä¼˜å€¼.æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•å…¶å®æ˜¯KKTæ¡ä»¶åœ¨ç­‰å¼çº¦æŸä¼˜åŒ–é—®é¢˜çš„ç®€åŒ–ç‰ˆ.</li>
<li>æœ‰ä¸ç­‰å¼çº¦æŸçš„ä¼˜åŒ–é—®é¢˜:é€šå¸¸ä½¿ç”¨KKTæ¡ä»¶.å³æŠŠä¸ç­‰å¼çº¦æŸ,ç­‰å¼çº¦æŸå’Œä¼˜åŒ–é—®é¢˜åˆå¹¶ä¸ºä¸€ä¸ªå¼å­.å‡è®¾æœ‰å¤šä¸ªç­‰å¼çº¦æŸ$h(x)$å’Œä¸ç­‰å¼çº¦æŸ$g(x)$,$L(\boldsymbol{x}, \boldsymbol{\lambda}, \boldsymbol{\mu})=f(\boldsymbol{x})+\sum_{i=1}^{m} \lambda_{i} h_{i}(\boldsymbol{x})+\sum_{i=1}^{n} \mu_{j} g_{j}(\boldsymbol{x})$,åˆ™ä¸ç­‰å¼çº¦æŸå¼•å…¥çš„KKTæ¡ä»¶å¦‚ä¸‹:<br>$\left\{\begin{array}{l}g_{j}(\boldsymbol{x}) \leqslant 0 \\ mu_{j} \geqslant 0  \\mu_{j} g_{j}(\boldsymbol{x})=0\end{array}\right.$ ,å®è´¨æ˜¯æœ€ä¼˜è§£åœ¨$g(x)&lt;0$åŒºåŸŸå†…æ—¶,çº¦æŸæ¡ä»¶ä¸èµ·ä½œç”¨,ç­‰ä»·äºå¯¹$Î¼$ç½®é›¶ç„¶åå¯¹åŸå‡½æ•°çš„åå¯¼æ•°ç½®é›¶;å½“$g(x)=0$æ—¶ä¸æƒ…å†µ2ç›¸è¿‘.ç»“åˆä¸¤ç§æƒ…å†µ,é‚£ä¹ˆåªéœ€è¦ä½¿$L$å¯¹$x$æ±‚å¯¼ä¸ºé›¶,ä½¿$h(x)$ä¸ºé›¶,ä½¿$Î¼g(x)$ä¸ºé›¶ä¸‰å¼å³å¯æ±‚è§£å€™é€‰æœ€ä¼˜å€¼.</li>
</ol>
<h4 id="é™ç»´æ–¹æ³•"><a href="#é™ç»´æ–¹æ³•" class="headerlink" title="é™ç»´æ–¹æ³•"></a><strong>é™ç»´æ–¹æ³•</strong></h4><ol>
<li>ä¸»æˆåˆ†åˆ†æ(PCA):é™ç»´,ä¸æ–­é€‰æ‹©ä¸å·²æœ‰åæ ‡è½´æ­£äº¤ä¸”æ–¹å·®æœ€å¤§çš„åæ ‡è½´.</li>
<li>å¥‡å¼‚å€¼åˆ†è§£(SVD):çŸ©é˜µåˆ†è§£,é™ç»´,æ¨èç³»ç»Ÿ. </li>
<li>çº¿æ€§åˆ¤åˆ«åˆ†æ(LDA)</li>
</ol>
<h4 id="é›†æˆæ–¹æ³•"><a href="#é›†æˆæ–¹æ³•" class="headerlink" title="é›†æˆæ–¹æ³•"></a>é›†æˆæ–¹æ³•</h4><h5 id="bagging"><a href="#bagging" class="headerlink" title="bagging"></a>bagging</h5><p>è£…è¢‹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ„å»ºå¤šä¸ªç›¸äº’ç‹¬ç«‹çš„è¯„ä¼°å™¨ï¼Œç„¶åå¯¹å…¶é¢„æµ‹è¿›è¡Œå¹³å‡æˆ–å¤šæ•°è¡¨å†³åŸåˆ™æ¥å†³å®šé›†æˆè¯„ä¼°å™¨çš„ç»“æœã€‚</p>
<ol>
<li>è¯„ä¼°å™¨ï¼šç›¸äº’ç‹¬ç«‹ï¼ŒåŒæ—¶è¿è¡Œ</li>
<li>æŠ½æ ·ï¼šæœ‰æ”¾å›æŠ½æ ·</li>
<li>å¦‚ä½•å†³å®šé›†æˆçš„ç»“æœï¼šå¹³å‡æˆ–è€…å°‘æ•°æœä»å¤šæ•°</li>
<li>ç›®æ ‡ï¼šé™ä½æ–¹å·®</li>
<li>åŸºå­¦ä¹ å™¨è¿‡æ‹Ÿåˆï¼šèƒ½å¤Ÿä¸€å®šç¨‹åº¦ä¸Šè§£å†³åŸºå­¦ä¹ å™¨è¿‡æ‹Ÿåˆçš„é—®é¢˜</li>
<li>åŸºå­¦ä¹ å™¨å­¦ä¹ èƒ½åŠ›å¼±ï¼šä¸æ˜¯å¾ˆæœ‰å¸®åŠ©</li>
<li>ä»£è¡¨ç®—æ³•ï¼šéšæœºæ£®æ—<h5 id="boosting"><a href="#boosting" class="headerlink" title="boosting"></a>boosting</h5>æå‡æ–¹æ³•ä¸­ï¼ŒåŸºè¯„ä¼°å™¨æ˜¯ç›¸å…³çš„ï¼Œæ˜¯æŒ‰é¡ºåºä¸€ä¸€æ„å»ºçš„ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ç»“åˆå¼±è¯„ä¼°å™¨çš„åŠ›é‡ä¸€æ¬¡æ¬¡å¯¹éš¾ä»¥è¯„ä¼°çš„æ ·æœ¬è¿›è¡Œé¢„æµ‹ï¼Œä»è€Œæ„æˆä¸€ä¸ªå¼ºè¯„ä¼°å™¨ã€‚æå‡æ³•çš„ä»£è¡¨æ¨¡å‹æœ‰Adaboostå’Œæ¢¯åº¦æå‡æ ‘ã€‚</li>
<li>è¯„ä¼°å™¨ï¼šç›¸äº’å…³è”ï¼ŒæŒ‰é¡ºåºä¾æ¬¡æ„å»ºï¼Œåå»ºçš„æ¨¡å‹åœ¨å…ˆå»ºæ¨¡å‹é¢„æµ‹å¤±è´¥çš„æ ·æœ¬ä¸Šæœ‰æ›´å¤šçš„æƒé‡</li>
<li>æŠ½æ ·ï¼šæœ‰æ”¾å›çš„é‡‡æ ·ï¼Œä½†ä¼šç¡®è®¤æ•°æ®çš„æƒé‡ï¼Œæ¯æ¬¡æŠ½æ ·éƒ½ä¼šç»™é¢„æµ‹å¤±è´¥çš„æ ·æœ¬æ›´å¤šçš„æƒé‡</li>
<li>å¦‚ä½•å†³å®šé›†æˆçš„ç»“æœï¼šåŠ æƒå¹³å‡ï¼Œåœ¨è®­ç»ƒé›†ä¸Šè¡¨ç°å¥½çš„æ¨¡å‹ä¼šæœ‰æ›´å¤§çš„æƒé‡</li>
<li>ç›®æ ‡ï¼šé™ä½åå·®ï¼Œæé«˜æ¨¡å‹æ•´ä½“çš„ç²¾ç¡®åº¦</li>
<li>åŸºå­¦ä¹ å™¨è¿‡æ‹Ÿåˆï¼šåŠ å‰§è¿‡æ‹Ÿåˆé—®é¢˜</li>
<li>åŸºå­¦ä¹ å™¨å­¦ä¹ èƒ½åŠ›å¼±ï¼šæå‡æ¨¡å‹è¡¨ç°</li>
<li>ä»£è¡¨ç®—æ³•ï¼šGBDT,Adaboost<h5 id="stacking"><a href="#stacking" class="headerlink" title="stacking"></a>stacking</h5>Stackingæ¨¡å‹æ˜¯æŒ‡å°†å¤šç§åˆ†ç±»å™¨ç»„åˆåœ¨ä¸€èµ·æ¥å–å¾—æ›´å¥½è¡¨ç°çš„ä¸€ç§é›†æˆå­¦ä¹ æ¨¡å‹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒStackingæ¨¡å‹åˆ†ä¸ºä¸¤å±‚ã€‚ç¬¬ä¸€å±‚ä¸­æˆ‘ä»¬è®­ç»ƒå¤šä¸ªä¸åŒçš„æ¨¡å‹ï¼Œç„¶åå†ä»¥ç¬¬ä¸€å±‚è®­ç»ƒçš„å„ä¸ªæ¨¡å‹çš„è¾“å‡ºä½œä¸ºè¾“å…¥æ¥è®­ç»ƒç¬¬äºŒå±‚çš„æ¨¡å‹ï¼Œä»¥å¾—åˆ°ä¸€ä¸ªæœ€ç»ˆçš„è¾“å‡ºã€‚</li>
</ol>
<h4 id="æ€§èƒ½åº¦é‡"><a href="#æ€§èƒ½åº¦é‡" class="headerlink" title="æ€§èƒ½åº¦é‡"></a><strong>æ€§èƒ½åº¦é‡</strong></h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center">é¢„æµ‹å€¼</th>
<th style="text-align:center">é¢„æµ‹å€¼</th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">çœŸå®å€¼</td>
<td style="text-align:center">1</td>
<td style="text-align:center">11</td>
<td style="text-align:center">10</td>
<td style="text-align:center">Recall = $\frac{11}{11+10}$</td>
</tr>
<tr>
<td style="text-align:center">çœŸå®å€¼</td>
<td style="text-align:center">0</td>
<td style="text-align:center">01</td>
<td style="text-align:center">00</td>
<td style="text-align:center">FPR = $\frac{01}{01+00}$</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">Precision=$\frac{11}{11+01}$</td>
<td style="text-align:center"></td>
<td style="text-align:center">Acc = $\frac{11+00}{11+10+01+00}$</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li><strong>å‡†ç¡®åº¦</strong>,æœ€å¸¸ç”¨,ä½†åœ¨æ•°æ®é›†ä¸å¹³è¡¡çš„æƒ…å†µä¸‹ä¸å¥½</li>
<li><strong>Precision(ç²¾ç¡®åº¦/æŸ¥å‡†ç‡)</strong>:$P=TP/(TP+FP)$</li>
<li><strong>Recall(å¬å›ç‡/æŸ¥å…¨ç‡)</strong>:$R=TP/(TP+FN)$</li>
<li><strong>FÎ²åº¦é‡</strong>:$F_{\beta}=\frac{\left(1+\beta^{2}\right) r p}{\beta^{2} * p+r}$,å½“Î²=1æ—¶é€€åŒ–ä¸ºF1åº¦é‡,æ˜¯ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå‡å€¼.</li>
<li><strong>TPR(çœŸæ­£ä¾‹ç‡)</strong>:$TPR=TP/(TP+FN)$</li>
<li><strong>FPR(å‡æ­£ä¾‹ç‡)</strong>:$FPR=FP/(TN+FP)$</li>
<li><strong>PRæ›²çº¿</strong>:çºµè½´ä¸ºPrecision,æ¨ªè½´ä¸ºRecall,ä¸€èˆ¬ä½¿ç”¨å¹³è¡¡ç‚¹(BEP,å³Precsion=Recallçš„ç‚¹)ä½œä¸ºè¡¡é‡æ ‡å‡†.</li>
<li><strong>ROC(æ¥å—è€…æ“ä½œç‰¹å¾)æ›²çº¿</strong>:ï¼ˆ<strong>æ¯åˆ¤æ–­æ­£ç¡®ä¸€ä¸ªå°‘æ•°ç±»ï¼Œå°±æœ‰å¤šå°‘ä¸ªå¤šæ•°ç±»ä¼šè¢«åˆ¤æ–­é”™è¯¯ã€‚</strong>ï¼‰çºµè½´ä¸ºTRP,æ¨ªè½´ä¸ºFPR,åœ¨ç»˜å›¾æ—¶å°†åˆ†ç±»é˜ˆå€¼ä¾æ¬¡è®¾ä¸ºæ¯ä¸ªæ ·ä¾‹çš„é¢„æµ‹å€¼,å†è¿æ¥å„ç‚¹.ROCæ›²çº¿å›´ä½çš„é¢ç§¯ç§°ä¸ºAOC,AOCè¶Šå¤§åˆ™å­¦ä¹ å™¨æ€§èƒ½è¶Šå¥½.</li>
</ol>
<h4 id="æŸå¤±å‡½æ•°å’Œé£é™©å‡½æ•°"><a href="#æŸå¤±å‡½æ•°å’Œé£é™©å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°å’Œé£é™©å‡½æ•°"></a><strong>æŸå¤±å‡½æ•°å’Œé£é™©å‡½æ•°</strong></h4><ol>
<li>æŸå¤±å‡½æ•°åº¦é‡æ¨¡å‹ä¸€æ¬¡é¢„æµ‹çš„å¥½å.å¸¸ç”¨çš„æŸå¤±å‡½æ•°æœ‰:0-1æŸå¤±å‡½æ•°,å¹³æ–¹æŸå¤±å‡½æ•°,ç»å¯¹æŸå¤±å‡½æ•°,å¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°.</li>
<li>æŸå¤±å‡½æ•°çš„æœŸæœ›æ˜¯ç†è®ºä¸Šæ¨¡å‹å…³äºè”åˆåˆ†å¸ƒP(X,Y)çš„å¹³å‡æ„ä¹‰ä¸‹çš„æŸå¤±,ç§°ä¸ºé£é™©å‡½æ•°,ä¹Ÿå«<strong>æœŸæœ›é£é™©</strong>.ä½†æ˜¯è”åˆåˆ†å¸ƒæ˜¯æœªçŸ¥çš„,æœŸæœ›é£é™©ä¸èƒ½ç›´æ¥è®¡ç®—.</li>
<li>å½“æ ·æœ¬å®¹é‡Nè¶‹äºæ— ç©·æ—¶ç»éªŒé£é™©è¶‹äºæœŸæœ›é£é™©,ä½†ç°å®ä¸­è®­ç»ƒæ ·æœ¬æ•°ç›®æœ‰é™.</li>
</ol>
<h4 id="ç»éªŒé£é™©æœ€å°åŒ–å’Œç»“æ„é£é™©æœ€å°åŒ–"><a href="#ç»éªŒé£é™©æœ€å°åŒ–å’Œç»“æ„é£é™©æœ€å°åŒ–" class="headerlink" title="ç»éªŒé£é™©æœ€å°åŒ–å’Œç»“æ„é£é™©æœ€å°åŒ–"></a><strong>ç»éªŒé£é™©æœ€å°åŒ–å’Œç»“æ„é£é™©æœ€å°åŒ–</strong></h4><ol>
<li>æ¨¡å‹å…³äºè®­ç»ƒæ•°æ®é›†çš„å¹³å‡æŸå¤±ç§°ä¸ºç»éªŒé£é™©.ç»éªŒé£é™©æœ€å°åŒ–çš„ç­–ç•¥å°±æ˜¯æœ€å°åŒ–ç»éªŒé£é™©.å½“æ ·æœ¬æ•°é‡è¶³å¤Ÿå¤§æ—¶å­¦ä¹ æ•ˆæœè¾ƒå¥½.æ¯”å¦‚å½“æ¨¡å‹æ˜¯æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ,æŸå¤±å‡½æ•°æ˜¯å¯¹æ•°æŸå¤±å‡½æ•°æ—¶,ç»éªŒé£é™©æœ€å°åŒ–å°±ç­‰ä»·äºæå¤§ä¼¼ç„¶ä¼°è®¡.ä½†æ˜¯å½“æ ·æœ¬å®¹é‡å¾ˆå°æ—¶ä¼šå‡ºç°è¿‡æ‹Ÿåˆ.</li>
<li>ç»“æ„é£é™©æœ€å°åŒ–ç­‰äºæ­£åˆ™åŒ–.ç»“æ„é£é™©åœ¨ç»éªŒé£é™©ä¸ŠåŠ ä¸Šè¡¨ç¤ºæ¨¡å‹å¤æ‚åº¦çš„æ­£åˆ™åŒ–é¡¹.æ¯”å¦‚å½“æ¨¡å‹æ˜¯æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ,æŸå¤±å‡½æ•°æ˜¯å¯¹æ•°æŸå¤±å‡½æ•°,æ¨¡å‹å¤æ‚åº¦ç”±æ¨¡å‹çš„å…ˆéªŒæ¦‚ç‡è¡¨ç¤ºæ—¶,ç»“æ„é£é™©æœ€å°åŒ–å°±ç­‰ä»·äºæœ€å¤§åéªŒæ¦‚ç‡ä¼°è®¡.</li>
</ol>
<h4 id="è¿‡æ‹Ÿåˆ"><a href="#è¿‡æ‹Ÿåˆ" class="headerlink" title="è¿‡æ‹Ÿåˆ"></a><strong>è¿‡æ‹Ÿåˆ</strong></h4><p>æŒ‡å­¦ä¹ æ—¶é€‰æ‹©çš„æ¨¡å‹æ‰€åŒ…å«çš„å‚æ•°è¿‡å¤š,ä»¥è‡´äºå¯¹å·²çŸ¥æ•°æ®é¢„æµ‹å¾—å¾ˆå¥½,ä½†å¯¹æœªçŸ¥æ•°æ®é¢„æµ‹å¾ˆå·®çš„ç°è±¡.æ¨¡å‹é€‰æ‹©æ—¨åœ¨é¿å…è¿‡æ‹Ÿåˆå¹¶æé«˜æ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›.</p>
<h4 id="æ­£åˆ™åŒ–"><a href="#æ­£åˆ™åŒ–" class="headerlink" title="æ­£åˆ™åŒ–"></a><strong>æ­£åˆ™åŒ–</strong></h4><p>æ¨¡å‹é€‰æ‹©çš„å…¸å‹æ–¹æ³•.æ­£åˆ™åŒ–é¡¹ä¸€èˆ¬æ˜¯æ¨¡å‹å¤æ‚åº¦çš„å•è°ƒé€’å¢å‡½æ•°,æ¯”å¦‚æ¨¡å‹å‚æ•°å‘é‡çš„èŒƒæ•°.</p>
<h4 id="äº¤å‰éªŒè¯"><a href="#äº¤å‰éªŒè¯" class="headerlink" title="äº¤å‰éªŒè¯"></a><strong>äº¤å‰éªŒè¯</strong></h4><p>æ˜¯å¦ä¸€å¸¸ç”¨çš„æ¨¡å‹é€‰æ‹©æ–¹æ³•,å¯åˆ†ä¸ºç®€å•äº¤å‰éªŒè¯,KæŠ˜äº¤å‰éªŒè¯,ç•™ä¸€äº¤å‰éªŒè¯ç­‰.</p>
<h4 id="sklearn"><a href="#sklearn" class="headerlink" title="sklearn"></a>sklearn</h4><p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/sklearn.png" alt="avatar"></p>
<h3 id="æ„ŸçŸ¥æœº"><a href="#æ„ŸçŸ¥æœº" class="headerlink" title="æ„ŸçŸ¥æœº"></a>æ„ŸçŸ¥æœº</h3><p>æ„ŸçŸ¥æœºæ˜¯<strong>äºŒç±»åˆ†ç±»</strong>çš„çº¿æ€§æ¨¡å‹,å±äºåˆ¤åˆ«æ¨¡å‹.æ„ŸçŸ¥æœºå­¦ä¹ æ—¨åœ¨æ±‚å‡ºå°†è®­ç»ƒæ•°æ®è¿›è¡Œçº¿æ€§åˆ’åˆ†çš„åˆ†ç¦»è¶…å¹³é¢.æ˜¯ç¥ç»ç½‘ç»œå’Œæ”¯æŒå‘é‡æœºçš„åŸºç¡€.</p>
<h4 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p>$f(x)=sign(wx + b)$,$w$å«ä½œæƒå€¼å‘é‡,$b$å«åšåç½®,$sign$æ˜¯ç¬¦å·å‡½æ•°.</p>
<h4 id="æ„ŸçŸ¥æœºçš„å‡ ä½•è§£é‡Š"><a href="#æ„ŸçŸ¥æœºçš„å‡ ä½•è§£é‡Š" class="headerlink" title="æ„ŸçŸ¥æœºçš„å‡ ä½•è§£é‡Š"></a><strong>æ„ŸçŸ¥æœºçš„å‡ ä½•è§£é‡Š</strong></h4><p>$wx+b$å¯¹åº”äºç‰¹å¾ç©ºé—´ä¸­çš„ä¸€ä¸ªåˆ†ç¦»è¶…å¹³é¢S,å…¶ä¸­$w$æ˜¯$S$çš„æ³•å‘é‡,$b$æ˜¯$S$çš„æˆªè·.$S$å°†ç‰¹å¾ç©ºé—´åˆ’åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†,ä½äºä¸¤ä¸ªéƒ¨åˆ†çš„ç‚¹åˆ†åˆ«è¢«åˆ†ä¸ºæ­£è´Ÿä¸¤ç±».</p>
<h4 id="ç­–ç•¥"><a href="#ç­–ç•¥" class="headerlink" title="ç­–ç•¥"></a>ç­–ç•¥</h4><p>å‡è®¾è®­ç»ƒæ•°æ®é›†æ˜¯çº¿æ€§å¯åˆ†çš„,æ„ŸçŸ¥æœºçš„æŸå¤±å‡½æ•°æ˜¯è¯¯åˆ†ç±»ç‚¹åˆ°è¶…å¹³é¢$S$çš„æ€»è·ç¦».å› ä¸ºè¯¯åˆ†ç±»ç‚¹åˆ°è¶…å¹³é¢$S$çš„è·ç¦»æ˜¯$\frac{1}{|w|}\left|w \cdot x_{0}+b\right|$,ä¸”å¯¹äºè¯¯åˆ†ç±»çš„æ•°æ®æ¥è¯´,æ€»æœ‰$-y_i(wx_i+b)&gt;0$æˆç«‹,å› æ­¤ä¸è€ƒè™‘$\frac{1}{|w|}$,å°±å¾—åˆ°æ„ŸçŸ¥æœºçš„æŸå¤±å‡½æ•°:</p>
<p>$L(w, b)=-\sum_{x \in M} y_{i}\left(w \cdot x_{i}+b\right)$,å…¶ä¸­Mæ˜¯è¯¯åˆ†ç±»ç‚¹çš„é›†åˆ.æ„ŸçŸ¥æœºå­¦ä¹ çš„ç­–ç•¥å°±æ˜¯é€‰å–ä½¿æŸå¤±å‡½æ•°æœ€å°çš„æ¨¡å‹å‚æ•°.</p>
<h4 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h4><p>æ„ŸçŸ¥æœºçš„æœ€ä¼˜åŒ–æ–¹æ³•é‡‡ç”¨<strong>éšæœºæ¢¯åº¦ä¸‹é™æ³•</strong>.é¦–å…ˆä»»æ„é€‰å–ä¸€ä¸ªè¶…å¹³é¢$w_0,b_0$,ç„¶åä¸æ–­åœ°æå°åŒ–ç›®æ ‡å‡½æ•°.åœ¨æå°åŒ–è¿‡ç¨‹ä¸­ä¸€æ¬¡éšæœºé€‰å–ä¸€ä¸ªè¯¯åˆ†ç±»ç‚¹æ›´æ–°$w,b$,ç›´åˆ°æŸå¤±å‡½æ•°ä¸º0.$w \leftarrow w+\eta y_{i} x_{i}$ ï¼Œ $b \leftarrow b+\eta y_{i}$ï¼Œå…¶ä¸­$Î·$è¡¨ç¤ºæ­¥é•¿.è¯¥ç®—æ³•çš„ç›´è§‚è§£é‡Šæ˜¯:å½“ä¸€ä¸ªç‚¹è¢«è¯¯åˆ†ç±»,å°±è°ƒæ•´$w,b$ä½¿åˆ†ç¦»è¶…å¹³é¢å‘è¯¥è¯¯åˆ†ç±»ç‚¹æ¥è¿‘.æ„ŸçŸ¥æœºçš„è§£å¯ä»¥ä¸åŒ.</p>
<h4 id="å¯¹å¶å½¢å¼"><a href="#å¯¹å¶å½¢å¼" class="headerlink" title="å¯¹å¶å½¢å¼"></a><strong>å¯¹å¶å½¢å¼</strong></h4><p>å‡è®¾åŸå§‹å½¢å¼ä¸­çš„$w_0$å’Œ$b_0$å‡ä¸º0,è®¾é€æ­¥ä¿®æ”¹$w$å’Œ$b$å…±næ¬¡,ä»¤$a=nÎ·$,æœ€åå­¦ä¹ åˆ°çš„$w,b$å¯ä»¥è¡¨ç¤ºä¸º$w =\sum_{i=1}^{N} \alpha_{i} y_{i} x_{i}$,$b =\sum_{i=1}^{N}{\alpha_{i} y_{i}}$ ,é‚£ä¹ˆå¯¹å¶ç®—æ³•å°±å˜ä¸ºè®¾åˆå§‹$a$å’Œ$b$å‡ä¸º0,æ¯æ¬¡é€‰å–æ•°æ®æ›´æ–°$a$å’Œ$b$ç›´è‡³æ²¡æœ‰è¯¯åˆ†ç±»ç‚¹ä¸ºæ­¢.å¯¹å¶å½¢å¼çš„æ„ä¹‰åœ¨äºå¯ä»¥å°†è®­ç»ƒé›†ä¸­å®ä¾‹é—´çš„å†…ç§¯è®¡ç®—å‡ºæ¥,å­˜åœ¨GramçŸ©é˜µä¸­,å¯ä»¥å¤§å¤§åŠ å¿«è®­ç»ƒé€Ÿåº¦.</p>
<h3 id="kè¿‘é‚»æ³•"><a href="#kè¿‘é‚»æ³•" class="headerlink" title="kè¿‘é‚»æ³•"></a>kè¿‘é‚»æ³•</h3><p>kè¿‘é‚»æ³•æ ¹æ®å…¶<strong>kä¸ªæœ€è¿‘é‚»</strong>çš„è®­ç»ƒå®ä¾‹çš„ç±»åˆ«,é€šè¿‡å¤šæ•°è¡¨å†³ç­‰æ–¹å¼è¿›è¡Œé¢„æµ‹.å½“k=1æ—¶ç§°ä¸ºæœ€è¿‘é‚»ç®—æ³•.</p>
<h4 id="ä¸‰ä¸ªåŸºæœ¬è¦ç´ "><a href="#ä¸‰ä¸ªåŸºæœ¬è¦ç´ " class="headerlink" title="ä¸‰ä¸ªåŸºæœ¬è¦ç´ :"></a>ä¸‰ä¸ªåŸºæœ¬è¦ç´ :</h4><ol>
<li>kå€¼çš„é€‰æ‹©</li>
<li>è·ç¦»åº¦é‡</li>
<li>åˆ†ç±»å†³ç­–è§„åˆ™</li>
</ol>
<h4 id="æ¨¡å‹-1"><a href="#æ¨¡å‹-1" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p>å½“è®­ç»ƒé›†,è·ç¦»åº¦é‡,kå€¼ä»¥åŠåˆ†ç±»å†³ç­–è§„åˆ™ç¡®å®šå,ç‰¹å¾ç©ºé—´å·²ç»æ ¹æ®è¿™äº›è¦ç´ è¢«åˆ’åˆ†ä¸ºä¸€äº›å­ç©ºé—´,ä¸”å­ç©ºé—´é‡Œæ¯ä¸ªç‚¹æ‰€å±çš„ç±»ä¹Ÿå·²è¢«ç¡®å®š.</p>
<h4 id="ç­–ç•¥-1"><a href="#ç­–ç•¥-1" class="headerlink" title="ç­–ç•¥"></a><strong>ç­–ç•¥</strong></h4><ol>
<li><strong>è·ç¦»</strong>:ç‰¹å¾ç©ºé—´ä¸­ä¸¤ä¸ªå®ä¾‹ç‚¹çš„è·ç¦»æ˜¯ç›¸ä¼¼ç¨‹åº¦çš„åæ˜ ,kè¿‘é‚»ç®—æ³•ä¸€èˆ¬ä½¿ç”¨æ¬§æ°è·ç¦»,ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´ä¸€èˆ¬çš„Lpè·ç¦»æˆ–Minkowskiè·ç¦».</li>
<li><strong>kå€¼</strong>:kå€¼è¾ƒå°æ—¶,æ•´ä½“æ¨¡å‹å˜å¾—å¤æ‚,å®¹æ˜“å‘ç”Ÿè¿‡æ‹Ÿåˆ.kå€¼è¾ƒå¤§æ—¶,æ•´ä½“æ¨¡å‹å˜å¾—ç®€å•.åœ¨åº”ç”¨ä¸­kä¸€èˆ¬å–è¾ƒå°çš„å€¼,é€šè¿‡äº¤å‰éªŒè¯æ³•é€‰å–æœ€ä¼˜çš„k.</li>
<li><p><strong>åˆ†ç±»å†³ç­–è§„åˆ™</strong>:kè¿‘é‚»ä¸­çš„åˆ†ç±»å†³ç­–è§„åˆ™å¾€å¾€æ˜¯å¤šæ•°è¡¨å†³,å¤šæ•°è¡¨å†³è§„åˆ™ç­‰ä»·äºç»éªŒé£é™©æœ€å°åŒ–.</p>
<h4 id="ç®—æ³•-1"><a href="#ç®—æ³•-1" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h4></li>
</ol>
<p>æ ¹æ®ç»™å®šçš„è·ç¦»åº¦é‡,åœ¨è®­ç»ƒé›†ä¸­æ‰¾å‡ºä¸xæœ€é‚»è¿‘çš„kä¸ªç‚¹,æ ¹æ®åˆ†ç±»è§„åˆ™å†³å®šxçš„ç±»åˆ«y.</p>
<p><strong>kdæ ‘</strong></p>
<ol>
<li><p>kdæ ‘å°±æ˜¯ä¸€ç§å¯¹kç»´ç©ºé—´ä¸­çš„å®ä¾‹ç‚¹è¿›è¡Œå­˜å‚¨ä»¥ä¾¿å¯¹å…¶è¿›è¡Œå¿«é€Ÿæ£€ç´¢çš„æ ‘å½¢æ•°æ®ç»“æ„.kdæ ‘æ›´é€‚ç”¨äº<strong>è®­ç»ƒå®ä¾‹æ•°è¿œå¤§äºç©ºé—´ç»´æ•°</strong>æ—¶çš„kè¿‘é‚»æœç´¢.</p>
</li>
<li><p><strong>æ„é€ </strong>:å¯ä»¥é€šè¿‡å¦‚ä¸‹<strong>é€’å½’</strong>å®ç°:åœ¨è¶…çŸ©å½¢åŒºåŸŸä¸Šé€‰æ‹©ä¸€ä¸ª<strong>åæ ‡è½´</strong>å’Œæ­¤åæ ‡è½´ä¸Šçš„ä¸€ä¸ª<strong>åˆ‡åˆ†ç‚¹</strong>,ç¡®å®šä¸€ä¸ªè¶…å¹³é¢,è¯¥è¶…å¹³é¢å°†å½“å‰è¶…çŸ©å½¢åŒºåŸŸåˆ‡åˆ†ä¸ºä¸¤ä¸ªå­åŒºåŸŸ.åœ¨å­åŒºåŸŸä¸Šé‡å¤åˆ‡åˆ†ç›´åˆ°å­åŒºåŸŸå†…æ²¡æœ‰å®ä¾‹æ—¶ç»ˆæ­¢.é€šå¸¸ä¾æ¬¡é€‰æ‹©åæ ‡è½´å’Œé€‰å®šåæ ‡è½´ä¸Šçš„<strong>ä¸­ä½æ•°ç‚¹</strong>ä¸ºåˆ‡åˆ†ç‚¹,è¿™æ ·å¯ä»¥å¾—åˆ°å¹³è¡¡kdæ ‘.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/kd_tree.png" alt="avatar"></p>
</li>
</ol>
<h4 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a><strong>æœç´¢</strong></h4><p>ä»æ ¹èŠ‚ç‚¹å‡ºå‘,è‹¥ç›®æ ‡ç‚¹xå½“å‰ç»´çš„åæ ‡å°äºåˆ‡åˆ†ç‚¹çš„åæ ‡åˆ™ç§»åŠ¨åˆ°å·¦å­ç»“ç‚¹,å¦åˆ™ç§»åŠ¨åˆ°å³å­ç»“ç‚¹,ç›´åˆ°å­ç»“ç‚¹ä¸ºå¶ç»“ç‚¹ä¸ºæ­¢.ä»¥æ­¤å¶ç»“ç‚¹ä¸ºâ€å½“å‰æœ€è¿‘ç‚¹â€,<strong>é€’å½’</strong>åœ°å‘ä¸Šå›é€€,åœ¨æ¯ä¸ªç»“ç‚¹:(a)å¦‚æœè¯¥ç»“ç‚¹æ¯”å½“å‰æœ€è¿‘ç‚¹è·ç¦»ç›®æ ‡ç‚¹æ›´è¿‘,åˆ™ä»¥è¯¥ç»“ç‚¹ä¸ºâ€å½“å‰æœ€è¿‘ç‚¹â€(b)â€å½“å‰æœ€è¿‘ç‚¹â€ä¸€å®šå­˜åœ¨äºè¯¥ç»“ç‚¹ä¸€ä¸ªå­ç»“ç‚¹å¯¹åº”çš„åŒºåŸŸ,æ£€æŸ¥è¯¥ç»“ç‚¹çš„å¦ä¸€å­ç»“ç‚¹å¯¹åº”çš„åŒºåŸŸæ˜¯å¦ä¸ä»¥ç›®æ ‡ç‚¹ä¸ºçƒå¿ƒ,ä»¥ç›®æ ‡ç‚¹ä¸â€å½“å‰æœ€è¿‘ç‚¹â€é—´çš„è·ç¦»ä¸ºåŠå¾„çš„è¶…çƒä½“ç›¸äº¤.å¦‚æœç›¸äº¤,ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå­ç»“ç‚¹,å¦‚æœä¸ç›¸äº¤,å‘ä¸Šå›é€€.æŒç»­è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°å›é€€åˆ°æ ¹ç»“ç‚¹,æœ€åçš„â€å½“å‰æœ€è¿‘ç‚¹â€å³ä¸ºæœ€è¿‘é‚»ç‚¹.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/search_kd.png" alt="avatar"></p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/search_kd_2.png" alt="avatar"></p>
<h3 id="æœ´ç´ è´å¶æ–¯"><a href="#æœ´ç´ è´å¶æ–¯" class="headerlink" title="æœ´ç´ è´å¶æ–¯"></a>æœ´ç´ è´å¶æ–¯</h3><p>æœ´ç´ è´å¶æ–¯æ˜¯åŸºäº<strong>è´å¶æ–¯å®šç†</strong>å’Œ<strong>ç‰¹å¾æ¡ä»¶ç‹¬ç«‹å‡è®¾</strong>çš„åˆ†ç±»æ–¹æ³•.é¦–å…ˆå­¦ä¹ è¾“å…¥/è¾“å‡ºçš„è”åˆæ¦‚ç‡åˆ†å¸ƒ,ç„¶ååŸºäºæ­¤æ¨¡å‹,å¯¹ç»™å®šçš„è¾“å…¥x,åˆ©ç”¨è´å¶æ–¯å®šç†æ±‚å‡ºåéªŒæ¦‚ç‡æœ€å¤§çš„è¾“å‡ºy.å±äºç”Ÿæˆæ¨¡å‹.</p>
<h4 id="æ¨¡å‹-2"><a href="#æ¨¡å‹-2" class="headerlink" title="æ¨¡å‹"></a><strong>æ¨¡å‹</strong></h4><ol>
<li>é¦–å…ˆå­¦ä¹ å…ˆéªŒæ¦‚ç‡åˆ†å¸ƒ$p(c_k),k=1,2,3,4,â€¦,k$</li>
<li>ç„¶åå­¦ä¹ æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ,$P\left(X=x | Y=c_{k}\right)=P\left(X^{(1)}=x^{(1)}, \cdots, X^{(n)}=x^{(n)} | Y=c_{k}\right)$.å¦‚æœä¼°è®¡å®é™…,éœ€è¦æŒ‡æ•°çº§çš„è®¡ç®—,æ‰€ä»¥æœ´ç´ è´å¶æ–¯æ³•å¯¹æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒä½œäº†æ¡ä»¶ç‹¬ç«‹æ€§çš„å‡è®¾,ä¸Šå¼å˜æˆ$\prod_{j=1}^{n} P\left(X^{(n)}=x^{(n)} | Y=c_{k}\right)$</li>
<li>åœ¨åˆ†ç±»æ—¶,é€šè¿‡å­¦ä¹ åˆ°çš„æ¨¡å‹è®¡ç®—åéªŒæ¦‚ç‡åˆ†å¸ƒ,ç”±è´å¶æ–¯å®šç†å¾—åˆ°$P\left(Y=c_{k} | X=x\right)=\frac{P\left(X=x | Y=c_{k}\right) P\left(Y=c_{k}\right)}{\sum_{k} P\left(X=x | Y=c_{k}\right) P\left(Y=c_{k}\right)}$</li>
<li>å°†æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾å¾—åˆ°çš„ç­‰å¼ä»£å…¥,å¹¶ä¸”æ³¨æ„åˆ°åˆ†æ¯éƒ½æ˜¯ç›¸åŒçš„,æ‰€ä»¥å¾—åˆ°æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨:$y=\arg \max _{a_{k}} P\left(Y=c_{k}\right) \prod_{j} P\left(X^{(l)}=x^{(l)} | Y=c_{k}\right)$</li>
</ol>
<p>æœ´ç´ è´å¶æ–¯å°†å®ä¾‹åˆ†åˆ°åéªŒæ¦‚ç‡æœ€å¤§çš„ç±»ä¸­,è¿™ç­‰ä»·äºæœŸæœ›é£é™©æœ€å°åŒ–.</p>
<h4 id="ç®—æ³•-2"><a href="#ç®—æ³•-2" class="headerlink" title="ç®—æ³•"></a><strong>ç®—æ³•</strong></h4><ol>
<li>ä½¿ç”¨<strong>æå¤§ä¼¼ç„¶ä¼°è®¡æ³•</strong>ä¼°è®¡ç›¸åº”çš„å…ˆéªŒæ¦‚ç‡:$P\left(Y=c_{k}\right)=\frac{\sum_{i=1}^{N} I\left(y_{i}=c_{k}\right)}{N}, \quad k=1,2, \cdots, K$å’Œæ¡ä»¶æ¦‚ç‡$P\left(X^{(j)}=a_{n} | Y=c_{k}\right)=\frac{\sum_{i=1}^{N} I\left(x_{i}^{(n)}=a_{j i} y_{i}=c_{k}\right)}{\sum_{i=1}^{N} I\left(y_{i}=c_{k}\right)}$</li>
<li>è®¡ç®—æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾ä¸‹çš„å®ä¾‹å„ä¸ªå–å€¼çš„å¯èƒ½æ€§,$P\left(Y=c_{k}\right) \prod_{j=1}^{n} P\left(X^{(j)}=x^{(j)} | Y=c_{k}\right), \quad k=1,2, \cdots, K$</li>
<li>é€‰å–å…¶ä¸­çš„æœ€å¤§å€¼ä½œä¸ºè¾“å‡º.</li>
</ol>
<h4 id="ç‰¹æ®Šæƒ…å†µ"><a href="#ç‰¹æ®Šæƒ…å†µ" class="headerlink" title="ç‰¹æ®Šæƒ…å†µ"></a>ç‰¹æ®Šæƒ…å†µ</h4><ol>
<li>ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡å¯èƒ½ä¼šå‡ºç°æ‰€è¦ä¼°è®¡çš„æ¦‚ç‡å€¼ä¸º0çš„æƒ…å†µ,åœ¨ç´¯ä¹˜åä¼šå½±å“åéªŒæ¦‚ç‡çš„è®¡ç®—ç»“æœ,ä½¿åˆ†ç±»äº§ç”Ÿåå·®.å¯ä»¥é‡‡ç”¨<strong>è´å¶æ–¯ä¼°è®¡</strong>,åœ¨éšæœºå˜é‡å„ä¸ªå–å€¼çš„é¢‘æ•°ä¸Šèµ‹äºˆä¸€ä¸ªæ­£æ•°.$P_{\lambda}\left(X^{(1)}=a_{j q} | Y=c_{k}\right)=\frac{\sum_{i=1}^{N} I\left(x_{i}^{(l)}=a_{\beta}, y_{i}=c_{k}\right)+\lambda}{\sum_{i=1}^{N} I\left(y_{i}=c_{k}\right)+S_{j} \lambda}$ï¼Œ$S_j$ä¸ºjå±æ€§å¯èƒ½å–å€¼æ•°é‡,å½“$Î»=0$æ—¶å°±æ˜¯æå¤§ä¼¼ç„¶ä¼°è®¡.å¸¸å–$Î»=1$,ç§°ä¸º<strong>æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘</strong>.</li>
<li>å¦‚æœæ˜¯è¿ç»­å€¼çš„æƒ…å†µ,å¯ä»¥å‡è®¾è¿ç»­å˜é‡æœä»é«˜æ–¯åˆ†å¸ƒ,ç„¶åç”¨è®­ç»ƒæ•°æ®ä¼°è®¡å‚æ•°.$P\left(X_{i}=x_{i} | Y=y_{i}\right)=\frac{1}{\sqrt{2 \pi} \sigma_{i j}^{2}} e^{\frac{\left(x_{i}-\mu_{j}\right)^{2}}{2 \sigma_{i}^{2}}}$</li>
</ol>
<h3 id="å†³ç­–æ ‘"><a href="#å†³ç­–æ ‘" class="headerlink" title="å†³ç­–æ ‘"></a>å†³ç­–æ ‘</h3><p>å†³ç­–æ ‘æ˜¯ä¸€ç§åŸºæœ¬çš„åˆ†ç±»ä¸å›å½’æ–¹æ³•.å®ƒå¯ä»¥è®¤ä¸ºæ˜¯<strong>if-thenè§„åˆ™</strong>çš„é›†åˆ,ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯å®šä¹‰åœ¨ç‰¹å¾ç©ºé—´ä¸ç±»ç©ºé—´ä¸Šçš„<strong>æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ</strong>.ä¸»è¦ä¼˜ç‚¹æ˜¯æ¨¡å‹å…·æœ‰å¯è¯»æ€§,åˆ†ç±»é€Ÿåº¦å¿«.å…¶ä¸»è¦å›´ç»•ç€ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>å¦‚ä½•ä»æ•°æ®è¡¨ä¸­æ‰¾å‡ºæœ€ä½³èŠ‚ç‚¹å’Œæœ€ä½³åˆ†æï¼Ÿ</li>
<li>å¦‚ä½•è®©å†³ç­–æ ‘åœæ­¢ç”Ÿé•¿ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆï¼Ÿ</li>
</ol>
<h4 id="æ¨¡å‹-3"><a href="#æ¨¡å‹-3" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p>åˆ†ç±»å†³ç­–æ ‘ç”±<strong>ç»“ç‚¹</strong>å’Œ<strong>æœ‰å‘è¾¹</strong>ç»„æˆ.ç»“ç‚¹åˆ†ä¸º<strong>å†…éƒ¨ç»“ç‚¹</strong>(è¡¨ç¤ºä¸€ä¸ªç‰¹å¾æˆ–å±æ€§)å’Œ<strong>å¶ç»“ç‚¹</strong>(è¡¨ç¤ºä¸€ä¸ªç±»).å†³ç­–æ ‘çš„è·¯å¾„å…·æœ‰<strong>äº’æ–¥ä¸”å®Œå¤‡</strong>çš„æ€§è´¨.</p>
<h4 id="ç­–ç•¥-2"><a href="#ç­–ç•¥-2" class="headerlink" title="ç­–ç•¥"></a>ç­–ç•¥</h4><p>å†³ç­–æ ‘å­¦ä¹ æœ¬è´¨ä¸Šæ˜¯ä»è®­ç»ƒæ•°æ®é›†ä¸­å½’çº³å‡ºä¸€ç»„åˆ†ç±»è§„åˆ™.æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªä¸è®­ç»ƒæ•°æ®<strong>çŸ›ç›¾è¾ƒå°</strong>,åŒæ—¶å…·æœ‰å¾ˆå¥½çš„<strong>æ³›åŒ–èƒ½åŠ›</strong>çš„å†³ç­–æ ‘.ä»æ‰€æœ‰å¯èƒ½çš„å†³ç­–æ ‘ä¸­é€‰å–æœ€ä¼˜å†³ç­–æ ‘æ˜¯NPå®Œå…¨é—®é¢˜,æ‰€ä»¥ç°å®ä¸­å¸¸é‡‡ç”¨<strong>å¯å‘å¼æ–¹æ³•</strong>è¿‘ä¼¼æ±‚è§£.</p>
<h4 id="ç®—æ³•-3"><a href="#ç®—æ³•-3" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h4><p>å†³ç­–æ ‘å­¦ä¹ ç®—æ³•åŒ…å«<strong>ç‰¹å¾é€‰æ‹©</strong>,<strong>å†³ç­–æ ‘çš„ç”Ÿæˆ</strong>ä¸<strong>å†³ç­–æ ‘çš„å‰ªæè¿‡ç¨‹</strong>.ç”Ÿæˆåªè€ƒè™‘å±€éƒ¨æœ€ä¼˜,å‰ªæåˆ™è€ƒè™‘å…¨å±€æœ€ä¼˜ã€‚</p>
<h4 id="ç‰¹å¾é€‰æ‹©"><a href="#ç‰¹å¾é€‰æ‹©" class="headerlink" title="ç‰¹å¾é€‰æ‹©"></a>ç‰¹å¾é€‰æ‹©</h4><p>å¦‚æœåˆ©ç”¨ä¸€ä¸ªç‰¹å¾è¿›è¡Œåˆ†ç±»çš„ç»“æœä¸éšæœºåˆ†ç±»çš„ç»“æœæ²¡æœ‰å¾ˆå¤§å·®åˆ«,åˆ™ç§°è¿™ä¸ªç‰¹å¾æ˜¯<strong>æ²¡æœ‰åˆ†ç±»èƒ½åŠ›</strong>çš„.æ‰”æ‰è¿™æ ·çš„ç‰¹å¾å¯¹å†³ç­–æ ‘å­¦ä¹ çš„ç²¾åº¦å½±å“ä¸å¤§.</p>
<ol>
<li><strong>ä¿¡æ¯ç†µ</strong>ï¼šç†µæ˜¯è¡¡é‡<strong>éšæœºå˜é‡ä¸ç¡®å®šæ€§</strong>çš„åº¦é‡.ç†µè¶Šå¤§,éšæœºå˜é‡çš„ä¸ç¡®å®šæ€§å°±è¶Šå¤§.ä¿¡æ¯ç†µæ˜¯ä¿¡æ¯é‡çš„æœŸæœ›ï¼Œ$\left.H(X)=-\sum_{x \in X} P(x) \log P(x)\right)$</li>
<li><strong>æ¡ä»¶ç†µ</strong>ï¼šæ¡ä»¶ç†µè¡¨ç¤ºåœ¨å·²çŸ¥éšæœºå˜é‡Xçš„æ¡ä»¶ä¸‹éšæœºå˜é‡Yçš„ä¸ç¡®å®šæ€§.$H(Y | X)=\sum_{i=1}^{n} p_{i} H\left(Y | X=x_{i}\right)$</li>
<li><strong>ä¿¡æ¯å¢ç›Š</strong>ï¼šè¡¨ç¤ºå¾—çŸ¥ç‰¹å¾Xçš„ä¿¡æ¯è€Œä½¿å¾—ç±»Yçš„ä¿¡æ¯çš„<strong>ä¸ç¡®å®šæ€§å‡å°‘</strong>çš„ç¨‹åº¦.å®šä¹‰ä¸ºé›†åˆDçš„ç»éªŒç†µä¸ç‰¹å¾Aåœ¨ç»™å®šæ¡ä»¶ä¸‹Dçš„ç»éªŒæ¡ä»¶ç†µä¹‹å·®$g(D,A)=H(D)-H(D|A)$,ä¹Ÿå°±æ˜¯è®­ç»ƒæ•°æ®é›†ä¸­ç±»ä¸ç‰¹å¾çš„<strong>äº’ä¿¡æ¯</strong>.</li>
<li><strong>ä¿¡æ¯å¢ç›Šç®—æ³•</strong>:è®¡ç®—æ•°æ®é›†Dçš„ç»éªŒç†µ$H(D)=-\sum_{k=1}^{K} \frac{\left|C_{k}\right|_{\mathrm{log}_{2}}\left|C_{k}\right|}{|D|}$,è®¡ç®—ç‰¹å¾Aå¯¹æ•°æ®é›†Dçš„ç»éªŒæ¡ä»¶ç†µ$H(D | A)=\sum_{i=1}^{n} \frac{\left|D_{i}\right|}{|D|} H\left(D_{i}\right)=-\sum_{i=1}^{n} \frac{\left|D_{i}\right|}{|D|} \sum_{k=1}^{K} \frac{\left|D_{\mu}\right|}{\left|D_{i}\right|} \log _{2} \frac{\left|D_{k}\right|}{\left|D_{i}\right|}$,è®¡ç®—ä¿¡æ¯å¢ç›Š,é€‰å–ä¿¡æ¯å¢ç›Šæœ€å¤§çš„ç‰¹å¾.</li>
<li><strong>ä¿¡æ¯å¢ç›Šæ¯”</strong>:ä¿¡æ¯å¢ç›Šå€¼çš„å¤§å°æ˜¯ç›¸å¯¹äºè®­ç»ƒæ•°æ®é›†è€Œè¨€çš„,å¹¶æ— ç»å¯¹æ„ä¹‰.ä½¿ç”¨ä¿¡æ¯å¢ç›Šæ¯”,$g_{R}(D, A)=\frac{g(D, A)}{H(D)}$å¯ä»¥å¯¹è¿™ä¸€é—®é¢˜è¿›è¡Œæ ¡æ­£.</li>
</ol>
<h4 id="å†³ç­–æ ‘çš„ç”Ÿæˆ"><a href="#å†³ç­–æ ‘çš„ç”Ÿæˆ" class="headerlink" title="å†³ç­–æ ‘çš„ç”Ÿæˆ"></a><strong>å†³ç­–æ ‘çš„ç”Ÿæˆ</strong></h4><ol>
<li><strong>ID3ç®—æ³•</strong>:æ ¸å¿ƒæ˜¯åœ¨å†³ç­–æ ‘å„ä¸ªç»“ç‚¹ä¸Šåº”ç”¨<strong>ä¿¡æ¯å¢ç›Šå‡†åˆ™</strong>é€‰æ‹©ä¿¡æ¯å¢ç›Šæœ€å¤§ä¸”å¤§äºé˜ˆå€¼çš„ç‰¹å¾,é€’å½’åœ°æ„å»ºå†³ç­–æ ‘.ID3ç›¸å½“äºç”¨æå¤§ä¼¼ç„¶æ³•è¿›è¡Œæ¦‚ç‡æ¨¡å‹çš„é€‰æ‹©.ç”±äºç®—æ³•åªæœ‰æ ‘çš„ç”Ÿæˆ,æ‰€ä»¥å®¹æ˜“äº§ç”Ÿè¿‡æ‹Ÿåˆ.</li>
<li><strong>C4.5ç®—æ³•</strong>:C4.5ç®—æ³•ä¸ID3ç®—æ³•ç›¸ä¼¼,æ”¹ç”¨<strong>ä¿¡æ¯å¢ç›Šæ¯”</strong>æ¥é€‰æ‹©ç‰¹å¾.</li>
</ol>
<h4 id="å†³ç­–æ ‘çš„å‰ªæ"><a href="#å†³ç­–æ ‘çš„å‰ªæ" class="headerlink" title="å†³ç­–æ ‘çš„å‰ªæ"></a><strong>å†³ç­–æ ‘çš„å‰ªæ</strong></h4><ol>
<li>åœ¨å­¦ä¹ æ—¶è¿‡å¤šè€ƒè™‘å¦‚ä½•æé«˜å¯¹è®­ç»ƒæ•°æ®çš„æ­£ç¡®åˆ†ç±»,ä»è€Œæ„å»ºå‡ºè¿‡äºå¤æ‚çš„å†³ç­–æ ‘,äº§ç”Ÿ<strong>è¿‡æ‹Ÿåˆ</strong>ç°è±¡.è§£å†³æ–¹æ³•æ˜¯å¯¹å·²ç”Ÿæˆçš„å†³ç­–æ ‘è¿›è¡Œç®€åŒ–,ç§°ä¸ºå‰ªæ.</li>
<li>è®¾æ ‘çš„å¶ç»“ç‚¹ä¸ªæ•°ä¸º$|T|$,æ¯ä¸ªå¶ç»“ç‚¹æœ‰$N_t$ä¸ªæ ·æœ¬ç‚¹,å…¶ä¸­$k$ç±»æ ·æœ¬ç‚¹æœ‰$N_{tk}$ä¸ª,å‰ªæå¾€å¾€é€šè¿‡æå°åŒ–å†³ç­–æ ‘æ•´ä½“çš„æŸå¤±å‡½æ•°$C_{\alpha}(T)=\sum_{i=1}^{\pi} N_{i} H_{i}(T)+\alpha|T|$æ¥å®ç°,å…¶ä¸­ç»éªŒç†µ$H_{t}(T)=-\sum_{k} \frac{N_{a}}{N_{t}} \log \frac{N_{u}}{N_{t}}$.å‰ªæé€šè¿‡åŠ å…¥$a|T|$é¡¹æ¥è€ƒè™‘æ¨¡å‹å¤æ‚åº¦,å®é™…ä¸Šå°±æ˜¯ç”¨æ­£åˆ™åŒ–çš„æå¤§ä¼¼ç„¶ä¼°è®¡è¿›è¡Œæ¨¡å‹é€‰æ‹©.</li>
<li><strong>å‰ªæç®—æ³•</strong>:å‰ªå»æŸä¸€å­ç»“ç‚¹,å¦‚æœç”Ÿæˆçš„æ–°çš„æ•´ä½“æ ‘çš„<strong>æŸå¤±å‡½æ•°å€¼</strong>å°äºåŸæ ‘,åˆ™è¿›è¡Œå‰ªæ,ç›´åˆ°ä¸èƒ½ç»§ç»­ä¸ºæ­¢.å…·ä½“å¯ä»¥ç”±åŠ¨æ€è§„åˆ’å®ç°.</li>
</ol>
<h4 id="CARTç®—æ³•"><a href="#CARTç®—æ³•" class="headerlink" title="CARTç®—æ³•"></a><strong>CARTç®—æ³•</strong></h4><ol>
<li><p>CARTæ—¢å¯ä»¥ç”¨äº<strong>åˆ†ç±»ä¹Ÿ</strong>å¯ä»¥ç”¨äº<strong>å›å½’</strong>.å®ƒå‡è®¾å†³ç­–æ ‘æ˜¯<strong>äºŒå‰æ ‘</strong>,å†…éƒ¨ç»“ç‚¹ç‰¹å¾çš„å–å€¼ä¸ºâ€æ˜¯â€å’Œâ€å¦â€.é€’å½’åœ°æ„å»ºäºŒå‰æ ‘,å¯¹å›å½’æ ‘ç”¨<strong>å¹³æ–¹è¯¯å·®</strong>æœ€å°åŒ–å‡†åˆ™,å¯¹åˆ†ç±»æ•°ç”¨<strong>åŸºå°¼æŒ‡æ•°</strong>æœ€å°åŒ–å‡†åˆ™.</p>
</li>
<li><p><strong>å›å½’æ ‘çš„ç”Ÿæˆ</strong>:åœ¨è®­ç»ƒæ•°æ®é›†æ‰€åœ¨çš„è¾“å…¥ç©ºé—´ä¸­,é€’å½’åœ°å°†æ¯ä¸ªåŒºåŸŸåˆ’åˆ†ä¸ºä¸¤ä¸ªå­åŒºåŸŸ.é€‰æ‹©ç¬¬jä¸ªå˜é‡å’Œå®ƒå–çš„å€¼sä½œä¸ºåˆ‡åˆ†å˜é‡å’Œåˆ‡åˆ†ç‚¹,å¹¶å®šä¹‰ä¸¤ä¸ªåŒºåŸŸ$R_{1}(j, s)=\left\{x | x^{(j)} \leqslant s\right\} \quad$å’Œ$\quad R_{2}(j, s)=\left\{x | x^{(l)}&gt;s\right\}$,éå†å˜é‡j,å¯¹å›ºå®šçš„jæ‰«æåˆ‡åˆ†ç‚¹s,æ±‚è§£$\min _{j, z}\left[\min _{c_1} \sum_{x \in R_{1}(j, x)}\left(y_{i}-c_{1}\right)^{2}+\min _{c_{2}} \sum_{x \in R_{2}(j, x)}\left(y_{i}-c_{2}\right)^{2}\right]$.ç”¨é€‰å®šçš„å¯¹(j,s)åˆ’åˆ†åŒºåŸŸå¹¶å†³å®šç›¸åº”çš„è¾“å‡ºå€¼$\hat{c}_{m}=\frac{1}{N_{m}} \sum_{x_{i} \in R_{m}(j, x)} y_{i}, x \in R_{m}, \quad m=1,2$,ç›´åˆ°æ»¡è¶³åœæ­¢æ¡ä»¶.</p>
</li>
<li><p><strong>åŸºå°¼æŒ‡æ•°</strong>:å‡è®¾æœ‰Kä¸ªç±»,æ ·æœ¬å±äºç¬¬kç±»çš„æ¦‚ç‡ä¸º$p_k$,åˆ™æ¦‚ç‡åˆ†å¸ƒçš„åŸºå°¼æŒ‡æ•°ä¸º:$\operatorname{Gini}(p)=\sum_{k=1}^{K} p_{k}\left(1-p_{k}\right)=1-\sum_{k=1}^{K} p_{k}^{2}$,è¡¨ç¤ºä¸ç¡®å®šæ€§.åœ¨ç‰¹å¾Açš„æ¡ä»¶ä¸‹é›†åˆDçš„åŸºå°¼æŒ‡æ•°å®šä¹‰ä¸º$\operatorname{Gini}(D, A)=\frac{\left|D_{1}\right|}{|D|} \operatorname{Gini}\left(D_{1}\right)+\frac{\left|D_{2}\right|}{|D|} \operatorname{Gini}\left(D_{2}\right)$,è¡¨ç¤ºåˆ†å‰²åé›†åˆDçš„ä¸ç¡®å®šæ€§.åŸºå°¼æŒ‡æ•°è¶Šå¤§,æ ·æœ¬é›†åˆçš„<strong>ä¸ç¡®å®šæ€§</strong>ä¹Ÿå°±è¶Šå¤§.</p>
</li>
<li><p><strong>åˆ†ç±»æ ‘çš„ç”Ÿæˆ</strong></p>
<ol>
<li>ä»æ ¹ç»“ç‚¹å¼€å§‹,è®¾ç»“ç‚¹çš„è®­ç»ƒæ•°æ®é›†ä¸ºD,å¯¹æ¯ä¸ªç‰¹å¾Aå’Œå…¶å¯èƒ½å–çš„æ¯ä¸ªå€¼a,è®¡ç®—A=aæ—¶çš„åŸºå°¼æŒ‡æ•°,</li>
<li>é€‰æ‹©<strong>åŸºå°¼æŒ‡æ•°æœ€å°</strong>çš„ç‰¹å¾åŠå…¶å¯¹åº”çš„åˆ‡åˆ†ç‚¹ä½œä¸º<strong>æœ€ä¼˜ç‰¹å¾</strong>ä¸<strong>æœ€ä¼˜åˆ‡åˆ†ç‚¹</strong>,ç”Ÿæˆä¸¤ä¸ªå­ç»“ç‚¹</li>
<li>é€’å½’è¿›è¡Œä»¥ä¸Šæ“ä½œ,ç›´è‡³æ»¡è¶³<strong>åœæ­¢æ¡ä»¶</strong>.åœæ­¢æ¡ä»¶ä¸€èˆ¬æ˜¯ç»“ç‚¹ä¸­çš„æ ·æœ¬ä¸ªæ•°å°äºé˜ˆå€¼,æˆ–æ ·æœ¬é›†çš„åŸºå°¼æŒ‡æ•°å°äºé˜ˆå€¼,æˆ–æ²¡æœ‰æ›´å¤šç‰¹å¾.</li>
</ol>
</li>
<li><p><strong>CARTå‰ªæ</strong></p>
<p>$T_t$è¡¨ç¤ºä»¥tä¸ºæ ¹ç»“ç‚¹çš„å­æ ‘,$|T_t|$æ˜¯$T_t$çš„å¶ç»“ç‚¹ä¸ªæ•°.å¯ä»¥è¯æ˜å½“$\alpha=\frac{C(t)-C\left(T_{t}\right)}{\left|T_{t}\right|-1}$æ—¶,$T_t$ä¸$t$æœ‰ç›¸åŒçš„æŸå¤±å‡½æ•°å€¼,ä¸”$t$çš„ç»“ç‚¹å°‘,å› æ­¤$t$æ¯”$T_t$æ›´å¯å–,å¯¹$T_t$è¿›è¡Œå‰ªæ.<strong>è‡ªä¸‹è€Œä¸Š</strong>åœ°å¯¹å„å†…éƒ¨ç»“ç‚¹tè®¡ç®—$g(t)=\frac{C(t)-C\left(T_{t}\right)}{\left|T_{t}\right|-1}$,å¹¶ä»¤$a=min(g(t))$,<strong>è‡ªä¸Šè€Œä¸‹</strong>åœ°è®¿é—®å†…éƒ¨èŠ‚ç‚¹t,å¦‚æœæœ‰$g(t)=a$,è¿›è¡Œå‰ªæ,å¹¶å¯¹tä»¥<strong>å¤šæ•°è¡¨å†³æ³•</strong>å†³å®šå…¶ç±»,å¾—åˆ°å­æ ‘T,å¦‚æ­¤å¾ªç¯åœ°ç”Ÿæˆä¸€ä¸²<strong>å­æ ‘åºåˆ—</strong>,ç›´åˆ°æ–°ç”Ÿæˆçš„Tæ˜¯ç”±æ ¹ç»“ç‚¹å•ç‹¬æ„æˆçš„æ ‘ä¸ºæ­¢.åˆ©ç”¨<strong>äº¤å‰éªŒè¯æ³•</strong>åœ¨å­æ ‘åºåˆ—ä¸­é€‰å–æœ€ä¼˜å­æ ‘.</p>
<p>å¦‚æœæ˜¯<strong>è¿ç»­å€¼</strong>çš„æƒ…å†µ,ä¸€èˆ¬ç”¨<strong>äºŒåˆ†æ³•</strong>ä½œä¸ºç»“ç‚¹æ¥åˆ’åˆ†.</p>
</li>
</ol>
<h3 id="logisticå›å½’å’Œæœ€å¤§ç†µæ¨¡å‹"><a href="#logisticå›å½’å’Œæœ€å¤§ç†µæ¨¡å‹" class="headerlink" title="logisticå›å½’å’Œæœ€å¤§ç†µæ¨¡å‹"></a>logisticå›å½’å’Œæœ€å¤§ç†µæ¨¡å‹</h3><h4 id="é€»è¾‘æ–¯è°›åˆ†å¸ƒ"><a href="#é€»è¾‘æ–¯è°›åˆ†å¸ƒ" class="headerlink" title="é€»è¾‘æ–¯è°›åˆ†å¸ƒ"></a><strong>é€»è¾‘æ–¯è°›åˆ†å¸ƒ</strong></h4><p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/logistic.png" alt="avatar"></p>
<p>åˆ†å¸ƒå‡½æ•°$f(x)$ä»¥ç‚¹$(Î¼,1/2)$ä¸ºä¸­å¿ƒå¯¹ç§°,$Î³$çš„å€¼è¶Šå°,æ›²çº¿åœ¨ä¸­å¿ƒé™„è¿‘å¢é•¿å¾—è¶Šå¿«.</p>
<h4 id="é€»è¾‘æ–¯è°›å›å½’æ¨¡å‹"><a href="#é€»è¾‘æ–¯è°›å›å½’æ¨¡å‹" class="headerlink" title="é€»è¾‘æ–¯è°›å›å½’æ¨¡å‹"></a><strong>é€»è¾‘æ–¯è°›å›å½’æ¨¡å‹</strong></h4><p>å¯¹äºç»™å®šçš„è¾“å…¥x,æ ¹æ®$P(Y=1 | x)=\frac{\exp (w \cdot x+b)}{1+\exp (w \cdot x+b)}$ å’Œ $P(Y=0 | x)=\frac{1}{1+\exp (w \cdot x+b)}$è®¡ç®—å‡ºä¸¤ä¸ªæ¡ä»¶æ¦‚ç‡å€¼çš„å¤§å°,å°†xåˆ†åˆ°æ¦‚ç‡å€¼è¾ƒå¤§çš„é‚£ä¸€ç±».å°†åç½®båŠ å…¥åˆ°æƒå€¼å‘é‡wä¸­,å¹¶åœ¨xçš„æœ€åæ·»åŠ å¸¸æ•°é¡¹1,å¾—åˆ°$P(Y=1 | x)=\frac{\exp (w \cdot x)}{1+\exp (w \cdot x)}$ å’Œ $P(Y=0 | x)=\frac{1}{1+\exp (w \cdot x)}$ã€‚</p>
<h4 id="å¯¹æ•°å‡ ç‡"><a href="#å¯¹æ•°å‡ ç‡" class="headerlink" title="å¯¹æ•°å‡ ç‡"></a>å¯¹æ•°å‡ ç‡</h4><p>å¦‚æœæŸäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡æ˜¯p,åˆ™è¯¥äº‹ä»¶å‘ç”Ÿçš„<strong>å‡ ç‡</strong>(æ­¤å¤„å‡ ç‡æŒ‡è¯¥äº‹ä»¶å‘ç”Ÿæ¦‚ç‡ä¸ä¸å‘ç”Ÿæ¦‚ç‡ä¹‹æ¯”)æ˜¯$\frac{p}{1-p}$,<strong>å¯¹æ•°å‡ ç‡</strong>æ˜¯$log(\frac{p}{1-p})$,é‚£ä¹ˆ$\log \frac{P(Y=1 | x)}{1-P(Y=1 | x)}=w \cdot x$ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨é€»è¾‘æ–¯è°›å›å½’æ¨¡å‹ä¸­,è¾“å‡ºY=1çš„å¯¹æ•°å‡ ç‡æ˜¯è¾“å…¥xçš„<strong>çº¿æ€§å‡½æ•°</strong>,çº¿æ€§å‡½æ•°å€¼è¶Šæ¥è¿‘æ­£æ— ç©·,æ¦‚ç‡å€¼å°±è¶Šæ¥è¿‘1,åä¹‹åˆ™è¶Šæ¥è¿‘0.</p>
<h4 id="ä¼¼ç„¶ä¼°è®¡"><a href="#ä¼¼ç„¶ä¼°è®¡" class="headerlink" title="ä¼¼ç„¶ä¼°è®¡"></a><strong>ä¼¼ç„¶ä¼°è®¡</strong></h4><p>ç»™å®šxçš„æƒ…å†µä¸‹å‚æ•°Î¸æ˜¯çœŸå®å‚æ•°çš„å¯èƒ½æ€§.</p>
<h4 id="æ¨¡å‹å‚æ•°ä¼°è®¡"><a href="#æ¨¡å‹å‚æ•°ä¼°è®¡" class="headerlink" title="æ¨¡å‹å‚æ•°ä¼°è®¡"></a><strong>æ¨¡å‹å‚æ•°ä¼°è®¡</strong></h4><p>å¯¹äºç»™å®šçš„äºŒåˆ†ç±»è®­ç»ƒæ•°æ®é›†,å¯¹æ•°ä¼¼ç„¶å‡½æ•°ä¸º</p>
<script type="math/tex; mode=display">
\begin{aligned} L(w) &=\sum_{i=1}^{N}\left[y_{i} \log \pi\left(x_{i}\right)+\left(1-y_{i}\right)\log\left(1-\pi\left(x_{i}\right)\right)\right]\\ &=\sum_{i=1}^{N}\left[y_{i} \log \frac{\pi\left(x_{i}\right)}{1-\pi\left(x_{i}\right)}+\log \left(1-\pi\left(x_{i}\right)\right)\right]\\&=\sum_{i=1}^{N}\left[y_{i}\left(w \cdot x_{i}\right)-\log \left(1+\exp \left(w \cdot x_{i}\right)\right]\right.\end{aligned}</script><p>ä¹Ÿå°±æ˜¯<strong>æŸå¤±å‡½æ•°</strong>.å…¶ä¸­$P(Y=1|x)=Ï€(x)$,å¯¹$L(w)$æ±‚æå¤§å€¼,å°±å¯ä»¥å¾—åˆ°$w$çš„ä¼°è®¡å€¼.é—®é¢˜å˜æˆäº†ä»¥å¯¹æ•°ä¼¼ç„¶å‡½æ•°ä¸ºç›®æ ‡å‡½æ•°çš„æœ€ä¼˜åŒ–é—®é¢˜.</p>
<h4 id="å¤šé¡¹é€»è¾‘æ–¯è°›å›å½’"><a href="#å¤šé¡¹é€»è¾‘æ–¯è°›å›å½’" class="headerlink" title="å¤šé¡¹é€»è¾‘æ–¯è°›å›å½’"></a><strong>å¤šé¡¹é€»è¾‘æ–¯è°›å›å½’</strong></h4><p>å½“é—®é¢˜æ˜¯å¤šåˆ†ç±»é—®é¢˜æ—¶,å¯ä»¥ä½œå¦‚ä¸‹æ¨å¹¿:è®¾Yæœ‰Kç±»å¯èƒ½å–å€¼,$P(Y=k | x)=\frac{\exp \left(w_{k} \cdot x\right)}{1+\sum_{k=1}^{K-1} \exp \left(w_{k} \cdot x\right)}, \quad k=1,2, \cdots, K-1 \quad P(Y=K | x)=\frac{1}{1+\sum_{k=1}^{K-1} \exp \left(w_{k} \cdot x\right)}$,å®é™…ä¸Šå°±æ˜¯<strong>one-vs-all</strong>çš„æ€æƒ³,å°†å…¶ä»–æ‰€æœ‰ç±»å½“ä½œä¸€ä¸ªç±»,é—®é¢˜è½¬æ¢ä¸ºäºŒåˆ†ç±»é—®é¢˜.</p>
<p>ä½¿ç”¨æœ€å¤§ä¼¼ç„¶æ³•è¡¡é‡æ¨¡å‹è¾“å‡ºçš„æ¦‚ç‡ä¸çœŸå®æ¦‚ç‡çš„å·®åˆ«ï¼Œå‡è®¾æ ·æœ¬ä¸€å…±æœ‰Nä¸ªï¼Œé‚£ä¹ˆè¿™ç»„æ ·æœ¬å‘ç”Ÿçš„æ€»æ¦‚ç‡å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<script type="math/tex; mode=display">
P(\boldsymbol{W})=\prod_{n=1}^{N}\left(\frac{e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}}{\sum_{k^{\prime}}^{C} e^{\boldsymbol{w}_{k^{\prime}}^{T} \boldsymbol{x}_{n}}}\right)</script><p>å¯¹å‡½æ•°å–å¯¹æ•°å†ä¹˜ä»¥-1ï¼Œæ¨å¯¼å¾—åˆ°ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
F(\boldsymbol{W})=-\ln (P(\boldsymbol{W})) &=\sum_{n=1}^{N} \ln \left(\frac{\sum_{k^{\prime}}^{C} e^{\boldsymbol{w}_{k^{\prime}}^{T} \boldsymbol{x}_{n}}}{e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}}\right) \\
&=\sum_{n=1}^{N} \ln \left(\frac{e^{\boldsymbol{w}_{1}^{T} \boldsymbol{x}}+e^{\boldsymbol{w}_{2}^{T} \boldsymbol{x}}+\ldots+e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}+\ldots+e^{\boldsymbol{w}_{c}^{T} \boldsymbol{x}}}{e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}}\right) \\
&=\sum_{n=1}^{N} \ln \left(1+\sum_{k \neq y_{n}} e^{\boldsymbol{w}_{k} \boldsymbol{x}_{n}-\boldsymbol{w}_{y_{n}} \boldsymbol{x}_{n}}\right)
\end{aligned}</script><h4 id="æœ€å¤§ç†µåŸç†"><a href="#æœ€å¤§ç†µåŸç†" class="headerlink" title="æœ€å¤§ç†µåŸç†"></a><strong>æœ€å¤§ç†µåŸç†</strong></h4><p>å­¦ä¹ æ¦‚ç‡æ¨¡å‹æ—¶,åœ¨æ‰€æœ‰å¯èƒ½çš„æ¦‚ç‡æ¨¡å‹ä¸­,<strong>ç†µæœ€å¤§</strong>çš„æ¨¡å‹æ˜¯æœ€å¥½çš„æ¨¡å‹.ç›´è§‚åœ°,æœ€å¤§ç†µåŸç†è®¤ä¸ºæ¨¡å‹é¦–å…ˆè¦æ»¡è¶³å·²æœ‰çš„äº‹å®,å³<strong>çº¦æŸæ¡ä»¶</strong>.åœ¨æ²¡æœ‰æ›´å¤šä¿¡æ¯çš„æƒ…å†µä¸‹,é‚£äº›ä¸ç¡®å®šçš„éƒ¨åˆ†éƒ½æ˜¯â€<strong>ç­‰å¯èƒ½çš„</strong>â€œ.</p>
<h4 id="æœ€å¤§ç†µæ¨¡å‹"><a href="#æœ€å¤§ç†µæ¨¡å‹" class="headerlink" title="æœ€å¤§ç†µæ¨¡å‹"></a><strong>æœ€å¤§ç†µæ¨¡å‹</strong></h4><p>ç»™å®šè®­ç»ƒæ•°æ®é›†,å¯ä»¥ç¡®å®šè”åˆåˆ†å¸ƒP(X,Y)çš„ç»éªŒåˆ†å¸ƒ$\tilde{P}(X=x, Y=y)=\frac{v(X=x, Y=y)}{N}$å’Œè¾¹ç¼˜åˆ†å¸ƒP(X)çš„ç»éªŒåˆ†å¸ƒ$\tilde{P}(X=x)=\frac{v(X=x)}{N}$,å…¶ä¸­vè¡¨ç¤ºé¢‘æ•°,Nè¡¨ç¤ºæ ·æœ¬å®¹é‡.ç”¨<strong>ç‰¹å¾å‡½æ•°$f(x,y)$</strong>=1æè¿°xä¸yæ»¡è¶³æŸä¸€äº‹å®,å¯ä»¥å¾—åˆ°ç‰¹å¾å‡½æ•°å…³äºP(X,Y)çš„ç»éªŒåˆ†å¸ƒçš„æœŸæœ›å€¼å’Œå…³äºæ¨¡å‹P(Y|X)ä¸P(X)çš„ç»éªŒåˆ†å¸ƒçš„æœŸæœ›å€¼,å‡è®¾ä¸¤è€…ç›¸ç­‰,å°±å¾—åˆ°äº†<strong>çº¦æŸæ¡ä»¶</strong>$\sum_{x, y} \tilde{P}(x) P(y | x) f(x, y)=\sum_{x, y} \tilde{P}(x, y) f(x, y)$.å®šä¹‰åœ¨æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒP(Y|X)ä¸Šçš„æ¡ä»¶ç†µä¸º$H(P)=-\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)$,åˆ™<strong>æ¡ä»¶ç†µæœ€å¤§</strong>çš„æ¨¡å‹ç§°ä¸ºæœ€å¤§ç†µæ¨¡å‹.</p>
<h4 id="æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ "><a href="#æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ " class="headerlink" title="æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ "></a><strong>æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ </strong></h4><p>å°±æ˜¯æ±‚è§£æœ€å¤§ç†µæ¨¡å‹çš„è¿‡ç¨‹.ç­‰ä»·äº<strong>çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜</strong></p>
<script type="math/tex; mode=display">
\begin{aligned}
&\max _{P_{e c}} H(P)=-\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)\\
&\text { s.t. } \quad E_{p}\left(f_{i}\right)=E_{p}\left(f_{i}\right), \quad i=1,2, \cdots, n\\
     &\sum_{y} P(y | x)=1
\end{aligned}</script><p>,å°†æ±‚æœ€å¤§å€¼é—®é¢˜æ”¹ä¸ºç­‰ä»·çš„æ±‚æœ€å°å€¼é—®é¢˜</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\min _{R \in C}-H(P)=\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)\\
&\text { s.t. } \quad E_{P}\left(f_{i}\right)-E_{\beta}\left(f_{i}\right)=0, \quad i=1,2, \cdots, n\\
&\sum_{y} P(y | x)=1
\end{aligned}</script><p>å¼•å…¥<strong>æ‹‰æ ¼æœ—æ—¥ä¹˜å­</strong></p>
<script type="math/tex; mode=display">
\begin{aligned}
L(P, w) & \equiv-H(P)+w_{0}\left(1-\sum_{y} P(y | x)\right)+\sum_{i=1}^{n} w_{i}\left(E_{p}\left(f_{i}\right)-E_{P}\left(f_{i}\right)\right) \\
&=\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)+w_{0}\left(1-\sum_{y} P(y | x)\right) \\
&+\sum_{i=1}^{n} w_{i}\left(\sum_{x, y} \tilde{P}(x, y) f_{i}(x, y)-\sum_{x, y} \tilde{P}(x) P(y | x) f_{i}(x, y)\right)
\end{aligned}</script><p>å°†åŸå§‹é—®é¢˜$\min _{p \in C} \max _{w} L(P, w)$è½¬æ¢ä¸ºæ— çº¦æŸæœ€ä¼˜åŒ–çš„<strong>å¯¹å¶é—®é¢˜</strong>$\max _{w} \min _{P \in \mathbf{C}} L(P, w)$.é¦–å…ˆæ±‚è§£å†…éƒ¨çš„<strong>æå°åŒ–é—®é¢˜</strong>,å³æ±‚$L(P,W)$å¯¹$P(y|x)$çš„åå¯¼æ•°.</p>
<script type="math/tex; mode=display">
\begin{aligned}
\frac{\partial L(P, w)}{\partial P(y | x)} &=\sum_{x, y} \tilde{P}(x)(\log P(y | x)+1)-\sum_{y} w_{0}-\sum_{x, y}\left(\tilde{P}(x) \sum_{i=1}^{n} w_{i} f_{i}(x, y)\right) \\
&=\sum_{x, y} \tilde{P}(x)\left(\log P(y | x)+1-w_{0}-\sum_{i=1}^{n} w_{i} f_{i}(x, y)\right)
\end{aligned}</script><p>,å¹¶ä»¤åå¯¼æ•°ç­‰äº0,è§£å¾—$Z_{w}(x)=\sum_{y} \exp \left(\sum_{i=1}^{n} w_{i} f_{i}(x, y)\right)$.å¯ä»¥è¯æ˜å¯¹å¶å‡½æ•°ç­‰ä»·äºå¯¹æ•°ä¼¼ç„¶å‡½æ•°,é‚£ä¹ˆå¯¹å¶å‡½æ•°æå¤§åŒ–ç­‰ä»·äºæœ€å¤§ç†µæ¨¡å‹çš„<strong>æå¤§ä¼¼ç„¶ä¼°è®¡</strong>$L(w)=\sum_{x, y} \tilde{P}(x, y) \sum_{i=1}^{n} w_{i} f_{i}(x, y)-\sum_{x} \tilde{P}(x) \log Z_{w}(x)$.ä¹‹åå¯ä»¥ç”¨æœ€ä¼˜åŒ–ç®—æ³•æ±‚è§£å¾—åˆ°w.</p>
<h4 id="é€»è¾‘å›å½’ä¸æœ€å¤§ç†µæ¨¡å‹çš„å…±åŒç‚¹"><a href="#é€»è¾‘å›å½’ä¸æœ€å¤§ç†µæ¨¡å‹çš„å…±åŒç‚¹" class="headerlink" title="é€»è¾‘å›å½’ä¸æœ€å¤§ç†µæ¨¡å‹çš„å…±åŒç‚¹"></a>é€»è¾‘å›å½’ä¸æœ€å¤§ç†µæ¨¡å‹çš„å…±åŒç‚¹</h4><p>æœ€å¤§ç†µæ¨¡å‹ä¸é€»è¾‘æ–¯è°›å›å½’æ¨¡å‹æœ‰ç±»ä¼¼çš„å½¢å¼,å®ƒä»¬åˆç§°ä¸º<strong>å¯¹æ•°çº¿æ€§æ¨¡å‹</strong>.æ¨¡å‹å­¦ä¹ å°±æ˜¯åœ¨ç»™å®šçš„è®­ç»ƒæ•°æ®æ¡ä»¶ä¸‹å¯¹æ¨¡å‹è¿›è¡Œæå¤§ä¼¼ç„¶ä¼°è®¡æˆ–æ­£åˆ™åŒ–çš„æå¤§ä¼¼ç„¶ä¼°è®¡.</p>
<h4 id="ä¼˜åŒ–ç®—æ³•"><a href="#ä¼˜åŒ–ç®—æ³•" class="headerlink" title="ä¼˜åŒ–ç®—æ³•"></a>ä¼˜åŒ–ç®—æ³•</h4><p>ä¼¼ç„¶å‡½æ•°æ˜¯<strong>å…‰æ»‘çš„å‡¸å‡½æ•°</strong>,å› æ­¤å¤šç§æœ€ä¼˜åŒ–æ–¹æ³•éƒ½é€‚ç”¨.</p>
<ol>
<li><strong>æ”¹è¿›çš„è¿­ä»£å°ºåº¦æ³•(IIS)</strong>:å‡è®¾å½“å‰çš„å‚æ•°å‘é‡æ˜¯w,å¦‚æœèƒ½æ‰¾åˆ°ä¸€ç§æ–¹æ³•<strong>w-&gt;w+Î´</strong>ä½¿å¯¹æ•°ä¼¼ç„¶å‡½æ•°å€¼å˜å¤§,å°±å¯ä»¥<strong>é‡å¤</strong>ä½¿ç”¨è¿™ä¸€æ–¹æ³•,ç›´åˆ°æ‰¾åˆ°æœ€å¤§å€¼.</li>
<li>é€»è¾‘æ–¯è°›å›å½’å¸¸åº”ç”¨æ¢¯åº¦ä¸‹é™æ³•,ç‰›é¡¿æ³•æˆ–æ‹Ÿç‰›é¡¿æ³•.</li>
</ol>
<h3 id="æ”¯æŒå‘é‡æœº"><a href="#æ”¯æŒå‘é‡æœº" class="headerlink" title="æ”¯æŒå‘é‡æœº"></a>æ”¯æŒå‘é‡æœº</h3><h4 id="æ¨¡å‹-4"><a href="#æ¨¡å‹-4" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p>æ”¯æŒå‘é‡æœº(SVM)æ˜¯ä¸€ç§<strong>äºŒç±»åˆ†ç±»æ¨¡å‹</strong>.å®ƒçš„åŸºæœ¬æ¨¡å‹æ˜¯å®šä¹‰åœ¨ç‰¹å¾ç©ºé—´ä¸Šçš„<strong>é—´éš”æœ€å¤§</strong>çš„çº¿æ€§åˆ†ç±»å™¨.æ”¯æŒå‘é‡æœºè¿˜åŒ…æ‹¬<strong>æ ¸æŠ€å·§</strong>,ä½¿å®ƒæˆä¸ºå®è´¨ä¸Šçš„éçº¿æ€§åˆ†ç±»å™¨.<strong>åˆ†ç¦»è¶…å¹³é¢</strong>$w^\star x+b^\star =0$,<strong>åˆ†ç±»å†³ç­–å‡½æ•°</strong>$f(s)=sign(w^\star x + b^\star)$.</p>
<h4 id="ç­–ç•¥-3"><a href="#ç­–ç•¥-3" class="headerlink" title="ç­–ç•¥"></a>ç­–ç•¥</h4><p><strong>é—´éš”æœ€å¤§åŒ–</strong>,å¯å½¢å¼åŒ–ä¸ºä¸€ä¸ªæ±‚è§£<strong>å‡¸äºŒæ¬¡è§„åˆ’</strong>çš„é—®é¢˜,ä¹Ÿç­‰ä»·äºæ­£åˆ™åŒ–çš„<strong>åˆé¡µæŸå¤±å‡½æ•°</strong>çš„æœ€å°åŒ–é—®é¢˜.</p>
<h4 id="æ•°æ®å¯åˆ†ã€è¿‘ä¼¼å¯åˆ†ã€ä¸å¯åˆ†"><a href="#æ•°æ®å¯åˆ†ã€è¿‘ä¼¼å¯åˆ†ã€ä¸å¯åˆ†" class="headerlink" title="æ•°æ®å¯åˆ†ã€è¿‘ä¼¼å¯åˆ†ã€ä¸å¯åˆ†"></a>æ•°æ®å¯åˆ†ã€è¿‘ä¼¼å¯åˆ†ã€ä¸å¯åˆ†</h4><p>å½“è®­ç»ƒæ•°æ®<strong>çº¿æ€§å¯åˆ†</strong>æ—¶,é€šè¿‡ç¡¬é—´éš”æœ€å¤§åŒ–,å­¦ä¹ å‡º<strong>çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº</strong>.å½“è®­ç»ƒæ•°æ®<strong>è¿‘ä¼¼çº¿æ€§å¯åˆ†</strong>æ—¶,é€šè¿‡è½¯é—´éš”æœ€å¤§åŒ–,å­¦ä¹ å‡º<strong>çº¿æ€§æ”¯æŒå‘é‡æœº</strong>.å½“è®­ç»ƒæ•°æ®<strong>çº¿æ€§ä¸å¯åˆ†</strong>æ—¶,é€šè¿‡ä½¿ç”¨æ ¸æŠ€å·§åŠè½¯é—´éš”æœ€å¤§åŒ–,å­¦ä¹ <strong>éçº¿æ€§æ”¯æŒå‘é‡æœº</strong>.</p>
<h4 id="æ ¸æŠ€å·§"><a href="#æ ¸æŠ€å·§" class="headerlink" title="æ ¸æŠ€å·§"></a>æ ¸æŠ€å·§</h4><p>å½“è¾“å…¥ç©ºé—´ä¸ºæ¬§å¼ç©ºé—´æˆ–ç¦»æ•£é›†åˆ,ç‰¹å¾ç©ºé—´ä¸ºå¸Œå°”ä¼¯ç‰¹ç©ºé—´æ—¶,æ ¸å‡½æ•°è¡¨ç¤ºå°†è¾“å…¥ä»è¾“å…¥ç©ºé—´<strong>æ˜ å°„</strong>åˆ°ç‰¹å¾ç©ºé—´å¾—åˆ°çš„ç‰¹å¾å‘é‡ä¹‹é—´çš„<strong>å†…ç§¯</strong>.é€šè¿‡æ ¸å‡½æ•°å­¦ä¹ éçº¿æ€§æ”¯æŒå‘é‡æœºç­‰ä»·äºåœ¨é«˜ç»´çš„ç‰¹å¾ç©ºé—´ä¸­å­¦ä¹ çº¿æ€§æ”¯æŒå‘é‡æœº.è¿™æ ·çš„æ–¹æ³•ç§°ä¸ºæ ¸æŠ€å·§.</p>
<h4 id="è¾“å…¥ç©ºé—´å’Œç‰¹å¾ç©ºé—´"><a href="#è¾“å…¥ç©ºé—´å’Œç‰¹å¾ç©ºé—´" class="headerlink" title="è¾“å…¥ç©ºé—´å’Œç‰¹å¾ç©ºé—´"></a>è¾“å…¥ç©ºé—´å’Œç‰¹å¾ç©ºé—´</h4><p>è€ƒè™‘ä¸€ä¸ªäºŒç±»åˆ†ç±»é—®é¢˜,å‡è®¾è¾“å…¥ç©ºé—´ä¸ç‰¹å¾ç©ºé—´ä¸ºä¸¤ä¸ªä¸åŒçš„ç©ºé—´,è¾“å…¥ç©ºé—´ä¸º<strong>æ¬§æ°ç©ºé—´æˆ–ç¦»æ•£é›†åˆ</strong>,ç‰¹å¾ç©ºé—´ä¸º<strong>æ¬§æ°ç©ºé—´æˆ–å¸Œå°”ä¼¯ç‰¹ç©ºé—´</strong>.æ”¯æŒå‘é‡æœºéƒ½å°†è¾“å…¥æ˜ å°„ä¸ºç‰¹å¾å‘é‡,æ‰€ä»¥æ”¯æŒå‘é‡æœºçš„å­¦ä¹ æ˜¯åœ¨<strong>ç‰¹å¾ç©ºé—´</strong>è¿›è¡Œçš„.</p>
<h4 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><p>æ”¯æŒå‘é‡æœºçš„æœ€ä¼˜åŒ–é—®é¢˜ä¸€èˆ¬é€šè¿‡å¯¹å¶é—®é¢˜åŒ–ä¸º<strong>å‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜</strong>æ±‚è§£,å…·ä½“æ­¥éª¤æ˜¯å°†ç­‰å¼çº¦æŸæ¡ä»¶ä»£å…¥ä¼˜åŒ–ç›®æ ‡,é€šè¿‡æ±‚åå¯¼æ±‚å¾—ä¼˜åŒ–ç›®æ ‡åœ¨ä¸ç­‰å¼çº¦æŸæ¡ä»¶ä¸‹çš„æå€¼.</p>
<h4 id="çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº"><a href="#çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº" class="headerlink" title="çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº"></a><strong>çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº</strong></h4><p>å½“è®­ç»ƒæ•°æ®é›†çº¿æ€§å¯åˆ†æ—¶,å­˜åœ¨æ— ç©·ä¸ªåˆ†ç¦»è¶…å¹³é¢å¯å°†ä¸¤ç±»æ•°æ®æ­£ç¡®åˆ†å¼€.åˆ©ç”¨<strong>é—´éš”æœ€å¤§åŒ–</strong>å¾—åˆ°<strong>å”¯ä¸€</strong>æœ€ä¼˜åˆ†ç¦»è¶…å¹³é¢$w^\star x +b = 0$å’Œç›¸åº”çš„åˆ†ç±»å†³ç­–å‡½æ•°$f(s)=sign(w^\star x + b^\star)$.ç§°ä¸ºçº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº.</p>
<h5 id="å‡½æ•°é—´éš”"><a href="#å‡½æ•°é—´éš”" class="headerlink" title="å‡½æ•°é—´éš”"></a>å‡½æ•°é—´éš”</h5><p>ä¸€èˆ¬æ¥è¯´,ä¸€ä¸ªç‚¹è·ç¦»åˆ†ç¦»è¶…å¹³é¢çš„<strong>è¿œè¿‘</strong>å¯ä»¥è¡¨ç¤ºåˆ†ç±»é¢„æµ‹çš„<strong>ç¡®ä¿¡ç¨‹åº¦</strong>.åœ¨è¶…å¹³é¢$w^\star x +b = 0$ç¡®å®šçš„æƒ…å†µä¸‹,$|wx+b|$èƒ½å¤Ÿç›¸å¯¹åœ°è¡¨ç¤ºç‚¹xè·ç¦»è¶…å¹³é¢çš„è¿œè¿‘,è€Œ$wx+b$ä¸$y$çš„ç¬¦å·æ˜¯å¦ä¸€è‡´èƒ½å¤Ÿè¡¨ç¤ºåˆ†ç±»æ˜¯å¦æ­£ç¡®.æ‰€ä»¥å¯ç”¨$\hat{\gamma}_{i}=y_{i}\left(w \cdot x_{i}+b\right)$æ¥è¡¨ç¤ºåˆ†ç±»çš„æ­£ç¡®æ€§åŠç¡®ä¿¡åº¦,è¿™å°±æ˜¯<strong>å‡½æ•°é—´éš”</strong>.æ³¨æ„åˆ°å³ä½¿è¶…å¹³é¢ä¸å˜,å‡½æ•°é—´éš”ä»ä¼šå—wå’Œbçš„ç»å¯¹å¤§å°å½±å“.</p>
<h5 id="å‡ ä½•é—´éš”"><a href="#å‡ ä½•é—´éš”" class="headerlink" title="å‡ ä½•é—´éš”"></a><strong>å‡ ä½•é—´éš”</strong></h5><p>ä¸€èˆ¬åœ°,å½“æ ·æœ¬ç‚¹è¢«è¶…å¹³é¢æ­£ç¡®åˆ†ç±»æ—¶,ç‚¹xä¸è¶…å¹³é¢çš„è·ç¦»æ˜¯$\gamma_{i}=y_{i}\left(\frac{w}{|w|} \cdot x_{i}+\frac{b}{|w|}\right)$å…¶ä¸­$||w||$æ˜¯$w$çš„$l2$èŒƒæ•°.è¿™å°±æ˜¯<strong>å‡ ä½•é—´éš”</strong>çš„å®šä¹‰.å®šä¹‰è¶…å¹³é¢å…³äºè®­ç»ƒæ•°æ®é›†Tçš„å‡ ä½•é—´éš”ä¸ºè¶…å¹³é¢å…³äºTä¸­æ‰€æœ‰æ ·æœ¬ç‚¹çš„å‡ ä½•é—´éš”ä¹‹<strong>æœ€å°å€¼</strong>$\gamma=\min _{i,â€¦,N} \gamma_{1}$.å¯çŸ¥$\gamma=\frac{\hat{\gamma}}{|\boldsymbol{w}|}$å½“$||w||=1$æ—¶å‡ ä½•é—´éš”å’Œå‡½æ•°é—´éš”<strong>ç›¸ç­‰</strong>.</p>
<h5 id="ç¡¬é—´éš”æœ€å¤§åŒ–"><a href="#ç¡¬é—´éš”æœ€å¤§åŒ–" class="headerlink" title="ç¡¬é—´éš”æœ€å¤§åŒ–"></a><strong>ç¡¬é—´éš”æœ€å¤§åŒ–</strong></h5><p>å¯¹çº¿æ€§å¯åˆ†çš„è®­ç»ƒé›†è€Œè¨€,è¿™é‡Œçš„é—´éš”æœ€å¤§åŒ–åˆç§°ä¸º<strong>ç¡¬é—´éš”æœ€å¤§åŒ–</strong>.ç›´è§‚è§£é‡Šæ˜¯å¯¹è®­ç»ƒé›†æ‰¾åˆ°å‡ ä½•é—´éš”æœ€å¤§çš„è¶…å¹³é¢æ„å‘³ç€ä»¥<strong>å……åˆ†å¤§çš„ç¡®ä¿¡åº¦</strong>å¯¹è®­ç»ƒæ•°æ®è¿›è¡Œåˆ†ç±».æ±‚æœ€å¤§é—´éš”åˆ†ç¦»è¶…å¹³é¢å³çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜:</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\max _{w, b} \quad \gamma\\
&\text { s.t. } \quad y_{i}\left(\frac{w}{\|w\|} \cdot x_{i}+\frac{b}{\|w\|}\right) \geqslant \gamma, \quad i=1,2, \cdots, N
\end{aligned}</script><p>,å°†å‡ ä½•é—´éš”ç”¨å‡½æ•°é—´éš”è¡¨ç¤º:</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\max _{w, b} \frac{\hat{\gamma}}{\|w\|}\\
&\text { s.t. } \quad y_{i}\left(w \cdot x_{i}+b\right) \geqslant \hat{p}, \quad i=1,2, \cdots, N
\end{aligned}</script><p>,å¹¶ä¸”æ³¨æ„åˆ°å‡½æ•°é—´éš”çš„å–å€¼å¹¶ä¸å½±å“æœ€ä¼˜åŒ–é—®é¢˜çš„è§£,ä¸å¦¨ä»¤å‡½æ•°é—´éš”=1,å¹¶è®©æœ€å¤§åŒ–$\frac{1}{||w||}$ç­‰ä»·ä¸ºæœ€å°åŒ–$\frac{||w||^2}{2}$,é—®é¢˜å˜ä¸º<strong>å‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜</strong></p>
<script type="math/tex; mode=display">
\min _{w, b} \frac{1}{2}\|w\|^{2} \\
s.t. \quad y_{i}\left(w \cdot x_{i}+b\right)-1 \geqslant 0, \quad i=1,2, \cdots, N</script><h5 id="æ”¯æŒå‘é‡å’Œé—´éš”è¾¹ç•Œ"><a href="#æ”¯æŒå‘é‡å’Œé—´éš”è¾¹ç•Œ" class="headerlink" title="æ”¯æŒå‘é‡å’Œé—´éš”è¾¹ç•Œ"></a><strong>æ”¯æŒå‘é‡å’Œé—´éš”è¾¹ç•Œ</strong></h5><p>ä¸åˆ†ç¦»è¶…å¹³é¢è·ç¦»<strong>æœ€è¿‘çš„æ ·æœ¬ç‚¹</strong>çš„å®ä¾‹ç§°ä¸º<strong>æ”¯æŒå‘é‡</strong>.æ”¯æŒå‘é‡æ˜¯ä½¿æœ€ä¼˜åŒ–é—®é¢˜ä¸­çš„çº¦æŸæ¡ä»¶ç­‰å·æˆç«‹çš„ç‚¹.å› æ­¤å¯¹$y=+1$çš„æ­£ä¾‹ç‚¹å’Œ$y=-1$çš„è´Ÿä¾‹ç‚¹,æ”¯æŒå‘é‡åˆ†åˆ«åœ¨è¶…å¹³é¢H1:$wx+b=+1$å’ŒH2:$wx+b=-1$.H1å’ŒH2å¹³è¡Œ,ä¸¤è€…ä¹‹é—´å½¢æˆä¸€æ¡é•¿å¸¦,é•¿å¸¦çš„å®½åº¦!ç§°$\frac{2}{||w||}$ä¸º<strong>é—´éš”</strong>,H1å’ŒH2ç§°ä¸º<strong>é—´éš”è¾¹ç•Œ</strong>.åœ¨å†³å®šåˆ†ç¦»è¶…å¹³é¢æ—¶åªæœ‰æ”¯æŒå‘é‡èµ·ä½œç”¨,æ‰€ä»¥æ”¯æŒå‘é‡æœºæ˜¯ç”±å¾ˆå°‘çš„â€é‡è¦çš„â€è®­ç»ƒæ ·æœ¬ç¡®å®šçš„.ç”±å¯¹å¶é—®é¢˜åŒæ ·å¯ä»¥å¾—åˆ°æ”¯æŒå‘é‡ä¸€å®šåœ¨é—´éš”è¾¹ç•Œä¸Š.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/support_vector.png" alt="avatar"></p>
<h5 id="å¯¹å¶ç®—æ³•"><a href="#å¯¹å¶ç®—æ³•" class="headerlink" title="å¯¹å¶ç®—æ³•"></a><strong>å¯¹å¶ç®—æ³•</strong></h5><p>å¼•è¿›æ‹‰æ ¼æœ—æ—¥ä¹˜å­,å®šä¹‰æ‹‰æ ¼æœ—æ—¥å‡½æ•°$L(w, b, \alpha)=\frac{1}{2}|w|^{2}-\sum_{i=1}^{N} \alpha_{i} y_{i}\left(w \cdot x_{i}+b\right)+\sum_{i=1}^{N} \alpha_{i}$,æ ¹æ®æ‹‰æ ¼æœ—æ—¥å¯¹å¶æ€§,åŸå§‹é—®é¢˜çš„å¯¹å¶é—®é¢˜æ˜¯æå¤§æå°é—®é¢˜:$\max _{\alpha} \min _{w, b} L(w, b, \alpha)$.å…ˆæ±‚å¯¹w,bçš„<strong>æå°å€¼</strong>.å°†$L(w,b,a)$åˆ†åˆ«å¯¹w,bæ±‚åå¯¼æ•°å¹¶ä»¤å…¶ç­‰äº0,å¾—</p>
<script type="math/tex; mode=display">
\begin{array}{l}
w=\sum_{i=1}^{N} \alpha_{i} y_{i} x_{i} \\
\sum_{i=1}^{N} \alpha_{i} y_{i}=0
\end{array}</script><p>,ä»£å…¥æ‹‰æ ¼æœ—æ—¥å‡½æ•°å¾—</p>
<script type="math/tex; mode=display">
\begin{aligned}
L(w, b, \alpha) &=\frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)-\sum_{i=1}^{N} \alpha_{i} y_{i}\left(\left(\sum_{j=1}^{N} \alpha_{j} y_{j} x_{j}\right) \cdot x_{i}+b\right)+\sum_{i=1}^{N} \alpha_{i} \\
&=-\frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)+\sum_{i=1}^{N} \alpha_{i}
\end{aligned}</script><p>è¿™å°±æ˜¯æå°å€¼.æ¥ä¸‹æ¥å¯¹æå°å€¼æ±‚å¯¹açš„æå¤§,å³æ˜¯<strong>å¯¹å¶é—®é¢˜</strong></p>
<script type="math/tex; mode=display">
\begin{array}{l}
\max _{a}-\frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)+\sum_{i=1}^{N} \alpha_{i} \\
\text { s.t. } \sum_{i=1}^{N} \alpha_{i} y_{i}=0 \\
\quad \alpha_{i} \geqslant 0, \quad i=1,2, \cdots, N
\end{array}</script><p>.å°†æ±‚æå¤§è½¬æ¢ä¸ºæ±‚æå°</p>
<script type="math/tex; mode=display">
\begin{array}{cl}
\min _{\alpha} & \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)-\sum_{i=1}^{N} \alpha_{i} \\
\text { s.t. } & \sum_{i=1}^{N} \alpha_{i} y_{i}=0 \\
& \alpha_{i} \geqslant 0, \quad i=1,2, \cdots, N
\end{array}</script><p>.ç”±<strong>KKTæ¡ä»¶</strong>æˆç«‹å¾—åˆ°</p>
<script type="math/tex; mode=display">
\begin{aligned}
&w^{*}=\sum_{i=1}^{N} \alpha_{i}^{*} y_{i} x_{i}\\
&b^{*}=y_{j}-\sum_{i=1}^{N} \alpha_{i}^{*} y_{i}\left(x_{i} \cdot x_{j}\right)
\end{aligned}</script><p>,å…¶ä¸­$j$ä¸ºä½¿$a_j^<em>&gt;0$çš„ä¸‹æ ‡ä¹‹ä¸€.æ‰€ä»¥é—®é¢˜å°±å˜ä¸ºæ±‚å¯¹å¶é—®é¢˜çš„è§£$a^</em>$,å†æ±‚å¾—åŸå§‹é—®é¢˜çš„è§£$w^<em>,b^</em>$,ä»è€Œå¾—åˆ†ç¦»è¶…å¹³é¢åŠåˆ†ç±»å†³ç­–å‡½æ•°å¯ä»¥çœ‹å‡º$w^<em>$å’Œ$b^</em>$éƒ½åªä¾èµ–è®­ç»ƒæ•°æ®ä¸­$a_i^<em>&gt;0$çš„æ ·æœ¬ç‚¹Z$(x_i,y_i)$,è¿™äº›å®ä¾‹ç‚¹$x_i$è¢«ç§°ä¸º<em>*æ”¯æŒå‘é‡</em></em>.</p>
<h4 id="çº¿æ€§æ”¯æŒå‘é‡æœº"><a href="#çº¿æ€§æ”¯æŒå‘é‡æœº" class="headerlink" title="çº¿æ€§æ”¯æŒå‘é‡æœº"></a><strong>çº¿æ€§æ”¯æŒå‘é‡æœº</strong></h4><p>å¦‚æœè®­ç»ƒæ•°æ®æ˜¯<strong>çº¿æ€§ä¸å¯åˆ†</strong>çš„(è¿‘ä¼¼çº¿æ€§å¯åˆ†),é‚£ä¹ˆä¸Šè¿°æ–¹æ³•ä¸­çš„ä¸ç­‰å¼çº¦æŸå¹¶ä¸èƒ½éƒ½æˆç«‹,éœ€è¦ä¿®æ”¹ç¡¬é—´éš”æœ€å¤§åŒ–,ä½¿å…¶æˆä¸º<strong>è½¯é—´éš”æœ€å¤§åŒ–</strong>.</p>
<h5 id="æ¾å¼›å˜é‡"><a href="#æ¾å¼›å˜é‡" class="headerlink" title="æ¾å¼›å˜é‡"></a>æ¾å¼›å˜é‡</h5><p>çº¿æ€§ä¸å¯åˆ†æ„å‘³ç€æŸäº›<strong>ç‰¹å¼‚ç‚¹</strong>ä¸èƒ½æ»¡è¶³å‡½æ•°é—´éš”å¤§äºç­‰äº1çš„çº¦æŸæ¡ä»¶,å¯ä»¥å¯¹æ¯ä¸ªæ ·æœ¬ç‚¹å¼•è¿›ä¸€ä¸ª<strong>æ¾å¼›å˜é‡</strong>,ä½¿å‡½æ•°é—´éš”åŠ ä¸Šæ¾å¼›å˜é‡å¤§äºç­‰äº1,çº¦æŸæ¡ä»¶å˜ä¸º$y_{i}\left(w \cdot x_{i}+b\right) \geqslant 1-\xi_{i}$,åŒæ—¶å¯¹æ¯ä¸ªæ¾å¼›å˜é‡,æ”¯ä»˜ä¸€ä¸ªä»£ä»·,ç›®æ ‡å‡½æ•°å˜ä¸º$\frac{1}{2}|w|^{2}+C \sum_{i=1}^{N} \xi_{i}$,å…¶ä¸­$C&gt;0$ç§°ä¸º<strong>æƒ©ç½šå‚æ•°</strong>,Cå€¼è¶Šå¤§å¯¹è¯¯åˆ†ç±»çš„æƒ©ç½šä¹Ÿè¶Šå¤§.æ–°ç›®æ ‡å‡½æ•°åŒ…å«äº†ä¸¤å±‚å«ä¹‰:ä½¿<strong>é—´éš”å°½é‡å¤§</strong>,åŒæ—¶ä½¿è¯¯åˆ†ç±»ç‚¹çš„<strong>ä¸ªæ•°å°½é‡å°</strong>.</p>
<h5 id="è½¯é—´éš”æœ€å¤§åŒ–"><a href="#è½¯é—´éš”æœ€å¤§åŒ–" class="headerlink" title="è½¯é—´éš”æœ€å¤§åŒ–"></a>è½¯é—´éš”æœ€å¤§åŒ–</h5><p>å­¦ä¹ é—®é¢˜å˜æˆå¦‚ä¸‹<strong>å‡¸äºŒæ¬¡è§„åˆ’</strong>é—®é¢˜:</p>
<script type="math/tex; mode=display">
\min _{w, b, k} \frac{1}{2}\|w\|^{2}+C \sum_{i=1}^{N} \xi_{i} \\
s.t. \quad y_{i}\left(w \cdot x_{i}+b\right) \geqslant 1-\xi_{i}, \quad i=1,2, \cdots, N \\
\xi_{i} \geqslant 0, \quad i=1,2, \cdots, N</script><p>,å¯ä»¥è¯æ˜wçš„è§£æ˜¯å”¯ä¸€çš„,ä½†bçš„è§£å­˜åœ¨ä¸€ä¸ª<strong>åŒºé—´</strong>.çº¿æ€§æ”¯æŒå‘é‡æœºåŒ…å«çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº,å› æ­¤<strong>é€‚ç”¨æ€§æ›´å¹¿</strong>.</p>
<h5 id="å¯¹å¶ç®—æ³•-1"><a href="#å¯¹å¶ç®—æ³•-1" class="headerlink" title="å¯¹å¶ç®—æ³•"></a>å¯¹å¶ç®—æ³•</h5><p>åŸå§‹é—®é¢˜çš„å¯¹å¶é—®é¢˜æ˜¯,æ„é€ <strong>æ‹‰æ ¼æœ—æ—¥å‡½æ•°</strong> $L(w, b, \xi, \alpha, \mu) \equiv \frac{1}{2}|w|^{2}+C \sum_{i=1}^{N} \xi_{i}-\sum_{i=1}^{N} \alpha_{i}\left(y_{i}\left(w \cdot x_{i}+b\right)-1+\xi_{i}\right)-\sum_{i=1}^{N} \mu_{i} \xi_{i}$ ï¼Œå…ˆæ±‚å¯¹w,b,Î¾çš„<strong>æå°å€¼</strong>,åˆ†åˆ«æ±‚åå¯¼å¹¶ä»¤å¯¼æ•°ä¸º0,å¾—</p>
<script type="math/tex; mode=display">
\begin{aligned}
&w=\sum_{i=1} \alpha_{i} y_{i} x_{i}\\
&\sum_{i=1}^{N} \alpha_{i} y_{i}=0\\
&C-\alpha_{i}-\mu_{i}=0
\end{aligned}</script><p>,ä»£å…¥åŸå‡½æ•°,å†å¯¹æå°å€¼æ±‚açš„<strong>æå¤§å€¼</strong>,å¾—åˆ°</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\max _{a}-\frac{1}{2} \sum_{i=1}^{N} \sum_{i=1}^{N} \alpha_{i} \alpha, y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)+\sum_{i=1}^{N} \alpha_{i}\\
&\text { s.t. } \quad \sum_{i=1}^{N} \alpha_{i} y_{i}=0\\
&\begin{array}{l}
C-\alpha_{i}-\mu_{i}=0 \\
\alpha_{i} \geqslant 0 \\
\mu_{i} \geqslant 0, \quad i=1,2, \cdots, N
\end{array}
\end{aligned}</script><p>,åˆ©ç”¨åä¸‰æ¡çº¦æŸ<strong>æ¶ˆå»Î¼</strong>,å†å°†æ±‚æå¤§è½¬æ¢ä¸º<strong>æ±‚æå°</strong>,å¾—åˆ°<strong>å¯¹å¶é—®é¢˜</strong></p>
<script type="math/tex; mode=display">
\begin{aligned}
&\min _{\alpha} \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)-\sum_{i=1}^{N} \alpha_{i}\\
&\text { s.t. } \quad \sum_{i=1}^{N} \alpha_{i} y_{i}=0\\
&0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2, \cdots, N
\end{aligned}</script><p>ç”±<strong>KKTæ¡ä»¶</strong>æˆç«‹å¯ä»¥å¾—åˆ°</p>
<script type="math/tex; mode=display">
\begin{array}{c}
w^{*}=\sum_{i=1}^{N} \alpha_{i}^{*} y_{i} x_{i} \\
b^{*}=y_{j}-\sum_{i=1}^{N} y_{i} \alpha_{i}^{*}\left(x_{i} \cdot x_{j}\right)
\end{array}</script><p>$j$æ˜¯æ»¡è¶³$0&lt;\alpha_j^<em><C$çš„ä¸‹æ ‡ä¹‹ä¸€.é—®é¢˜å°±å˜ä¸ºé€‰æ‹©æƒ©ç½šå‚æ•°$C>0$,æ±‚å¾—å¯¹å¶é—®é¢˜(<strong>å‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜</strong>)çš„**æœ€ä¼˜è§£$\alpha^</C$çš„ä¸‹æ ‡ä¹‹ä¸€.é—®é¢˜å°±å˜ä¸ºé€‰æ‹©æƒ©ç½šå‚æ•°$C></em>$<strong>,ä»£å…¥è®¡ç®—$w^<em>$å’Œ$b^</em>$,æ±‚å¾—åˆ†ç¦»è¶…å¹³é¢å’Œåˆ†ç±»å†³ç­–å‡½æ•°.å› ä¸º$b$çš„è§£å¹¶ä¸å”¯ä¸€,æ‰€ä»¥å®é™…è®¡ç®—$b^*$æ—¶å¯ä»¥å–æ‰€æœ‰æ ·æœ¬ç‚¹ä¸Šçš„</strong>å¹³å‡å€¼**.</p>
<h5 id="æ”¯æŒå‘é‡"><a href="#æ”¯æŒå‘é‡" class="headerlink" title="æ”¯æŒå‘é‡"></a>æ”¯æŒå‘é‡</h5><p>åœ¨<strong>çº¿æ€§ä¸å¯åˆ†</strong>çš„æƒ…å†µä¸‹,å°†å¯¹åº”ä¸$\alpha_i^<em>&gt;0$çš„æ ·æœ¬ç‚¹$(x_i,y_i)$çš„å®ä¾‹ç‚¹$x_i$ç§°ä¸º<em>*æ”¯æŒå‘é‡</em></em>.è½¯é—´éš”çš„æ”¯æŒå‘é‡æˆ–è€…åœ¨é—´éš”è¾¹ç•Œä¸Š,æˆ–è€…åœ¨é—´éš”è¾¹ç•Œä¸åˆ†ç±»è¶…å¹³é¢ä¹‹é—´,æˆ–è€…å†åˆ†ç¦»è¶…å¹³é¢è¯¯åˆ†ä¸€ä¾§.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/support_soft.png" alt="avatar"></p>
<h5 id="åˆé¡µæŸå¤±"><a href="#åˆé¡µæŸå¤±" class="headerlink" title="åˆé¡µæŸå¤±"></a>åˆé¡µæŸå¤±</h5><p>å¯ä»¥è®¤ä¸ºæ˜¯0-1æŸå¤±å‡½æ•°çš„ä¸Šç•Œ,è€Œçº¿æ€§æ”¯æŒå‘é‡æœºå¯ä»¥è®¤ä¸ºæ˜¯ä¼˜åŒ–åˆé¡µæŸå¤±å‡½æ•°æ„æˆçš„ç›®æ ‡å‡½æ•°.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/0_1loss.png" alt="avatar"></p>
<h4 id="éçº¿æ€§æ”¯æŒå‘é‡æœº"><a href="#éçº¿æ€§æ”¯æŒå‘é‡æœº" class="headerlink" title="éçº¿æ€§æ”¯æŒå‘é‡æœº"></a><strong>éçº¿æ€§æ”¯æŒå‘é‡æœº</strong></h4><p>å¦‚æœåˆ†ç±»é—®é¢˜æ˜¯<strong>éçº¿æ€§</strong>çš„,å°±è¦ä½¿ç”¨<strong>éçº¿æ€§æ”¯æŒå‘é‡æœº</strong>.ä¸»è¦ç‰¹ç‚¹æ˜¯ä½¿ç”¨<strong>æ ¸æŠ€å·§</strong>.</p>
<h5 id="éçº¿æ€§åˆ†ç±»é—®é¢˜"><a href="#éçº¿æ€§åˆ†ç±»é—®é¢˜" class="headerlink" title="éçº¿æ€§åˆ†ç±»é—®é¢˜"></a><strong>éçº¿æ€§åˆ†ç±»é—®é¢˜</strong></h5><p>ç”¨çº¿æ€§åˆ†ç±»æ–¹æ³•æ±‚è§£éçº¿æ€§åˆ†ç±»é—®é¢˜åˆ†ä¸ºä¸¤æ­¥:é¦–å…ˆä½¿ç”¨ä¸€ä¸ªå˜æ¢å°†åŸç©ºé—´çš„æ•°æ®æ˜ å°„åˆ°æ–°ç©ºé—´,ç„¶ååœ¨æ–°ç©ºé—´é‡Œç”¨çº¿æ€§åˆ†ç±»å­¦ä¹ æ–¹æ³•ä»è®­ç»ƒæ•°æ®ä¸­å­¦ä¹ åˆ†ç±»æ¨¡å‹.</p>
<h5 id="æ ¸å‡½æ•°"><a href="#æ ¸å‡½æ•°" class="headerlink" title="æ ¸å‡½æ•°"></a><strong>æ ¸å‡½æ•°</strong></h5><p>è®¾Xæ˜¯<strong>è¾“å…¥ç©ºé—´</strong>(æ¬§å¼ç©ºé—´çš„å­é›†æˆ–ç¦»æ•£é›†åˆ),Hä¸º<strong>ç‰¹å¾ç©ºé—´</strong>(å¸Œå°”ä¼¯ç‰¹ç©ºé—´),ä¸€èˆ¬æ˜¯<strong>é«˜ç»´</strong>ç”šè‡³æ— ç©·ç»´çš„.å¦‚æœå­˜åœ¨ä¸€ä¸ªä»Xåˆ°Hçš„æ˜ å°„$\phi(x): \mathcal{X} \rightarrow \mathcal{H}$ä½¿å¾—å¯¹æ‰€æœ‰x,zå±äºX,å‡½æ•°K(x,z)æ»¡è¶³æ¡ä»¶$K(x, z)=\phi(x) \cdot \phi(z)$,ç‚¹ä¹˜ä»£è¡¨<strong>å†…ç§¯</strong>,åˆ™ç§°K(x,z)ä¸º<strong>æ ¸å‡½æ•°</strong>.</p>
<h5 id="æ ¸æŠ€å·§-1"><a href="#æ ¸æŠ€å·§-1" class="headerlink" title="æ ¸æŠ€å·§"></a><strong>æ ¸æŠ€å·§</strong></h5><p>åŸºæœ¬æ€æƒ³æ˜¯é€šè¿‡ä¸€ä¸ª<strong>éçº¿æ€§å˜æ¢</strong>å°†è¾“å…¥ç©ºé—´å¯¹åº”äºä¸€ä¸ª<strong>ç‰¹å¾ç©ºé—´</strong>,ä½¿å¾—åœ¨è¾“å…¥ç©ºé—´ä¸­çš„<strong>è¶…æ›²é¢æ¨¡å‹</strong>å¯¹åº”äºç‰¹å¾ç©ºé—´ä¸­çš„<strong>è¶…å¹³é¢æ¨¡å‹</strong>(æ”¯æŒå‘é‡æœº).åœ¨å­¦ä¹ å’Œé¢„æµ‹ä¸­åªå®šä¹‰æ ¸å‡½æ•°$K(x,z)$,è€Œ<strong>ä¸æ˜¾å¼</strong>åœ°å®šä¹‰æ˜ å°„å‡½æ•°.å¯¹äºç»™å®šçš„æ ¸$K(x,z)$,ç‰¹å¾ç©ºé—´å’Œæ˜ å°„å‡½æ•°çš„å–æ³•å¹¶<strong>ä¸å”¯ä¸€</strong>.æ³¨æ„åˆ°åœ¨çº¿æ€§æ”¯æŒå‘é‡æœºçš„å¯¹å¶é—®é¢˜ä¸­,ç›®æ ‡å‡½æ•°å’Œå†³ç­–å‡½æ•°éƒ½åªæ¶‰åŠè¾“å…¥å®ä¾‹ä¸å®ä¾‹ä¹‹é—´çš„<strong>å†…ç§¯</strong>,$x_i,x_j$å¯ä»¥ç”¨æ ¸å‡½æ•°$K(x_i,x_j)=\phi (x_i)\phi (x_j)$æ¥<strong>ä»£æ›¿</strong>.å½“æ˜ å°„å‡½æ•°æ˜¯éçº¿æ€§å‡½æ•°æ—¶,å­¦ä¹ åˆ°çš„å«æœ‰æ ¸å‡½æ•°çš„æ”¯æŒå‘é‡æœºæ˜¯éçº¿æ€§åˆ†ç±»æ¨¡å‹.åœ¨å®é™…åº”ç”¨ä¸­,å¾€å¾€ä¾èµ–é¢†åŸŸçŸ¥è¯†<strong>ç›´æ¥é€‰æ‹©</strong>æ ¸å‡½æ•°.</p>
<h5 id="æ­£å®šæ ¸"><a href="#æ­£å®šæ ¸" class="headerlink" title="æ­£å®šæ ¸"></a><strong>æ­£å®šæ ¸</strong></h5><p>é€šå¸¸æ‰€è¯´çš„æ ¸å‡½æ•°æ˜¯æŒ‡<strong>æ­£å®šæ ¸å‡½æ•°</strong>.åªè¦æ»¡è¶³æ­£å®šæ ¸çš„å……è¦æ¡ä»¶,é‚£ä¹ˆç»™å®šçš„å‡½æ•°K(x,z)å°±æ˜¯æ­£å®šæ ¸å‡½æ•°.è®¾Kæ˜¯å®šä¹‰åœ¨X<em>Xä¸Šçš„<strong>å¯¹ç§°å‡½æ•°</strong>,å¦‚æœä»»æ„xiå±äºX,K(x,z)å¯¹åº”çš„<strong>GramçŸ©é˜µ</strong>$K=\left[K\left(x_{i}, x_{j}\right)\right]_{mxm}$æ˜¯<em>*åŠæ­£å®šçŸ©é˜µ</em></em>,åˆ™ç§°$K(x,z)$æ˜¯æ­£å®šæ ¸.è¿™ä¸€å®šä¹‰åœ¨æ„é€ æ ¸å‡½æ•°æ—¶å¾ˆæœ‰ç”¨,ä½†è¦éªŒè¯ä¸€ä¸ªå…·ä½“å‡½æ•°æ˜¯å¦ä¸ºæ­£å®šæ ¸å‡½æ•°å¹¶ä¸å®¹æ˜“,æ‰€ä»¥åœ¨å®é™…é—®é¢˜ä¸­å¾€å¾€åº”ç”¨å·²æœ‰çš„æ ¸å‡½æ•°.</p>
<h5 id="ç®—æ³•-4"><a href="#ç®—æ³•-4" class="headerlink" title="ç®—æ³•"></a><strong>ç®—æ³•</strong></h5><p>é€‰å–é€‚å½“çš„æ ¸å‡½æ•°K(x,z)å’Œé€‚å½“çš„å‚æ•°C,å°†çº¿æ€§æ”¯æŒå‘é‡æœºå¯¹å¶å½¢å¼ä¸­çš„å†…ç§¯æ¢æˆæ ¸å‡½æ•°,æ„é€ å¹¶æ±‚è§£æœ€ä¼˜åŒ–é—®é¢˜</p>
<script type="math/tex; mode=display">
\min _{a} \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j} K\left(x_{i}, x_{j}\right)-\sum_{i=1}^{N} \alpha_{i} \\
s.t. \quad \sum_{i=1}^{N} \alpha_{i} y_{i}=0 \\
0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2, \cdots, N</script><p>,é€‰æ‹©æœ€ä¼˜è§£$a^<em>$çš„ä¸€ä¸ªæ­£åˆ†é‡$0&lt;a_j^</em>&lt;C$è®¡ç®—$b^{<em>}=y_{j}-\sum_{i=1}^{N} \alpha_{i}^{</em>} y_{i} K\left(x_{i} \cdot x_{j}\right)$,æ„é€ å†³ç­–å‡½æ•°$f(x)=\operatorname{sign}\left(\sum_{i=1}^{N} \alpha_{i}^{<em>} y_{i} K\left(x \cdot x_{i}\right)+b^{</em>}\right)$</p>
<h5 id="å¸¸ç”¨æ ¸å‡½æ•°"><a href="#å¸¸ç”¨æ ¸å‡½æ•°" class="headerlink" title="å¸¸ç”¨æ ¸å‡½æ•°"></a><strong>å¸¸ç”¨æ ¸å‡½æ•°</strong></h5><ol>
<li><strong>å¤šé¡¹å¼æ ¸å‡½æ•°(polynomial kernel function)</strong> :$K(x, z)=(x \cdot z+1)^{p}$,å¯¹åº”çš„æ”¯æŒå‘é‡æœºæ˜¯ä¸€ä¸ªpæ¬¡å¤šé¡¹å¼åˆ†ç±»å™¨,åˆ†ç±»å†³ç­–å‡½æ•°ä¸º:$f(x)=\operatorname{sign}\left(\sum_{i=1}^{N_{i}} a_{i}^{<em>} y_{i}\left(x_{i} \cdot x+1\right)^{p}+b^{</em>}\right)$</li>
<li><strong>é«˜æ–¯æ ¸å‡½æ•°(Gaussian krenel function)</strong> :$K(x, z)=\exp \left(-\frac{|x-z|^{2}}{2 \sigma^{2}}\right)$ ,å¯¹åº”çš„æ”¯æŒå‘é‡æœºæ˜¯é«˜æ–¯å¾„å‘åŸºå‡½æ•°(RBF)åˆ†ç±»å™¨.åˆ†ç±»å†³ç­–å‡½æ•°ä¸º$f(x)=\operatorname{sign}\left(\sum_{i=1}^{N_{t}} a_{i}^{<em>} y_{i} \exp \left(-\frac{|x-z|^{2}}{2 \sigma^{2}}\right)+b^{</em>}\right)$</li>
<li><strong>å­—ç¬¦ä¸²æ ¸å‡½æ•°(string kernel function)</strong>: æ ¸å‡½æ•°ä¸ä»…å¯ä»¥å®šä¹‰åœ¨æ¬§æ°ç©ºé—´ä¸Š,è¿˜å¯ä»¥å®šä¹‰åœ¨<strong>ç¦»æ•£æ•°æ®çš„é›†åˆ</strong>ä¸Š.å­—ç¬¦ä¸²æ ¸å‡½æ•°ç»™å‡ºäº†å­—ç¬¦ä¸²ä¸­é•¿åº¦ç­‰äºnçš„æ‰€æœ‰å­ä¸²ç»„æˆçš„ç‰¹å¾å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦.</li>
</ol>
<h5 id="åºåˆ—æœ€å°æœ€ä¼˜åŒ–-SMO-ç®—æ³•"><a href="#åºåˆ—æœ€å°æœ€ä¼˜åŒ–-SMO-ç®—æ³•" class="headerlink" title="åºåˆ—æœ€å°æœ€ä¼˜åŒ–(SMO)ç®—æ³•"></a><strong>åºåˆ—æœ€å°æœ€ä¼˜åŒ–(SMO)ç®—æ³•</strong></h5><p>SMOæ˜¯ä¸€ç§<em>å¿«é€Ÿæ±‚è§£å‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜</em></p>
<script type="math/tex; mode=display">
\begin{aligned}
&\min _{\alpha} \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j} K\left(x_{i}, x_{j}\right)-\sum_{i=1}^{N} \alpha_{i}\\
&\text { s.t. } \quad \sum_{i=1}^{N} \alpha_{i} y_{i}=0\\
&0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2, \cdots, N
\end{aligned}</script><p>çš„ç®—æ³•.åŸºæœ¬æ€è·¯æ˜¯:å¦‚æœæ‰€æœ‰å˜é‡éƒ½æ»¡è¶³æ­¤ä¼˜åŒ–é—®é¢˜çš„KKTæ¡ä»¶,é‚£ä¹ˆè§£å°±å¾—åˆ°äº†.å¦åˆ™,é€‰æ‹©<strong>ä¸¤ä¸ªå˜é‡</strong>,å›ºå®šå…¶ä»–å˜é‡,é’ˆå¯¹è¿™ä¸¤ä¸ªå˜é‡æ„å»ºä¸€ä¸ªäºŒæ¬¡è§„åˆ’é—®é¢˜.ä¸æ–­åœ°å°†åŸé—®é¢˜åˆ†è§£ä¸º<strong>å­é—®é¢˜</strong>å¹¶å¯¹å­é—®é¢˜æ±‚è§£,å°±å¯ä»¥æ±‚è§£åŸé—®é¢˜.æ³¨æ„å­é—®é¢˜ä¸¤ä¸ªå˜é‡ä¸­åªæœ‰ä¸€ä¸ªæ˜¯<strong>è‡ªç”±å˜é‡</strong>,å¦ä¸€ä¸ªç”±<strong>ç­‰å¼çº¦æŸ</strong>ç¡®å®š.</p>
<h5 id="ä¸¤ä¸ªå˜é‡äºŒæ¬¡è§„åˆ’çš„æ±‚è§£æ–¹æ³•"><a href="#ä¸¤ä¸ªå˜é‡äºŒæ¬¡è§„åˆ’çš„æ±‚è§£æ–¹æ³•" class="headerlink" title="ä¸¤ä¸ªå˜é‡äºŒæ¬¡è§„åˆ’çš„æ±‚è§£æ–¹æ³•"></a><strong>ä¸¤ä¸ªå˜é‡äºŒæ¬¡è§„åˆ’çš„æ±‚è§£æ–¹æ³•</strong></h5><p>å‡è®¾é€‰æ‹©çš„ä¸¤ä¸ªå˜é‡æ˜¯a1,a2,å…¶ä»–å˜é‡æ˜¯å›ºå®šçš„,äºæ˜¯å¾—åˆ°å­é—®é¢˜</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\begin{aligned}
\min _{\alpha, \alpha_{i}} W\left(\alpha_{1}, \alpha_{2}\right)=& \frac{1}{2} K_{11} \alpha_{1}^{2}+\frac{1}{2} K_{22} \alpha_{2}^{2}+y_{1} y_{2} K_{12} \alpha_{1} \alpha_{2} \\
&-\left(\alpha_{1}+\alpha_{2}\right)+y_{1} \alpha_{1} \sum_{i=1}^{N} y_{i} \alpha_{i} K_{n}+y_{2} \alpha_{2} \sum_{i=1}^{N} y_{i} \alpha_{i} K_{i}
\end{aligned}\\
&\text { s.t. } \quad \alpha_{1} y_{1}+\alpha_{2} y_{2}=-\sum_{i=3}^{N} y_{i} \alpha_{i}=\zeta\\
&0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2
\end{aligned}</script><p>,$\epsilon$æ˜¯å¸¸æ•°,ç›®æ ‡å‡½æ•°å¼çœç•¥äº†ä¸å«$a_1,a_2$çš„å¸¸æ•°é¡¹.è€ƒè™‘ä¸ç­‰å¼çº¦æŸå’Œç­‰å¼çº¦æŸ,è¦æ±‚çš„æ˜¯ç›®æ ‡å‡½æ•°åœ¨ä¸€æ¡å¹³è¡Œäºå¯¹è§’çº¿çš„çº¿æ®µä¸Šçš„æœ€ä¼˜å€¼</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/1.png" alt="avatar"></p>
<p>é—®é¢˜å˜ä¸º<strong>å•å˜é‡</strong>çš„æœ€ä¼˜åŒ–é—®é¢˜.å‡è®¾åˆå§‹å¯è¡Œè§£ä¸ºaold,æœ€ä¼˜è§£ä¸ºanew,è€ƒè™‘æ²¿ç€çº¦æŸæ–¹å‘æœªç»å‰ªè¾‘çš„æœ€ä¼˜è§£anew,unc(å³æœªè€ƒè™‘ä¸ç­‰å¼çº¦æŸ).å¯¹è¯¥é—®é¢˜æ±‚åå¯¼æ•°,å¹¶ä»¤å¯¼æ•°ä¸º0,ä»£å…¥åŸå¼,ä»¤$E_{i}=g\left(x_{i}\right)-y_{i}=\left(\sum_{j=1}^{N} \alpha, y_{j} K\left(x_{j}, x_{i}\right)+b\right)-y_{i}, \quad i=1,2$,å¾—åˆ°$\alpha_{2}^{\text {new, } \text { unc }}=\alpha_{2}^{\text {old }}+\frac{y_{2}\left(E_{1}-E_{2}\right)}{\eta}$,ç»å‰ªè¾‘åa2çš„è§£æ˜¯</p>
<script type="math/tex; mode=display">
\alpha_{2}^{\text {new }}=\left\{\begin{array}{ll}H, & \alpha_{2}^{\text {new }, \text { unc }}>H \\ \alpha_{2}^{\text {new }, \text { unc }}, & L \leqslant \alpha_{2}^{\text {new}, \text { unc}} \leqslant H \\ L, & \alpha_{2}^{\text {new }, \text { unc }}<L\end{array}\right.</script><p>Lä¸Hæ˜¯$a_2^{new}$æ‰€åœ¨çš„å¯¹è§’çº¿æ®µç«¯ç‚¹çš„ç•Œ.å¹¶è§£å¾—$\alpha_{1}^{\mathrm{new}}=\alpha_{1}^{\mathrm{old}}+y_{1} y_{2}\left(\alpha_{2}^{\mathrm{old}}-\alpha_{2}^{\mathrm{new}}\right)$</p>
<h5 id="å˜é‡çš„é€‰æ‹©æ–¹æ³•"><a href="#å˜é‡çš„é€‰æ‹©æ–¹æ³•" class="headerlink" title="å˜é‡çš„é€‰æ‹©æ–¹æ³•"></a><strong>å˜é‡çš„é€‰æ‹©æ–¹æ³•</strong></h5><p>åœ¨æ¯ä¸ªå­é—®é¢˜ä¸­é€‰æ‹©ä¸¤ä¸ªå˜é‡ä¼˜åŒ–,å…¶ä¸­è‡³å°‘ä¸€ä¸ªå˜é‡æ˜¯è¿åKKTæ¡ä»¶çš„.ç¬¬ä¸€ä¸ªå˜é‡çš„é€‰å–æ ‡å‡†æ˜¯<strong>è¿åKKTæ¡ä»¶æœ€ä¸¥é‡</strong>çš„æ ·æœ¬ç‚¹,ç¬¬äºŒä¸ªå˜é‡çš„é€‰å–æ ‡å‡†æ˜¯å¸Œæœ›èƒ½ä½¿è¯¥å˜é‡æœ‰<strong>è¶³å¤Ÿå¤§çš„å˜åŒ–</strong>,ä¸€èˆ¬å¯ä»¥é€‰å–ä½¿å¯¹åº”çš„$|E1-E2|$æœ€å¤§çš„ç‚¹.åœ¨æ¯æ¬¡é€‰å–å®Œç‚¹å,<strong>æ›´æ–°</strong>é˜ˆå€¼$b$å’Œå·®å€¼$Ei$.</p>
<h3 id="æå‡æ–¹æ³•"><a href="#æå‡æ–¹æ³•" class="headerlink" title="æå‡æ–¹æ³•"></a>æå‡æ–¹æ³•</h3><h4 id="æå‡æ–¹æ³•-1"><a href="#æå‡æ–¹æ³•-1" class="headerlink" title="æå‡æ–¹æ³•"></a>æå‡æ–¹æ³•</h4><p>boostingæ˜¯<strong>ä¸€ç§å¸¸ç”¨çš„ç»Ÿè®¡å­¦ä¹ æ–¹æ³•,æ˜¯é›†æˆå­¦ä¹ çš„ä¸€ç§.å®ƒé€šè¿‡æ”¹å˜è®­ç»ƒæ ·æœ¬çš„æƒé‡(æ¦‚ç‡åˆ†å¸ƒ),å­¦ä¹ </strong>å¤šä¸ª<strong>å¼±åˆ†ç±»å™¨(åŸºæœ¬åˆ†ç±»å™¨),å¹¶å°†è¿™äº›åˆ†ç±»å™¨</strong>çº¿æ€§ç»„åˆ**æ¥æ„æˆä¸€ä¸ªå¼ºåˆ†ç±»å™¨æé«˜åˆ†ç±»çš„æ€§èƒ½.</p>
<h4 id="åŠ æ³•æ¨¡å‹å’Œå‰å‘åˆ†æ­¥ç®—æ³•"><a href="#åŠ æ³•æ¨¡å‹å’Œå‰å‘åˆ†æ­¥ç®—æ³•" class="headerlink" title="åŠ æ³•æ¨¡å‹å’Œå‰å‘åˆ†æ­¥ç®—æ³•"></a>åŠ æ³•æ¨¡å‹å’Œå‰å‘åˆ†æ­¥ç®—æ³•</h4><p>åŠ æ³•æ¨¡å‹$f(x)= \sum_{m=1}^M{\beta_mb(x;\gamma_m)}$,å…¶ä¸­ï¼Œ$b(x;\gamma_m)$ä¸ºåŸºå‡½æ•°ï¼Œ$\gamma_m$ä¸ºåŸºå‡½æ•°å‚æ•°ï¼Œ$\beta_m$ä¸ºåŸºå‡½æ•°çš„ç³»æ•°ã€‚åœ¨ç»™å®šè®­ç»ƒæ•°æ®åŠæŸå¤±å‡½æ•°$L(y,f(x))$çš„æ¡ä»¶ä¸‹ï¼Œå­¦ä¹ åŠ æ³•æ¨¡å‹$f(x)$æˆä¸ºç»éªŒé£é™©æå°åŒ–å³æŸå¤±å‡½æ•°æå°åŒ–é—®é¢˜ï¼š</p>
<script type="math/tex; mode=display">
min_{\beta_m,\gamma_m}\sum_{m=1}^{M}{\beta_m b(x_i;\gamma_m)}</script><p>é€šå¸¸è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ä¼˜åŒ–é—®é¢˜ã€‚</p>
<p>å‰å‘åˆ†æ­¥ç®—æ³•æ±‚è§£è¿™ä¸€ä¼˜åŒ–é—®é¢˜çš„æƒ³æ³•æ˜¯ï¼šå› ä¸ºå­¦ä¹ çš„æ˜¯åŠ æ³•æ¨¡å‹ï¼Œå¦‚æœèƒ½å¤Ÿä»å‰å‘åï¼Œæ¯ä¸€æ­¥åªå­¦ä¹ ä¸€ä¸ªåŸºå‡½æ•°åŠå…¶ç³»æ•°ï¼š$\left(\beta_{m}, \gamma_{m}\right)=\arg \min _{\beta, y} \sum_{i=1}^{N} L\left(y_{i}, f_{m-1}\left(x_{i}\right)+\beta b\left(x_{i} ; \gamma\right)\right)$ï¼Œå¾—åˆ°å‚æ•°Î²må’ŒÎ³m,æ›´æ–°$f_{m}(x)=f_{m-1}(x)+\beta_{m} b\left(x ; \gamma_{m}\right)$,é€æ­¥é€¼è¿‘ä¼˜åŒ–ç›®æ ‡å‡½æ•°å¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç®€åŒ–ä¼˜åŒ–çš„å¤æ‚åº¦ï¼Œæœ€ç»ˆå¾—åˆ°åŠ æ³•æ¨¡å‹ã€‚</p>
<h4 id="AdaBoost"><a href="#AdaBoost" class="headerlink" title="AdaBoost"></a><strong>AdaBoost</strong></h4><h5 id="æ€æƒ³ï¼š"><a href="#æ€æƒ³ï¼š" class="headerlink" title="æ€æƒ³ï¼š"></a>æ€æƒ³ï¼š</h5><p>AdaBoostæé«˜é‚£äº›è¢«å‰ä¸€è½®å¼±åˆ†ç±»å™¨é”™è¯¯åˆ†ç±»æ ·æœ¬çš„æƒå€¼,è€Œé™ä½é‚£äº›è¢«æ­£ç¡®åˆ†ç±»æ ·æœ¬çš„æƒå€¼.ç„¶åé‡‡å–<strong>åŠ æƒå¤šæ•°è¡¨å†³</strong>çš„æ–¹æ³•ç»„åˆå¼±åˆ†ç±»å™¨.</p>
<h5 id="ç®—æ³•-5"><a href="#ç®—æ³•-5" class="headerlink" title="ç®—æ³•"></a><strong>ç®—æ³•</strong></h5><p>é¦–å…ˆå‡è®¾è®­ç»ƒæ•°æ®é›†å…·æœ‰å‡åŒ€çš„æƒå€¼åˆ†å¸ƒD1,ä½¿ç”¨å…·æœ‰<strong>æƒå€¼åˆ†å¸ƒ</strong>Dmçš„è®­ç»ƒæ•°æ®é›†å­¦ä¹ å¾—åˆ°<strong>åŸºæœ¬åˆ†ç±»å™¨</strong>Gm(x),è®¡ç®—<strong>åˆ†ç±»è¯¯å·®ç‡</strong>$e_{m}=P\left(G_{m}\left(x_{i}\right) \neq y_{i}\right)=\sum_{i=1}^{N} w_{m i} I\left(G_{m}\left(x_{i}\right) \neq y_{i}\right)$å’ŒGm(x)çš„<strong>ç³»æ•°</strong>$\alpha_{m}=\frac{1}{2} \log \frac{1-e_{m}}{e_{m}}$,æ›´æ–°è®­ç»ƒæ•°æ®é›†çš„æƒå€¼åˆ†å¸ƒ$D_{m+1}=\left(w_{m+1,1}, \cdots, w_{m+1, i}, \cdots, w_{m+1, N}\right)$ï¼Œå…¶ä¸­</p>
<script type="math/tex; mode=display">
w_{m+1, i}=\left\{\begin{array}{ll}
\frac{w_{mi}}{Z_{m}} \mathrm{e}^{-\alpha_{m}}, & G_{m}\left(x_{i}\right)=y_{i} \\
\frac{w_{m i}}{Z_{m}} \mathrm{e}^{\alpha_{m}}, & G_{m}\left(x_{i}\right) \neq y_{i}
\end{array}\right.</script><p>$Z_m$æ˜¯ä½¿Dm+1æˆä¸ºæ¦‚ç‡åˆ†å¸ƒçš„<strong>è§„èŒƒåŒ–å› å­</strong>$Z_{m}=\sum_{i=1}^{N} w_{m i} \exp \left(-\alpha_{m} y_{i} G_{m}\left(x_{i}\right)\right)$.é‡å¤ä¸Šè¿°æ“ä½œMæ¬¡åå¾—åˆ°Mä¸ªå¼±åˆ†ç±»å™¨,æ„å»ºçº¿æ€§ç»„åˆå¾—åˆ°<strong>æœ€ç»ˆåˆ†ç±»å™¨</strong>$G(x)=\operatorname{sign}(f(x))=\operatorname{sign}\left(\sum_{m=1}^{M} \alpha_{m} G_{m}(x)\right)$</p>
<h4 id="æå‡æ ‘"><a href="#æå‡æ ‘" class="headerlink" title="æå‡æ ‘"></a><strong>æå‡æ ‘</strong></h4><p>æå‡æ ‘æ˜¯æ¨¡å‹ä¸ºåŠ æ³•æ¨¡å‹,ç®—æ³•ä¸ºå‰å‘åˆ†å¸ƒç®—æ³•,åŸºå‡½æ•°ä¸º<strong>å†³ç­–æ ‘</strong>çš„æå‡æ–¹æ³•.ç¬¬mæ­¥çš„æ¨¡å‹æ˜¯$f_{m}(x)=f_{m-1}(x)+T\left(x ; \Theta_{m}\right)$,é€šè¿‡ç»éªŒé£é™©æå°åŒ–ç¡®å®šä¸‹ä¸€æ£µå†³ç­–æ ‘çš„å‚æ•°$\hat{\Theta}_{m}=\arg \min _{\theta_{m}} \sum_{i=1}^{N} L\left(y_{i}, f_{m-1}\left(x_{i}\right)+T\left(x_{i} ; \Theta_{m}\right)\right)$.ä¸åŒé—®é¢˜çš„æå‡æ ‘å­¦ä¹ ç®—æ³•ä¸»è¦åŒºåˆ«åœ¨äºä½¿ç”¨çš„<strong>æŸå¤±å‡½æ•°</strong>ä¸åŒ.</p>
<h5 id="äºŒç±»åˆ†ç±»é—®é¢˜"><a href="#äºŒç±»åˆ†ç±»é—®é¢˜" class="headerlink" title="äºŒç±»åˆ†ç±»é—®é¢˜"></a><strong>äºŒç±»åˆ†ç±»é—®é¢˜</strong></h5><p>åªéœ€å°†AdaBoostç®—æ³•ä¸­çš„åŸºæœ¬åˆ†ç±»å™¨é™åˆ¶ä¸ºäºŒç±»åˆ†ç±»æ•°å³å¯.</p>
<h5 id="å›å½’é—®é¢˜"><a href="#å›å½’é—®é¢˜" class="headerlink" title="å›å½’é—®é¢˜"></a><strong>å›å½’é—®é¢˜</strong></h5><p>å¦‚æœå°†è¾“å…¥ç©ºé—´åˆ’åˆ†ä¸ºJä¸ªäº’ä¸ç›¸äº¤çš„åŒºåŸŸ,å¹¶ä¸”åœ¨æ¯ä¸ªåŒºåŸŸä¸Šç¡®å®šè¾“å‡ºçš„å¸¸é‡$C_j$,é‚£ä¹ˆæ ‘å¯è¡¨ç¤ºä¸º$T(x ; \Theta)=\sum_{j=1}^{J} c_{j} I\left(x \in R_{j}\right)$,å…¶ä¸­$\Theta=\left\{\left(R_{1}, c_{1}\right),\left(R_{2}, c_{2}\right), \cdots,\left(R_{J}, c_{J}\right)\right\}$æå‡æ ‘é‡‡ç”¨<strong>å‰å‘åˆ†æ­¥ç®—æ³•</strong>:</p>
<script type="math/tex; mode=display">
\begin{aligned}
&f_{0}(x)=0\\
&\begin{array}{l}
f_{m}(x)=f_{m-1}(x)+T\left(x ; \Theta_{m}\right), m=1,2, \cdots, M \\
f_{M}(x)=\sum_{m=1}^{M} T\left(x ; \Theta_{m}\right)
\end{array}
\end{aligned}</script><p>.å½“é‡‡ç”¨å¹³æ–¹è¯¯å·®æŸå¤±å‡½æ•°æ—¶,æŸå¤±å˜ä¸º</p>
<script type="math/tex; mode=display">
\begin{array}{l}
L\left(y, f_{m-1}(x)+T\left(x ; \Theta_{m}\right)\right) \\
\quad=\left[y-f_{m-1}(x)-T\left(x ; \Theta_{m}\right)\right]^{2} \\
\quad=\left[r-T\left(x ; \Theta_{m}\right)\right]^{2}
\end{array}</script><p>,å…¶ä¸­ræ˜¯å½“å‰æ¨¡å‹æ‹Ÿåˆæ•°æ®çš„<strong>æ®‹å·®</strong>.æ¯ä¸€æ­¥éƒ½åªéœ€<strong>æ‹Ÿåˆæ®‹å·®</strong>å­¦ä¹ ä¸€ä¸ªå›å½’æ ‘å³å¯.</p>
<h5 id="å­˜åœ¨çš„ç¼ºç‚¹"><a href="#å­˜åœ¨çš„ç¼ºç‚¹" class="headerlink" title="å­˜åœ¨çš„ç¼ºç‚¹"></a>å­˜åœ¨çš„ç¼ºç‚¹</h5><p>å½“æŸå¤±å‡½æ•°å¼å¹³æ–¹è¯¯å·®æŸå¤±å‡½æ•°æˆ–è€…äº¤å‰ç†µæŸå¤±å‡½æ•°çš„æ—¶å€™ï¼Œæ®‹å·®å³ä¸ºå¯¹åº”çš„æ¢¯åº¦ï¼Œè¿™ä¸ªæ—¶å€™æŸå¤±å‡½æ•°æ²¿ç€æ¢¯åº¦çš„æ–¹å‘ä¸‹é™æœ€å¿«ã€‚å½“æŸå¤±å‡½æ•°å¼å…¶ä»–æŸå¤±å‡½æ•°çš„æ—¶å€™ï¼Œæ®‹å·®å’ŒæŸå¤±å‡½æ•°çš„å¯¼æ•°å¹¶ä¸ç›¸ç­‰ï¼Œå‡½æ•°æ”¶æ•›çš„é€Ÿåº¦å°±ä¼šæ²¡æœ‰æ²¿ç€æ¢¯åº¦çš„æ–¹å‘æ”¶æ•›çš„å¿«ã€‚</p>
<h4 id="æ¢¯åº¦æå‡æ ‘-GBDT"><a href="#æ¢¯åº¦æå‡æ ‘-GBDT" class="headerlink" title="æ¢¯åº¦æå‡æ ‘(GBDT)"></a>æ¢¯åº¦æå‡æ ‘(GBDT)</h4><p>åˆ©ç”¨æœ€é€Ÿä¸‹é™æ³•çš„è¿‘ä¼¼æ–¹æ³•æ¥å®ç°æ¯ä¸€æ­¥çš„ä¼˜åŒ–,å…³é”®åœ¨äºç”¨æŸå¤±å‡½æ•°çš„<strong>è´Ÿæ¢¯åº¦</strong>åœ¨å½“å‰æ¨¡å‹çš„å€¼$-\left[\frac{\partial L\left(y, f\left(x_{i}\right)\right)}{\partial f\left(x_{i}\right)}\right]_{f(x)=f_{-1}(x)}$ä½œä¸ºå›å½’é—®é¢˜ä¸­æå‡æ ‘ç®—æ³•ä¸­çš„æ®‹å·®çš„<strong>è¿‘ä¼¼å€¼</strong>,æ¯ä¸€æ­¥ä»¥æ­¤æ¥ä¼°è®¡å›å½’æ ‘å¶ç»“ç‚¹åŒºåŸŸä»¥æ‹Ÿåˆæ®‹å·®çš„è¿‘ä¼¼å€¼,å¹¶åˆ©ç”¨çº¿æ€§æœç´¢ä¼°è®¡å¶ç»“ç‚¹åŒºåŸŸçš„å€¼ä½¿æŸå¤±å‡½æ•°æœ€å°åŒ–,ç„¶åæ›´æ–°å›å½’æ ‘å³å¯.</p>
<h4 id="Xgboost"><a href="#Xgboost" class="headerlink" title="Xgboost"></a>Xgboost</h4><p>ç›¸æ¯”ä¼ ç»ŸGBDTæœ‰ä»¥ä¸‹ä¼˜ç‚¹:</p>
<ol>
<li>åœ¨ä¼˜åŒ–æ—¶ç”¨åˆ°äº†äºŒé˜¶å¯¼æ•°ä¿¡æ¯.</li>
<li>åœ¨ä»£ä»·å‡½æ•°é‡ŒåŠ å…¥äº†æ­£åˆ™é¡¹.</li>
<li>æ¯æ¬¡è¿­ä»£åéƒ½å°†å¶å­ç»“ç‚¹çš„æƒé‡ä¹˜ä¸Šä¸€ä¸ªç³»æ•°,å‰Šå¼±æ¯æ£µæ ‘çš„å½±å“.</li>
<li>åˆ—æŠ½æ ·.</li>
<li>åœ¨è®­ç»ƒå‰å¯¹æ•°æ®è¿›è¡Œæ’åº,ä¿å­˜ä¸ºblockç»“æ„,å¹¶è¡Œåœ°å¯¹å„ä¸ªç‰¹å¾è¿›è¡Œå¢ç›Šè®¡ç®—.</li>
</ol>
<h3 id="EMç®—æ³•"><a href="#EMç®—æ³•" class="headerlink" title="EMç®—æ³•"></a>EMç®—æ³•</h3><p>EMç®—æ³•æ˜¯ä¸€ç§<strong>è¿­ä»£</strong>ç®—æ³•,ç”¨äºå«æœ‰<strong>éšå˜é‡</strong>çš„æ¦‚ç‡æ¨¡å‹å‚æ•°çš„æå¤§ä¼¼ç„¶ä¼°è®¡.æ¯æ¬¡è¿­ä»£ç”±ä¸¤æ­¥ç»„æˆ:Eæ­¥,æ±‚<strong>æœŸæœ›</strong>(expectation),Mæ­¥,æ±‚<strong>æå¤§å€¼</strong>(maximization),ç›´è‡³æ”¶æ•›ä¸ºæ­¢.</p>
<h4 id="éšå˜é‡"><a href="#éšå˜é‡" class="headerlink" title="éšå˜é‡"></a><strong>éšå˜é‡</strong></h4><p>ä¸èƒ½è¢«ç›´æ¥è§‚å¯Ÿåˆ°ï¼Œä½†æ˜¯å¯¹ç³»ç»Ÿçš„çŠ¶æ€å’Œèƒ½è§‚å¯Ÿåˆ°çš„è¾“å‡ºå­˜åœ¨å½±å“çš„ä¸€ç§ä¸œè¥¿.</p>
<h4 id="ç®—æ³•-6"><a href="#ç®—æ³•-6" class="headerlink" title="ç®—æ³•"></a><strong>ç®—æ³•</strong></h4><ol>
<li>é€‰æ‹©å‚æ•°çš„åˆå§‹å€¼Î¸(0),å¼€å§‹è¿­ä»£.æ³¨æ„EMç®—æ³•å¯¹åˆå€¼æ˜¯<strong>æ•æ„Ÿ</strong>çš„.</li>
<li><strong>Eæ­¥</strong>:Î¸(i)ä¸ºç¬¬iæ¬¡è¿­ä»£å‚æ•°Î¸çš„ä¼°è®¡å€¼,åœ¨ç¬¬i+1æ¬¡è¿­ä»£çš„Eæ­¥,è®¡ç®—$\begin{aligned} Q\left(\theta, \theta^{(i)}\right) &amp;=E_{z}\left[\log P(Y, Z | \theta) | Y, \theta^{(i)}\right] =\sum_{z} \log P(Y, Z | \theta) P\left(Z | Y, \theta^{(i)}\right) \end{aligned}$ ,$P(Z|Y,Î¸(i))$æ˜¯åœ¨ç»™å®š<strong>è§‚æµ‹æ•°æ®</strong>Yå’Œå½“å‰å‚æ•°ä¼°è®¡Î¸(i)ä¸‹<strong>éšå˜é‡æ•°æ®</strong>Zçš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ.</li>
<li><strong>Mæ­¥</strong>:æ±‚ä½¿Q(Î¸,Î¸(i))æå¤§åŒ–çš„Î¸,ç¡®å®šç¬¬i+1æ¬¡è¿­ä»£çš„å‚æ•°çš„ä¼°è®¡å€¼$\theta^{(i+1)}=\arg \max _{\theta} Q\left(\theta, \theta^{(i)}\right)$</li>
<li>é‡å¤2å’Œ3ç›´åˆ°<strong>æ”¶æ•›</strong>,ä¸€èˆ¬æ˜¯å¯¹è¾ƒå°çš„æ­£æ•°$\varepsilon1$å’Œ$\varepsilon2$æ»¡è¶³$\left|\theta^{(i+1)}-\theta^{(i)}\right|&lt;\varepsilon_{1} \quad$ æˆ–$\quad\left|Q\left(\theta^{(i+1)}, \theta^{(i)}\right)-Q\left(\theta^{(i)}, \theta^{(i)}\right)\right|&lt;\varepsilon_{2}$åˆ™åœæ­¢è¿­ä»£.</li>
</ol>
<h4 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h4><p>EMç®—æ³•æ˜¯é€šè¿‡ä¸æ–­æ±‚è§£<strong>ä¸‹ç•Œ</strong>çš„æå¤§åŒ–é€¼è¿‘æ±‚è§£å¯¹æ•°ä¼¼ç„¶å‡½æ•°æå¤§åŒ–çš„ç®—æ³•.å¯ä»¥ç”¨äºç”Ÿæˆæ¨¡å‹çš„<strong>éç›‘ç£å­¦ä¹ </strong>.ç”Ÿæˆæ¨¡å‹ç”±è”åˆæ¦‚ç‡åˆ†å¸ƒP(X,Y)è¡¨ç¤º.Xä¸ºè§‚æµ‹æ•°æ®,Yä¸ºæœªè§‚æµ‹æ•°æ®.</p>
<h3 id="éšé©¬å°”ç§‘å¤«æ¨¡å‹-HMM"><a href="#éšé©¬å°”ç§‘å¤«æ¨¡å‹-HMM" class="headerlink" title="éšé©¬å°”ç§‘å¤«æ¨¡å‹(HMM)"></a>éšé©¬å°”ç§‘å¤«æ¨¡å‹(HMM)</h3><p>éšé©¬å°”å¯å¤«æ¨¡å‹æ˜¯å…³äº<strong>æ—¶åº</strong>çš„æ¦‚ç‡æ¨¡å‹,æè¿°ç”±ä¸€ä¸ªéšè—çš„é©¬å°”å¯å¤«é“¾éšæœºç”Ÿæˆä¸å¯è§‚æµ‹çš„<strong>çŠ¶æ€åºåˆ—</strong>,å†ç”±å„ä¸ªçŠ¶æ€ç”Ÿæˆä¸€ä¸ªè§‚æµ‹è€Œäº§ç”Ÿ<strong>è§‚æµ‹éšæœºåºåˆ—</strong>çš„è¿‡ç¨‹.HMMæ˜¯ä¸€ç§ç”Ÿæˆå¼æ¨¡å‹ï¼Œå®ƒçš„ç†è®ºåŸºç¡€æ˜¯æœ´ç´ è´å¶æ–¯ï¼Œæœ¬è´¨ä¸Šå°±ç±»ä¼¼äºæˆ‘ä»¬å°†æœ´ç´ è´å¶æ–¯åœ¨å•æ ·æœ¬åˆ†ç±»é—®é¢˜ä¸Šçš„åº”ç”¨æ¨å¹¿åˆ°åºåˆ—æ ·æœ¬åˆ†ç±»é—®é¢˜ä¸Šã€‚</p>
<h4 id="æ¨¡å‹è¡¨ç¤º"><a href="#æ¨¡å‹è¡¨ç¤º" class="headerlink" title="æ¨¡å‹è¡¨ç¤º"></a>æ¨¡å‹è¡¨ç¤º</h4><p>è®¾Qæ˜¯æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€çš„é›†åˆ$Q=\left\{q_{1}, q_{2}, \cdots, q_{N}\right\}$,Væ˜¯æ‰€æœ‰å¯èƒ½çš„è§‚æµ‹çš„é›†åˆ$V=\left\{v_{1}, v_{2}, \cdots, v_{M}\right\}$,Iæ˜¯é•¿åº¦ä¸ºTçš„çŠ¶æ€åºåˆ—$I=\left(i_{1}, i_{2}, \cdots, i_{T}\right)$, Oæ˜¯å¯¹åº”çš„è§‚æµ‹åºåˆ—$O=\left(o_{1}, o_{2}, \cdots, o_{T}\right)$,</p>
<ol>
<li>Aæ˜¯<strong>çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µ</strong>$A=\left[a_{i j}\right]_{N \times N}$,$a_{ij}$è¡¨ç¤ºåœ¨æ—¶åˆ»tå¤„äºçŠ¶æ€$q_i$çš„æ¡ä»¶ä¸‹åœ¨æ—¶åˆ»t+1è½¬ç§»åˆ°çŠ¶æ€$q_j$çš„æ¦‚ç‡.</li>
<li>.Bæ˜¯<strong>è§‚æµ‹æ¦‚ç‡çŸ©é˜µ</strong> $B=\left[b_{j}(k)\right]_{N \times M}$,$b_{ij}$æ˜¯åœ¨æ—¶åˆ»tå¤„äºçŠ¶æ€$q_j$çš„æ¡ä»¶ä¸‹ç”Ÿæˆè§‚æµ‹$v_k$çš„æ¦‚ç‡.</li>
<li>$\pi$æ˜¯<strong>åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡</strong>$\pi=\pi(x)$,$\pi_i$è¡¨ç¤ºæ—¶åˆ»t=1å¤„äºçŠ¶æ€qiçš„æ¦‚ç‡.</li>
</ol>
<p>éšé©¬å°”å¯å¤«æ¨¡å‹ç”±åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡$pi$,çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µAä»¥åŠè§‚æµ‹æ¦‚ç‡çŸ©é˜µBç¡®å®š.$\pi$å’ŒAå†³å®šå³éšè—çš„<strong>é©¬å°”å¯å¤«é“¾</strong>,ç”Ÿæˆä¸å¯è§‚æµ‹çš„<strong>çŠ¶æ€åºåˆ—</strong>.Bå†³å®šå¦‚ä½•ä»çŠ¶æ€ç”Ÿæˆè§‚æµ‹,ä¸çŠ¶æ€åºåˆ—ç»¼åˆç¡®å®šäº†<strong>è§‚æµ‹åºåˆ—</strong>.å› æ­¤,éšé©¬å°”å¯å¤«æ¨¡å‹å¯ä»¥ç”¨<strong>ä¸‰å…ƒç¬¦å·</strong>è¡¨ç¤º$\lambda = (A,B,\pi)$</p>
<h4 id="ä¸¤ä¸ªåŸºæœ¬å‡è®¾"><a href="#ä¸¤ä¸ªåŸºæœ¬å‡è®¾" class="headerlink" title="ä¸¤ä¸ªåŸºæœ¬å‡è®¾"></a>ä¸¤ä¸ªåŸºæœ¬å‡è®¾</h4><ol>
<li><strong>é½æ¬¡é©¬å°”å¯å¤«æ€§å‡è®¾</strong>:å‡è®¾éšè—çš„é©¬å°”å¯å¤«é“¾åœ¨ä»»æ„æ—¶åˆ»tçš„çŠ¶æ€åªä¾èµ–äºå…¶å‰ä¸€æ—¶åˆ»çš„çŠ¶æ€.</li>
<li><strong>è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾</strong>:å‡è®¾ä»»æ„æ—¶åˆ»çš„è§‚æµ‹åªä¾èµ–äºè¯¥æ—¶åˆ»çš„é©¬å°”å¯å¤«é“¾çš„çŠ¶æ€.</li>
</ol>
<h4 id="ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"><a href="#ä¸‰ä¸ªåŸºæœ¬é—®é¢˜" class="headerlink" title="ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"></a>ä¸‰ä¸ªåŸºæœ¬é—®é¢˜</h4><h5 id="1-æ¦‚ç‡è®¡ç®—é—®é¢˜"><a href="#1-æ¦‚ç‡è®¡ç®—é—®é¢˜" class="headerlink" title="1. æ¦‚ç‡è®¡ç®—é—®é¢˜"></a><strong>1. æ¦‚ç‡è®¡ç®—é—®é¢˜</strong></h5><p>ç»™å®šæ¨¡å‹$\lambda = (A,B,\pi)$å’Œè§‚æµ‹åºåˆ—,$O=\left(o_{1}, o_{2}, \cdots, o_{T}\right)$è®¡ç®—åœ¨æ¨¡å‹$\lambda$ä¸‹è§‚æµ‹åºåˆ—Oå‡ºç°çš„æ¦‚ç‡$P(O|Î»)$.</p>
<ol>
<li>ç›´æ¥è®¡ç®—ï¼šåˆ—ä¸¾æ‰€æœ‰å¯èƒ½é•¿åº¦ä¸ºTçš„çŠ¶æ€åºåˆ—,æ±‚å„ä¸ªçŠ¶æ€åºåˆ—Iä¸è§‚æµ‹åºåˆ—Oçš„è”åˆæ¦‚ç‡,ä½†è®¡ç®—é‡å¤ªå¤§,å®é™…æ“ä½œä¸å¯è¡Œ.</li>
<li><strong>å‰å‘ç®—æ³•</strong>ï¼šå®šä¹‰åˆ°æ—¶åˆ»téƒ¨åˆ†è§‚æµ‹åºåˆ—ä¸º$o_1$~$o_t$ä¸”çŠ¶æ€ä¸º$q_i$çš„æ¦‚ç‡ä¸º<strong>å‰å‘æ¦‚ç‡</strong>,è®°ä½œ$\alpha_{t}(i)=P\left(o_{1}, o_{2}, \cdots, o_{t}, i_{t}=q_{i} | \lambda\right)$.åˆå§‹åŒ–å‰å‘æ¦‚ç‡$\alpha_{1}(i)=\pi_{i} b_{i}\left(o_{1}\right), \quad i=1,2, \cdots, N$ï¼Œé€’æ¨ï¼Œå¯¹$t=1$ ~ $T-1$,$\alpha_{t+1}(i)=\left[\sum_{j=1}^{N} \alpha_{t}(j) a_{j i}\right] b_{i}\left(o_{t+1}\right), \quad i=1,2, \cdots, N$,å¾—åˆ°$P(O | \lambda)=\sum_{i=1}^{N} \alpha_{T}(i)$å‡å°‘è®¡ç®—é‡çš„åŸå› åœ¨äºæ¯ä¸€æ¬¡è®¡ç®—ç›´æ¥å¼•ç”¨å‰ä¸€ä¸ªæ—¶åˆ»çš„è®¡ç®—ç»“æœ,é¿å…é‡å¤è®¡ç®—.</li>
<li><strong>åå‘ç®—æ³•</strong>:å®šä¹‰åœ¨æ—¶åˆ»tçŠ¶æ€ä¸º$q_i$çš„æ¡ä»¶ä¸‹,ä»t+1åˆ°Tçš„éƒ¨åˆ†è§‚æµ‹åºåˆ—ä¸º$o_{i+1}$~$o_T$çš„æ¦‚ç‡ä¸º<strong>åå‘æ¦‚ç‡</strong>,è®°ä½œ$\beta_{t}(i)=P\left(o_{t+1}, o_{t+2}, \cdots, o_{r} | i_{t}=q_{i}, \lambda\right)$.åˆå§‹åŒ–åå‘æ¦‚ç‡$\beta_{r}(i)=1, \quad i=1,2, \cdots, N$,é€’æ¨,å¯¹$t=T-1$~$1$$\beta_{t}(i)=\sum_{j=1}^{N} a_{i j} b_{j}\left(o_{i+1}\right) \beta_{i+1}(j), \quad i=1,2, \cdots, N$,å¾—åˆ°$P(O | \lambda)=\sum_{i=1}^{N} \pi_{i} b_{i}\left(o_{1}\right) \beta_{1}(i)$</li>
</ol>
<h5 id="2-å­¦ä¹ ç®—æ³•"><a href="#2-å­¦ä¹ ç®—æ³•" class="headerlink" title="2. å­¦ä¹ ç®—æ³•"></a><strong>2. å­¦ä¹ ç®—æ³•</strong></h5><p>å·²çŸ¥è§‚æµ‹åºåˆ—$O=(o_1,o_2, \cdots,o_r)$,ä¼°è®¡æ¨¡å‹$\lambda = (A,B,\pi)$,çš„å‚æ•°,ä½¿å¾—åœ¨è¯¥æ¨¡å‹ä¸‹è§‚æµ‹åºåˆ—æ¦‚ç‡$p(O|\lambda)$æœ€å¤§.æ ¹æ®è®­ç»ƒæ•°æ®æ˜¯å¦åŒ…æ‹¬è§‚å¯Ÿåºåˆ—å¯¹åº”çš„çŠ¶æ€åºåˆ—åˆ†åˆ«ç”±ç›‘ç£å­¦ä¹ ä¸éç›‘ç£å­¦ä¹ å®ç°.</p>
<ol>
<li><p>ç›‘ç£å­¦ä¹ ï¼šä¼°è®¡è½¬ç§»æ¦‚ç‡$\hat{a}_{i j}=\frac{A_{i j}}{\sum_{j=1}^{N} A_{i j}}, \quad i=1,2, \cdots, N ; \quad j=1,2, \cdots, N$ å’Œè§‚æµ‹æ¦‚ç‡$\hat{b}_{j}(k)=\frac{B_{j k}}{\sum_{k=1}^{M} B_{j k}}, \quad j=1,2, \cdots, N, k=1,2, \cdots, M$.åˆå§‹çŠ¶æ€æ¦‚ç‡$\pi_i$çš„ä¼°è®¡ä¸ºSä¸ªæ ·æœ¬ä¸­åˆå§‹çŠ¶æ€ä¸º$q_i$çš„é¢‘ç‡.</p>
</li>
<li><p><strong>éç›‘ç£å­¦ä¹ (Baum-Welchç®—æ³•)</strong>:å°†è§‚æµ‹åºåˆ—æ•°æ®çœ‹ä½œè§‚æµ‹æ•°æ®O,çŠ¶æ€åºåˆ—æ•°æ®çœ‹ä½œä¸å¯è§‚æµ‹çš„<strong>éšæ•°æ®</strong>I.é¦–å…ˆç¡®å®šå®Œå…¨æ•°æ®çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°$log p(O,I|\lambda)$,æ±‚Qå‡½æ•°</p>
<script type="math/tex; mode=display">
\begin{aligned}
Q(\lambda, \bar{\lambda})=& \sum_{t} \log \pi_{i_1} P(O, I | \bar{\lambda}) \\
&+\sum_{I}\left(\sum_{i=1}^{I-1} \log a_{i_t,i_{t+1}}\right) P(O, I | \bar{\lambda}) \\
&+\sum_{I}\left(\sum_{i=1}^{T} \log b_{i_t}\left(o_{t}\right)\right) P(O, I | \bar{\lambda})
\end{aligned}</script><p>,ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•æå¤§åŒ–Qå‡½æ•°æ±‚æ¨¡å‹å‚æ•°$\pi_{i}=\frac{P\left(O, i_{1}=i | \bar{\lambda}\right)}{P(O | \bar{\lambda})}$,$a_{i j}=\frac{\sum_{i=1}^{T-1} P\left(O, i_{t}=i, i_{t+1}=j | \bar{\lambda}\right)}{\sum_{t=1}^{T-1} P\left(O, i_{t}=i | \bar{\lambda}\right)}$,$b_{j}(k)=\frac{\sum_{i=1}^{T} P\left(O, i_{t}=j | \bar{\lambda}\right) I\left(o_{i}=v_{k}\right)}{\sum_{i=1}^{T} P\left(O, i_{t}=j | \bar{\lambda}\right)}$,</p>
</li>
</ol>
<h5 id="3-é¢„æµ‹é—®é¢˜"><a href="#3-é¢„æµ‹é—®é¢˜" class="headerlink" title="3. é¢„æµ‹é—®é¢˜"></a><strong>3. é¢„æµ‹é—®é¢˜</strong></h5><p>ä¹Ÿç§°ä¸ºè§£ç é—®é¢˜.å·²çŸ¥æ¨¡å‹$\lambda = (A,B,\pi)$å’Œè§‚æµ‹åºåˆ—$O=(O_1,O_2,\cdots,O_T)$,æ±‚å¯¹ç»™å®šè§‚æµ‹åºåˆ—æ¡ä»¶æ¦‚ç‡$P(I|O)$æœ€å¤§çš„çŠ¶æ€åºåˆ—$I=(i_1,i_2,\cdots,i_T)$</p>
<ol>
<li><p><strong>è¿‘ä¼¼ç®—æ³•</strong>: åœ¨æ¯ä¸ªæ—¶åˆ»té€‰æ‹©åœ¨è¯¥æ—¶åˆ»æœ€æœ‰å¯èƒ½å‡ºç°çš„çŠ¶æ€$i_t^<em>$,ä»è€Œå¾—åˆ°ä¸€ä¸ªçŠ¶æ€åºåˆ—ä½œä¸ºé¢„æµ‹çš„ç»“æœ.ä¼˜ç‚¹æ˜¯<em>*è®¡ç®—ç®€å•</em></em>,ç¼ºç‚¹æ˜¯ä¸èƒ½ä¿è¯çŠ¶æ€åºåˆ—æ•´ä½“æ˜¯æœ€æœ‰å¯èƒ½çš„çŠ¶æ€åºåˆ—</p>
</li>
<li><p><strong>ç»´ç‰¹æ¯”ç®—æ³•</strong>:ç”¨<strong>åŠ¨æ€è§„åˆ’</strong>æ±‚æ¦‚ç‡æœ€å¤§è·¯å¾„,è¿™ä¸€æ¡è·¯å¾„å¯¹åº”ç€ä¸€ä¸ªçŠ¶æ€åºåˆ—.ä»t=1å¼€å§‹,é€’æ¨åœ°è®¡ç®—åœ¨æ—¶åˆ»tçŠ¶æ€ä¸ºiçš„å„æ¡éƒ¨åˆ†è·¯å¾„çš„æœ€å¤§æ¦‚ç‡,ç›´è‡³å¾—åˆ°æ—¶åˆ»t=TçŠ¶æ€ä¸ºiçš„å„æ¡è·¯å¾„çš„æœ€å¤§æ¦‚ç‡.æ—¶åˆ»t=Tçš„æœ€å¤§æ¦‚ç‡å³ä¸º<strong>æœ€ä¼˜è·¯å¾„</strong>çš„æ¦‚ç‡$P^\star$,æœ€ä¼˜è·¯å¾„çš„<strong>ç»ˆç»“ç‚¹</strong>$i_t^\star$ä¹ŸåŒæ—¶å¾—åˆ°,ä¹‹åä»ç»ˆç»“ç‚¹å¼€å§‹ç”±åå‘å‰é€æ­¥æ±‚å¾—<strong>ç»“ç‚¹</strong>,å¾—åˆ°æœ€ä¼˜è·¯å¾„.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">viterbi</span><span class="params">(obs, states, Pi, A, B)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param obs:è§‚æµ‹åºåˆ—</span></span><br><span class="line"><span class="string">    :param states:éšçŠ¶æ€</span></span><br><span class="line"><span class="string">    :param Pi:åˆå§‹æ¦‚ç‡ï¼ˆéšçŠ¶æ€ï¼‰</span></span><br><span class="line"><span class="string">    :param A:è½¬ç§»æ¦‚ç‡ï¼ˆéšçŠ¶æ€ï¼‰</span></span><br><span class="line"><span class="string">    :param B: å‘å°„æ¦‚ç‡ ï¼ˆéšçŠ¶æ€è¡¨ç°ä¸ºæ˜¾çŠ¶æ€çš„æ¦‚ç‡ï¼‰</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># è·¯å¾„æ¦‚ç‡è¡¨ V[æ—¶é—´][éšçŠ¶æ€] = æ¦‚ç‡</span></span><br><span class="line">    V = [&#123;&#125;]</span><br><span class="line">    <span class="comment"># ä¸€ä¸ªä¸­é—´å˜é‡ï¼Œä»£è¡¨å½“å‰çŠ¶æ€æ˜¯å“ªä¸ªéšçŠ¶æ€</span></span><br><span class="line">    path = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–åˆå§‹çŠ¶æ€ (t == 0)</span></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">        V[<span class="number">0</span>][y] = Pi[y] * B[y][obs[<span class="number">0</span>]]</span><br><span class="line">        path[y] = [y]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¹ t &gt; 0 è·‘ä¸€éç»´ç‰¹æ¯”ç®—æ³•</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">1</span>, len(obs)):</span><br><span class="line">        V.append(&#123;&#125;)</span><br><span class="line">        newpath = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">            <span class="comment"># æ¦‚ç‡ éšçŠ¶æ€ =    å‰çŠ¶æ€æ˜¯y0çš„æ¦‚ç‡ * y0è½¬ç§»åˆ°yçš„æ¦‚ç‡ * yè¡¨ç°ä¸ºå½“å‰çŠ¶æ€çš„æ¦‚ç‡</span></span><br><span class="line">            (prob, state) = max([(V[t - <span class="number">1</span>][y0] * A[y0][y] * B[y][obs[t]], y0) <span class="keyword">for</span> y0 <span class="keyword">in</span> states])</span><br><span class="line">            <span class="comment"># è®°å½•æœ€å¤§æ¦‚ç‡</span></span><br><span class="line">            V[t][y] = prob</span><br><span class="line">            <span class="comment"># è®°å½•è·¯å¾„</span></span><br><span class="line">            newpath[y] = path[state] + [y]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¸éœ€è¦ä¿ç•™æ—§è·¯å¾„</span></span><br><span class="line">        path = newpath</span><br><span class="line"></span><br><span class="line">    print_dptable(V)</span><br><span class="line">    (prob, state) = max([(V[len(obs) - <span class="number">1</span>][y], y) <span class="keyword">for</span> y <span class="keyword">in</span> states])</span><br><span class="line">    <span class="keyword">return</span> (prob, path[state])</span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ‰“å°è·¯å¾„æ¦‚ç‡è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_dptable</span><span class="params">(V)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"    "</span>,</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(V)): <span class="keyword">print</span> <span class="string">"%7d"</span> % i,</span><br><span class="line">    <span class="keyword">print</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> V[<span class="number">0</span>].keys():</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"%.5s: "</span> % y,</span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> range(len(V)):</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"%.7s"</span> % (<span class="string">"%f"</span> % V[t][y]),</span><br><span class="line">        <span class="keyword">print</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="æœ€å¤§ç†µé©¬å°”ç§‘å¤«æ¨¡å‹-MEMM"><a href="#æœ€å¤§ç†µé©¬å°”ç§‘å¤«æ¨¡å‹-MEMM" class="headerlink" title="æœ€å¤§ç†µé©¬å°”ç§‘å¤«æ¨¡å‹(MEMM)"></a>æœ€å¤§ç†µé©¬å°”ç§‘å¤«æ¨¡å‹(MEMM)</h3><p>æœ€å¤§ç†µé©¬å°”ç§‘å¤«æ¨¡å‹åˆ©ç”¨åˆ¤åˆ«å¼æ¨¡å‹çš„ç‰¹ç‚¹ï¼Œç›´æ¥å¯¹æ¯ä¸€ä¸ªæ—¶åˆ»çš„çŠ¶æ€å»ºç«‹ä¸€ä¸ªåˆ†ç±»å™¨ï¼Œç„¶åå°†æ‰€æœ‰çš„åˆ†ç±»å™¨çš„æ¦‚ç‡å€¼è¿ä¹˜èµ·æ¥$P\left(y_{1}^{n} | x_{1}^{n}\right)=\prod_{t=1}^{n} P\left(y_{t} | y_{t-1}, x_{t}\right)$ã€‚ä¸ºäº†å®ç°æ˜¯å¯¹æ•´ä¸ªåºåˆ—è¿›è¡Œçš„åˆ†ç±»ï¼Œåœ¨æ¯ä¸ªæ—¶åˆ»tæ—¶ï¼Œå®ƒçš„ç‰¹å¾ä¸ä»…æ¥è‡ªå½“å‰è§‚æµ‹å€¼$x_t$ï¼Œè€Œä¸”è¿˜æ¥è‡ªå‰ä¸€çŠ¶æ€å€¼$y_{t-1}$,é€šè¿‡æœ€å¤§ç†µåˆ†ç±»å™¨å»ºæ¨¡$P\left(y_{t}=y^{<em>} | y_{t-1}=y^{\prime}, x_{t}\right)=\frac{1}{Z\left(x_{t}, y^{\prime}\right)} \exp \left(\sum_{a} \lambda_{a} f_{a}\left(x_{t}, y^{\prime}, y^{</em>}\right)\right)$,å…¶ä¸­ï¼Œ$Z\left(x_{t}, y \prime\right)=\sum_{y} \exp \left(\sum_{a} \lambda_{a} f_{a}\left(x_{t}, y \prime, y\right)\right)$ï¼Œ</p>
<h4 id="æ ‡æ³¨åç½®é—®é¢˜"><a href="#æ ‡æ³¨åç½®é—®é¢˜" class="headerlink" title="æ ‡æ³¨åç½®é—®é¢˜"></a>æ ‡æ³¨åç½®é—®é¢˜</h4><p>ä½¿ç”¨ç»´ç‰¹æ¯”ç®—æ³•è¿›è¡Œè§£ç æ—¶ï¼Œ$v_{t}(j)=\max _{i} v_{t-1}(i) * P\left(y_{j} | y_{i}, x_{t}\right) 1 \leq j \leq n, 1&lt;t&lt;T$ã€‚æœ€å¤§ç†µæ¨¡å‹åœ¨æ¯ä¸€ä¸ªæ—¶åˆ»ï¼Œé’ˆå¯¹ä¸åŒçš„å‰ä¸€çŠ¶æ€yâ€²è¿›è¡Œå½’ä¸€åŒ–æ“ä½œï¼Œè¿™æ˜¯ä¸€ç§å±€éƒ¨çš„å½’ä¸€åŒ–æ“ä½œï¼Œä¼šå­˜åœ¨æ ‡ç­¾åç½®é—®é¢˜ã€‚</p>
<h5 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h5><p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/label_bias.png" alt="avatar"></p>
<p>çŠ¶æ€è½¬æ¢(1â†’2),(2â†’3),(4â†’5),(5â†’3)çš„æ¦‚ç‡å€¼éƒ½æ˜¯1ï¼Œè€Œæ— è®ºè§‚æµ‹å€¼æ˜¯ä»€ä¹ˆï¼Œæ¢è¨€ä¹‹æœ‰$P(2|1,i)=P(2|1,o)=1$</p>
<p>ä½ å¯èƒ½ä¼šå¾ˆæƒŠè®¶$P(2âˆ£1,i)=1,P(2âˆ£1,o)=1$æ€ä¹ˆå¯èƒ½ä¼šæˆç«‹å‘¢ï¼Ÿä½ å¯ä»¥å¥—ç”¨ä¸Šé¢çš„å…¬å¼è¯•ä¸€è¯•ï¼Œç”±äºçŠ¶æ€â€1â€çš„åªèƒ½è½¬æ¢ä¸ºâ€2â€ï¼Œæ‰€ä»¥è®¡ç®—å½’ä¸€åŒ–é¡¹æ—¶ï¼Œ å…¶å®åªæœ‰ä¸€ä¸ªæšä¸¾å€¼ï¼Œå°±æ˜¯çŠ¶æ€â€2â€ï¼Œæ‰€ä»¥æ— è®ºä½ åˆ†å­ä¸ºå¤šå°‘ï¼Œåˆ†æ¯éƒ½å’Œå®ƒä¸€æ ·ï¼Œæ‰€ä»¥æ¦‚ç‡å€¼å°±æ˜¯1ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶å®è§‚æµ‹å€¼å¹¶æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œè¿™å°±æ˜¯æ ‡ç­¾åç½®ã€‚</p>
<h5 id="åæœï¼š"><a href="#åæœï¼š" class="headerlink" title="åæœï¼š"></a><strong>åæœï¼š</strong></h5><p>å®ƒä¼šé€ æˆä»€ä¹ˆåæœå‘¢ï¼Ÿ<br>ä»–ä¼šå¯¼è‡´æ¨¡å‹è¿›è¡Œé¢„æµ‹æ—¶åªä¾èµ–æ•°æ®ç»Ÿè®¡å‡ºæ¥çš„æ¦‚ç‡å€¼ï¼Œæ²¡æœ‰åˆ©ç”¨åˆ°æ ·æœ¬çš„ç‰¹å¾ã€‚<br>å‡è®¾è®­ç»ƒé›†ç°åœ¨æœ‰3ä¸ªribå’Œ1ä¸ªrobï¼Œå½“æˆ‘ä»¬åœ¨æµ‹è¯•é˜¶æ®µï¼Œé‡åˆ°è¯robï¼Œå®ƒä¼šè¢«è§£ç æˆä»€ä¹ˆçŠ¶æ€åºåˆ—å‘¢ï¼Ÿç­”æ¡ˆæ˜¯(0â†’1â†’2â†’3)ï¼ä½ å¯ä»¥å¥—å…¬å¼è¯•ä¸€è¯•ï¼Œå› ä¸º$P(1âˆ£0,r)&gt;P(4âˆ£0,r)$,$P(2âˆ£1,o)=P(5âˆ£4,0)=1,P(3âˆ£2,b)&gt;P(3âˆ£5,b)$ã€‚</p>
<h5 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a><strong>åŸå› </strong></h5><p>é‚£ä¹ˆé—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ï¼Ÿå› ä¸ºMEMMä¸­åœ¨æ¯ä¸€æ—¶åˆ»tï¼Œéƒ½åœ¨å‰ä¸€æ—¶åˆ»æŸçŠ¶æ€yâ€²ä¸‹åšäº†å±€éƒ¨çš„å½’ä¸€åŒ–æ“ä½œï¼Œå¦‚ä½•è§£å†³è¿™ç§æ ‡ç­¾åç½®é—®é¢˜å‘¢ï¼Ÿ<br>åœ¨CRFä¸­å¹¶ä¸æ˜¯å¯¹æ¯ä¸ªæ—¶åˆ»éƒ½è¿›è¡Œä¸€æ¬¡åˆ†ç±»ï¼Œè€Œæ˜¯ç›´æ¥å¯¹æ•´ä¸ªåºåˆ—è¿›è¡Œåˆ†ç±»ï¼Œåšä¸€ä¸ªå…¨å±€çš„å½’ä¸€åŒ–æ“ä½œã€‚</p>
<h3 id="æ¡ä»¶éšæœºåœºCRF"><a href="#æ¡ä»¶éšæœºåœºCRF" class="headerlink" title="æ¡ä»¶éšæœºåœºCRF"></a>æ¡ä»¶éšæœºåœºCRF</h3><h4 id="æ¦‚ç‡å›¾æ¨¡å‹"><a href="#æ¦‚ç‡å›¾æ¨¡å‹" class="headerlink" title="æ¦‚ç‡å›¾æ¨¡å‹"></a>æ¦‚ç‡å›¾æ¨¡å‹</h4><p>ç»“ç‚¹è¡¨ç¤ºéšæœºå˜é‡ï¼Œè¾¹è¡¨ç¤ºéšæœºå˜é‡ä¹‹é—´çš„æ¦‚ç‡ä¾èµ–å…³ç³»ã€‚</p>
<h5 id="é©¬å°”ç§‘å¤«æ€§"><a href="#é©¬å°”ç§‘å¤«æ€§" class="headerlink" title="é©¬å°”ç§‘å¤«æ€§"></a>é©¬å°”ç§‘å¤«æ€§</h5><ol>
<li>æˆå¯¹é©¬å°”å¯å¤«æ€§</li>
<li>å±€éƒ¨é©¬å°”ç§‘å¤«æ€§</li>
<li>å…¨å±€é©¬å°”ç§‘å¤«æ€§</li>
</ol>
<h5 id="æ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„å› å¼åˆ†è§£"><a href="#æ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„å› å¼åˆ†è§£" class="headerlink" title="æ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„å› å¼åˆ†è§£"></a>æ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„å› å¼åˆ†è§£</h5><h6 id="å›¢ä¸æœ€å¤§å›¢"><a href="#å›¢ä¸æœ€å¤§å›¢" class="headerlink" title="å›¢ä¸æœ€å¤§å›¢"></a>å›¢ä¸æœ€å¤§å›¢</h6><p>æ— å‘å›¾Gä¸­ä»»ä½•ä¸¤ä¸ªç»“ç‚¹å‡æœ‰è¾¹è¿æ¥çš„ç»“ç‚¹å­é›†ç§°ä¸º<strong>å›¢</strong>ã€‚è‹¥Cæ˜¯æ— å‘å›¾Gçš„ä¸€ä¸ªå›¢ï¼Œå¹¶ä¸”ä¸èƒ½å†åŠ è¿›ä»»ä½•ä¸€ä¸ªGçš„ç»“ç‚¹ä½¿å…¶æˆä¸ºä¸€ä¸ªæ›´å¤§çš„å›¢ï¼Œç§°æ­¤Cä¸º<strong>æœ€å¤§å›¢</strong>ã€‚</p>
<p>ç»™å®šæ¦‚ç‡æ— å‘å›¾æ¨¡å‹ï¼Œè®¾å…¶æ— å‘å›¾ä¸ºGï¼ŒCä¸ºGä¸Šçš„æœ€å¤§å›¢ï¼Œ$Y_C$è¡¨ç¤ºCå¯¹åº”çš„éšæœºå˜é‡ã€‚é‚£ä¹ˆæ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„è”åˆæ¦‚ç‡åˆ†å¸ƒ$P(Y)$å¯å†™ä½œå›¾ä¸­æ‰€æœ‰æœ€å¤§å›¢Cä¸Šçš„å‡½æ•°$\phi_C(Y_C)$çš„ä¹˜ç§¯çš„å½¢å¼ã€‚</p>
<p><strong>Hammersley-Cliffordå®šç†</strong><br>æ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„è”åˆæ¦‚ç‡åˆ†å¸ƒ$P(Y)$å¯ä»¥è¡¨ç¤ºä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p>
<script type="math/tex; mode=display">
P(Y)=\frac{1}{Z}\prod_C{\phi_C(Y_C)}\\
Z=\sum_Y\prod_C{\phi_C(Y_C)}</script><h5 id="æ¡ä»¶éšæœºåœºCRF-1"><a href="#æ¡ä»¶éšæœºåœºCRF-1" class="headerlink" title="æ¡ä»¶éšæœºåœºCRF"></a>æ¡ä»¶éšæœºåœºCRF</h5><p>æ¡ä»¶éšæœºåœºåŸºäºæ¦‚ç‡æ— å‘å›¾æ¨¡å‹ï¼Œåˆ©ç”¨æœ€å¤§å›¢ç†è®ºï¼Œå¯¹éšæœºå˜é‡çš„è”åˆåˆ†å¸ƒ$P(Y)$è¿›è¡Œå»ºæ¨¡ã€‚</p>
<p>åœ¨åºåˆ—æ ‡æ³¨ä»»åŠ¡ä¸­çš„æ¡ä»¶éšæœºåœºï¼Œå¾€å¾€æ˜¯æŒ‡<strong>çº¿æ€§é“¾æ¡ä»¶éšæœºåœº</strong></p>
<h6 id="æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼"><a href="#æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼" class="headerlink" title="æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼"></a>æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼</h6><script type="math/tex; mode=display">
P(y|x)=\frac{1}{Z(x)} \exp \left(\sum_{i, k} \lambda_{k} t_{k}\left(y_{i-1}, y_{i}, x, i\right)+\sum_{i, j} \mu_{l} s_{l}\left(y_{i}, x, i\right)\right) 
\\
Z(x)=\sum_{y} \exp \left(\sum_{i, k} \lambda_{k} t_{k}\left(y_{i-1}, y_{i}, x, i\right)+\sum_{i, j} \mu_{l} s_{l}\left(y_{i}, x, i\right)\right)</script><h6 id="æ¡ä»¶éšæœºåœºçš„ç®€åŒ–å½¢å¼"><a href="#æ¡ä»¶éšæœºåœºçš„ç®€åŒ–å½¢å¼" class="headerlink" title="æ¡ä»¶éšæœºåœºçš„ç®€åŒ–å½¢å¼"></a>æ¡ä»¶éšæœºåœºçš„ç®€åŒ–å½¢å¼</h6><script type="math/tex; mode=display">
\begin{aligned}
P(y | x) &=\frac{1}{Z(x)} \exp \sum_{k=1}^{K} w_{k} f_{k}(y, x) \\
Z(x) &=\sum_{y} \exp \sum_{k=1}^{K} w_{k} f_{k}(y, x)
\end{aligned}</script><h6 id="æ¡ä»¶éšæœºåœºçš„çŸ©é˜µå½¢å¼"><a href="#æ¡ä»¶éšæœºåœºçš„çŸ©é˜µå½¢å¼" class="headerlink" title="æ¡ä»¶éšæœºåœºçš„çŸ©é˜µå½¢å¼"></a>æ¡ä»¶éšæœºåœºçš„çŸ©é˜µå½¢å¼</h6><script type="math/tex; mode=display">
P_{w}(y | x)=\frac{1}{Z_{w}(x)} \prod_{i=1}^{n+1} M_{i}\left(y_{i-1}, y_{i} | x\right)\\
Z_{w}(x)=\left(M_{1}(x) M_{2}(x) \cdots M_{n+1}(x)\right)_{\text {start, stop }}</script><h3 id="K-Means"><a href="#K-Means" class="headerlink" title="K-Means"></a>K-Means</h3><p>K-Meansæ˜¯<strong>æ— ç›‘ç£</strong>çš„<strong>èšç±»</strong>ç®—æ³•.æ€æƒ³æ˜¯å¯¹äºç»™å®šçš„æ ·æœ¬é›†,æŒ‰ç…§æ ·æœ¬ä¹‹é—´çš„è·ç¦»å¤§å°å°†æ ·æœ¬é›†åˆ’åˆ†ä¸ºKä¸ªç°‡,è®©ç°‡å†…çš„ç‚¹å°½é‡ç´§å¯†åœ°è¿åœ¨ä¸€èµ·,è€Œè®©ç°‡é—´çš„è·ç¦»å°½é‡çš„å¤§.</p>
<h4 id="ä¼ ç»Ÿç®—æ³•"><a href="#ä¼ ç»Ÿç®—æ³•" class="headerlink" title="ä¼ ç»Ÿç®—æ³•"></a>ä¼ ç»Ÿç®—æ³•</h4><ol>
<li>ç”¨å…ˆéªŒçŸ¥è¯†æˆ–äº¤å‰éªŒè¯é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„<strong>k</strong>å€¼.</li>
<li>éšæœºé€‰æ‹©kä¸ªæ ·æœ¬ä½œä¸ºåˆå§‹çš„<strong>è´¨å¿ƒ</strong>.æ³¨æ„åˆå§‹åŒ–è´¨å¿ƒçš„é€‰æ‹©å¯¹æœ€åçš„èšç±»ç»“æœå’Œè¿è¡Œæ—¶é—´éƒ½æœ‰å¾ˆå¤§çš„å½±å“.</li>
<li>è®¡ç®—æ¯ä¸ªæ ·æœ¬ç‚¹å’Œå„ä¸ªè´¨å¿ƒçš„è·ç¦»,å°†æ ·æœ¬ç‚¹æ ‡è®°ä¸º<strong>è·ç¦»æœ€å°</strong>çš„è´¨å¿ƒæ‰€å¯¹åº”çš„ç°‡.</li>
<li>é‡æ–°è®¡ç®—æ¯ä¸ª<strong>ç°‡</strong>çš„è´¨å¿ƒ,å–è¯¥ç°‡ä¸­æ¯ä¸ªç‚¹ä½ç½®çš„å¹³å‡å€¼.</li>
<li>é‡å¤2,3,4æ­¥ç›´åˆ°kä¸ªè´¨å¿ƒéƒ½æ²¡æœ‰å‘ç”Ÿå˜åŒ–ä¸ºæ­¢.</li>
</ol>
<h4 id="K-Means-1"><a href="#K-Means-1" class="headerlink" title="K-Means++"></a>K-Means++</h4><p>ç”¨äºä¼˜åŒ–éšæœºåˆå§‹åŒ–è´¨å¿ƒçš„æ–¹æ³•</p>
<ol>
<li>ä»è¾“å…¥æ ·æœ¬ç‚¹ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªç‚¹ä½œä¸ºç¬¬ä¸€ä¸ªè´¨å¿ƒ.</li>
<li>è®¡ç®—æ¯ä¸€ä¸ªæ ·æœ¬ç‚¹åˆ°å·²é€‰æ‹©çš„è´¨å¿ƒä¸­<strong>æœ€è¿‘è´¨å¿ƒ</strong>çš„è·ç¦»D(x).</li>
<li>é€‰æ‹©ä¸€ä¸ªæ–°çš„æ ·æœ¬ç‚¹ä½œä¸ºæ–°çš„è´¨å¿ƒ,é€‰æ‹©åŸåˆ™æ˜¯D(x)è¶Šå¤§çš„ç‚¹è¢«é€‰ä¸­çš„æ¦‚ç‡è¶Šå¤§.</li>
<li>é‡å¤2å’Œ3ç›´åˆ°é€‰å‡ºkä¸ªè´¨å¿ƒ.</li>
</ol>
<h4 id="Elkan-K-Means"><a href="#Elkan-K-Means" class="headerlink" title="Elkan K-Means"></a><strong>Elkan K-Means</strong></h4><p>åˆ©ç”¨ä¸¤è¾¹ä¹‹å’Œå¤§äºç¬¬ä¸‰è¾¹ä»¥åŠä¸¤è¾¹ä¹‹å·®å°äºç¬¬ä¸‰è¾¹æ¥å‡å°‘è·ç¦»çš„è®¡ç®—.ä¸é€‚ç”¨äºç‰¹å¾ç¨€ç–çš„æƒ…å†µ.</p>
<h4 id="Mini-Batch-K-Means"><a href="#Mini-Batch-K-Means" class="headerlink" title="Mini Batch K-Means"></a><strong>Mini Batch K-Means</strong></h4><p>æ ·æœ¬é‡å¾ˆå¤§æ—¶,åªç”¨å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ¥åšä¼ ç»Ÿçš„K-Means.ä¸€èˆ¬å¤šç”¨å‡ æ¬¡è¯¥ç®—æ³•,ä»ä¸åŒçš„éšå³é‡‡æ ·ä¸­é€‰æ‹©æœ€ä¼˜çš„èšç±»ç°‡.</p>
<h3 id="Apriori"><a href="#Apriori" class="headerlink" title="Apriori"></a>Apriori</h3><p>Aprioriæ˜¯å¸¸ç”¨çš„æŒ–æ˜å‡º<strong>æ•°æ®å…³è”è§„åˆ™</strong>çš„ç®—æ³•,ç”¨äºæ‰¾å‡ºæ•°æ®å€¼ä¸­<strong>é¢‘ç¹</strong>å‡ºç°çš„æ•°æ®é›†åˆ.ä¸€èˆ¬ä½¿ç”¨æ”¯æŒåº¦æˆ–è€…æ”¯æŒåº¦ä¸ç½®ä¿¡åº¦çš„ç»„åˆä½œä¸º<strong>è¯„ä¼°æ ‡å‡†</strong>.</p>
<ol>
<li>æ”¯æŒåº¦ï¼šå‡ ä¸ªå…³è”çš„æ•°æ®åœ¨æ•°æ®é›†ä¸­å‡ºç°çš„æ¬¡æ•°å æ€»æ•°æ®é›†çš„æ¯”é‡Support$(X, Y)=P(X Y)=\frac{\text {number}(X Y)}{\text {num}(\text {AllSamples})}$</li>
<li><strong>ç½®ä¿¡åº¦</strong>ï¼šä¸€ä¸ªæ•°æ®å‡ºç°å.å¦ä¸€ä¸ªæ•°æ®å‡ºç°çš„æ¦‚ç‡Confidence$(X \Leftarrow Y)=P(X | Y)=P(X Y) / P(Y)$</li>
</ol>
<p>Aprioriç®—æ³•çš„ç›®æ ‡æ˜¯æ‰¾åˆ°æœ€å¤§çš„<strong>Ké¡¹é¢‘ç¹é›†</strong>.å‡è®¾ä½¿ç”¨æ”¯æŒåº¦æ¥ä½œä¸ºè¯„ä¼°æ ‡å‡†,é¦–å…ˆæœç´¢å‡º<strong>å€™é€‰1é¡¹é›†</strong>åŠå¯¹åº”çš„æ”¯æŒåº¦,<strong>å‰ªæ</strong>å»æ‰ä½äºæ”¯æŒåº¦çš„1é¡¹é›†,å¾—åˆ°<strong>é¢‘ç¹1é¡¹é›†</strong>.ç„¶åå¯¹å‰©ä¸‹çš„é¢‘ç¹1é¡¹é›†è¿›è¡Œ<strong>è¿æ¥</strong>,å¾—åˆ°å€™é€‰çš„é¢‘ç¹2é¡¹é›†â€¦â€¦ä»¥æ­¤ç±»æ¨,ä¸æ–­è¿­ä»£,ç›´åˆ°æ— æ³•æ‰¾åˆ°é¢‘ç¹k+1é¡¹é›†ä¸ºæ­¢,å¯¹åº”çš„é¢‘ç¹ké¡¹é›†çš„é›†åˆå³ä¸ºè¾“å‡ºç»“æœ.</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://blog.csdn.net/qq_20989105/article/details/81218696" target="_blank" rel="noopener">HMMéšé©¬å°”å¯å¤«æ¨¡å‹ä¸viterbiç»´ç‰¹æ¯”ç®—æ³•</a></li>
</ol>
]]></content>
      <categories>
        <category>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•</category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>scrapy</title>
    <url>/2019/08/31/scrapy/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id><a href="#" class="headerlink" title=" "></a> </h3><p><img src="/2019/08/31/scrapy/scrapy_framework.png" alt="avatar"></p>
<a id="more"></a>
<p><a href="https://scrapy-chs.readthedocs.io/zh_CN/1.0/" target="_blank" rel="noopener">scrapyä¸­æ–‡æ–‡æ¡£</a></p>
<h3 id="1-ç¼–å†™scrapyçˆ¬è™«æ­¥éª¤"><a href="#1-ç¼–å†™scrapyçˆ¬è™«æ­¥éª¤" class="headerlink" title="1. ç¼–å†™scrapyçˆ¬è™«æ­¥éª¤"></a>1. ç¼–å†™scrapyçˆ¬è™«æ­¥éª¤</h3><ol>
<li><p>æ–°å»ºé¡¹ç›®ï¼šï¼ˆscrapy startproject projectnameï¼‰:æ–°å»ºçˆ¬è™«é¡¹ç›®</p>
</li>
<li><p>åˆ›å»ºçˆ¬è™«ï¼šscrapy genspider spidername â€œ<a href="http://www.xxx.cn/" target="_blank" rel="noopener">http://www.xxx.cn/</a>â€œ</p>
</li>
<li><p>æ˜ç¡®ç›®æ ‡ï¼šï¼ˆç¼–å†™items.pyï¼‰ï¼šæ˜ç¡®æƒ³è¦æŠ“å–çš„ç›®æ ‡</p>
</li>
<li><p>åˆ¶ä½œçˆ¬è™«ï¼šï¼ˆspiders/xxspider.pyï¼‰:åˆ¶ä½œçˆ¬è™«å¼€å§‹çˆ¬å–çš„ç½‘é¡µ</p>
</li>
<li><p>ç¼–å†™pipeline.pyï¼Œå¤„ç†spiderè¿”å›çš„itemæ•°æ®ã€‚å†™Pipelineå‡½æ•°</p>
</li>
<li><p>ç¼–å†™settings.py,å¯åŠ¨ç®¡é“ç»„ä»¶ITEM_PIPELINES={}ï¼Œä»¥åŠå…¶ä»–ç›¸å…³è®¾ç½®USER_AGENT,DEFAULT_REQUEST_HEADERS</p>
</li>
<li><p>æ‰§è¡Œçˆ¬è™«</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> cmdline</span><br><span class="line">cmdline.execute([<span class="string">'scrapy'</span>,<span class="string">'crawl'</span>,<span class="string">'cib'</span>])</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="2-åˆ›å»ºçˆ¬è™«"><a href="#2-åˆ›å»ºçˆ¬è™«" class="headerlink" title="2. åˆ›å»ºçˆ¬è™«"></a>2. åˆ›å»ºçˆ¬è™«</h3><ol>
<li>scrapy genspider spidername â€œ<a href="http://www.xxx.cn/" target="_blank" rel="noopener">http://www.xxx.cn/</a>â€œ<ul>
<li>genspider:è¡¨ç¤ºç”Ÿæˆä¸€ä¸ªçˆ¬è™«ï¼ˆé»˜è®¤æ˜¯scrapy.Spiderç±»ï¼‰</li>
<li>spidernameï¼šè¡¨ç¤ºçˆ¬è™«åï¼ˆå¯¹åº”çˆ¬è™«ä»£ç é‡Œçš„nameå‚æ•°ï¼‰</li>
<li>â€œ<a href="http://www.xxx.cn/" target="_blank" rel="noopener">http://www.xxx.cn/</a>â€œ ï¼šè¡¨ç¤ºå…è®¸çˆ¬è™«çˆ¬å–çš„åŸŸèŒƒå›´</li>
</ul>
</li>
<li>spidername.py<ul>
<li>name= â€˜â€™:çˆ¬è™«çš„è¯†åˆ«åç§°ï¼Œå”¯ä¸€</li>
<li>allow_domains=[] ï¼šæœç´¢çš„åŸŸåèŒƒå›´ï¼Œçˆ¬è™«çš„çº¦æŸåŒºåŸŸï¼Œè§„å®šçˆ¬è™«åªçˆ¬å–è¿™ä¸ªåŸŸåä¸‹çš„ç½‘é¡µï¼Œä¸å­˜åœ¨çš„urlä¼šè¢«å¿½ç•¥</li>
<li>start_urls=():çˆ¬å–çš„urlåˆ—è¡¨ã€‚çˆ¬è™«ä»è¿™é‡Œå¼€å§‹æŠ“å–æ•°æ®ï¼Œæ‰€ä»¥ï¼Œç¬¬ä¸€æ¬¡ä¸‹è½½çš„æ•°æ®å°†ä¼šä»è¿™äº›urlså¼€å§‹ã€‚å…¶ä»–å­URLå°†ä¼šä»è¿™äº›èµ·å§‹URLä¸­ç»§æ‰¿æ€§ç”Ÿæˆ</li>
<li>parse(self,response):è§£æçš„æ–¹æ³•ï¼Œæ¯ä¸ªåˆå§‹URLå®Œæˆä¸‹è½½åå°†è¢«è°ƒç”¨ï¼Œè°ƒç”¨çš„æ—¶å€™ä¼ å…¥æ¯ä¸€ä¸ªURLä¼ å›çš„Responseå¯¹è±¡æ¥ä½œä¸ºå”¯ä¸€å‚æ•°ï¼Œä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š</li>
<li>è´Ÿè´£è§£æè¿”å›çš„ç½‘é¡µæ•°æ®ï¼ˆresponse.bodyï¼‰ï¼Œæå–ç»“æ„åŒ–æ•°æ®ï¼ˆç”Ÿæˆitemï¼‰</li>
<li>ç”Ÿæˆéœ€è¦ä¸‹ä¸€é¡µçš„URLè¯·æ±‚</li>
<li>start_requests(self):è¿™ä¸ªæ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚è¯¥å¯¹è±¡åŒ…å«spiderç”¨äºçˆ¬å–ï¼ˆé»˜è®¤å®ç°æ˜¯ä½¿ç”¨start_urlsçš„urlï¼‰çš„ç¬¬ä¸€ä¸ªRequestã€‚å½“spiderå¯åŠ¨çˆ¬å–å¹¶ä¸”ä¸ºæŒ‡å®šstart_urlsæ—¶ï¼Œè°ƒç”¨è¯¥æ–¹æ³•</li>
<li>logï¼ˆself,message[,level,component]ï¼‰:ä½¿ç”¨scrapy.log.msg()æ–¹æ³•è®°å½•ï¼ˆlogï¼‰message</li>
</ul>
</li>
</ol>
<h3 id="3-æ‰§è¡Œçˆ¬è™«"><a href="#3-æ‰§è¡Œçˆ¬è™«" class="headerlink" title="3. æ‰§è¡Œçˆ¬è™«"></a>3. æ‰§è¡Œçˆ¬è™«</h3><ol>
<li>scrapy crawl spidername -o save_filename<ul>
<li>crawlï¼šè¡¨ç¤ºå¯åŠ¨ä¸€ä¸ªscrapyçˆ¬è™«</li>
<li>spidernameï¼šè¡¨ç¤ºéœ€è¦å¯åŠ¨çš„çˆ¬è™«åï¼ˆå¯¹åº”çˆ¬è™«ä»£ç é‡Œçš„nameå‚æ•°ï¼‰</li>
<li>-0 :è¡¨ç¤ºè¾“å‡ºåˆ°æ–‡ä»¶</li>
<li>save_filename:è¡¨ç¤ºä¿å­˜æ–‡ä»¶çš„åç§°,ï¼Œé»˜è®¤4ç§è¾“å‡ºæ–‡ä»¶æ ¼å¼ï¼šjsonï¼Œjsonlï¼Œcsvï¼Œxml</li>
</ul>
</li>
</ol>
<h3 id="4-æŸ¥çœ‹å½“å‰é¡¹ç›®ä¸‹çš„çˆ¬è™«"><a href="#4-æŸ¥çœ‹å½“å‰é¡¹ç›®ä¸‹çš„çˆ¬è™«" class="headerlink" title="4. æŸ¥çœ‹å½“å‰é¡¹ç›®ä¸‹çš„çˆ¬è™«"></a>4. æŸ¥çœ‹å½“å‰é¡¹ç›®ä¸‹çš„çˆ¬è™«</h3><ol>
<li>scrapy list</li>
</ol>
<h3 id="5-pipeline-çš„ä¸€äº›å…¸å‹åº”ç”¨"><a href="#5-pipeline-çš„ä¸€äº›å…¸å‹åº”ç”¨" class="headerlink" title="5. pipeline çš„ä¸€äº›å…¸å‹åº”ç”¨"></a>5. pipeline çš„ä¸€äº›å…¸å‹åº”ç”¨</h3><ol>
<li>éªŒè¯çˆ¬å–çš„æ•°æ®ï¼ˆæ£€æŸ¥itemåŒ…å«æŸäº›å­—æ®µï¼Œæ¯”å¦‚è¯´nameï¼‰</li>
<li>æ•°æ®æŸ¥é‡ï¼ˆå¹¶ä¸¢å¼ƒï¼‰</li>
<li>å°†çˆ¬å–ç»“æœä¿å­˜åˆ°æ–‡ä»¶æˆ–è€…æ•°æ®åº“ä¸­</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomethingPiple</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="comment"># å¯é€‰å®ç°ï¼Œåšå‚æ•°åˆå§‹åŒ–ï¼Œæ¯”å¦‚æ‰“å¼€æ–‡ä»¶æ“ä½œf.open('xxx','w',edcoding='utf-8')</span></span><br><span class="line">            <span class="comment"># doing something</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self,spider)</span>:</span></span><br><span class="line">            <span class="comment"># spider(Spider å¯¹è±¡) - è¢«å…³é—­çš„spider</span></span><br><span class="line">            <span class="comment"># å¯é€‰å®ç°ï¼Œå½“spiderè¢«å¼€å¯æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨ã€‚</span></span><br><span class="line">            <span class="comment"># è¯¥æ–¹æ³•å’Œ__init__æ–¹æ³•åŠŸèƒ½åŸºæœ¬ç›¸åŒã€‚</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self,item,spider)</span>:</span></span><br><span class="line">            <span class="comment"># item(Itemå¯¹è±¡) - è¢«çˆ¬å–çš„item</span></span><br><span class="line">            <span class="comment"># spider ï¼ˆSpiderå¯¹è±¡ï¼‰ - çˆ¬å–è¯¥itemçš„spider</span></span><br><span class="line">            <span class="comment"># è¿™ä¸ªæ–¹æ³•å¿…é¡»å®ç°ï¼Œæ¯ä¸ªitem pipeline ç»„ä»¶éƒ½éœ€è¦è°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line">            <span class="comment"># è¿™ä¸ªæ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªItemå¯¹è±¡ï¼Œè¢«ä¸¢å¼ƒçš„itemå°†ä¸ä¼šè¢«ä¹‹åçš„pipelineç»„ä»¶å¤„ç†</span></span><br><span class="line">            <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self,spider)</span>:</span></span><br><span class="line">            <span class="comment"># spider(Spider å¯¹è±¡) - è¢«å…³é—­çš„spider</span></span><br><span class="line">            <span class="comment"># å¯é€‰å®ç°ï¼Œå½“spiderè¢«å…³é—­æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨ã€‚</span></span><br><span class="line">            <span class="comment"># æ¯”å¦‚å…³é—­åˆå§‹åŒ–æ‰“å¼€çš„æ–‡ä»¶f.close()</span></span><br></pre></td></tr></table></figure>
<h3 id="6-å¯åŠ¨Scrapy-Shell"><a href="#6-å¯åŠ¨Scrapy-Shell" class="headerlink" title="6. å¯åŠ¨Scrapy Shell"></a>6. å¯åŠ¨Scrapy Shell</h3><p>å‘½ä»¤ï¼šscrapy shell â€œwww.baidu.comâ€</p>
<h3 id="7-selector-é€‰æ‹©å™¨"><a href="#7-selector-é€‰æ‹©å™¨" class="headerlink" title="7. selector é€‰æ‹©å™¨"></a>7. selector é€‰æ‹©å™¨</h3><ol>
<li><p>Selectoræœ‰å››ä¸ªåŸºæœ¬æ–¹æ³•ï¼Œæœ€å¸¸ç”¨çš„æ˜¯xpathï¼š</p>
<ol>
<li><p>xpathï¼ˆï¼‰ï¼šä¼ å…¥xpathè¡¨è¾¾å¼ï¼Œè¿”å›è¯¥è¡¨è¾¾å¼æ‰€å¯¹åº”çš„æ‰€æœ‰èŠ‚ç‚¹çš„selector liståˆ—è¡¨</p>
<p>XPathè¡¨è¾¾å¼çš„ä¾‹å­åŠå¯¹åº”å«ä¹‰ï¼š</p>
<ul>
<li>/html/head/title:é€‰æ‹©<html>æ–‡æ¡£ä¸­<head>æ ‡ç­¾å†…çš„<title>å…ƒç´ </title></head></html></li>
<li>/html/head/title/text():é€‰æ‹©<html>æ–‡æ¡£ä¸­<head>æ ‡ç­¾å†…çš„<title>å…ƒç´ çš„æ–‡å­—</title></head></html></li>
<li>//tdï¼šé€‰æ‹©æ‰€æœ‰çš„<td>å…ƒç´ </td></li>
<li>//div[@class=â€mineâ€]:é€‰æ‹©æ‰€æœ‰å…·æœ‰class=â€mineâ€å±æ€§çš„divå…ƒç´ </li>
</ul>
</li>
<li><p>extractï¼ˆï¼‰ï¼šåºåˆ—åŒ–è¯¥ç»“ç‚¹ä¸ºUnicodeå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›list</p>
</li>
<li><p>css()ï¼šä¼ å…¥cssè¡¨è¾¾å¼ï¼Œè¿”å›è¯¥è¡¨è¾¾å¼æ‰€å¯¹åº”çš„æ‰€æœ‰èŠ‚ç‚¹çš„selector liståˆ—è¡¨ï¼Œè¯­æ³•åŒBeautifulSoup4</p>
</li>
<li><p>re()ï¼šæ ¹æ®ä¼ å…¥çš„æ­£åˆ™è¡¨è¾¾å¼å¯¹æ•°æ®è¿›è¡Œæå–ï¼Œè¿”å›Unicodeå­—ç¬¦ä¸²liståˆ—è¡¨</p>
</li>
</ol>
</li>
<li><p>æ³¨æ„</p>
<ol>
<li><p>xpath è¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨</p>
</li>
<li><p>xpath.extract():å°†xpathå¯¹è±¡è½¬æ¢æˆUnicodeå­—ç¬¦ä¸²</p>
</li>
<li><p>settingsè®¾ç½®</p>
<ul>
<li><p>HTTPERROR_ALLOWED_CODES = [403, 500, 404]</p>
</li>
<li><p>ROBOTSTXT_OBEY = False</p>
</li>
<li><p>ä¸‹è½½ä¸­é—´ä»¶ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DOWNLOAD_DELAY = <span class="number">2</span></span><br><span class="line">        RANDOMIZE_DOWNLOAD_DELAY = <span class="literal">True</span></span><br><span class="line">        COOKIES_ENABLED = <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">        <span class="string">'bank_info.middlewares.MyUserAgentMiddleware'</span>: <span class="number">300</span>,</span><br><span class="line">        <span class="string">'bank_info.middlewares.BankInfoDownloaderMiddleware'</span>: <span class="number">543</span>, <span class="comment"># å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        ITEM_PIPELINES = &#123;</span><br><span class="line">        <span class="string">'bank_info.pipelines.BankInfoPipeline'</span>: <span class="number">300</span>, <span class="comment"># å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="8-scrapyé«˜çº§"><a href="#8-scrapyé«˜çº§" class="headerlink" title="8. scrapyé«˜çº§"></a>8. scrapyé«˜çº§</h3><ol>
<li><p>ç¿»é¡µåŠŸèƒ½ï¼šscrapy.follow(next_page,callback=self.parse)   ä¼šè‡ªåŠ¨æ‹¼æ¥urlå’Œnext_page</p>
</li>
<li><p>æŠ½å–responseä¸­æ»¡è¶³xpathè§„åˆ™çš„é“¾æ¥ï¼šLinkExtractor(restrict_xpath=â€™xxxxâ€™), links = link.extract_links(response)</p>
</li>
<li><p>è¦é˜²æ­¢scrapyè¢«banï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç­–ç•¥ï¼š</p>
<ul>
<li><p>åŠ¨æ€è®¾ç½®user agentï¼ˆ åœ¨middleware.pyä¸­éšæœºé€‰å–user-agent,å¹¶æŠŠå®ƒèµ‹å€¼ç»™requestï¼‰</p>
<ol>
<li><p>åœ¨settingså¼€å¯UAMiddlewareè¿™ä¸ªä¸­é—´ä»¶ï¼šDOWNLOADER_MIDDLEWARES</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UAMiddleware</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># å®šä¹‰ä¸€ä¸ªUser-Agentçš„List</span></span><br><span class="line">    ua_list = [</span><br><span class="line">    <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 '</span>,</span><br><span class="line">    <span class="string">'(KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36'</span>,</span><br><span class="line">    <span class="string">'Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)'</span>,</span><br><span class="line">    <span class="string">'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)'</span>,</span><br><span class="line">    <span class="string">'Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)'</span>,</span><br><span class="line">    <span class="string">'Mozilla/5.0 (compatible; bingbot/2.0; +http://www.bing.com/bingbot.htm)'</span>,</span><br><span class="line">    ]</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request, spider)</span>:</span> <span class="comment"># å¯¹requestè¿›è¡Œæ‹¦æˆª</span></span><br><span class="line">        ua = random.choices(self.ua_list) <span class="comment"># ä½¿ç”¨randomæ¨¡å—ï¼Œéšæœºåœ¨ua_listä¸­é€‰å–User-Agent</span></span><br><span class="line">        request.headers[<span class="string">'User-Agent'</span>] = ua <span class="comment"># æŠŠé€‰å–å‡ºæ¥çš„User-Agentèµ‹ç»™request</span></span><br><span class="line">        print(request.url) <span class="comment"># æ‰“å°å‡ºrequestçš„url</span></span><br><span class="line">        print(request.headers[<span class="string">'User-Agent'</span>]) <span class="comment"># æ‰“å°å‡ºrequestçš„headers</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response, spider)</span>:</span> <span class="comment"># å¯¹responseè¿›è¡Œæ‹¦æˆª</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(self, request, exception, spider)</span>:</span> <span class="comment"># å¯¹process_requestæ–¹æ³•ä¼ å‡ºæ¥çš„å¼‚å¸¸è¿›è¡Œå¤„ç†</span></span><br><span class="line">       <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>ç¦ç”¨cookies ï¼š COOKIES_ENABLED=False</p>
</li>
<li><p>è®¾ç½®å»¶è¿Ÿä¸‹è½½ ï¼š DOWNLOAD_DELAY=2</p>
</li>
<li><p>ä½¿ç”¨Google cache</p>
</li>
<li><p>ä½¿ç”¨IPåœ°å€æ± ï¼ˆTor projectã€VPNå’Œä»£ç†IPï¼‰</p>
</li>
<li><p>ä½¿ç”¨Crawlera</p>
</li>
</ul>
</li>
<li><p>scrapyä¸­é—´ä»¶çš„åˆ†ç±»ï¼š</p>
<ul>
<li>scrapyçš„ä¸­é—´ä»¶ç†è®ºä¸Šæœ‰ä¸‰ç§(Schduler Middleware,Spider Middleware,Downloader Middleware),åœ¨åº”ç”¨ä¸Šä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š<ol>
<li>çˆ¬è™«ä¸­é—´ä»¶Spider Middlewareï¼šå¯ä»¥æ·»åŠ ä»£ç æ¥å¤„ç†å‘é€ç»™ Spiders çš„responseåŠspideräº§ç”Ÿçš„itemå’Œrequest.<ul>
<li>å½“èœ˜è››ä¼ é€’è¯·æ±‚å’Œitemsç»™å¼•æ“çš„è¿‡ç¨‹ä¸­ï¼Œèœ˜è››ä¸­é—´ä»¶å¯ä»¥å¯¹å…¶è¿›è¡Œå¤„ç†ï¼ˆè¿‡æ»¤å‡º URL é•¿åº¦æ¯” URLLENGTH_LIMIT çš„ requestã€‚ï¼‰</li>
<li>å½“å¼•æ“ä¼ é€’å“åº”ç»™èœ˜è››çš„è¿‡ç¨‹ä¸­ï¼Œèœ˜è››ä¸­é—´ä»¶å¯ä»¥å¯¹å“åº”è¿›è¡Œè¿‡æ»¤ï¼ˆä¾‹å¦‚è¿‡æ»¤å‡ºæ‰€æœ‰å¤±è´¥(é”™è¯¯)çš„ HTTP responseï¼‰</li>
</ul>
</li>
<li>ä¸‹è½½å™¨ä¸­é—´ä»¶Downloader Middlewareï¼šä¸»è¦åŠŸèƒ½åœ¨è¯·æ±‚åˆ°ç½‘é¡µå,é¡µé¢è¢«ä¸‹è½½æ—¶è¿›è¡Œä¸€äº›å¤„ç†.ï¼ˆåçˆ¬ç­–ç•¥éƒ½æ˜¯éƒ¨ç½²åœ¨ä¸‹è½½ä¸­é—´ä»¶çš„ï¼‰<ul>
<li>å½“å¼•æ“ä¼ é€’è¯·æ±‚ç»™ä¸‹è½½å™¨çš„è¿‡ç¨‹ä¸­ï¼Œä¸‹è½½ä¸­é—´ä»¶å¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œå¤„ç† ï¼ˆä¾‹å¦‚å¢åŠ http headerä¿¡æ¯ï¼Œå¢åŠ proxyä¿¡æ¯ç­‰ï¼‰</li>
<li>åœ¨ä¸‹è½½å™¨å®Œæˆhttpè¯·æ±‚ï¼Œä¼ é€’å“åº”ç»™å¼•æ“çš„è¿‡ç¨‹ä¸­ï¼Œ ä¸‹è½½ä¸­é—´ä»¶å¯ä»¥å¯¹å“åº”è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚è¿›è¡Œgzipçš„è§£å‹ç­‰ï¼‰</li>
<li>ä¸‹è½½ä¸­é—´ä»¶ä¸‰å¤§å‡½æ•°ï¼š<ol>
<li>process_request(request, spider)â€”â€”ä¸»è¦å‡½æ•°<ul>
<li>process_request() å¿…é¡»è¿”å›å…¶ä¸­ä¹‹ä¸€: è¿”å› None ã€è¿”å›ä¸€ä¸ª Response å¯¹è±¡ã€è¿”å›ä¸€ä¸ª Request å¯¹è±¡æˆ–raise IgnoreRequest</li>
<li>å¦‚æœå…¶è¿”å› Noneï¼š Scrapyå°†ç»§ç»­å¤„ç†è¯¥requestï¼Œæ‰§è¡Œå…¶ä»–çš„ä¸­é—´ä»¶çš„ç›¸åº”æ–¹æ³•ï¼Œç›´åˆ°åˆé€‚çš„ä¸‹è½½å™¨å¤„ç†å‡½æ•°(download handler)è¢«è°ƒç”¨ï¼Œ è¯¥requestè¢«æ‰§è¡Œ(å…¶responseè¢«ä¸‹è½½)</li>
<li>å¦‚æœå…¶è¿”å›Response å¯¹è±¡ï¼š Scrapyå°†ä¸ä¼šè°ƒç”¨ä»»ä½•å…¶ä»–çš„process_request()æˆ– process_exception()æ–¹æ³•ï¼Œæˆ–ç›¸åº”çš„ä¸‹è½½å‡½æ•°ã€‚å…¶å°†è¿”å›è¯¥responseï¼Œå·²å®‰è£…çš„ä¸­é—´ä»¶çš„ process_response() æ–¹æ³•åˆ™ä¼šåœ¨æ¯ä¸ªresponseè¿”å›æ—¶è¢«è°ƒç”¨</li>
<li>å¦‚æœå…¶è¿”å› Requestå¯¹è±¡ ï¼š Scrapyåˆ™ä¼šåœæ­¢è°ƒç”¨ process_requestæ–¹æ³•å¹¶é‡æ–°è°ƒåº¦è¿”å›çš„requestï¼Œä¹Ÿå°±æ˜¯æŠŠrequesté‡æ–°è¿”å›ï¼Œè¿›å…¥è°ƒåº¦å™¨é‡æ–°å…¥é˜Ÿåˆ—</li>
<li>å¦‚æœå…¶è¿”å›raise IgnoreRequestå¼‚å¸¸ ï¼š åˆ™å®‰è£…çš„ä¸‹è½½ä¸­é—´ä»¶çš„ process_exception()æ–¹æ³• ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ä¸ªæ–¹æ³•å¤„ç†è¯¥å¼‚å¸¸ï¼Œ åˆ™requestçš„errback(Request.errback)æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœæ²¡æœ‰ä»£ç å¤„ç†æŠ›å‡ºçš„å¼‚å¸¸ï¼Œ åˆ™è¯¥å¼‚å¸¸è¢«å¿½ç•¥ä¸”ä¸è®°å½•(ä¸åŒäºå…¶ä»–å¼‚å¸¸é‚£æ ·)</li>
</ul>
</li>
<li>process_response(request, response, spider)â€”â€”ä¸»è¦å‡½æ•°<ul>
<li>process_response() å¿…é¡»è¿”å›ä»¥ä¸‹ä¹‹ä¸€ï¼šè¿”å›ä¸€ä¸ªResponse å¯¹è±¡ã€ è¿”å›ä¸€ä¸ªRequest å¯¹è±¡æˆ–raise IgnoreRequest å¼‚å¸¸</li>
<li>å¦‚æœå…¶è¿”å›ä¸€ä¸ª Responseå¯¹è±¡ï¼š (å¯ä»¥ä¸ä¼ å…¥çš„responseç›¸åŒï¼Œä¹Ÿå¯ä»¥æ˜¯å…¨æ–°çš„å¯¹è±¡)ï¼Œ è¯¥responseä¼šè¢«åœ¨é“¾ä¸­çš„å…¶ä»–ä¸­é—´ä»¶çš„ process_response() æ–¹æ³•å¤„ç†</li>
<li>å¦‚æœå…¶è¿”å›ä¸€ä¸ª Requestå¯¹è±¡ï¼š åˆ™ä¸­é—´ä»¶é“¾åœæ­¢ï¼Œ è¿”å›çš„requestä¼šè¢«é‡æ–°è°ƒåº¦ä¸‹è½½ã€‚å¤„ç†ç±»ä¼¼äº process_request() è¿”å›requestæ‰€åšçš„é‚£æ ·</li>
<li>å¦‚æœå…¶æŠ›å‡ºä¸€ä¸ªIgnoreRequestå¼‚å¸¸ ï¼šåˆ™è°ƒç”¨requestçš„errback(Request.errback)ã€‚</li>
<li>å¦‚æœæ²¡æœ‰ä»£ç å¤„ç†æŠ›å‡ºçš„å¼‚å¸¸ï¼Œåˆ™è¯¥å¼‚å¸¸è¢«å¿½ç•¥ä¸”ä¸è®°å½•(ä¸åŒäºå…¶ä»–å¼‚å¸¸é‚£æ ·)</li>
</ul>
</li>
<li>process_exception(request, exception, spider)<ul>
<li>å¦‚æœå…¶è¿”å› None ï¼š Scrapyå°†ä¼šç»§ç»­å¤„ç†è¯¥å¼‚å¸¸ï¼Œæ¥ç€è°ƒç”¨å·²å®‰è£…çš„å…¶ä»–ä¸­é—´ä»¶çš„ process_exception()æ–¹æ³•ï¼Œç›´åˆ°æ‰€æœ‰ä¸­é—´ä»¶éƒ½è¢«è°ƒç”¨å®Œæ¯•ï¼Œåˆ™è°ƒç”¨é»˜è®¤çš„å¼‚å¸¸å¤„ç†</li>
<li>å¦‚æœå…¶è¿”å›ä¸€ä¸ª Response å¯¹è±¡ï¼š ç›¸å½“äºå¼‚å¸¸è¢«çº æ­£äº†ï¼Œåˆ™å·²å®‰è£…çš„ä¸­é—´ä»¶é“¾çš„ process_response()æ–¹æ³•è¢«è°ƒç”¨ã€‚Scrapyå°†ä¸ä¼šè°ƒç”¨ä»»ä½•å…¶ä»–ä¸­é—´ä»¶çš„ process_exception()æ–¹æ³•</li>
<li>å¦‚æœå…¶è¿”å›ä¸€ä¸ª Request å¯¹è±¡ï¼š åˆ™è¿”å›çš„requestå°†ä¼šè¢«é‡æ–°è°ƒç”¨ä¸‹è½½ã€‚è¿™å°†åœæ­¢ä¸­é—´ä»¶çš„ process_exception() æ–¹æ³•æ‰§è¡Œï¼Œå°±å¦‚è¿”å›ä¸€ä¸ªresponseçš„é‚£æ ·</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li><p>å…¶ä»–å†…ç½®downloader middleware</p>
<p>| item | value |<br>| â€”- | â€”- |<br>| DefaultHeadersMiddleware | å°†æ‰€æœ‰requestçš„å¤´è®¾ç½®ä¸ºé»˜è®¤æ¨¡å¼ |<br>| DownloadTimeoutMiddleware | è®¾ç½®requestçš„timeout |<br>| HttpAuthMiddleware | å¯¹æ¥è‡ªç‰¹å®šspiderçš„requestæˆæƒ |<br>| HttpCacheMiddleware | ç»™request&amp;responseè®¾ç½®ç¼“å­˜ç­–ç•¥ |<br>| HttpProxyMiddleware | ç»™æ‰€æœ‰requestè®¾ç½®httpä»£ç† |<br>| RedirectMiddleware | å¤„ç†requestçš„é‡å®šå‘ |<br>| MetaRefreshMiddleware | æ ¹æ®meta-refresh html tagå¤„ç†é‡å®šå‘ |<br>| RetryMiddleware | å¤±è´¥é‡è¯•ç­–ç•¥ |<br>| RobotsTxtMiddleware | robotså°ç¦å¤„ç† |<br>| UserAgentMiddleware | æ”¯æŒuser agenté‡å†™ |</p>
</li>
<li><p>æŠŠæ•°æ®ä¿å­˜åˆ°jsonæ–‡ä»¶</p>
<p>ä¸‹é¢è¿™ä¸ªä¾‹å­å°†ä¼šæŠŠæ‰€æœ‰çˆ¬è™«æ‰€çˆ¬å–åˆ°çš„æ•°æ®ä¿å­˜åˆ° items.jl æ–‡ä»¶ä¸­ï¼Œ.jlæ—¢æ˜¯è¡¨ç¤º JSON Lines æ ¼å¼ï¼Œæ—¢æ˜¯æ¯ä¸€è¡Œå­˜å‚¨ä¸€ä¸ª itemï¼›</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JsonWriterPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.file = open(<span class="string">'items.jl'</span>, <span class="string">'w'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.file.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        line = json.dumps(dict(item)) + <span class="string">"\n"</span></span><br><span class="line">        self.file.write(line)</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŠŠæ•°æ®å†™åˆ°MongoDB</p>
<p>MongoDB address ä»¥åŠ database name æ˜¯é€šè¿‡ Scrapy settings é…ç½®çš„ï¼›ä¸‹é¢è¿™ä¸ªç”¨ä¾‹ä¸»è¦ç”¨æ¥å±•ç¤ºå¦‚ä½•ä½¿ç”¨ from_crawler çš„ç”¨æ³•ä»¥åŠå¦‚ä½•æ­£ç¡®çš„æ¸…ç†æ‰è¿™äº›ç›¸å…³çš„ resources</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MongoPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    collection_name = <span class="string">'scrapy_items'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, mongo_uri, mongo_db)</span>:</span></span><br><span class="line">        self.mongo_uri = mongo_uri</span><br><span class="line">        self.mongo_db = mongo_db</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_crawler</span><span class="params">(cls, crawler)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls(</span><br><span class="line">            mongo_uri=crawler.settings.get(<span class="string">'MONGO_URI'</span>),</span><br><span class="line">            mongo_db=crawler.settings.get(<span class="string">'MONGO_DATABASE'</span>, <span class="string">'items'</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.client = pymongo.MongoClient(self.mongo_uri)</span><br><span class="line">        self.db = self.client[self.mongo_db]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.client.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        self.db[self.collection_name].insert_one(dict(item))</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="9-çˆ¬å–åŠ¨æ€é¡µé¢"><a href="#9-çˆ¬å–åŠ¨æ€é¡µé¢" class="headerlink" title="9. çˆ¬å–åŠ¨æ€é¡µé¢"></a>9. çˆ¬å–åŠ¨æ€é¡µé¢</h3><p>åœ¨scrapyä¸­ä½¿ç”¨splash</p>
<ol>
<li><p>å®‰è£…docker ï¼š</p>
</li>
<li><p>å®‰è£…splashï¼šdocker pull scrapinghub/splash</p>
</li>
<li><p>å¼€å¯ç«¯å£:docker run -p 5023:5023 -p 8050:8050 -p 8051:8051 scrapinghub/splash</p>
</li>
<li><p>å®‰è£… scrapy-splash: pip install scrapy-splash</p>
</li>
<li><p>ä¿®æ”¹setting.pyæ–‡ä»¶å¯¹scrapy-splashè¿›è¡Œé…ç½®</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#SplashæœåŠ¡å™¨åœ°å€</span></span><br><span class="line"><span class="string">SPLASH_URL</span> <span class="string">=</span> <span class="string">'http://localhost:8050'</span></span><br><span class="line"><span class="comment">#å¼€å¯Splashçš„ä¸¤ä¸ªä¸‹è½½ä¸­é—´ä»¶å¹¶è°ƒæ•´HttpCompressionMiddlewareçš„æ¬¡åº</span></span><br><span class="line"> <span class="string">DOWNLOADER_MIDDLEWARES</span> <span class="string">=</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">'scrapy_splash.SplashCookiesMiddleware':</span> <span class="number">723</span><span class="string">,</span></span><br><span class="line">    <span class="attr">'scrapy_splash.SplashMiddleware':</span> <span class="number">725</span><span class="string">,</span></span><br><span class="line">    <span class="attr">'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware':</span> <span class="number">810</span><span class="string">,</span></span><br><span class="line"> <span class="string">&#125;</span></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line"> <span class="comment">#è®¾ç½®å»é‡è¿‡æ»¤å™¨</span></span><br><span class="line"> <span class="string">DUPEFILTER_CLASS</span> <span class="string">=</span> <span class="string">'scrapy_splash.SplashAwareDupeFilter'</span></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line"> <span class="comment">#ç”¨æ¥æ”¯æŒcache_argsï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"> <span class="string">SPIDER_MIDDLEWARES</span> <span class="string">=</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">'scrapy_splash.SplashDeduplicateArgsMiddleware':</span> <span class="number">100</span><span class="string">,</span></span><br><span class="line"> <span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>çˆ¬è™«</category>
      </categories>
      <tags>
        <tag>ä¸“ä¸šæŠ€èƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title>selenium</title>
    <url>/2019/08/09/selenium/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><ol>
<li><p>å®‰è£…ï¼špip install selenium</p>
<p>å› ä¸ºseleniumæ˜¯é…åˆæµè§ˆå™¨ä¸€èµ·ä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦ä¸‹è½½æµè§ˆå™¨çš„é©±åŠ¨(webdriver)ï¼Œä»¥chromeä¸ºä¾‹ï¼šchromeçš„webdriverï¼š <a href="http://chromedriver.storage.googleapis.com/index.html" target="_blank" rel="noopener">chromedriver</a> ä¸åŒçš„Chromeçš„ç‰ˆæœ¬å¯¹åº”çš„chromedriver.exe ç‰ˆæœ¬ä¹Ÿä¸ä¸€æ ·ã€‚å¦‚æœæ˜¯æœ€æ–°çš„Chrome, ä¸‹è½½æœ€æ–°çš„chromedriver.exe å°±å¯ä»¥ã€‚æŠŠchromedriverçš„è·¯å¾„ä¹ŸåŠ åˆ°<strong>ç¯å¢ƒå˜é‡</strong>é‡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver      <span class="comment"># å¼•å…¥webdriver api</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()     <span class="comment"># ä½¿ç”¨chromeæµè§ˆå™¨å£°æ˜ä¸€ä¸ªwebdriverå¯¹è±¡</span></span><br><span class="line"><span class="comment"># driver = webdriver.Chrome('/your path /webdriver')</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  driver.get(<span class="string">'http://www.baidu.com/'</span>) <span class="comment"># è¡¨ç¤ºä½¿ç”¨chromeä»¥getçš„æ–¹å¼è¯·æ±‚ç™¾åº¦çš„url</span></span><br><span class="line">  driver.find_element_by_id(<span class="string">"kw"</span>).send_keys(<span class="string">"selenium"</span>)   <span class="comment"># æ£€ç´¢åˆ°ç™¾åº¦çš„è¾“å…¥æ¡†ï¼Œè¾“å…¥selenium</span></span><br><span class="line">  driver.find_element_by_id(<span class="string">"su"</span>).click() <span class="comment"># æ£€ç´¢åˆ°ç™¾åº¦çš„æœç´¢æŒ‰é’®å¹¶ç‚¹å‡»</span></span><br><span class="line">  wait = WebDriverWait(driever,<span class="number">10</span>) <span class="comment"># ç­‰å¾…åŠ è½½</span></span><br><span class="line">  wait.until(EC.presence_of_element_located((By.ID,<span class="string">'content_left'</span>)))</span><br><span class="line">  print(driver.current_url)  <span class="comment"># è¾“å‡ºå½“å‰é¡µé¢url</span></span><br><span class="line">  print(driver.get_cookies) <span class="comment"># è¾“å‡ºcookies</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">  driver.close()</span><br></pre></td></tr></table></figure>
<a id="more"></a>
</li>
<li><p>å…ƒç´ é€‰å–</p>
<ol>
<li><p>å•å…ƒç´ é€‰å–</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">find_element_by_id      <span class="comment"># é€šè¿‡å…ƒç´ id</span></span><br><span class="line">find_element_by_name    <span class="comment"># é€šè¿‡nameå±æ€§</span></span><br><span class="line">find_element_by_xpath   <span class="comment"># é€šè¿‡xpath</span></span><br><span class="line">find_element_by_link_text   <span class="comment"># é€šè¿‡é“¾æ¥æ–‡æœ¬</span></span><br><span class="line">find_element_by_partial_link_text</span><br><span class="line">find_element_by_tag_name    <span class="comment"># é€šè¿‡æ ‡ç­¾å</span></span><br><span class="line">find_element_by_class_name      <span class="comment"># é€šè¿‡classåç§°å®šä½</span></span><br><span class="line">find_element_by_css_selector    <span class="comment"># é€šè¿‡cssé€‰æ‹©å™¨å®šä½</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¤šå…ƒç´ é€‰å–</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">find_elements_by_name</span><br><span class="line">find_elements_by_xpath</span><br><span class="line">find_elements_by_link_text</span><br><span class="line">find_elements_by_partial_link_text</span><br><span class="line">find_elements_by_tag_name</span><br><span class="line">find_elements_by_class_name</span><br><span class="line">find_elements_by_css_selector</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>å…ƒç´ æ“ä½œ</p>
<ul>
<li>clear æ¸…é™¤å…ƒç´ çš„å†…å®¹ï¼šclear(self)</li>
<li>send_keys æ¨¡æ‹ŸæŒ‰é”®è¾“å…¥ï¼šsend_keys(self, *value)</li>
<li>click ç‚¹å‡»å…ƒç´ ï¼šclick(self)</li>
<li>submit æäº¤è¡¨å•ï¼šsubmit(self)</li>
<li>è·å–å…ƒç´ å±æ€§ï¼šget_attribute(self, name)</li>
<li>è·å–å…ƒç´ æ–‡æœ¬ï¼štext</li>
</ul>
</li>
</ol>
   <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">driver.find_element_by_id(<span class="string">"kw"</span>).clear()</span><br></pre></td></tr></table></figure>
<ol>
<li><p><strong>é¡µé¢æ“ä½œæ–¹æ³•</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰“å¼€æµè§ˆå™¨</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"><span class="comment"># è¯·æ±‚ä¸€ä¸ªurl</span></span><br><span class="line">driver.get(<span class="string">"www.baidu.com"</span>)</span><br><span class="line"><span class="comment"># è¿”å›å½“å‰é¡µé¢çš„title</span></span><br><span class="line">title = driver.title</span><br><span class="line"><span class="comment"># è¿”å›å½“å‰é¡µé¢çš„url</span></span><br><span class="line">url = driver.current_url</span><br><span class="line"><span class="comment"># è¿”å›å½“å‰é¡µé¢çš„æºç </span></span><br><span class="line">source = driver.page_source</span><br><span class="line"><span class="comment"># å…³é—­å½“å‰é¡µé¢</span></span><br><span class="line">driver.close()</span><br><span class="line"><span class="comment"># æ³¨é”€å¹¶å…³é—­æµè§ˆå™¨</span></span><br><span class="line">driver.quit()</span><br><span class="line"><span class="comment"># æµè§ˆå™¨å‰è¿›</span></span><br><span class="line">driver.forward()</span><br><span class="line"><span class="comment"># æµè§ˆå™¨åé€€</span></span><br><span class="line">driver.back()</span><br><span class="line"><span class="comment"># åˆ·æ–°å½“å‰é¡µé¢</span></span><br><span class="line">driver.refresh()</span><br><span class="line"><span class="comment"># è·å–å½“å‰sessionä¸­çš„å…¨éƒ¨cookie</span></span><br><span class="line">get_cookies(self)</span><br><span class="line"><span class="comment"># è·å–å½“å‰ä¼šä¸­ä¸­çš„æŒ‡å®šcookie</span></span><br><span class="line">get_cookie(self, name)</span><br><span class="line"><span class="comment"># åœ¨å½“å‰ä¼šè¯ä¸­æ·»åŠ cookie</span></span><br><span class="line">add_cookie(self, cookie_dict)</span><br><span class="line"><span class="comment"># æ·»åŠ æµè§ˆå™¨User-Agentï¼š</span></span><br><span class="line">options.add_argument(<span class="string">'User-Agent=Mozilla/5.0 (Linux; U; Android 4.0.2; en-us; Galaxy Nexus Build/ICL53F) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30'</span>)</span><br><span class="line"><span class="comment"># æ·»åŠ è®¾ç½®é¡¹Chrome Optionsï¼š</span></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'xxxx'</span>)</span><br><span class="line">driver = webdriver.Chrome(chrome_options=options)</span><br></pre></td></tr></table></figure>
</li>
<li><p>é¡µé¢ç­‰å¾…</p>
<ol>
<li><p>éšå¼ç­‰å¾…ï¼šç®€å•çš„è®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œå•ä½ä¸ºï¼šç§’</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>) <span class="comment"># seconds</span></span><br><span class="line">driver.get(<span class="string">"http://somedomain/url_that_delays_loading"</span>)</span><br><span class="line">myDynamicElement = driver.find_element_by_id(<span class="string">"myDynamicElement"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ˜¾å¼ç­‰å¾…ï¼šæŒ‡å®šæŸä¸ªæ¡ä»¶ï¼Œç„¶åè®¾ç½®æœ€é•¿ç­‰å¾…æ—¶é—´ã€‚å¦‚æœåœ¨è¿™ä¸ªæ—¶é—´è¿˜æ²¡æœ‰æ‰¾åˆ°å…ƒç´ ï¼Œä¾¿ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(<span class="string">"http://somedomain/url_that_delays_loading"</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"> 	<span class="comment"># è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯untilæˆ–until_notä¸­çš„å¯æ‰§è¡Œæ–¹æ³•methodå‚æ•°ï¼Œå¾ˆå¤šäººä¼ å…¥äº†WebElementå¯¹è±¡</span></span><br><span class="line">  <span class="comment"># WebDriverWait(driver, 10).until(driver.find_element_by_id('kw'))  é”™è¯¯</span></span><br><span class="line">  element = WebDriverWait(driver, <span class="number">10</span>).until(</span><br><span class="line">            EC.presence_of_element_located((By.ID, <span class="string">"myDynamicElement"</span>))</span><br><span class="line">            )</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>expected_conditions(17ä¸ªæ¡ä»¶)ï¼šexpected_conditionsæ˜¯seleniumçš„ä¸€ä¸ªæ¨¡å—ï¼Œå…¶ä¸­åŒ…å«ä¸€ç³»åˆ—å¯ç”¨äºåˆ¤æ–­çš„æ¡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">selenium.webdriver.support.expected_conditions</span><br><span class="line"></span><br><span class="line">è¿™ä¸¤ä¸ªæ¡ä»¶ç±»éªŒè¯titleï¼ŒéªŒè¯ä¼ å…¥çš„å‚æ•°titleæ˜¯å¦ç­‰äºæˆ–åŒ…å«äºdriver.title</span><br><span class="line">title_is</span><br><span class="line">title_contains</span><br><span class="line"></span><br><span class="line">ä¸€ä¸ªåªè¦ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å…ƒç´ åŠ è½½å‡ºæ¥å°±é€šè¿‡ï¼›å¦ä¸€ä¸ªå¿…é¡»æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å…ƒç´ éƒ½åŠ è½½å‡ºæ¥æ‰è¡Œ</span><br><span class="line">presence_of_element_located</span><br><span class="line">presence_of_all_elements_located</span><br><span class="line"></span><br><span class="line">è¿™ä¸‰ä¸ªæ¡ä»¶éªŒè¯å…ƒç´ æ˜¯å¦å¯è§ï¼Œå‰ä¸¤ä¸ªä¼ å…¥å‚æ•°æ˜¯å…ƒç»„ç±»å‹çš„locatorï¼Œç¬¬ä¸‰ä¸ªä¼ å…¥WebElement</span><br><span class="line">ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªå…¶å®è´¨æ˜¯ä¸€æ ·çš„</span><br><span class="line">visibility_of_element_located</span><br><span class="line">invisibility_of_element_located</span><br><span class="line">visibility_of</span><br><span class="line"></span><br><span class="line">è¿™ä¸¤ä¸ªäººæ¡ä»¶åˆ¤æ–­æŸæ®µæ–‡æœ¬æ˜¯å¦å‡ºç°åœ¨æŸå…ƒç´ ä¸­ï¼Œä¸€ä¸ªåˆ¤æ–­å…ƒç´ çš„textï¼Œä¸€ä¸ªåˆ¤æ–­å…ƒç´ çš„value</span><br><span class="line">text_to_be_present_in_element</span><br><span class="line">text_to_be_present_in_element_value</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªæ¡ä»¶åˆ¤æ–­frameæ˜¯å¦å¯åˆ‡å…¥ï¼Œå¯ä¼ å…¥locatorå…ƒç»„æˆ–è€…ç›´æ¥ä¼ å…¥å®šä½æ–¹å¼ï¼šidã€nameã€indexæˆ–WebElement</span><br><span class="line">frame_to_be_available_and_switch_to_it</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªæ¡ä»¶åˆ¤æ–­æ˜¯å¦æœ‰alertå‡ºç°</span><br><span class="line">alert_is_present</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªæ¡ä»¶åˆ¤æ–­å…ƒç´ æ˜¯å¦å¯ç‚¹å‡»ï¼Œä¼ å…¥locator</span><br><span class="line">element_to_be_clickable</span><br><span class="line"></span><br><span class="line">è¿™å››ä¸ªæ¡ä»¶åˆ¤æ–­å…ƒç´ æ˜¯å¦è¢«é€‰ä¸­ï¼Œç¬¬ä¸€ä¸ªæ¡ä»¶ä¼ å…¥WebElementå¯¹è±¡ï¼Œç¬¬äºŒä¸ªä¼ å…¥locatorå…ƒç»„</span><br><span class="line">ç¬¬ä¸‰ä¸ªä¼ å…¥WebElementå¯¹è±¡ä»¥åŠçŠ¶æ€ï¼Œç›¸ç­‰è¿”å›<span class="literal">True</span>ï¼Œå¦åˆ™è¿”å›<span class="literal">False</span></span><br><span class="line">ç¬¬å››ä¸ªä¼ å…¥locatorä»¥åŠçŠ¶æ€ï¼Œç›¸ç­‰è¿”å›<span class="literal">True</span>ï¼Œå¦åˆ™è¿”å›<span class="literal">False</span></span><br><span class="line">element_to_be_selected</span><br><span class="line">element_located_to_be_selected</span><br><span class="line">element_selection_state_to_be</span><br><span class="line">element_located_selection_state_to_be</span><br><span class="line"></span><br><span class="line">æœ€åä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦ä»åœ¨DOMä¸­ï¼Œä¼ å…¥WebElementå¯¹è±¡ï¼Œå¯ä»¥åˆ¤æ–­é¡µé¢æ˜¯å¦åˆ·æ–°äº†</span><br><span class="line">staleness_of</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>é¼ æ ‡æ“ä½œ</strong></p>
<ul>
<li>context_click(elem) å³å‡»é¼ æ ‡ç‚¹å‡»å…ƒç´ elemï¼Œå¦å­˜ä¸ºç­‰è¡Œä¸º</li>
<li>double_click(elem) åŒå‡»é¼ æ ‡ç‚¹å‡»å…ƒç´ elemï¼Œåœ°å›¾webå¯å®ç°æ”¾å¤§åŠŸèƒ½</li>
<li>drag_and_drop(source,target) æ‹–åŠ¨é¼ æ ‡ï¼Œæºå…ƒç´ æŒ‰ä¸‹å·¦é”®ç§»åŠ¨è‡³ç›®æ ‡å…ƒç´ é‡Šæ”¾</li>
<li>move_to_element(elem) é¼ æ ‡ç§»åŠ¨åˆ°ä¸€ä¸ªå…ƒç´ ä¸Š</li>
<li>click_and_hold(elem) æŒ‰ä¸‹é¼ æ ‡å·¦é”®åœ¨ä¸€ä¸ªå…ƒç´ ä¸Š</li>
<li>perform() åœ¨é€šè¿‡è°ƒç”¨è¯¥å‡½æ•°æ‰§è¡ŒActionChainsä¸­å­˜å‚¨è¡Œä¸º</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è·å–é€šè¿‡é¼ æ ‡å³é”®å¦å­˜ä¸ºç™¾åº¦å›¾ç‰‡logoçš„ä¾‹å­</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains</span><br><span class="line"> </span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line">driver.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#é¼ æ ‡ç§»åŠ¨è‡³å›¾ç‰‡ä¸Š å³é”®ä¿å­˜å›¾ç‰‡</span></span><br><span class="line">elem_pic = driver.find_element_by_xpath(<span class="string">"//div[@id='lg']/img"</span>)</span><br><span class="line"><span class="keyword">print</span> elem_pic.get_attribute(<span class="string">"src"</span>)</span><br><span class="line">action = ActionChains(driver).move_to_element(elem_pic)</span><br><span class="line">action.context_click(elem_pic)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#é‡ç‚¹:å½“å³é”®é¼ æ ‡ç‚¹å‡»é”®ç›˜å…‰æ ‡å‘ä¸‹åˆ™ç§»åŠ¨è‡³å³é”®èœå•ç¬¬ä¸€ä¸ªé€‰é¡¹</span></span><br><span class="line">action.send_keys(Keys.ARROW_DOWN)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">action.send_keys(<span class="string">'v'</span>) <span class="comment">#å¦å­˜ä¸º</span></span><br><span class="line">action.perform()</span><br><span class="line"> </span><br><span class="line"><span class="comment">#è·å–å¦å­˜ä¸ºå¯¹è¯æ¡†(å¤±è´¥)</span></span><br><span class="line">alert.switch_to_alert()</span><br><span class="line">alert.accept()</span><br><span class="line"><span class="comment"># driver.switch_to_alert().accept()  # ç‚¹å‡»å¼¹å‡ºé‡Œé¢çš„ç¡®å®šæŒ‰é’®</span></span><br><span class="line"><span class="comment"># driver.switch_to_alert().dismiss() # ç‚¹å‡»å¼¹å‡ºä¸Šé¢çš„XæŒ‰é’®</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>é”®ç›˜æ“ä½œ</strong></p>
<ul>
<li>send_keys(Keys.ENTER) æŒ‰ä¸‹å›è½¦é”®</li>
<li>send_keys(Keys.TAB) æŒ‰ä¸‹Tabåˆ¶è¡¨é”®</li>
<li>send_keys(Keys.SPACE) æŒ‰ä¸‹ç©ºæ ¼é”®space</li>
<li>send_keys(Kyes.ESCAPE) æŒ‰ä¸‹å›é€€é”®Esc</li>
<li>send_keys(Keys.BACK_SPACE) æŒ‰ä¸‹åˆ é™¤é”®BackSpace</li>
<li>send_keys(Keys.SHIFT) æŒ‰ä¸‹shifté”®</li>
<li>send_keys(Keys.CONTROL) æŒ‰ä¸‹Ctrlé”®</li>
<li>send_keys(Keys.ARROW_DOWN) æŒ‰ä¸‹é¼ æ ‡å…‰æ ‡å‘ä¸‹æŒ‰é”®</li>
<li>send_keys(Keys.CONTROL,â€™aâ€™) ç»„åˆé”®å…¨é€‰Ctrl+A</li>
<li>send_keys(Keys.CONTROL,â€™câ€™) ç»„åˆé”®å¤åˆ¶Ctrl+C</li>
<li>send_keys(Keys.CONTROL,â€™xâ€™) ç»„åˆé”®å‰ªåˆ‡Ctrl+X</li>
<li>send_keys(Keys.CONTROL,â€™vâ€™) ç»„åˆé”®ç²˜è´´Ctrl+V</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"> </span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line">driver.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#è¾“å…¥æ¡†è¾“å…¥å†…å®¹</span></span><br><span class="line">elem = driver.find_element_by_id(<span class="string">"kw"</span>)</span><br><span class="line">elem.send_keys(<span class="string">"Eastmount CSDN"</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#åˆ é™¤ä¸€ä¸ªå­—ç¬¦CSDN å›é€€é”®</span></span><br><span class="line">elem.send_keys(Keys.BACK_SPACE)</span><br><span class="line">elem.send_keys(Keys.BACK_SPACE)</span><br><span class="line">elem.send_keys(Keys.BACK_SPACE)</span><br><span class="line">elem.send_keys(Keys.BACK_SPACE)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#è¾“å…¥ç©ºæ ¼+"åšå®¢"</span></span><br><span class="line">elem.send_keys(Keys.SPACE)</span><br><span class="line">elem.send_keys(<span class="string">u"åšå®¢"</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#ctrl+a å…¨é€‰è¾“å…¥æ¡†å†…å®¹</span></span><br><span class="line">elem.send_keys(Keys.CONTROL,<span class="string">'a'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#ctrl+x å‰ªåˆ‡è¾“å…¥æ¡†å†…å®¹</span></span><br><span class="line">elem.send_keys(Keys.CONTROL,<span class="string">'x'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#è¾“å…¥æ¡†é‡æ–°è¾“å…¥æœç´¢</span></span><br><span class="line">elem.send_keys(Keys.CONTROL,<span class="string">'v'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#é€šè¿‡å›è½¦é”®æ›¿ä»£ç‚¹å‡»æ“ä½œ</span></span><br><span class="line">driver.find_element_by_id(<span class="string">"su"</span>).send_keys(Keys.ENTER)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
</li>
<li><p>æˆªå›¾ä¿å­˜ï¼šå½“çˆ¬è™«å‡ºé”™æ—¶å¯ä»¥æˆªå›¾ä¿å­˜å½“æ—¶é¡µé¢ï¼Œä»¥ä¾¿å¤ç°bugï¼Œè¿›è¡Œåˆ†æã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">driver.maximize_window()</span><br><span class="line">driver.get_screenshot_as_file(<span class="string">"screen shot saved path/pic_&#123;&#125;.png"</span>.format(xx))</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯¹seleniumäºŒæ¬¡å°è£…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasePage</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ä¸»è¦æ˜¯æŠŠå¸¸ç”¨çš„å‡ ä¸ªSeleniumæ–¹æ³•å°è£…åˆ°BasePageè¿™ä¸ªç±»ï¼Œæˆ‘ä»¬è¿™é‡Œæ¼”ç¤ºä»¥ä¸‹å‡ ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="string">    back()</span></span><br><span class="line"><span class="string">    forward()</span></span><br><span class="line"><span class="string">    get()</span></span><br><span class="line"><span class="string">    quit()</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, driver)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å†™ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæœ‰ä¸€ä¸ªå‚æ•°driver</span></span><br><span class="line"><span class="string">        :param driver:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver = driver</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">back</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æµè§ˆå™¨åé€€æŒ‰é’®</span></span><br><span class="line"><span class="string">        :param none:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver.back()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æµè§ˆå™¨å‰è¿›æŒ‰é’®</span></span><br><span class="line"><span class="string">        :param none:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver.forward()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_url</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ‰“å¼€urlç«™ç‚¹</span></span><br><span class="line"><span class="string">        :param url:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver.get(url)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">quit_browser</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å…³é—­å¹¶åœæ­¢æµè§ˆå™¨æœåŠ¡</span></span><br><span class="line"><span class="string">        :param none:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver.quit()</span><br><span class="line">       </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BrowserEngine</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    å®šä¹‰ä¸€ä¸ªæµè§ˆå™¨å¼•æ“ç±»ï¼Œæ ¹æ®browser_typeçš„å€¼å»ï¼Œæ§åˆ¶å¯åŠ¨ä¸åŒçš„æµè§ˆå™¨ï¼Œè¿™é‡Œä¸»è¦æ˜¯IEï¼ŒFirefox, Chrome</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, driver)</span>:</span></span><br><span class="line">        self.driver = driver</span><br><span class="line"> </span><br><span class="line">    browser_type = <span class="string">"IE"</span>   <span class="comment"># maybe Firefox, Chrome, IE</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_browser</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        é€šè¿‡ifè¯­å¥ï¼Œæ¥æ§åˆ¶åˆå§‹åŒ–ä¸åŒæµè§ˆå™¨çš„å¯åŠ¨ï¼Œé»˜è®¤æ˜¯å¯åŠ¨Chrome</span></span><br><span class="line"><span class="string">        :return: driver</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> self.browser_type == <span class="string">'Firefox'</span>:</span><br><span class="line">            driver = webdriver.Firefox()</span><br><span class="line">        <span class="keyword">elif</span> self.browser_type == <span class="string">'Chrome'</span>:</span><br><span class="line">            driver = webdriver.Chrome()</span><br><span class="line">        <span class="keyword">elif</span> self.browser_type == <span class="string">'IE'</span>:</span><br><span class="line">            driver = webdriver.Ie()</span><br><span class="line">        <span class="keyword">else</span>: driver = webdriver.Chrome()</span><br><span class="line"> </span><br><span class="line">        driver.maximize_window()</span><br><span class="line">        driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> driver</span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>çˆ¬è™«</category>
      </categories>
      <tags>
        <tag>ä¸“ä¸šæŠ€èƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title>requests</title>
    <url>/2019/07/19/requests/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><ol>
<li>çˆ¬è™«çš„åŸºæœ¬æµç¨‹<ul>
<li><strong>å‘èµ·è¯·æ±‚</strong><br>é€šè¿‡HTTPåº“å‘ç›®æ ‡ç«™ç‚¹å‘èµ·è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯å‘é€ä¸€ä¸ªRequestï¼Œè¯·æ±‚å¯ä»¥åŒ…å«é¢å¤–çš„headerç­‰ä¿¡æ¯ï¼Œç­‰å¾…æœåŠ¡å™¨å“åº”</li>
<li><strong>è·å–å“åº”å†…å®¹</strong><br>å¦‚æœæœåŠ¡å™¨èƒ½æ­£å¸¸å“åº”ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªResponseï¼ŒResponseçš„å†…å®¹ä¾¿æ˜¯æ‰€è¦è·å–çš„é¡µé¢å†…å®¹ï¼Œç±»å‹å¯èƒ½æ˜¯HTML,Jsonå­—ç¬¦ä¸²ï¼ŒäºŒè¿›åˆ¶æ•°æ®ï¼ˆå›¾ç‰‡æˆ–è€…è§†é¢‘ï¼‰ç­‰ç±»å‹</li>
<li><strong>è§£æå†…å®¹</strong><br>å¾—åˆ°çš„å†…å®¹å¯èƒ½æ˜¯HTML,å¯ä»¥ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œé¡µé¢è§£æåº“è¿›è¡Œè§£æï¼Œå¯èƒ½æ˜¯Json,å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºJsonå¯¹è±¡è§£æï¼Œå¯èƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå¯ä»¥åšä¿å­˜æˆ–è€…è¿›ä¸€æ­¥çš„å¤„ç†</li>
<li><strong>ä¿å­˜æ•°æ®</strong><br>ä¿å­˜å½¢å¼å¤šæ ·ï¼Œå¯ä»¥å­˜ä¸ºæ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥ä¿å­˜åˆ°æ•°æ®åº“ï¼Œæˆ–è€…ä¿å­˜ç‰¹å®šæ ¼å¼çš„æ–‡ä»¶</li>
</ul>
</li>
</ol>
<a id="more"></a>
<ol>
<li><p><strong>Requestä¸­åŒ…å«ä»€ä¹ˆï¼Ÿ</strong></p>
<ul>
<li><p><strong>è¯·æ±‚æ–¹å¼</strong></p>
<p>ä¸»è¦æœ‰ï¼šGET/POSTä¸¤ç§ç±»å‹å¸¸ç”¨ï¼Œå¦å¤–è¿˜æœ‰HEAD/PUT/DELETE/OPTIONS</p>
<ol>
<li><p>GETå’ŒPOSTçš„åŒºåˆ«å°±æ˜¯ï¼šè¯·æ±‚çš„æ•°æ®GETæ˜¯åœ¨urlä¸­ï¼ŒPOSTåˆ™æ˜¯å­˜æ”¾åœ¨å¤´éƒ¨</p>
<p>GET:å‘æŒ‡å®šçš„èµ„æºå‘å‡ºâ€œæ˜¾ç¤ºâ€è¯·æ±‚ã€‚ä½¿ç”¨GETæ–¹æ³•åº”è¯¥åªç”¨åœ¨è¯»å–æ•°æ®ï¼Œè€Œä¸åº”å½“è¢«ç”¨äºäº§ç”Ÿâ€œå‰¯ä½œç”¨â€çš„æ“ä½œä¸­ï¼Œä¾‹å¦‚åœ¨Web Applicationä¸­ã€‚å…¶ä¸­ä¸€ä¸ªåŸå› æ˜¯GETå¯èƒ½ä¼šè¢«ç½‘ç»œèœ˜è››ç­‰éšæ„è®¿é—®</p>
<p>POST:å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®ï¼Œè¯·æ±‚æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚æœ¬æ–‡ä¸­ã€‚è¿™ä¸ªè¯·æ±‚å¯èƒ½ä¼šåˆ›å»ºæ–°çš„èµ„æºæˆ–ä¿®æ”¹ç°æœ‰èµ„æºï¼Œæˆ–äºŒè€…çš†æœ‰ã€‚</p>
</li>
<li><p>HEADï¼šä¸GETæ–¹æ³•ä¸€æ ·ï¼Œéƒ½æ˜¯å‘æœåŠ¡å™¨å‘å‡ºæŒ‡å®šèµ„æºçš„è¯·æ±‚ã€‚åªä¸è¿‡æœåŠ¡å™¨å°†ä¸ä¼ å›èµ„æºçš„æœ¬æ–‡éƒ¨åˆ†ã€‚å®ƒçš„å¥½å¤„åœ¨äºï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨ä¸å¿…ä¼ è¾“å…¨éƒ¨å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥è·å–å…¶ä¸­â€œå…³äºè¯¥èµ„æºçš„ä¿¡æ¯â€ï¼ˆå…ƒä¿¡æ¯æˆ–ç§°å…ƒæ•°æ®ï¼‰ã€‚</p>
</li>
<li><p>PUTï¼šå‘æŒ‡å®šèµ„æºä½ç½®ä¸Šä¼ å…¶æœ€æ–°å†…å®¹ã€‚</p>
</li>
<li><p>OPTIONSï¼šè¿™ä¸ªæ–¹æ³•å¯ä½¿æœåŠ¡å™¨ä¼ å›è¯¥èµ„æºæ‰€æ”¯æŒçš„æ‰€æœ‰HTTPè¯·æ±‚æ–¹æ³•ã€‚ç”¨â€™*â€™æ¥ä»£æ›¿èµ„æºåç§°ï¼Œå‘WebæœåŠ¡å™¨å‘é€OPTIONSè¯·æ±‚ï¼Œå¯ä»¥æµ‹è¯•æœåŠ¡å™¨åŠŸèƒ½æ˜¯å¦æ­£å¸¸è¿ä½œã€‚</p>
</li>
<li><p>DELETEï¼šè¯·æ±‚æœåŠ¡å™¨åˆ é™¤Request-URIæ‰€æ ‡è¯†çš„èµ„æºã€‚</p>
</li>
</ol>
</li>
</ul>
</li>
<li><p><strong>è¯·æ±‚URL</strong></p>
<p>URLï¼Œå³ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„ç½‘å€ï¼Œç»Ÿä¸€èµ„æºå®šä½ç¬¦æ˜¯å¯¹å¯ä»¥ä»äº’è”ç½‘ä¸Šå¾—åˆ°çš„èµ„æºçš„ä½ç½®å’Œè®¿é—®æ–¹æ³•çš„ä¸€ç§ç®€æ´çš„è¡¨ç¤ºï¼Œæ˜¯äº’è”ç½‘ä¸Šæ ‡å‡†èµ„æºçš„åœ°å€ã€‚äº’è”ç½‘ä¸Šçš„æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„URLï¼Œå®ƒåŒ…å«çš„ä¿¡æ¯æŒ‡å‡ºæ–‡ä»¶çš„ä½ç½®ä»¥åŠæµè§ˆå™¨åº”è¯¥æ€ä¹ˆå¤„ç†å®ƒã€‚</p>
<p>URLçš„æ ¼å¼ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>ç¬¬ä¸€éƒ¨åˆ†æ˜¯åè®®(æˆ–ç§°ä¸ºæœåŠ¡æ–¹å¼)ã€‚</li>
<li>ç¬¬äºŒéƒ¨åˆ†æ˜¯å­˜æœ‰è¯¥èµ„æºçš„ä¸»æœºIPåœ°å€(æœ‰æ—¶ä¹ŸåŒ…æ‹¬ç«¯å£å·)ã€‚</li>
<li>ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ä¸»æœºèµ„æºçš„å…·ä½“åœ°å€ï¼Œå¦‚ç›®å½•å’Œæ–‡ä»¶åç­‰ã€‚</li>
</ul>
<p>çˆ¬è™«çˆ¬å–æ•°æ®æ—¶å¿…é¡»è¦æœ‰ä¸€ä¸ªç›®æ ‡çš„URLæ‰å¯ä»¥è·å–æ•°æ®ï¼Œå› æ­¤ï¼Œå®ƒæ˜¯çˆ¬è™«è·å–æ•°æ®çš„åŸºæœ¬ä¾æ®ã€‚</p>
</li>
<li><p><strong>è¯·æ±‚å¤´</strong></p>
<p>åŒ…å«è¯·æ±‚æ—¶çš„å¤´éƒ¨ä¿¡æ¯ï¼Œå¦‚User-Agent,Host,Cookiesç­‰ä¿¡æ¯.</p>
</li>
<li><p><strong>è¯·æ±‚ä½“</strong></p>
<p>è¯·æ±‚æ˜¯æºå¸¦çš„æ•°æ®ï¼Œå¦‚æäº¤è¡¨å•æ•°æ®æ—¶å€™çš„è¡¨å•æ•°æ®ï¼ˆPOSTï¼‰</p>
</li>
<li><p>èƒ½çˆ¬å–ä»€ä¹ˆæ ·çš„æ•°æ®ï¼Ÿ</p>
<ul>
<li>ç½‘é¡µæ–‡æœ¬ï¼šå¦‚HTMLæ–‡æ¡£ï¼ŒJsonæ ¼å¼åŒ–æ–‡æœ¬ç­‰</li>
<li>å›¾ç‰‡ï¼šè·å–åˆ°çš„æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¿å­˜ä¸ºå›¾ç‰‡æ ¼å¼</li>
<li>è§†é¢‘ï¼šåŒæ ·æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶</li>
<li>å…¶ä»–ï¼šåªè¦è¯·æ±‚åˆ°çš„ï¼Œéƒ½å¯ä»¥è·å–</li>
</ul>
</li>
<li><p><strong>å¦‚ä½•è§£ææ•°æ®ï¼Ÿ</strong></p>
<ol>
<li>ç›´æ¥å¤„ç†</li>
<li>Jsonè§£æ</li>
<li>æ­£åˆ™è¡¨è¾¾å¼å¤„ç†</li>
<li>BeautifulSoupè§£æå¤„ç†</li>
<li>PyQueryè§£æå¤„ç†</li>
<li>XPathè§£æå¤„ç†</li>
</ol>
</li>
<li><p><strong>å…³äºæŠ“å–çš„é¡µé¢æ•°æ®å’Œæµè§ˆå™¨é‡Œçœ‹åˆ°çš„ä¸ä¸€æ ·çš„é—®é¢˜ï¼Ÿ</strong></p>
<p>å‡ºç°è¿™ç§æƒ…å†µæ˜¯å› ä¸ºï¼Œå¾ˆå¤šç½‘ç«™ä¸­çš„æ•°æ®éƒ½æ˜¯é€šè¿‡jsï¼ŒajaxåŠ¨æ€åŠ è½½çš„ï¼Œæ‰€ä»¥ç›´æ¥é€šè¿‡getè¯·æ±‚è·å–çš„é¡µé¢å’Œæµè§ˆå™¨æ˜¾ç¤ºçš„ä¸åŒã€‚</p>
</li>
<li><p><strong>å¦‚ä½•è§£å†³jsæ¸²æŸ“çš„é—®é¢˜ï¼Ÿ</strong></p>
<ul>
<li>åˆ†æajax</li>
<li>Selenium/webdriver</li>
<li>Splash</li>
</ul>
</li>
<li><p><strong>æ€æ ·ä¿å­˜æ•°æ®ï¼Ÿ</strong></p>
<ul>
<li>æ–‡æœ¬ï¼šçº¯æ–‡æœ¬ï¼ŒJson,Xmlç­‰</li>
<li>å…³ç³»å‹æ•°æ®åº“ï¼šå¦‚mysql,oracle,sql serverç­‰ç»“æ„åŒ–æ•°æ®åº“</li>
<li>éå…³ç³»å‹æ•°æ®åº“ï¼šMongoDB,Redisç­‰key-valueå½¢å¼å­˜å‚¨</li>
</ul>
</li>
<li><p><strong>requestçš„åº”ç”¨</strong></p>
<ol>
<li><p>Requestsæ˜¯ç”¨pythonè¯­è¨€åŸºäºurllibç¼–å†™çš„ï¼Œé‡‡ç”¨çš„æ˜¯Apache2 Licensedå¼€æºåè®®çš„HTTPåº“ã€‚ä¸€å¥è¯ï¼Œrequestsæ˜¯pythonå®ç°çš„æœ€ç®€å•æ˜“ç”¨çš„HTTPåº“ï¼Œå»ºè®®çˆ¬è™«ä½¿ç”¨requestsåº“ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response  = requests.get(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">print(type(response))</span><br><span class="line">print(response.status_code)</span><br><span class="line">print(response.text) </span><br><span class="line">print(response.cookies)</span><br><span class="line">print(response.content) <span class="comment">#è¿™æ ·è·å–çš„æ•°æ®æ˜¯äºŒè¿›åˆ¶æ•°æ®</span></span><br><span class="line">print(response.content.decode(<span class="string">"utf-8"</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¾ˆå¤šæƒ…å†µä¸‹çš„ç½‘ç«™å¦‚æœç›´æ¥response.textä¼šå‡ºç°ä¹±ç çš„é—®é¢˜ï¼Œæ‰€ä»¥è¿™ä¸ªä½¿ç”¨response.contentè¿™æ ·è¿”å›çš„æ•°æ®æ ¼å¼å…¶å®æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œç„¶åé€šè¿‡decode()è½¬æ¢ä¸ºutf-8ï¼Œè¿™æ ·å°±è§£å†³äº†é€šè¿‡response.textç›´æ¥è¿”å›æ˜¾ç¤ºä¹±ç çš„é—®é¢˜.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response =requests.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">response.encoding=<span class="string">"utf-8"</span></span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<p>ä¸ç®¡æ˜¯é€šè¿‡response.content.decode(â€œutf-8)çš„æ–¹å¼è¿˜æ˜¯é€šè¿‡response.encoding=â€utf-8â€çš„æ–¹å¼éƒ½å¯ä»¥é¿å…ä¹±ç çš„é—®é¢˜å‘ç”Ÿ</p>
</li>
<li><p><strong>requestsåŒ…ä¸­çš„è¯·æ±‚æ–¹å¼</strong></p>
<p>requestsé‡Œæä¾›ä¸ªå„ç§è¯·æ±‚æ–¹å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">requests.post(<span class="string">"http://httpbin.org/post"</span>)</span><br><span class="line">requests.put(<span class="string">"http://httpbin.org/put"</span>)</span><br><span class="line">requests.delete(<span class="string">"http://httpbin.org/delete"</span>)</span><br><span class="line">requests.head(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line">requests.options(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºæœ¬GETè¯·æ±‚</span></span><br><span class="line">requests.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line"><span class="comment"># å¸¦å‚æ•°çš„GETè¯·æ±‚</span></span><br><span class="line">requests.get(<span class="string">"http://httpbin.org/get?name=zhaofan&amp;age=23"</span>)</span><br><span class="line"><span class="comment"># æˆ–è€… ä½¿ç”¨paramså…³é”®å­—ä¼ é€’å‚æ•°ï¼Œå¦‚æœå­—å…¸ä¸­çš„å‚æ•°ä¸ºNoneåˆ™ä¸ä¼šæ·»åŠ åˆ°urlä¸Š</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"name"</span>:<span class="string">"zhaofan"</span>,</span><br><span class="line">    <span class="string">"age"</span>:<span class="number">22</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">"http://httpbin.org/get"</span>,params=data)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>responseçš„ä¸»è¦å±æ€§</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = requests.get(<span class="string">'http://www.jianshu.com'</span>)</span><br><span class="line">print(type(response.status_code), response.status_code)</span><br><span class="line">print(type(response.headers), response.headers)</span><br><span class="line">print(type(response.cookies), response.cookies)</span><br><span class="line">print(type(response.url), response.url)</span><br><span class="line">print(type(response.history), response.history)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è§£æjson</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = requests.get(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line"><span class="comment"># requestsé‡Œé¢é›†æˆçš„jsonå…¶å®å°±æ˜¯æ‰§è¡Œäº†json.loads()æ–¹æ³•ï¼Œä¸¤è€…çš„ç»“æœæ˜¯ä¸€æ ·çš„</span></span><br><span class="line">print(response.json())</span><br><span class="line">print(json.loads(response.text))</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ·»åŠ headers</strong></p>
<p>å¯ä»¥å®šåˆ¶headersçš„ä¿¡æ¯ï¼Œå¦‚å½“æˆ‘ä»¬ç›´æ¥é€šè¿‡requestsè¯·æ±‚çŸ¥ä¹ç½‘ç«™çš„æ—¶å€™ï¼Œé»˜è®¤æ˜¯æ— æ³•è®¿é—®çš„,å› ä¸ºè®¿é—®çŸ¥ä¹éœ€è¦å¤´éƒ¨ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨è°·æ­Œæµè§ˆå™¨é‡Œè¾“å…¥chrome://version,å°±å¯ä»¥çœ‹åˆ°ç”¨æˆ·ä»£ç†ï¼Œå°†ç”¨æˆ·ä»£ç†æ·»åŠ åˆ°å¤´éƒ¨ä¿¡æ¯.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36"</span></span><br><span class="line">&#125;</span><br><span class="line">response =requests.get(<span class="string">"https://www.zhihu.com"</span>,headers=headers)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>åŸºæœ¬POSTè¯·æ±‚</strong></p>
<p>é€šè¿‡åœ¨å‘é€postè¯·æ±‚æ—¶æ·»åŠ ä¸€ä¸ªdataå‚æ•°ï¼Œè¿™ä¸ªdataå‚æ•°å¯ä»¥é€šè¿‡å­—å…¸æ„é€ æˆï¼Œè¿™æ ·å¯¹äºå‘é€postè¯·æ±‚å°±éå¸¸æ–¹ä¾¿.åŒæ ·çš„åœ¨å‘é€postè¯·æ±‚çš„æ—¶å€™ä¹Ÿå¯ä»¥å’Œå‘é€getè¯·æ±‚ä¸€æ ·é€šè¿‡headerså‚æ•°ä¼ é€’ä¸€ä¸ªå­—å…¸ç±»å‹çš„æ•°æ®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"name"</span>:<span class="string">"zhaofan"</span>,</span><br><span class="line">    <span class="string">"age"</span>:<span class="number">23</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(<span class="string">"http://httpbin.org/post"</span>,data=data)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å…³äºè¯·æ±‚çŠ¶æ€</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response= requests.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"><span class="keyword">if</span> response.status_code == requests.codes.ok:</span><br><span class="line">    print(<span class="string">"è®¿é—®æˆåŠŸ"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ–‡ä»¶ä¸Šä¼ </strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">files= &#123;<span class="string">"files"</span>:open(<span class="string">"git.jpeg"</span>,<span class="string">"rb"</span>)&#125;</span><br><span class="line">response = requests.post(<span class="string">"http://httpbin.org/post"</span>,files=files)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è·å–cookie</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = requests.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">print(response.cookies)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key,value <span class="keyword">in</span> response.cookies.items():</span><br><span class="line">    print(key+<span class="string">"="</span>+value)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ä¼šè¯ç»´æŒ</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.get(<span class="string">"http://httpbin.org/cookies/set/number/123456"</span>)</span><br><span class="line">response = s.get(<span class="string">"http://httpbin.org/cookies"</span>)</span><br><span class="line">print(response.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹é¢æ˜¯é”™è¯¯ç¤ºèŒƒ</span></span><br><span class="line">requests.get(<span class="string">"http://httpbin.org/cookies/set/number/123456"</span>)</span><br><span class="line">response = requests.get(<span class="string">"http://httpbin.org/cookies"</span>)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è¯ä¹¦éªŒè¯</strong></p>
<p>ç°åœ¨å¾ˆå¤šç½‘ç«™éƒ½éœ€è¦è¯ä¹¦çš„éªŒè¯ï¼Œæ²¡æœ‰è¯ä¹¦ä¼šå‡ºç°â€œä½ è®¿é—®çš„ä¸æ˜¯ä¸€ä¸ªç§å¯†é“¾æ¥â€ä¹‹ç±»çš„é”™è¯¯ã€‚å¯¹äºHttpsåè®®ï¼Œç›´é¦–å…ˆä¼šæ£€æŸ¥è¯ä¹¦æ˜¯å¦åˆæ³•ï¼Œå¦‚æœè¯ä¹¦ä¸åˆæ³•ï¼Œåˆ™ä¼šæŠ›å‡ºï¼šSSLErrorã€‚é’ˆå¯¹è¿™ä¸€ç‚¹æœ‰ä¸¤ç§æªæ–½ï¼š<br>ä¸‹é¢è¿™ç§æ–¹æ³•ï¼šåœ¨è®¿é—®çš„æ—¶å€™ï¼Œè®¾ç½®ä¸è¿›è¡Œè¯ä¹¦çš„éªŒè¯ï¼Œæ­¤æ—¶è¿”å›çŠ¶æ€ç 200ï¼Œä½†æ˜¯ä¾æ—§ä¼šæœ‰è­¦å‘Šã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.packages <span class="keyword">import</span> urllib3</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line">response = requests.get(<span class="string">'https://www.12306.cn'</span>, verify=<span class="literal">False</span>)</span><br><span class="line">print(response.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨æŒ‡å®šè¯ä¹¦</span></span><br><span class="line">response = requests.get(<span class="string">'https://www.12306.cn'</span>, cert=(<span class="string">'/path/server.crt'</span>, <span class="string">'/path/key'</span>))</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ä»£ç†çš„è®¾ç½®</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">proxies = &#123;</span><br><span class="line">  <span class="string">"http"</span>: <span class="string">"http://127.0.0.1:9743"</span>,</span><br><span class="line">  <span class="string">"https"</span>: <span class="string">"https://127.0.0.1:9743"</span>,</span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</span><br><span class="line">print(response.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹äºéœ€è¦ç”¨æˆ·åå’Œå¯†ç çš„ä»£ç†</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">"http"</span>: <span class="string">"http://user:password@127.0.0.1:9743/"</span>,<span class="comment">#æŒ‡å®šå¥½ç”¨æˆ·åå’Œå¯†ç </span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</span><br><span class="line">print(response.status_code)</span><br><span class="line"><span class="comment"># socksä»£ç†ï¼šå…ˆå®‰è£…è¯¥æ¨¡å—   pip3 install 'requests[socks]'</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'socks5://127.0.0.1:9742'</span>,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'socks5://127.0.0.1:9742'</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è¶…æ—¶è®¾ç½®</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> ReadTimeout</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">"http://httpbin.org/get"</span>, timeout = <span class="number">0.5</span>)</span><br><span class="line">    print(response.status_code)</span><br><span class="line"><span class="keyword">except</span> ReadTimeout:</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>éœ€è¦ç™»å½•è®¤è¯æ‰èƒ½è®¿é—®çš„ç½‘ç«™</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://120.27.34.24:9001'</span>, auth=HTTPBasicAuth(<span class="string">'user'</span>, <span class="string">'123'</span>))</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">r = requests.get(<span class="string">'http://120.27.34.24:9001'</span>, auth=(<span class="string">'user'</span>, <span class="string">'123'</span>))</span><br><span class="line">print(r.status_code)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¼‚å¸¸å¤„ç†</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> ReadTimeout, ConnectionError, RequestException</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">"http://httpbin.org/get"</span>, timeout = <span class="number">0.5</span>)</span><br><span class="line">    print(response.status_code)</span><br><span class="line"><span class="keyword">except</span> ReadTimeout:</span><br><span class="line">    print(<span class="string">'Timeout'</span>)</span><br><span class="line"><span class="keyword">except</span> ConnectionError:</span><br><span class="line">    print(<span class="string">'Connection error'</span>)</span><br><span class="line"><span class="keyword">except</span> RequestException:</span><br><span class="line">    print(<span class="string">'Error'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>çˆ¬è™«</category>
      </categories>
      <tags>
        <tag>ä¸“ä¸šæŠ€èƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¿€æ´»å‡½æ•°</title>
    <url>/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="sigmoid"><a href="#sigmoid" class="headerlink" title="sigmoid"></a>sigmoid</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>sigmoidå‡½æ•°ä¹Ÿå«Logisticå‡½æ•°ï¼Œç”¨äºéšå±‚ç¥ç»å…ƒè¾“å‡ºï¼Œå–å€¼èŒƒå›´ä¸º(0,1)ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªå®æ•°æ˜ å°„åˆ°(0,1)çš„åŒºé—´ï¼Œå¯ä»¥ç”¨æ¥åšäºŒåˆ†ç±»ã€‚</p>
<p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/sigmoid.png" alt="avatat"></p>
<a id="more"></a>
<p>Sigmoidå‡½æ•°å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
S(x)=\frac{1}{1+e^{-x}}</script><p>å…¶å¯¹xçš„å¯¼æ•°å¯ä»¥ç”¨è‡ªèº«è¡¨ç¤º:</p>
<script type="math/tex; mode=display">
S^{\prime}(x)=\frac{e^{-x}}{\left(1+e^{-x}\right)^{2}}=S(x)(1-S(x))</script><h4 id="æ¢¯åº¦æ¶ˆå¤±"><a href="#æ¢¯åº¦æ¶ˆå¤±" class="headerlink" title="æ¢¯åº¦æ¶ˆå¤±"></a>æ¢¯åº¦æ¶ˆå¤±</h4><p>ä¼˜åŒ–ç¥ç»ç½‘ç»œçš„æ–¹æ³•æ˜¯Back Propagationï¼Œå³å¯¼æ•°çš„åå‘ä¼ é€’ï¼šå…ˆè®¡ç®—è¾“å‡ºå±‚å¯¹åº”çš„lossï¼Œç„¶åå°†lossä»¥å¯¼æ•°çš„å½¢å¼ä¸æ–­å‘ä¸Šä¸€å±‚ç½‘ç»œä¼ é€’ï¼Œä¿®æ­£ç›¸åº”çš„å‚æ•°ï¼Œè¾¾åˆ°é™ä½lossçš„ç›®çš„ã€‚ Sigmoidå‡½æ•°åœ¨æ·±åº¦ç½‘ç»œä¸­å¸¸å¸¸ä¼šå¯¼è‡´å¯¼æ•°é€æ¸å˜ä¸º0ï¼Œä½¿å¾—å‚æ•°æ— æ³•è¢«æ›´æ–°ï¼Œç¥ç»ç½‘ç»œæ— æ³•è¢«ä¼˜åŒ–ã€‚åŸå› åœ¨äºä¸¤ç‚¹ï¼š</p>
<ol>
<li>åœ¨ä¸Šå›¾ä¸­å®¹æ˜“çœ‹å‡ºï¼Œå½“$\sigma(x)$ä¸­$x$è¾ƒå¤§æˆ–è¾ƒå°æ—¶ï¼Œå¯¼æ•°æ¥è¿‘0ï¼Œè€Œåå‘ä¼ é€’çš„æ•°å­¦ä¾æ®æ˜¯å¾®ç§¯åˆ†æ±‚å¯¼çš„é“¾å¼æ³•åˆ™ï¼Œå½“å‰å±‚çš„å¯¼æ•°éœ€è¦ä¹‹å‰å„å±‚å¯¼æ•°çš„ä¹˜ç§¯ï¼Œå‡ ä¸ªå°æ•°çš„ç›¸ä¹˜ï¼Œç»“æœä¼šå¾ˆæ¥è¿‘0 .</li>
<li>Sigmoidå¯¼æ•°çš„æœ€å¤§å€¼æ˜¯0.25ï¼Œè¿™æ„å‘³ç€å¯¼æ•°åœ¨æ¯ä¸€å±‚è‡³å°‘ä¼šè¢«å‹ç¼©ä¸ºåŸæ¥çš„1/4ï¼Œé€šè¿‡ä¸¤å±‚åè¢«å˜ä¸º1/16ï¼Œâ€¦ï¼Œé€šè¿‡10å±‚åä¸º$\frac{1}{4^10}$ã€‚è¯·æ³¨æ„è¿™é‡Œæ˜¯â€œè‡³å°‘â€ï¼Œå¯¼æ•°è¾¾åˆ°æœ€å¤§å€¼è¿™ç§æƒ…å†µè¿˜æ˜¯å¾ˆå°‘è§çš„ã€‚</li>
</ol>
<p>ä¼˜ç‚¹ï¼šå¹³æ»‘ã€æ˜“äºæ±‚å¯¼ã€‚<br>ç¼ºç‚¹ï¼šæ¿€æ´»å‡½æ•°è®¡ç®—é‡å¤§ï¼Œåå‘ä¼ æ’­æ±‚è¯¯å·®æ¢¯åº¦æ—¶ï¼Œæ±‚å¯¼æ¶‰åŠé™¤æ³•ï¼›åå‘ä¼ æ’­æ—¶ï¼Œå¾ˆå®¹æ˜“å°±ä¼šå‡ºç°æ¢¯åº¦æ¶ˆå¤±çš„æƒ…å†µï¼Œä»è€Œæ— æ³•å®Œæˆæ·±å±‚ç½‘ç»œçš„è®­ç»ƒã€‚<strong>å¹‚è¿ç®—ç›¸å¯¹è€—æ—¶</strong></p>
<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1.0</span>/(<span class="number">1</span>+np.exp(-x))</span><br></pre></td></tr></table></figure>
<h3 id="tanh"><a href="#tanh" class="headerlink" title="tanh"></a>tanh</h3><p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/tanh.png" alt="avatar"></p>
<p>tanhå…¬å¼</p>
<script type="math/tex; mode=display">
\tanh x=\frac{e^{x}-e^{-x}}{e^{x}+e^{-x}}</script><h3 id="ReLU"><a href="#ReLU" class="headerlink" title="ReLU"></a>ReLU</h3><p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/relu.png" alt="avatar"></p>
<script type="math/tex; mode=display">
ReLU = max(0,x)</script><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>è§£å†³äº†gradient vanishingé—®é¢˜ (åœ¨æ­£åŒºé—´)</li>
<li>è®¡ç®—é€Ÿåº¦éå¸¸å¿«ï¼Œåªéœ€è¦åˆ¤æ–­è¾“å…¥æ˜¯å¦å¤§äº0</li>
<li>æ”¶æ•›é€Ÿåº¦è¿œå¿«äºsigmoidå’Œtanh</li>
</ul>
<p>å­˜åœ¨çš„é—®é¢˜ï¼š</p>
<ol>
<li>ReLUçš„è¾“å‡ºä¸æ˜¯zero-centered</li>
<li>Dead ReLU Problemï¼ŒæŒ‡çš„æ˜¯æŸäº›ç¥ç»å…ƒå¯èƒ½æ°¸è¿œä¸ä¼šè¢«æ¿€æ´»ï¼Œå¯¼è‡´ç›¸åº”çš„å‚æ•°æ°¸è¿œä¸èƒ½è¢«æ›´æ–°ã€‚æœ‰ä¸¤ä¸ªä¸»è¦åŸå› å¯èƒ½å¯¼è‡´è¿™ç§æƒ…å†µäº§ç”Ÿ: <ol>
<li>éå¸¸ä¸å¹¸çš„å‚æ•°åˆå§‹åŒ–ï¼Œè¿™ç§æƒ…å†µæ¯”è¾ƒå°‘è§ </li>
<li>learning rateå¤ªé«˜å¯¼è‡´åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å‚æ•°æ›´æ–°å¤ªå¤§ï¼Œä¸å¹¸ä½¿ç½‘ç»œè¿›å…¥è¿™ç§çŠ¶æ€ã€‚è§£å†³æ–¹æ³•æ˜¯å¯ä»¥é‡‡ç”¨Xavieråˆå§‹åŒ–æ–¹æ³•ï¼Œä»¥åŠé¿å…å°†learning rateè®¾ç½®å¤ªå¤§æˆ–ä½¿ç”¨adagradç­‰è‡ªåŠ¨è°ƒèŠ‚learning rateçš„ç®—æ³•ã€‚</li>
</ol>
</li>
</ol>
<h3 id="Leaky-ReLU"><a href="#Leaky-ReLU" class="headerlink" title="Leaky ReLU"></a>Leaky ReLU</h3><p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/leakrelu.png" alt="avatar"></p>
<script type="math/tex; mode=display">
f(x)=max(\alpha x,x)</script><p>äººä»¬ä¸ºäº†è§£å†³Dead ReLU Problemï¼Œæå‡ºäº†å°†ReLUçš„å‰åŠæ®µè®¾ä¸º$0.01x$è€Œé0ã€‚å¦å¤–ä¸€ç§ç›´è§‚çš„æƒ³æ³•æ˜¯åŸºäºå‚æ•°çš„æ–¹æ³•ï¼Œå³Parametric ReLU:$f(x)=max(\alpha x,x)$ï¼Œå…¶ä¸­$\alpha$å¯ç”±back propagationå­¦å‡ºæ¥ã€‚ç†è®ºä¸Šæ¥è®²ï¼ŒLeaky ReLUæœ‰ReLUçš„æ‰€æœ‰ä¼˜ç‚¹ï¼Œå¤–åŠ ä¸ä¼šæœ‰Dead ReLUé—®é¢˜ï¼Œä½†æ˜¯åœ¨å®é™…æ“ä½œå½“ä¸­ï¼Œå¹¶æ²¡æœ‰å®Œå…¨è¯æ˜Leaky ReLUæ€»æ˜¯å¥½äºReLUã€‚</p>
<h3 id="ELU-Exponential-Linear-Units"><a href="#ELU-Exponential-Linear-Units" class="headerlink" title="ELU (Exponential Linear Units)"></a><strong>ELU (Exponential Linear Units)</strong></h3><p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/ELU.png" alt="avata"></p>
<script type="math/tex; mode=display">
f(x)=\left\{\begin{array}{ll}
x, & \text { if } x>0 \\
\alpha\left(e^{x}-1\right), & \text { otherwise }
\end{array}\right.</script><p>ELUä¹Ÿæ˜¯ä¸ºè§£å†³ReLUå­˜åœ¨çš„é—®é¢˜è€Œæå‡ºï¼Œæ˜¾ç„¶ï¼ŒELUæœ‰ReLUçš„åŸºæœ¬æ‰€æœ‰ä¼˜ç‚¹ï¼Œä»¥åŠï¼š</p>
<ul>
<li>ä¸ä¼šæœ‰Dead ReLUé—®é¢˜</li>
<li>è¾“å‡ºçš„å‡å€¼æ¥è¿‘0ï¼Œzero-centered</li>
</ul>
<p>å®ƒçš„ä¸€ä¸ªå°é—®é¢˜åœ¨äºè®¡ç®—é‡ç¨å¤§ã€‚ç±»ä¼¼äºLeaky ReLUï¼Œç†è®ºä¸Šè™½ç„¶å¥½äºReLUï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­ç›®å‰å¹¶æ²¡æœ‰å¥½çš„è¯æ®ELUæ€»æ˜¯ä¼˜äºReLUã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://baike.baidu.com/item/Sigmoidå‡½æ•°/7981407?fr=aladdin" target="_blank" rel="noopener">Sigmoidå‡½æ•°</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwNzc2NTk0NQ==&amp;mid=2247484448&amp;idx=1&amp;sn=80479bf682d7ade4184fde809ea0cc3e&amp;chksm=970c2cf6a07ba5e0e046e4d5b8169e8fb58c9e858878840b571d43060e30986152a534830bc6&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">ç¥ç»ç½‘ç»œæ¿€æ´»å‡½æ•°=ç”Ÿç‰©è½¬æ¢å™¨ï¼Ÿ</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/25110450" target="_blank" rel="noopener">èŠä¸€èŠæ·±åº¦å­¦ä¹ çš„activation function</a></li>
</ol>
]]></content>
      <categories>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ¿€æ´»å‡½æ•°</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¼˜åŒ–ç®—æ³•</title>
    <url>/2018/07/11/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="æ¢¯åº¦ä¸‹é™ç®—æ³•"><a href="#æ¢¯åº¦ä¸‹é™ç®—æ³•" class="headerlink" title="æ¢¯åº¦ä¸‹é™ç®—æ³•"></a>æ¢¯åº¦ä¸‹é™ç®—æ³•</h2><p>æ¢¯åº¦ä¸‹é™æ³•(Gradient descent)æˆ–æœ€é€Ÿä¸‹é™æ³•(steepest descent)æ˜¯æ±‚è§£æ— çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜çš„ä¸€ç§å¸¸ç”¨çš„ã€å®ç°ç®€å•çš„æ–¹æ³•ã€‚<br>å‡è®¾$f(x)$æ˜¯$R^n$ä¸Šå…·æœ‰ä¸€é˜¶è¿ç»­åå¯¼æ•°çš„å‡½æ•°ã€‚æ±‚è§£</p>
<script type="math/tex; mode=display">
   min_{x \in R^n}f(x)</script><p>æ— çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜ã€‚ $f^\ast$è¡¨ç¤ºç›®æ ‡å‡½æ•°$f(x)$çš„æå°ç‚¹ã€‚<br>æ¢¯åº¦ä¸‹é™æ³•æ˜¯ä¸€ç§è¿­ä»£ç®—æ³•ï¼Œé€‰å–é€‚å½“çš„åˆå€¼$x^0$,ä¸æ–­è¿­ä»£ï¼Œæ›´æ–°xçš„å€¼ï¼Œè¿›è¡Œç›®æ ‡å‡½æ•°çš„æå°åŒ–ï¼Œç›´åˆ°æ”¶æ•›ã€‚ç”±äºè´Ÿæ¢¯åº¦çš„æ–¹å‘æ˜¯ä½¿å‡½æ•°ä¸‹é™æœ€å¿«çš„æ–¹å‘ï¼Œåœ¨è¿­ä»£çš„æ¯ä¸€æ­¥ï¼Œä»¥è´Ÿæ¢¯åº¦æ–¹å‘æ›´æ–°xçš„å€¼ï¼Œä»è€Œè¾¾åˆ°å‡å°‘å‡½æ•°å€¼çš„ç›®çš„ã€‚<br>ç¬¬k+1æ¬¡è¿­ä»£å€¼ï¼š</p>
<script type="math/tex; mode=display">
x^{(k+1)} \leftarrow x^{(k)}+\lambda_{k} p_{k}</script><p>å…¶ä¸­ï¼Œ$p_k$æ˜¯æœç´¢æ–¹å‘ï¼Œå–è´Ÿæ¢¯åº¦æ–¹å‘$p_k = - \nabla f(x^k)$,$\lambda_k$ä½¿å¾—</p>
<script type="math/tex; mode=display">
f\left(x^{(k)}+\lambda_{k} p_{k}\right)=\min _{\lambda \geq 0} f\left(x^{(k)}+\lambda p_{k}\right)</script><a id="more"></a>
<h3 id="ç®—æ³•æè¿°ï¼š"><a href="#ç®—æ³•æè¿°ï¼š" class="headerlink" title="ç®—æ³•æè¿°ï¼š"></a>ç®—æ³•æè¿°ï¼š</h3><p>è¾“å…¥:ç›®æ ‡å‡½æ•°$f(x)$ï¼Œæ¢¯åº¦å‡½æ•°$g(x^k)=\nabla f(x^k)$,è®¡ç®—$\epsilon$.<br>è¾“å‡ºï¼š$f(x)$çš„æå°å€¼ç‚¹$x^\star$</p>
<ol>
<li>å–åˆå€¼$x^0 \in R^n$,ç½®k=0</li>
<li>è®¡ç®—$f(x^k)$</li>
<li>è®¡ç®—æ¢¯åº¦$g_k = g(x^k)$,å½“$\left|g_{k}\right|&lt;\varepsilon$æ—¶ï¼Œåœæ­¢è¿­ä»£ï¼Œä»¤$p_k = -g(x^k)$æ±‚$\lambda_k$,ä½¿<script type="math/tex; mode=display">
f\left(x^{(k)}+\lambda_{k} p_{k}\right)=\min _{\lambda \geq 0} f\left(x^{(k)}+\lambda p_{k}\right)</script></li>
<li>ç½®$x^{k+1}=x^k+\lambda_k p_k$,è®¡ç®—$f(x^{k+1})$å½“$<br>\left|f\left(x^{(k+1)}\right)-f\left(x^{(k)}\right)\right|&lt;\varepsilon<br>$æˆ–$\left|x^{(k+1)}-x^{(k)}\right|&lt;\varepsilon$åœæ­¢è¿­ä»£ã€‚ä»¤$x^\star = x^{k+1}$</li>
<li>å¦åˆ™ï¼Œç½®$k=k+1$,è½¬3.</li>
</ol>
<h3 id="æ¢¯åº¦ä¸‹é™è°ƒä¼˜"><a href="#æ¢¯åº¦ä¸‹é™è°ƒä¼˜" class="headerlink" title="æ¢¯åº¦ä¸‹é™è°ƒä¼˜"></a>æ¢¯åº¦ä¸‹é™è°ƒä¼˜</h3><ol>
<li><strong>ç®—æ³•çš„æ­¥é•¿é€‰æ‹©</strong>ã€‚æ­¥é•¿å–å€¼å–å†³äºæ•°æ®æ ·æœ¬ï¼Œå¯ä»¥å¤šå–ä¸€äº›å€¼ï¼Œä»å¤§åˆ°å°ï¼Œåˆ†åˆ«è¿è¡Œç®—æ³•ï¼Œçœ‹çœ‹è¿­ä»£æ•ˆæœï¼Œå¦‚æœæŸå¤±å‡½æ•°åœ¨å˜å°ï¼Œè¯´æ˜å–å€¼æœ‰æ•ˆï¼Œå¦åˆ™è¦å¢å¤§æ­¥é•¿ã€‚æ­¥é•¿å¤ªå¤§ï¼Œä¼šå¯¼è‡´è¿­ä»£è¿‡å¿«ï¼Œç”šè‡³æœ‰å¯èƒ½é”™è¿‡æœ€ä¼˜è§£ã€‚æ­¥é•¿å¤ªå°ï¼Œè¿­ä»£é€Ÿåº¦å¤ªæ…¢ï¼Œå¾ˆé•¿æ—¶é—´ç®—æ³•éƒ½ä¸èƒ½ç»“æŸã€‚æ‰€ä»¥ç®—æ³•çš„æ­¥é•¿éœ€è¦å¤šæ¬¡è¿è¡Œåæ‰èƒ½å¾—åˆ°ä¸€ä¸ªè¾ƒä¸ºä¼˜çš„å€¼ã€‚</li>
<li><strong>ç®—æ³•å‚æ•°çš„åˆå§‹å€¼é€‰æ‹©</strong>ã€‚åˆå§‹å€¼ä¸åŒï¼Œè·å¾—çš„æœ€å°å€¼ä¹Ÿæœ‰å¯èƒ½ä¸åŒï¼Œå› æ­¤æ¢¯åº¦ä¸‹é™æ±‚å¾—çš„åªæ˜¯å±€éƒ¨æœ€å°å€¼ï¼›å½“ç„¶å¦‚æœæŸå¤±å‡½æ•°æ˜¯å‡¸å‡½æ•°åˆ™ä¸€å®šæ˜¯æœ€ä¼˜è§£ã€‚ç”±äºæœ‰å±€éƒ¨æœ€ä¼˜è§£çš„é£é™©ï¼Œéœ€è¦å¤šæ¬¡ç”¨ä¸åŒåˆå§‹å€¼è¿è¡Œç®—æ³•ï¼Œå…³é”®æŸå¤±å‡½æ•°çš„æœ€å°å€¼ï¼Œé€‰æ‹©æŸå¤±å‡½æ•°æœ€å°åŒ–çš„åˆå€¼ã€‚</li>
<li><strong>å½’ä¸€åŒ–</strong>ã€‚ç”±äºæ ·æœ¬ä¸åŒç‰¹å¾çš„å–å€¼èŒƒå›´ä¸ä¸€æ ·ï¼Œå¯èƒ½å¯¼è‡´è¿­ä»£å¾ˆæ…¢ï¼Œä¸ºäº†å‡å°‘ç‰¹å¾å–å€¼çš„å½±å“ï¼Œå¯ä»¥å¯¹ç‰¹å¾æ•°æ®å½’ä¸€åŒ–ã€‚</li>
</ol>
<h3 id="æ¢¯åº¦ä¸‹é™æ³•å¤§å®¶æ—ï¼ˆBGDï¼ŒSGDï¼ŒMBGDï¼‰"><a href="#æ¢¯åº¦ä¸‹é™æ³•å¤§å®¶æ—ï¼ˆBGDï¼ŒSGDï¼ŒMBGDï¼‰" class="headerlink" title="æ¢¯åº¦ä¸‹é™æ³•å¤§å®¶æ—ï¼ˆBGDï¼ŒSGDï¼ŒMBGDï¼‰"></a>æ¢¯åº¦ä¸‹é™æ³•å¤§å®¶æ—ï¼ˆBGDï¼ŒSGDï¼ŒMBGDï¼‰</h3><ol>
<li><strong>æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•ï¼ˆBatch Gradient Descentï¼‰</strong> æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•ï¼Œæ˜¯æ¢¯åº¦ä¸‹é™æ³•æœ€å¸¸ç”¨çš„å½¢å¼ï¼Œå…·ä½“åšæ³•ä¹Ÿå°±æ˜¯åœ¨æ›´æ–°å‚æ•°æ—¶ä½¿ç”¨æ‰€æœ‰çš„æ ·æœ¬æ¥è¿›è¡Œæ›´æ–°ã€‚</li>
<li><strong>éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼ˆStochastic Gradient Descentï¼‰</strong> å…¶å®å’Œæ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•åŸç†ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨ä¸æ±‚æ¢¯åº¦æ—¶æ²¡æœ‰ç”¨æ‰€æœ‰çš„æ ·æœ¬çš„æ•°æ®ï¼Œè€Œæ˜¯ä»…ä»…é€‰å–ä¸€ä¸ªæ ·æœ¬æ¥æ±‚æ¢¯åº¦ã€‚éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼Œå’Œæ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•æ˜¯ä¸¤ä¸ªæç«¯ï¼Œä¸€ä¸ªé‡‡ç”¨æ‰€æœ‰æ•°æ®æ¥æ¢¯åº¦ä¸‹é™ï¼Œä¸€ä¸ªç”¨ä¸€ä¸ªæ ·æœ¬æ¥æ¢¯åº¦ä¸‹é™ã€‚è‡ªç„¶å„è‡ªçš„ä¼˜ç¼ºç‚¹éƒ½éå¸¸çªå‡ºã€‚å¯¹äºè®­ç»ƒé€Ÿåº¦æ¥è¯´ï¼Œéšæœºæ¢¯åº¦ä¸‹é™æ³•ç”±äºæ¯æ¬¡ä»…ä»…é‡‡ç”¨ä¸€ä¸ªæ ·æœ¬æ¥è¿­ä»£ï¼Œè®­ç»ƒé€Ÿåº¦å¾ˆå¿«ï¼Œè€Œæ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•åœ¨æ ·æœ¬é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œè®­ç»ƒé€Ÿåº¦ä¸èƒ½è®©äººæ»¡æ„ã€‚å¯¹äºå‡†ç¡®åº¦æ¥è¯´ï¼Œéšæœºæ¢¯åº¦ä¸‹é™æ³•ç”¨äºä»…ä»…ç”¨ä¸€ä¸ªæ ·æœ¬å†³å®šæ¢¯åº¦æ–¹å‘ï¼Œå¯¼è‡´è§£å¾ˆæœ‰å¯èƒ½ä¸æ˜¯æœ€ä¼˜ã€‚å¯¹äºæ”¶æ•›é€Ÿåº¦æ¥è¯´ï¼Œç”±äºéšæœºæ¢¯åº¦ä¸‹é™æ³•ä¸€æ¬¡è¿­ä»£ä¸€ä¸ªæ ·æœ¬ï¼Œå¯¼è‡´è¿­ä»£æ–¹å‘å˜åŒ–å¾ˆå¤§ï¼Œä¸èƒ½å¾ˆå¿«çš„æ”¶æ•›åˆ°å±€éƒ¨æœ€ä¼˜è§£ã€‚</li>
<li><strong>å°æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•ï¼ˆMini-batch Gradient Descentï¼‰</strong> å°æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•æ˜¯æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•å’Œéšæœºæ¢¯åº¦ä¸‹é™æ³•çš„æŠ˜è¡·ï¼Œä¹Ÿå°±æ˜¯å¯¹äº$m$ä¸ªæ ·æœ¬ï¼Œæˆ‘ä»¬é‡‡ç”¨$x$ä¸ªæ ·æœ¬æ¥è¿­ä»£ï¼Œ$1&lt;x&lt;m$ã€‚ä¸€èˆ¬å¯ä»¥å–$x=16,32,64â€¦$ï¼Œå½“ç„¶æ ¹æ®æ ·æœ¬çš„æ•°æ®ï¼Œå¯ä»¥è°ƒæ•´è¿™ä¸ª$x$ çš„å€¼ã€‚</li>
</ol>
<p>ä¸Šè¿°ä¸‰ç§æ–¹æ³•å¾—åˆ°å±€éƒ¨æœ€ä¼˜è§£çš„è¿‡ç¨‹ï¼š<br><img src="/2018/07/11/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/C80A2811-1678-4371-BCCD-8AA51A777820.jpg" alt="avatar"></p>
<h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(X, y, W, B, alpha, max_iters)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    ä½¿ç”¨äº†æ‰€æœ‰çš„æ ·æœ¬è¿›è¡Œæ¢¯åº¦ä¸‹é™</span></span><br><span class="line"><span class="string">    X: è®­ç»ƒé›†,</span></span><br><span class="line"><span class="string">    y: æ ‡ç­¾,</span></span><br><span class="line"><span class="string">    W: æƒé‡å‘é‡,</span></span><br><span class="line"><span class="string">    B: bias,</span></span><br><span class="line"><span class="string">    alpha: å­¦ä¹ ç‡,</span></span><br><span class="line"><span class="string">    max_iters: æœ€å¤§è¿­ä»£æ¬¡æ•°.</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    dW = <span class="number">0</span> <span class="comment"># æƒé‡æ¢¯åº¦æ”¶é›†å™¨</span></span><br><span class="line">    dB = <span class="number">0</span> <span class="comment"># Biasæ¢¯åº¦çš„æ”¶é›†å™¨</span></span><br><span class="line">    m = X.shape[<span class="number">0</span>] <span class="comment"># æ ·æœ¬æ•°</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(max_iters):</span><br><span class="line">        dW = <span class="number">0</span> <span class="comment"># æ¯æ¬¡è¿­ä»£é‡ç½®</span></span><br><span class="line">        dB = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">            <span class="comment"># 1. è¿­ä»£æ‰€æœ‰çš„æ ·æœ¬</span></span><br><span class="line">            <span class="comment"># 2. è®¡ç®—æƒé‡å’Œbiasçš„æ¢¯åº¦ä¿å­˜åœ¨w_gradå’Œb_grad,</span></span><br><span class="line">            <span class="comment"># 3. é€šè¿‡å¢åŠ w_gradå’Œb_gradæ¥æ›´æ–°dWå’ŒdB</span></span><br><span class="line">            W = W - alpha * (dW / m) <span class="comment"># æ›´æ–°æƒé‡</span></span><br><span class="line">            B = B - alpha * (dB / m) <span class="comment"># æ›´æ–°bias</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> W, B</span><br></pre></td></tr></table></figure>
<h3 id="æ¢¯åº¦ä¸‹é™å’Œæœ€å°äºŒä¹˜æ³•"><a href="#æ¢¯åº¦ä¸‹é™å’Œæœ€å°äºŒä¹˜æ³•" class="headerlink" title="æ¢¯åº¦ä¸‹é™å’Œæœ€å°äºŒä¹˜æ³•"></a>æ¢¯åº¦ä¸‹é™å’Œæœ€å°äºŒä¹˜æ³•</h3><p>æ¢¯åº¦ä¸‹é™æ³•å’Œæœ€å°äºŒä¹˜æ³•ç›¸æ¯”ï¼Œæ¢¯åº¦ä¸‹é™æ³•éœ€è¦é€‰æ‹©æ­¥é•¿ï¼Œè€Œæœ€å°äºŒä¹˜æ³•ä¸éœ€è¦ã€‚æ¢¯åº¦ä¸‹é™æ³•æ˜¯è¿­ä»£æ±‚è§£ï¼Œæœ€å°äºŒä¹˜æ³•æ˜¯è®¡ç®—è§£æè§£ã€‚å¦‚æœæ ·æœ¬é‡ä¸ç®—å¾ˆå¤§ï¼Œä¸”å­˜åœ¨è§£æè§£ï¼Œæœ€å°äºŒä¹˜æ³•æ¯”èµ·æ¢¯åº¦ä¸‹é™æ³•è¦æœ‰ä¼˜åŠ¿ï¼Œè®¡ç®—é€Ÿåº¦å¾ˆå¿«ã€‚ä½†æ˜¯å¦‚æœæ ·æœ¬é‡å¾ˆå¤§ï¼Œç”¨æœ€å°äºŒä¹˜æ³•ç”±äºéœ€è¦æ±‚ä¸€ä¸ªè¶…çº§å¤§çš„é€†çŸ©é˜µï¼Œè¿™æ—¶å°±å¾ˆéš¾æˆ–è€…å¾ˆæ…¢æ‰èƒ½æ±‚è§£è§£æè§£äº†ï¼Œä½¿ç”¨è¿­ä»£çš„æ¢¯åº¦ä¸‹é™æ³•æ¯”è¾ƒæœ‰ä¼˜åŠ¿ã€‚</p>
<h2 id="ç‰›é¡¿æ³•"><a href="#ç‰›é¡¿æ³•" class="headerlink" title="ç‰›é¡¿æ³•"></a>ç‰›é¡¿æ³•</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œç‰›é¡¿æ³•ä¸»è¦åº”ç”¨åœ¨ä¸¤ä¸ªæ–¹é¢ï¼Œ1ï¼šæ±‚æ–¹ç¨‹çš„æ ¹ï¼›2ï¼šæœ€ä¼˜åŒ–ã€‚</p>
<h3 id="æ±‚è§£è¿‡ç¨‹"><a href="#æ±‚è§£è¿‡ç¨‹" class="headerlink" title="æ±‚è§£è¿‡ç¨‹"></a>æ±‚è§£è¿‡ç¨‹</h3><p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ–¹ç¨‹éƒ½æœ‰æ±‚æ ¹å…¬å¼ï¼Œæˆ–è€…æ±‚æ ¹å…¬å¼å¾ˆå¤æ‚ï¼Œå¯¼è‡´æ±‚è§£å›°éš¾ã€‚åˆ©ç”¨ç‰›é¡¿æ³•ï¼Œå¯ä»¥è¿­ä»£æ±‚è§£ã€‚</p>
<p>åŸç†æ˜¯åˆ©ç”¨æ³°å‹’å…¬å¼ï¼Œåœ¨ $x_0$å¤„å±•å¼€ï¼Œä¸”å±•å¼€åˆ°ä¸€é˜¶, å³ $f(x)=f(x_0)+f^\prime{x_0}(x-x_0)$ ã€‚æ±‚è§£æ–¹ç¨‹$f(x)=0$ï¼Œç­‰ä»·äº$f(x_0)+f^\prime(x_0)(x-x_0)=0$ï¼Œæ±‚è§£ $x=x_1=x_0-\frac{f(x_0)}{f^\prime(x_0)}$ã€‚å› ä¸ºè¿™æ˜¯åˆ©ç”¨æ³°å‹’å…¬å¼çš„ä¸€é˜¶å±•å¼€,$f(x)=f(x_0)+f^\prime(x_0)(x-x_0)$ å¤„å¹¶ä¸æ˜¯å®Œå…¨ç›¸ç­‰ï¼Œè€Œæ˜¯è¿‘ä¼¼ç›¸ç­‰ï¼Œè¿™é‡Œæ±‚å¾—çš„çš„$x_1$å¹¶ä¸èƒ½è®© $f(x)=0$ï¼Œåªèƒ½è¯´ $f(x_1)$ çš„å€¼æ¯”$f(x_9)$çš„å€¼æ›´æ¥è¿‘äº0ï¼Œäºæ˜¯è¿­ä»£çš„æƒ³æ³•å°±å¾ˆè‡ªç„¶äº†ï¼Œå¯ä»¥è¿›è€Œæ¨å‡º $x_{n+1}=x_n-\frac{f(x_n)}{f\prime(x_n)}$ï¼Œé€šè¿‡è¿­ä»£ï¼Œè¿™ä¸ªå¼å­å¿…ç„¶åœ¨ $f(x^\star)=0$ çš„æ—¶å€™æ”¶æ•›ã€‚æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š<br><img src="/2018/07/11/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/B03C2A8B-AF9F-4871-94F6-0E7F6D6EC890.png" alt="avatar"></p>
<h3 id="æœ€ä¼˜åŒ–"><a href="#æœ€ä¼˜åŒ–" class="headerlink" title="æœ€ä¼˜åŒ–"></a>æœ€ä¼˜åŒ–</h3><p>æ— çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜</p>
<script type="math/tex; mode=display">
min_{x \in R^N}f(x)</script><p>å…¶ä¸­$s^\star$ä¸ºç›®æ ‡å‡½æ•°çš„æå°ç‚¹</p>
<p>è®¾$f(x)$å…·æœ‰äºŒé˜¶è¿ç»­åå¯¼ï¼Œè‹¥ç¬¬$k$æ¬¡è¿­ä»£å€¼ä¸º$x^k$,åˆ™å¯å°†$f(x)$åœ¨$x^k$é™„è¿‘è¿›è¡ŒäºŒé˜¶æ³°å‹’å±•å¼€ï¼š</p>
<script type="math/tex; mode=display">
f(x)=f\left(x^{(k)}\right)+g_{k}^{T}\left(x-x^{(k)}\right)+\frac{1}{2}\left(x-x^{(k)}\right)^{T} H\left(x^{(k)}\right)\left(x-x^{(x)}\right)</script><p>å…¶ä¸­ï¼Œ$g_k=g(x^k)=\nabla f(x^k)$æ˜¯$f(x)$çš„æ¢¯åº¦å‘é‡åœ¨ç‚¹$x^k$çš„å€¼ï¼Œ$H(x^k)$æ˜¯$f(x)$çš„æµ·å¡çŸ©é˜µ</p>
<script type="math/tex; mode=display">
H(x)=\left[\frac{\partial^{2} f}{\partial x_{i} \partial x_{j}}\right]_{n \times n}</script><p>åœ¨ç‚¹$x^k$çš„å€¼ã€‚</p>
<p>å‡½æ•°$f(x)$æœ‰æå€¼çš„å¿…è¦æ¡ä»¶æ˜¯åœ¨æå€¼ç‚¹å¤„ä¸€é˜¶å¯¼æ•°ä¸º0ï¼Œå³æ¢¯åº¦å‘é‡ä¸º0ã€‚ç‰¹åˆ«çš„å½“$H(x^k)$æ˜¯æ­£å®šçŸ©é˜µæ—¶ï¼Œå‡½æ•°$f(x)$çš„æå€¼ä¸ºæœ€å°å€¼ã€‚</p>
<p>ä¸ºäº†çš„å¾—åˆ°ä¸€é˜¶å¯¼æ•°ä¸º0çš„ç‚¹ï¼Œå¯ä»¥ç”¨åˆ°<strong>æ±‚è§£æ–¹ç¨‹</strong>éƒ¨åˆ†çš„æ–¹æ³•ã€‚æ ¹æ®äºŒé˜¶æ³°å‹’å±•å¼€ï¼Œå¯¹$\nabla f(x)$åœ¨$x^k$è¿›è¡Œå±•å¼€å¾—ï¼ˆä¹Ÿå¯ä»¥å¯¹æ³°å‹’å…¬å¼å†è¿›è¡Œæ±‚å¯¼ï¼‰ï¼š</p>
<script type="math/tex; mode=display">
\nabla f(x)=g_{k}+H_{k}\left(x-x^{(k)}\right)</script><p>å…¶ä¸­ï¼Œ$H_k=H(x^k)$åˆ™ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}&g_{k}+H_{k}\left(x^{(k+1)}-x^{(k)}\right)=0\\&x^{(k+1)}=x^{(k)}-H_{k}^{-1} g_{k}\end{aligned}</script><p>ä»¤</p>
<script type="math/tex; mode=display">
H_kp_k = -g_k</script><p>å¾—åˆ°è¿­ä»£å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
x^{k+1} = x^k+p_k</script><p>æœ€ç»ˆåœ¨$\nabla f(x^\star)=0$æ”¶æ•›</p>
<h3 id="ç®—æ³•æè¿°"><a href="#ç®—æ³•æè¿°" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h3><p>è¾“å…¥ï¼šç›®æ ‡å‡½æ•°$f(x)$ï¼Œæ¢¯åº¦$g(x) = \nabla f(x)$,æµ·å¡çŸ©é˜µ$H(x)$,ç²¾åº¦(é˜ˆå€¼)$\epsilon$</p>
<p>è¾“å‡ºï¼š$f(x)$çš„æå°å€¼ç‚¹$x^\star$</p>
<ol>
<li><p>å–åˆå§‹ç‚¹$x^0$,ç½®k=0</p>
</li>
<li><p>è®¡ç®—$g_k = g(x^k)$</p>
</li>
<li><p>è‹¥$\left|g_k \right| &lt; \epsilon$ï¼Œåˆ™åœæ­¢è®¡ç®—ï¼Œæ±‚å¾—è¿‘ä¼¼è§£:$x^\star = x^k$</p>
</li>
<li><p>è®¡ç®—$H_k = H(x^k)$,å¹¶æ±‚$p_k$ã€‚</p>
<script type="math/tex; mode=display">
H_kp_k = -g_k</script></li>
<li><p>ç½® $x(k+1) = x^k + p_k$</p>
</li>
<li>ç½® k=k+1, è½¬2.</li>
</ol>
<h3 id="ç‰›é¡¿æ³•å’Œæ¢¯åº¦ä¸‹é™"><a href="#ç‰›é¡¿æ³•å’Œæ¢¯åº¦ä¸‹é™" class="headerlink" title="ç‰›é¡¿æ³•å’Œæ¢¯åº¦ä¸‹é™"></a>ç‰›é¡¿æ³•å’Œæ¢¯åº¦ä¸‹é™</h3><p>æ¢¯åº¦ä¸‹é™æ³•å’Œç‰›é¡¿æ³•ç›¸æ¯”ï¼Œä¸¤è€…éƒ½æ˜¯è¿­ä»£æ±‚è§£ï¼Œä¸è¿‡æ¢¯åº¦ä¸‹é™æ³•æ˜¯æ¢¯åº¦æ±‚è§£ï¼Œè€Œç‰›é¡¿æ³•æ˜¯ç”¨äºŒé˜¶çš„æµ·æ£®çŸ©é˜µçš„é€†çŸ©é˜µæ±‚è§£ã€‚ç›¸å¯¹è€Œè¨€ï¼Œä½¿ç”¨ç‰›é¡¿æ³•æ”¶æ•›æ›´å¿«ï¼ˆè¿­ä»£æ›´å°‘æ¬¡æ•°ï¼‰ã€‚ä½†æ˜¯æ¯æ¬¡è¿­ä»£çš„æ—¶é—´æ¯”æ¢¯åº¦ä¸‹é™æ³•é•¿ã€‚</p>
<p>æ¢¯åº¦ä¸‹é™æ³•ï¼š </p>
<script type="math/tex; mode=display">
x^{k+1} = x^k - \lambda \nabla f(x^k)</script><p>ç‰›é¡¿æ³•ï¼š</p>
<script type="math/tex; mode=display">
x^{k+1} = x^k-\lambda(H^k)^{-1}\nabla f(x^k)</script><p>è‡³äºä¸ºä»€ä¹ˆç‰›é¡¿æ³•æ”¶æ•›æ›´å¿«ï¼Œé€šä¿—æ¥è¯´æ¢¯åº¦ä¸‹é™æ³•æ¯æ¬¡åªä»ä½ å½“å‰æ‰€å¤„ä½ç½®é€‰ä¸€ä¸ªå¡åº¦æœ€å¤§çš„æ–¹å‘èµ°ä¸€æ­¥ï¼Œç‰›é¡¿æ³•åœ¨é€‰æ‹©æ–¹å‘æ—¶ï¼Œä¸ä»…ä¼šè€ƒè™‘å¡åº¦æ˜¯å¦å¤Ÿå¤§ï¼Œè¿˜ä¼šè€ƒè™‘ä½ èµ°äº†ä¸€æ­¥ä¹‹åï¼Œå¡åº¦æ˜¯å¦ä¼šå˜å¾—æ›´å¤§ã€‚æ‰€ä»¥ï¼Œå¯ä»¥è¯´ç‰›é¡¿æ³•æ¯”æ¢¯åº¦ä¸‹é™æ³•çœ‹å¾—æ›´è¿œä¸€ç‚¹ï¼Œèƒ½æ›´å¿«åœ°èµ°åˆ°æœ€åº•éƒ¨ã€‚ä»å‡ ä½•ä¸Šè¯´ï¼Œç‰›é¡¿æ³•å°±æ˜¯ç”¨ä¸€ä¸ªäºŒæ¬¡æ›²é¢å»æ‹Ÿåˆä½ å½“å‰æ‰€å¤„ä½ç½®çš„å±€éƒ¨æ›²é¢ï¼Œè€Œæ¢¯åº¦ä¸‹é™æ³•æ˜¯ç”¨ä¸€ä¸ªå¹³é¢å»æ‹Ÿåˆå½“å‰çš„å±€éƒ¨æ›²é¢ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼ŒäºŒæ¬¡æ›²é¢çš„æ‹Ÿåˆä¼šæ¯”å¹³é¢æ›´å¥½ï¼Œæ‰€ä»¥ç‰›é¡¿æ³•é€‰æ‹©çš„ä¸‹é™è·¯å¾„ä¼šæ›´ç¬¦åˆçœŸå®çš„æœ€ä¼˜ä¸‹é™è·¯å¾„ã€‚<br><img src="/2018/07/11/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/84835FEB-0EA4-41E5-B07D-41BBEB49AE9B.jpg" alt="9c6e73f0200cbe504e0370a18ca3a95a"><br>çº¢è‰²çš„ç‰›é¡¿æ³•çš„è¿­ä»£è·¯å¾„ï¼Œç»¿è‰²çš„æ˜¯æ¢¯åº¦ä¸‹é™æ³•çš„è¿­ä»£è·¯å¾„ã€‚<br>ç‰›é¡¿æ³•æ˜¯æ¢¯åº¦ä¸‹é™æ³•çš„è¿›ä¸€æ­¥å‘å±•ï¼Œæ¢¯åº¦æ³•åˆ©ç”¨äº†ç›®æ ‡å‡½æ•°çš„ä¸€é˜¶åå¯¼ä¿¡æ¯ã€ä¸€è´Ÿæ¢¯åº¦æ–¹å‘ä½œä¸ºæœç´¢æ–¹å‘ï¼Œåªè€ƒè™‘ç›®æ ‡å‡½æ•°åœ¨è¿­ä»£ç‚¹çš„å±€éƒ¨æ€§è´¨ï¼›è€Œç‰›é¡¿æ³•ä¸ä»…ä½¿ç”¨ç›®æ ‡å‡½æ•°çš„ä¸€é˜¶åå¯¼æ•°ï¼Œè¿˜è¿›ä¸€æ­¥åˆ©ç”¨äº†ç›®æ ‡å‡½æ•°çš„äºŒé˜¶åå¯¼æ•°ï¼Œè¿™æ ·å°±è€ƒè™‘äº†æ¢¯åº¦å˜åŒ–çš„è¶‹åŠ¿ï¼Œå› è€Œèƒ½æ›´å…¨é¢åœ°ç¡®å®šåˆé€‚çš„æœç´¢æ–¹å‘ä»¥åŠ å¿«æ”¶æ•›ï¼Œå®ƒå…·æœ‰äºŒé˜¶æ”¶æ•›é€Ÿåº¦ï¼Œä½†æ˜¯ç‰›é¡¿æ³•ä¹Ÿå­˜åœ¨ä¸¤ä¸ª<strong>ç¼ºç‚¹</strong> ï¼š</p>
<ul>
<li>å¯¹ç›®æ ‡å‡½æ•°æœ‰è¾ƒä¸¥æ ¼çš„è¦æ±‚ï¼Œå‡½æ•°å¿…é¡»å…·æœ‰è¿ç»­çš„ä¸€ã€äºŒé˜¶åå¯¼ï¼Œæµ·å¡çŸ©é˜µå¿…é¡»æ­£å®šã€‚</li>
<li>è®¡ç®—ç›¸å½“å¤æ‚ï¼Œé™¤äº†éœ€è¦è®¡ç®—æ¢¯åº¦å¤–ï¼Œè¿˜éœ€è®¡ç®—äºŒé˜¶åå¯¼çŸ©é˜µå’Œå®ƒçš„é€†çŸ©é˜µã€‚è®¡ç®—é‡ã€å­˜å‚¨é‡éƒ½å¾ˆå¤§ã€‚ä¸”å‡ä»¥ç»´æ•°Nçš„å¹³æ–¹æ¯”å¢åŠ ï¼Œå½“Nå¾ˆå¤§æ—¶ï¼Œè¿™ä¸ªé—®é¢˜å°±æ›´åŠ çªå‡ºã€‚</li>
</ul>
<h2 id="æ‹Ÿç‰›é¡¿æ³•"><a href="#æ‹Ÿç‰›é¡¿æ³•" class="headerlink" title="æ‹Ÿç‰›é¡¿æ³•"></a>æ‹Ÿç‰›é¡¿æ³•</h2><p>åœ¨ç‰›é¡¿æ³•çš„è¿­ä»£è®¡ç®—ä¸­ï¼Œéœ€è¦è®¡ç®—æµ·å¡çŸ©é˜µçš„é€†çŸ©é˜µ$H^-1$ï¼Œè¿™ä¸€è®¡ç®—æ¯”è¾ƒå¤æ‚ï¼Œè€ƒè™‘ç”¨ä¸€ä¸ªné˜¶çŸ©é˜µ$G_k=G(x^k)$æ¥è¿‘ä¼¼æ›¿ä»£$H^{-1}_{k}=H^{-1}(x^k)$ã€‚è¿™å°±æ˜¯æ‹Ÿç‰›é¡¿çš„åŸºæœ¬æƒ³æ³•ã€‚</p>
<p>è¦æ‰¾åˆ°è¿‘ä¼¼çš„æ›¿ä»£çŸ©é˜µï¼Œå¿…å®šè¦å’Œ$H_k$æœ‰ç±»ä¼¼çš„æ€§è´¨ã€‚å…ˆçœ‹ä¸‹ç‰›é¡¿æ³•è¿­ä»£ä¸­æµ·å¡çŸ©é˜µ$H_k$æ»¡è¶³çš„æ¡ä»¶ã€‚é¦–å…ˆï¼Œ$H_k$æ»¡è¶³ä»¥ä¸‹å…³ç³»ï¼š</p>
<p>å–$x=x^{k-1}$ï¼Œç”±</p>
<script type="math/tex; mode=display">
\nabla f(x)=g_k+H_k(x-x^k)</script><p>å¾—ï¼š</p>
<script type="math/tex; mode=display">
g_{k-1}-g_k = H_k(x^{k-1}-x^k)</script><p>è®°$y_k=g_k-g_{k-1},\delta_k = x^k-x^{k-1}$,åˆ™ï¼š</p>
<script type="math/tex; mode=display">
y_{k-1}=H_k\delta_{k-1}H^{-1}_ky_{k-1}=\delta_{k-1}</script><p>ç§°ä¸ºæ‹Ÿç‰›é¡¿æ¡ä»¶ã€‚</p>
<p>å…¶æ¬¡ï¼Œå¦‚æœ$H_k$æ˜¯æ­£å®šçš„ï¼ˆ$H_k^{-1}$ä¹Ÿæ˜¯æ­£å®šçš„ï¼‰ï¼Œé‚£ä¹ˆä¿è¯ç‰›é¡¿æ³•çš„æœç´¢æ–¹å‘$p_k$æ˜¯ä¸‹é™æ–¹å‘ã€‚è¿™æ˜¯å› ä¸ºæœç´¢æ–¹å‘æ˜¯$p_k = -H_k^{-1}g_k$,</p>
<p>ç”±</p>
<script type="math/tex; mode=display">
x^{k+1} = x^k -H^{-1}_kg_k</script><p>æœ‰</p>
<script type="math/tex; mode=display">
x = x^k - \lambda H_k^{-1}g_k = x^k+\lambda p_k</script><p>åˆ™$f(x)$åœ¨$x^k$çš„æ³°å‹’å±•å¼€å¯è¿‘ä¼¼ä¸ºï¼š</p>
<script type="math/tex; mode=display">
f(x) = f(x^k) - \lambda g^T_kH_k^{-1}g_k</script><p>ç”±äº$H_k^{-1}$æ­£å®šï¼Œæ•…$g_k^TH_k^{-1}g_k&gt;0$ã€‚å½“$\lambda$ä¸ºä¸€ä¸ªå……åˆ†å°çš„æ­£æ•°æ—¶ï¼Œæœ‰$f(x)&lt;f(x^k)$,å³æœç´¢æ–¹å‘$p_k$æ˜¯ä¸‹é™æ–¹å‘ã€‚</p>
<p>å› æ­¤æ‹Ÿç‰›é¡¿æ³•å°†$G_k$ä½œä¸º$H^{-1}_k$è¿‘ä¼¼ã€‚è¦æ±‚$G_k$æ»¡è¶³åŒæ ·çš„æ¡ä»¶ã€‚é¦–å…ˆï¼Œæ¯æ¬¡è¿­ä»£çŸ©é˜µ$G_k$æ˜¯æ­£å®šçš„ã€‚åŒæ—¶ï¼Œ$G_kæ»¡è¶³ä¸‹é¢çš„æ‹Ÿç‰›é¡¿æ¡ä»¶</p>
<script type="math/tex; mode=display">
G_{k+1}y_k = \delta_k</script><p>æŒ‰ç…§æ‹Ÿç‰›é¡¿æ¡ä»¶ï¼Œåœ¨æ¯æ¬¡è¿­ä»£ä¸­å¯ä»¥é€‰æ‹©æ›´æ–°çŸ©é˜µ$G_{k+1}$:</p>
<script type="math/tex; mode=display">
G_{k+1} = G_k + \nabla G_k</script><h3 id="DFP"><a href="#DFP" class="headerlink" title="DFP"></a>DFP</h3><h3 id="BFGS"><a href="#BFGS" class="headerlink" title="BFGS"></a>BFGS</h3><h3 id="Broyden"><a href="#Broyden" class="headerlink" title="Broyden"></a>Broyden</h3>]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ä¼˜åŒ–ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>linuxå‘½ä»¤é€ŸæŸ¥</title>
    <url>/2018/06/25/linux%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="linuxçš„æ–‡ä»¶ç³»ç»Ÿ"><a href="#linuxçš„æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="linuxçš„æ–‡ä»¶ç³»ç»Ÿ"></a>linuxçš„æ–‡ä»¶ç³»ç»Ÿ</h2><ol>
<li>/boot:ç³»ç»Ÿå¯åŠ¨ç›¸å…³çš„æ–‡ä»¶ï¼Œå¦‚å†…æ ¸ã€initrdã€ä»¥åŠgrubï¼ˆbootloaderï¼‰</li>
<li>/dev:è®¾å¤‡æ–‡ä»¶ï¼š<ol>
<li>å—è®¾å¤‡ï¼šéšæœºè®¿é—®ï¼Œæ•°æ®å—</li>
<li>å­—ç¬¦è®¾å¤‡ï¼šçº¿æ€§è®¿é—®ï¼ŒæŒ‰å­—ç¬¦ä¸ºå•ä½</li>
<li>è®¾å¤‡å·ï¼šä¸»è®¾å¤‡å·ï¼ˆmajorï¼‰å’Œæ¬¡è®¾å¤‡å·ï¼ˆminorï¼‰</li>
</ol>
</li>
<li>/etcï¼šé…ç½®æ–‡ä»¶</li>
<li>/homeï¼šç”¨æˆ·çš„å®¶ç›®å½•ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·çš„å®¶ç›®å½•é€šå¸¸é»˜è®¤ä¸º/home/username</li>
<li>/rootï¼šç®¡ç†å‘˜çš„å®¶ç›®å½•ï¼›</li>
<li>/lib:åº“æ–‡ä»¶<ol>
<li>é™æ€åº“ï¼š.a</li>
<li>åŠ¨æ€åº“ï¼š.dll, .so(shared object)</li>
<li>/lib/moudules:å†…æ ¸æ¨¡å—æ–‡ä»¶</li>
</ol>
</li>
<li>/lib64</li>
<li>/media:æŒ‚è½½ç‚¹ç›®å½•ï¼Œç§»åŠ¨è®¾å¤‡</li>
<li>/mnt:æŒ‚è½½ç‚¹ç›®å½•ï¼Œé¢å¤–çš„ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ</li>
<li>/opt:å¯é€‰ç›®å½•ï¼Œç¬¬ä¸‰æ–¹ç¨‹åºçš„å®‰è£…ç›®å½•</li>
<li>/procï¼šä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå†…æ ¸æ˜ å°„æ–‡ä»¶</li>
<li>/sysï¼šä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œè·Ÿç¡¬ä»¶è®¾å¤‡ç›¸å…³çš„å±æ€§æ˜ å°„æ–‡ä»¶</li>
<li>/tmp:ä¸´æ—¶æ–‡ä»¶ï¼Œ/var/tmp</li>
<li>/var:å¯å˜åŒ–çš„æ–‡ä»¶</li>
<li>/bin:å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç”¨æˆ·å‘½ä»¤</li>
<li>/sbinï¼šç®¡ç†å‘½ä»¤</li>
</ol>
<a id="more"></a>
<h2 id="terminal-å‘½ä»¤"><a href="#terminal-å‘½ä»¤" class="headerlink" title="terminal å‘½ä»¤"></a>terminal å‘½ä»¤</h2><ol>
<li>printenvï¼šæ‰“å°ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡</li>
<li>whereis: æŸ¥æ‰¾æ–‡ä»¶orå‘½ä»¤</li>
<li>æŸ¥çœ‹å·²ç»å­˜åœ¨çš„ssh key : cat ~/.ssh/id_rsa.pub</li>
</ol>
<h3 id="å‹ç¼©"><a href="#å‹ç¼©" class="headerlink" title="å‹ç¼©"></a>å‹ç¼©</h3><ol>
<li>tar  <ol>
<li>è§£åŒ…ï¼štar zxvf filename.tar  </li>
<li>æ‰“åŒ…ï¼štar czvf filename.tar dirname</li>
</ol>
</li>
<li>gzå‘½ä»¤  <ol>
<li>è§£å‹1ï¼šgunzip filename.gz  </li>
<li>è§£å‹2ï¼šgzip -d filename.gz  </li>
<li>å‹ç¼©ï¼šgzip filename<ol>
<li>.tar.gz å’Œ  .tgz      </li>
<li>è§£å‹ï¼štar zxvf filename.tar.gz      </li>
<li>å‹ç¼©ï¼štar zcvf filename.tar.gz dirname      </li>
<li>å‹ç¼©å¤šä¸ªæ–‡ä»¶ï¼štar zcvf filename.tar.gz dirname1 dirname2 dirname3â€¦..</li>
</ol>
</li>
</ol>
</li>
<li>bz2å‘½ä»¤  <ol>
<li>è§£å‹1ï¼šbzip2 -d filename.bz2  </li>
<li>è§£å‹2ï¼šbunzip2 filename.bz2  </li>
<li>å‹ç¼©ï¼šbzip2 -z filename       </li>
<li>.tar.bz2       <ol>
<li>è§£å‹ï¼štar jxvf filename.tar.bz2       </li>
<li>å‹ç¼©ï¼štar jcvf filename.tar.bz2 dirname</li>
</ol>
</li>
</ol>
</li>
<li>bzå‘½ä»¤    <ol>
<li>è§£å‹1ï¼šbzip2 -d filename.bz    </li>
<li>è§£å‹2ï¼šbunzip2 filename.bz         </li>
<li>.tar.bz       <ol>
<li>è§£å‹ï¼štar jxvf filename.tar.bz</li>
</ol>
</li>
<li>zå‘½ä»¤    <ol>
<li>è§£å‹ï¼šuncompress filename.z    </li>
<li>å‹ç¼©ï¼šcompress filename       </li>
<li>.tar.z          <ol>
<li>è§£å‹ï¼štar zxvf filename.tar.z          </li>
<li>å‹ç¼©ï¼štar zcvf filename.tar.z dirname</li>
</ol>
</li>
</ol>
</li>
<li>zipå‘½ä»¤        <ol>
<li>è§£å‹ï¼šunzip filename.zip    </li>
<li>å‹ç¼©ï¼šzip filename.zip dirname</li>
</ol>
</li>
</ol>
</li>
<li><p>æ€»ç»“ï¼šz ä»¥gzipæ ¼å¼å‹ç¼©ï¼Œcè¡¨ç¤ºcreateï¼Œvæ˜¾ç¤ºå‹ç¼©çš„è¯¦ç»†æƒ…å†µ f file</p>
<ol>
<li>å‹ç¼©<ol>
<li>tar â€“cvf jpg.tar *.jpg //å°†ç›®å½•é‡Œæ‰€æœ‰jpgæ–‡ä»¶æ‰“åŒ…æˆtar.jpg </li>
<li>tar â€“czf jpg.tar.gz *.jpg //å°†ç›®å½•é‡Œæ‰€æœ‰jpgæ–‡ä»¶æ‰“åŒ…æˆjpg.taråï¼Œå¹¶ä¸”å°†å…¶ç”¨gzipå‹ç¼©ï¼Œç”Ÿæˆä¸€ä¸ªgzipå‹ç¼©è¿‡çš„åŒ…ï¼Œå‘½åä¸ºjpg.tar.gz </li>
<li>tar â€“cjf jpg.tar.bz2 *.jpg //å°†ç›®å½•é‡Œæ‰€æœ‰jpgæ–‡ä»¶æ‰“åŒ…æˆjpg.taråï¼Œå¹¶ä¸”å°†å…¶ç”¨bzip2å‹ç¼©ï¼Œç”Ÿæˆä¸€ä¸ªbzip2å‹ç¼©è¿‡çš„åŒ…ï¼Œå‘½åä¸ºjpg.tar.bz2 </li>
<li>tar â€“cZf jpg.tar.Z *.jpg //å°†ç›®å½•é‡Œæ‰€æœ‰jpgæ–‡ä»¶æ‰“åŒ…æˆjpg.taråï¼Œå¹¶ä¸”å°†å…¶ç”¨compresså‹ç¼©ï¼Œç”Ÿæˆä¸€ä¸ªumcompresså‹ç¼©è¿‡çš„åŒ…ï¼Œå‘½åä¸ºjpg.tar.Z </li>
<li>rar a jpg.rar *.jpg //raræ ¼å¼çš„å‹ç¼©ï¼Œéœ€è¦å…ˆä¸‹è½½rar for linux </li>
<li>zip jpg.zip *.jpg //zipæ ¼å¼çš„å‹ç¼©ï¼Œéœ€è¦å…ˆä¸‹è½½zip for linux </li>
<li>è§£å‹</li>
<li>tar â€“xvf file.tar //è§£å‹ taråŒ… </li>
<li>tar -xzvf file.tar.gz //è§£å‹tar.gz </li>
<li>tar -xjvf file.tar.bz2 //è§£å‹ </li>
<li>tar.bz2 tar â€“xZvf file.tar.Z //è§£å‹tar.Z </li>
<li>unrar e file.rar //è§£å‹rar </li>
<li>unzip file.zip //è§£å‹zip </li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h3><ol>
<li>æ–°å»ºä¸€ä¸ªå«session_nameçš„sessionï¼šscreen -S session_name</li>
<li>åˆ—å‡ºå½“å‰æ‰€æœ‰çš„sessionï¼šscreen -ls</li>
<li>å›åˆ°session_nameè¿™ä¸ªsessionï¼šscreen -r session_name</li>
<li>è¿œç¨‹detachæŸä¸ªsessionï¼šscreen -d session_name</li>
<li>ç»“æŸå½“å‰sessionå¹¶å›åˆ°session_nameè¿™ä¸ªsessionï¼šscreen -d -r session_name        </li>
<li>åˆ©ç”¨exité€€å‡ºå¹¶killæ‰session</li>
</ol>
<h3 id="æŸ¥çœ‹æ˜¾å¡å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ"><a href="#æŸ¥çœ‹æ˜¾å¡å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹æ˜¾å¡å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ"></a>æŸ¥çœ‹æ˜¾å¡å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ</h3><ol>
<li>æŸ¥çœ‹æ˜¾å¡ä½¿ç”¨æƒ…å†µï¼šwatch -n 5 nvidia-smi</li>
<li>æŸ¥çœ‹ç£ç›˜ä½¿ç”¨ï¼šdf -h</li>
</ol>
<h3 id="ç§»åŠ¨é‡å‘½å"><a href="#ç§»åŠ¨é‡å‘½å" class="headerlink" title="ç§»åŠ¨é‡å‘½å"></a>ç§»åŠ¨é‡å‘½å</h3><ol>
<li>å°†/usr/udtä¸­çš„æ‰€æœ‰æ–‡ä»¶ç§»åˆ°å½“å‰ç›®å½•(ç”¨â€.â€è¡¨ç¤º)ä¸­ï¼š$ mv /usr/udt/* .</li>
<li>å°†æ–‡ä»¶test.txté‡å‘½åä¸ºwbk.txtï¼š$ mv test.txt wbk.txt</li>
</ol>
<h3 id="ç›®å½•ç®¡ç†"><a href="#ç›®å½•ç®¡ç†" class="headerlink" title="ç›®å½•ç®¡ç†"></a>ç›®å½•ç®¡ç†</h3><ol>
<li>ls</li>
<li>cd</li>
<li>pwd</li>
<li>mkdir</li>
<li>rmdir</li>
<li>tree</li>
</ol>
<h3 id="æ–‡ä»¶ç®¡ç†"><a href="#æ–‡ä»¶ç®¡ç†" class="headerlink" title="æ–‡ä»¶ç®¡ç†"></a>æ–‡ä»¶ç®¡ç†</h3><ol>
<li>touch</li>
<li>stat</li>
<li>file</li>
<li>rm<ol>
<li>-i: è‹¥æŒ‡å®šç›®å½•å·²æœ‰åŒåæ–‡ä»¶ï¼Œåˆ™å…ˆè¯¢é—®æ˜¯å¦è¦†ç›–æ—§æ–‡ä»¶;</li>
<li>-f: åœ¨mvæ“ä½œè¦è¦†ç›–æŸå·²æœ‰çš„ç›®æ ‡æ–‡ä»¶æ—¶ä¸ç»™ä»»ä½•æŒ‡ç¤º;</li>
</ol>
</li>
<li>cp [options] source dest<ol>
<li>-a:æ­¤é€‰é¡¹é€šå¸¸åœ¨å¤åˆ¶ç›®å½•æ—¶ä½¿ç”¨ï¼Œå®ƒä¿ç•™é“¾æ¥ã€æ–‡ä»¶å±æ€§ï¼Œå¹¶å¤åˆ¶ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹ã€‚å…¶ä½œç”¨ç­‰äºdprå‚æ•°ç»„åˆã€‚</li>
<li>-dï¼šå¤åˆ¶æ—¶ä¿ç•™é“¾æ¥ã€‚è¿™é‡Œæ‰€è¯´çš„é“¾æ¥ç›¸å½“äºWindowsç³»ç»Ÿä¸­çš„å¿«æ·æ–¹å¼ã€‚</li>
<li>-fï¼šè¦†ç›–å·²ç»å­˜åœ¨çš„ç›®æ ‡æ–‡ä»¶è€Œä¸ç»™å‡ºæç¤ºã€‚</li>
<li>-iï¼šä¸-fé€‰é¡¹ç›¸åï¼Œåœ¨è¦†ç›–ç›®æ ‡æ–‡ä»¶ä¹‹å‰ç»™å‡ºæç¤ºï¼Œè¦æ±‚ç”¨æˆ·ç¡®è®¤æ˜¯å¦è¦†ç›–ï¼Œå›ç­”â€yâ€æ—¶ç›®æ ‡æ–‡ä»¶å°†è¢«è¦†ç›–ã€‚</li>
<li>-pï¼šé™¤å¤åˆ¶æ–‡ä»¶çš„å†…å®¹å¤–ï¼Œè¿˜æŠŠä¿®æ”¹æ—¶é—´å’Œè®¿é—®æƒé™ä¹Ÿå¤åˆ¶åˆ°æ–°æ–‡ä»¶ä¸­ã€‚</li>
<li>-rï¼šè‹¥ç»™å‡ºçš„æºæ–‡ä»¶æ˜¯ä¸€ä¸ªç›®å½•æ–‡ä»¶ï¼Œæ­¤æ—¶å°†å¤åˆ¶è¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„å­ç›®å½•å’Œæ–‡ä»¶ã€‚</li>
<li>-lï¼šä¸å¤åˆ¶æ–‡ä»¶ï¼Œåªæ˜¯ç”Ÿæˆé“¾æ¥æ–‡ä»¶ã€‚</li>
</ol>
</li>
<li>mv</li>
<li>nano</li>
<li>vi</li>
<li>vim</li>
</ol>
<h3 id="æ—¥æœŸæ—¶é—´"><a href="#æ—¥æœŸæ—¶é—´" class="headerlink" title="æ—¥æœŸæ—¶é—´"></a>æ—¥æœŸæ—¶é—´</h3><ol>
<li>data</li>
<li>clock</li>
<li>hwclock</li>
<li>cal</li>
<li>ntpdate</li>
</ol>
<h3 id="æŸ¥çœ‹æ–‡æœ¬"><a href="#æŸ¥çœ‹æ–‡æœ¬" class="headerlink" title="æŸ¥çœ‹æ–‡æœ¬"></a>æŸ¥çœ‹æ–‡æœ¬</h3><ol>
<li>cat</li>
<li>tac</li>
<li>more</li>
<li>less</li>
<li>head</li>
<li>tail</li>
</ol>
<h3 id="æ–‡æœ¬æŸ¥æ‰¾"><a href="#æ–‡æœ¬æŸ¥æ‰¾" class="headerlink" title="æ–‡æœ¬æŸ¥æ‰¾"></a>æ–‡æœ¬æŸ¥æ‰¾</h3><ol>
<li>findï¼šæŸ¥æ‰¾æ–‡ä»¶ï¼Œegï¼šfind /etc/pass* åœ¨/etcç›®å½•ä¸‹æŸ¥æ‰¾ä»¥passå¼€å¤´çš„æ–‡ä»¶</li>
<li>grepï¼šæŸ¥æ‰¾æ–‡æœ¬å†…å®¹ï¼Œeg: grep â€˜^rootâ€™ /etc/passwd åœ¨/etc/passwdæ–‡ä»¶ä¸­æŸ¥æ‰¾ä»¥rootå¼€å¤´çš„å†…å®¹<h3 id="ç®¡é“"><a href="#ç®¡é“" class="headerlink" title="ç®¡é“"></a>ç®¡é“</h3></li>
<li>| è¡¨ç¤ºç®¡é“ï¼Œè¡¨ç¤ºç®¡é“å·¦è¾¹å‘½ä»¤çš„ç»“æœä¼ ç»™ç®¡é“å³è¾¹ã€‚eg: ls -l | moreã€ ps aux | grep xxx</li>
<li>å‘½ä»¤1 | å‘½ä»¤2 | å‘½ä»¤3</li>
</ol>
<h3 id="æ–‡æœ¬å¤„ç†"><a href="#æ–‡æœ¬å¤„ç†" class="headerlink" title="æ–‡æœ¬å¤„ç†"></a>æ–‡æœ¬å¤„ç†</h3><ol>
<li>cut<ol>
<li>-dï¼šæŒ‡å®šå­—æ®µåˆ†å‰²ç¬¦ï¼Œé»˜è®¤æ˜¯ç©ºæ ¼<ol>
<li>-dâ€,â€</li>
</ol>
</li>
<li>-fï¼š æŒ‡å®šè¦æ˜¾ç¤ºçš„å­—æ®µ<ol>
<li>-f 1,3</li>
<li>-f 1-3</li>
</ol>
</li>
</ol>
</li>
<li>sortï¼šæ–‡æœ¬æ’åº<ol>
<li>-nï¼šæ•°å€¼æ’åº</li>
<li>-rï¼šé™åº</li>
<li>-tï¼šå­—æ®µåˆ†éš”ç¬¦</li>
<li>-kï¼šä»¥å“ªä¸ªå­—æ®µä¸ºå…³é”®å­—è¿›è¡Œæ’åº</li>
<li>-uï¼šæ’åºåç›¸åŒçš„è¡Œåªæ˜¾ç¤ºä¸€æ¬¡</li>
<li>-fï¼šæ’åºæ—¶å¿½ç•¥å­—ç¬¦å¤§å°å†™</li>
</ol>
</li>
<li>join</li>
<li>sed</li>
<li>awk</li>
</ol>
<h3 id="ç³»ç»Ÿç®¡ç†å‘½ä»¤"><a href="#ç³»ç»Ÿç®¡ç†å‘½ä»¤" class="headerlink" title="ç³»ç»Ÿç®¡ç†å‘½ä»¤"></a>ç³»ç»Ÿç®¡ç†å‘½ä»¤</h3><ol>
<li>ps å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¿›ç¨‹çš„è¯¦ç»†çŠ¶å†µ<ol>
<li>-a æ˜¾ç¤ºç»ˆç«¯ä¸Šæ‰€æœ‰è¿›ç¨‹ï¼ŒåŒ…æ‹¬å…¶ä»–ç”¨æˆ·çš„è¿›ç¨‹</li>
<li>-u æ˜¾ç¤ºè¿›ç¨‹çš„è¯¦ç»†çŠ¶æ€</li>
<li>-x æ˜¾ç¤ºæ²¡æœ‰æ§åˆ¶ç»ˆç«¯çš„è¿›ç¨‹</li>
<li>-w æ˜¾ç¤ºåŠ å®½ï¼Œä»¥ä¾¿æ˜¾ç¤ºæ›´å¤šçš„ä¿¡æ¯</li>
<li>-r åªæ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹</li>
</ol>
</li>
<li>top å‘½ä»¤ç”¨æ¥åŠ¨æ€æ˜¾ç¤ºè¿è¡Œä¸­çš„è¿›ç¨‹ï¼Œå¯ä»¥åœ¨ä½¿ç”¨topå‘½ä»¤æ—¶åŠ ä¸Š-dæ¥æŒ‡å®šæ˜¾ç¤ºä¿¡æ¯æ›´æ–°çš„æ—¶é—´é—´éš”ã€‚åœ¨topå‘½ä»¤ä¸‹ï¼Œé€šè¿‡æŒ‰ä¸‹ä¸‹åˆ—å­—æ¯ï¼Œæ¥å¯¹æ˜¾ç¤ºç»“æœè¿›è¡Œæ’åº<ol>
<li>m æ ¹æ®å†…å­˜ä½¿ç”¨é‡æ¥æ’åº</li>
<li>p  æ ¹æ®cpuå æœ‰ç‡æ¥æ’åº</li>
<li>t   æ ¹æ®è¿›ç¨‹è¿è¡Œæ—¶é—´çš„é•¿çŸ­æ¥æ’åº</li>
<li>u  å¯ä»¥æ ¹æ®åé¢è¾“å…¥çš„ç”¨æˆ·åæ¥ç­›é€‰è¿›ç¨‹</li>
<li>k  å¯ä»¥æ ¹æ®åé¢è¾“å…¥çš„pidæ¥æ€æ­»è¿›ç¨‹</li>
<li>q  é€€å‡º</li>
<li>h  è·å¾—å¸®åŠ©</li>
</ol>
</li>
<li>kill ï¼Œkillall<ol>
<li>kill -9 pid</li>
<li>killall è¿›ç¨‹å</li>
</ol>
</li>
</ol>
<h3 id="ç£ç›˜ç©ºé—´å‘½ä»¤"><a href="#ç£ç›˜ç©ºé—´å‘½ä»¤" class="headerlink" title="ç£ç›˜ç©ºé—´å‘½ä»¤"></a>ç£ç›˜ç©ºé—´å‘½ä»¤</h3><ol>
<li>df å‘½ä»¤ç”¨äºæ£€æµ‹æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´å ç”¨å’Œå‰©ä½™æƒ…å†µï¼Œå¯ä»¥æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿå¯¹èŠ‚ç‚¹å’Œç£ç›˜å—çš„ä½¿ç”¨æƒ…å†µ<ol>
<li>a æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ä½¿ç”¨æƒ…å†µ</li>
<li>m ä»¥1024å­—èŠ‚ä¸ºå•ä½æ˜¾ç¤º</li>
<li>t æ˜¾ç¤ºå„æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ</li>
<li>T æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿ</li>
</ol>
</li>
<li>du å‘½ä»¤ç”¨äºç»Ÿè®¡ç›®å½•æˆ–æ–‡ä»¶æ‰€å ç£ç›˜ç©ºé—´çš„å¤§å°ï¼Œè¯¥å‘½ä»¤çš„æ‰§è¡Œç»“æœä¸dfç±»ä¼¼ï¼Œduæ›´ä¾§é‡äºç£ç›˜çš„ä½¿ç”¨æƒ…å†µã€‚ æ ¼å¼ï¼š du [é€‰é¡¹] ç›®å½•æˆ–æ–‡ä»¶å<ol>
<li>a é€’å½’æ˜¾ç¤ºæŒ‡å®šç›®å½•ä¸­å„æ–‡ä»¶å’Œå­ç›®å½•ä¸­æ–‡ä»¶å ç”¨çš„æ•°æ®å—</li>
<li>s æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•å ç”¨çš„æ•°æ®å—</li>
<li>b ä»¥å­—èŠ‚ä¸ºå•ä½æ˜¾ç¤ºç£ç›˜å ç”¨æƒ…å†µ</li>
<li>l è®¡ç®—æ‰€æœ‰æ–‡ä»¶å¤§å°ï¼Œå¯¹ç¡¬é“¾æ¥æ–‡ä»¶è®¡ç®—å¤šæ¬¡</li>
</ol>
</li>
</ol>
<h3 id="æŸ¥çœ‹æˆ–é…ç½®ç½‘å¡ä¿¡æ¯ï¼šifconfig"><a href="#æŸ¥çœ‹æˆ–é…ç½®ç½‘å¡ä¿¡æ¯ï¼šifconfig" class="headerlink" title="æŸ¥çœ‹æˆ–é…ç½®ç½‘å¡ä¿¡æ¯ï¼šifconfig"></a>æŸ¥çœ‹æˆ–é…ç½®ç½‘å¡ä¿¡æ¯ï¼šifconfig</h3><h3 id="æµ‹è¯•è¿œç¨‹ä¸»æœºè¿é€šæ€§ï¼šping"><a href="#æµ‹è¯•è¿œç¨‹ä¸»æœºè¿é€šæ€§ï¼šping" class="headerlink" title="æµ‹è¯•è¿œç¨‹ä¸»æœºè¿é€šæ€§ï¼šping"></a>æµ‹è¯•è¿œç¨‹ä¸»æœºè¿é€šæ€§ï¼šping</h3><ol>
<li>ping -c4 www.baidu.com<h3 id="æŸ¥çœ‹ç½‘ç»œæƒ…å†µï¼š-netstat-ntpl"><a href="#æŸ¥çœ‹ç½‘ç»œæƒ…å†µï¼š-netstat-ntpl" class="headerlink" title="æŸ¥çœ‹ç½‘ç»œæƒ…å†µï¼š netstat -ntpl"></a>æŸ¥çœ‹ç½‘ç»œæƒ…å†µï¼š netstat -ntpl</h3></li>
</ol>
<h3 id="linuxå¼•å·"><a href="#linuxå¼•å·" class="headerlink" title="linuxå¼•å·"></a>linuxå¼•å·</h3><ol>
<li>åå¼•å·ï¼š` ï¼Œ å‘½ä»¤æ›¿æ¢</li>
<li>å•å¼•å·ï¼šâ€™â€™,å­—ç¬¦ä¸²</li>
<li>åŒå¼•å·ï¼šâ€â€,å˜é‡æ›¿æ¢</li>
</ol>
<h2 id="è½¯ä»¶å®‰è£…å’Œç®¡ç†"><a href="#è½¯ä»¶å®‰è£…å’Œç®¡ç†" class="headerlink" title="è½¯ä»¶å®‰è£…å’Œç®¡ç†"></a>è½¯ä»¶å®‰è£…å’Œç®¡ç†</h2><h3 id="è½¯ä»¶åŒ…"><a href="#è½¯ä»¶åŒ…" class="headerlink" title="è½¯ä»¶åŒ…"></a>è½¯ä»¶åŒ…</h3><ol>
<li>binæ–‡ä»¶ï¼ˆé€‚åˆæ‰€æœ‰Linuxå‘è¡Œç‰ˆï¼‰ï¼Œæ˜¯å¯æ‰§è¡Œçš„æ–‡ä»¶</li>
<li>rpmåŒ…ï¼Œyumï¼ˆredhatç³»åˆ—ï¼‰<ol>
<li>rpmå‘½ä»¤ï¼šå®‰è£…è¿‡ç¨‹ä¸­ä¸éœ€è¦æŒ‡å®šå®‰è£…è·¯å¾„ï¼Œrpmæ–‡ä»¶åœ¨åˆ¶ä½œçš„æ—¶å€™å·²ç»ç¡®å®šäº†å®‰è£…è·¯å¾„</li>
<li>æŸ¥è¯¢è½¯ä»¶å®‰è£…è·¯å¾„ï¼šrpm -ql xxx</li>
</ol>
</li>
<li>æºç å‹ç¼©åŒ…ï¼ˆé€‚åˆæ‰€æœ‰çš„Linuxå‘è¡Œç‰ˆï¼‰</li>
<li>å®˜æ–¹å·²ç»ç¼–è¯‘å¥½çš„ï¼Œä¸‹è½½è½¯ä»¶åŒ…ç›´æ¥å¯ä»¥ä½¿ç”¨</li>
<li>å®‰è£…æ­¥éª¤ï¼š<ol>
<li>æ£€æŸ¥æ˜¯å¦å·²ç»å®‰è£…ï¼šrpm -qa | grep jdk</li>
<li>ä¸‹è½½è½¯ä»¶åŒ…</li>
<li>å®‰è£…ä¾èµ–<h3 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h3></li>
</ol>
</li>
<li>è§£å†³rpmä¸‹è½½é—®é¢˜</li>
<li>è§£å†³rpmæ–‡ä»¶çš„æŸ¥è¯¢é—®é¢˜</li>
<li>è§£å†³rpmå®‰è£…é—®é¢˜</li>
<li>è§£å†³rpmçš„ä¾èµ–é—®é¢˜</li>
</ol>
]]></content>
      <categories>
        <category>é€ŸæŸ¥</category>
      </categories>
      <tags>
        <tag>é€ŸæŸ¥</tag>
        <tag>linuxå‘½ä»¤</tag>
      </tags>
  </entry>
  <entry>
    <title>pythoné«˜çº§</title>
    <url>/2018/06/05/python%E9%AB%98%E7%BA%A7/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="range-start-stop-step"><a href="#range-start-stop-step" class="headerlink" title="range(start, stop[, step])"></a>range(start, stop[, step])</h3><ul>
<li>start: è®¡æ•°ä» start å¼€å§‹ã€‚é»˜è®¤æ˜¯ä» 0 å¼€å§‹ã€‚</li>
<li>stop: è®¡æ•°åˆ° stop ç»“æŸï¼Œ</li>
<li>stepï¼šæ­¥é•¿ï¼Œé»˜è®¤ä¸º1ã€‚</li>
</ul>
<a id="more"></a>
<h3 id="lambda-map-filter-reduce-yieldå‡½æ•°çš„åº”ç”¨"><a href="#lambda-map-filter-reduce-yieldå‡½æ•°çš„åº”ç”¨" class="headerlink" title="lambda,map,filter,reduce,yieldå‡½æ•°çš„åº”ç”¨"></a>lambda,map,filter,reduce,yieldå‡½æ•°çš„åº”ç”¨</h3><h4 id="åŒ¿åå‡½æ•°lambda"><a href="#åŒ¿åå‡½æ•°lambda" class="headerlink" title="åŒ¿åå‡½æ•°lambda"></a><strong>åŒ¿åå‡½æ•°lambda</strong></h4><p>å†’å·å·¦è¾¹æ”¾åŸå‡½æ•°çš„å‚æ•°ï¼Œå¯ä»¥æœ‰å¤šä¸ªå‚æ•°ï¼Œç”¨é€—å·(,)éš”å¼€ï¼Œå†’å·å³è¾¹æ˜¯è¿”å›å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">lambda</span> x,y:x+y</span><br></pre></td></tr></table></figure>
<h4 id="éå†å‡½æ•°-map"><a href="#éå†å‡½æ•°-map" class="headerlink" title="éå†å‡½æ•°:map"></a><strong>éå†å‡½æ•°</strong>:map</h4><p>mapå‡½æ•°ç”¨äºéå†åºåˆ—</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">li = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">lo = [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line">list(map(<span class="keyword">lambda</span> x, y: x**<span class="number">2</span> + y**<span class="number">2</span>, li, lo))</span><br><span class="line"><span class="comment"># [26, 40, 58, 80]</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (x*x)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (x+x)</span><br><span class="line"></span><br><span class="line">funcs = [multiply, add]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    value = map(<span class="keyword">lambda</span> x: x(i), funcs)</span><br><span class="line">print(list(value))</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="comment"># [0, 0]</span></span><br><span class="line"><span class="comment"># [1, 2]</span></span><br><span class="line"><span class="comment"># [4, 4]</span></span><br><span class="line"><span class="comment"># [9, 6]</span></span><br></pre></td></tr></table></figure>
<h4 id="ç­›é€‰å‡½æ•°-filter"><a href="#ç­›é€‰å‡½æ•°-filter" class="headerlink" title="ç­›é€‰å‡½æ•°:filter"></a><strong>ç­›é€‰å‡½æ•°</strong>:filter</h4><p>ç­›é€‰å‡½æ•°ç”¨äºå¯¹åºåˆ—ä¸­çš„å…ƒç´ è¿›è¡Œç­›é€‰ï¼Œæœ€ç»ˆè·å–ç¬¦åˆæ¡ä»¶çš„åºåˆ—ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">li = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line">list(filter(<span class="keyword">lambda</span> x: x&gt;<span class="number">5</span>, li))</span><br><span class="line"><span class="comment">#Output</span></span><br><span class="line"><span class="comment"># [6, 7, 8, 9]</span></span><br></pre></td></tr></table></figure>
<h4 id="ç´¯è®¡å‡½æ•°-reduce"><a href="#ç´¯è®¡å‡½æ•°-reduce" class="headerlink" title="ç´¯è®¡å‡½æ•°:reduce"></a><strong>ç´¯è®¡å‡½æ•°</strong>:reduce</h4><p>å¯¹åºåˆ—ä¸­çš„æ‰€æœ‰å‡½æ•°è¿›è¡Œç´¯ç§¯æ“ä½œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">li = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">reduce(<span class="keyword">lambda</span> a, b: a+b, li) <span class="comment"># ç»“æœä¸º15</span></span><br><span class="line">reduce(<span class="keyword">lambda</span> a, b: a+b, li, <span class="number">100</span>)<span class="comment">#ç»“æœä¸º115ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºåˆå§‹å€¼ï¼Œåœ¨æ­¤å€¼ä¹‹è¿›è¡Œç´¯è®¡</span></span><br></pre></td></tr></table></figure>
<h4 id="å…³é”®å­—-yield"><a href="#å…³é”®å­—-yield" class="headerlink" title="å…³é”®å­—: yield"></a><strong>å…³é”®å­—</strong>: yield</h4><p>yieldå¯ä»¥å°†å‡½æ•°æ‰§è¡Œçš„ä¸­é—´ç»“æœè¿”å›ä½†æ˜¯ä¸ç»“æŸç¨‹åºã€‚æŠŠä¸€ä¸ªå‡½æ•°å˜æˆä¸€ä¸ªç”Ÿæˆå™¨.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(x)</span>:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i&lt;x:</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        i+=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="args-å’Œ-kwargs"><a href="#args-å’Œ-kwargs" class="headerlink" title="args å’Œ *kwargs"></a>args å’Œ *kwargs</h3><h4 id="argsï¼šé¢„å…ˆå¹¶ä¸çŸ¥é“-å‡½æ•°ä½¿ç”¨è€…ä¼šä¼ é€’å¤šå°‘ä¸ªå‚æ•°"><a href="#argsï¼šé¢„å…ˆå¹¶ä¸çŸ¥é“-å‡½æ•°ä½¿ç”¨è€…ä¼šä¼ é€’å¤šå°‘ä¸ªå‚æ•°" class="headerlink" title="argsï¼šé¢„å…ˆå¹¶ä¸çŸ¥é“, å‡½æ•°ä½¿ç”¨è€…ä¼šä¼ é€’å¤šå°‘ä¸ªå‚æ•°"></a>argsï¼šé¢„å…ˆå¹¶ä¸çŸ¥é“, å‡½æ•°ä½¿ç”¨è€…ä¼šä¼ é€’å¤šå°‘ä¸ªå‚æ•°</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_var_args</span><span class="params">(f_arg, *argv)</span>:</span></span><br><span class="line">print(<span class="string">"first normal arg:"</span>, f_arg)</span><br><span class="line"><span class="keyword">for</span> arg <span class="keyword">in</span> argv:</span><br><span class="line">    print(<span class="string">"another arg through *argv:"</span>, arg)</span><br><span class="line"></span><br><span class="line">test_var_args(<span class="string">'yasoob'</span>, <span class="string">'python'</span>, <span class="string">'eggs'</span>, <span class="string">'test'</span>)</span><br><span class="line"></span><br><span class="line">first normal arg: yasoob</span><br><span class="line">another arg through *argv: python</span><br><span class="line">another arg through *argv: eggs</span><br><span class="line">another arg through *argv: test</span><br></pre></td></tr></table></figure>
<h4 id="argsï¼šå°†ä¸å®šé•¿åº¦çš„é”®å€¼å¯¹-ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ã€‚"><a href="#argsï¼šå°†ä¸å®šé•¿åº¦çš„é”®å€¼å¯¹-ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ã€‚" class="headerlink" title="**argsï¼šå°†ä¸å®šé•¿åº¦çš„é”®å€¼å¯¹, ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ã€‚"></a>**argsï¼šå°†ä¸å®šé•¿åº¦çš„é”®å€¼å¯¹, ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ã€‚</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greet_me</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> kwargs.items():</span><br><span class="line">    print(<span class="string">"&#123;0&#125; == &#123;1&#125;"</span>.format(key, value))</span><br><span class="line"></span><br><span class="line">greet_me(name=<span class="string">"yasoob"</span>)</span><br><span class="line">name == yasoob</span><br></pre></td></tr></table></figure>
<h3 id="ç”Ÿæˆå™¨-Generators"><a href="#ç”Ÿæˆå™¨-Generators" class="headerlink" title="ç”Ÿæˆå™¨ Generators"></a>ç”Ÿæˆå™¨ Generators</h3><p>ç”Ÿæˆå™¨å¹¶ä¸æŠŠæ‰€æœ‰çš„å€¼å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆå€¼ã€‚é€šè¿‡éå†æ¥ä½¿ç”¨ï¼Œè¦ä¹ˆç”¨ä¸€ä¸ªâ€œforâ€å¾ªç¯ï¼Œè¦ä¹ˆå°†å®ƒä¼ é€’ç»™ä»»æ„å¯ä»¥è¿›è¡Œè¿­ä»£çš„å‡½æ•°å’Œç»“æ„ã€‚å¤§å¤šæ•°æ—¶å€™ç”Ÿæˆå™¨æ˜¯ä»¥å‡½æ•°æ¥å®ç°çš„ã€‚ç„¶è€Œï¼Œå®ƒä»¬å¹¶ä¸è¿”å›ä¸€ä¸ªå€¼ï¼Œè€Œæ˜¯yield(æš‚ä¸”è¯‘ä½œâ€œç”Ÿå‡ºâ€)ä¸€ä¸ªå€¼ã€‚</p>
<h4 id="å¯è¿­ä»£å¯¹è±¡-Iterable"><a href="#å¯è¿­ä»£å¯¹è±¡-Iterable" class="headerlink" title="å¯è¿­ä»£å¯¹è±¡(Iterable)"></a>å¯è¿­ä»£å¯¹è±¡(Iterable)</h4><p> Pythonä¸­ä»»æ„çš„å¯¹è±¡ï¼Œåªè¦å®ƒå®šä¹‰äº†å¯ä»¥è¿”å›ä¸€ä¸ªè¿­ä»£å™¨çš„<strong>iter</strong>æ–¹æ³•ï¼Œæˆ–è€…å®šä¹‰äº†å¯ä»¥æ”¯æŒä¸‹æ ‡ç´¢å¼•çš„<strong>getitem</strong>æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚</p>
<h4 id="è¿­ä»£å™¨-Iterator"><a href="#è¿­ä»£å™¨-Iterator" class="headerlink" title="è¿­ä»£å™¨(Iterator)"></a>è¿­ä»£å™¨(Iterator)</h4><p>ä»»æ„å¯¹è±¡ï¼Œåªè¦å®šä¹‰äº†next(Python2) æˆ–è€…<strong>next</strong>æ–¹æ³•ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚å¯¹äºpythonä¸­çš„å­—ç¬¦ä¸²å¦‚ï¼šp_s = â€˜pythonâ€™æ¥è¯´ï¼Œp_sæ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œä½†ä¸æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œä¸å¯ä»¥ä½¿ç”¨next(p_s),ä½†å¯ä»¥ä½¿ç”¨iter()å‡½æ•°ï¼Œä½¿å¾—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡å˜æˆä¸€ä¸ªè¿­ä»£å™¨ï¼šiter(p_s)</p>
<h4 id="è¿­ä»£-Iteration"><a href="#è¿­ä»£-Iteration" class="headerlink" title="è¿­ä»£(Iteration)"></a>è¿­ä»£(Iteration)</h4><p>ç”¨ä¸€ä¸ªå¾ªç¯æ¥éå†æŸä¸ªä¸œè¥¿æ—¶ï¼Œè¿™ä¸ªè¿‡ç¨‹æœ¬èº«å°±å«è¿­ä»£ã€‚</p>
   <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Python</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generator_function</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> generator_function():</span><br><span class="line">  print(item)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output: 0</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line"><span class="comment"># 7</span></span><br><span class="line"><span class="comment"># 8</span></span><br><span class="line"><span class="comment"># 9</span></span><br></pre></td></tr></table></figure>
<h3 id="è£…é¥°å™¨"><a href="#è£…é¥°å™¨" class="headerlink" title="è£…é¥°å™¨"></a>è£…é¥°å™¨</h3><p>è£…é¥°å™¨æ˜¯ï¼šæ˜¯ä¿®æ”¹å…¶ä»–å‡½æ•°çš„åŠŸèƒ½çš„å‡½æ•°</p>
<h4 id="åœ¨å‡½æ•°ä¸­å®šä¹‰å‡½æ•°"><a href="#åœ¨å‡½æ•°ä¸­å®šä¹‰å‡½æ•°" class="headerlink" title="åœ¨å‡½æ•°ä¸­å®šä¹‰å‡½æ•°"></a><strong>åœ¨å‡½æ•°ä¸­å®šä¹‰å‡½æ•°</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hi</span><span class="params">(name=<span class="string">"yasoob"</span>)</span>:</span></span><br><span class="line">     print(<span class="string">"now you are inside the hi() function"</span>)</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">greet</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"now you are in the greet() function"</span></span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">welcome</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"now you are in the welcome() function"</span></span><br><span class="line"> </span><br><span class="line"> print(greet())</span><br><span class="line"> print(welcome())</span><br><span class="line"> print(<span class="string">"now you are back in the hi() function"</span>)</span><br><span class="line"> </span><br><span class="line"> hi()</span><br><span class="line"> <span class="comment">#output:now you are inside the hi() function</span></span><br><span class="line"> <span class="comment">#       now you are in the greet() function</span></span><br><span class="line"> <span class="comment">#       now you are in the welcome() function</span></span><br><span class="line"> <span class="comment">#       now you are back in the hi() function</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># ä¸Šé¢å±•ç¤ºäº†æ— è®ºä½•æ—¶ä½ è°ƒç”¨hi(), greet()å’Œwelcome()å°†ä¼šåŒæ—¶è¢«è°ƒç”¨ã€‚</span></span><br><span class="line"> <span class="comment"># ç„¶ågreet()å’Œwelcome()å‡½æ•°åœ¨hi()å‡½æ•°ä¹‹å¤–æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œæ¯”å¦‚ï¼š</span></span><br><span class="line"> </span><br><span class="line"> greet()</span><br><span class="line"> <span class="comment">#outputs: NameError: name 'greet' is not defined</span></span><br></pre></td></tr></table></figure>
<h4 id="ä»å‡½æ•°ä¸­è¿”å›å‡½æ•°"><a href="#ä»å‡½æ•°ä¸­è¿”å›å‡½æ•°" class="headerlink" title="ä»å‡½æ•°ä¸­è¿”å›å‡½æ•°"></a><strong>ä»å‡½æ•°ä¸­è¿”å›å‡½æ•°</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hi</span><span class="params">(name=<span class="string">"yasoob"</span>)</span>:</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">greet</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"now you are in the greet() function"</span></span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">welcome</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"now you are in the welcome() function"</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">if</span> name == <span class="string">"yasoob"</span>:</span><br><span class="line">     <span class="keyword">return</span> greet</span><br><span class="line"> <span class="keyword">else</span>:</span><br><span class="line">     <span class="keyword">return</span> welcome</span><br><span class="line"> </span><br><span class="line"> a = hi()</span><br><span class="line"> print(a)</span><br><span class="line"> <span class="comment">#outputs: &lt;function greet at 0x7f2143c01500&gt;</span></span><br><span class="line"> <span class="comment">#ä¸Šé¢æ¸…æ™°åœ°å±•ç¤ºäº†`a`ç°åœ¨æŒ‡å‘åˆ°hi()å‡½æ•°ä¸­çš„greet()å‡½æ•°</span></span><br><span class="line"> <span class="comment">#ç°åœ¨è¯•è¯•è¿™ä¸ª</span></span><br><span class="line"> print(a())</span><br><span class="line"> <span class="comment">#outputs: now you are in the greet() function</span></span><br></pre></td></tr></table></figure>
<h4 id="å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°"><a href="#å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°" class="headerlink" title="å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°"></a><strong>å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hi</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">"hi yasoob!"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doSomethingBeforeHi</span><span class="params">(func)</span>:</span></span><br><span class="line">print(<span class="string">"I am doing some boring work before executing hi()"</span>)</span><br><span class="line">print(func())</span><br><span class="line">doSomethingBeforeHi(hi)</span><br><span class="line"><span class="comment">#outputs:I am doing some boring work before executing hi()</span></span><br><span class="line"><span class="comment">#        hi yasoob!</span></span><br></pre></td></tr></table></figure>
<h4 id="è£…é¥°å™¨-1"><a href="#è£…é¥°å™¨-1" class="headerlink" title="è£…é¥°å™¨"></a><strong>è£…é¥°å™¨</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_new_decorator</span><span class="params">(a_func)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapTheFunction</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"I am doing some boring work before executing a_func()"</span>)</span><br><span class="line"></span><br><span class="line">        a_func()</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"I am doing some boring work after executing a_func()"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapTheFunction</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_function_requiring_decoration</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"I am the function which needs some decoration to remove my foul smell"</span>)</span><br><span class="line"></span><br><span class="line">a_function_requiring_decoration()</span><br><span class="line"><span class="comment">#outputs: "I am the function which needs some decoration to remove my foul smell"</span></span><br><span class="line"></span><br><span class="line">a_function_requiring_decoration = a_new_decorator(a_function_requiring_decoration)</span><br><span class="line"><span class="comment">#now a_function_requiring_decoration is wrapped by wrapTheFunction()</span></span><br><span class="line"></span><br><span class="line">a_function_requiring_decoration()</span><br><span class="line"><span class="comment">#outputs:I am doing some boring work before executing a_func()</span></span><br><span class="line"><span class="comment">#        I am the function which needs some decoration to remove my foul smell</span></span><br><span class="line"><span class="comment">#        I am doing some boring work after executing a_func()</span></span><br></pre></td></tr></table></figure>
<h4 id="è¯­æ³•ç³–"><a href="#è¯­æ³•ç³–" class="headerlink" title="@è¯­æ³•ç³–"></a><strong>@è¯­æ³•ç³–</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@a_new_decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_function_requiring_decoration</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""Hey you! Decorate me!"""</span></span><br><span class="line">    print(<span class="string">"I am the function which needs some decoration to "</span></span><br><span class="line">        <span class="string">"remove my foul smell"</span>)</span><br><span class="line"></span><br><span class="line">a_function_requiring_decoration()</span><br><span class="line"><span class="comment">#outputs: I am doing some boring work before executing a_func()</span></span><br><span class="line"><span class="comment">#         I am the function which needs some decoration to remove my foul smell</span></span><br><span class="line"><span class="comment">#         I am doing some boring work after executing a_func()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#the @a_new_decorator is just a short way of saying:</span></span><br><span class="line">a_function_requiring_decoration = a_new_decorator(a_function_requiring_decoration)</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>functools.wraps</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(a_function_requiring_decoration.__name__)</span><br><span class="line"><span class="comment"># Output: wrapTheFunction</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æœŸå¾…çš„è¾“å‡ºåº”è¯¥æ˜¯â€œa_function_requiring_decorationâ€ï¼Œè¿™é‡Œçš„å‡½æ•°è¢«warpTheFunctionæ›¿ä»£äº†ã€‚Pythonæä¾›ä¸€ä¸ªç®€å•çš„å‡½æ•°æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šfunctools.wrapã€‚</p>
<p>@wrapsæ¥å—ä¸€ä¸ªå‡½æ•°æ¥è¿›è¡Œè£…é¥°ï¼Œå¹¶åŠ å…¥äº†å¤åˆ¶å‡½æ•°åç§°ã€æ³¨é‡Šæ–‡æ¡£ã€å‚æ•°åˆ—è¡¨ç­‰ç­‰çš„åŠŸèƒ½ã€‚è¿™å¯ä»¥è®©æˆ‘ä»¬åœ¨è£…é¥°å™¨é‡Œé¢è®¿é—®åœ¨è£…é¥°ä¹‹å‰çš„å‡½æ•°çš„å±æ€§ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_new_decorator</span><span class="params">(a_func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(a_func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapTheFunction</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"I am doing some boring work before executing a_func()"</span>)</span><br><span class="line">        a_func()</span><br><span class="line">        print(<span class="string">"I am doing some boring work after executing a_func()"</span>)</span><br><span class="line">    <span class="keyword">return</span> wrapTheFunction</span><br><span class="line"></span><br><span class="line"><span class="meta">@a_new_decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_function_requiring_decoration</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""Hey yo! Decorate me!"""</span></span><br><span class="line">    print(<span class="string">"I am the function which needs some decoration to "</span></span><br><span class="line">        <span class="string">"remove my foul smell"</span>)</span><br><span class="line"></span><br><span class="line">print(a_function_requiring_decoration.__name__)</span><br><span class="line"><span class="comment"># Output: a_function_requiring_decoration</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="åº”ç”¨1-æ—¥å¿—"><a href="#åº”ç”¨1-æ—¥å¿—" class="headerlink" title="åº”ç”¨1:æ—¥å¿—"></a>åº”ç”¨1:æ—¥å¿—</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">logit</span><span class="params">(logfile=<span class="string">'out.log'</span>)</span>:</span></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">logging_decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">         @wraps(func)</span></span><br><span class="line">         <span class="function"><span class="keyword">def</span> <span class="title">wrapped_function</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">             log_string = func.__name__ + <span class="string">" was called"</span></span><br><span class="line">             print(log_string)</span><br><span class="line">             <span class="comment"># æ‰“å¼€logfileï¼Œå¹¶å†™å…¥å†…å®¹</span></span><br><span class="line">             <span class="keyword">with</span> open(logfile, <span class="string">'a'</span>) <span class="keyword">as</span> opened_file:</span><br><span class="line">                 <span class="comment"># ç°åœ¨å°†æ—¥å¿—æ‰“åˆ°æŒ‡å®šçš„logfile</span></span><br><span class="line">                 opened_file.write(log_string + <span class="string">'\n'</span>)</span><br><span class="line">             <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">         <span class="keyword">return</span> wrapped_function</span><br><span class="line">     <span class="keyword">return</span> logging_decorator</span><br><span class="line"> </span><br><span class="line"><span class="meta"> @logit()</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">myfunc1</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"> myfunc1()</span><br><span class="line"> <span class="comment"># Output: myfunc1 was called</span></span><br><span class="line"> <span class="comment"># ç°åœ¨ä¸€ä¸ªå«åš out.log çš„æ–‡ä»¶å‡ºç°äº†ï¼Œé‡Œé¢çš„å†…å®¹å°±æ˜¯ä¸Šé¢çš„å­—ç¬¦ä¸²</span></span><br><span class="line"> </span><br><span class="line"><span class="meta"> @logit(logfile='func2.log')</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">myfunc2</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"> myfunc2()</span><br><span class="line"> <span class="comment"># Output: myfunc2 was called</span></span><br><span class="line"> <span class="comment"># ç°åœ¨ä¸€ä¸ªå«åš func2.log çš„æ–‡ä»¶å‡ºç°äº†ï¼Œé‡Œé¢çš„å†…å®¹å°±æ˜¯ä¸Šé¢çš„å­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure>
<h5 id="åº”ç”¨2ï¼šè®¡ç®—å‡½æ•°è¿è¡Œæ—¶é—´"><a href="#åº”ç”¨2ï¼šè®¡ç®—å‡½æ•°è¿è¡Œæ—¶é—´" class="headerlink" title="åº”ç”¨2ï¼šè®¡ç®—å‡½æ•°è¿è¡Œæ—¶é—´"></a>åº”ç”¨2ï¼šè®¡ç®—å‡½æ•°è¿è¡Œæ—¶é—´</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timethis</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="string">"""Decorator that reports the execution time."""</span></span><br><span class="line"><span class="meta">@wraps(func)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    result = func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        print(func.__name__, end - start, <span class="string">'s'</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    eturn wrapper</span><br></pre></td></tr></table></figure>
<h4 id="è£…é¥°å™¨ç±»"><a href="#è£…é¥°å™¨ç±»" class="headerlink" title="è£…é¥°å™¨ç±»"></a>è£…é¥°å™¨ç±»</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">logit</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, logfile=<span class="string">'out.log'</span>)</span>:</span></span><br><span class="line">        self.logfile = logfile</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, func)</span>:</span></span><br><span class="line"><span class="meta">        @wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapped_function</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            log_string = func.__name__ + <span class="string">" was called"</span></span><br><span class="line">            print(log_string)</span><br><span class="line">            <span class="comment"># æ‰“å¼€logfileå¹¶å†™å…¥</span></span><br><span class="line">            <span class="keyword">with</span> open(self.logfile, <span class="string">'a'</span>) <span class="keyword">as</span> opened_file:</span><br><span class="line">                <span class="comment"># ç°åœ¨å°†æ—¥å¿—æ‰“åˆ°æŒ‡å®šçš„æ–‡ä»¶</span></span><br><span class="line">                opened_file.write(log_string + <span class="string">'\n'</span>)</span><br><span class="line">            <span class="comment"># ç°åœ¨ï¼Œå‘é€ä¸€ä¸ªé€šçŸ¥</span></span><br><span class="line">            self.notify()</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> wrapped_function</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">notify</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># logitåªæ‰“æ—¥å¿—ï¼Œä¸åšåˆ«çš„</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="å¯¹è±¡è‡ªçœ"><a href="#å¯¹è±¡è‡ªçœ" class="headerlink" title="å¯¹è±¡è‡ªçœ"></a>å¯¹è±¡è‡ªçœ</h3><h4 id="dir"><a href="#dir" class="headerlink" title="dir"></a>dir</h4><p>ç”¨äºè‡ªçœçš„æœ€é‡è¦çš„å‡½æ•°ä¹‹ä¸€ã€‚å®ƒè¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—å‡ºäº†ä¸€ä¸ªå¯¹è±¡æ‰€æ‹¥æœ‰çš„å±æ€§å’Œæ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">my_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">dir(my_list)</span><br><span class="line"><span class="comment"># Output: ['__add__', '__class__', '__contains__', '__delattr__', '__delitem__',</span></span><br><span class="line"><span class="comment"># '__delslice__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__',</span></span><br><span class="line"><span class="comment"># '__getitem__', '__getslice__', '__gt__', '__hash__', '__iadd__', '__imul__',</span></span><br><span class="line"><span class="comment"># '__init__', '__iter__', '__le__', '__len__', '__lt__', '__mul__', '__ne__',</span></span><br><span class="line"><span class="comment"># '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__reversed__', '__rmul__',</span></span><br><span class="line"><span class="comment"># '__setattr__', '__setitem__', '__setslice__', '__sizeof__', '__str__',</span></span><br><span class="line"><span class="comment"># '__subclasshook__', 'append', 'count', 'extend', 'index', 'insert', 'pop',</span></span><br><span class="line"><span class="comment"># 'remove', 'reverse', 'sort']</span></span><br></pre></td></tr></table></figure>
<h4 id="type-å’Œ-id"><a href="#type-å’Œ-id" class="headerlink" title="type  å’Œ id"></a>type  å’Œ id</h4><h4 id="inspect"><a href="#inspect" class="headerlink" title="inspect"></a>inspect</h4><p>inspectæ¨¡å—å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜</p>
<h3 id="æ¨å¯¼å¼"><a href="#æ¨å¯¼å¼" class="headerlink" title="æ¨å¯¼å¼"></a>æ¨å¯¼å¼</h3><h4 id="åˆ—è¡¨æ¨å¯¼å¼"><a href="#åˆ—è¡¨æ¨å¯¼å¼" class="headerlink" title="åˆ—è¡¨æ¨å¯¼å¼"></a>åˆ—è¡¨æ¨å¯¼å¼</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">variable = [out_exp <span class="keyword">for</span> out_exp <span class="keyword">in</span> input_list <span class="keyword">if</span> out_exp == <span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<h4 id="å­—å…¸æ¨å¯¼å¼"><a href="#å­—å…¸æ¨å¯¼å¼" class="headerlink" title="å­—å…¸æ¨å¯¼å¼"></a>å­—å…¸æ¨å¯¼å¼</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;v: k <span class="keyword">for</span> k, v <span class="keyword">in</span> some_dict.items()&#125;</span><br></pre></td></tr></table></figure>
<h3 id="For-else"><a href="#For-else" class="headerlink" title="For - else"></a>For - else</h3><p>   forå¾ªç¯è¿˜æœ‰ä¸€ä¸ªelseä»å¥,è¿™ä¸ªelseä»å¥ä¼šåœ¨å¾ªç¯æ­£å¸¸ç»“æŸæ—¶æ‰§è¡Œã€‚</p>
   <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">10</span>):</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">2</span>, n):</span><br><span class="line">    <span class="keyword">if</span> n % x == <span class="number">0</span>:</span><br><span class="line">        print(n, <span class="string">'equals'</span>, x, <span class="string">'*'</span>, n / x)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># loop fell through without finding a factor</span></span><br><span class="line">    print(n, <span class="string">'is a prime number'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="å‡½æ•°ç¼“å­˜"><a href="#å‡½æ•°ç¼“å­˜" class="headerlink" title="å‡½æ•°ç¼“å­˜"></a>å‡½æ•°ç¼“å­˜</h3><p>å‡½æ•°ç¼“å­˜å…è®¸æˆ‘ä»¬å°†ä¸€ä¸ªå‡½æ•°å¯¹äºç»™å®šå‚æ•°çš„è¿”å›å€¼ç¼“å­˜èµ·æ¥ã€‚å½“ä¸€ä¸ªI/Oå¯†é›†çš„å‡½æ•°è¢«é¢‘ç¹ä½¿ç”¨ç›¸åŒçš„å‚æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œå‡½æ•°ç¼“å­˜å¯ä»¥èŠ‚çº¦æ—¶é—´ã€‚</p>
<p>Python3.2+</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="meta">@lru_cache(maxsize=32)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print([fib(n) <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">10</span>)])</span><br><span class="line"><span class="comment"># Output: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹è¿”å›å€¼æ¸…ç©ºç¼“å­˜</span></span><br><span class="line">fib.cache_clear()</span><br></pre></td></tr></table></figure>
<p>python2</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">memoize</span><span class="params">(function)</span>:</span></span><br><span class="line">    memo = &#123;&#125;</span><br><span class="line"><span class="meta">    @wraps(function)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> args <span class="keyword">in</span> memo:</span><br><span class="line">            <span class="keyword">return</span> memo[args]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rv = function(*args)</span><br><span class="line">            memo[args] = rv</span><br><span class="line">            <span class="keyword">return</span> rv</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@memoize</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>: <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> fibonacci(n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">fibonacci(<span class="number">25</span>)</span><br></pre></td></tr></table></figure>
<h3 id="With-ä¸Šä¸‹æ–‡ç®¡ç†å™¨"><a href="#With-ä¸Šä¸‹æ–‡ç®¡ç†å™¨" class="headerlink" title="With ä¸Šä¸‹æ–‡ç®¡ç†å™¨"></a>With ä¸Šä¸‹æ–‡ç®¡ç†å™¨</h3><p>å¯ä»¥ç”¨æ¥ç®¡ç†æ•°æ®åº“è¿æ¥å…³é—­ï¼Œæ–‡ä»¶æ‰“å¼€å…³é—­ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„ç±»ï¼Œèµ·ç è¦å®šä¹‰<strong>enter</strong>å’Œ<strong>exit</strong>æ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, file_name, method)</span>:</span></span><br><span class="line">        self.file_obj = open(file_name, method)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.file_obj</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼ŒPythonä¼šå°†å¼‚å¸¸çš„type,valueå’Œtracebackä¼ é€’ç»™__exit__æ–¹æ³•ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, type, value, traceback)</span>:</span></span><br><span class="line">        print(<span class="string">"Exception has been handled"</span>)</span><br><span class="line">        self.file_obj.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> File(<span class="string">'demo.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> opened_file:</span><br><span class="line">    opened_file.undefined_function()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output: Exception has been handled</span></span><br></pre></td></tr></table></figure>
<h3 id="Collections"><a href="#Collections" class="headerlink" title="Collections"></a>Collections</h3><h4 id="Defaultdict"><a href="#Defaultdict" class="headerlink" title="Defaultdict"></a>Defaultdict</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">dict_list = defaultdict(list)</span><br><span class="line">dict_int = defaultdict(int) <span class="comment">#0</span></span><br></pre></td></tr></table></figure>
<h4 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h4><p>Counteræ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå®ƒå¯ä»¥é’ˆå¯¹æŸé¡¹æ•°æ®è¿›è¡Œè®¡æ•°ã€‚</p>
<h4 id="Deque"><a href="#Deque" class="headerlink" title="Deque"></a>Deque</h4><p>dequeæä¾›äº†ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œå¯ä»¥ä»å¤´/å°¾ä¸¤ç«¯æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d = deque(range(<span class="number">5</span>))</span><br><span class="line">print(len(d))</span><br><span class="line"><span class="comment">## è¾“å‡º: 5</span></span><br><span class="line">d.popleft()</span><br><span class="line"><span class="comment">## è¾“å‡º: 0</span></span><br><span class="line">d.pop()</span><br><span class="line"><span class="comment">## è¾“å‡º: 4</span></span><br><span class="line">print(d)</span><br><span class="line"><span class="comment">## è¾“å‡º: deque([1, 2, 3])</span></span><br></pre></td></tr></table></figure>
<h4 id="Namedtuple"><a href="#Namedtuple" class="headerlink" title="Namedtuple"></a>Namedtuple</h4><p>å¯ä»¥åƒå­—å…¸(dict)ä¸€æ ·è®¿é—®namedtuplesï¼Œä½†namedtuplesæ˜¯ä¸å¯å˜çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">Animal = namedtuple(<span class="string">'Animal'</span>, <span class="string">'name age type'</span>)</span><br><span class="line">perry = Animal(name=<span class="string">"perry"</span>, age=<span class="number">31</span>, type=<span class="string">"cat"</span>)</span><br><span class="line"></span><br><span class="line">print(perry)</span><br><span class="line"><span class="comment">## è¾“å‡º: Animal(name='perry', age=31, type='cat')</span></span><br><span class="line"></span><br><span class="line">print(perry.name)</span><br><span class="line"><span class="comment">## è¾“å‡º: 'perry'</span></span><br></pre></td></tr></table></figure>
<h4 id="enum-Enum"><a href="#enum-Enum" class="headerlink" title="enum.Enum"></a>enum.Enum</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Species</span><span class="params">(Enum)</span>:</span></span><br><span class="line">    cat = <span class="number">1</span></span><br><span class="line">    dog = <span class="number">2</span></span><br><span class="line">    horse = <span class="number">3</span></span><br><span class="line">    aardvark = <span class="number">4</span></span><br><span class="line">    butterfly = <span class="number">5</span></span><br><span class="line">    owl = <span class="number">6</span></span><br><span class="line">    platypus = <span class="number">7</span></span><br><span class="line">    dragon = <span class="number">8</span></span><br><span class="line">    unicorn = <span class="number">9</span></span><br><span class="line">    <span class="comment"># ä¾æ¬¡ç±»æ¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½†æˆ‘ä»¬å¹¶ä¸æƒ³å…³å¿ƒåŒä¸€ç‰©ç§çš„å¹´é¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåˆ«å</span></span><br><span class="line">    kitten = <span class="number">1</span>  <span class="comment"># (è¯‘è€…æ³¨ï¼šå¹¼å°çš„çŒ«å’ª)</span></span><br><span class="line">    puppy = <span class="number">2</span>   <span class="comment"># (è¯‘è€…æ³¨ï¼šå¹¼å°çš„ç‹—ç‹—)</span></span><br><span class="line"></span><br><span class="line">Animal = namedtuple(<span class="string">'Animal'</span>, <span class="string">'name age type'</span>)</span><br><span class="line">perry = Animal(name=<span class="string">"Perry"</span>, age=<span class="number">31</span>, type=Species.cat)</span><br><span class="line">drogon = Animal(name=<span class="string">"Drogon"</span>, age=<span class="number">4</span>, type=Species.dragon)</span><br><span class="line">tom = Animal(name=<span class="string">"Tom"</span>, age=<span class="number">75</span>, type=Species.cat)</span><br><span class="line">charlie = Animal(name=<span class="string">"Charlie"</span>, age=<span class="number">2</span>, type=Species.kitten)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>charlie.type == tom.type</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>charlie.type</span><br><span class="line">&lt;Species.cat: <span class="number">1</span>&gt;</span><br></pre></td></tr></table></figure>
<h3 id="itertools"><a href="#itertools" class="headerlink" title="itertools"></a>itertools</h3><p>itertoolsæä¾›çš„å·¥å…·ç›¸å½“é«˜æ•ˆä¸”èŠ‚çœå†…å­˜ã€‚ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œä½ å°†èƒ½å¤Ÿåˆ›å»ºè‡ªå·±å®šåˆ¶çš„è¿­ä»£å™¨ç”¨äºé«˜æ•ˆç‡çš„å¾ªç¯ã€‚itertoolsä¸»è¦æ¥åˆ†ä¸ºä¸‰ç±»å‡½æ•°ï¼Œåˆ†åˆ«ä¸ºæ— é™è¿­ä»£å™¨ã€è¾“å…¥åºåˆ—è¿­ä»£å™¨ã€ç»„åˆç”Ÿæˆå™¨</p>
<h4 id="æ— é™è¿­ä»£å™¨"><a href="#æ— é™è¿­ä»£å™¨" class="headerlink" title="æ— é™è¿­ä»£å™¨"></a>æ— é™è¿­ä»£å™¨</h4><h5 id="Itertools-count-start-0-step-1"><a href="#Itertools-count-start-0-step-1" class="headerlink" title="Itertools.count(start=0, step=1)"></a><strong>Itertools.count(start=0, step=1)</strong></h5><p>åˆ›å»ºä¸€ä¸ªè¿­ä»£å¯¹è±¡ï¼Œç”Ÿæˆä»startå¼€å§‹çš„è¿ç»­æ•´æ•°ï¼Œæ­¥é•¿ä¸ºstepã€‚å¦‚æœçœç•¥äº†startåˆ™é»˜è®¤ä»0å¼€å§‹ï¼Œæ­¥é•¿é»˜è®¤ä¸º1ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.count():</span><br><span class="line">  <span class="keyword">print</span> i</span><br></pre></td></tr></table></figure>
<h5 id="Itertools-cycle-iterable"><a href="#Itertools-cycle-iterable" class="headerlink" title="Itertools.cycle(iterable)"></a><strong>Itertools.cycle(iterable)</strong></h5><p>åˆ›å»ºä¸€ä¸ªè¿­ä»£å¯¹è±¡ï¼Œå¯¹äºè¾“å…¥çš„iterableçš„å…ƒç´ åå¤æ‰§è¡Œå¾ªç¯æ“ä½œï¼Œå†…éƒ¨ç”Ÿæˆiterableä¸­çš„å…ƒç´ çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œè¿™ä¸ªå‰¯æœ¬ç”¨æ¥è¿”å›å¾ªç¯ä¸­çš„é‡å¤é¡¹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> itertools.cycle([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]):</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">print</span> (i, item)</span><br></pre></td></tr></table></figure>
<h5 id="Itertools-repeat-object-times"><a href="#Itertools-repeat-object-times" class="headerlink" title="Itertools.repeat(object[, times])"></a><strong>Itertools.repeat(object[, times])</strong></h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.repeat(<span class="string">'kivinsae'</span>, <span class="number">5</span>):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br></pre></td></tr></table></figure>
<h4 id="è¾“å…¥åºåˆ—è¿­ä»£å™¨"><a href="#è¾“å…¥åºåˆ—è¿­ä»£å™¨" class="headerlink" title="è¾“å…¥åºåˆ—è¿­ä»£å™¨"></a>è¾“å…¥åºåˆ—è¿­ä»£å™¨</h4><h5 id="itertools-accumulate-iterables"><a href="#itertools-accumulate-iterables" class="headerlink" title="itertools.accumulate(*iterables)"></a>itertools.accumulate(*iterables)</h5><p>è¿™ä¸ªå‡½æ•°ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªç´¯åŠ å™¨ï¼Œä¸åœå¯¹åˆ—è¡¨æˆ–è€…è¿­ä»£å™¨è¿›è¡Œç´¯åŠ æ“ä½œï¼ˆè¿™é‡ŒæŒ‡æ¯é¡¹ç´¯åŠ ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = itertools.accumulate(range(<span class="number">10</span>))</span><br><span class="line">print(list(x))</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># [0, 1, 3, 6, 10, 15, 21, 28, 36, 45]</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-chain-iterables"><a href="#itertools-chain-iterables" class="headerlink" title="itertools.chain(*iterables)"></a><strong>itertools.chain(*iterables)</strong></h5><p>æŠŠå¤šä¸ªè¿­ä»£å™¨ä½œä¸ºå‚æ•°ï¼Œä½†æ˜¯åªä¼šè¿”å›å•ä¸ªè¿­ä»£å™¨ã€‚äº§ç”Ÿæ‰€æœ‰å‚æ•°è¿­ä»£å™¨çš„å†…å®¹ï¼Œå´å¥½ä¼¼æ¥è‡ªäºä¸€ä¸ªå•ä¸€çš„åºåˆ—ã€‚ç®€å•äº†è®²å°±æ˜¯è¿æ¥å¤šä¸ª åˆ—è¡¨ æˆ–è€… è¿­ä»£å™¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.chain([<span class="string">'p'</span>,<span class="string">'x'</span>,<span class="string">'e'</span>], [<span class="string">'scp'</span>, <span class="string">'nmb'</span>, <span class="string">'balenciaga'</span>]):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># p</span></span><br><span class="line"><span class="comment"># x</span></span><br><span class="line"><span class="comment"># e</span></span><br><span class="line"><span class="comment"># scp</span></span><br><span class="line"><span class="comment"># nmb</span></span><br><span class="line"><span class="comment"># balenciaga</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-compress-data-selectors"><a href="#itertools-compress-data-selectors" class="headerlink" title="itertools.compress(data,selectors)"></a><strong>itertools.compress(data,selectors)</strong></h5><p>compressæä¾›äº†ä¸€ä¸ªå¯¹äºåŸå§‹æ•°æ®çš„ç­›é€‰åŠŸèƒ½ï¼Œå…·ä½“æ¡ä»¶å¯ä»¥è®¾ç½®çš„éå¸¸å¤æ‚ï¼Œä¸‹é¢åˆ—å‡ºç›¸å…³çš„å®šä¹‰ä»£ç æ¥è§£é‡Šã€‚ç®€å•æ¥ç†è§£ï¼Œå°±æ˜¯æŒ‰ç…§çœŸå€¼è¡¨è¿›è¡Œå…ƒç´ ç­›é€‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  ä¾‹ï¼š</span></span><br><span class="line">list(itertools.compress(<span class="string">'ABCDEF'</span>, [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]))</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># ['A', 'B', 'D', 'F']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…·ä½“å®ç°ï¼š</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress</span><span class="params">(data, selectors)</span>:</span></span><br><span class="line">    <span class="comment"># compress('ABCDEF', [1,0,1,0,1,1]) --&gt; A C E F</span></span><br><span class="line">    <span class="keyword">return</span> (d <span class="keyword">for</span> d, s <span class="keyword">in</span> izip(data, selectors) <span class="keyword">if</span> s)</span><br></pre></td></tr></table></figure>
<h5 id="itertools-dropwhile-predicate-iterable"><a href="#itertools-dropwhile-predicate-iterable" class="headerlink" title="itertools.dropwhile(predicate,iterable)"></a><strong>itertools.dropwhile(predicate,iterable)</strong></h5><p>dropwhileä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œåªè¦æ˜¯å‡½æ•°predicate(item)ä¸ºTrueï¼Œåˆ™ä¸¢æ‰iterableä¸­çš„é¡¹ï¼Œä½†æ˜¯å¦‚æœpredicateè¿”å›çš„æ˜¯Falseï¼Œåˆ™ç”Ÿæˆiterableä¸­çš„é¡¹å’Œæ‰€æœ‰çš„åç»­é¡¹ã€‚<br>å…·ä½“æ¥è¯´å°±æ˜¯ï¼Œåœ¨æ¡ä»¶ä¸ºFalseä¹‹åçš„ç¬¬ä¸€æ¬¡ï¼Œå°±è¿”å›è¿­ä»£å™¨ä¸­å‰©ä½™çš„æ‰€æœ‰é¡¹ã€‚åœ¨è¿™ä¸ªå‡½æ•°è¡¨è¾¾å¼é‡Œé¢iterableçš„å€¼ä¼šæŒ‰ç´¢å¼•ä¸€ä¸ªä¸ªä½œä¸ºpredicateçš„å‚æ•°è¿›è¡Œè®¡ç®—ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŒ‰ç…§çœŸå€¼å‡½æ•°ä¸¢å¼ƒæ‰åˆ—è¡¨å’Œè¿­ä»£å™¨å‰é¢çš„å…ƒç´ ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">should_drop</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="keyword">return</span> (x &lt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.dropwhile(should_drop, [<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">-2</span>]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># Testing: -1</span></span><br><span class="line"><span class="comment"># Testing: 0</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Yielding: 2</span></span><br><span class="line"><span class="comment"># Yielding: 3</span></span><br><span class="line"><span class="comment"># Yielding: 4</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Yielding: -2</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-groupby-iterable-key"><a href="#itertools-groupby-iterable-key" class="headerlink" title="itertools.groupby(iterable[,key])"></a><strong>itertools.groupby(iterable[,key])</strong></h5><p>è¿”å›ä¸€ä¸ªé›†åˆçš„è¿­ä»£å™¨ï¼Œé›†åˆå†…æ˜¯æŒ‰ç…§keyè¿›è¡Œåˆ†ç»„åçš„å€¼ã€‚<br>å¦‚æœiterableåœ¨å¤šæ¬¡è¿ç»­çš„è¿­ä»£ä¸­ç”Ÿæˆäº†åŒä¸€é¡¹ï¼Œåˆ™ä¼šå®šä¹‰ä¸€ä¸ªç»„ï¼Œå¦‚æœå¯¹è¿™ä¸ªå‡½æ•°åº”ç”¨ä¸€ä¸ªåˆ†ç±»åˆ—è¡¨ï¼Œé‚£ä¹ˆåˆ†ç»„ä¼šå®šä¹‰è¿™ä¸ªåˆ—è¡¨ä¸­æ‰€æœ‰çš„å”¯ä¸€é¡¹ï¼Œkeyæ˜¯ä¸€ä¸ªå‡½æ•°å¹¶åº”ç”¨äºæ¯ä¸€é¡¹ã€‚å¦‚æœè¿™ä¸ªå‡½æ•°æœ‰è¿”å›å€¼ï¼Œåˆ™è¿™ä¸ªå€¼ä¼šç”¨äºåç»­çš„é¡¹ï¼Œè€Œä¸æ˜¯å’Œè¯¥é¡¹æœ¬èº«è¿›è¡Œæ¯”è¾ƒã€‚è¿™ä¸ªå‡½æ•°è¿”å›çš„è¿­ä»£å™¨ç”Ÿæˆå…ƒç´ (key,group)ï¼Œkeyæ˜¯åˆ†ç»„çš„é”®å€¼ï¼Œgroupæ˜¯è¿­ä»£å™¨ï¼Œä»è€Œç”Ÿæˆç»„æˆè¿™ä¸ªç»„çš„æ‰€æœ‰é¡¹ç›®ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="string">'aa'</span>, <span class="string">'ab'</span>, <span class="string">'abc'</span>, <span class="string">'bcd'</span>, <span class="string">'abcde'</span>]</span><br><span class="line"><span class="keyword">for</span> i, k <span class="keyword">in</span> itertools.groupby(a, len):</span><br><span class="line">    <span class="keyword">print</span> i, list(k)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># 2 ['aa', 'ab']</span></span><br><span class="line"><span class="comment"># 3 ['abc', 'bcd']</span></span><br><span class="line"><span class="comment"># 5 ['abcde']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…·ä½“å®ç°</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">groupby</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="comment"># [k for k, g in groupby('AAAABBBCCDAABBB')] --&gt; A B C D A B</span></span><br><span class="line">        <span class="comment"># [list(g) for k, g in groupby('AAAABBBCCD')] --&gt; AAAA BBB CC D</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, iterable, key=None)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> key <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                key = <span class="keyword">lambda</span> x: x</span><br><span class="line">            self.keyfunc = key</span><br><span class="line">            self.it = iter(iterable)</span><br><span class="line">            self.tgtkey = self.currkey = self.currvalue = object()</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">next</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">while</span> self.currkey == self.tgtkey:</span><br><span class="line">                self.currvalue = next(self.it)    <span class="comment"># Exit on StopIteration</span></span><br><span class="line">                self.currkey = self.keyfunc(self.currvalue)</span><br><span class="line">            self.tgtkey = self.currkey</span><br><span class="line">            <span class="keyword">return</span> (self.currkey, self._grouper(self.tgtkey))</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">_grouper</span><span class="params">(self, tgtkey)</span>:</span></span><br><span class="line">            <span class="keyword">while</span> self.currkey == tgtkey:</span><br><span class="line">                <span class="keyword">yield</span> self.currvalue</span><br><span class="line">                self.currvalue = next(self.it)    <span class="comment"># Exit on StopIteration</span></span><br><span class="line">                self.currkey = self.keyfunc(self.currvalue)</span><br></pre></td></tr></table></figure>
<h5 id="itertools-ifilter-predicate-iterable"><a href="#itertools-ifilter-predicate-iterable" class="headerlink" title="itertools.ifilter(predicate,iterable)"></a><strong>itertools.ifilter(predicate,iterable)</strong></h5><p>å‡½æ•°è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œç±»ä¼¼äºé’ˆå¯¹äºåˆ—è¡¨çš„å‡½æ•°filter()ï¼Œä½†æ˜¯åªåŒ…æ‹¬æµ‹è¯•å‡½æ•°è¿”å›Trueæ—¶å€™çš„å€¼ã€‚å’Œdropwhile()ä½œç”¨ä¸åŒã€‚<br>å‡½æ•°åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œåªç”Ÿæˆpredicate(iterable)ä¸ºTrueçš„é¡¹ï¼Œç®€å•æ¥è¯´å°±æ˜¯è¿”å›iterableä¸­æ‰€æœ‰è®¡ç®—åä¸ºTrueçš„é¡¹ã€‚å¦‚æœæ˜¯éTrueåˆ™è¿›è¡Œä¹‹åçš„å…¶ä»–æ“ä½œã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_item</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="keyword">return</span> (x&lt;<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.ifilter(check_item, [ <span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">-2</span> ]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># Testing: -1</span></span><br><span class="line"><span class="comment"># Yielding: -1</span></span><br><span class="line"><span class="comment"># Testing: 0</span></span><br><span class="line"><span class="comment"># Yielding: 0</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Testing: 2</span></span><br><span class="line"><span class="comment"># Testing: 3</span></span><br><span class="line"><span class="comment"># Testing: 4</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Testing: -2</span></span><br><span class="line"><span class="comment"># Yielding: -2</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-ifilterfalse-predicate-iterable"><a href="#itertools-ifilterfalse-predicate-iterable" class="headerlink" title="itertools.ifilterfalse(predicate,iterable)"></a><strong>itertools.ifilterfalse(predicate,iterable)</strong></h5><p>æœ¬å‡½æ•°å’Œä¸Šé¢çš„ifilterä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯åªæœ‰å½“predicate(iterable)ä¸ºFalseæ—¶å€™æ‰è¿›è¡Œpredicateçš„è¾“å‡ºã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_item</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="keyword">return</span> (x &lt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.ifilterfalse(check_item, [<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">-2</span>]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># Testing: -1</span></span><br><span class="line"><span class="comment"># Testing: 0</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Testing: 2</span></span><br><span class="line"><span class="comment"># Yielding: 2</span></span><br><span class="line"><span class="comment"># Testing: 3</span></span><br><span class="line"><span class="comment"># Yielding: 3</span></span><br><span class="line"><span class="comment"># Testing: 4</span></span><br><span class="line"><span class="comment"># Yielding: 4</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Testing: -2</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-islice-iterable-stop"><a href="#itertools-islice-iterable-stop" class="headerlink" title="itertools.islice(iterable,stop)"></a><strong>itertools.islice(iterable,stop)</strong></h5><p>ç®€å•æ¥è¯´è¿™ä¸ªå‡½æ•°ï¼Œå°±æ˜¯å¯¹äºä¸€ä¸ªè¿­ä»£å¯¹è±¡iterableï¼Œè®¾å®šä¸€ä¸ªç‰¹å®šçš„åˆ‡ç‰‡/é€‰å–/æˆªå–è§„åˆ™ï¼Œç„¶åæœ€åè¾“å‡ºä¸€ä¸ªç‰¹å®šçš„æ–°çš„è¿­ä»£å¯¹è±¡çš„è¿‡ç¨‹ã€‚è¿™ä¸ªstopå®é™…ä¸Šä»£è¡¨ä¸€ä¸ªä¸‰å…ƒæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯startï¼Œstopï¼Œstepã€‚å¦‚æœstartçœç•¥ï¼Œé»˜è®¤ä»ç´¢å¼•0å¼€å§‹ï¼›å¦‚æœstepè¢«çœç•¥ï¼Œåˆ™é»˜è®¤æ­¥é•¿ä¸º1ï¼›stopä¸èƒ½è¢«çœç•¥ã€‚æœ¬è´¨å°±æ˜¯ä¸€ä¸ªåˆ‡ç‰‡å·¥å…·ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Stop at 5:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.islice(itertools.count(), <span class="number">5</span>):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Start at 5, Stop at 10:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.islice(itertools.count(), <span class="number">5</span>, <span class="number">10</span>):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="keyword">print</span> <span class="string">'By tens to 100:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.islice(itertools.count(), <span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># Stop</span></span><br><span class="line"><span class="comment"># at</span></span><br><span class="line"><span class="comment"># 5:</span></span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># Start</span></span><br><span class="line"><span class="comment"># at</span></span><br><span class="line"><span class="comment"># 5, Stop</span></span><br><span class="line"><span class="comment"># at</span></span><br><span class="line"><span class="comment"># 10:</span></span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line"><span class="comment"># 7</span></span><br><span class="line"><span class="comment"># 8</span></span><br><span class="line"><span class="comment"># 9</span></span><br><span class="line"><span class="comment"># By</span></span><br><span class="line"><span class="comment"># tens</span></span><br><span class="line"><span class="comment"># to</span></span><br><span class="line"><span class="comment"># 100:</span></span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"><span class="comment"># 20</span></span><br><span class="line"><span class="comment"># 30</span></span><br><span class="line"><span class="comment"># 40</span></span><br><span class="line"><span class="comment"># 50</span></span><br><span class="line"><span class="comment"># 60</span></span><br><span class="line"><span class="comment"># 70</span></span><br><span class="line"><span class="comment"># 80</span></span><br><span class="line"><span class="comment"># 90</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-imap-function-iterable"><a href="#itertools-imap-function-iterable" class="headerlink" title="itertools.imap(function,*iterable)"></a><strong>itertools.imap(function,*iterable)</strong></h5><p>æœ¬å‡½æ•°åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œä½œç”¨å‡½æ•°ä¸ºfunction1ï¼Œfunction2ï¼Œfunction3â€¦ï¼Œå¯¹åº”çš„å˜é‡æ¥è‡ªè¿­ä»£å™¨iterable1ï¼Œiterable2ï¼Œiterable3â€¦ã€‚ç„¶åè¿”å›ä¸€ä¸ª(f1,f2,f3â€¦)å½¢å¼çš„å…ƒç»„ã€‚åªè¦å…¶ä¸­ä¸€ä¸ªè¿­ä»£å™¨ä¸å†ç”Ÿæˆå€¼ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šåœæ­¢ã€‚æ‰€ä»¥è¦å¤„ç†å¥½Noneçš„æƒ…å†µï¼Œç”¨ä¸€ä¸‹æ›¿ä»£è¾“å‡ºä¹‹ç±»çš„æ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="string">'Doubles:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.imap(<span class="keyword">lambda</span> x:<span class="number">2</span>*x, xrange(<span class="number">5</span>)):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Multiples:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.imap(<span class="keyword">lambda</span> x,y:(x, y, x*y), xrange(<span class="number">5</span>), xrange(<span class="number">5</span>,<span class="number">10</span>)):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'%d * %d = %d'</span> % i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># Doubles:</span></span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line"><span class="comment"># 8</span></span><br><span class="line"><span class="comment"># Multiples:</span></span><br><span class="line"><span class="comment"># 0 * 5 = 0</span></span><br><span class="line"><span class="comment"># 1 * 6 = 6</span></span><br><span class="line"><span class="comment"># 2 * 7 = 14</span></span><br><span class="line"><span class="comment"># 3 * 8 = 24</span></span><br><span class="line"><span class="comment"># 4 * 9 = 36</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-starmap-function-iterable"><a href="#itertools-starmap-function-iterable" class="headerlink" title="itertools.starmap(function,iterable)"></a><strong>itertools.starmap(function,iterable)</strong></h5><p>å‡½æ•°åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä¸­å†…è°ƒç”¨çš„function(*item)ï¼Œitemæ¥è‡ªäºiterableã€‚åªæœ‰å½“è¿­ä»£å¯¹è±¡iterableç”Ÿæˆçš„é¡¹é€‚åˆè¿™ä¸ªå‡½æ•°çš„è°ƒç”¨å½¢å¼çš„æ—¶å€™ï¼Œstarmapæ‰ä¼šæœ‰æ•ˆã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.starmap(<span class="keyword">lambda</span> x,y:(x, y, x*y), [(<span class="number">0</span>, <span class="number">5</span>), (<span class="number">1</span>, <span class="number">6</span>), (<span class="number">2</span>, <span class="number">7</span>), (<span class="number">3</span>, <span class="number">8</span>), (<span class="number">4</span>, <span class="number">9</span>)]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'%d * %d = %d'</span> % i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># 0 * 5 = 0</span></span><br><span class="line"><span class="comment"># 1 * 6 = 6</span></span><br><span class="line"><span class="comment"># 2 * 7 = 14</span></span><br><span class="line"><span class="comment"># 3 * 8 = 24</span></span><br><span class="line"><span class="comment"># 4 * 9 = 36</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-tee-iterable-n-2"><a href="#itertools-tee-iterable-n-2" class="headerlink" title="itertools.tee(iterable[,n=2])"></a><strong>itertools.tee(iterable[,n=2])</strong></h5><p>å‡½æ•°ä¼šè¿”å›è‹¥å¹²ä¸ªåŸºäºæŸä¸ªåŸå§‹è¾“å…¥çš„ç‹¬ç«‹è¿­ä»£å™¨ã€‚ç±»ä¼¼äºLinuxç³»ç»Ÿä¸Šçš„teeæŒ‡ä»¤ã€‚å¦‚æœä¸ç‰¹åœ°åˆ¶å®šnçš„è¯ï¼Œå‡½æ•°ä¼šé»˜è®¤æ˜¯2ã€‚teeæ‹¬å·é‡Œé¢æœ€å¥½ä½¿ç”¨æ ‡å‡†è¾“å…¥ï¼Œè€Œä¸æ˜¯åŸå§‹è¿­ä»£å™¨ã€‚ä¸ç„¶ä¼šåœ¨æŸäº›ç¼“å­˜è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">r = itertools.islice(itertools.count(), <span class="number">5</span>)</span><br><span class="line">i1, i2 = itertools.tee(r)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> i1:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'i1:'</span>, i</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> i2:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'i2:'</span>, i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># i1: 0</span></span><br><span class="line"><span class="comment"># i1: 1</span></span><br><span class="line"><span class="comment"># i1: 2</span></span><br><span class="line"><span class="comment"># i1: 3</span></span><br><span class="line"><span class="comment"># i1: 4</span></span><br><span class="line"><span class="comment"># i2: 0</span></span><br><span class="line"><span class="comment"># i2: 1</span></span><br><span class="line"><span class="comment"># i2: 2</span></span><br><span class="line"><span class="comment"># i2: 3</span></span><br><span class="line"><span class="comment"># i2: 4</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-takewhile-predicate-iterable"><a href="#itertools-takewhile-predicate-iterable" class="headerlink" title="itertools.takewhile(predicate,iterable)"></a><strong>itertools.takewhile(predicate,iterable)</strong></h5><p>å‡½æ•°å’Œdropwhileåˆšå¥½ç›¸åï¼Œåªè¦predicateè®¡ç®—åä¸ºFalseï¼Œè¿­ä»£è¿‡ç¨‹ç«‹åˆ»åœæ­¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">should_take</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="keyword">return</span> (x&lt;<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.takewhile(should_take, [ <span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">-2</span> ]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># Testing: -1</span></span><br><span class="line"><span class="comment"># Yielding: -1</span></span><br><span class="line"><span class="comment"># Testing: 0</span></span><br><span class="line"><span class="comment"># Yielding: 0</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Testing: 2</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-izip-iterables"><a href="#itertools-izip-iterables" class="headerlink" title="itertools.izip( *iterables)"></a><strong>itertools.izip( *iterables)</strong></h5><p>è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªåˆå¹¶å¤šä¸ªè¿­ä»£å™¨ï¼Œæˆä¸ºä¸€ä¸ªå…ƒç»„çš„è¿­ä»£å¯¹è±¡ã€‚ç±»ä¼¼äºå†…ç½®å‡½æ•°zipï¼Œä½†è¿”å›çš„æ˜¯è¿­ä»£å¯¹è±¡è€Œéåˆ—è¡¨ã€‚<br>åˆ›å»ºä¸€ä¸ªè¿­ä»£å¯¹è±¡ï¼Œç”Ÿæˆå…ƒç»„(i1,i2,i3â€¦)åˆ†åˆ«æ¥è‡ªäºi1,i2,i3â€¦ï¼Œåªè¦æä¾›çš„æŸä¸ªè¿­ä»£å™¨ä¸åœ¨ç”Ÿæˆå€¼ï¼Œå‡½æ•°å°±ä¼šç«‹åˆ»åœæ­¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.izip([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># (1, 'a')</span></span><br><span class="line"><span class="comment"># (2, 'b')</span></span><br><span class="line"><span class="comment"># (3, 'c')</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-izip-longest-iterable-fillvalue"><a href="#itertools-izip-longest-iterable-fillvalue" class="headerlink" title="itertools.izip_longest(*iterable[,fillvalue])"></a><strong>itertools.izip_longest(*iterable[,fillvalue])</strong></h5><p>å‡½æ•°å’Œizipé›·åŒï¼Œä½†æ˜¯åŒºåˆ«åœ¨äºä¸ä¼šåœæ­¢ï¼Œä¼šæŠŠæ‰€æœ‰è¾“å…¥çš„è¿­ä»£å¯¹è±¡å…¨éƒ¨è€—å°½ä¸ºæ­¢ï¼Œå¯¹äºå‚æ•°ä¸åŒ¹é…çš„é¡¹ï¼Œä¼šç”¨Noneä»£æ›¿ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.izip_longest([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="string">'a'</span>, <span class="string">'b'</span>]):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># (1, 'a')</span></span><br><span class="line"><span class="comment"># (2, 'b')</span></span><br><span class="line"><span class="comment"># (3, None)</span></span><br></pre></td></tr></table></figure>
<h4 id="ç»„åˆç”Ÿæˆå™¨"><a href="#ç»„åˆç”Ÿæˆå™¨" class="headerlink" title="ç»„åˆç”Ÿæˆå™¨"></a>ç»„åˆç”Ÿæˆå™¨</h4><h5 id="itertools-product-iterable-repeat"><a href="#itertools-product-iterable-repeat" class="headerlink" title="itertools.product(*iterable[,repeat])"></a><strong>itertools.product(*iterable[,repeat])</strong></h5><p>è¿™ä¸ªå·¥å…·å°±æ˜¯äº§ç”Ÿå¤šä¸ªåˆ—è¡¨æˆ–è€…è¿­ä»£å™¨çš„nç»´ç§¯ã€‚å¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡å®šrepeaté»˜è®¤ä¸ºåˆ—è¡¨å’Œè¿­ä»£å™¨çš„æ•°é‡ã€‚ï¼ˆç¬›å¡å°”ç§¯ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">b = (<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>)</span><br><span class="line">c = itertools.product(a,b)</span><br><span class="line"><span class="keyword">for</span> elem <span class="keyword">in</span> c:</span><br><span class="line">    <span class="keyword">print</span> elem</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># (1, 'A')</span></span><br><span class="line"><span class="comment"># (1, 'B')</span></span><br><span class="line"><span class="comment"># (1, 'C')</span></span><br><span class="line"><span class="comment"># (2, 'A')</span></span><br><span class="line"><span class="comment"># (2, 'B')</span></span><br><span class="line"><span class="comment"># (2, 'C')</span></span><br><span class="line"><span class="comment"># (3, 'A')</span></span><br><span class="line"><span class="comment"># (3, 'B')</span></span><br><span class="line"><span class="comment"># (3, 'C')</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-permutations-iterable-r"><a href="#itertools-permutations-iterable-r" class="headerlink" title="itertools.permutations(iterable[,r])"></a><strong>itertools.permutations(iterable[,r])</strong></h5><p>å‡½æ•°ä½œç”¨å…¶å®å°±æ˜¯äº§ç”ŸæŒ‡å®šæ•°ç›®repeatçš„å…ƒç´ çš„æ‰€æœ‰æ’åˆ—ï¼Œä¸”é¡ºåºæœ‰å…³ï¼Œä½†æ˜¯é‡åˆ°åŸåˆ—è¡¨æˆ–è€…è¿­ä»£å™¨æœ‰é‡å¤å…ƒç´ çš„ç°è±¡çš„æ—¶å€™ï¼Œä¹Ÿä¼šå¯¹åº”çš„äº§ç”Ÿé‡å¤é¡¹ã€‚è¿™ä¸ªæ—¶å€™æœ€å¥½ç”¨groupbyæˆ–è€…å…¶ä»–filterå»ä¸€ä¸‹é‡ï¼Œå¦‚æœæœ‰éœ€è¦çš„è¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = itertools.permutations(range(<span class="number">4</span>), <span class="number">3</span>)</span><br><span class="line">print(list(x))</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># [(0, 1, 2), </span></span><br><span class="line"><span class="comment"># (0, 1, 3), </span></span><br><span class="line"><span class="comment"># (0, 2, 1), </span></span><br><span class="line"><span class="comment"># (0, 2, 3), </span></span><br><span class="line"><span class="comment"># (0, 3, 1), </span></span><br><span class="line"><span class="comment"># (0, 3, 2), </span></span><br><span class="line"><span class="comment"># (1, 0, 2), </span></span><br><span class="line"><span class="comment"># (1, 0, 3), </span></span><br><span class="line"><span class="comment"># (1, 2, 0), </span></span><br><span class="line"><span class="comment"># (1, 2, 3), </span></span><br><span class="line"><span class="comment"># (1, 3, 0), </span></span><br><span class="line"><span class="comment"># (1, 3, 2), </span></span><br><span class="line"><span class="comment"># (2, 0, 1), </span></span><br><span class="line"><span class="comment"># (2, 0, 3), </span></span><br><span class="line"><span class="comment"># (2, 1, 0), </span></span><br><span class="line"><span class="comment"># (2, 1, 3), </span></span><br><span class="line"><span class="comment"># (2, 3, 0), </span></span><br><span class="line"><span class="comment"># (2, 3, 1), </span></span><br><span class="line"><span class="comment"># (3, 0, 1),</span></span><br><span class="line"><span class="comment"># (3, 0, 2), </span></span><br><span class="line"><span class="comment"># (3, 1, 0), </span></span><br><span class="line"><span class="comment"># (3, 1, 2), </span></span><br><span class="line"><span class="comment"># (3, 2, 0), </span></span><br><span class="line"><span class="comment"># (3, 2, 1)</span></span><br><span class="line"><span class="comment"># ]</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-combinations-iterable-r"><a href="#itertools-combinations-iterable-r" class="headerlink" title="itertools.combinations(iterable,r)"></a><strong>itertools.combinations(iterable,r)</strong></h5><p>è¿™ä¸ªå‡½æ•°ç”¨æ¥ç”ŸæˆæŒ‡å®šæ•°ç›®rçš„å…ƒç´ ä¸é‡å¤çš„æ‰€æœ‰ç»„åˆã€‚æ³¨æ„å’Œpermutationçš„åŒºåˆ†ï¼Œä»¥åŠè¿™ä¸ªç»„åˆæ˜¯æ— åºçš„ï¼Œåªè€ƒè™‘å…ƒç´ æœ¬èº«çš„uniqueæ€§ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = itertools.combinations(range(<span class="number">4</span>), <span class="number">3</span>)</span><br><span class="line">print(list(x))</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># [(0, 1, 2), (0, 1, 3), (0, 2, 3), (1, 2, 3)]</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-combinations-with-replacement-iterable-r"><a href="#itertools-combinations-with-replacement-iterable-r" class="headerlink" title="itertools.combinations_with_replacement(iterable,r)"></a><strong>itertools.combinations_with_replacement(iterable,r)</strong></h5><p>è¿™ä¸ªå‡½æ•°ç”¨æ¥ç”ŸæˆæŒ‡å®šæ•°ç›®rçš„å…ƒç´ å¯é‡å¤çš„æ‰€æœ‰ç»„åˆã€‚ç„¶è€Œè¿™ä¸ªå‡½æ•°ä¾ç„¶è¦ä¿è¯å…ƒç´ ç»„åˆçš„uniqueæ€§ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = itertools.combinations_with_replacement(<span class="string">'ABC'</span>, <span class="number">2</span>)</span><br><span class="line">print(list(x))</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># [('A', 'A'), </span></span><br><span class="line"><span class="comment"># ('A', 'B'), </span></span><br><span class="line"><span class="comment"># ('A', 'C'), </span></span><br><span class="line"><span class="comment"># ('B', 'B'), </span></span><br><span class="line"><span class="comment"># ('B', 'C'), </span></span><br><span class="line"><span class="comment"># ('C', 'Câ€™)</span></span><br><span class="line"><span class="comment"># ]</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>python</category>
      </categories>
  </entry>
  <entry>
    <title>Vimé€ŸæŸ¥</title>
    <url>/2018/05/29/Vim%E9%80%9F%E6%9F%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="vimï¼ˆVisual-Interfaceï¼‰"><a href="#vimï¼ˆVisual-Interfaceï¼‰" class="headerlink" title="vimï¼ˆVisual Interfaceï¼‰"></a>vimï¼ˆVisual Interfaceï¼‰</h2><p><img src="/2018/05/29/Vim%E9%80%9F%E6%9F%A5/NSFileHandle.png" alt="avatar"></p>
<a id="more"></a>
<h3 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h3><ol>
<li>hï¼šå·¦ç§»</li>
<li>jï¼šä¸‹ç§»</li>
<li>kï¼šä¸Šç§»</li>
<li>l(L)ï¼šå³ç§»</li>
<li><code>^</code> æˆ– <code>0</code>ï¼šå…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„è¡Œé¦–ã€‚</li>
<li><code>1$</code>ï¼šå…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„è¡Œæœ«ï¼Œ<code>2$</code>:å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œçš„è¡Œæœ«,â€¦ã€‚</li>
<li>Mï¼šå…‰æ ‡ç§»åŠ¨åˆ°ä¸­é—´è¡Œ</li>
<li>Lï¼šå…‰æ ‡ç§»åŠ¨åˆ°å±å¹•æœ€åä¸€è¡Œè¡Œé¦–</li>
<li>Gï¼šç§»åŠ¨åˆ°æŒ‡å®šè¡Œï¼Œè¡Œå· -Gï¼Œåªæœ‰Gçš„è¯ï¼Œåˆ°æ–‡ä»¶æœ€æœ«å°¾</li>
<li>ggï¼šæ–‡ä»¶ç¬¬ä¸€ä¸ªå­—ç¬¦</li>
<li>w:å‘åä¸€æ¬¡ç§»åŠ¨ä¸€ä¸ªå­—</li>
<li>bï¼šå‘å‰ä¸€æ¬¡ç§»åŠ¨ä¸€ä¸ªå­—</li>
<li>{ï¼šæŒ‰æ®µç§»åŠ¨ï¼Œä¸Šç§»</li>
<li>}ï¼šæŒ‰æ®µä¸‹ç§»ï¼Œä¸‹ç§»</li>
<li>ctrl+dï¼šå‘ä¸‹ç¿»åŠå±</li>
<li>ctrl+uï¼šå‘ä¸Šç¿»åŠå±</li>
<li>ctrl+fï¼šå‘ä¸‹ç¿»ä¸€å±</li>
<li>ctrl+bï¼šå‘ä¸Šç¿»ä¸€å±</li>
</ol>
<h4 id="å¯è§†æ¨¡å¼"><a href="#å¯è§†æ¨¡å¼" class="headerlink" title="å¯è§†æ¨¡å¼"></a>å¯è§†æ¨¡å¼</h4><ol>
<li>v:æŒ‰å­—ç¬¦ç§»åŠ¨ï¼Œç»“åˆh,j,k,lé€‰ä¸­æ–‡æœ¬å†…å®¹ã€‚</li>
<li>Vï¼šæŒ‰è¡Œç§»åŠ¨ï¼Œé€‰ä¸­æ–‡æœ¬å¯è§†æ¨¡å¼ï¼Œå¯ä»¥é…åˆdï¼Œyï¼Œ&gt;&gt;,&lt;&lt;å®ç°å¯¹æ–‡æœ¬å—çš„åˆ é™¤ï¼Œå¤åˆ¶ï¼Œå·¦å³ç§»åŠ¨ã€‚</li>
</ol>
<h4 id="åˆ é™¤å‘½ä»¤"><a href="#åˆ é™¤å‘½ä»¤" class="headerlink" title="åˆ é™¤å‘½ä»¤"></a>åˆ é™¤å‘½ä»¤</h4><ol>
<li>xï¼šåˆ é™¤å…‰æ ‡åä¸€ä¸ªå­—ç¬¦ï¼Œn x åˆ é™¤å…‰æ ‡åçš„nä¸ªå­—ç¬¦</li>
<li>Xï¼šåˆ é™¤å…‰æ ‡å‰ä¸€ä¸ªå­—ç¬¦ï¼Œç›¸å½“äºBackspace</li>
<li>ddï¼šåˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œï¼Œn ddåˆ é™¤æŒ‡å®šçš„nè¡Œ</li>
<li>Dï¼šåˆ é™¤å…‰æ ‡åæœ¬è¡Œæ‰€æœ‰å†…å®¹ï¼ŒåŒ…å«å…‰æ ‡æ‰€åœ¨å­—ç¬¦</li>
<li>d0ï¼šåˆ é™¤å…‰æ ‡å‰æœ¬è¡Œæ‰€æœ‰å†…å®¹ï¼Œä¸åŒ…å«å…‰æ ‡æ‰€åœ¨å­—ç¬¦</li>
<li>dwï¼šåˆ é™¤å…‰æ ‡å¼€å§‹ä½ç½®çš„å­—ï¼ŒåŒ…å«å…‰æ ‡æ‰€åœ¨å­—ç¬¦</li>
</ol>
<h4 id="æ’¤é”€å‘½ä»¤"><a href="#æ’¤é”€å‘½ä»¤" class="headerlink" title="æ’¤é”€å‘½ä»¤"></a>æ’¤é”€å‘½ä»¤</h4><ol>
<li>uï¼šä¸€æ­¥ä¸€æ­¥æ’¤é”€</li>
<li>ctrl+rï¼šåæ’¤é”€</li>
</ol>
<h4 id="é‡å¤å‘½ä»¤"><a href="#é‡å¤å‘½ä»¤" class="headerlink" title="é‡å¤å‘½ä»¤"></a>é‡å¤å‘½ä»¤</h4><ol>
<li>. ï¼šé‡å¤ä¸Šä¸€æ¬¡æ“ä½œçš„å‘½ä»¤</li>
</ol>
<h4 id="æ–‡æœ¬ç§»åŠ¨"><a href="#æ–‡æœ¬ç§»åŠ¨" class="headerlink" title="æ–‡æœ¬ç§»åŠ¨"></a>æ–‡æœ¬ç§»åŠ¨</h4><ol>
<li>>&gt;:æ–‡æœ¬è¡Œå³ç§»</li>
<li>\&lt;&lt;:æ–‡æœ¬è¡Œå·¦ç§»</li>
</ol>
<h4 id="å¤åˆ¶ç²˜è´´"><a href="#å¤åˆ¶ç²˜è´´" class="headerlink" title="å¤åˆ¶ç²˜è´´"></a>å¤åˆ¶ç²˜è´´</h4><ol>
<li>yyï¼šå¤åˆ¶å½“å‰è¡Œï¼Œn yyå¤åˆ¶nè¡Œ</li>
<li>åœ¨æœ«è¡Œæ¨¡å¼ï¼Œè¾“å…¥ï¼ša,by å¤åˆ¶ä»ç¬¬aè¡Œå¼€å§‹ï¼Œåˆ°ç¬¬bè¡Œç»“æŸçš„å†…å®¹</li>
<li>pï¼šåœ¨å…‰æ ‡ååœ¨ä½ç½®å‘ä¸‹æ–°å¼€è¾Ÿä¸€è¡Œï¼Œç²˜è´´</li>
<li>dï¼šå‰ªåˆ‡é€‰ä¸­å†…å®¹</li>
</ol>
<h4 id="æŸ¥æ‰¾å‘½ä»¤"><a href="#æŸ¥æ‰¾å‘½ä»¤" class="headerlink" title="æŸ¥æ‰¾å‘½ä»¤"></a>æŸ¥æ‰¾å‘½ä»¤</h4><ol>
<li>/str : æŸ¥æ‰¾strï¼Œä»å…‰æ ‡æ‰€åœ¨è¡Œå¾€ä¸‹æŸ¥æ‰¾</li>
<li>ï¼Ÿstrï¼šæŸ¥æ‰¾strï¼Œä»å…‰æ ‡æ‰€åœ¨è¡Œå¾€ä¸ŠæŸ¥æ‰¾</li>
<li>nï¼šæŸ¥æ‰¾ä¸‹ä¸€ä¸ª</li>
<li>Nï¼šæŸ¥æ‰¾ä¸Šä¸€ä¸ª </li>
</ol>
<h4 id="æ›¿æ¢æ“ä½œ"><a href="#æ›¿æ¢æ“ä½œ" class="headerlink" title="æ›¿æ¢æ“ä½œ"></a>æ›¿æ¢æ“ä½œ</h4><ol>
<li>rï¼šæ›¿æ¢å½“å‰å­—ç¬¦</li>
<li>Ræ›¿æ¢å½“å‰è¡Œå…‰æ ‡åçš„å­—ç¬¦</li>
</ol>
<h4 id="æ›¿æ¢å‘½ä»¤"><a href="#æ›¿æ¢å‘½ä»¤" class="headerlink" title="æ›¿æ¢å‘½ä»¤"></a>æ›¿æ¢å‘½ä»¤</h4><ol>
<li>æœ«è¡Œæ¨¡å¼ä¸‹ï¼Œå°†å…‰æ ‡æ‰€åœ¨è¡Œçš„abcæ›¿æ¢æˆ123ï¼Œï¼šs/abc/123/g</li>
<li>æœ«è¡Œæ¨¡å¼ä¸‹ï¼Œå°†ç¬¬ä¸€è¡Œåˆ°ç¬¬10è¡Œä¹‹é—´çš„abcæ›¿æ¢æˆ123ï¼Œ:1,10s/abc/123/g</li>
<li>æœ«è¡Œæ¨¡å¼ä¸‹ï¼ŒæŠŠæ–‡ä»¶ä¸­çš„abcå…¨éƒ¨æ›¿æ¢æˆ123ï¼Œ:%s/abc/123</li>
</ol>
<h3 id="è¾“å…¥æ¨¡å¼"><a href="#è¾“å…¥æ¨¡å¼" class="headerlink" title="è¾“å…¥æ¨¡å¼"></a>è¾“å…¥æ¨¡å¼</h3><ol>
<li>iï¼šæ’å…¥å…‰æ ‡å‰ä¸€ä¸ªå­—ç¬¦</li>
<li>Iï¼šæ’å…¥è¡Œé¦–</li>
<li>aï¼šæ’å…¥å…‰æ ‡åä¸€ä¸ªå­—ç¬¦</li>
<li>A: æ’å…¥è¡Œæœ«</li>
<li>oï¼šå‘ä¸‹æ–°å¼€ä¸€è¡Œï¼Œæ’å…¥è¡Œé¦–</li>
<li><p>Oï¼šå‘ä¸Šæ–°å¼€ä¸€è¡Œï¼Œæ’å…¥è¡Œé¦–</p>
<h3 id="æœ«è¡Œæ¨¡å¼"><a href="#æœ«è¡Œæ¨¡å¼" class="headerlink" title="æœ«è¡Œæ¨¡å¼"></a>æœ«è¡Œæ¨¡å¼</h3></li>
<li><p>ï¼šset nu æ˜¾ç¤ºè¡Œå·</p>
</li>
<li>! shellå‘½ä»¤</li>
<li>wqï¼šä¿å­˜é€€å‡º</li>
<li>ZZï¼š ä¿å­˜é€€å‡º</li>
<li>qï¼ï¼šä¸ä¿å­˜é€€å‡º</li>
</ol>
<h3 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h3><p>ä¿®æ”¹ç”¨æˆ·ç›®å½•ä¸‹çš„vimrcï¼ˆ~/.vimrcï¼‰æ–‡ä»¶ï¼Œä¿®æ”¹vimé…ç½®</p>
<ol>
<li>set nu :è®¾ç½®æ¯æ¬¡vim æ‰“å¼€æ–‡ä»¶æ˜¾ç¤ºè¡Œå·ã€‚</li>
<li>set ts=4:è®¾ç½®tabé”®æ¯æ¬¡4ä¸ªç©ºæ ¼</li>
</ol>
]]></content>
      <categories>
        <category>soft skill</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Vim</tag>
        <tag>é€ŸæŸ¥</tag>
      </tags>
  </entry>
  <entry>
    <title>latexå…¬å¼é€ŸæŸ¥</title>
    <url>/2018/05/10/latex%E5%85%AC%E5%BC%8F%E9%80%9F%E6%9F%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ä¸Šä¸‹æ ‡"><a href="#ä¸Šä¸‹æ ‡" class="headerlink" title="ä¸Šä¸‹æ ‡"></a>ä¸Šä¸‹æ ‡</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>x_{2}</td>
<td>$x_{2}$</td>
</tr>
<tr>
<td>x^2</td>
<td>$x^{2}$</td>
</tr>
</tbody>
</table>
</div>
<a id="more"></a>
<h3 id="å…¬å¼åºå·"><a href="#å…¬å¼åºå·" class="headerlink" title="å…¬å¼åºå·"></a>å…¬å¼åºå·</h3><script type="math/tex; mode=display">
y = wx+b \tag{1.1}</script><h3 id="æ‹¬å·"><a href="#æ‹¬å·" class="headerlink" title="æ‹¬å·"></a>æ‹¬å·</h3><ol>
<li><p>() [] ç›´æ¥å†™å°±è¡Œï¼Œè€Œ {} åˆ™éœ€è¦è½¬ä¹‰</p>
<ol>
<li>y \in \{3, 4, 5\} : $y \in \{3, 4, 5\}$</li>
</ol>
</li>
<li><p>æœ‰æ—¶å€™æ‹¬å·éœ€è¦å¤§å·çš„ï¼Œæ­¤æ—¶éœ€è¦ä½¿ç”¨\leftå’Œ\rightåŠ å¤§æ‹¬å·çš„å¤§å°ã€‚</p>
<ol>
<li>\left(\frac {x} {y} \right)^2 : $\left(\frac {x} {y} \right)^2$</li>
</ol>
</li>
<li><p>\left å’Œ \rightå¿…é¡»æˆå¯¹å‡ºç°ï¼Œå¯¹äºä¸æ˜¾ç¤ºçš„ä¸€è¾¹å¯ä»¥ä½¿ç”¨ . ä»£æ›¿</p>
</li>
<li><p>\left. \frac{du}{dx} \right| _{x=0} : $\left. \frac{du}{dx} \right| _{x=0}$</p>
</li>
<li><p>åŒæ‹¬å·$\left|g_{k}\right|$</p>
</li>
<li><p>å·¦å¤§æ‹¬å·ï¼š</p>
<p> <code>\left\{\begin{array}{ll}
 x=\frac{3 \pi}{2}(1+2 t) \cos \left(\frac{3 \pi}{2}(1+2 t)\right) &amp; \\
 y=s, &amp; 0 \leq s \leq L,|t| \leq 1 \\
 z=\frac{3 \pi}{2}(1+2 t) \sin \left(\frac{3 \pi}{2}(1+2 t)\right)
 \end{array}\right.</code></p>
<script type="math/tex; mode=display">
 \left\{\begin{array}{ll}
 x=\frac{3 \pi}{2}(1+2 t) \cos \left(\frac{3 \pi}{2}(1+2 t)\right) & \\
 y=s, & 0 \leq s \leq L,|t| \leq 1 \\
 z=\frac{3 \pi}{2}(1+2 t) \sin \left(\frac{3 \pi}{2}(1+2 t)\right)
 \end{array}\right.</script></li>
</ol>
<h3 id="åˆ†æ•°"><a href="#åˆ†æ•°" class="headerlink" title="åˆ†æ•°"></a>åˆ†æ•°</h3><p>ä¸¤ç§å†™æ³•ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">å‘½ä»¤</th>
<th style="text-align:center">æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">\frac{1}{2x+1}</td>
<td style="text-align:center">$\frac{1}{2x+1}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="å¼€æ–¹"><a href="#å¼€æ–¹" class="headerlink" title="å¼€æ–¹"></a>å¼€æ–¹</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\sqrt[n]{a}</td>
<td>$\sqrt[n]{a}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="å¯¹æ•°"><a href="#å¯¹æ•°" class="headerlink" title="å¯¹æ•°"></a>å¯¹æ•°</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\log</td>
<td>$\log$</td>
</tr>
<tr>
<td>\lg</td>
<td>$\lg$</td>
</tr>
<tr>
<td>\ln</td>
<td>$\ln$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="å‘é‡"><a href="#å‘é‡" class="headerlink" title="å‘é‡"></a>å‘é‡</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\vec{a}</td>
<td>$\vec{a}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="ä¸‰è§’è¿ç®—"><a href="#ä¸‰è§’è¿ç®—" class="headerlink" title="ä¸‰è§’è¿ç®—"></a>ä¸‰è§’è¿ç®—</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\bot</td>
<td>$\bot$</td>
<td></td>
<td>\angle</td>
<td>$\angle$</td>
</tr>
<tr>
<td>\sin</td>
<td>$\sin$</td>
<td></td>
<td>\cos</td>
<td>$\cos$</td>
</tr>
<tr>
<td>\tan</td>
<td>$\tan$</td>
<td></td>
<td>\cot</td>
<td>$\cot$</td>
</tr>
<tr>
<td>\sec</td>
<td>$\sec$</td>
<td></td>
<td>\csc</td>
<td>$\csc$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="çœç•¥å·"><a href="#çœç•¥å·" class="headerlink" title="çœç•¥å·"></a>çœç•¥å·</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\ldots</td>
<td>$\ldots$</td>
</tr>
<tr>
<td>\cdots</td>
<td>$\cdots$</td>
</tr>
<tr>
<td>\cdot</td>
<td>$\cdot$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="éœ€è¦è½¬ä¹‰çš„å­—ç¬¦"><a href="#éœ€è¦è½¬ä¹‰çš„å­—ç¬¦" class="headerlink" title="éœ€è¦è½¬ä¹‰çš„å­—ç¬¦"></a>éœ€è¦è½¬ä¹‰çš„å­—ç¬¦</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\#</td>
<td>$#$</td>
<td></td>
<td>\_</td>
<td>$_$</td>
</tr>
<tr>
<td>\$</td>
<td>$$$</td>
<td></td>
<td>\\%</td>
<td>$\%$</td>
</tr>
<tr>
<td>\\&amp;</td>
<td>$\&amp;$</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>\\{</td>
<td>$\{$</td>
<td></td>
<td>\\}</td>
<td>$\}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="æ™®é€šç¬¦å·"><a href="#æ™®é€šç¬¦å·" class="headerlink" title="æ™®é€šç¬¦å·"></a>æ™®é€šç¬¦å·</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\pm</td>
<td>$\pm$</td>
<td></td>
<td>\times</td>
<td>$\times$</td>
</tr>
<tr>
<td>\div</td>
<td>$\div$</td>
<td></td>
<td>\mid</td>
<td>$\mid$</td>
</tr>
<tr>
<td>\cdot</td>
<td>$\cdot$</td>
<td></td>
<td>\circ</td>
<td>$\circ$</td>
</tr>
<tr>
<td>\ast</td>
<td>$\ast$</td>
<td></td>
<td>\bigodot</td>
<td>$\bigodot$</td>
</tr>
<tr>
<td>\bigotimes</td>
<td>$\bigotimes$</td>
<td></td>
<td>\equiv</td>
<td>$\equiv$</td>
</tr>
<tr>
<td>\leq or \le</td>
<td>$\leq$</td>
<td></td>
<td>\geq or \ge</td>
<td>$\geq$</td>
</tr>
<tr>
<td>\ll</td>
<td>$\ll$</td>
<td></td>
<td>\gg</td>
<td>$\gg$</td>
</tr>
<tr>
<td>\neq or  \ne</td>
<td>$\neq$</td>
<td></td>
<td>\approx</td>
<td>$\approx$</td>
</tr>
<tr>
<td>\succeq</td>
<td>$\succeq$</td>
<td></td>
<td>\preceq</td>
<td>$\preceq$</td>
</tr>
<tr>
<td>\doteq</td>
<td>$\doteq$</td>
<td></td>
<td>\cong</td>
<td>$\cong$</td>
</tr>
<tr>
<td>\sim</td>
<td>$\sim$</td>
<td></td>
<td>\simeq</td>
<td>$\simeq$</td>
</tr>
<tr>
<td>\vdash</td>
<td>$\vdash$</td>
<td></td>
<td>\dashv</td>
<td>$\dashv$</td>
</tr>
<tr>
<td>\models</td>
<td>$\models$</td>
<td></td>
<td>\perp</td>
<td>$\perp$</td>
</tr>
<tr>
<td>\smile</td>
<td>$\smile$</td>
<td></td>
<td>\frown</td>
<td>$\frown$</td>
</tr>
<tr>
<td>\saymp</td>
<td>$\asymp$</td>
<td></td>
<td>\:</td>
<td>$\:$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="å¸Œè…Šå­—æ¯"><a href="#å¸Œè…Šå­—æ¯" class="headerlink" title="å¸Œè…Šå­—æ¯"></a>å¸Œè…Šå­—æ¯</h3><p>å¤§å†™ï¼šå¼€å¤´å­—æ¯å¤§å†™<br>æ–œä½“ï¼šå‘½ä»¤å‰é¢åŠ var</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th>å¤§å†™</th>
<th>æ–œä½“</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th>å¤§å†™</th>
<th>æ–œä½“</th>
</tr>
</thead>
<tbody>
<tr>
<td>\alpha</td>
<td>$\alpha$</td>
<td>A</td>
<td></td>
<td></td>
<td>\beta</td>
<td>$\beta$</td>
<td>B</td>
<td></td>
</tr>
<tr>
<td>\gamma</td>
<td>$\gamma$</td>
<td>$\Gamma$</td>
<td>$\varGamma$</td>
<td></td>
<td>\delta</td>
<td>$\delta$</td>
<td>$\Delta$</td>
<td>$\varDelta$</td>
</tr>
<tr>
<td>\epsilon</td>
<td>$\epsilon$</td>
<td>E</td>
<td>$\varepsilon$</td>
<td></td>
<td>\zeta</td>
<td>$\zeta$</td>
<td>Z</td>
<td></td>
</tr>
<tr>
<td>\eta</td>
<td>$\eta$</td>
<td>H</td>
<td></td>
<td></td>
<td>\theta</td>
<td>$\theta$</td>
<td>$\Theta$</td>
<td>$\varTheta$</td>
</tr>
<tr>
<td>\iota</td>
<td>$\iota$</td>
<td>I</td>
<td></td>
<td></td>
<td>\kappa</td>
<td>$\kappa$</td>
<td>K</td>
<td></td>
</tr>
<tr>
<td>\lambda</td>
<td>$\lambda$</td>
<td>$\Lambda$</td>
<td>$\varLambda$</td>
<td></td>
<td>\mu</td>
<td>$\mu$</td>
<td>M</td>
<td></td>
</tr>
<tr>
<td>\xi</td>
<td>$\xi$</td>
<td>$\Xi$</td>
<td>$\varXi$</td>
<td></td>
<td>\nu</td>
<td>$\nu$</td>
<td>N</td>
<td></td>
</tr>
<tr>
<td>\pi</td>
<td>$\pi$</td>
<td>$\Pi$</td>
<td>$\varPi$</td>
<td></td>
<td>\rho</td>
<td>$\rho$</td>
<td>P</td>
<td>$\varrho$</td>
</tr>
<tr>
<td>\sigma</td>
<td>$\sigma$</td>
<td>$\Sigma$</td>
<td>$\varSigma$</td>
<td></td>
<td>\tau</td>
<td>$\tau$</td>
<td>T</td>
<td></td>
</tr>
<tr>
<td>\upsilon</td>
<td>$\upsilon$</td>
<td>$\Upsilon$</td>
<td>$\varUpsilon$</td>
<td></td>
<td>\phi</td>
<td>$\phi$</td>
<td>$\Phi$</td>
<td>$\varPhi$</td>
</tr>
<tr>
<td>\chi</td>
<td>$\chi$</td>
<td>X</td>
<td></td>
<td></td>
<td>\psi</td>
<td>$\psi$</td>
<td>$\Psi$</td>
<td>$\varPsi$</td>
</tr>
<tr>
<td>\omega</td>
<td>$\omega$</td>
<td>$\Omega$</td>
<td>$\varOmega$</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p><img src="/2018/05/10/latex%E5%85%AC%E5%BC%8F%E9%80%9F%E6%9F%A5/NSFileHandle.png" alt="5f979c551b937e468a1ed99ff62134d4"></p>
<h3 id="é›†åˆè¿ç®—"><a href="#é›†åˆè¿ç®—" class="headerlink" title="é›†åˆè¿ç®—"></a>é›†åˆè¿ç®—</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\emptyset</td>
<td>$\emptyset$</td>
<td></td>
<td>\propto</td>
<td>$\propto$</td>
</tr>
<tr>
<td>\notin</td>
<td>$\notin$</td>
<td></td>
<td>\Join or \bowtie</td>
<td>$\Join$</td>
</tr>
<tr>
<td>\supset</td>
<td>$\supset$</td>
<td></td>
<td>\subseteq</td>
<td>$\subseteq$</td>
</tr>
<tr>
<td>\subset</td>
<td>$\subset$</td>
<td></td>
<td>\supseteq</td>
<td>$\supseteq$</td>
</tr>
<tr>
<td>\sqsubset</td>
<td>$\sqsubset$</td>
<td></td>
<td>\sqsupseteq</td>
<td>$\sqsupseteq$</td>
</tr>
<tr>
<td>\bigcap</td>
<td>$\bigcap$</td>
<td></td>
<td>\bigcup</td>
<td>$\bigcup$</td>
</tr>
<tr>
<td>\bigvee</td>
<td>$\bigvee$</td>
<td></td>
<td>\bigwedge</td>
<td>$\bigwedge$</td>
</tr>
<tr>
<td>\biguplus</td>
<td>$\biguplus$</td>
<td></td>
<td>\bigsqcup</td>
<td>$\bigsqcup$</td>
</tr>
<tr>
<td>\in</td>
<td>$\in$</td>
<td></td>
<td>\ni or \owns</td>
<td>$\owns$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="é€»è¾‘è¿ç®—"><a href="#é€»è¾‘è¿ç®—" class="headerlink" title="é€»è¾‘è¿ç®—"></a>é€»è¾‘è¿ç®—</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\because</td>
<td>$\because$</td>
<td></td>
<td>\therefore</td>
<td>$\therefore$</td>
</tr>
<tr>
<td>\forall</td>
<td>$\forall$</td>
<td></td>
<td>\exists</td>
<td>$\exists$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="å¾®åˆ†"><a href="#å¾®åˆ†" class="headerlink" title="å¾®åˆ†"></a>å¾®åˆ†</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>y{\prime}x</td>
<td>$y{\prime}x$</td>
<td></td>
<td>\int</td>
<td>$\int$</td>
</tr>
<tr>
<td>\iint</td>
<td>$\iint$</td>
<td></td>
<td>\iiint</td>
<td>$\iiint$</td>
</tr>
<tr>
<td>\oint</td>
<td>$oint$</td>
<td></td>
<td>\lim</td>
<td>$lim$</td>
</tr>
<tr>
<td>\infty</td>
<td>$\infty$</td>
<td></td>
<td>\nabla</td>
<td>$\nabla$</td>
</tr>
<tr>
<td>\partial</td>
<td>$\partial$</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h3 id="ç®­å¤´"><a href="#ç®­å¤´" class="headerlink" title="ç®­å¤´"></a>ç®­å¤´</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\uparrow</td>
<td>$\uparrow$</td>
<td></td>
<td>\downarrow</td>
<td>$\downarrow$</td>
</tr>
<tr>
<td>\Uparrow</td>
<td>$\Uparrow$</td>
<td></td>
<td>\Downarrow</td>
<td>$\Downarrow$</td>
</tr>
<tr>
<td>\leftarrow</td>
<td>$\leftarrow$</td>
<td></td>
<td>\rightarrow</td>
<td>$\rightarrow$</td>
</tr>
<tr>
<td>\Leftarrow</td>
<td>$\Leftarrow$</td>
<td></td>
<td>\Rightarrow</td>
<td>$\Rightarrow$</td>
</tr>
<tr>
<td>\longleftarrow</td>
<td>$\longleftarrow$</td>
<td></td>
<td>\longrightarrow</td>
<td>$\longrightarrow$</td>
</tr>
<tr>
<td>\Longrightarrow</td>
<td>$\Longrightarrow$</td>
<td></td>
<td>\Longrightarrow</td>
<td>$\Longrightarrow$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="æ±‚å’Œã€è¿ä¹˜å’Œç§¯åˆ†å·"><a href="#æ±‚å’Œã€è¿ä¹˜å’Œç§¯åˆ†å·" class="headerlink" title="æ±‚å’Œã€è¿ä¹˜å’Œç§¯åˆ†å·"></a>æ±‚å’Œã€è¿ä¹˜å’Œç§¯åˆ†å·</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th>ä½¿ç”¨</th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody>
<tr>
<td>\sum</td>
<td>$\sum$</td>
<td>\sum_{i=1}^{N}</td>
<td>$\sum_{i=1}^{N}$</td>
</tr>
<tr>
<td>\prod</td>
<td>$\prod$</td>
<td>\prod_{i=1}^{N}</td>
<td>$\prod_{i=1}^{N}$</td>
</tr>
<tr>
<td>\coprod</td>
<td>$\coprod$</td>
<td>\coprod_{i=1}^{N}</td>
<td>$\coprod_{i=1}^{N}$</td>
</tr>
<tr>
<td>\int</td>
<td>$\int$</td>
<td>\int_{a}^{b}</td>
<td>$\int_{a}^{b}$</td>
</tr>
<tr>
<td>\iint</td>
<td>$\iint$</td>
<td>\iint_{a}^{b}</td>
<td>$\iint_{a}^{b}$</td>
</tr>
<tr>
<td>\bigcup</td>
<td>$\bigcup$</td>
<td>\bigcup_{i=1}^{N}</td>
<td>$\bigcup_{i=1}^{N}$</td>
</tr>
<tr>
<td>\bigcap</td>
<td>$\bigcap$</td>
<td>\bigcap_{i=1}^{N}</td>
<td>$\bigcap_{i=1}^{N}$</td>
</tr>
<tr>
<td>\lim_{n\rightarrow+\infty}</td>
<td>$lim_{n\rightarrow+\infty}$</td>
<td>\lim_{n\rightarrow+\infty}\frac{1}{n(n+1)}</td>
<td>$\lim_{n\rightarrow+\infty}\frac{1}{n(n+1)}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="æ•°å­—æ¨¡å¼é‡éŸ³ç¬¦"><a href="#æ•°å­—æ¨¡å¼é‡éŸ³ç¬¦" class="headerlink" title="æ•°å­—æ¨¡å¼é‡éŸ³ç¬¦"></a>æ•°å­—æ¨¡å¼é‡éŸ³ç¬¦</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\hat{a}</td>
<td>$\hat{a}$</td>
<td></td>
<td>\dot{a}</td>
<td>$\dot{a}$</td>
</tr>
<tr>
<td>\grave{a}</td>
<td>$\grave{a}$</td>
<td></td>
<td>\acute{a}</td>
<td>$\acute{a}$</td>
</tr>
<tr>
<td>\bar{a}</td>
<td>$\bar{a}$</td>
<td></td>
<td>\tilde{a}</td>
<td>$\tilde{a}$</td>
</tr>
<tr>
<td>\check{a}</td>
<td>$\check{a}$</td>
<td></td>
<td>\ddot{a}</td>
<td>$\ddot{a}$</td>
</tr>
<tr>
<td>\widehat{A}</td>
<td>$\widehat{A}$</td>
<td></td>
<td>\widetilde{A}</td>
<td>$\widetilde{A}$</td>
</tr>
<tr>
<td>\vec{a}</td>
<td>$\vec{a}$</td>
<td></td>
<td>\breve{a}</td>
<td>$\breve{a}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="è¿çº¿ç¬¦å·"><a href="#è¿çº¿ç¬¦å·" class="headerlink" title="è¿çº¿ç¬¦å·"></a>è¿çº¿ç¬¦å·</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\overline{a+b+c+d}</td>
<td>$\overline{a+b+c+d}$</td>
</tr>
<tr>
<td>\underline{a+b+c+d}</td>
<td>$\underline{a+b+c+d}$</td>
</tr>
<tr>
<td>\overbrace{a+\underbrace{b+c}_{1.0}+d}^{2.0}</td>
<td>$\overbrace{a+\underbrace{b+c}_{1.0}+d}^{2.0}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="çŸ©é˜µ"><a href="#çŸ©é˜µ" class="headerlink" title="çŸ©é˜µ"></a>çŸ©é˜µ</h3><p>å‘½ä»¤</p>
<p>\left|\begin{array}{cccc}<br>     1 &amp; 6 &amp; 9 \\\<br>     7 &amp; 9 &amp; 0 \\\<br>     9 &amp; 5 &amp; 0<br>\end{array}\right|</p>
<p>æ˜¾ç¤ºï¼š</p>
<script type="math/tex; mode=display">
\left|\begin{array}{cccc}
     1 & 6 & 9 \\ 
     7 & 9 & 0 \\
     9 & 5 & 0
\end{array}\right|</script><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><p><a href="https://mathpix.com/" target="_blank" rel="noopener">https://mathpix.com/</a></p>
<p><a href="https://houmin.cc/posts/fedfc052/" target="_blank" rel="noopener">https://houmin.cc/posts/fedfc052/</a></p>
]]></content>
      <categories>
        <category>soft skill</category>
      </categories>
      <tags>
        <tag>é€ŸæŸ¥</tag>
        <tag>latex</tag>
      </tags>
  </entry>
  <entry>
    <title>å›¾è®º</title>
    <url>/2018/03/21/%E5%9B%BE%E8%AE%BA/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="æ— å‘å›¾"><a href="#æ— å‘å›¾" class="headerlink" title="æ— å‘å›¾"></a>æ— å‘å›¾</h3><h4 id="å®šä¹‰æ— å‘å›¾æ•°æ®ç»“æ„"><a href="#å®šä¹‰æ— å‘å›¾æ•°æ®ç»“æ„" class="headerlink" title="å®šä¹‰æ— å‘å›¾æ•°æ®ç»“æ„"></a>å®šä¹‰æ— å‘å›¾æ•°æ®ç»“æ„</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Graph</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        self.n = n</span><br><span class="line">        self.e = <span class="number">0</span></span><br><span class="line">        self.adj = [[] <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_edge</span><span class="params">(self, v, w)</span>:</span></span><br><span class="line">        self.adj[v].append(w)</span><br><span class="line">        self.adj[w].append(v)</span><br><span class="line">        self.e += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="æ— å‘å›¾åˆ¤ç¯"><a href="#æ— å‘å›¾åˆ¤ç¯" class="headerlink" title="æ— å‘å›¾åˆ¤ç¯"></a>æ— å‘å›¾åˆ¤ç¯</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cycle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, G)</span>:</span></span><br><span class="line">        self.vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.has_cycle = <span class="literal">False</span></span><br><span class="line">        self.G = G</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> range(G.n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[s]:</span><br><span class="line">                self.dfs(s, s)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(self, v, parent)</span>:</span></span><br><span class="line">        self.vis[v] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> self.G.adj[v]:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[w]:</span><br><span class="line">                self.dfs(w, v)</span><br><span class="line">            <span class="comment"># ç›¸é‚»èŠ‚ç‚¹å·²è¢«è®¿é—®è¿‡ï¼ŒåŒæ—¶è¿˜ä¸æ˜¯parentèŠ‚ç‚¹ï¼Œåˆ™å­˜åœ¨ç¯</span></span><br><span class="line">            <span class="keyword">elif</span> w != parent:</span><br><span class="line">                self.has_cycle = <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h4 id="æ— å‘å›¾æ˜¯å¦ä¸ºäºŒåˆ†å›¾"><a href="#æ— å‘å›¾æ˜¯å¦ä¸ºäºŒåˆ†å›¾" class="headerlink" title="æ— å‘å›¾æ˜¯å¦ä¸ºäºŒåˆ†å›¾"></a>æ— å‘å›¾æ˜¯å¦ä¸ºäºŒåˆ†å›¾</h4><p>äºŒåˆ†å›¾åˆå«äºŒéƒ¨å›¾ï¼Œæ˜¯å›¾è®ºä¸­çš„ä¸€ç§ç‰¹æ®Šæ¨¡å‹ã€‚è®¾G=(V,E)æ˜¯ä¸€ä¸ªæ— å‘å›¾ï¼Œå¦‚æœé¡¶ç‚¹Vå¯åˆ†å‰²ä¸ºä¸¤ä¸ªäº’ä¸ç›¸äº¤çš„å­é›†<code>(A,B)</code>ï¼Œå¹¶ä¸”å›¾ä¸­çš„æ¯æ¡è¾¹<code>ï¼ˆiï¼Œjï¼‰</code>æ‰€å…³è”çš„ä¸¤ä¸ªé¡¶ç‚¹iå’Œjåˆ†åˆ«å±äºè¿™ä¸¤ä¸ªä¸åŒçš„é¡¶ç‚¹é›†<code>(i in A,j in B)</code>ï¼Œåˆ™ç§°å›¾Gä¸ºä¸€ä¸ªäºŒåˆ†å›¾ã€‚</p>
<p><img src="/2018/03/21/%E5%9B%BE%E8%AE%BA/äºŒåˆ†å›¾.png" alt="avatar"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TwoColor</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, G)</span>:</span></span><br><span class="line">        self.vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.color = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.G = G</span><br><span class="line">        self.is_two_colorable = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> range(G.n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[s]:</span><br><span class="line">                self.dfs(s)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(self, v)</span>:</span></span><br><span class="line">        self.vis[v] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> self.G.adj[v]:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[w]:</span><br><span class="line">                self.color[w] = <span class="keyword">not</span> self.color[v]</span><br><span class="line">                self.dfs(w)</span><br><span class="line">            <span class="keyword">elif</span> self.color[w] == self.color[v]:</span><br><span class="line">                self.is_two_colorable = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h3 id="æœ€å°ç”Ÿæˆæ ‘"><a href="#æœ€å°ç”Ÿæˆæ ‘" class="headerlink" title="æœ€å°ç”Ÿæˆæ ‘"></a>æœ€å°ç”Ÿæˆæ ‘</h3><h4 id="prime-ç®—æ³•"><a href="#prime-ç®—æ³•" class="headerlink" title="prime ç®—æ³•"></a>prime ç®—æ³•</h4><p><img src="/2018/03/21/%E5%9B%BE%E8%AE%BA/prime.gif" alt="avatar"></p>
<p>æ¯æ¬¡å‘æœ€å°ç”Ÿæˆæ ‘ä¸­åŠ å…¥æƒé‡æœ€å°çš„æ¨ªåˆ‡è¾¹ï¼Œæ¨ªåˆ‡è¾¹æ˜¯è¿æ¥æ ‘ä¸éæ ‘é¡¶ç‚¹çš„è¾¹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prim</span><span class="params">(adj_matrix)</span>:</span></span><br><span class="line">    <span class="string">"""ç»™å®šé‚»æ¥çŸ©é˜µï¼Œè¿”å›MSTæƒå€¼ï¼Œè¿”å›-1è¡¨ç¤ºå›¾ä¸è¿é€š"""</span></span><br><span class="line">    n = len(adj_matrix)  <span class="comment"># é¡¶ç‚¹0~n-1</span></span><br><span class="line">    vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">    low_cut = [float(<span class="string">'inf'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]  <span class="comment"># æ¨ªåˆ‡è¾¹çš„æƒé‡</span></span><br><span class="line"></span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line">    vis[<span class="number">0</span>] = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">        low_cut[i] = adj_matrix[<span class="number">0</span>][i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">        min_cut = float(<span class="string">'inf'</span>)</span><br><span class="line">        p = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> vis[j] <span class="keyword">and</span> min_cut &gt; low_cut[j]:</span><br><span class="line">                min_cut = low_cut[j]</span><br><span class="line">                p = j</span><br><span class="line">        <span class="keyword">if</span> min_cut == float(<span class="string">'inf'</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>  <span class="comment"># åŸå›¾ä¸è¿é€š</span></span><br><span class="line">        ans += min_cut</span><br><span class="line">        vis[p] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="comment"># æ¨ªåˆ‡è¾¹æ›´æ–°ä¸ºæ›´å°çš„æƒé‡</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> vis[j] <span class="keyword">and</span> low_cut[j] &gt; adj_matrix[p][j]:</span><br><span class="line">                low_cut[j] = adj_matrix[p][j]</span><br><span class="line">    <span class="keyword">return</span> ans</span><br></pre></td></tr></table></figure>
<h4 id="Kuskal-ç®—æ³•"><a href="#Kuskal-ç®—æ³•" class="headerlink" title="Kuskal ç®—æ³•"></a>Kuskal ç®—æ³•</h4><p><img src="/2018/03/21/%E5%9B%BE%E8%AE%BA/Kuskal.png" alt="avatar"></p>
<p>å°†å›¾ä¸­æ‰€æœ‰è¾¹æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºåŠ å…¥æœ€å°ç”Ÿæˆæ ‘ï¼ŒåŠ å…¥çš„è¾¹ä¸ä¼šä¸å·²åŠ å…¥çš„è¾¹æ„æˆæ¢ã€‚(åˆ©ç”¨å¹¶æŸ¥é›†UFåˆ¤æ–­è¿é€šæ€§)ï¼Œç›´åˆ°æ ‘ä¸­å«æœ‰n-1æ¡è¾¹ä¸ºæ­¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kruskal</span><span class="params">(edges, n)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    æ±‚æœ€å°ç”Ÿæˆæ ‘æƒå€¼</span></span><br><span class="line"><span class="string">    :param edges: [(u, v, w), ...]ï¼Œä¸‰å…ƒç»„å«ä¹‰(é¡¶ç‚¹uï¼Œé¡¶ç‚¹vï¼Œè¾¹æƒé‡w)</span></span><br><span class="line"><span class="string">    :param n: é¡¶ç‚¹æ•°ï¼Œé¡¶ç‚¹èŒƒå›´0~n-1</span></span><br><span class="line"><span class="string">    :return: æœ€å°ç”Ÿæˆæ ‘æƒå€¼ï¼ˆå›¾ä¸è¿é€šï¼Œè¿”å›-1ï¼‰</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    uf = UnionFind(n)  <span class="comment"># å¹¶æŸ¥é›†</span></span><br><span class="line">    edges.sort(key=<span class="keyword">lambda</span> item: item[<span class="number">2</span>])</span><br><span class="line">    edge_cnt = <span class="number">0</span></span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(edges)):</span><br><span class="line">        u, v, w = edges[i]</span><br><span class="line">        root_u, root_v = uf.find(u), uf.find(v)</span><br><span class="line">        <span class="keyword">if</span> root_u != root_v:</span><br><span class="line">            ans += w</span><br><span class="line">            uf.union(u, v)</span><br><span class="line">            edge_cnt += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> edge_cnt == n<span class="number">-1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> edge_cnt &lt; n<span class="number">-1</span>:  <span class="comment"># ä¸è¿é€š</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnionFind</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""å¹¶æŸ¥é›†ç±»"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        <span class="string">"""é•¿åº¦ä¸ºnçš„å¹¶æŸ¥é›†"""</span></span><br><span class="line">        self.uf = [<span class="number">-1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n + <span class="number">1</span>)]    <span class="comment"># åˆ—è¡¨0ä½ç½®ç©ºå‡º</span></span><br><span class="line">        self.sets_count = n                     <span class="comment"># åˆ¤æ–­å¹¶æŸ¥é›†é‡Œå…±æœ‰å‡ ä¸ªé›†åˆ, åˆå§‹åŒ–é»˜è®¤äº’ç›¸ç‹¬ç«‹</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># def find(self, p):</span></span><br><span class="line">    <span class="comment">#     """æŸ¥æ‰¾pçš„æ ¹ç»“ç‚¹(ç¥–å…ˆ)"""</span></span><br><span class="line">    <span class="comment">#     r = p                                   # åˆå§‹p</span></span><br><span class="line">    <span class="comment">#     while self.uf[p] &gt; 0:</span></span><br><span class="line">    <span class="comment">#         p = self.uf[p]</span></span><br><span class="line">    <span class="comment">#     while r != p:                           # è·¯å¾„å‹ç¼©, æŠŠæœç´¢ä¸‹æ¥çš„ç»“ç‚¹ç¥–å…ˆå…¨æŒ‡å‘æ ¹ç»“ç‚¹</span></span><br><span class="line">    <span class="comment">#         self.uf[r], r = p, self.uf[r]</span></span><br><span class="line">    <span class="comment">#     return p</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># def find(self, p):</span></span><br><span class="line">    <span class="comment">#     while self.uf[p] &gt;= 0:</span></span><br><span class="line">    <span class="comment">#         p = self.uf[p]</span></span><br><span class="line">    <span class="comment">#     return p</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(self, p)</span>:</span></span><br><span class="line">        <span class="string">"""å°¾é€’å½’"""</span></span><br><span class="line">        <span class="keyword">if</span> self.uf[p] &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line">        self.uf[p] = self.find(self.uf[p])</span><br><span class="line">        <span class="keyword">return</span> self.uf[p]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">union</span><span class="params">(self, p, q)</span>:</span></span><br><span class="line">        <span class="string">"""è¿é€šp,q è®©qæŒ‡å‘p"""</span></span><br><span class="line">        proot = self.find(p)</span><br><span class="line">        qroot = self.find(q)</span><br><span class="line">        <span class="keyword">if</span> proot == qroot:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">elif</span> self.uf[proot] &gt; self.uf[qroot]:   <span class="comment"># è´Ÿæ•°æ¯”è¾ƒ, å·¦è¾¹è§„æ¨¡æ›´å°</span></span><br><span class="line">            self.uf[qroot] += self.uf[proot]</span><br><span class="line">            self.uf[proot] = qroot</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.uf[proot] += self.uf[qroot]  <span class="comment"># è§„æ¨¡ç›¸åŠ </span></span><br><span class="line">            self.uf[qroot] = proot</span><br><span class="line">        self.sets_count -= <span class="number">1</span>                    <span class="comment"># è¿é€šåé›†åˆæ€»æ•°å‡ä¸€</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_connected</span><span class="params">(self, p, q)</span>:</span></span><br><span class="line">        <span class="string">"""åˆ¤æ–­pqæ˜¯å¦å·²ç»è¿é€š"""</span></span><br><span class="line">        <span class="keyword">return</span> self.find(p) == self.find(q)     <span class="comment"># å³åˆ¤æ–­ä¸¤ä¸ªç»“ç‚¹æ˜¯å¦æ˜¯å±äºåŒä¸€ä¸ªç¥–å…ˆ</span></span><br></pre></td></tr></table></figure>
<h3 id="æœ‰å‘å›¾"><a href="#æœ‰å‘å›¾" class="headerlink" title="æœ‰å‘å›¾"></a>æœ‰å‘å›¾</h3><h4 id="å®šä¹‰æ— å‘å›¾çš„æ•°æ®ç»“æ„"><a href="#å®šä¹‰æ— å‘å›¾çš„æ•°æ®ç»“æ„" class="headerlink" title="å®šä¹‰æ— å‘å›¾çš„æ•°æ®ç»“æ„"></a>å®šä¹‰æ— å‘å›¾çš„æ•°æ®ç»“æ„</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DiGraph</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        self.n = n</span><br><span class="line">        self.e = <span class="number">0</span></span><br><span class="line">        self.adj = [[] <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_edge</span><span class="params">(self, v, w)</span>:</span></span><br><span class="line">        self.adj[v].append(w)</span><br><span class="line">        self.e += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="æœ‰å‘å›¾åˆ¤ç¯"><a href="#æœ‰å‘å›¾åˆ¤ç¯" class="headerlink" title="æœ‰å‘å›¾åˆ¤ç¯"></a>æœ‰å‘å›¾åˆ¤ç¯</h4><p>å¯¹æœ‰å‘å›¾ä½¿ç”¨dfsæœç´¢ï¼Œç³»ç»Ÿè°ƒç”¨æ ˆè¡¨ç¤ºäº†å½“å‰éå†äº†çš„æœ‰å‘è·¯å¾„</p>
<p>è‹¥é€’å½’è¿‡ç¨‹è®¿é—®åˆ°å‡ºç°åœ¨æ ˆä¸­çš„èŠ‚ç‚¹ï¼Œåˆ™å›¾ä¸­å­˜åœ¨äº†ç¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DirectedCycle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, G)</span>:</span></span><br><span class="line">        self.on_stack = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.has_cycle = <span class="literal">False</span></span><br><span class="line">        self.G = G</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> range(G.n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[s]:</span><br><span class="line">                self.dfs(s)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(self, v)</span>:</span></span><br><span class="line">        self.on_stack[v] = <span class="literal">True</span></span><br><span class="line">        self.vis[v] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> self.G.adj[v]:</span><br><span class="line">            <span class="keyword">if</span> self.has_cycle:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="keyword">not</span> self.vis[w]:</span><br><span class="line">                self.dfs(w)</span><br><span class="line">            <span class="keyword">elif</span> self.on_stack[w]:</span><br><span class="line">                self.has_cycle = <span class="literal">True</span></span><br><span class="line">        self.on_stack[v] = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>ä¸€ä¸ªæœ‰å‘äº”ç¯å›¾çš„æ‹“æ‰‘æ’åºå³ä¸ºæ‰€æœ‰é¡¶ç‚¹dfsçš„é€†ååºæ’åˆ—</p>
<p>å¼ºè¿é€šæ€§ï¼šæœ‰å‘å›¾ä»»æ„ä¸¤ç‚¹äº’ç›¸å¯è¾¾ï¼Œåˆ™ä¸ºå¼ºè¿é€šå›¾ã€‚</p>
<p><strong>Kosaraju ç®—æ³•</strong>ï¼š</p>
<ol>
<li>æœ‰å‘å›¾Gç¿»è½¬å¾—åˆ°$G^R$</li>
<li>dfså¾—åˆ°$G^R$ä¸­é¡¶ç‚¹çš„é€†ååºæ’åˆ—</li>
<li>æŒ‰ç…§è¿™ä¸ªä½ ååºæ’åˆ—åœ¨Gä¸­æ‰§è¡Œæ ‡å‡†dfsï¼Œæ¯æ¬¡é€’å½’è°ƒç”¨æ‰€æ ‡è®°çš„é¡¶ç‚¹åœ¨åŒä¸€å¼ºè¿é€šåˆ†é‡é‡</li>
</ol>
<p><strong>æœ€çŸ­è·¯å¾„æ¯”è¾ƒã€æ€»ç»“</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç®—æ³•</th>
<th>æ¡ä»¶</th>
<th>å¹³å‡</th>
<th>æœ€å</th>
<th>ç©ºé—´å¤æ‚åº¦</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Dijkstra</td>
<td>è¾¹æƒä¸ºæ­£</td>
<td>$ElogV$</td>
<td>$ElogV$</td>
<td>$V$</td>
<td></td>
</tr>
<tr>
<td>æ‹“æ‰‘æ’åº</td>
<td>æ— ç¯</td>
<td>$E$</td>
<td>$E+V$</td>
<td>$V$</td>
<td>æ— ç¯å›¾æœ€ä¼˜ç®—æ³•</td>
</tr>
<tr>
<td>Bellman-Fordï¼ˆåŸºäºé˜Ÿåˆ—ï¼‰</td>
<td>æ— è´Ÿæƒé‡</td>
<td>$E+V$</td>
<td>$VE$</td>
<td>$V$</td>
</tr>
</tbody>
</table>
</div>
<p>Dijkstra ç®—æ³•ï¼šæ¯æ¬¡æ·»åŠ ç¦»èµ·ç‚¹æœ€è¿‘çš„éæ ‘èŠ‚ç‚¹</p>
<p>primï¼šæ¯æ¬¡æ·»åŠ ç¦»æ ‘æœ€è¿‘çš„éæ ‘èŠ‚ç‚¹</p>
<h4 id="å•æºæœ€çŸ­è·¯å¾„ï¼Œé‚»æ¥çŸ©é˜µå½¢å¼"><a href="#å•æºæœ€çŸ­è·¯å¾„ï¼Œé‚»æ¥çŸ©é˜µå½¢å¼" class="headerlink" title="å•æºæœ€çŸ­è·¯å¾„ï¼Œé‚»æ¥çŸ©é˜µå½¢å¼"></a>å•æºæœ€çŸ­è·¯å¾„ï¼Œé‚»æ¥çŸ©é˜µå½¢å¼</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dijkstra</span><span class="params">(adj_matrix, s)</span>:</span></span><br><span class="line">    <span class="string">"""ç»™å®šé‚»æ¥çŸ©é˜µå’Œèµ·ç‚¹sï¼Œè¿”å›såˆ°æ‰€æœ‰ç‚¹çš„æœ€çŸ­è·¯å¾„"""</span></span><br><span class="line">    n = len(adj_matrix)  <span class="comment"># é¡¶ç‚¹0~n-1</span></span><br><span class="line">    vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">    edge_to = [<span class="number">-1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]  <span class="comment"># è·¯å¾„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    dist = [float(<span class="string">'inf'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]  <span class="comment"># æœ€çŸ­è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">    dist[s] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        min_dist = float(<span class="string">'inf'</span>)</span><br><span class="line">        p = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> vis[j] <span class="keyword">and</span> dist[j] &lt; min_dist:</span><br><span class="line">                min_dist = dist[j]</span><br><span class="line">                p = j</span><br><span class="line">        <span class="keyword">if</span> p == <span class="number">-1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        vis[p] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> vis[j] <span class="keyword">and</span> dist[p] + adj_matrix[p][j] &lt; dist[j]:</span><br><span class="line">                dist[j] = dist[p] + adj_matrix[p][j]</span><br><span class="line">                edge_to[j] = p</span><br><span class="line">    <span class="keyword">return</span> dist, edge_to</span><br></pre></td></tr></table></figure>
<p>å•å…ƒæœ€çŸ­è·¯å¾„ï¼Œé‚»æ¥è¡¨å½¢å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dijkstra</span><span class="params">(adj, s)</span>:</span></span><br><span class="line">    n = len(adj)</span><br><span class="line">    dist = [float(<span class="string">'inf'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line"></span><br><span class="line">    dist[s] = <span class="number">0</span></span><br><span class="line">    pq = [(<span class="number">0</span>, s)]</span><br><span class="line">    <span class="keyword">while</span> pq:</span><br><span class="line">        <span class="comment"># u, væ˜¯é¡¶ç‚¹ï¼Œdæ˜¯è·ç¦»ï¼Œwæ˜¯è¾¹æƒé‡</span></span><br><span class="line">        d, u = heappop(pq)</span><br><span class="line">        <span class="keyword">if</span> d &gt; dist[u]:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> v, w <span class="keyword">in</span> adj[u]:</span><br><span class="line">            <span class="keyword">if</span> d + w &lt; dist[v]:</span><br><span class="line">                dist[v] = d + w</span><br><span class="line">                heappush(pq, (dist[v], v))</span><br><span class="line">    <span class="keyword">return</span> dist</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>å›¾è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜</title>
    <url>/2018/03/14/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜"><a href="#å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜" class="headerlink" title="å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜"></a>å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜</h2><p>ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²<code>S,P</code>,å…¶ä¸­<code>S</code>ä¸²é•¿åº¦ä¸º<code>n</code>ï¼Œ<code>P</code>ä¸²é•¿åº¦ä¸º<code>m</code>, <code>(m&lt;=n)</code>ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²<code>P</code>æ˜¯å¦æ˜¯<code>S</code>çš„å­ä¸²</p>
<h4 id="å¤æ‚åº¦"><a href="#å¤æ‚åº¦" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><p>å®¹æ˜“è®¡ç®—å¤æ‚åº¦ï¼š<code>O(m*n)</code></p>
<h3 id="Brute-Force-ç®€å•åŒ¹é…"><a href="#Brute-Force-ç®€å•åŒ¹é…" class="headerlink" title="Brute-Force(ç®€å•åŒ¹é…)"></a>Brute-Force(ç®€å•åŒ¹é…)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">naive_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    m, n = len(s), len(p)</span><br><span class="line">    <span class="keyword">if</span> m-n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m-n+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> s[i:i+n] == p:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="Rabin-Karpç®—æ³•"><a href="#Rabin-Karpç®—æ³•" class="headerlink" title="Rabin-Karpç®—æ³•"></a>Rabin-Karpç®—æ³•</h3><h4 id="æ€æƒ³"><a href="#æ€æƒ³" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4><p>åŸºæœ¬æ€æƒ³å’Œæš´åŠ›ç ´è§£ç®—æ³•æ˜¯ä¸€æ ·çš„ã€‚ä¹Ÿéœ€è¦ä¸€ä¸ªå¤§å°ä¸º<strong>m</strong>çš„çª—å£ï¼Œä½†æ˜¯ä¸ä¸€æ ·çš„æ˜¯ï¼Œä¸æ˜¯ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªé•¿åº¦ä¸º<strong>m</strong>çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æ¯”è¾ƒä»–ä»¬çš„å“ˆå¸Œå€¼ã€‚</p>
<h4 id="å¤æ‚åº¦åˆ†æ"><a href="#å¤æ‚åº¦åˆ†æ" class="headerlink" title="å¤æ‚åº¦åˆ†æ"></a>å¤æ‚åº¦åˆ†æ</h4><p>ä¸€å…±ä¼šæœ‰(<strong>n-m+1</strong>)ä¸ªçª—å£æ»‘åŠ¨ï¼Œè¿™ä¸€æ­¥çš„å¤æ‚åº¦æ˜¯<strong>O(n)</strong>ã€‚</p>
<p>è®¡ç®—å“ˆå¸Œå€¼:</p>
<p>å‡è®¾ç°åœ¨çª—å£çš„èµ·ç‚¹åœ¨<strong>j</strong>è¿™ä¸ªä½ç½®ï¼Œæ­¤æ—¶çª—å£å†…çš„å­—ç¬¦ä¸²å“ˆå¸Œå€¼ä¸ºï¼Œ</p>
<script type="math/tex; mode=display">
H(S, j)=\sum_{i=0}^{m-1} \alpha^{m-(i+1)} \times \operatorname{char}\left(s_{i}\right)</script><p>é‚£ä¹ˆï¼Œå½“è®¡ç®—ä¸‹ä¸€ä¸ªçª—å£çš„å“ˆå¸Œå€¼æ—¶ï¼Œä¹Ÿå°±æ˜¯å½“çª—å£çš„èµ·ç‚¹ä¸º<strong>j+1</strong>æ—¶ï¼Œå“ˆå¸Œå‡½æ•°å€¼å¯ç”±å¦‚ä¸‹æ–¹æ³•è®¡ç®—ï¼š</p>
<script type="math/tex; mode=display">
H(S, j+1)=\alpha\left(H(S, j)-\alpha^{m-1} \operatorname{char}\left(s_{j}\right)\right)+\operatorname{char}\left(s_{j+m}\right)</script><p>è¿™æ ·çœ‹æ¥ï¼Œåœ¨è®¡ç®—å‡ºç¬¬ä¸€ä¸ªçª—å£çš„å‡½æ•°å€¼ä¹‹åï¼Œåé¢çš„æ¯ä¸€ä¸ªçª—å£å“ˆå¸Œå€¼éƒ½å¯ä»¥æ ¹æ®ä¸Šè¿°å…¬å¼è®¡ç®—ï¼Œåªéœ€è¦åšä¸€æ¬¡å‡æ³•ï¼Œä¸€æ¬¡ä¹˜æ³•ï¼Œä¸€æ¬¡åŠ æ³•ã€‚ä¹‹åçš„æ¯ä¸€æ¬¡å“ˆå¸Œå€¼è®¡ç®—éƒ½æ˜¯<strong>O(1)</strong>çš„å¤æ‚åº¦ã€‚æ‰€ä»¥è®¡ç®—ç¬¬ä¸€ä¸ªçª—å£çš„å¤æ‚åº¦ï¼Œ<strong>O(m)</strong>ï¼Œæ­¤åè®¡ç®—æ¯ä¸€ä¸ªçª—å£çš„å¤æ‚åº¦<strong>O(1)</strong>ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦ï¼š<code>O(n+m)</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rabin_karp_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    n = len(s)</span><br><span class="line">    m = len(p)</span><br><span class="line">    h1 = hash(p)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, n-m+<span class="number">1</span>):</span><br><span class="line">        h2 = hash(s[i:i+m])</span><br><span class="line">        <span class="keyword">if</span> h1 != h2:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> s[i:i+m] == p:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<h3 id="KMPç®—æ³•"><a href="#KMPç®—æ³•" class="headerlink" title="KMPç®—æ³•"></a>KMPç®—æ³•</h3><p>æœ‰ç‚¹å¤æ‚ï¼Œæœ‰æ—¶é—´å†å†™ä¸Šã€‚</p>
<h4 id="æ€æƒ³-1"><a href="#æ€æƒ³-1" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4><h4 id="å¤æ‚åº¦åˆ†æ-1"><a href="#å¤æ‚åº¦åˆ†æ-1" class="headerlink" title="å¤æ‚åº¦åˆ†æ"></a>å¤æ‚åº¦åˆ†æ</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># KMPç®—æ³•ï¼š</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kmp_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    m, n = len(s), len(p)</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span> <span class="keyword">or</span> m - n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    table = partial_table(p)</span><br><span class="line">    i, cur = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> i &lt; m-n+<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> p[cur] == s[i+cur]:</span><br><span class="line">            cur += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> cur == <span class="number">0</span>:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                i += cur - table[cur<span class="number">-1</span>]  <span class="comment"># ç§»åŠ¨ä½æ•°=å·²åŒ¹é…çš„å­—ç¬¦æ•°-å¯¹åº”çš„éƒ¨åˆ†åŒ¹é…å€¼</span></span><br><span class="line">                cur = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> cur == n:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">partial_table</span><span class="params">(p)</span>:</span></span><br><span class="line">    m = len(p)</span><br><span class="line">    table = [<span class="number">0</span>] * m</span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> q <span class="keyword">in</span> range(<span class="number">1</span>, m):</span><br><span class="line">        <span class="keyword">if</span> p[k] == p[q]:</span><br><span class="line">            k = k + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            k = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> p[k] == p[q]:</span><br><span class="line">                k = k + <span class="number">1</span></span><br><span class="line">        table[q] = k</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> table</span><br></pre></td></tr></table></figure>
<h3 id="Horspoolç®—æ³•"><a href="#Horspoolç®—æ³•" class="headerlink" title="Horspoolç®—æ³•"></a>Horspoolç®—æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shift_table</span><span class="params">(p)</span>:</span></span><br><span class="line">    <span class="comment"># ç”Ÿæˆ Horspool ç®—æ³•çš„ç§»åŠ¨è¡¨</span></span><br><span class="line">    <span class="comment"># å½“å‰æ£€æµ‹å­—ç¬¦ä¸ºcï¼Œæ¨¡å¼é•¿åº¦ä¸ºm</span></span><br><span class="line">    <span class="comment"># å¦‚æœå½“å‰cä¸åŒ…å«åœ¨æ¨¡å¼çš„å‰m-1ä¸ªå­—ç¬¦ä¸­ï¼Œç§»åŠ¨æ¨¡å¼çš„é•¿åº¦m</span></span><br><span class="line">    <span class="comment"># å…¶ä»–æƒ…å†µä¸‹ç§»åŠ¨æœ€å³è¾¹çš„çš„cåˆ°æ¨¡å¼æœ€åä¸€ä¸ªå­—ç¬¦çš„è·ç¦»</span></span><br><span class="line">    <span class="comment"># from collections import defaultdict</span></span><br><span class="line">    <span class="comment"># table = defaultdict(lambda: len(p))</span></span><br><span class="line">    table = dict()</span><br><span class="line">    <span class="comment"># print table</span></span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> range(<span class="number">0</span>, len(p) - <span class="number">1</span>):</span><br><span class="line">        table[p[index]] = len(p) - <span class="number">1</span> - index</span><br><span class="line">    <span class="comment"># print table</span></span><br><span class="line">    <span class="keyword">return</span> table</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">horspool_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    m, n = len(s), len(p)</span><br><span class="line">    table = shift_table(p)</span><br><span class="line">    index = len(p) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> index &lt;= m - <span class="number">1</span>:</span><br><span class="line">        <span class="comment"># print("start matching at", index)</span></span><br><span class="line">        match_count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> match_count &lt; n <span class="keyword">and</span> p[n - <span class="number">1</span> - match_count] == s[index - match_count]:</span><br><span class="line">            match_count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> match_count == len(p):</span><br><span class="line">            <span class="keyword">return</span> index - match_count + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># print s[index], table.get(s[index])</span></span><br><span class="line">            <span class="keyword">if</span> table.get(s[index]) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                table[s[index]] = n</span><br><span class="line">            index += table[s[index]]</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<h3 id="Sunday-ç®—æ³•"><a href="#Sunday-ç®—æ³•" class="headerlink" title="Sunday ç®—æ³•"></a>Sunday ç®—æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sunday_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    char_pos = dict()</span><br><span class="line">    <span class="keyword">for</span> i, ch <span class="keyword">in</span> enumerate(p):</span><br><span class="line">        char_pos[ch] = i</span><br><span class="line">    <span class="comment"># print "char_pos:", char_pos</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    m, n = len(s), len(p)</span><br><span class="line">    <span class="keyword">while</span> i &lt;= m - n:</span><br><span class="line">        found = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j, ch <span class="keyword">in</span> enumerate(p):</span><br><span class="line">            <span class="keyword">if</span> s[i + j] != ch:</span><br><span class="line">                found = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">if</span> (i + n) &lt; m:</span><br><span class="line">                    <span class="keyword">if</span> s[i + n] <span class="keyword">not</span> <span class="keyword">in</span> char_pos:</span><br><span class="line">                        i += (n + <span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        i += (n - char_pos[s[i + n]])</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<h3 id="Boyer-Mooreç®—æ³•"><a href="#Boyer-Mooreç®—æ³•" class="headerlink" title="Boyer_Mooreç®—æ³•"></a>Boyer_Mooreç®—æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">boyer_moore_search</span><span class="params">(string, des)</span>:</span></span><br><span class="line">    l = len(des) - <span class="number">1</span></span><br><span class="line">    strlen = len(string) - <span class="number">1</span></span><br><span class="line">    start, end = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> strlen &gt;= <span class="number">0</span>:</span><br><span class="line">        end = start + len(des)</span><br><span class="line">        <span class="comment"># print string[start:end]</span></span><br><span class="line">        cr = compare(string[start:end], des)</span><br><span class="line">        <span class="keyword">if</span> cr[<span class="number">0</span>] == <span class="number">-2</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'not found'</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> cr[<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># return end - l</span></span><br><span class="line">            <span class="keyword">return</span> start</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pos = is_character_in(des, cr[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> cr[<span class="number">0</span>] == (len(des) - <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> pos != <span class="number">-1</span>:</span><br><span class="line">                    start += len(des) - <span class="number">1</span> - pos</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    start += len(des)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> pos == <span class="number">-1</span>:</span><br><span class="line">                    <span class="comment">#  have good  string</span></span><br><span class="line">                    goodPos = is_character_in(des, des[l])</span><br><span class="line">                    <span class="keyword">if</span> goodPos == l:</span><br><span class="line">                        start += l + <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        start += l - goodPos</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_character_in</span><span class="params">(s, c)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> pos <span class="keyword">in</span> range(len(s)):</span><br><span class="line">        <span class="keyword">if</span> s[pos] == c:</span><br><span class="line">            <span class="keyword">return</span> pos</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare</span><span class="params">(str1, str2)</span>:</span></span><br><span class="line">    l1 = len(str1) - <span class="number">1</span></span><br><span class="line">    l2 = len(str2) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> l1 != l2:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> l1 &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> str1[l1] != str2[l1]:</span><br><span class="line">            <span class="keyword">return</span> l1, str1[l1]</span><br><span class="line">        l1 -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<h3 id="BMHBNFSç®—æ³•ï¼ˆå¿«é€ŸåŒ¹é…ç®—æ³•ï¼‰"><a href="#BMHBNFSç®—æ³•ï¼ˆå¿«é€ŸåŒ¹é…ç®—æ³•ï¼‰" class="headerlink" title="BMHBNFSç®—æ³•ï¼ˆå¿«é€ŸåŒ¹é…ç®—æ³•ï¼‰"></a>BMHBNFSç®—æ³•ï¼ˆå¿«é€ŸåŒ¹é…ç®—æ³•ï¼‰</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_skip</span><span class="params">(p)</span>:</span></span><br><span class="line">    m = len(p)</span><br><span class="line">    a = p[m<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m<span class="number">-2</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        <span class="keyword">if</span> p[i] == a:</span><br><span class="line">            <span class="keyword">return</span> m<span class="number">-2</span>-i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bmhbnfs_find</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    <span class="comment"># find first occurrence of p in s</span></span><br><span class="line">    m = len(s)</span><br><span class="line">    n = len(p)</span><br><span class="line">    <span class="comment"># skipæ˜¯æŠŠç¦»p[m-1]æœ€è¿‘ä¸”å­—ç¬¦ç›¸åŒçš„å­—ç¬¦ç§»åˆ°m-1ä½éœ€è¦è·³è¿‡çš„æ­¥æ•°-1</span></span><br><span class="line">    <span class="comment"># skip = delta1(p)[p[m - 1]]</span></span><br><span class="line">    skip = compute_skip(p)</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt;= m - n:</span><br><span class="line">        <span class="keyword">if</span> s[i + n - <span class="number">1</span>] == p[n - <span class="number">1</span>]:  <span class="comment"># (boyer-moore)</span></span><br><span class="line">            <span class="comment"># potential match</span></span><br><span class="line">            <span class="keyword">if</span> s[i:i + n - <span class="number">1</span>] == p[:n - <span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">            <span class="keyword">if</span> s[i + n] <span class="keyword">not</span> <span class="keyword">in</span> p:</span><br><span class="line">                i = i + n + <span class="number">1</span>  <span class="comment"># (sunday)</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                i = i + skip  <span class="comment"># (horspool)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># skip</span></span><br><span class="line">            <span class="keyword">if</span> s[i + n] <span class="keyword">not</span> <span class="keyword">in</span> p:</span><br><span class="line">                i = i + n + <span class="number">1</span>  <span class="comment"># (sunday)</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                i = i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>  <span class="comment"># not found</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>å­—ç¬¦ä¸²åŒ¹é…</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ¨æ€è§„åˆ’</title>
    <url>/2018/03/09/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2018/03/09/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/dynamic_programming.png" alt="avatar"></p>
<a id="more"></a>
<h2 id="åŸºæœ¬æ€è·¯"><a href="#åŸºæœ¬æ€è·¯" class="headerlink" title="åŸºæœ¬æ€è·¯"></a>åŸºæœ¬æ€è·¯</h2><h3 id="æ€è€ƒçŠ¶æ€"><a href="#æ€è€ƒçŠ¶æ€" class="headerlink" title="æ€è€ƒçŠ¶æ€"></a>æ€è€ƒçŠ¶æ€</h3><p>çŠ¶æ€å…ˆå°è¯•â€œé¢˜ç›®é—®ä»€ä¹ˆï¼Œå°±æŠŠä»€ä¹ˆè®¾ç½®ä¸ºçŠ¶æ€â€ã€‚ç„¶åè€ƒè™‘â€œçŠ¶æ€å¦‚ä½•è½¬ç§»â€ï¼Œå¦‚æœâ€œçŠ¶æ€è½¬ç§»æ–¹ç¨‹â€ä¸å®¹æ˜“å¾—åˆ°ï¼Œå°è¯•ä¿®æ”¹å®šä¹‰ï¼Œç›®çš„ä»ç„¶æ˜¯ä¸ºäº†æ–¹ä¾¿å¾—åˆ°â€œçŠ¶æ€è½¬ç§»æ–¹ç¨‹â€ã€‚</p>
<h3 id="æ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ˆæ ¸å¿ƒã€éš¾ç‚¹ï¼‰"><a href="#æ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ˆæ ¸å¿ƒã€éš¾ç‚¹ï¼‰" class="headerlink" title="æ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ˆæ ¸å¿ƒã€éš¾ç‚¹ï¼‰"></a>æ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ˆæ ¸å¿ƒã€éš¾ç‚¹ï¼‰</h3><p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ˜¯éå¸¸é‡è¦çš„ï¼Œæ˜¯åŠ¨æ€è§„åˆ’çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯éš¾ç‚¹ï¼Œèµ·åˆ°æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ã€‚</p>
<blockquote>
<p>æŠ€å·§æ˜¯åˆ†ç±»è®¨è®ºã€‚å¯¹çŠ¶æ€ç©ºé—´è¿›è¡Œåˆ†ç±»ï¼Œæ€è€ƒæœ€ä¼˜å­ç»“æ„åˆ°åº•æ˜¯ä»€ä¹ˆã€‚å³å¤§é—®é¢˜çš„æœ€ä¼˜è§£å¦‚ä½•ç”±å°é—®é¢˜çš„æœ€ä¼˜è§£å¾—åˆ°ã€‚</p>
</blockquote>
<p>å½’çº³â€œçŠ¶æ€è½¬ç§»æ–¹ç¨‹â€æ˜¯ä¸€ä¸ªå¾ˆçµæ´»çš„äº‹æƒ…ï¼Œå¾—å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œé™¤äº†æŒæ¡ç»å…¸çš„åŠ¨æ€è§„åˆ’é—®é¢˜ä»¥å¤–ï¼Œè¿˜éœ€è¦å¤šåšé¢˜ã€‚å¦‚æœæ˜¯é’ˆå¯¹é¢è¯•ï¼Œè¯·è‡ªè¡ŒæŠŠæ¡éš¾åº¦ï¼Œæˆ‘ä¸ªäººè§‰å¾—æŒæ¡å¸¸è§é—®é¢˜çš„åŠ¨æ€è§„åˆ’è§£æ³•ï¼Œæ˜ç™½åŠ¨æ€è§„åˆ’çš„æœ¬è´¨å°±æ˜¯æ‰“è¡¨æ ¼ï¼Œä»ä¸€ä¸ªå°è§„æ¨¡é—®é¢˜å‡ºå‘ï¼Œé€æ­¥å¾—åˆ°å¤§é—®é¢˜çš„è§£ï¼Œå¹¶è®°å½•è¿‡ç¨‹ã€‚åŠ¨æ€è§„åˆ’ä¾ç„¶æ˜¯â€œç©ºé—´æ¢æ—¶é—´â€æ€æƒ³çš„ä½“ç°ã€‚</p>
<h3 id="æ€è€ƒåˆå§‹åŒ–"><a href="#æ€è€ƒåˆå§‹åŒ–" class="headerlink" title="æ€è€ƒåˆå§‹åŒ–"></a>æ€è€ƒåˆå§‹åŒ–</h3><p>åˆå§‹åŒ–æ˜¯éå¸¸é‡è¦çš„ï¼Œä¸€æ­¥é”™ï¼Œæ­¥æ­¥é”™ï¼Œåˆå§‹åŒ–çŠ¶æ€ä¸€å®šè¦è®¾ç½®å¯¹ï¼Œæ‰å¯èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚</p>
<p>è§’åº¦ 1ï¼šç›´æ¥ä»çŠ¶æ€çš„è¯­ä¹‰å‡ºå‘ï¼›</p>
<p>è§’åº¦ 2ï¼šå¦‚æœçŠ¶æ€çš„è¯­ä¹‰ä¸å¥½æ€è€ƒï¼Œå°±è€ƒè™‘â€œçŠ¶æ€è½¬ç§»æ–¹ç¨‹â€çš„è¾¹ç•Œéœ€è¦ä»€ä¹ˆæ ·åˆå§‹åŒ–çš„æ¡ä»¶ï¼›</p>
<p>è§’åº¦ 3ï¼šä»â€œçŠ¶æ€è½¬ç§»æ–¹ç¨‹â€æ–¹ç¨‹çš„ä¸‹æ ‡çœ‹æ˜¯å¦éœ€è¦å¤šè®¾ç½®ä¸€è¡Œã€ä¸€åˆ—è¡¨ç¤ºâ€œå“¨å…µâ€ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€äº›è¾¹ç•Œçš„è®¨è®ºï¼Œä½¿å¾—ä»£ç å˜å¾—æ¯”è¾ƒçŸ­ã€‚</p>
<h3 id="æ€è€ƒè¾“å‡º"><a href="#æ€è€ƒè¾“å‡º" class="headerlink" title="æ€è€ƒè¾“å‡º"></a>æ€è€ƒè¾“å‡º</h3><p>æœ‰äº›æ—¶å€™æ˜¯æœ€åä¸€ä¸ªçŠ¶æ€ï¼Œæœ‰äº›æ—¶å€™å¯èƒ½ä¼šç»¼åˆæ‰€æœ‰è®¡ç®—è¿‡çš„çŠ¶æ€ã€‚</p>
<h3 id="æ€è€ƒçŠ¶æ€å‹ç¼©"><a href="#æ€è€ƒçŠ¶æ€å‹ç¼©" class="headerlink" title="æ€è€ƒçŠ¶æ€å‹ç¼©"></a>æ€è€ƒçŠ¶æ€å‹ç¼©</h3><p>  â€œçŠ¶æ€å‹ç¼©â€ä¼šä½¿å¾—ä»£ç éš¾äºç†è§£ï¼Œåˆå­¦çš„æ—¶å€™å¯ä»¥ä¸ä¸€æ­¥åˆ°ä½ã€‚å…ˆæŠŠä»£ç å†™æ­£ç¡®ï¼Œç„¶åå†æ€è€ƒçŠ¶æ€å‹ç¼©ã€‚</p>
<p>  çŠ¶æ€å‹ç¼©åœ¨æœ‰ä¸€ç§æƒ…å†µä¸‹æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œé‚£å°±æ˜¯çŠ¶æ€ç©ºé—´éå¸¸åºå¤§çš„æ—¶å€™ï¼ˆå¤„ç†æµ·é‡æ•°æ®ï¼‰ï¼Œæ­¤æ—¶ç©ºé—´ä¸å¤Ÿç”¨ï¼Œå°±å¿…é¡»çŠ¶æ€å‹ç¼©ã€‚</p>
<hr>
<h2 id="é¢˜ç›®ï¼ˆLeetCodeï¼‰"><a href="#é¢˜ç›®ï¼ˆLeetCodeï¼‰" class="headerlink" title="é¢˜ç›®ï¼ˆLeetCodeï¼‰"></a>é¢˜ç›®ï¼ˆLeetCodeï¼‰</h2><h3 id="5-æœ€é•¿å›æ–‡å­ä¸²"><a href="#5-æœ€é•¿å›æ–‡å­ä¸²" class="headerlink" title="5. æœ€é•¿å›æ–‡å­ä¸²"></a>5. <a href="https://leetcode-cn.com/problems/longest-palindromic-substring/" target="_blank" rel="noopener">æœ€é•¿å›æ–‡å­ä¸²</a></h3><p>æè¿°ï¼šç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ° s ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚ä½ å¯ä»¥å‡è®¾ s çš„æœ€å¤§é•¿åº¦ä¸º 1000ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<p>è¾“å…¥: â€œbabadâ€</p>
<p>è¾“å‡º: â€œbabâ€</p>
<p>æ³¨æ„: â€œabaâ€ ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆç­”æ¡ˆã€‚</p>
<p>ç¤ºä¾‹ 2ï¼š</p>
<p>è¾“å…¥: â€œcbbdâ€</p>
<p>è¾“å‡º: â€œbbâ€</p>
<p>â€œåŠ¨æ€è§„åˆ’â€æœ€å…³é”®çš„æ­¥éª¤æ˜¯æƒ³æ¸…æ¥šâ€œçŠ¶æ€å¦‚ä½•è½¬ç§»â€ï¼Œäº‹å®ä¸Šï¼Œâ€œå›æ–‡â€æ˜¯å¤©ç„¶å…·æœ‰â€œçŠ¶æ€è½¬ç§»â€æ€§è´¨çš„ï¼š</p>
<blockquote>
<p>ä¸€ä¸ªå›æ–‡å»æ‰ä¸¤å¤´ä»¥åï¼Œå‰©ä¸‹çš„éƒ¨åˆ†ä¾ç„¶æ˜¯å›æ–‡ï¼ˆè¿™é‡Œæš‚ä¸è®¨è®ºè¾¹ç•Œï¼‰ã€‚</p>
</blockquote>
<p>ä¾ç„¶ä»å›æ–‡ä¸²çš„å®šä¹‰å±•å¼€è®¨è®ºï¼š</p>
<ol>
<li><p>å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²çš„å¤´å°¾ä¸¤ä¸ªå­—ç¬¦éƒ½ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²ä¸€å®šä¸æ˜¯å›æ–‡ä¸²ï¼›</p>
</li>
<li><p>å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²çš„å¤´å°¾ä¸¤ä¸ªå­—ç¬¦ç›¸ç­‰ï¼Œæ‰æœ‰å¿…è¦ç»§ç»­åˆ¤æ–­ä¸‹å»ã€‚</p>
</li>
<li><p>å¦‚æœé‡Œé¢çš„å­ä¸²æ˜¯å›æ–‡ï¼Œæ•´ä½“å°±æ˜¯å›æ–‡ä¸²ï¼›</p>
</li>
<li><p>å¦‚æœé‡Œé¢çš„å­ä¸²ä¸æ˜¯å›æ–‡ä¸²ï¼Œæ•´ä½“å°±ä¸æ˜¯å›æ–‡ä¸²ã€‚</p>
</li>
</ol>
<p>å³åœ¨å¤´å°¾å­—ç¬¦ç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œé‡Œé¢å­ä¸²çš„å›æ–‡æ€§è´¨æ®å®šäº†æ•´ä¸ªå­ä¸²çš„å›æ–‡æ€§è´¨ï¼Œè¿™å°±æ˜¯çŠ¶æ€è½¬ç§»ã€‚å› æ­¤å¯ä»¥æŠŠâ€œçŠ¶æ€â€å®šä¹‰ä¸ºåŸå­—ç¬¦ä¸²çš„ä¸€ä¸ªå­ä¸²æ˜¯å¦ä¸ºå›æ–‡å­ä¸²ã€‚</p>
<h4 id="ç¬¬-1-æ­¥ï¼šå®šä¹‰çŠ¶æ€"><a href="#ç¬¬-1-æ­¥ï¼šå®šä¹‰çŠ¶æ€" class="headerlink" title="ç¬¬ 1 æ­¥ï¼šå®šä¹‰çŠ¶æ€"></a>ç¬¬ 1 æ­¥ï¼šå®šä¹‰çŠ¶æ€</h4><p><code>dp[i][j]</code> è¡¨ç¤ºå­ä¸² <code>s[i,j]</code> æ˜¯å¦ä¸ºå›æ–‡å­ä¸²ã€‚</p>
<h4 id="ç¬¬-2-æ­¥ï¼šæ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹"><a href="#ç¬¬-2-æ­¥ï¼šæ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹" class="headerlink" title="ç¬¬ 2 æ­¥ï¼šæ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹"></a>ç¬¬ 2 æ­¥ï¼šæ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><p>è¿™ä¸€æ­¥åœ¨åšåˆ†ç±»è®¨è®ºï¼ˆæ ¹æ®å¤´å°¾å­—ç¬¦æ˜¯å¦ç›¸ç­‰ï¼‰ï¼Œæ ¹æ®ä¸Šé¢çš„åˆ†æå¾—åˆ°ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">dp[<span class="string">i</span>][<span class="symbol">j</span>] = (s[<span class="string">i</span>] == s[<span class="string">j</span>]) and dp[<span class="string">i + 1</span>][<span class="symbol">j - 1</span>]</span><br></pre></td></tr></table></figure>
<p>åˆ†æï¼š</p>
<ol>
<li><p><code>i</code> å’Œ <code>j</code> çš„å…³ç³»æ˜¯ <code>i &lt;= j</code>ï¼Œå› æ­¤ï¼Œåªéœ€è¦å¡«è¿™å¼ è¡¨çš„ä¸ŠåŠéƒ¨åˆ†ï¼›</p>
</li>
<li><p>çœ‹åˆ° <code>dp[i + 1][j - 1]</code> å°±å¾—è€ƒè™‘è¾¹ç•Œæƒ…å†µã€‚è¾¹ç•Œæ¡ä»¶æ˜¯ï¼šè¡¨è¾¾å¼ <code>[i + 1, j - 1]</code>ä¸æ„æˆåŒºé—´ï¼Œå³é•¿åº¦ä¸¥æ ¼å°äº 2ï¼Œå³<code>j - 1 - (i + 1) + 1 &lt; 2</code> ï¼Œæ•´ç†å¾— <code>j - i &lt; 3</code>ã€‚</p>
</li>
</ol>
<p>è¿™ä¸ªç»“è®ºå¾ˆæ˜¾ç„¶ï¼šå½“å­ä¸² <code>s[i, j]</code> çš„é•¿åº¦ç­‰äº 2 æˆ–è€…ç­‰äº 3 çš„æ—¶å€™ï¼Œæˆ‘å…¶å®åªéœ€è¦åˆ¤æ–­ä¸€ä¸‹å¤´å°¾ä¸¤ä¸ªå­—ç¬¦æ˜¯å¦ç›¸ç­‰å°±å¯ä»¥ç›´æ¥ä¸‹ç»“è®ºäº†ã€‚</p>
<ul>
<li><p>å¦‚æœå­ä¸² <code>s[i + 1, j - 1]</code> åªæœ‰ 1 ä¸ªå­—ç¬¦ï¼Œå³å»æ‰ä¸¤å¤´ï¼Œå‰©ä¸‹ä¸­é—´éƒ¨åˆ†åªæœ‰ 1 ä¸ªå­—ç¬¦ï¼Œå½“ç„¶æ˜¯å›æ–‡ï¼›</p>
</li>
<li><p>å¦‚æœå­ä¸² <code>s[i + 1, j - 1]</code> ä¸ºç©ºä¸²ï¼Œé‚£ä¹ˆå­ä¸² <code>s[i, j]</code> ä¸€å®šæ˜¯å›æ–‡å­ä¸²ã€‚</p>
</li>
</ul>
<p>å› æ­¤ï¼Œåœ¨ <code>s[i] == s[j]</code> æˆç«‹å’Œ <code>j - i &lt; 3</code> çš„å‰æä¸‹ï¼Œç›´æ¥å¯ä»¥ä¸‹ç»“è®ºï¼Œ<code>dp[i][j] = true</code>ï¼Œå¦åˆ™æ‰æ‰§è¡ŒçŠ¶æ€è½¬ç§»ã€‚</p>
<h4 id="ç¬¬-3-æ­¥-è€ƒè™‘åˆå§‹åŒ–"><a href="#ç¬¬-3-æ­¥-è€ƒè™‘åˆå§‹åŒ–" class="headerlink" title="ç¬¬ 3 æ­¥:è€ƒè™‘åˆå§‹åŒ–"></a>ç¬¬ 3 æ­¥:è€ƒè™‘åˆå§‹åŒ–</h4><p>åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå•ä¸ªå­—ç¬¦ä¸€å®šæ˜¯å›æ–‡ä¸²ï¼Œå› æ­¤æŠŠå¯¹è§’çº¿å…ˆåˆå§‹åŒ–ä¸º 1ï¼Œå³ <code>dp[i][i] = 1</code>ã€‚</p>
<h4 id="ç¬¬-4-æ­¥-è€ƒè™‘è¾“å‡º"><a href="#ç¬¬-4-æ­¥-è€ƒè™‘è¾“å‡º" class="headerlink" title="ç¬¬ 4 æ­¥:è€ƒè™‘è¾“å‡º"></a>ç¬¬ 4 æ­¥:è€ƒè™‘è¾“å‡º</h4><p>åªè¦ä¸€å¾—åˆ° <code>dp[i][j] = true</code>ï¼Œå°±è®°å½•å­ä¸²çš„é•¿åº¦å’Œèµ·å§‹ä½ç½®ï¼Œæ²¡æœ‰å¿…è¦æˆªå–ï¼Œå› ä¸ºæˆªå–å­—ç¬¦ä¸²ä¹Ÿè¦æ¶ˆè€—æ€§èƒ½ï¼Œè®°å½•æ­¤æ—¶çš„å›æ–‡å­ä¸²çš„â€œèµ·å§‹ä½ç½®â€å’Œâ€œå›æ–‡é•¿åº¦â€å³å¯ã€‚</p>
<h4 id="ç¬¬-5-æ­¥-è€ƒè™‘çŠ¶æ€æ˜¯å¦å¯ä»¥å‹ç¼©"><a href="#ç¬¬-5-æ­¥-è€ƒè™‘çŠ¶æ€æ˜¯å¦å¯ä»¥å‹ç¼©" class="headerlink" title="ç¬¬ 5 æ­¥:è€ƒè™‘çŠ¶æ€æ˜¯å¦å¯ä»¥å‹ç¼©"></a>ç¬¬ 5 æ­¥:è€ƒè™‘çŠ¶æ€æ˜¯å¦å¯ä»¥å‹ç¼©</h4><p>åœ¨å¡«è¡¨çš„è¿‡ç¨‹ä¸­ï¼Œåªå‚è€ƒäº†å·¦ä¸‹æ–¹çš„æ•°å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">longestPalindrome</span><span class="params">(self,s)</span>:</span></span><br><span class="line"></span><br><span class="line">size = len(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> size &lt; <span class="number">2</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">dp = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(size)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(size)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(size):</span><br><span class="line"></span><br><span class="line">dp[_][_] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">start_idx = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">max_len = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,size):</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(j):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s[i] == s[j]:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> j - i &lt; <span class="number">3</span>: <span class="comment"># i,j ä¹‹é—´åªæœ‰ä¸€ä¸ªå­—ç¬¦æˆ–è€…æ²¡æœ‰å­—ç¬¦</span></span><br><span class="line"></span><br><span class="line">dp[i][j] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">dp[i][j] = dp[i+<span class="number">1</span>][j<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dp[i][j] == <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">cur_len = j - i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> cur_len &gt; max_len:</span><br><span class="line"></span><br><span class="line">max_len = cur_len</span><br><span class="line"></span><br><span class="line">start_idx = i</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> s[start_idx:start_idx+max_len]</span><br></pre></td></tr></table></figure>
<h3 id="1143-æœ€é•¿å…¬å…±å­åºåˆ—"><a href="#1143-æœ€é•¿å…¬å…±å­åºåˆ—" class="headerlink" title="1143. æœ€é•¿å…¬å…±å­åºåˆ—"></a>1143. <a href="https://leetcode-cn.com/problems/longest-common-subsequence/" target="_blank" rel="noopener">æœ€é•¿å…¬å…±å­åºåˆ—</a></h3><p>æè¿°ï¼šç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² text1 å’Œ text2ï¼Œè¿”å›è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—ã€‚ä¸€ä¸ªå­—ç¬¦ä¸²çš„ å­åºåˆ—æ˜¯æŒ‡è¿™æ ·ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼šå®ƒæ˜¯ç”±åŸå­—ç¬¦ä¸²åœ¨ä¸æ”¹å˜å­—ç¬¦çš„ç›¸å¯¹é¡ºåºçš„æƒ…å†µä¸‹åˆ é™¤æŸäº›å­—ç¬¦ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ä»»ä½•å­—ç¬¦ï¼‰åç»„æˆçš„æ–°å­—ç¬¦ä¸²ã€‚</p>
<p>ä¾‹å¦‚ï¼Œâ€aceâ€ æ˜¯ â€œabcdeâ€ çš„å­åºåˆ—ï¼Œä½† â€œaecâ€ ä¸æ˜¯ â€œabcdeâ€ çš„å­åºåˆ—ã€‚ä¸¤ä¸ªå­—ç¬¦ä¸²çš„ã€Œå…¬å…±å­åºåˆ—ã€æ˜¯è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ‰€å…±åŒæ‹¥æœ‰çš„å­åºåˆ—ã€‚è‹¥è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ²¡æœ‰å…¬å…±å­åºåˆ—ï¼Œåˆ™è¿”å› 0ã€‚</p>
<p>ç¤ºä¾‹ 1:</p>
<p>è¾“å…¥ï¼štext1 = â€œabcdeâ€, text2 = â€œaceâ€</p>
<p>è¾“å‡ºï¼š3</p>
<p>è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ â€œaceâ€ï¼Œå®ƒçš„é•¿åº¦ä¸º 3ã€‚</p>
<p>ç¤ºä¾‹ 2:</p>
<p>è¾“å…¥ï¼štext1 = â€œabcâ€, text2 = â€œabcâ€</p>
<p>è¾“å‡ºï¼š3</p>
<p>è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ â€œabcâ€ï¼Œå®ƒçš„é•¿åº¦ä¸º 3ã€‚</p>
<p>ç¤ºä¾‹ 3:</p>
<p>è¾“å…¥ï¼štext1 = â€œabcâ€, text2 = â€œdefâ€</p>
<p>è¾“å‡ºï¼š0</p>
<p>è§£é‡Šï¼šä¸¤ä¸ªå­—ç¬¦ä¸²æ²¡æœ‰å…¬å…±å­åºåˆ—ï¼Œè¿”å› 0ã€‚</p>
<p>æç¤º:</p>
<p>1 &lt;= text1.length &lt;= 1000</p>
<p>1 &lt;= text2.length &lt;= 1000</p>
<p>è¾“å…¥çš„å­—ç¬¦ä¸²åªå«æœ‰å°å†™è‹±æ–‡å­—ç¬¦ã€‚</p>
<h4 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h4><ol>
<li><p>çŠ¶æ€ï¼šé—®é¢˜è¦æ±‚æœ€é•¿å…¬å…±å­åºåˆ—ï¼Œé‚£å°±è®©dpè¡¨å­˜å‚¨é•¿åº¦ã€‚</p>
</li>
<li><p>çŠ¶æ€è½¬ç§»ï¼š</p>
</li>
<li><p>å½“ <code>S1i==S2j</code> æ—¶ï¼Œé‚£ä¹ˆå°±èƒ½åœ¨ <code>S1</code> çš„å‰ <code>i-1</code> ä¸ªå­—ç¬¦ä¸ <code>S2</code> çš„å‰ <code>j-1</code> ä¸ªå­—ç¬¦æœ€é•¿å…¬å…±å­åºåˆ—çš„åŸºç¡€ä¸Šå†åŠ ä¸Š <code>S1i</code> è¿™ä¸ªå€¼ï¼Œæœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦åŠ  <code>1</code>ï¼Œå³ <code>dp[i][j] = dp[i-1][j-1] + 1</code>ã€‚</p>
</li>
<li><p>å½“ <code>S1i != S2j</code> æ—¶ï¼Œæ­¤æ—¶æœ€é•¿å…¬å…±å­åºåˆ—ä¸º <code>S1</code> çš„å‰ <code>i-1</code> ä¸ªå­—ç¬¦å’Œ <code>S2</code> çš„å‰ <code>j</code> ä¸ªå­—ç¬¦æœ€é•¿å…¬å…±å­åºåˆ—ï¼Œæˆ–è€… <code>S1</code> çš„å‰ i ä¸ªå­—ç¬¦å’Œ <code>S2</code> çš„å‰ <code>j-1</code> ä¸ªå­—ç¬¦æœ€é•¿å…¬å…±å­åºåˆ—ï¼Œå–å®ƒä»¬çš„æœ€å¤§è€…ï¼Œå³ <code>dp[i][j] = max{ dp[i-1][j], dp[i][j-1] }</code>ã€‚</p>
</li>
</ol>
<p>ç»¼ä¸Šï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p>
<p><img src="/2018/03/09/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/dp_1.png" alt="avatar"></p>
<ol>
<li>è§£çš„å½¢å¼ï¼šè§£åœ¨dpè¡¨çš„å³ä¸‹è§’</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">longestCommonSubsequence</span><span class="params">(self, text1, text2)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type text1: str</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type text2: str</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:rtype: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> text1 <span class="keyword">or</span> <span class="keyword">not</span> text2:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">size_1 = len(text1)</span><br><span class="line"></span><br><span class="line">size_2 = len(text2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–è¡¨æ ¼</span></span><br><span class="line"></span><br><span class="line">dp = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(size_2+<span class="number">1</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(size_1+<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(size_1):</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(size_2):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> text1[i] == text2[j]:</span><br><span class="line"></span><br><span class="line">dp[i+<span class="number">1</span>][j+<span class="number">1</span>] = dp[i][j] + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">dp[i+<span class="number">1</span>][j+<span class="number">1</span>] = max(dp[i][j+<span class="number">1</span>],dp[i+<span class="number">1</span>][j])</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> dp[size_1][size_2]</span><br></pre></td></tr></table></figure>
<h3 id="53-æœ€å¤§åºåˆ—å’Œ"><a href="#53-æœ€å¤§åºåˆ—å’Œ" class="headerlink" title="53. æœ€å¤§åºåˆ—å’Œ"></a>53. <a href="https://leetcode-cn.com/problems/maximum-subarray/" target="_blank" rel="noopener">æœ€å¤§åºåˆ—å’Œ</a></h3><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚</p>
<p>ç¤ºä¾‹:</p>
<p>è¾“å…¥: [-2,1,-3,4,-1,2,1,-5,4],</p>
<p>è¾“å‡º: 6</p>
<p>è§£é‡Š: è¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚</p>
<p>è¿›é˜¶:</p>
<p>å¦‚æœä½ å·²ç»å®ç°å¤æ‚åº¦ä¸º O(n) çš„è§£æ³•ï¼Œå°è¯•ä½¿ç”¨æ›´ä¸ºç²¾å¦™çš„åˆ†æ²»æ³•æ±‚è§£ã€‚</p>
<h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>æ³•ä¸€ï¼šæš´åŠ›åŠ¨æ€è§„åˆ’ï¼šè¶…æ—¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maxSubArray</span><span class="params">(self, nums)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type nums: List[int]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:rtype: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">size = len(nums)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> size == <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> nums[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">dp = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(size)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(size)]</span><br><span class="line"></span><br><span class="line">start = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">end = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">max_val = float(<span class="string">'-inf'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(size):</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(j):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> j - i == <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">dp[i][j] = nums[i] + nums[j]</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">dp[i][j] = dp[i][j<span class="number">-1</span>] + nums[j]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> max_val &lt; dp[i][j]:</span><br><span class="line"></span><br><span class="line">start = i</span><br><span class="line"></span><br><span class="line">end = j</span><br><span class="line"></span><br><span class="line">max_val = dp[i][j]</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> max(max_val, max(nums))</span><br></pre></td></tr></table></figure>
<p>æ³•äºŒï¼šDPæ³•ï¼Œç”¨äº†äº›çµå·§çš„æ€è·¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maxSubArray</span><span class="params">(self, nums)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type nums: List[int]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:rtype: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">max_, sum_ = nums[<span class="number">0</span>],nums[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums[<span class="number">1</span>:]:</span><br><span class="line"></span><br><span class="line">sum_ = sum_ + num <span class="keyword">if</span> sum_ &gt; <span class="number">0</span> <span class="keyword">else</span> num</span><br><span class="line"></span><br><span class="line">max_ = max_ <span class="keyword">if</span> max_ &gt; sum_ <span class="keyword">else</span> sum_</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> max_</span><br></pre></td></tr></table></figure>
<h3 id="300-æœ€é•¿ä¸Šå‡å­åºåˆ—"><a href="#300-æœ€é•¿ä¸Šå‡å­åºåˆ—" class="headerlink" title="300. æœ€é•¿ä¸Šå‡å­åºåˆ—"></a>300. <a href="https://leetcode-cn.com/problems/longest-increasing-subsequence/" target="_blank" rel="noopener">æœ€é•¿ä¸Šå‡å­åºåˆ—</a></h3><p>ç»™å®šä¸€ä¸ªæ— åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ã€‚</p>
<p>ç¤ºä¾‹:</p>
<p>è¾“å…¥: [10,9,2,5,3,7,101,18]</p>
<p>è¾“å‡º: 4</p>
<p>è§£é‡Š: æœ€é•¿çš„ä¸Šå‡å­åºåˆ—æ˜¯ [2,3,7,101]ï¼Œå®ƒçš„é•¿åº¦æ˜¯ 4ã€‚</p>
<p>è¯´æ˜:å¯èƒ½ä¼šæœ‰å¤šç§æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ç»„åˆï¼Œä½ åªéœ€è¦è¾“å‡ºå¯¹åº”çš„é•¿åº¦å³å¯ã€‚ä½ ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥ä¸º $O(n^2)$ ã€‚</p>
<p>è¿›é˜¶: ä½ èƒ½å°†ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦é™ä½åˆ° <code>O(n log n)</code> å—?</p>
<h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>çŠ¶æ€ï¼šå®šä¹‰ dp[i]ä¸ºè€ƒè™‘å‰ iä¸ªå…ƒç´ ï¼Œä»¥ç¬¬ i ä¸ªæ•°å­—ç»“å°¾çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ï¼Œæ³¨æ„ nums[i]å¿…é¡»è¢«é€‰å–ã€‚</p>
<p>çŠ¶æ€è½¬ç§»ï¼šä»å°åˆ°å¤§è®¡ç®— dp[] æ•°ç»„çš„å€¼ï¼Œåœ¨è®¡ç®— dp[i] ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»è®¡ç®—å‡º dp[0â€¦iâˆ’1] çš„å€¼ï¼Œåˆ™çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š</p>
<p><img src="/2018/03/09/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/dp_2.png" alt="avatar"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lengthOfLIS</span><span class="params">(self, nums)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type nums: List[int]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:rtype: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">dp = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line"></span><br><span class="line">dp.append(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(i):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> nums[i] &gt; nums[j]:</span><br><span class="line"></span><br><span class="line">dp[i] = max(dp[i], dp[j] + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> max(dp)</span><br></pre></td></tr></table></figure>
<h3 id="10-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"><a href="#10-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…" class="headerlink" title="10. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"></a><a href="https://leetcode-cn.com/problems/regular-expression-matching/" target="_blank" rel="noopener">10. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</a></h3><p><strong>çŠ¶æ€</strong>ï¼šé—®é¢˜è¦æ±‚è§£çš„æ˜¯æ­£åˆ™ä¸²æ˜¯å¦å¯ä»¥åŒ¹é…ï¼Œåˆ™æŠŠçŠ¶æ€è®¾ä¸ºæ˜¯å¦å¯åŒ¹é…ã€‚<code>dp[i][j]</code> è¡¨ç¤º <code>s</code> çš„å‰ <code>i</code>ä¸ªæ˜¯å¦èƒ½è¢« <code>p</code> çš„å‰ <code>j</code> ä¸ªåŒ¹é…</p>
<p><strong>è½¬ç§»æ–¹ç¨‹</strong> ï¼š </p>
<ol>
<li><p><code>p[j] == s[i] or p[j] == &quot;.&quot; : dp[i][j] = dp[i-1][j-1]</code> </p>
</li>
<li><p><code>p[j] ==&quot; * &quot;</code>:     # æ¯”è¾ƒéš¾æƒ³</p>
<ol>
<li><code>p[j-1] != s[i]: dp[i][j] = dp[i][j-2]</code> # <code>*</code> å‰çš„å­—ç¬¦å’ŒåŸå­—ç¬¦ä¸²ä¸åŒ¹é…,ç›¸å½“äºè¯¥å­—ç¬¦åŒ¹é…0æ¬¡ã€‚</li>
<li><code>p[j-1] == s[i] or p[j-1] == &quot;.&quot;ï¼š</code> # åŒ¹é…<ol>
<li><code>dp[i][j] = dp[i-1][j]</code> # * åŒ¹é…å¤šæ¬¡</li>
<li><code>dp[i][j] = dp[i][j-1]</code> # * åŒ¹é…ä¸€æ¬¡</li>
<li><code>dp[i][j] = dp[i][j-2]</code> # * åŒ¹é…0æ¬¡</li>
</ol>
</li>
</ol>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isMatch</span><span class="params">(self, s, p)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> p:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">not</span> s</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s <span class="keyword">and</span> len(p) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        nrow = len(s) + <span class="number">1</span></span><br><span class="line">        ncol = len(p) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        dp = [[<span class="literal">False</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(ncol)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(nrow)]</span><br><span class="line"></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">True</span></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">1</span>] = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">2</span>, ncol):</span><br><span class="line">            j = c - <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> p[j] == <span class="string">'*'</span>:</span><br><span class="line">                dp[<span class="number">0</span>][c] = dp[<span class="number">0</span>][c - <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> range(<span class="number">1</span>, nrow): <span class="comment"># r åŸå§‹ä¸²</span></span><br><span class="line">            i = r - <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">1</span>, ncol): <span class="comment"># c æ­£åˆ™ä¸²</span></span><br><span class="line">                j = c - <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> s[i] == p[j] <span class="keyword">or</span> p[j] == <span class="string">'.'</span>:</span><br><span class="line">                    dp[r][c] = dp[r - <span class="number">1</span>][c - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">elif</span> p[j] == <span class="string">'*'</span>:</span><br><span class="line">                    <span class="keyword">if</span> p[j - <span class="number">1</span>] == s[i] <span class="keyword">or</span> p[j - <span class="number">1</span>] == <span class="string">'.'</span>:</span><br><span class="line">                        dp[r][c] = dp[r - <span class="number">1</span>][c] <span class="keyword">or</span> dp[r][c - <span class="number">2</span>]</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        dp[r][c] = dp[r][c - <span class="number">2</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[r][c] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[nrow - <span class="number">1</span>][ncol - <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ä¸“ä¸šæŠ€èƒ½</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
      </tags>
  </entry>
  <entry>
    <title>èƒŒåŒ…é—®é¢˜</title>
    <url>/2018/03/01/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>æœ‰Nä»¶ç‰©å“å’Œä¸€ä¸ªå®¹é‡ä¸º<code>v</code>çš„èƒŒåŒ…ï¼Œæ”¾å…¥ç¬¬iä»¶ç‰©å“è€—è´¹ç©ºé—´<code>c[i]</code>å¾—åˆ°ä»·å€¼ä¸º<code>W[i]</code>,æ±‚å“ªäº›ç‰©å“è£…å…¥èƒŒåŒ…å¯ä½¿å¾—æ€»ä»·å€¼æœ€å¤§ï¼Ÿ</p>
<h4 id="åŠ¨æ€è§„åˆ’æ±‚è§£ï¼š"><a href="#åŠ¨æ€è§„åˆ’æ±‚è§£ï¼š" class="headerlink" title="åŠ¨æ€è§„åˆ’æ±‚è§£ï¼š"></a>åŠ¨æ€è§„åˆ’æ±‚è§£ï¼š</h4><p>çŠ¶æ€ï¼šé—®é¢˜æ‰€æ±‚æœ€å¤§ä»·å€¼ï¼Œè®¾çŠ¶æ€å³ä¸ºèƒŒåŒ…ä¸­ç‰©å“çš„ä»·å€¼</p>
<p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p>
<p><code>dp[i][j]</code>è¡¨ç¤ºå‰iä»¶ç‰©å“æ”¾å…¥ä¸€ä¸ªå®¹é‡ä¸ºVçš„èƒŒåŒ…è·å¾—çš„æœ€å¤§ä»·å€¼çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸º</p>
<script type="math/tex; mode=display">
\mathrm{dp}[\mathrm{i}][\mathrm{v}]=\max \left\{\begin{array}{l}
dp[i-1][v](\text {not select}) \\
dp[i-1][v-C[i]]+W[i](\text {select})
\end{array}\right.</script><p>å…¶ä¸­<code>dp[i-1][v-C[i]]</code>è¡¨ç¤ºå‰<code>i-1</code>ä»¶ç‰©å“æ”¾å…¥å®¹é‡ä¸º<code>v-C[i]</code>çš„èƒŒåŒ…ä¸­ã€‚</p>
<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># F[0, 0...V] = 0</span></span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>):</span><br><span class="line">    dp[<span class="number">0</span>][v] = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="comment"># å®¹é‡è£…ä¸ä¸‹å½“å‰ç‰©å“æ—¶ï¼Œä¿ç•™åŸå€¼</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(<span class="number">0</span>, C[i]):</span><br><span class="line">        dp[i][v] = dp[i<span class="number">-1</span>][v]</span><br><span class="line">    <span class="comment"># çŠ¶æ€è½¬ç§»</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(C[i], V+<span class="number">1</span>):</span><br><span class="line">        dp[i][v] = max(dp[i<span class="number">-1</span>][v], dp[i<span class="number">-1</span>][v-C[i]] + W[i])</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><ol>
<li><p>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(VN)</code></p>
</li>
<li><p>ç©ºé—´å¤æ‚åº¦ï¼š<code>O(VN)</code>å¯ä¼˜åŒ–æˆ<code>O(N)</code></p>
<p><code>dp[i][v]</code>ç”±<code>dp[i-1][v-C[i]]</code>å’Œ<code>dp[i-1][v]</code>ä¸¤ä¸ªå­é—®é¢˜é€’æ¨å¾—åˆ°ï¼Œæ‰€ä»¥ç¬¬<code>i</code>æ¬¡è¿­ä»£æ—¶ï¼Œ<code>v</code>æŒ‰ç…§<code>V-&gt;0</code>çš„é€†åºè®¡ç®—<code>dp[v]</code>å¯ä»¥ä¿è¯<code>dp[v]=max(dp[v],dp[v-C[i]]+W[i])</code>ï¼Œè¿™æ ·åœ¨èµ‹å€¼ä¹‹å‰ï¼Œè®¿é—®åˆ°çš„å‡ä¸º<code>i-1</code>æ¬¡è¿­ä»£ä¿ç•™çš„å€¼ã€‚</p>
<p>ç©ºé—´ä¸º<code>c[i]</code>çš„ç‰©å“ä¸ä¼šå—åˆ°çŠ¶æ€<code>dp[0...C[i]]</code>çš„å½±å“ï¼Œå³ä¸å½±å“è£…ä¸ä¸‹è¯¥ç‰©å“çš„èƒŒåŒ…èƒ½è£…å…¥çš„æœ€å¤§ä»·å€¼ï¼Œæ‰€ä»¥<code>v</code>ä¸­<code>V</code>é€’å‡åˆ°<code>C[i]</code>å°±å¯ä»¥äº†ã€‚</p>
</li>
<li><p>ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(V, C[i]<span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        dp[v] = max(dp[v], dp[v-C[i]] + W[i])</span><br></pre></td></tr></table></figure>
<p>å¯¹å¤„ç†0-1èƒŒåŒ…çš„ç‰©å“è¿›è¡ŒæŠ½è±¡ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">zero_one_pack</span><span class="params">(F, c, w)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(V, c<span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        dp[v] = max(dp[v], dp[v-c] + w)</span><br><span class="line"></span><br><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    zero_one_pack(dp, C[i], W[i])</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="åˆå§‹åŒ–ç»†èŠ‚"><a href="#åˆå§‹åŒ–ç»†èŠ‚" class="headerlink" title="åˆå§‹åŒ–ç»†èŠ‚"></a>åˆå§‹åŒ–ç»†èŠ‚</h4><p>åˆå§‹åŒ–dpçš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨æ²¡æœ‰ä»»ä½•ç‰©å“å¯ä»¥è£…å…¥èƒŒåŒ…æ—¶çš„åˆæ³•çŠ¶æ€ï¼ˆå¿…è¦ä½†ä¸å……åˆ†æ¡ä»¶ï¼‰</p>
<ol>
<li><p>æ°å¥½è£…æ»¡èƒŒåŒ…æ—¶ï¼Œæ±‚æœ€ä¼˜è§£ï¼š<code>dp[0]=0,dp[1...V]=</code>$-\infty$</p>
<ul>
<li><p>å®¹é‡ä¸º0æ—¶ï¼Œä»€ä¹ˆä¹Ÿè£…ä¸ä¸‹ï¼Œä»·å€¼ä¸º0ï¼Œæ‰€ä»¥<code>dp[0]=0</code></p>
</li>
<li><p>å®¹é‡ä¸ä¸º0çš„æ—¶å€™ï¼ŒçŠ¶æ€æœªå®šä¹‰ï¼ŒçŠ¶æ€è®¾ä¸º$-\infty$</p>
</li>
</ul>
<p>æŒ‰æ­¤è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œåªæœ‰èƒ½å¤Ÿæ°å¥½è£…å…¥çš„ç‰©å“æ‰ä¼šæ›´æ–°å‡ºåˆç†å€¼ï¼ˆæ­£å€¼ï¼‰ï¼ŒåŸºäº<code>dp[0]=0</code></p>
</li>
<li><p>æ²¡è¦æ±‚æŠŠèƒŒåŒ…è£…æ»¡ï¼š<code>dp[0...V]=0</code></p>
<p>ä»»ä½•å®¹é‡éƒ½æœ‰ä¸€ä¸ªåˆæ³•çš„â€œä»€ä¹ˆéƒ½ä¸è£…â€ï¼Œæ‰€ä»¥è®¾<code>dp[0...V]=0</code></p>
</li>
</ol>
<h3 id="å®Œå…¨èƒŒåŒ…"><a href="#å®Œå…¨èƒŒåŒ…" class="headerlink" title="å®Œå…¨èƒŒåŒ…"></a>å®Œå…¨èƒŒåŒ…</h3><p><img src="/Users/lizhen/Library/Application Support/typora-user-images/image-20200321181733468.png" alt="image-20200321181733468"></p>
<h4 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h4><p>æœ‰Nç§ç‰©å“å’Œ1ä¸ªå®¹é‡ä¸ºVçš„èƒŒåŒ…ï¼Œæ¯ç§ç‰©å“å¯ä»¥æœ‰ä»»æ„å¤šä¸ªï¼Œæ”¾å…¥ç¬¬iç§ç‰©å“çš„è€—è´¹ç©ºé—´<code>C[i]</code>ï¼Œä»·å€¼ä¸º<code>W[i]</code>,æ±‚èƒŒåŒ…èƒ½å¤Ÿè£…å…¥çš„æœ€å¤§ä»·å€¼ï¼Ÿ</p>
<h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>æ¯ç§ç‰©å“å¯ä»¥æ”¾å…¥0ä»¶ï¼Œ1ä»¶ï¼Œâ€¦ï¼Œ<code>int(V/C[i])</code>ä»¶ï¼Œä»¤<code>dp[i][v]</code>è¡¨ç¤ºå‰iç§ç‰©å“æ”¾å…¥å®¹é‡vçš„èƒŒåŒ…è·å–çš„æœ€å¤§ä»·å€¼ï¼Œåˆ™<code>dp[i][v]=max(dp[i-1][v-k*C[i]]+k*W[i]),0&lt;=k*C[i]&lt;=v</code></p>
<h4 id="ä¼˜åŒ–-1"><a href="#ä¼˜åŒ–-1" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><p>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(nv</code>$\sum \frac{V}{C[i]}$)</p>
<p>ç®€å•ä¼˜åŒ–ï¼šä¸€ä¸ªç®€å•æœ‰æ•ˆçš„ä¼˜åŒ–æ€è·¯æ˜¯ï¼šå•ä½ä»·å€¼æ›´ä¾¿å®œçš„åº”è¯¥ç›´æ¥è·³è¿‡</p>
<p>è‹¥ä¸¤ä»¶ç‰©å“<code>i,j</code>æœ‰<code>C[i]&lt;=C[j] and W[i]&gt;=W[j]</code>;åˆ™<code>j</code>å¯ä»¥ç›´æ¥è·³è¿‡ï¼Œä¸å¿…è€ƒè™‘ï¼Œå¯¹äºéšæœºæ•°æ®ï¼Œè¿™ä¼šå¤§å¤§å‡å°‘ç‰©å“æ•°é‡ï¼ŒåŠ å¿«é€Ÿåº¦ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sieve = &#123;C[i]: <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>)&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="comment"># è·³è¿‡è£…ä¸ä¸‹çš„</span></span><br><span class="line">    <span class="keyword">if</span> C[i] &gt; V:</span><br><span class="line">        sieve[C[i]] = <span class="number">-1</span></span><br><span class="line">    <span class="comment"># è·³è¿‡ C[i] == C[j] and W[i] &gt; W[j]çš„jç‰©å“</span></span><br><span class="line">    <span class="keyword">elif</span> sieve[C[i]] &lt; W[i]:</span><br><span class="line">        sieve[C[i]] = W[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> sieve[C[i]] &lt; <span class="number">0</span> <span class="keyword">or</span> W[i] &lt; sieve[C[i]]:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(C[i], V+<span class="number">1</span>):</span><br><span class="line">        max_k = V // C[i]</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">1</span>, max_k+<span class="number">1</span>):</span><br><span class="line">            dp[i][v] = max(dp[i<span class="number">-1</span>][v], dp[i<span class="number">-1</span>][v-k*C[i]] + k*W[i])</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆä¼˜åŒ–æ–¹æ¡ˆï¼š</p>
<p>æŒ‰ç…§æ­£åºå®¹é‡æ›´æ–°å½“å‰æ€»ä»·å€¼ï¼Œ<code>dp[v-C[i]]</code>ä¸­å¯èƒ½æ˜¯<code>i-1</code>æ¬¡è¿­ä»£ä¸­ä¿ç•™çš„å€¼ï¼Œä¹Ÿå¯èƒ½æ˜¯æœ¬æ¬¡è¿­ä»£ä¸­äº§ç”Ÿäº†å˜åŒ–çš„å€¼ã€‚ï¼ˆå¦‚æœåŠ é€‰ç¬¬iä»¶ç‰©å“ï¼‰</p>
<p>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(NV)</code></p>
<p>ç©ºé—´å¤æ‚åº¦:<code>O(V)</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(C[i], V+<span class="number">1</span>):</span><br><span class="line">        dp[v] = max(dp[v], dp[v-C[i]] + W[i])</span><br></pre></td></tr></table></figure>
<p>å¯¹å¤„ç†ä¸€ç§å®Œå…¨èƒŒåŒ…çš„ç‰©å“è¿‡ç¨‹è¿›è¡ŒæŠ½è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complete_pack</span><span class="params">(F, c, w)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(c, V+<span class="number">1</span>):</span><br><span class="line">        F[v] = max(F[v], F[v-c] + w)</span><br><span class="line"></span><br><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    complete_pack(dp, C[i], W[i])</span><br></pre></td></tr></table></figure>
<h4 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h4><p>0-1 èƒŒåŒ…ï¼šå€’åºå®¹é‡ï¼Œå½“å‰æ–°ç‰©å“ä¹‹å¤šå½±å“ä¸€æ¬¡å½“å‰æ€»ä»·å€¼</p>
<p>å®Œå…¨èƒŒåŒ…ï¼šæ­£åºå®¹é‡ï¼Œéšç€å®¹é‡å¢åŠ ï¼Œå½“å‰æ–°ç‰©å“å¯ä»¥å¤šæ¬¡å½±å“å½“å‰æ€»ä»·å€¼</p>
<h3 id="å¤šé‡èƒŒåŒ…"><a href="#å¤šé‡èƒŒåŒ…" class="headerlink" title="å¤šé‡èƒŒåŒ…"></a>å¤šé‡èƒŒåŒ…</h3><p>æœ‰<code>N</code>ç§ç‰©å“å’Œ1ä¸ªå®¹é‡ä¸º<code>V</code>çš„èƒŒåŒ…ï¼Œç¬¬iç§ç‰©å“æœ‰<code>M[i]</code>ä»¶ï¼Œæ¯ä»¶è€—è´¹ç©ºé—´<code>C[i]</code>,ä»·å€¼<code>W[i]</code>,æ±‚èƒ½è£…å…¥èƒŒåŒ…çš„æœ€å¤§ä»·å€¼ã€‚</p>
<h4 id="æ€è·¯1"><a href="#æ€è·¯1" class="headerlink" title="æ€è·¯1"></a>æ€è·¯1</h4><p>å’Œå®Œå…¨èƒŒåŒ…ç±»ä¼¼ï¼Œå¯¹iç§ç‰©å“æœ‰<code>M[i]+1</code>ç§ç­–ç•¥ï¼Œå–<code>0</code>ä»¶ï¼Œå–<code>1</code>ä»¶ï¼Œâ€¦ï¼Œå–<code>M[i]</code>,ä»¤<code>dp[i][v]</code>è¡¨ç¤ºå‰iä¸­ç‰©å“æ”¾å…¥å®¹é‡vä¸­è·å¾—çš„æœ€å¤§ä»·å€¼ï¼Œåˆ™<code>dp[i][v]=max(dp[i-1][v-k*C[i]]+k*W[i]),0&lt;=k&lt;=M[i]</code></p>
<p>æ—¶é—´å¤æ‚åº¦ï¼š`O(V<script type="math/tex">\sum M_i</script></p>
<h4 id="æ€è·¯2"><a href="#æ€è·¯2" class="headerlink" title="æ€è·¯2"></a>æ€è·¯2</h4><p>è½¬åŒ–ä¸º0-1èƒŒåŒ…é—®é¢˜ï¼ŒæŠŠç¬¬iç§ç‰©å“æ¢æˆ<code>M[i]</code>ä»¶<code>0-1</code>èƒŒåŒ…ä¸­çš„ç‰©å“ï¼Œå¾—åˆ°ç‰©å“æ•°ä¸º$\sum M_i$çš„<code>0-1</code>èƒŒåŒ…é—®é¢˜ï¼Œæ—¶é—´å¤æ‚åº¦ä»ä¸º$O(V\sum M_i)$ã€‚ä½¿ç”¨äºŒè¿›åˆ¶çš„æ€æƒ³ï¼Œå¯ä»¥æŠŠæ—¶é—´å¤æ‚åº¦ä¸‹é™ä¸º$O(V\sum{log{M_i}})$,å³æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼è¿›è¡Œæ‹†åˆ†ï¼š</p>
<p>$2^0,2^1,2^2,â€¦,2^{k-1},M_i-2^k+1$</p>
<p>è¿™æ ·æ‹¼æˆçš„æ–°ç‰©å“æ€»é‡ç­‰äºåŸæ¥ç‰©å“çš„æ•°é‡ï¼Œç¬¬iä»¶ç‰©å“æ‹†åˆ†æˆäº†$O(log{m_i})$</p>
<h5 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiple_pack</span><span class="params">(F, c, w, m)</span>:</span></span><br><span class="line">    <span class="comment"># å¦‚æœç‰©å“è¶³å¤Ÿå¤šï¼Œå°±å˜æˆäº†å®Œå…¨èƒŒåŒ…</span></span><br><span class="line">    <span class="keyword">if</span> c * m &gt;= V:</span><br><span class="line">        complete_pack(F, c, w)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># å¤šé‡èƒŒåŒ…æŒ‰ç…§2æ¬¡å¹‚è¿›è¡Œåˆ’åˆ†æˆ0-1èƒŒåŒ…</span></span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> k &lt; m:</span><br><span class="line">        zero_one_pack(F, k*c, k*w)</span><br><span class="line">        m = m - k</span><br><span class="line">        k = <span class="number">2</span> * k</span><br><span class="line">    <span class="comment"># æŠŠå‰©ä½™çš„ç‰©å“å½“ä½œ1ä»¶ç‰©å“</span></span><br><span class="line">    zero_one_pack(F, c * m, w * m)</span><br><span class="line"></span><br><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    multiple_pack(dp, C[i], W[i], M[i])</span><br></pre></td></tr></table></figure>
<h3 id="äºŒç»´è´¹ç”¨èƒŒåŒ…"><a href="#äºŒç»´è´¹ç”¨èƒŒåŒ…" class="headerlink" title="äºŒç»´è´¹ç”¨èƒŒåŒ…"></a>äºŒç»´è´¹ç”¨èƒŒåŒ…</h3><p>å¯¹äºæ¯ä»¶ç‰©å“æœ‰ä¸¤ç§ä¸åŒçš„costï¼Œæ¯ç§costæœ‰ä¸€ä¸ªæœ€å¤§å®¹çº³å€¼ï¼ˆèƒŒåŒ…å®¹é‡ï¼‰ï¼Œæ€æ ·é€‰æ‹©ç‰©å“ä½¿å¾—èƒŒåŒ…å®¹çº³æœ€å¤§ä»·å€¼ï¼Ÿç¬¬iç§ç‰©å“ä¸¤ç§è´¹ç”¨åˆ†åˆ«ä¸º<code>C[i]</code>å’Œ<code>D[i]</code>ï¼Œä¸¤ç§costæœ€å¤§å®¹çº³å€¼ä¸ºV,Uï¼Œç‰©å“çš„ä»·å€¼ä¸º<code>W[i]</code>(é¢˜ç›®åœºæ™¯æ ·ä¾‹ï¼šæ‰“çŸ©å½¢ä¸­æ”¾å°çŸ©å½¢ï¼Œæ±‚æœ€å¤§å®¹é‡)</p>
<h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>è´¹ç”¨åŠ 1ç»´ï¼ŒçŠ¶æ€åŠ 1ç»´ï¼›ä»¤<code>dp[i][v][u]</code>è¡¨ç¤ºå‰iä»¶ç‰©å“ä»˜å‡ºä¸¤ç§è´¹ç”¨åˆ†åˆ«ä¸ºvï¼Œuæ—¶å¯è·å¾—çš„æœ€å¤§ä»·å€¼ã€‚åˆ™<code>dp[i][v][u]=max(dp[i-1][v][u],dp[i-1][v-C[i]][u-D[i]]+W[i])</code></p>
<h4 id="ä¼˜åŒ–-2"><a href="#ä¼˜åŒ–-2" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><p>ç±»ä¼¼äºä¸€ç»´èƒŒåŒ…ç©ºé—´ä¼˜åŒ–æ–¹æ³•ï¼ŒäºŒç»´èƒŒåŒ…ä¸ä¹‹ç±»ä¼¼ï¼š</p>
<ol>
<li>äºŒç»´0-1èƒŒåŒ…ï¼švå’Œué‡‡ç”¨é€†åºå¾ªç¯</li>
<li>äºŒç»´å®Œå…¨èƒŒåŒ…ï¼švå’Œué‡‡ç”¨é¡ºåºå¾ªç¯</li>
<li>äºŒç»´å¤šé‡èƒŒåŒ…ï¼šæ‹†åˆ†ç‰©å“</li>
</ol>
<h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">two_dim_zero_one_pack</span><span class="params">(F, c, d, w)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(V, c<span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> range(U, d<span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            F[v][u] = max(F[v][u], F[v-c][u-d] + w)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">two_dim_complete_pack</span><span class="params">(F, c, d, w)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(c, V+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> range(d, U+<span class="number">1</span>):</span><br><span class="line">            F[v][u] = max(F[v][u], F[v-c][u-d] + w)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">two_dim_multiple_pack</span><span class="params">(F, c, d, w, m)</span>:</span></span><br><span class="line">    <span class="comment"># ä¸¤ç§costæ•°é‡éƒ½å……è¶³ï¼Œå¯ç›´æ¥æŒ‰ç…§å®Œå…¨èƒŒåŒ…å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> c * m &gt;= V <span class="keyword">and</span> d * m &gt;= U:</span><br><span class="line">        two_dim_complete_pack(F, c, d, w)</span><br><span class="line">    <span class="comment"># å¤šé‡èƒŒåŒ…æŒ‰ç…§2æ¬¡å¹‚è¿›è¡Œåˆ’åˆ†æˆ0-1èƒŒåŒ…</span></span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> k &lt; m:</span><br><span class="line">        two_dim_complete_pack(F, k * c, k * d, k * w)</span><br><span class="line">        m = m - k</span><br><span class="line">        k = <span class="number">2</span> * k</span><br><span class="line">    <span class="comment"># æŠŠå‰©ä½™çš„ç‰©å“å½“ä½œ1ä»¶ç‰©å“</span></span><br><span class="line">    two_dim_zero_one_pack(F, m * c, m * d, m * w)</span><br><span class="line"></span><br><span class="line">F = [[<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)] <span class="keyword">for</span> u <span class="keyword">in</span> range(U+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    two_dim_zero_one_pack(F, C[i], D[i], W[i])</span><br><span class="line">    <span class="comment"># two_dim_complete_pack(F, C[i], D[i], W[i])</span></span><br><span class="line">    <span class="comment"># two_dim_multiple_pack(F, C[i], D[i], W[i], M[i])</span></span><br></pre></td></tr></table></figure>
<h4 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h4><p>äºŒç»´è´¹ç”¨é¢˜ç›®çš„ä¸€ç§éšå«è¡¨è¿°æ–¹å¼ï¼šæœ€å¤šå–Uä»¶</p>
<p>å¯¹äºæœ‰è¿™ç§é™åˆ¶çš„é¢˜ç›®ï¼Œå¯ä»¥å°†â€™ä»¶æ•°â€™çœ‹ä½œä¸€ç§è´¹ç”¨ï¼Œæ¯ä»¶ç‰©å“ä»¶æ•°è´¹ç”¨ä¸º1ï¼Œå¯ä»¥è¾¾åˆ°çš„æœ€å¤§ä»¶æ•°è´¹ç”¨éUï¼Œ<code>dp[v][u]</code>è¡¨ç¤ºcostä¸ºvï¼Œæœ€å¤šé€‰æ‹©uä»¶ç‰©å“æ—¶æ‰€è¾¾åˆ°çš„æœ€å¤§ä»·å€¼ï¼ˆå†æ ¹æ®ç‰©å“çš„ç‰¹æ€§ï¼ˆ0-1,å®Œå…¨ï¼Œå¤šé‡ï¼‰é‡‡ç”¨ä¸åŒçš„æ–¹å¼è¿›è¡Œå¾ªç¯ï¼Œå¾—å‡ºç­”æ¡ˆï¼‰</p>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>èƒŒåŒ…é—®é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title>æ’åºç®—æ³•</title>
    <url>/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="æ’åºç®—æ³•"><a href="#æ’åºç®—æ³•" class="headerlink" title="æ’åºç®—æ³•"></a>æ’åºç®—æ³•</h2><p><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/æ’åº.png" alt="avatar"></p>
<a id="more"></a>
<h3 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h3><h4 id="æ€æƒ³"><a href="#æ€æƒ³" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4><p>æ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ã€‚å®ƒé‡å¤åœ°èµ°è®¿è¿‡è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœå®ƒä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠå®ƒä»¬äº¤æ¢è¿‡æ¥ã€‚èµ°è®¿æ•°åˆ—çš„å·¥ä½œæ˜¯é‡å¤åœ°è¿›è¡Œç›´åˆ°æ²¡æœ‰å†éœ€è¦äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ•°åˆ—å·²ç»æ’åºå®Œæˆã€‚è¿™ä¸ªç®—æ³•çš„åå­—ç”±æ¥æ˜¯å› ä¸ºè¶Šå°çš„å…ƒç´ ä¼šç»ç”±äº¤æ¢æ…¢æ…¢â€œæµ®â€åˆ°æ•°åˆ—çš„é¡¶ç«¯ã€‚</p>
<h4 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><ol>
<li>æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢å®ƒä»¬ä¸¤ä¸ªï¼›</li>
<li>å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ï¼Œè¿™æ ·åœ¨æœ€åçš„å…ƒç´ åº”è¯¥ä¼šæ˜¯æœ€å¤§çš„æ•°ï¼›</li>
<li>é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªï¼›</li>
<li><p>é‡å¤æ­¥éª¤1~3ï¼Œç›´åˆ°æ’åºå®Œæˆã€‚</p>
<h4 id="å¤æ‚åº¦"><a href="#å¤æ‚åº¦" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4></li>
<li><p>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(1)</code></p>
</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼š$O(n^2)$<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bubble_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="comment"># å¤–å±‚å¾ªç¯: èµ°è®¿æ•°æ®çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums) - <span class="number">1</span>):</span><br><span class="line">        <span class="comment"># è®¾ç½®æ˜¯å¦äº¤æ¢æ ‡å¿—ä½</span></span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="comment"># å†…å±‚å¾ªç¯: æ¯æ¬¡èµ°è®¿æ•°æ®æ—¶, ç›¸é‚»å¯¹æ¯”æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(nums) - i - <span class="number">1</span>):</span><br><span class="line">            <span class="comment"># è¦æ±‚ä»ä½åˆ°é«˜</span></span><br><span class="line">            <span class="comment"># å¦‚æ¬¡åºæœ‰è¯¯å°±äº¤æ¢</span></span><br><span class="line">            <span class="keyword">if</span> nums[j] &gt; nums[j + <span class="number">1</span>]:</span><br><span class="line">                nums[j], nums[j + <span class="number">1</span>] = nums[j + <span class="number">1</span>], nums[j]</span><br><span class="line">                <span class="comment"># å‘ç”Ÿäº†æ•°æ®äº¤æ¢</span></span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">        <span class="comment"># å¦‚æœæœªå‘ç”Ÿäº¤æ¢æ•°æ®, åˆ™è¯´æ˜åç»­æ•°æ®å‡æœ‰åº</span></span><br><span class="line">        <span class="keyword">if</span> flag == <span class="literal">False</span>:</span><br><span class="line">            <span class="keyword">break</span>  <span class="comment"># è·³å‡ºæ•°æ®èµ°è®¿</span></span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<h3 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h3><h4 id="æ€æƒ³-1"><a href="#æ€æƒ³-1" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4>å®ƒçš„å·¥ä½œåŸç†ï¼šé¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ï¼Œç„¶åï¼Œå†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚<h4 id="æ­¥éª¤-1"><a href="#æ­¥éª¤-1" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4>nä¸ªè®°å½•çš„ç›´æ¥é€‰æ‹©æ’åºå¯ç»è¿‡n-1è¶Ÿç›´æ¥é€‰æ‹©æ’åºå¾—åˆ°æœ‰åºç»“æœã€‚</li>
<li>åˆå§‹çŠ¶æ€ï¼šæ— åºåŒºä¸º<code>R[1â€¦n]</code>ï¼Œæœ‰åºåŒºä¸ºç©ºï¼›</li>
<li>ç¬¬iè¶Ÿæ’åº<code>(i=1,2,3â€¦n-1)</code>å¼€å§‹æ—¶ï¼Œå½“å‰æœ‰åºåŒºå’Œæ— åºåŒºåˆ†åˆ«ä¸º<code>R[1â€¦i-1]å’ŒR(iâ€¦nï¼‰</code>ã€‚è¯¥è¶Ÿæ’åºä»å½“å‰æ— åºåŒºä¸­-é€‰å‡ºå…³é”®å­—æœ€å°çš„è®°å½• <code>R[k]</code>ï¼Œå°†å®ƒä¸æ— åºåŒºçš„ç¬¬1ä¸ªè®°å½•Räº¤æ¢ï¼Œä½¿<code>R[1â€¦i]</code>å’Œ<code>R[i+1â€¦n)</code>åˆ†åˆ«å˜ä¸ºè®°å½•ä¸ªæ•°å¢åŠ 1ä¸ªçš„æ–°æœ‰åºåŒºå’Œè®°å½•ä¸ªæ•°å‡å°‘1ä¸ªçš„æ–°æ— åºåŒºï¼›</li>
<li>n-1è¶Ÿç»“æŸï¼Œæ•°ç»„æœ‰åºåŒ–äº†ã€‚<h4 id="å¤æ‚åº¦-1"><a href="#å¤æ‚åº¦-1" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4></li>
<li>æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(1)<h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">selection_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line">    size = len(nums)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(size):</span><br><span class="line">        min_idx = i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i+<span class="number">1</span>,size):</span><br><span class="line">            <span class="keyword">if</span> nums[j] &lt; nums[min_idx]:</span><br><span class="line">                min_idx = j</span><br><span class="line">        temp = nums[min_idx]</span><br><span class="line">        nums[min_idx] = nums[i]</span><br><span class="line">        nums[i] = temp</span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<h3 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h3><h4 id="æ€æƒ³-2"><a href="#æ€æƒ³-2" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4>å’Œé€‰æ‹©æ’åºä¸€æ ·ï¼Œå½’å¹¶æ’åºçš„æ€§èƒ½ä¸å—è¾“å…¥æ•°æ®çš„å½±å“ï¼Œä½†è¡¨ç°æ¯”é€‰æ‹©æ’åºå¥½çš„å¤šï¼Œå› ä¸ºå§‹ç»ˆéƒ½æ˜¯O(n log nï¼‰çš„æ—¶é—´å¤æ‚åº¦ã€‚ä»£ä»·æ˜¯éœ€è¦é¢å¤–çš„å†…å­˜ç©ºé—´ã€‚</li>
</ol>
<h4 id="æ­¥éª¤-2"><a href="#æ­¥éª¤-2" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><p><strong>å½’å¹¶æ’åº</strong>æ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚å½’å¹¶æ’åºæ˜¯ä¸€ç§ç¨³å®šçš„æ’åºæ–¹æ³•ã€‚å°†å·²æœ‰åºçš„å­åºåˆ—åˆå¹¶ï¼Œå¾—åˆ°å®Œå…¨æœ‰åºçš„åºåˆ—ï¼›å³å…ˆä½¿æ¯ä¸ªå­åºåˆ—æœ‰åºï¼Œå†ä½¿å­åºåˆ—æ®µé—´æœ‰åºã€‚è‹¥å°†ä¸¤ä¸ªæœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæœ‰åºè¡¨ï¼Œç§°ä¸º2-è·¯å½’å¹¶ã€‚</p>
<ol>
<li>æŠŠé•¿åº¦ä¸ºnçš„è¾“å…¥åºåˆ—åˆ†æˆä¸¤ä¸ªé•¿åº¦ä¸ºn/2çš„å­åºåˆ—ï¼›</li>
<li>å¯¹è¿™ä¸¤ä¸ªå­åºåˆ—åˆ†åˆ«é‡‡ç”¨å½’å¹¶æ’åºï¼›</li>
<li>å°†ä¸¤ä¸ªæ’åºå¥½çš„å­åºåˆ—åˆå¹¶æˆä¸€ä¸ªæœ€ç»ˆçš„æ’åºåºåˆ—ã€‚</li>
</ol>
<h4 id="å¤æ‚åº¦-2"><a href="#å¤æ‚åº¦-2" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><ol>
<li>æ—¶é—´å¤æ‚åº¦$O(nlog_2 n)$</li>
</ol>
<h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(nums) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line"></span><br><span class="line">    mid_idx = len(nums) / <span class="number">2</span></span><br><span class="line">    left_array = nums[<span class="number">0</span>:mid_idx]</span><br><span class="line">    right_array = nums[mid_idx:len(nums)]</span><br><span class="line">    <span class="keyword">return</span> merge(merge_sort(left_array),merge_sort(right_array))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(left_array,right_array)</span>:</span></span><br><span class="line">    <span class="comment"># åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</span></span><br><span class="line">    res = []</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; len(left_array) <span class="keyword">and</span> j &lt; len(right_array):</span><br><span class="line">        <span class="keyword">if</span> left_array[i] &lt; right_array[j]:</span><br><span class="line">            res.append(left_array[i])</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res.append(right_array[j])</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> i &lt; len(left_array):</span><br><span class="line">        res.extend(left_array[i:])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res.extend(right_array[j:])</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<h3 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h3><h4 id="æ€æƒ³-3"><a href="#æ€æƒ³-3" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4><p>é€šè¿‡æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚æ’å…¥æ’åºåœ¨å®ç°ä¸Šï¼Œé€šå¸¸é‡‡ç”¨in-placeæ’åºï¼ˆå³åªéœ€ç”¨åˆ°O(1)çš„é¢å¤–ç©ºé—´çš„æ’åºï¼‰ï¼Œå› è€Œåœ¨ä»åå‘å‰æ‰«æè¿‡ç¨‹ä¸­ï¼Œéœ€è¦åå¤æŠŠå·²æ’åºå…ƒç´ é€æ­¥å‘åæŒªä½ï¼Œä¸ºæœ€æ–°å…ƒç´ æä¾›æ’å…¥ç©ºé—´ã€‚</p>
<h4 id="æ­¥éª¤-3"><a href="#æ­¥éª¤-3" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ’å…¥æ’åºéƒ½é‡‡ç”¨in-placeåœ¨æ•°ç»„ä¸Šå®ç°ã€‚å…·ä½“ç®—æ³•æè¿°å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æ’åºï¼›</li>
<li>å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼›</li>
<li>å¦‚æœè¯¥å…ƒç´ ï¼ˆå·²æ’åºï¼‰å¤§äºæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ ç§»åˆ°ä¸‹ä¸€ä½ç½®ï¼›</li>
<li>é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æ’åºçš„å…ƒç´ å°äºæˆ–è€…ç­‰äºæ–°å…ƒç´ çš„ä½ç½®ï¼›</li>
<li>å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥ä½ç½®åï¼›</li>
<li><p>é‡å¤æ­¥éª¤2~5ã€‚</p>
<h4 id="å¤æ‚åº¦-3"><a href="#å¤æ‚åº¦-3" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4></li>
<li><p>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(1)</code></p>
</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼š$O(n^2)$</li>
</ol>
<h4 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(nums)):</span><br><span class="line">        temp = nums[i]</span><br><span class="line">        pos = i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> temp &lt; nums[j]:</span><br><span class="line">                nums[j + <span class="number">1</span>] = nums[j]</span><br><span class="line">                pos = j</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pos = j + <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        nums[pos] = temp</span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<h3 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h3><p>å¸Œå°”æ’åºæ˜¯å¸Œå°”ï¼ˆDonald Shellï¼‰ äº1959å¹´æå‡ºçš„ä¸€ç§æ’åºç®—æ³•ã€‚å¸Œå°”æ’åºä¹Ÿæ˜¯ä¸€ç§æ’å…¥æ’åºï¼Œå®ƒæ˜¯ç®€å•æ’å…¥æ’åºç»è¿‡æ”¹è¿›ä¹‹åçš„ä¸€ä¸ªæ›´é«˜æ•ˆçš„ç‰ˆæœ¬ï¼Œä¹Ÿç§°ä¸ºç¼©å°å¢é‡æ’åºï¼ŒåŒæ—¶è¯¥ç®—æ³•æ˜¯å†²ç ´O(n2ï¼‰çš„ç¬¬ä¸€æ‰¹ç®—æ³•ä¹‹ä¸€ã€‚å®ƒä¸æ’å…¥æ’åºçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä¼šä¼˜å…ˆæ¯”è¾ƒè·ç¦»è¾ƒè¿œçš„å…ƒç´ ã€‚å¸Œå°”æ’åºåˆå«ç¼©å°å¢é‡æ’åºã€‚</p>
<h4 id="æ€æƒ³-4"><a href="#æ€æƒ³-4" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4><p>å¸Œå°”æ’åºæ˜¯æŠŠè®°å½•æŒ‰ä¸‹è¡¨çš„ä¸€å®šå¢é‡åˆ†ç»„ï¼Œå¯¹æ¯ç»„ä½¿ç”¨ç›´æ¥æ’å…¥æ’åºç®—æ³•æ’åºï¼›éšç€å¢é‡é€æ¸å‡å°‘ï¼Œæ¯ç»„åŒ…å«çš„å…³é”®è¯è¶Šæ¥è¶Šå¤šï¼Œå½“å¢é‡å‡è‡³1æ—¶ï¼Œæ•´ä¸ªæ–‡ä»¶æ°è¢«åˆ†æˆä¸€ç»„ï¼Œç®—æ³•ä¾¿ç»ˆæ­¢ã€‚</p>
<h4 id="æ­¥éª¤-4"><a href="#æ­¥éª¤-4" class="headerlink" title="æ­¥éª¤:"></a>æ­¥éª¤:</h4><p>å…ˆå°†æ•´ä¸ªå¾…æ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åº,å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>é€‰æ‹©ä¸€ä¸ªå¢é‡åºåˆ—<code>t1ï¼Œt2ï¼Œâ€¦ï¼Œtk</code>ï¼Œå…¶ä¸­<code>ti&gt;tjï¼Œtk=1</code>ï¼›</li>
<li>æŒ‰å¢é‡åºåˆ—ä¸ªæ•°kï¼Œå¯¹åºåˆ—è¿›è¡Œ k è¶Ÿæ’åºï¼›</li>
<li>æ¯è¶Ÿæ’åºï¼Œæ ¹æ®å¯¹åº”çš„å¢é‡tiï¼Œå°†å¾…æ’åºåˆ—åˆ†å‰²æˆè‹¥å¹²é•¿åº¦ä¸º m çš„å­åºåˆ—ï¼Œåˆ†åˆ«å¯¹å„å­è¡¨è¿›è¡Œç›´æ¥æ’å…¥æ’åºã€‚ä»…å¢é‡å› å­ä¸º1 æ—¶ï¼Œæ•´ä¸ªåºåˆ—ä½œä¸ºä¸€ä¸ªè¡¨æ¥å¤„ç†ï¼Œè¡¨é•¿åº¦å³ä¸ºæ•´ä¸ªåºåˆ—çš„é•¿åº¦ã€‚<br><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/aHR0cHM6Ly9pbWFnZXMyMDE4LmNuYmxvZ3MuY29tL2Jsb2cvMTE5MjY5OS8yMDE4MDMvMTE5MjY5OS0yMDE4MDMxOTA5NDExNjA0MC0xNjM4NzY2MjcxLnBuZw.png" alt="avat"><h4 id="å¤æ‚åº¦-4"><a href="#å¤æ‚åº¦-4" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4></li>
<li>æ—¶é—´å¤æ‚åº¦$O(nlog_2 n)$<h4 id="ä»£ç -4"><a href="#ä»£ç -4" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    size = len(nums)</span><br><span class="line">    gap = size / <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> gap:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(gap, size):</span><br><span class="line">            temp = nums[i]</span><br><span class="line">            pre_index = i - gap</span><br><span class="line">            <span class="comment"># å¯¹äºåˆ’åˆ†åˆ°ä¸€ç»„å†…çš„æ•°è¿›è¡Œæ’åº</span></span><br><span class="line">            <span class="keyword">while</span> pre_index &gt;= <span class="number">0</span> <span class="keyword">and</span> nums[pre_index] &gt; temp:</span><br><span class="line">                nums[pre_index + gap] = nums[pre_index]</span><br><span class="line">                pre_index -= gap</span><br><span class="line">            <span class="comment"># æ’å…¥</span></span><br><span class="line">            nums[pre_index+gap] = temp</span><br><span class="line">        </span><br><span class="line">        gap /= <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<h3 id="å¿«æ’"><a href="#å¿«æ’" class="headerlink" title="å¿«æ’"></a>å¿«æ’</h3><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/1450319-20190525163106857-545290968.png" alt="avatar"><h4 id="æ­¥éª¤-5"><a href="#æ­¥éª¤-5" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4>å¿«é€Ÿæ’åºä½¿ç”¨åˆ†æ²»æ³•æ¥æŠŠä¸€ä¸ªä¸²ï¼ˆlistï¼‰åˆ†ä¸ºä¸¤ä¸ªå­ä¸²ï¼ˆsub-listsï¼‰ã€‚</li>
<li>ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç§°ä¸º â€œåŸºå‡†â€ï¼ˆpivot ï¼‰</li>
<li>é‡æ–°æ’åºæ•°åˆ—ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹åï¼Œè¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸ºåˆ†åŒºï¼ˆpartitionï¼‰æ“ä½œ</li>
<li><p>é€’å½’åœ°ï¼ˆrecursiveï¼‰æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºã€‚<br>å¤æ‚åº¦:</p>
</li>
<li><p>æ—¶é—´å¤æ‚åº¦ï¼š$O(nlogn)$</p>
</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼š$O(logn)$</li>
<li>ç¨³å®šæ€§ï¼šä¸ç¨³å®š<h4 id="ä»£ç -5"><a href="#ä»£ç -5" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quick_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="comment"># é€’å½’é€€å‡ºæ¡ä»¶</span></span><br><span class="line">    <span class="comment"># ä»…å‰©ä¸€ä¸ªå…ƒç´ æ— éœ€ç»§ç»­åˆ†ç»„</span></span><br><span class="line">    <span class="keyword">if</span> len(nums) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line">        <span class="comment"># è®¾ç½®å…³é”®æ•°æ®</span></span><br><span class="line">    a = nums[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># æ‰¾å‡ºæ‰€æœ‰æ¯” a å¤§çš„æ•°æ®</span></span><br><span class="line">    big = [x <span class="keyword">for</span> x <span class="keyword">in</span> nums <span class="keyword">if</span> x &gt; a]</span><br><span class="line">    <span class="comment"># æ‰¾å‡ºæ‰€æœ‰æ¯” a å°çš„æ•°æ®</span></span><br><span class="line">    small = [x <span class="keyword">for</span> x <span class="keyword">in</span> nums <span class="keyword">if</span> x &lt; a]</span><br><span class="line">    <span class="comment"># æ‰¾å‡ºæ‰€æœ‰ä¸ a ç›¸ç­‰çš„æ•°æ®</span></span><br><span class="line">    same = [x <span class="keyword">for</span> x <span class="keyword">in</span> nums <span class="keyword">if</span> x == a]</span><br><span class="line">    <span class="comment"># æ‹¼æ¥æ•°æ®æ’åºçš„ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> quick_sort(small) + same + quick_sort(big)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h3><p>å †æ’åºï¼ˆHeapsortï¼‰ æ˜¯æŒ‡åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ã€‚å †ç§¯æ˜¯ä¸€ä¸ªè¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘çš„ç»“æ„ï¼Œå¹¶åŒæ—¶æ»¡è¶³å †ç§¯çš„æ€§è´¨ï¼šå³å­ç»“ç‚¹çš„é”®å€¼æˆ–ç´¢å¼•æ€»æ˜¯å°äºï¼ˆæˆ–è€…å¤§äºï¼‰å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚</p>
<h4 id="æ­¥éª¤-6"><a href="#æ­¥éª¤-6" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><ol>
<li>å°†åˆå§‹å¾…æ’åºå…³é”®å­—åºåˆ—(R1,R2â€¦.Rn)æ„å»ºæˆå¤§é¡¶å †ï¼Œæ­¤å †ä¸ºåˆå§‹çš„æ— åºåŒºï¼›</li>
<li>å°†å †é¡¶å…ƒç´ R[1]ä¸æœ€åä¸€ä¸ªå…ƒç´ R[n]äº¤æ¢ï¼Œæ­¤æ—¶å¾—åˆ°æ–°çš„æ— åºåŒº<code>(R1,R2,â€¦â€¦Rn-1)</code>å’Œæ–°çš„æœ‰åºåŒº(Rn),ä¸”æ»¡è¶³<code>R[1,2â€¦n-1]&lt;=R[n]</code>ï¼›</li>
<li>ç”±äºäº¤æ¢åæ–°çš„å †é¡¶R[1]å¯èƒ½è¿åå †çš„æ€§è´¨ï¼Œå› æ­¤éœ€è¦å¯¹å½“å‰æ— åºåŒº<code>(R1,R2,â€¦â€¦Rn-1)</code>è°ƒæ•´ä¸ºæ–°å †ï¼Œç„¶åå†æ¬¡å°†R[1]ä¸æ— åºåŒºæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œå¾—åˆ°æ–°çš„æ— åºåŒº<code>(R1,R2â€¦.Rn-2)</code>å’Œæ–°çš„æœ‰åºåŒº<code>(Rn-1,Rn)</code>ã€‚ä¸æ–­é‡å¤æ­¤è¿‡ç¨‹ç›´åˆ°æœ‰åºåŒºçš„å…ƒç´ ä¸ªæ•°ä¸ºn-1ï¼Œåˆ™æ•´ä¸ªæ’åºè¿‡ç¨‹å®Œæˆã€‚</li>
</ol>
<p><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/CA6B626B-98BA-4AA5-BC01-FDAFE554BB87.gif" alt="avatar"></p>
<h4 id="å¤æ‚åº¦-5"><a href="#å¤æ‚åº¦-5" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><ol>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO(nlogn)<h4 id="ä»£ç -6"><a href="#ä»£ç -6" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">heap_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    size = len(nums)</span><br><span class="line">    <span class="keyword">if</span> size &lt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line">    <span class="comment"># æ„å»ºä¸€ä¸ªæœ€å¤§å †</span></span><br><span class="line">    build_max_heap(nums)</span><br><span class="line">    <span class="comment"># å¾ªç¯å°†æ ¹å’Œæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œç„¶åé‡æ–°è°ƒæ•´æœ€å¤§å †ã€‚</span></span><br><span class="line">    <span class="keyword">while</span> size &gt; <span class="number">0</span>:</span><br><span class="line">        temp = nums[<span class="number">0</span>]</span><br><span class="line">        nums[<span class="number">0</span>] = nums[size - <span class="number">1</span>]</span><br><span class="line">        nums[size - <span class="number">1</span>] = temp</span><br><span class="line"></span><br><span class="line">        size -= <span class="number">1</span></span><br><span class="line">        adjust_heap(nums, <span class="number">0</span>,size)</span><br><span class="line">    <span class="keyword">return</span> nums</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_max_heap</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="comment"># ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹å‘ä¸Šæ„é€ æœ€å¤§å †</span></span><br><span class="line">    <span class="comment"># i çš„å·¦å­æ ‘å’Œå³å­æ ‘åˆ†åˆ«ä¸º2i+1 å’Œ 2(i+1)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums) / <span class="number">2</span><span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        adjust_heap(nums, i,len(nums))</span><br><span class="line">    <span class="comment"># return nums</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adjust_heap</span><span class="params">(nums, i,size)</span>:</span></span><br><span class="line">    max_index = i</span><br><span class="line">    <span class="comment"># å¦‚æœæœ‰å·¦å­æ ‘ï¼Œä¸”å·¦å­æ ‘å¤§äºçˆ¶èŠ‚ç‚¹ï¼Œåˆ™å°†æœ€å¤§æŒ‡é’ˆæŒ‡å‘å·¦å­æ ‘</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">2</span> * i + <span class="number">1</span> &lt; size <span class="keyword">and</span> nums[<span class="number">2</span> * i + <span class="number">1</span>] &gt; nums[max_index]:</span><br><span class="line">        max_index = <span class="number">2</span> * i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">2</span> * (i + <span class="number">1</span>) &lt; size <span class="keyword">and</span> nums[<span class="number">2</span> * (i + <span class="number">1</span>)] &gt; nums[max_index]:</span><br><span class="line">        max_index = <span class="number">2</span> * (i + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> max_index == i:</span><br><span class="line">        temp = nums[max_index]</span><br><span class="line">        nums[max_index] = nums[i]</span><br><span class="line">        nums[i] = temp</span><br><span class="line">        adjust_heap(nums, max_index,size)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="è®¡æ•°æ’åº"><a href="#è®¡æ•°æ’åº" class="headerlink" title="è®¡æ•°æ’åº"></a>è®¡æ•°æ’åº</h3><p><strong>è®¡æ•°æ’åº</strong>çš„æ ¸å¿ƒåœ¨äºå°†è¾“å…¥çš„æ•°æ®å€¼è½¬åŒ–ä¸ºé”®å­˜å‚¨åœ¨é¢å¤–å¼€è¾Ÿçš„æ•°ç»„ç©ºé—´ä¸­ã€‚ ä½œä¸ºä¸€ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºï¼Œè®¡æ•°æ’åºè¦æ±‚è¾“å…¥çš„æ•°æ®å¿…é¡»æ˜¯æœ‰ç¡®å®šèŒƒå›´çš„æ•´æ•°ã€‚</p>
<h4 id="åŸºæœ¬æ€æƒ³"><a href="#åŸºæœ¬æ€æƒ³" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h4><p>è®¡æ•°æ’åº(Counting sort) æ˜¯ä¸€ç§ç¨³å®šçš„æ’åºç®—æ³•ã€‚è®¡æ•°æ’åºä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„æ•°ç»„Cï¼Œå…¶ä¸­ç¬¬iä¸ªå…ƒç´ æ˜¯å¾…æ’åºæ•°ç»„Aä¸­å€¼ç­‰äºiçš„å…ƒç´ çš„ä¸ªæ•°ã€‚ç„¶åæ ¹æ®æ•°ç»„Cæ¥å°†Aä¸­çš„å…ƒç´ æ’åˆ°æ­£ç¡®çš„ä½ç½®ã€‚å®ƒ<strong>åªèƒ½å¯¹æ•´æ•°è¿›è¡Œæ’åº</strong>ã€‚<br><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/E4559E2C-6389-4EAB-976A-95289A079EB8.gif" alt="avatar"></p>
<h4 id="ç®—æ³•æ­¥éª¤"><a href="#ç®—æ³•æ­¥éª¤" class="headerlink" title="ç®—æ³•æ­¥éª¤"></a>ç®—æ³•æ­¥éª¤</h4><ol>
<li>æ‰¾å‡ºå¾…æ’åºçš„æ•°ç»„ä¸­æœ€å¤§å’Œæœ€å°çš„å…ƒç´ </li>
<li>ç»Ÿè®¡æ•°ç»„ä¸­æ¯ä¸ªå€¼ä¸ºiçš„å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå­˜å…¥æ•°ç»„Cçš„ç¬¬ié¡¹</li>
<li>å¯¹æ‰€æœ‰çš„è®¡æ•°ç´¯åŠ ï¼ˆä»Cä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œæ¯ä¸€é¡¹å’Œå‰ä¸€é¡¹ç›¸åŠ ï¼‰</li>
<li>åå‘å¡«å……ç›®æ ‡æ•°ç»„ï¼šå°†æ¯ä¸ªå…ƒç´ iæ”¾åœ¨æ–°æ•°ç»„çš„ç¬¬C(i)é¡¹ï¼Œæ¯æ”¾ä¸€ä¸ªå…ƒç´ å°±å°†C(i)å‡å»1ã€‚<h4 id="å¤æ‚åº¦-6"><a href="#å¤æ‚åº¦-6" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4></li>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO(n+k)<h4 id="ä»£ç -7"><a href="#ä»£ç -7" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_sort</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="comment"># è·å–arrä¸­çš„æœ€å¤§å€¼å’Œæœ€å°å€¼</span></span><br><span class="line">    max_num = max(arr)</span><br><span class="line">    min_num = min(arr)</span><br><span class="line">    <span class="comment"># ä»¥æœ€å¤§å€¼å’Œæœ€å°å€¼çš„å·®ä½œä¸ºä¸­é—´æ•°ç»„çš„é•¿åº¦,å¹¶æ„å»ºä¸­é—´æ•°ç»„ï¼Œåˆå§‹åŒ–ä¸º0</span></span><br><span class="line">    length = max_num - min_num + <span class="number">1</span></span><br><span class="line">    temp_arr = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(length)]</span><br><span class="line">    <span class="comment"># åˆ›å»ºç»“æœListï¼Œå­˜æ”¾æ’åºå®Œæˆçš„ç»“æœ</span></span><br><span class="line">    res_arr = list(range(len(arr)))</span><br><span class="line">    <span class="comment"># ç¬¬ä¸€æ¬¡å¾ªç¯éå†</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> arr:</span><br><span class="line">        temp_arr[num - min_num] += <span class="number">1</span></span><br><span class="line">    <span class="comment"># ç¬¬äºŒæ¬¡å¾ªç¯éå†</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, length):</span><br><span class="line">        temp_arr[i] = temp_arr[i] + temp_arr[i - <span class="number">1</span>]</span><br><span class="line">    <span class="comment"># ç¬¬ä¸‰æ¬¡å¾ªç¯éå†</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(arr) - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        res_arr[temp_arr[arr[i] - min_num] - <span class="number">1</span>] = arr[i]</span><br><span class="line">        temp_arr[arr[i] - min_num] -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res_arr</span><br></pre></td></tr></table></figure>
<h3 id="æ¡¶æ’åº"><a href="#æ¡¶æ’åº" class="headerlink" title="æ¡¶æ’åº"></a>æ¡¶æ’åº</h3>æ¡¶æ’åº æ˜¯è®¡æ•°æ’åºçš„å‡çº§ç‰ˆã€‚å®ƒåˆ©ç”¨äº†å‡½æ•°çš„æ˜ å°„å…³ç³»ï¼Œé«˜æ•ˆä¸å¦çš„å…³é”®å°±åœ¨äºè¿™ä¸ªæ˜ å°„å‡½æ•°çš„ç¡®å®šã€‚</li>
</ol>
<h4 id="åŸºæœ¬æ€æƒ³-1"><a href="#åŸºæœ¬æ€æƒ³-1" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h4><p>å‡è®¾è¾“å…¥æ•°æ®æœä»å‡åŒ€åˆ†å¸ƒï¼Œå°†æ•°æ®åˆ†åˆ°æœ‰é™æ•°é‡çš„æ¡¶é‡Œï¼Œæ¯ä¸ªæ¡¶å†åˆ†åˆ«æ’åºï¼ˆæœ‰å¯èƒ½å†ä½¿ç”¨åˆ«çš„æ’åºç®—æ³•æˆ–æ˜¯ä»¥é€’å½’æ–¹å¼ç»§ç»­ä½¿ç”¨æ¡¶æ’åºè¿›è¡Œæ’</p>
<p><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/D7FA465B-93A5-493B-BE2B-15375A28FAE2.gif" alt="avatar"></p>
<h4 id="ç®—æ³•æ­¥éª¤-1"><a href="#ç®—æ³•æ­¥éª¤-1" class="headerlink" title="ç®—æ³•æ­¥éª¤"></a>ç®—æ³•æ­¥éª¤</h4><ol>
<li>æ ¹æ®æ•°æ®åˆ†æ¡¶</li>
<li>éå†æ•°ç»„ï¼ŒæŠŠæ•°æ®ä¸€ä¸ªä¸€ä¸ªæ”¾åˆ°å¯¹åº”çš„æ¡¶ä¸­ã€‚</li>
<li>å¯¹æ¯ä¸ªä¸æ˜¯ç©ºçš„æ¡¶è¿›è¡Œæ’åºï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–æ’åºæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥é€’å½’ä½¿ç”¨æ¡¶æ’åºã€‚</li>
<li>ä»ä¸æ˜¯ç©ºçš„æ¡¶é‡ŒæŠŠæ’å¥½åºçš„æ•°æ®æ‹¼æ¥èµ·æ¥ã€‚<h4 id="å¤æ‚åº¦-7"><a href="#å¤æ‚åº¦-7" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4></li>
<li>æ—¶é—´å¤æ‚åº¦ï¼šæœ€å¥½æƒ…å†µä¸‹ä½¿ç”¨çº¿æ€§æ—¶é—´O(n)ï¼Œæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼Œå–å†³ä¸å¯¹å„ä¸ªæ¡¶ä¹‹é—´æ•°æ®è¿›è¡Œæ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼Œå› ä¸ºå…¶å®ƒéƒ¨åˆ†çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(n)ã€‚å¾ˆæ˜¾ç„¶ï¼Œæ¡¶åˆ’åˆ†çš„è¶Šå°ï¼Œå„ä¸ªæ¡¶ä¹‹é—´çš„æ•°æ®è¶Šå°‘ï¼Œæ’åºæ‰€ç”¨çš„æ—¶é—´ä¹Ÿä¼šè¶Šå°‘ã€‚<h4 id="ä»£ç -8"><a href="#ä»£ç -8" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, k)</span>:</span></span><br><span class="line">        self.key = k;</span><br><span class="line">        self.next = <span class="literal">None</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bucket_sort</span><span class="params">(arr,bucket_num)</span>:</span></span><br><span class="line">    h = [];</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, bucket_num):</span><br><span class="line">        h.append(node(<span class="number">0</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(arr)):</span><br><span class="line">        tmp = node(arr[i])</span><br><span class="line">        map = arr[i] / bucket_num</span><br><span class="line">        p = h[map]</span><br><span class="line">        <span class="keyword">if</span> p.key <span class="keyword">is</span> <span class="number">0</span>:</span><br><span class="line">            h[map].next = tmp</span><br><span class="line">            h[map].key = h[map].key + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">while</span> (p.next != <span class="literal">None</span> <span class="keyword">and</span> p.next.key &lt;= tmp.key):</span><br><span class="line">                p = p.next</span><br><span class="line">            tmp.next = p.next</span><br><span class="line">            p.next = tmp</span><br><span class="line">            h[map].key = h[map].key + <span class="number">1</span></span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">        q = h[i].next</span><br><span class="line">        <span class="keyword">while</span> (q != <span class="literal">None</span>):</span><br><span class="line">            arr[k] = q.key</span><br><span class="line">            k = k + <span class="number">1</span></span><br><span class="line">            q = q.next</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="åŸºæ•°æ’åº"><a href="#åŸºæ•°æ’åº" class="headerlink" title="åŸºæ•°æ’åº"></a>åŸºæ•°æ’åº</h3><p>åŸºæ•°æ’åºä¹Ÿæ˜¯éæ¯”è¾ƒçš„æ’åºç®—æ³•ï¼Œå¯¹æ¯ä¸€ä½è¿›è¡Œæ’åºï¼Œä»æœ€ä½ä½å¼€å§‹æ’åºï¼Œå¤æ‚åº¦ä¸ºO(kn),ä¸ºæ•°ç»„é•¿åº¦ï¼Œkä¸ºæ•°ç»„ä¸­çš„æ•°çš„æœ€å¤§çš„ä½æ•°ï¼›</p>
<h4 id="åŸºæœ¬æ€æƒ³-2"><a href="#åŸºæœ¬æ€æƒ³-2" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h4><p>åŸºæ•°æ’åºæ˜¯æŒ‰ç…§ä½ä½å…ˆæ’åºï¼Œç„¶åæ”¶é›†ï¼›å†æŒ‰ç…§é«˜ä½æ’åºï¼Œç„¶åå†æ”¶é›†ï¼›ä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°æœ€é«˜ä½ã€‚æœ‰æ—¶å€™æœ‰äº›å±æ€§æ˜¯æœ‰ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œå…ˆæŒ‰ä½ä¼˜å…ˆçº§æ’åºï¼Œå†æŒ‰é«˜ä¼˜å…ˆçº§æ’åºã€‚æœ€åçš„æ¬¡åºå°±æ˜¯é«˜ä¼˜å…ˆçº§é«˜çš„åœ¨å‰ï¼Œé«˜ä¼˜å…ˆçº§ç›¸åŒçš„ä½ä¼˜å…ˆçº§é«˜çš„åœ¨å‰ã€‚åŸºæ•°æ’åºåŸºäºåˆ†åˆ«æ’åºï¼Œåˆ†åˆ«æ”¶é›†ï¼Œæ‰€ä»¥æ˜¯ç¨³å®šçš„ã€‚<br><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/2BA80F27-FCDC-4BEA-BD0B-2AAB59242752.gif" alt="avatar"></p>
<h4 id="ç®—æ³•æ­¥éª¤-2"><a href="#ç®—æ³•æ­¥éª¤-2" class="headerlink" title="ç®—æ³•æ­¥éª¤"></a>ç®—æ³•æ­¥éª¤</h4><ol>
<li>å–å¾—æ•°ç»„ä¸­çš„æœ€å¤§æ•°ï¼Œå¹¶å–å¾—ä½æ•°ï¼›</li>
<li>arrä¸ºåŸå§‹æ•°ç»„ï¼Œä»æœ€ä½ä½å¼€å§‹å–æ¯ä¸ªä½ç»„æˆradixæ•°ç»„ï¼›</li>
<li>å¯¹radixè¿›è¡Œè®¡æ•°æ’åºï¼ˆåˆ©ç”¨è®¡æ•°æ’åºé€‚ç”¨äºå°èŒƒå›´æ•°çš„ç‰¹ç‚¹ï¼‰ï¼›</li>
</ol>
<h4 id="å¤æ‚åº¦-8"><a href="#å¤æ‚åº¦-8" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><ol>
<li>æ—¶é—´å¤æ‚åº¦ï¼šOï¼ˆknï¼‰</li>
</ol>
<h4 id="ä»£ç -9"><a href="#ä»£ç -9" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">radix_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    k = len(str(max(nums)))  <span class="comment"># æœ€å¤§çš„æ•°çš„ä½æ•°</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">        tong = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">            tong[int(num / (<span class="number">10</span> ** i)) % <span class="number">10</span>].append(num)  <span class="comment"># è·å–å½“å‰æ’åºä½æ•°ä¸Šçš„æ•°å­—</span></span><br><span class="line">        <span class="comment">#print(tong)</span></span><br><span class="line">        nums = []</span><br><span class="line">        <span class="keyword">for</span> zitong <span class="keyword">in</span> tong:</span><br><span class="line">            nums = nums + zitong</span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ä¸“ä¸šæŠ€èƒ½</tag>
        <tag>æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title>æŸ¥æ‰¾ç®—æ³•</title>
    <url>/2018/02/10/%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ç®€å•æœç´¢æŸ¥æ‰¾"><a href="#ç®€å•æœç´¢æŸ¥æ‰¾" class="headerlink" title="ç®€å•æœç´¢æŸ¥æ‰¾"></a>ç®€å•æœç´¢æŸ¥æ‰¾</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">brute_force_search</span><span class="params">(nums,key)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">        <span class="keyword">if</span> num == key:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="äºŒåˆ†æŸ¥æ‰¾"><a href="#äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾"></a>äºŒåˆ†æŸ¥æ‰¾</h3><p>å‰æï¼šæ•°ç»„æœ‰åº</p>
<h4 id="è¿­ä»£ç‰ˆæœ¬"><a href="#è¿­ä»£ç‰ˆæœ¬" class="headerlink" title="è¿­ä»£ç‰ˆæœ¬"></a>è¿­ä»£ç‰ˆæœ¬</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search</span><span class="params">(nums, key)</span>:</span></span><br><span class="line">    low = <span class="number">0</span></span><br><span class="line">    high = len(nums) - <span class="number">1</span></span><br><span class="line">    time = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> low &lt; high:</span><br><span class="line">        time += <span class="number">1</span></span><br><span class="line">        mid = int((low + high) / <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> key &lt; nums[mid]:</span><br><span class="line">            high = mid - <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> key &gt; nums[mid]:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># æ‰“å°æŠ˜åŠçš„æ¬¡æ•°</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"success! times: %s"</span> % time</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"fail! times: %s"</span> % time</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h4 id="é€’å½’ç‰ˆæœ¬"><a href="#é€’å½’ç‰ˆæœ¬" class="headerlink" title="é€’å½’ç‰ˆæœ¬"></a>é€’å½’ç‰ˆæœ¬</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search_recursive</span><span class="params">(nums, item)</span>:</span></span><br><span class="line">    mid = len(nums) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> nums[mid] == item:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> mid == <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># midç­‰äº0å°±æ˜¯æ‰¾åˆ°æœ€åä¸€ä¸ªå…ƒç´ äº†ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> item &gt; nums[mid]:  <span class="comment"># æ‰¾ååŠéƒ¨åˆ†</span></span><br><span class="line">            <span class="comment"># print(lst[mid:])</span></span><br><span class="line">            <span class="keyword">return</span> binary_search_recursive(nums[mid:], item)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> binary_search_recursive(nums[:mid], item)  <span class="comment"># æ‰¾å‰åŠéƒ¨åˆ†</span></span><br></pre></td></tr></table></figure>
<h3 id="Hash-æŸ¥æ‰¾"><a href="#Hash-æŸ¥æ‰¾" class="headerlink" title="Hash æŸ¥æ‰¾"></a>Hash æŸ¥æ‰¾</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashTable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size)</span>:</span></span><br><span class="line">        self.elem = [<span class="literal">None</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(size)]  <span class="comment"># ä½¿ç”¨listæ•°æ®ç»“æ„ä½œä¸ºå“ˆå¸Œè¡¨å…ƒç´ ä¿å­˜æ–¹æ³•</span></span><br><span class="line">        self.count = size  <span class="comment"># æœ€å¤§è¡¨é•¿</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hash</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> key % self.count  <span class="comment"># æ•£åˆ—å‡½æ•°é‡‡ç”¨é™¤ç•™ä½™æ•°æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert_hash</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""æ’å…¥å…³é”®å­—åˆ°å“ˆå¸Œè¡¨å†…"""</span></span><br><span class="line">        address = self.hash(key)  <span class="comment"># æ±‚æ•£åˆ—åœ°å€</span></span><br><span class="line">        <span class="keyword">while</span> self.elem[address]:  <span class="comment"># å½“å‰ä½ç½®å·²ç»æœ‰æ•°æ®äº†ï¼Œå‘ç”Ÿå†²çªã€‚</span></span><br><span class="line">            address = (address+<span class="number">1</span>) % self.count  <span class="comment"># çº¿æ€§æ¢æµ‹ä¸‹ä¸€åœ°å€æ˜¯å¦å¯ç”¨</span></span><br><span class="line">        self.elem[address] = key  <span class="comment"># æ²¡æœ‰å†²çªåˆ™ç›´æ¥ä¿å­˜ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search_hash</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""æŸ¥æ‰¾å…³é”®å­—ï¼Œè¿”å›å¸ƒå°”å€¼"""</span></span><br><span class="line">        star = address = self.hash(key)</span><br><span class="line">        <span class="keyword">while</span> self.elem[address] != key:</span><br><span class="line">            address = (address + <span class="number">1</span>) % self.count</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.elem[address] <span class="keyword">or</span> address == star:  <span class="comment"># è¯´æ˜æ²¡æ‰¾åˆ°æˆ–è€…å¾ªç¯åˆ°äº†å¼€å§‹çš„ä½ç½®</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">      </span><br><span class="line">     </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># hashæŸ¥æ‰¾</span></span><br><span class="line">    list_a = [<span class="number">12</span>, <span class="number">67</span>, <span class="number">56</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">37</span>, <span class="number">22</span>, <span class="number">29</span>, <span class="number">15</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">34</span>]</span><br><span class="line">    hash_table = HashTable(len(list_a))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> list_a:</span><br><span class="line">        hash_table.insert_hash(i)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> hash_table.elem:</span><br><span class="line">        <span class="keyword">if</span> i:</span><br><span class="line">            print(i, hash_table.elem.index(i))</span><br><span class="line"></span><br><span class="line">    print(hash_table.search_hash(<span class="number">15</span>))</span><br><span class="line">    print(hash_table.search_hash(<span class="number">33</span>))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>æŸ¥æ‰¾ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexoå†™ä½œæŠ€å·§</title>
    <url>/2018/02/09/hexo-writing-skills/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">è¯·è¾“å…¥å¯†ç ä»¥é˜…è¯»è¿™ç¯‡ç§å¯†æ–‡ç« ã€‚</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="6febbc3b5688c74f9c57bf7c23f35f2b45688d15a68bfc8c5ec17d0778442c64">04b96cf03f1b5d00286d72390b6bf2e0817acbfddb7147d2fcc01912c7f5c0f9713c9c317ba53b9347fde83c930f8c77af411014f8ec84eef7465f6027f6e563b20763efbf9fac1db105face649d36b82b8e5a28894e0322accb07eba0f38491487fddc38b18732e21e4d5a09a208486db90f1b471e152ae582639c98996b3d9545b516ad74403d379a378e897878b9754f5f3c9a9c1cbf034ea3b155b6217c7c2a8ce65fc5458e94d70325ea68e520fea1f3d22f56b6349aee20af7ed199e2c05d5058ef826f483bf40a5fd1d5f80699b8219f40947ecaa012188919bc2fd0944b2b5f8ef475b2f9e253d4f72a6606a1c758ab965e388a3f5f738ddba60d11df6633ca126fc2c4a451982124862d23264d570529db35abb1b751e2dffd5670a5cd5cda9ce5f7383dace45cc07c15de907fa244376f834ac253bcaa2e59897750ef4b4d9c9dfe28d221c72c8a26715aa8ec83d72fc0f43077ab0828ba4233e0c76d781496082cb1d82db37990136ca0e9cc4667ea66ad6d9da7a3268f028a373459ee12ac21be7121d827e304487bd466fb5d245e4a5d8e631dc778052153b1749330c6a4180eddb9c8db21a9b8c063ab5841cad12a45d7ef48cdb4609ba83ac061e8bc5d332f995699eea655084a131e9777fae8edab489b81c9f24691d0813144668c49782f5b3413490e5f8c626883454e8da7a8348537ec7806bb94338ac692345d9c86511f7a390f4c001804a8c3956154ffbdb6ce6750ce5714cb4cdbdb6eb172638f428883e6931a56308bb0c32f5713fc29d225ae2ce26de454942a38e21ccb8ef1c979f046002edcfc16de78d5d575f4382d559d78dce1c3dc6f94a33c8c81f40c2a01a38b8d36c0c18eb5efbedebdc45eeb979fcad808cf7415633034e593a968616ae03b4fcd896e6497b216269a22964fcc068e168cc22974afbbc1167d01603d975f9405837cbbc8c2901205a950ad3b4e510ba8f54daa87bad015378c0625216cabb9b1f4054e0db2a7820cd70925d9456eab62173978d3b23ee02001029f4d91c8dacf07238c064a7e3ff25f4bbb75e6daac3c99f54639843a33111ace5e75f88d3c318ef4409486738aad523ba453c922367e4eee5762b0646689764e28f4fa435733d930e655c81a58027bd3532ea9001f51104d21e7f5c8a80d25f0eec1f165cca84004a36473b3f15ccf2d3e0d62eb7aa8e641e3206c1549a98e1effa02203368b84f8113e5e7c607a74ee1efbd6ab02fa5a3f6a1a9c46dcf36c63d439f407a174b0407fe186449c22edaa63b0f8249555e26e5be60cf07617ef627c04002c4c7859bd6fcde62b70aed76abb33503dc5da4d853abd31c9701215cc2ac4ff890338b8ab44889d344abca3f032249ff35c527568b1c8112cc10d46e96f0d53f50f8620f4b8471a3432152e335aff2a7510018679796f007d6c996f3ae974c56169465e4ddf8455bfabe1e0baef3e26663e6c6d56530b9893644698bd18e0353943e05bcbdcaeb40e82d7f50edc59b7aad3f1608df9f3edb515751975f3f6ceb73a8bce2ae6102de1e082d99461c5862b3d30f2fbd093b7e95051e5853618e8244432cefaf1997f62884179d8039bdfdd23ace9c369ed3a7c5f0aaca7a1fe261c993431d775a613eeea41528b907d739637d44382077cdedefde8d8c70735df4742b8ef6ac71cdee4af711b1e131dc2418ab22b7f5283cec02403c8a11ae47726e60e4d37ebaba7b636927b55bbf631a9eb9ec6aaed178c99a0757b889cb4e444e1cd5a272958cd2cfab59892cddb6b87d3f4201e6e196b82f46d774d6ca682fb385a33a0f6b9df3c0d27eaf9f7d972b54f350888d25b874ad1a355653f4d1bdbf06d0a74fcd003e48586353f54b91fc922edfc41c04bfb4f3b0d4eb502452cd5bea5cccdd9a1a523a2df761d552bb2912556e0388a058bc07dcc11ed35eb1764cbd7db4a2587412daca535e3bd5ae513a63432fb79cbc97884de914790330a7b9dcdf3cc8afdb643b9bde3c861bba8edc74e847133a313a86c3bd09c3308322a6b6a130479bc28c415ff55cabd571927cf93386a14fd611d528f3f8f481ca397631b9814509aeaf6a3e92f9ff62b6a89a2d3771555ab5e6ca0c1707a524e3be295c3b31ee6af60569b629d48177673b16ef059fd0d50acb678f2e58145d4fdcf22944cbcf9fed52e0f7b7304efd6c3c9bfb0cbff90467c9c5af4ce84d03201f57c753e04ebd64c0c6df55d6b7b9b96dd6e0451e03ee3fce781e0d0051447cc71dc9d08cbd3dacbddcbdf4cc1bc4f5b46c190894ac8450641b25894c21f2266a5ec0c4dfc0a5cee9d9da0a931df376611a0ccdd5b38dc85b9519e6497f67d2c0d945b859e3adc0821f262e59d57f29d9d8b3638c11a825b9d9d6121b8185c477a663451abab6e92df1b6f66445dee9be039459f674f7cbfa2486554b818fa050769109add3d69a1efebf18ca8aca454f47b1dddb99cca6fedb2be981073d7f3242aaf4948a1ba4e0f28853181f3453558b5c99e87e10f3c3679db9171d23d4b41a9558a6df4e3164ae771d443cb220f5f64dc06d5ec5d1dabf46abc1f025fb9fcd690766e4355f8dad17ec75327774f1851f570a9808f828eea1e6a26ad9f0c492cf0e52a3a03ce9be42e9a2482764d2ebc1ff5f4bcf83f9d51646b749475c6a939258724fcba73c9a8d92cbde902d3f99dfbbe27379a007ef1c3ca73c39c6ed7afd82b87037f2a90275b8eebd21135958ac05c194dd7e8638bb55c031b3beb44b530ea44c2dc2a64650d4f8d76cbdbb6a53d341a3a3018f233c69370c7f477b0022a43d074f585469932ce0647ea1374fe659b06a66852a5da93a0f22b03650ccc9e0f973cd79a900ce70fe777dfce6c3715ad2c24822890c26917cbc6dd75b90a9b46263608d6e029b02b24ca064ebc82008a4fa22ef8fd3c7ab612a0e0ef44079518b0a77167d5c42e4bd247ea97d2618b40a31fac5ca5634ac361b1aab3f2c3bede1f30eebaad9722131813a3357b90d0eaca93d5e5182cb42d300ce0e52455b8fd5f79f260618a7562cce68b7781ff694236945c049c0ccb9a24282a0c0964d9d827f1b59df40ca3c2cb77a4c148d37ccb39cf7f4ec455e5c39cd588c1cf650dcb4958a167a52955da9dbb63696f19d2defd85262d86a66098f46ac662159d4c3b53eb63513a1323acbf40a627f7ee89c3417ad973b1fa62a0e3ab76b773681e62b37d3fb7ced87c956703c95ae6738b122aeaf44904bbd11e71fa117a72d8562d41b88beedc1b9c04ed2d2a16e3df1c1e6cb012f7dbc2610e3fa865d4af849299db3a57242776bdea1feee689cb4204b004bc3076d8ae8df4d338758fc21142066a6c2dd5c2e9ed2f37d2d8d8765ff85cca8906b9772542ca7d4352a40eefc6d90084e4dfc6b815679b86d19e2cf990bd62b0f04b930f3235dc3feb3c2543271b4b71506fc8cc0ca3bd34f5d7496fabfc7e14a7b674c937bc1cd5a5add2aa8cfa8ed53edf1fe64bfe3e07c4b573b062ef6078eb6ab310eb84f9e8f2990f0c363ed9ed65d7ea2a972403a15eacac6b6f1cc6114e5480164b2157e9488bc6facb4518016855da286d5812dcc6a0ba0f3ddd266fedfa1c48f9a4a47f1bd06b70e39d204dcb396768c6f169371f3c8389a7bb516a94f430cdb0983e9738419a47f88938031cf5935bbd0b983243631c4173a3ab841ec7b760c843ca00d0460e9374654393f2707e6bff799ef20d12c17b3ca74796ee69439aeae0798541e8fa6eabd06f27fb4c03beb876554564ce5182bc8b11ca1e850cbcfa05a75e34a0120a04aab9374687e2a964e4a57d95d424d8d7378f1c839b2d3067337dd29056ef738be56da76769fbbd9229387701bbddbefe6d471f63d6900d6dcf9e72762571f420a027436983c8e468656e011e333d20a6394eb3df07cf9ff0ce8d2f6d603c72f5cf9c080015480c9e712041aec1ff95093a4cb5dbf1a077303cf3dd9fcb785f0156b310e57017b806836841ff6f7974ab889807273b04251f86961f324ee86092c8a71457c8dea95025f5a11eca9114915c0f4d473446d91d7e92ace995dbd4029341f0680915d8be2d59548efa87be5625fb75794eaf8b48d947318ab31b7a39e4d3b32b0dea951feab2031f4ea78fc36a1b5ab0af384b0488ed235e445400e1c8a968dec9db1a8fbfbf61086cda9c6ccf49c5502f75aa7741669669a7c7ce516f49ad1c3e2e1c0610228c5273c8362f73abc217d82e38f90a8da95e76370794430085b50ba888b90f54f440c2c4c548fef83e74fb7dc8b1979f4b6acac0898d251d98dbc915c2354656a74311e4af81a1d4c20046ad9b2b3efc8c5774889a112f45bac23db22b863ad3a7eb765814bdb0a48ffda9fea35b515ec059d38c19a1298cb99fde6bbeac63d84e8a9bc66cfd99ed5a6a3330dbe540a12af7fa54867d8e7918d7410760d135000f0ad409cedb567333b4fd633bd8ab4944d9518bf0163e4cb7b1c546e8bba9286c812fdf6bb86b16b3144d5073f7731d5a4f8aa17619322ffa091181efa5df5cdcbaaea8be3ffbe63bbed8ab77585889c9e4ea0c68e908408d18826553e7f1f42c87020bfc23b6a3b0ccc1a832a60647605298d71cad9f59196988354d209850ad0132f53c8f163c6f81b2074ebeb99a4750860e927fd0d30c2bbd68855d31706e15f0d4044c5139daf1cacd4103c05341775d55bc0e39dbd01e3e2faa8d676554d8feb1ce0d738945ffa42e2ad928174f7aaa87fa9d041573c4d0174e7ab3a1106b6bf7f3e5b26c3f8deffd58554626d6017e1d18250b63a2650a13c97dd2def53e4293b49a01cf48e89b7bffa90d1d70d121fc9b7aae994b7baa0fd5ca2887eb4f45816cc2225fea711e55c8642e1559a59468aa64fd3a926d8676e4a31f7088d279b88fdca9dce18ff1408ca1b000a3428bd9d5dc327847e4e4ed8eedde1de17baab74b5b4e95f318ca4facec2b26f30e10c0f2b1f39400298b1ffee035289454a4e6c7ccbbeb233ed437c3b9b961c306d2e1e1d13c0ea7f83fd05dc1555321d02e289f999c8bc0cc977a6d36c68c226604c085f3a00d521ab629848bb1cd70140ce8f77b87c5604b483ef77503a46caaa0f95b6131f035efba5905c576c68a104ac4ace38d8cd0dfae329ad0712ab29f32216a37330c38d4f979a8e6d4425a27f17844e7a31e55718a00a7d23a94088b73b4310bf85898ef4ae631a8212835ba3c0b141963538c4ce2d3069fb3549d6505ee4a4eef0b671eba95f59c0bee6a54056432756232f0da11e91e9d5cdb0801e58812461941e436e8cd0a875eb04e3dc1f2114dd1c9d4ec19de9aab4f059fb05d091e74993af5cc84b3ccdbb5d019cd9cf89e8291e8806195330796ebdd8fcea3894047f870bceb2e0705d6953960bac5c154e829b26a0f78a3f42619f52c72272d217b9e7a6ac31ffdf163a0878b1753e0ce771f9465d5ec5b20763dbf5ae55dbec040fd8e77ef7ef70ca8014ced38e97b37ea8b1d5df52242584c92e26d1271eb92f00c056fc2d59b14161c451c3a5a228204b93c20186ffe755161c584860dccc67e902fb2d65e3bede2f5c374a2878999e830191223fe42f2c2ca31e3d99f7faa0f880800c2a23d3518a85ce123887991f1045dff57215271f42c052f5e3f1a30122a2b37eebe0ae90b6dcd78a01156d2df71c5ac0d8f57ca5f178b60319099dfe472b78e5ca8afd68f9638e553a3f70218a52b011a7a00ad969878d080420ced82d817b29f5f2368450574fe273ed27ea2a83099c6b97946738dee8d9e898932a1625e765d67fc0aa48a3d33d2d982d219118c99f31dc5e8f2d1b12ce4548b9b49059dbab92bdbf9de24e8c0000c7ae5bc6ef5eaf24d0a248d0e18ead6f8264c65772d4292f2368210bb07e69c42450b10fe5cbab422f0a149aac0dfa33148437a0fc7c2e164d43a9d69a51999126dfeff2983fccc34285079539d2f1e592fe33fed5329594703b563e8a6f8370724745544224432d3792ebf181ec6daaaa926d77221e177a60ed5dd3c177a129b45bb80e7613c8adbd1de87c4675191e18c563eba1e564b719d98dabd72f5a44f22beba8353eea62c4160af72da964b99fc1e7e99d51899f0783de118fa0f77aae1cb1912b3569ef2f46eabc1c8109400e97d322071e675f28fad67881e3a1cb56da2b4370d27db8156e4193f02c712aee405cf3828fbab4c4e7e723f091c86d08f1737d82ab4f3258aa68de40ca0f8335261cdf56c62d8032640844f10803666cba285f8bfd3504a227a5aefeb6fc1902d9dc5a6cde49ba6a12a8c3bc20f63a6e3858b56d82f15eb28ed7bdde7adb09babf361f716bfe4edbc5c525158bb34e2fa9a1cd813d520a3f8ba6f42fa871910443eb1f95e82e6a7672356a1a1caa0bf864ee265330e0aed5c0d330a89fa9241c5ad81bfa5bc227ab0d0fb99b15ca7f2e30842af5c2dad4979e2b5115cd2bfe4b14d227d166e08f41edd6dbb59c04d4b662f696c8a4200179c241dc0cf7c43de6b097a9179e0b71c60e3463705adfe6415d57d0644fa393ecfae440507395864b0791f1db3a120125b9a1d167509cf15f861e47ea0bedb8ae17b8a84facd6f4fcc6ac7aa011d887d003e9cf61016bc7e775ea12c94af52160e09940accac8608870be46c7329ce2919f5c7aa07b155459c805ae7e5752009b6007b20e8cf9428010bca4275d43a66840a8fc5ed418744c7b4a153199b5161d2ccbd5fcb030c6e44463eff21e8490ba760735bf7407f810ded3915d9ea5b2f5538559eef8313ed4c524ebb4deea7316b9f42ebf2c0dd4110d25bc3e87b3e28b40a04c64d3d8cd1ecf4b2ef0c31663c297d220aa49099f468ba1bd48337f4d0bc17c564a7f8c39394601230fd6736be98ee8da91d235c465acce1307504ab26ea4e94bbb55253f88b3a0110ee8a342dfd7b4c4d22e6680705831afeaf486aad049991d85a3ee9b28ee868d190ca33508f56872464d19070c9a90b1f081e4e2618376762324f33f8a523e5b7c009a944d7f8d99e03978adc175a0da2646dd1ee181f8f5c8b6347c11a11eae60661d01e9f9846a2a6f141c46814cec98c3c331abbccf6f7bc30659ef8405d144962382979e7fe5b0be76451fd852110e439faeee99502ff40d252809a9ca09823c24d958970afe699f992da99faf029c9ea9da12b89970121a64169acc219192d084e77afedead2c2ed448708b949196c7f0dcd396b68be3f0f7b9870db3296fff7bbf2811cb526191ba126d700a69b3313aac728f93d080ebfe0e196d950ea7985d6cb43e770cd64d2456a075cd16284b2bc51669fdf753534943388134f2a4537458d0490e7c08619abc725abf3cbbbbfa6388a0d37bedce267bd4ef86f496734d494284a83812a367c1e930ecab8d5882b9254b1bd06003d9df1dc8d9df0e281275aba567ec7e7b7c6fa2a46b67b3b7a57ffe3d5d50f748f63aaa4d21ad4a88d26b21d7822af57ffabda660d04a1e66918300be46985314b12b2bbd660fd9343fb66317b9553a1353303205ab46f474925739421969a0d719dd3daf39bfd29fec0d5be9e676ff8e865cd084efec4590eadcdd7b966df108d1c8137dc8773e1290f47a2133b1ddcdbc281f99134decb4e2a09e760b5433d59fdcb871b7f9c59bbb0fae7630a291563b619a82cc821157a24dcf75730da243305afb7a5e89c7d5edd964642d2d19ab0e27364218459cebf2074df16b5aa3fced5b3537b53341e00449d81583b5336ef9a452ceaeb8577a4e740622a978ba6798614bacad9a5a8d2f715de05d2e45ce41b333460472a2b0ac7808884dcfd08e77a167ed34e2b2e4ae3f378c208689841856233ada0ba39ac0b65d10b93ce371b18eba6db3e930d336a016ba286da06d19190ed4acf66ba497d922ef302af596e1fa02c0d55b9569bcc9e4497ee5bed95f4d8e12b80982d14acb6f11586da2a0ab481fb09f2db30cc2bf14c48da3caf0020091bebf1408b40cbae717ae7a6559c51945daad47c6b7b4b987d81787101afd951b78a5e6c38c4861987adb388a12284488e1b221afc303a6d22ace90c6b7e3c738c41fbb1f0e8e23afe198c91b0bbeb9a42e48fa4718559f192d0e29d602d4fec9cc4577a59a3950309d9f18c7d258d68153e12da9303ff9360103e43ef72cdd4f3ad67e48e91757aba65dc01a22bbfce863d096650de96b3b89508a413deb286c667767b9949e1a2f9e2e6552bc625dd16e43aab45021e1a1ab500b0d5e5856ac405b392fb05553dd6ddb00c93f2da5849fd20505a6c0a19311592b914db375ad8963d834ba68a4a658b95a08f6ab54330657acc7f5c15042755f50c2319cf73346c89f3011f81b31fd8fc69d05f0d877303d5ca39928927ab4fc43cdacc128619a9380fb95106d0b4d5154ad5c801988794e950c5ea87cfad6d584baf0183352a38af0c7224ba73a216a1cb67c3c6b7da56c4cf724944c8e347178f1c652def07a7f85d83f2b46d2d8cffaf5e928948cd059b4ee8d73a4c023760ee3bdc380b2dcf8f9142a9ff5864acfb7c42c2792eaff36911b3ea05527888301fd5b766468b133d8f7e36d47b48cae5005f43b804eda71b95a04b26751c4ac79c79c5e0c9bd057b12bee96575e749872fbbf8b4aac9e243384b9159a83aa328c208d4b1ee9333ddce635d07b2be4761e68105ff5b40f72d4bf9a71ba613c25fa0a7d038025696b3f7f0858fbe084d68a5bb82e10147ef3965aacab2887453aad94e0cf66b27ee6ed52a7e72243fd2af0652208fa72675969810a16b3a1f8ed48750db8bdc08120d4e5a5341e0679896cdd8e2cf518533df573a101a5ddc832548ae76602d9d1aa1c57dcd1d77f98df747b6fb4e8a30c4ef4eed1b670cb29353f907eff3175f496bb25fd6d995493f93162292301cd510f984f62d7f2ca3ee28f73d642e3c14b4fe689a59f6074a0a79c139f2444e38e3d48c25fcf640d01fc9c96b03cb4243a550066fe8de8ed65b30b2036c5d9392140f37c424a157441db028d7ad574e8e1ba887054f1806680e37db7f153019c3501b3d635ed0a62ef2122721116de7650fd954dbc5df811560a50e02162377ebee5b3a20d3975ea553c9acfad7c9b15e0eb351b2bac583952c34a2e6594b856b79ff61e94ecdea884d8e53e3b05cd9d4ab28872e70003e7116d016da303ccc729b67d763fa24626d4713ba7457ff8fdce878eaa0fc00c703c5dc8b9423ce5ee29408b73ae00ea23052cec69e8bc2b1674c56cca02606e81a051f98291be961984fc8d1df267d628ce73fe91554fba94d4acec3ff845c491555d35f83b2cc20aa06e07b23aa22742d14c9e50d763e48cde9cc3f2319f5a358052bf25d7a9e23f8b90639d7d907889acd67f37bbf0a0dba4e8c2c6a09a1966f6a09668f14e640c6025fcd3ff6adc23076c4e3635d77c4d0edc817c50256a47cf9809e2861c926d139f21a93255dd73584f104b9aa6bfe437c40d58fb138c71a6221ecdc0711df27a0e72a848fb239c7fa3c1e7615e061db2a3dd9df34c84ea4fd5fa5282fffebe02673c719e7d7bc577e2896aa63db492645ab556f3a1eb68173d747efa57d20a7a28a77a0520163bce8fd8b2f6166c37f3d1ed98e32906734e6178a6298d9bad1e26271387ef232b11dbb5505f03183abf8c82ccc437c4740c5364a622c4273652cb752a836f37dbc4196d285a14c6bd427b91292029dd74ce327df9a72ba8a21526787067ccbf468caef8369c7bb923183fa82d28623d755746df8953805d9e69c81d434a60cab4b3a27385dec4b6251f380a0f6ab790aaa65c35e435cf6663f8710d6787eebe7f64a4a7c7cacecb3614d0bbbd59f76c9beff4422fdfd218c8a96ad902bffa07c4640112e35383b34e09f0ee94727f374df70d4688bac51fd707785bf6f58de525845913d2ec43dcff5597c5c4763080d4adc9bf36d3fb946596243580709ca7647dbcadea3483931f43b796640acefc9f011505f4c2f6aef66461b1875f290d79463964c5d80169c9f0337526613b788e93ff84639281d31a7b97f48f4d9fee36567f2f36eef478f599855bcd2bf864fff5bb6c2a4d516c7536fad1135f3a017df92726677b1253c8b42bda230a2febf0b755c1ebcec4b2b3cf3786ff4dd4f8c87cf0ca18a52f24c66bf23a8bf1cffa7f687c9183009423b7ecd7f2ec09a6fdc4d3fedbfab35f9c843078684ef84b1e80dcf62ada5d62924642b14899b076e9682864057b3806bfdfa7311b3c44ed51df4aba9520ce9e9d73ab0148070f43a08b49296396bb65b79964e4ecd942d91ff9611f602e8a0185939e5e8cd5b6ed8e00a008046d5f964287c34c06c9913d3a4af94e7d7826aaae11f5afd083d7a3e9c3eecaf7713b0c666e58cabed647c7a194cfeed569465e9f93e3ecc22a52ab379daa559987ce9656e4de152246e5d52e72ce74e565765fbe9ca250a53b9919e716783ff03a286830f25618ba7027ba1fabce86639ca9a689e56d0b19890f52c83c3048e29b580dddd1eb1cca19b771036bdd72d311b1a67a10b6fe42cb252d0b16b3892aa18a8032c26449bf5f5e2c3c0606a9d83c71b1e79cb4c9ef8404a95645ee75a2b87656423254f45e8ec1997bf79fa57883237b0f03659c4171b2fe9615835b261d80b7f045f0ab6c9b519e4c933af955f6888bf43c7a00a2784636554b82d9506c3a6f1ac256d77f77667af850c5cc06b233aa45dfa11f77387f09383b70c7aa3959f12388c480071b5f89acf16b81daff800b710f4c37b9b96e3cc54a1960f29363d08ed6285f3960d1e509b7ab7cc149203962fc1c9587f3e7af23bd1e7cf737a14b07e9708a0e0229c35c84c7ae31b1737ddc9c57fcd51693e41a2fd5c92dfe853d2b3e94bc2c2670585cf461efdfb172c1bfe515c77ad18c9e5d0bb496b289808665a02ee4237b29cda92313c1c17405b4f0ec25d9e74059125dd56006aa8bca1eaed0519f51e8570c88872d544dd9ce86a7210e02832e6a7925a3a9cd993a077eaa9a109f0749c192cb58153c84a454f29607a81ef008b8c77fca184e0b600ad18bc0ff15f02fe2c78b880e6fbe657a7c3b28a722afd7e859701a1b3ce83f62c660258f862fb48876a22b304eff85f54158cd6b7d469c212d6d5a25574af89efeedcfb3b1680fd931b8640cc9ca77ad7a2042fb359612157a6c0c7ec72772b91e2068b0445ebb46ad384bc2e8ab7a38edcd50787a4e63911ecdd4e12a52e8fdd2f2fb69cf8045f282c9ba10e12a531437169afd677495033e34caa585838f763f2eb1b3005b5c5d0937c03a1335851a57dea4e9ab7961ec3e44ff658548b3aded3a1c5f477656a693e2f22f580d0917d152ae97bb0c4ee110de35f375d6cd85caadd9d62bb9981b33f6396d6060e44077dd4f1a28ad5e4dafdc9cc1ea7ae3a8d48ba3fb93053d54767dc5665bd70abafe69d9d64ca1e090585caf2b0b717e602b972e9d4ff5e32715bdd6cdc1831f7eb7d1deddc4046f8899a84a6d231a2a4adbc3cc1323985ddf3c828f1c1c9417513138b2bd91f3d09155464e0d6e2cb7d25f3bf51fa5af90a5b102ceb0b981f08701bb867e10d473008139ec5e09bbac52a55e644f426d50762e3c6754c55be90a599e79eb591e497e3d2b67877b51897a409864ff587582cdf9eed396e140a37da077a56eb1b04aea1f8094a65dbee80503458e4e7a25bd1c43b210e8094103c055925fc9723e6972baef799465754609a26e86383dfe4384eeb3ce1299818e73c923985e9bd96b8c15f6477131964fb43df04eee1ef0621e2d6cf3278018a214e94cbb230b6fedde0a1477cbf2129d89f7283972ce6e6e227f4571429a34c869e5da31744c88c01e65e6dad25b2aa23db25960f62b9fdf9e8ec152ffb6cd0071e307935dc84ebd2c59d8ff72a0b5505887f429c1ada4f3b223c32843baebbdf49924ee8f6c19dfb18ace71cfe8577fbfcea5ef81e338ec466749b4934a6af199ab98a21008275a9de1a6f78e17ebf18ef51f705019a526a22f7a0e2a71c87695b4307da18292ceacd53daf5b4f468e8fdc571a97c127b04c852fef970b45f2f37df33b960d008654ebc8680ecee9e4c78368fef7ffc2df030ffde87bfe7b15d6ee3a006a1d0e66195028264a1317482af67e7870cd3b4e0c5f7e134f1c216f4d1c25f8755af6af7c34832baa77ffa339cfffb3fe5d0871fb1d7c9f8f4f00d15c3b7312c1cdad2e830bce1a7a3a61c3065e14336bc2ab54220af89d79e4c93f59b598c31b7a6a03046054115427fa5f93fec979e852914e60f4c3a0791faa8593cf421aa7da161472ca6d36bdee95d12fc7b0652bb50d0fb13591e9a45aab379f50cfbc38d16e70750aadb80c038ef5ac262f2964fa8c839356a24f30605119a95a8f515323dd3044e7379dbcda323c26e899e0968349fdf3fecd46bc3ea56131f586d565a9f1d0eb2d5414574b37369c86404dd43e5bb1a869cb955b095a50a38408a935b447ef0441145f236a87b8e1649853b92e191f4ad817d4f6985e58b02fbf5e17ebb968abe2af19f2a770f7b063268f86a0f6c1324acbd5a69faa823459c7b21180e8bbecefbde6f6d4935082a625170f620337eb6a608fd5d47a89ec88d0fc5249da6c4ba44c3f09ef49e3879d720f9c47b05a95e4410d1c3d473cf34897959ef177bfe24442b9fb595792d3fb69917881148d7edbd62cb94a84fb1c336575b8b8ec210b20c494c40dd9c153beb5f37038325b0ed81c0fbb572f0e286b9e9ae5e96364c418cb34073ef85ef42133a7b4fe780cd6f9eef78f1fd89d03f4f695d79bb4e19237fc82fbdc0db3c83f62c350d5ef15db2711d1835d6d80cdbd428875e39c5f01f115ba62714719d202604a09bb2a6964f8cd50557775af82d8dd5609fd45cd2d0e129eb95988de8efe6067244fa3309a44be75a96f1730aacfdf234751c570d09f31445cca4476700c8e5df29aa007956a8cf179801a86d5b0ed277a9e24eac17fe65faa949b60430c053b209e3a16d103cf9b14a7f83504a8335255688bb5d90197eaf586dd5441570d28675df33d7271fa8f68fbd6631fa89b14dfbb3561c2b914bcbba06524bbe2db7bb9121c14c85d96f488540da6d09295d6a534afe3811080f18272e9f5d36e2bb19dcf339d3ad87aff87ec82e60e31b2171d7ef36cab0379f27aaa70459450a5f039b503c78c69aa51384d80f342c1681830ae5ad7e4753a915da43b26b8020c21562e9436632d37ed654f850648ae8a8ffde80d4f1d1379163cc7e31fca29ad9c93b42252c42e030d8fc3958cc89592342eab2582f0510e5802c73fcc50055faf9bc20bf9aaa92e9b9b9d0821433a45c416570b9258dcb1e3081dcf442172d15703efa51ef09f657a31eab2950286ade77b5abe64bc462c4867f41f78828f49ec7b342e100badf45ee9dc3d798efd1346c2fcbdca189dff90193c9ac1279b4eb1fb105769721507c0ea2faf01465410f377c89555ec4cf79175b3df5b9e6ca0b90474f97e8db842a3165bf64725731c76dd9732c51cbcc9a657ee60426b5d026e56031e54a541632ace50b0b5cb9453e25e9fb1b88e68a66257aec3cca0f1d86bb66b98f99f13ed61114e978a0ff8e7e24c9b61725cae6e1c8070dcbedeaf4a17c6c950545614b2b176833d28682b1e1f544edddcb26ddb8b0e3a8652c229b4d835c6a7d0ca5457cef07c9ef8f3cfe6d6bc2ebad124c774203bbfef868c7f332fb3e90147465870828aae1620cd2c6fbfbb515d09cf34c70238d9489a419474a99a134b5225a010fbcc4ef52b938c3f1504079902f93e2cd3fe4eb9652bf86408bdc63d387d24f533214a48ff182d0f28b0ff77708ae80f9805fbf418ec9e03d9f96bdbc418a298684601e8dc94d07493e205e78832d1af0ffb435bffadc3d50faa8585c18438dc81e8d757f2663dbb8fc1af9ac50106302f9cbaa3c09546b1de16785ca6856d3a9a4780b60f0315a99689f4386e5ca5f677c22007aed3342bd4b720cfad35afe393bc5c4909055de6f25a0812b1a3ea3f23bbce16a47cdde25b1e7a719347d786475a7da9ced8fe6346a57909e475d24babfdd8c6308b812e581c3d41b5c1cd448e794daffbf97aa4c352309196baf2160223da47d8a6318fbcf790db0b1ec70597900c678e908268b024b0304e7232eb1ae9a31c68bd654c9405cef61909f33e0db036c3d9af0698c38df5e6520af0974204ea8b39ca95e74cfa18234fcf98c8318ec8a0b688bf9d16db78c77d7d961d42d517202311c152e89be9b194a53190d9bc1764cb0af7a488f1273589b1313f070651f0ca3c529054b6e382db120dcda9074a1bf3510512f9ebd9c8914865b751e376fe9d9cb3ed43faa79e1d5c624d8e43d732410c7b30072d70a7eba1afe66c781df420a84fb378b6097821892e9ca51c9378e43b74d6110e7ecb6d8bf5f3442e5ae654a125a96309c3de080f21531ab2b0f09f25ab94a6fbacf44da073f9e3d8d92e5d96a99a484cf3639c413052d40c64eade4e425184b9fc898e4f9c783795095e1c160fffc46c45457df9f9e57f9d129becc2392c7c6d9acc4f361dfe670b0a7932626a34e79f73c9255b9853a56fa40258d04b31b519229ccbcc0725003f46d1d832fe4756e9f86fc9c7c50f4e76f0adf5b814cf21e18ed69cb7647ae3ef7f517dedf7ecbb7c50c7af1dac435db89b5fef9ca372c206b50795e80ac959f7a8d58ff836b9a42fff8d6678730c21ac27dedf67ed4de54b892618ffbf1dc46ef9eab6a80f959d138f4b75acdcb97b98e1d760d21e4ba24b1c437984b18f72796668cf358e717467cef04ab03b09d7ff645ea569c1ded3b0a08be31f85684ad9d99ce2b718afd7d0a025932b777cfff61954cf33a8767dbcab126aad7cc36f582f419e5dc31e82af0827bba77b5c59b749094d5e5c3c106dfe9b28800720363ab07a7f3e36cb8f22fbf2e196000d6b8fdb334e238dbbfeeba4895de472cdfd3dbfc8791cd28f83db66b5896543cdb8c52439e04437974a4e5515b6a4928880f8780e12902fba6696ccc6f4225cf7e58273db72ec1be8ba8595824f20a6219d97ac97c4e68be9ef17ade30fd181fe9302855ac12dc25e4979c1f630bc53622f42edb2b78118319fe36ad6285adae91cbf8680a8c63b98eb38896ae5c39222d31404e99999e4716d26ca0f0ae124acf006be2b8a008033dce127203cf7e0007f42b129024fd6b4cd2b4159a679e7418f79291c38a8564b93e7b39a200213309043fa9f5f4288fabdb5faba2f500dbcf2cba5d164e51aff0fd5938a4bf1dcc333da13c6408e2c580d05fa089b469b62b164bb258bdfc6e19160789302a08985e4bc3f0cd8b68e0228218af2cd51fd1f9197288187800b30a1475f512c9cfc6f46162563a8a8a23990c2ab7c396e11d3153954098bb560e3ade495579c83fce93826248050f7c38ae0938c61d220ba68f3f023aee22d11c91d50c747dd2f5f1916e3dab4031139ed51c357c056d21c152493c7c732ac8f410ba6a17ce69cf1c06551cd7f7403ef80e46e1fa171cd44cb082e1725aa95f37723b3a987a2007fffd807f2fadc67ea7c1affdac6cc784aebb374fe1f28d38a8a82036388e07e0b6550e665b6a5a2314c794dfdacea572e33f2c609b55f31b102a316ed3f10619866b80579c5744e304aee6d8e0774eebf1774f56ac233ade43555bdc7e0c2e0b7cd4cd6dc733cc8b4e2289ee8170195efc6ce019c1be797403aa85f5f2510e9d734441f3cf19eccfd0faae8325efd24966b6bc3e8fe1eb8279556488ca79b899b6fa21493e95ade14bc2542cd5d56d4cb9673b3e7bea152e3e269f91c7593d45914132cd6b3622b9c67d9031937c651c2fb4bf544647669672160f7c4f0164417071c4e63d159d2ad3b9e8d07d62afbc84b9f478f15118e778d8bc187a86a1795ce462fbc2bf01d7af814881a6be08df41578b1a69728ab4189378787d17a91a315ecaaf2c551f0f747fee5b4166568f854c4883eca1465af96282c062b08365c71984a73b256dd19237209f434b9a9b741cf5a239dba5ac84cf1654a1db4c98dbf9de2886048a2578242e363d804c821f95db4434d3ac3cbabfb2f0bd7a3258abd974a32b3aef5a20a6a2681ec6a1cc79fa9e7c85b79acbe1bb22b143e75248f7335a3a164e9ed1f13ff92441cb1f3c94974cb6f3ba4b4902bd4db9e755bc4eda27d0fd58292ac7a38721e3109cc2365afde6fa5e876150e3b3deca62666a3c6cd3451f8dbfd58f423488c2cf18b82371de5809bffd8187d2a41b96cb26ce48575f72e31b1c57b64885217f81b0d5b412ae6f18f96618712415242b760a9cfed120556c975dbd2a683f00e754f0859778906acbf93f6360564e4d5be3790053ea598c7bc911ef9c366966a70c3aa7bac628d245a6f2259ce85ceac2a9d98d778bdaad7d8da13e8906018e37763b9c85a8923dd5521bc6506adad396d85cb9242d3a2810aafd54ec455a73a68a6d623adfdddb1d3f7cf39f7d8d0fc95c27973833b23a166edabca5b9e6e71f7d500b02c6b4bdb7e6f0dec252525364a3c3b9417c624976277aa472b833c769f9b96d17ec5e4398edf59fe3de8c763d3919d91a4ab4c09c7c7f3e6d80d42ae49181739f4c2c1cf65caade165a9ef3952b78bc598ad386ffe8b47026fa5261c18008c8dddbe92ee4fba219d8f99324aa8347d4b106594f3e4321ae1386a3c2655858fb9dc17966d34555b9f8e03c4f5bf6ac724158965138cc7f64eb9eaed87d31d86d53e8c07406d6c4b17731ab250273c8056197e8a6217bf611be78485a2becb310a635fce7ff10c3f472458ec744dc39cfa7f5a557273d210fc54026d0eb8d42a3ef6774d153f434a47e709c2c2a10fac9f00f91eede28673958a6ee0785d5ff21a8b8bce8cc581d9efcca558012847a85975245d5a899d05498ae5869ec3aca41facfcbc3b947c24023d28445ba151a461cf757a6533b505f91b2e091d49328d2939cc4b4cb5e1548850059c82b7cf6c1855591bc53d1dd90edcf21f31b85bd0d1ef771280f887631f7fa402034e62fcfc5b6dbb4c05885d657caea505f787609e55eb9746ee7e4dd65340a0d25cb41e42f63f9dab35f0fd8b3abdd5af84f79e4dbf36ab8ddf78d1a64ac3032790b6451e16d9dd9ab87419e362659ac015be8caba3a0fafba0b6ecea271e620dca4a900e5d1245cbd0fd9bb20e52c91895cabba4ab917a6d5228a9fe1a562f232884e848b4cc3a162e812859451023c8f33eacb519ab3afe5b19aaf708c296bcf3724b7775771a2888424f64b129e0ad770de9e3c3d3c5e000c48d089e67c13996780bcdfc11546e963c670aee0948e179377d4c78419873a6b1c53ffb9e40941c436b0d4a34b3579dced47e88255dafebd1073aeca354b5e64e886a9c6f69eb958c9930c6e083c77aaa6a78a4298eb745a2ba59cdb127d4949b6fd0522057e606c56e7c31f991e5a870cbef340db6ca86fa1a986a710455dd8874d1bd62b1e331029dbb618e66506bd753c7f188bee0a9a429a277ce59067b1bcce279150336fe81056089bf8c71113215a135beb735008e5425d204ea41bde53aab141d68dc4008e51caf553db9e696a8f0c2baa789b81bfb933ec8dce13f35c8180b01aa1f3e9c71253c637d02c58e495d36149c45cc21a64253adc6447146c296e39334473bc53a6c2d04d3f4e2f5f41804ddce7d0e2f2df3d10ce7af9d8b69c9534222343b93b747be2b95570378095ceb5c0879e9c1375a613954cba380d47f903d78b14b1b6cb8add71c36f7ab4ee3bcbd934e69b5f09fdf2f18063f5d46c471046896a66297bc24905a403db65d8989e09e4c7fcaefcbbe9243df91ec5d9505d685ee24b1965c3a066e4a56599dbaad61ec9071b3126c46be4aec009e52b6e8b524c137efe4647327ccd1fda6ee182e0d36a984ede6e6ee39c17c00492825d4ab911e44778f68c7a9eef2084f13fe290784c8b80f9060664d98bc552d8692faa378636c1fae47012880e204a7a914d46d81b7da3500870112af566bb7ded7964f94c33026fd149b68838105b863792096d0ddb1b62f3a8bbfc975db2afd2a5e8ebaec059e1fb103c643d5eed58dd2ecf977ee3abc2fbedb3dd5f2548a73f8997b87b22af008561b4219ddb8f862d726bae7edf86b0ce75d1b6b99c73e1229bf06e2ee3be086b9dfa5f73dce7d119c745b71f77962dd30930aa89013811a1e09fb841ab011c3d35d4edb6bc06c25790315c1d87ea8a8625b58775d3f076af24427fa914669ad61677435af53174d01158820e6af62c99599ba53bb9829a9a6a476d88c6f75acad813fbb248a1d24b1e9aa38b45dc1b7a1042c182de67348bdc219e4c8e5a6d0e84f13b38aa199897d4c6bd72445c2592ff95be659850dd5ab7c9202bef64260b0c6e3e7213858b37cb1ed174e8958b7766e4d4a4ff977957e15c4ccfe3db5332780640cfcef0e2a7c0cc5d734afd9d69acda3be31aa570d4710901273c24676b5e187135ea8f90a91fd32c2d9703e1e1694010ef3c847f719eac195597642f25be06d9dfcd3f60a89d9790685326737dce0de76ac365daf8ec692f08771e6c439f5c7d2197189dd929880601861b235cbc90f5306ae9424c66e72f514f8da295b59083163dae8c4a5fb46e547040f99a717f804d08bade8104a55d713ba4da25afcc8279865aa07a28b988dcec900d782a26a4b222222e186ed889cd2e4881986c1bd1bfd0e50d2ea45bf049332cc439e32a722ec1b1fbacd0de8d1662d9b254c5b2cb15f6e6366dc36e3dc9d7c42de6a1b3c6855775cc819c4060fba41b9ed6e2ae11ee5734d5a1887d1d451d133f656b6c4c50e160f1dd703835262a27f100aac9ecf3ccb261e72676ad72d57c705d344dcb364464786115eb612867df9c55bb6605999a553fdce4b687b8bae0fd0554ea53b720af99042c7ce7443afbddd15a1b6ab22785b9238cf7f44544fd4719872cb0d9be8a356c88fdbc3949d84879e2cdc7ccf2cc2f625834d21048a779f71f388d5f40d0057e864cf3ca83a9d1c78cda3c08fc72635b6522d3322ec6cc78365fbc9aa50fd0cc22b78ffc2fc26aeefcb8896d92a47fd0717f13256ea9f3a617aa5c49ea74655418eaa2c74b487b6948b3441d58d106d911016b443a57e7fe0b64759a57eb7297f3bfc72aec1795d0a26263c4a929db53ca7d71c03002e1293a7b7ac7f4929b8a554bbe6bf884d9561da0772bb15339726c1d6d9654fc38bda9bdb9091450196956d244f00bbb514fcc088df048ffa51ec580b977c6b60906e979506b86a3662ae91d08cffa9bcc77a7301962c47e9729ba94cb9cebc30e89edbc53b5666b0ee0fe78b4b2227b133004373fe7e4c70ebcf14458b11d00577f30c70f7adec7441aa3eca833c593a1565da8963273fa557aa896412c3a9c7d666e5c9e57a4e9797b980c47e435b7d596606e066ad54c23ed29bd3a2eed1f65cfea61321a5b4fd89464c21e3765fbfc6ca0e423269a6ce97d8b34c974d5ef926a82fec72e07db2e562507bc81887631e81786d37f54bc404bb86d72c7ac7be34772a6f5008a6573236a26d704bc6117ed5ca7e5b132876dbccfc73f2ca1b49e47490b0a7ce8eb479e8f095654fb5a507b519910ee55947565789b740070800cfc519eb8e959500c5476d2f77ef0c7b7e55a4c7e20a460770637f7b83af5b403453b9870e663673ce8e1152efc1e91d1f5aeb73efe9fd6c13fff69154fefcb62671d131e9cec771191590d997fadbdf4a1b0ad2198de08302935d7bd116e010663e12a57e27e507732f025c41efd678a16b74a617689ae013a82e8cb21e240ce7d4fdb1a62af094b0f70c6f6aa05cd2ec0c1b4d1b367adad956efec8e3a4bb9aec0b90b05b52a9f2fdc4b9a916b436dd8f95e62fd5e5314a20684d7fab2bbef9baef8ac51ca060ab2d2be7e37aff1d9cb613adb2163fbfb23c52f8dbbf916d20e28a34f7da9a633ab90b79a16b0b5e8a19458f56a8315e9760599debf4b3169509469bf6b611234e1adb157d72029ade77cb41bf4209949782096667f3152a2b311c8254b9a9064734868543c0914134e8f38a450bbe08401363ca976e63001affa7fb44d0e8ac52a06d12e159d010f83dfe4e50183616a06369af1a75d584e1deca4a6e4e013c46345138382abb20479460796373d48397c56b77645cbcfe312b7aaf5a224ace6bfab2de33cd06db4dcde3c57b619021a316059bba6e867eec98dc59731740533d35c09f1001295b977f851bba1600595253a0c58480c6846d1e460f838b36055b8cde960789d2c2d47aeb00c493cacf4d55a03c3e651d7bc07ece11b89e3709f80cf647bf3a9811508660bd5e24de4563edf1926f84ad64d12eea205ef5277e3b97011374f60061b06430c8c1816ddc92fdda1b4f25b6554aa1f094df8e67c726751b8af6202e0ee61bf29c777c4a9f291f40721c62d3dc3975390f3cd792bd993fc3ca8f250c665667fc3e06e51db7f209dc2372f0e9d14a35fed7f0ffc017b2769900b27dfcd07f3b660ed84145eaad52831ec156a87a39ed55479d76d16273f8e8e762f7988a8b4d47956420935240868e169a51c0437241e85ae02182c845b19231f138d64f69f282fd1c3d3149222b03d287a3eb42dfc3f4afe53e9685d07def1819239bb7fc11afd3d59fe2b637c0c1e62f58de7c5c04634eaba08fc677af1daa355f163ed2ddd98395094fdb1e91be72bc803016da2d203b7483cee78d5192d33a4af88f77257dcc32ab80d8ce6d402578b01d202df82366fcd5d347f9afc74df4bb5e8a6e86f7c203bbbca9911aecbba9a929ed8048d12971eb56bce1f02e34f8c06f9cbb9cd8a8605189b362ba8f25dbbce3a0f8293ea29efe62448a83079c94efe140ff8f7575b5d3a04038a64523b7f2cf90ac1dfe5f5d06564b52c06dab9c2260b55441a02cb5cfb594853bb5468bb40b8eb0b67a640920522e2213e5902f6e6b48f4fc39b60e411866ce1db0c71698b74aad22390635ecf0b1f9ea17ea398215397047e9e358ee4faa45a66bd795f541be27e0e4a4c8172e5a79443867bafdd71a5ae9f04fa728a5da8c55633f7d0d800256339978b9cdd91a7831f7e38badda26879ab035d532ef51e07bc006624f0ab1f6d45a05b9a124be9cdb3f0e1ec2e6a0a5caa09d90bea70ec723df80cb60ca207135ce1eda8238ae0f9401f9b032edf6e175adf8aedb03205bf8bfcc158164f5bc0daf1554e26412ed7c14fcb47a982ac653484916123d07825ec707ed73a02240afec267375eeca13c2903c30b9c5496eafcccd8a0fae1c61ce1ece1a11c1c8aebfcf4e0770e2289399ee2ef7c722bb0733fdca6a98b082bc782353d00de5a975039d0a9ffed1036ac61c30143e0f782cb93f9f5fc60ab1795c6d12da3352e488fffead6dffe4dbabf6b22808e53b3a355a7f7da127f2c96b64929da8777ede1a22c8655be1ba23c8f3694a6eced925a5b878f8e6d7d1ca59380496e316643fba6bbec884bcf06d6089a99971f94912ab9ee55b3c3fddbb91915e4e77c699b37d8bbd04257e28a2ace6d42769f391ca6ca077e33eb30d554088b2ef94aa83c07c4784fdde68a007efc5778ce5024c2df1dd43cf480bf74bbb880529c3efd9df0edee9b8228e78907063123b0ca76b7edb839e6322e4172c32b4408658429a91d872610d5c9d826d15b01ecf917428f77147b7e61323d9166f004065af862654131b7898b516184c4f3f36718b351bea9bcb223c7d5174fa1017c4f32d447eaf4b4d46f27b6851b9e432da19b37ac24c7f6c1cefe3b0c5293d2499b935f487aaa5482d40f45c7a34cfc9d55c241bb23f34c9fd261d533cd2677f47bd13bc25a548b0a1da74160c4eed1d52e632932f4d2c59549e6c3135b94c28a386855848a329a42130ca96f919cc8856b0cbb3f1117176e7686bf764e489dd511e2639412194a3d01851eb218a41d56be12a81cc060e2ffe029eb287c3c1bff384db19ba623cef98b17f46f97ba562bcad1fe043c74b1b219034da6f8c0433585c724f15623f113d8e5d2f976e55f149283e63fc81d78274a7f782705d18feb816491f9ddd81016f8bbfe8d430da01bc5d43d0ba2241a67ecad5f2825d08161e97a5e5312868e8a1a7b5d263012db6aaad99c1e7272ac28fa6fc81b611779537e66f5134ba6906479a53226a56863b1438f878dbacee259ab43bcc0b3fede9c8dcfd298e67896a8c3779801d46dddf7bc15b83ee4c3dace416d116a8b250b743fde04392388d5fbc316b41deaf5faea8b4fa8ddaeba270701453f43f4ea96b3f095cd87d3bcad031553c9298d3354bb149f1adc63896ab7487229c275e86c68ed229cf36ced003e1725b9e7da4f589a85f51a3260348669580889d7e7451cbb522fa7d1e44b92e107d7618bbc51570a7bd0fbdb77faac6b56253fdb0ee9dacce62cb02a639a28ba8215b896aa24fc649e2abbcc5c29aade4edb255d1059debd57ca59c41cfb6180db5e369bd1ac2bf4476bc907a59c32dac99f5b9481fe304c544c2eba4fc64b8d8204209a10bad9d780c831c1ec0b20aeb26ecf7c5c14fd36c163a662315374e19c914b10a394465475ae11e5c0d0dcc2ed43e033f988b1642029e0ed495b53d1c48530e9d83644edb8ccc7b3a6d55d9f0cd6f7e728b76656c7dd511d1a5dd24a09bd12a9de30031941a82ea5f491dba0d6976b9d961054f904fadb9df3ecfd81dc2604c94f2d86766658e2326b79c5fa81cdada9f9490b1f895d2b34b1cfe49e027cb2b7e739bac79c28ef27f1a7f1833a12427b5f42946daa4a6ae5df7cb72f4d94e76c6d2115e4ee46194d2e42fb29b137bbca917a4cad58d28d85a5387a6ee29c596773c92493074556fd22c53991facc39383af222a9cc5e0dbfafac17600935dac7b486f175e68562988bcbad3026751975d83ee8cb68e58ca407bf64369a7ce4a272339ef7643dd89329f513734e2f5f6583c25541492142ffae9d3ac8f67156326c530d9f28e2f671c0f2fb1833f13b90582efcf8768d5ad90dd7afcfa2d678b84a2c12ec37a4992e64b5250e0e28fb8dbe07e965384fd564c7d8cd7ceefaa1e333dd82ff5131468a469cdbbd3f5a6714db1e6262267b0cd0a64a63880408000856d4f00bd026a7ea99b6d74ea15d431cfbb745e79349ab88168aac9c375d2443cfc7f6ecfb1d3bedeb3b9eccbaf1490dcdacbd7597f632175ba8b5f5bfbb5a769c1b3f0901a5c19ce5c12ba4f586b1299371f968ff06702edde8636b735bbf688385f3cc4905b76a3d95040850598ca661fa66cd8f168092cbb3e4d477a8ba0db4b76eccfaa78392e658559539790729e2036f4ebb14676b87c9de4f7e951ffdc71b4f7933de4df7d818da17b14acd7fcb5171e6f40fc386de7e385727b0d7364028400d61b360a9cb8217dc815cac3b14fe11b126ab3e66532f4e6e73be24c4e1d71374a5d6dd826073eb6617ae374ceac2488b22b6f4a89939548dad8aeb4f137540aebe3e5bff7bcddc888498908f3571a80ce0be510cedfda82274004283966cfad36d40a8c1870a2b7e3cafe30e21ecc55e384fa95541fce51771dd7e522867773722bed998f4bacea4b6543397014033401fe2d050697a461534f44999c7cfa0673c831a95af6531ceb6a66d7ed6af7c1c5dc5572bdf6758f0fd75bdd8189084f95415db9f22ba0f9a75af5459722561c6340a6d74373d5713c64545024c31ff6af78c3972051646edc14401baf77a35aff0870882d58d1ba898df42b841e0e70b91a9747a3a4593c02e42ff1d2db6371424d3701765c853573af794ea92d5697a2a3696eb71750a1bdd43516343d934057edabb29821afe50a7c48e2579a44f8d87dfe95df091e50b7700b808bfb59de1c4e384e8ce1e291a5757e5ce87b91874075650a0361cd188e1807fd868a628dd9d049c9f7882cd6bee914d642212c992294fa46a7305ee2373e27351ead36b159f35d4bfee8a2712335e7ecd91697ae8c7ddcfdf9d7821b131b874911c1bcccdf1158672622cc18f820d420644ccee2208d12842c32eddd01068720a1bafc462ac1edb7f131e216341a6fe541f3bae62df5ebb1ca922519cc1269efb2e5716f31604aaac9f82bffc2b2ffc0c14bf78390e0cb32fbe0852ce874ad248ac7773002c21ea78ad3a5bd47b420ecc38d8454efba85dc917d5bb08b6ab85a55c8135912ca221a98cec1aac98d44c66894a6bef36ef072e1f1fc50ea479dd484a6f609eadd06fcec92ca28f3fe594c540ed4b1eb4d36c9d2197b2ae9c665511bce4b2684c56509678ea073e98ff16f1da964c4d980fe62cb7ffcb74c82de5c93789073be84efa96f987938e66e1537b6543a5acb91a6dec2c19bca0b466b982d8682b89649b9e0b4a00297b52eeaeab1088caf39067d78fe79363daa444b84c3b1c8b2e8ed7b813887ac189fdd993bd6ee1fc5e9b44d40d01315374eab2d199eb7da3576f6893199c06e118854165d34e0fb8cb231dd3f97b858c29a29a8d302f05fd32936dd8a7da84c7b9f3f9c35caeacaae4f0d203d61e39443f3a7d8194b0949d4612c4a3255597f0eb3a87cd97884f7a37c524b5af29b87cd8bbf287f8c60987fa241634629e63f49f92c08df154acac72c3edaec70f24f2a307c26c78373fd6c595f967563ee4daed2e273eeb61a560846c9b18f7d7e133771c78e83fcbbbc48c37296bf62dbeee1da6f9a537bb6107db39342f20c42c8c7685bdfa59f36234f511685592966b4e7660269c5b863261bbd4222e8422c0fdeb289188217bd8fdc32eefb0360c220eaf2ebc1e3d5045e9ba7a91e76e80f88ae9a25c1f5bdbc02a2c2192e1046953f53c3d480af9d8687f6ccef08f8e4bbd234afd72b06e6039f87255e90c433efe699b2d232154d506507a9bc98dea9190c6f81a00b06a6319a4a5b064367a1b33b718bf94fbcc75e01ad1d7a600e5c765ca5b9ade218b12c55c6433aadff0983235415cee28ac0890596a16b5a4c7c696cf3ca7dc5d0cc320bd853c372631f7d90bce6e95934cb95027116c38cc8a018cdef8db16a0e91f31feef088414ce95ed7e60529d3b70617546ddb27b3e8721cc4df6d3f6452416bb8e501284de33ad5ff16a99564b6fb042a86abc603a0bf1d4c46766c40e9f5ccfee8ebd463e0aa4efead36a92fd7107661ed13333ba8ca4879399ce2380b8d56094127754bb75d083a78aa8fb99f0f42391b44799498e2eea2ced1854cfd9e63699db9b6402db44c5107eb4e8bbb8a17e2b1b36a16541072593784167d0c56f71632250a1a79790a8913d1eae4a93b387e8ccea5ba0e29ad2a8a6a91c60bd6d633cdb98f54d97cfb8d0a334ed4f8c40016f14c1898d9bbf3d331fa9787d752301eba1cff7092a785f80ad2103fd70f03d5fdd3ef1246e5e8655a04db80dda2dd92e85bdfe2c5a159db4bd5e35ecaadd5cf33a9ff5c931b4fc0c0211ee609aa8ecb9b9b00ff311c2d7122742c0bac763b55656334b400be4c884f8de45e3c155df9a953d936e04fd27db8606f25763589f6db08830888d896bc999b5218239865e0b2ddd1651e6e0aaab8d286cf5abe2605e1ac8aa97b26d71a31dd93d746be36fda3816cea1fdf30288a3c3dd08e81d1cd4f437a9f5e24b5c71c8e405e7062ab2775ad88314763ba1aa3f87a8e995053464fd87ed9be683794dca7068aa1fc0e747ea192f3e0cd1c6e64aa22883ef92d55e25596e0bf015b5bc63f2342c8c94fa54a7907f47741bc12b0b779ea993e08d10ff6f251b0ac9ad14af5fb2f61d2a0a4df24bc1f25bc56e32c9377bdd7f2cc770d29d8496610e7322b2ffbfd051771a9e124662ede59a13213f1e951632dc120b7d1957a97d40443fd0e6bd081179f3c5c5815ce4c832be6bc190ca5bcb46c31dd229a3cfcfdf84156611d0f8db1960138dbf73b3f8d147275f48a307b706b17aed0266b495053530c40700923ae93a2fbefcaa26289d317d2b364544902fa93a16e1320d799d6ea62886c258ee9b2b155b57a89607fee108a664279fd87fda055c0a79bb614c213a4afbb1586eabb2e2ad95ec8ce8df1e69f24eb6cbda0a39f13786569c8dbaa47b1ef408fc11ac055b8d03e8a63483fdec48680a35db297b5fd8dfee39f34ed193d5385b0c77ac48b7a29e258fafa88933b92c18866e4896b7beaa7cc12d19ff789b197bb4e0cfda3ec60923893a6fccdb502d1806c2f361669dc9fe1a74ed7cdeabc73cf1a1f1a1c52840cb77eea7e4d39645158fc3cf9f1824e7d8cf21fe61a83348e9d91c7dc2c33d98bd503b17c55ce910a86e00e4dbe4cf1273b93c953089cd2dbaa1d2f48fa773a73463f54b374f3a6813af0f29461b944f4ae701a5febd1b10faa9cd26691614c70b156aa2e4c9829bba24625b366dd4e6cb6218e9480252dd0ff4f72f37533cbdcae515c2b0de4bc231cc2770c094db5f6d268299ba7999956df18e395362b0d7fe0746c2913c31b819769d1b5aa0c58196e90418f04c0d64932c2996588910485b0ceddbdf95f71c8632be789c395ef24a5511df84d12d287879379063ab399d899c983817f6637cff3c149cc1125d7c60d871c205e1de828aa611dc6861746965506812d0b3e7c7b8cf2838db1b0ab2186cc8f8d2bc485d4dcf89b2c1f4fc7d52e4f7481cd71b75994b579bde8c8d639913849f472c62b45504b2a0b2841eb790f63153e6db854f56cb918866fb95adab17e9913f92129f49b48745095857e1b735119228ab5c64359e5647c109e7440f3f754a0ef88c103f75092e49a9266d3db0dbb8c0139a178a91b34fd93229a130071185f183dfdd975b0fb1585c8304e0573e5b345e22037445a8f60b79eec31f717fd8d46f21b46763b27127a8dd44e2121e60f5769a055a7fac579089c605445ac8d2db6075f705f1b2fc097133993c6f7211cf1e9322c5bc0b2f624da10a18175422b60cfad5dd49a9e1c9ec5aa1c0b7259c3f6b9d82f47f8c096b802b812b015acf0e7ef13209824239f8c8899cdd6e6f927dd190e2a42a0e66d68722b7ab9a991c01bdf04cb8affb1cdf33f1c3e076af3b7dee372f04a43b6681802c5010f91b00237ba39a42bdcf0fa5bc1bbe4ceff057615154b11824d947f8fad2a8b857d01bb49d7c969a9ab3cab9970f3f180bd69a74add5a359024226b229be4a458ed4d955905fdb8376ba4fbd9af1d7fbba6ee701dc2495e264520637e01b42be4d962a90a84bedf448ca29001e3f2658d9c0608f55da6c3bdceb39499b494dcf88e9396be798ab76642c811ee2d5c438b03eb71b1c20fd89706ffebb4c101497fac1fdccb2bcee1afd0b35ee347c540068760e9728eb743cffa1c75c5179bb8f1de53e5f64484b858dbef1b99efdebe17e98b57ce52dcfe652aedadd41855eaf4e35c1527d13ad8e689dba9b6b03e3ae0b923b73afbba561eaba1c70c0f1b14e823b79ddd88769bd02f0acc5695dc4dbe1bb331ad6c88d95a7c803c3f37ffc02eab03d8f838e560b24538fe7bbf161bdc157a3ad565bca9f08fdd842525b0e88da0fd0bbe11a83f1f574054e214ae4b02c177567a019d8ea8983c83b76465f011cab777df48b4f7ddc78cee829ec61bb2ada1f7d87ce83b2ef3c00d4a83054f0421f610952892c78d7d24d4ff39b89a1e3634af3bb39045dcd021230cb80fe1503a3bf864685b9101d4814142e7482ab62480a8e0436a0fa281cae4bc5d1dba44bc0e0df64e328d908c68b8d17d5c56bc92b3ad0ef82ac70c86d94e122f0226be7b43e93541130a81a8bd76479d020124253f1f7cbc315d27407352c47f672bed0bc52c80e65c3d5bd76a0f505b33deaa94dfd222bdfc790804f505016c3632409fbc72e631312fcdba609306165901ea678e47c8721883548284b3d6fc9b88928f71c305d512395ca8c94fa210cc5dc6a019d6aecee4eb9edefb9bc3337e0111576164edf861e73a94d906e3c6182d7e90c122dac9c2d073fe940e446564dcb0f3b6a19f106319e1feb953e274f970b7b1a1b24b2db710afc06ff3bb4c6655da276b3c595432daf9472362601c7acb6ab01364899dc5836cd9f47b51a6c368911424953df205d534b59d0e92c844e8ea5d90f84ffd407cc354ce68842d722fade283aee2e37bd0f7d40d96151a7233f4ce29f10d0da79c8d1cf089ae2690420d852e935f7bc2a0247b3b7e6f68ed2477da93f264978a944be35abfc8ea6b361c65f9c89925adb906d297de5377777f6ac36999c75e7e6e3389e04e0ea5d61c2ef4a09deadf97fce51912e9c5073ecc058c2004c329a575efa7f514f61e5b4b9ae39d649e08acbfdab43de9958ce2c809b09b4b398db6f72d3da177f7f6abd72331a264100c9fcc7369d23fa0da5ed17e92f7de0dab12155973866275e40e00f7612bed2b2d09a08d69daea4f0c884e4dc7dc84d16ca7b292e96f7f1e73562c17a64e7c993f32177686ec31b8511e1b6a4e831bedcb71081fa3cef0012196c65e6b5a8a57cb0c20a6ae797e3acbf9bb5ff19260d0c925bf7b6fde3291965b43283fd2a2d0069e04516500a2e47bc13d770e6e6515299d1bc7645633f4d85a6f0d752fb8994fb38690f9b19f8330509c6d623380147d965c2e79a40a347abee6a329c5d9ccd298ec14d1ff92ba6bd0814452d0f0b8f7489f016f124215f73f1afc6ae3a889a36ff03824f230aa99002d665bc77359cf1d5caaf28b914fb2ade2d4078be1004f6cd504926934dae8a5f1e6505dcea8826521506c8509e9f9c202ce96dee8c6eea90408c6240b44fc94f73e127e730aa1964fd4d27c5fa762c79975801411760bedb2b50f7ebd4f74d0fd3a192f77c341ad4fc3b4ae25e16b4e4a92f4a18c8fd03cb24563798ebc3c4ac07b5ee53365274ae8873ff7744f29f8957264a5d00f44581b1425afd5e6f6d1ebc0c8ece226346105f75e8583628e25d324b525bd16614bbb08cf0b328075c789cf24f7d0d7648eae9f35943abc0107c523e3a9eeb40260ca4c4081bcdbdc52ebb620fe7589334d0547efe3b9c609b3245374e1d7025dfa342663a7a9cf69c9035bb1f239b8e7aa4b700b1c353f47698c8e80e9272983c6e781f40fbb72db8dfa8705ecf265c8bd0cc8c13454e292d33ce371d06bdb5e1aaee3265489f8d3e9526ae94899a20eb1d030b256f45752a713497c94e48ea116015b671533459770750e920f1cb33b45ef7b62e8c18c83f83a0d05ad109214321ed759e3bf0af49dd4d96c49d2064d7ac6dae88fdb05d0f73e10dac23e1585ed28a60c3d53a8dfcb715ded159b8d5900749a63c000518fd3bc696f3c05a3b427e751b129c5be08a6f6d90f3d62dc9f96f0842bd3fe7b31c75199828e9161ee1bbe1de3a640adadac7577edc4f3fe595f72da34e6403e268bca6234f7f898a8241d34d10273ad786d9fc0cd9d6add7a71ba76ba97e072eb3c3bef0f64fd0ce3e8a356129b4ea4631e26dfb8e356ce66119aa2c6884c48b768c5b7557b78611286d98c972a8c0817a5022766bc83e28d07351f15c3bc7ab54083987fb694d23c4fc11a5b1fc52b2d73158e7467aa5e40a21035293b2649823211f1f6e5a0f52c2bd1eed81e52d75426c3e1629f7847ad559b59704038d9ddb5c314f557e7de14a79fbae2d004d0496d39eb55595caba46f3c2d41c9bcb9d10435889e2cba03435b39f8039bcd4fb66932c50dda07d691740cf8c65393f6d88642c81b5b3ee546f0cb223aca5696750b9638836a0ae81804fceb37ea1965293b06d01eb8e5bde0901f472e870ac153287c4c55ebd05de7539ded435519736865853c5e1e71d6f054785edbfceb6c5be8533a5812691b4c48f230b687d87a9d2ba62482a5a1338e6068b5cb14a8e929d190c41027fdf531ba44d9b3e84f7b6dea4aba6763feca24c2f619767ccb0a21c2edfe520121bf19d7703b1d2bb4625a4efe0cda9c6be6a146fb92f41a453af88124224872d5985c85425756fae2a522d6b5b1079ef2129f948bdbfcb9fa4a6185a54dbcedc0d5fea6d5a51ba0d99f25636b985cb917adb5eaa88586802b3a0f9ddf27ea871d101ef3d3beb928e7db2bb010f6c5584011d26a23d72350970f4efdd921b18a1a1f2ca463c0577cb1b6a85e98943544011414042afc70c9b7977917583cec8a76768623b1a0470d03c9ca2950d3477ab77fd6bc4a2aae7c83d48f1bdd385abac12a63d7b746df2eac36f419e9f8b10aa8a5a32b8b183c4e5d061676b99354d3273ab7014a1d0df0c2dd275c3d5c998a7804142798485cb98e216430f8e9ffab31738f6600d63d5f7ed13b7327db832bdcdd744d9c13a7d8cfbd5c9ec84192572097d458a68242cfe030bd0e9e8168959cfe904fbf2a8f9e34c3e76f269316f15b1c0fd3cd2429a313f38001bbb2361f40974dc202198c4d576f756e56302a353995e3d5d47a13c1d871f93703ea9ac839e3d2e05a486211a0abc1076334777a124f11d67edfa4e5c5a942e78ea672b2f0b130bbd9ccd8b19ca7d4abeb80b168a48144291e9d543e3a50c41a204bd2e697cbe9d8bf4e04fd803841ebd996aaea25d823fc22628ed5b91bb7d6426b93166cfd5449fa58d853b2ede44557adb7341640ab3ba19bf7b4e41c79f2bbbb76fe4619a1a98a5633ced8fa25864c8d5a9b78ab47cd2372d771c06df36ed09dabd081951ba5ffb073b876997d25b228f9ea7d04a9f83f64e0c5f516d1511248f4d057bf05f07583fb94a8d23761d6e9bc93721f3ad4f482b906ed2995c7373fbb2bfb844e7ee216269d71b01c3c506c0a45e23e1404958a45adad5d489d85f147036a37325654513c6d6afe87ad098443c9d27291dde0e5df4837d90ac19fbbb79bfcf8c5669f2ba5d0edfb85c0d3ca8971c8806fe9c030ed8476577163b7a1f9edc7aed3c23aaf9ab3e2cd464fa84f8825b64dda62668c88ba8476139c54510f092ff8f640b20fb5e2c826601f61ef51d81c14edd70a7d806e02168ea6c637f1196e6129019313880def146aedb7391106f1c6925b9ff9305cfe73d02eabfcd020bd20fd4c741be4e77438fc3064013a124da4eea2f53231db1be8df928554cf0002730d1d37732dd8c18c692da30b5feebd980e29c519a9dc7fac2a1eeac8cb37f57df2e9ef6ff8a1c5fd995e93cc8755739e1d9db0b1686ed97ddf9ab3ea265f8f1688a96758b6bd03183ea53d8988a61321556e163c6dfecae56bdbb2073e47a00e7d59ccd8a8118149477aa8ff03cdf87c27cc9688e0fa8d6cc68ddc8f5a956177da089282bad0572308ddd84131651239f4d7f8a560a3867d88c5dbb2e5209f900f5e716d2ce4cb6267637e11b03fed9f94e4257b655dbd3698710dd55ee0487ee1088266275570c2f0d2e831597f1310c97df6e6303fff13ac0e6a200687b8d7db4c0a8ef0d0922e31633c45abce84aaff9310030d566d87b0496829628d624ffd13d44308b5e469d5d0ef8dd18885122ac4605ea07b545354621983c5b10c89a5366762376ec99be90d4ee4a62e7c4259d2ef1bcfd764582e54be832b1fc4d6585f3d6a50bb7986a94cf2c1e3a3cb0fd546238c420d5cf4ff7196464afb580dfdc44e9ab48748b091262c67a1d54d932668d3bfadaf1b034e8f9f4913e33e568a9e8ec6e74e7c94838cc7194b9689aea232ef1d0ad01c901094bafaa2f85ad8338f8f3305fa5a7c71db1928d1ef2c6cf2cf3cd50dce3750d5dec08478c2220a4db835e29689745c6fd00c6a4a663b5ce16053af12e0c7bda560e21c3b6ce5e39820a6bec2889641c3214ab5af634932fec340d996091c54d5baebb143ee8fd2b739f270a6abc0e0d4ebbff0ab1460b88a5460e0e5ef17600474e8a97fd66305040a80d1d72818f65e4beca17b64dec7ee2b58d4956446efbc7b6605979cdb6e1d49d72af9e17e4389995ed8d348aee8b64d119fff23ff236c0fff0f3467a368fa25890904860650c16a880c47696e20245cf50f30b75114f4d0e346a8523edf00898377b6cb72a8892494303452248ba2fce91c74571886dd9be0d1aab81de8062bc3e896ffb428d0dc8f5549b6e7efd5c990c443bbaa1e23b8de8f947817b7f69b314fc2fe824dfefe7bf2fe2e1d907685991cc0fd24d77af957e42c4bfa83a30d7ba9d172453b360075ea4fa993903378a6f8db1ddfd19ce086ee0348e0b86f61d5db056a21db3e93287dad1af8051c5683036b8b250aee92d2f973afccee7b60c0f6c2a56498d8014f1bc5fc317c524f81f0f21177aff0cf2b6b31507a67e1052310c88672cc8513df0f338b09cd3a8a6793cd3e62d08ff3165a93e8c183d905afb90c4aeb33d2cded35550c6d9de1b7e05e42b56b1b3915499ace9a66afa1db33d3cbddc2b3b6ac64cbc2b8bce285c18f0d7369c4b27eeea00f6bb3ad5c019d7b6d4f0460e2020ab73a1bf06fbd6f768361b199b609356374e4944d63d34f6848767316feb733e9e7872aabbb07fc37e5cd4c3800ce23a0b64839f304b8890491b06b89b3494a1d3c0da7fe6fd9a155a129d08f73a3c659f945607fcd2135580263fcbdc166f4ea031e80486a7a4fd7e9a5b5ad46d3d60188dbc31b691317c0d0c3ea8504d9029ff4a633dc40a1aefeaae684e66e7847076b8bf631000248cb5c336f2dc4855b98f101a15940b1cbac1c799067f5a37d3f34d22280d1ebc97c2d442c550cfcda19b98e60b9de3e7f25c8d9c7d7ae44adbaed33cc01eb2d3c33d0547a38f241f79d364239a99dd3908ac4d228280dabe59ff2a308ed3e303d2e57df447af397730b97daaf499423544ed5e21b6ee9d66db64796cac24232d3470b8f1ca9d8d08f9a685e4e8b71718ff961da90ce3f971bcc0969982f129ee72b185e2bec013d0077c87d1dc3f71376bc3d8ff66b95d779124563e182066ee1c06a94f92cdf13c468db70fb3b4592c42935f7cb45abf3d8ff7645930954b02c77a16d793b7ecb1f0f69f6ac249d8390570aa953284b13cc3cf61e5aae9eeb71082672292fdda5d6c64ecdff169ccad768a68b906fd90db1f77448459ec3710ff6b549f0ec10664a65a9a392f628b97aa50afa037da0014115122d2d4fd3938f11f05492fe64e8810679eefa1ad0cf11143468af60db73421ebc66e6e67ff0a7681d2d3bc58a30b7dde22b78397e2786ff13d71c6d8c869374117d960b561e58673436ea57a838ecb7383a1780cdb5667f94de6389a5970f47d0fbe326888d43fbf226755ef51d41c6b3a26d1f19eb4ba35c4079ab418e7a5bda79058f111a6cff22f98ca7fb35d9981a368ced26ce9c9be2af7f89c0e62d4bffa1a107b4be17a5c2dddaec3b36fae0fae7d5dcae39c0d096228ce3a4e7b0e1703df3a23448bf8c76e7243aa498b7fd0ab6ac4e62ba5d517f07a6105657e24773c80cbe409921807465be59ff6cb6009aa2c6183cbfd2044bc1c7b5bc7e0bd5994eb356c67a881c4a934522f4ce284d2e592ad53844f3f3cd0e9d52e0b5099d1c464d696178093fa61170a70f733a81e34512513670593f30871df8254c0012725e95d75fed66a992511c523b106aae17cdf84ebf015d4582c8285b963f4b086ba63975a2bc2ce679dfa1829a0601bcffa386e32c191b191de99994fbbd6d4512fb28c73a5e06a7b812db908a1d0fea94db61831025a570fe8eaf51b26a7a8cc8f4449d27668a44a2d3374ac134387d2367666c4d4fa793b961517de3c0798cb7579608e49ee5031fef26a327835f2f8532d7b5619433eefd3a252ce57111ff35f9a3fe0b4133138fa9f09c55be3be3b1ec167b6ceac991c188fd2288910311efdaa3229a34a61e58c0e4bbae4984f75437530e98cfbac4e5563c1900f54b01ab2a60a7455964f3423e09ca0202072b9b25fd59d81bb84da3aaa36e0b7727080a4822ef78a3b908fa3a46dc6afffce672bef01954c6c5e4b9654847f3b414087f68ac275554e57ad408835c80364bf92136748593484fadbd2be635973629a49b8acd48597ba9a08b8792bbe0fdf1b28b8d6e1b871aa6dcac4334d05a436af0fa1a18199b43797179bdbd0942b2ae6bfa23747d143518f38dcfcf2a6c398faf2ef0d0317ab1da3876ade81244db37711dad287b6b2dd862851a172415494f5c49fe188392f506109fd5217af0dbc71cbc3c9d13ca6cecdc6e479a25aa5dbe289e03f7323e9feb1ecb68e5a184c95ef4f83c96d0522dbee2a93ca34a6de6370c5d85300ef789986c347e76ebd1708305b17e1f8f3bb2976c62e402aea331f81149251d097e398c284bdd679a86e6559e10052b5466ad790006ffb253090e23b896d6780421e86c162d25a42294ce88c41a8689d123ca1c49dfc013a9b98320b14e4fb8ed6f0819f07354a5799819d7377afa9a478764358d9ca9b4010aaa74a2cd118bb15ac6f7fd6165a970cad45cdafbbeefcb3dfa08ee17edbaac1832870bfdbc9abd0212e549e34abf1d02cbf7d5532a33f73890409975d50b5427dc19851dcf8e795511d081ecd200a04bf462e2a0a5fa450d2ad1c94c20b5eb884bd1c5e016b4a725b66a52b1c66b09e6f2239f8598505900b359744219063d414c4551553bac6e9024590092dc68c8b29dacb50daa477004ea632a0c34938822bca3266724e8eaf3ea8ad72e67ebfd569d95e880d514b52d1b814a6e754fe9648df16d497d5635c3d08b887caae714901a267f778336b970a5063f92789415d9ac4859477b4a86bac5f01ba39fd466341098cd2115c15569c9f11f53e50438423a2ac57fe59473ab09aba4c28acf9cbb7367d22f3d36b6f943003bde88c9cd89da2254e38ec9c7393ef43fbc7c6a2e016c7ddb7ce3d65f2fc3cfd2db42a970b4dd78ffbc234aae817d7ac1fd43cdefa431df0e333850846d908e9434604d0cc3256487ad92a312aaed474c4d95c969f385c7c9b5b90531e39742b8bc9dffed78e5efdc5dfc02029f180f5bd841b57b36dd64ac215d271a220b61b873157ce1c61962e9de8179ebe4f07dfa72ed9d657bde23bdf5241dd0a0cf2ea4b101a5f1e77a0fb6a43c3983bf88fe129d395b1d252f0fbedaacfc5343fc4e1cc7cabaea25a06e5bdf5ee4f7d7a5a363cee1297fe97a5d4252e6f6563c9481232298ec01dac4f2365a146bd35a45189bfc5d985feb8e89b692c35efe29d1b1c09576fe97776a9a887ba51fc72a4475944251731c89047bf2aa5c3de9a17898ceb29375444beb4a380edc438997b013ec7a91183de6120bc28d7c85f4899fa904c9d58a881c5a7ba8ff574eee9350492455ae1a84cc8bdd319d2a39daa5fcb4f40888e89585515624877a4b60a71e89761ad6dbe99b47be23da59e89250e9b4b6f72e3f8bbf3c74ddd695d48b5a75997cd22d42defc5e18b15492ec9c4cd175919943b83e8e6e588b9564b1a83febbc863121088008e831050e7a4537b5f35e360d1ea1cea8dc2a6d32ae733d70135acefc0ae03db5ff12bde9c47ccfc4ea765a72faa8ff9bd0da77becea4fd3a129974b5f514dd36c8232373d7d842478b4b3a7f5827e5efee2a1de2752a085fd198883b8be22cd2ad6f68cfd81c33fd5d849ae23aa8773c844bb3b45a40425a5e2ea62a9f012a15f17b0b3eb1c6b342c00d411f3954ef6fdad718a589f5fbaaefa8cd4694a0c930fc4995084f9d436919c21f3fb4f0ab863cbca7700ca3ad6789838360a335523ea32ea71c739bdd7982358be1da2847749b77cb7904d5f85ab618b0736dafe4aa391733423e20ea16cd7c6ac48f0c16338bf4a84952fb06ce1822a6221869f33152a780e2fbe49569fe47cd19c9174deee775500e8ad71442e074c727c8e14ea7c29d45d0fe935478784951493372c47cf759f6a23f1442b81ee202b32b0f8701ee1f311ebd8f66a1e9afa560635b120abdb6fe50009a68c7715812b3154b0d2fe0b101dd3f99d4bba52e9f0890ef1d2ad354927e99abc770e3b5c6760edede01f60359b76424caf450bff968feb30389617b388b360feabad9060065757eff864b22d85f0ce14c043a8d83c00adb2aba1d9398a60e9efe95e8e0450ae50dc3a597f60c40953b589cc04d8187300a512c70a8408f53357d11922d7f669c2be092c32d0470deeaf45dae5374510cb1969b61f93583ebfb2d4862963e24fefc5438607a55b7d0446ce2a6d7aa232b7d188165688eb7c30aaf7e2f061776b16d1265a53594cb05a963b15b39e1a1fb433f38702456a32d8aaf678a86450fc0f6eb21a2652092e5698e1bded10c2d15ad4d35b7220f2648028ae453d0df10a012aadc283b6b11868af41e7f92787f2f9eb4bdf2eac230b58a77189554f6a9f4a0114e2d2c4c662067dc7ac3b8a1b1dae213b34bd38550406fd871eb03fa7346bccc6557e7281b047341e06ea973487c9ec3fd175d0724687346a8478f47172efe58d0b73a88aeff9a53bd67b8149e0f8b3582fc473049888966eccd4e79c7612ad404d260a124509f759176cc9c860c47d687457cad2ead185537a0ef2dff59f4878f2b8aacb1f2da706ada2be5eaec159d2d1bf1c5f11ffe082b8fb614a58da4793c5dca286ba33b28fc157d79bdd7c9f11dc64923cdd00f016e27dcbce2f1373273c8770b41f40ba95e7ebb5ecfc96980beccb51ed83505842c14c4eb5a0fcb5186ae3507fdd6f104d2f871b9153c52b90495b2d062cc63396f33cdb158459082121ad45c579bd4cae45798deb8270b782d6fce0b5a11378376e4c1b374f208eb13f08312a29497d530acf1d5cd7da52eed17dfa3a8e9014686dbee4ca0fc2f1202f2e0c2d64de6c744eae83a64cc262e0a6cc5f1d2742b989ce666ed9bc89c26352be046a0724730eae7f393ed9f11495f22fb0092241fd122ff92b45179793dbd685ee37fe4a57b3d3b5e687e45f863952a1113e6a8e61a902f640531014231edaf620d3d212562b0c5ee427d93bf41315cad72ecad24c97cd568dc9eedf1fd16f8b72d65cf9b592d5b6d912dd3570feb7f63131aafdcaef6e9dedbc30f371ed3addb971dc47c0524211b5aaea39705b7c22b6774af59184ff9d82868a153dff15066ca8e557effd880ce3112b749a63fcb736271e90b7a78f1ec6542b85afd957c3b85914d2dd08b4c8549d2076072bdbf261f54b060c25aed0056ab38f5d1bcb2849cf97e5d4ee16a648780461d7201977d3b34d7bfc6b64f0763ea84574ce458dc8aaee9c7fa31d785b06d6fbc3eeef1407aac138ea4f12051c27afa27bb71cd002496a06afd138a3508dc7d832c6539fea2c6c3b27ed0c03aa0a31d61f6cf12535a913b713c58b57826bf4917e5fda2e2698b926e1d55d90bb601a638918e3c81b8555b41b2f5f3460d59ce6df7fc57dddba03240f14983d3bd87e7826877186d465d9755ce65ac7cc12635953b18d158557552d7da47f7f4458e4468f1d93dd395d44f57d4d49c98288b3eea055f440f7894e8c47c1b6481be091f88718e8eef2d0b4836d16e4843d37dec49aa27e3792b107462aa0dc38c431bf166ec9823ae622461dcb58dda0fcbe71f4b351f617a78e90e7919c6eb4762aa593e11fc087dc5902aa36d340c4f615cc951c0be293f4891d2e6d62c0858c8d8a6f447f49a381f741e6e63970ad519878cc58c4c716badf304f53825c2c538c63223f1ea4fe775f92c8c0141e761f1730b51819c934b5dfc48770415d35cbe4f51e5c09a1ac29a90be4d954f5d3a85989bfcb348f8d05d23621a0ff1eca7c453e35e535e5dc85e51e892005c151c59c277e3a7ca362df1227bb613178d6f91e62c3138deeb634606612584417b62e17fe31a64cf6c647fc450bb2040c533a57eb19145189d95a5e9b4cc099bfaaab44e5aee224ef852220306bb6fb79de6cd26d88591618a7b1b09e508ef8ed8d25887592fb6c357c19f93667bdcb00f74fe1191322e1bef52c532efdf1fd1b13e9479e3aaace0e315e4c90f83268cfe3f6f41ec81e88408824565a649e52bdae6a377e7439fcd5bdd7a201e1b4539cf877e979ae32e2beebd7d9e2f86e456695799c9619fb425ce5c57fb5027a07e63729dc72bf7339315315f3e381dc8d9ca7d878c0128e3f56ccb461202e56f348132d94eb635b40f15d96c8e01e68c612f3d3af7ae6746ad541da26e259ceb611461119d4caf4c27125d3234e53c831232f8d5e28efdab9ad00fd6c79525a83c56903c60cd4ac294db73c9ebd7bcb9ace029a55d5f8c383d313ef6dc67631fca8e9234148246954e265323d4530c77a0089372768abef56e15adcb3853f9cf9fe2be5b75bf907be94f9ff643b9034e135c3de7a67274582771180c5f2a410686a343d6a856062ddf8622eafa55dfdbe7d86336c2c6ba8f2cdcebcb3a26b3cc7ed46e163526c345f21dbabcfdb1d2a57d5b14c7878e4b31e5259d46e164affc01c67840af3157874b7ae432c8494e4eb624c537eb75b5a169a421e990dfdf5bfb50a6f9a8268fae32ae1e9960cfb2c0061170103eb27428deee7cbc887e67f4fdaf0a39068eecc8bb7b2136bb35e3a4bb15ed50a0eb9fa6e5ded75215ca622acd24caa15118cf5cd6f5dade6629561cf89dc6efdc9782fc21e302f8503c5686663dbdaa984ef5fa550cd7d2c7be5d3d6065c5a8cdf651be418cda7339136a9b9dddd9ff58e0becaddf0145ab8db6c1519ccec75765f7486df55cefdf3fd3dc885765987305a408d383dc81cdc8d84b97f0d3d10613fb8f1ff52f1366710267224c22c883467564ee3632158a18d38dcbc02ff6a5835ebd13e8ee82b7e48ee030be185e0cd7881b71d261db3fb679833c9d5325a24a94835f8c68ec70c378aac14e96885c71ca1e5ff1f071d822165b86f272d1b6fbe2b16de2fb0a01ef55045a45d4500ed2550ef780c272a64f9fac51eaf83cc62c5a93ef669085cf9945da4c868d521d1232226dde499b104a9d104eef3b2106217824b7495406c6f462bf37bafb7298d9f18d846c964535b44f22ce6c6b0414896698ffae51d3f933f39f2a502efa7d7d715ff02fe906b09fbf3bcfffa3944b3f25bf8049657e7d567530f4f591d50cb2e2cb367e5be4aeaeb85c810c147f35ead5f409782649adbcb4a59fac24d18030b99172441dd5b8175f91314011bc9fdc6189c67daaeaa8a95c02c637906557e6cdad443dfe69ea30ca8c41793c7ad53e89328aed3adab08a0f29dcc4dac2a35257087f9746e281a90905a85263ad6d38ca0a6b5cf7c0eefd966d6e3d73532c3e1d6466c5cdf4cf3ada81b67cd033927714f2fdbc995cf28c88cc677faf3da021f20ae6e278c57245091f850dde03ee7f22161cae8437f4d99c9002544e765ac3dd343d3d451da87269df6f185546eb5d71cb38d965bd4b9cbe63e311c0bb2b437bb4a07b20c8169cc2e57aa20b1d76ee0d88db9cc31804fd47837b5617d15f8c3272aae8c19d92a6208145ce73b6fc6c311e1182151ed32836b98ee82625a39c3e78d529d01849b868feaf9862443732bafb09ea3670da70f68304fda0b0e71a6bfa1201b8ff4d07377cfc9efffb35020f7c089fe767ebd39b0f780ec4868fb287349058ab394bba63d64a64225b8378783101c53284d8a084e2057c211895aca6797cba63721dbc4e78e509fcf35596a5f0eb23b2ce66ee12f06a335aeb1e315f53e580445604b7d5eea2836045193cb538769bd700a4debd9ffd56769038b5d2888a0a5344d7a8c2cec384b1da8a9e83dc8b2204114d081d3eb01d14106bafd351da7a85dfe1d8d4993f4829409f19fe97914366c9461fcea0c8cab5f3cf634a303161c825a1118a898d25c3188eecbc9996ce2e518a82b9ac1da4dfda17cfef1d8cdfd76294671bc2368efdd79f17927d1d81c127b33d6c61d26af1f89822838131a4e86e9b56c777fb961c7bf57af60b42a8ccb0828b62e1ab1aa8c8323dd9d5b403a6c3adc6cebabe336d97ae85866ba628fb31f55c90c5b18f0279e75806cdaa1bb863d84d1168ae5999acf84d91ae7961e202e870c8d83d860381f609f7e001d0bea145b94d6c8cf874c5f8d8c0a4eafad5303b6959a86337da09d5fe4541a2966e8eae0e0ed617ced1c463377f9c6389bc5ce5f4accd0476a6161a5d6306dcd3852e29a9c3f4476db9fde2eb1712d25362e1d721583e2352ffabb8d57c83217423728f448392483541eff348dd8cbabb934e31893c7672f860598e09c624e6258fe431f987e46d85f7b69965a7b9d1e84c36d21ccdd9859c1c53c0b5939dc712f9eb18979e9aafec2af17e2d797442fdb6b00dc141590ec1dff663ee7854cade7b93d7dcbe666dd5039cca7ecb840b52f13349eb264b61e78a825839c87ba32d3324dc83bfb4f04352f7c6751489e67496db194c04ebb113c990b2ba7f6b4bbbf199bf8c2d0936bdb77bed84d6e91632bc655535515824a6efa7ee4a4d26f02b65d6034c8a6aabedb48cf07d5c2e199409532e4b24e8dbe00f50ca55dde2b98f4a50ef604200ede014b06c2bee47fefedc387e0ba3206b3aa0cc2b2c2a2d7f27eb0b787ec6d86a315ee40c3c1b9d7bfef47fd6b323679b568fdd6fda2b0da30969e4e1fa66725eab29d824059af792b091b518ba30e3742cb180f0c4a600c9dc4012698ae60ad31491c54aa683028e0f91d597be9870f89d4e86017c7241e5068a7fa9ed10255fe7b7d355ae66f0534b02cba81dfb93bbdca461566331508cab031dbbbacd8bda717ef4cc109c5cf487f6c7b71c3437d6ed52fe6795226da9a4a3a78676e2308848d46f238704b059ce6124ff569479a5e900a4612905532a8949a773803f69f7a2257f4062140717d81aa36e717d48186e6c606b1be96c37d1dc9c5e86795e733980379604878ba5ad108b15f643f402d592452005079f009f7b728fbf3bf95da739c5c1c280c3040f051dc8e8e65de497143c6d3e39fef98ea97ef03cb85644a3aaa570c057b4e274f2c1cac1f19bba89d12718d85d1318ea0a4b68eef4409d51b0834397cb554667e3af507c478b09504adf737ba456260b64abdf6a760711d80913817255e680cd58747a77b17a7950f4551c8d0125a3fd0c6fdfdeba472c717652974e94c3f5543ac31b4cad4c5626c052055d2978875bbfc99245b4ca1f62d2e45c4aa80363f996e608f502f979782b231afa6e8483fdc91ad187c75a97fe25a243bc9bf5809723e11afbd090c22a11b87058adbea2ad9bb91f6ca7de34591d004dae8f52990e63cd22d21df348edc5aa4ae260ba8ca3027eab25ac9e3e0b518c84a538bf983cc9d935674f29d699f3c71262132b0f5f99e0b6aee3fbae8441f2d7eebd7aec9b313e3516268276c916e18d3018a360c60c2225060817060b0e2ce56b84357dec4289fb448dc1b47b45f401308bc4d7f5d6e75962329fa7c54bb82fde74d1a8f87890d6ae117e21f389a856823216cf76ba71a6feff5e7f5539d279b0fc7b9e84baefa0ec287ef90ad33111cb97a9e517e7eebc5758aea61fb3f4c07922b794e81f4c4ca0b01972b3dfe9b806cc3b0d4709e3b6f3e498c86ebbb4e22b6f9178e1112d366f9dea87b12fe2275cc4261029df7d3a27cc9f97de463da0450b4f24d6afa2b51931544b6c70f0c054942b58306c72923461fafce276071b3ef1a37b102283ba3c1acc459b113c720b336c1ebb8e5e719d992591b4827df76b9f6c6a3150fb02ab53c94cf8c8e6e0c7c7870f7f725606623c839b43f9d49903ae96817264ebac2f69c5fc892bb25d04a45ee3e4f8dc1740182ca3a31fd8dc875cef7f40ef8f82ed6f71fa9ea2452b7609e2fff2bb6ce4ad1d24cd1e25722f31e2a1560b34af3bd91e41c45847759448a8f975d7a7b83fd2c67837a486d057cb6cf42791cb8f998f18d8ee8001e6689232935340d783bd55ed7840fc056e8ded820d75ab3dc94bce932973fa5b0d337ee84a3a090a95442315c3231a13ef8b30c52a90cffb2eb3c375ae38fc6cccba47d0f1b875ef5900c2b1dee6de29ae90a5dac0393ac907f30fe1fb150d8d65ab93b1f213016bd2c133d1bdd0cfae4d8c86f1bbfcaebf36b29a4f1dec19ced474041c3bfd415b816323fb5b73a13c51122a87f3a5ef297187d3d3cc83561552e633a4801f76c748d10e35e751bfef1c629caed4fb0fcaecab884a05bcba70b1c4b95bffa10c47b2afe0012e41d75cbf7744c01d2b1d89febbaa00d4c68c175335965ec7e0eeb0a473b14739449fb81cbdcca7def4afa837063ebfa04a98b8eda0883c5682cb184a7289746a1e09c63753c150eaeb17223cd44d0023921df34268dbd7b013ca343576919380d577f73e2654ed65df10f9e18a704c7ad1f723c9ee8788b7399930b2ff28a2b016311a2304fccdeeb9f9b709b971b6c41cf5a4ffcc5dc304b810240dbdf4203a25a13dde46fd6b118fa8f7257e8743cca57c97ebaabc718039d6fb863622adc1805a01d9bf0cbcdc7a8fbac0796fb16ee57031881b79aae8d6c1485f2c63d4b22be8a4b57da7567702bdcb2579c9c4fc4e585d2fc0758489ebe0627ef63c525e1676accce6c6a7c22305aa4386b5f223b041c360103e61887c66fa30ce40700333efb3d225ab4457dfbbcdb4a7b461eb3db868a1538684a382effc5675cec5d45fdcff9bd45bdb9041062219b89ed3d0ce8bc619d65bb53f940a7634067c38f0178add8b6ecfab85b97778069f13602592d1e3669365edbdfa58deda2c09390a48ee0c6026d75b97906dcc46a843c20509b727aa66fa83adf045ca99f8e01fafef08f865250be5bee99678e4f1ce9abf6927b10cf6f12fdb14c3045cd383b198e4cf1d144a032d0d6c99da9ef786f949d3c3b6c278e105cdb12aa0044ab0797c522daea81adf187f72811a62c723b4be467dad231f0f849e0b7482a1cbb30de82ab3439b313a456c5b57c8fbb4e62991f8bf2252ad610c6789ba317ec86a6fb3cc42196c42c215aa5b4a79c35852b33982933b7e69b38f2e166d0115e35eb5bc52f1ec1874baa2f62d15848761472e5151f8856c090b938886c1031bb81377b3762827da0f6934a1b3c798e04fe1b39ed89cd9c7ce6b9274b9dd79100fc9d3f82b42086a3340b72e82128de1650ab8a0556907d5fe84f78a635ba057c19a8bf10df68e789b64f1f304a52227463c2c950ffdfbecdae91554a2fff551da94ab5f72851435eaff766a20e9f3611aa7a3e4569bcff05e0520193297f2d984afc966d82d2629574466b037fa322b9ed1c82fcbfedeefad4b34e77c511e9575e236e3175799e2fbce6446c531eabbaea55cef664a13e436b5f960b553c19cdd51bee9f77bb5009c72cb5941af9ba6d201060be505e8b922327f83cca76a0e9015ab67f4cdb3d18a757645468321537f607a5384962e97ce4a8a0ec8b1ce6af48ebb312f707e6f9789259091f38c57da888cb5bf89617a3f425e64e7a3caf8e62c020f73c1c8994c2e4aa37eacbf74ff87f105106ec01f53163ec005cc1c436cb8d3667bfb918d146ec2eb2edb1622857d56f21e149fa1e6101ddb2c59641c32cf0896782dc6be9456348dd5e4d8a4b64f93c96d3d7eaa810afbf89fb7f42ba11643962cb79bcbec4e88ae11b53d8e125765b6c8c38f70188644d4909ae91b37fe0d53950ff9d23e51fc3dffe7ad555d479736cd630fde420c9cd92b481f572e75b08ed0d37d28d03b88ab28b7e9e0ee35b9506a680ab4f9d983a43c3717012f34d663d3057f5c0b2f22184291c959155c8726ae704f72b3f08b3981cfe839ef761319a6eb77cb581fdd9010d8abb94dbd0dbe73346abd6a308f037710ff1277265dbe59027c51568037b61350f0e11e35152d243fcdeac6ad8afe580a5ca7b1776f739d408abc60756c74d38926ebde99673e5c4ab9f6f68001a3100dc2ea83cf69dd161229c34737d0eae656aff4eeca0ba25d95f88b855712e0e6a4637ea45ae523e179a5367021e73712e4443a934e0faf35cbd65d344615c957b4fa4b602d6d12aefab013b6ea73260768ba12fabb854db5e67a555038c7fd236642b249e8ebd93da30f5e29c6c961c588fe2ebf54f8adec45bd3dc30044de10dffc571d740f35b1f70b862d724f10205c3e282b0f1d621eb7d7450065ac65be2ec045112f66b2257b49bf424ce8d3d53e4e933b3ad009173a564f65fd9ecbb6c53d1053a6407d380f5861b76fe2ad5385ef2b4fa5e2fc49c2b0aed72d03ed9a7d0b33a0f9d146115852196947995af5b4ab53a0980e86ac7dc20de6f7856448d4d322fd37129cf0f10ec50b3168fb3871bceae013be7c4ef34afbd4844426f42427f8106bac520d029f5124927f91185de8cafc74fd74ff0df903b8e1340ff396a2602f74cede05fe870e6429202a4c6e219d87576627b9247021c75826caa312e68620f9ebeb9863dee6b4684e51dfa93378dc7a0a41ec32c6ca96eb46f611e26fb9a6379ee8fa08e1dbb197038f10aa3fb11fe2326c2ceccccf15dd698c63314c1cfc91dff52c0da72389a05681beb4d9d40e93349d4f0fad5bf2d00dedf8fe5eed87419458e506dae1184af0537dc83c5c1d9e5716929bb6e1c8314b6dad97cf21b249667983dcd45a36a3b5840e8913304311c6874bedb33098a71b2e4c04def2a2b50d236f11e21fb87bd36211c440b9349acb74fc2a7c0d46e823940c3aab81af2ced35b98738640ec8dd2ed08346a603e070aa7d87fc2cd36d71415b77bf8b0da72cd00837f730bd3c07d394588ed95ec48c411d75faf52157a68c72a7391cc8b9c866a69c88aa0eaeb834473842141cb88d76548eb328b1b6a70f0e6927ec8164be4228eef2c4d9e2e83b385fd3a09e5d2c7dd09823b3c1bb0eabeeb759c0679bc3ab7919de0b8a32a11dd4c5e2639714a479a313c8c91fbd78e7832df25925a418c694492a252d761430394523540933fb5a8d9fd41c2e67a51e76d23a1c615350f410adc67c75c7365c69fd9a3c660aa6038dcd2047d84f7460cc872b9f0350451438b61e44ded90de8c7dcdef19826f5bc8618f9802b81c563d595fab4a2daace812ef278ba401225bbdeb03bed0c77a0a541c8a66265c609beae886bd7c00c2d5390a1a3a3784a1c2e48bb11b1913f5c72b6a0a49267805bd15d509b18f034bbdbb31836051f098e0c0a86e9981f8452c00b03a0d9feede0fc77c546fe5224741a1daa60a481ccccdb4fce2d94a59253a93d073bef8b083d6e49ddf316fb9c7b0f234786fc91e0372a37ba0097cc332c5a219d8ebe93f7f6c9e74f47aae83a619ad9ceabf123cc1050c877050083610ec264bfbe8170574769b85a921a0c3c6d8d28ee5f805d15a8323e7a616a9a0d5141bfe485ba8ef103f6f387767e3b688124bb6259fb4ec29b771004b8d89b504f0c9fdbb44f510202ade8e04a9568a380eb037a2264762180d00a767e28eb90c941f51ab2367dcb9a2a4e70f90b100017004990f29b1853ca90b1c40ed8ed68b9a2f3748a9afa0eacbed677e1af9e18e904367791b3c8506f6842abdad9414922e782db386c0e1fd9933cefb833de63a27277d47d94eecb4b49f3a6f801c8006afdbe2bc3b2e62b4fae0b5f5d2fc75e84c5644d73c5fcaa3ea50c83de5f5eeba243e7c81decddab6032cb6b023c280b92a3964b5022cae7bb6cc297e1dc76af6f2be4ce1b664c9817210ffdc0aff951a44e2203ef8caed8dc30101ef5608e6a332e6ea97b7f24fc8798f682ee15f1d5b01b45af0339d098018412d2399b2a080d3fc6fb834ef54e561dd61cdb124c4d25e2d71b4d9f3dda012b366058c696aa4ea4efd856fbbbc4af944ba5190a4012726e10962af753116cd8fa212d818c572fa6f69768cf5c6af6a4bfd26b18ca2cfac8e0c3f05a2fda0e47c8c1f01fe3fc8791371eea505de2896c47faba6ffc17282b8241250a0efe0ea4e3502523797e437d6d3c8611ed5ce7216e8654c1aa890fdc0a0b03aab597fe0704c34316ccaa75d90706f06a34cf7a3dc608ef00bd2d557c2dd4d5db5726c632527658eaddca0c61b5e63f524758ede93946ad63369ae26110969076e37fa45fe8d7933d17ca30b0c21b10f7be698b803cdbf9e9f56ba5e0bea556b8295d1236cbb1eb960f994514bded69bf4c21a2f514c7aaf9fddaed358141dee06ceef596d166a2f4b542199e6ad91f4e0f286ff44f95f83077fef648695108d9c51e334576a6dce0a7f963402ea12791a2b44e2e0f3962db025200205b0846433b8319d3a3808a5367004b04f84874f26e2105564001d8eabeb0c7f22bc570472b777cdf27045e9a52dc64606cfea238328d33c0c28a488b89857b316283f5420015cf72cf76c31f8b0cd97a74b78892197e85fb0fd93354a81742134c45607c15ef1415e7e2d17d128dab8a8da767d745cfba65df35351c24d8ce8cdc6cc4acfd142a37c2b9476d56bdacbd4c614c9fbd5615882c41a198c0f0a186cc50ba9d7a47a6c8669e03320798d7e3d2f71ab4b841c5bc7e2fe07082f5c8465bda251e4f02b5e2c81aa0b14b1b2258c97631c641d3d1a12cb30dbcd01db369f51b69eb82a09bce35269e049f7669f477c9e598473fc291e3bf8ea55a7a5ec79197f39d5c08c341fefb4452c99a8ecf6185cf98a09cf350efd0c729eb0aa66a59fe3ed0f4fe85babe9a51f7b1b99b9d6c01c904d3f1b718a641b4f96aaf27baf31d7d085d7ba2fccabbdf910668b9994f1a1ed1521c33caaaa0fb24f9b1b160735cfb75781d937d6b55d120fc74ed28a289c4f834361a9b733ae4a27df8c854691715a1b365c18c81b832ccf4c6a023ff9f68dce3913fc80509932a4bae00b4a20e8ba90d547e624b2170a0e8bcb4360435e5ed0002d4b2f899f05a0e7c1467d2a9449c8dd43c0c14a408a3dda4aa2d29e1b0ec449bb14365b1c8dc4d51eda394aa538a54009c98cdf84bc15c3452f774a5ad04081520af81e657afe3359593b68d7f0d65199cb195925a3fdb8e11663cbf5c8d623490312da58162d7904cee7f41da0142dd2c784bdd1b3165d3035bb230ee84f65e571d5518534220fd990bad7cebf620047ce240373e2a00feb66febfea612e59720dd41381442f53aa21301a261f1bf5a622fecaa9c35028291607faf92cae3ba7387dd1297512edbfdd0dedfd09cea60a2d2bde92247914bc145513b2e8067ca744bd9afd94267bf1c637c9ef4d668aa54993572b4e7fe745fd07f61f0787d8e7ae25245077d53fd34c76c4f824df3ac1243e1e6f379b6ceeda1b3501c41446ae3fddaf56d828acdaa1e4681fd4965a590df5ac4b031a3edee425319e1f229189d5141d45ce046aeb716a5db46b85b0451b574b1fd2f648711f0146551cb4d3f1b07c2ed85d29f34f82cd34f24d98489fd744b03c0872bf38d42929126b491356422e4351ff5e885160013fc137997ff482b83d3d73d74b4adb5b924a6b6f18ae8a146ae314c68c599150ad465059fc17145be90768b71630f89b6bf90dba31786ef51eae57e6c7ddac565f40700d9ea41559fc1ec19b5a24f77b4bd5ddf6d6b0c745f8fa48563bbb794da7a5040fbe95a4b932cfaf1057a05fd0d6df24e05fa4407e592f7a80bbd15b37e0d35cc78305397f7680f7cbd4cb54a0773e73d0b1bb61dc2be80faa6dbd5cbb675eea1dfacb8d0bbebefa8a5c2c65bbecf58fb069975fa4299cbfaee14c21242d14dc60c3505090941d11c4e54ebf0553547fecb3de684db28063317664db93ce18f99f440b226af40ba7f340f0f0495e24c8134ce4b9ca9846fd9259557cec3645d3cf5175d803671407e8dd9d366a56329ec8397453749956f460ba43d2bfbbdda4033c79ca4c61b40b13a21e566248d7821327b46445eba0f2b06a557ffde88746d66e3528d81dcf0bdb209d0d980c8c8ecc82ff2c002a66bfd85b38a2ab405526dc88629292c030cadc063d074e9d77229cfa7ac2a190ced55cc32f8064dc79422ae52bcab8a78a64f0ff0f72a7fb60b55919667390e41fc5474e24721f64599f8b6d7b06331e9a3ba8ed2708a289da24dfa1061180833f93b4bfd60aeae32579c6c0a3754b90b339921b8eef0aa0304c2a2711a53edb41cc9bb51bff89da7492ba19ed54d5da12a5dcaf16f41ef927788e1bd9d59315f5422201f6a99bc27f02bb5b792a6aa8f506338a8e4397be520420244b06943889032ed0ff40544ac7e3d8aa43f82a629c5d1ba2bd71e034ea264948eb07e1f86716b7f1b5d1bbd5aee6c311d0ed209244c07eba623cc1d91b5ca862667219ca3320759180449a3322b9dd0c43db2a108879f5b272fc9ae83f2e6fc9191e3aa2541a8303fa1a9eb09f5b916a26b00e0b0c8aa299e0f38e114ba5b8239542eeb35e44cb50f34e125335fc8803790710d2d706f4751c6a5a7e793b32913d3e99a0af4db24af338d285069a28e386b6030deaee57c07eed20756bba913f9cde42da51f7fe17a0dd3df55496557875c18885c058e4b6d37f32a48ef00000c647d10ead387c614a2b65aa4e9bf5845bd2aa5de46c81a1db1d65ee83817af4cf689ccffae3ed6fc7530c0e366719d30185989d14ec0f2225ebe1640bb660dbc2b2786fad18a5f9e1514485b6d843476281c722807fdd2797ec9d6f1a6a128d38691a715f099ddb121e59e01437cd06c70f60fe248cdada6b53929f269840cfba7dbeae1536056bff10d239b2a6203f6bae9342bd7b8012f01e97aa16cf3d97d4c423b935c8baf5a550efb9c2deb8cd268ca2532df5cb38f25e351d3a4cb5f174e780574bec2f163ea9462df667b3b1535749de33323afe1a9b46d0bf8c7503ca7a3d2fb86de28ee735fe85151fdbaf89f11c5a596196427bfdf7aebdfcbb5915cde25f78ffbebcf2546c15623a490d4dc1d07c5f5423e7d9625608baf6361ae1901857d32c7808508389272b55a5c6401ead0e5e5f76bd7718aaf3028e2cf2edd3a65be04967d979c5ab1df44b04dd7fbbc7ba7309c7c5237448eb1125b86c4f490629e2e4aa87cf1f8ba5dbc808319729fd6b924a7badfe8e8577f4d2cdc0de9146b4e59775396707d9f74c7c8c62b1aab05196261e24957f31ae90b7c69f213ef7e214a8bcda012ac6d13e6a44e335cdfa3ba70ce49d6c37ece5e10ae5bfb82d938efbc593816731a21585e216c5600fe275cad0ef6a5835560de7df0a2d2172f26a213150770d5cc676efc8cd4830416263a3792af9523cf2fd26f8db5d8685be6f02d6b0f95a6515e7fc1f810febfa8a14fc14edc0e627b2f5dd649d265aaf8225bed220daf247660132d5ab7b9563fb68e99be847136bb20495ce77e7d16926bb6d3acd4eee1f661a44f92e5feeef631fd457459414ae03bc318f91d3c3f28c8339f7b513157e5790bbffb8e8dfded7cdc9ae4f37b31c2769ec5a46fa758d8649d11a9e53a6db348fe9c4e56e3aac9870525484490eace5f186f0f1292bd76302e61d30c120a7dfc1e7164c289296a3d011570abc36e1593a1ab2deec82ce16d072244471f02192c4305f05dbf1d14edee8d6c0b0399ff75cc6be171a504520b3f29d4af621195d8478e7a866f281e5d88da32ed32afb1aae0868af5b00125d3406db58cd2f8d037a8fa6afd20bd5344e33a7ec1aec77e48a1e0dd6ab68811ab423ad6817cf696474b35488c549db03ccf32db9cacc56d9015c047ae01179ed99679413d0a87bc42311a8f84c0d1ae70e82eff9a6980ce37acf9fcc1270445664ad70ac01ff71b93004d39c92cbf2b21f372adf900dc53da192a64e5f82143464e7e54526337f126ea7d1568f610d637becc638259051f0982a795b5eb74899941f5373124c570d5070f6b8beaecd56fc79a493e28065f8e7392990b76b80d45f2f541997b8e0aa776bb6feea7266eed480a21b30db44dfc2bf83f9ce53f5cc398ea8a827118b2eb8b9aac128a5b20869e661b6922dd52c25c51b3872d96342a923288747104548d5f0d692703afdade9b9dd82d85f0adf9192c693197c4d084a17f8281350f48c5c8d5f010a3ae092164599195f449a3913f7944f691a02b1d4ac3b81244764f767b93278304b2f80c8561535b35be61d34b92104cccb11591bb669c5bed13e9bb6ec7074f23a132dc5dda18a2f5cff69d9b997283aceaa870500b66cea046f3d12454f947643b5968c1d57acf9784ae342d39059aed8936d261ead221bc8bb5b53b9c42d1ad6af410f0e1ab9726bf2aba994feeac44a43bbff140e27b99c2570e2239256b879bfc036bb01734c064823ad67b71632715c1013ca7fecfd1940555311f14f16f40745eb99fdbc50467f7fb8572deeacfda37cee445f7d5739e09f87fce4102c0ffeb32255a33280bd068f04f8ada6475ff4b2eb70ec647302b87bfd1bd38bf6d9bfd7b7c31912a190084214801d89562333a2702ee7ffcb791c4f3e8b6d2b50990b6512d95a141c54aeea23602eb758e725b0350b8c354965307d80c0836515c2f06d70490dcaf80a5ba09f7200086bd43603e18437c5f467d54d938d23df3bfd19943481ccbc43fb45fbcccb5332b50c470a9cef7bdf6a03e2458cc876f6fdb650adfe6b2a394e9add66f0fb63b781059571e8f14a89871818317336626654f9d439dfceb106a88d7de91d36bbaf3ccf346bbd53278c2e345e4dab6c56072fe3b0df73fe18d5c29d487495a5e109f3a3497af9ab0d9d25c76627aff0764180c727ff295de8e95cc7d45ade4dc126cadf538bd547cc8c69dab5c42a787219d12e75328e0efe1fdd0aea0fdfed24f32480f97b31bc647d781063e419f71cc3fb42e682545204eb0a237560a4662a282704e675fa5f7d9f451981ae636362736f9a42d4a4f056207ebba3017a1efee41def09984f5515f3600fd2c876c1ccc196adfe77ece31eae9f31a15488334a02781df216273cebe306559c6b7dbdfdf3218255a2fd0fd4d0495a3a830cfaf83fd504e56df3fbe4ea30221c0458451151dbfea5b37acbaae0c1b48994c56a86d59e0620a693fe54de7f0298e0e583f4b7ecb30b9d6adffe01da900c679742551b430954c06bed056ebb8a08136a35e471153a92d3bfa2298e6d18002e49fa42e40ec7f750bf59a5974a019a27ca3b6909bdc4ef56caf96a792879e76a16459eb860dd8aa41e43adc626d0c05ff783471d5d1363ba0887989f22c02fe96def679b68c0493a1a23327e4e32723305b349d1633b187186fbb3db90a1f21a9aa186ef246700d457f8b835a44c63d3b91ca2363e43e36634febbbb06ee2be7b77eaeea97496d00353502b8c749021794a5bf80a77f3aa07fba96aa4f862c3d5a3dbca633618aa1e77014ace8969a746ce58aeb5d8b2b787fb606772646cdd012daff4c185d8b5eb724b9b3a843f309b8e01ca28893019ad541341d142bd2f2021c0fdc6d6a610580308767b9e1553b39d7960cfe9b96a805e52e87a702b90dcf26c16049cebb77ebc37347dc2f96a25ab088b2f3ef9eee7a03aef8d87d9bd74bf2663771bd9377515ccdabfbea83ce320c16fa1912639880f92951119478598fa423b732aef4a782061454ff3d452c1c041ddffebda3769d3c7fc5a920f4dd6cc0651ba84c96776532fa3340ae01b391e6ba7295bc4b0f56f6cb1de34acd3d1e42d67d27d8df60ffef0d1231917d761bc635cb566da6aa131adc8c10b616204cf4f3eb2852da8c6447899e6994befbdf32739409585d811ba3c4f9617e9bbf16501cad4ff8409996fb1aa69342b5625e3bcd116edf7eb4e55c6bd7dc8d7ebe29abcd6744fb43376712ed4e181b940bc609d65e6430d8ac800971ec61a2cebeb70eb20fc514950e7c727dad80739ced9a6e3e157c687ee6f799926f4f301f8b8e535d4f8a03b7092413ad638fae6686b78ca90195c872613e401c18bb4c31122e0151a7589edd9cfda8c091ee185f546747a3cab90f9e02aebd55e269f147acc7d6bb44fe5151827a6bcd284bf17106f7f894b8039724a0fa74e016a5972f1e9605ffdc778f789622d769ba6c18ce8e3ed7fd180acf20cd19e6b771ed849e64f413a712b252fb7df4338b9748a1499646406ee46a326b5e455f6275b9a044c3b2ed863053756a390eed2ca8b3a7d9f0c2fef083ca84821756062f59e14a7a6394dc2f5aa3224de255f847be91547f4a737d5e6f733f84efb080bd99a199755714abcc5ee574cf9e4a18571e6d20c3312d218eb5b6cf53dcb5a273caa0ed552ef5d3cf42f9ad34d28803247bf05b5228eb7d467fe18056639b11df7f4c767fd3b6a47f13711ad02bef5617e1654d70cebb43ce1e834d0bb975719f4fa276097e3ee0441519f98d64cf1709f286ec5453edabccf9685c5e59bc4a09cff95567943aaf824c9b71d00e91aea4ee3dcda99df85e00226a8da0b5f9eae83809fc59bc3613134e97258a9c268ecd34d38618552c6522925c0143746240f0a6ef4afb70f544aef4a71118e3db3d022aa9be6237154276eb664ad41e4aa2df3d17afd75038fb0b815b495504ab869f321d4d30fa12ba10e2ea03f41a5ed045018667af8fc2b91e9589ef76f3eab11b3be7b3f8940cba2330bcb70433726f965d1d22440f4d1213394df020648d036231269ced03fd725b2d0b94f434dfa3e0f85a8506bc5d66fa167dcf18e3d02c5719a2b33808aa82bb3afcb16370b8b033158fee47cf03124eb5dbb6ce6d1ec4a86aba5d8ad3dc58bf455fdfa2464f2d0b54843200cbb77b1ee7d773577601a3e8282e6c248a28dc899a82574bea15a69ec6ab0a1bf1e4d0fb493c47861ca52bac75685b60fff846a0f6f73a276848fe5d5cd24352fea90bf4ffe456b216e425cbd9e2c76acb5f230324875fb147a72eeec2f61072b21853bc166a3a8eb7c7056e8116e881287dd9fb85609aa134e1d603352f5ebf4d7c2496ac006e09e6e507b8093f658d443589e6756cc53d85e1c7a5b40ed9721f358541c9757032f1a9fcbee26c794fcee0f29d39398f0b450353f26a3d51a90622e73b673955ac2656db1c578787899d84e1fec4914d2e9ca71ffeda74252c90d820c28d3f785300047700aa9fbc1ed63e0fc6338b9fe03ab913500d932ef518a46d1fc98d8a15eebf6317285c246cb76915e28fb524a8cad5d24dc07d7f98146ec0b0737802208003420a658fad3ed5bb2c9cf1ce3423aef2af04b38071e6d52280c7285effb2034a953450baea0057cc73c8b10720b45d72a5877a4ccdda28bb35d7f863908bb20f3df42dd03f50cb931215e5693debca1802db5d71dbf0a2740f428c9961e66ba7646e61f94476c76a8c7b449973ebd48e0ceae524ce2e4aed1da18e74c8eceed778553a3acf85e71df1f7b24fa0a0f02d2ae7d164ce10c66f444824c473133f4e0ef09022876bd1c528112c86fe9f271cfec3e344806c7aea5d9d3e9498329a1e9aeaa2838edee5ed368107bc4dfc81a1184ac3fc7eed1a9908d2739ecf374aaaedcdb5f10ff94a2a96fe2a660b46ae5c02628ed4452b6e094e6b94c5ff117241f5767aa9edc457b86344c945e77f5df911572c1805701a8d0301388a0e99a12daa19ef1372c7fcd3a82219729577c85dfe807901baeeae2858378d77d0a0621c67fb7843cbb48d85992f3d030c5ec804f59e1d1ee7b76e9087df142a83a07198bbe655bc3e004ec7b5d132589006bfb4afa9e6611c356565d6cb38afe31584c94b07f6781b92a07ae3d9a93c65e96bf330cd051301198a43058a892a2caf8f5a2c12c70c8669c6270e1a1a030bd9346a4727f07013b9968cbd56ed8d7b073d17eaef6efb01acbf32f1057fe566ea01790d9ac9fdd2ce44cada6f76c24ce1987af169555a9bd95fb0c7f70fe6e5f795907cd896ce7aad3988707ec60633789e6beb0d253c032ff5a91de4bbe7245442b5d9fd74e740dd61e88fe8a102d6bb90a33ae7296a02cf09f701cbaf53d5a287bb7feceea73cd8152ac8fa6b96c50dcc4418e0260e3342e221cdf23be77a70ad39f1e5700f22852db5dd037efd5df193e3b076b670a13269effe0fc6d68dd90e05079ade48c0befa20915363594c5d09511f32bb142168e834474b5f1367766120c3b39ebeb6328f7c3a47660ae9ea6407c8d1c48638b3d82f4733f8d3af2559d72d7c8db86eea71bf7f354989059b5408591ea0b79df14d592f31d620ef4959bd17df03987bcf757f537ef37f9228dacbb8e2851991dea9f607517bfb7e284b55390bc251f4fbe495de922ed0c87c96024b397cef46d3e51c6bfa3f63987f277e07891487791f8bc0018854014a7b5651b76db3fbbfdad5f9ea7458bb7fbbeb508d3aa8d864dfc806bd7f45108b85f459bc3ecba350e0c1b1b0c67c9421ccc9d0038b756199b9c6988a3301d1be65de58e90497cd0a575b2204bb9956f9040216c5e6e1ba837addcb14857e667159533803c1c80259e94932367a34bc76dd5e9644122a61830df8fe36c3139a77be2872d3c399f7011e78c5b3cae95af0c96a7ce414249825c5622d644109c43485dfd563b1aa689be1e5e06938ae05dbb4c0863cbd6b645afab5ca555ba3ffd4cf7878d221eaa040adad215df56ed905363be9015497e84478fee70163d0607f5f9deb00f76eebf96299b39310472585df72ba16143da1cf2e4185b748db49e1db47e801baeee6212359931050941251dcf4629a1483c33e7a433ebe57cba31ecfef2375e85982c0aaf9bfd71d5ecc48fd07f3ab672da0e76278d91bb321877183398ce2af6e0e48d9c6173436121ac438567d0ebedaa9b9de055e6619f6570e64ecb8ab44f72395482a9d33e672600ff33ace5b7089a7cc525c00c65d85772baef1b6edaba4189a36d3f94e0535e556d9d6d77be07d0027924f4a9c2cec9bad6d8cb7edf3d98f487815ec76331458da4dcca470569ae82e8888d4d49a0736c10383e668aaee1994224fa9ac9209fe7ca44b9ea883bbddbd4ab6b2f4211405bc22e21c58c5131116e0229fc6f52b17f7d6bdc06170c37f958bdefff44adcf61af3f79952abf530be7909dc0373889b7d49b0da6916f610864bcfbd0154144bbe342ab59c70040c72b4b99c6a7cdf959d2a202d65e4f683835bb0211df07f6dc1c8ed03a50cf6e8b5a82f5b89c41c467742e41530be0ee5558d3d0894eebfe340cf6b3b6b986cd33737791ffc679c9a67d98e226a62e13e2de08db2b2a83592c98c1e3459092ef4ae9a6099b99a22babc412e541a2d1d7ad64b91f1927875e8f3562af1c1983e9932f4cb71e2a70f314798257156f9fd45ff8dfaa83cb54e5b7e4d7bb077c7f7a4146a76d47251c0f513167990c3d94195fb2d96fad0b636bce183904a5cd9dfd041ede30cb489dc0a51e201303d5a258f67e16c087157c8575f7b7383d0a8201e44263ac6fe096a6c42b1c74a7d4f87b778e0ad5aaec4a240282194620b142d652afdd88f03a96c66d5029d79b39b0525e3db8347822f79d237eb2e7e5d3525630ffd14ff0aeec559b4bdb59f2fec803eb9925ef2a56fc796ac61c7c23166cd5f671653b94df16a5a9a70d8d6f5566599f645bdb5878b557ca356636efc18afdc200933744497bebca95269c049e6b61eb6307815de518f3268c16768be986b5bce2230f18a0d61a5950c42d635a84e8a413fc1072d76fe68758a7f0e0b8191783232ff70cc4b38b59fd501d57540034c7ae053fb4c7d80e16a6c19144f928ffbeed1f9d39df5578c60f616dbcd0309a6ca9b253c090af7aa5cebb2b54fe991444006a470c1e0cd89e137358281b3ce7d5c439829311f0c6d6a3bfb90367a6e0add0c8d8eb432ed86b690d05b368a17d702685b28f01252bbb94506ce3fbe2e1f0f29b77321b6e66693206eb975208d8988544a0295285ef806f35eb8a37ceb023d80f3d40d5df2a190cc697c9ddadadbf57033685e26f1e036f38c4141a073cb64134e6b5d808f24a3724b5d5c2ec0bba7de7a3bf58ab92b41529dde3dbe99085bfb53c03e12279bfe208b918fd68ddf5345bf6b07830d6866262a4c201b436b6805ea5da4ccfc6b1b8d29a93bb87f96551a6701e5f0870774056e7ad036a7073459199b85715562ad59c00cfafb54cb01e6ac054bc184fed5b2897ac55c2c268504b76d618eaf444681585b8512133edfedc7b073654e437f1919cc87ac70217e0269932acd8c3e7967fe86ae2318f40611e80d7ccf9079a4ac8ab6080c67108d13d5cde46718c2d8011bf183eaf5564e20366760c6c4e97bf4f8f1be35f0978d1d15fae11a29a5b454c195ac0d375e882a56d8bddc39480fe8aa92697b980e075aec713f08c3698c2a8461d3ee4fe1c051e5629a57d9a2d52107aada82fe5f317c0d543438811b89c065dc1c55b217d71a40c3731bb7ca6f72aa02f691a3375a4f30ea837b232696a2dcc09d2de64f6f6da3fc6cea2794820c82d920f46d67823d33ec28d71e5bce7ac68f2c8e10d10b42e161ed86fb4d175ebb91d89be25646523347fdf75e34a03649d7fa495c5b3f8dc67133d6f7040ec6918f7cf847bf3ff46d91fa7be2050fd19f4c24c948c942c5cf9e1fc7722f361118b75cb4be62dca6ef5431569ca639396f6d579268fcc5723f31f6bac2e7df760c2f7151bafcb2d8865425b4cd987721077e919c4b1fd7f5f230a22d991f3894d0ba82c7ed56e09eb32ecf781ef083111eb5f7c5da48a715e4b86cb388daa3dd889a552fea4c2529bbe19c74c0df0dd7cd73837acbe8c941f14bdaf8554bee3c03949056b74f5374ae5ae9b6fbd7f3f314888cac11c999d6b9bdf1589b0a62052a579c09ebd28322519f5a75cc88f443de7e431d57826ff64bb7b7762bccd61abbc0e03cc93fe3632905ab0fc88525f2f40aa303f05bf12411d43fae94741cab2829729d7ebcfec37fb6d6eab77fc23fc954e82fb2505a5c4064148d5a2b6d3d4fada29edcea765d358fc42f2f27591d09ef8851bde94a98be758b7802efcc4c166876983b5f4aa012e71f931c5611875b2fcab55b735f4dd53aeac5dd68d4d3e070b8f3c1aadd47a5fa0a89936e76a5728d2adb15d1bc6759079d228704f6182baaace21901510284193e07d63c9570306ed2ee2ec334f9da8b10799479f0e762931953a478822f9ff7e62f51f06243189faaa316dfa1636ea3704bbc2f3e561cce9400466700ab86f9223f650c0d537b82932d45c75d1d0c74ab837090b608e3563f357639d64671f195302f0e8757f4008c623be3671c49a05f9c11c3346f88743493256a62c6049b06c329e2b1c01dca117e9e37e54297c54d7415ddd45f5a5656cb96e0a22e858567cd83cc5ca634e7b82828f43b92d9deff0b23079dc33bacb45fefce2e6263fd55d1ad9d4fdd96e821ff4ee8cb361764847a8c9e8d743d27d4457bcc1223d9f0fc64c6af0f110a9609b73685b6b62a7e7da2d4ecfd77f313d8abfdd3c3706fd776137ebdc808eace129c9014a3322a29e46f44609037aac2362c4faf673993f933523147f51281cb6dd037d8cb14ffe2581cbd903af171e34bf9abba543b34c60d75ac8cb8c04760f315d4473d2651f7d0f049e4066afee777017d5ecd8ef764bf6c4e8532a446d2e897ca043706389a5d20619a864c1df65e421ea8fdfd3787c750fe6a31754a01cf697175877ec496503c3084b7a3dc7e41c760ad18cc11f067379bea01f043193d111e534e799d6417a69b061d732a699035886138ed827a428240c5dded57ea785147b2337bdb5ef3fb432d915dab7b3175301338c61c6d043d961fded8e0915dd2eec87abef9c811b53c4b7d1a658ebb39e37acce78dcfa563c66aa75ff146938eaa45f82d8d917ca20568879bdc42bc97a2cdbd9a885e129797e4fdb2390400d06299c9f147422c5200d97a6b04a58b1531482650d3172d72e03811be0f2c0c7e06dd848882732fe55f6809f70b5b5c5817869405913181965d728f06180d5af683b4a3d2a9202b87b2cbcbde3da15705f7b0bfb62cbcc7d29c51b2443cb4ff067e598b791f36dfe4c69402fb9ebb582044aabca3805a10296ee38c44fe76cad1972e925904410a04a3e796f10284ce0d841557f7271cd122f29c6deef8207ef57ef95df18b2e3f18c7176f33c18bcc6810900b9f613536fcf75342bc806e8489a88a2255e7d4c2ef8ed736ef01bed21e81cf908365735d19c866f716a26b1b76abb0414537f6ee3fe38cb0843ba3b015e41734a8cb92213b14544fec811a8132601461ca8b15f4e8f11ab69dd6eef055fd649d2d98aac3a8f3aa95431226c30158dcfd1511609be32d1ae2a63888c6027fa939563688cd363ac4879f85e15f19b2d959e85ff9cc55d92c7e0a3c1f7bfecbafc476ac99245745bb9ad95878bb49cf1a6830bb3683b6f3f62f317e25805bb875356edde09e756066b9f00f32f21193a7a76a123b565231bbea174f2a20071853ac4362478f3e499761d3cdfdf3e79a5fe56d436663310d8f152fe9a772548e53466366ff7d01ce0eeb5f1abf809c0138e7c9b1c31e1af5761af2e327e1b8b437c9a65a42aff36dea4838656cdab1a4ed2c9571a384967bddfc7f1067e85248834e520e363ed50522cf463bed729ee97a4c98333b0dd9c767ba4cbd4924ff2e622de675aaf216d46ca2760160c0befa9a8b4b0b488494c25a0ce5000453531b69f43aa9cd21a3e1d7eeaa15e1079d0865c4316f16aefca230eed4da15dd35a7c11b1e9fe7d97804d72548789d740a2ead3137b266a7696922640e9b7a205a7af53e196db2b8c149735d810c59418ee2f8a201c4c102561280667060dcaa78233f136465e315f2e1dea492d41287119e159a4b351882fb24c85e5ae65c71d1d7b2d3495bda6ba1fb28b45a03ee0b7ba5b42bfdb0e9b1cf21733b20aee517380a710e454acca0802bc2810ef1e921a365282a151a4132977d6b0485773ae721982fd25753aa6176cc278322249c97e2126d0f0b29d23c5a577eb520251be4051f8d5b49c4740a0b636fa14e0cef672fc74b1288a24bda76e56dddb8f453f91d85d2af954c2748506e98b58489874ac4d85d044dbbf7210806a2c24ccabacb83928775e69633f0cbae73d1e047c45036bfa9a54d1fe2e3f8aa4324062e32934ba0001e7b387912ee68ddcf805572a3a3eea8eee29375462da7ead8eeddcb54abb70b4d7d041b7868875a47f08e7c8f4873dd17fe717b4b5618d4715ca57240545fb178ef3bfa8db7cd7896dc8d7eb3525ca8f5d9ed41e8b99772f479eeb3ca04aa790f68af56b5fd5eea329339d062edeca623bb0a5bcbec81c2260a8ca55bdd35c148b1c3edb4e2415f567a0f37946b92eb5552a73be151f056c19f12472fc29050fed574ebd961ccc03f59ee596f6e6a35750355969a1ff9dbbf751b22dc67207d41084a3349df8c5a08a1d55d53175f41b752da3b6adeba2c2995431bcee09b6b19f7148929207cb6327f4a17f986f0efde31e7d0f328ce99557820eb2e22127c78f8bf439d6f7245c259baaeaa7f61d1d875f793526ed453e07e7a0c9f66bce24bbc7917c9499240090523ab70bf34a1dda159f2196c7822f83f26d357fa1dd36135d8bebc279d98d0119ad3a444f9c8bcc84cea34e9a19b2481b3a035d57b03bf9dfe1887e1d69ad1839d5bf856d939cb27ed0016c02accceaf22d1ea911a75b879d73bf904ea5b70efe6801481c88974cd6ca98bebc5bc691d53d6033d500c036153de5c3ee04f084fb730e4adb76dfa94dcba16930a3e697efa81b9d2df38f9b47c08f1a2662441c650b5b337fa989ce45e2785a6f79cee325372f554028f589d8af69da407a8be78ea1bcd5f8ef05fffb576cec850f168612f9543268684766b7e21d8d9f152f2e8deb964e5e21d382d6a585bcb76fba1b53f3a1330c51b8b7a74e42e29382731728c8b2971d66489ab65ffa44b8367040975861d6e22204b3fa1fc03164b34900540a9f4cc0b8376ab8261e93bc34ae6ebc1cb934fa87c4e44cd251ec0931886f98aa0d393a3ff9e9c92b941fea21064ced6eaecd3ad1bc7fd6a955975fa773c9fe5a4a9e8feca87948531982c604da0887926f0712caf336ccdf217bf15336eb82dd4b29a5074a3c347f9bb21c6fb4e51d0843730ad3707226d5ec418ca03341bc1e1d80bc9e6c2dc6aab1c530da96e0e1af3bb1d1c7b74f8ebe75fa799a6efa59ae77aba865054666d273a45be066944ae9d7dd2dc72f56f459d89f911361066e91b0249269d251b0110d4844c8a9d46c7366103c777b8331f33128dcddb0f0eed76cfacb951d1fe37874ec709c94bf382a89a26cce8d68658c18d36e02858e0f67f6fe5c5449e034c44735a55c6e5e8a983541c9f62edeb0fd453695b679d7d5b8186d58490ee0dd9b4a51695b085d22d1b7a6969652f01f3310967b0d0ccbaceb2332dc857b6ef481d4dce86d50a4b41ee7cea426d29de267ed337b88fe9ca4ec427786c31463d80e10b6db40eac61304021aa09429cf239036344a5f0efed11d3c223c97a781ce7e5eb47f9eb285309b5a8f2fa4f30436b5e55f8f5cc785dd0f8945ce3ee4865709cd6aa8d55ff91d6cfd9fc62053e49d6dd61793e9901a05d43b5e10d1fb56c05b1f55b639b2bc5e58d9453f09b7d63b65185dd37a35e67eebc4aef334a3f2045847a1ec42714edfbcb1b0c0a099110f570d889f9ed0b4cdc972e66fe321bcad858336bc48d89d7d8889b3b70934e569f6d3184f867604930bab6af349a387832673387e2d8d39542f8ecc7605b885969c220df251b394cdf4bba4abd717d0a8d82bdf14d23fcb8d9a0142ca2826944ddcc3053aa36441de599e1f338942b1e89f4ae91d095a4efb7c31392bdad869aa4bc138db0a1f21e590fa138f51777fcd11897faa12766b791ce7a3b85b6c0401cb30edd7ffa7093671f8f840a0dcf7cc68a3818a11cfaab3876e032b05ddc97bc2edb54d10c3a3e56e68cfe7eb39d930e6a348ba3abd86c3cbe79b66f293514b781040938f6562312fdde7e127f93e3cedf442222ce1835cd51c31be5f0a02a212fb88a5b01d85c06b1ae096a8437b6b86902a60faa12acaddc850bce7e7b82b58e3e893e8138ea45a6b22b1765fd25fb6880923a245d5e7035b20e7701871f484b19154fef6c7505a2b6ccea788573e18a779621b3b650eb54e8d77bd5755c3c2bab5e0fb4b47d23138d611dd3766adf0816084bf4dcb52af442470c684967b3b779444751213baefbf6c98c3cd6f05b830caf88a725a3136fa11ae1ed4e8bc596305958f2f680b1827ed39bc76a82dbcbbff7783eb457427b049dd2326d2ba70f16fdc95e41d926a5d2655b90604d3d87afda3349499c6165882f02d7d701da2002bb8633fa1bcea038089c44615e0bcc3878bdee30a354fd82b7d571fba5d052b3e611f18aa436805ca3c0967b057d7e9eb9038ea3f64f93daf63d90eb9d6c120204b5c9615ca6d76565552c8f86038984ed1a7cee768ee2508250a790f07635bbf2cd6c824058c8a54ed266f305faa10d36b6cfd8561ff56f18cb3f5a492dc34885df90977d1b1efcb84c0d7b5a055cd5346059d1458231514d2633351fcbbff3b61ef75001873a785ca75d9b64784e7a706b41801f526b4a1df6424c3b7f2d3d91c4e57652f23a90ceafee67810d1f2d947b36992872269c5c6a25def635e498020d0eab6684c526ef39b7a0ebcc9c84662bd4e4ce1e4ce3d9f47affb123e092da5f37a982e1003d0b7fc62c0ebf67204c3431f833b96f2575393383afd341f8773f37236ca557fb323b7ee8126647347c6f106abe32e572bb77d0ab7bf203325a764d8f9facf642f285eff64b92456b356fcecca46b4cca4711dc4e6e3ece52888613060dfb4406befc3f1218589f2508472b669537125e958aff78c015f39fe6d943da46af867b3975efac6ddd50bb2391a970ba15ab9b98cebc3e38b2d6caac9707b8d074eb6c65379253a100d978bea4ac612607387f916f6cfced3b6bc12ec287c62a603910516452a5eef5e9235360033cb25df6a286bfd247e676c6d186c82f250ecbb9dbc59c63dd10b79dbd6d1129e14c8643b0914738daeea96ffa64af95732088a53c1cfbe6cd728c17469ead169eeba36f385b23858531330290be18d0864cf10149f1312dac96818a8cf1f42dce3ff1b31fdbd299bf75115d3a8f58050dfa2df8a7a4f77df0d5f6d26b70df45a6a2a7140306135f2a9e5d89e21ffc4c04abfa5e035a8261e7b1cf7fb8d63ef465a091deab8a1e50bdec8950e3e321b6cd08263631f051d5d17f1291dbeab80b72a7b37eb8e3bf2406f4371d13ece081b58b6c9a44868de9a5ec37e66aab879043a6a1395a5fde8fec98a5070360ba964af6499d5357735ab3fcdb253eae3cec0850053aec9bfec6938a90473f786f3a08d35b8063bc7724297d4327d7ae1236a1e8734377192d056311febf6c358ae09bf328f9845ba589c4499c0bb560b53ee60ad3de7feb91bbf9697554c7f8a04b46fbd8152d400da2e4430478d8b36af6c65cfa606a2300643dfe21cabc24fbef6a26f15365f8bd9cc85307cfc8e75e311e84f0b3b10c2278e22bb9db15e561255fb9a4d6bdaa4a6077101528a51d6c14a18ae6aad3d64ab66d33e7e3b29fb679422cf23b7246a7dc4f7342bb0d48ab081ffc81adfb2f7dfdc884af3d27af513d9357171d15e7449a4fbad6de053a4dd021bf3763995bebc062a897b6dafa45829924f7dafb992f7ae5a76cf246bb9efb24447f14191f32d24599f0d6eb77f0393e8401e745e4e071a6e9e909ac5b640f3de5149d4a4f8a57f3542756e59ce8b596bf08bbc9a98b33281c137ffe54016376a57a35f71483e5e1c2273a9a636588adf86a2c052bed6d99a3212062f6c2e5b9463f3f97de92821595f540ffccbb64179122d4825728b3e4331eb558000fb7318040b8f08e1f6955c53c0aa54318a96595d5b9c9df591e9909744fd9e09bc731186ff1aa88c19eb696b593decd52095ce38c9fdaf54bfce3f2eaac5c2d3aa21e23c0dad47d496aff8c03b82e9f7896f5</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>æŠ€æœ¯/åšå®¢</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>writing skills</tag>
      </tags>
  </entry>
  <entry>
    <title>HexoåŸºç¡€å»ºç«™</title>
    <url>/2018/02/09/hexo-get-start/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">è¯·è¾“å…¥å¯†ç ä»¥é˜…è¯»è¿™ç¯‡ç§å¯†æ–‡ç« ã€‚</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="877864de143ccaa4077ee2075f360eae4c446c9c5909d9d22e8bd748fb204b4c">04b96cf03f1b5d00286d72390b6bf2e0817acbfddb7147d2fcc01912c7f5c0f9713c9c317ba53b9347fde83c930f8c77af411014f8ec84eef7465f6027f6e563b20763efbf9fac1db105face649d36b82b8e5a28894e0322accb07eba0f38491487fddc38b18732e21e4d5a09a208486db90f1b471e152ae582639c98996b3d9545b516ad74403d379a378e897878b9754f5f3c9a9c1cbf034ea3b155b6217c7c2a8ce65fc5458e94d70325ea68e520fea1f3d22f56b6349aee20af7ed199e2c05d5058ef826f483bf40a5fd1d5f8069bf4ba16532f28cfd952ce82641688eb2454a48968a19553e4d540a08770cd7275d70f6da201c8ff25a2d2c4f75e3e011f0a320241da7602220fba21756d81e6b573983db5148b6496f0fabe1c76e252587586a5761fc556b66262570cf7984483cebae9e2a6034d958c028d056c6140c9ad006ad52fe13044393d3a4db740fe9e5664b921ef2e056dd5a96741ceb1ab88c39ad5c1e9d0c7e3d972d9e879309aa9868a49bea583040e8e0e581005b0481cd06ff7dbbfdb1e75f157768759c318f96434061db48975c5d2e074d0cb21bbaab80b1987d226602ffc695f08f5cdb86c57a21e6e03eb5e1e567067f9d5f43ef226afcc9de3bab01844360e33f4d0276f2fc8ca69eea86139350d4a261ad89a483d2d10305f1867be3595f53486fb3204de59558f6d9027a3ef6e59e2930d9e8e2fa87a9385f05f48f99afb2205266d1f016b93f7a8cce08ae652767600314d8ea151364272fd8daab3fff78541fe3998a76cc30105c6294d505c34547e9e835e878f116e1aef4ca207cc804274ca52b407d6b89daa74c9da09b23031a4b4b0752eb43ba922d72df5a293ef8f89e2f5d1dcb4c8b8599c045207a67614682e7a027492c5b089fbc769e4c8d69f7c91d3ce7a24c3103db00e46a1e996dde2edc346de517ee7effef788b7afd308dfc1602f56136fd20a4b1ab4a61dc2a4c96bdc95f87d5a2bfa0df27931cc22959c61e1facd7f3e2718a93a8a70159a97057f1e9b3d791d3b76772d39cc72e5a9b54f1ae1b68c1e993b314434146d28d3ee05afbdeb8d492abecb37c67932141f8a6963cfc58c63e33fab4477240eecaf27d56669aafe1ec5af81417517f78227195e2aa5d6b8e01585d54fdd317559a955477a272721acf09cfbac7510c598e1f7128e6217714ba326edef11af672b59f6588ab91159db638a1dbb0884ce8f40535fe5fa2b3551a66508c281d54152acd3a1f54248ce24e4b4fadcfab371893a392b4e158b07c618f4eefa8c50e5c497e081845591932b0a4c2aafbba24a79731e894761a45eebffaa9346347f0a5ca579b5f34fe6369d7cb9c0da87c44ee4440507fac40585750d0157c3d64d3eae41ba4cad29daba360f7ac329f475f9f8e272f7591d95f9763dc4701632d54beabb59ab874080baf861dfd627776c78fb7499e107f2f245e6c30f1fd5c596652e6108241646a9318445f468943b82a51daa6167672b746a4b3307ce94ed6d8b5c8f7c1b2eb43aeaa0078d8283832055ad755d8aa1a602c007e0337504c60a6bc514a07972005b43e78f14ed000523adc6c3e636758b6169547d5c4eabecc66bc2ece5f6c54e33d49f822d1d1a6f161602a2babe300875fb51db8220946e06f81942a66b3f9e793e0f7849cd4a9c0453c2d9bf62a1f1a6232ef39331a6bb856b94824335c7bb165ed9b1ced3c0e7231ab2a73d57a94e6545a8d206d943661cbd2c035a83403f433639059c7c2e6093d824c9ab4344d29df81712ee70c8ecf26b09f76f59a2b940da1942245970b194801a4a6cd8ae1980d43d2e82d69319bb18f24f0cc4fa3e72a417f0b3932298aa2f95b7efc4b639b69758f8d0621d8dc2ca4e6408f8d8a28584ccf2547b25d41da4bf1d8ee821ac221cf5057046cd68198aee444788f4584384a7339a9b0442694318d7e344871e36b12a53d03e040b32cc5bf027cd13ecf0181ea49d078edc9e7876c7ff682b0ea5e9ec2695b9f231f4ffd5ab36d3b59acafc4cd3cf962b480923e3fe22968c7aa2bc8894d3997aa6f42feb01ffcd3087df8a29d3f7f8cfb314cd98f43684a64a634c6e5410d6e3392f7523dc02ae0b547bd4a97822a07c8cd594e584106f0a5980c79fda720298937dae9c2ab3eac3b34a2c3127484920105ea7e5a4058d177285079ebb4c7c2bd17d001e964cfa35d0a08b9814d78475bc11f295a263548aeed634c0fff7bbb8106cd21157f70793edf4d6ccc7c2f74c1f9607e4d762885e4c416f6c4dce6436a6eefdfad2119e490c416ae864f2e5fd98daaf9c906728ffe16a9096ac2397f26f1a8d0b65761df9f24be2b8faaa0d6fb3782e11dba5d423c022dbc43cba85fef75b17752ab94ef7232667002087b947970f5475ccd9083335be21bd9e23100c4c37f6ded68bee348368abb7ba1bc7493d875dfb12128d45e4433483c15a3f01f3abbeb9054008023ad220fb92fd9a9a470cf4d035b621f3f80eca160b0b2c0a78eccf6b0cb63c93ea5c97f8aa5f4b25a0ee2a9584e759973e5ed3417ef9889017a9088cb99e678062ae28f17febac3bbabc5007af03ca9993036c6d15eb52948ae23193ea3ef9ba38b408204750b67254cd7414ae306108ecaa5ec89118c637388b07952d31236796f24d24c14f87602602a4c1e290758bc6c40ad0fa429018fd45f9c6a1bbd252bc508543efe49884566b4985e0a12bec22d2082609703e8a7e5d7835381a425a701684a16bdeea7d2590f4dc10717ad83bbc69ed51bf00b4116c2c95062eabbe84ecede75e49fabd9dfbd5ba235b8624b93312e2f7737e9fb4733e5b61c61905151e5750dec7c490c34d1dea8e0cc38fd2aa55a11e40c91b628dbf59c79f26ef0f0dcaa5fff218d0b327b763aad4cd68390ea4fa75cc25478b67b421922dc7120342757171dfc2edbf5354c369e32902a02c6b78f6a07e7af2140a1e182684e75ffbde2e55d7e0e9842409c4c5dc6542363e7de2e8983cb27e09760eda4f2db7243c058e4236385940174e00fddadc5a7220594e8fdf1f81e6724e8ce18d1e38a13d17bb10a16104bb33daf8765fb4775c725f799b6e487921736350260c7d3ce6d1451103c9cf73c9d58e0956b716b841362720af377904d413f6c88a4b0c039b5239c7529c9efc458a26f691eddf4eaf42d5bad14d466fb5a53d51f7df00e03b97148cbe33312c78f3dc5cc326f513ca99d3d7f4957306e00b7b68b731a18382232f9b99acdd57ed1e8d4eeab61a59927e09336ca4142a6e497f93b5018e001da0bee8c658aaf0b45a94e45fbcef8b58ee090262c224401683fd0c2ad39fd5456e0c90f2dfbad949d400a9b7ea8b178a05a7d69034de2fcec4d40aeb878bbccb381b3b935d200c0dbea67a388cf433769b38da53c91b5c296e0b92822dc8cbe7fd1972853c1efe4613e7936a381c04e837fcdf06b8e1b693178393f8d57413541b77452de649ad2c5eefc9c36ba09eb48093874f9350a2de79c05e8300ed445199459f362161d487158e5213437ecb6ea1d694c3f3daf89152891150ffa6913f9e95ff191a057240e22aac2770fdf49f65d8f7bf7f731cc7c23ea33877225efb759ad61b4ccde7834f0f2f392f0a28b88aefcc54c31d1b6073c510a0ada532753dac5a218917bc9a5a447a35c2234bfe1f8695c3a531022e316dc3e1eb5235864e149d0c80f12dc09a49225ffd7d75345bd4b8d56a849fcdea10563ff03ce514dc4ad79036bcb5b1a28e18af19589d5dc59fa3681e96371f6cf2dbcb7fb6a249d1e1439e9acadda99f0b356e62b331c4b8fedd9913d7e1153d225770e65f87ee2f5e90c8d94ef967ecc98c893682baa280789ce766742e505d664738d58da36c9d39cd82a7b3f2a5a706fda297033bedc707bc28ac305bff66ae5baaabef47d12afb6fc5ed79e67c13b21b607731a85250b861a4c23958ffa6aa93d21c1303ff4f6328a4eb1b24391b64095944751b8fdb85a0817c1e89c8a1ea1f972661a46898a7dd7abaabfecc2be73f4c9796a575dd4649b12864e7a4277f44603fbf273092574e1676ab072ceaca49a38922f43dec374c7dd03fd5e7902de897f25e63e8b06b936fdf08d797f55c3ef057e03e111d0dbd1e44094576510ef7fb7451da4d84ef03cb41a1edcfcd104b70cb56a7b76da5342b5bde74fdc101a7790b80d86866bc555cec6d698865ce42c98ebf2414228a56f623f26dc09ced8fa4dcc0a78de44ddab466428fb743fcc1bd37534b3a256fea0bd86b641c6749f06d26a21235b184e76d34f3698aefbba6a5ecebbc579a25e86bb277863641f2d586293cc6a38f1a23c6118a2539982cc447a165ea862d87c03f8ddedfd3306e210d21361c1ec238b22af2c7217ccc3cbabf963d026d3a6cab9177778f05e4e46035c3da2f95485c996552366288d726d7f90697f692ec1cb9e4dd7ced74434fdd8edd4e3fe9fb1ae24013c2d498865a9869df6dd8362dd3ffd834361dac3b5899480181f1f95bd2a2a10b09502ca17173528d0a3f3cd4563fe802ead366ab9007a8540d6fd959daffde9003823e80ea1fb38010cb5bb4b8a2574be191e9db78b020dd9668b57b14a5de6ea4f5214665ff0f4c2dc3aaa97a80db5b80fc74f2a7734c4149392d157e3efb109258ecdfca433d86648cbd0faaabba6b104a23a31b935269d6214a10ad42b721e54743557e7d51e360f816f1d523db30e48be3d6cd1eb9fdde1dc4c4a2274519e23d5794f08d2433aca127bf406e7664b91dfb6c00a01433f63075cc395631303a95b2002a506b144e67ad6c22cd37439a3730da7822b61e70fc9ceeceed23de497d7074b72bb16340fb60871d592351e1ca415b46d4fe82551e04ec36c7afba760e51276836b70a7a27852117fe1f21df979bfbd39d0305991899b48fed4230ec750410dc5bdfaa6c43d590ea7e00d85d99285285db82fe2b645d146c43f2c3a843117d37af619c97bd7e44bf96b2d4f7e10ce50dcf496bb42467728014e42ebad6b93aabe846f5024c81555174e8da573e1530a63044194c277f2829f2615fb09684b098fef3f4130c5408fe913271be47fdca049ca523167289e974c6403046951c22adc748cdf5ce2cf558357e6d50075054565387d40ec557ee665dff8735a1016b9a44d084559b5bdf28802602f1735a849f89f9bd88451c57921df7fc828f4cc58f632cc4e6a6ba168fdac8e738c4b6fa9afef130110ddfab7761f9bcb2ae899f434ada17d8d59a3f6bed27a94eeabfe42eeb48057d2b5103de13a440a47512d26df367c5a13c42fcf9aaf7695e731852ee379eddca8b0548093573a94ef0565ad66c66852205828a552368c1db9c7d2a039702b1af56d57009d3e5a48722a176c80baad07be3f7bc5e5b431e448c21b2b497cedff041cb52ec6796eb263293dc2d5c5cb5d28aba45fdc50c7c6cf9c34987bd428ae5783abeb54a0351a1cce812b7f155688615b5da83bb476ccd4c76abb2ece7bc52167e8c98121ba0cfdbad2ff4ad093315e64b4fa26b371b7fc01ddb2fe6346703874b17f33bb3ac9a917a691248b63c81480063e95552668d09cfde57972cc575f6ff8aeb6ce376e33961fb9cefc5de545cfb1f80f7646740541258c906ae22ed9a073165d2ccaa747fb76f39541dd792f63af69e3ccd7a4e17cf36c0a052fab8bf3f0225764e881b48b75fcfb04a8e5edba83d123820c4c8df08996ff3d189a04550486f621eaf8190765f07441f42d4c2ed78defe2d1832ff3dfa4be46ed05bb2eaf967b1535b0699f5da5f1d8cc1e1c354e9ea257bb830480d04ed681ac1aecbc4634102750f635da5d817ae208969276fb49a42c0630027e9f46fff812166a1fd12d3537de2ee6de327bdf0bb0323d830d885606f15e73b12d5ad663df20be13f50c7d58f8f32d2895d071ff1003354602ced38b03dead9750ebdfa11a58cf1112f03985cedef4b1cfcefd4573907c1ecdc634b221b44dfd475970efe0bb63a2c7993f5acbc2faa7642e69c9e43741ea60c24de9cc018738bd81373742ed8a1951a6f3379c91b0f4f809fd01a231f4378f3dc64aa3ddc33b40cad7277208f11f0a4cce30c08b79ec2617d35816662f319b3da4107d810a41a32820af31eb70a47cabc79cb343239b37e8140281b6e704a2d7fef95f8aa0a95287b5c33db2cdec9fb6f37b3456eac5c252cdfeef7401ba19c40e59e8731043447b55908c096f952d135ba2ecd35a0355597ef74973510070e671185d191003e9e0e88cfd8ef2192f6b986a70c8035caf933be61b8cdd31f85b873af06edacc1a0cdab9489a3220f27aca0d9a3894503753ac9a0ec1f48c7607a4fb965f15bf0b7ed33bef9cdf37be925faa924ba4706d49bff38abc6187ab47195b34e1d259cbb83f172e9e4aeedde80c830d61e9c6dd278f43cbcab88b4733f279fb59eb8110006579487854c49bceb307417d2d5f7b787e094bdcc42716a4edf234e208c5f4bd4179b2b168a6a46ba262eb04fe424a460244e6c282fbb277b11ace1f9105cfa0711dfd0499cf676215b6a0c3b7e4e77510ecf301a161e125fe420a615414543c997723e6074f0049aafb9a8fea2f5a49aef40ff5ffb3c9ffb29d4fafa4d4928e76b3eaf8ce91ff29f59d2d607ce28850074a3917bd1dcacd644f6b8b32b3ffc4a9ef9c9cc280920b553537f48c6df81286d9d378df296d9b4d5de22baea9b4e887895a82e04b6fd0942df439cb44237fb9e40b4876886baa2937db28c4353b952f01805b94aa6dd3d448ccb895dcf0b344ed7bbdaaa982c361c71d928b629478a73504833332ded54d9291a872b87a389761a684d45ad563c9cec3203d586a7b4380b1802ab60f60533702c373e39a793b301905adb1f44d0210f8099fea627112a0701c8db33b7d9eeca2a49070d175ae8c1047d90a2a5996855a8f007eeab1e2bdf4b00ea0280f587804163307b7b6c8bea087755fb2914d7bc1b46f2560e89ab302f1e8218a831f288cf069eda22a8c2d2667ff5ba7fe0814bf012e0a52cac9ee7055503e3714cf71b7766517aefa5a2f3dc42b19a2a4ea012f5aac9d385a4e53770fa6ecf3ff415c104c8620cb634f9d9e36878c6d3fa3d221e7dca3a557aef19688eb92be73885f12cb1f8a8425ecbca87d0ab4aa6eb0f1d132f1dbd2426009f5a730cb841cacfca7afaeab6213eb2be0d17c2a8c18df9dbe67d1e626785654f28c2d79655aac9d4b371f23ad6cf8d0d5cfe5c90fb6af7824ac75c4eb4c07af06d72d044ba2fa96a864dd81d5d6a93ac3b3740dfaf586a0d0ba924379833182e285c474e4584f20616a0a742e4207b1f5b1815084573477b8a46c0725d2e00b3634c84b49025ab406014cdba2ab7cfcde8a6544ae7972e2991c785c3b661a401bd3dd301176e6962c11cd3ab714f54d26f9478b2e3369df900b8a9bc43eb00dd1f64a2609d2f79c883c3d6e4bc4f101ae13c8239e73c435fe9a47e068f239fa66330bc0c3f812698a9bbeec0ff359463e133dfe34fdabeb0206b299b6f007855d7901552ce985c959be6f60d6bb10bf526b5b7303d96e375579243ae4f2e4ad2549301c9fc56947bce1f119ed9bc760a3c0aad565d706169a86b80ca3581dcfbe94a00d6b6e6f72e681c84e3474d3362b799fa507d23bf1df41d74eaf09ec1b9956e56cf510c50b7b2cce01495de8da8eb040f814be9cc4b7b314fcdee515fb59f20366f3fe5d8bdfc4b74d06a548d83be474951e5d02e46f44f96e6282b7c75fcde3733309dc48ca043d1fe88c817bfdb03628f0a8807a60ea4701f714bff768e8aebe69be60f15f0fcd88b2d88d4134de181f83aa12a65df66a3c4a1498b047733470234fec385af9d30ab00c6e8cf831c3036a006966502876d08e4b417ed94012dfc51b593bf23604463805870970c75815c41f7d4cd20c4205fe38082a21e07542f4f3c37dae3d5e45b3ff90c77ef96b1cda8ba0e55f15bf6572857ee26144c681e12b6a5b30eb8644ee3805bf2c0200798b55849476d6c6aec5b0157c7954b150d0cf6f8aa3217ecf778904e1b969be20a06a20b0b5f23a5c65e626a61bc2ac83769adf4f48b9ef7984c4cf7f138a841fbcd911d058a132f7d069bd51c6c9613b5256355de19535b76e972b9a80c5e55690eb6bad83a0c5d75c89669974cc030e671045fdd0376c75a5e9c32a975414539e2afb3b9337e5ac226a0bb5d02b30020aab47d085159ccbd6247e2bdc0397fc2ddaa634ea3be474c598ea2229e0da1db39cfa2c4a0b94bde246f3df9bb1c5d360fc00ff1e2a631dd9044d569bbd5e18f345d7d564c866bf17072a9bf39464282e77bc0cc5dc90da9f74789fb7388d073e58c4516feeedf4b637199ca437f2b16bacef5b321d0fa821e29dcdf9982dc78c31de2f7bd336ff6782295c5a164fb1dce7117d1cb2f288320030ba36495c236f9996335567990a67ba7095cf8c09924285c2a0aa007de602be8e176c2f1b3e41462b56934fece6822556c12666e7fa299d4d558b602fb975e4120939c884f381e1fd1130ef98545d2b1134e5d0aeb069799016abd73fc5c076fd0768658a9cfe1042fe6bf1713afb571a81d0fc85ed8746b8b5bdf292ca453c674f605a684c2e194eda07a69a2ce5e3542c8db2414636a9ecadeb20dbc63d004f9627e00e157c3ec82ee03fc33d9a98e341fc1a4ce0d1a2953cf4f8f688b0d124ea127c4fc99c66c63b402db860cc5d5537c1cd3ab09d2ebe276af185abfdcc45d0f345934426456f8d0a27333c29aaf17e85b44d4906a55dced2e1bc90e6b33b2a0cd578b6008028e96840a1270062887417db31691c5d44393fee74e6f620dbe920eea8062b9c22c26b74dbccf82d139db402b0b0b7708bc3b5879ad6c7a778ffc9a994dcb8f2654e296e5dc2dceb7707dcbbcb34c66d249de9f64715a499c9d8aff07d7b2642e96f5c18691f39fdaa481d5d22a7370972b55b5481e68ce3be2bade036082667689419d692e1d970d4c122b6ec13e831b23975890ed5b8ce7738bc3bc4416dd2468c6f4709c704889ee465a0e347c5bca59b9d2a37945bb1ab2785744f1230af0d880844ca0a35af2116b281dcb31f5504ba000d5a81ffbcb4b022e44c5a98281793e6dd3ee99b9c81b7171c344d8f08ccd8f1108b34af287dd35b203b1a9074ecb7e462a5cdb739f8af43e3f69a6a97c37c29dbb7eaa54147cc188f757d33f51b624881b2a81ad0c582158ec2d2bd7857e903e0ab75fd84f6a2c67813594b9dfa0a2746587ed2200a8a2f6428da95e2ecb8a7c6dd67e53e03547c2e0e0e20f2ac5fa5a9715c85987f231ae1ca2e34650ce3d3cd8bd1744363654a98c28d55f8ec5883518d2284b31d5a5519f4c6ca54669a2a6268d17fcf6e2f66b94ea3fb162df235af3926a11f5f2a1b4dcd38a4d1e8f6ee35c7715a0d62479ba47a00f20a8fd9a1bc960807d8957f7cd133bf11724809b0d45d979c7dd7d363f8ef271039ee6a30bd30c4200d8546921f577df298a9bfd0b3e0f7937609e9f549174edc4482186d1bf15314ad5627cd86c34e0ed61c56afc3c0a6f60067bc1dc4ceb51719dff7d3fa6978ea83585468a8ac866953204d09563c26a7e5b62903e00b0d6c856d1c9d32412da5e30a749da3329ab904743f8dbc0d8a40579b97248ee4d6da3128bca49f7ef5bbad68cea98a4ee01ba0da6f28f3ac241ec8c6b202f16b2154b9714d196ac83690cad92f9e25053d4bc5caff5545d56f7de324a80e391f4fcfb07e0f6dbfd25625f66db70b25c2752d18f80a04d8f13c5428d83a5826fec55436b6db98bbbeb0789f51a7e3fee5ab337d7170aa07607b16115167e90a72f91903a0615c5771d551a9d974bb1b58164e4c31215689068d6b7f479da094b741a821eb1fb2834d08708a035d59bb267238aa14b25d8581133522040ee0948181e23c2f9506d97a26810ed72fcf9ebceb7cf9db6bc3ca97da97eceb042581e8f0f82bac1ca97e000fdd9764d528ab4f6c515549c6f938df8ecb6eedc8f0e5eda68848e76a4d1f884133f9bb127dcddbdb35d94efc868e3026b4c13900635ef506c8c571f8e86a1e8f9ea09e072e56c48193d7d3e4d7f929f8e1803ae3588ca4c41fef935d2f6c3c2dce33062c78b850099e4529cfbfc2cf579b0d19adac2465aaf41a2edf0dc9874d3a13e7e870aa67327a3544521782522acc1e046bf8ae97c6934ffa18995764c05d265a78f95cb8456384306003dd5238e84ef47bcc18a2383d2ce4fe1e16480fc3d9617013fd2f6b630a00979eed4b84bf85481fb2aba3c719519c361d2153bab50c72023e9e4da38252ba6e99b098d15ff2bd104af01634629c39429c930f5f490057c6721a0b118201db136b617a8946997611f5e9d2fde32f592a5ee6b912b5d07ed7dad763c71ab1dbbf9fa53f4073bd726d94a67c5eddb9d705fc89259638cfe312347a3a57aca77755c070b85b280e07453fbb2814c38f200d97b6753d3f835a5ae91c9874cd39785e07ed48861f4812d43e45ed78da4e2e956b764e8984ed68d974a102bb5548416a19d26fdd0a40bc79eb85a17f5eb8132e813fd833bdf736d6c174ec6273f65546e9320cc5d3824a5f3e3e1409f78b6ce40c84cfdb7a087f850df84bb8122b66d4e98ba1ed9c4b380769fdd38c2c3ea3c7adfaa73779ed9526b7504c8299840b5884658caa08f3d86acce72ca74fdd0ac6aaf59c11d1816e760234b11504a70e34a8e76721c4847f2882d9bb99a59dc4db14db82b4630d02bccdb0d13b257801239ee9c29fe68055f341e621077ceab492b18870f6a92c1b5b01dfc493f56e240ad4da2a934755c8d97afe17eb6abfdfea782e490d6723308927666f253645690b5ef758655c6d35ca8ed43a3ccbb51b6847fe71c4bface3608de046ccf30e894ad979ed977859defa24352ab0eb97feaa6fc6d771db3c6153ee23d8fc8c57091f94672512693c4b47ee7b71337cc071d9de79fefd55e70ef097a5495e0526dc88dec9a3a49767cfd793c1296c9656800a0936aa41a6987277384668e74fa203d56c002311f90ba9f3371dd43b5b1377db0b04a4003a66395f4b3ebed72de261846f586e8b8472f7f6b5670107189849ebd1602d7bf8dd1b0fd72d51f9184fdd78fdb41a2208648f556a4b158d7fe4f4d7fa910b9cd47681bfd3fbabf8f2ef5ff7fa249bc9c2e8d0ea9c92bb89735c83d0f3776bf255149b455d06f7e66c881911c7fe0703c25aba7899f57d23eea6ae14f1c96bb68cdebf752d7ac8629957fc74ac59cb0af7e87e17bc9457ccb14b40cadc4e32298ad246ea547fc502199f4509a81d60d9a8c31cafe19180644b678a8335e3f42b9717019ca2a1e8f6bc9eb8563e3666bd4bbcc3b9b965b0798bdd89daa7984b00de78405ec171392044be570c4c4d7f30b83cd4c306134fc471a5b47a63d15b93dde603b0acd168aa1d53ce0cb008381bdc8bf4a8073478895e79962e551a24c3c21f0f1bbdadae7900a02ff7c9ec8a4da84a3917934c180af38f7d25f6133c0be4d935d7e251a0286285bb26aea0da8e9ee68d9a3f33b0d870e1d15a38a7d363c723c8180d5125f4a08d89aef673dcf0adbe8bb5a59500aacc087d1d3a68f5d44ba9803e9fdefb257514844cb8645c1fd026077a30a6f480fb35e5cece3a472dd2673728f2edab9eac9ea20bf59d9a19248cb78af35044c0f4064ce13f8f40d7569a861e7d2e21bdedc012fa9c6fd28c17fba2e209a20e197cbf4c53eeb36cfbdf2dc2290d17efbd0a42ea6770311b8d35e778af8ffd1ac30c8b20acd531721fb65fb8f2ce00307eb4ca9a5f97615a44fa0eca7a089cea65298d1d431765d5b66026ca74c213e26032ffcafa54186cce83b038d517e1c1ac72d95d2c2610c5e2c0564eec191767f49853c4e236b1797fefbef4ff5b0f42fc63f16c7f5a916f1610e9148df5facbf8abed39fcdf29fbac55c06040882015e298be5948cf6d560ff72f2ac01ea2ce19f29f16c323a286b5491e21b762dc36cb1aa02d0bb32a2a1781f1504bef941f0db6baecdeae9f63bb2da425d059444212efb78075004958e43cc71dce7aa102a8b57300b4f7bb4dc7072b0be8a4c12cf6f589a4a4506f00b1454d2ac4f4614a1a5444be12b0a53af1a82984410988547c5554babf6b134a2e30651f2425433a99760e36005d66a931161d0c2140fd4e2b0d596bf24dadd2b5a6a7e386225777557c52959651e217b8f99041d8480fbf22ed8d9514c38a2dff59dcb2cd183a2393c666a051c8e3bf3b86b25a6e2ec7f991a17a091d65a343ce999d087580a7ed981eda3c2cca5e85a72865be56ffda7790c0189fd9dc48061d1c4a6970e5ae1c342c6837da1921eaaed26fae8478aee882e3c8209d39ea0ed5d293b48598625ead98f05f823a54a0a9f96726646378b35506941a9943a45b298bcd8bdc4d1a6a544f4b3f458f484afb7c8ab7d8a456ebd3a315af7a6851aa47fec80395b5b44296ec81a649a5004ae03bf3910e04bf16452cde01a39e49fc796fbc9a46b22be73a74e83d5bdc257057fa05def3ed00569d7f1bc1aa940fe54f64dcb24c27644f3c53f5f1a459e41b235d1989b00fcdf537bc76292280f5779453938efa5ca96bbb7dd630e46c0a9b079862326c3ea15fb943c3b4d28b7033aa9624533263280b29e7b35f3e7c7348715d3cdfaabd0b7b5af4e8cde1be05c5f3acdf4afac4d6db4c18fbdb0cc9cb1f270c5c58b9289ed992e726232c331f0b91c54b5ddbc9ef7fb8470a3992efb29239a5663b6ae110fcfec42078ba307cefae438aeea983b898b32c26a03c2a1b3c7dab175fa218aa14eb151766947de8ac91be73f2df25d59654cbe8ba0132e7a3b7e8766754c7c35b20385321d3687299d042c5fc0b2c5763b04838be4475e45bb7ca76f20c28b118b79555f364673907253ed87653603893c604892e162d494748aeee06f1131ccc82b655a8f1a947dd3f47b3bf2460c5d600f732b026939071af85d5fb3637d17607c9e54b84fe531e50934a3e28de3770502259c6c52a0046f2d4062b7b513a7c685e5d2a598d00b00ba2304aaecef6e29b930d7b009152aa0cb902566d1a9fcb58a250624216a6546fb3e1ff92ad00b9d18edc6d0b8af01e610e09872a3a4882d922ab94ac6f6bc5cb27c9f354f7dceaac3e2b2a0576e96e427d441445abdea2dbcba04ae8f1bdd8a84bdc3f0e7de3e27520f6e4d31be00586279740bbbc6a17a8794d2e5e7148935c0e974b89e8db6783b369630a05f5a7f753c0ea8f97d7155eb42d4a5c2be6fe23509509816f6ff4ed55751aa6930d27428c7bd83a64ae270c0231effb06e06acbb582bec8c7386296a610b13b0f517f72e1ee856d84d43838aa9cfb37d63b84ab5349ccb3ef73b590cf5d97367f8a238b911d24d2b7a588dee7bc8fc9657883909f682d942e02a5629dc960286be89f220e6fdebc6c5225b4451a0ac55aa9c1a0e01f523a64a8c6c8ec6b08a3d60bc84906b1705c542b2660faab51c23546118574f8bd88f24ffe92611a936700465f753731915653c481ad8d130eae17bd76e485fb300f7c454b5191cea48f7228df385f2bbfe058a8f9f421bb61907575e7c2f9f40ed7e631dc00a012705fcf61d1347c3a8cc1e7be01591af0a21f55f0f6d21db312e2dc860b64633bd2e363bbee929f4ffff8d8a0afcaa26feb3880a9d44a9dcb06bf08015beed75c0ce92f624297b4b655a334e6557247a3660e001fe03295de77262cc7a8e8e214171281577cd8c3e35775657ef2054fd9bf8305a7119ebe66b70f1a15c7f30cc92d4595fb7c4973adbb64b054ee99ed1f85102925b252677b75617e169fc235180dd0afa019ba8cbd0c1f4a6ac2c7dedce4570e8851441df68689e6296551cbc4b8460ea61069777f428be6dc8f06d4cdd0cdbe04d6180625b387098088065d0ca6e163b449899aac4fecdfa38b0cdf1cf0f76ed048589044e4d91760b509b70b45100abd3cde298439b95f9b9d0d93d91b3b1ecb632078f86901006efb66f19a138beaa6cdb2f79d2a37e6f03d75b74f42c1645257f5d6bcf9694d1e0154e25bcf7d6c4886c38a2c4831dc6409b8f3bb09b9c6abeaee0f87add1ed9a82661018d1d8c4aea8fdfcfb06a32fc922f1c3906b87b63e255990af2cb42bfc8a9be56ce77f9762e79f3bec002cc8c5d00fe13253c8aceb67c7a9b8bc97ecc89f8ab9939a55107bb62c1e252331bf1de645cd80760f3f70553be3c419ed6e0bf22afec6bdfdc13e582e863b3053ac806d5ec9357d35922a6842eeb615bd38d7200acacc71f1d99f7eca3a3393ee73a7bb45bbdc0896bf13830f2aa8719b09d228a8751ad38173ceaf5c3595805a7b4fa35a5f6b04ee3b2e965aa8bbf00a92bbf715965110b93ff9e7f34ee9f4cdd00f7089d75159da19ec6f4012597311d42e495d7253446d3ee57153e15fbfbcaec9499d89fdb578c42a0eb226f7bf06988e3fe1e7a868852aa5b1bceffcb8dc0849afe17d2c9372abe29881fe4d32cebd2c91d37f5987c28a5e9a4e37992a576d6c8598625477bb929ffd046382b38eabde87a8dfa2abcb674b013bd056bd7f1acf1f96121024052f7d5baa30f0c1c1b7f2e6daf1a58e12088cb50cc088e5ed767c6ddea5cb99aabacad48cad49b6f333cd29bec322ae4562a64915caee4f385cb67bc07c955a644fbf0d0e70afa89ada9f13df25c4cdcecafd9edb5f66241c1bfa280e5b3a3a127dbcdf51d02f93c85d4b5f223585bcb1f931c9b26f6ade7d61dd0400433bfeb4aaa96a104287a07be2f96ace2709e09fcbc00c8dda895edfd33f093e71bb1fbee7f1f7186531069821808c48f1be7633bb9c8545e6a90b8fd6d6d7427da13a6a19aff548e866f9729e6b4fa0cd85b11c55eec5685708ea7e88586ae0ca329ec430ce507d167bc301b5b9725bb60633fa088d0458776366b34d1e9c377179e27480d1ab2e11ccc1473e8aadf3fa3bc27501e45105a4d4cf051f1841494d0d628b0dd663e5af16b4def53dd38f04484e33cf53c3618100b717f41a8db6c9350b95ec5b8c2c3ec9e6d767c899325d5f69567363a6762a0566c6aa147b1aca9a1c5b127136b8c4dbab33aade694062d6e16a901193716ce9e52a597de294c2d65d8d8b05eff34b0d7f2eff5b0fa878b91a2c8684fba370bea777c02566dbe7a1ce2e5be6071e169217eb8d877b88c286e4d7a6f01d9cf56fea22115be53c96fdeb6f6c5be6c1cabb20c66f2404200548e73df209bdaab4bd90454fc0593c4b6726864cdbf6413bfe25b13beaac1a6aeb38f5247b02735a054681735bc9e285a6dbc975075c9c2544bf3f936dcc00e7e5e06a81a53fa0c3f8809cf2415fb762df02e1c2f4481d221fc72fc9c7e4f7aa78d5e05234e28325dc2adf7a537f41c60f06ea938ff05421a01565702f57f7909b2eb7d751e1b7a117aaf007d55ba57427a9b087d5cee3c38c89bda10bbfc369efb966a9507e304751acac02bc15862082940e9d7c265bd77671214606723292b089f044022aba80e2b968a204f409544963c6c3342aa526a066eaf71924328648acd4127d238f3edddb2fd3dedd50ed5c99f741c285e65847a04319fadf25befcd94d60a6d7241d99f54cee3eb87248d63febeb7c6e8e6557881937c249f690246e4748f09e437d1c292d4452b834ef07a9c6d8d90459c65026b3272a39b924931a088683cd521c83b929a1c44b8e967b3e07ebde39b06b44e7950b1dff2161c3d370fdabd85e007c0245e4079c7443fb66fafb1f8e59b259c9d00395f38c9c667c73b13d2f736f230fcea401d07683ca5b15f55f23df569e03c4212c92a58c34c4c2a6b09830cfdc402bd311559f9f75a93df57d8429cddddc6a954bf6831641178792680af2aa9770900942944a7a13287c0b298b6952580ab8af806e44962b1a89e7264f68e2a943ebc19c137e42316b5091a0002fcec162bb7913e1b96dc6c01ea15dbe27208b4764306abe20d4c5fd6c53d38c3906866910099d0a0ccb1eff233c3afa269cbabe8f53f62ef437087df1df345c3fa67d20c429c2287129d4411413aaa4cb4de4c3abb0599232978291526bb83d6f34d5d3f82b8784f4385689303278c1af1bd2e4c4f2ac1be8c1427f09341e51b4eee83c3087f31bf1145b0db3e95b2245dfd8a36affd281920574ab9e21541d23f0d8716ab2a83c39fbb152dcf951af89810b6c30c4103ed67e496e04a6e5ba17f660e5042b2e6547397dff48dccb504f009e58aa4a601f691ad9b2564562fa920f5feeebf92bc07233c3df718d7253a03d6a1e0de85428678efd4668af8da67b6d2d2b4accebe9d07b56bd0b112b0d8d1b13214d9a53785fe4325a02d8ce44a5ca3ab7c46005cb674af0a90b54c7268cc4062fac95698366f5ee1de992365894f19a6848f7a2f88c41aef487cbf607009f986c7835120db9c67eb33d6ed3601cfb9ad25feea52eaf71c9a95f1e941a95dc731d126b07a36857d3200b8d1618afa79cb6497e8188a8159ee1afeba5d064ab3d4df4c9e9f48ffef138ed57f30d6f856b6fba39dafa058aa9b031375810ae0a2d72425e0d87c4dc80cd179c8224a18ad52d5018cd347a3e779b27d89832ca7a03f4002424fcae7a02c6b487082ab9feb0bdd8123d7a3cbf376651086e9c6e4e92d3aedd18a4ba4706a7d2d5f839a1b97319d5160de8e6dc1448ae30195b8d4f85f033712949be7c3f8493f2f22c37aa1b1bccc2d755841fd06dfda2beb89964525a962ed07d9787bfca0bca13408435b234d12f20fbb42afb49cc32dcefd194df6f29062e7f8253d02d1d92e2a93b8bd0019316637c798ac5475d6be746348893e54d604a23909ae5d892b5b2fceb26aa640005067d8ccfb50e76ced9a1a06c205226f8333a3927f67e0920b69dc3bcea2cafe6047d380a663fcc57c2eeae8c575867e10b048db302e8363e216f1c8e1d9e8973a2c106cf4c1ffe16a244e80dac0027361f5eee4e6cf0b7f371353bc8b32ebfd316e3f04192220bd8e607e65ae31dcf83702afb11027cf6c8456f9ed5dba2db3563cd1dd84fe961f2a6d605bae4592eb0441fee8a6dcf0b7d948ba6bf7d796f9df25e2fe9f153655aa31e4ad573d5286ff0400da06f3023a131bf283a6a0d8f4017fb98b8f12752e11663ea5c297c15418aa5b614da3b1db23245e362b40b355953eec7a08aee0298baf2e05864d5a7ca3976dc54dcd66a033962626859ca42a4c8ee9473738f1efdd4f96c36259d3afad76f22b44aa7818c15c3ade2eec98c16ec4f4ddab632cf8a450217c6fc872589f26e47a271d448113c618e18f60efa37229e4017c265bad0b975351bb8e97977133839ce8e82599b6f98202af452f5f1acd4e53a46fffd22c16095981994ce7d39caba0783b14676698cd84921eef1d420cf86c150152a692a90747bea4007e21f860f8a7c42a3dd3e3ead19c9fd352213889da72b205846668588d8b443374e43a7bce7c28f7e53d27a81764b2ad77d50148c98983945fcc7971f038c460115bbc64e2d11c581e24db4e20d3e7cc12c81b2a468201ae314053aac917b172c10b567b67b6b3120f1923c456e6e6320297a7c3ab59c123bf14cf64c67b8bcfcdbf9693bc9a76d9fc5cc10961ee7997e3d0d8b5b99bf5f5648b6be126eb65eb1d1c51f3e5ce8b1ae69f4a40d1f4dc0d775e36f405ce1756b3ae14604c96c09a21f14a35084e224d12d5f1f2bb30d6c5c87fdaaad2655c0190023abb1eb7ee4937c7b79d22b743b1f4df215cc00847bc578709996eaf998916220e9f716bd52e63639bf6c3477a73d070bc8fa467ce47a80a57839cb17cfabeefe2970eb70d463e4f0dc1eb8f7d51aabb0b2c4a64ebc023abe9d1570681b7258e88993554530fbdc1946cb753318cfe30fb11ab234a67cc2d9d6d16968189b0a375446e526385a66997011940e3a090e2b0ae1145455b3ffb2246e725ba2c396a1a3ba12b6a453921b8bdeabbc780b6a3114db3ec4291957b67c0a535bea71073ce518e921b8036a77acfa367861c5e08e1d20acd9301ba7905bd69df7ede3e31e4039517508f2d14445aac6f2fde11dcc3f4c337e8adfbe8e97625c2f1135931a442fb894763400b3b91444860bd5d44f510eaee4f6d6e72c9b629f09ce832e031e773a6fc2d244ce7dc90fc3533e6a9adba3fe5c2fd655daedf5e57b16a67f50181f313ffee605cea079eb8da71835e66e2733675df6c7afc57ddc6415bd7c7a8044be6bbe986e9390586bf44cd9a49ab65b80173833baf14ac30f858ef7c392253ce03daa5bbf11beadc954defd5a5097ecd04fa03c34c75cadda8cf846882e27f1231aabeda626f7b758e03affb24e5a2203a1be3979c21893b7d739cdf78abf7d15e5ee01e263633771ae532637c804add844d20d1ba780e05fe394f9bb9327a13143c98ed9898b819dd2911d4adc9a7c03c4e393e75aa78eae729329842327de9c5c7aa611c70aadac92cc7e4a0cb9686f511e178664abe23440674505421eacd4349a7896b16a2c89a631f146b21c89d9fd91546e953c54392fffd520906ad2b473becc50e049f7b73f6477649b084239d26958c257b0e5b705647bfb6a44b20d7421fc861ad0db79fe6a9e5b75fd6918623dc83aa3327e184517ace365c316503bd69d9d91983986219e50581a69d124a4bdb6da64e4b258f8e5d403ed31d0be41a0497ec3ff14989f96fcbb6f595fc54b15a0ef8137d5585858787619f11214d1bf89fb5679a7e2007fc8b0d87a29f185f7d34e6c64040924d0e55f85c040dde821ea736057806085538f40e455b3f946c97181ca7c0bbc845658b202cbfe4f15aaa5e04a2aa87ac14a9133e2c090a630dbd7cd4d898574983637522908ea55329b177d4a15425b141522b0c3d6eb70b1290a5252ad630ff4ee978edad0aa353afff51cf1ecc478707420f0e957878b8aec0f282a1e3b3c3a9e22c938154c6eb67f7f253ccb87076b2a543c30a2645765f3ae8060d772839eef3dc5af6489379921967a9422527ae37d1954f12734b32a1a7817e19cf6a0d54d79e8576c861694ca77221d5dc4946d1de5241a7c05ece30010923a418cc81d8d1c8b6eef6d46018355f7c1f2ad17ae788be3d4280c5668741345e44ec8c761d31195cc8f9725d735f2d4145b63556ce5c19cbfd0f20543b7b1fc8072dbba4527ee02aee823502ebd551fa49cd31e7af3806bce31cbd8125515e9dee10ddc14c1f437963540bf5c10987fa07647c51e0dd0b96a14b3c33c96167413d73ea1430957d293d259720bd206f42c46b1efe174e9a8169ba3265bf68603dd91542165302cade3c1bf77ec5eeca5e061320c4208d08ee5610c62a32f013e3ac7be65980d36120663dd38dd45b35bbf4e4e8250b57397fb4e2353e8b8162476a7761a7edf4ca7dec0bb1f882242fcd06ae05fd32968444e082b02f82450f6edac974929978fdcb69ca845c34de9210361d0458d0a41d13430343798f9f3bde86f6a48d7059f5d5068d68c49e582e708640f1cd9f0f1a4d9ec57427e4c3e4f514f231d3582b390a19e75829a5da68759d2b445135296f1831057dde048225fb8984d02080ebf7fecde1ec16a925edb554d44bb3873e0a9df293f549e460a713a814658ac6fc8019accb69c9d46a14a94a839e71fe4df9a737b5d10de350b8e886a7cfafc6064f942f99a0231be97148bc7246d8b1d1266434b81609ef875487f20c272fcd387a824bc93aff19074d6b1d4508a01e63bd280547b054d2c2c912158ca61b1da0de7c7c74caafe286d83ee2f196bf873f28ae378df2b2bb5aff069e6874de9fd3fc9d261cd280b79b324f90a01e53c168e437a3e9fa82cc0d89d4b9edef452baec7af7602d2247224fac53fc8cc1200357c0aa871ad8d26686fc239418c34a8fa10e770fc5ee1fefe1f6c6923ebb95d405835524442b8dc9ea9bee937cbbc29d121c04eaa52cb2937f9ab8ab900cfc725ba63d0821f3b52b39d369cf8ce90dc1fbcf488bcf1786040a006dbbb7dac3c500697b72dae968d532e5f58e373db0d7ed78012ab74e510c03324e654beb04fe5dc9ba61f93bd162509612e2837b42f9ec4e8ddbc805231334776a5dcc7021b1244f06843e7bdbd074f37969f6b9d72ab46ee92e1b193a077524e3108aef1e70d727dac5841f2d6b389fd06a9c5b1c74db67773aeb2c7f685c50c7b0918a4ce517195a2e94d8b0ee783bf1554fb53339ae9f223f4bd9c117a7536600907a2210282436d4c8ae7a2f02bd411688535715f73668a015593bd1b96fa83199fd434c2037efdbda18b01d1055f8f6b573b91607efbe791563598e77c8c23c89ff330d60d357755935562087063bac2a885b55b09ed4d4c5c8d9bb0492a43de4c3d597d8fffb3e706ffaab8fb11b9cb1556ddc31559fdf9bab67c7749fa899db5a08e4aa58ba500daa6c7e27503fa3f56db90b568c672cdad9c0fa29c1ee138ea40a7d02ec1b0d561ee58f99c02b276458c57a58d76603b72c95eed2a1eeb16a9690bb37b039324dce6bce928d5eae52783f5e4feba9eaa7b91ebb2550a53c0e3fa58434a6c513a9bb196a835f12d79b5816bb4ad24f4901bd70cd0feb34a75f2eb51fc2cf1cf4da48f36a7fcb0adb2fe8bc13beba1611cde64313c868ad86070e80f5827932ca4007822e7c1fc347a443f9285588b755c013f97002192268b68fb4a1809ca8b19e29dd61336840492030df3096b6247724df29f63625c0b3a002ddb17fd958ef40b5573f25f4c7737219fb677ccb4727ec001b4c891eb244139be4a03df59fbbc372b0a64f6d8d184c4ca111cb5d9b069eba472337c658f5d8b1540185e3619ad45d4b6cf82f35a7f926a6142845eacba62ab012c21dd07369fc4d31fe5b4b23f93ebf5ec4bc41b7e12722045295c09e48de04f49bb299a94077ea7cb8579e5a557568f945209d15d0ec2944635346cfe0be01e6eb96ebb41ff5b189b5f96836d782000621ede734280db9f0fe0ebf3b690fbd5a7abad262d5faaf0e62edf353c1eeb6e641669d7d44cca80582370cf3e4f61469b971a098178af10afd5f233d990789575bfc6f6149949a828f4cf526d71b821cad385607f7979dfda295ef6c45d15f8ba2ae4cc882fba1a28e3942ff91ee0ddaa94d54c31ed5ccf1ee633d35ca1248d9ae0ccf491f01560b635c343401e5b049a0cc66f425f2b916897c36746bdae4e653a89ecb28a8a62bc1484ef5d5e2b6a7132c5554e96ea8d86057f62c5dc7b537505f34aeaa2be496a6fa2a14887d7a286d1f20cece839a31d9b7521df70ac4e8a5e1a3779f429708e86b3e76f245f5a3961c76dd378bd9d7b0e2169ef9ea1141549e85b3113b679bf4b4cac62ac40c469253e889c3b463cc5d5e253799895214f8d926be9c1e61ee54b5124891c74738e919e4445ee09982c4bfef1487a4b8f5ce865557b3f0969db7f5eb9df4dce8818001d9caf36910566d9b4d36567530b6d7e34531e67984be120ff55282f2d0c29bc3df7922792ae0fa5066e881f8cdc28c4a7ee7a86ca2cebec05e7a1d20744c5aa9da5eb504bf05f148a4a78796d80ebb07a6229532e9a619ac356b786922ad1b0b9647ed96d461ef17b146b4026bdf825a92c8d23cdf48d6349279634e7cf222c4d3c1c0a588fa02f538aa8530893b648aa64d90170c3b5deba28f6a04b1db5b1fb208bc8dfa422945b9fd9f964c0ebf83c5fe4fafa8972d31bfc4ca5a4524202b5ccc9403326bb018651fc42a4db81d991ddaee0e35ffc1b75042efaf40856b57098f227602ce36f4086a3fb43e1d23d137b328c166f9462c6a62d1f25de13cd1500d5dac2e05a8dd22a4bb12a627fb3b34b7add004c12bd9a02a3249d43399f232bb750ad485b0dba80c82966d9db5b6b8e76440ec26cb8fc99f8be175e3d14802942f00221e30a63ee616e52b28967df8199d9dd5ece43ac1cbc3268e397f9a3020413e1b2ef97863f0988ce2e9d352a3614952f3a2bd3e0df63ebcfff780c024cc1cbfa82b423699ec1dd23764a1fbdea26df7f6df6510328cf82f5832e3d1c7beeef998359ae43b9904f0fb55b40e0c01e1192065e450e025f5149a0be15faf01b4c2a7fd265f3a8cc539df54094c73f9fe58caa318a971a74d0297fefe0878179ea2864e3edf5b42f8608c3a2a23e1a3387abb7b99fe156c684ac48087589ab40988501638c1169d5b7517afcde087983acbd0939a080c06aaf1f76a8b14d55c32853e1afa9e2e0c1fa3f12baacfd0a301b67b407fe2ebe6aed20eb8e696dc53ca20bd1888fa7766f14ff47f3982ab40020f3338c863398321cb08a3d9f657a58f57ee8501eeadc42ed486332b38b86ccdb9e968d8f218587cb7ea0f7e657b1d3913fa299a6f816c5819f543abf99472fe242de0bad00a0fd4b322940e68bfbcedc184615aae677a1d6eab190c46551ba876f101bf7d3a7e487c7eaf885687fe0d64e465d8044dce5817f4426b85360786b3cd7566e1b905f7d3dcf50dc5fdfabacb33730fa4a436ce7fdf748ee8a7846c145a2e9601dc18fdad15e26d91144394c73e127c38f28133719f2576f2c68d8b3dd57d0979d92a0ff868e81f6ade77f6e0f814f1d4355f9fd6907effb9c079b212f5e5cc9d30b12a142f8a6187f751fb328a71e3ad118c3f1607b6d77eb5a323dfa8d5910d97fcea64525fc47ccd306c66a9a57dbbed8dc3cb11c667a2a18aa3d06a06ce6894ec78e7fb8a8fdd00b7afac6f3a2393a06557f120032256613353e3c825292f9a5b46032137ef44d29140cefa34da405081aa002c86393460242109c0ccab84c8e0cf9d10949d35e8536d1e8013d34a80c586d7527e3708498b216873fdd8e1973eebc26c28ea5f49a26e16fb84c68d5ee35350c7b4711bf66421eaf7beb3c5ce4f712f9ce2d62111a737c0587162840ec44c28c1bef0f28df9f87b1c9563fc92a929860cab8a7fd446dec2043bfda170c00824682f593c1a8c9bf9fdb3521f3dbac9845f6790fb055a8d7a64838a28fd4f5cbdee713b5e3245ba2f7da7a950426e19d61081b5486847f67b6c1543a36dfd6633a4dc4baa168919e32772a4c46f8861c1bb0c37f8bd270b2bb14254251d196ca7afc2e1ff03d2aec4cc2d4f0960b345cca373e2789fded4777cb432af3439ac7a76c2c83c58aec44733915a0d28316be63a8632308fcf8b1bf090c4a0005889de1f87e5e2c322535b172207ba29512290b95e39931d107d2e19c73ed05a870a7939b5ad2b3271bee04c12750d059fd1eddf395cc891ff197b85e54106b67e353c561f8ee6e8d9d0c184a09d6bb2e12edd11f1af4a3b1ca333d59da565a89b5810f44dd7a59ed3ad83b0d2d1b8fbf68e607be540b0ee0fdeb18ab69adb947105e03d39208b896b484c31aa0ac103a91b1fc806fc1dca367920ac3995bcb18ea731b1e5581f3da7a5969f21757e58714ffd18649ea89f246a736cd0f30421badf175909dd827816cbd16450f9cac88186c0902787c4ad7d6ccda3701ec726efa22cd45a549382bd943f1d32b93e20c8abc2b683d5956cf43918877ffb6c2de8a324eeddab6f3ab7e918d4611337bcaa8342cbc892a5a0e55ae4a5d188eadab8db5abe2cb268dbcc9359a457a5b140d90e5ef0a06a2a6b9e23605b44a93c2632060389888571171291549ef511a72e7e2f12f37f8d5267dd1622792ccd07692908ddf503bdb0dc0f299d21165b8cdc62bc1b0e6383ccaab8f59505a5654d832fb35ce74030f1df0efe93aed1afda5f36986b96226e8c8ecd787ca63eba0d1ba1fb644dfc620155cead029720085a7ea1ffa6e7df9240b36b2733df0657c69a4aee9a1adb4205fb2ccd22687f6f39b1e1f6b6c6470c3e15063cbab8468371cba49880666db0948d93ee89beb07b94e60e9d93c5204f43eb30d5e9d0d401e31ea96c81617d1735025725d92770986e584a7445e574579af39b010d3a4b5ce7db4039f0a6eb6bfe4aed2b7c8795a3f09c05d45bcdf2056ab1c05bef09b4b147a8ab3f8d6f4ab8211909216128edf8df2308e5cbe7b7847d6009d6ffcb0fe159cf6d67c0c7feb725773fbf2b133552f5270a2b045939a9de0d9474adc431ce40cc199ac02db9d024b1176397866cc46ff33ad60899e6ebf704d0ba7aceea6f9b73f3005302a658c09f713dae6868e9894c19641362da9a868e31a8cd2bbefe7cb9b46f4b6ba8a0b722a2b17680e910e7fc7725b050717c1598da80829104e2c8a43dbd9ff7094990d5cc789e48228d5ad59e7fc0607d2cb90163c31e6bd22feae507357cd4eb72a5461dfaf22a2cb1f3d115a124e7b5858e808102eb60025bf72304319915e9a10192e9d3ce15d4352d433203b8d00a281eee89355241d9a93ba66b81da41c69a66622fa0565762b83a254da979f0a0aa68f0b6a134359236da02c622cf6ac470d6b0c0f5783ce6768987fd2c20f7d9b5eb414de6391565729ee9193a60ee6f3c9140edbc3715c6bcc634b767b794641bd1f3338ac7615f26f0c52bf8f0af548864df9f1bc3820b342f5812c3d85ad09ee714a46c476a536e2170b0b4c14088f6a6399a7051a573237c482a5b4066af0f2d6c0a930ee7a4313047b224a6d684582e8701698e3d4b1c18c3fc5f9b875d698ac0b7d4699c7922bdc2b5501052814216d9a834da23cbc57d99c1b3653ece8b5e3855df4a920dc560c53d70edf698908a6a4bfa27e6905d0a879a225adcc5db4b252d6ec47e11b6c987465c8beda2454f5e53a396cc96121404b3bd5a311d18964229604691872be3a7a02a7a2fc125a9a07f7751824ca5abbc6f92ed25f423451b3f2567db8013551c8add4208d69bfb60e08efa663504573b289bafe4638ea44128bc7a1d2def75fef31d7b51a92ef8f31f0a4c58233eb0bd6a646f6d95333ab8d36e4e5ef0356e307a70cb6dbecf0f240a749d2f9da9861c50e64210417a1c09931fecd45088acd7750f67cf8b1505b31f41f1ff21cb60ff9582a99b9b11971739552c357bf876eef90d6f6b5928e3397bd00bf400d08a33915419fc9ad3725339dc1d2d1a83d975dc0ed96b84b5328761fc49d714836709db368eef06cc14b2545d15b5494b2ba4cc92d7b193e29b98d5b6f2610d4ae78c4768f18b5fff53d148936307a499bfe29112f2791a398fc1be12a0a5d13344fc717bae19454fc9211c868543c3ac7f826e74dfac3c52da91e9fabdee4c1e76152ee602973874ada718149460f9ac3a9ef8d7d3732760d11efd0d21722717c7cccd47fefcd920b5e0409ff42c4e920eb87555935d6a9fc4638599c7ca1b5231366d3e1566cd7a40172e8b5df467e4969f3ab9c382e5beb8a45461919630d08c3e1044b4363d7289561d940a116d48df6622af9e7a233379bce65a421a868ec7577a1efc08cbc180c6c03539d30c1174484b5f9ea4d00bf6ae9d7b98cd8818d6da198b42c2397116e1f6ddf399e2c5d471a395a08e909cde980e67cbef44aee0a0acae8da980573fa22e6360c74aa1b04892172fa911282e7d017e64b08261b51c44d1eca1c80e9a057bf9e9367f518f9cd60439d377deae7e7ac0f77dc033590e2a28e0b412828c3319f5df725620a1027611e2bb460fb3acebeb906474fc292cdbdb65dd3cc424236d6c695f3de62f1b435b3f0e9fcaee58348cf40fad20a02c9cd03c996b41f4da261f1bf8c1af80e42f2959b70a23b6b8575b9300f59d39a35c6f2c25f6b9fc6f3971ee25e30a08f6b73e02fee14f2fcf135b987291907adfba1931474e4916a186ea80737a1aa5d079e2da00fe58a6103b39cc77f4354f3508d394096ccc4b7bee2eaf96ff5584920ab6819b3231fd81fe65dac4232d8ebd5a6e977b3ff8999ed08c49568fee1809e10d27d2a05aa0df5c026aadbe5d7ce231994f3b8ea613fcec2638ac922a73b751b83dc91da0c6a7263d496d05286389e7fbdfff427f4c47af43963a4c2e196e0a53195836e67d2e165aad8e00484aae60381c2a1fce8751e2646364f3147804d1577c592ab00439b087ca48f7f60e5a4c4523d77bc8251f21683a53c8e36ac14f3f76c8a2e6fa9fa794ddccb677c917c965ae59bef1cf6788d5ce6f9dfce4e87963ccc30fec1f38af407a35655cfb8d8d301c52a8a6d2cb69a5b3e0c55c127b5846dbbe6b8f6acff5a133801a5d5de1a75e990eed06dd5d906d0ee4097660e3ff3f8abf406e9522bb2932029a86c015c16e880314c0ab67d16dc4e3c368de23ecbbfb7284770bc8f64a67abdcb09b1f17c9b5dabc18aa29084ca7ade13bea83194d28eddf9c627e849a9909abc605943044d1eb8d8450d7e3e27a8daf4388aee759173946048aeec7b117f0d265d703f1805b922c7f65ff184c11e2b3812b2cbdda48cf822ad81cd2d1552bd8cf5b26505377bd0a1c670831a5f63df56b5e427ad745e7f39c284e81d52c05905390bbedc96a36bb413f701c43e0c0ea5815cdabba8de7c12c583b92d540240b7564c5ea2bde1977736d6c47aa0540f44cc900671419e793c37f0a4071a84aa884e28790a11c7a178544806383dbec120192dacd41e7d81aebeecd92392b060d2e6ec8309fd6364c1803a76ac802a850351f52609cbcb9d1eb3d747d13e59aba0dbec1c0db45c31d5fc856213dd84d278fe9b46188f95bfd9b584806e3fa93eb8dd2f41a84cb34569840ffb9f7037101aade61057b7e68b2f0f042cf64115131cf405fcabd5beb133bc29b4c4fcb2d96cd3ee0eb26344ffa291811396af99250435996fc383dd6a4233cc700dc765b85fed52c7717ccbf5d0d5e7b1d065326946bb8b0caf60e0f349abcb1a1c49670c618408d9ee35c295ff51da1338168b6a4c3d3b99f6ad5984d84a4dc6576fef2f751eaa74aa1e29c1acb61903680d8fc5e8d3ab48b9faabb8af77814973c2f4c1fd3879ba9639c54ec38e4ce76700ca19ad3ed813324dfe925e77f99a25a334b0bd2c637a1d43a4218a897536932191f91e2cb27862ba21b4d016be616c74533713d064ad32087f0cb9646449edac987ecb92a004b482e2b6edef4f20b39dce24dbd0f6cde7711678dc145c9fd3086f9eb49973db08c980f44c9ac00494ca26db401aaa905646f449ad8dea521287625ddbe152105c8b65dd5af4e1cf2bf1032769908bab4294849b1a1e4ae65be5d2229f4995ffa1ade2e447d1647a08fd30f354e531ce643d86f327f26cc5b7c483eb2fdde48aa5023d250b50eee37da687d3e0ada0364c7b398bf591e787f002f776015d6d78599cf3f08d4dd8dc77022a3e0b19e32eed838894eb688138fa1b5784d16eb770e4854c2000996252bf94ae45f924918e4021b967ac254952340ebb99d10a2f26d4a595fb5ef0ffb5b08be532ce9aa5ac420fc829c6e6256daafdc8e49456c5e3b64c90b17b0fd30c472de0c1dac4f6f0c26532b7c1bfdf0f41404adc626792811c15ba63121848580f8faebaa0cc61f789f48eb3d88a33ea3f5dcfc71e70753845493458e78fd0a41034a0f5dfb04f5ddc5cf0c656022341342577931c0de4fe5c057358fb76dbdaa49884adc30c15d1e05171b137e6b1ff9ab38f1c864ed9ffc3622fc9a9c0dc989672e675125b6731ccb3d51b4be7e44f09590470f43cab7a80fbf67a91dc3d633acff254191074e2c8fd8bb28144758c5e4df514854ace74763c50ca5d819f442b5827c48d53e3076317bc8ec2d366d67bfe23b08879009cc88e7eb3c69710e5ec1a529bbe620cd3996899fe7aa8d8598b83e46b1d793ee6662857f8b9db9333a1514a2b9bfcae81ff11db42ec3af8d5e8fd460b7bbb951459feb6a1c979cc4ece31a9c682f03a6ba6a8cc4cc5b6c888883af7b8703ab7e7fddaf9ff44c06d7ac2ab60cf8f219b5223b51cd7b5e5143eb376ebc543ba43d4d39460ba8cceace89e008e6967b71dcb27a87b7aa49fbf9eccc7a2321814e3204f292330a03c84698c4254a923029b8c11571461f1d940184705f44cfd8dc19c87d02b35a886ff2d85c65bd0772c029e423aaf7caa4f6a978d9a411c0782f404304f207cae2a19d13ebc5ccb9b1410cac4a363a5c890eadaa23f6a9157764d01e6bbb4265af58867ce09d6bb74db12dc47e5155181d844769f1e2d553312aa7e0be91f27685d4ad5df123487ae4dc092ca93516af0a33d887b9f11a0a4c3bba0853eb86fc06377ea8d39f6e67acca5970c021d2253b5a69a85979cf59fb709fea1aafb4bf51d7b0d4a9ab8398b1f0496c451f7a614b1bae5a1d58bf11c4f4957ac271ccfb3cf94a1360e5b24c588dada588471a5f0f8a85265e897dadb6e854b028d6174fd9cd94f8631cc8a7b62b9d3ec58d2730b38cdf597d30d4ced52bcfff34fef6189724f08aa7eeb22e193ee195cd8d21caff1443a8265191a35f20a8c14be5179461ee7852241201ba96392d3a43a2bce28ec739ffeecae07eadedb0704c4380555adf84c86e722d6ff6d2c69486159deb6de3ee8926499508cf39c5a46df72923f4aff97f481ff8b975ea0cc178c83218f9881f7e6379c35a0dbc9ded5856d14b1ac6fdf698dcd55487a78b8cdfeaca2574a7aab84203179afa60d3a28a49233f432c5b3a59c6d33490b55594de023521632a1b41c8575cbdb9ec21ede5d8fe5eb89e9f22ace24de92ba6dccce2d59de9e3be08eb3e56395adc7e3fb0a753114b566003ffc1366aa85d7bd5b1099df4758d5932d588b609e8c95b20addc164fa754942fe7326b75a204f4e59c836e82b8b9fd7d2763980ab2627dd103bebe0c4d5997539c3af203d94546a275b1d052ca566b79404e53d3bed3b028db48a2859b87452f4c0f2025ed5765179034407a7e761bccc4bb456bb0b6c48a99c9a7dacf326657565ce1fe2b9c1be6542226d898aaa626add10a8a6345b5dac737c65ef9591280a741bf6442dbd5208862a96a3c20bcd541c169509430e63a0e91089b95445de1540923848aa8b80c2af47ff520415497e53dc79938384cd21560db8ef2099b36180a59f334d23a9add2b814d16de0eed8f71413dec2478ece8a47b0cc94849c4bf15260d75815ebf0b8fbb21920058e06a6ff18ff6d588d276c52bad2c3136a49081277c8958eeb7cb77816b387b4a31204a29386485f7aabb5f84d6f23f9f94072b34bcf1f89f2d100b3539583f229199c2348766dfb5783c4e06e1c2f22bab3039813e844527b9f8d5a115d0c06fd5c7b9850c45ea51608b0c053dbd822402fcd75e597792efbfb0d081290f6d10d9d99e1acce3e587a63ac4e7670df1ad5c1c43e651e55e8bbcdba16768ffc745af3ade6a9c418f0766054f2e2d5172b1aa26431a201745784af1ed469fba4932d6639d04c4027cd48c232da37d9a1c2e82900054ddf6a6333a268a8a28b04899a5d4c480e4e1d8ef9a9aaea62eb99afc8dc2f4c2e4a8f8a0f6742b230b666a4f917ffb99ec837586883e3eca23b1bc8bd1ad573d7fda48ea0db406850088e51e7c171768d75b640740000f528886fb7ee2b63760c33dfe54247081fcadc4ed64282206ea01f40b6b8be03e0401f83f8247687167783544cd48f0c3893629d28a1c5569afe89fd3eaed64f8a144a649cdafddedd410c0bf6d65f3afbaff5eccead92baf6a8f74aee98dec844048513347be2377ab8983965cc9733b7bd3c4944376f7c64b14b56b8ff29bf8cf5b1e4c20e7427b44eebaebf6db11a43dab7419a9e9e9a831121df9de48330938e993b5ae511625f4916e67e00e996887c1863d941d8b77e0546233ab150449871b71e5cb6d41f066de356e0d0acdc3ca538fbced35f28ff45601ac4a9e4e70ba08a881c15eb7d0fc1420a6afe140622e9fc162802bfa4d8b74cf617cb02199ee716500648eac5ff645fa20750722d7dd133a9a6d9a33c9a916630e06caeebc19e0d7a4d0808d82dae747a7c0ea52df96c16c92e9571d711bde865a60861f08f8000e92bae42d2230de60fafc796cfe560f8d3e90f2bf3e2dac660c478f190290054d3321a2955ab90dfa61df2ad8963a4533afb22ae1db44be008e597b880e4dd73db92692e57238c353a1688bfbc2ef0a2c767cf91c09cf1a2c7f6110dc737c16f1e2d1c0e5e7ed2d2318e1368183cb038d209ac2b5861c08c05aad1204794ee96a5f21a4f0d6da42563d434a5f916bb3ff7aabb3f6276134bc13b9521fd05acd7551a14f24d58afe1820ade4e6e1e920c002b6326bdbbadba738ba84ee1479cefe3e51d92f9709da5a787aec7262e19d4434ceac5d9f3a4f650e9d998a96973f8ad967ad3f359fd0f193cb7588b74e910bc4a22f4a70bdf2de1c829ae4f61bea50f0a0185e1cf11083ab4fcd58539134d5da2a4fcf16dbbecfc359184766d66b02b57a4e992d51434faddc82f7f4865800497f411da554b77d710e281d2368bd0ed4c102377fa1390898cfa2922d5df5809ebd60c1d487cfd9c230f2c76045e6198eba0631827a85a2aad403f503649d316f95bda98cf298d367ee284ae96c1491c48a7651cd16c4dae61b3647e8a6f1a4189dce953142abc81ece037c6e05f5bf247340e6e94a3404f6412fb32b0ff316b2eecec538abd9051802d6aee4324439d7a44ceb7e0056379c410ba9c0d959486849c286cbb96f18d93f3a58c49f58de04433a4c6490ebeee78bdee3ecaac6ebb1456eaeaf2570a38c8a42461e2382d7cd23c0fc15bb46adbb66b4408bc454617a371ca5f996a226a1c0794d85b9dfed1e430c153df94fcc78e845d0003bf2d50c9cb6c9cd05788820f201ba83cd47d9010db6f005fb8310cc2c83ddab5ad103ddd4d103c9f45c08702f203a0a88c8e37a8bf50de2d80c7381306d5dc3eb895d2fd6c427962200514203d6d959a1ac7899a4d3094a8856d73774b41f690994949dc8d3074c4f2ecebb4dc685a0cf127b6195317b3de8ff74817b3c4495e34d08f826ac814b2a8bf3126cc71aa7fdd78fec4bf8108964859385ad0b00dbeb589d21b7feb8ccfd4320b5b59cdb374ef2dfab3780595d30957138b3b1e5ebd87205645c99d4d0b873868c8b6680bf4fbd5f077c8a10e4207fc83c524812057f5e75aa32841708ea87aa076ece108aab3607c9bc36cfe78cc311c9f45027893d5bc4a21aac63f5b8258e2c4e0cf25cc0ea09d8f7e29ac73afaa409277f5f7e631791c9efe805c6a0cbc467f84d9864718e36bb0aa869618267e5373ae07c51e4e75113bfb41315d7158a2876fed82e113c5769c011d94ac31f7ec10635a865989455b30a76c01f329dd781415e6d0176e45806788f9fbd9fbc64e36312404f193ca06cfff71b5ba41678ed382777cce6e2272cc1326ceabac4454cf51d9223bc4d116d9d36a51968571f4dbead24c36992710d7871af83edc6e8536b557b5501e3e6683580aecf4ecf0182b946786cd5fc31beca391b3ca464d200826715b981303e760659c5ca1fd648dc5eb7e471f8ba33773fff6d78d91b0e4a227c18934595d5921a8cc72875d2ae39136a8deec3145e144d0883a5dfcd57560113faec91201d6f82959bd850c2a1b54d53736f07ac9c42fc66f9137d64d894e129ab980d05ae787ccd79e3ea07a85ad2cf1a1854f9af5579688ee84f87e049ff1eab313760191d52578ea3c8a5844dad5165afaad73aedd645d09ae7939cb13086f776202c7a7d78924206921b8a60d7a50a0c0fd0133ef24a45f6bfd4c9aaf61fbcd22fe4a687987d50ae4ee2c52336381e92c07031986bc908d8ff0e90f7e073b11609eaf8cb839e7980dc99f775a32c25ed52dff377812b50f5bc6735789e755906b5090fa36397cd85a7a361f9ac58354e288c79f4b1586fd99b764e5a206b461eeb0b58c295111d429757e9cd57155d23232897e1b9677ac2c043e1aaeaad5dafa9934abef7beee1f255486881a5a2c7eac6b04ec1328a14950ad829b30978323c808b570d19ec079088ab9044fcc331614c231a1fd9daf1dfc2debb28736021877e3970d5f752a7852007a11615d062d28edf8c3d8cdbaccd7cc189604fe10b25ec3d910042d3157eb76e1baca1f4cc14fa5e22aafb511a347df5869328c24dcaa534013e98c77ac97abc3fd89a0c44061e5b7f5c3bddf61613378703ba7370d808034c5930ee108aee3af55c3d52342b27e960f7909a69f57f84c1f4ed37da3755b8fdb039c660aa3d35aa28cdbe72dd5b9cc1c5bf9d4405b2e3afaf785b06d1f7cd45ff532c11b7fa6281bd96115a46396cdd9cdaab4185fbc5ce56d2a3c0f3bf665baea8ea5d434ffbf43c46daaee53542f8692afa6317e4e456b88dc3125747869069255b52cca10a343669e1fdd0a83caf4e7a94d0fd3f1aa4f78e836379c150f9c859e36ee3aa9bb0b7fa33da1236d0e1f3c4e6550894f521798c0b861da7bd9631d9d1d76f5a423efda2d0f1d9db29fb3acb72f0c7314c1d5c466868b76dcaaa2ebf36fe0918910d16c6077c4134b18baa32b7b38de879c215ab51425d1f8ac993373f42dd075896d4051220b151d7c2e17f0b08e8704d7cfab933a04dffe717b845fe7c79ff39199913b4c41104b8f7a99e4f6d9e78025020e524c6614abc42a39f4cfdf8e53c32a45d16224a11c45c637f302f309efc34b8e31ab6011eb4c476a29f2945b21c6fb63a556f424a173e1f8fbbd10edd1097b03c629236732f9d7d536eb7ee197f8587c6fdba26b73866fb54939b949c50626e152289e51746be060a173ba0c58c0005acd2f197d9f07bbad81b09c68fbc9abe189149d398e1efb0186237ecdc5d3fe4ab0af43e70eedc1421738750f326285356e133e5505d31a2c449feb2cbca6efd572512dca41adec87038f7aed15e22f4e0432ba789bf490b23dcede0883de08b25b758c400f3554bf5db983e99d4a8e8cfb71b9597389e34b78ac24ce2d4b2d5e719c819f07ec6b57ad40af4ca4ede50ac84f339cd7acdc486f06870fb9095cf5e8f16eadc47aeab07ca5b1fee9e84996266a8735f9f57f201ef4739827a95f6cc995130fd390ad4947674fbfa39003f9f994584ffbe61a123a4f38023563d568f0dc9aa287d3ccf8f57b41f04349b64e3b4d1d31ffcf9e7e254477e7b8a0c08fac0350ad58d347c586d3becf4e0eade4ee33d99111f48f97eaff79bf3ae68db6b8047de4f115c1113d40547e1a83d933942f895799294b5ac75158fdea5c39f6daebfc40dc89cf01889e55d8d4aee7fc513c2253a04702a7fce7161e0255b2d62ea478ef668eec8536faeaa05a9a35decc3669d53c6f7041708e2834f6b7bce906e73f0bf5757966257dc4c960ef5205363b7258c6b844c5694d9193e430f4c905a4f74d6c7b303ef69dc0c787aba4a89039ca6eb3888f158a4471848bb60d858b2bf418ec20e9c934e5256e9eaa85d1c8b3b21859ca9f73ee1e924431a26ab02f00fddecb73d32c334f67ee5034061b1752cf5d39af6c00cbfe526014d24fab729667a62a2d8c55feb257c6e426d57d792414775536d540e26fe3f4d3d2dcf5023f415ed9a97500e0de5105c08ac04711427c5fe7c0471767453d93e73632b252bde05edcb27f5ce3a9ef43f70e5086f475a1a5e62d13050257f3b3c40505ec46f4835b221b4bad50fd13a525b4a5e39e1445cedfda99be2bcb85f4876acf0f1fbdfc8c15c926c48bd4b2291c170260c7a29691e3e3007ee6aabd38561f6ccd8575701e8b4e38d0dcc4118d25221e1b590274465e6cc52c079837bc740b8d5595cc1efa9607e83df1906ddd2b3b93cc9c27356d9fdad053a7db2619344728c0d7024bb16be52acdaa2dee3213f5d1be11296b5ad46523c1f6bf5144043f81038c9b1c01e9d1598af2d594be03b182d45a2b0d19650c5d77f51cb3becda1de58c234beb76f88d8debe92d270d42f23de7647a4ab7bb467fe29f54f46f8452676e5155942dd45f14eead5926f854dc0ea6c5466144f38c664f96fade8a0dc9939fa474c33527ba346b41a44233c6d56a7a4724dd8e5a7ca0b0ea8acfe7e9304748b3e92ed315d1e8d3e1d6d88c94179c4de207f3d9542a8893d9f169b9ec396ab0e76f15c6432c37a2cf6236dc3c32d4bb135385f02f7cc830cc9037cb5960d34cbc3e5b6163328054d4a75e6ca5a9e5041f9d98bb4a329df670b84a3598b357e0c34d7538b9396065be39702c8351abfe9a04ffebf9d5a68439bc29cd8f08a6b03c5560c51bf6ab7d2eb6df8522f1d5016a5da51264ea2e3ce2c27c18f8d9ed102daac9ce7e1e8403bea241b1d8419da5130b447970e59fcc387a1d010bbc2c77cdf70196de7b62787926db0fb9afd10616462c90c572e9f31854621676ad6a5f5e9b9b078cc63f0dfb44eeb8ecb3cbad70afb48e14c0b3507a813ff70f8c9e3c446b991655ed0a25411cb9a10e4af2f90aed6bd62cbb7cfb126f6f646cba4c4fcbf001930f53571c8a051eaa4852390cc861d3ef69d47f71418f0ed7474a5f27e39b896dcbda3b19c6a4dc78a93eace62e027ad56d5926379099217162c08c3983ee49555f1c9e20790f01776c913f9268fdd0d3f11e7043477c5d7424249aa02f997e427f7f1bfa8e57eec443ab54a7e9d136ed3debacc3bcac1060337d7970472bf0167c10170e0d12a12a66921b3f5f2381488f6967e6f3379d7a12118264acad445a2bea41f00c990f6b38d7f67f7012718fe79ae5acb60ef53ee686caa72c70b79635f0d28aea10cb72b70913991fce98bba8742f50b3bca19eaea17f4bb57c5bcbeab0dcc5f2a7e03cc522ffd761ea1fd436aa8a91c4fea85287ce529fbd48567e72b1f9cb6772e4a6287bd7a6c8056b78b1f04606f64bc069a5878698dc2e6488a33cc4e046fb4017198fe2813e5059f693cd7d4b1418375e9053e82729a4f53c69c5f743404eac732a0604512873d1becb8ba8d902a8ee170b1d929ed7fdbcad462f903e759dc68b87a7b5a2550ca1a1378f4c6750347a6acacd3180c37924f7b88c16e922f8cb1a9c3522504b460b57cdb3de7edb468a07dba38271305107409263825354af3d9386037517c8189335104734fb9e6e743a32172126dc7d458e798ecd9f135eb87f2d29338c081adf016ae3c7013586f816f44cd0d877269c5fd872e27b17bf697705cf444ae6d7931fea53e7c6519ed9842f844547eeb98c7d591eddf9321b236049c53cbcbfca84c809e1538d7bd85cea425d85b6429912d43c4cbc7cd81a5d906bf300d8a8cf636f67a66f3519e3ef4bf371b6ee3152ca068848502d13e2cfe478e608ba435cd83de5c40b33cda526517ba5a851117d5714826e6622c7745dcf91be4297ea507115d1a15123f278fe2a2f6b621d5eeeae39657fbd9af34a9b47d0cf58accd8f7495954bf1d46d56cd9ecb4c998894292ae662fd795bdf6d0a282ed16e8c468638d45b5c4ba44d4019628ef22c8f3dc330a0520dfb6e8cee27fb2c027bcb49c8059a592fd3cc6c9a1939f25d30361de2c9912e7bf8650b25d759f758f5f54064b9217b47397a579760fa911d94531be5098738fc7b210ea6aeaf0f8aeb7f373639a3a01e7df47b4870b470093cabca1743b5152bdfd8fa92bb624b977a10940610cd2b385c9354ae2cabef9bf63f918e60f73bcb2272a97a3ca05472cc6985721702863590001d446d4e935044dc550249de4d474b1cb1d8b8a56b2163321fd808a45c41aa2d4b58b9155e6fdfe719f9ded6d48d370a7b9547c7750090b27ef2b88df4675d14f8216017edc7767b0bd7697a4a3ec691eabd8c3130bd7841db4fdb88fe169c7753fb9994009dc62cb7675f7bd9cab8fbf0fc1d8ea8a1824a0e1c95769031148e54c871bd903eb775d2a1ae737b8de3665434c3cb99520788c0cbcda63cc6eb4495b4998a5007101c4a345ae8c9acf546c2617977e0d62f18524558f400107a115f89b2ce1522b61194ab94e2e56d18ca4051dee901f8260e41148f54395c222f4b8572d42ff1b89a029aee6fb0c5b750d6015f22714cb31da17c283f0284ef35c9b478f508bc267ed9c24150677a2ab0e7060312c669e021eea4b6fb839b21f94b2a76c1ae67f420384ccf0834fc74455d35820651fd420f544862d0958b589bc26b4eb26b9c3e42689099fb80c46e369997e7ffc6bc3827d327e0b8d75f935659a134958762d0b40af3ae3b178123421abd5532f7c3504ff39c4f4ac4a84c33613c30851ea7dd48fbd1b52b81ab3847c06d4ee1f4835fe4ac1d28c4ca29938ba740bf628afdab04455ecb6e1b322ba259510f47c2480f5e38f4fb7ccf9ef874eb606bb6ab806a7394a0ed161a032f475f33457b36c5be569926afcf937279d8038e1978416d23b0eb2dd4db88cf8d1a9c2d00b24de351d81b3968fb89cda898a3c165e168e59022999122394e4a09d18f8302e7955a5840fe194f724b9cbee4ed7da2d5706ac9eaccce3bd9d112b0b83087d94514a5611ac5ab5de5af6e59b715447b1f7e18eeb68433188ccce9ff33caa8205e31748d1b64153afccd64f5ef39ea676ae4fc816a54e50abd7b89a6c641dd5dd3e0ac3a5173b220123f87541e9b65c9050c63b288e3d5bd419529dbb96de04ae76c34a958403ecd1ee81e8b22ca2e75d18515078da3cc1f94a194f3357abd0db05ad57b80b437b4661cd7493868b8367cfd031d25b41580acccd6f2df78a9223524ccd7341dc4e49cf63e4a2634574932ea67a2c864f641d5186b7066aee42966cc0a8afa15b563eed7bd6fcdc99b96806f19f4f3e3c1bab7652f6b4af2c13e987db7b70726e10ba3f93c65ac2ccef65f23c07c26e83a5f2a648586ac6507c3902a5bf8b7523e698e91c8aaaa2d5abd331e6bd59d6883e4505e1e76a6e59b825c0a55294d66b0edfb9ee77805f6c7c2652bf44cb8a2b1528bfb9d6afee409c66d71b877a50352d4fe1c7202dcaec6453610d5ddce16354349529190df2ccbec3dcd823f6d591723e70076bb29f3547e38fe8c14d2636c4657914d0c10d4d47053217f614692de70cb466b13d0fc691ce92028ffb3226b2f5224cd1c1989d915f0274fd95e3762fadc816a795cad6c0fe9ac7eb8eff61c6d6b668a7e2bf0fa17ab6511f53570ce99b9afd9a182e77f3bcfca41ca20f542fc341196f4acb9d12d25a925d0184270e96d6660f6cc57ecf4c27a179448e20b8a889c6137b380cfb37a75adb353f6354b7a7201ba9740b288fdd4e21cbe8094b4b1d6b89780cb66c</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>æŠ€æœ¯/åšå®¢</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>next</tag>
      </tags>
  </entry>
</search>
