<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>è¿‡å»ã€ç°åœ¨ã€æœªæ¥</title>
    <url>/2020/03/20/%E8%BF%87%E5%8E%BB%E3%80%81%E7%8E%B0%E5%9C%A8%E3%80%81%E6%9C%AA%E6%9D%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å¼€è¿™ç¯‡ blog post æœ‰ä¸¤ä¸ªç›®çš„ï¼š</p>
<ol>
<li>å›é¦–è¿‡å»ï¼ŒæŠŠæ¡ç°åœ¨ï¼Œä¸è´Ÿæœªæ¥ã€‚å½“è¹‰è·ä¸å‰çš„æ—¶å€™ï¼Œå¯ä»¥æé†’è‡ªå·±æƒ³è¦ä¸€ä¸ªä»€ä¹ˆæ ·çš„æœªæ¥ï¼Œä»€ä¹ˆåº”è¯¥åšï¼Œä»€ä¹ˆä¸åº”è¯¥åšã€‚</li>
<li>å®¢è§‚çš„è®°å½•è‡ªå·±çš„æˆé•¿ã€‚</li>
</ol>
<a id="more"></a>
<h3 id="2020-3-æ‰¾å·¥ä½œ"><a href="#2020-3-æ‰¾å·¥ä½œ" class="headerlink" title="2020.3 æ‰¾å·¥ä½œ"></a>2020.3 æ‰¾å·¥ä½œ</h3><h3 id="2019-11-2020-3-å­¦ä¹ ç¯‡"><a href="#2019-11-2020-3-å­¦ä¹ ç¯‡" class="headerlink" title="2019.11-2020.3 å­¦ä¹ ç¯‡"></a>2019.11-2020.3 å­¦ä¹ ç¯‡</h3><ul>
<li>[ ] å­ä¸²åŒ¹é…ç®—æ³•åŸºæœ¬æ€æƒ³ï¼Œå¤æ‚åº¦åˆ†æ</li>
</ul>
<p>å¾…æ‰¾å®Œå®ä¹ å†æ¥è¡¥ã€‚ã€‚ã€‚</p>
<h3 id="2020-3-2020-4-æ‰¾å®ä¹ ç¯‡"><a href="#2020-3-2020-4-æ‰¾å®ä¹ ç¯‡" class="headerlink" title="2020.3-2020.4 æ‰¾å®ä¹ ç¯‡"></a>2020.3-2020.4 æ‰¾å®ä¹ ç¯‡</h3>]]></content>
      <categories>
        <category>ç”Ÿæ´»</category>
      </categories>
      <tags>
        <tag>æˆé•¿</tag>
      </tags>
  </entry>
  <entry>
    <title>transformer</title>
    <url>/2020/05/09/transformer/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><a id="more"></a>
<p><img src="/2020/05/09/transformer/transformer.jpeg" alt></p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>è‡ª2017å¹´æå‡ºä»¥æ¥ï¼ŒTransformeråœ¨ä¼—å¤šè‡ªç„¶è¯­è¨€å¤„ç†é—®é¢˜ä¸­å–å¾—äº†éå¸¸å¥½çš„æ•ˆæœã€‚å®ƒä¸ä½†è®­ç»ƒé€Ÿåº¦æ›´å¿«ï¼Œè€Œä¸”æ›´é€‚åˆå»ºæ¨¡é•¿è·ç¦»ä¾èµ–å…³ç³»ï¼Œå› æ­¤å¤§æœ‰å–ä»£å¾ªç¯æˆ–å·ç§¯ç¥ç»ç½‘ç»œï¼Œä¸€ç»Ÿè‡ªç„¶è¯­è¨€å¤„ç†çš„æ·±åº¦æ¨¡å‹æ±Ÿæ¹–ä¹‹åŠ¿ã€‚æœ¬æ–‡ç»“åˆ<a href="https://arxiv.org/abs/1706.03762" target="_blank" rel="noopener">ã€ŠAttention is all you needã€‹</a>è®ºæ–‡ä¸Harvardçš„ä»£ç <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html" target="_blank" rel="noopener">ã€ŠAnnotated Transformerã€‹</a>æ·±å…¥ç†è§£transformeræ¨¡å‹ã€‚ </p>
<!--more-->
<h1 id="Transformer"><a href="#Transformer" class="headerlink" title="Transformer"></a>Transformer</h1><p>Transformerçš„æ•´ä½“ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨Encoderå’ŒDecoderä¸­éƒ½ä½¿ç”¨äº†Self-attention, Point-wiseå’Œå…¨è¿æ¥å±‚ã€‚Encoderå’Œdecoderçš„å¤§è‡´ç»“æ„åˆ†åˆ«å¦‚ä¸‹å›¾çš„å·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†æ‰€ç¤ºã€‚</p>
<p><img src="/2020/05/09/transformer/over_all.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_model</span><span class="params">(src_vocab, tgt_vocab, N=<span class="number">6</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">               d_model=<span class="number">512</span>, d_ff=<span class="number">2048</span>, h=<span class="number">8</span>, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Helper: Construct a model from hyperparameters.</span></span><br><span class="line"><span class="string">    src_vocab: è¾“å…¥è¯æ±‡è¡¨å¤§å°</span></span><br><span class="line"><span class="string">    tgt_vocab:è¾“å‡ºè¯æ±‡è¡¨å¤§å°</span></span><br><span class="line"><span class="string">    Nï¼šå †å ä¸ªæ•°</span></span><br><span class="line"><span class="string">    d_model:embedding_size</span></span><br><span class="line"><span class="string">    d_ff: çº¿å½¢å±‚è¾“å‡ºç»´åº¦</span></span><br><span class="line"><span class="string">    h:multi-headä¸­ head çš„ä¸ªæ•°</span></span><br><span class="line"><span class="string">    dropoutï¼š</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    c = copy.deepcopy</span><br><span class="line">    attn = MultiHeadedAttention(h, d_model)</span><br><span class="line">    ff = PositionwiseFeedForward(d_model, d_ff, dropout)</span><br><span class="line">    position = PositionalEncoding(d_model, dropout)</span><br><span class="line">    model = EncoderDecoder(</span><br><span class="line">        Encoder(EncoderLayer(d_model, c(attn), c(ff), dropout), N), <span class="comment"># encoder</span></span><br><span class="line">        Decoder(DecoderLayer(d_model, c(attn), c(attn), c(ff), dropout), N), <span class="comment"># decoder</span></span><br><span class="line">        nn.Sequential(Embeddings(d_model, src_vocab), c(position)), <span class="comment"># src_embed</span></span><br><span class="line">        nn.Sequential(Embeddings(d_model, tgt_vocab), c(position)), <span class="comment"># tgt_embed</span></span><br><span class="line">        Generator(d_model, tgt_vocab) <span class="comment"># generator</span></span><br><span class="line">    		)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># This was important from their code. </span></span><br><span class="line">    <span class="comment"># Initialize parameters with Glorot / fan_avg.</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> model.parameters():</span><br><span class="line">        <span class="keyword">if</span> p.dim() &gt; <span class="number">1</span>:</span><br><span class="line">            nn.init.xavier_uniform(p)</span><br><span class="line">    <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure>
<h2 id="Embedding"><a href="#Embedding" class="headerlink" title="Embedding"></a>Embedding</h2><p>transformerçš„è¾“å…¥æ˜¯<strong>Word Embedding + Position Embedding</strong>ã€‚</p>
<h3 id="Word-Embedding"><a href="#Word-Embedding" class="headerlink" title="Word Embedding"></a>Word Embedding</h3><p>Word embeddingåœ¨pytorchä¸­é€šå¸¸ç”¨ nn.Embedding å®ç°ï¼Œå…¶æƒé‡çŸ©é˜µé€šå¸¸æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<ol>
<li>ä½¿ç”¨ Pre-trainedçš„<strong>Embeddingså¹¶freeze</strong>ï¼Œè¿™ç§æƒ…å†µä¸‹å®é™…å°±æ˜¯ä¸€ä¸ª Lookup Tableã€‚</li>
<li>å¯¹å…¶è¿›è¡Œéšæœºåˆå§‹åŒ–(å½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹© Pre-trained çš„ç»“æœ)ï¼Œä½†<strong>è®¾ä¸º Trainable</strong>ã€‚è¿™æ ·åœ¨ training è¿‡ç¨‹ä¸­ä¸æ–­åœ°å¯¹ Embeddings è¿›è¡Œæ”¹è¿›ã€‚</li>
</ol>
<p>transformeré€‰æ‹©åè€…ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><figcaption><span>word_embedding</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Embeddings</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, vocab)</span>:</span></span><br><span class="line">        super(Embeddings, self).__init__()</span><br><span class="line">        self.lut = nn.Embedding(vocab, d_model) <span class="comment"># vocab è¯æ±‡è¡¨å¤§å°</span></span><br><span class="line">        self.d_model = d_model  <span class="comment">#è¡¨ç¤ºembeddingçš„ç»´åº¦</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.lut(x) * math.sqrt(self.d_model)</span><br></pre></td></tr></table></figure>
<h3 id="Positional-Embedding"><a href="#Positional-Embedding" class="headerlink" title="Positional Embedding"></a>Positional Embedding</h3><p>åœ¨RNNä¸­ï¼Œå¯¹å¥å­çš„å¤„ç†æ˜¯ä¸€ä¸ªä¸ªwordæŒ‰é¡ºåºè¾“å…¥çš„ã€‚ä½†åœ¨ Transformer ä¸­ï¼Œè¾“å…¥å¥å­çš„æ‰€æœ‰wordæ˜¯åŒæ—¶å¤„ç†çš„ï¼Œæ²¡æœ‰è€ƒè™‘è¯çš„æ’åºå’Œä½ç½®ä¿¡æ¯ã€‚å› æ­¤ï¼ŒTransformer çš„ä½œè€…æå‡ºäº†åŠ å…¥ <code>positional encoding</code>çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<code>positional encoding</code>ä½¿å¾— Transformer å¯ä»¥è¡¡é‡ word ä½ç½®æœ‰å…³çš„ä¿¡æ¯ã€‚</p>
<p><strong>å¦‚ä½•å®ç°å…·æœ‰ä½ç½®ä¿¡æ¯çš„encodingï¼Ÿ</strong></p>
<p>ä½œè€…æä¾›äº†ä¸¤ç§æ€è·¯ï¼š</p>
<ul>
<li>é€šè¿‡è®­ç»ƒå­¦ä¹  positional encoding å‘é‡ï¼›</li>
<li>ä½¿ç”¨å…¬å¼æ¥è®¡ç®— positional encodingå‘é‡ã€‚</li>
</ul>
<p>è¯•éªŒåå‘ç°ä¸¤ç§é€‰æ‹©çš„ç»“æœæ˜¯ç›¸ä¼¼çš„ï¼Œæ‰€ä»¥é‡‡ç”¨äº†ç¬¬2ç§æ–¹æ³•ï¼Œä¼˜ç‚¹æ˜¯ä¸éœ€è¦è®­ç»ƒå‚æ•°ï¼Œè€Œä¸”å³ä½¿<strong>åœ¨è®­ç»ƒé›†ä¸­æ²¡æœ‰å‡ºç°è¿‡çš„å¥å­é•¿åº¦ä¸Šä¹Ÿèƒ½ç”¨</strong>ã€‚Positional Encodingçš„å…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
P E_{(p o s, 2 i)} &=\sin \left(p o s / 10000^{2 i / d_{\text {model }}}\right) \\
P E_{(p o s, 2 i+1)} &=\cos \left(p o s / 10000^{2 i / d_{\text {model }}}\right.
\end{aligned}</script><p>å…¶ä¸­ï¼Œ$pos$æŒ‡çš„æ˜¯è¿™ä¸ª word åœ¨è¿™ä¸ªå¥å­ä¸­çš„ä½ç½®ï¼›$2i$æŒ‡çš„æ˜¯ embedding è¯å‘é‡çš„å¶æ•°ç»´åº¦ï¼Œ$2i+1$æŒ‡çš„æ˜¯embedding è¯å‘é‡çš„å¥‡æ•°ç»´åº¦ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><figcaption><span>PositionalEncoding</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PositionalEncoding</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Implement the PE function."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, dropout, max_len=<span class="number">5000</span>)</span>:</span></span><br><span class="line">        super(PositionalEncoding, self).__init__()</span><br><span class="line">        self.dropout = nn.Dropout(p=dropout)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Compute the positional encodings once in log space.</span></span><br><span class="line">        pe = torch.zeros(max_len, d_model)</span><br><span class="line">        position = torch.arange(<span class="number">0</span>, max_len).unsqueeze(<span class="number">1</span>) <span class="comment"># [max_len, 1]</span></span><br><span class="line">        div_term = torch.exp(torch.arange(<span class="number">0</span>, d_model, <span class="number">2</span>) * -(math.log(<span class="number">10000.0</span>) / d_model)) <span class="comment"># ?</span></span><br><span class="line">        pe[:, <span class="number">0</span>::<span class="number">2</span>] = torch.sin(position * div_term) <span class="comment"># å¶æ•°åˆ—</span></span><br><span class="line">        pe[:, <span class="number">1</span>::<span class="number">2</span>] = torch.cos(position * div_term) <span class="comment"># å¥‡æ•°åˆ—</span></span><br><span class="line">        pe = pe.unsqueeze(<span class="number">0</span>)         <span class="comment"># [1, max_len, d_model]</span></span><br><span class="line">        self.register_buffer(<span class="string">'pe'</span>, pe) <span class="comment"># ä¸Šè¿°ä»£ç åªéœ€è®¡ç®—ä¸€æ¬¡ï¼Œç„¶åæ”¾åˆ°å¯„å­˜å™¨é‡Œï¼Œéšç”¨éšå–ã€‚</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x = x + Variable(self.pe[:, :x.size(<span class="number">1</span>)], </span><br><span class="line">                         requires_grad=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> self.dropout(x) <span class="comment"># æ®è¯´dropout=0.1</span></span><br></pre></td></tr></table></figure>
<p><code>x = x + Variable(self.pe[:, :x.size(1)], requires_grad=False)</code> è¿™è¡Œä»£ç è¡¨ç¤ºï¼›è¾“å…¥æ¨¡å‹çš„æ•´ä¸ªEmbeddingæ˜¯Word Embeddingä¸Positional Embeddingç›´æ¥ç›¸åŠ ä¹‹åçš„ç»“æœã€‚</p>
<p>ä¸ºä»€ä¹ˆä¸Šé¢çš„ä¸¤ä¸ªå…¬å¼èƒ½ä½“ç°å•è¯çš„ç›¸å¯¹ä½ç½®ä¿¡æ¯å‘¢ï¼Ÿ</p>
<p>ä¸‹é¢ä¸€æ®µä»£ç å–è¯å‘é‡çš„4ä¸ªç»´åº¦ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ä½ç½®ç¼–ç ä¸‹æ–¹ï¼Œå°†åŸºäºä½ç½®æ·»åŠ æ­£å¼¦æ³¢ã€‚å¯¹äºæ¯ä¸ªç»´åº¦ï¼Œæ³¢çš„é¢‘ç‡å’Œåç§»éƒ½ä¸åŒã€‚</span></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>, <span class="number">5</span>))</span><br><span class="line">pe = PositionalEncoding(<span class="number">20</span>, <span class="number">0</span>)</span><br><span class="line">y = pe.forward(Variable(torch.zeros(<span class="number">1</span>, <span class="number">100</span>, <span class="number">20</span>))) <span class="comment"># [bs=1,seq_len=100,embed_size=20]</span></span><br><span class="line">plt.plot(np.arange(<span class="number">100</span>), y[<span class="number">0</span>, :, <span class="number">4</span>:<span class="number">8</span>].data.numpy())</span><br><span class="line">plt.legend([<span class="string">"dim %d"</span> %p <span class="keyword">for</span> p <span class="keyword">in</span> [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]])</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/09/transformer/position_embedding.png" alt></p>
<p>å¯ä»¥çœ‹åˆ°æŸä¸ªåºåˆ—ä¸­ä¸åŒä½ç½®çš„å•è¯ï¼Œåœ¨æŸä¸€ç»´åº¦ä¸Šçš„ä½ç½®ç¼–ç æ•°å€¼ä¸ä¸€æ ·ï¼Œå³åŒä¸€åºåˆ—çš„ä¸åŒå•è¯åœ¨å•ä¸ªçº¬åº¦ç¬¦åˆæŸä¸ªæ­£å¼¦æˆ–è€…ä½™å¼¦ï¼Œå¯è®¤ä¸ºä»–ä»¬çš„å…·æœ‰ç›¸å¯¹å…³ç³»ã€‚</p>
<h2 id="Encoder"><a href="#Encoder" class="headerlink" title="Encoder"></a>Encoder</h2><p>Encoderéƒ¨åˆ†æ˜¯ç”±ä¸ªå±‚ç›¸åŒå°Encoder Layerä¸²è”è€Œæˆã€‚å°Encoder Layerå¯ä»¥ç®€åŒ–ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>Multi-Head Self Attention</li>
<li>Feed-Forward Network</li>
</ol>
<p><code>Multi-Head Self Attention</code> å’Œ<code>Feed-Forward Network</code>ä¹‹åéƒ½æ¥äº†ä¸€å±‚<code>Add</code> å’Œ<code>Norm</code></p>
<p>ç¤ºæ„å›¾å¦‚ä¸‹:</p>
<p><img src="/2020/05/09/transformer/encoder_layer.png" alt></p>
<h3 id="Muti-Head-Attention"><a href="#Muti-Head-Attention" class="headerlink" title="Muti-Head-Attention"></a>Muti-Head-Attention</h3><p>Multi-Head Self Attention å®é™…ä¸Šæ˜¯<strong>ç”±hä¸ªSelf Attention å±‚å¹¶è¡Œç»„æˆï¼ŒåŸæ–‡ä¸­h=8</strong>ã€‚</p>
<h4 id="Self-Attention"><a href="#Self-Attention" class="headerlink" title="Self-Attention"></a>Self-Attention</h4><p>self-attentionçš„è¾“å…¥æ˜¯åºåˆ—è¯å‘é‡<code>x</code>ã€‚<code>x</code>ç»è¿‡ä¸€ä¸ªçº¿æ€§å˜æ¢å¾—åˆ°<code>query(Q)</code>, <code>x</code>ç»è¿‡ç¬¬äºŒä¸ªçº¿æ€§å˜æ¢å¾—åˆ°<code>key(K)</code>,<code>x</code>ç»è¿‡ç¬¬ä¸‰ä¸ªçº¿æ€§å˜æ¢å¾—åˆ°<code>value(V)</code>ã€‚ä¹Ÿå°±æ˜¯ï¼š</p>
<ul>
<li>Q = linear_q(x)</li>
<li>K = linear_k(x)</li>
<li>V = linear_v(x)</li>
</ul>
<p>å³ï¼š</p>
<p><img src="/2020/05/09/transformer/qkv.png" alt></p>
<p>linear_k, linear_q, linear_væ˜¯ç›¸äº’ç‹¬ç«‹ã€æƒé‡$ğ‘Š^ğ‘„,ğ‘Š^ğ¾,W^V$)æ˜¯ä¸åŒçš„ï¼Œé€šè¿‡è®­ç»ƒå¯å¾—åˆ°ã€‚å¾—åˆ°query(Q)ï¼Œkey(K)ï¼Œvalue(V)ä¹‹åæŒ‰ç…§ä¸‹é¢çš„å…¬å¼è®¡ç®—attention(Q, K, V)ï¼š</p>
<script type="math/tex; mode=display">
\text {Attention}(Q, K, V)=\text {Softmax}\left(\frac{Q K^{T}}{\sqrt{d_{k}}}\right) V</script><p><img src="/2020/05/09/transformer/attention.png" alt></p>
<p>è¿™é‡Œ<code>Z</code>å°±æ˜¯<code>attention(Q, K, V)</code>ï¼Œ$ğ‘‘_ğ‘˜=\frac{ğ‘‘_{ğ‘šğ‘œğ‘‘ğ‘’ğ‘™}}{â„}=\frac{512}{8}=64$ã€‚</p>
<ol>
<li><p>ä¸ºä»€ä¹ˆè¦ç”¨$\sqrt{d_k}$ å¯¹ $ğ‘„ğ¾^ğ‘‡$è¿›è¡Œç¼©æ”¾å‘¢ï¼Ÿ</p>
<p>$d_k$å®é™…ä¸Šæ˜¯<code>Q/K/V</code>çš„æœ€åä¸€ä¸ªç»´åº¦ï¼Œå½“$d_k$è¶Šå¤§ï¼Œ$QK^T$å°±è¶Šå¤§ï¼Œå¯èƒ½ä¼šå°†softmaxå‡½æ•°æ¨å…¥æ¢¯åº¦æå°çš„åŒºåŸŸã€‚</p>
</li>
<li><p>softmaxä¹‹åå€¼éƒ½ä»‹äº0åˆ°1ä¹‹é—´ï¼Œå¯ä»¥ç†è§£æˆå¾—åˆ°äº† attention weightsã€‚ç„¶ååŸºäºè¿™ä¸ª attention weights å¯¹ V æ±‚ weighted sum å€¼ Attention(Q, K, V)ã€‚ </p>
</li>
</ol>
<p>Multi-Head-Attention å°±æ˜¯å°†<code>embedding</code>ä¹‹åçš„XæŒ‰ç»´åº¦$ğ‘‘_{ğ‘šğ‘œğ‘‘ğ‘’ğ‘™}=512$ åˆ‡å‰²æˆ$â„=8$ä¸ªï¼Œåˆ†åˆ«åšself-attentionä¹‹åå†åˆå¹¶åœ¨ä¸€èµ·ã€‚</p>
<p><img src="/2020/05/09/transformer/attention_1.png" alt></p>
<figure class="highlight python"><figcaption><span>Attention</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attention</span><span class="params">(query, key, value, mask=None, dropout=None)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Compute 'Scaled Dot Product Attention</span></span><br><span class="line"><span class="string">    qkv :[batch, h, seq_len, embed_size/h(d_k)]</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    d_k = query.size(<span class="number">-1</span>)</span><br><span class="line">    scores = torch.matmul(query, key.transpose(<span class="number">-2</span>, <span class="number">-1</span>)) / math.sqrt(d_k)</span><br><span class="line">    <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        scores = scores.masked_fill(mask == <span class="number">0</span>, <span class="number">-1e9</span>)  <span class="comment"># mask </span></span><br><span class="line">    p_attn = F.softmax(scores, dim = <span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">if</span> dropout <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        p_attn = dropout(p_attn)     <span class="comment"># dropout=0.1</span></span><br><span class="line">    <span class="keyword">return</span> torch.matmul(p_attn, value), p_attn</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/09/transformer/multi_head.png" alt></p>
<figure class="highlight python"><figcaption><span>MultiHeadedAttention</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MultiHeadedAttention</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, h, d_model, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">        <span class="string">"Take in model size and number of heads."</span></span><br><span class="line">        super(MultiHeadedAttention, self).__init__()</span><br><span class="line">        <span class="keyword">assert</span> d_model % h == <span class="number">0</span></span><br><span class="line">        <span class="comment"># We assume d_v always equals d_k</span></span><br><span class="line">        self.d_k = d_model // h</span><br><span class="line">        self.h = h</span><br><span class="line">        self.linears = clones(nn.Linear(d_model, d_model), <span class="number">4</span>)</span><br><span class="line">        self.attn = <span class="literal">None</span></span><br><span class="line">        self.dropout = nn.Dropout(p=dropout)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, query, key, value, mask=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å®ç°MultiHeadedAttentionã€‚</span></span><br><span class="line"><span class="string">           è¾“å…¥çš„qï¼Œkï¼Œvæ˜¯å½¢çŠ¶ [batch, seq_len, embed_size(d_model)]ã€‚</span></span><br><span class="line"><span class="string">           è¾“å‡ºçš„x çš„å½¢çŠ¶åŒä¸Šã€‚</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># Same mask applied to all h heads.</span></span><br><span class="line">            mask = mask.unsqueeze(<span class="number">1</span>)</span><br><span class="line">        nbatches = query.size(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1) Do all the linear projections in batch from d_model =&gt; h x d_k </span></span><br><span class="line">        <span class="comment">#    [batch, seq_len, embed_size] -&gt;[batch, h, seq_len, embed_size/h]</span></span><br><span class="line">        query, key, value = [l(x).view(nbatches, <span class="number">-1</span>, self.h, self.d_k).transpose(<span class="number">1</span>, <span class="number">2</span>) <span class="keyword">for</span> l, x <span class="keyword">in</span> zip(self.linears, (query, key, value))]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2) Apply attention on all the projected vectors in batch.</span></span><br><span class="line">        <span class="comment">#    è®¡ç®—æ³¨æ„åŠ›attn å¾—åˆ°attn*v ä¸attn </span></span><br><span class="line">        <span class="comment">#    qkv :[batch, h, seq_len, embed_size/h] --&gt;</span></span><br><span class="line">        <span class="comment">#              x:[batch, h, seq_len, embed_size/h], attn[batch, h, seq_len, seq_len]</span></span><br><span class="line">        x, self.attn = attention(query, key, value, mask=mask, dropout=self.dropout)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3) "Concat" using a view and apply a final linear.</span></span><br><span class="line">        <span class="comment">#     ä¸Šä¸€æ­¥çš„ç»“æœåˆå¹¶åœ¨ä¸€èµ·è¿˜åŸæˆåŸå§‹è¾“å…¥åºåˆ—çš„å½¢çŠ¶</span></span><br><span class="line">        x = x.transpose(<span class="number">1</span>, <span class="number">2</span>).contiguous().view(nbatches, <span class="number">-1</span>, self.h * self.d_k)</span><br><span class="line">        <span class="keyword">return</span> self.linears[<span class="number">-1</span>](x)  <span class="comment"># æœ€åå†è¿‡ä¸€ä¸ªçº¿æ€§å±‚</span></span><br></pre></td></tr></table></figure>
<h4 id="Self-Attentionçš„ä¼˜ç‚¹"><a href="#Self-Attentionçš„ä¼˜ç‚¹" class="headerlink" title="Self-Attentionçš„ä¼˜ç‚¹"></a>Self-Attentionçš„ä¼˜ç‚¹</h4><ol>
<li>å› ä¸ºæ¯ä¸ªè¯éƒ½å’Œå‘¨å›´æ‰€æœ‰è¯åšattentionï¼Œæ‰€ä»¥ä»»æ„ä¸¤ä¸ªä½ç½®éƒ½ç›¸å½“äºæœ‰ç›´è¿çº¿è·¯ï¼Œå¯æ•è·é•¿è·ç¦»ä¾èµ–ã€‚</li>
<li>Attentionçš„å¯è§£é‡Šæ€§æ›´å¥½ï¼Œæ ¹æ®Attention scoreå¯ä»¥çŸ¥é“ä¸€ä¸ªè¯å’Œå“ªäº›è¯çš„å…³ç³»æ¯”è¾ƒå¤§ã€‚</li>
<li>æ˜“äºå¹¶è¡ŒåŒ–ï¼Œå½“å‰å±‚çš„Attentionè®¡ç®—åªå’Œå‰ä¸€å±‚çš„å€¼æœ‰å…³ï¼Œæ‰€ä»¥ä¸€å±‚çš„æ‰€æœ‰èŠ‚ç‚¹å¯å¹¶è¡Œæ‰§è¡Œself-attentionæ“ä½œã€‚è®¡ç®—æ•ˆç‡é«˜ï¼Œä¸€æ¬¡Self-Attentionåªéœ€è¦ä¸¤æ¬¡çŸ©é˜µè¿ç®—ï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚</li>
</ol>
<h3 id="Add-amp-Norm"><a href="#Add-amp-Norm" class="headerlink" title="Add &amp; Norm"></a>Add &amp; Norm</h3><p><code>x</code> åºåˆ—ç»è¿‡<code>Multi-Head-Self-Attention</code> ä¹‹åå®é™…ç»è¿‡ä¸€ä¸ª<code>Add+Norm</code>å±‚ï¼Œå†è¿›å…¥<code>feed-forward network(FFN)</code>ï¼Œåœ¨<code>FFN</code>ä¹‹ååˆç»è¿‡ä¸€ä¸ª<code>norm</code>å†è¾“å…¥ä¸‹ä¸€ä¸ªencoder layerã€‚å‡ ä¹æ¯ä¸ªsub layerä¹‹åéƒ½ä¼šç»è¿‡ä¸€ä¸ªå½’ä¸€åŒ–ï¼Œç„¶åå†åŠ åœ¨åŸæ¥çš„è¾“å…¥ä¸Šã€‚</p>
<figure class="highlight python"><figcaption><span>Norm</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LayerNorm</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Construct a layernorm module (See citation for details)."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, features, eps=<span class="number">1e-6</span>)</span>:</span></span><br><span class="line">        super(LayerNorm, self).__init__()</span><br><span class="line">        self.a_2 = nn.Parameter(torch.ones(features)) <span class="comment"># ?</span></span><br><span class="line">        self.b_2 = nn.Parameter(torch.zeros(features)) <span class="comment"># ?</span></span><br><span class="line">        self.eps = eps</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        mean = x.mean(<span class="number">-1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        std = x.std(<span class="number">-1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> self.a_2 * (x - mean) / (std + self.eps) + self.b_2</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><figcaption><span>Add</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SublayerConnection</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A residual connection followed by a layer norm.</span></span><br><span class="line"><span class="string">    Note for code simplicity the norm is first as opposed to last.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size, dropout)</span>:</span></span><br><span class="line">        super(SublayerConnection, self).__init__()</span><br><span class="line">        self.norm = LayerNorm(size)</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, sublayer)</span>:</span></span><br><span class="line">        <span class="string">"Apply residual connection to any sublayer with the same size."</span></span><br><span class="line">        <span class="comment"># sublayer &lt;-- encoder layer</span></span><br><span class="line">        <span class="keyword">return</span> x + self.dropout(sublayer(self.norm(x)))</span><br></pre></td></tr></table></figure>
<h3 id="Feed-Forward-Network"><a href="#Feed-Forward-Network" class="headerlink" title="Feed-Forward Network"></a>Feed-Forward Network</h3><p>Feed-Forward Networkå¯ä»¥ç»†åˆ†ä¸ºæœ‰ä¸¤å±‚ï¼Œç¬¬ä¸€å±‚æ˜¯ä¸€ä¸ªçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œç¬¬äºŒå±‚æ˜¯æ¿€æ´»å‡½æ•°æ˜¯ReLUã€‚å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<script type="math/tex; mode=display">
F F N=\max \left(0, x W_{1}+b_{1}\right) W_{2}+b_{2}</script><figure class="highlight python"><figcaption><span>PositionwiseFeedForward</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PositionwiseFeedForward</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"""Implements FFN equation.</span></span><br><span class="line"><span class="string">    positionwiseä½“ç°åœ¨å“ªé‡Œï¼Ÿï¼Ÿ</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, d_ff, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">      <span class="string">"""</span></span><br><span class="line"><span class="string">      d_model: embedding_size</span></span><br><span class="line"><span class="string">      d_ff: çº¿å½¢å±‚è¾“å‡ºç»´åº¦</span></span><br><span class="line"><span class="string">      """</span></span><br><span class="line">        super(PositionwiseFeedForward, self).__init__()</span><br><span class="line">        self.w_1 = nn.Linear(d_model, d_ff)</span><br><span class="line">        self.w_2 = nn.Linear(d_ff, d_model)</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.w_2(self.dropout(F.relu(self.w_1(x))))</span><br></pre></td></tr></table></figure>
<h3 id="ç»„åˆå‡ºEncoder"><a href="#ç»„åˆå‡ºEncoder" class="headerlink" title="ç»„åˆå‡ºEncoder"></a>ç»„åˆå‡ºEncoder</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clones</span><span class="params">(module, N)</span>:</span></span><br><span class="line">    <span class="string">"Produce N identical layers."</span></span><br><span class="line">    <span class="keyword">return</span> nn.ModuleList([copy.deepcopy(module) <span class="keyword">for</span> _ <span class="keyword">in</span> range(N)])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Encoder</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Core encoder is a stack of N layers"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, layer, N)</span>:</span></span><br><span class="line">        super(Encoder, self).__init__()</span><br><span class="line">        self.layers = clones(layer, N)  <span class="comment"># sub layer</span></span><br><span class="line">        self.norm = LayerNorm(layer.size)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, mask)</span>:</span></span><br><span class="line">        <span class="string">"Pass the input (and mask) through each layer in turn."</span></span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.layers:</span><br><span class="line">            x = layer(x, mask)</span><br><span class="line">        <span class="keyword">return</span> self.norm(x)</span><br></pre></td></tr></table></figure>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>æ€»çš„æ¥è¯´Encoder æ˜¯ç”±ä¸Šè¿°å°encoder layer 6ä¸ªä¸²è¡Œå åŠ ç»„æˆã€‚encoder sub layerä¸»è¦åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>SubLayer-1 åš Multi-Headed Attention</li>
<li>SubLayer-2 åš Feed Forward Neural Network</li>
</ul>
<h2 id="Decoder"><a href="#Decoder" class="headerlink" title="Decoder"></a>Decoder</h2><p>Decoderä¸Encoderæœ‰æ‰€ä¸åŒï¼ŒEncoderä¸Decoderçš„å…³ç³»å¯ä»¥ç”¨ä¸‹å›¾æè¿°ï¼š</p>
<p><img src="/2020/05/09/transformer/decoder.png" alt></p>
<figure class="highlight python"><figcaption><span>Decoder</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Decoder</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Generic N layer decoder with masking."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, layer, N)</span>:</span></span><br><span class="line">        super(Decoder, self).__init__()</span><br><span class="line">        self.layers = clones(layer, N)</span><br><span class="line">        self.norm = LayerNorm(layer.size)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, memory, src_mask, tgt_mask)</span>:</span> </span><br><span class="line">      	<span class="comment"># memory Encoderæœ€åçš„è¾“å‡ºã€‚ </span></span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.layers:</span><br><span class="line">            x = layer(x, memory, src_mask, tgt_mask)</span><br><span class="line">        <span class="keyword">return</span> self.norm(x)</span><br></pre></td></tr></table></figure>
<p>Decoder å­ç»“æ„ï¼ˆsub layerï¼‰ï¼š</p>
<p><img src="/2020/05/09/transformer/decoder_layer.png" alt></p>
<p>Decoder ä¹Ÿæ˜¯N=6å±‚å †å çš„ç»“æ„ã€‚è¢«åˆ†ä¸º3ä¸ª SubLayerï¼ŒEncoderä¸Decoderæœ‰ä¸‰å¤§ä¸»è¦çš„ä¸åŒï¼š</p>
<ol>
<li>Decoder SubLayer-1 ä½¿ç”¨çš„æ˜¯ â€œMaskedâ€ Multi-Headed Attention æœºåˆ¶ï¼Œé˜²æ­¢ä¸ºäº†æ¨¡å‹çœ‹åˆ°è¦é¢„æµ‹çš„æ•°æ®ï¼Œé˜²æ­¢æ³„éœ²ã€‚</li>
<li>SubLayer-2 æ˜¯ä¸€ä¸ª Encoder-Decoder Multi-head Attentionã€‚</li>
<li>LinearLayer å’Œ SoftmaxLayer ä½œç”¨äº SubLayer-3 çš„è¾“å‡ºåé¢ï¼Œæ¥é¢„æµ‹å¯¹åº”çš„ word çš„ probabilities ã€‚</li>
</ol>
<h3 id="Mask-Multi-Head-Attention"><a href="#Mask-Multi-Head-Attention" class="headerlink" title="Mask-Multi-Head-Attention"></a>Mask-Multi-Head-Attention</h3><p>Mask çš„ç›®çš„æ˜¯é˜²æ­¢ Decoder â€œseeing the futureâ€ï¼Œé˜²æ­¢æå‰çŸ¥é“é¢„æµ‹çš„å†…å®¹ï¼ˆensures that the predictions for position $i$ can depend only on the known outputs at positions less than $i$.ï¼‰,è¿™ä¹Ÿè¯´æ˜Transformeråªæ˜¯åœ¨Encoderé˜¶æ®µå¯ä»¥å¹¶è¡ŒåŒ–ï¼ŒDecoderé˜¶æ®µä¾ç„¶è¦ä¸€ä¸ªä¸ªè¯é¡ºåºç¿»è¯‘ï¼Œä¾ç„¶æ˜¯<strong>ä¸²è¡Œ</strong>çš„ã€‚è¿™é‡Œmaskæ˜¯ä¸€ä¸ªä¸‹ä¸‰è§’çŸ©é˜µï¼Œå¯¹è§’çº¿ä»¥åŠå¯¹è§’çº¿å·¦ä¸‹éƒ½æ˜¯1ï¼Œå…¶ä½™éƒ½æ˜¯0ã€‚</p>
<figure class="highlight python"><figcaption><span>subsequent_mask</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">subsequent_mask</span><span class="params">(size)</span>:</span></span><br><span class="line">    <span class="string">""""Mask out subsequent positions.</span></span><br><span class="line"><span class="string">    maskåç»­çš„ä½ç½®ï¼Œè¿”å›[size, size]å°ºå¯¸ä¸‹ä¸‰è§’Tensor</span></span><br><span class="line"><span class="string">    å¯¹è§’çº¿åŠå…¶å·¦ä¸‹è§’å…¨æ˜¯1ï¼Œå³ä¸Šè§’å…¨æ˜¯0</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    attn_shape = (<span class="number">1</span>, size, size)</span><br><span class="line">    <span class="comment"># np.triu()  Upper triangle of an array: è¿”å›çŸ©é˜µä¸Šä¸‰è§’</span></span><br><span class="line">    subsequent_mask = np.triu(np.ones(attn_shape), k=<span class="number">1</span>).astype(<span class="string">'uint8'</span>)</span><br><span class="line">    <span class="keyword">return</span> torch.from_numpy(subsequent_mask) == <span class="number">0</span> <span class="comment"># ç­‰äº0ï¼Œè¿”å›çš„æ˜¯çŸ©é˜µçš„ä¸‹ä¸‰è§’</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">5</span>,<span class="number">5</span>))</span><br><span class="line">plt.imshow(subsequent_mask(<span class="number">20</span>)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="/2020/05/09/transformer/subsequent_mask.png" alt></p>
<p>subsequent_mask è¿”å›ç»“æœï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tensor([[[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]]], dtype=torch.uint8)</span><br></pre></td></tr></table></figure>
<p>å½“maskä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œattentionè®¡ç®—éœ€è¦å°†xåšä¸€ä¸ªæ“ä½œï¼šscores = scores.masked_fill(mask == 0, -1e9)ã€‚å³å°†mask==0çš„æ›¿æ¢ä¸º-1e9,å…¶ä½™ä¸å˜ã€‚</p>
<h3 id="Encoder-Decoder-Multi-head-Attention"><a href="#Encoder-Decoder-Multi-head-Attention" class="headerlink" title="Encoder-Decoder Multi-head Attention"></a>Encoder-Decoder Multi-head Attention</h3><p>è¿™éƒ¨åˆ†å’ŒMulti-head Attentionçš„åŒºåˆ«æ˜¯è¯¥å±‚çš„è¾“å…¥æ¥è‡ªencoderå’Œä¸Šä¸€æ¬¡decoderçš„ç»“æœã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecoderLayer</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Decoder is made of self-attn, src-attn, and feed forward (defined below)"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size, self_attn, src_attn, feed_forward, dropout)</span>:</span></span><br><span class="line">        super(DecoderLayer, self).__init__()</span><br><span class="line">        self.size = size</span><br><span class="line">        self.self_attn = self_attn</span><br><span class="line">        self.src_attn = src_attn</span><br><span class="line">        self.feed_forward = feed_forward</span><br><span class="line">        self.sublayer = clones(SublayerConnection(size, dropout), <span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, memory, src_mask, tgt_mask)</span>:</span></span><br><span class="line">        <span class="string">"Follow Figure 1 (right) for connections."</span></span><br><span class="line">      	<span class="comment"># å°†decoderçš„ä¸‰ä¸ªSublayerä¸²è”èµ·æ¥</span></span><br><span class="line">        m = memory <span class="comment"># ä¸ºencoder æœ€åçš„è¾“å‡º</span></span><br><span class="line">        x = self.sublayer[<span class="number">0</span>](x, <span class="keyword">lambda</span> x: self.self_attn(x, x, x, tgt_mask))</span><br><span class="line">        x = self.sublayer[<span class="number">1</span>](x, <span class="keyword">lambda</span> x: self.src_attn(x, m, m, src_mask))</span><br><span class="line">        <span class="keyword">return</span> self.sublayer[<span class="number">2</span>](x, self.feed_forward)</span><br></pre></td></tr></table></figure>
<h3 id="Linear-and-Softmax-to-Produce-Output-Probabilities"><a href="#Linear-and-Softmax-to-Produce-Output-Probabilities" class="headerlink" title="Linear and Softmax to Produce Output Probabilities"></a>Linear and Softmax to Produce Output Probabilities</h3><p>Decoderçš„æœ€åä¸€ä¸ªéƒ¨åˆ†æ˜¯è¿‡ä¸€ä¸ªlinear layerå°†decoderçš„è¾“å‡ºæ‰©å±•åˆ°ä¸vocabulary sizeä¸€æ ·çš„ç»´åº¦ä¸Šã€‚ç»è¿‡softmax åï¼Œé€‰æ‹©æ¦‚ç‡æœ€é«˜çš„ä¸€ä¸ªwordä½œä¸ºé¢„æµ‹ç»“æœã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå·²ç»è®­ç»ƒå¥½çš„ç½‘ç»œï¼Œåœ¨åšé¢„æµ‹æ—¶ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç»™ decoder è¾“å…¥ encoder å¯¹æ•´ä¸ªå¥å­ embedding çš„ç»“æœå’Œä¸€ä¸ªç‰¹æ®Šçš„å¼€å§‹ç¬¦å· &lt;/s&gt;ã€‚decoder å°†äº§ç”Ÿé¢„æµ‹ï¼Œåœ¨ä¾‹å­ä¸­åº”è¯¥æ˜¯ <code>I</code>ã€‚</li>
<li>ç»™ decoder è¾“å…¥ encoder çš„ embedding ç»“æœå’Œ â€œ&lt;/s&gt; Iâ€ï¼Œåœ¨è¿™ä¸€æ­¥ decoder åº”è¯¥äº§ç”Ÿé¢„æµ‹ <code>am</code>ã€‚</li>
<li>ç»™ decoder è¾“å…¥ encoder çš„ embedding ç»“æœå’Œ â€œ&lt;/s&gt; I amâ€ï¼Œåœ¨è¿™ä¸€æ­¥ decoder åº”è¯¥äº§ç”Ÿé¢„æµ‹ <code>a</code>ã€‚</li>
<li>ç»™ decoder è¾“å…¥ encoder çš„ embedding ç»“æœå’Œ â€œ&lt;/s&gt; I am aâ€ï¼Œåœ¨è¿™ä¸€æ­¥ decoder åº”è¯¥äº§ç”Ÿé¢„æµ‹ <code>student</code>ã€‚</li>
<li>ç»™ decoder è¾“å…¥ encoder çš„ embedding ç»“æœå’Œ â€œ&lt;/s&gt;I am a studentâ€, decoderåº”è¯¥ç”Ÿæˆå¥å­ç»“å°¾çš„æ ‡è®°ï¼Œdecoder åº”è¯¥è¾“å‡º <code>&lt;/eos&gt;</code>ã€‚</li>
<li>ç„¶å decoder ç”Ÿæˆäº† &lt;/eos&gt;ï¼Œç¿»è¯‘å®Œæˆã€‚</li>
</ol>
<p>è¿™éƒ¨åˆ†çš„ä»£ç å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Generator</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Define standard linear + softmax generation step."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, vocab)</span>:</span></span><br><span class="line">    		<span class="string">"""</span></span><br><span class="line"><span class="string">    		d_model:decoder è¾“å‡ºçš„embedding size</span></span><br><span class="line"><span class="string">    		vocabï¼šç›®æ ‡çš„è¯æ±‡è¡¨å¤§å°</span></span><br><span class="line"><span class="string">    		"""</span></span><br><span class="line">        super(Generator, self).__init__()</span><br><span class="line">        self.proj = nn.Linear(d_model, vocab)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.proj(x), dim=<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="EncoderDecoder"><a href="#EncoderDecoder" class="headerlink" title="EncoderDecoder"></a>EncoderDecoder</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EncoderDecoder</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A standard Encoder-Decoder architecture. Base for this and many </span></span><br><span class="line"><span class="string">    other models.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, encoder, decoder, src_embed, tgt_embed, generator)</span>:</span></span><br><span class="line">        super(EncoderDecoder, self).__init__()</span><br><span class="line">        self.encoder = encoder</span><br><span class="line">        self.decoder = decoder</span><br><span class="line">        self.src_embed = src_embed <span class="comment"># embedding</span></span><br><span class="line">        self.tgt_embed = tgt_embed <span class="comment"># embedding</span></span><br><span class="line">        self.generator = generator <span class="comment"># ç”¨äºç”Ÿæˆç¿»è¯‘ç›®æ ‡ï¼ˆLinear + softmax --&gt; probï¼‰</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, src, tgt, src_mask, tgt_mask)</span>:</span></span><br><span class="line">        <span class="string">"Take in and process masked src and target sequences."</span></span><br><span class="line">        <span class="keyword">return</span> self.decode(self.encode(src, src_mask), src_mask,</span><br><span class="line">                            tgt, tgt_mask)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(self, src, src_mask)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.encoder(self.src_embed(src), src_mask)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(self, memory, src_mask, tgt, tgt_mask)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.decoder(self.tgt_embed(tgt), memory, src_mask, tgt_mask)</span><br></pre></td></tr></table></figure>
<h2 id="Full-Model"><a href="#Full-Model" class="headerlink" title="Full Model"></a>Full Model</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_model</span><span class="params">(src_vocab, tgt_vocab, N=<span class="number">6</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">               d_model=<span class="number">512</span>, d_ff=<span class="number">2048</span>, h=<span class="number">8</span>, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">    <span class="string">"Helper: Construct a model from hyperparameters."</span></span><br><span class="line">    c = copy.deepcopy</span><br><span class="line">    attn = MultiHeadedAttention(h, d_model)</span><br><span class="line">    ff = PositionwiseFeedForward(d_model, d_ff, dropout) <span class="comment"># linear(relu(linear(x)))</span></span><br><span class="line">    position = PositionalEncoding(d_model, dropout)</span><br><span class="line">    model = EncoderDecoder(</span><br><span class="line">        Encoder(EncoderLayer(d_model, c(attn), c(ff), dropout), N),</span><br><span class="line">        Decoder(DecoderLayer(d_model, c(attn), c(attn), </span><br><span class="line">                             c(ff), dropout), N),</span><br><span class="line">        nn.Sequential(Embeddings(d_model, src_vocab), c(position)),</span><br><span class="line">        nn.Sequential(Embeddings(d_model, tgt_vocab), c(position)),</span><br><span class="line">        Generator(d_model, tgt_vocab))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># This was important from their code. </span></span><br><span class="line">    <span class="comment"># Initialize parameters with Glorot / fan_avg.</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> model.parameters():</span><br><span class="line">        <span class="keyword">if</span> p.dim() &gt; <span class="number">1</span>:</span><br><span class="line">            nn.init.xavier_uniform(p)</span><br><span class="line">    <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure>
<h1 id="Training"><a href="#Training" class="headerlink" title="Training"></a>Training</h1><p>è¿™éƒ¨åˆ†ä¸»è¦æ ¹æ®è‡ªå·±çš„ç†è§£å¯¹ä»£ç åŠ æ³¨é‡Š</p>
<h2 id="Batches-and-Masking"><a href="#Batches-and-Masking" class="headerlink" title="Batches and Masking"></a>Batches and Masking</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Batch</span>:</span></span><br><span class="line">    <span class="string">"Object for holding a batch of data with mask during training."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, src, trg=None, pad=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self.src = src</span><br><span class="line">        self.src_mask = (src != pad).unsqueeze(<span class="number">-2</span>) <span class="comment"># å¯¹è¶…å‡ºå¥å­é•¿åº¦éƒ¨åˆ†mask</span></span><br><span class="line">        <span class="keyword">if</span> trg <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.trg = trg[:, :<span class="number">-1</span>]</span><br><span class="line">            self.trg_y = trg[:, <span class="number">1</span>:]</span><br><span class="line">            self.trg_mask = self.make_std_mask(self.trg, pad) <span class="comment"># mask to hide padding and future words</span></span><br><span class="line">            self.ntokens = (self.trg_y != pad).data.sum()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_std_mask</span><span class="params">(tgt, pad)</span>:</span></span><br><span class="line">        <span class="string">"Create a mask to hide padding and future words."</span></span><br><span class="line">        tgt_mask = (tgt != pad).unsqueeze(<span class="number">-2</span>)</span><br><span class="line">        tgt_mask = tgt_mask &amp; Variable(</span><br><span class="line">            subsequent_mask(tgt.size(<span class="number">-1</span>)).type_as(tgt_mask.data))</span><br><span class="line">        <span class="keyword">return</span> tgt_mask</span><br></pre></td></tr></table></figure>
<h2 id="Training-Loop"><a href="#Training-Loop" class="headerlink" title="Training Loop"></a>Training Loop</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_epoch</span><span class="params">(data_iter, model, loss_compute)</span>:</span></span><br><span class="line">    <span class="string">"Standard Training and Logging Function"</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    total_tokens = <span class="number">0</span></span><br><span class="line">    total_loss = <span class="number">0</span></span><br><span class="line">    tokens = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, batch <span class="keyword">in</span> enumerate(data_iter):</span><br><span class="line">        out = model.forward(batch.src, batch.trg, </span><br><span class="line">                            batch.src_mask, batch.trg_mask)</span><br><span class="line">        loss = loss_compute(out, batch.trg_y, batch.ntokens)</span><br><span class="line">        total_loss += loss</span><br><span class="line">        total_tokens += batch.ntokens</span><br><span class="line">        tokens += batch.ntokens</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">50</span> == <span class="number">1</span>:</span><br><span class="line">            elapsed = time.time() - start</span><br><span class="line">            print(<span class="string">"Epoch Step: %d Loss: %f Tokens per Sec: %f"</span> %</span><br><span class="line">                    (i, loss / batch.ntokens, tokens / elapsed))</span><br><span class="line">            start = time.time()</span><br><span class="line">            tokens = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> total_loss / total_tokens</span><br></pre></td></tr></table></figure>
<h2 id="Training-Data"><a href="#Training-Data" class="headerlink" title="Training Data"></a>Training Data</h2><p>ä½¿ç”¨æ ‡å‡†WMT 2014è‹±è¯­-å¾·è¯­æ•°æ®é›†è¿›è¡Œäº†è®­ç»ƒï¼Œè¯¥æ•°æ®é›†åŒ…å«å¤§çº¦450ä¸‡ä¸ªå¥å­å¯¹ã€‚ ä½¿ç”¨å­—èŠ‚å¯¹çš„ç¼–ç æ–¹æ³•å¯¹å¥å­è¿›è¡Œç¼–ç ï¼Œè¯¥ç¼–ç å…·æœ‰å¤§çº¦37000ä¸ªè¯çš„å…±äº«æº-ç›®æ ‡è¯æ±‡è¡¨ã€‚ å¯¹äºè‹±è¯­-æ³•è¯­ï¼Œä½¿ç”¨äº†WMT 2014 è‹±è¯­-æ³•è¯­æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†ç”±36Mä¸ªå¥å­ç»„æˆï¼Œå¹¶å°†è¯åˆ†æˆ32000ä¸ªè¯ç‰‡(Word-piece)çš„è¯æ±‡è¡¨ã€‚å¥å­å¯¹æŒ‰ç…§è¿‘ä¼¼çš„åºåˆ—é•¿åº¦è¿›è¡Œæ‰¹å¤„ç†ã€‚æ¯ä¸ªè®­ç»ƒæ‰¹åŒ…å«ä¸€ç»„å¥å­å¯¹ï¼ŒåŒ…å«å¤§çº¦25000ä¸ªæºè¯å’Œ25000ä¸ªç›®æ ‡è¯ã€‚</p>
<p>ä½¿ç”¨torch textæ¥åˆ›å»ºbatchã€‚åœ¨torchtextçš„ä¸€ä¸ªå‡½æ•°ä¸­åˆ›å»ºbatchï¼Œç¡®ä¿å¡«å……åˆ°æœ€å¤§batchè®­ç»ƒé•¿åº¦çš„å¤§å°ä¸è¶…è¿‡é˜ˆå€¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">global</span> max_src_in_batch, max_tgt_in_batch</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">batch_size_fn</span><span class="params">(new, count, sofar)</span>:</span></span><br><span class="line">    <span class="string">"Keep augmenting batch and calculate total number of tokens + padding."</span></span><br><span class="line">    <span class="keyword">global</span> max_src_in_batch, max_tgt_in_batch</span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>: <span class="comment"># ï¼Ÿï¼Ÿ</span></span><br><span class="line">        max_src_in_batch = <span class="number">0</span></span><br><span class="line">        max_tgt_in_batch = <span class="number">0</span></span><br><span class="line">    max_src_in_batch = max(max_src_in_batch,  len(new.src))</span><br><span class="line">    max_tgt_in_batch = max(max_tgt_in_batch,  len(new.trg) + <span class="number">2</span>)</span><br><span class="line">    src_elements = count * max_src_in_batch</span><br><span class="line">    tgt_elements = count * max_tgt_in_batch</span><br><span class="line">    <span class="keyword">return</span> max(src_elements, tgt_elements)</span><br></pre></td></tr></table></figure>
<h2 id="Optimizer"><a href="#Optimizer" class="headerlink" title="Optimizer"></a>Optimizer</h2><p>é€‰æ‹©Adamä½œä¸ºä¼˜åŒ–å™¨ï¼Œå…¶å‚æ•°ä¸º$\beta_1 = 0.9, \beta_2=0.98,\epsilon=10^{-9}$ã€‚æ ¹æ®$lrate = d_{model}^{- \frac{1}{2}} * min(step_num^{- \frac{1}{2}},step_num \cdot warmup_steps^{-1.5})$ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ”¹å˜äº†å­¦ä¹ ç‡ã€‚åœ¨<code>warm_up</code>ä¸­éšæ­¥æ•°çº¿æ€§åœ°å¢åŠ å­¦ä¹ é€Ÿç‡ï¼Œéšåä¸æ­¥æ•°çš„åå¹³æ–¹æ ¹æˆæ¯”ä¾‹åœ°å‡å°å®ƒã€‚é¢„çƒ­<code>warmup_steps</code>ä¸º4000ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoamOpt</span>:</span></span><br><span class="line">    <span class="string">"Optim wrapper that implements rate."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, model_size, factor, warmup, optimizer)</span>:</span></span><br><span class="line">        self.optimizer = optimizer</span><br><span class="line">        self._step = <span class="number">0</span></span><br><span class="line">        self.warmup = warmup</span><br><span class="line">        self.factor = factor</span><br><span class="line">        self.model_size = model_size</span><br><span class="line">        self._rate = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">step</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"Update parameters and rate"</span></span><br><span class="line">        self._step += <span class="number">1</span></span><br><span class="line">        rate = self.rate()</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> self.optimizer.param_groups:</span><br><span class="line">            p[<span class="string">'lr'</span>] = rate</span><br><span class="line">        self._rate = rate</span><br><span class="line">        self.optimizer.step()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rate</span><span class="params">(self, step = None)</span>:</span></span><br><span class="line">        <span class="string">"Implement `lrate` above"</span></span><br><span class="line">        <span class="keyword">if</span> step <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            step = self._step</span><br><span class="line">        <span class="comment"># å¯¹åº”ä¸Šé¢å…¬å¼</span></span><br><span class="line">        <span class="keyword">return</span> self.factor * (self.model_size ** (<span class="number">-0.5</span>) * min(step ** (<span class="number">-0.5</span>), step * self.warmup ** (<span class="number">-1.5</span>)))</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_std_opt</span><span class="params">(model)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> NoamOpt(model.src_embed[<span class="number">0</span>].d_model, <span class="number">2</span>, <span class="number">4000</span>,torch.optim.Adam(model.parameters(), lr=<span class="number">0</span>, betas=(<span class="number">0.9</span>, <span class="number">0.98</span>), eps=<span class="number">1e-9</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">opts = [NoamOpt(<span class="number">512</span>, <span class="number">1</span>, <span class="number">4000</span>, <span class="literal">None</span>), </span><br><span class="line">        NoamOpt(<span class="number">512</span>, <span class="number">1</span>, <span class="number">8000</span>, <span class="literal">None</span>),</span><br><span class="line">        NoamOpt(<span class="number">256</span>, <span class="number">1</span>, <span class="number">4000</span>, <span class="literal">None</span>)]</span><br><span class="line">plt.plot(np.arange(<span class="number">1</span>, <span class="number">20000</span>), [[opt.rate(i) <span class="keyword">for</span> opt <span class="keyword">in</span> opts] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">20000</span>)])</span><br><span class="line">plt.legend([<span class="string">"512:4000"</span>, <span class="string">"512:8000"</span>, <span class="string">"256:4000"</span>])</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/09/transformer/warm_up.png" alt="screenshot"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<ol>
<li>åœ¨embedding sizeç›¸åŒçš„æƒ…å†µä¸‹ï¼Œwarm upæ­¥æ•°è¶Šå°‘ï¼Œå‰æœŸçš„å­¦ä¹ ç‡æ›²çº¿è¶Šé™¡å³­ï¼Œå­¦çš„è¶Šå¿«ã€‚</li>
<li>åœ¨warm upæ­¥æ•°ç›¸åŒçš„æ—¶å€™ï¼Œembedding size è¶Šå°ï¼Œå‰æœŸçš„å­¦ä¹ ç‡æ›²çº¿è¶Šé™¡å³­ï¼Œå­¦çš„è¶Šå¿«ã€‚</li>
</ol>
<h2 id="Regularization"><a href="#Regularization" class="headerlink" title="Regularization"></a>Regularization</h2><h3 id="Label-Smoothing"><a href="#Label-Smoothing" class="headerlink" title="Label Smoothing"></a>Label Smoothing</h3><h4 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h4><p>åœ¨å¤šåˆ†ç±»è®­ç»ƒä»»åŠ¡ä¸­ï¼Œè¾“å…¥ç»è¿‡ç¥çº§ç½‘ç»œçš„è®¡ç®—ï¼Œä¼šå¾—åˆ°å½“å‰è¾“å…¥å¯¹åº”äºå„ä¸ªç±»åˆ«çš„ç½®ä¿¡åº¦åˆ†æ•°ï¼Œè¿™äº›åˆ†æ•°ä¼šè¢«softmaxè¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œæœ€ç»ˆå¾—åˆ°å½“å‰è¾“å…¥å±äºæ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ã€‚</p>
<script type="math/tex; mode=display">
q_{i}=\frac{\exp \left(z_{i}\right)}{\sum_{j=1}^{K} \exp \left(z_{j}\right)}</script><p>ä¹‹ååœ¨ä½¿ç”¨äº¤å‰ç†µå‡½æ•°æ¥è®¡ç®—æŸå¤±å€¼ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
&L o s s=-\sum_{i=1}^{K} p_{i} \log q_{i}\\
&p_{i}=\left\{\begin{array}{l}
1, \text { if }(i=y) \\
0, i f(i \neq y)
\end{array}\right.
\end{aligned}</script><p>å…¶ä¸­ï¼Œiè¡¨ç¤ºå¤šç±»ä¸­çš„æŸä¸€ç±»ã€‚</p>
<p>æœ€ç»ˆåœ¨è®­ç»ƒç½‘ç»œæ—¶ï¼Œæœ€å°åŒ–é¢„æµ‹æ¦‚ç‡å’Œæ ‡ç­¾çœŸå®æ¦‚ç‡çš„äº¤å‰ç†µï¼Œä»è€Œå¾—åˆ°æœ€ä¼˜çš„é¢„æµ‹æ¦‚ç‡åˆ†å¸ƒã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†è¾¾åˆ°æœ€å¥½çš„æ‹Ÿåˆæ•ˆæœï¼Œæœ€ä¼˜çš„é¢„æµ‹æ¦‚ç‡åˆ†å¸ƒä¸ºï¼š</p>
<script type="math/tex; mode=display">
Z_{i}=\left\{\begin{array}{l}
+\infty, i f(i=y) \\
0, i f(i \neq y)
\end{array}\right.</script><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç½‘ç»œä¼šé©±ä½¿è‡ªèº«å¾€æ­£ç¡®æ ‡ç­¾å’Œé”™è¯¯æ ‡ç­¾å·®å€¼å¤§çš„æ–¹å‘å­¦ä¹ ï¼Œåœ¨è®­ç»ƒæ•°æ®ä¸è¶³ä»¥è¡¨å¾æ‰€ä»¥çš„æ ·æœ¬ç‰¹å¾çš„æƒ…å†µä¸‹ï¼Œå°±<strong>ä¼šå¯¼è‡´ç½‘ç»œè¿‡æ‹Ÿåˆ</strong>ã€‚</p>
<h4 id="label-smoothingåŸç†"><a href="#label-smoothingåŸç†" class="headerlink" title="label smoothingåŸç†"></a>label smoothingåŸç†</h4><p>label smoothingçš„æå‡ºå°±æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæ˜¯ä¸€ç§æ­£åˆ™åŒ–çš„ç­–ç•¥ã€‚å…¶é€šè¿‡â€è½¯åŒ–â€ä¼ ç»Ÿçš„one-hotç±»å‹æ ‡ç­¾ï¼Œä½¿å¾—åœ¨è®¡ç®—æŸå¤±å€¼æ—¶èƒ½å¤Ÿæœ‰æ•ˆæŠ‘åˆ¶è¿‡æ‹Ÿåˆç°è±¡ã€‚label smoothingç›¸å½“äºå‡å°‘çœŸå®æ ·æœ¬æ ‡ç­¾çš„ç±»åˆ«åœ¨è®¡ç®—æŸå¤±å‡½æ•°æ—¶çš„æƒé‡ï¼Œæœ€ç»ˆèµ·åˆ°æŠ‘åˆ¶è¿‡æ‹Ÿåˆçš„æ•ˆæœã€‚</p>
<p>1.label smoothingå°†çœŸå®æ¦‚ç‡åˆ†å¸ƒä½œå¦‚ä¸‹æ”¹å˜ï¼š</p>
<script type="math/tex; mode=display">
P_{i}=\left\{\begin{array}{l}
1, i f(i=y) \\
0, i f(i \neq y)
\end{array} \Longrightarrow  P_{i}=\left\{\begin{array}{l}
(1-\varepsilon), i f(i=y) \\
\frac{\varepsilon}{K-1}, i f(i \neq y)
\end{array}\right.\right.</script><p>å…¶å®æ›´æ–°åçš„åˆ†å¸ƒå°±ç›¸å½“äºå¾€çœŸå®åˆ†å¸ƒä¸­åŠ å…¥äº†å™ªå£°ï¼Œä¸ºäº†ä¾¿äºè®¡ç®—ï¼Œè¯¥å™ªå£°æœä»ç®€å•çš„å‡åŒ€åˆ†å¸ƒã€‚</p>
<p>2.ä¸ä¹‹å¯¹åº”ï¼Œlabel smoothingå°†äº¤å‰ç†µæŸå¤±å‡½æ•°ä½œå¦‚ä¸‹æ”¹å˜ï¼š</p>
<script type="math/tex; mode=display">
L o s s=-\sum_{i=1}^{K} p_{i} \log q_{i} \Longrightarrow \operatorname{Loss}_{i}=\left\{\begin{array}{l}
(1-\varepsilon)^{*} \operatorname{Loss}, \text {if}(i=y) \\
\varepsilon^{*} \operatorname{Loss}, \text {if}(i \neq y)
\end{array}\right.</script><p>3.ä¸ä¹‹å¯¹åº”ï¼Œlabel smoothingå°†æœ€ä¼˜çš„é¢„æµ‹æ¦‚ç‡åˆ†å¸ƒä½œå¦‚ä¸‹æ”¹å˜ï¼š</p>
<script type="math/tex; mode=display">
Z_{i}=\left\{\begin{array}{l}
+\infty, i f(i=y) \\
0, i f(i \neq y)
\end{array} \Longrightarrow Z_{i}=\left\{\begin{array}{l}
\log \frac{(k-1)(1-\varepsilon)}{\varepsilon+\alpha}, i f(i=y) \\
\alpha, i f(i \neq y)
\end{array}\right.\right.</script><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LabelSmoothing</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Implement label smoothing."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size, padding_idx, smoothing=<span class="number">0.0</span>)</span>:</span></span><br><span class="line">        super(LabelSmoothing, self).__init__()</span><br><span class="line">        self.criterion = nn.KLDivLoss(size_average=<span class="literal">False</span>)</span><br><span class="line">        self.padding_idx = padding_idx</span><br><span class="line">        self.confidence = <span class="number">1.0</span> - smoothing</span><br><span class="line">        self.smoothing = smoothing</span><br><span class="line">        self.size = size</span><br><span class="line">        self.true_dist = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, target)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> x.size(<span class="number">1</span>) == self.size</span><br><span class="line">        true_dist = x.data.clone()</span><br><span class="line">        true_dist.fill_(self.smoothing / (self.size - <span class="number">2</span>)) <span class="comment"># ?</span></span><br><span class="line">        true_dist.scatter_(<span class="number">1</span>, target.data.unsqueeze(<span class="number">1</span>), self.confidence)</span><br><span class="line">        true_dist[:, self.padding_idx] = <span class="number">0</span></span><br><span class="line">        mask = torch.nonzero(target.data == self.padding_idx)</span><br><span class="line">        <span class="keyword">if</span> mask.dim() &gt; <span class="number">0</span>:</span><br><span class="line">            true_dist.index_fill_(<span class="number">0</span>, mask.squeeze(), <span class="number">0.0</span>)</span><br><span class="line">        self.true_dist = true_dist</span><br><span class="line">        <span class="keyword">return</span> self.criterion(x, Variable(true_dist, requires_grad=<span class="literal">False</span>))</span><br></pre></td></tr></table></figure>
<p>åœ¨è®­ç»ƒæœŸé—´ï¼Œé‡‡ç”¨äº†å€¼ $\epsilon_{ls}=0.1$çš„æ ‡ç­¾å¹³æ»‘ã€‚ è¿™ç§åšæ³•æé«˜äº†å›°æƒ‘åº¦ï¼Œå› ä¸ºæ¨¡å‹å˜å¾—æ›´åŠ ä¸ç¡®å®šï¼Œä½†æé«˜äº†å‡†ç¡®æ€§å’ŒBLEUåˆ†æ•°ã€‚ä½¿ç”¨KL div losså®ç°æ ‡ç­¾å¹³æ»‘ã€‚ ç›¸æ¯”ä½¿ç”¨ç‹¬çƒ­ç›®æ ‡åˆ†å¸ƒï¼Œå…¶åŒ…å«æ­£ç¡®å•è¯çš„ç½®ä¿¡åº¦å’Œæ•´ä¸ªè¯æ±‡è¡¨ä¸­åˆ†å¸ƒçš„å…¶ä½™å¹³æ»‘é¡¹ã€‚å¯ä»¥çœ‹åˆ°æ ‡ç­¾å¹³æ»‘çš„ç¤ºä¾‹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Example of label smoothing.</span></span><br><span class="line"><span class="comment"># embed_size = 5, padding_idx=0,smoothing=0.4</span></span><br><span class="line">crit = LabelSmoothing(<span class="number">5</span>, <span class="number">0</span>, <span class="number">0.4</span>)</span><br><span class="line">predict = torch.FloatTensor([[<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">0.7</span>, <span class="number">0.1</span>, <span class="number">0</span>],</span><br><span class="line">                             [<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">0.7</span>, <span class="number">0.1</span>, <span class="number">0</span>], </span><br><span class="line">                             [<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">0.7</span>, <span class="number">0.1</span>, <span class="number">0</span>]])</span><br><span class="line">v = crit(Variable(predict.log()), </span><br><span class="line">         Variable(torch.LongTensor([<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>])))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show the target distributions expected by the system.</span></span><br><span class="line">plt.imshow(crit.true_dist)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/09/transformer/label_smooth.png" alt="screenshot"></p>
<p>Emmm,ä¸Šå›¾æ²¡çœ‹æ‡‚ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">crit = LabelSmoothing(<span class="number">5</span>, <span class="number">0</span>, <span class="number">0.1</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loss</span><span class="params">(x)</span>:</span></span><br><span class="line">    d = x + <span class="number">3</span> * <span class="number">1</span></span><br><span class="line">    predict = torch.FloatTensor([[<span class="number">0</span>, x / d, <span class="number">1</span> / d, <span class="number">1</span> / d, <span class="number">1</span> / d],</span><br><span class="line">                                 ])</span><br><span class="line">    <span class="comment">#print(predict)</span></span><br><span class="line">    <span class="keyword">return</span> crit(Variable(predict.log()),</span><br><span class="line">                 Variable(torch.LongTensor([<span class="number">1</span>]))).data[<span class="number">0</span>]</span><br><span class="line">plt.plot(np.arange(<span class="number">1</span>, <span class="number">100</span>), [loss(x) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>)])</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå¯¹ç»™å®šçš„é€‰æ‹©éå¸¸æœ‰ä¿¡å¿ƒï¼Œæ ‡ç­¾å¹³æ»‘å®é™…ä¸Šä¼šå¼€å§‹æƒ©ç½šæ¨¡å‹ã€‚???æ€ä¹ˆçœ‹å‡ºæ¥çš„ï¼Ÿæˆ‘æ²¡çœ‹æ‡‚ï¼</p>
<p><img src="/2020/05/09/transformer/penate.png" alt="screenshot"></p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><h3 id="Copy-Task"><a href="#Copy-Task" class="headerlink" title="Copy Task"></a>Copy Task</h3><h4 id="Synthetic-Data"><a href="#Synthetic-Data" class="headerlink" title="Synthetic Data"></a>Synthetic Data</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data_gen</span><span class="params">(V, batch, nbatches)</span>:</span></span><br><span class="line">    <span class="string">"Generate random data for a src-tgt copy task."</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(nbatches):</span><br><span class="line">        data = torch.from_numpy(np.random.randint(<span class="number">1</span>, V, size=(batch, <span class="number">10</span>)))</span><br><span class="line">        data[:, <span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">        src = Variable(data, requires_grad=<span class="literal">False</span>)</span><br><span class="line">        tgt = Variable(data, requires_grad=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">yield</span> Batch(src, tgt, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Loss-Computation"><a href="#Loss-Computation" class="headerlink" title="Loss Computation"></a>Loss Computation</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleLossCompute</span>:</span></span><br><span class="line">    <span class="string">"A simple loss compute and train function."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, generator, criterion, opt=None)</span>:</span></span><br><span class="line">        self.generator = generator</span><br><span class="line">        self.criterion = criterion</span><br><span class="line">        self.opt = opt</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, x, y, norm)</span>:</span></span><br><span class="line">        x = self.generator(x)</span><br><span class="line">        loss = self.criterion(x.contiguous().view(<span class="number">-1</span>, x.size(<span class="number">-1</span>)), </span><br><span class="line">                              y.contiguous().view(<span class="number">-1</span>)) / norm</span><br><span class="line">        loss.backward()</span><br><span class="line">        <span class="keyword">if</span> self.opt <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.opt.step()</span><br><span class="line">            self.opt.optimizer.zero_grad()</span><br><span class="line">        <span class="keyword">return</span> loss.data[<span class="number">0</span>] * norm</span><br></pre></td></tr></table></figure>
<h4 id="Greedy-Decoding"><a href="#Greedy-Decoding" class="headerlink" title="Greedy Decoding"></a>Greedy Decoding</h4><p>è´ªå¿ƒè§£ç ã€‚ã€‚ã€‚å¤§ä½¬ä»¬çœŸä¼šèµ·åå­—ï¼ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Train the simple copy task.</span></span><br><span class="line">V = <span class="number">11</span></span><br><span class="line">criterion = LabelSmoothing(size=V, padding_idx=<span class="number">0</span>, smoothing=<span class="number">0.0</span>)</span><br><span class="line">model = make_model(V, V, N=<span class="number">2</span>)</span><br><span class="line">model_opt = NoamOpt(model.src_embed[<span class="number">0</span>].d_model, <span class="number">1</span>, <span class="number">400</span>,</span><br><span class="line">        torch.optim.Adam(model.parameters(), lr=<span class="number">0</span>, betas=(<span class="number">0.9</span>, <span class="number">0.98</span>), eps=<span class="number">1e-9</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    model.train()</span><br><span class="line">    run_epoch(data_gen(V, <span class="number">30</span>, <span class="number">20</span>), model, </span><br><span class="line">              SimpleLossCompute(model.generator, criterion, model_opt))</span><br><span class="line">    model.eval()</span><br><span class="line">    print(run_epoch(data_gen(V, <span class="number">30</span>, <span class="number">5</span>), model, </span><br><span class="line">                    SimpleLossCompute(model.generator, criterion, <span class="literal">None</span>)))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greedy_decode</span><span class="params">(model, src, src_mask, max_len, start_symbol)</span>:</span></span><br><span class="line">    memory = model.encode(src, src_mask)</span><br><span class="line">    ys = torch.ones(<span class="number">1</span>, <span class="number">1</span>).fill_(start_symbol).type_as(src.data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(max_len<span class="number">-1</span>):</span><br><span class="line">        out = model.decode(memory, src_mask, </span><br><span class="line">                           Variable(ys), </span><br><span class="line">                           Variable(subsequent_mask(ys.size(<span class="number">1</span>))</span><br><span class="line">                                    .type_as(src.data)))</span><br><span class="line">        prob = model.generator(out[:, <span class="number">-1</span>])</span><br><span class="line">        _, next_word = torch.max(prob, dim = <span class="number">1</span>)</span><br><span class="line">        next_word = next_word.data[<span class="number">0</span>]</span><br><span class="line">        ys = torch.cat([ys, </span><br><span class="line">                        torch.ones(<span class="number">1</span>, <span class="number">1</span>).type_as(src.data).fill_(next_word)], dim=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> ys</span><br><span class="line"></span><br><span class="line">model.eval()</span><br><span class="line">src = Variable(torch.LongTensor([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]]) )</span><br><span class="line">src_mask = Variable(torch.ones(<span class="number">1</span>, <span class="number">1</span>, <span class="number">10</span>) )</span><br><span class="line">print(greedy_decode(model, src, src_mask, max_len=<span class="number">10</span>, start_symbol=<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><figcaption><span>result</span></figcaption><table><tr><td class="code"><pre><span class="line">  <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span>     <span class="number">4</span>     <span class="number">5</span>     <span class="number">6</span>     <span class="number">7</span>     <span class="number">8</span>     <span class="number">9</span>    <span class="number">10</span></span><br><span class="line">[torch.LongTensor of size <span class="number">1</span>x10]</span><br></pre></td></tr></table></figure>
<p>ç¿»è¯‘çš„ä¾‹å­æ¶‰åŠGPUå¹¶è¡Œæ¯”è¾ƒå¤æ‚ï¼Œä¸åšä»‹ç»ã€‚</p>
<h1 id="Attention-Visualization"><a href="#Attention-Visualization" class="headerlink" title="Attention Visualization"></a>Attention Visualization</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tgt_sent = trans.split()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw</span><span class="params">(data, x, y, ax)</span>:</span></span><br><span class="line">    seaborn.heatmap(data, </span><br><span class="line">                    xticklabels=x, square=<span class="literal">True</span>, yticklabels=y, vmin=<span class="number">0.0</span>, vmax=<span class="number">1.0</span>, </span><br><span class="line">                    cbar=<span class="literal">False</span>, ax=ax)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>):</span><br><span class="line">    fig, axs = plt.subplots(<span class="number">1</span>,<span class="number">4</span>, figsize=(<span class="number">20</span>, <span class="number">10</span>))</span><br><span class="line">    print(<span class="string">"Encoder Layer"</span>, layer+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        draw(model.encoder.layers[layer].self_attn.attn[<span class="number">0</span>, h].data, sent, sent <span class="keyword">if</span> h ==<span class="number">0</span> <span class="keyword">else</span> [], ax=axs[h])</span><br><span class="line">    plt.show()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>):</span><br><span class="line">    fig, axs = plt.subplots(<span class="number">1</span>,<span class="number">4</span>, figsize=(<span class="number">20</span>, <span class="number">10</span>))</span><br><span class="line">    print(<span class="string">"Decoder Self Layer"</span>, layer+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        draw(model.decoder.layers[layer].self_attn.attn[<span class="number">0</span>, h].data[:len(tgt_sent), :len(tgt_sent)], tgt_sent, tgt_sent <span class="keyword">if</span> h ==<span class="number">0</span> <span class="keyword">else</span> [], ax=axs[h])</span><br><span class="line">    plt.show()</span><br><span class="line">    print(<span class="string">"Decoder Src Layer"</span>, layer+<span class="number">1</span>)</span><br><span class="line">    fig, axs = plt.subplots(<span class="number">1</span>,<span class="number">4</span>, figsize=(<span class="number">20</span>, <span class="number">10</span>))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        draw(model.decoder.layers[layer].self_attn.attn[<span class="number">0</span>, h].data[:len(tgt_sent), :len(sent)],sent, tgt_sent <span class="keyword">if</span> h ==<span class="number">0</span> <span class="keyword">else</span> [], ax=axs[h])</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
<h2 id="Encoder-visualization"><a href="#Encoder-visualization" class="headerlink" title="Encoder visualization"></a>Encoder visualization</h2><div class="note info">
            <p>Encoder Layer 2</p>
          </div>
<p><img src="/2020/05/09/transformer/encoder_layer_2.png" alt="screenshot"></p>
<div class="note info">
            <p>Encoder Layer 2</p>
          </div>
<p><img src="/2020/05/09/transformer/encoder_layer_4.png" alt="screenshot"></p>
<div class="note info">
            <p>Encoder Layer 6ï¼Œè¿™ä¸€å±‚è¯´æ˜äº†å•¥ï¼Ÿï¼Ÿ</p>
          </div>
<p><img src="/2020/05/09/transformer/image-20200511115252714.png" alt="image-20200511115252714"></p>
<p>åŒä¸€è¡Œï¼Œæ¯”è¾ƒä¸åŒçš„head,å¯ä»¥çœ‹å‡ºï¼Œä¸åŒçš„headï¼Œattentionåˆ°çš„å†…å®¹æ˜¯å„ä¸ç›¸åŒçš„ã€‚</p>
<p>ä¸åŒè¡Œæ¯”è¾ƒçš„ç»“è®ºï¼Ÿ</p>
<h2 id="Decoder-visualization"><a href="#Decoder-visualization" class="headerlink" title="Decoder visualization"></a>Decoder visualization</h2><div class="note info">
            <p>decoder Self Layer 2 :<s>ä¼šattentionåˆ°æ‰€æœ‰å•è¯ï¼Œå•è¯å¤§å¤šä¼šattentionåˆ°è‡ªå·±ã€‚</s></p>
          </div>
<p><img src="/2020/05/09/transformer/image-20200511120009561.png" alt="image-20200511120009561"></p>
<div class="note info">
            <p>decoder Src Layer 2</p>
          </div>
<p><img src="/2020/05/09/transformer/image-20200511120705604.png" alt="image-20200511120705604"></p>
<div class="note info">
            <p>decoder Self Layer 4</p>
          </div>
<p><img src="/2020/05/09/transformer/image-20200511120927309.png" alt="image-20200511120927309"></p>
<div class="note info">
            <p>decoder Src Layer 4</p>
          </div>
<p><img src="/2020/05/09/transformer/image-20200511120946538.png" alt="image-20200511120946538"></p>
<div class="note info">
            <p>decoder Self Layer 6</p>
          </div>
<p><img src="/2020/05/09/transformer/image-20200511121002344.png" alt="image-20200511121002344"></p>
<div class="note info">
            <p>decoder Src Layer 6</p>
          </div>
<p><img src="/2020/05/09/transformer/image-20200511121021648.png" alt="image-20200511121021648"></p>
<p>åŒä¸€è¡Œ ï¼Ÿ</p>
<p>ä¸åŒè¡Œï¼Ÿ</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="tricks"><a href="#tricks" class="headerlink" title="tricks"></a>tricks</h2><p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹æ²¡æœ‰æ”¶æ•›å¾—å¾ˆå¥½æ—¶ï¼ŒDecoderé¢„æµ‹äº§ç”Ÿçš„è¯å¾ˆå¯èƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚è¿™ä¸ªæ—¶å€™å¦‚æœå†æŠŠé”™è¯¯çš„æ•°æ®å†è¾“ç»™Decoderï¼Œå°±ä¼šè¶Šè·‘è¶Šåã€‚è¿™ä¸ªæ—¶å€™æ€ä¹ˆåŠï¼Ÿ</p>
<ul>
<li>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨ â€œteacher forcingâ€ã€‚å› ä¸ºæˆ‘ä»¬çŸ¥é“åº”è¯¥é¢„æµ‹çš„wordæ˜¯ä»€ä¹ˆï¼Œé‚£ä¹ˆå¯ä»¥ç»™Decoderå–‚ä¸€ä¸ªæ­£ç¡®çš„ç»“æœä½œä¸ºè¾“å…¥ã€‚</li>
<li>é™¤äº†é€‰æ‹©æœ€é«˜æ¦‚ç‡çš„è¯ (greedy search)ï¼Œè¿˜å¯ä»¥é€‰æ‹©æ˜¯æ¯”å¦‚ â€œBeam Searchâ€ï¼Œå¯ä»¥ä¿ç•™topKä¸ªé¢„æµ‹çš„wordã€‚ Beam Search æ–¹æ³•ä¸å†æ˜¯åªå¾—åˆ°ä¸€ä¸ªè¾“å‡ºæ”¾åˆ°ä¸‹ä¸€æ­¥å»è®­ç»ƒäº†ï¼Œæˆ‘ä»¬å¯ä»¥è®¾å®šä¸€ä¸ªå€¼ï¼Œæ‹¿å¤šä¸ªå€¼æ”¾åˆ°ä¸‹ä¸€æ­¥å»è®­ç»ƒï¼Œè¿™æ¡è·¯å¾„çš„æ¦‚ç‡ç­‰äºæ¯ä¸€æ­¥è¾“å‡ºçš„æ¦‚ç‡çš„ä¹˜ç§¯ã€‚</li>
</ul>
<h2 id="Transformerçš„ä¼˜ç¼ºç‚¹"><a href="#Transformerçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="Transformerçš„ä¼˜ç¼ºç‚¹"></a>Transformerçš„ä¼˜ç¼ºç‚¹</h2><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ol>
<li>æ¯å±‚è®¡ç®—å¤æ‚åº¦æ¯”RNNè¦ä½ã€‚</li>
<li>å¯ä»¥è¿›è¡Œ<strong>å¹¶è¡Œè®¡ç®—</strong>ã€‚</li>
<li>ä»è®¡ç®—ä¸€ä¸ªåºåˆ—é•¿åº¦ä¸ºnçš„ä¿¡æ¯è¦ç»è¿‡çš„è·¯å¾„é•¿åº¦æ¥çœ‹, CNNéœ€è¦å¢åŠ å·ç§¯å±‚æ•°æ¥æ‰©å¤§è§†é‡ï¼ŒRNNéœ€è¦ä»1åˆ°né€ä¸ªè¿›è¡Œè®¡ç®—ï¼Œè€ŒSelf-attentionåªéœ€è¦ä¸€æ­¥çŸ©é˜µè®¡ç®—å°±å¯ä»¥ã€‚Self-Attentionå¯ä»¥æ¯”RNNæ›´å¥½åœ°è§£å†³é•¿æ—¶ä¾èµ–é—®é¢˜ã€‚å½“ç„¶å¦‚æœè®¡ç®—é‡å¤ªå¤§ï¼Œæ¯”å¦‚åºåˆ—é•¿åº¦Nå¤§äºåºåˆ—ç»´åº¦Dè¿™ç§æƒ…å†µï¼Œä¹Ÿå¯ä»¥ç”¨çª—å£é™åˆ¶Self-Attentionçš„è®¡ç®—æ•°é‡ã€‚ï¼Ÿï¼Ÿï¼Ÿ</li>
<li>ä»ä½œè€…åœ¨é™„å½•ä¸­ç»™å‡ºçš„æ —å­å¯ä»¥çœ‹å‡ºï¼ŒSelf-Attentionæ¨¡å‹æ›´å¯è§£é‡Šï¼ŒAttentionç»“æœçš„åˆ†å¸ƒè¡¨æ˜äº†è¯¥æ¨¡å‹å­¦ä¹ åˆ°äº†ä¸€äº›è¯­æ³•å’Œè¯­ä¹‰ä¿¡æ¯ã€‚</li>
</ol>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ol>
<li>å®è·µä¸Šï¼šæœ‰äº›RNNè½»æ˜“å¯ä»¥è§£å†³çš„é—®é¢˜transformeræ²¡åšåˆ°ï¼Œæ¯”å¦‚<strong>å¤åˆ¶string</strong>ï¼Œæˆ–è€…æ¨ç†æ—¶ç¢°åˆ°çš„sequenceé•¿åº¦æ¯”è®­ç»ƒæ—¶æ›´é•¿ï¼ˆå› ä¸º<strong>ç¢°åˆ°äº†æ²¡è§è¿‡çš„position embedding</strong>ï¼‰ã€‚</li>
<li>ç†è®ºä¸Šï¼štransformersä¸æ˜¯computationally universal(å›¾çµå®Œå¤‡)ï¼Œè¿™ç§éRNNå¼çš„æ¨¡å‹æ˜¯éå›¾çµå®Œå¤‡çš„çš„ï¼Œ<strong>æ— æ³•å•ç‹¬å®ŒæˆNLPä¸­æ¨ç†ã€å†³ç­–ç­‰è®¡ç®—é—®é¢˜</strong>ï¼ˆåŒ…æ‹¬ä½¿ç”¨transformerçš„bertæ¨¡å‹ç­‰ç­‰ï¼‰ã€‚ï¼Ÿï¼Ÿï¼Ÿ</li>
</ol>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://nlp.seas.harvard.edu/2018/04/03/attention.html" target="_blank" rel="noopener">The Annotated Transformer</a></li>
<li><a href="https://www.cnblogs.com/zingp/p/11696111.html" target="_blank" rel="noopener">æ·±å…¥ç†è§£TransformeråŠå…¶æºç </a></li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯/è‡ªç„¶è¯­è¨€å¤„ç†</category>
      </categories>
  </entry>
  <entry>
    <title>å¹³æ»‘æ–¹æ³•</title>
    <url>/2020/05/08/%E5%B9%B3%E6%BB%91%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>åœ¨ä¸€ä¸ªæ¦‚ç‡æ¨¡å‹ä¸­ï¼Œä¹Ÿå°±æ˜¯ p(e)åœ¨ event space E ä¸‹çš„æ¦‚ç‡åˆ†å¸ƒï¼Œæ¨¡å‹å¾ˆå¯èƒ½ä¼šç”¨æœ€å¤§ä¼¼ç„¶ä¼°è®¡(MLE)ï¼š</p>
<script type="math/tex; mode=display">
P_{M L E}=\frac{c(x)}{\sum_{e} c(e)}</script><p>ç„¶è€Œï¼Œç”±äºå¹¶æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®ï¼Œå¾ˆå¤šäº‹ä»¶ $x$ å¹¶æ²¡æœ‰åœ¨è®­ç»ƒæ•°æ®ä¸­å‡ºç°ï¼Œä¹Ÿå°±æ˜¯ $c(x)=0$ï¼Œ$P_{MLE}=0$è¿™æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ²¡æœ‰åœ¨è®­ç»ƒæ•°æ®ä¸­å‡ºç°çš„æ•°æ®ï¼Œå¹¶ä¸ä»£è¡¨ä¸ä¼šåœ¨æµ‹è¯•æ•°æ®ä¸­å‡ºç°ï¼Œå¦‚æœæ²¡æœ‰è€ƒè™‘åˆ°æ•°æ®ç¨€ç–æ€§ï¼Œæ¨¡å‹å°±æ˜¾å¾—å¤ªç®€å•äº†ã€‚</p>
<p>Data sparsity æ˜¯ smoothing çš„æœ€å¤§åŸå› ã€‚Chen &amp; Goodman åœ¨1998 å¹´æåˆ°è¿‡ï¼Œå‡ ä¹æ‰€æœ‰æ•°æ®ç¨€ç–çš„åœºæ™¯ä¸‹ï¼Œsmoothing éƒ½å¯ä»¥å¸®åŠ©æé«˜ performanceï¼Œè€Œæ•°æ®ç¨€ç–æ€§å‡ ä¹æ˜¯æ‰€æœ‰ç»Ÿè®¡æ¨¡å‹éƒ½ä¼šé‡åˆ°çš„é—®é¢˜ã€‚è€Œå¦‚æœä½ æœ‰è¶³å¤Ÿå¤šçš„è®­ç»ƒæ•°æ®ï¼Œæ‰€æœ‰çš„ parameters éƒ½å¯ä»¥åœ¨æ²¡æœ‰ smoothing çš„æƒ…å†µä¸‹è¢«å‡†ç¡®çš„ä¼°è®¡ï¼Œé‚£ä¹ˆä½ æ€»æ˜¯å¯ä»¥æ‰©å±•æ¨¡å‹ï¼Œå¦‚åŸæ¥æ˜¯ bigramï¼Œæ²¡æœ‰æ•°æ®ç¨€ç–ï¼Œå®Œå…¨å¯ä»¥æ‰©å±•åˆ° trigram æ¥æé«˜ performanceï¼Œå¦‚æœè¿˜æ²¡æœ‰å‡ºç°ç¨€ç–ï¼Œå°±å†å¾€é«˜å±‚æ¨ï¼Œå½“ parameters è¶Šæ¥è¶Šå¤šçš„æ—¶å€™ï¼Œæ•°æ®ç¨€ç–å†æ¬¡æˆä¸ºäº†é—®é¢˜ï¼Œè¿™æ—¶å€™ï¼Œç”¨åˆé€‚çš„å¹³æ»‘æ–¹æ³•å¯ä»¥å¾—åˆ°æ›´å‡†ç¡®çš„æ¨¡å‹ã€‚å®é™…ä¸Šï¼Œæ— è®ºæœ‰å¤šå°‘çš„æ•°æ®ï¼Œå¹³æ»‘å‡ ä¹æ€»æ˜¯å¯ä»¥ä»¥å¾ˆå°çš„ä»£ä»·æ¥æé«˜ performanceã€‚</p>
<a id="more"></a>
<h3 id="å¹³æ»‘æ–¹æ³•"><a href="#å¹³æ»‘æ–¹æ³•" class="headerlink" title="å¹³æ»‘æ–¹æ³•"></a>å¹³æ»‘æ–¹æ³•</h3><h4 id="add-one-smoothing"><a href="#add-one-smoothing" class="headerlink" title="add-one smoothing"></a>add-one smoothing</h4><p>(ä¹Ÿå«laplace smoothing),ä»¥bigramä¸ºä¾‹ï¼š</p>
<p>MLE estimateï¼š</p>
<script type="math/tex; mode=display">
P_{M L E}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1} w_{i}\right)}{c\left(w_{i-1}\right)}</script><p>Add-one estimate:</p>
<script type="math/tex; mode=display">
P_{A d d-1}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1} w_{i}\right)+1}{c\left(w_{i-1}\right)+V}</script><p>å…¶ä¸­ï¼Œ$V$è¡¨ç¤ºè¯å…¸å¤§å°ã€‚</p>
<p>å‡è®¾è¯­æ–™åº“ä¸ºï¼š</p>
<blockquote>
<ol>
<li>john read moby dick</li>
<li>mary read a different book</li>
<li>she read a book by cher</li>
</ol>
</blockquote>
<p>é‚£ä¹ˆï¼Œjohn read a book è¿™ä¸ªå¥å­çš„æ¦‚ç‡ä¸ºï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
p(\text { john read a book })&=p(\text { john } |<s>)  p(\text { read } | \text { john })  p(\text { a } | \text { read })  p(\text { book } | a )  p(<e> | \text {book}) \\
&=\frac{c(<s>,john)}{\sum_{w} c(<s>,w)} \frac{c(john,read)}{\sum_{w} c(john,w)} \frac{c(read,a)}{\sum_{w} c(read,w)} \frac{c(a,book)}{\sum_{w} c(a,w)} \frac{c(book,<e>)}{\sum_{w} c(book,w)}\\
&= \frac{1}{3} * \frac{1}{1} * \frac{2}{3} * \frac{1}{2} * \frac{1}{2} \\
&\approx 0.006
\end{aligned}</script><p>è€Œï¼Œcher read a book è¿™ä¸ªå¥å­å‡ºç°çš„æ¦‚ç‡æ˜¯ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
p(\text { cher read a book })&=p(\text { cher } |<s>)  p(\text { read } | \text { cher })  p(\text { a } | \text { read })  p(\text { book } | a )  p(<e> | \text {book}) \\
&=\frac{c(<s>,cher)}{\sum_{w} c(<s>,w)} \frac{c(cher,read)}{\sum_{w} c(cher,w)} \frac{c(read,a)}{\sum_{w} c(read,w)} \frac{c(a,book)}{\sum_{w} c(a,w)} \frac{c(book,<e>)}{\sum_{w} c(book,w)}\\
&= \frac{0}{3} * \frac{0}{1} * \frac{2}{3} * \frac{1}{2} * \frac{1}{2} \\
&\approx 0
\end{aligned}</script><p>å¦‚æœä½¿ç”¨add-one smoothingï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
p(\text { john read a book })&=p(\text { john } |<s>)  p(\text { read } | \text { john })  p(\text { a } | \text { read })  p(\text { book } | a )  p(<e> | \text {book}) \\
&= \frac{1+1}{3+11} * \frac{1+1}{1+11} * \frac{2+1}{3+11} * \frac{1+1}{2+11} * \frac{1+1}{2+11} \\
&\approx 0.0001
\end{aligned}</script><script type="math/tex; mode=display">
\begin{aligned}
p(\text { cher read a book })&=p(\text { cher } |<s>)  p(\text { read } | \text { cher })  p(\text { a } | \text { read })  p(\text { book } | a )  p(<e> | \text {book}) \\
&= \frac{0+1}{3+11} * \frac{0+1}{1+11} * \frac{2+1}{3+11} * \frac{1+1}{2+11} * \frac{1+1}{2+11} \\
&\approx 0.00003
\end{aligned}</script><p>åŠ  1 å¹³æ»‘é€šå¸¸æƒ…å†µä¸‹æ˜¯ä¸€ç§å¾ˆç³Ÿç³•çš„ç®—æ³•ï¼Œä¸å…¶ä»–å¹³æ»‘æ–¹æ³•ç›¸æ¯”æ˜¾å¾—éå¸¸å·®ï¼Œå¯ä»¥æŠŠåŠ  1 å¹³æ»‘ç”¨åœ¨å…¶ä»–ä»»åŠ¡ä¸­ï¼Œå¦‚æ–‡æœ¬åˆ†ç±»ï¼Œæˆ–è€…éé›¶è®¡æ•°æ²¡é‚£ä¹ˆå¤šçš„æƒ…å†µä¸‹ã€‚</p>
<h4 id="Additive-smoothing"><a href="#Additive-smoothing" class="headerlink" title="Additive smoothing"></a>Additive smoothing</h4><p>å¯¹åŠ  1 å¹³æ»‘çš„æ”¹è¿›å°±æ˜¯æŠŠ 1 æ”¹æˆ $\delta$ï¼Œä¸” $0&lt;\delta$</p>
<script type="math/tex; mode=display">
P_{A d d-\delta}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1} w_{i}\right)+\delta}{c\left(w_{i-1}\right)+\delta V}</script><p>å¯ä»¥æŠŠ$\delta$çœ‹ä½œæ˜¯ä¸€ä¸ªå¯ä»¥è°ƒèŠ‚çš„è¶…å‚æ•°ã€‚</p>
<h4 id="Good-Turing-smoothing"><a href="#Good-Turing-smoothing" class="headerlink" title="Good-Turing smoothing"></a>Good-Turing smoothing</h4><p><strong>åŸºæœ¬æ€æƒ³:</strong> ç”¨è§‚å¯Ÿè®¡æ•°è¾ƒé«˜çš„ N-gram æ•°é‡æ¥é‡æ–°ä¼°è®¡æ¦‚ç‡é‡å¤§å°ï¼Œå¹¶æŠŠå®ƒæŒ‡æ´¾ç»™é‚£äº›å…·æœ‰é›¶è®¡æ•°æˆ–è¾ƒä½è®¡æ•°çš„ N-gram.</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾ä½ åœ¨é’“é±¼ï¼Œç„¶åæŠ“åˆ°äº† 18 æ¡é±¼ï¼Œç§ç±»å¦‚ä¸‹ï¼š10æ¡é²¤é±¼, 3æ¡é»‘é±¼, 2æ¡åˆ€é±¼, 1æ¡é²¨é±¼, 1æ¡è‰é±¼, 1æ¡é³—é±¼ï¼Œé‚£ä¹ˆ</p>
<ol>
<li><p>ä¸‹ä¸€ä¸ªé’“åˆ°çš„é±¼æ˜¯é²¨é±¼çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ</p>
<p>1/18</p>
</li>
<li><p>ä¸‹ä¸€æ¡ä¸æ˜¯æ–°é±¼ç§ï¼ˆä¹‹å‰æ²¡æœ‰å‡ºç°è¿‡ï¼‰çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ</p>
<p>3/18(æ²¡æœ‰å‡ºç°è¿‡çš„æŒ‰å‡ºç°è¿‡ä¸€æ¬¡ç®—)</p>
</li>
<li><p>ä¸‹ä¸€æ¡æŠ“åˆ°çš„é±¼æ˜¯é²¨é±¼çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ</p>
<p>é¦–å…ˆè‚¯å®šçš„æ˜¯æ¦‚ç‡å°äº1/18  â€”&gt; good turing</p>
</li>
</ol>
<p>åœ¨good turing ä¸‹,å¯¹å‚æ•°çš„ä¼°è®¡åˆ†ä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>æ²¡æœ‰å‡ºç°è¿‡çš„ï¼š$P_{GT}=\frac{N_1}{N}$</li>
<li>å‡ºç°è¿‡çš„ï¼š$P_{GT}=\frac{(c+1)N_{c+1}}{N_c*N}$</li>
</ol>
<p>å…¶ä¸­ï¼Œ$N_c$è¡¨ç¤ºå‡ºç°cæ¬¡çš„å•è¯ä¸ªæ•°,$N$ä»£è¡¨æ ·æœ¬æ€»æ•°ã€‚<br>æ¯”å¦‚ï¼š</p>
<blockquote>
<p>sam i am i am sam i do not eat </p>
<p>samï¼š2æ¬¡</p>
<p>iï¼š3æ¬¡</p>
<p>amï¼š2æ¬¡</p>
<p>doï¼š1æ¬¡</p>
<p>notï¼š1æ¬¡</p>
<p>eatï¼š1æ¬¡</p>
</blockquote>
<p>æœ‰ï¼š$N_3=1,N_2=2,N_1=3$</p>
<p>å¯¹äºç¬¬3ä¸ªé—®é¢˜ï¼š$P_{GT}=\frac{(1+1)<em>1}{3</em>18}=\frac{1}{27}$.</p>
<h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><p>ç”±å…¬å¼ï¼š$P_{GT}=\frac{(c+1)N_{c+1}}{N_c*N}$åœ¨è®¡ç®—å½“å‰é¡¹$c$ çš„æ—¶å€™ï¼Œéœ€è¦è®¡ç®—åˆ°$c+1$çš„$N_{c+1}$,è‹¥$N_{c+1}=0$ï¼Œåˆ™ä¼šå¯¼è‡´æ¦‚ç‡ä¸º0.</p>
<p>è§£å†³æ–¹æ³•ï¼šå¯ä»¥åˆ©ç”¨æœºå™¨å­¦ä¹ ä¸­å›å½’ç®—æ³•å¯¹$N_1,N_2,\ldots,N_c,N_{c+1}$è¿›è¡Œæ‹Ÿåˆï¼Œè¿›è€Œå¾—å‡º$N_{c+1}$çš„å€¼ã€‚</p>
<h3 id="Interpolation"><a href="#Interpolation" class="headerlink" title="Interpolation"></a>Interpolation</h3><p><strong>åŸºæœ¬æ€æƒ³</strong>ï¼šåœ¨è®¡ç®—Trigramæ¦‚ç‡çš„åŒæ—¶ï¼Œè€ƒè™‘Unigramï¼ŒBigramï¼ŒTrigramå‡ºç°çš„æ¬¡æ•°ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šæœ‰</p>
<p><code>C(in the kitchen)=0</code>,<code>C(the kitchen)=3</code>,<code>C(kitchen)=4</code>,<code>C(arboretum)=0</code>.åœ¨è®¡ç®—<code>p(kitchen|in the)</code>å’Œ<code>p(arboretum|in the)</code>çš„æ—¶å€™ï¼Œä»è¯­æ–™è®¡ç®—å¾—å‡ºï¼š$p(kitchen|in,the)=p(arboretum|in,the)=0$,ä½†æ˜¯ä»ç»éªŒä¸Šæ¥è®²$p(kitchen|in,the)&gt;p(arboretum|in,the)$ï¼Œå› ä¸ºkitchenè¦æ¯”arboretumå¸¸è§çš„å¤šã€‚è¦å®ç°è¿™ä¸ªï¼Œæˆ‘ä»¬å°±å¸Œæœ›æŠŠ bigram å’Œ unigram ç»“åˆèµ·æ¥ï¼Œinterpolate å°±æ˜¯è¿™æ ·ä¸€ç§æ–¹æ³•ã€‚ç”¨çº¿æ€§å·®å€¼æŠŠä¸åŒé˜¶çš„ N-gram ç»“åˆèµ·æ¥ï¼Œè¿™é‡Œç»“åˆäº† trigramï¼Œbigram å’Œ unigramã€‚ç”¨ lambda è¿›è¡ŒåŠ æƒ</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathrm{p}\left(\mathrm{w}_{\mathrm{n}} | \mathrm{w}_{\mathrm{n}-1}, \mathrm{w}_{\mathrm{n}-2}\right)=& \lambda_{1} \mathrm{p}\left(\mathrm{w}_{\mathrm{n}} | \mathrm{w}_{\mathrm{n}-1}, \mathrm{w}_{\mathrm{n}-2}\right) \\
&+\lambda_{2} \mathrm{p}\left(\mathrm{w}_{\mathrm{n}} | \mathrm{w}_{\mathrm{n}-1}\right) \\
&+\lambda_{3} \mathrm{p}\left(\mathrm{w}_{\mathrm{n}}\right)\\
\sum_i\lambda_i=1
\end{aligned}</script><h5 id="æ€æ ·è®¾ç½®-lambdasï¼Ÿï¼Ÿï¼Ÿï¼Ÿ"><a href="#æ€æ ·è®¾ç½®-lambdasï¼Ÿï¼Ÿï¼Ÿï¼Ÿ" class="headerlink" title="æ€æ ·è®¾ç½® lambdasï¼Ÿï¼Ÿï¼Ÿï¼Ÿ"></a>æ€æ ·è®¾ç½® lambdasï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</h5>]]></content>
      <categories>
        <category>è‡ªç„¶è¯­è¨€å¤„ç†</category>
      </categories>
      <tags>
        <tag>è‡ªç„¶è¯­è¨€å¤„ç†åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†è¯ç®—æ³•</title>
    <url>/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="åˆ†è¯ç®€ä»‹"><a href="#åˆ†è¯ç®€ä»‹" class="headerlink" title="åˆ†è¯ç®€ä»‹"></a>åˆ†è¯ç®€ä»‹</h3><p>ä¸­æ–‡åˆ†è¯ç®—æ³•æ˜¯æŒ‡å°†ä¸€ä¸ªæ±‰å­—åºåˆ—åˆ‡åˆ†æˆä¸€ä¸ªä¸€ä¸ªå•ç‹¬çš„è¯ï¼Œä¸è‹±æ–‡ä»¥ç©ºæ ¼ä½œä¸ºå¤©ç„¶çš„åˆ†éš”ç¬¦ä¸åŒï¼Œä¸­æ–‡å­—ç¬¦åœ¨è¯­ä¹‰è¯†åˆ«æ—¶ï¼Œéœ€è¦æŠŠæ•°ä¸ªå­—ç¬¦ç»„åˆæˆè¯ï¼Œæ‰èƒ½è¡¨è¾¾å‡ºçœŸæ­£çš„å«ä¹‰ã€‚åˆ†è¯ç®—æ³•é€šå¸¸åº”ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ã€æœç´¢å¼•æ“ã€æ™ºèƒ½æ¨èç­‰é¢†åŸŸã€‚</p>
<p>åˆ†è¯ç®—æ³•æ ¹æ®å…¶æ ¸å¿ƒæ€æƒ³ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯åŸºäºè¯å…¸çš„åˆ†è¯ï¼Œå…ˆæŠŠå¥å­æŒ‰ç…§å­—å…¸åˆ‡åˆ†æˆè¯ï¼Œå†å¯»æ‰¾è¯çš„æœ€ä½³ç»„åˆæ–¹å¼ï¼›ç¬¬äºŒç§æ˜¯åŸºäºå­—çš„åˆ†è¯ï¼Œå³ç”±å­—æ„è¯ï¼Œå…ˆæŠŠå¥å­åˆ†æˆä¸€ä¸ªä¸ªå­—ï¼Œå†å°†å­—ç»„åˆæˆè¯ï¼Œå¯»æ‰¾æœ€ä¼˜çš„åˆ‡åˆ†ç­–ç•¥ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è½¬åŒ–æˆåºåˆ—æ ‡æ³¨é—®é¢˜ã€‚</p>
<p>å…¶åˆ†ç±»å¤§è‡´å¯åˆ†ä¸ºï¼š</p>
<ol>
<li><p>åŸºäºåŒ¹é…è§„åˆ™çš„æ–¹æ³•</p>
<ul>
<li>æ­£å‘æœ€å¤§åŒ¹é…æ³•(forward maximum matching method, FMM)</li>
<li>é€†å‘æœ€å¤§åŒ¹é…æ³•(backward maximum matching method, BMM)</li>
<li>æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•</li>
</ul>
</li>
<li><p>åŸºäºç»Ÿè®¡ä»¥åŠæœºå™¨å­¦ä¹ çš„åˆ†è¯æ–¹æ³•</p>
<ul>
<li>åŸºäºN-gramè¯­è¨€æ¨¡å‹çš„åˆ†è¯æ–¹æ³•</li>
<li>åŸºäºHMMçš„åˆ†è¯æ–¹æ³•</li>
<li>åŸºäºCRFçš„åˆ†è¯æ–¹æ³•</li>
<li>åŸºäºè¯æ„ŸçŸ¥æœºçš„åˆ†è¯æ–¹æ³•</li>
<li>åŸºäºæ·±åº¦å­¦ä¹ çš„ç«¯åˆ°ç«¯çš„åˆ†è¯æ–¹æ³•</li>
</ul>
</li>
</ol>
<p>åŸºäºè§„åˆ™åŒ¹é…çš„åˆ†è¯é€šå¸¸ä¼šåŠ å…¥ä¸€äº›å¯å‘å¼è§„åˆ™ï¼Œæ¯”å¦‚â€œæ­£å‘/åå‘æœ€å¤§åŒ¹é…â€ï¼Œâ€œé•¿è¯ä¼˜å…ˆâ€ç­‰ã€‚</p>
<p>åŸºäºç»Ÿè®¡ä»¥åŠæœºå™¨å­¦ä¹ çš„åˆ†è¯æ–¹æ³•ï¼Œå®ƒä»¬åŸºäºäººå·¥æ ‡æ³¨çš„è¯æ€§å’Œç»Ÿè®¡ç‰¹å¾ï¼Œå¯¹ä¸­æ–‡è¿›è¡Œå»ºæ¨¡ï¼Œå³æ ¹æ®è§‚æµ‹åˆ°çš„æ•°æ®(æ ‡æ³¨å¥½çš„è¯­æ–™)å¯¹æ¨¡å‹å‚æ•°è¿›è¡Œè®­ç»ƒï¼Œåœ¨åˆ†è¯é˜¶æ®µå†é€šè¿‡æ¨¡å‹è®¡ç®—å„ç§åˆ†è¯å‡ºç°çš„æ¦‚ç‡ï¼Œå°†æ¦‚ç‡æœ€å¤§çš„åˆ†è¯ç»“æœä½œä¸ºæœ€ç»ˆç»“æœã€‚è¿™ç±»åˆ†è¯ç®—æ³•èƒ½å¾ˆå¥½å¤„ç†æ­§ä¹‰å’Œæœªç™»å½•è¯é—®é¢˜ï¼Œæ•ˆæœæ¯”åŸºäºè§„åˆ™åŒ¹é…çš„æ–¹æ³•æ•ˆæœå¥½ï¼Œä½†æ˜¯éœ€è¦å¤§é‡çš„äººå·¥æ ‡æ³¨æ•°æ®ï¼Œä»¥åŠè¾ƒæ…¢çš„åˆ†è¯é€Ÿåº¦ã€‚</p>
<p><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç åŠæ•°æ®</a></p>
<a id="more"></a>
<h4 id="ä¸­æ–‡åˆ†è¯çš„åº”ç”¨"><a href="#ä¸­æ–‡åˆ†è¯çš„åº”ç”¨" class="headerlink" title="ä¸­æ–‡åˆ†è¯çš„åº”ç”¨"></a>ä¸­æ–‡åˆ†è¯çš„åº”ç”¨</h4><p>ç›®å‰åœ¨è‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯ä¸­ï¼Œä¸­æ–‡å¤„ç†æŠ€æœ¯æ¯”è¥¿æ–‡å¤„ç†æŠ€æœ¯è¦è½åå¾ˆå¤§ä¸€æ®µè·ç¦»ï¼Œè®¸å¤šè¥¿æ–‡çš„å¤„ç†æ–¹æ³•ä¸­æ–‡ä¸èƒ½ç›´æ¥é‡‡ç”¨ï¼Œå°±æ˜¯å› ä¸ºä¸­æ–‡å¿…éœ€æœ‰åˆ†è¯è¿™é“å·¥åºã€‚ä¸­æ–‡åˆ†è¯æ˜¯å…¶ä»–ä¸­æ–‡ä¿¡æ¯å¤„ç†çš„åŸºç¡€ï¼Œæœç´¢å¼•æ“åªæ˜¯ä¸­æ–‡åˆ†è¯çš„ä¸€ä¸ªåº”ç”¨ã€‚å…¶ä»–çš„æ¯”å¦‚æœºå™¨ç¿»è¯‘ï¼ˆMTï¼‰ã€è¯­éŸ³åˆæˆã€è‡ªåŠ¨åˆ†ç±»ã€è‡ªåŠ¨æ‘˜è¦ã€è‡ªåŠ¨æ ¡å¯¹ç­‰ç­‰ï¼Œéƒ½éœ€è¦ç”¨åˆ°åˆ†è¯ã€‚å› ä¸ºä¸­æ–‡éœ€è¦åˆ†è¯ï¼Œå¯èƒ½ä¼šå½±å“ä¸€äº›ç ”ç©¶ï¼Œä½†åŒæ—¶ä¹Ÿä¸ºä¸€äº›ä¼ä¸šå¸¦æ¥æœºä¼šï¼Œå› ä¸ºå›½å¤–çš„è®¡ç®—æœºå¤„ç†æŠ€æœ¯è¦æƒ³è¿›å…¥ä¸­å›½å¸‚åœºï¼Œé¦–å…ˆä¹Ÿæ˜¯è¦è§£å†³ä¸­æ–‡åˆ†è¯é—®é¢˜ã€‚åœ¨ä¸­æ–‡ç ”ç©¶æ–¹é¢ï¼Œç›¸æ¯”å¤–å›½äººæ¥è¯´ï¼Œä¸­å›½äººæœ‰ååˆ†æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚</p>
<p>åˆ†è¯å‡†ç¡®æ€§å¯¹æœç´¢å¼•æ“æ¥è¯´ååˆ†é‡è¦ï¼Œä½†å¦‚æœåˆ†è¯é€Ÿåº¦å¤ªæ…¢ï¼Œå³ä½¿å‡†ç¡®æ€§å†é«˜ï¼Œå¯¹äºæœç´¢å¼•æ“æ¥è¯´ä¹Ÿæ˜¯ä¸å¯ç”¨çš„ï¼Œå› ä¸ºæœç´¢å¼•æ“éœ€è¦å¤„ç†æ•°ä»¥äº¿è®¡çš„ç½‘é¡µï¼Œå¦‚æœåˆ†è¯è€—ç”¨çš„æ—¶é—´è¿‡é•¿ï¼Œä¼šä¸¥é‡å½±å“æœç´¢å¼•æ“å†…å®¹æ›´æ–°çš„é€Ÿåº¦ã€‚å› æ­¤å¯¹äºæœç´¢å¼•æ“æ¥è¯´ï¼Œåˆ†è¯çš„å‡†ç¡®æ€§å’Œé€Ÿåº¦ï¼ŒäºŒè€…éƒ½éœ€è¦è¾¾åˆ°å¾ˆé«˜çš„è¦æ±‚ã€‚ç›®å‰ç ”ç©¶ä¸­æ–‡åˆ†è¯çš„å¤§å¤šæ˜¯ç§‘ç ”é™¢æ ¡ï¼Œæ¸…åã€åŒ—å¤§ã€ä¸­ç§‘é™¢ã€åŒ—äº¬è¯­è¨€å­¦é™¢ã€ä¸œåŒ—å¤§å­¦ã€IBMç ”ç©¶é™¢ã€å¾®è½¯ä¸­å›½ç ”ç©¶é™¢ç­‰éƒ½æœ‰è‡ªå·±çš„ç ”ç©¶é˜Ÿä¼ï¼Œè€ŒçœŸæ­£ä¸“ä¸šç ”ç©¶ä¸­æ–‡åˆ†è¯çš„å•†ä¸šå…¬å¸é™¤äº†æµ·é‡ç§‘æŠ€ä»¥å¤–ï¼Œå‡ ä¹æ²¡æœ‰ã€‚</p>
<h3 id="åŸºäºåŒ¹é…è§„åˆ™çš„æ–¹æ³•"><a href="#åŸºäºåŒ¹é…è§„åˆ™çš„æ–¹æ³•" class="headerlink" title="åŸºäºåŒ¹é…è§„åˆ™çš„æ–¹æ³•"></a>åŸºäºåŒ¹é…è§„åˆ™çš„æ–¹æ³•</h3><p>ä¸»è¦æ˜¯äººå·¥å»ºç«‹è¯åº“ä¹Ÿå«åšè¯å…¸ï¼Œé€šè¿‡è¯å…¸åŒ¹é…çš„æ–¹å¼å¯¹å¥å­è¿›è¡Œåˆ’åˆ†ã€‚å…¶å®ç°ç®€å•é«˜æ•ˆï¼Œä½†æ˜¯å¯¹æœªç™»é™†è¯å¾ˆéš¾è¿›è¡Œå¤„ç†ã€‚ä¸»è¦æœ‰å‰å‘æœ€å¤§åŒ¹é…æ³•ï¼Œåå‘æœ€å¤§åŒ¹é…æ³•ä»¥åŠåŒå‘æœ€å¤§åŒ¹é…æ³•ã€‚</p>
<h4 id="å‰å‘æœ€å¤§åŒ¹é…ç®—æ³•"><a href="#å‰å‘æœ€å¤§åŒ¹é…ç®—æ³•" class="headerlink" title="å‰å‘æœ€å¤§åŒ¹é…ç®—æ³•"></a>å‰å‘æœ€å¤§åŒ¹é…ç®—æ³•</h4><p>å‰å‘æœ€å¤§åŒ¹é…ç®—æ³•ï¼Œæ˜¯ä»å¾…åˆ†è¯å¥å­çš„å·¦è¾¹å‘å³è¾¹æœç´¢ï¼Œå¯»æ‰¾è¯çš„æœ€å¤§åŒ¹é…ã€‚è§„å®šä¸€ä¸ªè¯çš„æœ€å¤§é•¿åº¦ï¼Œæ¯æ¬¡æ‰«æçš„æ—¶å€™å¯»æ‰¾å½“å‰å¼€å§‹çš„è¿™ä¸ªé•¿åº¦çš„è¯æ¥å’Œå­—å…¸ä¸­çš„è¯åŒ¹é…ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ç¼©çŸ­é•¿åº¦ç»§ç»­å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°å­—å…¸ä¸­çš„è¯æˆ–è€…æˆä¸ºå•å­—ã€‚</p>
<h5 id="ç®—æ³•æµç¨‹"><a href="#ç®—æ³•æµç¨‹" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h5><ol>
<li>ä»å‰å‘åæ‰«æå­—å…¸ï¼Œæµ‹è¯•è¯»å…¥çš„å­ä¸²æ˜¯å¦åœ¨å­—å…¸ä¸­</li>
<li>å¦‚æœå­˜åœ¨ï¼Œåˆ™ä»è¾“å…¥ä¸­åˆ é™¤æ‰è¯¥å­ä¸²ï¼Œé‡æ–°æŒ‰ç…§è§„åˆ™å–å­ä¸²ï¼Œé‡å¤1</li>
<li>å¦‚æœä¸å­˜åœ¨äºå­—å…¸ä¸­ï¼Œåˆ™ä»å³å‘å·¦å‡å°‘å­ä¸²é•¿åº¦ï¼Œé‡å¤1</li>
</ol>
<h5 id="åˆ†è¯å®ä¾‹ï¼š"><a href="#åˆ†è¯å®ä¾‹ï¼š" class="headerlink" title="åˆ†è¯å®ä¾‹ï¼š"></a>åˆ†è¯å®ä¾‹ï¼š</h5><p>æ¯”å¦‚è¯´è¾“å…¥ â€œåŒ—äº¬å¤§å­¦ç”Ÿå‰æ¥åº”è˜â€ï¼Œå‡è®¾è¯å…¸ä¸­æœ€é•¿çš„å•è¯ä¸º 5 ä¸ªï¼ˆMAX_LENGTHï¼‰ã€‚</p>
<ol>
<li>ç¬¬ä¸€è½®ï¼šå–å­ä¸² â€œåŒ—äº¬å¤§å­¦ç”Ÿâ€ï¼Œæ­£å‘å–è¯ï¼Œå¦‚æœåŒ¹é…å¤±è´¥ï¼Œ<strong>æ¯æ¬¡å»æ‰åŒ¹é…å­—æ®µæœ€åé¢çš„ä¸€ä¸ªå­—</strong><br>â€œåŒ—äº¬å¤§å­¦ç”Ÿâ€ï¼Œæ‰«æ 5 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œåŒ—äº¬å¤§å­¦â€<br>â€œåŒ—äº¬å¤§å­¦â€ï¼Œæ‰«æ 4 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œåŒ—äº¬å¤§å­¦â€ï¼Œè¾“å…¥å˜ä¸ºâ€œç”Ÿå‰æ¥åº”è˜â€</li>
<li>ç¬¬äºŒè½®ï¼šå–å­ä¸²â€œç”Ÿå‰æ¥åº”è˜â€<br>â€œç”Ÿå‰æ¥åº”è˜â€ï¼Œæ‰«æ 5 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œç”Ÿå‰æ¥åº”â€<br>â€œç”Ÿå‰æ¥åº”â€ï¼Œæ‰«æ 4 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œç”Ÿå‰æ¥â€<br>â€œç”Ÿå‰æ¥â€ï¼Œæ‰«æ 3 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œç”Ÿå‰â€<br>â€œç”Ÿå‰â€ï¼Œæ‰«æ 2 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œç”Ÿå‰â€ï¼Œè¾“å…¥å˜ä¸ºâ€œæ¥åº”è˜â€â€</li>
<li>ç¬¬ä¸‰è½®ï¼šå–å­ä¸²â€œæ¥åº”è˜â€<br>â€œæ¥åº”è˜â€ï¼Œæ‰«æ 3 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œæ¥åº”â€<br>â€œæ¥åº”â€ï¼Œæ‰«æ 2 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œæ¥â€<br>é¢—ç²’åº¦æœ€å°ä¸º 1ï¼Œç›´æ¥è¾“å‡ºâ€œæ¥â€ï¼Œè¾“å…¥å˜ä¸ºâ€œåº”è˜â€</li>
<li>ç¬¬å››è½®ï¼šå–å­ä¸²â€œåº”è˜â€<br>â€œåº”è˜â€ï¼Œæ‰«æ 2 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œåº”è˜â€ï¼Œè¾“å…¥å˜ä¸ºâ€œâ€<br>è¾“å…¥é•¿åº¦ä¸º0ï¼Œæ‰«æç»ˆæ­¢</li>
</ol>
<h5 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><p>æ•°æ®å‡†å¤‡ï¼šè¯åº“</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward_max_match</span><span class="params">(sentence, window_size, word_dict)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    å‰å‘æœ€å¤§åŒ¹é…ç®—æ³•ï¼š</span></span><br><span class="line"><span class="string">    ï¼ˆ1ï¼‰æ‰«æå­—å…¸ï¼Œæµ‹è¯•è¯»å…¥çš„å­ä¸²æ˜¯å¦åœ¨å­—å…¸ä¸­</span></span><br><span class="line"><span class="string">    ï¼ˆ2ï¼‰å¦‚æœå­˜åœ¨ï¼Œåˆ™ä»è¾“å…¥ä¸­åˆ é™¤æ‰è¯¥å­ä¸²ï¼Œé‡æ–°æŒ‰ç…§è§„åˆ™å–å­ä¸²ï¼Œé‡å¤ï¼ˆ1ï¼‰</span></span><br><span class="line"><span class="string">    ï¼ˆ3ï¼‰å¦‚æœä¸å­˜åœ¨äºå­—å…¸ä¸­ï¼Œåˆ™ä»å³å‘å·¦å‡å°‘å­ä¸²é•¿åº¦ï¼Œé‡å¤ï¼ˆ1ï¼‰</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param sentence: å¾…åˆ†è¯çš„å¥å­</span></span><br><span class="line"><span class="string">    :param window_size: è¯çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line"><span class="string">    :param word_dict: è¯å…¸</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    seg_words = []  <span class="comment"># å­˜æ”¾åˆ†è¯ç»“æœ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> sentence:</span><br><span class="line">        <span class="keyword">for</span> word_len <span class="keyword">in</span> range(window_size, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> sentence[:word_len] <span class="keyword">in</span> word_dict:</span><br><span class="line">                <span class="comment"># å¦‚æœè¯¥è¯å†å­—å…¸ä¸­ï¼Œå°†è¯¥è¯ä¿å­˜åˆ°åˆ†è¯ç»“æœä¸­,å¹¶å°†å…¶ä»å¥ä¸­åˆ‡å‡ºæ¥</span></span><br><span class="line">                seg_words.append(sentence[:word_len])</span><br><span class="line">                sentence = sentence[word_len:]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># å¦‚æœçª—å£ä¸­çš„è¯ä¸åœ¨å­—å…¸ä¸­ï¼Œå°†ç¬¬ä¸€ä¸ªå­—åˆ‡åˆ†å‡ºæ¥</span></span><br><span class="line">            seg_words.append(sentence[:word_len])</span><br><span class="line">            sentence = sentence[word_len:]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'/'</span>.join(seg_words)</span><br></pre></td></tr></table></figure>
<h4 id="åå‘æœ€å¤§åŒ¹é…ç®—æ³•"><a href="#åå‘æœ€å¤§åŒ¹é…ç®—æ³•" class="headerlink" title="åå‘æœ€å¤§åŒ¹é…ç®—æ³•"></a>åå‘æœ€å¤§åŒ¹é…ç®—æ³•</h4><p>åœ¨è¯å…¸ä¸­ä»å¥å°¾å‘å¥é¦–è¿›è¡Œæ‰«æï¼Œå°½å¯èƒ½åœ°é€‰æ‹©ä¸è¯å…¸ä¸­æœ€é•¿å•è¯åŒ¹é…çš„è¯ä½œä¸ºç›®æ ‡åˆ†è¯ï¼Œç„¶åè¿›è¡Œä¸‹ä¸€æ¬¡åŒ¹é…ã€‚</p>
<p>åœ¨å®è·µä¸­ï¼Œé€†å‘æœ€å¤§åŒ¹é…ç®—æ³•æ€§èƒ½ä¼˜äºæ­£å‘æœ€å¤§åŒ¹é…ç®—æ³•ã€‚ </p>
<h5 id="ç®—æ³•æµç¨‹-1"><a href="#ç®—æ³•æµç¨‹-1" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h5><ol>
<li>ä»åå‘å‰æ‰«æå­—å…¸ï¼Œæµ‹è¯•è¯»å…¥çš„å­ä¸²æ˜¯å¦åœ¨å­—å…¸ä¸­</li>
<li>å¦‚æœå­˜åœ¨ï¼Œåˆ™ä»è¾“å…¥ä¸­åˆ é™¤æ‰è¯¥å­ä¸²ï¼Œé‡æ–°æŒ‰ç…§è§„åˆ™å–å­ä¸²ï¼Œé‡å¤1</li>
<li>å¦‚æœä¸å­˜åœ¨äºå­—å…¸ä¸­ï¼Œåˆ™ä»å·¦å‘å³å‡å°‘å­ä¸²é•¿åº¦ï¼Œé‡å¤1</li>
</ol>
<h5 id="åˆ†è¯å®ä¾‹"><a href="#åˆ†è¯å®ä¾‹" class="headerlink" title="åˆ†è¯å®ä¾‹"></a>åˆ†è¯å®ä¾‹</h5><p>è¾“å…¥ â€œåŒ—äº¬å¤§å­¦ç”Ÿå‰æ¥åº”è˜â€ï¼Œå‡è®¾è¯å…¸ä¸­æœ€é•¿çš„å•è¯ä¸º 5 ä¸ªï¼ˆMAX_LENGTHï¼‰ã€‚</p>
<ol>
<li>ç¬¬ä¸€è½®ï¼šå–å­ä¸² â€œç”Ÿå‰æ¥åº”è˜â€ï¼Œé€†å‘å–è¯ï¼Œå¦‚æœåŒ¹é…å¤±è´¥ï¼Œ<strong>æ¯æ¬¡å»æ‰åŒ¹é…å­—æ®µæœ€å‰é¢çš„ä¸€ä¸ªå­—</strong><br>â€œç”Ÿå‰æ¥åº”è˜â€ï¼Œæ‰«æ 5 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œå‰æ¥åº”è˜â€<br>â€œå‰æ¥åº”è˜â€ï¼Œæ‰«æ 4 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œæ¥åº”è˜â€<br>â€œæ¥åº”è˜â€ï¼Œæ‰«æ 3 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œåº”è˜â€<br>â€œåº”è˜â€ï¼Œæ‰«æ 2 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œåº”è˜â€ï¼Œè¾“å…¥å˜ä¸ºâ€œå¤§å­¦ç”Ÿå‰æ¥â€</li>
<li>ç¬¬äºŒè½®ï¼šå–å­ä¸²â€œå¤§å­¦ç”Ÿå‰æ¥â€<br>â€œå¤§å­¦ç”Ÿå‰æ¥â€ï¼Œæ‰«æ 5 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œå­¦ç”Ÿå‰æ¥â€<br>â€œå­¦ç”Ÿå‰æ¥â€ï¼Œæ‰«æ 4 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œç”Ÿå‰æ¥â€<br>â€œç”Ÿå‰æ¥â€ï¼Œæ‰«æ 3 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œå‰æ¥â€<br>â€œå‰æ¥â€ï¼Œæ‰«æ 2 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œå‰æ¥â€ï¼Œè¾“å…¥å˜ä¸ºâ€œåŒ—äº¬å¤§å­¦ç”Ÿâ€</li>
<li>ç¬¬ä¸‰è½®ï¼šå–å­ä¸²â€œåŒ—äº¬å¤§å­¦ç”Ÿâ€<br>â€œåŒ—äº¬å¤§å­¦ç”Ÿâ€ï¼Œæ‰«æ 5 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œäº¬å¤§å­¦ç”Ÿâ€<br>â€œäº¬å¤§å­¦ç”Ÿâ€ï¼Œæ‰«æ 4 å­—è¯å…¸ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œå­—ä¸²é•¿åº¦å‡ 1 å˜ä¸ºâ€œå¤§å­¦ç”Ÿâ€<br>â€œå¤§å­¦ç”Ÿâ€ï¼Œæ‰«æ 3 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œå¤§å­¦ç”Ÿâ€ï¼Œè¾“å…¥å˜ä¸ºâ€œåŒ—äº¬â€</li>
<li>ç¬¬å››è½®ï¼šå–å­ä¸²â€œåŒ—äº¬â€<br>â€œåŒ—äº¬â€ï¼Œæ‰«æ 2 å­—è¯å…¸ï¼Œæœ‰åŒ¹é…ï¼Œè¾“å‡ºâ€œåŒ—äº¬â€ï¼Œè¾“å…¥å˜ä¸ºâ€œâ€<br>è¾“å…¥é•¿åº¦ä¸º0ï¼Œæ‰«æç»ˆæ­¢</li>
</ol>
<h5 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><p>æ•°æ®å‡†å¤‡ï¼šè¯åº“</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backward_max_match</span><span class="params">(sentence, window_size, word_dict)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    åå‘æœ€å¤§åŒ¹é…ç®—æ³•ï¼š</span></span><br><span class="line"><span class="string">    ï¼ˆ1ï¼‰ä»åå‘å‰æ‰«æå­—å…¸ï¼Œæµ‹è¯•è¯»å…¥çš„å­ä¸²æ˜¯å¦åœ¨å­—å…¸ä¸­</span></span><br><span class="line"><span class="string">    ï¼ˆ2ï¼‰å¦‚æœå­˜åœ¨ï¼Œåˆ™ä»è¾“å…¥ä¸­åˆ é™¤æ‰è¯¥å­ä¸²ï¼Œé‡æ–°æŒ‰ç…§è§„åˆ™å–å­ä¸²ï¼Œé‡å¤ï¼ˆ1ï¼‰</span></span><br><span class="line"><span class="string">    ï¼ˆ3ï¼‰å¦‚æœä¸å­˜åœ¨äºå­—å…¸ä¸­ï¼Œåˆ™ä»å³å‘å·¦å‡å°‘å­ä¸²é•¿åº¦ï¼Œé‡å¤ï¼ˆ1ï¼‰</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param sentence: å¾…åˆ†è¯çš„å¥å­</span></span><br><span class="line"><span class="string">    :param window_size: è¯çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line"><span class="string">    :param word_dict: è¯å…¸</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    seg_words = []</span><br><span class="line">    <span class="keyword">while</span> sentence:</span><br><span class="line">        <span class="keyword">for</span> word_len <span class="keyword">in</span> range(window_size, <span class="number">0</span>, <span class="number">-1</span>):  <span class="comment"># æ¯æ¬¡å»æ‰åŒ¹é…å­—æ®µæœ€å‰é¢çš„ä¸€ä¸ªå­—</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> sentence[len(sentence) - word_len:] <span class="keyword">in</span> word_dict:</span><br><span class="line">                <span class="comment"># å¦‚æœè¯¥è¯å†å­—å…¸ä¸­ï¼Œå°†è¯¥è¯ä¿å­˜åˆ°åˆ†è¯ç»“æœä¸­,å¹¶å°†å…¶ä»å¥ä¸­åˆ‡å‡ºæ¥</span></span><br><span class="line">                seg_words.append(sentence[len(sentence) - word_len:])</span><br><span class="line">                sentence = sentence[:len(sentence) - word_len]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># å¦‚æœçª—å£ä¸­çš„è¯ä¸åœ¨å­—å…¸ä¸­ï¼Œå°†æœ€åä¸€ä¸ªå­—åˆ‡åˆ†å‡ºæ¥</span></span><br><span class="line">            seg_words.append(sentence[<span class="number">-1</span>:])</span><br><span class="line">            sentence = sentence[:<span class="number">-1</span>]</span><br><span class="line">    seg_words.reverse()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'/'</span>.join(seg_words)</span><br></pre></td></tr></table></figure>
<h4 id="åŒå‘æœ€å¤§åŒ¹é…æ³•"><a href="#åŒå‘æœ€å¤§åŒ¹é…æ³•" class="headerlink" title="åŒå‘æœ€å¤§åŒ¹é…æ³•"></a>åŒå‘æœ€å¤§åŒ¹é…æ³•</h4><p>å› ä¸ºåŒä¸€ä¸ªå¥å­ï¼Œåœ¨æœºæ¢°åˆ†è¯ä¸­ç»å¸¸ä¼šå‡ºç°å¤šç§åˆ†è¯çš„ç»„åˆï¼Œå› æ­¤éœ€è¦è¿›è¡Œæ­§ä¹‰æ¶ˆé™¤ï¼Œæ¥å¾—åˆ°æœ€ä¼˜çš„åˆ†è¯ç»“æœã€‚</p>
<p>ä»¥å¾ˆå¸¸è§çš„MMSEGæœºæ¢°åˆ†è¯ç®—æ³•ä¸ºä¾‹ï¼ŒMMSEGåœ¨æœç´¢å¼•æ“Solrä¸­ç»å¸¸ä½¿ç”¨åˆ°ï¼Œæ˜¯ä¸€ç§éå¸¸å¯é é«˜æ•ˆçš„åˆ†è¯ç®—æ³•ã€‚MMSEGæ¶ˆé™¤æ­§ä¹‰çš„è§„åˆ™æœ‰å››ä¸ªï¼Œå®ƒåœ¨ä½¿ç”¨ä¸­ä¾æ¬¡ç”¨è¿™å››ä¸ªè§„åˆ™è¿›è¡Œè¿‡æ»¤ï¼Œç›´åˆ°åªæœ‰ä¸€ç§ç»“æœæˆ–è€…ç¬¬å››ä¸ªè§„åˆ™ä½¿ç”¨å®Œæ¯•ã€‚è¿™ä¸ªå››ä¸ªè§„åˆ™åˆ†åˆ«æ˜¯ï¼š</p>
<ol>
<li><p>æœ€å¤§åŒ¹é…ã€‚é€‰æ‹©â€œè¯ç»„é•¿åº¦æœ€å¤§çš„â€é‚£ä¸ªè¯ç»„ï¼Œç„¶åé€‰æ‹©è¿™ä¸ªè¯ç»„çš„ç¬¬ä¸€ä¸ªè¯ï¼Œä½œä¸ºåˆ‡åˆ†å‡ºçš„ç¬¬ä¸€ä¸ªè¯ï¼Œå¦‚å¯¹äºâ€œä¸­å›½äººæ°‘ä¸‡å²â€ï¼ŒåŒ¹é…ç»“æœåˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>ä¸­/å›½/äºº</li>
<li>ä¸­å›½/äºº/æ°‘</li>
<li>ä¸­å›½/äººæ°‘/ä¸‡å²</li>
<li>ä¸­å›½äºº/æ°‘/ä¸‡å²</li>
</ul>
<p>åœ¨è¿™ä¸ªä¾‹å­â€œè¯ç»„é•¿åº¦æœ€é•¿çš„â€è¯ç»„ä¸ºåä¸¤ä¸ªï¼Œå› æ­¤é€‰æ‹©äº†â€œä¸­å›½äºº/æ°‘/ä¸‡å²â€ä¸­çš„â€œä¸­å›½äººâ€ï¼Œæˆ–è€…â€œä¸­å›½/äººæ°‘/ä¸‡å²â€ä¸­çš„â€œä¸­å›½â€ã€‚</p>
</li>
<li><p>æœ€å¤§å¹³å‡è¯è¯­é•¿åº¦ã€‚ç»è¿‡è§„åˆ™1è¿‡æ»¤åï¼Œå¦‚æœå‰©ä½™çš„è¯ç»„è¶…è¿‡1ä¸ªï¼Œé‚£å°±é€‰æ‹©å¹³å‡è¯è¯­é•¿åº¦æœ€å¤§çš„é‚£ä¸ª(å¹³å‡è¯é•¿=è¯ç»„æ€»å­—æ•°/è¯è¯­æ•°é‡)ã€‚æ¯”å¦‚â€œç”Ÿæ´»æ°´å¹³â€ï¼Œå¯èƒ½å¾—åˆ°å¦‚ä¸‹è¯ç»„ï¼š</p>
<ul>
<li>ç”Ÿ/æ´»æ°´/å¹³ (4/3=1.33)</li>
<li>ç”Ÿæ´»/æ°´/å¹³ (4/3=1.33)</li>
<li>ç”Ÿæ´»/æ°´å¹³ (4/2=2)</li>
</ul>
<p>æ ¹æ®æ­¤è§„åˆ™ï¼Œå°±å¯ä»¥ç¡®å®šé€‰æ‹©â€œç”Ÿæ´»/æ°´å¹³â€è¿™ä¸ªè¯ç»„</p>
</li>
<li><p>è¯è¯­é•¿åº¦çš„æœ€å°å˜åŒ–ç‡ã€‚è¿™ä¸ªå˜åŒ–ç‡ä¸€èˆ¬å¯ä»¥ç”±æ ‡å‡†å·®æ¥å†³å®šã€‚æ¯”å¦‚å¯¹äºâ€œä¸­å›½äººæ°‘ä¸‡å²â€è¿™ä¸ªçŸ­è¯­ï¼Œå¯ä»¥è®¡ç®—ï¼š</p>
<ul>
<li>ä¸­å›½/äººæ°‘/ä¸‡å²(æ ‡å‡†å·®=sqrt(((2-2)^2+(2-2)^2+(2-2^2))/3)=0)</li>
<li>ä¸­å›½äºº/æ°‘/ä¸‡å²(æ ‡å‡†å·®=sqrt(((2-3)^2+(2-1)^2+(2-2)^2)/3)=0.8165)</li>
</ul>
<p>äºæ˜¯é€‰æ‹©â€œä¸­å›½/äººæ°‘/ä¸‡å²â€è¿™ä¸ªè¯ç»„ã€‚</p>
</li>
<li><p>è®¡ç®—è¯ç»„ä¸­çš„æ‰€æœ‰å•å­—è¯è¯é¢‘çš„è‡ªç„¶å¯¹æ•°ï¼Œç„¶åå°†å¾—åˆ°çš„å€¼ç›¸åŠ ï¼Œå–æ€»å’Œæœ€å¤§çš„è¯ç»„ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>è®¾æ–½/å’Œæœ/åŠ¡</li>
<li>è®¾æ–½/å’Œ/æœåŠ¡</li>
</ul>
<p>è¿™ä¸¤ä¸ªè¯ç»„ä¸­åˆ†åˆ«æœ‰â€œåŠ¡â€å’Œâ€œå’Œâ€è¿™ä¸¤ä¸ªå•å­—è¯ï¼Œå‡è®¾â€œåŠ¡â€ä½œä¸ºå•å­—è¯æ—¶å€™çš„é¢‘ç‡æ˜¯5ï¼Œâ€œå’Œâ€ä½œä¸ºå•å­—è¯æ—¶å€™çš„é¢‘ç‡æ˜¯10ï¼Œå¯¹5å’Œ10å–è‡ªç„¶å¯¹æ•°ï¼Œç„¶åå–æœ€å¤§å€¼è€…ï¼Œæ‰€ä»¥å–â€œå’Œâ€å­—æ‰€åœ¨çš„è¯ç»„ï¼Œå³â€œè®¾æ–½/å’Œ/æœåŠ¡â€ã€‚</p>
</li>
</ol>
<p>åœ¨å®é™…ä¸­æ ¹æ®éœ€æ±‚ï¼Œé€‰æ‹©æˆ–åˆ¶å®šç›¸åº”çš„è§„åˆ™æ¥æ”¹å–„åˆ†è¯çš„è´¨é‡ã€‚</p>
<h5 id="ç®—æ³•æµç¨‹-2"><a href="#ç®—æ³•æµç¨‹-2" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h5><ol>
<li>æ¯”è¾ƒæ­£å‘æœ€å¤§åŒ¹é…å’Œé€†å‘æœ€å¤§åŒ¹é…ç»“æœ</li>
<li>å¦‚æœåˆ†è¯æ•°é‡ç»“æœä¸åŒï¼Œé‚£ä¹ˆå–åˆ†è¯æ•°é‡è¾ƒå°‘çš„é‚£ä¸ª</li>
<li>å¦‚æœåˆ†è¯æ•°é‡ç»“æœç›¸åŒ<ul>
<li>åˆ†è¯ç»“æœç›¸åŒï¼Œå¯ä»¥è¿”å›ä»»ä½•ä¸€ä¸ª</li>
<li>åˆ†è¯ç»“æœä¸åŒï¼Œè¿”å›å•å­—æ•°æ¯”è¾ƒå°‘çš„é‚£ä¸ª</li>
</ul>
</li>
</ol>
<p>è¿™ç§è§„åˆ™çš„å‡ºå‘ç‚¹æ¥è‡ªè¯­è¨€å­¦ä¸Šçš„å¯å‘ï¼šæ±‰è¯­ä¸­å•å­—è¯çš„æ•°é‡è¦è¿œå°äºéå•å­—è¯ã€‚å› æ­¤ï¼Œç®—æ³•åº”å½“å°½é‡å‡å°‘ç»“æœä¸­çš„å•å­—ï¼Œä¿ç•™æ›´å¤šçš„å®Œæ•´è¯è¯­ã€‚</p>
<h5 id="åˆ†è¯å®ä¾‹-1"><a href="#åˆ†è¯å®ä¾‹-1" class="headerlink" title="åˆ†è¯å®ä¾‹"></a>åˆ†è¯å®ä¾‹</h5><p>æ­£å‘åŒ¹é…æœ€ç»ˆåˆ‡åˆ†ç»“æœä¸ºï¼šåŒ—äº¬å¤§å­¦ / ç”Ÿå‰ / æ¥ / åº”è˜ï¼Œåˆ†è¯æ•°é‡ä¸º 4ï¼Œå•å­—æ•°ä¸º 1<br>é€†å‘åŒ¹é…æœ€ç»ˆåˆ‡åˆ†ç»“æœä¸ºï¼šâ€åŒ—äº¬/ å¤§å­¦ç”Ÿ/ å‰æ¥ / åº”è˜ï¼Œåˆ†è¯æ•°é‡ä¸º 4ï¼Œå•å­—æ•°ä¸º 0<br>é€†å‘åŒ¹é…å•å­—æ•°å°‘ï¼Œå› æ­¤è¿”å›é€†å‘åŒ¹é…çš„ç»“æœã€‚</p>
<h5 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><p>æ•°æ®å‡†å¤‡ï¼šè¯åº“</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_max_match</span><span class="params">(sentence,window_size,word_dict)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    1. æ¯”è¾ƒæ­£å‘æœ€å¤§åŒ¹é…å’Œé€†å‘æœ€å¤§åŒ¹é…ç»“æœ</span></span><br><span class="line"><span class="string">    2. å¦‚æœåˆ†è¯æ•°é‡ç»“æœä¸åŒï¼Œé‚£ä¹ˆå–åˆ†è¯æ•°é‡è¾ƒå°‘çš„é‚£ä¸ª</span></span><br><span class="line"><span class="string">    3. å¦‚æœåˆ†è¯æ•°é‡ç»“æœç›¸åŒ</span></span><br><span class="line"><span class="string">       * åˆ†è¯ç»“æœç›¸åŒï¼Œå¯ä»¥è¿”å›ä»»ä½•ä¸€ä¸ª</span></span><br><span class="line"><span class="string">       * åˆ†è¯ç»“æœä¸åŒï¼Œè¿”å›å•å­—æ•°æ¯”è¾ƒå°‘çš„é‚£ä¸ª</span></span><br><span class="line"><span class="string">    :param sentence: å¾…åˆ†è¯çš„å¥å­</span></span><br><span class="line"><span class="string">    :param window_size: è¯çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line"><span class="string">    :param word_dict: è¯å…¸</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    forward_seg = forward_max_match(sentence,window_size,word_dict)</span><br><span class="line">    backward_seg = backward_max_match(sentence,window_size,word_dict)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœåˆ†è¯ç»“æœä¸åŒï¼Œè¿”å›è¯æ•°è¾ƒå°çš„åˆ†è¯ç»“æœ</span></span><br><span class="line">    <span class="keyword">if</span> len(forward_seg) != len(backward_seg):</span><br><span class="line">        <span class="keyword">return</span> forward_seg <span class="keyword">if</span> len(forward_seg) &lt; len(backward_seg) <span class="keyword">else</span> backward_seg</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># å¦‚æœåˆ†è¯ç»“æœè¯æ•°ç›¸åŒï¼Œä¼˜å…ˆè€ƒè™‘è¿”å›åŒ…å«å•ä¸ªå­—ç¬¦æœ€å°‘çš„åˆ†è¯ç»“æœ</span></span><br><span class="line">        forward_single_word_count = len([filter(<span class="keyword">lambda</span> x:len(x) == <span class="number">1</span>,forward_seg)])</span><br><span class="line">        backward_single_word_count = len([filter(<span class="keyword">lambda</span> x:len(x) == <span class="number">1</span>,backward_seg)])</span><br><span class="line">        <span class="keyword">if</span> forward_single_word_count != backward_single_word_count:</span><br><span class="line">            <span class="keyword">return</span> forward_seg <span class="keyword">if</span> forward_single_word_count &lt; backward_single_word_count <span class="keyword">else</span> backward_seg</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># å¦åˆ™ï¼Œè¿”å›ä»»æ„ç»“æœ</span></span><br><span class="line">            <span class="keyword">return</span> forward_seg</span><br></pre></td></tr></table></figure>
<h5 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><p>å¯¹æ­§ä¹‰é—®é¢˜çš„è§£å†³æœ‰ç‚¹å¼±</p>
<h4 id="N-æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•"><a href="#N-æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•" class="headerlink" title="(N-)æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•"></a>(N-)æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•</h4><h5 id="åŸºæœ¬æ€æƒ³"><a href="#åŸºæœ¬æ€æƒ³" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h5><p>é¦–å…ˆåŸºäºè¯å…¸å¯¹æ–‡æœ¬è¿›è¡Œå…¨åˆ‡åˆ†(æ”¹ç¼–ç‰ˆæœ€å¤§åŒ¹é…)ï¼›ç„¶ååŸºäºè¯è¯­çš„ä¸´æ¥å…³ç³»æ„å»ºä¸€ä¸ªæœ‰å‘å›¾ï¼›ä½¿ç”¨æ¨¡å‹(æ¯”å¦‚ä¸€é˜¶é©¬å°”ç§‘å¤«æ¨¡å‹)å¯¹å›¾é‡Œçš„è¾¹åŠ æƒï¼›æœ€åä½¿ç”¨æœ€çŸ­è·¯å¾„ç®—æ³•æ±‚ï¼Œä»å¥é¦–åˆ°å¥æœ«è´¨é‡æœ€é«˜(æ¯”å¦‚æ¦‚ç‡æœ€å¤§)çš„è·¯å¾„ï¼Œå°±å¾—åˆ°äº†åˆ†è¯ç»“æœã€‚</p>
<h5 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h5><p>æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•é¦–å…ˆå°†ä¸€å¥è¯ä¸­çš„æ‰€æœ‰è¯åŒ¹é…å‡ºæ¥ï¼Œæ„æˆè¯å›¾ï¼ˆæœ‰å‘æ— ç¯å›¾DAGï¼‰ï¼Œä¹‹åå¯»æ‰¾ä»èµ·å§‹ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·¯å¾„ä½œä¸ºæœ€ä½³ç»„åˆæ–¹å¼ï¼Œä»¥â€œä»–è¯´çš„ç¡®å®åœ¨ç†â€ä¸ºä¾‹ï¼Œç»™å‡ºå¯¹è¿™å¥è¯çš„3-æœ€çŸ­è·¯ï¼š<br><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/æœ€çŸ­è·¯å¾„åˆ†è¯ç®—æ³•.png" alt="avatar"></p>
<ol>
<li><p>æ„å»ºæœ‰å‘å›¾ï¼šæ ¹æ®ä¸€ä¸ªå·²æœ‰è¯å…¸æ„é€ å‡ºçš„æœ‰å‘æ— ç¯å›¾ï¼ˆå…¨åˆ‡åˆ†ï¼Œæ ¹æ®ä¸´æ¥å…³ç³»æ„å»ºæœ‰å‘å›¾ï¼‰ã€‚å®ƒå°†å­—ä¸²åˆ†ä¸ºå•ä¸ªçš„å­—ï¼Œæ¯ä¸ªå­—ç”¨å›¾ä¸­ç›¸é‚»çš„ä¸¤ä¸ªç»“ç‚¹è¡¨ç¤ºï¼Œæ•…å¯¹äºé•¿åº¦ä¸ºnçš„å­—ä¸²ï¼Œéœ€è¦n+1ä¸ªç»“ç‚¹ã€‚ä¸¤èŠ‚ç‚¹é—´è‹¥æœ‰è¾¹ï¼Œåˆ™è¡¨ç¤ºä¸¤èŠ‚ç‚¹é—´æ‰€åŒ…å«çš„æ‰€æœ‰ç»“ç‚¹æ„æˆçš„è¯ï¼Œå¦‚å›¾ä¸­ç»“ç‚¹2ã€3ã€4æ„æˆè¯â€œçš„ç¡®â€ã€‚</p>
</li>
<li><p>è®¡ç®—æƒé‡ï¼šæœ¬ä¾‹å­ä¸­æƒé‡ä¸º1ï¼ˆä¸ºäº†ç®€å•ï¼‰ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸€é˜¶é©¬å°”ç§‘å¤«æ¨¡å‹è¿›è¡Œæƒé‡è®¡ç®—ã€‚</p>
<ul>
<li>p(å®ï¼Œåœ¨)=p(å®)*p(åœ¨|å®)ã€‚æ¦‚ç‡å–å€¼è¶Šå¤§ï¼Œè¯´æ˜ä¸€ä¸ªè¾¹å‡ºç°çš„æ¦‚ç‡è¶Šå¤§ï¼Œè¿™æ¡è¾¹ä¼šæå‡æ‰€åœ¨åˆ†å¥ç»“æœçš„æ¦‚ç‡ï¼Œç”±äºæœ€åè¦è®¡ç®—æœ€çŸ­è·¯å¾„ï¼Œéœ€è¦æ„é€ ä¸€ä¸ªè¿æ¥æƒé‡ä¸åˆ†å±€ç»“æœè´¨é‡æˆåæ¯”çš„æŒ‡æ ‡ï¼Œå› æ­¤å¯¹æ¦‚ç‡å–äº†å€’ï¼šweight=1/p(å®,åœ¨)</li>
<li><p>è¿™ä¸ªæ¦‚ç‡å¯èƒ½éå¸¸å°ï¼Œå¾—åˆ°çš„æƒé‡å–å€¼éå¸¸å¤§ã€‚è€Œæˆ‘ä»¬åé¢åœ¨è®¡ç®—è·¯å¾„çš„é•¿åº¦æ—¶ï¼Œä¼šå°†è‹¥å¹²ä¸ªè¾¹çš„æƒé‡åŠ èµ·æ¥ï¼Œè¿™æ—¶å€™æœ‰ä¸Šæº¢å‡ºçš„å¯èƒ½æ€§ã€‚é¿å…ä¸Šæº¢å‡ºçš„å¸¸ç”¨ç­–ç•¥æ˜¯å–å¯¹æ•°ã€‚ï¼šweight=log(1/p(å®ï¼Œåœ¨))ã€‚</p>
</li>
<li><p>æ¦‚ç‡çš„ä¼°ç®—ï¼šæ¦‚ç‡å°±ç”¨é¢‘ç‡æ¥ä¼°è®¡ï¼Œp(å®) = ï¼ˆâ€œå®â€å­—åœ¨è¯­æ–™ä¸­å‡ºç°çš„æ¬¡æ•°ï¼‰/ï¼ˆè¯­æ–™çš„æ€»è¯æ•°ï¼‰ï¼Œ</p>
<p>p(åœ¨|å®) = p(å®åœ¨)/p(å®)=(â€œå®åœ¨â€åœ¨è¯­æ–™ä¸­å‡ºç°çš„æ¬¡æ•°)/(â€œå®â€åœ¨è¯­æ–™ä¸­å‡ºç°çš„æ¬¡æ•°)</p>
</li>
</ul>
</li>
</ol>
<h5 id="ä»£ç ï¼ˆç»´ç‰¹æ¯”ï¼‰"><a href="#ä»£ç ï¼ˆç»´ç‰¹æ¯”ï¼‰" class="headerlink" title="ä»£ç ï¼ˆç»´ç‰¹æ¯”ï¼‰"></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç ï¼ˆç»´ç‰¹æ¯”ï¼‰</a></h5><p>æ•°æ®å‡†å¤‡ï¼š1ã€è¯åº“ï¼Œ2ã€è¯è¯­ä¹‹é—´çš„æ¡ä»¶æ¦‚ç‡ï¼ˆç”¨æ¥è®¡ç®—è·¯å¾„æƒé‡ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ç»´ç‰¹æ¯”ç®—æ³•æ±‚è¯å›¾çš„æœ€çŸ­è·¯å¾„</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">viterbi</span><span class="params">(self, word_graph)</span>:</span></span><br><span class="line">    path_length_map = &#123;&#125;  <span class="comment"># ç”¨äºå­˜å‚¨æ‰€æœ‰çš„è·¯å¾„ï¼Œåé¢çš„é‚»æ¥è¯è¯­æ‰€åœ¨ä½ç½®ï¼Œä»¥åŠå¯¹åº”çš„é•¿åº¦</span></span><br><span class="line">    word_graph = [[[<span class="string">"&lt;start&gt;"</span>, <span class="number">1</span>]]] + word_graph + [[[<span class="string">"&lt;end&gt;"</span>, <span class="number">-1</span>]]]</span><br><span class="line">    <span class="comment"># è¿™æ˜¯ä¸€ç§æ¯”è¾ƒç®€å•çš„æ•°æ®ç»“æ„</span></span><br><span class="line">    path_length_map[(<span class="string">"&lt;start&gt;"</span>,)] = [<span class="number">1</span>, <span class="number">0</span>]  <span class="comment"># startå¤„ï¼Œåé¢çš„ä¸´æ¥è¯è¯­åœ¨åˆ—è¡¨çš„1å¤„ï¼Œè·¯å¾„é•¿åº¦æ˜¯0,ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(word_graph)):</span><br><span class="line">        distance_from_start2current = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> len(word_graph[i]) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> former_path <span class="keyword">in</span> list(path_length_map.keys()):  <span class="comment"># path_length_mapå†…å®¹ä¸€ç›´åœ¨å˜ï¼Œéœ€è¦æ·±æ‹·è´key,ä¹Ÿå°±æ˜¯å·²ç»ç§¯ç´¯çš„æ‰€æœ‰è·¯å¾„</span></span><br><span class="line">            <span class="comment"># å–å‡ºå·²ç»ç§¯ç´¯çš„è·¯å¾„ï¼Œåé¢çš„ä¸´æ¥è¯è¯­ä½ç½®ï¼Œä»¥åŠè·¯å¾„çš„é•¿åº¦ã€‚</span></span><br><span class="line">            [next_index_4_former_path, former_distance] = path_length_map[former_path]</span><br><span class="line">            former_word = former_path[<span class="number">-1</span>]</span><br><span class="line">            later_path = list(former_path)</span><br><span class="line">            <span class="keyword">if</span> next_index_4_former_path == i:  <span class="comment"># å¦‚æœè¿™æ¡è·¯å¾„çš„ä¸´æ¥è¯è¯­çš„ä½ç½®å°±æ˜¯å½“å‰ç´¢å¼•</span></span><br><span class="line">                <span class="keyword">for</span> current_word <span class="keyword">in</span> word_graph[i]:  <span class="comment"># éå†è¯å›¾æ•°æ®ä¸­ï¼Œè¿™ä¸ªä½ç½®ä¸Šçš„æ‰€æœ‰æ¢é€‰è¯è¯­ï¼Œç„¶åä¸former_pathæ‹¼æ¥æ–°è·¯å¾„</span></span><br><span class="line">                    current_word, next_index = current_word</span><br><span class="line">                    new_path = tuple(later_path + [current_word])  <span class="comment"># åªæœ‰int, string, tupleè¿™ç§ä¸å¯ä¿®æ”¹çš„æ•°æ®ç±»å‹å¯ä»¥hashï¼Œ</span></span><br><span class="line">                    <span class="comment"># ä¹Ÿå°±æ˜¯æˆä¸ºdictçš„key</span></span><br><span class="line">                    <span class="comment"># è®¡ç®—æ–°è·¯å¾„çš„é•¿åº¦</span></span><br><span class="line">                    new_path_len = former_distance + self.word_distance.get((former_word, current_word), <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">                    path_length_map[new_path] = [next_index, new_path_len]  <span class="comment"># å­˜å‚¨æ–°è·¯å¾„åé¢çš„ä¸´æ¥è¯è¯­ï¼Œä»¥åŠè·¯å¾„é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment"># ç»´ç‰¹æ¯”çš„éƒ¨åˆ†ã€‚é€‰æ‹©åˆ°è¾¾å½“å‰èŠ‚ç‚¹çš„è·¯å¾„ä¸­ï¼Œæœ€çŸ­çš„é‚£ä¸€æ¡</span></span><br><span class="line">                    <span class="keyword">if</span> current_word <span class="keyword">in</span> distance_from_start2current:  <span class="comment"># å¦‚æœå·²ç»æœ‰åˆ°è¾¾å½“å‰è¯è¯­çš„è·¯å¾„ï¼Œéœ€è¦æ‹©ä¼˜</span></span><br><span class="line">                        <span class="keyword">if</span> distance_from_start2current[current_word][<span class="number">1</span>] &gt; new_path_len:  <span class="comment"># å¦‚æœå½“å‰æ–°è·¯å¾„æ¯”å·²æœ‰çš„æ›´çŸ­</span></span><br><span class="line">                            distance_from_start2current[current_word] = [new_path, new_path_len]  <span class="comment"># ç”¨æ›´çŸ­çš„è·¯å¾„æ•°æ®è¦†ç›–åŸæ¥çš„</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        distance_from_start2current[current_word] = [new_path, new_path_len]  <span class="comment"># å¦‚æœè¿˜æ²¡æœ‰è¿™æ¡è·¯å¾„ï¼Œå°±è®°å½•å®ƒ</span></span><br><span class="line">    shortest_path = distance_from_start2current[<span class="string">"&lt;end&gt;"</span>][<span class="number">0</span>]</span><br><span class="line">    shortest_path = shortest_path[<span class="number">1</span>:<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> shortest_path</span><br></pre></td></tr></table></figure>
<h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ol>
<li>å¯¹æ­§ä¹‰å’Œæ–°è¯çš„å¤„ç†ä¸æ˜¯å¾ˆå¥½ï¼Œå¯¹è¯å…¸ä¸­æœªå‡ºç°çš„è¯æ²¡æ³•è¿›è¡Œå¤„ç†ã€‚</li>
<li>åˆ†è¯æ•ˆæœå–å†³äºè¯å…¸çš„è´¨é‡ã€‚</li>
</ol>
<h3 id="åŸºäºç»Ÿè®¡ä»¥åŠæœºå™¨å­¦ä¹ çš„åˆ†è¯æ–¹æ³•"><a href="#åŸºäºç»Ÿè®¡ä»¥åŠæœºå™¨å­¦ä¹ çš„åˆ†è¯æ–¹æ³•" class="headerlink" title="åŸºäºç»Ÿè®¡ä»¥åŠæœºå™¨å­¦ä¹ çš„åˆ†è¯æ–¹æ³•"></a>åŸºäºç»Ÿè®¡ä»¥åŠæœºå™¨å­¦ä¹ çš„åˆ†è¯æ–¹æ³•</h3><h4 id="åŸºäºN-gramè¯­è¨€æ¨¡å‹çš„åˆ†è¯æ–¹æ³•"><a href="#åŸºäºN-gramè¯­è¨€æ¨¡å‹çš„åˆ†è¯æ–¹æ³•" class="headerlink" title="åŸºäºN-gramè¯­è¨€æ¨¡å‹çš„åˆ†è¯æ–¹æ³•"></a>åŸºäºN-gramè¯­è¨€æ¨¡å‹çš„åˆ†è¯æ–¹æ³•</h4><h5 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h5><p>n-gramæ¨¡å‹ï¼Œç§°ä¸ºNå…ƒæ¨¡å‹ï¼Œå¯ç”¨äºå®šä¹‰å­—ç¬¦ä¸²ä¸­çš„è·ç¦»ï¼Œä¹Ÿå¯ç”¨äºä¸­æ–‡çš„åˆ†è¯ï¼›è¯¥æ¨¡å‹å‡è®¾ç¬¬nä¸ªè¯çš„å‡ºç°åªä¸å‰é¢n-1ä¸ªè¯ç›¸å…³ï¼Œä¸å…¶ä»–è¯éƒ½ä¸ç›¸å…³ï¼Œæ•´ä¸ªè¯­å¥çš„æ¦‚ç‡å°±æ˜¯å„ä¸ªè¯å‡ºç°æ¦‚ç‡çš„ä¹˜ç§¯ï¼›è€Œè¿™äº›æ¦‚ç‡ï¼Œåˆ©ç”¨è¯­æ–™ï¼Œç»Ÿè®¡åŒæ—¶å‡ºç°ç›¸å…³è¯çš„æ¦‚ç‡æ¬¡æ•°è®¡ç®—å¾—åˆ°ï¼›å¸¸ç”¨çš„æ¨¡å‹æ˜¯Bi-gramå’ŒTri-gramæ¨¡å‹ã€‚<br>å‡è®¾ä¸€ä¸ªå­—ç¬¦ä¸²sç”±mä¸ªè¯ç»„æˆï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è®¡ç®—å‡º$p(w_1,w_2,\ldots,w_m)$çš„æ¦‚ç‡ï¼Œæ ¹æ®æ¦‚ç‡è®ºä¸­çš„é“¾å¼æ³•åˆ™å¾—åˆ°å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
p(w_1,w_2,\ldots,w_m) = p(w_1)*p(w_2|w_1)*p(w_3|w_2,w_1)\ldots p(w_m|w_{m-1},\ldots,w_2,w_1)=\prod_{i}{p(w_i|w_1,w_2,\ldots,w_{i-1})}</script><p>é‚£ä¹ˆä¸‹é¢çš„é—®é¢˜æ˜¯å¦‚ä½•è®¡ç®—ä¸Šé¢æ¯ä¸€ä¸ªæ¦‚ç‡ï¼Œæ¯”å¦‚$p(w_1,w_2,w_3,w_4,w_5)$ï¼Œä¸€ç§æ¯”è¾ƒç›´è§‚çš„è®¡ç®—å°±æ˜¯è®¡æ•°ç„¶åç”¨é™¤æ³•ï¼š</p>
<script type="math/tex; mode=display">
p(w_5|w_1,w_2,w_3,w_4) = \frac{Count(w_1,w_2,w_3,w_4,w_5)}{Count(w_1,w_2,w_3,w_4)}</script><p>ç›´æ¥è®¡ç®—è¿™ä¸ªæ¦‚ç‡çš„éš¾åº¦æœ‰ç‚¹å¤§ï¼š</p>
<ol>
<li><p>ç›´æ¥è¿™æ ·è®¡ç®—ä¼šå¯¼è‡´å‚æ•°ç©ºé—´è¿‡å¤§ã€‚</p>
<p>ä¸€ä¸ªè¯­è¨€æ¨¡å‹çš„å‚æ•°å°±æ˜¯æ‰€æœ‰çš„è¿™äº›æ¡ä»¶æ¦‚ç‡ï¼Œè¯•æƒ³æŒ‰ä¸Šé¢æ–¹å¼è®¡ç®—$p(w_5|w_1,w_2,w_3,w_4)$,è¿™é‡Œ$w_5$æœ‰è¯å…¸å¤§å°å–å€¼çš„å¯èƒ½ï¼Œè®°è¯å…¸å¤§å°ï¼š$|V|$ï¼Œåˆ™è¯¥æ¨¡å‹çš„å‚æ•°ä¸ªæ•°æ˜¯$|V|^5$ï¼Œè€Œä¸”è¿™è¿˜ä¸åŒ…å«$P(w_4|w_1,w_2,w_3)$çš„ä¸ªæ•°ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ ·å»è®¡ç®—æ¡ä»¶æ¦‚ç‡ä¼šä½¿è¯­è¨€æ¨¡å‹å‚æ•°ä¸ªæ•°è¿‡å¤šè€Œæ— æ³•ä½¿ç”¨ã€‚</p>
</li>
<li><p>æ•°æ®ç¨€ç–ä¸¥é‡ã€‚æˆ‘çš„ç†è§£æ˜¯åƒä¸Šé¢é‚£æ ·è®¡æ•°è®¡ç®—ï¼Œæ¯”å¦‚è®¡æ•°åˆ†å­$w_1,w_2,w_3,w_4,w_5$,åœ¨æˆ‘ä»¬æ‰€èƒ½è§çš„æ–‡æœ¬ä¸­å‡ºç°çš„æ¬¡æ•°æ˜¯å¾ˆå°çš„ï¼Œè¿™æ ·è®¡ç®—çš„ç»“æœæ˜¯è¿‡å¤šçš„æ¡ä»¶æ¦‚ç‡ä¼šç­‰äº0ï¼Œå› ä¸ºæˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰çœ‹åˆ°è¶³å¤Ÿçš„æ–‡æœ¬æ¥ç»Ÿè®¡ï¼å‡è®¾ä¸€ä¸ªè¯­æ–™åº“ä¸­å•è¯çš„æ•°é‡ä¸º$|V|$ä¸ªï¼Œä¸€ä¸ªå¥å­ç”±$n$ä¸ªè¯ç»„æˆï¼Œé‚£ä¹ˆæ¯ä¸ªå•è¯éƒ½å¯èƒ½æœ‰$|V|$ä¸ªå–å€¼ï¼Œé‚£ä¹ˆç”±è¿™äº›è¯ç»„æˆçš„$n$å…ƒç»„åˆçš„æ•°ç›®ä¸º$|V|^n$ç§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»„åˆæ•°ä¼šéšç€$n$çš„å¢åŠ è€Œå‘ˆç°æŒ‡æ•°çº§åˆ«çš„å¢é•¿ï¼Œéšç€$n$çš„å¢åŠ ï¼Œè¯­æ–™æ•°æ®åº“èƒ½å¤Ÿæä¾›çš„æ•°æ®æ˜¯éå¸¸æœ‰é™çš„ï¼Œé™¤éæœ‰æµ·é‡çš„å„ç§ç±»å‹çš„è¯­æ–™æ•°æ®ï¼Œå¦åˆ™è¿˜æœ‰å¤§é‡çš„$n$å…ƒç»„åˆéƒ½æ²¡æœ‰åœ¨è¯­æ–™åº“ä¸­å‡ºç°è¿‡ï¼ˆå³ç”±$n$ä¸ªå•è¯æ‰€ç»„æˆçš„ä¸€äº›å¥å­æ ¹æœ¬å°±æ²¡å‡ºç°è¿‡ï¼Œå¯ä»¥ç†è§£ä¸ºå¾ˆå¤šçš„$n$å…ƒç»„æ‰€ç»„æˆçš„å¥å­ä¸èƒ½è¢«äººå¾ˆå¥½åœ°ç†è§£ï¼‰ä¹Ÿå°±æ˜¯è¯´ä¾æ®æœ€å¤§ä¼¼ç„¶ä¼°è®¡å¾—åˆ°çš„æ¦‚ç‡å°†ä¼šæ˜¯0ï¼Œæ¨¡å‹å¯èƒ½ä»…ä»…èƒ½å¤Ÿè®¡ç®—å¯¥å¯¥å‡ ä¸ªå¥å­ã€‚æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p>
</li>
</ol>
<p>è§£å†³åƒæ•°ç©ºé—´è¿‡å¤§çš„é—®é¢˜ã€‚å¼•å…¥äº†é©¬å°”ç§‘å¤«å‡è®¾ï¼š<strong>éšæ„ä¸€ä¸ªè¯å‡ºç°çš„æ¦‚ç‡åªä¸å®ƒå‰é¢å‡ºç°çš„æœ‰é™çš„ä¸€ä¸ªæˆ–è€…å‡ ä¸ªè¯æœ‰å…³ã€‚</strong>å‡è®¾ç¬¬$w_i$ä¸ªè¯è¯­åªä¸å®ƒå‰é¢çš„$n$ä¸ªè¯è¯­ç›¸å…³ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°å‰é¢çš„æ¡ä»¶æ¦‚ç‡è®¡ç®—ç®€åŒ–å¦‚ä¸‹</p>
<script type="math/tex; mode=display">
p(w_i|w_{i-1},\ldots,w_2,w_1) \approx p(w_i|w_{i-1},\ldots,w_{i-n})\\
p(w_1,w_2,\ldots,w_m) \approx \prod_{i} p(w_i|w_{i-1},\ldots,w_{i-n})</script><p>å½“n=1ï¼Œå³ä¸€å…ƒæ¨¡å‹ï¼ˆUni-gramï¼‰,å³$w_i$ä¸å®ƒå‰é¢çš„0ä¸ªè¯ç›¸å…³ï¼Œå³$w_i$ä¸ä¸ä»»ä½•è¯ç›¸å…³ï¼Œæ¯ä¸€ä¸ªè¯éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼š</p>
<script type="math/tex; mode=display">
P\left(w_{1}, w_{2}, \cdots, w_{m}\right)=\prod_{i=1}^{m} P\left(w_{i}\right)</script><p>å½“n=2ï¼Œå³äºŒå…ƒæ¨¡å‹ï¼ˆBi-gramï¼‰,æ­¤æ—¶$w_i$ä¸å®ƒå‰é¢1ä¸ªè¯ç›¸å…³ï¼š</p>
<script type="math/tex; mode=display">
P\left(w_{1}, w_{2}, \cdots, w_{m}\right)=\prod_{i=1}^{m} P\left(w_{i} | w_{i-1}\right)</script><p>å½“n=3æ—¶ï¼Œå³ä¸‰å…ƒæ¨¡å‹ï¼ˆTri-gramï¼‰,æ­¤æ—¶$w_i$ä¸å®ƒå‰é¢2ä¸ªè¯ç›¸å…³ï¼š</p>
<script type="math/tex; mode=display">
P\left(w_{1}, w_{2}, \cdots, w_{m}\right)=\prod_{i=1}^{m} P\left(w_{i} | w_{i-2} w_{i-1}\right)</script><p>ä¸€èˆ¬æ¥è¯´ï¼ŒNå…ƒæ¨¡å‹å°±æ˜¯å‡è®¾å½“å‰è¯çš„å‡ºç°æ¦‚ç‡åªä¸å®ƒå‰é¢çš„N-1ä¸ªè¯æœ‰å…³ã€‚è€Œè¿™äº›æ¦‚ç‡å‚æ•°éƒ½æ˜¯å¯ä»¥é€šè¿‡å¤§è§„æ¨¡è¯­æ–™åº“æ¥è®¡ç®—ã€‚<strong>åœ¨å®è·µä¸­ç”¨çš„æœ€å¤šçš„å°±æ˜¯bigramå’Œtrigramäº†ï¼Œé«˜äºå››å…ƒçš„ç”¨çš„éå¸¸å°‘ï¼Œç”±äºè®­ç»ƒå®ƒé¡»è¦æ›´åºå¤§çš„è¯­æ–™ï¼Œå¹¶ä¸”æ•°æ®ç¨€ç–ä¸¥é‡ï¼Œæ—¶é—´å¤æ‚åº¦é«˜ï¼Œç²¾åº¦å´æé«˜çš„ä¸å¤šã€‚</strong></p>
<h5 id="å‚æ•°ä¼°è®¡"><a href="#å‚æ•°ä¼°è®¡" class="headerlink" title="å‚æ•°ä¼°è®¡"></a>å‚æ•°ä¼°è®¡</h5><p>è¦è®¡ç®—å‡ºæ¨¡å‹ä¸­çš„æ¡ä»¶æ¦‚ç‡ï¼Œè¿™äº›æ¡ä»¶æ¦‚ç‡ä¹Ÿç§°ä¸ºæ¨¡å‹çš„å‚æ•°ï¼Œå¾—åˆ°è¿™äº›å‚æ•°çš„è¿‡ç¨‹ç§°ä¸ºè®­ç»ƒã€‚ç”¨æœ€å¤§ä¼¼ç„¶æ€§ä¼°è®¡è®¡ç®—ä¸‹é¢çš„æ¡ä»¶æ¦‚ç‡ï¼š</p>
<script type="math/tex; mode=display">
P\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1}, w_{i}\right)}{c\left(w_{i-1}\right)}</script><p>ä¸€å…ƒè¯­è¨€æ¨¡å‹ä¸­ï¼šå¥å­æ¦‚ç‡å®šä¹‰ä¸ºï¼š$P\left(s\right)=\prod_{i=1}^{m} P\left(w_{i}\right)$,è¿™ä¸ªå¼å­æˆç«‹çš„æ¡ä»¶æ˜¯æœ‰ä¸€ä¸ªå‡è®¾ï¼Œå°±æ˜¯æ¡ä»¶æ— å…³å‡è®¾ï¼Œæˆ‘ä»¬è®¤ä¸ºæ¯ä¸ªè¯éƒ½æ˜¯æ¡ä»¶æ— å…³çš„ã€‚è¿™é‡Œçš„å‚æ•°ç§ç±»æ˜¯ä¸€ç§ $P(w_n)$,ä½†æ˜¯å‚æ•°å®ä¾‹æœ‰$|V|$ä¸ª(Væ˜¯è¯å…¸å¤§å°),æˆ‘ä»¬åº”è¯¥å¦‚ä½•å¾—åˆ°æ¯ä¸ªå‚æ•°å®ä¾‹çš„å€¼ã€‚ç”¨çš„æ˜¯æå¤§ä¼¼ç„¶ä¼°è®¡æ³•ã€‚æ¯”å¦‚è®­ç»ƒè¯­æ–™æ˜¯:â€æ˜ŸæœŸäº”æ—©æ™¨ï¼Œæˆ‘ç‰¹æ„èµ·äº†ä¸ªå¤§æ—©ï¼Œä¸ºçš„å°±æ˜¯çœ‹çœ‹æ—©æ™¨çš„å¤©ç©ºã€‚â€é‚£ä¹ˆæˆ‘ä»¬çš„å­—å…¸ä¸ºï¼šæ˜Ÿ æœŸ äº” æ—© æ™¨ ï¼Œæˆ‘ ç‰¹ æ„ èµ· äº† ä¸ª å¤§ æ—© ä¸º çš„ å°± æ˜¯ çœ‹ å¤© ç©º ã€‚ 22ä¸ªä¸åŒè¯ï¼Œæ¯ä¸ªè¯è¯­çš„æ¦‚ç‡ç›´æ¥ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡æ³•ä¼°è®¡å¾—åˆ°ã€‚å¦‚ï¼šp(æ˜Ÿ) = 1/27ï¼Œp(æœŸ) = 1/27ã€‚äºæ˜¯éœ€è¦å­˜å‚¨å­¦ä¹ å¾—åˆ°çš„æ¨¡å‹å‚æ•°ï¼Œä¸€ä¸ªå‘é‡ï¼Œ22ç»´ï¼Œæ¯ä¸ªç»´åº¦ä¿å­˜ç€æ¯ä¸ªå•è¯çš„æ¦‚ç‡å€¼ã€‚å½“éœ€è¦è®¡ç®—ï¼šp(æˆ‘çœ‹çœ‹æ—©æ™¨çš„å¤©ç©º)=p(æˆ‘)p(çœ‹)p(çœ‹)p(æ—©)p(æ™¨)p(çš„)p(å¤©)p(ç©º)=$\frac{1}{27}<em>\frac{1}{27}</em>\frac{1}{27}\ldots *\frac{1}{27}$ï¼Œå¯ä»¥ç›´æ¥è®¡ç®—å‡ºæ¥ã€‚äºæ˜¯åªè¦å°†æ¯å¥è¯æ‹†å¼€ä¸ºæ¯ä¸ªå•è¯ç„¶åç”¨ç´¯ç§¯å½¢å¼è¿ç®—ï¼Œè¿™æ ·å°±èƒ½ç®—å‡ºæ¯å¥è¯çš„æ¦‚ç‡ã€‚ç¼ºç‚¹æ˜¯ï¼šä¸åŒ…å«è¯­åºä¿¡æ¯ã€‚</p>
<p>äºŒå…ƒè¯­è¨€æ¨¡å‹ä¸­ï¼šä¸ºäº†è®¡ç®—å¯¹åº”çš„äºŒå…ƒæ¨¡å‹çš„å‚æ•°ï¼Œå³$P(w_i | w_{i-1})$ï¼Œè¦å…ˆè®¡æ•°å³$c(w_{i-1},w_i)$ï¼Œç„¶åè®¡æ•°$c(w_{i-1})$,å†ç”¨é™¤æ³•å¯å¾—åˆ°è¿™äº›æ¡ä»¶æ¦‚ç‡.å¯ä»¥çœ‹åˆ°å¯¹äº$c(w_{i-1},w_i)$æ¥è¯´ï¼Œ$w_{i-1}$æœ‰è¯­æ–™åº“è¯å…¸å¤§å°ï¼ˆè®°ä½œ$|V|$ï¼‰çš„å¯èƒ½å–å€¼ï¼Œ$w_i$ä¹Ÿæ˜¯ï¼Œæ‰€ä»¥$c(w_{i-1},w_i)$è¦è®¡ç®—çš„ä¸ªæ•°æœ‰$|V|^2$ã€‚</p>
<p>$c(w_{i-1},w_i)$è®¡æ•°ç»“æœå¦‚ä¸‹:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>i</th>
<th>want</th>
<th>to</th>
<th>eat</th>
<th>chinese</th>
<th>food</th>
<th>lunch</th>
<th>english</th>
</tr>
</thead>
<tbody>
<tr>
<td>i</td>
<td>5</td>
<td>827</td>
<td>0</td>
<td>9</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
</tr>
<tr>
<td>want</td>
<td>2</td>
<td>0</td>
<td>608</td>
<td>1</td>
<td>6</td>
<td>6</td>
<td>5</td>
<td>1</td>
</tr>
<tr>
<td>to</td>
<td>2</td>
<td>0</td>
<td>4</td>
<td>686</td>
<td>2</td>
<td>0</td>
<td>6</td>
<td>211</td>
</tr>
<tr>
<td>eat</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>16</td>
<td>2</td>
<td>42</td>
<td>0</td>
</tr>
<tr>
<td>chinese</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>82</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>food</td>
<td>15</td>
<td>0</td>
<td>15</td>
<td>0</td>
<td>1</td>
<td>4</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>lunch</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>spend</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<p>$c(w_{i-1})$çš„è®¡æ•°å¦‚ä¸‹ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>i</th>
<th>want</th>
<th>to</th>
<th>eat</th>
<th>chinese</th>
<th>food</th>
<th>lunch</th>
<th>english</th>
</tr>
</thead>
<tbody>
<tr>
<td>2533</td>
<td>927</td>
<td>2417</td>
<td>746</td>
<td>158</td>
<td>1093</td>
<td>341</td>
<td>278</td>
</tr>
</tbody>
</table>
</div>
<p>é‚£ä¹ˆäºŒå…ƒæ¨¡å‹çš„å‚æ•°è®¡ç®—ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>i</th>
<th>want</th>
<th>to</th>
<th>eat</th>
<th>chinese</th>
<th>food</th>
<th>lunch</th>
<th>english</th>
</tr>
</thead>
<tbody>
<tr>
<td>i</td>
<td>0.002</td>
<td>0.33</td>
<td>0</td>
<td>0.0036</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.00079</td>
</tr>
<tr>
<td>want</td>
<td>0.0022</td>
<td>0</td>
<td>0.66</td>
<td>0.0011</td>
<td>0.0065</td>
<td>0.0065</td>
<td>0.0054</td>
<td>0.0011</td>
</tr>
<tr>
<td>to</td>
<td>0.00083</td>
<td>0</td>
<td>0.0017</td>
<td>0.28</td>
<td>0.00083</td>
<td>0</td>
<td>0.0025</td>
<td>0.087</td>
</tr>
<tr>
<td>eat</td>
<td>0</td>
<td>0</td>
<td>0.0027</td>
<td>0</td>
<td>0.021</td>
<td>0.0027</td>
<td>0.056</td>
<td>0</td>
</tr>
<tr>
<td>chinese</td>
<td>0.0063</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.52</td>
<td>0.0063</td>
<td>0</td>
</tr>
<tr>
<td>food</td>
<td>0.014</td>
<td>0</td>
<td>0.0014</td>
<td>0</td>
<td>0.00092</td>
<td>0.0037</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>lunch</td>
<td>0.0059</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0029</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>spend</td>
<td>0.0036</td>
<td>0</td>
<td>0.0036</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<p>æ¯”å¦‚è®¡ç®—å…¶ä¸­çš„P(want | i) = 0.33å¦‚:$p(want|i) = \frac{c(i,want)}{c(i)}=\frac{827}{2533} \approx0.33$,é’ˆå¯¹è¿™ä¸ªè¯­æ–™åº“çš„äºŒå…ƒæ¨¡å‹å»ºç«‹å¥½äº†åï¼Œå¯ä»¥è®¡ç®—ç›®æ ‡ï¼Œå³ä¸€ä¸ªå¥å­çš„æ¦‚ç‡äº†ï¼Œä¸€ä¸ªä¾‹å­å¦‚ä¸‹ï¼š</p>
<p>$p(s)=p(i want english food) = p(i|<start>)<em>p(want|i)</em>p(english|want)<em>p(food|english)</em>p(<end>|food) \approx 0.000031$</end></start></p>
<p>è¯¥äºŒå…ƒæ¨¡å‹æ‰€æ•æ‰åˆ°çš„ä¸€äº›å®é™…ä¿¡æ¯:</p>
<ul>
<li>$p(english|want) = 0.0011,p(chinese|want)=0.0065$,want chinese çš„æ¦‚ç‡æ›´é«˜ï¼Œè¿™å’ŒçœŸå®ä¸–ç•Œæƒ…å†µç›¸å¯¹åº”ï¼Œå› ä¸ºchinese food æ¯” English food æ›´å—æ¬¢è¿ã€‚</li>
<li>$p(to|want)=0.66$, want to çš„æ¦‚ç‡å¾ˆé«˜ï¼Œåæ˜ äº†è¯­æ³•ç‰¹æ€§</li>
<li>$p(food|to)=0$ ï¼Œto food æ¦‚ç‡ä¸º0ï¼Œå› ä¸ºè¿™ç§æ­é…ä¸å¸¸è§</li>
<li>$p(want|spend)=0$, spend want æ¦‚ç‡ä¸º0ï¼Œå› ä¸ºè¿™æ ·è¿åäº†è¯­æ³•ã€‚</li>
</ul>
<p>å¸¸å¸¸åœ¨å¯¹æ•°ç©ºé—´é‡Œé¢è®¡ç®—æ¦‚ç‡ï¼ŒåŸå› æœ‰ä¸¤ä¸ªï¼š</p>
<ol>
<li>é˜²æ­¢æº¢å‡ºï¼Œå¦‚æœè®¡ç®—çš„å¥å­å¾ˆé•¿ï¼Œæœ€åå¾—åˆ°çš„ç»“æœå°†éå¸¸å°ï¼Œç”šè‡³ä¼šæº¢å‡ºï¼Œæ¯”å¦‚è®¡ç®—å¾—åˆ°çš„æ¦‚ç‡æ˜¯0.001ï¼Œé‚£ä¹ˆå‡è®¾ä»¥10ä¸ºåº•å–å¯¹æ•°çš„ç»“æœå°±æ˜¯-3ï¼Œè¿™æ ·å°±ä¸ä¼šæº¢å‡ºã€‚</li>
<li>å¯¹æ•°ç©ºé—´é‡Œé¢åŠ æ³•å¯ä»¥ä»£æ›¿ä¹˜æ³•ï¼Œå› ä¸ºlog(p1p2) = logp1 + logp2ï¼Œè€Œåœ¨è®¡ç®—æœºå†…éƒ¨ï¼Œæ˜¾ç„¶åŠ æ³•æ¯”ä¹˜æ³•æ‰§è¡Œæ›´å¿«ï¼</li>
</ol>
<h5 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><p>æ•°æ®å‡†å¤‡ï¼šunigram:(word, freq),bigram:(word1,word2,freq) è¯­æ–™æ•°æ®ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="comment"># global parameter</span></span><br><span class="line">DELIMITER = <span class="string">" "</span>  <span class="comment"># åˆ†è¯ä¹‹åçš„åˆ†éš”ç¬¦</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DNASegment</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.word1_dict_prob = &#123;&#125;  <span class="comment"># è®°å½•æ¦‚ç‡,1-gram</span></span><br><span class="line">        self.word1_dict_count = &#123;&#125;  <span class="comment"># è®°å½•è¯é¢‘,1-gram</span></span><br><span class="line">        self.word1_dict_count[<span class="string">"&lt;S&gt;"</span>] = <span class="number">8310575403</span>  <span class="comment"># å¼€å§‹çš„&lt;S&gt;çš„ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">        self.word2_dict_prob = &#123;&#125;  <span class="comment"># è®°å½•æ¦‚ç‡,2-gram</span></span><br><span class="line">        self.word2_dict_count = &#123;&#125;  <span class="comment"># è®°å½•è¯é¢‘,2-gram</span></span><br><span class="line"></span><br><span class="line">        self.gmax_word_length = <span class="number">0</span></span><br><span class="line">        self.all_freq = <span class="number">0</span>  <span class="comment"># æ‰€æœ‰è¯çš„è¯é¢‘æ€»å’Œ,1-gramçš„</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¼°ç®—æœªå‡ºç°çš„è¯çš„æ¦‚ç‡,æ ¹æ®beautiful dataé‡Œé¢çš„æ–¹æ³•ä¼°ç®—</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_unkonw_word_prob</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> math.log(<span class="number">10.</span> / (self.all_freq * <span class="number">10</span> ** len(word)))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å¾—ç‰‡æ®µçš„æ¦‚ç‡</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_word_prob</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">in</span> self.word1_dict_prob:  <span class="comment"># å¦‚æœå­—å…¸åŒ…å«è¿™ä¸ªè¯</span></span><br><span class="line">            prob = self.word1_dict_prob[word]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prob = self.get_unkonw_word_prob(word)</span><br><span class="line">        <span class="keyword">return</span> prob</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å¾—ä¸¤ä¸ªè¯çš„è½¬ç§»æ¦‚ç‡(bigram)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_word_trans_prob</span><span class="params">(self, first_word, second_word)</span>:</span></span><br><span class="line">        trans_word = first_word + <span class="string">" "</span> + second_word</span><br><span class="line">        <span class="comment"># print trans_word</span></span><br><span class="line">        <span class="keyword">if</span> trans_word <span class="keyword">in</span> self.word2_dict_count:</span><br><span class="line">            trans_prob = math.log(self.word2_dict_count[trans_word] / self.word1_dict_count[first_word])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            trans_prob = self.get_word_prob(second_word)</span><br><span class="line">        <span class="keyword">return</span> trans_prob</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯»æ‰¾nodeçš„æœ€ä½³å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">    <span class="comment"># æ–¹æ³•ä¸ºå¯»æ‰¾æ‰€æœ‰å¯èƒ½çš„å‰é©±ç‰‡æ®µ</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_best_pre_node</span><span class="params">(self, sequence, node, node_state_list)</span>:</span></span><br><span class="line">        <span class="comment"># å¦‚æœnodeæ¯”æœ€å¤§è¯é•¿å°ï¼Œå–çš„ç‰‡æ®µé•¿åº¦ä»¥nodeçš„é•¿åº¦ä¸ºé™</span></span><br><span class="line">        max_seg_length = min([node, self.gmax_word_length])</span><br><span class="line">        pre_node_list = []  <span class="comment"># å‰é©±èŠ‚ç‚¹åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è·å¾—æ‰€æœ‰çš„å‰é©±ç‰‡æ®µï¼Œå¹¶è®°å½•ç´¯åŠ æ¦‚ç‡</span></span><br><span class="line">        <span class="keyword">for</span> segment_length <span class="keyword">in</span> range(<span class="number">1</span>, max_seg_length + <span class="number">1</span>):</span><br><span class="line">            segment_start_node = node - segment_length</span><br><span class="line">            segment = sequence[segment_start_node:node]  <span class="comment"># è·å–ç‰‡æ®µ</span></span><br><span class="line"></span><br><span class="line">            pre_node = segment_start_node  <span class="comment"># å–è¯¥ç‰‡æ®µï¼Œåˆ™è®°å½•å¯¹åº”çš„å‰é©±èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> pre_node == <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># å¦‚æœå‰é©±ç‰‡æ®µå¼€å§‹èŠ‚ç‚¹æ˜¯åºåˆ—çš„å¼€å§‹èŠ‚ç‚¹ï¼Œ</span></span><br><span class="line">                <span class="comment"># åˆ™æ¦‚ç‡ä¸º&lt;S&gt;è½¬ç§»åˆ°å½“å‰è¯çš„æ¦‚ç‡</span></span><br><span class="line">                <span class="comment"># segment_prob = self.get_word_prob(segment)</span></span><br><span class="line">                segment_prob = self.get_word_trans_prob(<span class="string">"&lt;S&gt;"</span>, segment)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># å¦‚æœä¸æ˜¯åºåˆ—å¼€å§‹èŠ‚ç‚¹ï¼ŒæŒ‰ç…§äºŒå…ƒæ¦‚ç‡è®¡ç®—</span></span><br><span class="line">                <span class="comment"># è·å¾—å‰é©±ç‰‡æ®µçš„å‰ä¸€ä¸ªè¯</span></span><br><span class="line">                pre_pre_node = node_state_list[pre_node][<span class="string">"pre_node"</span>]</span><br><span class="line">                pre_pre_word = sequence[pre_pre_node:pre_node]</span><br><span class="line">                segment_prob = self.get_word_trans_prob(pre_pre_word, segment)</span><br><span class="line"></span><br><span class="line">            pre_node_prob_sum = node_state_list[pre_node][<span class="string">"prob_sum"</span>]  <span class="comment"># å‰é©±èŠ‚ç‚¹çš„æ¦‚ç‡çš„ç´¯åŠ å€¼</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># å½“å‰nodeä¸€ä¸ªå€™é€‰çš„ç´¯åŠ æ¦‚ç‡å€¼</span></span><br><span class="line">            candidate_prob_sum = pre_node_prob_sum + segment_prob</span><br><span class="line"></span><br><span class="line">            pre_node_list.append((pre_node, candidate_prob_sum))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ‰¾åˆ°æœ€å¤§çš„å€™é€‰æ¦‚ç‡å€¼</span></span><br><span class="line">        (best_pre_node, best_prob_sum) = max(pre_node_list, key=<span class="keyword">lambda</span> d: d[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> (best_pre_node, best_prob_sum)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æœ€å¤§æ¦‚ç‡åˆ†è¯</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mp_seg</span><span class="params">(self, sequence)</span>:</span></span><br><span class="line">        sequence = sequence.strip()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">        node_state_list = []  <span class="comment"># è®°å½•èŠ‚ç‚¹çš„æœ€ä½³å‰é©±ï¼Œindexå°±æ˜¯ä½ç½®ä¿¡æ¯</span></span><br><span class="line">        <span class="comment"># åˆå§‹èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯0èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">        ini_state = &#123;&#125;</span><br><span class="line">        ini_state[<span class="string">"pre_node"</span>] = <span class="number">-1</span>  <span class="comment"># å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        ini_state[<span class="string">"prob_sum"</span>] = <span class="number">0</span>  <span class="comment"># å½“å‰çš„æ¦‚ç‡æ€»å’Œ</span></span><br><span class="line">        node_state_list.append(ini_state)</span><br><span class="line">        <span class="comment"># å­—ç¬¦ä¸²æ¦‚ç‡ä¸º2å…ƒæ¦‚ç‡</span></span><br><span class="line">        <span class="comment"># P(a b c) = P(a|&lt;S&gt;)P(b|a)P(c|b)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># é€ä¸ªèŠ‚ç‚¹å¯»æ‰¾æœ€ä½³å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> range(<span class="number">1</span>, len(sequence) + <span class="number">1</span>):</span><br><span class="line">            <span class="comment"># å¯»æ‰¾æœ€ä½³å‰é©±ï¼Œå¹¶è®°å½•å½“å‰æœ€å¤§çš„æ¦‚ç‡ç´¯åŠ å€¼</span></span><br><span class="line">            (best_pre_node, best_prob_sum) = self.get_best_pre_node(sequence, node, node_state_list)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ·»åŠ åˆ°é˜Ÿåˆ—</span></span><br><span class="line">            cur_node = &#123;&#125;</span><br><span class="line">            cur_node[<span class="string">"pre_node"</span>] = best_pre_node</span><br><span class="line">            cur_node[<span class="string">"prob_sum"</span>] = best_prob_sum</span><br><span class="line">            node_state_list.append(cur_node)</span><br><span class="line">            <span class="comment"># print "cur node list",node_state_list</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 2, è·å¾—æœ€ä¼˜è·¯å¾„,ä»ååˆ°å‰</span></span><br><span class="line">        best_path = []</span><br><span class="line">        node = len(sequence)  <span class="comment"># æœ€åä¸€ä¸ªç‚¹</span></span><br><span class="line">        best_path.append(node)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            pre_node = node_state_list[node][<span class="string">"pre_node"</span>]</span><br><span class="line">            <span class="keyword">if</span> pre_node == <span class="number">-1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            node = pre_node</span><br><span class="line">            best_path.append(node)</span><br><span class="line">        best_path.reverse()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 3, æ„å»ºåˆ‡åˆ†</span></span><br><span class="line">        word_list = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(best_path) - <span class="number">1</span>):</span><br><span class="line">            left = best_path[i]</span><br><span class="line">            right = best_path[i + <span class="number">1</span>]</span><br><span class="line">            word = sequence[left:right]</span><br><span class="line">            word_list.append(word)</span><br><span class="line"></span><br><span class="line">        seg_sequence = DELIMITER.join(word_list)</span><br><span class="line">        <span class="keyword">return</span> seg_sequence</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ è½½è¯å…¸ï¼Œä¸ºè¯\tè¯é¢‘çš„æ ¼å¼</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">initial_dict</span><span class="params">(self, gram1_file, gram2_file)</span>:</span></span><br><span class="line">        <span class="comment"># è¯»å–unigramæ–‡ä»¶</span></span><br><span class="line">        dict_file = open(gram1_file, <span class="string">"r"</span>)</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> dict_file:</span><br><span class="line">            sequence = line.strip()</span><br><span class="line">            key = sequence.split(<span class="string">'\t'</span>)[<span class="number">0</span>]</span><br><span class="line">            value = float(sequence.split(<span class="string">'\t'</span>)[<span class="number">1</span>])</span><br><span class="line">            self.word1_dict_count[key] = value</span><br><span class="line">        <span class="comment"># è®¡ç®—é¢‘ç‡</span></span><br><span class="line">        self.all_freq = sum(self.word1_dict_count.values())  <span class="comment"># æ‰€æœ‰è¯çš„è¯é¢‘</span></span><br><span class="line">        self.gmax_word_length = max(len(key) <span class="keyword">for</span> key <span class="keyword">in</span> self.word1_dict_count.keys())</span><br><span class="line">        self.gmax_word_length = <span class="number">20</span></span><br><span class="line">        self.all_freq = <span class="number">1024908267229.0</span></span><br><span class="line">        <span class="comment"># è®¡ç®—1gramè¯çš„æ¦‚ç‡</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> self.word1_dict_count:</span><br><span class="line">            self.word1_dict_prob[key] = math.log(self.word1_dict_count[key] / self.all_freq)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¯»å–2_gram_fileï¼ŒåŒæ—¶è®¡ç®—è½¬ç§»æ¦‚ç‡</span></span><br><span class="line">        dict_file = open(gram2_file, <span class="string">"r"</span>)</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> dict_file:</span><br><span class="line">            sequence = line.strip()</span><br><span class="line">            key = sequence.split(<span class="string">'\t'</span>)[<span class="number">0</span>]</span><br><span class="line">            value = float(sequence.split(<span class="string">'\t'</span>)[<span class="number">1</span>])</span><br><span class="line">            first_word = key.split(<span class="string">" "</span>)[<span class="number">0</span>]</span><br><span class="line">            second_word = key.split(<span class="string">" "</span>)[<span class="number">1</span>]</span><br><span class="line">            self.word2_dict_count[key] = float(value)</span><br><span class="line">            <span class="keyword">if</span> first_word <span class="keyword">in</span> self.word1_dict_count:</span><br><span class="line">                <span class="comment"># å–è‡ªç„¶å¯¹æ•°</span></span><br><span class="line">                self.word2_dict_prob[key] = math.log(value / self.word1_dict_count[first_word])  </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.word2_dict_prob[key] = self.word1_dict_prob[second_word]</span><br></pre></td></tr></table></figure>
<h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p><strong>åˆ—ä¸¾å‡ºæ‰€æœ‰å¯èƒ½çš„åˆ†è¯æ–¹å¼ï¼Œå†åˆ†åˆ«è®¡ç®—å¥å­æ¦‚ç‡ï¼Œé€‰æ‹©æ¦‚ç‡æœ€å¤§çš„ä½œä¸ºæœ€ç»ˆåˆ†è¯ç»“æœã€‚ç©·ä¸¾æ³•ï¼Œé€Ÿåº¦æ…¢ã€‚</strong></p>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>N-gramsæœ‰ä¸€äº›ä¸è¶³ï¼Œå› ä¸ºè¯­è¨€å­˜åœ¨ä¸€ä¸ªé•¿è·ç¦»ä¾èµ–å…³ç³»ï¼Œæ¯”å¦‚ï¼šâ€œThe computer which I had just put into the machine room on the fifth floor crashed.â€å‡å¦‚è¦é¢„æµ‹æœ€åä¸€ä¸ªè¯è¯­crashedå‡ºç°çš„æ¦‚ç‡ï¼Œå¦‚æœé‡‡ç”¨äºŒå…ƒæ¨¡å‹ï¼Œé‚£ä¹ˆcrashedä¸floorå®é™…å…³è”å¯èƒ½æ€§åº”è¯¥éå¸¸å°ï¼Œç›¸åçš„ï¼Œè¿™å¥å­çš„ä¸»è¯­computerä¸crashedçš„ç›¸å…³æ€§å¾ˆå¤§ï¼Œä½†æ˜¯n-gramså¹¶æ²¡æœ‰æ•æ‰åˆ°è¿™ä¸ªä¿¡æ¯ã€‚</li>
<li>ä¸€ä¸ªè¯æ˜¯ç”±å‰ä¸€ä¸ªæˆ–è€…å‡ ä¸ªè¯å†³å®šçš„ï¼Œè¿™æ ·å¯ä»¥å»é™¤ä¸€éƒ¨åˆ†æ­§ä¹‰é—®é¢˜ï¼Œä½†æ˜¯n-gramæ¨¡å‹è¿˜æ˜¯åŸºäºé©¬å°”ç§‘å¤«æ¨¡å‹çš„ï¼Œå…¶åŸºæœ¬åŸç†å°±æ˜¯æ— åæ•ˆæ€§ï¼Œå°±æ˜¯åç»­çš„èŠ‚ç‚¹çš„çŠ¶æ€ä¸å½±å“å‰é¢çš„çŠ¶æ€ï¼Œå°±æ˜¯å…ˆå‰çš„åˆ†è¯å½¢å¼ä¸€æ—¦ç¡®å®šï¼Œæ— è®ºåç»­è·Ÿçš„æ˜¯ä»€ä¹ˆè¯ï¼Œéƒ½ä¸ä¼šå†æœ‰å˜åŒ–ï¼Œè¿™åœ¨ç°å®ä¸­æ˜¾ç„¶æ˜¯ä¸æˆç«‹çš„ã€‚ã€‚å› æ­¤å°±æœ‰ä¸€äº›å¯ä»¥è€ƒè™‘åˆ°åç»­è¯çš„ç®—æ³•ï¼Œå¦‚crfç­‰æ–¹æ³•ã€‚</li>
</ol>
<h4 id="åŸºäºHMMçš„åˆ†è¯ç®—æ³•"><a href="#åŸºäºHMMçš„åˆ†è¯ç®—æ³•" class="headerlink" title="åŸºäºHMMçš„åˆ†è¯ç®—æ³•"></a>åŸºäºHMMçš„åˆ†è¯ç®—æ³•</h4><h5 id="éšé©¬å°”ç§‘å¤«æ¨¡å‹-HMM"><a href="#éšé©¬å°”ç§‘å¤«æ¨¡å‹-HMM" class="headerlink" title="éšé©¬å°”ç§‘å¤«æ¨¡å‹(HMM)"></a>éšé©¬å°”ç§‘å¤«æ¨¡å‹(HMM)</h5><p>éšé©¬å°”å¯å¤«æ¨¡å‹æ˜¯å…³äº<strong>æ—¶åº</strong>çš„æ¦‚ç‡æ¨¡å‹,æè¿°ç”±ä¸€ä¸ªéšè—çš„é©¬å°”å¯å¤«é“¾éšæœºç”Ÿæˆä¸å¯è§‚æµ‹çš„<strong>çŠ¶æ€åºåˆ—</strong>,å†ç”±å„ä¸ªçŠ¶æ€ç”Ÿæˆä¸€ä¸ªè§‚æµ‹è€Œäº§ç”Ÿ<strong>è§‚æµ‹éšæœºåºåˆ—</strong>çš„è¿‡ç¨‹.HMMæ˜¯ä¸€ç§ç”Ÿæˆå¼æ¨¡å‹ï¼Œå®ƒçš„ç†è®ºåŸºç¡€æ˜¯æœ´ç´ è´å¶æ–¯ï¼Œæœ¬è´¨ä¸Šå°±ç±»ä¼¼äºæˆ‘ä»¬å°†æœ´ç´ è´å¶æ–¯åœ¨å•æ ·æœ¬åˆ†ç±»é—®é¢˜ä¸Šçš„åº”ç”¨æ¨å¹¿åˆ°åºåˆ—æ ·æœ¬åˆ†ç±»é—®é¢˜ä¸Šã€‚</p>
<h6 id="æ¨¡å‹è¡¨ç¤º"><a href="#æ¨¡å‹è¡¨ç¤º" class="headerlink" title="æ¨¡å‹è¡¨ç¤º"></a>æ¨¡å‹è¡¨ç¤º</h6><p>è®¾Qæ˜¯æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€çš„é›†åˆ$Q=\left\{q_{1}, q_{2}, \cdots, q_{N}\right\}$,Væ˜¯æ‰€æœ‰å¯èƒ½çš„è§‚æµ‹çš„é›†åˆ$V=\left\{v_{1}, v_{2}, \cdots, v_{M}\right\}$,Iæ˜¯é•¿åº¦ä¸ºTçš„çŠ¶æ€åºåˆ—$I=\left(i_{1}, i_{2}, \cdots, i_{T}\right)$, Oæ˜¯å¯¹åº”çš„è§‚æµ‹åºåˆ—$O=\left(o_{1}, o_{2}, \cdots, o_{T}\right)$,</p>
<ol>
<li>Aæ˜¯<strong>çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µ</strong>$A=\left[a_{i j}\right]_{N \times N}$,$a_{ij}$è¡¨ç¤ºåœ¨æ—¶åˆ»tå¤„äºçŠ¶æ€$q_i$çš„æ¡ä»¶ä¸‹åœ¨æ—¶åˆ»t+1è½¬ç§»åˆ°çŠ¶æ€$q_j$çš„æ¦‚ç‡.</li>
<li>Bæ˜¯<strong>è§‚æµ‹æ¦‚ç‡çŸ©é˜µ</strong> $B=\left[b_{j}(k)\right]_{N \times M}$,$b_{ij}$æ˜¯åœ¨æ—¶åˆ»tå¤„äºçŠ¶æ€$q_j$çš„æ¡ä»¶ä¸‹ç”Ÿæˆè§‚æµ‹$v_k$çš„æ¦‚ç‡.</li>
<li>$\pi$æ˜¯<strong>åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡</strong>$\pi=\pi(x)$,$\pi_i$è¡¨ç¤ºæ—¶åˆ»t=1å¤„äºçŠ¶æ€qiçš„æ¦‚ç‡.</li>
</ol>
<p>éšé©¬å°”å¯å¤«æ¨¡å‹ç”±åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡$pi$,çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µAä»¥åŠè§‚æµ‹æ¦‚ç‡çŸ©é˜µBç¡®å®š.$\pi$å’ŒAå†³å®šå³éšè—çš„<strong>é©¬å°”å¯å¤«é“¾</strong>,ç”Ÿæˆä¸å¯è§‚æµ‹çš„<strong>çŠ¶æ€åºåˆ—</strong>.Bå†³å®šå¦‚ä½•ä»çŠ¶æ€ç”Ÿæˆè§‚æµ‹,ä¸çŠ¶æ€åºåˆ—ç»¼åˆç¡®å®šäº†<strong>è§‚æµ‹åºåˆ—</strong>.å› æ­¤,éšé©¬å°”å¯å¤«æ¨¡å‹å¯ä»¥ç”¨<strong>ä¸‰å…ƒç¬¦å·</strong>è¡¨ç¤º$\lambda = (A,B,\pi)$</p>
<h6 id="ä¸¤ä¸ªåŸºæœ¬å‡è®¾"><a href="#ä¸¤ä¸ªåŸºæœ¬å‡è®¾" class="headerlink" title="ä¸¤ä¸ªåŸºæœ¬å‡è®¾"></a>ä¸¤ä¸ªåŸºæœ¬å‡è®¾</h6><ol>
<li><strong>é½æ¬¡é©¬å°”å¯å¤«æ€§å‡è®¾</strong>:å‡è®¾éšè—çš„é©¬å°”å¯å¤«é“¾åœ¨ä»»æ„æ—¶åˆ»tçš„çŠ¶æ€åªä¾èµ–äºå…¶å‰ä¸€æ—¶åˆ»çš„çŠ¶æ€.</li>
<li><strong>è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾</strong>:å‡è®¾ä»»æ„æ—¶åˆ»çš„è§‚æµ‹åªä¾èµ–äºè¯¥æ—¶åˆ»çš„é©¬å°”å¯å¤«é“¾çš„çŠ¶æ€.</li>
</ol>
<h6 id="ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"><a href="#ä¸‰ä¸ªåŸºæœ¬é—®é¢˜" class="headerlink" title="ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"></a>ä¸‰ä¸ªåŸºæœ¬é—®é¢˜</h6><p><strong>1. æ¦‚ç‡è®¡ç®—é—®é¢˜</strong></p>
<p>ç»™å®šæ¨¡å‹$\lambda = (A,B,\pi)$å’Œè§‚æµ‹åºåˆ—,$O=\left(o_{1}, o_{2}, \cdots, o_{T}\right)$è®¡ç®—åœ¨æ¨¡å‹$\lambda$ä¸‹è§‚æµ‹åºåˆ—Oå‡ºç°çš„æ¦‚ç‡$P(O|Î»)$.</p>
<ol>
<li>ç›´æ¥è®¡ç®—ï¼šåˆ—ä¸¾æ‰€æœ‰å¯èƒ½é•¿åº¦ä¸ºTçš„çŠ¶æ€åºåˆ—,æ±‚å„ä¸ªçŠ¶æ€åºåˆ—Iä¸è§‚æµ‹åºåˆ—Oçš„è”åˆæ¦‚ç‡,ä½†è®¡ç®—é‡å¤ªå¤§,å®é™…æ“ä½œä¸å¯è¡Œ.</li>
<li><strong>å‰å‘ç®—æ³•</strong>ï¼šå®šä¹‰åˆ°æ—¶åˆ»téƒ¨åˆ†è§‚æµ‹åºåˆ—ä¸º$o_1$~$o_t$ä¸”çŠ¶æ€ä¸º$q_i$çš„æ¦‚ç‡ä¸º<strong>å‰å‘æ¦‚ç‡</strong>,è®°ä½œ$\alpha_{t}(i)=P\left(o_{1}, o_{2}, \cdots, o_{t}, i_{t}=q_{i} | \lambda\right)$.åˆå§‹åŒ–å‰å‘æ¦‚ç‡$\alpha_{1}(i)=\pi_{i} b_{i}\left(o_{1}\right), \quad i=1,2, \cdots, N$ï¼Œé€’æ¨ï¼Œå¯¹$t=1$ ~ $T-1$,$\alpha_{t+1}(i)=\left[\sum_{j=1}^{N} \alpha_{t}(j) a_{j i}\right] b_{i}\left(o_{t+1}\right), \quad i=1,2, \cdots, N$,å¾—åˆ°$P(O | \lambda)=\sum_{i=1}^{N} \alpha_{T}(i)$å‡å°‘è®¡ç®—é‡çš„åŸå› åœ¨äºæ¯ä¸€æ¬¡è®¡ç®—ç›´æ¥å¼•ç”¨å‰ä¸€ä¸ªæ—¶åˆ»çš„è®¡ç®—ç»“æœ,é¿å…é‡å¤è®¡ç®—.</li>
<li><strong>åå‘ç®—æ³•</strong>:å®šä¹‰åœ¨æ—¶åˆ»tçŠ¶æ€ä¸º$q_i$çš„æ¡ä»¶ä¸‹,ä»t+1åˆ°Tçš„éƒ¨åˆ†è§‚æµ‹åºåˆ—ä¸º$o_{i+1}$~$o_T$çš„æ¦‚ç‡ä¸º<strong>åå‘æ¦‚ç‡</strong>,è®°ä½œ$\beta_{t}(i)=P\left(o_{t+1}, o_{t+2}, \cdots, o_{r} | i_{t}=q_{i}, \lambda\right)$.åˆå§‹åŒ–åå‘æ¦‚ç‡$\beta_{r}(i)=1, \quad i=1,2, \cdots, N$,é€’æ¨,å¯¹$t=T-1$~$1$$\beta_{t}(i)=\sum_{j=1}^{N} a_{i j} b_{j}\left(o_{i+1}\right) \beta_{i+1}(j), \quad i=1,2, \cdots, N$,å¾—åˆ°$P(O | \lambda)=\sum_{i=1}^{N} \pi_{i} b_{i}\left(o_{1}\right) \beta_{1}(i)$</li>
</ol>
<p><strong>2. å­¦ä¹ ç®—æ³•</strong></p>
<p>å·²çŸ¥è§‚æµ‹åºåˆ—$O=(o_1,o_2, \cdots,o_r)$,ä¼°è®¡æ¨¡å‹$\lambda = (A,B,\pi)$,çš„å‚æ•°,ä½¿å¾—åœ¨è¯¥æ¨¡å‹ä¸‹è§‚æµ‹åºåˆ—æ¦‚ç‡$p(O|\lambda)$æœ€å¤§.æ ¹æ®è®­ç»ƒæ•°æ®æ˜¯å¦åŒ…æ‹¬è§‚å¯Ÿåºåˆ—å¯¹åº”çš„çŠ¶æ€åºåˆ—åˆ†åˆ«ç”±ç›‘ç£å­¦ä¹ ä¸éç›‘ç£å­¦ä¹ å®ç°.</p>
<ol>
<li><p>ç›‘ç£å­¦ä¹ ï¼šä¼°è®¡è½¬ç§»æ¦‚ç‡$\hat{a}_{i j}=\frac{A_{i j}}{\sum_{j=1}^{N} A_{i j}}, \quad i=1,2, \cdots, N ; \quad j=1,2, \cdots, N$ å’Œè§‚æµ‹æ¦‚ç‡$\hat{b}_{j}(k)=\frac{B_{j k}}{\sum_{k=1}^{M} B_{j k}}, \quad j=1,2, \cdots, N, k=1,2, \cdots, M$.åˆå§‹çŠ¶æ€æ¦‚ç‡$\pi_i$çš„ä¼°è®¡ä¸ºSä¸ªæ ·æœ¬ä¸­åˆå§‹çŠ¶æ€ä¸º$q_i$çš„é¢‘ç‡.</p>
</li>
<li><p><strong>éç›‘ç£å­¦ä¹ (Baum-Welchç®—æ³•)</strong>:å°†è§‚æµ‹åºåˆ—æ•°æ®çœ‹ä½œè§‚æµ‹æ•°æ®O,çŠ¶æ€åºåˆ—æ•°æ®çœ‹ä½œä¸å¯è§‚æµ‹çš„<strong>éšæ•°æ®</strong>I.é¦–å…ˆç¡®å®šå®Œå…¨æ•°æ®çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°$log p(O,I|\lambda)$,æ±‚Qå‡½æ•°</p>
</li>
</ol>
<script type="math/tex; mode=display">
   \begin{aligned}
   Q(\lambda, \bar{\lambda})=& \sum_{t} \log \pi_{i_1} P(O, I | \bar{\lambda}) \\
   &+\sum_{I}\left(\sum_{i=1}^{I-1} \log a_{i_t,i_{t+1}}\right) P(O, I | \bar{\lambda}) \\
   &+\sum_{I}\left(\sum_{i=1}^{T} \log b_{i_t}\left(o_{t}\right)\right) P(O, I | \bar{\lambda})
   \end{aligned}</script><p>   ,ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•æå¤§åŒ–Qå‡½æ•°æ±‚æ¨¡å‹å‚æ•°$\pi_{i}=\frac{P\left(O, i_{1}=i | \bar{\lambda}\right)}{P(O | \bar{\lambda})}$,$a_{i j}=\frac{\sum_{i=1}^{T-1} P\left(O, i_{t}=i, i_{t+1}=j | \bar{\lambda}\right)}{\sum_{t=1}^{T-1} P\left(O, i_{t}=i | \bar{\lambda}\right)}$,$b_{j}(k)=\frac{\sum_{i=1}^{T} P\left(O, i_{t}=j | \bar{\lambda}\right) I\left(o_{i}=v_{k}\right)}{\sum_{i=1}^{T} P\left(O, i_{t}=j | \bar{\lambda}\right)}$,</p>
<p><strong>3. é¢„æµ‹é—®é¢˜</strong></p>
<p>ä¹Ÿç§°ä¸ºè§£ç é—®é¢˜.å·²çŸ¥æ¨¡å‹$\lambda = (A,B,\pi)$å’Œè§‚æµ‹åºåˆ—$O=(O_1,O_2,\cdots,O_T)$,æ±‚å¯¹ç»™å®šè§‚æµ‹åºåˆ—æ¡ä»¶æ¦‚ç‡$P(I|O)$æœ€å¤§çš„çŠ¶æ€åºåˆ—$I=(i_1,i_2,\cdots,i_T)$</p>
<ol>
<li><p><strong>è¿‘ä¼¼ç®—æ³•</strong>: åœ¨æ¯ä¸ªæ—¶åˆ»té€‰æ‹©åœ¨è¯¥æ—¶åˆ»æœ€æœ‰å¯èƒ½å‡ºç°çš„çŠ¶æ€$i_t^<em>$,ä»è€Œå¾—åˆ°ä¸€ä¸ªçŠ¶æ€åºåˆ—ä½œä¸ºé¢„æµ‹çš„ç»“æœ.ä¼˜ç‚¹æ˜¯<em>*è®¡ç®—ç®€å•</em></em>,ç¼ºç‚¹æ˜¯ä¸èƒ½ä¿è¯çŠ¶æ€åºåˆ—æ•´ä½“æ˜¯æœ€æœ‰å¯èƒ½çš„çŠ¶æ€åºåˆ—</p>
</li>
<li><p><strong>ç»´ç‰¹æ¯”ç®—æ³•</strong>:ç”¨<strong>åŠ¨æ€è§„åˆ’</strong>æ±‚æ¦‚ç‡æœ€å¤§è·¯å¾„,è¿™ä¸€æ¡è·¯å¾„å¯¹åº”ç€ä¸€ä¸ªçŠ¶æ€åºåˆ—.ä»t=1å¼€å§‹,é€’æ¨åœ°è®¡ç®—åœ¨æ—¶åˆ»tçŠ¶æ€ä¸ºiçš„å„æ¡éƒ¨åˆ†è·¯å¾„çš„æœ€å¤§æ¦‚ç‡,ç›´è‡³å¾—åˆ°æ—¶åˆ»t=TçŠ¶æ€ä¸ºiçš„å„æ¡è·¯å¾„çš„æœ€å¤§æ¦‚ç‡.æ—¶åˆ»t=Tçš„æœ€å¤§æ¦‚ç‡å³ä¸º<strong>æœ€ä¼˜è·¯å¾„</strong>çš„æ¦‚ç‡$P^\star$,æœ€ä¼˜è·¯å¾„çš„<strong>ç»ˆç»“ç‚¹</strong>$i_t^\star$ä¹ŸåŒæ—¶å¾—åˆ°,ä¹‹åä»ç»ˆç»“ç‚¹å¼€å§‹ç”±åå‘å‰é€æ­¥æ±‚å¾—<strong>ç»“ç‚¹</strong>,å¾—åˆ°æœ€ä¼˜è·¯å¾„.</p>
</li>
</ol>
<h5 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h5><p>åœ¨åˆ†è¯ç®—æ³•ä¸­ï¼Œåˆ†è¯å¯¹åº”ç€ä¸‰å¤§é—®é¢˜ä¸­çš„é¢„æµ‹é—®é¢˜ï¼ˆè§£ç é—®é¢˜ï¼‰ï¼Œéšé©¬å°”å¯å¤«ç»å¸¸ç”¨ä½œèƒ½å¤Ÿå‘ç°æ–°è¯çš„ç®—æ³•ï¼Œé€šè¿‡æµ·é‡çš„æ•°æ®å­¦ä¹ ï¼Œèƒ½å¤Ÿå°†äººåã€åœ°åã€äº’è”ç½‘ä¸Šçš„æ–°è¯ç­‰ä¸€ä¸€è¯†åˆ«å‡ºæ¥ï¼Œå…·æœ‰å¹¿æ³›çš„åº”ç”¨åœºæ™¯ã€‚</p>
<p>å…¶åˆ†è¯è¿‡ç¨‹:</p>
<p><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/hmm_seg.png" alt="avatar"></p>
<h5 id="ä»£ç -4"><a href="#ä»£ç -4" class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><p>æ•°æ®å‡†å¤‡ï¼šåˆ†å¥½è¯çš„è¯åº“</p>
<p>step 1:é€šè¿‡ç»Ÿè®¡è¯­æ–™åº“ä¸­è¯çš„é¢‘æ¬¡ï¼Œè®¡ç®—ä¸‰ä¸ªæ¦‚ç‡ï¼šåˆå§‹çŠ¶æ€æ¦‚ç‡startï¼ŒçŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µtransï¼Œå‘å°„æ¦‚ç‡emitã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HmmTrain</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.line_index = <span class="number">-1</span></span><br><span class="line">        self.char_set = set()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">(self)</span>:</span>  <span class="comment"># åˆå§‹åŒ–å­—å…¸</span></span><br><span class="line">        trans_dict = &#123;&#125;  <span class="comment"># å­˜å‚¨çŠ¶æ€è½¬ç§»æ¦‚ç‡</span></span><br><span class="line">        emit_dict = &#123;&#125;  <span class="comment"># å‘å°„æ¦‚ç‡(çŠ¶æ€-&gt;è¯è¯­çš„æ¡ä»¶æ¦‚ç‡)</span></span><br><span class="line">        Count_dict = &#123;&#125;  <span class="comment"># å­˜å‚¨æ‰€æœ‰çŠ¶æ€åºåˆ— ï¼Œç”¨äºå½’ä¸€åŒ–åˆ†æ¯</span></span><br><span class="line">        start_dict = &#123;&#125;  <span class="comment"># å­˜å‚¨çŠ¶æ€çš„åˆå§‹æ¦‚ç‡</span></span><br><span class="line">        state_list = [<span class="string">'B'</span>, <span class="string">'M'</span>, <span class="string">'E'</span>, <span class="string">'S'</span>]  <span class="comment"># çŠ¶æ€åºåˆ—</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> state <span class="keyword">in</span> state_list:</span><br><span class="line">            trans_dict[state] = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> state1 <span class="keyword">in</span> state_list:</span><br><span class="line">                trans_dict[state][state1] = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> state <span class="keyword">in</span> state_list:</span><br><span class="line">            start_dict[state] = <span class="number">0.0</span></span><br><span class="line">            emit_dict[state] = &#123;&#125;</span><br><span class="line">            Count_dict[state] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(trans_dict) #&#123;'B': &#123;'B': 0.0, 'S': 0.0, 'M': 0.0, 'E': 0.0&#125;, 'S': &#123;'B': 0.0, 'S': 0.0, 'M': 0.0, 'E': 0.0&#125;,ã€‚ã€‚ã€‚&#125;</span></span><br><span class="line">        <span class="comment"># print(emit_dict) # &#123;'B': &#123;&#125;, 'S': &#123;&#125;, 'M': &#123;&#125;, 'E': &#123;&#125;&#125;</span></span><br><span class="line">        <span class="comment"># print(start_dict) # &#123;'B': 0.0, 'S': 0.0, 'M': 0.0, 'E': 0.0&#125;</span></span><br><span class="line">        <span class="comment"># print(Count_dict) # &#123;'B': 0, 'S': 0, 'M': 0, 'E': 0&#125;</span></span><br><span class="line">        <span class="keyword">return</span> trans_dict, emit_dict, start_dict, Count_dict</span><br><span class="line"></span><br><span class="line">    <span class="string">'''ä¿å­˜æ¨¡å‹'''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save_model</span><span class="params">(self, word_dict, model_path)</span>:</span></span><br><span class="line">        f = open(model_path, <span class="string">'w'</span>)</span><br><span class="line">        f.write(str(word_dict))</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="string">'''è¯è¯­çŠ¶æ€è½¬æ¢'''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_word_status</span><span class="params">(self, word)</span>:</span>  <span class="comment"># æ ¹æ®è¯è¯­ï¼Œè¾“å‡ºè¯è¯­å¯¹åº”çš„SBMEçŠ¶æ€</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        S:å•å­—è¯</span></span><br><span class="line"><span class="string">        B:è¯çš„å¼€å¤´</span></span><br><span class="line"><span class="string">        M:è¯çš„ä¸­é—´</span></span><br><span class="line"><span class="string">        E:è¯çš„æœ«å°¾</span></span><br><span class="line"><span class="string">        èƒ½ ['S']</span></span><br><span class="line"><span class="string">        å‰å¾€ ['B', 'E']</span></span><br><span class="line"><span class="string">        ç§‘å¨ç‰¹ ['B', 'M', 'E']</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        word_status = []</span><br><span class="line">        <span class="keyword">if</span> len(word) == <span class="number">1</span>:</span><br><span class="line">            word_status.append(<span class="string">'S'</span>)</span><br><span class="line">        <span class="keyword">elif</span> len(word) == <span class="number">2</span>:</span><br><span class="line">            word_status = [<span class="string">'B'</span>, <span class="string">'E'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            M_num = len(word) - <span class="number">2</span></span><br><span class="line">            M_list = [<span class="string">'M'</span>] * M_num</span><br><span class="line">            word_status.append(<span class="string">'B'</span>)</span><br><span class="line">            word_status.extend(M_list)</span><br><span class="line">            word_status.append(<span class="string">'E'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> word_status</span><br><span class="line"></span><br><span class="line">    <span class="string">'''åŸºäºäººå·¥æ ‡æ³¨è¯­æ–™åº“ï¼Œè®­ç»ƒå‘å°„æ¦‚ç‡ï¼Œåˆå§‹çŠ¶æ€ï¼Œ è½¬ç§»æ¦‚ç‡'''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, train_filepath, trans_path, emit_path, start_path)</span>:</span></span><br><span class="line">        trans_dict, emit_dict, start_dict, Count_dict = self.init()</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> open(train_filepath):</span><br><span class="line">            self.line_index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            line = line.strip()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            char_list = []</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(line)):</span><br><span class="line">                <span class="keyword">if</span> line[i] == <span class="string">" "</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                char_list.append(line[i])</span><br><span class="line"></span><br><span class="line">            self.char_set = set(char_list)  <span class="comment"># è®­ç»ƒé¢„æ–™åº“ä¸­æ‰€æœ‰å­—çš„é›†åˆ</span></span><br><span class="line"></span><br><span class="line">            word_list = line.split(<span class="string">" "</span>)</span><br><span class="line">            line_status = []  <span class="comment"># ç»Ÿè®¡çŠ¶æ€åºåˆ—</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> word <span class="keyword">in</span> word_list:</span><br><span class="line">                line_status.extend(self.get_word_status(word))  <span class="comment"># ä¸€å¥è¯å¯¹åº”ä¸€è¡Œè¿ç»­çš„çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> len(char_list) == len(line_status):</span><br><span class="line">                <span class="comment"># print(word_list) # ['ä½†', 'ä»', 'ç”Ÿç‰©å­¦', 'çœ¼å…‰', 'çœ‹', 'å°±', 'å¹¶é', 'å¦‚æ­¤', 'äº†', 'ã€‚']</span></span><br><span class="line">                <span class="comment"># print(line_status) # ['S', 'S', 'B', 'M', 'E', 'B', 'E', 'S', 'S', 'B', 'E', 'B', 'E', 'S', 'S']</span></span><br><span class="line">                <span class="comment"># print('******')</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(len(line_status)):</span><br><span class="line">                    <span class="keyword">if</span> i == <span class="number">0</span>:  <span class="comment"># å¦‚æœåªæœ‰ä¸€ä¸ªè¯ï¼Œåˆ™ç›´æ¥ç®—ä½œæ˜¯åˆå§‹æ¦‚ç‡</span></span><br><span class="line">                        start_dict[line_status[<span class="number">0</span>]] += <span class="number">1</span>  <span class="comment"># start_dictè®°å½•å¥å­ç¬¬ä¸€ä¸ªå­—çš„çŠ¶æ€ï¼Œç”¨äºè®¡ç®—åˆå§‹çŠ¶æ€æ¦‚ç‡</span></span><br><span class="line">                        Count_dict[line_status[<span class="number">0</span>]] += <span class="number">1</span>  <span class="comment"># è®°å½•æ¯ä¸€ä¸ªçŠ¶æ€çš„å‡ºç°æ¬¡æ•°</span></span><br><span class="line">                    <span class="keyword">else</span>:  <span class="comment"># ç»Ÿè®¡ä¸Šä¸€ä¸ªçŠ¶æ€åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œä¸¤ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬ç§»æ¦‚ç‡</span></span><br><span class="line">                        trans_dict[line_status[i - <span class="number">1</span>]][line_status[i]] += <span class="number">1</span>  <span class="comment"># ç”¨äºè®¡ç®—è½¬ç§»æ¦‚ç‡</span></span><br><span class="line">                        Count_dict[line_status[i]] += <span class="number">1</span></span><br><span class="line">                        <span class="comment"># ç»Ÿè®¡å‘å°„æ¦‚ç‡</span></span><br><span class="line">                        <span class="keyword">if</span> char_list[i] <span class="keyword">not</span> <span class="keyword">in</span> emit_dict[line_status[i]]:</span><br><span class="line">                            emit_dict[line_status[i]][char_list[i]] = <span class="number">0.0</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            emit_dict[line_status[i]][char_list[i]] += <span class="number">1</span>  <span class="comment"># ç”¨äºè®¡ç®—å‘å°„æ¦‚ç‡</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(emit_dict)#&#123;'S': &#123;'å¦': 10.0, 'æ˜”': 25.0, 'ç›´': 238.0, 'å…­': 1004.0, 'æ®–': 17.0, 'ä»—': 36.0, 'æŒª': 15.0, 'æœ—': 151.0</span></span><br><span class="line">        <span class="comment"># print(trans_dict)#&#123;'S': &#123;'S': 747969.0, 'E': 0.0, 'M': 0.0, 'B': 563988.0&#125;, 'E': &#123;'S': 737404.0, 'E': 0.0, 'M': 0.0, 'B': 651128.0&#125;,</span></span><br><span class="line">        <span class="comment"># print(start_dict) #&#123;'S': 124543.0, 'E': 0.0, 'M': 0.0, 'B': 173416.0&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿›è¡Œå½’ä¸€åŒ–</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> start_dict:  <span class="comment"># çŠ¶æ€çš„åˆå§‹æ¦‚ç‡</span></span><br><span class="line">            start_dict[key] = start_dict[key] * <span class="number">1.0</span> / self.line_index</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> trans_dict:  <span class="comment"># çŠ¶æ€è½¬ç§»æ¦‚ç‡</span></span><br><span class="line">            <span class="keyword">for</span> key1 <span class="keyword">in</span> trans_dict[key]:</span><br><span class="line">                trans_dict[key][key1] = trans_dict[key][key1] / Count_dict[key]</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> emit_dict:  <span class="comment"># å‘å°„æ¦‚ç‡(çŠ¶æ€-&gt;è¯è¯­çš„æ¡ä»¶æ¦‚ç‡)</span></span><br><span class="line">            <span class="keyword">for</span> word <span class="keyword">in</span> emit_dict[key]:</span><br><span class="line">                emit_dict[key][word] = emit_dict[key][word] / Count_dict[key]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(emit_dict)#&#123;'S': &#123;'å¦': 6.211504202703743e-06, 'æ˜”': 1.5528760506759358e-05, 'ç›´': 0.0001478338000243491,</span></span><br><span class="line">        <span class="comment"># print(trans_dict)#&#123;'S': &#123;'S': 0.46460125869921165, 'E': 0.0, 'M': 0.0, 'B': 0.3503213832274479&#125;,</span></span><br><span class="line">        <span class="comment"># print(start_dict)#&#123;'S': 0.41798844132394497, 'E': 0.0, 'M': 0.0, 'B': 0.5820149148537713&#125;</span></span><br><span class="line">        self.save_model(trans_dict, trans_path)</span><br><span class="line">        self.save_model(emit_dict, emit_path)</span><br><span class="line">        self.save_model(start_dict, start_path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> trans_dict, emit_dict, start_dict</span><br></pre></td></tr></table></figure>
<p>Step 2: ä½¿ç”¨ç»´ç‰¹æ¯”ç®—æ³•ï¼Œæ±‚è§£æ¦‚ç‡æœ€å¤§è·¯å¾„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HmmCut</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,start_model_path,trans_model_path,emit_model_path)</span>:</span></span><br><span class="line">        self.prob_trans = self.load_model(trans_model_path)</span><br><span class="line">        self.prob_emit = self.load_model(emit_model_path)</span><br><span class="line">        self.prob_start = self.load_model(start_model_path)</span><br><span class="line"></span><br><span class="line">    <span class="string">'''åŠ è½½æ¨¡å‹'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load_model</span><span class="params">(self, model_path)</span>:</span></span><br><span class="line">        f = open(model_path, <span class="string">'r'</span>)</span><br><span class="line">        a = f.read()</span><br><span class="line">        word_dict = eval(a)</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">return</span> word_dict</span><br><span class="line"></span><br><span class="line">    <span class="string">'''verterbiç®—æ³•æ±‚è§£'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">viterbi</span><span class="params">(self, obs, states, start_p, trans_p, emit_p)</span>:</span>  <span class="comment"># ç»´ç‰¹æ¯”ç®—æ³•ï¼ˆä¸€ç§é€’å½’ç®—æ³•ï¼‰</span></span><br><span class="line">        <span class="comment"># ç®—æ³•çš„å±€é™åœ¨äºè®­ç»ƒè¯­æ–™è¦è¶³å¤Ÿå¤§ï¼Œéœ€è¦ç»™æ¯ä¸ªè¯ä¸€ä¸ªå‘å°„æ¦‚ç‡,.get(obs[0], 0)çš„ç”¨æ³•æ˜¯å¦‚æœdictä¸­ä¸å­˜åœ¨è¿™ä¸ªkey,åˆ™è¿”å›0å€¼</span></span><br><span class="line">        V = [&#123;&#125;]</span><br><span class="line">        path = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">            V[<span class="number">0</span>][y] = start_p[y] * emit_p[y].get(obs[<span class="number">0</span>], <span class="number">0</span>)  <span class="comment"># åœ¨ä½ç½®0ï¼Œä»¥yçŠ¶æ€ä¸ºæœ«å°¾çš„çŠ¶æ€åºåˆ—çš„æœ€å¤§æ¦‚ç‡</span></span><br><span class="line">            path[y] = [y]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">1</span>, len(obs)):</span><br><span class="line">            V.append(&#123;&#125;)</span><br><span class="line">            newpath = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">                state_path = ([(V[t - <span class="number">1</span>][y0] * trans_p[y0].get(y, <span class="number">0</span>) * emit_p[y].get(obs[t], <span class="number">0</span>), y0) <span class="keyword">for</span> y0 <span class="keyword">in</span> states <span class="keyword">if</span> V[t - <span class="number">1</span>][y0] &gt; <span class="number">0</span>])</span><br><span class="line">                <span class="keyword">if</span> state_path == []:</span><br><span class="line">                    (prob, state) = (<span class="number">0.0</span>, <span class="string">'S'</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    (prob, state) = max(state_path)</span><br><span class="line">                V[t][y] = prob</span><br><span class="line">                newpath[y] = path[state] + [y]</span><br><span class="line"></span><br><span class="line">            path = newpath  <span class="comment"># è®°å½•çŠ¶æ€åºåˆ—</span></span><br><span class="line">        (prob, state) = max([(V[len(obs) - <span class="number">1</span>][y], y) <span class="keyword">for</span> y <span class="keyword">in</span> states])  <span class="comment"># åœ¨æœ€åä¸€ä¸ªä½ç½®ï¼Œä»¥yçŠ¶æ€ä¸ºæœ«å°¾çš„çŠ¶æ€åºåˆ—çš„æœ€å¤§æ¦‚ç‡</span></span><br><span class="line">        <span class="keyword">return</span> (prob, path[state])  <span class="comment"># è¿”å›æ¦‚ç‡å’ŒçŠ¶æ€åºåˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ†è¯ä¸»æ§å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cut</span><span class="params">(self, sent)</span>:</span></span><br><span class="line">        prob, pos_list = self.viterbi(sent, (<span class="string">'B'</span>, <span class="string">'M'</span>, <span class="string">'E'</span>, <span class="string">'S'</span>), self.prob_start, self.prob_trans, self.prob_emit)</span><br><span class="line">        seglist = list()</span><br><span class="line">        word = list()</span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> range(len(pos_list)):</span><br><span class="line">            <span class="keyword">if</span> pos_list[index] == <span class="string">'S'</span>:</span><br><span class="line">                word.append(sent[index])</span><br><span class="line">                seglist.append(word)</span><br><span class="line">                word = []</span><br><span class="line">            <span class="keyword">elif</span> pos_list[index] <span class="keyword">in</span> [<span class="string">'B'</span>, <span class="string">'M'</span>]:</span><br><span class="line">                word.append(sent[index])</span><br><span class="line">            <span class="keyword">elif</span> pos_list[index] == <span class="string">'E'</span>:</span><br><span class="line">                word.append(sent[index])</span><br><span class="line">                seglist.append(word)</span><br><span class="line">                word = []</span><br><span class="line">        seglist = [<span class="string">''</span>.join(tmp) <span class="keyword">for</span> tmp <span class="keyword">in</span> seglist]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> seglist</span><br></pre></td></tr></table></figure>
<p>å¦‚æœç”»å‡ºçŠ¶æ€è½¬ç§»å›¾åƒï¼Œå‘ç°çŠ¶æ€åªèƒ½åœ¨å±‚é—´ç‚¹è½¬ç§»ï¼Œè½¬ç§»è·¯å¾„ä¸Šçš„åˆ†æ•°ä¸ºæ¦‚ç‡ï¼Œæ±‚ä¸€æ¡æ¦‚ç‡æœ€å¤§çš„è·¯å¾„ã€‚è¿™å¯ä»¥ç”¨ç»´ç‰¹æ¯”ç®—æ³•è®¡ç®—ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªåŠ¨æ€è§„åˆ’</p>
<p><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/hmm_viterbi.png" alt="avatar"></p>
<h5 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p><strong>ä»ä¸‰æ–¹é¢æ¯”è¾ƒHMMå’ŒN-gramã€‚</strong></p>
<ol>
<li>HMMæ¨¡å‹æ˜¯ä¸€ä¸ªç”Ÿæˆæ¨¡å‹ï¼ŒåŒºåˆ«äºN-gramè¯­è¨€æ¨¡å‹ï¼ŒHMMæ²¡æœ‰ç›´æ¥å¯¹ç»™å®šè§‚æµ‹å€¼åçŠ¶æ€çš„åˆ†å¸ƒ $P(S|O)$ï¼ˆ<em>O</em> ä»£è¡¨è§‚æµ‹åºåˆ—ï¼‰è¿›è¡Œå»ºæ¨¡ï¼Œè€Œæ˜¯å¯¹çŠ¶æ€åºåˆ—æœ¬èº«çš„åˆ†å¸ƒ$P(S)$å’Œç»™å®šçŠ¶æ€åè§‚æµ‹å€¼çš„åˆ†å¸ƒ $p(O|S)$å»ºæ¨¡ ï¼›</li>
<li>å­¦ä¹ è¿‡ç¨‹ä¸N-gramç›¸åŒï¼ŒHMMåœ¨æœ‰ç›‘ç£å­¦ä¹ çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡å‚æ•°ï¼›</li>
<li>é¢„æµ‹æ—¶ï¼ŒHMMé‡‡ç”¨ç»´ç‰¹æ¯”ç®—æ³•ã€‚</li>
</ol>
<h4 id="CRFåˆ†è¯"><a href="#CRFåˆ†è¯" class="headerlink" title="CRFåˆ†è¯"></a>CRFåˆ†è¯</h4><h5 id="æ¡ä»¶éšæœºåœºCRF"><a href="#æ¡ä»¶éšæœºåœºCRF" class="headerlink" title="æ¡ä»¶éšæœºåœºCRF"></a>æ¡ä»¶éšæœºåœºCRF</h5><p>æ¡ä»¶éšæœºåœºåŸºäºæ¦‚ç‡æ— å‘å›¾æ¨¡å‹ï¼Œåˆ©ç”¨æœ€å¤§å›¢ç†è®ºï¼Œå¯¹éšæœºå˜é‡çš„è”åˆåˆ†å¸ƒ$P(Y)$è¿›è¡Œå»ºæ¨¡ã€‚</p>
<p>åœ¨åºåˆ—æ ‡æ³¨ä»»åŠ¡ä¸­çš„æ¡ä»¶éšæœºåœºï¼Œå¾€å¾€æ˜¯æŒ‡<strong>çº¿æ€§é“¾æ¡ä»¶éšæœºåœº</strong>ï¼Œè¿™æ—¶ï¼Œåœ¨æ¡ä»¶æ¦‚ç‡æ¨¡å‹$P(Y|X)$ä¸­ï¼Œ$Y$æ˜¯è¾“å‡ºå˜é‡ï¼Œè¡¨ç¤ºæ ‡è®°åºåˆ—ï¼ˆæˆ–çŠ¶æ€åºåˆ—ï¼‰ï¼Œ$X$æ˜¯è¾“å…¥å˜é‡ï¼Œè¡¨ç¤ºéœ€è¦æ ‡æ³¨çš„è§‚æµ‹åºåˆ—ã€‚å­¦ä¹ æ—¶ï¼Œåˆ©ç”¨è®­ç»ƒæ•°æ®é›†é€šè¿‡æå¤§ä¼¼ç„¶ä¼°è®¡æˆ–æ­£åˆ™åŒ–çš„æå¤§ä¼¼ç„¶ä¼°è®¡å¾—åˆ°æ¡ä»¶æ¦‚ç‡æ¨¡å‹$p(Y|X)$ï¼›é¢„æµ‹æ—¶ï¼Œå¯¹äºç»™å®šçš„è¾“å…¥åºåˆ—xï¼Œæ±‚å‡ºæ¡ä»¶æ¦‚ç‡$p(y|x)$æœ€å¤§çš„è¾“å‡ºåºåˆ—y.</p>
<h6 id="æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼"><a href="#æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼" class="headerlink" title="æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼"></a>æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼</h6><script type="math/tex; mode=display">
P(y|x)=\frac{1}{Z(x)} \exp \left(\sum_{i, k} \lambda_{k} t_{k}\left(y_{i-1}, y_{i}, x, i\right)+\sum_{i, j} \mu_{l} s_{l}\left(y_{i}, x, i\right)\right) 
\\
Z(x)=\sum_{y} \exp \left(\sum_{i, k} \lambda_{k} t_{k}\left(y_{i-1}, y_{i}, x, i\right)+\sum_{i, j} \mu_{l} s_{l}\left(y_{i}, x, i\right)\right)</script><h5 id="æ¡ä»¶éšæœºåœºåˆ†è¯æ–¹æ³•"><a href="#æ¡ä»¶éšæœºåœºåˆ†è¯æ–¹æ³•" class="headerlink" title="æ¡ä»¶éšæœºåœºåˆ†è¯æ–¹æ³•"></a>æ¡ä»¶éšæœºåœºåˆ†è¯æ–¹æ³•</h5><p>æ¡ä»¶éšæœºåœºå’Œéšé©¬å°”å¯å¤«ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä½¿ç”¨BMESå››ä¸ªçŠ¶æ€ä½æ¥è¿›è¡Œåˆ†è¯ã€‚ä»¥å¦‚ä¸‹å¥å­ä¸ºä¾‹ï¼š</p>
<p>ä¸­ å›½ æ˜¯ æ³± æ³± å¤§ å›½<br>B  B  B  B  B  B  B<br>M M M M M M M<br>E  E  E  E  E  E  E<br>S  S  S  S  S  S  S</p>
<p>æ¡ä»¶éšæœºåœºè§£ç å°±æ˜¯åœ¨ä»¥ä¸Šç”±æ ‡è®°ç»„æˆçš„æ•°ç»„ä¸­æœç´¢ä¸€æ¡æœ€ä¼˜çš„è·¯å¾„ã€‚</p>
<p>è¦æŠŠæ¯ä¸€ä¸ªå­—(å³è§‚å¯Ÿå˜é‡)å¯¹åº”çš„æ¯ä¸€ä¸ªçŠ¶æ€BMES(å³æ ‡è®°å˜é‡)çš„æ¦‚ç‡éƒ½æ±‚å‡ºæ¥ã€‚ä¾‹å¦‚å¯¹äºè§‚å¯Ÿå˜é‡â€œå›½â€ï¼Œå½“å‰æ ‡è®°å˜é‡ä¸ºEï¼Œå‰ä¸€ä¸ªè§‚å¯Ÿå˜é‡ä¸ºâ€œä¸­â€ï¼Œå‰ä¸€ä¸ªæ ‡è®°å˜é‡ä¸ºBï¼Œåˆ™ï¼št(B, E, â€˜å›½â€™) å¯¹åº”åˆ°æ¡ä»¶éšæœºåœºé‡Œç›¸é‚»æ ‡è®°å˜é‡$(y_{i-1},y_i)$çš„åŠ¿å‡½æ•°ã€‚s(E, â€˜å›½â€™) å¯¹åº”åˆ°æ¡ä»¶éšæœºåœºé‡Œå•ä¸ªæ ‡è®°å˜é‡$y_i$å¯¹åº”çš„åŠ¿å‡½æ•°$s_l(y_i,x,i)$ã€‚t(B, E, â€˜å›½â€™), s(E, â€˜å›½â€™)ç›¸åº”çš„æƒå€¼$Î»_k,\mu_l$ï¼Œ éƒ½æ˜¯ç”±æ¡ä»¶éšæœºåœºç”¨å¤§é‡çš„æ ‡æ³¨è¯­æ–™è®­ç»ƒå‡ºæ¥ã€‚å› æ­¤åˆ†è¯çš„æ ‡è®°è¯†åˆ«å°±æ˜¯æ±‚å¯¹äºå„ä¸ªè§‚å¯Ÿå˜é‡ï¼Œå®ƒä»¬çš„æ ‡è®°å˜é‡(BMES)çŠ¶æ€åºåˆ—çš„æ¦‚ç‡æœ€å¤§å€¼ï¼Œå³æ±‚ï¼šçš„æ¦‚ç‡ç»„åˆæœ€å¤§å€¼ã€‚è¿™ä¸ªè§£æ³•ä¸éšé©¬å°”å¯å¤«ç±»ä¼¼ï¼Œå¯ä»¥ç”¨viterbiç®—æ³•æ±‚è§£ã€‚</p>
<h5 id="ä»£ç -5"><a href="#ä»£ç -5" class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><p>ä½¿ç”¨crf++å®ç°å¯¹æ¨¡å‹çš„è®­ç»ƒï¼Œcrf++ å®‰è£…ã€æ•°æ®æ ¼å¼åŠæ¨¡æ¿å‚æ•°è¯·å‚è€ƒï¼š<a href="https://jeffery0628.github.io/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/">åºåˆ—æ ‡æ³¨</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> CRFPP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRFModel</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, model=<span class="string">'model_name'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: ç±»åˆå§‹åŒ–</span></span><br><span class="line"><span class="string">        :param model: æ¨¡å‹åç§°</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.model = model</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_tagger</span><span class="params">(self, tag_data)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: æ·»åŠ è¯­æ–™</span></span><br><span class="line"><span class="string">        :param tag_data: æ•°æ®</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        word_str = tag_data.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.model):</span><br><span class="line">            print(<span class="string">'æ¨¡å‹ä¸å­˜åœ¨,è¯·ç¡®è®¤æ¨¡å‹è·¯å¾„æ˜¯å¦æ­£ç¡®!'</span>)</span><br><span class="line">            exit()</span><br><span class="line">        tagger = CRFPP.Tagger(<span class="string">"-m &#123;&#125; -v 3 -n2"</span>.format(self.model))</span><br><span class="line">        tagger.clear()</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> word_str:</span><br><span class="line">            tagger.add(word)</span><br><span class="line">        tagger.parse()</span><br><span class="line">        <span class="keyword">return</span> tagger</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">text_mark</span><span class="params">(self, tag_data, begin=<span class="string">'B'</span>, middle=<span class="string">'I'</span>, end=<span class="string">'E'</span>, single=<span class="string">'S'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ–‡æœ¬æ ‡è®°</span></span><br><span class="line"><span class="string">        :param tag_data: æ•°æ®</span></span><br><span class="line"><span class="string">        :param begin: å¼€å§‹æ ‡è®°</span></span><br><span class="line"><span class="string">        :param middle: ä¸­é—´æ ‡è®°</span></span><br><span class="line"><span class="string">        :param end: ç»“æŸæ ‡è®°</span></span><br><span class="line"><span class="string">        :param single: å•å­—ç»“æŸæ ‡è®°</span></span><br><span class="line"><span class="string">        :return result: æ ‡è®°åˆ—è¡¨</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        tagger = self.add_tagger(tag_data)</span><br><span class="line">        size = tagger.size()</span><br><span class="line">        tag_text = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, size):</span><br><span class="line">            word, tag = tagger.x(i, <span class="number">0</span>), tagger.y2(i)</span><br><span class="line">            <span class="keyword">if</span> tag <span class="keyword">in</span> [begin, middle]:</span><br><span class="line">                tag_text += word</span><br><span class="line">            <span class="keyword">elif</span> tag <span class="keyword">in</span> [end, single]:</span><br><span class="line">                tag_text += word + <span class="string">"*&amp;*"</span></span><br><span class="line">        result = tag_text.split(<span class="string">'*&amp;*'</span>)</span><br><span class="line">        result.pop()</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crf_test</span><span class="params">(self, tag_data, separator=<span class="string">'/'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: crfæµ‹è¯•</span></span><br><span class="line"><span class="string">        :param tag_data:</span></span><br><span class="line"><span class="string">        :param separator:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        result = self.text_mark(tag_data)</span><br><span class="line">        data = separator.join(result)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crf_learn</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: è®­ç»ƒæ¨¡å‹</span></span><br><span class="line"><span class="string">        :param filename: å·²æ ‡æ³¨æ•°æ®æº</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        crf_bash = <span class="string">"crf_learn -f 3 -c 4.0 data/template.txt &#123;&#125; &#123;&#125;"</span>.format(filename, self.model)</span><br><span class="line">        process = subprocess.Popen(crf_bash.split(), stdout=subprocess.PIPE)</span><br><span class="line">        output = process.communicate()[<span class="number">0</span>]</span><br><span class="line">        print(output.decode(encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">    crf_model = CRFModel(model=<span class="string">'data/model_crf'</span>)</span><br><span class="line">    crf_model.crf_learn(filename=<span class="string">'data/train_file_crf.txt'</span>)</span><br><span class="line">    <span class="comment"># é¢„æµ‹</span></span><br><span class="line">    print(crf_model.crf_test(tag_data=<span class="string">'æˆ‘ä»¬ä¸€å®šè¦æˆ˜èƒœæ•Œäººï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒä»¬éƒ½æ˜¯çº¸è€è™ã€‚'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="æ¡ä»¶éšæœºåœºåˆ†è¯çš„ä¼˜ç¼ºç‚¹"><a href="#æ¡ä»¶éšæœºåœºåˆ†è¯çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="æ¡ä»¶éšæœºåœºåˆ†è¯çš„ä¼˜ç¼ºç‚¹"></a>æ¡ä»¶éšæœºåœºåˆ†è¯çš„ä¼˜ç¼ºç‚¹</h5><p>æ¡ä»¶éšæœºåœºåˆ†è¯æ˜¯ä¸€ç§ç²¾åº¦å¾ˆé«˜çš„åˆ†è¯æ–¹æ³•ï¼Œå®ƒæ¯”éšé©¬å°”å¯å¤«çš„ç²¾åº¦è¦é«˜ï¼Œæ˜¯å› ä¸ºéšé©¬å°”å¯å¤«å‡è®¾è§‚å¯Ÿå˜é‡$x_i$åªä¸å½“å‰çŠ¶æ€$y_i$æœ‰å…³ï¼Œè€Œä¸å…¶å®ƒçŠ¶æ€$y_{i-1}$ï¼Œ$y_{i+1}$æ— å…³;è€Œæ¡ä»¶éšæœºåœºå‡è®¾äº†å½“å‰è§‚å¯Ÿå˜é‡$x_i$ä¸ä¸Šä¸‹æ–‡ç›¸å…³ï¼Œå¦‚ ï¼Œå°±æ˜¯è€ƒè™‘åˆ°ä¸Šä¸€ä¸ªå­—æ ‡è®°çŠ¶æ€ä¸ºBæ—¶ï¼Œå½“å‰æ ‡è®°çŠ¶æ€ä¸ºEå¹¶ä¸”è¾“å‡ºâ€œå›½â€å­—çš„æ¦‚ç‡ã€‚å› æ­¤é€šè¿‡ä¸Šä¸‹æ–‡çš„åˆ†æï¼Œæ¡ä»¶éšæœºåœºåˆ†è¯ä¼šæå‡åˆ°æ›´é«˜çš„ç²¾åº¦ã€‚ä½†å› ä¸ºå¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œæ¡ä»¶éšæœºåœºä¸€èˆ¬è®­ç»ƒä»£ä»·éƒ½æ¯”è¾ƒå¤§ã€‚</p>
<h4 id="ç»“æ„åŒ–æ„ŸçŸ¥æœºåˆ†è¯ç®—æ³•"><a href="#ç»“æ„åŒ–æ„ŸçŸ¥æœºåˆ†è¯ç®—æ³•" class="headerlink" title="ç»“æ„åŒ–æ„ŸçŸ¥æœºåˆ†è¯ç®—æ³•"></a>ç»“æ„åŒ–æ„ŸçŸ¥æœºåˆ†è¯ç®—æ³•</h4><p>åˆ©ç”¨éšé©¬å°”ç§‘å¤«æ¨¡å‹å®ç°åŸºäºåºåˆ—æ ‡æ³¨çš„ä¸­æ–‡åˆ†è¯å™¨ï¼Œæ•ˆæœå¹¶ä¸ç†æƒ³ã€‚äº‹å®ä¸Šï¼Œéšé©¬å°”å¯å¤«æ¨¡å‹å‡è®¾äººä»¬è¯´çš„è¯ä»…ä»…å–å†³äºä¸€ä¸ªéšè—çš„BMESåºåˆ—ï¼Œè¿™ä¸ªå‡è®¾å¤ªå•çº¯äº†ï¼Œä¸ç¬¦åˆè¯­è¨€è§„å¾‹ã€‚è¯­è¨€ä¸æ˜¯ç”±è¿™ä¹ˆç®€å•çš„æ ‡ç­¾åºåˆ—ç”Ÿæˆï¼Œè¯­è¨€å«æœ‰æ›´å¤šç‰¹å¾ï¼Œè€Œéšé©¬å°”ç§‘å¤«æ¨¡å‹æ²¡æœ‰æ•æ‰åˆ°ã€‚<strong>éšé©¬å¼¥å¯å¤«æ¨¡å‹èƒ½æ•æ‰çš„ç‰¹å¾ä»…é™äºä¸¤ç§: å…¶ä¸€ï¼Œå‰ä¸€ä¸ªæ ‡ç­¾æ˜¯ä»€ä¹ˆï¼›å…¶äºŒï¼Œå½“å‰å­—ç¬¦æ˜¯ä»€ä¹ˆ</strong>ã€‚ä¸ºäº†åˆ©ç”¨æ›´å¤šçš„ç‰¹å¾ï¼Œçº¿æ€§æ¨¡å‹( linear model )åº”è¿è€Œç”Ÿã€‚çº¿æ€§æ¨¡å‹ç”±ä¸¤éƒ¨åˆ†æ„æˆ: ä¸€ç³»åˆ—ç”¨æ¥æå–ç‰¹å¾çš„ç‰¹å¾å‡½æ•°$\phi$ï¼Œä»¥åŠç›¸åº”çš„æƒé‡å‘é‡$w$ã€‚</p>
<h5 id="æ„ŸçŸ¥æœºç®—æ³•"><a href="#æ„ŸçŸ¥æœºç®—æ³•" class="headerlink" title="æ„ŸçŸ¥æœºç®—æ³•"></a>æ„ŸçŸ¥æœºç®—æ³•</h5><p>æ„ŸçŸ¥æœºç®—æ³•æ˜¯ä¸€ç§è¿­ä»£å¼çš„ç®—æ³•ï¼šåœ¨è®­ç»ƒé›†ä¸Šè¿è¡Œå¤šä¸ªè¿­ä»£ï¼Œæ¯æ¬¡è¯»å…¥ä¸€ä¸ªæ ·æœ¬ï¼Œæ‰§è¡Œé¢„æµ‹ï¼Œå°†é¢„æµ‹ç»“æœä¸æ­£ç¡®ç­”æ¡ˆè¿›è¡Œå¯¹æ¯”ï¼Œè®¡ç®—è¯¯å·®ï¼Œæ ¹æ®è¯¯å·®æ›´æ–°æ¨¡å‹å‚æ•°ï¼Œå†æ¬¡è¿›è¡Œè®­ç»ƒï¼Œç›´åˆ°è¯¯å·®æœ€å°ä¸ºæ­¢ã€‚</p>
<ul>
<li><strong>æŸå¤±å‡½æ•°</strong>: ä»æ•°å€¼ä¼˜åŒ–çš„è§’åº¦æ¥è®²ï¼Œè¿­ä»£å¼æœºå™¨å­¦ä¹ ç®—æ³•éƒ½åœ¨ä¼˜åŒ–(å‡å°)ä¸€ä¸ªæŸå¤±å‡½æ•°ã€‚æŸå¤±å‡½æ•° J(w) ç”¨æ¥è¡¡é‡æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„é”™è¯¯ç¨‹åº¦ï¼Œè‡ªå˜é‡æ˜¯æ¨¡å‹å‚æ•° $w$ï¼Œå› å˜é‡æ˜¯ä¸€ä¸ªæ ‡é‡ï¼Œè¡¨ç¤ºæ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„æŸå¤±çš„å¤§å°ã€‚</li>
<li><strong>æ¢¯åº¦ä¸‹é™</strong>: ç»™å®šæ ·æœ¬ï¼Œå…¶ç‰¹å¾å‘é‡ $x$ åªæ˜¯å¸¸æ•°ï¼Œå¯¹ $J(w)$ æ±‚å¯¼ï¼Œå¾—åˆ°ä¸€ä¸ªæ¢¯åº¦å‘é‡ $\Delta w$ï¼Œå®ƒçš„åæ–¹å‘ä¸€å®šæ˜¯å½“å‰ä½ç½®æŸå¤±å‡½æ•°å‡å°é€Ÿåº¦æœ€å¿«çš„æ–¹å‘ã€‚å¦‚æœå‚æ•°ç‚¹ $w$ åæ–¹å‘ç§»åŠ¨å°±ä¼šä½¿æŸå¤±å‡½æ•°å‡å°ï¼Œå«æ¢¯åº¦ä¸‹é™ã€‚</li>
<li><strong>å­¦ä¹ ç‡</strong>: æ¢¯åº¦ä¸‹é™çš„æ­¥é•¿å«åšå­¦ä¹ ç‡ã€‚</li>
<li><strong>éšæœºæ¢¯åº¦ä¸‹é™</strong>(SGD): å¦‚æœç®—æ³•æ¯æ¬¡è¿­ä»£éšæœºé€‰å–éƒ¨åˆ†æ ·æœ¬è®¡ç®—æŸå¤±å‡½æ•°çš„æ¢¯åº¦ï¼Œåˆ™ç§°ä¸ºéšæœºæ¢¯åº¦ä¸‹é™ã€‚</li>
</ul>
<p>å‡å¦‚æ•°æ®æœ¬èº«çº¿æ€§ä¸å¯åˆ†ï¼Œæ„ŸçŸ¥æœºæŸå¤±å‡½æ•°ä¸ä¼šæ”¶æ•›ï¼Œæ¯æ¬¡è¿­ä»£åˆ†ç¦»è¶…å¹³é¢éƒ½ä¼šå‰§çƒˆæŒ¯è¡ã€‚è¿™æ—¶å¯ä»¥å¯¹æ„ŸçŸ¥æœºç®—æ³•æ‰“è¡¥ä¸ï¼Œä½¿ç”¨æŠ•ç¥¨æ„ŸçŸ¥æœºæˆ–å¹³å‡æ„ŸçŸ¥æœºã€‚</p>
<ol>
<li><p><strong>æŠ•ç¥¨æ„ŸçŸ¥æœº</strong>ï¼šæ¯æ¬¡è¿­ä»£çš„æ¨¡å‹éƒ½ä¿ç•™ï¼Œå‡†ç¡®ç‡ä¹Ÿä¿ç•™ï¼Œé¢„æµ‹æ—¶ï¼Œæ¯ä¸ªæ¨¡å‹éƒ½ç»™å‡ºè‡ªå·±çš„ç»“æœï¼Œä¹˜ä»¥å®ƒçš„å‡†ç¡®ç‡åŠ æƒå¹³å‡å€¼ä½œä¸ºæœ€ç»ˆç»“æœã€‚</p>
</li>
<li><p>æŠ•ç¥¨æ„ŸçŸ¥æœºè¦æ±‚å­˜å‚¨å¤šä¸ªæ¨¡å‹åŠåŠ æƒï¼Œè®¡ç®—å¼€é”€è¾ƒå¤§ï¼Œæ›´å®é™…çš„åšæ³•æ˜¯å–å¤šä¸ªæ¨¡å‹çš„æƒé‡çš„å¹³å‡ï¼Œè¿™å°±æ˜¯<strong>å¹³å‡æ„ŸçŸ¥æœº</strong>ã€‚</p>
</li>
</ol>
<h5 id="ç»“æ„åŒ–é¢„æµ‹é—®é¢˜"><a href="#ç»“æ„åŒ–é¢„æµ‹é—®é¢˜" class="headerlink" title="ç»“æ„åŒ–é¢„æµ‹é—®é¢˜"></a>ç»“æ„åŒ–é¢„æµ‹é—®é¢˜</h5><p>è‡ªç„¶è¯­è¨€å¤„ç†é—®é¢˜å¤§è‡´å¯åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç§æ˜¯åˆ†ç±»é—®é¢˜ï¼Œå¦ä¸€ç§å°±æ˜¯ç»“æ„åŒ–é¢„æµ‹é—®é¢˜ï¼Œåºåˆ—æ ‡æ³¨åªæ˜¯ç»“æ„åŒ–é¢„æµ‹çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå¯¹æ„ŸçŸ¥æœºç¨ä½œæ‹“å±•ï¼Œåˆ†ç±»å™¨å°±èƒ½æ”¯æŒç»“æ„åŒ–é¢„æµ‹ã€‚<br>ä¿¡æ¯çš„å±‚æ¬¡ç»“æ„ç‰¹ç‚¹ç§°ä½œç»“æ„åŒ–ã€‚<strong>é‚£ä¹ˆç»“æ„åŒ–é¢„æµ‹</strong>(structhreï¼Œprediction)åˆ™æ˜¯é¢„æµ‹å¯¹è±¡ç»“æ„çš„ä¸€ç±»ç›‘ç£å­¦ä¹ é—®é¢˜ã€‚ç›¸åº”çš„æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ç§°ä½œ<strong>ç»“æ„åŒ–å­¦ä¹ </strong>(stutured laming )ã€‚åˆ†ç±»é—®é¢˜çš„é¢„æµ‹ç»“æœæ˜¯ä¸€ä¸ªå†³ç­–è¾¹ç•Œï¼Œ å›å½’é—®é¢˜çš„é¢„æµ‹ç»“æœæ˜¯ä¸€ä¸ªå®æ•°æ ‡é‡ï¼Œè€Œç»“æ„åŒ–é¢„æµ‹çš„ç»“æœåˆ™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç»“æ„ã€‚<br>è‡ªç„¶è¯­è¨€å¤„ç†ä¸­æœ‰è®¸å¤šä»»åŠ¡æ˜¯ç»“æ„åŒ–é¢„æµ‹ï¼Œæ¯”å¦‚åºåˆ—æ ‡æ³¨é¢„æµ‹ç»“æ„æ˜¯ä¸€æ•´ä¸ªåºåˆ—ï¼Œå¥æ³•åˆ†æé¢„æµ‹ç»“æ„æ˜¯ä¸€æ£µå¥æ³•æ ‘ï¼Œæœºå™¨ç¿»è¯‘é¢„æµ‹ç»“æ„æ˜¯ä¸€æ®µå®Œæ•´çš„è¯‘æ–‡ã€‚è¿™äº›ç»“æ„ç”±è®¸å¤šéƒ¨åˆ†æ„æˆï¼Œæœ€å°çš„éƒ¨åˆ†è™½ç„¶ä¹Ÿæ˜¯åˆ†ç±»é—®é¢˜(æ¯”å¦‚ä¸­æ–‡åˆ†è¯æ—¶æ¯ä¸ªå­—ç¬¦åˆ†ç±»ä¸º{B,M,E,S} ),ä½†å¿…é¡»è€ƒè™‘ç»“æ„æ•´ä½“çš„åˆç†ç¨‹åº¦ã€‚</p>
<h6 id="ç»“æ„åŒ–é¢„æµ‹ä¸å­¦ä¹ æµç¨‹"><a href="#ç»“æ„åŒ–é¢„æµ‹ä¸å­¦ä¹ æµç¨‹" class="headerlink" title="ç»“æ„åŒ–é¢„æµ‹ä¸å­¦ä¹ æµç¨‹"></a>ç»“æ„åŒ–é¢„æµ‹ä¸å­¦ä¹ æµç¨‹</h6><p>ç»“æ„åŒ–é¢„æµ‹çš„è¿‡ç¨‹å°±æ˜¯ç»™å®šä¸€ä¸ªæ¨¡å‹ Î» åŠæ‰“åˆ†å‡½æ•° scoreï¼Œåˆ©ç”¨æ‰“åˆ†å‡½æ•°ç»™ä¸€äº›å¤‡é€‰ç»“æ„æ‰“åˆ†ï¼Œé€‰æ‹©åˆ†æ•°æœ€é«˜çš„ç»“æ„ä½œä¸ºé¢„æµ‹è¾“å‡ºï¼Œå…¬å¼å¦‚ä¸‹:</p>
<script type="math/tex; mode=display">
\hat{y}=\arg \max _{y \in Y} \operatorname{score}({\lambda}(x, y))</script><p>å…¶ä¸­ï¼ŒY æ˜¯å¤‡é€‰ç»“æ„çš„é›†åˆã€‚æ—¢ç„¶ç»“æ„åŒ–é¢„æµ‹å°±æ˜¯æœç´¢å¾—åˆ†æœ€é«˜çš„ç»“æ„ yï¼Œé‚£ä¹ˆç»“æ„åŒ–å­¦ä¹ çš„ç›®æ ‡å°±æ˜¯æƒ³æ–¹è®¾æ³•è®©æ­£ç¡®ç­”æ¡ˆ y çš„å¾—åˆ†æœ€é«˜ã€‚ä¸åŒçš„æ¨¡å‹æœ‰ä¸åŒçš„ç®—æ³•ï¼Œå¯¹äºçº¿æ€§æ¨¡å‹ï¼Œè®­ç»ƒç®—æ³•ä¸ºç»“æ„åŒ–æ„ŸçŸ¥æœºã€‚</p>
<h5 id="ç»“æ„åŒ–æ„ŸçŸ¥æœºç®—æ³•"><a href="#ç»“æ„åŒ–æ„ŸçŸ¥æœºç®—æ³•" class="headerlink" title="ç»“æ„åŒ–æ„ŸçŸ¥æœºç®—æ³•"></a>ç»“æ„åŒ–æ„ŸçŸ¥æœºç®—æ³•</h5><p>è¦è®©çº¿æ€§æ¨¡å‹æ”¯æŒç»“æ„åŒ–é¢„æµ‹ï¼Œå¿…é¡»å…ˆè®¾è®¡æ‰“åˆ†å‡½æ•°ã€‚æ‰“åˆ†å‡½æ•°çš„è¾“å…¥æœ‰ä¸¤ä¸ªç¼ºä¸€ä¸å¯çš„å‚æ•°: ç‰¹å¾ $x$ å’Œç»“æ„$y$ã€‚ä½†ä¹‹å‰çš„çº¿æ€§æ¨¡å‹çš„â€œæ‰“åˆ†å‡½æ•°â€åªæ¥å—ä¸€ä¸ªè‡ªå˜é‡ $x$ã€‚åšæ³•æ˜¯å®šä¹‰æ–°çš„ç‰¹å¾å‡½æ•°$\phi (x,y)$ï¼ŒæŠŠç»“æ„ $y$ ä¹Ÿä½œä¸ºä¸€ç§ç‰¹å¾ï¼Œè¾“å‡ºæ–°çš„â€œç»“æ„åŒ–ç‰¹å¾å‘é‡â€ã€‚æ–°ç‰¹å¾å‘é‡ä¸æƒé‡å‘é‡åšç‚¹ç§¯åï¼Œå°±å¾—åˆ°ä¸€ä¸ªæ ‡é‡ï¼Œå°†å…¶ä½œä¸ºåˆ†æ•°:</p>
<script type="math/tex; mode=display">
\operatorname{score}(x, y)=w \cdot \phi(x, y)</script><p>æ‰“åˆ†å‡½æ•°æœ‰äº†ï¼Œå–åˆ†å€¼æœ€å¤§çš„ç»“æ„ä½œä¸ºé¢„æµ‹ç»“æœï¼Œå¾—åˆ°ç»“æ„åŒ–é¢„æµ‹å‡½æ•°:</p>
<script type="math/tex; mode=display">
\hat{y}=\arg \max _{y \in Y}(w \cdot \phi(x, y))</script><p>é¢„æµ‹å‡½æ•°ä¸çº¿æ€§åˆ†ç±»å™¨çš„å†³ç­–å‡½æ•°å¾ˆåƒï¼Œéƒ½æ˜¯æƒé‡å‘é‡ç‚¹ç§¯ç‰¹å¾å‘é‡ã€‚é‚£ä¹ˆæ„ŸçŸ¥æœºç®—æ³•ä¹Ÿå¯ä»¥æ‹“å±•å¤ç”¨ï¼Œå¾—åˆ°çº¿æ€§æ¨¡å‹çš„ç»“æ„åŒ–å­¦ä¹ ç®—æ³•:</p>
<ol>
<li>è¯»å…¥æ ·æœ¬ $(x,y)$ï¼Œè¿›è¡Œç»“æ„åŒ–é¢„æµ‹$\hat{y}=\arg \max _{y \in Y}(w \cdot \phi(x, y))$</li>
<li>ä¸æ­£ç¡®ç­”æ¡ˆç›¸æ¯”ï¼Œè‹¥ä¸ç›¸ç­‰ï¼Œåˆ™æ›´æ–°å‚æ•°: å¥–åŠ±æ­£ç¡®ç­”æ¡ˆè§¦å‘çš„ç‰¹å¾å‡½æ•°çš„æƒé‡ï¼Œå¦åˆ™è¿›è¡Œæƒ©ç½š:$w \leftarrow w+\phi\left(x^{(i)}, y\right)-\phi\left(x^{(i)}, \hat{y}\right)$</li>
<li>è°ƒæ•´å­¦ä¹ ç‡:$\boldsymbol{w} \leftarrow \boldsymbol{w}+\alpha\left(\phi\left(\boldsymbol{x}^{(i)}, \boldsymbol{y}\right)-\phi\left(\boldsymbol{x}^{(i)}, \hat{\boldsymbol{y}}\right)\right)$</li>
</ol>
<h6 id="ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸æ„ŸçŸ¥æœºç®—æ³•æ¯”è¾ƒ"><a href="#ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸æ„ŸçŸ¥æœºç®—æ³•æ¯”è¾ƒ" class="headerlink" title="ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸æ„ŸçŸ¥æœºç®—æ³•æ¯”è¾ƒ"></a>ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸æ„ŸçŸ¥æœºç®—æ³•æ¯”è¾ƒ</h6><ul>
<li>ç»“æ„åŒ–æ„ŸçŸ¥æœºä¿®æ”¹äº†ç‰¹å¾å‘é‡ã€‚</li>
<li>ç»“æ„åŒ–æ„ŸçŸ¥æœºçš„å‚æ•°æ›´æ–°èµç½šåˆ†æ˜ã€‚</li>
</ul>
<h6 id="ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸åºåˆ—æ ‡æ³¨"><a href="#ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸åºåˆ—æ ‡æ³¨" class="headerlink" title="ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸åºåˆ—æ ‡æ³¨"></a>ç»“æ„åŒ–æ„ŸçŸ¥æœºä¸åºåˆ—æ ‡æ³¨</h6><p>åºåˆ—æ ‡æ³¨æœ€å¤§çš„ç»“æ„ç‰¹ç‚¹å°±æ˜¯æ ‡ç­¾ç›¸äº’ä¹‹é—´çš„ä¾èµ–æ€§ï¼Œè¿™ç§ä¾èµ–æ€§åˆ©ç”¨åˆå§‹çŠ¶æ€æ¦‚ç‡æƒ³ä¿©ç‹—å’ŒçŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µä½“ç³»é‚£ï¼Œé‚£ä¹ˆå¯¹äºç»“æ„åŒ–æ„ŸçŸ¥æœºï¼Œå°±å¯ä»¥ä½¿ç”¨<strong>è½¬ç§»ç‰¹å¾</strong>æ¥è¡¨ç¤º:</p>
<script type="math/tex; mode=display">
\phi_{k}\left(y_{t-1}, y_{t}\right)=\left\{\begin{array}{ll}
1, & y_{t-1}=s_{i}, and , y_{t}=s_{j} \\
0
\end{array} \quad i=0, \cdots, N ; j=1, \cdots, N\right.</script><p>å…¶ä¸­ï¼Œ$y_t$ä¸ºåºåˆ—ç¬¬ t ä¸ªæ ‡ç­¾ï¼Œ$s_i$ä¸ºæ ‡æ³¨é›†ç¬¬ i ç§æ ‡ç­¾ï¼ŒN ä¸ºæ ‡æ³¨é›†å¤§å°ã€‚</p>
<p><strong>çŠ¶æ€ç‰¹å¾</strong>ï¼Œç±»ä¼¼äºéšé©¬å°”å¯å¤«æ¨¡å‹çš„å‘å°„æ¦‚ç‡çŸ©é˜µï¼ŒçŠ¶æ€ç‰¹å¾åªä¸å½“å‰çš„çŠ¶æ€æœ‰å…³ï¼Œä¸ä¹‹å‰çš„çŠ¶æ€æ— å…³:</p>
<script type="math/tex; mode=display">
\phi_{i}\left(x_{i}, y_{i}\right)=\left\{\begin{array}{l}
1 \\
0
\end{array}\right.</script><p>äºæ˜¯ï¼Œç»“æ„åŒ–æ„ŸçŸ¥æœºçš„ç‰¹å¾å‡½æ•°å°±æ˜¯è½¬ç§»ç‰¹å¾å’ŒçŠ¶æ€ç‰¹å¾çš„åˆé›†:</p>
<script type="math/tex; mode=display">
\phi=\left[\phi_{k} ; \phi_{l}\right] \quad k=1, \cdots, N^{2}+N ; l=N^{2}+N+1, \cdots</script><p>åŸºäºä»¥ä¸Šå…¬å¼ï¼Œç»Ÿä¸€ç”¨æ‰“åˆ†å‡½æ•°æ¥è¡¨ç¤º:</p>
<script type="math/tex; mode=display">
\operatorname{score}(\boldsymbol{x}, \boldsymbol{y})=\sum_{t=1}^{T} \boldsymbol{w} \cdot \phi\left(y_{t-1}, y_{t}, \boldsymbol{x}_{t}\right)</script><p>æœ‰äº†æ‰“åˆ†å…¬å¼ï¼Œå°±å¯ä»¥åˆ©ç”¨ç»´ç‰¹æ¯”ç®—æ³•æ±‚è§£å¾—åˆ†æœ€é«˜çš„åºåˆ—ã€‚</p>
<h5 id="ä»£ç -6"><a href="#ä»£ç -6" class="headerlink" title="ä»£ç "></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">ä»£ç </a></h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CPTTrain</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, segment, train)</span>:</span></span><br><span class="line">        self.__char_type = &#123;&#125;</span><br><span class="line">        data_path = <span class="string">"data"</span></span><br><span class="line">        <span class="keyword">for</span> ind, name <span class="keyword">in</span> enumerate([<span class="string">"punc"</span>, <span class="string">"alph"</span>, <span class="string">"date"</span>, <span class="string">"num"</span>]):</span><br><span class="line">            fn = data_path + <span class="string">"/"</span> + name</span><br><span class="line">            <span class="keyword">if</span> os.path.isfile(fn):</span><br><span class="line">                <span class="keyword">for</span> line <span class="keyword">in</span> open(fn, <span class="string">"r"</span>):</span><br><span class="line">                    self.__char_type[line.strip()] = ind</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">"can't open"</span>, fn)</span><br><span class="line">                exit()</span><br><span class="line"></span><br><span class="line">        self.__train_insts = <span class="literal">None</span>  <span class="comment"># all instances for training.</span></span><br><span class="line">        self.__feats_weight = <span class="literal">None</span>  <span class="comment"># ["b", "m", "e", "s"][all the features] --&gt; weight.</span></span><br><span class="line">        self.__words_num = <span class="literal">None</span>  <span class="comment"># total words num in all the instances.</span></span><br><span class="line">        self.__insts_num = <span class="literal">None</span>  <span class="comment"># namley the sentences' num.</span></span><br><span class="line">        self.__cur_ite_ID = <span class="literal">None</span>  <span class="comment"># current iteration index.</span></span><br><span class="line">        self.__cur_inst_ID = <span class="literal">None</span>  <span class="comment"># current index_th instance.</span></span><br><span class="line">        self.__real_inst_ID = <span class="literal">None</span>  <span class="comment"># the accurate index in training instances after randimizing.</span></span><br><span class="line">        self.__last_update = <span class="literal">None</span>  <span class="comment"># ["b".."s"][feature] --&gt; [last_update_ite_ID, last_update_inst_ID]</span></span><br><span class="line">        self.__feats_weight_sum = <span class="literal">None</span>  <span class="comment"># sum of ["b".."s"][feature] from begin to end.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> segment <span class="keyword">and</span> train <span class="keyword">or</span> <span class="keyword">not</span> segment <span class="keyword">and</span> <span class="keyword">not</span> train:</span><br><span class="line">            print(<span class="string">"there is only a True and False in segment and train"</span>)</span><br><span class="line">            exit()</span><br><span class="line">        <span class="keyword">elif</span> train:</span><br><span class="line">            self.Train = self.__Train</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.__LoadModel()</span><br><span class="line">            self.Segment = self.__Segment</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__LoadModel</span><span class="params">(self)</span>:</span></span><br><span class="line">        model = <span class="string">"data/avgmodel"</span></span><br><span class="line">        print(<span class="string">"load"</span>, model, <span class="string">"..."</span>)</span><br><span class="line">        self.__feats_weight = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> os.path.isfile(model):</span><br><span class="line">            start = time.clock()</span><br><span class="line">            self.__feats_weight = pickle.load(open(model, <span class="string">"rb"</span>))</span><br><span class="line">            end = time.clock()</span><br><span class="line">            print(<span class="string">"It takes %d seconds"</span> % (end - start))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"can't open"</span>, model)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Train</span><span class="params">(self, corp_file_name, max_train_num, max_ite_num)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.__LoadCorp(corp_file_name, max_train_num):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        starttime = time.clock()</span><br><span class="line"></span><br><span class="line">        self.__feats_weight = &#123;&#125;</span><br><span class="line">        self.__last_update = &#123;&#125;</span><br><span class="line">        self.__feats_weight_sum = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> self.__cur_ite_ID <span class="keyword">in</span> range(max_ite_num):</span><br><span class="line">            <span class="keyword">if</span> self.__Iterate():</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        self.__SaveModel()</span><br><span class="line">        endtime = time.clock()</span><br><span class="line">        print(<span class="string">"total iteration times is %d seconds"</span> % (endtime - starttime))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__GenerateFeats</span><span class="params">(self, inst)</span>:</span></span><br><span class="line">        inst_feat = []</span><br><span class="line">        <span class="keyword">for</span> ind, [c, tag, t] <span class="keyword">in</span> enumerate(inst):</span><br><span class="line">            inst_feat.append([])</span><br><span class="line">            <span class="keyword">if</span> t == <span class="number">-1</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment"># Cn</span></span><br><span class="line">            <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">-2</span>, <span class="number">3</span>):</span><br><span class="line">                inst_feat[<span class="number">-1</span>].append(<span class="string">"C%d==%s"</span> % (n, inst[ind + n][<span class="number">0</span>]))</span><br><span class="line">            <span class="comment"># CnCn+1</span></span><br><span class="line">            <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">-2</span>, <span class="number">2</span>):</span><br><span class="line">                inst_feat[<span class="number">-1</span>].append(<span class="string">"C%dC%d==%s%s"</span> % (n, n + <span class="number">1</span>, inst[ind + n][<span class="number">0</span>], inst[ind + n + <span class="number">1</span>][<span class="number">0</span>]))</span><br><span class="line">            <span class="comment"># C-1C1</span></span><br><span class="line">            inst_feat[<span class="number">-1</span>].append(<span class="string">"C-1C1==%s%s"</span> % (inst[ind - <span class="number">1</span>][<span class="number">0</span>], inst[ind + <span class="number">1</span>][<span class="number">0</span>]))</span><br><span class="line">            <span class="comment"># Pu(C0)</span></span><br><span class="line">            inst_feat[<span class="number">-1</span>].append(<span class="string">"Pu(%s)==%d"</span> % (c, int(t == <span class="number">0</span>)))</span><br><span class="line">            <span class="comment"># T(C-2)T(C-1)T(C0)T(C1)T(C2)</span></span><br><span class="line">            inst_feat[<span class="number">-1</span>].append(<span class="string">"T-2...2=%d%d%d%d%d"</span> % (</span><br><span class="line">            inst[ind - <span class="number">2</span>][<span class="number">2</span>], inst[ind - <span class="number">1</span>][<span class="number">2</span>], inst[ind][<span class="number">2</span>], inst[ind + <span class="number">1</span>][<span class="number">2</span>], inst[ind + <span class="number">2</span>][<span class="number">2</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> inst_feat</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__SaveModel</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># the last time to sum all the features.</span></span><br><span class="line">        norm = float(self.__cur_ite_ID + <span class="number">1</span>) * self.__insts_num</span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> self.__feats_weight_sum:</span><br><span class="line">            last_ite_ID = self.__last_update[feat][<span class="number">0</span>]</span><br><span class="line">            last_inst_ID = self.__last_update[feat][<span class="number">1</span>]</span><br><span class="line">            c = (self.__cur_ite_ID - last_ite_ID) * self.__insts_num + self.__cur_inst_ID - last_inst_ID</span><br><span class="line">            self.__feats_weight_sum[feat] += self.__feats_weight[feat] * c</span><br><span class="line">            self.__feats_weight_sum[feat] = self.__feats_weight_sum[feat] / norm</span><br><span class="line"></span><br><span class="line">        pickle.dump(self.__feats_weight_sum, open(<span class="string">"data/avgmodel"</span>, <span class="string">"wb"</span>))</span><br><span class="line">        self.__train_insts = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__LoadCorp</span><span class="params">(self, corp_file_name, max_train_num)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(corp_file_name):</span><br><span class="line">            print(<span class="string">"can't open"</span>, corp_file_name)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        self.__train_insts = []</span><br><span class="line">        self.__words_num = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> ind, line <span class="keyword">in</span> enumerate(open(corp_file_name, <span class="string">"r"</span>)):</span><br><span class="line">            <span class="keyword">if</span> max_train_num &gt; <span class="number">0</span> <span class="keyword">and</span> ind &gt;= max_train_num:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            self.__train_insts.append(self.__PreProcess(line.strip()))</span><br><span class="line">            self.__words_num += len(self.__train_insts[<span class="number">-1</span>]) - <span class="number">4</span></span><br><span class="line">        self.__insts_num = len(self.__train_insts)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"number of total insts is"</span>, self.__insts_num)</span><br><span class="line">        print(<span class="string">"number of total characters is"</span>, self.__words_num)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__PreProcess</span><span class="params">(self, sent)</span>:</span></span><br><span class="line">        inst = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            inst.append([<span class="string">"&lt;s&gt;"</span>, <span class="string">"s"</span>, <span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> sent.split():</span><br><span class="line">            rt = word.rpartition(<span class="string">"/"</span>)</span><br><span class="line">            t = self.__char_type.get(rt[<span class="number">0</span>], <span class="number">4</span>)</span><br><span class="line">            inst.append([rt[<span class="number">0</span>], rt[<span class="number">2</span>], t])  <span class="comment"># [c, tag, t]</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            inst.append([<span class="string">"&lt;s&gt;"</span>, <span class="string">"s"</span>, <span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> inst</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Segment</span><span class="params">(self, src)</span>:</span></span><br><span class="line">        <span class="string">"""suppose there is one sentence once."""</span></span><br><span class="line">        inst = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            inst.append([<span class="string">"&lt;s&gt;"</span>, <span class="string">"s"</span>, <span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> src:</span><br><span class="line">            inst.append([c, <span class="string">""</span>, self.__char_type.get(c, <span class="number">4</span>)])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            inst.append([<span class="string">"&lt;s&gt;"</span>, <span class="string">"s"</span>, <span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">        feats = self.__GenerateFeats(inst)</span><br><span class="line">        tags = self.__DPSegment(inst, feats)</span><br><span class="line"></span><br><span class="line">        rst = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, len(tags) - <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">if</span> tags[i] <span class="keyword">in</span> [<span class="string">"s"</span>, <span class="string">"b"</span>]:</span><br><span class="line">                rst.append(inst[i][<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rst[<span class="number">-1</span>] += inst[i][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">" "</span>.join(rst)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Iterate</span><span class="params">(self)</span>:</span></span><br><span class="line">        start = time.clock()</span><br><span class="line">        print(<span class="string">"%d th iteration"</span> % self.__cur_ite_ID)</span><br><span class="line"></span><br><span class="line">        train_list = random.sample(range(self.__insts_num), self.__insts_num)</span><br><span class="line">        error_sents_num = <span class="number">0</span></span><br><span class="line">        error_words_num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> self.__cur_inst_ID, self.__real_inst_ID <span class="keyword">in</span> enumerate(train_list):</span><br><span class="line">            num = self.__TrainInstance()</span><br><span class="line">            error_sents_num += <span class="number">1</span> <span class="keyword">if</span> num &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            error_words_num += num</span><br><span class="line"></span><br><span class="line">        st = <span class="number">1</span> - float(error_sents_num) / self.__insts_num</span><br><span class="line">        wt = <span class="number">1</span> - float(error_words_num) / self.__words_num</span><br><span class="line"></span><br><span class="line">        end = time.clock()</span><br><span class="line">        print(<span class="string">"sents accuracy = %f%%, words accuracy = %f%%, it takes %d seconds"</span> % (st * <span class="number">100</span>, wt * <span class="number">100</span>, end - start))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> error_sents_num == <span class="number">0</span> <span class="keyword">and</span> error_words_num == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__TrainInstance</span><span class="params">(self)</span>:</span></span><br><span class="line">        cur_inst = self.__train_insts[self.__real_inst_ID]</span><br><span class="line">        feats = self.__GenerateFeats(cur_inst)</span><br><span class="line"></span><br><span class="line">        seg = self.__DPSegment(cur_inst, feats)</span><br><span class="line">        <span class="keyword">return</span> self.__Correct(seg, feats)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__DPSegment</span><span class="params">(self, inst, feats)</span>:</span></span><br><span class="line">        num = len(inst)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get all position's score.</span></span><br><span class="line">        value = [&#123;&#125; <span class="keyword">for</span> i <span class="keyword">in</span> range(num)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, num - <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> [<span class="string">"b"</span>, <span class="string">"m"</span>, <span class="string">"e"</span>, <span class="string">"s"</span>]:</span><br><span class="line">                value[i][t] = self.__GetScore(i, t, feats)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># find optimal path.</span></span><br><span class="line">        tags = [<span class="literal">None</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(num)]</span><br><span class="line">        best = [<span class="number">-1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(num)]  <span class="comment"># best[i]: [i, i + length(i)) is optimal segment.</span></span><br><span class="line">        length = [<span class="literal">None</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(num)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num - <span class="number">2</span> - <span class="number">1</span>, <span class="number">1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">for</span> dis <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">                <span class="keyword">if</span> i + dis &gt; num - <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                cur_score = best[i + dis]</span><br><span class="line">                self.__Tag(i, i + dis, tags)</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> range(i, i + dis):</span><br><span class="line">                    cur_score += value[k][tags[k]]</span><br><span class="line">                <span class="keyword">if</span> length[i] <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> cur_score &gt; best[i]:</span><br><span class="line">                    best[i] = cur_score</span><br><span class="line">                    length[i] = dis</span><br><span class="line"></span><br><span class="line">        i = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; num - <span class="number">2</span>:</span><br><span class="line">            self.__Tag(i, i + length[i], tags)</span><br><span class="line">            i += length[i]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tags</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__GetScore</span><span class="params">(self, pos, t, feats)</span>:</span></span><br><span class="line">        pos_feats = feats[pos]</span><br><span class="line">        score = <span class="number">0.0</span></span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> pos_feats:</span><br><span class="line">            score += self.__feats_weight.get(feat + <span class="string">"=&gt;"</span> + t, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Tag</span><span class="params">(self, f, t, tags)</span>:</span></span><br><span class="line">        <span class="string">"""tag the sequence tags in the xrange of [f, t)"""</span></span><br><span class="line">        <span class="keyword">if</span> t - f == <span class="number">1</span>:</span><br><span class="line">            tags[f] = <span class="string">"s"</span></span><br><span class="line">        <span class="keyword">elif</span> t - f &gt;= <span class="number">2</span>:</span><br><span class="line">            tags[f], tags[t - <span class="number">1</span>] = <span class="string">"b"</span>, <span class="string">"e"</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(f + <span class="number">1</span>, t - <span class="number">1</span>):</span><br><span class="line">                tags[i] = <span class="string">"m"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Correct</span><span class="params">(self, tags, feats)</span>:</span></span><br><span class="line">        updates = &#123;&#125;</span><br><span class="line">        cur_inst = self.__train_insts[self.__real_inst_ID]</span><br><span class="line">        error_words_num = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, len(cur_inst) - <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">if</span> tags[i] == cur_inst[i][<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            error_words_num += <span class="number">1</span></span><br><span class="line">            pos_feats = feats[i]</span><br><span class="line">            target = cur_inst[i][<span class="number">1</span>]</span><br><span class="line">            mine = tags[i]</span><br><span class="line">            <span class="keyword">for</span> feat <span class="keyword">in</span> pos_feats:</span><br><span class="line">                updates[feat + <span class="string">"=&gt;"</span> + target] = updates.get(feat + <span class="string">"=&gt;"</span> + target, <span class="number">0.0</span>) + <span class="number">1</span></span><br><span class="line">                updates[feat + <span class="string">"=&gt;"</span> + mine] = updates.get(feat + <span class="string">"=&gt;"</span> + mine, <span class="number">0.0</span>) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        self.__Update(updates)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> error_words_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Update</span><span class="params">(self, updates)</span>:</span></span><br><span class="line">        <span class="comment"># update the features weight.</span></span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> updates:</span><br><span class="line">            pair = self.__last_update.get(feat, [<span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">            last_ite_ID = pair[<span class="number">0</span>]</span><br><span class="line">            last_inst_ID = pair[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">            c = (self.__cur_ite_ID - last_ite_ID) * self.__insts_num + self.__cur_inst_ID - last_inst_ID</span><br><span class="line">            self.__feats_weight_sum[feat] = self.__feats_weight_sum.get(feat, <span class="number">0</span>) + c * self.__feats_weight.get(feat, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            self.__feats_weight[feat] = self.__feats_weight.get(feat, <span class="number">0</span>) + updates[feat]</span><br><span class="line">            self.__last_update[feat] = [self.__cur_ite_ID, self.__cur_inst_ID]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    train = CPTTrain(train=<span class="literal">True</span>, segment=<span class="literal">False</span>)</span><br><span class="line">    train.Train(<span class="string">"data/msr_train.txt"</span>, max_train_num=<span class="number">1000000</span>, max_ite_num=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">    srcs = [<span class="string">"å¤å¤©çš„æ¸…æ™¨"</span>,</span><br><span class="line">            <span class="string">"â€œäººä»¬å¸¸è¯´ç”Ÿæ´»æ˜¯ä¸€éƒ¨æ•™ç§‘ä¹¦ï¼Œè€Œè¡€ä¸ç«çš„æˆ˜äº‰æ›´æ˜¯ä¸å¯å¤šå¾—çš„æ•™ç§‘ä¹¦ï¼Œå¥¹ç¡®å®æ˜¯åå‰¯å…¶å®çš„â€˜æˆ‘çš„å¤§å­¦â€™ã€‚"</span>,</span><br><span class="line">            <span class="string">"å¤å¤©çš„æ¸…æ™¨å¤å¤©çœ‹è§çŒªå…«æˆ’å’Œå«¦å¨¥äº†ã€‚"</span>,</span><br><span class="line">            <span class="string">"æµ·è¿ä¸šé›„è¸å…¨çƒä¹‹é¦–ï¼ŒæŒ‰å¨ä½è®¡å ä¸–ç•Œæ€»æ•°çš„ï¼‘ï¼—ï¼…ã€‚"</span>]</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"avg"</span>)</span><br><span class="line">    seg = CPTTrain(train=<span class="literal">False</span>, segment=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> src <span class="keyword">in</span> srcs:</span><br><span class="line">        print(seg.Segment(src))</span><br></pre></td></tr></table></figure>
<h4 id="åŸºäºæ·±åº¦å­¦ä¹ çš„ç«¯åˆ°ç«¯çš„åˆ†è¯æ–¹æ³•"><a href="#åŸºäºæ·±åº¦å­¦ä¹ çš„ç«¯åˆ°ç«¯çš„åˆ†è¯æ–¹æ³•" class="headerlink" title="åŸºäºæ·±åº¦å­¦ä¹ çš„ç«¯åˆ°ç«¯çš„åˆ†è¯æ–¹æ³•"></a>åŸºäºæ·±åº¦å­¦ä¹ çš„ç«¯åˆ°ç«¯çš„åˆ†è¯æ–¹æ³•</h4><p>åœ¨ä¸­æ–‡åˆ†è¯ä¸Šï¼ŒåŸºäºç¥ç»ç½‘ç»œçš„æ–¹æ³•ï¼Œå¾€å¾€ä½¿ç”¨ã€Œå­—å‘é‡ + BiLSTM + CRFã€æ¨¡å‹ï¼Œåˆ©ç”¨ç¥ç»ç½‘ç»œæ¥å­¦ä¹ ç‰¹å¾ï¼Œå°†ä¼ ç»Ÿ CRF ä¸­çš„äººå·¥ç‰¹å¾å·¥ç¨‹é‡é™åˆ°æœ€ä½</p>
<p>BiLSTMã€BiLSTM+CRFã€BiLSTM+CNN+CRFã€BERTã€BERT+CRFã€BERT+BiLSTMã€BERT+BiLSTM+CRFï¼Œç”±äºä»¥ä¸Šæ¨¡å‹å‡å¯å¯¹åºåˆ—æ ‡æ³¨ä»»åŠ¡è¿›è¡Œå»ºæ¨¡æ±‚è§£ï¼Œæ‰€ä»¥å‡å¯æ‹¿æ¥åšä¸­æ–‡åˆ†è¯ã€‚ä»¥æ¯”è¾ƒå…¸å‹çš„ã€Œå­—å‘é‡ + BiLSTM ï¼ˆ+CNNï¼‰+ CRFã€æ¨¡å‹ä¸ºä¾‹ï¼š</p>
<p>BiLSTMèåˆä¸¤ç»„å­¦ä¹ æ–¹å‘ç›¸åï¼ˆä¸€ä¸ªæŒ‰å¥å­é¡ºåºï¼Œä¸€ä¸ªæŒ‰å¥å­é€†åºï¼‰çš„LSTMå±‚ï¼Œèƒ½å¤Ÿåœ¨ç†è®ºä¸Šå®ç°å½“å‰è¯å³åŒ…å«å†å²ä¿¡æ¯ã€åˆåŒ…å«æœªæ¥ä¿¡æ¯ï¼Œæ›´æœ‰åˆ©äºå¯¹å½“å‰è¯è¿›è¡Œæ ‡æ³¨ã€‚è™½ç„¶ä¾èµ–äºç¥ç»ç½‘ç»œå¼ºå¤§çš„éçº¿æ€§æ‹Ÿåˆèƒ½åŠ›ï¼Œç†è®ºä¸Šæˆ‘ä»¬å·²ç»èƒ½å¤Ÿå­¦ä¹ å‡ºä¸é”™çš„æ¨¡å‹ã€‚ä½†æ˜¯ï¼ŒBiLSTMåªè€ƒè™‘äº†æ ‡ç­¾ä¸Šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å¯¹äºåºåˆ—æ ‡æ³¨ä»»åŠ¡æ¥è¯´ï¼Œå½“å‰ä½ç½®çš„æ ‡ç­¾$y_t$ä¸å‰ä¸€ä¸ªä½ç½®$y_{t-1}$ã€åä¸€ä¸ªä½ç½®$y_{t+1}$éƒ½æœ‰æ½œåœ¨çš„å…³ç³»ã€‚ä¾‹å¦‚ï¼Œâ€œä¸œå—å¤§å­¦æ¬¢è¿æ‚¨â€è¢«æ ‡æ³¨ä¸ºâ€œä¸œ/S å—/M å¤§/M å­¦/E æ¬¢/B è¿/E æ‚¨/Sâ€ï¼Œç”±åˆ†è¯çš„æ ‡æ³¨è§„åˆ™å¯çŸ¥ï¼ŒBæ ‡ç­¾ååªèƒ½æ¥Må’ŒEï¼ŒBiLSTMæ²¡æœ‰åˆ©ç”¨è¿™ç§æ ‡ç­¾ä¹‹é—´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å› æ­¤ï¼Œå°±æœ‰äººæå‡ºäº†åœ¨æ¨¡å‹åæ¥ä¸€å±‚CRFå±‚ï¼Œç”¨äºåœ¨æ•´ä¸ªåºåˆ—ä¸Šå­¦ä¹ æœ€ä¼˜çš„æ ‡ç­¾åºåˆ—ï¼š</p>
<p><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/bilstm_crf.jpeg" alt="avatar"></p>
<p>BiLSTM+CNN+CRFï¼šå¯¹äºåˆ†è¯ä»»åŠ¡ï¼Œå½“å‰è¯çš„æ ‡ç­¾åŸºæœ¬ä¸Šåªä¸å‰å‡ ä¸ªå’Œå’Œå‡ ä¸ªè¯æœ‰å…³è”ã€‚BiLSTMåœ¨å­¦ä¹ è¾ƒé•¿å¥å­æ—¶ï¼Œå¯èƒ½å› ä¸ºæ¨¡å‹å®¹é‡é—®é¢˜ä¸¢å¼ƒä¸€äº›é‡è¦ä¿¡æ¯ï¼Œå› æ­¤åœ¨æ¨¡å‹ä¸­åŠ äº†ä¸€ä¸ªCNNå±‚ï¼Œç”¨äºæå–å½“å‰è¯çš„å±€éƒ¨ç‰¹å¾ã€‚ï¼ˆä¸çŸ¥æ•ˆæœæ€æ ·ï¼Ÿï¼Ÿï¼ï¼ï¼‰</p>
<p><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/bilstm_cnn_crf.png" alt="avatar"></p>
<h5 id="æ¨¡å‹æ¯”è¾ƒ"><a href="#æ¨¡å‹æ¯”è¾ƒ" class="headerlink" title="æ¨¡å‹æ¯”è¾ƒ"></a>æ¨¡å‹æ¯”è¾ƒ</h5><p>Trained and tested with pku dataset</p>
<p>CRF</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Template</th>
<th style="text-align:center">Precision</th>
<th style="text-align:center">Recall</th>
<th style="text-align:center">F1-Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">crf_template</td>
<td style="text-align:center">0.938</td>
<td style="text-align:center">0.923</td>
<td style="text-align:center">0.931</td>
</tr>
</tbody>
</table>
</div>
<p>Bi-LSTM</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Structure</th>
<th style="text-align:center">Precision</th>
<th style="text-align:center">Recall</th>
<th style="text-align:center">F1-Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">emb256_hid256_l3</td>
<td style="text-align:center">0.9252</td>
<td style="text-align:center">0.9237</td>
<td style="text-align:center">0.9243</td>
</tr>
</tbody>
</table>
</div>
<p>Bi-LSTM + CRF</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Structure</th>
<th style="text-align:center">Precision</th>
<th style="text-align:center">Recall</th>
<th style="text-align:center">F1-Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">emb256_hid256_l3</td>
<td style="text-align:center">0.9343</td>
<td style="text-align:center">0.9336</td>
<td style="text-align:center">0.9339</td>
</tr>
</tbody>
</table>
</div>
<p>BERT + Bi-LSTM</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Structure</th>
<th style="text-align:center">Precision</th>
<th style="text-align:center">Recall</th>
<th style="text-align:center">F1-Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">emb768_hid512_l2</td>
<td style="text-align:center">0.9698</td>
<td style="text-align:center">0.9650</td>
<td style="text-align:center">0.9646</td>
</tr>
</tbody>
</table>
</div>
<h5 id="ä»£ç -7"><a href="#ä»£ç -7" class="headerlink" title="ä»£ç "></a>ä»£ç </h5><p>ä»¥BERT+RNN+CRFä¸ºä¾‹ï¼Œå¯æ ¹æ®éœ€æ±‚è¿›è¡Œæ”¹åŠ¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> TorchCRF <span class="keyword">import</span> CRF </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertRNNCRF</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num_tags, rnn_type, bert_path, bert_train, seg_vocab_size,hidden_dim, n_layers, bidirectional, batch_first,</span></span></span><br><span class="line"><span class="function"><span class="params">                 dropout, restrain)</span>:</span></span><br><span class="line">        super(BertRNNCRF, self).__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line">        self.bert = BertModel.from_pretrained(bert_path)</span><br><span class="line">        <span class="comment"># å¯¹bertè¿›è¡Œè®­ç»ƒ</span></span><br><span class="line">        <span class="keyword">for</span> name, param <span class="keyword">in</span> self.bert.named_parameters():</span><br><span class="line">            param.requires_grad = bert_train</span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                               hidden_size=hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line">        self.crf = CRF(num_tags, batch_first=<span class="literal">True</span>, restrain_matrix=restrain, loss_side=<span class="number">2.5</span>)</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        <span class="keyword">if</span> self.bidirectional:</span><br><span class="line">            self.fc_tags = nn.Linear(hidden_dim*<span class="number">2</span>, num_tags)</span><br><span class="line">            <span class="comment"># self.fc_tags = nn.Linear(768, num_tags)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.fc_tags = nn.Linear(hidden_dim, num_tags)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, context, seq_len,max_seq_len, mask_bert)</span>:</span></span><br><span class="line">        <span class="comment"># context    è¾“å…¥çš„å¥å­</span></span><br><span class="line">        <span class="comment"># mask_bert  å¯¹paddingéƒ¨åˆ†è¿›è¡Œmaskï¼Œå’Œå¥å­ä¸€ä¸ªsizeï¼Œpaddingéƒ¨åˆ†ç”¨0è¡¨ç¤ºï¼Œå¦‚ï¼š[1, 1, 1, 1, 0, 0]</span></span><br><span class="line">        bert_sentence, bert_cls = self.bert(context, attention_mask=mask_bert)</span><br><span class="line">        <span class="comment"># sentence_len = bert_sentence.shape[1]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># bert_cls = bert_cls.unsqueeze(dim=1).repeat(1, sentence_len, 1)</span></span><br><span class="line">        <span class="comment"># bert_sentence = bert_sentence + bert_cls</span></span><br><span class="line">        encoder_out, sorted_seq_lengths, desorted_indices = self.prepare_pack_padded_sequence(bert_sentence, seq_len)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(encoder_out, sorted_seq_lengths,</span><br><span class="line">                                                            batch_first=self.batch_first)</span><br><span class="line">        <span class="comment"># self.rnn.flatten_parameters()</span></span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line">        <span class="comment"># unpack sequence</span></span><br><span class="line">        <span class="comment"># output = [ batch size,sent len, hidden_dim * bidirectional]</span></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first,total_length=max_seq_len)</span><br><span class="line">        output = output[desorted_indices]</span><br><span class="line">        out = self.fc_tags(self.dropout(output.contiguous()))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out[:, <span class="number">1</span>:, :]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepare_pack_padded_sequence</span><span class="params">(self, inputs_words, seq_lengths, descending=True)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param device:</span></span><br><span class="line"><span class="string">        :param inputs_words:</span></span><br><span class="line"><span class="string">        :param seq_lengths:</span></span><br><span class="line"><span class="string">        :param descending:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        sorted_seq_lengths, indices = torch.sort(seq_lengths, descending=descending)</span><br><span class="line">        _, desorted_indices = torch.sort(indices, descending=<span class="literal">False</span>)</span><br><span class="line">        sorted_inputs_words = inputs_words[indices]</span><br><span class="line">        <span class="keyword">return</span> sorted_inputs_words, sorted_seq_lengths, desorted_indices</span><br></pre></td></tr></table></figure>
<h3 id="åˆ†è¯ä¸­çš„éš¾é¢˜"><a href="#åˆ†è¯ä¸­çš„éš¾é¢˜" class="headerlink" title="åˆ†è¯ä¸­çš„éš¾é¢˜"></a>åˆ†è¯ä¸­çš„éš¾é¢˜</h3><p>ä¸­æ–‡æ˜¯ä¸€ç§ååˆ†å¤æ‚çš„è¯­è¨€ï¼Œè®©è®¡ç®—æœºç†è§£ä¸­æ–‡è¯­è¨€æ›´æ˜¯å›°éš¾ã€‚åœ¨ä¸­æ–‡åˆ†è¯è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸¤å¤§éš¾é¢˜ä¸€ç›´æ²¡æœ‰å®Œå…¨çªç ´ã€‚</p>
<h4 id="1ã€æ­§ä¹‰åˆ‡åˆ†é—®é¢˜"><a href="#1ã€æ­§ä¹‰åˆ‡åˆ†é—®é¢˜" class="headerlink" title="1ã€æ­§ä¹‰åˆ‡åˆ†é—®é¢˜"></a>1ã€æ­§ä¹‰åˆ‡åˆ†é—®é¢˜</h4><p>æ­§ä¹‰æ˜¯æŒ‡åŒæ ·çš„ä¸€å¥è¯ï¼Œå¯èƒ½æœ‰ä¸¤ç§æˆ–è€…æ›´å¤šçš„åˆ‡åˆ†æ–¹æ³•ã€‚</p>
<ul>
<li>äº¤é›†æ­§ä¹‰ï¼šâ€œç»“åˆæˆâ€ï¼Œç»“åˆ/æˆï¼Œç»“/åˆæˆ</li>
<li>ç»„åˆæ­§ä¹‰ï¼šâ€œèµ·èº«â€ï¼Œä»–ç«™èµ·/èº«/æ¥ã€‚ ä»–æ˜å¤©/èµ·èº«/å»åŒ—äº¬ã€‚</li>
<li>æ··åˆå‹æ­§ä¹‰ï¼šåŒæ—¶å…·å¤‡äº¤é›†æ­§ä¹‰å’Œç»„åˆæ­§ä¹‰çš„ç‰¹ç‚¹ã€‚1ï¼Œè¿™ç¯‡æ–‡ç« å†™å¾—å¤ªå¹³æ·¡äº†ã€‚2ï¼Œè¿™å¢™æŠ¹çš„å¤ªå¹³äº†ã€‚3ï¼Œå³ä½¿å¤ªå¹³æ—¶æœŸä¹Ÿä¸åº”è¯¥æ”¾æ¾è­¦æƒ•ã€‚â€œå¤ªå¹³æ·¡â€æ˜¯äº¤é›†å‹ï¼Œâ€œå¤ªå¹³â€æ˜¯ç»„åˆå‹ã€‚ </li>
</ul>
<p>äº¤é›†æ­§ä¹‰ç›¸å¯¹ç»„åˆæ­§ä¹‰æ¥è¯´æ˜¯è¿˜ç®—æ¯”è¾ƒå®¹æ˜“å¤„ç†ï¼Œç»„åˆæ­§ä¹‰éœ€è¦æ ¹æ®æ•´ä¸ªå¥å­æ¥åˆ¤æ–­ã€‚ï¼ˆç‰¹å¾ï¼šä¸Šä¸‹æ–‡è¯­ä¹‰åˆ†æï¼ŒéŸµå¾‹åˆ†æï¼Œè¯­æ°”ï¼Œé‡éŸ³ï¼Œåœé¡¿ï¼‰</p>
<h4 id="2ã€æœªç™»å½•è¯"><a href="#2ã€æœªç™»å½•è¯" class="headerlink" title="2ã€æœªç™»å½•è¯"></a>2ã€æœªç™»å½•è¯</h4><p>æœªç™»å½•è¯ï¼ˆç”Ÿè¯ï¼Œæ–°è¯ï¼‰ï¼š1.å·²æœ‰çš„è¯è¡¨ä¸­æ²¡æœ‰æ”¶å½•çš„è¯ã€‚2.å·²æœ‰çš„è®­ç»ƒè¯­æ–™ä¸­æœªæ›¾å‡ºç°çš„è¯ï¼ˆé›†å¤–è¯OOVï¼‰ã€‚</p>
<p>ç±»å‹ï¼š</p>
<ol>
<li>æ–°å‡ºç°çš„æ™®é€šè¯æ±‡ï¼šåšå®¢ï¼Œè¶…å¥³ï¼Œç»™åŠ›ã€‚</li>
<li>ä¸“æœ‰åè¯ï¼šäººåã€åœ°åã€ç»„ç»‡åã€æ—¶é—´ã€æ•°å­—è¡¨è¾¾ã€</li>
<li>ä¸“ä¸šåè¯å’Œç ”ç©¶é¢†åŸŸåè¯ï¼šè‹ä¸¹çº¢ï¼Œç¦½æµæ„Ÿ</li>
<li>å…¶ä»–ä¸“ç”¨åè¯ï¼šæ–°å‡ºç°çš„äº§å“åï¼Œç”µå½±ï¼Œä¹¦è®°ã€‚</li>
</ol>
<p>å¯¹äºçœŸå®æ•°æ®æ¥è¯´ï¼Œæœªç™»å½•è¯å¯¹åˆ†è¯ç²¾åº¦çš„å½±å“è¿œè¿œè¶…è¿‡äº†æ­§ä¹‰åˆ‡åˆ†ã€‚æœªç™»å½•è¯æ˜¯å¾ˆéš¾å¤„ç†çš„é—®é¢˜ï¼Œè€Œä¸”è¿™äº›åˆæ­£å¥½æ˜¯äººä»¬ç»å¸¸ä½¿ç”¨çš„è¯ï¼Œå› æ­¤å¯¹äºæœç´¢å¼•æ“æ¥è¯´ï¼Œåˆ†è¯ç³»ç»Ÿä¸­çš„æœªç™»å½•è¯è¯†åˆ«ååˆ†é‡è¦ã€‚ç›®å‰æœªç™»å½•è¯è¯†åˆ«å‡†ç¡®ç‡å·²ç»æˆä¸ºè¯„ä»·ä¸€ä¸ªåˆ†è¯ç³»ç»Ÿå¥½åçš„é‡è¦æ ‡å¿—ä¹‹ä¸€ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><p><a href="https://blog.csdn.net/selinda001/article/details/79345072" target="_blank" rel="noopener">ä¸­æ–‡åˆ†è¯å¼•æ“ java å®ç° â€” æ­£å‘æœ€å¤§ã€é€†å‘æœ€å¤§ã€åŒå‘æœ€å¤§åŒ¹é…æ³•</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/sxron/articles/6391926.html" target="_blank" rel="noopener">ä¸­æ–‡åˆ†è¯ç®—æ³•æ€»ç»“</a></p>
</li>
<li><p><a href="https://blog.csdn.net/Zh823275484/article/details/87878512" target="_blank" rel="noopener">åŸºäºn-gramæ¨¡å‹çš„ä¸­æ–‡åˆ†è¯</a></p>
</li>
<li><p><a href="https://blog.csdn.net/qq_27825451/article/details/102457058" target="_blank" rel="noopener">è¯¦è§£è¯­è¨€æ¨¡å‹NGramåŠå›°æƒ‘åº¦Perplexity</a></p>
</li>
<li><p><a href="https://blog.csdn.net/wangliang_f/article/details/17532633" target="_blank" rel="noopener">åˆ†è¯å­¦ä¹ (3)ï¼ŒåŸºäºngramè¯­è¨€æ¨¡å‹çš„nå…ƒåˆ†è¯</a></p>
</li>
<li><p><a href="https://zhuanlan.zhihu.com/p/33261835" target="_blank" rel="noopener">ä¸­æ–‡åˆ†è¯ç®—æ³•ç®€ä»‹</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/715fa597c6bc" target="_blank" rel="noopener">NLPï¼šåˆ†è¯ç®—æ³•ç»¼è¿°</a></p>
</li>
<li><p><a href="https://github.com/NLP-LOVE/Introduction-NLP/blob/master/chapter/5.%E6%84%9F%E7%9F%A5%E6%9C%BA%E5%88%86%E7%B1%BB%E4%B8%8E%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8.md" target="_blank" rel="noopener">æ„ŸçŸ¥æœºåˆ†ç±»ä¸åºåˆ—æ ‡æ³¨</a></p>
</li>
</ol>
]]></content>
      <categories>
        <category>è‡ªç„¶è¯­è¨€å¤„ç†åŸºç¡€</category>
      </categories>
      <tags>
        <tag>è‡ªç„¶è¯­è¨€å¤„ç†åŸºç¡€</tag>
        <tag>è‡ªç„¶è¯­è¨€å¤„ç†</tag>
        <tag>åˆ†è¯ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡æœ¬çº é”™</title>
    <url>/2020/04/24/%E6%96%87%E6%9C%AC%E7%BA%A0%E9%94%99/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><h4 id="å¸¸è§é”™è¯¯ç±»å‹"><a href="#å¸¸è§é”™è¯¯ç±»å‹" class="headerlink" title="å¸¸è§é”™è¯¯ç±»å‹"></a>å¸¸è§é”™è¯¯ç±»å‹</h4><ol>
<li>è°éŸ³å­—è¯ï¼Œå¦‚ é…å‰¯çœ¼ç›-é…å‰¯çœ¼é•œ</li>
<li>æ··æ·†éŸ³å­—è¯ï¼Œå¦‚ æµæµªç»‡å¥³-ç‰›éƒç»‡å¥³</li>
<li>å­—è¯é¡ºåºé¢ å€’ï¼Œå¦‚ ä¼è¿ªè‰¾ä¼¦-è‰¾ä¼¦ä¼è¿ª</li>
<li>å­—è¯è¡¥å…¨ï¼Œå¦‚ çˆ±æœ‰å¤©æ„-å‡å¦‚çˆ±æœ‰å¤©æ„</li>
<li>å½¢ä¼¼å­—é”™è¯¯ï¼Œå¦‚ é«˜æ¢-é«˜ç²±</li>
<li>ä¸­æ–‡æ‹¼éŸ³å…¨æ‹¼ï¼Œå¦‚ xingfu-å¹¸ç¦</li>
<li>ä¸­æ–‡æ‹¼éŸ³ç¼©å†™ï¼Œå¦‚ sz-æ·±åœ³</li>
<li>è¯­æ³•é”™è¯¯ï¼Œå¦‚ æƒ³è±¡éš¾ä»¥-éš¾ä»¥æƒ³è±¡</li>
</ol>
<p>é’ˆå¯¹ä¸åŒä¸šåŠ¡åœºæ™¯ï¼Œè¿™äº›é—®é¢˜å¹¶ä¸ä¸€å®šå…¨éƒ¨å­˜åœ¨ï¼Œæ¯”å¦‚è¾“å…¥æ³•ä¸­éœ€è¦å¤„ç†å‰å››ç§ï¼Œæœç´¢å¼•æ“éœ€è¦å¤„ç†æ‰€æœ‰ç±»å‹ï¼Œè¯­éŸ³è¯†åˆ«åæ–‡æœ¬çº é”™åªéœ€è¦å¤„ç†å‰ä¸¤ç§ï¼Œ å…¶ä¸­â€™å½¢ä¼¼å­—é”™è¯¯â€™ä¸»è¦é’ˆå¯¹äº”ç¬”æˆ–è€…ç¬”ç”»æ‰‹å†™è¾“å…¥ç­‰ã€‚</p>
<a id="more"></a>
<h4 id="çº é”™æ–¹æ³•"><a href="#çº é”™æ–¹æ³•" class="headerlink" title="çº é”™æ–¹æ³•"></a>çº é”™æ–¹æ³•</h4><p>çº é”™ç®—æ³•åˆ†ä¸ºä¸¤ä¸ªæ–¹å‘ï¼šåŸºäºè§„åˆ™ã€æ·±åº¦æ¨¡å‹</p>
<h5 id="è§„åˆ™çš„è§£å†³æ€è·¯"><a href="#è§„åˆ™çš„è§£å†³æ€è·¯" class="headerlink" title="è§„åˆ™çš„è§£å†³æ€è·¯"></a><strong>è§„åˆ™çš„è§£å†³æ€è·¯</strong></h5><p>ä¸­æ–‡çº é”™åˆ†ä¸ºä¸¤æ­¥èµ°ï¼Œç¬¬ä¸€æ­¥æ˜¯é”™è¯¯æ£€æµ‹ï¼Œç¬¬äºŒæ­¥æ˜¯é”™è¯¯çº æ­£ï¼›</p>
<p>é”™è¯¯æ£€æµ‹éƒ¨åˆ†å…ˆé€šè¿‡ç»“å·´ä¸­æ–‡åˆ†è¯å™¨åˆ‡è¯ï¼Œç”±äºå¥å­ä¸­å«æœ‰é”™åˆ«å­—ï¼Œæ‰€ä»¥åˆ‡è¯ç»“æœå¾€å¾€ä¼šæœ‰åˆ‡åˆ†é”™è¯¯çš„æƒ…å†µï¼Œè¿™æ ·ä»å­—ç²’åº¦å’Œè¯ç²’åº¦ä¸¤æ–¹é¢æ£€æµ‹é”™è¯¯ï¼Œ æ•´åˆè¿™ä¸¤ç§ç²’åº¦çš„ç–‘ä¼¼é”™è¯¯ç»“æœï¼Œå½¢æˆç–‘ä¼¼é”™è¯¯ä½ç½®å€™é€‰é›†ï¼›</p>
<p>é”™è¯¯çº æ­£éƒ¨åˆ†ï¼Œæ˜¯éå†æ‰€æœ‰çš„ç–‘ä¼¼é”™è¯¯ä½ç½®ï¼Œå¹¶ä½¿ç”¨éŸ³ä¼¼ã€å½¢ä¼¼è¯å…¸æ›¿æ¢é”™è¯¯ä½ç½®çš„è¯ï¼Œç„¶åé€šè¿‡è¯­è¨€æ¨¡å‹è®¡ç®—å¥å­å›°æƒ‘åº¦ï¼Œå¯¹æ‰€æœ‰å€™é€‰é›†ç»“æœæ¯”è¾ƒå¹¶æ’åºï¼Œå¾—åˆ°æœ€ä¼˜çº æ­£è¯ã€‚</p>
<h5 id="æ·±åº¦æ¨¡å‹çš„è§£å†³æ€è·¯"><a href="#æ·±åº¦æ¨¡å‹çš„è§£å†³æ€è·¯" class="headerlink" title="æ·±åº¦æ¨¡å‹çš„è§£å†³æ€è·¯"></a><strong>æ·±åº¦æ¨¡å‹çš„è§£å†³æ€è·¯</strong></h5><p>ç«¯åˆ°ç«¯çš„æ·±åº¦æ¨¡å‹å¯ä»¥é¿å…äººå·¥æå–ç‰¹å¾ï¼Œå‡å°‘äººå·¥å·¥ä½œé‡ï¼ŒRNNåºåˆ—æ¨¡å‹å¯¹æ–‡æœ¬ä»»åŠ¡æ‹Ÿåˆèƒ½åŠ›å¼ºï¼Œrnn_attentionåœ¨è‹±æ–‡æ–‡æœ¬çº é”™æ¯”èµ›ä¸­å–å¾—ç¬¬ä¸€åæˆç»©ï¼Œè¯æ˜åº”ç”¨æ•ˆæœä¸é”™ï¼›</p>
<p>CRFä¼šè®¡ç®—å…¨å±€æœ€ä¼˜è¾“å‡ºèŠ‚ç‚¹çš„æ¡ä»¶æ¦‚ç‡ï¼Œå¯¹å¥å­ä¸­ç‰¹å®šé”™è¯¯ç±»å‹çš„æ£€æµ‹ï¼Œä¼šæ ¹æ®æ•´å¥è¯åˆ¤å®šè¯¥é”™è¯¯ï¼Œé˜¿é‡Œå‚èµ›2016ä¸­æ–‡è¯­æ³•çº é”™ä»»åŠ¡å¹¶å–å¾—ç¬¬ä¸€åï¼Œè¯æ˜åº”ç”¨æ•ˆæœä¸é”™ï¼›</p>
<p>seq2seqæ¨¡å‹æ˜¯ä½¿ç”¨encoder-decoderç»“æ„è§£å†³åºåˆ—è½¬æ¢é—®é¢˜ï¼Œç›®å‰åœ¨åºåˆ—è½¬æ¢ä»»åŠ¡ä¸­ï¼ˆå¦‚æœºå™¨ç¿»è¯‘ã€å¯¹è¯ç”Ÿæˆã€æ–‡æœ¬æ‘˜è¦ã€å›¾åƒæè¿°ï¼‰ä½¿ç”¨æœ€å¹¿æ³›ã€æ•ˆæœæœ€å¥½çš„æ¨¡å‹ä¹‹ä¸€ã€‚</p>
<h3 id="ç¼–è¾‘è·ç¦»"><a href="#ç¼–è¾‘è·ç¦»" class="headerlink" title="ç¼–è¾‘è·ç¦»"></a>ç¼–è¾‘è·ç¦»</h3><h4 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>ç¼–è¾‘è·ç¦»çš„ç»å…¸åº”ç”¨å°±æ˜¯ç”¨äºæ‹¼å†™æ£€é”™ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥çš„è¯è¯­ä¸åœ¨è¯å…¸ä¸­ï¼Œè‡ªåŠ¨ä»è¯å…¸ä¸­æ‰¾å‡ºç¼–è¾‘è·ç¦»å°äºæŸä¸ªæ•°nçš„å•è¯ï¼Œè®©ç”¨æˆ·é€‰æ‹©æ­£ç¡®çš„é‚£ä¸€ä¸ªï¼Œné€šå¸¸å–åˆ°2æˆ–è€…3ã€‚</p>
<p>å­—ç¬¦ä¸²Aåˆ°Bçš„<strong>ç¼–è¾‘è·ç¦»</strong>æ˜¯æŒ‡ï¼Œåªç”¨æ’å…¥ã€åˆ é™¤å’Œæ›¿æ¢ä¸‰ç§æ“ä½œï¼Œæœ€å°‘éœ€è¦å¤šå°‘æ­¥å¯ä»¥æŠŠAå˜æˆBã€‚ä¾‹å¦‚ï¼Œä»FAMEåˆ°GATEéœ€è¦ä¸¤æ­¥ï¼ˆä¸¤æ¬¡æ›¿æ¢ï¼‰ï¼Œä»GAMEåˆ°ACMåˆ™éœ€è¦ä¸‰æ­¥ï¼ˆåˆ é™¤Gå’ŒEå†æ·»åŠ Cï¼‰ã€‚</p>
<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minDistance_recursive</span><span class="params">(self, word1, word2)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        é€’å½’è§£æ³•</span></span><br><span class="line"><span class="string">        :type word1: str</span></span><br><span class="line"><span class="string">        :type word2: str</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word1 <span class="keyword">or</span> <span class="keyword">not</span> word2:</span><br><span class="line">            <span class="comment"># é€’å½’å‡ºå£ï¼šå…¶ä¸­ä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºç©ºï¼Œè¿”å›éç©ºå­—ç¬¦ä¸²çš„é•¿åº¦</span></span><br><span class="line">            <span class="keyword">return</span> (len(word1) <span class="keyword">or</span> len(word2))</span><br><span class="line">        <span class="keyword">if</span> word1[<span class="number">-1</span>] == word2[<span class="number">-1</span>]:</span><br><span class="line">            <span class="comment"># å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²æœ€åä¸€ä¸ªå­—ç¬¦ç›¸åŒ</span></span><br><span class="line">            <span class="keyword">return</span> self.minDistance(word1[:<span class="number">-1</span>], word2[:<span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + min(self.minDistance(word1[:<span class="number">-1</span>], word2), self.minDistance(word1, word2[:<span class="number">-1</span>]),</span><br><span class="line">                       self.minDistance(word1[:<span class="number">-1</span>], word2[:<span class="number">-1</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minDistance_dp</span><span class="params">(self,word1,word2)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        åŠ¨æ€è§„åˆ’è§£æ³•</span></span><br><span class="line"><span class="string">        :param word1:</span></span><br><span class="line"><span class="string">        :param word2:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word1 <span class="keyword">or</span> <span class="keyword">not</span> word2:</span><br><span class="line">            <span class="keyword">return</span> (len(word1) <span class="keyword">or</span> len(word2))</span><br><span class="line"></span><br><span class="line">        dp = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(len(word2)+<span class="number">1</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(len(word1)+<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># dp åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(word1)+<span class="number">1</span>):</span><br><span class="line">            dp[i][<span class="number">0</span>] = i</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(word2)+<span class="number">1</span>):</span><br><span class="line">            dp[<span class="number">0</span>][i] = i</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(word1)+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,len(word2)+<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> word1[i<span class="number">-1</span>] == word2[j<span class="number">-1</span>]:</span><br><span class="line">                    dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[i][j] = <span class="number">1</span> + min(dp[i<span class="number">-1</span>][j],dp[i][j<span class="number">-1</span>],dp[i<span class="number">-1</span>][j<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[len(word1)][len(word2)]</span><br></pre></td></tr></table></figure>
<p><a href="https://leetcode-cn.com/problems/edit-distance/solution/bian-ji-ju-chi-by-leetcode-solution/" target="_blank" rel="noopener">leetcodeé¢˜è§£</a></p>
<h3 id="æ‹¼å†™è‡ªåŠ¨çº é”™ç³»ç»Ÿ"><a href="#æ‹¼å†™è‡ªåŠ¨çº é”™ç³»ç»Ÿ" class="headerlink" title="æ‹¼å†™è‡ªåŠ¨çº é”™ç³»ç»Ÿ"></a>æ‹¼å†™è‡ªåŠ¨çº é”™ç³»ç»Ÿ</h3><p>ç»™å®šä¸€å¾…çº é”™è¯w,éœ€è¦ä»ä¸€ç³»åˆ—å€™é€‰è¯ä¸­é€‰å‡ºä¸€æœ€å¯èƒ½çš„è¯cã€‚ä¹Ÿå°±æ˜¯ï¼š$argmax(p(c|w))$, c in å€™é€‰è¯è¡¨ã€‚æ ¹æ®è´å¶æ–¯åŸç†ï¼Œ$p(c|w) = p(w|c) <em> p(c) / p(w)$. åˆæœ‰å¯¹ä»»æ„å¯èƒ½çš„c,p(w)ä¸€æ ·ï¼Œæ•…ä¹Ÿå°±æ˜¯æ±‚ä½¿$argmax(p(w|c) </em> p(c))$æˆç«‹çš„c.</p>
<h4 id="Candidate-Model"><a href="#Candidate-Model" class="headerlink" title="Candidate Model:"></a>Candidate Model:</h4><p>åˆ©ç”¨ç¼–è¾‘è·ç¦»å°äº1æˆ–è€…ç¼–è¾‘è·ç¦»å°äº2ï¼Œæ¥æ„é€ åˆæ­¥å€™é€‰é›†ï¼Œç„¶ååˆ©ç”¨è¯­æ–™åº“ï¼Œè¿‡æ»¤åˆæ­¥å€™é€‰é›†ï¼Œå¾—åˆ°ç¬¦åˆè§„èŒƒçš„å€™é€‰è¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edits1</span><span class="params">(word)</span>:</span></span><br><span class="line">    <span class="string">"All edits that are one edit away from `word`."</span></span><br><span class="line">    letters    = <span class="string">'abcdefghijklmnopqrstuvwxyz'</span></span><br><span class="line">    splits     = [(word[:i], word[i:])    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(word) + <span class="number">1</span>)]</span><br><span class="line">    deletes    = [L + R[<span class="number">1</span>:]               <span class="keyword">for</span> L, R <span class="keyword">in</span> splits <span class="keyword">if</span> R]</span><br><span class="line">    transposes = [L + R[<span class="number">1</span>] + R[<span class="number">0</span>] + R[<span class="number">2</span>:] <span class="keyword">for</span> L, R <span class="keyword">in</span> splits <span class="keyword">if</span> len(R)&gt;<span class="number">1</span>]</span><br><span class="line">    replaces   = [L + c + R[<span class="number">1</span>:]           <span class="keyword">for</span> L, R <span class="keyword">in</span> splits <span class="keyword">if</span> R <span class="keyword">for</span> c <span class="keyword">in</span> letters]</span><br><span class="line">    inserts    = [L + c + R               <span class="keyword">for</span> L, R <span class="keyword">in</span> splits <span class="keyword">for</span> c <span class="keyword">in</span> letters]</span><br><span class="line">    <span class="keyword">return</span> set(deletes + transposes + replaces + inserts)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edits2</span><span class="params">(word)</span>:</span> </span><br><span class="line">  <span class="string">"ç¼–è¾‘è·ç¦»å°äº2çš„å€™é€‰è¯"</span></span><br><span class="line">  <span class="keyword">return</span> (e2 <span class="keyword">for</span> e1 <span class="keyword">in</span> edits1(word) <span class="keyword">for</span> e2 <span class="keyword">in</span> edits1(e1))</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">known</span><span class="params">(words)</span>:</span> </span><br><span class="line">  <span class="string">"åœ¨è¯­æ–™ä¸­è¿‡æ»¤å‡ºå¤åˆæ‹¼å†™è§„èŒƒçš„ï¼ˆæ­£ç¡®ï¼‰çš„è¯"</span></span><br><span class="line">  <span class="keyword">return</span> set(w <span class="keyword">for</span> w <span class="keyword">in</span> words <span class="keyword">if</span> w <span class="keyword">in</span> corpus)</span><br></pre></td></tr></table></figure>
<h4 id="Language-Model"><a href="#Language-Model" class="headerlink" title="Language Model"></a>Language Model</h4><p>å€™é€‰é›†åˆä¸­çš„è¯å†è¯­æ–™åº“ä¸­çš„å‡ºç°æ¦‚ç‡ã€‚æ¯”å¦‚ï¼šthe åœ¨è‹±æ–‡æ–‡æœ¬ä¸­å‡ºç°çš„æ¦‚ç‡ç‡ä¸º7%ï¼Œåˆ™æœ‰ï¼šp(the)=0.07</p>
<p>,å¯ä»¥é€šè¿‡ç»Ÿè®¡è¯­æ–™åº“ä¸­$p(c)$ = è¯cå‡ºç°çš„é¢‘æ¬¡/æ‰€æœ‰è¯çš„å‡ºç°æ¬¡æ•°ä¹‹å’Œã€‚ï¼ˆunigramï¼Œbigramï¼‰</p>
<h4 id="Error-Model"><a href="#Error-Model" class="headerlink" title="Error Model"></a>Error Model</h4><p>å½“æƒ³è¦è¾“å…¥theå´æ„å¤–æ‹¼å†™æˆtehçš„æ¦‚ç‡:p(teh|the)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">candidates</span><span class="params">(word)</span>:</span> </span><br><span class="line">    <span class="keyword">return</span> known([word]) <span class="keyword">or</span> known(edits1(word)) <span class="keyword">or</span> known(edits2(word)) <span class="keyword">or</span> [word]</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">correction</span><span class="params">(word)</span>:</span> </span><br><span class="line">    <span class="keyword">return</span> max(candidates(word), key=P)</span><br></pre></td></tr></table></figure>
<h4 id="Selection-Mechanism"><a href="#Selection-Mechanism" class="headerlink" title="Selection Mechanism"></a>Selection Mechanism</h4><p>ä»æ­£ç¡®çš„æ‹¼å†™å€™é€‰é›†ä¸­é€‰æ‹©æœ€æœ‰å¯èƒ½çš„æ­£ç¡®ç»“æœï¼Œargmax</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ol>
<li>åˆ©ç”¨ç¼–è¾‘è·ç¦»æ„é€ æ­£ç¡®ç»“æœå€™é€‰é›†</li>
<li>åˆ©ç”¨language model å’Œerror model æ¥è®¡ç®—æ¦‚ç‡ã€‚</li>
<li>ä»æ­£ç¡®ç»“æœå€™é€‰é›†ä¸­é€‰æ‹©æ¦‚ç‡æœ€å¤§çš„æ­£ç¡®æ‹¼å†™ã€‚</li>
</ol>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><p><a href="https://cloud.tencent.com/developer/article/1435917" target="_blank" rel="noopener">ä¸­æ–‡æ–‡æœ¬çº é”™ç®—æ³•èµ°åˆ°å¤šè¿œäº†ï¼Ÿ</a></p>
</li>
<li><p><a href="https://github.com/shibing624/pycorrector" target="_blank" rel="noopener">pycorrect</a></p>
</li>
</ol>
]]></content>
      <categories>
        <category>è‡ªç„¶è¯­è¨€å¤„ç†åŸºç¡€</category>
      </categories>
  </entry>
  <entry>
    <title>å…³é”®è¯æŠ½å–</title>
    <url>/2020/04/21/%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8A%BD%E5%8F%96/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="TF-IDF-æå–å…³é”®è¯"><a href="#TF-IDF-æå–å…³é”®è¯" class="headerlink" title="TF-IDF æå–å…³é”®è¯"></a>TF-IDF æå–å…³é”®è¯</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>TF-IDF(Term Frequency-Inverse Document Frequency, è¯é¢‘-é€†æ–‡ä»¶é¢‘ç‡).TF-IDFæ˜¯ä¸€ç§ç»Ÿè®¡æ–¹æ³•ï¼Œç”¨ä»¥è¯„ä¼°ä¸€å­—è¯å¯¹äºä¸€ä¸ªæ–‡ä»¶é›†æˆ–ä¸€ä»½æ–‡ä»¶åœ¨ä¸€ä¸ªè¯­æ–™åº“ä¸­çš„é‡è¦ç¨‹åº¦ã€‚å­—è¯çš„é‡è¦æ€§éšç€å®ƒåœ¨æ–‡ä»¶ä¸­å‡ºç°çš„æ¬¡æ•°æˆæ­£æ¯”å¢åŠ ï¼Œä½†åŒæ—¶ä¼šéšç€å®ƒåœ¨è¯­æ–™åº“ä¸­å‡ºç°çš„é¢‘ç‡æˆåæ¯”ä¸‹é™ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼š<strong>ä¸€ä¸ªè¯è¯­åœ¨ä¸€ç¯‡æ–‡ç« ä¸­å‡ºç°æ¬¡æ•°è¶Šå¤š, åŒæ—¶åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­å‡ºç°æ¬¡æ•°è¶Šå°‘, è¶Šèƒ½å¤Ÿä»£è¡¨è¯¥æ–‡ç« ã€‚</strong></p>
<blockquote>
<p>TF-IDF ç®—æ³•ä¸»è¦é€‚ç”¨äºè‹±æ–‡ï¼Œä¸­æ–‡é¦–å…ˆè¦åˆ†è¯ï¼Œåˆ†è¯åè¦è§£å†³å¤šè¯ä¸€ä¹‰ï¼Œä»¥åŠä¸€è¯å¤šä¹‰é—®é¢˜ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜é€šè¿‡ç®€å•çš„tf-idfæ–¹æ³•ä¸èƒ½å¾ˆå¥½çš„è§£å†³ã€‚äºæ˜¯å°±æœ‰äº†åæ¥çš„è¯åµŒå…¥æ–¹æ³•ï¼Œç”¨å‘é‡æ¥è¡¨å¾ä¸€ä¸ªè¯ã€‚</p>
</blockquote>
<a id="more"></a>
<h3 id="TF-IDF"><a href="#TF-IDF" class="headerlink" title="TF-IDF"></a>TF-IDF</h3><h4 id="TF"><a href="#TF" class="headerlink" title="TF"></a>TF</h4><p>è¡¨ç¤ºè¯æ¡ï¼ˆå…³é”®å­—ï¼‰åœ¨æ–‡æœ¬ä¸­å‡ºç°çš„æ¬¡æ•°ï¼ˆfrequencyï¼‰(ä¸€èˆ¬ä¸ç”¨)ã€‚TF èƒŒåçš„éšå«çš„å‡è®¾æ˜¯ï¼ŒæŸ¥è¯¢å…³é”®å­—ä¸­çš„å•è¯åº”è¯¥ç›¸å¯¹äºå…¶ä»–å•è¯æ›´åŠ é‡è¦ï¼Œè€Œæ–‡æ¡£çš„é‡è¦ç¨‹åº¦ï¼Œä¹Ÿå°±æ˜¯ç›¸å…³åº¦ï¼Œä¸å•è¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°æˆæ­£æ¯”ã€‚æ¯”å¦‚ï¼Œâ€œCarâ€ è¿™ä¸ªå•è¯åœ¨æ–‡æ¡£ A é‡Œå‡ºç°äº† 5 æ¬¡ï¼Œè€Œåœ¨æ–‡æ¡£ B é‡Œå‡ºç°äº† 20 æ¬¡ï¼Œé‚£ä¹ˆ TF è®¡ç®—å°±è®¤ä¸ºæ–‡æ¡£ B å¯èƒ½æ›´ç›¸å…³ã€‚</p>
<h5 id="å˜ç§ä¸€-é€šè¿‡å¯¹æ•°å‡½æ•°é¿å…-TF-çº¿æ€§å¢é•¿"><a href="#å˜ç§ä¸€-é€šè¿‡å¯¹æ•°å‡½æ•°é¿å…-TF-çº¿æ€§å¢é•¿" class="headerlink" title="å˜ç§ä¸€:é€šè¿‡å¯¹æ•°å‡½æ•°é¿å… TF çº¿æ€§å¢é•¿"></a>å˜ç§ä¸€:é€šè¿‡å¯¹æ•°å‡½æ•°é¿å… TF çº¿æ€§å¢é•¿</h5><p>ç†ç”±ï¼šè™½ç„¶æˆ‘ä»¬ä¸€èˆ¬è®¤ä¸ºä¸€ä¸ªæ–‡æ¡£åŒ…å«æŸ¥è¯¢å…³é”®è¯å¤šæ¬¡ç›¸å¯¹æ¥è¯´è¡¨è¾¾äº†æŸç§ç›¸å…³åº¦ï¼Œä½†è¿™æ ·çš„å…³ç³»å¾ˆéš¾è¯´æ˜¯çº¿æ€§çš„ã€‚ä»¥ â€œCar Insuranceâ€ ä¸ºä¾‹ï¼Œæ–‡æ¡£ A å¯èƒ½åŒ…å« â€œCarâ€ è¿™ä¸ªè¯ 100 æ¬¡ï¼Œè€Œæ–‡æ¡£ B å¯èƒ½åŒ…å« 200 æ¬¡ï¼Œæ˜¯ä¸æ˜¯è¯´æ–‡æ¡£ B çš„ç›¸å…³åº¦å°±æ˜¯æ–‡æ¡£ A çš„ 2 å€å‘¢ï¼Ÿå…¶å®ï¼Œå½“è¿™ç§é¢‘æ¬¡è¶…è¿‡äº†æŸä¸ªé˜ˆå€¼ä¹‹åï¼Œè¿™ä¸ª TF ä¹Ÿå°±æ²¡é‚£ä¹ˆæœ‰åŒºåˆ†åº¦äº†ã€‚</p>
<p><strong>ç”¨ Logï¼Œä¹Ÿå°±æ˜¯å¯¹æ•°å‡½æ•°ï¼Œå¯¹ TF è¿›è¡Œå˜æ¢ï¼Œå°±æ˜¯ä¸€ä¸ªä¸è®© TF çº¿æ€§å¢é•¿çš„æŠ€å·§</strong>ã€‚å…·ä½“æ¥è¯´ï¼Œäººä»¬å¸¸å¸¸ç”¨ 1+Log(TF) è¿™ä¸ªå€¼æ¥ä»£æ›¿åŸæ¥çš„ TF å–å€¼ã€‚åœ¨è¿™æ ·æ–°çš„è®¡ç®—ä¸‹ï¼Œå‡è®¾ â€œCarâ€ å‡ºç°ä¸€æ¬¡ï¼Œæ–°çš„å€¼æ˜¯ 1ï¼Œå‡ºç° 100 æ¬¡ï¼Œæ–°çš„å€¼æ˜¯ $log 100=5.6$ï¼Œè€Œå‡ºç° 200 æ¬¡ï¼Œæ–°çš„å€¼æ˜¯$log 200 = 6.3$ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™æ ·çš„è®¡ç®—ä¿æŒäº†ä¸€ä¸ªå¹³è¡¡ï¼Œæ—¢æœ‰åŒºåˆ†åº¦ï¼Œä½†ä¹Ÿä¸è‡³äºå®Œå…¨çº¿æ€§å¢é•¿ã€‚</p>
<h5 id="å˜ç§äºŒï¼šæ ‡å‡†åŒ–è§£å†³é•¿æ–‡æ¡£ã€çŸ­æ–‡æ¡£é—®é¢˜"><a href="#å˜ç§äºŒï¼šæ ‡å‡†åŒ–è§£å†³é•¿æ–‡æ¡£ã€çŸ­æ–‡æ¡£é—®é¢˜" class="headerlink" title="å˜ç§äºŒï¼šæ ‡å‡†åŒ–è§£å†³é•¿æ–‡æ¡£ã€çŸ­æ–‡æ¡£é—®é¢˜"></a>å˜ç§äºŒï¼šæ ‡å‡†åŒ–è§£å†³é•¿æ–‡æ¡£ã€çŸ­æ–‡æ¡£é—®é¢˜</h5><p>ç»å…¸çš„è®¡ç®—å¹¶æ²¡æœ‰è€ƒè™‘ â€œé•¿æ–‡æ¡£â€ å’Œâ€œçŸ­æ–‡æ¡£â€çš„åŒºåˆ«ã€‚ä¸€ä¸ªæ–‡æ¡£ A æœ‰ 3,000 ä¸ªå•è¯ï¼Œä¸€ä¸ªæ–‡æ¡£ B æœ‰ 250 ä¸ªå•è¯ï¼Œå¾ˆæ˜æ˜¾ï¼Œå³ä¾¿ â€œCarâ€ åœ¨è¿™ä¸¤ä¸ªæ–‡æ¡£ä¸­éƒ½åŒæ ·å‡ºç°è¿‡ 20 æ¬¡ï¼Œä¹Ÿä¸èƒ½è¯´è¿™ä¸¤ä¸ªæ–‡æ¡£éƒ½åŒç­‰ç›¸å…³ã€‚<strong>å¯¹ TF è¿›è¡Œ â€œæ ‡å‡†åŒ–â€ï¼ˆNormalizationï¼‰ï¼Œç‰¹åˆ«æ˜¯æ ¹æ®æ–‡æ¡£çš„æœ€å¤§ TF å€¼è¿›è¡Œçš„æ ‡å‡†åŒ–ï¼Œæˆäº†å¦å¤–ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„æŠ€å·§</strong>ã€‚</p>
<script type="math/tex; mode=display">
tf_{ij} = \frac{n_{i,j}}{\sum_k n_{k,j}}</script><p>å…¶ä¸­$n_{i,j}$æ˜¯è¯$w_i$åœ¨æ–‡æ¡£$d_j$ä¸­å‡ºç°çš„æ¬¡æ•°ï¼Œåˆ†æ¯æ˜¯æ–‡æ¡£$d_j$ä¸­æ‰€æœ‰è¯æ±‡å‡ºç°çš„æ¬¡æ•°æ€»å’Œã€‚</p>
<h4 id="IDF"><a href="#IDF" class="headerlink" title="IDF"></a>IDF</h4><p>ä»…æœ‰ TF ä¸èƒ½æ¯”è¾ƒå®Œæ•´åœ°æè¿°æ–‡æ¡£çš„ç›¸å…³åº¦ã€‚å› ä¸ºè¯­è¨€çš„å› ç´ ï¼Œæœ‰ä¸€äº›å•è¯å¯èƒ½ä¼šæ¯”è¾ƒè‡ªç„¶åœ°åœ¨å¾ˆå¤šæ–‡æ¡£ä¸­åå¤å‡ºç°ï¼Œæ¯”å¦‚è‹±è¯­ä¸­çš„ â€œTheâ€ã€â€œAnâ€ã€â€œButâ€ ç­‰ç­‰ã€‚è¿™äº›è¯å¤§å¤šèµ·åˆ°äº†é“¾æ¥è¯­å¥çš„ä½œç”¨ï¼Œæ˜¯ä¿æŒè¯­è¨€è¿è´¯ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬è¦æœç´¢ â€œHow to Build A Carâ€ è¿™ä¸ªå…³é”®è¯ï¼Œå…¶ä¸­çš„ â€œHowâ€ã€â€œToâ€ ä»¥åŠ â€œAâ€ éƒ½æå¯èƒ½åœ¨ç»å¤§å¤šæ•°çš„æ–‡æ¡£ä¸­å‡ºç°ï¼Œè¿™ä¸ªæ—¶å€™ TF å°±æ— æ³•å¸®åŠ©æˆ‘ä»¬åŒºåˆ†æ–‡æ¡£çš„ç›¸å…³åº¦äº†ã€‚</p>
<p>é€†æ–‡æ¡£é¢‘ç‡çš„æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦å» â€œæƒ©ç½šâ€ï¼ˆPenalizeï¼‰é‚£äº›å‡ºç°åœ¨å¤ªå¤šæ–‡æ¡£ä¸­çš„å•è¯ã€‚</p>
<h5 id="å˜ç§ä¸‰ï¼šå¯¹æ•°å‡½æ•°å¤„ç†-IDF"><a href="#å˜ç§ä¸‰ï¼šå¯¹æ•°å‡½æ•°å¤„ç†-IDF" class="headerlink" title="å˜ç§ä¸‰ï¼šå¯¹æ•°å‡½æ•°å¤„ç† IDF"></a>å˜ç§ä¸‰ï¼šå¯¹æ•°å‡½æ•°å¤„ç† IDF</h5><p>æŸä¸€ç‰¹å®šè¯è¯­çš„IDFï¼Œå¯ä»¥ç”±æ€»æ–‡ä»¶æ•°ç›®é™¤ä»¥åŒ…å«è¯¥è¯è¯­çš„æ–‡ä»¶çš„æ•°ç›®ï¼Œå†å°†å¾—åˆ°çš„å•†å–å¯¹æ•°å¾—åˆ°ã€‚å¦‚æœåŒ…å«è¯æ¡tçš„æ–‡æ¡£è¶Šå°‘, IDFè¶Šå¤§ï¼Œåˆ™è¯´æ˜è¯æ¡å…·æœ‰å¾ˆå¥½çš„ç±»åˆ«åŒºåˆ†èƒ½åŠ›ã€‚</p>
<script type="math/tex; mode=display">
idf_w = log{\frac{|D|}{|j:t_i \in d_j|}}</script><p>å…¶ä¸­ï¼Œ$|D|$è¡¨ç¤ºè¯­æ–™åº“ä¸­æ–‡æ¡£æ€»æ•°ï¼Œåˆ†æ¯ä¸ºåŒ…å«è¯wçš„æ–‡æ¡£æ•°+1ï¼Œåˆ†æ¯åŠ 1æ˜¯ä¸ºäº†é¿å…å‡ºç°åˆ†æ¯ä¸ºé›¶çš„æƒ…å†µã€‚</p>
<p>æ ·åšçš„å¥½å¤„å°±æ˜¯ï¼Œç¬¬ä¸€ï¼Œä½¿ç”¨äº†æ–‡æ¡£æ€»æ•°æ¥åšæ ‡å‡†åŒ–ï¼Œå¾ˆç±»ä¼¼ä¸Šé¢æåˆ°çš„æ ‡å‡†åŒ–çš„æ€è·¯ï¼›ç¬¬äºŒï¼Œåˆ©ç”¨å¯¹æ•°æ¥è¾¾åˆ°éçº¿æ€§å¢é•¿çš„ç›®çš„ã€‚</p>
<h5 id="å˜ç§å››ï¼šæŸ¥è¯¢è¯åŠæ–‡æ¡£å‘é‡æ ‡å‡†åŒ–"><a href="#å˜ç§å››ï¼šæŸ¥è¯¢è¯åŠæ–‡æ¡£å‘é‡æ ‡å‡†åŒ–" class="headerlink" title="å˜ç§å››ï¼šæŸ¥è¯¢è¯åŠæ–‡æ¡£å‘é‡æ ‡å‡†åŒ–"></a>å˜ç§å››ï¼šæŸ¥è¯¢è¯åŠæ–‡æ¡£å‘é‡æ ‡å‡†åŒ–</h5><p>å¯¹æŸ¥è¯¢å…³é”®å­—å‘é‡ï¼Œä»¥åŠæ–‡æ¡£å‘é‡è¿›è¡Œæ ‡å‡†åŒ–ï¼Œä½¿å¾—è¿™äº›å‘é‡èƒ½å¤Ÿä¸å—å‘é‡é‡Œæœ‰æ•ˆå…ƒç´ å¤šå°‘çš„å½±å“ï¼Œä¹Ÿå°±æ˜¯ä¸åŒçš„æ–‡æ¡£å¯èƒ½æœ‰ä¸åŒçš„é•¿åº¦ã€‚åœ¨çº¿æ€§ä»£æ•°é‡Œï¼Œå¯ä»¥æŠŠå‘é‡éƒ½æ ‡å‡†åŒ–ä¸ºä¸€ä¸ªå•ä½å‘é‡çš„é•¿åº¦ã€‚è¿™ä¸ªæ—¶å€™å†è¿›è¡Œç‚¹ç§¯è¿ç®—ï¼Œå°±ç›¸å½“äºåœ¨åŸæ¥çš„å‘é‡ä¸Šè¿›è¡Œä½™å¼¦ç›¸ä¼¼åº¦çš„è¿ç®—ã€‚æ‰€ä»¥ï¼Œå¦å¤–ä¸€ä¸ªè§’åº¦åˆ©ç”¨è¿™ä¸ªè§„åˆ™å°±æ˜¯ç›´æ¥åœ¨å¤šæ•°æ—¶å€™è¿›è¡Œä½™å¼¦ç›¸ä¼¼åº¦è¿ç®—ï¼Œä»¥ä»£æ›¿ç‚¹ç§¯è¿ç®—ã€‚</p>
<h4 id="TF-IDF-1"><a href="#TF-IDF-1" class="headerlink" title="TF-IDF"></a>TF-IDF</h4><p>æŸä¸€ç‰¹å®šæ–‡ä»¶å†…çš„é«˜è¯è¯­é¢‘ç‡ï¼Œä»¥åŠè¯¥è¯è¯­åœ¨æ•´ä¸ªæ–‡ä»¶é›†åˆä¸­çš„ä½æ–‡ä»¶é¢‘ç‡ï¼Œå¯ä»¥äº§ç”Ÿå‡ºé«˜æƒé‡çš„TF-IDFã€‚å› æ­¤ï¼ŒTF-IDFå€¾å‘äºè¿‡æ»¤æ‰å¸¸è§çš„è¯è¯­ï¼Œä¿ç•™é‡è¦çš„è¯è¯­(å…³é”®è¯)ã€‚</p>
<script type="math/tex; mode=display">
TF-IDF = TF * IDF</script><h3 id="TF-IDF-çš„åº”ç”¨"><a href="#TF-IDF-çš„åº”ç”¨" class="headerlink" title="TF-IDF çš„åº”ç”¨"></a>TF-IDF çš„åº”ç”¨</h3><ol>
<li>æœç´¢å¼•æ“</li>
<li>å…³é”®è¯æå–</li>
<li>æ–‡æœ¬ç›¸ä¼¼æ€§</li>
<li>æ–‡æœ¬æ‘˜è¦</li>
</ol>
<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>å…·ä½“å®ç°ï¼Œç§»æ­¥<a href="https://github.com/jeffery0628/keyword_extraction" target="_blank" rel="noopener">GitHub</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf_idf</span><span class="params">(document, corpus)</span>:</span>  <span class="comment"># è®¡ç®—TF-IDF,å¹¶è¿”å›å­—å…¸</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param document: è®¡ç®—documenté‡Œé¢æ¯ä¸ªè¯çš„tfidfå€¼ï¼Œdocumentä¸ºæ–‡æœ¬åˆ†è¯åçš„å½¢å¼ï¼Œ</span></span><br><span class="line"><span class="string">    å¦‚:[6 æœˆ 19 æ—¥ 2012 å¹´åº¦ ä¸­å›½ çˆ±å¿ƒ åŸå¸‚ å…¬ç›Šæ´»åŠ¨ æ–°é—» å‘å¸ƒä¼š åœ¨äº¬ä¸¾è¡Œ]</span></span><br><span class="line"><span class="string">    å¦‚æœæ˜¯å¯¹ä¸€ç¯‡æ–‡æ¡£è¿›è¡Œå…³é”®è¯æå–ï¼Œåˆ™éœ€è¦å¯¹æ–‡æ¡£è¿›è¡Œåˆ†å¥ï¼ŒæŠŠæ¯å¥è¯çœ‹æˆä¸€ä¸ªdocumentï¼Œcorpusåˆ™å­˜æ”¾çš„æ˜¯æ•´ç¯‡æ–‡æ¡£åˆ†è¯åçš„æ‰€æœ‰å¥å­ï¼ˆå¥å­ä¸ºåˆ†è¯åçš„ç»“æœï¼‰ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param corpus:  corpusä¸ºæ‰€æœ‰é—®å½“åˆ†è¯åçš„åˆ—è¡¨ï¼š[document1,document2,document3,...]</span></span><br><span class="line"><span class="string">    :return:dictç±»å‹ï¼ŒæŒ‰ç…§tfidfå€¼ä»å¤§åˆ°å°æ’åºï¼š orderdict[word] = tfidf_value</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    word_tfidf = &#123;&#125;</span><br><span class="line">    <span class="comment"># è®¡ç®—è¯é¢‘</span></span><br><span class="line">    freq_words = Counter(document)</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> freq_words:</span><br><span class="line">        <span class="comment"># è®¡ç®—TFï¼šæŸä¸ªè¯åœ¨æ–‡ç« ä¸­å‡ºç°çš„æ¬¡æ•°/æ–‡ç« æ€»è¯æ•°</span></span><br><span class="line">        tf = freq_words[word] / len(document)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—IDFï¼šlog(è¯­æ–™åº“çš„æ–‡æ¡£æ€»æ•°/(åŒ…å«è¯¥è¯çš„æ–‡æ¡£æ•°+1))</span></span><br><span class="line">        idf = math.log(len(corpus) / (wordinfilecount(word, corpus) + <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—æ¯ä¸ªè¯çš„TFIDFå€¼</span></span><br><span class="line">        tfidf = tf * idf  <span class="comment"># è®¡ç®—TF-IDF</span></span><br><span class="line">        word_tfidf[word] = tfidf</span><br><span class="line"></span><br><span class="line">    orderdic = sorted(word_tfidf.items(), key=<span class="keyword">lambda</span> item: item[<span class="number">1</span>], reverse=<span class="literal">True</span>)  <span class="comment"># ç»™å­—å…¸æ’åº</span></span><br><span class="line">    <span class="keyword">return</span> orderdic</span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    stop_words_path = <span class="string">r'stop_words.txt'</span>  <span class="comment"># åœç”¨è¯è¡¨è·¯å¾„</span></span><br><span class="line">    stop_words = get_stopwords(stop_words_path)  <span class="comment"># è·å–åœç”¨è¯è¡¨åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">    documents_dir = <span class="string">'data'</span></span><br><span class="line">    filelist = get_documents(documents_dir)  <span class="comment"># è·å–æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">    corpus = get_corpus(filelist, stop_words)  <span class="comment"># å»ºç«‹è¯­æ–™åº“</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx,document <span class="keyword">in</span> enumerate(corpus):</span><br><span class="line">        word_tfidf = tf_idf(document, corpus)  <span class="comment"># è®¡ç®—TF-IDF</span></span><br><span class="line">        <span class="comment"># è¾“å‡ºå‰åå…³é”®è¯</span></span><br><span class="line">        print(<span class="string">'document &#123;&#125;,top 10 key words&#123;&#125;'</span>.format(idx+<span class="number">1</span>,word_tfidf[:<span class="number">10</span>]))</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨scikit-learn è®¡ç®—tfidf<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfTransformer, TfidfVectorizer</span><br><span class="line"><span class="comment"># å¯¹è¯­æ–™è¿›è¡Œç¨å¾®å¤„ç†</span></span><br><span class="line">corpus = [*map(<span class="keyword">lambda</span> x:<span class="string">" "</span>.join(x), corpus)]</span><br><span class="line">tfidf_model = TfidfVectorizer()</span><br><span class="line">tfidf_matrix = tfidf_model.fit_transform(corpus)  <span class="comment"># è®¡ç®—æ¯ä¸ªè¯çš„tfidfå€¼</span></span><br><span class="line">words = tfidf_model.get_feature_names()<span class="comment"># æ‰€æœ‰è¯çš„é›†åˆ</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(corpus)):</span><br><span class="line">  	word_tfidf = &#123;&#125;</span><br><span class="line">  	<span class="keyword">for</span> j <span class="keyword">in</span> range(len(words)):</span><br><span class="line">        word_tfidf[words[j]] = tfidf_matrix[i, j]</span><br><span class="line">        word_tfidf = sorted(word_tfidf.items(),key=<span class="keyword">lambda</span> item:item[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br><span class="line">        print(<span class="string">'document &#123;&#125;,top 10 key words&#123;&#125;'</span>.format(i+<span class="number">1</span>, word_tfidf[:<span class="number">10</span>]))</span><br></pre></td></tr></table></figure></p>
<h2 id="TextRank-æå–å…³é”®è¯"><a href="#TextRank-æå–å…³é”®è¯" class="headerlink" title="TextRank æå–å…³é”®è¯"></a>TextRank æå–å…³é”®è¯</h2><h3 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>TF-IDF ç®—æ³•å¯¹æœ‰å¤šæ®µæ–‡æœ¬çš„å…³é”®è¯æå–éå¸¸æœ‰æ•ˆï¼Œä½†æ˜¯å¯¹äºå•ç¯‡æˆ–è€…æ–‡æ¡£åˆ†å‰²è¾ƒå°‘çš„æ–‡æœ¬è¡¨ç°å¾—ä¸æ˜¯ç‰¹åˆ«å¥½ã€‚å¦‚æœéœ€è¦æå–å…³é”®è¯çš„è¯­å¥åªæœ‰ä¸€å¥è¯ï¼Œé‚£ä¹ˆåŸºäºTF-IDFå¯ä»¥çŸ¥é“ï¼Œæ‰€æœ‰å…³é”®è¯çš„é‡è¦åº¦éƒ½ä¸º0(å› ä¸ºIDFå€¼ä¸º0)ï¼Œè¿™ç§æƒ…å†µä¸‹ä½¿ç”¨TextRankæ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚</p>
<p>TextRankæ˜¯ä¸€ç§åŸºäºå›¾æ’åºçš„ç®—æ³•ï¼ŒåŸºæœ¬æ€æƒ³æ˜¯(æ¥æºäºPageRank)ï¼šé€šè¿‡æŠŠæ–‡æœ¬åˆ†å‰²æˆè‹¥å¹²ç»„æˆå•å…ƒ(å•è¯ã€å¥å­)å¹¶å»ºç«‹å›¾æ¨¡å‹ï¼Œåˆ©ç”¨æŠ•ç¥¨æœºåˆ¶å¯¹æ–‡æœ¬ä¸­çš„é‡è¦æˆåˆ†è¿›è¡Œæ’åºï¼Œ<strong>ä»…åˆ©ç”¨å•ç¯‡æ–‡æ¡£æœ¬èº«çš„ä¿¡æ¯å°±å¯ä»¥å®ç°å…³é”®è¯æå–ã€æ–‡æœ¬æ‘˜è¦</strong>ã€‚å’Œ LDAã€HMM ç­‰æ¨¡å‹ä¸åŒ, TextRankä¸éœ€è¦äº‹å…ˆå¯¹å¤šç¯‡æ–‡æ¡£è¿›è¡Œå­¦ä¹ è®­ç»ƒ, å› å…¶ç®€æ´æœ‰æ•ˆè€Œå¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</p>
<h3 id="PageRank"><a href="#PageRank" class="headerlink" title="PageRank"></a>PageRank</h3><h4 id="PageRank-çš„ç®€åŒ–æ¨¡å‹"><a href="#PageRank-çš„ç®€åŒ–æ¨¡å‹" class="headerlink" title="PageRank çš„ç®€åŒ–æ¨¡å‹"></a>PageRank çš„ç®€åŒ–æ¨¡å‹</h4><p>å‡è®¾ä¸€å…±æœ‰ 4 ä¸ªç½‘é¡µ Aã€Bã€Cã€Dã€‚å®ƒä»¬ä¹‹é—´çš„é“¾æ¥ä¿¡æ¯å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/04/21/%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8A%BD%E5%8F%96/pagerank.png" alt="avatar"></p>
<p>å‡ºé“¾æŒ‡çš„æ˜¯é“¾æ¥å‡ºå»çš„é“¾æ¥ã€‚å…¥é“¾æŒ‡çš„æ˜¯é“¾æ¥è¿›æ¥çš„é“¾æ¥ã€‚æ¯”å¦‚å›¾ä¸­ A æœ‰ 2 ä¸ªå…¥é“¾ï¼Œ3 ä¸ªå‡ºé“¾ã€‚ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªç½‘é¡µçš„å½±å“åŠ› = æ‰€æœ‰å…¥é“¾é›†åˆçš„é¡µé¢çš„åŠ æƒå½±å“åŠ›ä¹‹å’Œï¼Œç”¨å…¬å¼è¡¨ç¤ºä¸ºï¼š</p>
<script type="math/tex; mode=display">
P R(u)=\sum_{v \in B_{u}} \frac{P R(v)}{L(v)}</script><p>u ä¸ºå¾…è¯„ä¼°çš„é¡µé¢ï¼Œ $B_{u}$ ä¸ºé¡µé¢ $u$ çš„å…¥é“¾é›†åˆã€‚é’ˆå¯¹å…¥é“¾é›†åˆä¸­çš„ä»»æ„é¡µé¢ $v$ï¼Œå®ƒèƒ½ç»™ $u$ å¸¦æ¥çš„å½±å“åŠ›æ˜¯å…¶è‡ªèº«çš„å½±å“åŠ› $PR(v)$ é™¤ä»¥ $v$ é¡µé¢çš„å‡ºé“¾æ•°é‡ï¼Œå³é¡µé¢ $v$ æŠŠå½±å“åŠ› $PR(v)$ å¹³å‡åˆ†é…ç»™äº†å®ƒçš„å‡ºé“¾ï¼Œè¿™æ ·ç»Ÿè®¡æ‰€æœ‰èƒ½ç»™ $u$ å¸¦æ¥é“¾æ¥çš„é¡µé¢ $v$ï¼Œå¾—åˆ°çš„æ€»å’Œå°±æ˜¯ç½‘é¡µ $u$ çš„å½±å“åŠ›ï¼Œå³ä¸º $PR(u)$ã€‚æ‰€ä»¥å‡ºé“¾ä¼šç»™è¢«é“¾æ¥çš„é¡µé¢èµ‹äºˆå½±å“åŠ›ï¼Œå½“æˆ‘ä»¬ç»Ÿè®¡äº†ä¸€ä¸ªç½‘é¡µé“¾å‡ºå»çš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯ç»Ÿè®¡äº†è¿™ä¸ªç½‘é¡µçš„è·³è½¬æ¦‚ç‡ã€‚</p>
<p>åœ¨ä¾‹å­ä¸­ï¼ŒA æœ‰ä¸‰ä¸ªå‡ºé“¾åˆ†åˆ«é“¾æ¥åˆ°äº† Bã€Cã€D ä¸Šã€‚é‚£ä¹ˆå½“ç”¨æˆ·è®¿é—® A çš„æ—¶å€™ï¼Œå°±æœ‰è·³è½¬åˆ° Bã€C æˆ–è€… D çš„å¯èƒ½æ€§ï¼Œè·³è½¬æ¦‚ç‡å‡ä¸º 1/3ã€‚B æœ‰ä¸¤ä¸ªå‡ºé“¾ï¼Œé“¾æ¥åˆ°äº† A å’Œ D ä¸Šï¼Œè·³è½¬æ¦‚ç‡ä¸º 1/2ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° Aã€Bã€Cã€D è¿™å››ä¸ªç½‘é¡µçš„è½¬ç§»çŸ©é˜µ Mï¼š</p>
<script type="math/tex; mode=display">
M=\left[\begin{array}{cccc}
0 & 1 / 2 & 1 & 0 \\
1 / 3 & 0 & 0 & 1 / 2 \\
1 / 3 & 0 & 0 & 1 / 2 \\
1 / 3 & 1 / 2 & 0 & 0
\end{array}\right]</script><p>å‡è®¾ Aã€Bã€Cã€D å››ä¸ªé¡µé¢çš„åˆå§‹å½±å“åŠ›éƒ½æ˜¯ç›¸åŒçš„ï¼Œå³ï¼š</p>
<script type="math/tex; mode=display">
w_{0}=\left[\begin{array}{l}
1 / 4 \\
1 / 4 \\
1 / 4 \\
1 / 4
\end{array}\right]</script><p>å½“è¿›è¡Œç¬¬ä¸€æ¬¡è½¬ç§»ä¹‹åï¼Œå„é¡µé¢çš„å½±å“åŠ› $w_{1}$ å˜ä¸ºï¼š</p>
<script type="math/tex; mode=display">
w_1=Mw_0=\left[\begin{array}{cccc}
0 & 1 / 2 & 1 & 0 \\
1 / 3 & 0 & 0 & 1 / 2 \\
1 / 3 & 0 & 0 & 1 / 2 \\
1 / 3 & 1 / 2 & 0 & 0
\end{array}\right]\left[\begin{array}{c}
1 / 4 \\
1 / 4 \\
1 / 4 \\
1 / 4
\end{array}\right]=\left[\begin{array}{c}
9 / 24 \\
5 / 24 \\
5 / 24 \\
5 / 24
\end{array}\right]</script><p>ç„¶åå†ç”¨è½¬ç§»çŸ©é˜µä¹˜ä»¥ $w_{1}$ å¾—åˆ° $w_{2}$ ç»“æœï¼Œç›´åˆ°ç¬¬ $n$ æ¬¡è¿­ä»£å $w_{n}$ å½±å“åŠ›ä¸å†å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥æ”¶æ•›åˆ° $(0.3333,0.2222,0.2222,0.2222$ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç€ Aã€Bã€Cã€D å››ä¸ªé¡µé¢æœ€ç»ˆå¹³è¡¡çŠ¶æ€ä¸‹çš„å½±å“åŠ›ã€‚èƒ½çœ‹å‡º A é¡µé¢ç›¸æ¯”äºå…¶ä»–é¡µé¢æ¥è¯´æƒé‡æ›´å¤§ï¼Œä¹Ÿå°±æ˜¯ PR å€¼æ›´é«˜ã€‚è€Œ Bã€Cã€D é¡µé¢çš„ PR å€¼ç›¸ç­‰ã€‚</p>
<h4 id="ç­‰çº§æ³„éœ²ï¼ˆRank-Leakï¼‰"><a href="#ç­‰çº§æ³„éœ²ï¼ˆRank-Leakï¼‰" class="headerlink" title="ç­‰çº§æ³„éœ²ï¼ˆRank Leakï¼‰"></a>ç­‰çº§æ³„éœ²ï¼ˆRank Leakï¼‰</h4><p>å¦‚æœä¸€ä¸ªç½‘é¡µæ²¡æœ‰å‡ºé“¾ï¼Œå°±åƒæ˜¯ä¸€ä¸ªé»‘æ´ä¸€æ ·ï¼Œå¸æ”¶äº†å…¶ä»–ç½‘é¡µçš„å½±å“åŠ›è€Œä¸é‡Šæ”¾ï¼Œæœ€ç»ˆä¼šå¯¼è‡´å…¶ä»–ç½‘é¡µçš„ PR å€¼ä¸º 0ã€‚</p>
<p><img src="/2020/04/21/%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8A%BD%E5%8F%96/rank_leak.png" alt="avatar"></p>
<h4 id="ç­‰çº§æ²‰æ²¡ï¼ˆRank-Sinkï¼‰"><a href="#ç­‰çº§æ²‰æ²¡ï¼ˆRank-Sinkï¼‰" class="headerlink" title="ç­‰çº§æ²‰æ²¡ï¼ˆRank Sinkï¼‰"></a>ç­‰çº§æ²‰æ²¡ï¼ˆRank Sinkï¼‰</h4><p>å¦‚æœä¸€ä¸ªç½‘é¡µåªæœ‰å‡ºé“¾ï¼Œæ²¡æœ‰å…¥é“¾ï¼Œè®¡ç®—çš„è¿‡ç¨‹è¿­ä»£ä¸‹æ¥ï¼Œä¼šå¯¼è‡´<strong>è¿™ä¸ªç½‘é¡µ</strong>çš„ PR å€¼ä¸º 0ï¼ˆä¹Ÿå°±æ˜¯ä¸å­˜åœ¨å…¬å¼ä¸­çš„ Vï¼‰ã€‚</p>
<p><img src="/2020/04/21/%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8A%BD%E5%8F%96/rank_sink.png" alt="avatar"></p>
<h4 id="è§£å†³æ–¹æ¡ˆï¼šéšæœºæµè§ˆ"><a href="#è§£å†³æ–¹æ¡ˆï¼šéšæœºæµè§ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼šéšæœºæµè§ˆ"></a>è§£å†³æ–¹æ¡ˆï¼šéšæœºæµè§ˆ</h4><p>ä¸ºäº†è§£å†³ç®€åŒ–æ¨¡å‹ä¸­å­˜åœ¨çš„ç­‰çº§æ³„éœ²å’Œç­‰çº§æ²‰æ²¡çš„é—®é¢˜ï¼Œæ‹‰é‡ŒÂ·ä½©å¥‡æå‡ºäº† PageRank çš„éšæœºæµè§ˆæ¨¡å‹ã€‚ä»–å‡è®¾äº†è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šç”¨æˆ·å¹¶ä¸éƒ½æ˜¯æŒ‰ç…§è·³è½¬é“¾æ¥çš„æ–¹å¼æ¥ä¸Šç½‘ï¼Œè¿˜æœ‰ä¸€ç§å¯èƒ½æ˜¯ä¸è®ºå½“å‰å¤„äºå“ªä¸ªé¡µé¢ï¼Œéƒ½æœ‰æ¦‚ç‡è®¿é—®åˆ°å…¶ä»–ä»»æ„çš„é¡µé¢ï¼Œæ¯”å¦‚è¯´ç”¨æˆ·å°±æ˜¯è¦ç›´æ¥è¾“å…¥ç½‘å€è®¿é—®å…¶ä»–é¡µé¢ï¼Œè™½ç„¶è¿™ä¸ªæ¦‚ç‡æ¯”è¾ƒå°ã€‚</p>
<p>æ‰€ä»¥ä»–å®šä¹‰äº†é˜»å°¼å› å­ dï¼Œè¿™ä¸ªå› å­ä»£è¡¨äº†ç”¨æˆ·æŒ‰ç…§è·³è½¬é“¾æ¥æ¥ä¸Šç½‘çš„æ¦‚ç‡ï¼Œé€šå¸¸å¯ä»¥å–ä¸€ä¸ªå›ºå®šå€¼ 0.85ï¼Œè€Œ 1-d=0.15 åˆ™ä»£è¡¨äº†ç”¨æˆ·ä¸æ˜¯é€šè¿‡è·³è½¬é“¾æ¥çš„æ–¹å¼æ¥è®¿é—®ç½‘é¡µçš„ï¼Œæ¯”å¦‚ç›´æ¥è¾“å…¥ç½‘å€ã€‚</p>
<script type="math/tex; mode=display">
P R(u)=\frac{1-d}{N}+d \sum_{v \in B_{u}} \frac{P R(v)}{L(v)}</script><p>å…¶ä¸­ $N$ ä¸ºç½‘é¡µæ€»æ•°ï¼Œè¿™æ ·æˆ‘ä»¬åˆå¯ä»¥é‡æ–°è¿­ä»£ç½‘é¡µçš„æƒé‡è®¡ç®—äº†ï¼ŒåŠ å…¥äº†é˜»å°¼å› å­ $d$ï¼Œä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†ç­‰çº§æ³„éœ²å’Œç­‰çº§æ²‰æ²¡çš„é—®é¢˜ã€‚é€šè¿‡æ•°å­¦å®šç†ä¹Ÿå¯ä»¥è¯æ˜ï¼Œæœ€ç»ˆ PageRank éšæœºæµè§ˆæ¨¡å‹æ˜¯å¯ä»¥æ”¶æ•›çš„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¾—åˆ°ä¸€ä¸ªç¨³å®šæ­£å¸¸çš„ PR å€¼ã€‚</p>
<h3 id="TextRank"><a href="#TextRank" class="headerlink" title="TextRank"></a>TextRank</h3><p>TextRanké€šè¿‡è¯ä¹‹é—´çš„ç›¸é‚»å…³ç³»æ„å»ºç½‘ç»œï¼Œç„¶åç”¨PageRankè¿­ä»£è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„rankå€¼ï¼Œæ’åºrankå€¼å³å¯å¾—åˆ°å…³é”®è¯ã€‚PageRankè¿­ä»£è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
P R\left(V_{i}\right)=(1-d)+d * \sum_{j \in \operatorname{In}\left(V_{i}\right)} \frac{1}{\left|O u t\left(V_{j}\right)\right|} P R\left(V_{j}\right)</script><p>å…¶ä¸­ï¼Œd:è¡¨ç¤ºé˜»å°¼ç³»æ•°ï¼Œä¸€èˆ¬ä¸º0.85ã€‚$V_i$ï¼šè¡¨ç¤ºå›¾ä¸­ä»»ä¸€èŠ‚ç‚¹ã€‚$In(V_i)$:è¡¨ç¤ºæŒ‡å‘é¡¶ç‚¹$V_i$çš„æ‰€æœ‰é¡¶ç‚¹çš„é›†åˆã€‚$|Out(V_j)|$ï¼šè¡¨ç¤ºç”±é¡¶ç‚¹$V_j$è¿æ¥å‡ºå»çš„æ‰€æœ‰é¡¶ç‚¹é›†åˆä¸ªæ•°ã€‚$PR(V_i)$ï¼šè¡¨ç¤ºé¡¶ç‚¹$V_i$çš„æœ€ç»ˆæ’åºæƒé‡ã€‚(ä¸pagerankå…¬å¼åŸºæœ¬ä¸€è‡´ã€‚)</p>
<p>ç½‘é¡µä¹‹é—´çš„é“¾æ¥å…³ç³»å¯ä»¥ç”¨å›¾è¡¨ç¤ºï¼Œé‚£ä¹ˆæ€ä¹ˆæŠŠä¸€ä¸ªå¥å­ï¼ˆå¯ä»¥çœ‹ä½œè¯çš„åºåˆ—ï¼‰æ„å»ºæˆå›¾å‘¢ï¼ŸTextRankå°†æŸä¸€ä¸ªè¯ä¸å…¶å‰é¢çš„Nä¸ªè¯ã€ä»¥åŠåé¢çš„Nä¸ªè¯å‡å…·æœ‰å›¾ç›¸é‚»å…³ç³»ï¼ˆç±»ä¼¼äºN-gramè¯­æ³•æ¨¡å‹ï¼‰ã€‚å…·ä½“å®ç°ï¼šè®¾ç½®ä¸€ä¸ªé•¿åº¦ä¸ºNçš„æ»‘åŠ¨çª—å£ï¼Œæ‰€æœ‰åœ¨è¿™ä¸ªçª—å£ä¹‹å†…çš„è¯éƒ½è§†ä½œè¯ç»“ç‚¹çš„ç›¸é‚»ç»“ç‚¹ï¼›åˆ™TextRankæ„å»ºçš„è¯å›¾ä¸ºæ— å‘å›¾ã€‚ä¸‹å›¾ç»™å‡ºäº†ç”±ä¸€ä¸ªæ–‡æ¡£æ„å»ºçš„è¯å›¾ï¼ˆå»æ‰äº†åœç”¨è¯å¹¶æŒ‰è¯æ€§åšäº†ç­›é€‰ï¼‰ï¼š</p>
<p><img src="/2020/04/21/%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8A%BD%E5%8F%96/textrank.png" alt="avatar"></p>
<p>è€ƒè™‘åˆ°ä¸åŒè¯å¯¹å¯èƒ½æœ‰ä¸åŒçš„å…±ç°ï¼ˆco-occurrenceï¼‰ï¼ŒTextRankå°†å…±ç°ä½œä¸ºæ— å‘å›¾è¾¹çš„æƒå€¼ã€‚é‚£ä¹ˆï¼ŒTextRankçš„è¿­ä»£è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
W S\left(V_{i}\right)=(1-d)+d * \sum_{j \in \operatorname{In}\left(V_{i}\right)} \frac{w_{ij}}{\left|O u t\left(V_{j}\right)\right|} W S\left(V_{j}\right)</script><p>è¯¥å…¬å¼ä»…ä»…æ¯”PageRankå¤šäº†ä¸€ä¸ªæƒé‡é¡¹$w_{ij}$ï¼Œç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è¾¹è¿æ¥æœ‰ä¸åŒçš„é‡è¦ç¨‹åº¦ã€‚</p>
<h4 id="TextRank-å…³é”®è¯-çŸ­è¯­-æå–ç®—æ³•"><a href="#TextRank-å…³é”®è¯-çŸ­è¯­-æå–ç®—æ³•" class="headerlink" title="TextRank å…³é”®è¯(çŸ­è¯­)æå–ç®—æ³•"></a>TextRank å…³é”®è¯(çŸ­è¯­)æå–ç®—æ³•</h4><ol>
<li>æŠŠç»™å®šçš„æ–‡æœ¬$T$æŒ‰ç…§å®Œæ•´å¥å­è¿›è¡Œåˆ†å‰²ï¼Œå³$T = [S_1,S_2,\ldots,S_n]$.</li>
<li>æ–‡æœ¬$T$ä¸­æ¯ä¸ªå¥å­$S_i$ï¼Œè¿›è¡Œåˆ†è¯å’Œè¯æ€§æ ‡æ³¨å¤„ç†ï¼Œå¹¶è¿‡æ»¤æ‰åœç”¨è¯ï¼Œåªä¿ç•™æŒ‡å®šè¯æ€§çš„å•è¯ï¼Œå¦‚åè¯ã€åŠ¨è¯ã€å½¢å®¹è¯ï¼Œå³$S_i = [t_{i,1},t_{i,2},\ldots,t_{i,\pi}]$,å…¶ä¸­$t_{ij}$æ˜¯ä¿ç•™åçš„å€™é€‰å…³é”®è¯ã€‚</li>
<li>æ„å»ºå€™é€‰å…³é”®è¯å›¾$G = (V,E)$ï¼Œå…¶ä¸­$V$ä¸ºèŠ‚ç‚¹é›†ï¼Œç”±æ­¥éª¤2ç”Ÿæˆçš„å€™é€‰å…³é”®è¯ç»„æˆï¼Œç„¶åé‡‡ç”¨å…±ç°å…³ç³»ï¼ˆco-occurrenceï¼‰æ„é€ ä»»ä¸¤ç‚¹ä¹‹é—´çš„è¾¹ï¼Œä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´å­˜åœ¨è¾¹ä»…å½“å®ƒä»¬å¯¹åº”çš„è¯æ±‡åœ¨é•¿åº¦ä¸ºKçš„çª—å£ä¸­å…±ç°ï¼ŒKè¡¨ç¤ºçª—å£å¤§å°ï¼Œå³æœ€å¤šå…±ç°Kä¸ªå•è¯ã€‚</li>
<li>æ ¹æ®ä¸Šé¢å…¬å¼ï¼Œè¿­ä»£ä¼ æ’­å„èŠ‚ç‚¹çš„æƒé‡ï¼Œç›´è‡³æ”¶æ•›ã€‚</li>
<li>å¯¹èŠ‚ç‚¹æƒé‡è¿›è¡Œå€’åºæ’åºï¼Œä»è€Œå¾—åˆ°æœ€é‡è¦çš„Tä¸ªå•è¯ï¼Œä½œä¸ºå€™é€‰å…³é”®è¯ã€‚</li>
<li>ç”±æ­¥éª¤5å¾—åˆ°æœ€é‡è¦çš„Tä¸ªå•è¯ï¼Œåœ¨åŸå§‹æ–‡æœ¬ä¸­è¿›è¡Œæ ‡è®°ï¼Œè‹¥å½¢æˆç›¸é‚»è¯ç»„ï¼Œåˆ™ç»„åˆæˆå¤šè¯å…³é”®è¯ã€‚</li>
</ol>
<h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">import</span> jieba.posseg <span class="keyword">as</span> pseg</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">textrank_graph</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.graph = defaultdict(list) <span class="comment"># key:[(),(),(),...] å¦‚ï¼šæ˜¯ [('æ˜¯', 'å…¨å›½', 1), ('æ˜¯', 'è°ƒæŸ¥', 1), ('æ˜¯', 'å¤±ä¸šç‡', 1), ('æ˜¯', 'åŸé•‡', 1)]</span></span><br><span class="line">        self.d = <span class="number">0.85</span>  <span class="comment"># dæ˜¯é˜»å°¼ç³»æ•°ï¼Œä¸€èˆ¬è®¾ç½®ä¸º0.85</span></span><br><span class="line">        self.min_diff = <span class="number">1e-5</span>  <span class="comment"># è®¾å®šæ”¶æ•›é˜ˆå€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ·»åŠ èŠ‚ç‚¹ä¹‹é—´çš„è¾¹</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addEdge</span><span class="params">(self, start, end, weight)</span>:</span></span><br><span class="line">        self.graph[start].append((start, end, weight))</span><br><span class="line">        self.graph[end].append((end, start, weight))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># èŠ‚ç‚¹æ’åº</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rank</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># ä¸€å…±æœ‰14ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        print(len(self.graph))</span><br><span class="line">        <span class="comment"># é»˜è®¤åˆå§‹åŒ–æƒé‡</span></span><br><span class="line">        weight_deault = <span class="number">1.0</span> / (len(self.graph) <span class="keyword">or</span> <span class="number">1.0</span>)</span><br><span class="line">        <span class="comment"># nodeweight_dict, å­˜å‚¨èŠ‚ç‚¹çš„æƒé‡</span></span><br><span class="line">        nodeweight_dict = defaultdict(float)</span><br><span class="line">        <span class="comment"># outsumï¼Œå­˜å‚¨èŠ‚ç‚¹çš„å‡ºåº¦æƒé‡</span></span><br><span class="line">        outsum_node_dict = defaultdict(float)</span><br><span class="line">        <span class="comment"># æ ¹æ®å›¾ä¸­çš„è¾¹ï¼Œæ›´æ–°èŠ‚ç‚¹æƒé‡</span></span><br><span class="line">        <span class="keyword">for</span> node, out_edge <span class="keyword">in</span> self.graph.items():</span><br><span class="line">            <span class="comment"># æ˜¯ [('æ˜¯', 'å…¨å›½', 1), ('æ˜¯', 'è°ƒæŸ¥', 1), ('æ˜¯', 'å¤±ä¸šç‡', 1), ('æ˜¯', 'åŸé•‡', 1)]</span></span><br><span class="line">            nodeweight_dict[node] = weight_deault <span class="comment"># åˆå§‹åŒ–èŠ‚ç‚¹æƒé‡</span></span><br><span class="line">            outsum_node_dict[node] = sum((edge[<span class="number">2</span>] <span class="keyword">for</span> edge <span class="keyword">in</span> out_edge), <span class="number">0.0</span>) <span class="comment"># ç»Ÿè®¡nodeèŠ‚ç‚¹çš„å‡ºåº¦</span></span><br><span class="line">        <span class="comment"># åˆå§‹çŠ¶æ€ä¸‹çš„textranké‡è¦æ€§æƒé‡</span></span><br><span class="line">        sorted_keys = sorted(self.graph.keys())</span><br><span class="line">        <span class="comment"># è®¾å®šè¿­ä»£æ¬¡æ•°ï¼Œ</span></span><br><span class="line">        step_dict = [<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> step <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">            <span class="keyword">for</span> node <span class="keyword">in</span> sorted_keys:</span><br><span class="line">                s = <span class="number">0</span></span><br><span class="line">                <span class="comment"># è®¡ç®—å…¬å¼ï¼š(edge_weight/outsum_node_dict[edge_node])*node_weight[edge_node]</span></span><br><span class="line">                <span class="keyword">for</span> e <span class="keyword">in</span> self.graph[node]:</span><br><span class="line">                    s += e[<span class="number">2</span>] / outsum_node_dict[e[<span class="number">1</span>]] * nodeweight_dict[e[<span class="number">1</span>]]</span><br><span class="line">                <span class="comment"># è®¡ç®—å…¬å¼ï¼š(1-d) + d*s</span></span><br><span class="line">                nodeweight_dict[node] = (<span class="number">1</span> - self.d) + self.d * s</span><br><span class="line">            step_dict.append(sum(nodeweight_dict.values()))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> abs(step_dict[step] - step_dict[step - <span class="number">1</span>]) &lt;= self.min_diff:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆ©ç”¨Z-scoreè¿›è¡Œæƒé‡å½’ä¸€åŒ–ï¼Œä¹Ÿç§°ä¸ºç¦»å·®æ ‡å‡†åŒ–ï¼Œæ˜¯å¯¹åŸå§‹æ•°æ®çš„çº¿æ€§å˜æ¢ï¼Œä½¿ç»“æœå€¼æ˜ å°„åˆ°[0 - 1]ä¹‹é—´ã€‚</span></span><br><span class="line">        <span class="comment"># å…ˆè®¾å®šæœ€å¤§å€¼ä¸æœ€å°å€¼å‡ä¸ºç³»ç»Ÿå­˜å‚¨çš„æœ€å¤§å€¼å’Œæœ€å°å€¼</span></span><br><span class="line">        (min_rank, max_rank) = (sys.float_info[<span class="number">0</span>], sys.float_info[<span class="number">3</span>])</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> nodeweight_dict.values():</span><br><span class="line">            <span class="keyword">if</span> w &lt; min_rank:</span><br><span class="line">                min_rank = w</span><br><span class="line">            <span class="keyword">if</span> w &gt; max_rank:</span><br><span class="line">                max_rank = w</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> n, w <span class="keyword">in</span> nodeweight_dict.items(): <span class="comment"># å½’ä¸€åŒ–</span></span><br><span class="line">            nodeweight_dict[n] = (w - min_rank / <span class="number">10.0</span>) / (max_rank - min_rank / <span class="number">10.0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> nodeweight_dict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextRank</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.candi_pos = [<span class="string">'n'</span>, <span class="string">'v'</span>, <span class="string">'a'</span>] <span class="comment"># å…³é”®è¯çš„è¯æ€§ï¼šåè¯ï¼ŒåŠ¨è¯ï¼Œå½¢å®¹è¯</span></span><br><span class="line">        self.span = <span class="number">5</span> <span class="comment"># çª—å£å¤§å°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_keywords</span><span class="params">(self, text, num_keywords)</span>:</span></span><br><span class="line">        g = textrank_graph()</span><br><span class="line">        cm = defaultdict(int)</span><br><span class="line">        word_list = [[word.word, word.flag] <span class="keyword">for</span> word <span class="keyword">in</span> pseg.cut(text)] <span class="comment"># ä½¿ç”¨jiebaåˆ†è¯å¹¶ä¸”å¯¹è¯æ€§è¿›è¡Œæ ‡æ³¨</span></span><br><span class="line">        <span class="keyword">for</span> i, word <span class="keyword">in</span> enumerate(word_list): <span class="comment"># è¯¥å¾ªç¯ç”¨äºç»Ÿè®¡åœ¨çª—å£èŒƒå›´å†…ï¼Œè¯çš„å…±ç°æ¬¡æ•°</span></span><br><span class="line">            <span class="keyword">if</span> word[<span class="number">1</span>][<span class="number">0</span>] <span class="keyword">in</span> self.candi_pos <span class="keyword">and</span> len(word[<span class="number">0</span>]) &gt; <span class="number">1</span>: <span class="comment">#</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(i + <span class="number">1</span>, i + self.span):</span><br><span class="line">                    <span class="keyword">if</span> j &gt;= len(word_list):<span class="comment"># é˜²æ­¢ä¸‹æ ‡è¶Šç•Œ</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    <span class="keyword">if</span> word_list[j][<span class="number">1</span>][<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> self.candi_pos <span class="keyword">or</span> len(word_list[j][<span class="number">0</span>]) &lt; <span class="number">2</span>: <span class="comment"># æ’é™¤è¯æ€§ä¸åœ¨å…³é”®è¯è¯æ€§åˆ—è¡¨ä¸­çš„è¯æˆ–è€…è¯é•¿åº¦å°äº2çš„è¯</span></span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    pair = tuple((word[<span class="number">0</span>], word_list[j][<span class="number">0</span>]))</span><br><span class="line">                    cm[(pair)] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> terms, w <span class="keyword">in</span> cm.items():</span><br><span class="line">            g.addEdge(terms[<span class="number">0</span>], terms[<span class="number">1</span>], w)</span><br><span class="line">        nodes_rank = g.rank()</span><br><span class="line">        nodes_rank = sorted(nodes_rank.items(), key=<span class="keyword">lambda</span> asd:asd[<span class="number">1</span>], reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> nodes_rank[:num_keywords]</span><br></pre></td></tr></table></figure>
<h2 id="LDA-Latent-Dirichlet-Allocation-æå–å…³é”®è¯"><a href="#LDA-Latent-Dirichlet-Allocation-æå–å…³é”®è¯" class="headerlink" title="LDA (Latent Dirichlet Allocation) æå–å…³é”®è¯"></a>LDA (Latent Dirichlet Allocation) æå–å…³é”®è¯</h2><h3 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>TF-IDF å’Œ TextRank ä¸¤ç§ç®—æ³•æ›´å¤šåæ˜ çš„æ˜¯æ–‡æœ¬çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå¯¹äºæ–‡æœ¬ä¹‹é—´çš„è¯­ä¹‰å…³ç³»è€ƒè™‘å¾—æ¯”è¾ƒå°‘ã€‚LDAæ˜¯ä¸€ç§èƒ½å¤Ÿä½“æ–‡æœ¬è¯­ä¹‰å…³ç³»çš„å…³é”®è¯æå–æ–¹æ³•ã€‚</p>
<blockquote>
<p>äºŒé¡¹åˆ†å¸ƒï¼ˆBinomial Distributionï¼‰ï¼Œå³é‡å¤næ¬¡çš„ä¼¯åŠªåˆ©è¯•éªŒï¼ˆBernoulli Experimentï¼‰ï¼Œç”¨$\xi$è¡¨ç¤ºéšæœºè¯•éªŒçš„ç»“æœã€‚å¦‚æœäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡æ˜¯P,åˆ™ä¸å‘ç”Ÿçš„æ¦‚ç‡$q=1-p$ï¼Œ$N$æ¬¡ç‹¬ç«‹é‡å¤è¯•éªŒä¸­å‘ç”ŸKæ¬¡çš„æ¦‚ç‡æ˜¯$P(\xi=K)= C(n,k) <em> p^k </em> (1-p)^{n-k}$ï¼Œå…¶ä¸­$C(n, k) =\frac{n!}{(k!(n-k)!)}$. æœŸæœ›ï¼š$E(Î¾)=np$,æ–¹å·®ï¼š$D(Î¾)=npq$å…¶ä¸­$q=1-p$</p>
<p>å¤šé¡¹åˆ†å¸ƒï¼ˆMultinomial Distributionï¼‰ï¼šå¤šé¡¹å¼åˆ†å¸ƒæ˜¯äºŒé¡¹å¼åˆ†å¸ƒçš„æ¨å¹¿ã€‚äºŒé¡¹åˆ†å¸ƒçš„å…¸å‹ä¾‹å­æ˜¯æ‰”ç¡¬å¸ï¼Œç¡¬å¸æ­£é¢æœä¸Šæ¦‚ç‡ä¸ºp, é‡å¤æ‰”næ¬¡ç¡¬å¸ï¼Œkæ¬¡ä¸ºæ­£é¢çš„æ¦‚ç‡å³ä¸ºä¸€ä¸ªäºŒé¡¹åˆ†å¸ƒæ¦‚ç‡ã€‚æŠŠäºŒé¡¹åˆ†å¸ƒå…¬å¼æ¨å¹¿è‡³å¤šç§çŠ¶æ€ï¼Œå°±å¾—åˆ°äº†å¤šé¡¹åˆ†å¸ƒã€‚<br>æŸéšæœºå®éªŒå¦‚æœæœ‰kä¸ªå¯èƒ½ç»“å±€$A_1,A_2,\ldots,A_k$ï¼Œåˆ†åˆ«å°†ä»–ä»¬çš„å‡ºç°æ¬¡æ•°è®°ä¸ºéšæœºå˜é‡$X_1,X_2,\ldots,X_k$ï¼Œå®ƒä»¬çš„æ¦‚ç‡åˆ†å¸ƒåˆ†åˆ«æ˜¯$p_1,p_2,\ldots,p_k$é‚£ä¹ˆåœ¨$n$æ¬¡é‡‡æ ·çš„æ€»ç»“æœä¸­ï¼Œ$A_1$å‡ºç°$n_1$æ¬¡ã€$A_2$å‡ºç°$n_2$æ¬¡,$\dots$,$A_k$å‡ºç°$n_k$æ¬¡çš„è¿™ç§äº‹ä»¶çš„å‡ºç°æ¦‚ç‡$P$æœ‰ä¸‹é¢å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
P\left(X_{1}=n_{1}, \cdots, X_{k}=n_{k}\right)=\left\{\begin{array}{ll}
\frac{n !}{n_{1} ! \cdots n_{k} !} p_{1}^{n_{1}} \cdots p_{k}^{n_{k}} & , \sum_{i=1}^{k} n_{i}=n \\
0 & , \text { otherwise }
\end{array}\right.</script><p>Betaåˆ†å¸ƒä¸Dirichletåˆ†å¸ƒçš„å®šä¹‰åŸŸå‡ä¸º[0,1]ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œé€šå¸¸å°†ä¸¤è€…ä½œä¸ºæ¦‚ç‡çš„åˆ†å¸ƒï¼ŒBetaåˆ†å¸ƒæè¿°çš„æ˜¯å•å˜é‡åˆ†å¸ƒï¼ŒDirichletåˆ†å¸ƒæè¿°çš„æ˜¯å¤šå˜é‡åˆ†å¸ƒï¼Œå› æ­¤ï¼ŒBetaåˆ†å¸ƒå¯ä½œä¸ºäºŒé¡¹åˆ†å¸ƒçš„å…ˆéªŒæ¦‚ç‡ï¼ŒDirichletåˆ†å¸ƒå¯ä½œä¸ºå¤šé¡¹åˆ†å¸ƒçš„å…ˆéªŒæ¦‚ç‡ã€‚</p>
</blockquote>
<p>åœ¨ä¸»é¢˜æ¨¡å‹ä¸­ï¼Œä¸»é¢˜è¡¨ç¤ºä¸€ä¸ªæ¦‚å¿µï¼Œè¡¨ç°ä¸ºä¸€ç³»åˆ—ç›¸å…³çš„å•è¯ï¼Œæ˜¯è¿™äº›å•è¯çš„æ¡ä»¶æ¦‚ç‡ã€‚å½¢è±¡æ¥è¯´ï¼Œä¸»é¢˜å°±æ˜¯ä¸€ä¸ªæ¡¶ï¼Œé‡Œé¢è£…äº†å‡ºç°æ¦‚ç‡è¾ƒé«˜çš„å•è¯ï¼Œè¿™äº›å•è¯ä¸è¿™ä¸ªä¸»é¢˜æœ‰å¾ˆå¼ºçš„ç›¸å…³æ€§ã€‚</p>
<h3 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a>ç†è®º</h3><p>æ€æ ·æ‰èƒ½ç”Ÿæˆä¸»é¢˜ï¼Ÿå¯¹æ–‡ç« çš„ä¸»é¢˜åº”è¯¥æ€ä¹ˆåˆ†æï¼Ÿè¿™æ˜¯ä¸»é¢˜æ¨¡å‹è¦è§£å†³çš„é—®é¢˜ã€‚</p>
<p> é¦–å…ˆï¼Œå¯ä»¥ç”¨ç”Ÿæˆæ¨¡å‹æ¥çœ‹æ–‡æ¡£å’Œä¸»é¢˜è¿™ä¸¤ä»¶äº‹ã€‚æ‰€è°“ç”Ÿæˆæ¨¡å‹ï¼Œå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è®¤ä¸º<strong>ä¸€ç¯‡æ–‡ç« çš„æ¯ä¸ªè¯éƒ½æ˜¯é€šè¿‡â€œä»¥ä¸€å®šæ¦‚ç‡é€‰æ‹©äº†æŸä¸ªä¸»é¢˜ï¼Œå¹¶ä»è¿™ä¸ªä¸»é¢˜ä¸­ä»¥ä¸€å®šæ¦‚ç‡é€‰æ‹©æŸä¸ªè¯è¯­â€</strong>è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹å¾—åˆ°çš„ã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬è¦ç”Ÿæˆä¸€ç¯‡æ–‡æ¡£ï¼Œå®ƒé‡Œé¢çš„æ¯ä¸ªè¯è¯­å‡ºç°çš„æ¦‚ç‡ä¸ºï¼š</p>
<script type="math/tex; mode=display">
p(W|D) = \sum_T P(W|T)P(T|D)</script><p>å…¶ä¸­ï¼Œ$W$è¡¨ç¤ºè¯ï¼Œ$T$è¡¨ç¤ºä¸»é¢˜ï¼Œ$D$è¡¨ç¤ºæ–‡æ¡£ã€‚</p>
<p><img src="/2020/04/21/%E5%85%B3%E9%94%AE%E8%AF%8D%E6%8A%BD%E5%8F%96/lda.png" alt="avatar"></p>
<p>å…¶ä¸­â€æ–‡æ¡£-è¯è¯­â€çŸ©é˜µè¡¨ç¤ºæ¯ä¸ªå•è¯åœ¨æ¯ä¸ªæ–‡æ¡£ä¸­çš„è¯é¢‘ï¼Œå³å‡ºç°çš„æ¦‚ç‡ï¼›â€ä¸»é¢˜-è¯è¯­â€çŸ©é˜µè¡¨ç¤ºæ¯ä¸ªä¸»é¢˜ä¸­æ¯ä¸ªå•è¯çš„å‡ºç°æ¦‚ç‡ï¼›â€æ–‡æ¡£-ä¸»é¢˜â€çŸ©é˜µè¡¨ç¤ºæ¯ä¸ªä¸»é¢˜åœ¨æ¯ä¸ªæ–‡æ¡£ä¸­å‡ºç°çš„æ¦‚ç‡ã€‚</p>
<p>å•è¯å¯¹äºä¸»é¢˜çš„æ¦‚ç‡å’Œä¸»é¢˜å¯¹äºæ–‡æ¡£çš„æ¦‚ç‡ï¼Œå¯ä»¥é€šè¿‡Gibbsé‡‡æ ·æ³•ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼‰æ¥è¿›è¡Œæ¦‚ç‡çš„è®¡ç®—ã€‚</p>
<p>ä¸»é¢˜$T_k$ä¸‹å„ä¸ªè¯$W_i$çš„æƒé‡è®¡ç®—å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
P(W_i|T_k) = \frac{C_{ik}+\beta}{\sum_{i=1}^N{C_{ik}+N*\beta}} = \phi_i^{t=k}</script><p>å…¶ä¸­ï¼Œ$w_i$ï¼šè¡¨ç¤ºå•è¯é›†åˆä¸­çš„ä»»ä¸€å•è¯ã€‚$T_k$:è¡¨ç¤ºä¸»é¢˜é›†åˆä¸­ä»»ä¸€ä¸»é¢˜ã€‚$P(w_i|T_k)$:è¡¨ç¤ºåœ¨ä¸»é¢˜ä¸º$k$æ—¶ï¼Œå•è¯$i$å‡ºç°çš„æ¦‚ç‡ï¼Œå…¶ç®€è®°ä¸º$\phi_i^{t=k}$ï¼Œ$C_{ik}$:è¡¨ç¤ºè¯­æ–™åº“ä¸­å•è¯$i$è¢«èµ‹äºˆä¸»é¢˜$k$çš„æ¬¡æ•°ã€‚$N$:è¡¨ç¤ºè¯æ±‡è¡¨çš„å¤§å°ã€‚$\beta$ï¼šè¡¨ç¤ºè¶…å‚æ•°ã€‚</p>
<p>æ–‡æ¡£$D_m$ä¸‹å„ä¸ªè¯$T_k$çš„æƒé‡è®¡ç®—å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
P(T_k|D_m) = \frac{C_{km}+\alpha}{\sum^K_{k=1}C_{km}+K*\alpha}=\theta^m_{t=k}</script><p>å…¶ä¸­ï¼Œ$D_m$:è¡¨ç¤ºæ–‡æ¡£é›†åˆä¸­ä»»ä¸€æ–‡æ¡£ã€‚$T_k$:è¡¨ç¤ºä¸»é¢˜é›†åˆä¸­ä»»ä¸€ä¸»é¢˜ã€‚$P(T_k|D_m)$:è¡¨ç¤ºè¯­æ–™åº“ä¸­æ–‡æ¡£mä¸­å•è¯è¢«èµ‹äºˆä¸»é¢˜$k$çš„æ¬¡æ•°ã€‚$K$ï¼šè¡¨ç¤ºä¸»é¢˜çš„æ•°é‡ã€‚$\alpha$è¡¨ç¤ºè¶…å‚æ•°ã€‚</p>
<p>å¾—åˆ°äº†æŒ‡å®šæ–‡æ¡£ä¸‹æŸä¸»é¢˜å‡ºç°çš„æ¦‚ç‡ï¼Œä»¥åŠæŒ‡å®šä¸»é¢˜ä¸‹ã€æŸå•è¯å‡ºç°çš„æ¦‚ç‡ã€‚é‚£ä¹ˆç”±è”åˆæ¦‚ç‡åˆ†å¸ƒå¯ä»¥çŸ¥é“ï¼Œå¯¹äºæŒ‡å®šæ–‡æ¡£æŸå•è¯å‡ºç°çš„æ¦‚ç‡ï¼š</p>
<script type="math/tex; mode=display">
P(W_i|D_m) = \sum_{k=1}^K{\phi_i^{t=k}*\theta_{t=k}^m}</script><p>åŸºäºä¸Šè¿°å…¬å¼ï¼Œå¯ä»¥è®¡ç®—å‡ºå•è¯$i$å¯¹äºæ–‡æ¡£$m$çš„ä¸»é¢˜é‡è¦æ€§ã€‚</p>
<p>ä½†æ˜¯ç”±äºåœ¨LDAä¸»é¢˜æ¦‚ç‡æ¨¡å‹ä¸­ï¼Œæ‰€æœ‰çš„è¯æ±‡éƒ½ä¼šä»¥ä¸€å®šçš„æ¦‚ç‡å‡ºç°åœ¨æ¯ä¸ªä¸»é¢˜ï¼Œæ‰€ä»¥è¿™æ ·ä¼šå¯¼è‡´æœ€ç»ˆè®¡ç®—çš„å•è¯å¯¹äºæ–‡æ¡£çš„ä¸»é¢˜é‡è¦æ€§åŒºåˆ†åº¦å—å½±å“ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬ä¼šå°†å•è¯ç›¸å¯¹äºä¸»é¢˜æ¦‚ç‡å°äºä¸€å®šé˜ˆå€¼çš„æ¦‚ç‡ç½®ä¸º0.</p>
<h3 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ä¸»é¢˜æ¨¡å‹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TopicModel</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># ä¸‰ä¸ªä¼ å…¥å‚æ•°ï¼šå¤„ç†åçš„æ•°æ®é›†ï¼Œå…³é”®è¯æ•°é‡ï¼Œå…·ä½“æ¨¡å‹ï¼ˆLSIã€LDAï¼‰ï¼Œä¸»é¢˜æ•°é‡</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, doc_list, keyword_num, model=<span class="string">'LDA'</span>, num_topics=<span class="number">4</span>)</span>:</span></span><br><span class="line">        <span class="comment"># ä½¿ç”¨gensimçš„æ¥å£ï¼Œå°†æ–‡æœ¬è½¬ä¸ºå‘é‡åŒ–è¡¨ç¤º</span></span><br><span class="line">        <span class="comment"># å…ˆæ„å»ºè¯ç©ºé—´</span></span><br><span class="line">        self.dictionary = corpora.Dictionary(doc_list)</span><br><span class="line">        <span class="comment"># ä½¿ç”¨BOWæ¨¡å‹å‘é‡åŒ– (token_id,freq)</span></span><br><span class="line">        corpus = [self.dictionary.doc2bow(doc) <span class="keyword">for</span> doc <span class="keyword">in</span> doc_list]  <span class="comment"># (token_id,freq)</span></span><br><span class="line">        <span class="comment"># å¯¹æ¯ä¸ªè¯ï¼Œæ ¹æ®tf-idfè¿›è¡ŒåŠ æƒï¼Œå¾—åˆ°åŠ æƒåçš„å‘é‡è¡¨ç¤º</span></span><br><span class="line">        self.tfidf_model = models.TfidfModel(corpus)</span><br><span class="line">        self.tfidf_corpus = self.tfidf_model[corpus]</span><br><span class="line"></span><br><span class="line">        self.keyword_num = keyword_num</span><br><span class="line">        self.num_topics = num_topics</span><br><span class="line">        <span class="comment"># é€‰æ‹©åŠ è½½èƒ¡æ¨¡å‹</span></span><br><span class="line">        <span class="keyword">if</span> model == <span class="string">'LSI'</span>:</span><br><span class="line">            self.model = self.train_lsi()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.model = self.train_lda()</span><br><span class="line">        <span class="comment"># å¾—åˆ°æ•°æ®é›†çš„ä¸»é¢˜-è¯åˆ†å¸ƒ</span></span><br><span class="line">        word_dic = self.word_dictionary(doc_list)</span><br><span class="line">        self.wordtopic_dic = self.get_wordtopic(word_dic)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å‘é‡åŒ–</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">doc2bowvec</span><span class="params">(self, word_list)</span>:</span></span><br><span class="line">        vec_list = [<span class="number">1</span> <span class="keyword">if</span> word <span class="keyword">in</span> word_list <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> word <span class="keyword">in</span> self.dictionary]</span><br><span class="line">        print(<span class="string">"vec_list"</span>, vec_list)</span><br><span class="line">        <span class="keyword">return</span> vec_list</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯ç©ºé—´æ„å»ºæ–¹æ³•å’Œå‘é‡åŒ–æ–¹æ³•ï¼Œåœ¨æ²¡æœ‰gensimæ¥å£æ—¶çš„ä¸€èˆ¬å¤„ç†æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">word_dictionary</span><span class="params">(self, doc_list)</span>:</span></span><br><span class="line">        dictionary = []</span><br><span class="line">        <span class="comment"># 2åŠå˜1åŠç»“æ„</span></span><br><span class="line">        <span class="keyword">for</span> doc <span class="keyword">in</span> doc_list:</span><br><span class="line">            <span class="comment"># extend he append æ–¹æ³•æœ‰ä½•å¼‚åŒ å®¹æ˜“å‡ºé”™</span></span><br><span class="line">            dictionary.extend(doc)</span><br><span class="line"></span><br><span class="line">        dictionary = list(set(dictionary))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dictionary</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¾—åˆ°æ•°æ®é›†çš„ä¸»é¢˜ - è¯åˆ†å¸ƒ</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_wordtopic</span><span class="params">(self, word_dic)</span>:</span></span><br><span class="line">        wordtopic_dic = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> word_dic:</span><br><span class="line">            singlist = [word]</span><br><span class="line">            <span class="comment"># è®¡ç®—æ¯ä¸ªè¯èƒ¡åŠ æƒå‘é‡</span></span><br><span class="line">            word_corpus = self.tfidf_model[self.dictionary.doc2bow(singlist)]</span><br><span class="line">            <span class="comment"># è®¡ç®—æ¯ä¸ªè¯deä¸»é¢˜å‘é‡</span></span><br><span class="line">            word_topic = self.model[word_corpus]</span><br><span class="line">            wordtopic_dic[word] = word_topic</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wordtopic_dic</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train_lsi</span><span class="params">(self)</span>:</span></span><br><span class="line">        lsi = models.LsiModel(self.tfidf_corpus, id2word=self.dictionary, num_topics=self.num_topics)</span><br><span class="line">        <span class="keyword">return</span> lsi</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train_lda</span><span class="params">(self)</span>:</span></span><br><span class="line">        lda = models.LdaModel(self.tfidf_corpus, id2word=self.dictionary, num_topics=self.num_topics)</span><br><span class="line">        <span class="keyword">return</span> lda</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¡ç®—è¯çš„åˆ†å¸ƒå’Œæ–‡æ¡£çš„åˆ†å¸ƒçš„ç›¸ä¼¼åº¦ï¼Œå–ç›¸ä¼¼åº¦æœ€é«˜çš„keyword_numä¸ªè¯ä½œä¸ºå…³é”®è¯</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_simword</span><span class="params">(self, word_list)</span>:</span></span><br><span class="line">        <span class="comment"># æ–‡æ¡£çš„åŠ æƒå‘é‡</span></span><br><span class="line">        sentcorpus = self.tfidf_model[self.dictionary.doc2bow(word_list)]</span><br><span class="line">        <span class="comment"># æ–‡æ¡£ä¸»é¢˜ å‘é‡</span></span><br><span class="line">        senttopic = self.model[sentcorpus]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># senttopic [(0, 0.03457821), (1, 0.034260772), (2, 0.8970413), (3, 0.034119748)]</span></span><br><span class="line">        <span class="comment"># ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">calsim</span><span class="params">(l1, l2)</span>:</span></span><br><span class="line">            a, b, c = <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span></span><br><span class="line">            <span class="keyword">for</span> t1, t2 <span class="keyword">in</span> zip(l1, l2):</span><br><span class="line">                x1 = t1[<span class="number">1</span>]</span><br><span class="line">                x2 = t2[<span class="number">1</span>]</span><br><span class="line">                a += x1 * x1</span><br><span class="line">                b += x1 * x1</span><br><span class="line">                c += x2 * x2</span><br><span class="line">            sim = a / math.sqrt(b * c) <span class="keyword">if</span> <span class="keyword">not</span> (b * c) == <span class="number">0.0</span> <span class="keyword">else</span> <span class="number">0.0</span></span><br><span class="line">            <span class="keyword">return</span> sim</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—è¾“å…¥æ–‡æœ¬å’Œæ¯ä¸ªè¯çš„ä¸»é¢˜åˆ†å¸ƒç›¸ä¼¼åº¦</span></span><br><span class="line">        sim_dic = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> self.wordtopic_dic.items():</span><br><span class="line">            <span class="comment"># è¿˜æ˜¯è®¡ç®—æ¯ä¸ªå†æœ¬æ–‡æ¡£ä¸­çš„è¯  å’Œæ–‡æ¡£çš„ç›¸è¯†åº¦</span></span><br><span class="line">            <span class="keyword">if</span> k <span class="keyword">not</span> <span class="keyword">in</span> word_list:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment">#</span></span><br><span class="line">            sim = calsim(v, senttopic)</span><br><span class="line">            sim_dic[k] = sim</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> sorted(sim_dic.items(), key=<span class="keyword">lambda</span> item:item[<span class="number">1</span>], reverse=<span class="literal">True</span>)[:self.keyword_num]:</span><br><span class="line">            print(k, v)</span><br><span class="line">        print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">topic_extract</span><span class="params">(word_list, model, pos=False, keyword_num=<span class="number">10</span>)</span>:</span></span><br><span class="line">    doc_list = load_data(pos)</span><br><span class="line">    topic_model = TopicModel(doc_list, keyword_num, model=model)</span><br><span class="line">    topic_model.get_simword(word_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">textrank_extract</span><span class="params">(text, pos=False, keyword_num=<span class="number">10</span>)</span>:</span></span><br><span class="line">    textrank = analyse.textrank</span><br><span class="line">    keywords = textrank(text, keyword_num)</span><br><span class="line">    <span class="comment"># è¾“å‡ºæŠ½å–å‡ºçš„å…³é”®è¯</span></span><br><span class="line">    <span class="keyword">for</span> keyword <span class="keyword">in</span> keywords:</span><br><span class="line">        print(keyword + <span class="string">"/ "</span>, end=<span class="string">''</span>)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    text = <span class="string">'6æœˆ19æ—¥,ã€Š2012å¹´åº¦â€œä¸­å›½çˆ±å¿ƒåŸå¸‚â€å…¬ç›Šæ´»åŠ¨æ–°é—»å‘å¸ƒä¼šã€‹åœ¨äº¬ä¸¾è¡Œã€‚'</span> + \</span><br><span class="line">           <span class="string">'ä¸­åç¤¾ä¼šæ•‘åŠ©åŸºé‡‘ä¼šç†äº‹é•¿è®¸å˜‰ç’åˆ°ä¼šè®²è¯ã€‚åŸºé‡‘ä¼šé«˜çº§é¡¾é—®æœ±å‘å¿ ,å…¨å›½è€é¾„'</span> + \</span><br><span class="line">           <span class="string">'åŠå‰¯ä¸»ä»»æœ±å‹‡,æ°‘æ”¿éƒ¨ç¤¾ä¼šæ•‘åŠ©å¸åŠ©ç†å·¡è§†å‘˜å‘¨è,ä¸­åç¤¾ä¼šæ•‘åŠ©åŸºé‡‘ä¼šå‰¯ç†äº‹é•¿è€¿å¿—è¿œ,'</span> + \</span><br><span class="line">           <span class="string">'é‡åº†å¸‚æ°‘æ”¿å±€å·¡è§†å‘˜è°­æ˜æ”¿ã€‚æ™‹æ±Ÿå¸‚äººå¤§å¸¸å§”ä¼šä¸»ä»»é™ˆå¥å€©,ä»¥åŠ10ä½™ä¸ªçœã€å¸‚ã€è‡ªæ²»åŒºæ°‘æ”¿å±€'</span> + \</span><br><span class="line">           <span class="string">'é¢†å¯¼åŠå››åå¤šå®¶åª’ä½“å‚åŠ äº†å‘å¸ƒä¼šã€‚îŒä¸­åç¤¾ä¼šæ•‘åŠ©åŸºé‡‘ä¼šç§˜ä¹¦é•¿æ—¶æ­£æ–°ä»‹ç»æœ¬å¹´åº¦â€œä¸­å›½çˆ±å¿ƒåŸ'</span> + \</span><br><span class="line">           <span class="string">'å¸‚â€å…¬ç›Šæ´»åŠ¨å°†ä»¥â€œçˆ±å¿ƒåŸå¸‚å®£ä¼ ã€å­¤è€å…³çˆ±æ•‘åŠ©é¡¹ç›®åŠç¬¬äºŒå±Šä¸­å›½çˆ±å¿ƒåŸå¸‚å¤§ä¼šâ€ä¸ºä¸»è¦å†…å®¹,é‡åº†å¸‚'</span> + \</span><br><span class="line">           <span class="string">'ã€å‘¼å’Œæµ©ç‰¹å¸‚ã€é•¿æ²™å¸‚ã€å¤ªåŸå¸‚ã€èšŒåŸ å¸‚ã€å—æ˜Œå¸‚ã€æ±•å¤´å¸‚ã€æ²§å·å¸‚ã€æ™‹æ±Ÿå¸‚åŠéµåŒ–å¸‚å°†ä¼šç§¯æå‚åŠ '</span> + \</span><br><span class="line">           <span class="string">'è¿™ä¸€å…¬ç›Šæ´»åŠ¨ã€‚îŒä¸­å›½é›…è™å‰¯æ€»ç¼–å¼ é“¶ç”Ÿå’Œå‡¤å‡°ç½‘åŸå¸‚é¢‘é“æ€»ç›‘èµµè€€åˆ†åˆ«ä»¥å„è‡ªåª’ä½“ä¼˜åŠ¿ä»‹ç»äº†æ´»åŠ¨'</span> + \</span><br><span class="line">           <span class="string">'çš„å®£ä¼ æ–¹æ¡ˆã€‚îŒä¼šä¸Š,ä¸­åç¤¾ä¼šæ•‘åŠ©åŸºé‡‘ä¼šä¸â€œç¬¬äºŒå±Šä¸­å›½çˆ±å¿ƒåŸå¸‚å¤§ä¼šâ€æ‰¿åŠæ–¹æ™‹æ±Ÿå¸‚ç­¾çº¦,è®¸å˜‰ç’ç†'</span> + \</span><br><span class="line">           <span class="string">'äº‹é•¿æ¥å—æ™‹æ±Ÿå¸‚å‚ä¸â€œç™¾ä¸‡å­¤è€å…³çˆ±è¡ŒåŠ¨â€å‘å›½å®¶é‡ç‚¹æ‰¶è´«åœ°åŒºæèµ çš„ä»·å€¼400ä¸‡å…ƒçš„æ¬¾ç‰©ã€‚æ™‹æ±Ÿå¸‚äººå¤§'</span> + \</span><br><span class="line">           <span class="string">'å¸¸å§”ä¼šä¸»ä»»é™ˆå¥å€©ä»‹ç»äº†å¤§ä¼šçš„ç­¹å¤‡æƒ…å†µã€‚'</span></span><br><span class="line"></span><br><span class="line">    pos = <span class="literal">False</span></span><br><span class="line">    seg_list = seg_to_list(text, pos)</span><br><span class="line">    filter_list = word_filter(seg_list, pos)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'LDAæ¨¡å‹ç»“æœï¼š'</span>)</span><br><span class="line">    topic_extract(filter_list, <span class="string">'LDA'</span>, pos)</span><br></pre></td></tr></table></figure>
<h4 id="LDA-æ­¥éª¤æ€»ç»“"><a href="#LDA-æ­¥éª¤æ€»ç»“" class="headerlink" title="LDA æ­¥éª¤æ€»ç»“"></a>LDA æ­¥éª¤æ€»ç»“</h4><p>æ•°æ®é›†å¤„ç†</p>
<ol>
<li>å…ˆæ„å»ºè¯ç©ºé—´  Dictionary(4064 unique tokens: [â€˜ä¸Šå°†â€™, â€˜ä¸“é—¨â€™, â€˜ä¹˜å®¢â€™, â€˜ä»ªå¼â€™, â€˜ä½“éªŒâ€™]â€¦)</li>
<li>ä½¿ç”¨BOWæ¨¡å‹å‘é‡åŒ–   corpus [[(0, 1), (1, 1), (2, 2), (3, 1),ã€‚ã€‚</li>
<li>å¯¹æ¯ä¸ªè¯ï¼Œæ ¹æ®tf-idfè¿›è¡ŒåŠ æƒï¼Œå¾—åˆ°åŠ æƒåçš„å‘é‡è¡¨ç¤º</li>
</ol>
<p>æ ¹æ®æ•°æ®é›†è·å¾—æ¨¡å‹</p>
<ol>
<li>å¾—åˆ°æ•°æ®é›†çš„ä¸»é¢˜-è¯åˆ†å¸ƒ  model (å¾—åˆ°æ¯ä¸ªè¯çš„å‘é‡ï¼‰ï¼ˆæ–‡æ¡£è½¬åˆ—è¡¨ å†è½¬é›†åˆå»é‡ï¼Œå†è½¬åˆ—è¡¨ï¼‰{â€˜ç™½è¡€ç—…â€™: [(0, 0.1273009), (1, 0.6181468), (2, 0.12732704), (3, 0.12722531)], â€˜å©´å„¿â€™: [ã€‚ã€‚ã€‚</li>
<li>æ±‚æ–‡æ¡£çš„åˆ†å¸ƒ:è¯ã€‹å‘é‡ã€‹tf/idfåŠ æƒã€‹åŒç¬¬4æ­¥å¾—åˆ°æ–‡æ¡£çš„åˆ†å¸ƒå‘é‡ [(0, 0.033984687), (1, 0.033736005), (2, 0.8978361), (3, 0.03444325)]</li>
<li>è®¡ç®—ä½™å¼¦è·ç¦»å¾—åˆ°ç»“æœ</li>
</ol>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol>
<li><p>ä¸ºä»€ä¹ˆè¦ç”¨æµ…å±‚è¯­ä¹‰åˆ†æï¼Ÿ</p>
<p>æˆ‘è§‰ç€ä¸€æ–¹é¢æ˜¯è€ƒè™‘æ–‡æœ¬çš„è¯­ä¹‰ä¿¡æ¯ã€‚è¿˜æœ‰å°±æ˜¯ç”¨è¯è¢‹æ¨¡å‹æ‰€è¡¨ç¤ºçš„å•è¯-æ–‡æœ¬çŸ©é˜µä¸€æ–¹é¢å­˜åœ¨æ•°æ®ç¨€ç–çš„é—®é¢˜ï¼Œå¦ä¸€æ–¹é¢å°±æ˜¯è¯æœ¬èº«ä¸€è¯å¤šä¹‰å’Œå¤šè¯ä¸€ä¹‰ç°è±¡åœ¨è¿›è¡Œæ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—çš„æ—¶å€™æœªå¿…èƒ½å¤Ÿå‡†ç¡®çš„è¡¨è¾¾ä¸¤ä¸ªæ–‡æœ¬çš„è¯­ä¹‰ç›¸ä¼¼åº¦ã€‚</p>
</li>
<li><p>æ½œåœ¨è¯­ä¹‰åˆ†æç®—æ³•</p>
<ol>
<li>çŸ©é˜µå¥‡å¼‚å€¼åˆ†è§£ç®—æ³•</li>
<li>éè´ŸçŸ©é˜µåˆ†è§£ç®—æ³•</li>
</ol>
</li>
</ol>
<p><a href="https://github.com/jeffery0628/keyword_extraction" target="_blank" rel="noopener">github ä»£ç </a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="https://www.cnblogs.com/jpcflyer/p/11180263.html" target="_blank" rel="noopener">æœºå™¨å­¦ä¹ ç»å…¸ç®—æ³•ä¹‹PageRank</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/41091116" target="_blank" rel="noopener">é€šä¿—æ˜“æ‡‚ç†è§£â€”â€”TF-IDFä¸TextRank</a></li>
</ol>
]]></content>
      <categories>
        <category>è‡ªç„¶è¯­è¨€å¤„ç†åŸºç¡€</category>
      </categories>
  </entry>
  <entry>
    <title>bertç³»åˆ—</title>
    <url>/2020/04/13/bert%E7%B3%BB%E5%88%97/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="BERT-åŠå…¶åç»­æ¨¡å‹"><a href="#BERT-åŠå…¶åç»­æ¨¡å‹" class="headerlink" title="BERT åŠå…¶åç»­æ¨¡å‹"></a>BERT åŠå…¶åç»­æ¨¡å‹</h2><p>äº†è§£è¿™äº›åç»­çš„æ¨¡å‹ï¼Œæ–¹ä¾¿åœ¨åç»­çš„ç ”ç©¶å’Œåº”ç”¨ä¸­æ¥æ›´å¥½çš„é€‰æ‹©æ¨¡å‹ã€‚</p>
<h3 id="BERT"><a href="#BERT" class="headerlink" title="BERT"></a>BERT</h3><p>BERTæ¨¡å‹çš„ä¸»è¦åˆ›æ–°ç‚¹éƒ½åœ¨pre-trainæ–¹æ³•ä¸Šï¼Œå³ç”¨äº†Masked LMå’ŒNext Sentence Predictionä¸¤ç§æ–¹æ³•åˆ†åˆ«æ•æ‰è¯è¯­å’Œå¥å­çº§åˆ«çš„representationã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert.jpg" alt="avatar"></p>
<p>å¯¹æ¯”OpenAI GPT(Generative pre-trained transformer)ï¼ŒBERTæ˜¯åŒå‘çš„Transformer blockè¿æ¥ï¼›å°±åƒå•å‘rnnå’ŒåŒå‘rnnçš„åŒºåˆ«ï¼Œç›´è§‰ä¸Šæ¥è®²æ•ˆæœä¼šå¥½ä¸€äº›ã€‚</p>
<p>å¯¹æ¯”ELMoï¼Œè™½ç„¶éƒ½æ˜¯â€œåŒå‘â€ï¼Œä½†ç›®æ ‡å‡½æ•°å…¶å®æ˜¯ä¸åŒçš„ã€‚ELMoæ˜¯åˆ†åˆ«ä»¥ $P(w_i|w_1,\cdots,w_{i-1})$ å’Œ$P(w_i|w_{i+1},\cdots,w_n)$ä½œä¸ºç›®æ ‡å‡½æ•°ï¼Œç‹¬ç«‹è®­ç»ƒå¤„ä¸¤ä¸ªrepresentationç„¶åæ‹¼æ¥ï¼Œè€ŒBERTåˆ™æ˜¯ä»¥$P(w_i|w_1,\cdots,w_{i-1},w_{i+1}\cdots,w_n)$  ä½œä¸ºç›®æ ‡å‡½æ•°è®­ç»ƒLMã€‚</p>
<a id="more"></a>
<h4 id="Task-1-MLM"><a href="#Task-1-MLM" class="headerlink" title="Task 1: MLM"></a>Task 1: MLM</h4><p>ç”±äºBERTéœ€è¦é€šè¿‡ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¥é¢„æµ‹ä¸­å¿ƒè¯çš„ä¿¡æ¯ï¼ŒåŒæ—¶åˆä¸å¸Œæœ›æ¨¡å‹æå‰çœ‹è§ä¸­å¿ƒè¯çš„ä¿¡æ¯ï¼Œå› æ­¤æå‡ºäº†ä¸€ç§ Masked Language Model çš„é¢„è®­ç»ƒæ–¹å¼ï¼Œå³éšæœºä»è¾“å…¥é¢„æ–™ä¸Š mask æ‰ä¸€äº›å•è¯ï¼Œç„¶åé€šè¿‡çš„ä¸Šä¸‹æ–‡é¢„æµ‹è¯¥å•è¯ï¼Œç±»ä¼¼äºä¸€ä¸ªå®Œå½¢å¡«ç©ºä»»åŠ¡ã€‚</p>
<p>åœ¨é¢„è®­ç»ƒä»»åŠ¡ä¸­ï¼Œ15%çš„ Word Piece ä¼šè¢«maskï¼Œè¿™15%çš„ Word Piece ä¸­ï¼Œ80%çš„æ—¶å€™ä¼šç›´æ¥æ›¿æ¢ä¸º [Mask] ï¼Œ10%çš„æ—¶å€™å°†å…¶æ›¿æ¢ä¸ºå…¶å®ƒä»»æ„å•è¯ï¼Œ10%çš„æ—¶å€™ä¼šä¿ç•™åŸå§‹Token</p>
<ul>
<li>æ²¡æœ‰100%maskçš„åŸå› <ul>
<li>å¦‚æœå¥å­ä¸­çš„æŸä¸ªToken100%éƒ½ä¼šè¢«maskæ‰ï¼Œé‚£ä¹ˆåœ¨fine-tuningçš„æ—¶å€™æ¨¡å‹å°±ä¼šæœ‰ä¸€äº›æ²¡æœ‰è§è¿‡çš„å•è¯</li>
</ul>
</li>
<li>åŠ å…¥10%éšæœºtokençš„åŸå› <ul>
<li>Transformerè¦ä¿æŒå¯¹æ¯ä¸ªè¾“å…¥tokençš„åˆ†å¸ƒå¼è¡¨å¾ï¼Œå¦åˆ™æ¨¡å‹å°±ä¼šè®°ä½è¿™ä¸ª[mask]æ˜¯token â€™hairyâ€˜</li>
<li>å¦å¤–ç¼–ç å™¨ä¸çŸ¥é“å“ªäº›è¯éœ€è¦é¢„æµ‹çš„ï¼Œå“ªäº›è¯æ˜¯é”™è¯¯çš„ï¼Œå› æ­¤è¢«è¿«éœ€è¦å­¦ä¹ æ¯ä¸€ä¸ªtokençš„è¡¨ç¤ºå‘é‡</li>
</ul>
</li>
<li>å¦å¤–ï¼Œæ¯ä¸ªbatchsizeåªæœ‰15%çš„å•è¯è¢«maskçš„åŸå› ï¼Œæ˜¯å› ä¸ºæ€§èƒ½å¼€é”€çš„é—®é¢˜ï¼ŒåŒå‘ç¼–ç å™¨æ¯”å•é¡¹ç¼–ç å™¨è®­ç»ƒè¦æ›´æ…¢</li>
</ul>
<h4 id="Task-2-NSP"><a href="#Task-2-NSP" class="headerlink" title="Task 2: NSP"></a>Task 2: NSP</h4><p>ä»…ä»…ä¸€ä¸ªMLMä»»åŠ¡æ˜¯ä¸è¶³ä»¥è®© BERT è§£å†³é˜…è¯»ç†è§£ç­‰å¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡çš„ï¼Œå› æ­¤æ·»åŠ äº†é¢å¤–çš„ä¸€ä¸ªé¢„è®­ç»ƒä»»åŠ¡ï¼Œå³ Next Sequence Predictionã€‚</p>
<p>å…·ä½“ä»»åŠ¡å³ä¸ºä¸€ä¸ªå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡ï¼Œå³åˆ¤æ–­å¥å­Bæ˜¯å¦æ˜¯å¥å­Açš„ä¸‹æ–‡ï¼Œå¦‚æœæ˜¯çš„è¯è¾“å‡ºâ€™IsNextâ€˜ï¼Œå¦åˆ™è¾“å‡ºâ€™NotNextâ€˜ã€‚</p>
<p>è®­ç»ƒæ•°æ®çš„ç”Ÿæˆæ–¹å¼æ˜¯ä»å¹³è¡Œè¯­æ–™ä¸­éšæœºæŠ½å–çš„è¿ç»­ä¸¤å¥è¯ï¼Œå…¶ä¸­50%ä¿ç•™æŠ½å–çš„ä¸¤å¥è¯ï¼Œå®ƒä»¬ç¬¦åˆIsNextå…³ç³»ï¼Œå¦å¤–50%çš„ç¬¬äºŒå¥è¯æ˜¯éšæœºä»é¢„æ–™ä¸­æå–çš„ï¼Œå®ƒä»¬çš„å…³ç³»æ˜¯NotNextçš„ã€‚è¿™ä¸ªå…³ç³»ä¿å­˜åœ¨å›¾4ä¸­çš„[CLS]ç¬¦å·ä¸­.</p>
<h4 id="è¾“å…¥"><a href="#è¾“å…¥" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert_input.jpg" alt="avatar"></p>
<ul>
<li>Token Embeddingsï¼šå³ä¼ ç»Ÿçš„è¯å‘é‡å±‚ï¼Œæ¯ä¸ªè¾“å…¥æ ·æœ¬çš„é¦–å­—ç¬¦éœ€è¦è®¾ç½®ä¸º[CLS]ï¼Œå¯ä»¥ç”¨äºä¹‹åçš„åˆ†ç±»ä»»åŠ¡ï¼Œè‹¥æœ‰ä¸¤ä¸ªä¸åŒçš„å¥å­ï¼Œéœ€è¦ç”¨[SEP]åˆ†éš”ï¼Œä¸”æœ€åä¸€ä¸ªå­—ç¬¦éœ€è¦ç”¨[SEP]è¡¨ç¤ºç»ˆæ­¢</li>
<li>Segment Embeddingsï¼šä¸º[0,1]åºåˆ—ï¼Œç”¨æ¥åœ¨NSPä»»åŠ¡ä¸­åŒºåˆ«ä¸¤ä¸ªå¥å­ï¼Œä¾¿äºåšå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡</li>
<li>Position Embeddingsï¼šä¸Transformerä¸­çš„ä½ç½®å‘é‡ä¸åŒï¼ŒBERTä¸­çš„ä½ç½®å‘é‡æ˜¯ç›´æ¥è®­ç»ƒå‡ºæ¥çš„</li>
</ul>
<h4 id="Fine-tunninng"><a href="#Fine-tunninng" class="headerlink" title="Fine-tunninng"></a>Fine-tunninng</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert_finetune.jpg" alt="avatar"></p>
<p>å¯¹äºä¸åŒçš„ä¸‹æ¸¸ä»»åŠ¡ï¼Œæˆ‘ä»¬ä»…éœ€è¦å¯¹BERTä¸åŒä½ç½®çš„è¾“å‡ºè¿›è¡Œå¤„ç†å³å¯ï¼Œæˆ–è€…ç›´æ¥å°†BERTä¸åŒä½ç½®çš„è¾“å‡ºç›´æ¥è¾“å…¥åˆ°ä¸‹æ¸¸æ¨¡å‹å½“ä¸­ã€‚å…·ä½“çš„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>å¯¹äºæƒ…æ„Ÿåˆ†æç­‰å•å¥åˆ†ç±»ä»»åŠ¡ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥å•ä¸ªå¥å­ï¼ˆä¸éœ€è¦[SEP]åˆ†éš”åŒå¥ï¼‰ï¼Œå°†[CLS]çš„è¾“å‡ºç›´æ¥è¾“å…¥åˆ°åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»</li>
<li>å¯¹äºå¥å­å¯¹ä»»åŠ¡ï¼ˆå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡ï¼‰ï¼Œéœ€è¦ç”¨[SEP]åˆ†éš”ä¸¤ä¸ªå¥å­è¾“å…¥åˆ°æ¨¡å‹ä¸­ï¼Œç„¶ååŒæ ·ä»…é¡»å°†[CLS]çš„è¾“å‡ºé€åˆ°åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»</li>
<li>å¯¹äºé—®ç­”ä»»åŠ¡ï¼Œå°†é—®é¢˜ä¸ç­”æ¡ˆæ‹¼æ¥è¾“å…¥åˆ°BERTæ¨¡å‹ä¸­ï¼Œç„¶åå°†ç­”æ¡ˆä½ç½®çš„è¾“å‡ºå‘é‡è¿›è¡ŒäºŒåˆ†ç±»å¹¶åœ¨å¥å­æ–¹å‘ä¸Šè¿›è¡Œsoftmaxï¼ˆåªéœ€é¢„æµ‹å¼€å§‹å’Œç»“æŸä½ç½®å³å¯ï¼‰</li>
<li>å¯¹äºå‘½åå®ä½“è¯†åˆ«ä»»åŠ¡ï¼Œå¯¹æ¯ä¸ªä½ç½®çš„è¾“å‡ºè¿›è¡Œåˆ†ç±»å³å¯ï¼Œå¦‚æœå°†æ¯ä¸ªä½ç½®çš„è¾“å‡ºä½œä¸ºç‰¹å¾è¾“å…¥åˆ°CRFå°†å–å¾—æ›´å¥½çš„æ•ˆæœã€‚</li>
</ul>
<h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><ul>
<li>è€ƒè™‘åŒå‘ä¿¡æ¯ï¼ˆä¸Šä¸‹æ–‡ä¿¡æ¯ï¼‰</li>
<li>ä¸ç”¨è€ƒè™‘å¾ˆé•¿çš„æ—¶åºé—®é¢˜ï¼ˆæ¢¯åº¦å¼¥æ•£ï¼Œæ¢¯åº¦çˆ†ç‚¸ï¼‰ï¼šlong-term dependency</li>
</ul>
<h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ul>
<li>BERTçš„é¢„è®­ç»ƒä»»åŠ¡MLMä½¿å¾—èƒ½å¤Ÿå€ŸåŠ©ä¸Šä¸‹æ–‡å¯¹åºåˆ—è¿›è¡Œç¼–ç ï¼Œä½†åŒæ—¶ä¹Ÿä½¿å¾—å…¶é¢„è®­ç»ƒè¿‡ç¨‹ä¸ä¸­çš„æ•°æ®ä¸å¾®è°ƒçš„æ•°æ®ä¸åŒ¹é…ï¼Œéš¾ä»¥é€‚åº”ç”Ÿæˆå¼ä»»åŠ¡(è®­ç»ƒæ•°æ®ç¼ºä¹mask)</li>
<li>ç¼ºä¹ç”Ÿæˆèƒ½åŠ›</li>
<li>å¦å¤–ï¼ŒBERTæ²¡æœ‰è€ƒè™‘é¢„æµ‹[MASK]ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œæ˜¯å¯¹è¯­è¨€æ¨¡å‹è”åˆæ¦‚ç‡çš„æœ‰åä¼°è®¡ã€‚ï¼ˆæœ´ç´ è´å¶æ–¯ï¼Œnaiveï¼‰</li>
<li>ç”±äºæœ€å¤§è¾“å…¥é•¿åº¦çš„é™åˆ¶ï¼Œé€‚åˆå¥å­å’Œæ®µè½çº§åˆ«çš„ä»»åŠ¡ï¼Œä¸é€‚ç”¨äºæ–‡æ¡£çº§åˆ«çš„ä»»åŠ¡ï¼ˆå¦‚é•¿æ–‡æœ¬åˆ†ç±»ï¼‰</li>
<li>é€‚åˆå¤„ç†è‡ªç„¶è¯­ä¹‰ç†è§£ç±»ä»»åŠ¡(NLU)ï¼Œè€Œä¸é€‚åˆè‡ªç„¶è¯­è¨€ç”Ÿæˆç±»ä»»åŠ¡(NLG)</li>
</ul>
<h4 id="torchä½¿ç”¨"><a href="#torchä½¿ç”¨" class="headerlink" title="torchä½¿ç”¨"></a>torchä½¿ç”¨</h4><ol>
<li>å¯¼å…¥ç›¸å…³åº“</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> transformers <span class="keyword">as</span> ppb <span class="comment"># pytorch transformers</span></span><br></pre></td></tr></table></figure>
<ol>
<li>å¯¼å…¥é¢„è®­ç»ƒå¥½çš„ DistilBERT æ¨¡å‹ä¸åˆ†è¯å™¨</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">model_class, tokenizer_class, pretrained_weights = (ppb.DistilBertModel, ppb.DistilBertTokenizer, <span class="string">'distilbert-base-uncased'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Want BERT instead of distilBERT? Uncomment the following line:</span></span><br><span class="line"><span class="comment">#model_class, tokenizer_class, pretrained_weights = (ppb.BertModel, ppb.BertTokenizer, 'bert-base-uncased')# </span></span><br><span class="line"></span><br><span class="line">Load pretrained model/tokenizertokenizer = tokenizer_class.from_pretrained(pretrained_weights)</span><br><span class="line">model = model_class.from_pretrained(pretrained_weights)</span><br></pre></td></tr></table></figure>
<ol>
<li>tokenizeï¼šåˆ†è¯+[cls]+[sep]<br><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert_tokenize.png" alt="avatar"></li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tokenizer.encode(<span class="string">'a visually stunning rumination on love'</span>, add_special_tokens=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>padding</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">max_len = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tokenized.values:</span><br><span class="line"> <span class="keyword">if</span> len(i) &gt; max_len:</span><br><span class="line">     max_len = len(i)</span><br><span class="line">padded = np.array([i + [<span class="number">0</span>]*(max_len-len(i)) <span class="keyword">for</span> i <span class="keyword">in</span> tokenized.values])</span><br></pre></td></tr></table></figure>
<ol>
<li>masking</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">attention_mask = np.where(padded != <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>ä½¿ç”¨bertè¿›è¡Œç¼–ç </li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    <span class="comment"># last_hidden_states = [batch_size, max_sentence_len, 768]</span></span><br><span class="line">    last_hidden_states = model(input_ids, attention_mask=attention_mask)</span><br></pre></td></tr></table></figure>
<p><a href="http://fancyerii.github.io/2019/03/09/bert-codes/#dataprocessor" target="_blank" rel="noopener">bertä»£ç é˜…è¯»</a></p>
<hr>
<p>è°·æ­Œå¯¹BERTè¿›è¡Œäº†æ”¹ç‰ˆï¼Œä¸‹é¢å°†å¯¹æ”¹ç‰ˆåçš„bertè¿›è¡Œå­¦ä¹ ï¼Œå¯¹æ¯”æ”¹ç‰ˆå‰åä¸»è¦çš„ç›¸ä¼¼ç‚¹å’Œä¸åŒç‚¹ï¼Œä»¥ä¾¿å¯ä»¥é€‰æ‹©åœ¨ç ”ç©¶æˆ–åº”ç”¨ä¸­ä½¿ç”¨å“ªä¸€ç§ã€‚æå‡ºçš„å‡ ç§æ–¹æ³•æ”¹è¿›BERTçš„é¢„æµ‹æŒ‡æ ‡æˆ–è®¡ç®—é€Ÿåº¦ï¼Œä½†æ˜¯å§‹ç»ˆè¾¾ä¸åˆ°ä¸¤è€…å…¼é¡¾ã€‚<strong>XLNetå’ŒRoBERTaæ”¹å–„äº†æ€§èƒ½ï¼Œè€ŒDistilBERTæé«˜äº†æ¨ç†é€Ÿåº¦</strong>ã€‚</p>
<h3 id="BERT-WWM"><a href="#BERT-WWM" class="headerlink" title="BERT-WWM"></a><strong>BERT-WWM</strong></h3><p><a href>è®ºæ–‡</a></p>
<h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>wwm å³ Whole Word Maskingï¼ˆå¯¹å…¨è¯è¿›è¡ŒMaskï¼‰ã€‚ç›¸æ¯”äºbertçš„æ”¹è¿›æ˜¯ç”¨Maskæ ‡ç­¾æ›¿æ¢ä¸€ä¸ªå®Œæ•´çš„è¯è€Œä¸æ˜¯å­—ï¼Œä¸­æ–‡å’Œè‹±æ–‡ä¸åŒï¼Œè‹±æ–‡æœ€å°çš„tokenæ˜¯ä¸€ä¸ªå•è¯ï¼Œè€Œä¸­æ–‡ä¸­æœ€å°çš„tokenå´æ˜¯å­—ï¼Œè¯æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç»„æˆï¼Œä¸”æ¯ä¸ªè¯ä¹‹é—´æ²¡æœ‰æ˜æ˜¾çš„åˆ†å‰²ï¼ŒåŒ…å«æ›´å¤šä¿¡æ¯çš„æ˜¯è¯ï¼Œå¯¹å…¨è¯maskå°±æ˜¯å¯¹æ•´ä¸ªè¯éƒ½é€šè¿‡maskè¿›è¡Œæ©ç ã€‚<br><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert_wwm_exam.png" alt="avatar"></p>
<h4 id="Bert-wwm-ext"><a href="#Bert-wwm-ext" class="headerlink" title="Bert-wwm-ext"></a><strong>Bert-wwm-ext</strong></h4><p>å®ƒæ˜¯BERT-wwmçš„ä¸€ä¸ªå‡çº§ç‰ˆï¼Œç›¸æ¯”äºBERT-wwmçš„æ”¹è¿›æ˜¯å¢åŠ äº†è®­ç»ƒæ•°æ®é›†åŒæ—¶ä¹Ÿå¢åŠ äº†è®­ç»ƒæ­¥æ•°ã€‚<br>BERT-wwm-extä¸»è¦æ˜¯æœ‰ä¸¤ç‚¹æ”¹è¿›ï¼š<br>1ï¼‰é¢„è®­ç»ƒæ•°æ®é›†åšäº†å¢åŠ ï¼Œè¾¾åˆ°5.4Bï¼›<br>2ï¼‰è®­ç»ƒæ­¥æ•°å¢å¤§ï¼Œè®­ç»ƒç¬¬ä¸€é˜¶æ®µ1Mæ­¥ï¼Œè®­ç»ƒç¬¬äºŒé˜¶æ®µ400Kæ­¥ã€‚</p>
<p><a href="https://github.com/ymcui/Chinese-BERT-wwm" target="_blank" rel="noopener">æ¨¡å‹ä¸‹è½½</a></p>
<h3 id="XLNet"><a href="#XLNet" class="headerlink" title="XLNet"></a>XLNet</h3><p>XLNetä½œä¸ºbertçš„å‡çº§æ¨¡å‹ï¼Œä¸»è¦åœ¨ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢è¿›è¡Œäº†ä¼˜åŒ–:</p>
<ul>
<li>é‡‡ç”¨ARæ¨¡å‹æ›¿ä»£AEæ¨¡å‹ï¼Œè§£å†³maskå¸¦æ¥çš„è´Ÿé¢å½±å“</li>
<li>åŒæµæ³¨æ„åŠ›æœºåˆ¶</li>
<li>å¼•å…¥transformer-xl</li>
</ul>
<h4 id="ARä¸AEè¯­è¨€æ¨¡å‹"><a href="#ARä¸AEè¯­è¨€æ¨¡å‹" class="headerlink" title="ARä¸AEè¯­è¨€æ¨¡å‹"></a>ARä¸AEè¯­è¨€æ¨¡å‹</h4><p>ç›®å‰ä¸»æµçš„nlpé¢„è®­ç»ƒæ¨¡å‹åŒ…æ‹¬ä¸¤ç±» Auto Regressive (<strong>AR</strong>) Language Model ä¸Auto Encoding (AE) Language Modelã€‚</p>
<h5 id="ARæ¨¡å‹"><a href="#ARæ¨¡å‹" class="headerlink" title="ARæ¨¡å‹"></a>ARæ¨¡å‹</h5><p>ARæ¨¡å‹çš„ä¸»è¦ä»»åŠ¡åœ¨äºè¯„ä¼°è¯­æ–™çš„æ¦‚ç‡åˆ†å¸ƒï¼Œä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªåºåˆ— $X=(x_1, \cdots ,x_T)$ ï¼ŒARæ¨¡å‹å°±æ˜¯åœ¨è®¡ç®—å…¶æå¤§ä¼¼ç„¶ä¼°è®¡$p(X)=\prod_{t=1}^Tp(x_tâˆ£x_{<t})$å³å·²çŸ¥$x_t$ä¹‹å‰çš„åºåˆ—ï¼Œé¢„æµ‹$x_t$ çš„å€¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åç€æ¥$p(x)="\prod_{t=1}^Tp(x_tâˆ£x_{">t})$å³å·²çŸ¥$x_t$ä¹‹åçš„åºåˆ—ï¼Œé¢„æµ‹$x_t$çš„å€¼ã€‚ARæ¨¡å‹ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„ç¼ºç‚¹å°±æ˜¯ï¼šæ¨¡å‹æ˜¯å•å‘çš„ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›çš„æ˜¯æ ¹æ®ä¸Šä¸‹æ–‡æ¥é¢„æµ‹ç›®æ ‡ï¼Œè€Œä¸å•æ˜¯ä¸Šæ–‡æˆ–è€…ä¸‹æ–‡ï¼Œä¹‹å‰open AIæå‡ºçš„GPTå°±æ˜¯é‡‡ç”¨çš„ARæ¨¡å¼ï¼ŒåŒ…æ‹¬GPT2.0ä¹Ÿæ˜¯è¯¥æ¨¡å¼ã€‚</t})$å³å·²çŸ¥$x_t$ä¹‹å‰çš„åºåˆ—ï¼Œé¢„æµ‹$x_t$></p>
<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>å…·å¤‡ç”Ÿæˆèƒ½åŠ›</li>
<li>è€ƒè™‘äº†ç›¸å…³æ€§</li>
<li>æ— ç›‘ç£</li>
<li>ä¸¥æ ¼çš„æ•°å­¦è¡¨è¾¾</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>å•å‘çš„</li>
<li>ï¼ˆéš¾è€ƒè™‘ long term dependencyï¼‰</li>
</ol>
<h5 id="AEæ¨¡å‹"><a href="#AEæ¨¡å‹" class="headerlink" title="AEæ¨¡å‹"></a>AEæ¨¡å‹</h5><p>AEæ¨¡å‹é‡‡ç”¨çš„å°±æ˜¯ä»¥ä¸Šä¸‹æ–‡çš„æ–¹å¼ï¼Œæœ€å…¸å‹çš„æˆåŠŸæ¡ˆä¾‹å°±æ˜¯bertã€‚ç®€å•å›é¡¾ä¸‹bertçš„é¢„è®­ç»ƒé˜¶æ®µï¼Œé¢„è®­ç»ƒåŒ…æ‹¬äº†ä¸¤ä¸ªä»»åŠ¡ï¼ŒMasked Language Modelä¸Next Sentence Predictionï¼ŒNext Sentence Predictionå³åˆ¤æ–­ä¸¤ä¸ªåºåˆ—çš„æ¨æ–­å…³ç³»ï¼ŒMasked Language Modelé‡‡ç”¨äº†ä¸€ä¸ªæ ‡å¿—ä½[MASK]æ¥éšæœºæ›¿æ¢ä¸€äº›è¯ï¼Œå†ç”¨[MASK]çš„ä¸Šä¸‹æ–‡æ¥é¢„æµ‹[MASK]çš„çœŸå®å€¼ï¼Œbertçš„æœ€å¤§é—®é¢˜ä¹Ÿæ˜¯å¤„åœ¨è¿™ä¸ªMASKçš„ç‚¹ï¼Œå› ä¸ºåœ¨å¾®è°ƒé˜¶æ®µï¼Œæ²¡æœ‰MASKè¿™å°±å¯¼è‡´é¢„è®­ç»ƒå’Œå¾®è°ƒæ•°æ®çš„ä¸ç»Ÿä¸€ï¼Œä»è€Œå¼•å…¥äº†ä¸€äº›äººä¸ºè¯¯å·®ã€‚</p>
<p>åœ¨xlnetä¸­ï¼Œé‡‡ç”¨äº†<strong>ARæ¨¡å‹</strong>ï¼Œä½†æ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªä¸Šä¸‹æ–‡çš„é—®é¢˜å‘¢ï¼Ÿ</p>
<h4 id="æ’åˆ—è¯­è¨€æ¨¡å‹-ä¸ºäº†è€ƒè™‘ä¸Šä¸‹æ–‡ä¿¡æ¯"><a href="#æ’åˆ—è¯­è¨€æ¨¡å‹-ä¸ºäº†è€ƒè™‘ä¸Šä¸‹æ–‡ä¿¡æ¯" class="headerlink" title="æ’åˆ—è¯­è¨€æ¨¡å‹(ä¸ºäº†è€ƒè™‘ä¸Šä¸‹æ–‡ä¿¡æ¯)"></a>æ’åˆ—è¯­è¨€æ¨¡å‹(ä¸ºäº†è€ƒè™‘ä¸Šä¸‹æ–‡ä¿¡æ¯)</h4><p>ä¸ºäº†è§£å†³ä¸Šæ–‡æåˆ°çš„é—®é¢˜ï¼Œä½œè€…æå‡ºäº†æ’åˆ—è¯­è¨€æ¨¡å‹ï¼Œè¯¥æ¨¡å‹ä¸å†å¯¹ä¼ ç»Ÿçš„ARæ¨¡å‹çš„åºåˆ—çš„å€¼æŒ‰é¡ºåºè¿›è¡Œå»ºæ¨¡ï¼Œè€Œæ˜¯æœ€å¤§åŒ–æ‰€æœ‰å¯èƒ½çš„åºåˆ—çš„å› å¼åˆ†è§£é¡ºåºçš„æœŸæœ›å¯¹æ•°ä¼¼ç„¶ï¼Œè¿™å¥è¯å¯èƒ½æœ‰ç‚¹ä¸å¥½ç†è§£ï¼Œä¸¾ä¸ªæ —å­ï¼Œå‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªåºåˆ—$[1,2,3,4]$ï¼Œå¦‚æœæˆ‘ä»¬çš„é¢„æµ‹ç›®æ ‡æ˜¯3ï¼Œå¯¹äºä¼ ç»Ÿçš„ARæ¨¡å‹æ¥è¯´ï¼Œç»“æœæ˜¯$p(3)=\prod^3_{t=1}p(3|x_{&lt;t})$ï¼Œå¦‚æœé‡‡ç”¨æœ¬æ–‡çš„æ–¹æ³•ï¼Œå…ˆå¯¹è¯¥åºåˆ—è¿›è¡Œå› å¼åˆ†è§£ï¼Œæœ€ç»ˆä¼šæœ‰24ç§æ’åˆ—æ–¹å¼ï¼Œä¸‹å›¾æ˜¯å…¶ä¸­å¯èƒ½çš„å››ç§æƒ…å†µï¼Œå¯¹äºç¬¬ä¸€ç§æƒ…å†µå› ä¸º3çš„å·¦è¾¹æ²¡æœ‰å…¶ä»–çš„å€¼ï¼Œæ‰€ä»¥è¯¥æƒ…å†µæ— éœ€åšå¯¹åº”çš„è®¡ç®—ï¼Œç¬¬äºŒç§æƒ…å†µ3çš„å·¦è¾¹è¿˜åŒ…æ‹¬äº†2ä¸4ï¼Œæ‰€ä»¥å¾—åˆ°çš„ç»“æœæ˜¯$p(3)=p(3|2)p(3|2,4)$ï¼Œåç»­çš„æƒ…å†µç±»ä¼¼ï¼Œè¿™æ ·å¤„ç†è¿‡åä¸ä½†ä¿ç•™äº†åºåˆ—çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¹Ÿ<strong>é¿å…äº†é‡‡ç”¨maskæ ‡è®°ä½ï¼Œå·§å¦™çš„æ”¹è¿›äº†bertä¸ä¼ ç»ŸARæ¨¡å‹çš„ç¼ºç‚¹</strong>ã€‚<br><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/xlnet.png" alt="avatar"></p>
<h5 id="å¦‚ä½•è®­ç»ƒï¼Ÿ"><a href="#å¦‚ä½•è®­ç»ƒï¼Ÿ" class="headerlink" title="å¦‚ä½•è®­ç»ƒï¼Ÿ"></a>å¦‚ä½•è®­ç»ƒï¼Ÿ</h5><ol>
<li>å‡å¦‚å¥å­é•¿åº¦ä¸º20ï¼Œåˆ™ä¼šäº§ç”Ÿ$20$!ç§æ’åˆ—ï¼Œåœ¨è¿™$20$!ç§æ’åˆ—ä¸­éšæœºæŠ½æ ·ï¼Œå¾—åˆ°è®­ç»ƒæ ·æœ¬ã€‚</li>
<li>ä¸ºè·å¾—ä¸°å¯Œçš„ä¸Šä¸‹æ–‡è¯­ä¹‰ä¿¡æ¯ï¼Œå¯¹æŠ½å–çš„æ ·æœ¬æœ€åçš„å‡ ä¸ªå•è¯è¿›è¡Œé¢„æµ‹ã€‚</li>
</ol>
<h4 id="åŸºäºç›®æ ‡æ„ŸçŸ¥è¡¨å¾çš„åŒæµè‡ªæ³¨æ„åŠ›-ä¸ºäº†è§£å†³ä½ç½®ä¿¡æ¯"><a href="#åŸºäºç›®æ ‡æ„ŸçŸ¥è¡¨å¾çš„åŒæµè‡ªæ³¨æ„åŠ›-ä¸ºäº†è§£å†³ä½ç½®ä¿¡æ¯" class="headerlink" title="åŸºäºç›®æ ‡æ„ŸçŸ¥è¡¨å¾çš„åŒæµè‡ªæ³¨æ„åŠ›(ä¸ºäº†è§£å†³ä½ç½®ä¿¡æ¯)"></a>åŸºäºç›®æ ‡æ„ŸçŸ¥è¡¨å¾çš„<strong>åŒæµè‡ªæ³¨æ„åŠ›</strong>(ä¸ºäº†è§£å†³ä½ç½®ä¿¡æ¯)</h4><p>è™½ç„¶æ’åˆ—è¯­è¨€æ¨¡å‹èƒ½æ»¡è¶³ç›®å‰çš„ç›®æ ‡ï¼Œä½†æ˜¯å¯¹äºæ™®é€šçš„transformerç»“æ„æ¥è¯´æ˜¯å­˜åœ¨ä¸€å®šçš„é—®é¢˜çš„ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œå‡è®¾æˆ‘ä»¬è¦æ±‚è¿™æ ·çš„ä¸€ä¸ªå¯¹æ•°ä¼¼ç„¶ï¼Œ$p_\theta(X_{z_t}|x_{z_{&lt;t}})$ï¼Œå¦‚æœé‡‡ç”¨æ ‡å‡†çš„softmaxçš„è¯ï¼Œé‚£ä¹ˆ</p>
<script type="math/tex; mode=display">
p_{\theta}\left(X_{z_t} | x_{z_{<t}}\right)=\frac{\exp \left(e(x)^{T} h_{\theta}\left(x_{z_{<t}}\right)\right)}{\sum_{x^{\prime}} \exp \left(e\left(x^{\prime}\right)^{T} h_{\theta}\left(x_{z_{<t}}\right)\right)}</script><p>å…¶ä¸­$h_\theta (x_{z_{&lt;t}})$è¡¨ç¤ºçš„æ˜¯æ·»åŠ äº†maskåçš„transformerçš„è¾“å‡ºå€¼ï¼Œå¯ä»¥å‘ç°$h_\theta (x_{z_{&lt;t}})$å¹¶ä¸ä¾èµ–äºå…¶è¦é¢„æµ‹çš„å†…å®¹çš„ä½ç½®ä¿¡æ¯ï¼Œå› ä¸ºæ— è®ºé¢„æµ‹ç›®æ ‡çš„ä½ç½®åœ¨å“ªé‡Œï¼Œå› å¼åˆ†è§£åå¾—åˆ°çš„æ‰€æœ‰æƒ…å†µéƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”transformerçš„æƒé‡å¯¹äºä¸åŒçš„æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤æ— è®ºç›®æ ‡ä½ç½®æ€ä¹ˆå˜éƒ½èƒ½å¾—åˆ°ç›¸åŒçš„åˆ†å¸ƒç»“æœï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‡å¦‚æˆ‘ä»¬çš„åºåˆ—indexè¡¨ç¤ºä¸º[1,2,3]ï¼Œå¯¹äºç›®æ ‡2ä¸3æ¥è¯´ï¼Œå…¶å› å¼åˆ†è§£åçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆç»è¿‡transformerä¹‹åå¾—åˆ°çš„ç»“æœè‚¯å®šä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚<br><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/123.png" alt="avatar"></p>
<p>è¿™å°±å¯¼è‡´æ¨¡å‹æ²¡æ³•å¾—åˆ°æ­£ç¡®çš„è¡¨è¿°ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®ºæ–‡ä¸­æå‡ºæ¥æ–°çš„åˆ†å¸ƒè®¡ç®—æ–¹æ³•ï¼Œæ¥å®ç°ç›®æ ‡ä½ç½®æ„ŸçŸ¥</p>
<script type="math/tex; mode=display">
p_{\theta}\left(X_{zt}=x | x_{z<t}\right)=\frac{\exp \left(e(x)^{T} g_{\theta}\left(x_{z<t}, z_{t}\right)\right)}{\sum_{x^{\prime}} \exp \left(e\left(x^{\prime}\right)^{T} g_{\theta}\left(x_{z<t}, z_{t}\right)\right)}</script><p>å…¶ä¸­$g_{\theta}\left(x_{z_{&lt;t}}, z_{t}\right)$æ˜¯æ–°çš„è¡¨ç¤ºå½¢å¼ï¼Œå¹¶ä¸”æŠŠä½ç½®ä¿¡æ¯$z_t$ä½œä¸ºäº†å…¶è¾“å…¥ã€‚<br>è¿™ä¸ªæ–°çš„è¡¨ç¤ºå½¢å¼ï¼Œè®ºæ–‡æŠŠè¯¥æ–¹æ³•ç§°ä¸ºTwo-Stream Self-Attentionï¼ŒåŒæµè‡ªæ³¨æ„åŠ›ï¼Œè¯¥æœºåˆ¶éœ€è¦è§£å†³äº†ä¸¤ä¸ªé—®é¢˜:</p>
<ul>
<li>å¦‚æœç›®æ ‡æ˜¯é¢„æµ‹$x_{z_t}$ï¼Œ$g_\theta (x_{z&lt;t},z_t)$é‚£ä¹ˆåªèƒ½æœ‰å…¶ä½ç½®ä¿¡æ¯$z_t$ è€Œä¸èƒ½åŒ…å«å†…å®¹ä¿¡æ¯$x_{z_t}$</li>
<li>å¦‚æœç›®æ ‡æ˜¯é¢„æµ‹å…¶ä»–tokenså³$x_{z_j}$é‚£ä¹ˆåº”è¯¥åŒ…å«$x_{z_t}$çš„å†…å®¹ä¿¡æ¯è¿™æ ·æ‰æœ‰å®Œæ•´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</li>
</ul>
<p>ä¼ ç»Ÿçš„transformerå¹¶ä¸æ»¡è¶³è¿™æ ·çš„éœ€æ±‚ï¼Œå› æ­¤ä½œè€…é‡‡ç”¨äº†ä¸¤ç§è¡¨è¿°æ¥ä»£æ›¿åŸæ¥çš„è¡¨è¿°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç§°ä¸º<strong>åŒæµ</strong>çš„åŸå› :</p>
<ul>
<li><p>content representationå†…å®¹è¡¨è¿°ï¼Œå³$h_\theta (x_{z_{\leq t}})$ä¸‹æ–‡ç”¨$h_{z_t}$è¡¨ç¤ºï¼Œè¯¥è¡¨è¿°å’Œä¼ ç»Ÿçš„transformerä¸€æ ·ï¼ŒåŒæ—¶ç¼–ç äº†ä¸Šä¸‹æ–‡å’Œ$x_{z_t}$è‡ªèº«</p>
<script type="math/tex; mode=display">
h_{z_{t}}^{(m)}=\text {Attention}\left(Q=h_{z_{t}}^{(m-1)}, K V=h_{z \leq t}^{(m-1)} ; \theta\right)</script><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/content_representation.png" alt="avatar"></p>
</li>
<li><p>query representationæŸ¥è¯¢è¡¨è¿°ï¼Œå³$g_\theta (x_{z_{&lt;t}})$ï¼Œä¸‹æ–‡ç”¨$g_{z_t}$ è¡¨ç¤ºï¼Œè¯¥è¡¨è¿°åŒ…å«ä¸Šä¸‹æ–‡çš„å†…å®¹ä¿¡æ¯$x_{z_{&lt;t}}$ å’Œç›®æ ‡çš„ä½ç½®ä¿¡æ¯$z_t$ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬ç›®æ ‡çš„å†…å®¹ä¿¡æ¯$x_{z_{t}}$ ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒKä¸Vçš„è®¡ç®—å¹¶æ²¡æœ‰åŒ…æ‹¬Qï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•è·å–åˆ°ç›®æ ‡çš„å†…å®¹ä¿¡æ¯ï¼Œä½†æ˜¯ç›®æ ‡çš„ä½ç½®ä¿¡æ¯åœ¨è®¡ç®—Qçš„æ—¶å€™ä¿ç•™äº†ä¸‹æ¥ï¼Œ</p>
<script type="math/tex; mode=display">
g_{z_{t}}^{(m)}=\text {Attention}\left(Q=g_{z_{t}}^{(m-1)}, K V=h_{z<t}^{(m-1)} ; \theta\right)</script></li>
</ul>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/query_representation.png" alt="avatar"></p>
<p>æ€»çš„è®¡ç®—è¿‡ç¨‹ï¼Œé¦–å…ˆï¼Œç¬¬ä¸€å±‚çš„æŸ¥è¯¢æµæ˜¯éšæœºåˆå§‹åŒ–äº†ä¸€ä¸ªå‘é‡å³$g_i^{0}=w$ï¼Œå†…å®¹æµæ˜¯é‡‡ç”¨çš„è¯å‘é‡å³$h_i^{0}=e(x_i)$ï¼Œself-attentionçš„è®¡ç®—è¿‡ç¨‹ä¸­ä¸¤ä¸ªæµçš„ç½‘ç»œæƒé‡æ˜¯å…±äº«çš„ï¼Œæœ€ååœ¨å¾®è°ƒé˜¶æ®µï¼Œåªéœ€è¦ç®€å•çš„æŠŠquery streamç§»é™¤ï¼Œåªé‡‡ç”¨content streamå³å¯ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/two_stream.png" alt="avatar"></p>
<h4 id="å¼•å…¥transformer-XL"><a href="#å¼•å…¥transformer-XL" class="headerlink" title="å¼•å…¥transformer XL"></a>å¼•å…¥transformer XL</h4><p>ä½œè€…è¿˜å°†transformer-xlçš„ä¸¤ä¸ªæœ€é‡è¦çš„æŠ€æœ¯ç‚¹åº”ç”¨äº†è¿›æ¥ï¼Œå³ç‰‡æ®µå¾ªç¯æœºåˆ¶ä¸ç›¸å¯¹ä½ç½®ç¼–ç ã€‚</p>
<h5 id="ç‰‡æ®µå¾ªç¯æœºåˆ¶"><a href="#ç‰‡æ®µå¾ªç¯æœºåˆ¶" class="headerlink" title="ç‰‡æ®µå¾ªç¯æœºåˆ¶"></a>ç‰‡æ®µå¾ªç¯æœºåˆ¶</h5><p>ransformer-xlçš„æå‡ºä¸»è¦æ˜¯ä¸ºäº†è§£å†³è¶…é•¿åºåˆ—çš„ä¾èµ–é—®é¢˜ï¼Œå¯¹äºæ™®é€šçš„transformerç”±äºæœ‰ä¸€ä¸ªæœ€é•¿åºåˆ—çš„è¶…å‚æ•°æ§åˆ¶å…¶é•¿åº¦ï¼ˆå¦‚æœä¸å¯¹æ–‡æœ¬æ§åˆ¶ï¼Œåˆ™ä¼šæå¤§æ¶ˆè€—å†…å­˜ï¼Œå› ä¸ºåœ¨è®¡ç®—scoreçŸ©é˜µçš„æ—¶å€™ï¼Œä¼šå¼€è¾Ÿ$n^2$å¤§å°çš„çŸ©é˜µï¼Œå¯¹äºä¸€ç¯‡æ–‡æœ¬ï¼Œé•¿åº¦ä¸º$10^5$,åˆ™éœ€è¦å¼€è¾Ÿ$10^5 * 10^5 = 10^10$å¤§å°çš„scoreçŸ©é˜µï¼Œæå…¶æ¶ˆè€—å†…å­˜ã€‚ï¼‰ï¼Œå¯¹äºç‰¹åˆ«é•¿çš„åºåˆ—å°±ä¼šå¯¼è‡´ä¸¢å¤±ä¸€äº›ä¿¡æ¯ï¼Œtransformer-xlå°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬çœ‹ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé•¿åº¦ä¸º1000çš„åºåˆ—ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®transformerçš„æœ€å¤§åºåˆ—é•¿åº¦æ˜¯100ï¼Œé‚£ä¹ˆè¿™ä¸ª1000é•¿åº¦çš„åºåˆ—éœ€è¦è®¡ç®—åæ¬¡ï¼Œå¹¶ä¸”æ¯ä¸€æ¬¡çš„è®¡ç®—éƒ½æ²¡æ³•è€ƒè™‘åˆ°æ¯ä¸€ä¸ªæ®µä¹‹é—´çš„å…³ç³»ï¼Œå¦‚æœé‡‡ç”¨transformer-xlï¼Œé¦–å…ˆå–ç¬¬ä¸€ä¸ªæ®µè¿›è¡Œè®¡ç®—ï¼Œç„¶åæŠŠå¾—åˆ°çš„ç»“æœçš„éšè—å±‚çš„å€¼è¿›è¡Œç¼“å­˜ï¼Œç¬¬äºŒä¸ªæ®µè®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼ŒæŠŠç¼“å­˜çš„å€¼æ‹¼æ¥èµ·æ¥å†è¿›è¡Œè®¡ç®—ï¼ˆRNNï¼‰ã€‚è¯¥æœºåˆ¶ä¸ä½†èƒ½ä¿ç•™é•¿ä¾èµ–å…³ç³»è¿˜èƒ½åŠ å¿«è®­ç»ƒï¼Œå› ä¸ºæ¯ä¸€ä¸ªå‰ç½®ç‰‡æ®µéƒ½ä¿ç•™äº†ä¸‹æ¥ï¼Œä¸éœ€è¦å†é‡æ–°è®¡ç®—ï¼Œåœ¨transformer-xlçš„è®ºæ–‡ä¸­ï¼Œç»è¿‡è¯•éªŒå…¶é€Ÿåº¦æ¯”transformerå¿«äº†1800å€ã€‚<br>åœ¨xlnetä¸­å¼•å…¥ç‰‡æ®µå¾ªç¯æœºåˆ¶å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨è®¡ç®—KVçš„æ—¶å€™åšç®€å•çš„ä¿®æ”¹ï¼Œå…¶ä¸­$\tilde{h}^{m-1}$è¡¨ç¤ºçš„æ˜¯ç¼“å­˜å€¼ã€‚</p>
<script type="math/tex; mode=display">
h_{z_{t}}^{(m)}=\text {Attention}\left(Q=h_{z_{t}}^{(m-1)}, K V=\left[\tilde{h}^{(m-1)}, h_{z \leq t}^{(m-1)}\right] ; \theta\right)</script><h5 id="ç›¸å¯¹ä½ç½®ç¼–ç "><a href="#ç›¸å¯¹ä½ç½®ç¼–ç " class="headerlink" title="ç›¸å¯¹ä½ç½®ç¼–ç "></a>ç›¸å¯¹ä½ç½®ç¼–ç </h5><p>bertçš„position embeddingé‡‡ç”¨çš„æ˜¯ç»å¯¹ä½ç½®ç¼–ç ï¼Œä½†æ˜¯ç»å¯¹ä½ç½®ç¼–ç åœ¨transformer-xlä¸­æœ‰ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œå› ä¸ºæ²¡æ³•åŒºåˆ†åˆ°åº•æ˜¯å“ªä¸€ä¸ªç‰‡æ®µé‡Œçš„ï¼Œè¿™å°±å¯¼è‡´äº†ä¸€äº›ä½ç½®ä¿¡æ¯çš„æŸå¤±ï¼Œè¿™é‡Œè¢«æ›¿æ¢ä¸ºäº†transformer-xlä¸­çš„ç›¸å¯¹ä½ç½®ç¼–ç ã€‚å‡è®¾ç»™å®šä¸€å¯¹ä½ç½®$i$ä¸$j$ï¼Œå¦‚æœ$i$ä¸$j$æ˜¯åŒä¸€ä¸ªç‰‡æ®µé‡Œçš„é‚£ä¹ˆæˆ‘ä»¬ä»¤è¿™ä¸ªç‰‡æ®µç¼–ç $s_{ij}=s_+$ï¼Œå¦‚æœä¸åœ¨ä¸€ä¸ªç‰‡æ®µé‡Œåˆ™ä»¤è¿™ä¸ªç‰‡æ®µç¼–ç ä¸º$s_{ij}=s_-$ï¼Œè¿™ä¸ªå€¼æ˜¯åœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­å¾—åˆ°çš„ï¼Œä¹Ÿæ˜¯ç”¨æ¥è®¡ç®—attention weightæ—¶å€™ç”¨åˆ°çš„ï¼Œåœ¨ä¼ ç»Ÿçš„transformerä¸­$\text {attention weight}= softmax(\frac{Qâ‹…K}{d}V)$ï¼Œåœ¨å¼•å…¥ç›¸å¯¹ä½ç½®ç¼–ç åï¼Œé¦–å…ˆè¦è®¡ç®—å‡º$a_{ij}=(q_i+b)^T_{s_{sj}}$ï¼Œå…¶ä¸­$b$ä¹Ÿæ˜¯ä¸€ä¸ªéœ€è¦è®­ç»ƒå¾—åˆ°çš„åæ‰§é‡ï¼Œæœ€åæŠŠå¾—åˆ°çš„$a_ij$ä¸ä¼ ç»Ÿçš„transformerçš„weightç›¸åŠ ä»è€Œå¾—åˆ°æœ€ç»ˆçš„attention weightã€‚</p>
<p><a href="https://github.com/huggingface/transformers/blob/master/src/transformers/modeling_xlnet.py" target="_blank" rel="noopener">æºç </a></p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>åœ¨å®éªŒä¸­å‘ç°ï¼Œxlnetæ›´å¤šè¿˜æ˜¯åœ¨é•¿æ–‡æœ¬çš„é˜…è¯»ç†è§£ç±»çš„ä»»åŠ¡ä¸Šæå‡æ›´æ˜æ˜¾ä¸€äº›ï¼Œè¿™ä¹Ÿå¾ˆç¬¦åˆä¸Šæ–‡ä¸­ä»‹ç»çš„è¿™äº›ä¼˜åŒ–ç‚¹ï¼Œåœ¨å®é™…å·¥ä¸šåœºæ™¯ä¸­ï¼Œæœºå™¨ç¿»è¯‘ã€æœ¬æ–‡æ‘˜è¦ç±»çš„ä»»åŠ¡åº”è¯¥ä¼šæœ‰æ›´å¥½çš„æ•ˆæœï¼Œå½“ç„¶åœ¨å…¶ä»–çš„æ–‡æœ¬åˆ†ç±»ã€è‡ªç„¶è¯­è¨€æ¨ç†ç­‰ä»»åŠ¡ä¸Šxlnetä¹Ÿæœ‰ä¸€å®šçš„æ•ˆæœæå‡ã€‚nlpé¢†åŸŸçš„æ¨¡å‹ç›®å‰å·²ç»å®Œå…¨é‡‡ç”¨äº†pretrain+fine tuningçš„æ¨¡å¼ï¼ŒGPT2.0çš„å•å‘æ¨¡å¼åœ¨å¢å¤§è®­ç»ƒè¯­æ–™çš„æƒ…å†µä¸‹æ•ˆæœå°±å·²ç»è¶…è¶Šäº†bertï¼Œå¯æƒ³è€ŒçŸ¥è¯¥é¢†åŸŸçš„ç ”ç©¶è¿˜æœ‰å¾ˆå¤§çš„ä¸Šå‡ç©ºé—´</p>
<h3 id="RoBERTa"><a href="#RoBERTa" class="headerlink" title="RoBERTa"></a>RoBERTa</h3><h4 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>åœ¨XLNetå…¨é¢è¶…è¶ŠBertåæ²¡å¤šä¹…ï¼ŒFacebookæå‡ºäº†RoBERTaï¼ˆa Robustly Optimized BERT Pretraining Approachï¼‰ã€‚å†åº¦åœ¨å¤šä¸ªä»»åŠ¡ä¸Šè¾¾åˆ°SOTAã€‚</p>
<p>å®ƒåœ¨æ¨¡å‹å±‚é¢æ²¡æœ‰æ”¹å˜Googleçš„Bertï¼Œ<strong>æ”¹å˜çš„åªæ˜¯é¢„è®­ç»ƒçš„æ–¹æ³•</strong>ã€‚</p>
<h4 id="åŠ¨æœº"><a href="#åŠ¨æœº" class="headerlink" title="åŠ¨æœº"></a>åŠ¨æœº</h4><p>Yinhan Liuç­‰äºº[6]è®¤ä¸ºè¶…å‚æ•°çš„é€‰æ‹©å¯¹æœ€ç»ˆç»“æœæœ‰é‡å¤§å½±å“ï¼Œä¸ºæ­¤ä»–ä»¬æå‡ºäº†BERTé¢„è®­ç»ƒçš„é‡å¤ç ”ç©¶ï¼Œå…¶ä¸­åŒ…æ‹¬å¯¹è¶…å‚æ•°è°ƒæ•´å’Œè®­ç»ƒé›†å¤§å°çš„å½±å“çš„ä»”ç»†è¯„ä¼°ã€‚<strong>æœ€ç»ˆï¼Œä»–ä»¬å‘ç°äº†BERTçš„è®­ç»ƒä¸è¶³</strong>ï¼Œå¹¶æå‡ºäº†ä¸€ç§æ”¹è¿›çš„æ¨¡å‹æ¥è®­ç»ƒBERTæ¨¡å‹ã€‚</p>
<h4 id="æ”¹è¿›"><a href="#æ”¹è¿›" class="headerlink" title="æ”¹è¿›"></a>æ”¹è¿›</h4><h5 id="é™æ€Masking-vs-åŠ¨æ€Masking"><a href="#é™æ€Masking-vs-åŠ¨æ€Masking" class="headerlink" title="é™æ€Masking vs åŠ¨æ€Masking"></a>é™æ€Masking vs åŠ¨æ€Masking</h5><p>åŸæ¥Bertå¯¹æ¯ä¸€ä¸ªåºåˆ—éšæœºé€‰æ‹©15%çš„Tokensæ›¿æ¢æˆ[MASK]ï¼Œä¸ºäº†æ¶ˆé™¤ä¸ä¸‹æ¸¸ä»»åŠ¡çš„ä¸åŒ¹é…ï¼Œè¿˜å¯¹è¿™15%çš„Tokensè¿›è¡Œï¼ˆ1ï¼‰80%çš„æ¦‚ç‡æ›¿æ¢æˆ[MASK]ï¼›ï¼ˆ2ï¼‰10%çš„æ¦‚ç‡ä¸å˜ï¼›ï¼ˆ3ï¼‰10%çš„æ¦‚ç‡æ›¿æ¢æˆå…¶ä»–è¯ã€‚ä½†æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ï¼Œè¿™15%çš„Tokensä¸€æ—¦è¢«é€‰æ‹©å°±ä¸å†æ”¹å˜ï¼Œä¹Ÿå°±æ˜¯è¯´ä»ä¸€å¼€å§‹éšæœºé€‰æ‹©äº†è¿™15%çš„Tokensï¼Œä¹‹åçš„Nä¸ªepoché‡Œéƒ½ä¸å†æ”¹å˜äº†ã€‚è¿™å°±å«åšé™æ€Maskingã€‚</p>
<p>è€ŒRoBERTaä¸€å¼€å§‹æŠŠé¢„è®­ç»ƒçš„æ•°æ®å¤åˆ¶10ä»½ï¼Œæ¯ä¸€ä»½éƒ½éšæœºé€‰æ‹©15%çš„Tokensè¿›è¡ŒMaskingï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒæ ·çš„ä¸€å¥è¯æœ‰10ç§ä¸åŒçš„maskæ–¹å¼ã€‚ç„¶åæ¯ä»½æ•°æ®éƒ½è®­ç»ƒN/10ä¸ªepochã€‚è¿™å°±ç›¸å½“äºåœ¨è¿™Nä¸ªepochçš„è®­ç»ƒä¸­ï¼Œæ¯ä¸ªåºåˆ—çš„è¢«maskçš„tokensæ˜¯ä¼šå˜åŒ–çš„ã€‚è¿™å°±å«åšåŠ¨æ€Maskingã€‚ä½œè€…åœ¨åªå°†é™æ€Maskingæ”¹æˆåŠ¨æ€Maskingï¼Œå…¶ä»–å‚æ•°ä¸å˜çš„æƒ…å†µä¸‹åšäº†å®éªŒï¼ŒåŠ¨æ€Maskingç¡®å®èƒ½æé«˜æ€§èƒ½ã€‚</p>
<h5 id="with-NSP-vs-without-NSP"><a href="#with-NSP-vs-without-NSP" class="headerlink" title="with NSP vs without NSP"></a>with NSP vs without NSP</h5><p>åŸæœ¬çš„Bertä¸ºäº†æ•æ‰å¥å­ä¹‹é—´çš„å…³ç³»ï¼Œä½¿ç”¨äº†NSPä»»åŠ¡è¿›è¡Œé¢„è®­ç»ƒï¼Œå°±æ˜¯è¾“å…¥ä¸€å¯¹å¥å­Aå’ŒBï¼Œåˆ¤æ–­è¿™ä¸¤ä¸ªå¥å­æ˜¯å¦æ˜¯è¿ç»­çš„ã€‚åœ¨è®­ç»ƒçš„æ•°æ®ä¸­ï¼Œ50%çš„Bæ˜¯Açš„ä¸‹ä¸€ä¸ªå¥å­ï¼Œ50%çš„Bæ˜¯éšæœºæŠ½å–çš„ã€‚</p>
<p>è€ŒRoBERTaå»é™¤äº†NSPï¼Œè€Œæ˜¯æ¯æ¬¡è¾“å…¥è¿ç»­çš„å¤šä¸ªå¥å­ï¼Œç›´åˆ°æœ€å¤§é•¿åº¦512ï¼ˆå¯ä»¥è·¨æ–‡ç« ï¼‰ã€‚è¿™ç§è®­ç»ƒæ–¹å¼å«åšï¼ˆFULL - SENTENCESï¼‰ï¼Œè€ŒåŸæ¥çš„Bertæ¯æ¬¡åªè¾“å…¥ä¸¤ä¸ªå¥å­ã€‚å®éªŒè¡¨æ˜åœ¨MNLIè¿™ç§æ¨æ–­å¥å­å…³ç³»çš„ä»»åŠ¡ä¸ŠRoBERTaä¹Ÿèƒ½æœ‰æ›´å¥½æ€§èƒ½ã€‚ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼‰</p>
<h5 id="æ›´å¤§çš„mini-batch"><a href="#æ›´å¤§çš„mini-batch" class="headerlink" title="æ›´å¤§çš„mini-batch"></a>æ›´å¤§çš„mini-batch</h5><p>åŸæœ¬çš„BERTbase çš„batch sizeæ˜¯256ï¼Œè®­ç»ƒ1Mä¸ªstepsã€‚RoBERTaçš„batch sizeä¸º8kã€‚ä¸ºä»€ä¹ˆè¦ç”¨æ›´å¤§çš„batch sizeå‘¢ï¼Ÿä½œè€…å€Ÿé‰´äº†åœ¨æœºå™¨ç¿»è¯‘ä¸­ï¼Œç”¨æ›´å¤§çš„batch sizeé…åˆæ›´å¤§å­¦ä¹ ç‡èƒ½æå‡æ¨¡å‹ä¼˜åŒ–é€Ÿç‡å’Œæ¨¡å‹æ€§èƒ½çš„ç°è±¡ï¼Œå¹¶ä¸”ä¹Ÿç”¨å®éªŒè¯æ˜äº†ç¡®å®Bertè¿˜èƒ½ç”¨æ›´å¤§çš„batch sizeã€‚</p>
<h5 id="æ›´å¤šçš„æ•°æ®ï¼Œæ›´é•¿çš„è®­ç»ƒæ—¶é—´"><a href="#æ›´å¤šçš„æ•°æ®ï¼Œæ›´é•¿çš„è®­ç»ƒæ—¶é—´" class="headerlink" title="æ›´å¤šçš„æ•°æ®ï¼Œæ›´é•¿çš„è®­ç»ƒæ—¶é—´"></a>æ›´å¤šçš„æ•°æ®ï¼Œæ›´é•¿çš„è®­ç»ƒæ—¶é—´</h5><p>å€Ÿé‰´XLNetç”¨äº†æ¯”Bertå¤š10å€çš„æ•°æ®ï¼ŒRoBERTaä¹Ÿç”¨äº†æ›´å¤šçš„æ•°æ®ã€‚æ€§èƒ½ç¡®å®å†æ¬¡å½ªå‡ã€‚å½“ç„¶ï¼Œä¹Ÿéœ€è¦é…åˆæ›´é•¿æ—¶é—´çš„è®­ç»ƒã€‚</p>
<h5 id="Byte-Pair-Encoding-BPE-å­—ç¬¦ç¼–ç "><a href="#Byte-Pair-Encoding-BPE-å­—ç¬¦ç¼–ç " class="headerlink" title="Byte-Pair Encoding (BPE)å­—ç¬¦ç¼–ç "></a>Byte-Pair Encoding (BPE)å­—ç¬¦ç¼–ç </h5><p>ä½¿ç”¨Sennrich[8]ç­‰äººæå‡ºçš„Byte-Pair Encoding (BPE)å­—ç¬¦ç¼–ç ï¼Œå®ƒæ˜¯å­—ç¬¦çº§å’Œå•è¯çº§è¡¨ç¤ºä¹‹é—´çš„æ··åˆä½“ï¼Œå¯ä»¥å¤„ç†è‡ªç„¶è¯­è¨€è¯­æ–™åº“ä¸­å¸¸è§çš„å¤§è¯æ±‡ï¼Œé¿å…è®­ç»ƒæ•°æ®å‡ºç°æ›´å¤šçš„â€œ[UNK]â€æ ‡å¿—ç¬¦å·ï¼Œä»è€Œå½±å“é¢„è®­ç»ƒæ¨¡å‹çš„æ€§èƒ½ã€‚å…¶ä¸­ï¼Œâ€œ[UNK]â€æ ‡è®°ç¬¦è¡¨ç¤ºå½“åœ¨BERTè‡ªå¸¦å­—å…¸vocab.txtæ‰¾ä¸åˆ°æŸä¸ªå­—æˆ–è€…è‹±æ–‡å•è¯æ—¶ï¼Œåˆ™ç”¨â€œ[UNK]â€è¡¨ç¤ºã€‚</p>
<h3 id="SpanBERT"><a href="#SpanBERT" class="headerlink" title="SpanBERT"></a>SpanBERT</h3><p><a href="https://arxiv.org/pdf/1907.10529.pdf" target="_blank" rel="noopener">è®ºæ–‡</a></p>
<h4 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>åœ¨è®¸å¤š NLP ä»»åŠ¡ä¸­éƒ½æ¶‰åŠå¯¹å¤šä¸ªæ–‡æœ¬åˆ†è¯é—´å…³ç³»çš„æ¨ç†ã€‚ä¾‹å¦‚ï¼Œåœ¨æŠ½å–å¼é—®ç­”ä»»åŠ¡ä¸­ï¼Œåœ¨å›ç­”é—®é¢˜â€œWhich NFL team won Super Bown 50?â€æ—¶ï¼Œåˆ¤æ–­â€œDenver Broncosâ€ æ˜¯å¦å±äºâ€œNFL teamâ€æ˜¯éå¸¸é‡è¦çš„æ­¥éª¤ã€‚ç›¸æ¯”äºåœ¨å·²çŸ¥â€œBroncosâ€é¢„æµ‹â€œDenverâ€çš„æƒ…å†µï¼Œç›´æ¥é¢„æµ‹â€œDenver Broncosâ€éš¾åº¦æ›´å¤§ï¼Œè¿™æ„å‘³ç€è¿™ç±»åˆ†è¯å¯¹è‡ªç›‘ç£ä»»åŠ¡æå‡ºäº†æ›´å¤šçš„æŒ‘æˆ˜ã€‚</p>
<p>SpanBertå¯¹ BERT æ¨¡å‹è¿›è¡Œäº†å¦‚ä¸‹æ”¹è¿›ï¼š</p>
<ol>
<li>æ²¡æœ‰segment embeddingï¼Œåªæœ‰ä¸€ä¸ªé•¿çš„å¥å­ï¼Œç±»ä¼¼RoBERTaã€‚</li>
<li><strong>Span Masking</strong>:å¯¹éšæœºçš„é‚»æ¥åˆ†è¯ï¼ˆspanï¼‰è€Œééšæœºçš„å•ä¸ªè¯è¯­ï¼ˆtokenï¼‰æ·»åŠ maskï¼›</li>
<li>MLM+SBO:é€šè¿‡ä½¿ç”¨åˆ†è¯è¾¹ç•Œçš„è¡¨ç¤ºæ¥é¢„æµ‹è¢«æ·»åŠ maskçš„åˆ†è¯çš„å†…å®¹ï¼Œä¸å†ä¾èµ–åˆ†è¯å†…å•ä¸ª token çš„è¡¨ç¤ºã€‚</li>
</ol>
<p>SpanBERT èƒ½å¤Ÿå¯¹åˆ†è¯è¿›è¡Œæ›´å¥½åœ°è¡¨ç¤ºå’Œé¢„æµ‹ã€‚è¯¥æ¨¡å‹å’Œ BERT åœ¨maskæœºåˆ¶å’Œè®­ç»ƒç›®æ ‡ä¸Šå­˜åœ¨å·®åˆ«ã€‚é¦–å…ˆï¼ŒSpanBERT ä¸å†å¯¹éšæœºçš„å•ä¸ª token æ·»åŠ maskï¼Œè€Œæ˜¯å¯¹éšæœºå¯¹é‚»æ¥åˆ†è¯æ·»åŠ maskã€‚å…¶æ¬¡ï¼ŒSpanBertæå‡ºäº†ä¸€ä¸ªæ–°çš„è®­ç»ƒç›®æ ‡ span-boundary objective (SBO) è¿›è¡Œæ¨¡å‹è®­ç»ƒã€‚é€šè¿‡å¯¹åˆ†è¯æ·»åŠ maskï¼Œä½œè€…èƒ½å¤Ÿä½¿æ¨¡å‹ä¾æ®å…¶æ‰€åœ¨è¯­å¢ƒé¢„æµ‹æ•´ä¸ªåˆ†è¯ã€‚å¦å¤–ï¼ŒSBO èƒ½ä½¿æ¨¡å‹åœ¨è¾¹ç•Œè¯ä¸­å­˜å‚¨å…¶åˆ†è¯çº§åˆ«çš„ä¿¡æ¯ï¼Œä½¿å¾—æ¨¡å‹çš„è°ƒä¼˜æ›´ä½³å®¹æ˜“ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/spanbert.png" alt="avatar"></p>
<p>æ¨¡å‹ä½¿ç”¨è¾¹ç•Œè¯ waså’Œ toæ¥é¢„æµ‹åˆ†è¯ä¸­çš„æ¯ä¸ªå•è¯ã€‚</p>
<p>ä¸ºäº†æ­å»º SpanBERT ï¼Œä½œè€…é¦–å…ˆæ„å»ºäº†ä¸€ä¸ª BERT æ¨¡å‹çš„å¹¶è¿›è¡Œäº†å¾®è°ƒï¼ŒSpanBERTçš„è¡¨ç°ä¼˜äºåŸå§‹ BERT æ¨¡å‹ã€‚åœ¨æ­å»ºbaselineçš„æ—¶å€™ï¼Œä½œè€…å‘ç°å¯¹å•ä¸ªéƒ¨åˆ†è¿›è¡Œé¢„è®­ç»ƒçš„æ•ˆæœï¼Œæ¯”ä½¿ç”¨ next sentence prediction (NSP) ç›®æ ‡å¯¹ä¸¤ä¸ªé•¿åº¦ä¸ºä¸€åŠçš„éƒ¨åˆ†è¿›è¡Œè®­ç»ƒçš„æ•ˆæœæ›´ä¼˜ï¼Œåœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸­è¡¨ç°å°¤å…¶æ˜æ˜¾ã€‚å› æ­¤ï¼Œä½œè€…åœ¨ç»è¿‡è°ƒä¼˜çš„ BERT æ¨¡å‹çš„é¡¶ç«¯å¯¹æ¨¡å‹è¿›è¡Œäº†æ”¹è¿›ã€‚</p>
<h4 id="Span-Masking"><a href="#Span-Masking" class="headerlink" title="Span Masking(????)"></a>Span Masking(????)</h4><p>å¯¹äºæ¯ä¸€ä¸ªå•è¯åºåˆ— $X = (x_1, \ldots , x_n )$ï¼Œä½œè€…é€šè¿‡è¿­ä»£åœ°é‡‡æ ·æ–‡æœ¬çš„åˆ†è¯é€‰æ‹©å•è¯ï¼Œç›´åˆ°è¾¾åˆ°æ©è†œè¦æ±‚çš„å¤§å°ï¼ˆä¾‹å¦‚ X çš„ 15%ï¼‰ï¼Œå¹¶å½¢æˆ X çš„å­é›† Yã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œä½œè€…é¦–å…ˆä»å‡ ä½•åˆ†å¸ƒ $l \sim Geo(p)$ä¸­é‡‡æ ·å¾—åˆ°åˆ†è¯çš„é•¿åº¦ï¼Œè¯¥å‡ ä½•åˆ†å¸ƒæ˜¯åæ€åˆ†å¸ƒï¼Œåå‘äºè¾ƒçŸ­çš„åˆ†è¯ã€‚ä¹‹åï¼Œä½œè€…éšæœºï¼ˆå‡åŒ€åœ°ï¼‰é€‰æ‹©åˆ†è¯çš„èµ·ç‚¹ã€‚</p>
<p>æ ¹æ®å‡ ä½•åˆ†å¸ƒï¼Œå…ˆéšæœºé€‰æ‹©ä¸€æ®µï¼ˆspanï¼‰çš„é•¿åº¦ï¼Œä¹‹åå†æ ¹æ®å‡åŒ€åˆ†å¸ƒéšæœºé€‰æ‹©è¿™ä¸€æ®µçš„èµ·å§‹ä½ç½®ï¼Œæœ€åæŒ‰ç…§é•¿åº¦é®ç›–ã€‚ä½œè€…è®¾å®šå‡ ä½•åˆ†å¸ƒå– p=0.2ï¼Œå¹¶è£å‰ªæœ€å¤§é•¿åº¦åªèƒ½æ˜¯ 10ï¼ˆä¸åº”å½“æ˜¯é•¿åº¦ 10 ä»¥ä¸Šä¿®å‰ªï¼Œè€Œåº”å½“ä¸ºä¸¢å¼ƒï¼‰ï¼Œåˆ©ç”¨æ­¤æ–¹æ¡ˆè·å¾—å¹³å‡é‡‡æ ·é•¿åº¦åˆ†å¸ƒã€‚å› æ­¤åˆ†è¯çš„å¹³å‡é•¿åº¦ä¸º 3.8 ã€‚ä½œè€…è¿˜æµ‹é‡äº†è¯è¯­ï¼ˆwordï¼‰ä¸­çš„åˆ†è¯ç¨‹åº¦ï¼Œä½¿å¾—æ·»åŠ æ©è†œçš„åˆ†è¯æ›´é•¿ã€‚ä¸‹å›¾å±•ç¤ºäº†åˆ†è¯æ©è†œé•¿åº¦çš„åˆ†å¸ƒæƒ…å†µã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/spanbert_fenci.png" alt="avatar"></p>
<p>å’Œåœ¨ BERT ä¸­ä¸€æ ·ï¼Œä½œè€…å°† Y çš„è§„æ¨¡è®¾å®šä¸º X çš„15%ï¼Œå…¶ä¸­ 80% ä½¿ç”¨ [MASK] è¿›è¡Œæ›¿æ¢ï¼Œ10% ä½¿ç”¨éšæœºå•è¯æ›¿æ¢ï¼Œ10%ä¿æŒä¸å˜ã€‚ä¸ä¹‹ä¸åŒçš„æ˜¯ï¼Œä½œè€…æ˜¯åœ¨åˆ†è¯çº§åˆ«è¿›è¡Œçš„è¿™ä¸€æ›¿æ¢ï¼Œè€Œéå°†æ¯ä¸ªå•è¯å•ç‹¬æ›¿æ¢ã€‚</p>
<h4 id="åˆ†è¯è¾¹ç•Œç›®æ ‡-SBO"><a href="#åˆ†è¯è¾¹ç•Œç›®æ ‡-SBO" class="headerlink" title="åˆ†è¯è¾¹ç•Œç›®æ ‡(SBO)???"></a>åˆ†è¯è¾¹ç•Œç›®æ ‡(SBO)???</h4><p>åˆ†è¯é€‰æ‹©æ¨¡å‹ä¸€èˆ¬ä½¿ç”¨å…¶è¾¹ç•Œè¯åˆ›å»ºä¸€ä¸ªå›ºå®šé•¿åº¦çš„åˆ†è¯è¡¨ç¤ºã€‚ä¸ºäº†äºè¯¥æ¨¡å‹ç›¸é€‚åº”ï¼Œä½œè€…å¸Œæœ›ç»“å°¾åˆ†è¯çš„è¡¨ç¤ºçš„æ€»å’Œä¸ä¸­é—´åˆ†è¯çš„å†…å®¹å°½é‡ç›¸åŒã€‚ä¸ºæ­¤ï¼Œä½œè€…å¼•å…¥äº† SBO ï¼Œå…¶ä»…ä½¿ç”¨è§‚æµ‹åˆ°çš„è¾¹ç•Œè¯æ¥é¢„æµ‹å¸¦æ©è†œçš„åˆ†è¯çš„å†…å®¹ã€‚</p>
<p>å…·ä½“åšæ³•æ˜¯ï¼Œåœ¨è®­ç»ƒæ—¶å– Span å‰åè¾¹ç•Œçš„ä¸¤ä¸ªè¯ï¼Œå€¼å¾—æŒ‡å‡ºï¼Œè¿™ä¸¤ä¸ªè¯ä¸åœ¨ Span å†…ï¼Œç„¶å<strong>ç”¨è¿™ä¸¤ä¸ªè¯å‘é‡åŠ ä¸Š Span ä¸­è¢«é®ç›–æ‰è¯çš„ä½ç½®å‘é‡ï¼Œæ¥é¢„æµ‹åŸè¯</strong>ã€‚</p>
<script type="math/tex; mode=display">
\mathbf{y}_{i}=f\left(\mathbf{x}_{s-1}, \mathbf{x}_{e+1}, \mathbf{p}_{i}\right)</script><p>è¯¦ç»†åšæ³•æ˜¯å°†è¯å‘é‡å’Œä½ç½®å‘é‡æ‹¼æ¥èµ·æ¥ï¼Œä½œè€…ä½¿ç”¨ä¸€ä¸ªä¸¤å±‚çš„å‰é¦ˆç¥ç»ç½‘ç»œä½œä¸ºè¡¨ç¤ºå‡½æ•°ï¼Œè¯¥ç½‘ç»œä½¿ç”¨ GeLu æ¿€æ´»å‡½æ•°ï¼Œå¹¶ä½¿ç”¨å±‚æ­£åˆ™åŒ–ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathbf{h} &=\text { LayerNorm }\left(\operatorname{GeLU}\left(W_{1} \cdot\left[\mathbf{x}_{s-1} ; \mathbf{x}_{e+1} ; \mathbf{p}_{i}\right]\right)\right) \\
f(\cdot) &=\text { LayerNorm }\left(\operatorname{GeLU}\left(W_{2} \cdot \mathbf{h}\right)\right)
\end{aligned}</script><p>ä½œè€…ä½¿ç”¨å‘é‡è¡¨ç¤º$y_i$æ¥é¢„æµ‹$x_i$ï¼Œå¹¶å’Œ MLM ä¸€æ ·ä½¿ç”¨äº¤å‰ç†µä½œä¸ºæŸå¤±å‡½æ•°ï¼Œå°±æ˜¯ SBO ç›®æ ‡çš„æŸå¤±ï¼Œä¹‹åå°†è¿™ä¸ªæŸå¤±å’Œ BERT çš„ <strong>Mased Language Model ï¼ˆMLMï¼‰</strong>çš„æŸå¤±åŠ èµ·æ¥ï¼Œä¸€èµ·ç”¨äºè®­ç»ƒæ¨¡å‹ã€‚</p>
<script type="math/tex; mode=display">
\mathcal{L}(\text { football })=\mathcal{L}_{\mathrm{MLM}}\left(\mathbf{x}_{7}\right)+\mathcal{L}_{\mathrm{SBO}}\left(\mathbf{x}_{4}, \mathbf{x}_{9}, \mathbf{p}_{7}\right)</script><h4 id="å•åºåˆ—è®­ç»ƒ"><a href="#å•åºåˆ—è®­ç»ƒ" class="headerlink" title="å•åºåˆ—è®­ç»ƒ"></a>å•åºåˆ—è®­ç»ƒ</h4><p>SpanBERT æ²¡ç”¨ Next Sentence Prediction (NSP) ä»»åŠ¡ï¼Œè€Œæ˜¯ç›´æ¥ç”¨ Single-Sequence Trainingï¼Œä¹Ÿå°±æ˜¯ä¸åŠ å…¥ NSP ä»»åŠ¡æ¥åˆ¤æ–­æ˜¯å¦ä¸¤å¥æ˜¯ä¸Šä¸‹å¥ï¼Œç›´æ¥ç”¨ä¸€å¥æ¥è®­ç»ƒï¼Œç‰‡æ®µé•¿åº¦æœ€å¤šä¸º512ä¸ªå•è¯ã€‚</p>
<h4 id="ç»†èŠ‚"><a href="#ç»†èŠ‚" class="headerlink" title="ç»†èŠ‚"></a>ç»†èŠ‚</h4><ol>
<li>è®­ç»ƒæ—¶ç”¨äº† <strong>Dynamic Masking</strong> è€Œä¸æ˜¯åƒ BERT åœ¨é¢„å¤„ç†æ—¶åš é™æ€Maskã€‚</li>
<li><strong>å–æ¶ˆ BERT ä¸­éšæœºé‡‡æ ·çŸ­å¥çš„ç­–ç•¥</strong></li>
<li>å¯¹Adamä¼˜åŒ–å™¨ä¸­çš„ä¸€äº›å‚æ•°åšäº†æ”¹å˜ã€‚</li>
</ol>
<h5 id="maskæœºåˆ¶"><a href="#maskæœºåˆ¶" class="headerlink" title="maskæœºåˆ¶"></a>maskæœºåˆ¶</h5><p>ä½œè€…åœ¨å­å•è¯ã€å®Œæ•´è¯è¯­ã€å‘½åå®ä½“ã€åè¯çŸ­è¯­å’Œéšæœºåˆ†è¯æ–¹é¢è¿›è¡Œäº†æ¯”è¾ƒï¼šå‘ç°ä½¿ç”¨éšæœºåˆ†è¯æ©è†œæœºåˆ¶æ•ˆæœæ›´ä¼˜ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/spanbert_token.png" alt="avatar"></p>
<h5 id="è¾…åŠ©ç›®æ ‡"><a href="#è¾…åŠ©ç›®æ ‡" class="headerlink" title="è¾…åŠ©ç›®æ ‡"></a>è¾…åŠ©ç›®æ ‡</h5><p>ä½¿ç”¨ SBO æ›¿æ¢ NSP å¹¶ä½¿ç”¨å•åºåˆ—è¿›è¡Œé¢„æµ‹çš„æ•ˆæœæ›´ä¼˜ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/spanbert_a_o.png" alt="avatar"></p>
<h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>SpanBERTæ˜¯åŸºäºåˆ†è¯çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œåœ¨å¤šä¸ªè¯„æµ‹ä»»åŠ¡ä¸­çš„å¾—åˆ†éƒ½è¶…è¶Šäº† BERT ä¸”åœ¨åˆ†è¯é€‰æ‹©ç±»ä»»åŠ¡ä¸­çš„æå‡å°¤å…¶æ˜æ˜¾ã€‚</p>
<h3 id="ERNIE"><a href="#ERNIE" class="headerlink" title="ERNIE"></a>ERNIE</h3><p><a href="https://arxiv.org/pdf/1905.07129" target="_blank" rel="noopener">è®ºæ–‡</a></p>
<h4 id="ç®€ä»‹-3"><a href="#ç®€ä»‹-3" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>æ— è®ºæ˜¯Elmoã€GPT, è¿˜æ˜¯èƒ½åŠ›æ›´å¼ºçš„ BERT æ¨¡å‹ï¼Œå…¶å»ºæ¨¡å¯¹è±¡ä¸»è¦èšç„¦åœ¨åŸå§‹è¯­è¨€ä¿¡å·ä¸Šï¼Œè¾ƒå°‘åˆ©ç”¨è¯­ä¹‰çŸ¥è¯†å•å…ƒå»ºæ¨¡ã€‚è¿™ä¸ªé—®é¢˜åœ¨ä¸­æ–‡æ–¹é¢å°¤ä¸ºæ˜æ˜¾ï¼Œä¾‹å¦‚ï¼ŒBERT åœ¨å¤„ç†ä¸­æ–‡è¯­è¨€æ—¶ï¼Œé€šè¿‡é¢„æµ‹æ±‰å­—è¿›è¡Œå»ºæ¨¡ï¼Œæ¨¡å‹å¾ˆéš¾å­¦å‡ºæ›´å¤§è¯­ä¹‰å•å…ƒçš„å®Œæ•´è¯­ä¹‰è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¹’ [mask] çƒï¼Œæ¸…æ˜ä¸Š [mask] å›¾ï¼Œ[mask] é¢œå…­è‰²è¿™äº›è¯ï¼ŒBERT æ¨¡å‹é€šè¿‡å­—çš„æ­é…ï¼Œå¾ˆå®¹æ˜“æ¨æµ‹å‡ºæ©ç çš„å­—ä¿¡æ¯ï¼Œä½†æ²¡æœ‰æ˜¾å¼åœ°å¯¹è¯­ä¹‰æ¦‚å¿µå•å…ƒ (å¦‚ä¹’ä¹“çƒã€æ¸…æ˜ä¸Šæ²³å›¾) ä»¥åŠå…¶å¯¹åº”çš„è¯­ä¹‰å…³ç³»è¿›è¡Œå»ºæ¨¡ã€‚å¦‚æœèƒ½å¤Ÿè®©æ¨¡å‹å­¦ä¹ åˆ°æµ·é‡æ–‡æœ¬ä¸­è•´å«çš„æ½œåœ¨çŸ¥è¯†ï¼ŒåŠ¿å¿…ä¼šè¿›ä¸€æ­¥æå‡å„ä¸ª NLP ä»»åŠ¡æ•ˆæœã€‚</p>
<p>ERNIE æ¨¡å‹é€šè¿‡å»ºæ¨¡æµ·é‡æ•°æ®ä¸­çš„å®ä½“æ¦‚å¿µç­‰å…ˆéªŒè¯­ä¹‰çŸ¥è¯†ï¼Œå­¦ä¹ çœŸå®ä¸–ç•Œçš„è¯­ä¹‰å…³ç³»ã€‚å…·ä½“æ¥è¯´ï¼ŒERNIE æ¨¡å‹é€šè¿‡å¯¹è¯ã€å®ä½“ç­‰è¯­ä¹‰å•å…ƒçš„æ©ç ï¼Œä½¿å¾—æ¨¡å‹å­¦ä¹ å®Œæ•´æ¦‚å¿µçš„è¯­ä¹‰è¡¨ç¤ºã€‚ç›¸è¾ƒäº BERT å­¦ä¹ åŸå§‹è¯­è¨€ä¿¡å·ï¼ŒERNIE ç›´æ¥å¯¹å…ˆéªŒè¯­ä¹‰çŸ¥è¯†å•å…ƒè¿›è¡Œå»ºæ¨¡ï¼Œå¢å¼ºäº†æ¨¡å‹è¯­ä¹‰è¡¨ç¤ºèƒ½åŠ›ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/ernie.png" alt="avatar"></p>
<p>åœ¨ BERT æ¨¡å‹ä¸­ï¼Œé€šè¿‡ã€å“ˆã€ä¸ã€æ»¨ã€çš„å±€éƒ¨å…±ç°ï¼Œå³å¯åˆ¤æ–­å‡ºã€å°”ã€å­—ï¼Œæ¨¡å‹æ²¡æœ‰å­¦ä¹ ä¸ã€å“ˆå°”æ»¨ã€ç›¸å…³çš„çŸ¥è¯†ã€‚è€Œ ERNIE é€šè¿‡å­¦ä¹ è¯ä¸å®ä½“çš„è¡¨è¾¾ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿå»ºæ¨¡å‡ºã€å“ˆå°”æ»¨ã€ä¸ã€é»‘é¾™æ±Ÿã€çš„å…³ç³»ï¼Œå­¦åˆ°ã€å“ˆå°”æ»¨ã€æ˜¯ã€é»‘é¾™æ±Ÿã€çš„çœä¼šä»¥åŠã€å“ˆå°”æ»¨ã€æ˜¯ä¸ªå†°é›ªåŸå¸‚ã€‚</p>
<h4 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/ernie_ar.png" alt="avatar"></p>
<p>æ¨¡å‹ä¸Šä¸»è¦çš„æ”¹è¿›æ˜¯åœ¨bertçš„åæ®µåŠ å…¥äº†å®ä½“å‘é‡å’Œç»è¿‡bertç¼–ç åçš„å‘é‡æ‹¼æ¥ï¼Œå¦å¤–åœ¨è¾“å‡ºæ—¶å¤šåŠ äº†å®ä½“è‡ªç¼–ç çš„ä»»åŠ¡ï¼Œä»è€Œå¸®åŠ©æ¨¡å‹æ³¨å…¥å®ä½“çŸ¥è¯†ä¿¡æ¯ã€‚</p>
<h5 id="T-Encoder"><a href="#T-Encoder" class="headerlink" title="T-Encoder"></a>T-Encoder</h5><p>è¿™éƒ¨åˆ†å°±æ˜¯çº¯ç²¹çš„bertç»“æ„ï¼Œåœ¨è¯¥éƒ¨åˆ†æ¨¡å‹ä¸­ä¸»è¦è´Ÿè´£å¯¹è¾“å…¥å¥å­ï¼ˆtoken embedding, segment embeddingå’Œpositional embeddingï¼‰è¿›è¡Œç¼–ç .</p>
<h5 id="K-Encoder"><a href="#K-Encoder" class="headerlink" title="K-Encoder"></a>K-Encoder</h5><p>å¼•å…¥å®ä½“ä¿¡æ¯ï¼Œä½¿ç”¨äº†TransEè®­ç»ƒå®ä½“å‘é‡ï¼Œå†é€šè¿‡å¤šå¤´Attentionè¿›è¡Œç¼–ç ï¼Œç„¶åé€šè¿‡å®ä½“å¯¹é½æŠ€æœ¯ï¼Œå°†å®ä½“å‘é‡åŠ å…¥åˆ°å¯¹åº”å®ä½“çš„ç¬¬ä¸€ä¸ªtokenç¼–ç åçš„å‘é‡ä¸Šã€‚ï¼ˆä¾‹å¦‚å§šæ˜æ˜¯ä¸€ä¸ªå®ä½“ï¼Œåœ¨è¾“å…¥æ—¶ä¼šè¢«åˆ†å‰²æˆå§šã€æ˜ï¼Œæœ€ååœ¨è¿™éƒ¨åˆ†å¼•å…¥çš„å§šæ˜è¿™ä¸ªå®ä½“çš„å‘é‡ä¼šè¢«åŠ å…¥åˆ°â€œå§šâ€è¿™ä¸ªå­—ç»è¿‡bertä¹‹åçš„å‘é‡ä¸Šå»ï¼‰</p>
<script type="math/tex; mode=display">
\begin{aligned}
\left\{\tilde{\boldsymbol{w}}_{1}^{(i)}, \ldots, \tilde{\boldsymbol{w}}_{n}^{(i)}\right\} &=\mathrm{MH}-\mathrm{ATT}\left(\left\{\boldsymbol{w}_{1}^{(i-1)}, \ldots, \boldsymbol{w}_{n}^{(i-1)}\right\}\right) \\
\left\{\tilde{\boldsymbol{e}}_{1}^{(i)}, \ldots, \tilde{\boldsymbol{e}}_{m}^{(i)}\right\} &=\mathrm{MH}-\mathrm{ATT}\left(\left\{\boldsymbol{e}_{1}^{(i-1)}, \ldots, \boldsymbol{e}_{m}^{(i-1)}\right\}\right)
\end{aligned}</script><p>ç”±äºç›´æ¥æ‹¼æ¥åå‘é‡ç»´åº¦ä¼šä¸å…¶ä»–æœªæ‹¼æ¥çš„å‘é‡ç»´åº¦ä¸åŒï¼Œæ‰€ä»¥åŠ å…¥information fusion layerï¼Œå¦å¤–è€ƒè™‘åˆ°åé¢çš„å®ä½“è‡ªç¼–ç ä»»åŠ¡ï¼Œæ‰€ä»¥è¿™é‡Œåœ¨èåˆä¿¡æ¯ä¹‹åï¼Œæœ‰å®ä½“å‘é‡åŠ å…¥çš„éƒ¨åˆ†éœ€è¦å¦å¤–å¤šè¾“å‡ºä¸€ä¸ªå®ä½“å‘é‡ã€‚</p>
<p>åŠ å…¥å®ä½“ä¿¡æ¯ä¹‹åçš„èåˆè¾“å‡ºè¿‡ç¨‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
\boldsymbol{h}_{j} &=\sigma\left(\tilde{\boldsymbol{W}}_{t}^{(i)} \tilde{\boldsymbol{w}}_{j}^{(i)}+\tilde{\boldsymbol{W}}_{e}^{(i)} \tilde{\boldsymbol{e}}_{k}^{(i)}+\tilde{\boldsymbol{b}}^{(i)}\right) \\
\boldsymbol{w}_{j}^{(i)} &=\sigma\left(\boldsymbol{W}_{t}^{(i)} \boldsymbol{h}_{j}+\boldsymbol{b}_{t}^{(i)}\right) \\
\boldsymbol{e}_{k}^{(i)} &=\sigma\left(\boldsymbol{W}_{e}^{(i)} \boldsymbol{h}_{j}+\boldsymbol{b}_{e}^{(i)}\right)
\end{aligned}</script><p>æœªåŠ å…¥å®ä½“ä¿¡æ¯ä¹‹åçš„èåˆè¾“å‡ºè¿‡ç¨‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
\boldsymbol{h}_{j} &=\sigma\left(\tilde{\boldsymbol{W}}_{t}^{(i)} \tilde{\boldsymbol{w}}_{j}^{(i)}+\tilde{\boldsymbol{b}}^{(i)}\right) \\
\boldsymbol{w}_{j}^{(i)} &=\sigma\left(\boldsymbol{W}_{t}^{(i)} \boldsymbol{h}_{j}+\boldsymbol{b}_{t}^{(i)}\right)
\end{aligned}</script><h5 id="å®ä½“è‡ªç¼–ç "><a href="#å®ä½“è‡ªç¼–ç " class="headerlink" title="å®ä½“è‡ªç¼–ç ????"></a>å®ä½“è‡ªç¼–ç ????</h5><p>ä¸ºäº†æ›´å¥½åœ°ä½¿ç”¨å®ä½“ä¿¡æ¯ï¼Œä½œè€…åœ¨è¿™é‡Œå¤šåŠ å…¥äº†ä¸€ä¸ªé¢„è®­ç»ƒä»»åŠ¡ entity auto-encoder(dEA)ã€‚</p>
<script type="math/tex; mode=display">
p\left(e_{j} | w_{i}\right)=\frac{\exp \left(\operatorname{linear}\left(\boldsymbol{w}_{i}^{o}\right) \cdot \boldsymbol{e}_{j}\right)}{\sum_{k=1}^{m} \exp \left(\operatorname{linear}\left(\boldsymbol{w}_{i}^{o}\right) \cdot \boldsymbol{e}_{k}\right)}</script><p>è¯¥é¢„è®­ç»ƒä»»åŠ¡å’Œbertç›¸ä¼¼ï¼ŒæŒ‰ä»¥ä¸‹æ–¹å¼è¿›è¡Œè®­ç»ƒï¼š</p>
<ol>
<li>15% çš„æƒ…å†µä¸‹ï¼šç”¨ [MASK] æ›¿æ¢è¢«é€‰æ‹©çš„å•è¯ï¼Œä¾‹å¦‚ï¼Œmy dog is hairy â†’ my dog is [MASK]</li>
<li>5% çš„æƒ…å†µä¸‹ï¼šç”¨ä¸€ä¸ªéšæœºå•è¯æ›¿æ¢è¢«é€‰æ‹©çš„å•è¯ï¼Œä¾‹å¦‚ï¼Œmy dog is hairy â†’ my dog is apple</li>
<li>80% çš„æƒ…å†µä¸‹ï¼šä¿æŒè¢«é€‰æ‹©çš„å•è¯ä¸å˜ï¼Œä¾‹å¦‚ï¼Œmy dog is hairy â†’ my dog is hairy</li>
</ol>
<h5 id="Extra-task"><a href="#Extra-task" class="headerlink" title="Extra-task"></a>Extra-task</h5><p>é™¤äº†æ­£å¸¸çš„ä»»åŠ¡ä¹‹å¤–ï¼ŒERNIEå¼•å…¥äº†ä¸¤ä¸ªæ–°ä»»åŠ¡Entity Typingå’ŒRelation Classification</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/ernie_extra_task.png" alt="avatar"></p>
<h5 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/ernie_experiment.png" alt="avatar"></p>
<p>ERNIEåœ¨é€šç”¨ä»»åŠ¡å…¶å®ç›¸æ¯”bertä¼˜åŠ¿ä¸å¤§ï¼Œå°½ç®¡æ–‡ç« æåˆ°äº†ERNIEæ›´é²æ£’ä»¥åŠGLUEçš„è¯„ä¼°å¯¹ERNIEä¸æ˜¯å¾ˆå‹å¥½ï¼Œåœ¨å¢åŠ å¤æ‚åº¦çš„åŒæ—¶ï¼Œå¹¶æ²¡æœ‰å–å¾—æœŸå¾…çš„æ•ˆæœã€‚ERNIEæä¾›äº†ä¸€ç§å¾ˆå¥½çš„å®ä½“ä¿¡æ¯å¼•å…¥æ€è·¯ï¼Œå¹¶ä¸”å…¶æ–°æå‡ºçš„é¢„è®­ç»ƒæ–¹æ³•ä¹Ÿç»™å¸Œæœ›å°†bertè¿™ä¸€æ¨¡å‹å¼•å…¥å…³ç³»æŠ½å–é¢†åŸŸæä¾›äº†å¾ˆå¥½çš„ä¾‹å­ã€‚</p>
<h3 id="MT-DNNï¼ˆé¢„è®­ç»ƒ-å¤šä»»åŠ¡ï¼‰"><a href="#MT-DNNï¼ˆé¢„è®­ç»ƒ-å¤šä»»åŠ¡ï¼‰" class="headerlink" title="MT-DNNï¼ˆé¢„è®­ç»ƒ+å¤šä»»åŠ¡ï¼‰"></a>MT-DNNï¼ˆé¢„è®­ç»ƒ+å¤šä»»åŠ¡ï¼‰</h3><p><a href="https://arxiv.org/pdf/1901.11504.pdf" target="_blank" rel="noopener">è®ºæ–‡</a>,<a href="https://github.com/namisan/mt-dnn" target="_blank" rel="noopener">æºç </a></p>
<h4 id="ç®€ä»‹-4"><a href="#ç®€ä»‹-4" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>å­¦ä¹ æ–‡æœ¬çš„å‘é‡ç©ºé—´è¡¨ç¤ºï¼Œæ˜¯è®¸å¤šè‡ªç„¶è¯­è¨€ç†è§£(NLU)ä»»åŠ¡çš„åŸºç¡€ã€‚ä¸¤ç§æµè¡Œçš„æ–¹æ³•æ˜¯<strong>å¤šä»»åŠ¡å­¦ä¹ </strong>å’Œ<strong>è¯­è¨€æ¨¡å‹çš„é¢„è®­ç»ƒ</strong>ã€‚MT-DNNé€šè¿‡æå‡ºä¸€ç§æ–°çš„å¤šä»»åŠ¡æ·±åº¦ç¥ç»ç½‘ç»œï¼ˆMT-DNNï¼‰æ¥ç»¼åˆä¸¤ç§æ–¹æ³•çš„ä¼˜ç‚¹ã€‚</p>
<p><strong>é¢„è®­ç»ƒ</strong>ï¼Œå¦‚BERTã€GPTç­‰ï¼Œå°±ä¸å¤šè¯´äº†ã€‚</p>
<p><strong>å¤šä»»åŠ¡</strong>å­¦ä¹ ( MTL )çš„çµæ„Ÿæ¥è‡ªäºäººçš„å­¦ä¹ æ´»åŠ¨ã€‚åœ¨äººç±»çš„å­¦ä¹ æ´»åŠ¨ä¸­ï¼Œäººä»¬ç»å¸¸åº”ç”¨ä»ä»¥å‰çš„ä»»åŠ¡ä¸­å­¦åˆ°çš„çŸ¥è¯†æ¥å¸®åŠ©å­¦ä¹ æ–°çš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œåœ¨å­¦ä¹ æ»‘å†°è¿™ä»¶äº‹æƒ…ä¸Šï¼Œä¸€ä¸ªçŸ¥é“å¦‚ä½•æ»‘é›ªçš„äººæ¯”ä»€ä¹ˆéƒ½ä¸çŸ¥é“çš„äººå®¹æ˜“ã€‚åŒæ ·ï¼Œ<strong>è”åˆå­¦ä¹ å¤šä¸ª(ç›¸å…³)</strong>ä»»åŠ¡ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œè¿™æ ·åœ¨ä¸€ä¸ªä»»åŠ¡ä¸­å­¦ä¹ åˆ°çš„çŸ¥è¯†æœ‰ç›Šäºå…¶ä»–ä»»åŠ¡ã€‚å¯¹äºMTLï¼ˆMulti-task Learningï¼Œå¤šä»»åŠ¡å­¦ä¹ ï¼‰æ¥è¯´ï¼Œå…¶ä¼˜ç‚¹æœ‰ä¸¤ä¸ªï¼š1ï¼‰å¼¥è¡¥äº†æœ‰äº›ä»»åŠ¡çš„æ•°æ®ä¸è¶³é—®é¢˜ï¼›2ï¼‰æœ‰æ­£åˆ™çš„ä½œç”¨ï¼Œé˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆã€‚</p>
<p><strong>ä¸¤è€…ç»“åˆ</strong>ï¼ˆå¼ºå¼ºè”æ‰‹ï¼ï¼‰ï¼šMT-DNNè®¤ä¸ºï¼ŒMTLå’Œpretrainæœ‰å¾ˆå¥½çš„äº’è¡¥ä½œç”¨ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯å¯ä»¥ç»“åˆä¸€ä¸‹ï¼Œå‘æŒ¥ä¸¤è€…çš„ä½œç”¨ã€‚æ›´å…·ä½“çš„å°±æ˜¯ï¼Œå…ˆç”¨BERTè¿›è¡Œpretrainï¼Œç„¶åç”¨MTLè¿›è¡Œfinetuneï¼Œè¿™å°±å½¢æˆäº†MT-DNNã€‚å¯è§ï¼Œä¸BERTçš„ä¸åŒåœ¨äºfinetuneçš„è¿‡ç¨‹ï¼Œè¿™é‡Œç”¨MTLä½œä¸ºç›®æ ‡ã€‚</p>
<h4 id="æ¨¡å‹-1"><a href="#æ¨¡å‹-1" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/mtdnn.png" alt="avatar"></p>
<p>è¡¨å¾å­¦ä¹  MT-DNN æ¨¡å‹çš„æ¶æ„ã€‚ä¸‹é¢çš„ç½‘ç»œå±‚åœ¨æ‰€æœ‰ä»»åŠ¡ä¸­éƒ½å…±äº«ï¼Œä¸Šé¢çš„ä¸¤å±‚æ˜¯é’ˆå¯¹ç‰¹å®šä»»åŠ¡ã€‚è¾“å…¥$X$(ä¸€å¥è¯æˆ–å¥å­å¯¹)é¦–å…ˆè¡¨å¾ä¸ºä¸€ä¸ªåºåˆ—çš„åµŒå…¥å‘é‡ï¼Œåœ¨$l_1$  ä¸­æ¯ä¸ªè¯å¯¹åº”ä¸€ä¸ªå‘é‡ã€‚ç„¶å Transformer ç¼–ç å™¨æ•æ‰æ¯ä¸ªå•è¯çš„è¯­å¢ƒä¿¡æ¯å¹¶åœ¨$l_2$ä¸­ç”Ÿæˆå…±äº«çš„è¯­å¢ƒåµŒå…¥å‘é‡ã€‚æœ€åï¼Œé’ˆå¯¹æ¯ä¸ªä»»åŠ¡ï¼Œç‰¹å®šä»»åŠ¡å±‚ç”Ÿæˆç‰¹å®šä»»åŠ¡çš„è¡¨å¾ï¼Œè€Œåæ˜¯åˆ†ç±»ã€ç›¸ä¼¼æ€§æ‰“åˆ†ã€å…³è”æ’åºç­‰å¿…éœ€çš„æ“ä½œã€‚</p>
<h5 id="å¤šä»»åŠ¡"><a href="#å¤šä»»åŠ¡" class="headerlink" title="å¤šä»»åŠ¡"></a>å¤šä»»åŠ¡</h5><p>MT-DNNæ˜¯ç»“åˆäº†4ç§ç±»å‹çš„NLUä»»åŠ¡ï¼šå•å¥åˆ†ç±»ã€å¥å­å¯¹åˆ†ç±»ã€æ–‡æœ¬ç›¸ä¼¼åº¦æ‰“åˆ†å’Œç›¸å…³åº¦æ’åºã€‚</p>
<ul>
<li>å•å¥åˆ†ç±»ï¼šCoLAä»»åŠ¡æ˜¯é¢„æµ‹è‹±è¯­å¥å­æ˜¯å¦åˆä¹è¯­æ³•ï¼ŒSST-2ä»»åŠ¡é¢„æµ‹ç”µå½±è¯„è®ºæ˜¯æ­£å‘è¿˜æ˜¯è´Ÿå‘ã€‚</li>
<li>æ–‡æœ¬ç›¸ä¼¼åº¦ï¼šè¿™æ˜¯ä¸€ä¸ªå›å½’ä»»åŠ¡ã€‚å¯¹äºç»™å®šçš„å¥å­å¯¹ï¼Œæ¨¡å‹è®¡ç®—äºŒè€…ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚åœ¨GLUEä¸­åªæœ‰STS-Bè¿™ä¸ªä»»åŠ¡æ˜¯å¤„ç†æ–‡æœ¬ç›¸ä¼¼åº¦ã€‚</li>
<li>æˆå¯¹æ–‡æœ¬åˆ†ç±»ï¼ˆæ–‡æœ¬è•´å«ï¼‰ï¼šå¯¹äºç»™å®šçš„å¥å­å¯¹ï¼Œæ¨ç†ä¸¤ä¸ªå¥å­ä¹‹é—´çš„å…³ç³»ã€‚RETå’ŒMNLIæ˜¯è¯­è¨€æ¨ç†ä»»åŠ¡ï¼Œæ¨ç†å¥å­ä¹‹é—´æ˜¯å¦å­˜åœ¨è•´å«å…³ç³»ã€çŸ›ç›¾çš„å…³ç³»æˆ–è€…ä¸­ç«‹å…³ç³»ã€‚QQPå’ŒMRPCæ˜¯é¢„æµ‹å¥å­æ˜¯å¦è¯­ä¹‰ç­‰ä»·ã€‚</li>
<li>ç›¸å…³æ€§æ’åºï¼šç»™å®šä¸€ä¸ªé—®é¢˜å’Œä¸€ç³»åˆ—å€™é€‰ç­”æ¡ˆï¼Œæ¨¡å‹æ ¹æ®é—®é¢˜å¯¹æ‰€æœ‰å€™é€‰ç­”æ¡ˆè¿›è¡Œæ’åºã€‚QNLIæ˜¯æ–¯å¦ç¦é—®ç­”æ•°æ®é›†çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œä»»åŠ¡æ˜¯é¢„æµ‹å€™é€‰ç­”æ¡ˆä¸­æ˜¯å¦åŒ…å«å¯¹é—®é¢˜çš„æ­£ç¡®ç­”æ¡ˆã€‚å°½ç®¡è¿™æ˜¯ä¸€ä¸ªäºŒåˆ†ç±»ä»»åŠ¡ï¼Œä½†æˆ‘ä»¬ä¾æ—§æŠŠå®ƒå½“ä½œæ’åºä»»åŠ¡ï¼Œå› ä¸ºæ¨¡å‹é‡æ’äº†å€™é€‰ç­”æ¡ˆï¼Œå°†æ­£ç¡®ç­”æ¡ˆæ’åœ¨æ›´å‰ã€‚</li>
</ul>
<h6 id="å•å¥åˆ†ç±»"><a href="#å•å¥åˆ†ç±»" class="headerlink" title="å•å¥åˆ†ç±»"></a>å•å¥åˆ†ç±»</h6><p>ç”¨[CLS]çš„è¡¨å¾ä½œä¸ºç‰¹å¾ï¼Œè®¾ä¸º$x$ï¼Œåˆ™å¯¹äºå•å¥çš„åˆ†ç±»ä»»åŠ¡ï¼Œç›´æ¥åœ¨åé¢æ¥å…¥ä¸€ä¸ªåˆ†ç±»å±‚å³å¯.</p>
<script type="math/tex; mode=display">
P_{r}(c | X)=\operatorname{softmax}\left(W^{T} \cdot x\right)</script><p>lossæ˜¯äº¤å‰ç†µæŸå¤±ï¼š</p>
<script type="math/tex; mode=display">
-\sum_{c} I(X, c) \log \left(P_{r}(c | X)\right)</script><h6 id="å¥å­ç›¸ä¼¼åº¦"><a href="#å¥å­ç›¸ä¼¼åº¦" class="headerlink" title="å¥å­ç›¸ä¼¼åº¦"></a>å¥å­ç›¸ä¼¼åº¦</h6><p>å°†ä¸¤å¥è¯packåé€è¿›å»ï¼Œå¾—åˆ°çš„[CLS]çš„è¡¨å¾ï¼Œå¯æ‹¿å‡ºæ¥è®¡ç®—åˆ†æ•°ï¼š</p>
<script type="math/tex; mode=display">
\operatorname{sim}\left(X_{1}, X_{2}\right)=\operatorname{sigmoid}\left(w^{T} \cdot x\right)</script><p>lossæ˜¯MSEï¼š</p>
<script type="math/tex; mode=display">
\left(y-\operatorname{Sim}\left(X_{1}, X_{2}\right)\right)^{2}</script><h6 id="å¥å­å¯¹åˆ†ç±»"><a href="#å¥å­å¯¹åˆ†ç±»" class="headerlink" title="å¥å­å¯¹åˆ†ç±»"></a>å¥å­å¯¹åˆ†ç±»</h6><p>å¯¹è¿™ä¸ªä»»åŠ¡ä¸ç†Ÿæ‚‰ã€‚ã€‚ã€‚</p>
<h6 id="ç›¸å…³æ€§æ’åº"><a href="#ç›¸å…³æ€§æ’åº" class="headerlink" title="ç›¸å…³æ€§æ’åº"></a>ç›¸å…³æ€§æ’åº</h6><p>å…ˆè®¡ç®—ä¸¤ä¸ªå¥å­ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œè¾“å…¥ä¸¤ä¸ªå¥å­packï¼Œé‡‡ç”¨[CLS]çš„è¾“å‡ºä½œä¸ºè¡¨å¾ã€‚</p>
<script type="math/tex; mode=display">
\operatorname{Rel}(Q, A)=g\left(w^{T} \cdot x\right)</script><p>lossé‡‡ç”¨æ’åºæŸå¤±ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
&-\sum_{Q, A^{+}} P_{r}\left(A^{+} | Q\right) \\
P_{r}\left(A^{+} | Q\right) &=\frac{\exp \left(\gamma \operatorname{Rel}\left(Q, A^{+}\right)\right)}{\sum_{A^{\prime} \in A} \exp \left(\gamma \operatorname{Rel}\left(Q, A^{\prime}\right)\right)}
\end{aligned}</script><h5 id="è®­ç»ƒè¿‡ç¨‹"><a href="#è®­ç»ƒè¿‡ç¨‹" class="headerlink" title="è®­ç»ƒè¿‡ç¨‹"></a>è®­ç»ƒè¿‡ç¨‹</h5><p>MT-DNN çš„è®­ç»ƒç¨‹åºåŒ…å«ä¸¤ä¸ªé˜¶æ®µï¼šé¢„è®­ç»ƒå’Œå¤šä»»åŠ¡å¾®è°ƒã€‚</p>
<ol>
<li>é¢„è®­ç»ƒé˜¶æ®µéµå¾ª BERT æ¨¡å‹çš„æ–¹å¼ã€‚lexicon encoderå’ŒTransformer encoderå‚æ•°çš„å­¦ä¹ æ˜¯é€šè¿‡ä¸¤ä¸ªæ— ç›‘ç£é¢„æµ‹ä»»åŠ¡ï¼šæ©ç è¯­è¨€å»ºæ¨¡(masked language modeling)å’Œä¸‹ä¸€å¥é¢„æµ‹(next sentence pre-<br>diction)ã€‚</li>
<li>åœ¨å¤šä»»åŠ¡å¾®è°ƒé˜¶æ®µï¼Œä½¿ç”¨åŸºäºminibatchçš„éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰æ¥å­¦ä¹ æ¨¡å‹å‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ï¼Œæ‰€æœ‰å…±äº«å±‚å’Œä»»åŠ¡ç‰¹å®šå±‚çš„å‚æ•°ï¼‰ï¼Œç®—æ³•æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ¯ä¸ªepochï¼Œé€‰æ‹©ä¸€ä¸ªmini-batch $b_t$(åœ¨9ä¸ªGLUEä»»åŠ¡ä¸­)ï¼Œå†å¯¹ç‰¹å®šä»»åŠ¡$k$è¿›è¡Œæ¨¡å‹å‚æ•°çš„æ›´æ–°ã€‚è¿™è¿‘ä¼¼åœ°ä¼˜åŒ–æ‰€æœ‰å¤šä»»åŠ¡çš„å’Œã€‚</li>
</ol>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/mtdnn_al.png" alt="avatar"></p>
<h3 id="DistilBERT"><a href="#DistilBERT" class="headerlink" title="DistilBERT"></a>DistilBERT</h3><p><a href="https://arxiv.org/pdf/1910.01108" target="_blank" rel="noopener">è®ºæ–‡</a></p>
<h4 id="åŠ¨æœº-1"><a href="#åŠ¨æœº-1" class="headerlink" title="åŠ¨æœº"></a>åŠ¨æœº</h4><p>é¢„è®­ç»ƒçš„è¯­è¨€æ¨¡å‹æ­£å˜å¾—æ—¥ç›Šåºå¤§ï¼Œè¿™äº›åºå¤§çš„æ¨¡å‹å°½ç®¡èƒ½å¤Ÿå¸¦æ¥å‡†ç¡®ç‡çš„æå‡ï¼Œä½†æ˜¯åœ¨è¿™äº›é¢„è®­ç»ƒæ¨¡å‹æŠ•å…¥ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€éœ€è¦å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œè€Œè¿™éœ€è¦å¤§é‡çš„èµ„æºï¼Œè€Œä¸”æ¨¡å‹æŠ•å…¥ä½¿ç”¨çš„æ—¶å€™ï¼Œç”±äºè®¡ç®—é‡å·¨å¤§ï¼Œæ¨¡å‹å¤„ç†æ•°æ®çš„æ—¶å»¶è¿‡é•¿ã€‚ä¸€ç§æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯å¯¹æ¨¡å‹è¿›è¡Œå‹ç¼©ã€‚</p>
<h4 id="æ¨¡å‹å‹ç¼©çš„æ–¹æ³•"><a href="#æ¨¡å‹å‹ç¼©çš„æ–¹æ³•" class="headerlink" title="æ¨¡å‹å‹ç¼©çš„æ–¹æ³•"></a>æ¨¡å‹å‹ç¼©çš„æ–¹æ³•</h4><ol>
<li><p>é‡åŒ–</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/quantization.jpg" alt="avatar"></p>
</li>
</ol>
<p>é‡åŒ–æ–¹æ³•æ„å‘³ç€é™ä½æ¨¡å‹æƒé‡çš„ç²¾åº¦ã€‚æ¯”å¦‚K-means é‡åŒ–æ–¹æ³•ï¼šå¯¹æ¨¡å‹æƒé‡çŸ©é˜µWè¿›è¡Œåˆ†ç»„ï¼Œåˆ†æˆnç°‡ï¼Œç„¶åæŠŠæƒé‡çŸ©é˜µé‡Œçš„å€¼è½¬åŒ–æˆ$1,\cdots,n$çš„æ­£æ•°ã€‚é€šè¿‡è¿™ç§æ–¹å¼æŠŠçŸ©é˜µä¸­çš„32ä½çš„floatå‹è½¬åŒ–æˆåªæœ‰8ä½ï¼ˆæˆ–è€…1ä½ï¼Œbinarizing matrixï¼‰çš„æ•´æ•°ã€‚</p>
<h5 id="è£å‰ªï¼ˆPruningï¼‰"><a href="#è£å‰ªï¼ˆPruningï¼‰" class="headerlink" title="è£å‰ªï¼ˆPruningï¼‰"></a>è£å‰ªï¼ˆPruningï¼‰</h5><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/Pruning.png" alt="avatar"></p>
<h6 id="weight-pruning"><a href="#weight-pruning" class="headerlink" title="weight pruning"></a>weight pruning</h6><p>   æŠŠæƒé‡çŸ©é˜µä¸­æ•°å€¼è¾ƒå¤§çš„å€¼è®¾ç½®ä¸º0ï¼Œä»è€Œæ„é€ ç¨€ç–çŸ©é˜µã€‚ï¼ˆç†è®ºä¸Šç¨€ç–çŸ©é˜µä¹˜æ³•é€Ÿåº¦å¿«äºnormal(danse)çŸ©é˜µä¹˜æ³•ã€‚ï¼‰</p>
<h6 id="Removing-neurons"><a href="#Removing-neurons" class="headerlink" title="Removing neurons"></a>Removing neurons</h6><p>   ç›´æ¥åˆ é™¤æƒé‡çŸ©é˜µä¸­ä¸é‡è¦çš„çš„æŸä¸€è¡Œæˆ–æŸä¸€åˆ—ã€‚ï¼ˆåˆ é™¤å’Œfine-tuneäº¤æ›¿è¿›è¡Œï¼Œè¿™æ ·å‰©ä¸‹çš„ç¥ç»å…ƒåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥å¼¥è¡¥è¢«åˆ é™¤çš„ç¥ç»å…ƒï¼‰</p>
<h6 id="Removing-weight-matrices"><a href="#Removing-weight-matrices" class="headerlink" title="Removing weight matrices"></a>Removing weight matrices</h6><p>   [10]ä»big transformersä¸­ç›´æ¥åˆ é™¤å¯¹accuracyè´¡çŒ®ä¸å¤§çš„æ•´ä¸ªattention headã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¸èƒ½ä¿è¯èƒ½å¤Ÿå¹¶è¡ŒåŠ é€Ÿï¼Œå› ä¸ºç›¸é‚»çš„æƒé‡çŸ©é˜µçš„sizeå˜çš„ä¸åŒäº†ã€‚</p>
<h5 id="çŸ¥è¯†è’¸é¦"><a href="#çŸ¥è¯†è’¸é¦" class="headerlink" title="çŸ¥è¯†è’¸é¦"></a>çŸ¥è¯†è’¸é¦</h5><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/Knowledge-distillation.jpg" alt="avatar"></p>
<p>DistilBertä½¿ç”¨æ¨¡å‹è’¸é¦æŠ€æœ¯ï¼šè¿™æ˜¯ä¸€ç§èƒ½å¤Ÿå°†å¤§å‹æ¨¡å‹ï¼ˆè¢«ç§°ä¸ºã€Œè€å¸ˆã€ï¼‰å‹ç¼©ä¸ºè¾ƒå°æ¨¡å‹ï¼ˆå³ã€Œå­¦ç”Ÿã€ï¼‰çš„æŠ€æœ¯ã€‚</p>
<p><a href="https://blog.csdn.net/nature553863/article/details/80568658" target="_blank" rel="noopener">çŸ¥è¯†è’¸é¦æ–¹æ³•</a></p>
<h6 id="çŸ¥è¯†è’¸é¦ï¼šè¿ç§»æ³›åŒ–èƒ½åŠ›"><a href="#çŸ¥è¯†è’¸é¦ï¼šè¿ç§»æ³›åŒ–èƒ½åŠ›" class="headerlink" title="çŸ¥è¯†è’¸é¦ï¼šè¿ç§»æ³›åŒ–èƒ½åŠ›"></a>çŸ¥è¯†è’¸é¦ï¼šè¿ç§»æ³›åŒ–èƒ½åŠ›</h6><p>çŸ¥è¯†è’¸é¦æ˜¯ä¸€ç§å‹ç¼©æŠ€æœ¯ï¼Œè¦æ±‚å¯¹å°å‹æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œä»¥ä½¿å…¶æ‹¥æœ‰ç±»ä¼¼äºå¤§å‹æ¨¡å‹çš„è¡Œä¸ºç‰¹å¾ã€‚åœ¨ç›‘ç£å­¦ä¹ é¢†åŸŸï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒåˆ†ç±»æ¨¡å‹æ—¶å¾€å¾€ä¼šåˆ©ç”¨å¯¹æ•°ä¼¼ç„¶ä¿¡å·å®ç°æ¦‚ç‡æœ€å¤§åŒ–ï¼ˆlogits çš„ softmaxï¼‰ï¼Œè¿›è€Œé¢„æµ‹å‡ºæ­£ç¡®ç±»ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ€§èƒ½è‰¯å¥½çš„æ¨¡å‹èƒ½å¤Ÿåˆ©ç”¨å…·æœ‰é«˜æ¦‚ç‡çš„æ­£ç¡®ç±»é¢„æµ‹è¾“å‡ºåˆ†å¸ƒï¼ŒåŒæ—¶å…¶å®ƒç±»çš„å‘ç”Ÿæ¦‚ç‡åˆ™æ¥è¿‘äºé›¶ã€‚</p>
<p><strong>ä½†æ˜¯ï¼ŒæŸäº›â€œæ¥è¿‘äºé›¶â€çš„æ¦‚ç‡è¦æ¯”å…¶å®ƒæ¦‚ç‡æ›´å¤§ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šåæ˜ å‡ºæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›</strong>ã€‚ä¾‹å¦‚ï¼ŒæŠŠæ™®é€šæ¤…å­è¯¯è®¤ä¸ºæ‰¶æ‰‹æ¤…è™½ç„¶å±äºé”™è¯¯ï¼Œä½†è¿™ç§é”™è¯¯è¿œæ¯”å°†å…¶è¯¯è®¤ä¸ºè˜‘è‡æ¥å¾—è½»å¾®ã€‚è¿™ç§ä¸ç¡®å®šæ€§ï¼Œæœ‰æ—¶è¢«ç§°ä¸ºâ€œæš—çŸ¥è¯†â€ã€‚ä¹Ÿå¯ä»¥ä»å¦ä¸€ä¸ªè§’åº¦æ¥ç†è§£è’¸é¦â€”â€”ç”¨äºé˜²æ­¢æ¨¡å‹å¯¹é¢„æµ‹ç»“æœå¤ªè¿‡ç¡®å®šï¼ˆç±»ä¼¼äºæ ‡ç­¾å¹³æ»‘ï¼‰ã€‚</p>
<p>åœ¨è¯­è¨€å»ºæ¨¡å½“ä¸­ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹è¯æ±‡è¡¨ä¸­çš„åˆ†å¸ƒè½»æ¾è§‚å¯Ÿåˆ°è¿™ç§ä¸ç¡®å®šæ€§ã€‚ä¸‹å›¾ä¸º BERT å¯¹ã€Šå¡è¨å¸ƒå…°å¡ã€‹ç”µå½±å½“ä¸­ç»å…¸å°è¯ä¸‹ä¸€å¥ç”¨è¯çš„çŒœæµ‹ï¼š</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/next_word.png" alt="avatar"></p>
<p>BERT æå‡ºçš„ 20 å¤§é«˜æ¦‚ç‡ç”¨è¯çŒœæµ‹ç»“æœã€‚è¯­è¨€æ¨¡å‹ç¡®å®šäº†ä¸¤ä¸ªå¯èƒ½æ€§æœ€é«˜çš„é€‰é¡¹ï¼ˆday ä¸ lifeï¼‰ï¼Œæ¥ä¸‹æ¥çš„è¯æ±‡ç›¸æ¯”ä¹‹ä¸‹æ¦‚ç‡è¦ä½å¾—å¤šã€‚</p>
<h6 id="å¦‚ä½•å¤åˆ¶è¿™äº›â€œæš—çŸ¥è¯†â€"><a href="#å¦‚ä½•å¤åˆ¶è¿™äº›â€œæš—çŸ¥è¯†â€" class="headerlink" title="å¦‚ä½•å¤åˆ¶è¿™äº›â€œæš—çŸ¥è¯†â€"></a>å¦‚ä½•å¤åˆ¶è¿™äº›â€œæš—çŸ¥è¯†â€</h6><p>åœ¨è®­ç»ƒå½“ä¸­ï¼Œé€šè¿‡è®­ç»ƒå­¦ç”Ÿç½‘ç»œï¼Œæ¥æ¨¡æ‹Ÿè€å¸ˆç½‘ç»œçš„å…¨éƒ¨è¾“å‡ºåˆ†å¸ƒï¼ˆä¹Ÿå°±æ˜¯çŸ¥è¯†ï¼‰ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡åŒ¹é…è¾“å‡ºåˆ†å¸ƒçš„æ–¹å¼è®­ç»ƒå­¦ç”Ÿç½‘ç»œï¼Œä»è€Œå®ç°ä¸è€å¸ˆç½‘ç»œç›¸åŒçš„æ³›åŒ–æ–¹å¼ï¼Œå³é€šè¿‡è½¯ç›®æ ‡ï¼ˆè€å¸ˆæ¦‚ç‡ï¼‰å°†äº¤å‰ç†µä»è€å¸ˆå¤„ä¼ é€’ç»™å­¦ç”Ÿã€‚</p>
<script type="math/tex; mode=display">
L=-\sum_{i} t_{i} * \log \left(s_{i}\right)</script><p>å…¶ä¸­ $t_i$ä¸ºæ¥è‡ªè€å¸ˆçš„ $logit$ï¼Œ$s_i$ ä¸ºå­¦ç”Ÿçš„ $logit$ã€‚ä»¥è€å¸ˆçš„è¡Œä¸º$t_i$ä½œä¸ºæ ‡ç­¾ï¼Œè®©å­¦ç”Ÿå»å­¦ä¹ è€å¸ˆçš„è¡Œä¸ºã€‚<strong>è¿™ä¸ªæŸå¤±å‡½æ•°å±äºæ›´ä¸°å¯Œçš„è®­ç»ƒä¿¡å·ï¼Œå› ä¸ºå•ä¸€ç¤ºä¾‹è¦æ¯”å•ä¸€ç¡¬ç›®æ ‡æ‹¥æœ‰æ›´é«˜çš„å¼ºåˆ¶çº¦æŸæ•ˆæœã€‚</strong>ä¸ºäº†è¿›ä¸€æ­¥æ­ç¤ºåˆ†ç±»ç»“æœçš„è´¨é‡ï¼ŒHinton ç­‰äººæå‡ºäº† softmax æ¸©åº¦çš„æ¦‚å¿µï¼š</p>
<script type="math/tex; mode=display">
p_{i}=\frac{\exp \left(z_{i} / T\right)}{\sum_{j} \exp \left(z_{j} / T\right)}</script><p>T ä¸ºæ¸©åº¦å‚æ•°ã€‚å½“$T \rightarrow 0$æ—¶ï¼Œåˆ†å¸ƒå˜ä¸º Kroneckerï¼ˆç›¸å½“äºç‹¬çƒ­ç›®æ ‡çŸ¢é‡ï¼‰ï¼›å½“ $T \rightarrow +\infty$æ—¶ï¼Œåˆ™å˜ä¸ºå‡åŒ€åˆ†å¸ƒã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå°†ç›¸åŒçš„æ¸©åº¦å‚æ•°åº”ç”¨äºå­¦ç”Ÿä¸è€å¸ˆç½‘ç»œï¼Œå³å¯è¿›ä¸€æ­¥ä¸ºæ¯ä¸ªè®­ç»ƒç¤ºä¾‹æ­ç¤ºæ›´å¤šä¿¡å·ã€‚T è¢«è®¾ç½®ä¸º 1 å³ä¸ºæ ‡å‡† Softmaxã€‚</p>
<p>åœ¨è’¸é¦æ–¹é¢ï¼Œä½¿ç”¨ Kullback-Leibler æŸå¤±å‡½æ•°ï¼Œå› ä¸ºå…¶æ‹¥æœ‰ç›¸åŒçš„ä¼˜åŒ–æ•ˆæœï¼š</p>
<script type="math/tex; mode=display">
K L(p \| q)=\mathbb{E}_{p}\left(\log \left(\frac{p}{q}\right)\right)=\sum_{i} p_{i} * \log \left(p_{i}\right)-\sum_{i} p_{i} * \log \left(q_{i}\right)</script><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> torch.optim <span class="keyword">import</span> Optimizer</span><br><span class="line"></span><br><span class="line">KD_loss = nn.KLDivLoss(reduction=<span class="string">'batchmean'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kd_step</span><span class="params">(teacher: nn.Module,</span></span></span><br><span class="line"><span class="function"><span class="params">            student: nn.Module,</span></span></span><br><span class="line"><span class="function"><span class="params">            temperature: float,</span></span></span><br><span class="line"><span class="function"><span class="params">            inputs: torch.tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            optimizer: Optimizer)</span>:</span></span><br><span class="line">    teacher.eval()</span><br><span class="line">    student.train()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        logits_t = teacher(inputs=inputs) <span class="comment"># è€å¸ˆçš„è¾“å‡º</span></span><br><span class="line">    logits_s = student(inputs=inputs) <span class="comment"># å­¦ç”Ÿçš„è¾“å‡º</span></span><br><span class="line">    <span class="comment"># è®¡ç®—kd_loss</span></span><br><span class="line">    loss = KD_loss(input=F.log_softmax(logits_s/temperature, dim=<span class="number">-1</span>),</span><br><span class="line">                   target=F.softmax(logits_t/temperature, dim=<span class="number">-1</span>))</span><br><span class="line">    </span><br><span class="line">    loss.backward()</span><br><span class="line">    optimizer.step()</span><br><span class="line">    optimizer.zero_grad()</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨è€å¸ˆä¿¡å·ï¼Œèƒ½å¤Ÿè®­ç»ƒå‡ºä¸€å¥—è¾ƒå°çš„è¯­è¨€æ¨¡å‹ DistilBERTï¼Œå±äº BERT çš„ç›‘ç£äº§ç‰©ã€‚</p>
<h4 id="æ¨¡å‹ç»“æ„"><a href="#æ¨¡å‹ç»“æ„" class="headerlink" title="æ¨¡å‹ç»“æ„"></a>æ¨¡å‹ç»“æ„</h4><p>DistilBERTæƒ³è¾ƒäºBERTåˆ é™¤äº† token-type åµŒå…¥ä¸ poolerï¼ˆç”¨äºä¸‹ä¸€å¥åˆ†ç±»ä»»åŠ¡ï¼‰ï¼Œä½†å…¶ä½™éƒ¨åˆ†æ¶æ„ä¿æŒä¸å˜ï¼Œè€Œå±‚æ•°ä¹Ÿå‡å°‘è‡³åŸæœ¬çš„äºŒåˆ†ä¹‹ä¸€ã€‚æ€»ä½“è€Œè¨€ï¼Œè’¸é¦æ¨¡å‹ DistilBERT åœ¨æ€»ä½“å‚æ•°æ•°é‡ä¸Šçº¦ä¸º BERT çš„ä¸€åŠï¼Œä½†åœ¨ GLUE è¯­è¨€ç†è§£åŸºå‡†æµ‹è¯•ä¸­èƒ½å¤Ÿä¿ç•™ 95% çš„ BERT æ€§èƒ½è¡¨ç°ã€‚</p>
<ol>
<li><strong>ä¸ºä»€ä¹ˆä¸é™ä½éšè—å±‚çš„å¤§å°ï¼Ÿ</strong><br>å°† 768 å‡è‡³ 512 ï¼Œæ„å‘³ç€æ€»å‚æ•°é‡çº¦ä¸‹é™è‡³åŸæœ¬çš„äºŒåˆ†ä¹‹ä¸€ã€‚åœ¨ç°ä»£æ¡†æ¶å½“ä¸­ï¼Œå¤§å¤šæ•°è¿ç®—éƒ½ç»è¿‡é«˜åº¦ä¼˜åŒ–ï¼Œè€Œä¸”å¼ é‡çš„æœ€ç»ˆç»´åº¦ï¼ˆéšè—ç»´åº¦ï¼‰çš„å˜åŒ–ä¼šå¯¹ Transformer æ¶æ„ï¼ˆçº¿æ€§åˆ†å±‚ä¸å±‚è§„èŒƒåŒ–ï¼‰ä¸­çš„å¤§éƒ¨åˆ†è¿ç®—äº§ç”Ÿå°å¹…å½±å“ã€‚å®éªŒä¸­å‘ç°ï¼Œå±‚æ•°å¯¹äºæ¨ç†æ—¶é—´çš„å½±å“è¦è¿œé«˜äºéšè—å±‚çš„å¤§å°ã€‚å› æ­¤ï¼Œæ›´å°å¹¶ä¸ä»£è¡¨ç€ä¸€å®šæ›´å¿«ã€‚</li>
</ol>
<p>è®­ç»ƒå­ç½‘ç»œçš„æ ¸å¿ƒä¸åªæ˜¯å»ºç«‹æ¶æ„ï¼Œè¿˜è¦æ±‚ä¸ºå­ç½‘ç»œæ‰¾åˆ°æ­£ç¡®çš„åˆå§‹åŒ–æ–¹å¼ä»¥å®ç°æ”¶æ•›ã€‚ DistilBERT ä½¿ç”¨bertçš„å‚æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œå°†å±‚æ•°å‰Šå‡ä¸€åŠï¼Œå¹¶é‡‡ç”¨ç›¸åŒçš„éšè—å¤§å°ã€‚DistilBERTè¿˜ç”¨åˆ°äº†æœ€è¿‘ RoBERTa è®ºæ–‡å½“ä¸­æåˆ°çš„ä¸€äº›è®­ç»ƒæŠ€å·§ï¼Œè¿™ä¹Ÿå†æ¬¡è¯æ˜ BERT æ¨¡å‹çš„è®­ç»ƒæ–¹å¼å¯¹å…¶æœ€ç»ˆè¡¨ç°æœ‰ç€è‡³å…³é‡è¦çš„å½±å“ã€‚ä¸ RoBERTa ç±»ä¼¼ï¼Œå¯¹ DIstilBERT è¿›è¡Œå¤§æ‰¹æ¬¡è®­ç»ƒï¼Œä½¿ç”¨æ¢¯åº¦ç´¯ç§¯ï¼ˆæ¯æ‰¹æœ€å¤š 4000 ä¸ªä¾‹å­ï¼‰ã€é…åˆåŠ¨æ€é®æŒ¡å¹¶åˆ é™¤äº†ä¸‹ä¸€å¥é¢„æµ‹ç›®æ ‡ã€‚</p>
<h4 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>DistilBERT çš„è¡¨ç°ï¼šä¿ç•™äº†BERT  95% ä»¥ä¸Šçš„æ€§èƒ½ï¼ŒåŒæ—¶å°†å‚æ•°å‡å°‘äº† 40%ã€‚æ¨ç†æ—¶é—´æ–¹é¢ï¼ŒDistilBERT æ¯” BERT å¿« 60%ï¼Œä½“ç§¯æ¯” BERT å° 60%ã€‚</p>
<h3 id="ALBERT"><a href="#ALBERT" class="headerlink" title="ALBERT"></a>ALBERT</h3><p><a href="[PDF](https://arxiv.org/pdf/1909.11942">è®ºæ–‡</a>)</p>
<h4 id="ç®€ä»‹-5"><a href="#ç®€ä»‹-5" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>è‡ªBERTçš„æˆåŠŸä»¥æ¥ï¼Œé¢„è®­ç»ƒæ¨¡å‹éƒ½é‡‡ç”¨äº†å¾ˆå¤§çš„å‚æ•°é‡ä»¥å–å¾—æ›´å¥½çš„æ¨¡å‹è¡¨ç°ã€‚ä½†æ˜¯æ¨¡å‹å‚æ•°é‡è¶Šæ¥è¶Šå¤§ä¹Ÿå¸¦æ¥äº†å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚å¯¹ç®—åŠ›è¦æ±‚è¶Šæ¥è¶Šé«˜ã€æ¨¡å‹éœ€è¦æ›´é•¿çš„æ—¶é—´å»è®­ç»ƒã€ç”šè‡³æœ‰äº›æƒ…å†µä¸‹å‚æ•°é‡æ›´å¤§çš„æ¨¡å‹è¡¨ç°å´æ›´å·®ã€‚ä¸ºäº†è§£å†³ç›®å‰é¢„è®­ç»ƒæ¨¡å‹å‚æ•°é‡è¿‡å¤§çš„é—®é¢˜ï¼Œalbertæå‡ºäº†ä¸¤ç§èƒ½å¤Ÿå¤§å¹…å‡å°‘é¢„è®­ç»ƒæ¨¡å‹å‚æ•°é‡çš„æ–¹æ³•ï¼Œæ­¤å¤–è¿˜æå‡ºç”¨Sentence-order predictionï¼ˆSOPï¼‰ä»»åŠ¡ä»£æ›¿BERTä¸­çš„Next-sentence predictionï¼ˆNSPï¼‰ä»»åŠ¡ã€‚</p>
<h4 id="æ¨¡å‹-2"><a href="#æ¨¡å‹-2" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><h5 id="åµŒå…¥å‘é‡å› å¼åˆ†è§£ï¼ˆFactorized-embedding-parameterizationï¼‰"><a href="#åµŒå…¥å‘é‡å› å¼åˆ†è§£ï¼ˆFactorized-embedding-parameterizationï¼‰" class="headerlink" title="åµŒå…¥å‘é‡å› å¼åˆ†è§£ï¼ˆFactorized embedding parameterizationï¼‰"></a>åµŒå…¥å‘é‡å› å¼åˆ†è§£ï¼ˆFactorized embedding parameterizationï¼‰</h5><p>åœ¨BERTã€XLNetã€RoBERTaç­‰æ¨¡å‹ä¸­ï¼Œç”±äºæ¨¡å‹ç»“æ„çš„é™åˆ¶ï¼ŒWordePiece embeddingçš„å¤§å°$E$ æ€»æ˜¯ä¸éšå±‚å¤§å°$H$ç›¸åŒï¼Œå³ $E \equiv H$ ã€‚ä»å»ºæ¨¡çš„è§’åº¦è€ƒè™‘ï¼Œè¯åµŒå…¥å­¦ä¹ çš„æ˜¯å•è¯ä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¡¨ç¤ºï¼Œè€Œéšå±‚åˆ™æ˜¯å­¦ä¹ ä¸ä¸Šä¸‹æ–‡ç›¸å…³çš„è¡¨ç¤ºã€‚æ˜¾ç„¶åè€…æ›´åŠ å¤æ‚ï¼Œéœ€è¦æ›´å¤šçš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æ¨¡å‹åº”å½“å¢å¤§éšå±‚å¤§å°$H$ï¼Œæˆ–è€…è¯´æ»¡è¶³ $H \gg E$ã€‚ä½†å®é™…ä¸Šè¯æ±‡è¡¨çš„å¤§å°$V$é€šå¸¸éå¸¸å¤§ï¼Œå¦‚æœ$E=H$çš„è¯ï¼Œå¢åŠ éšå±‚å¤§å°$H$åå°†ä¼šä½¿embedding matrixçš„ç»´åº¦$V \times E$éå¸¸å·¨å¤§ã€‚</p>
<p>å› æ­¤ALBERTæƒ³è¦æ‰“ç ´$E$ä¸$H$ ä¹‹é—´çš„ç»‘å®šå…³ç³»ï¼Œä»è€Œå‡å°æ¨¡å‹çš„å‚æ•°é‡ï¼ŒåŒæ—¶æå‡æ¨¡å‹è¡¨ç°ã€‚å…·ä½“åšæ³•æ˜¯å°†embedding matrixåˆ†è§£ä¸ºä¸¤ä¸ªå¤§å°åˆ†åˆ«ä¸º$V \times  E$ å’Œ$E \times H$ çŸ©é˜µï¼Œä¹Ÿå°±æ˜¯è¯´å…ˆå°†å•è¯æŠ•å½±åˆ°ä¸€ä¸ªä½ç»´çš„embeddingç©ºé—´ $E$ ï¼Œå†å°†å…¶æŠ•å½±åˆ°é«˜ç»´çš„éšè—ç©ºé—´$H$  ã€‚è¿™ä½¿å¾—embedding matrixçš„ç»´åº¦ä»$O(V \times H)$  å‡å°åˆ°$O(v \times E + E \times H)$ ã€‚å½“ $H \gg E$æ—¶ï¼Œå‚æ•°é‡å‡å°‘éå¸¸æ˜æ˜¾ã€‚åœ¨å®ç°æ—¶ï¼Œéšæœºåˆå§‹åŒ–$V\times E$å’Œ$E\times H$çš„çŸ©é˜µï¼Œè®¡ç®—æŸä¸ªå•è¯çš„è¡¨ç¤ºéœ€ç”¨ä¸€ä¸ªå•è¯çš„one-hotå‘é‡ä¹˜ä»¥$V\times E$ç»´çš„çŸ©é˜µï¼ˆä¹Ÿå°±æ˜¯lookupï¼‰ï¼Œå†ç”¨å¾—åˆ°çš„ç»“æœä¹˜$E\times H$ç»´çš„çŸ©é˜µå³å¯ã€‚ä¸¤ä¸ªçŸ©é˜µçš„å‚æ•°é€šè¿‡æ¨¡å‹å­¦ä¹ ã€‚</p>
<p>ä»ä¸‹å›¾å®éªŒç»“æœå¯è§ï¼Œå¯¹äºä¸å…±äº«å‚æ•°çš„æƒ…å†µï¼Œ$E$å‡ ä¹æ˜¯ä¸å¤§è¶Šå¥½ï¼›è€Œå…±äº«å‚æ•°ä¹‹åï¼Œ $E$å¤ªå¤§åè€Œä¼šä½¿æ¨¡å‹è¡¨ç°å˜å·®ï¼Œ$E=128$æ¨¡å‹è¡¨ç°æœ€å¥½ï¼Œå› æ­¤ALBERTçš„é»˜è®¤å‚æ•°è®¾ç½®ä¸­$E=128$.</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_embedding.png" alt="avatar"></p>
<p>è€ƒè™‘åˆ°ALBERT-baseçš„ $h=768$ï¼Œé‚£ä¹ˆ $E=768$æ—¶ï¼Œæ¨¡å‹åº”è¯¥å¯ä»¥çœ‹ä½œæ²¡æœ‰å‡å°‘embeddingå‚æ•°é‡çš„æƒ…å†µã€‚è€Œä¸å…±äº«å‚æ•°çš„å®éªŒç»“æœè¡¨æ˜æ­¤æ—¶æ¨¡å‹è¡¨ç°æ›´å¥½ï¼Œé‚£ä¹ˆä¼¼ä¹è¯´æ˜äº†Factorized embeddingåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†æ¨¡å‹çš„è¡¨ç°ã€‚</p>
<h5 id="è·¨å±‚å‚æ•°å…±äº«ï¼ˆå‚æ•°é‡å‡å°‘ä¸»è¦å…±äº«ï¼‰"><a href="#è·¨å±‚å‚æ•°å…±äº«ï¼ˆå‚æ•°é‡å‡å°‘ä¸»è¦å…±äº«ï¼‰" class="headerlink" title="è·¨å±‚å‚æ•°å…±äº«ï¼ˆå‚æ•°é‡å‡å°‘ä¸»è¦å…±äº«ï¼‰"></a>è·¨å±‚å‚æ•°å…±äº«ï¼ˆå‚æ•°é‡å‡å°‘ä¸»è¦å…±äº«ï¼‰</h5><p>å¦ä¸€ä¸ªå‡å°‘å‚æ•°é‡çš„æ–¹æ³•å°±æ˜¯å±‚ä¹‹é—´çš„å‚æ•°å…±äº«ï¼Œå³å¤šä¸ªå±‚ä½¿ç”¨ç›¸åŒçš„å‚æ•°ã€‚å‚æ•°å…±äº«æœ‰ä¸‰ç§æ–¹å¼ï¼šåªå…±äº«feed-forward networkçš„å‚æ•°ã€åªå…±äº«attentionçš„å‚æ•°ã€å…±äº«å…¨éƒ¨å‚æ•°ã€‚ALBERTé»˜è®¤æ˜¯å…±äº«å…¨éƒ¨å‚æ•°çš„ã€‚å®éªŒè¡¨æ˜åŠ å…¥å‚æ•°å…±äº«ä¹‹åï¼Œæ¯ä¸€å±‚çš„è¾“å…¥embeddingå’Œè¾“å‡ºembeddingçš„L2è·ç¦»å’Œä½™å¼¦ç›¸ä¼¼åº¦éƒ½æ¯”BERTç¨³å®šäº†å¾ˆå¤šã€‚è¿™è¯æ˜å‚æ•°å…±äº«èƒ½å¤Ÿä½¿æ¨¡å‹å‚æ•°æ›´åŠ ç¨³å®šã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/cross.png" alt="avatar"></p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹å‡ºå‚æ•°å…±äº«å‡ ä¹ä¹Ÿæ˜¯å¯¹æ¨¡å‹ç»“æœæœ‰è´Ÿé¢å½±å“çš„ã€‚ä½†æ˜¯è€ƒè™‘åˆ°å…¶èƒ½å¤Ÿå¤§å¹…å‰Šå‡å‚æ•°é‡ï¼Œå¹¶ä¸”å¯¹ç»“æœå½±å“ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œå› æ­¤æƒè¡¡ä¹‹ä¸‹é€‰æ‹©äº†å‚æ•°å…±äº«ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_crosslayer.png" alt="avatar"></p>
<h5 id="å¥é—´è¿è´¯æ€§"><a href="#å¥é—´è¿è´¯æ€§" class="headerlink" title="å¥é—´è¿è´¯æ€§"></a>å¥é—´è¿è´¯æ€§</h5><ul>
<li><strong>NSP</strong>ï¼šä¸‹ä¸€å¥é¢„æµ‹ï¼Œ æ­£æ ·æœ¬=ä¸Šä¸‹ç›¸é‚»çš„2ä¸ªå¥å­ï¼Œè´Ÿæ ·æœ¬=éšæœº2ä¸ªå¥å­</li>
<li><strong>SOP</strong>ï¼šå¥å­é¡ºåºé¢„æµ‹ï¼Œæ­£æ ·æœ¬=æ­£å¸¸é¡ºåºçš„2ä¸ªç›¸é‚»å¥å­ï¼Œè´Ÿæ ·æœ¬=è°ƒæ¢é¡ºåºçš„2ä¸ªç›¸é‚»å¥å­</li>
</ul>
<p>NSPä»»åŠ¡è¿‡äºç®€å•ï¼Œåªè¦æ¨¡å‹å‘ç°ä¸¤ä¸ªå¥å­çš„ä¸»é¢˜ä¸ä¸€æ ·å°±è¡Œäº†ï¼Œæ‰€ä»¥SOPé¢„æµ‹ä»»åŠ¡èƒ½å¤Ÿè®©æ¨¡å‹å­¦ä¹ åˆ°æ›´å¤šçš„ä¿¡æ¯ã€‚</p>
<p>é™¤äº†å‡å°‘æ¨¡å‹å‚æ•°å¤–ï¼Œè¿˜å¯¹BERTçš„é¢„è®­ç»ƒä»»åŠ¡Next-sentence prediction (NSP)è¿›è¡Œäº†æ”¹è¿›ã€‚åœ¨BERTä¸­ï¼ŒNSPä»»åŠ¡çš„æ­£ä¾‹æ˜¯æ–‡ç« ä¸­è¿ç»­çš„ä¸¤ä¸ªå¥å­ï¼Œè€Œè´Ÿä¾‹åˆ™æ˜¯ä»ä¸¤ç¯‡æ–‡æ¡£ä¸­å„é€‰ä¸€ä¸ªå¥å­æ„é€ è€Œæˆã€‚åœ¨å…ˆå‰çš„ç ”ç©¶ä¸­ï¼Œå·²ç»è¯æ˜NSPæ˜¯å¹¶ä¸æ˜¯ä¸€ä¸ªåˆé€‚çš„é¢„è®­ç»ƒä»»åŠ¡ã€‚ä½œè€…æ¨æµ‹å…¶åŸå› æ˜¯æ¨¡å‹åœ¨åˆ¤æ–­ä¸¤ä¸ªå¥å­çš„å…³ç³»æ—¶ä¸ä»…è€ƒè™‘äº†ä¸¤ä¸ªå¥å­ä¹‹é—´çš„è¿è´¯æ€§ï¼ˆcoherenceï¼‰ï¼Œè¿˜ä¼šè€ƒè™‘åˆ°ä¸¤ä¸ªå¥å­çš„è¯é¢˜ï¼ˆtopicï¼‰ã€‚è€Œä¸¤ç¯‡æ–‡æ¡£çš„è¯é¢˜é€šå¸¸ä¸åŒï¼Œæ¨¡å‹ä¼šæ›´å¤šçš„é€šè¿‡è¯é¢˜å»åˆ†æä¸¤ä¸ªå¥å­çš„å…³ç³»ï¼Œè€Œä¸æ˜¯å¥å­é—´çš„è¿è´¯æ€§ï¼Œè¿™ä½¿å¾—NSPä»»åŠ¡å˜æˆäº†ä¸€ä¸ªç›¸å¯¹ç®€å•çš„ä»»åŠ¡ã€‚</p>
<p>å› æ­¤æœ¬æ–‡æå‡ºäº†Sentence-order prediction (SOP)æ¥å–ä»£NSPã€‚å…·ä½“æ¥è¯´ï¼Œå…¶æ­£ä¾‹ä¸NSPç›¸åŒï¼Œä½†è´Ÿä¾‹æ˜¯é€šè¿‡é€‰æ‹©ä¸€ç¯‡æ–‡æ¡£ä¸­çš„ä¸¤ä¸ªè¿ç»­çš„å¥å­å¹¶å°†å®ƒä»¬çš„é¡ºåºäº¤æ¢æ„é€ çš„ã€‚è¿™æ ·ä¸¤ä¸ªå¥å­å°±ä¼šæœ‰ç›¸åŒçš„è¯é¢˜ï¼Œæ¨¡å‹å­¦ä¹ åˆ°çš„å°±æ›´å¤šæ˜¯å¥å­é—´çš„è¿è´¯æ€§ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_sop.png" alt="avatar"></p>
<p>å¦‚ä¸Šå®éªŒç»“æœæ‰€ç¤ºï¼Œå¦‚æœä¸ä½¿ç”¨NSPæˆ–SOPä½œä¸ºé¢„è®­ç»ƒä»»åŠ¡çš„è¯ï¼Œæ¨¡å‹åœ¨NSPå’ŒSOPä¸¤ä¸ªä»»åŠ¡ä¸Šè¡¨ç°éƒ½å¾ˆå·®ï¼›å¦‚æœä½¿ç”¨NSPä½œä¸ºé¢„è®­ç»ƒä»»åŠ¡çš„è¯ï¼Œæ¨¡å‹ç¡®å®èƒ½å¾ˆå¥½çš„è§£å†³NSPé—®é¢˜ï¼Œä½†æ˜¯åœ¨SOPé—®é¢˜ä¸Šè¡¨ç°å´å¾ˆå·®ï¼Œå‡ ä¹ç›¸å½“äºéšæœºçŒœï¼Œå› æ­¤è¯´æ˜NSPä»»åŠ¡ç¡®å®å¾ˆéš¾å­¦åˆ°å¥å­é—´çš„è¿è´¯æ€§ï¼›è€Œå¦‚æœç”¨SOPä½œä¸ºé¢„è®­ç»ƒä»»åŠ¡ï¼Œåˆ™æ¨¡å‹ä¹Ÿå¯ä»¥è¾ƒå¥½çš„è§£å†³NSPé—®é¢˜ï¼ŒåŒæ—¶æ¨¡å‹åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸Šè¡¨ç°ä¹Ÿæ›´å¥½ã€‚è¯´æ˜SOPç¡®å®æ˜¯æ›´å¥½çš„é¢„è®­ç»ƒä»»åŠ¡ã€‚</p>
<h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><h5 id="é¢å¤–çš„è®­ç»ƒæ•°æ®å’Œdropout"><a href="#é¢å¤–çš„è®­ç»ƒæ•°æ®å’Œdropout" class="headerlink" title="é¢å¤–çš„è®­ç»ƒæ•°æ®å’Œdropout"></a>é¢å¤–çš„è®­ç»ƒæ•°æ®å’Œdropout</h5><p>ALBERTè®­ç»ƒæ—¶è¿˜åŠ å…¥äº†XLNetå’ŒRoBERTaè®­ç»ƒæ—¶ç”¨çš„é¢å¤–æ•°æ®ï¼Œå®éªŒè¡¨æ˜åŠ å…¥é¢å¤–æ•°æ®ï¼ˆW additional dataï¼‰ç¡®å®ä¼šæå‡æ¨¡å‹è¡¨ç°ã€‚æ­¤å¤–ï¼Œä½œè€…è¿˜è§‚å¯Ÿåˆ°æ¨¡å‹ä¼¼ä¹ä¸€ç›´æ²¡æœ‰è¿‡æ‹Ÿåˆæ•°æ®ï¼Œå› æ­¤å»é™¤äº†Dropoutï¼Œä»å¯¹æ¯”è¯•éªŒå¯ä»¥çœ‹å‡ºï¼Œå»é™¤Dropoutï¼ˆW/O Dropoutï¼‰åæ¨¡å‹è¡¨ç°ç¡®å®æ›´å¥½ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_dropout.png" alt="avatar"></p>
<h4 id="æ€»ç»“-4"><a href="#æ€»ç»“-4" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_bert.png" alt="avatar"></p>
<p>ALBERTçš„è®­ç»ƒé€Ÿåº¦æ˜æ˜¾æ¯”BERTå¿«ï¼ŒALBERT-xxlargeçš„è¡¨ç°æ›´æ˜¯å…¨æ–¹é¢è¶…è¿‡äº†BERTã€‚</p>
<p>æœ¬æ–‡æœ‰ä¸¤ä¸ªå°ç»†èŠ‚å¯ä»¥å­¦ä¹ ï¼Œä¸€ä¸ªæ˜¯åœ¨æ¨¡å‹ä¸ä¼šè¿‡æ‹Ÿåˆçš„æƒ…å†µä¸‹ä¸ä½¿ç”¨dropoutï¼›å¦ä¸€ä¸ªåˆ™æ˜¯warm-startï¼Œå³åœ¨è®­ç»ƒæ·±å±‚ç½‘ç»œï¼ˆä¾‹å¦‚12å±‚ï¼‰æ—¶ï¼Œå¯ä»¥å…ˆè®­ç»ƒæµ…å±‚ç½‘ç»œï¼ˆä¾‹å¦‚6å±‚ï¼‰ï¼Œå†åœ¨å…¶åŸºç¡€ä¸Šåšfine-tuneï¼Œè¿™æ ·å¯ä»¥åŠ å¿«æ·±å±‚æ¨¡å‹çš„æ”¶æ•›ã€‚</p>
<h3 id="TinyBERT"><a href="#TinyBERT" class="headerlink" title="TinyBERT"></a>TinyBERT</h3><p><a href="https://arxiv.org/abs/1909.10351" target="_blank" rel="noopener">è®ºæ–‡</a></p>
<h4 id="ç®€ä»‹-6"><a href="#ç®€ä»‹-6" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>åœ¨ NLP é¢†åŸŸï¼ŒBERT ç”±äºæ¨¡å‹è¿‡äºåºå¤§ï¼Œå•ä¸ªæ ·æœ¬è®¡ç®—ä¸€æ¬¡çš„å¼€é”€åŠ¨è¾„ä¸Šç™¾æ¯«ç§’ï¼Œå¾ˆéš¾åº”ç”¨åˆ°å®é™…ç”Ÿäº§ä¸­ã€‚ä¸­ç§‘æŠ€å¤§å­¦ã€åä¸ºè¯ºäºšæ–¹èˆŸå®éªŒå®¤çš„ç ”ç©¶è€…æå‡ºäº† TinyBERTï¼Œè¿™æ˜¯ä¸€ç§ä¸ºåŸºäº transformer çš„æ¨¡å‹ä¸“é—¨è®¾è®¡çš„çŸ¥è¯†è’¸é¦æ–¹æ³•ï¼Œæ¨¡å‹å¤§å°ä¸º BERT çš„ 13.3%ï¼Œæ¨ç†é€Ÿåº¦æ˜¯ BERT çš„ 9.4 å€ï¼Œè€Œä¸”æ€§èƒ½æ²¡æœ‰å‡ºç°æ˜æ˜¾ä¸‹é™ã€‚</p>
<p>ç›®å‰ä¸»æµçš„å‡ ç§è’¸é¦æ–¹æ³•å¤§æ¦‚åˆ†æˆ 1. åˆ©ç”¨ transformer ç»“æ„è’¸é¦, 2. åˆ©ç”¨å…¶å®ƒç®€å•çš„ç»“æ„æ¯”å¦‚ BiLSTM ç­‰è’¸é¦ã€‚ç”±äº BiLSTM ç­‰ç»“æ„ç®€å•ï¼Œä¸”ä¸€èˆ¬æ˜¯ç”¨ BERT æœ€åä¸€å±‚çš„è¾“å‡ºç»“æœè¿›è¡Œè’¸é¦ï¼Œä¸èƒ½å­¦åˆ° transformer ä¸­é—´å±‚çš„ä¿¡æ¯ï¼Œå¯¹äºå¤æ‚çš„è¯­ä¹‰åŒ¹é…ä»»åŠ¡ï¼Œæ•ˆæœæœ‰ç‚¹ä¸å°½äººæ„ã€‚</p>
<p>åŸºäº transformer ç»“æ„çš„è’¸é¦æ–¹æ³•ç›®å‰æ¯”è¾ƒå‡ºåçš„æœ‰å¾®è½¯çš„ BERT-PKD (Patient Knowledge Distillation for BERT)ï¼Œhuggingface çš„ DistilBERTï¼Œä»¥åŠåä¸ºçš„ TinyBERTã€‚ä»–ä»¬çš„åŸºæœ¬æ€è·¯éƒ½æ˜¯å‡å°‘ transformer encoding çš„å±‚æ•°å’Œ hidden size å¤§å°ï¼Œå®ç°ç»†èŠ‚ä¸Šå„æœ‰ä¸åŒï¼Œä¸»è¦å·®å¼‚ä½“ç°åœ¨ loss çš„è®¾è®¡ä¸Šã€‚</p>
<h4 id="æ¨¡å‹-3"><a href="#æ¨¡å‹-3" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/tinyBert.jpg" alt="avatar"></p>
<p>æ•´ä¸ª TinyBERT çš„ loss è®¾è®¡åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p>
<h5 id="Embedding-layer-Distillation"><a href="#Embedding-layer-Distillation" class="headerlink" title="Embedding-layer Distillation"></a>Embedding-layer Distillation</h5><script type="math/tex; mode=display">
\mathcal{L}_{\mathrm{embd}}=\operatorname{MSE}\left(\boldsymbol{E}^{S} \boldsymbol{W}_{e}, \boldsymbol{E}^{T}\right)</script><p>å…¶ä¸­ï¼Œ$E^s \in R^{l \times ds}$,$E^T \ in R^{l \times dt}$åˆ†åˆ«è¡¨ç¤º student ç½‘ç»œçš„ embedding å’Œ teacher ç½‘ç»œçš„ embedding. å…¶ä¸­ l ä»£è¡¨ sequence length, ds ä»£è¡¨ student embedding ç»´åº¦ï¼Œ dt ä»£è¡¨ teacher embedding ç»´åº¦ã€‚ç”±äº student ç½‘ç»œçš„ embedding å±‚é€šå¸¸è¾ƒ teacher ä¼šå˜å°ä»¥è·å¾—æ›´å°çš„æ¨¡å‹å’ŒåŠ é€Ÿï¼Œæ‰€ä»¥ $W_e$ æ˜¯ä¸€ä¸ª $d_s \times d_t$ç»´çš„å¯è®­ç»ƒçš„çº¿æ€§å˜æ¢çŸ©é˜µï¼ŒæŠŠ student çš„ embedding æŠ•å½±åˆ° teacher embedding æ‰€åœ¨çš„ç©ºé—´ã€‚æœ€åå†ç®— MSEï¼Œå¾—åˆ° embedding loss.</p>
<h5 id="Transformer-layer-Distillation"><a href="#Transformer-layer-Distillation" class="headerlink" title="Transformer-layer Distillation"></a>Transformer-layer Distillation</h5><p>TinyBERT çš„ transformer è’¸é¦é‡‡ç”¨éš” k å±‚è’¸é¦çš„æ–¹å¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œteacher BERT ä¸€å…±æœ‰ 12 å±‚ï¼Œè‹¥æ˜¯è®¾ç½® student BERT ä¸º 4 å±‚ï¼Œå°±æ˜¯æ¯éš” 3 å±‚è®¡ç®—ä¸€ä¸ª transformer loss. æ˜ å°„å‡½æ•°ä¸º g(m) = 3 * m(???), m ä¸º student encoder å±‚æ•°ã€‚å…·ä½“å¯¹åº”ä¸º student ç¬¬ 1 å±‚ transformer å¯¹åº” teacher ç¬¬ 3 å±‚ï¼Œç¬¬ 2 å±‚å¯¹åº”ç¬¬ 6 å±‚ï¼Œç¬¬ 3 å±‚å¯¹åº”ç¬¬ 9 å±‚ï¼Œç¬¬ 4 å±‚å¯¹åº”ç¬¬ 12 å±‚ã€‚æ¯ä¸€å±‚çš„ transformer loss åˆåˆ†ä¸ºä¸¤éƒ¨åˆ†ç»„æˆï¼Œattention based distillation å’Œ hidden states based distillation.</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/transormers_distillation.jpg" alt="avatar"></p>
<h6 id="Attention-based-loss"><a href="#Attention-based-loss" class="headerlink" title="Attention based loss"></a>Attention based loss</h6><script type="math/tex; mode=display">
\mathcal{L}_{\mathrm{attn}}=\frac{1}{h} \sum_{i=1}^{h} \operatorname{MSE}\left(\boldsymbol{A}_{i}^{S}, \boldsymbol{A}_{i}^{T}\right)</script><p>å…¶ä¸­ï¼Œ$A_i \in R^{l \times l}$ $h$ä»£è¡¨attentionçš„å¤´æ•°ï¼Œ$l$ä»£è¡¨è¾“å…¥é•¿åº¦ï¼Œ$A_i^S$ä»£è¡¨studentç½‘ç»œç¬¬iä¸ªattentionå¤´çš„attention scoreçŸ©é˜µã€‚$A_i^T$ä»£è¡¨teacherç½‘ç»œçš„ç¬¬iä¸ªattentionå¤´çš„attention score çŸ©é˜µã€‚ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªæŸå¤±ï¼Ÿåœ¨What Does BERT Look At? An Analysis of BERTâ€™s Attention [12]ä¸­ç ”ç©¶äº†attention æƒé‡åˆ°åº•å­¦åˆ°äº†ä»€ä¹ˆï¼Œå®éªŒå‘ç°ä¸è¯­ä¹‰è¿˜æœ‰è¯­æ³•ç›¸å…³çš„è¯æ¯”å¦‚ç¬¬ä¸€ä¸ªåŠ¨è¯å®¾è¯­ï¼Œç¬¬ä¸€ä¸ªä»‹è¯å®¾è¯­ï¼Œä»¥åŠ[CLS], [SEP], é€—å·ç­‰ tokenï¼Œæœ‰å¾ˆé«˜çš„æ³¨æ„åŠ›æƒé‡ã€‚ä¸ºäº†ç¡®ä¿è¿™éƒ¨åˆ†ä¿¡æ¯èƒ½è¢« student ç½‘ç»œå­¦åˆ°ï¼ŒTinyBERT åœ¨ loss è®¾è®¡ä¸­åŠ ä¸Šäº† student å’Œ teacher çš„ attention matrix çš„ MSEã€‚è¿™æ ·è¯­è¨€çŸ¥è¯†å¯ä»¥å¾ˆå¥½çš„ä» teacher BERT è½¬ç§»åˆ° student BERT.</p>
<h6 id="hidden-states-based-distillation"><a href="#hidden-states-based-distillation" class="headerlink" title="hidden states based distillation"></a>hidden states based distillation</h6><script type="math/tex; mode=display">
\mathcal{L}_{\mathrm{hidn}}=\mathrm{MSE}\left(\boldsymbol{H}^{S} \boldsymbol{W}_{h}, \boldsymbol{H}^{T}\right)</script><p>å…¶ä¸­ï¼Œ$H^S \in R^{l \times ds}$,$H^T \in R^{l \times dt}$åˆ†åˆ«æ˜¯ student transformer å’Œ teacher transformer çš„éšå±‚è¾“å‡ºã€‚å’Œ embedding loss åŒç†ï¼Œ$W_h$æŠŠ$H^S$æŠ•å½±åˆ°$H^T$æ‰€åœ¨çš„ç©ºé—´ã€‚</p>
<h6 id="Prediction-Layer-Distillation"><a href="#Prediction-Layer-Distillation" class="headerlink" title="Prediction-Layer Distillation"></a>Prediction-Layer Distillation</h6><script type="math/tex; mode=display">
\mathcal{L}_{\text {pred }}=-\operatorname{softmax}\left(\boldsymbol{z}^{T}\right) \cdot \log \_ \left(\boldsymbol{z}^{S} / t\right)</script><p>å…¶ä¸­ t æ˜¯ temperature valueï¼Œæš‚æ—¶è®¾ä¸º 1.é™¤äº†æ¨¡ä»¿ä¸­é—´å±‚çš„è¡Œä¸ºå¤–ï¼Œè¿™ä¸€å±‚ç”¨æ¥æ¨¡æ‹Ÿ teacher ç½‘ç»œåœ¨ predict å±‚çš„è¡¨ç°ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™ä¸€å±‚è®¡ç®—äº† teacher è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒå’Œ student è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒçš„ softmax äº¤å‰ç†µã€‚è¿™ä¸€å±‚çš„å®ç°å’Œå…·ä½“ä»»åŠ¡ç›¸å…³.</p>
<p> prediction loss æœ‰å¾ˆå¤šå˜åŒ–ã€‚</p>
<ol>
<li>åœ¨ TinyBERT ä¸­ï¼Œè¿™ä¸ª loss æ˜¯ teacher BERT é¢„æµ‹çš„æ¦‚ç‡å’Œ student BERT é¢„æµ‹æ¦‚ç‡çš„ softmax äº¤å‰ç†µ.</li>
<li>åœ¨ BERT-PKD æ¨¡å‹ä¸­ï¼Œè¿™ä¸ª loss æ˜¯ teacher BERT å’Œ student BERT çš„äº¤å‰ç†µå’Œ student BERT å’Œ hard target( one-hot)çš„äº¤å‰ç†µçš„åŠ æƒå¹³å‡ã€‚</li>
</ol>
<p>ç›´æ¥ç”¨ hard target lossï¼Œæ•ˆæœæ¯”ä½¿ç”¨ teacher student softmax äº¤å‰ç†µä¸‹é™ 5-6 ä¸ªç‚¹ã€‚å› ä¸º softmax æ¯” one-hot ç¼–ç äº†æ›´å¤šæ¦‚ç‡åˆ†å¸ƒçš„ä¿¡æ¯ã€‚å¹¶ä¸”softmax cross-entropy loss å®¹æ˜“å‘ç”Ÿä¸æ”¶æ•›çš„æƒ…å†µï¼ŒæŠŠ softmax äº¤å‰ç†µæ”¹æˆ MSE, æ”¶æ•›æ•ˆæœå˜å¥½ï¼Œä½†æ³›åŒ–æ•ˆæœå˜å·®ã€‚è¿™æ˜¯å› ä¸ºä½¿ç”¨ softmax cross-entropy éœ€è¦å­¦åˆ°æ•´ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œæ›´éš¾æ”¶æ•›ï¼Œå› ä¸ºæ‹Ÿåˆäº† teacher BERT çš„æ¦‚ç‡åˆ†å¸ƒï¼Œæœ‰æ›´å¼ºçš„æ³›åŒ–æ€§ã€‚MSE å¯¹æå€¼æ•æ„Ÿï¼Œæ”¶æ•›çš„æ›´å¿«ï¼Œä½†æ³›åŒ–æ•ˆæœä¸å¦‚å‰è€…ã€‚</p>
<p>æ‰€ä»¥æ€»çš„lossï¼š</p>
<script type="math/tex; mode=display">
\mathcal{L}_{\text {model }}=\sum_{m=0}^{M+1} \lambda_{m} \mathcal{L}_{\text {layer }}\left(S_{m}, T_{g(m)}\right)</script><p>å…¶ä¸­</p>
<script type="math/tex; mode=display">
\mathcal{L}_{\text {layer }}\left(S_{m}, T_{g(m)}\right)=\left\{\begin{array}{ll}
\mathcal{L}_{\text {embd }}\left(S_{0}, T_{0}\right), & m=0 \\
\mathcal{L}_{\text {hidn }}\left(S_{m}, T_{g(m)}\right)+\mathcal{L}_{\text {attn }}\left(S_{m}, T_{g(m)}\right), & M \geq m>0 \\
\mathcal{L}_{\text {pred }}\left(S_{M+1}, T_{N+1}\right), & m=M+1
\end{array}\right.</script><h4 id="ä¸¤é˜¶æ®µå­¦ä¹ æ¡†æ¶"><a href="#ä¸¤é˜¶æ®µå­¦ä¹ æ¡†æ¶" class="headerlink" title="ä¸¤é˜¶æ®µå­¦ä¹ æ¡†æ¶"></a>ä¸¤é˜¶æ®µå­¦ä¹ æ¡†æ¶</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/two_step.jpg" alt="avatar"></p>
<p>ç±»ä¼¼äºåŸç”Ÿçš„ BERT å…ˆ pre-train, æ ¹æ®å…·ä½“ä»»åŠ¡å† fine-tineã€‚TinyBERT å…ˆåœ¨ general domain æ•°æ®é›†ä¸Šç”¨æœªç»å¾®è°ƒçš„ BERT å……å½“æ•™å¸ˆè’¸é¦å‡ºä¸€ä¸ª base æ¨¡å‹ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œå…·ä½“ä»»åŠ¡é€šè¿‡æ•°æ®å¢å¼ºï¼Œåˆ©ç”¨å¾®è°ƒåçš„ BERT å†è¿›è¡Œé‡æ–°æ‰§è¡Œè’¸é¦ã€‚è¿™ç§ä¸¤é˜¶æ®µçš„æ–¹æ³•ç»™ TinyBERT æä¾›äº†åƒ BERT ä¸€æ ·çš„æ³›åŒ–èƒ½åŠ›ã€‚ </p>
<h4 id="æ€»ç»“-5"><a href="#æ€»ç»“-5" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p> TinyBERT ä½œä¸ºä¸€ç§è’¸é¦æ–¹æ³•ï¼Œèƒ½æœ‰æ•ˆçš„æå– BERT transformer ç»“æ„ä¸­ä¸°å¯Œçš„è¯­æ„ä¿¡æ¯ï¼Œåœ¨ä¸ç‰ºç‰²æ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œé€Ÿåº¦èƒ½è·å¾— 8 åˆ° 9 å€çš„æå‡ã€‚</p>
<h3 id="FastBert"><a href="#FastBert" class="headerlink" title="FastBert"></a>FastBert</h3><h4 id="ç®€ä»‹-7"><a href="#ç®€ä»‹-7" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>FastBERTçš„åˆ›æ–°ç‚¹å¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯åœ¨æ¯å±‚Transformeråéƒ½å»é¢„æµ‹æ ·æœ¬æ ‡ç­¾ï¼Œå¦‚æœæŸæ ·æœ¬é¢„æµ‹ç»“æœçš„ç½®ä¿¡åº¦å¾ˆé«˜ï¼Œå°±ä¸ç”¨ç»§ç»­è®¡ç®—äº†ã€‚è®ºæ–‡æŠŠè¿™ä¸ªé€»è¾‘ç§°ä¸ºæ ·æœ¬è‡ªé€‚åº”æœºåˆ¶ï¼ˆSample-wise adaptive mechanismï¼‰ï¼Œå°±æ˜¯è‡ªé€‚åº”è°ƒæ•´æ¯ä¸ªæ ·æœ¬çš„è®¡ç®—é‡ï¼Œå®¹æ˜“çš„æ ·æœ¬é€šè¿‡ä¸€ä¸¤å±‚å°±å¯ä»¥é¢„æµ‹å‡ºæ¥ï¼Œè¾ƒéš¾çš„æ ·æœ¬åˆ™éœ€è¦èµ°å®Œå…¨ç¨‹ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ text_a = â€˜åŒ—äº¬é²œèŠ±å¿«é€’â€™ text_b = â€˜åŒ—äº¬é²œèŠ±é€Ÿé€’â€™ è¿™ç§caseå¯èƒ½æµ…å±‚çš„bertå°±å·²ç»èƒ½å¤Ÿå¾ˆå¥½çš„ç®—å‡ºå…¶ç›¸å…³æ€§æ‰“åˆ†ï¼Œæ‰€ä»¥ç®—å®Œä¸¤å±‚bertçš„æ‰“åˆ†å’Œ12å±‚çš„ç»“æœåŸºæœ¬ä¸€è‡´ï¼Œè€Œtext_a = â€˜åŒ—äº¬é²œèŠ±å¿«é€’â€™ text_b = â€˜æœ‰æ²¡æœ‰å“ªä¸ªåœ°æ–¹å–èŠ±å‰ï¼Œè€Œä¸”åŒ…é€ï¼Œä½ç½®åŒ—äº¬â€™ è¿™ç§caseå¯èƒ½éœ€è¦æ·±å±‚çš„bertå»æŠ½å–ä¸¤è¾¹çš„è¯­ä¹‰ç‰¹å¾ï¼Œå¹¶è®¡ç®—å…¶æ˜¯å¦åŒ¹é…ï¼Œæ‰€ä»¥åœ¨inferenceé˜¶æ®µå°±éœ€è¦ç®—å®Œ12å±‚ã€‚</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/fastbert.jpg" alt="avatar"></p>
<p>ä½œè€…å°†åŸBERTæ¨¡å‹ç§°ä¸ºä¸»å¹²ï¼ˆBackboneï¼‰ï¼Œæ¯ä¸ªåˆ†ç±»å™¨ç§°ä¸ºåˆ†æ”¯ï¼ˆBranchï¼‰ã€‚è¿™é‡Œçš„åˆ†æ”¯Classifieréƒ½æ˜¯æœ€åä¸€å±‚çš„åˆ†ç±»å™¨è’¸é¦æ¥çš„ï¼Œä½œè€…å°†è¿™ç§°ä¸ºè‡ªè’¸é¦ï¼ˆSelf-distillationï¼‰ã€‚å°±æ˜¯åœ¨é¢„è®­ç»ƒå’Œç²¾è°ƒé˜¶æ®µéƒ½åªæ›´æ–°ä¸»å¹²å‚æ•°ï¼Œç²¾è°ƒå®Œå<strong>freezeä¸»å¹²å‚æ•°ï¼Œç”¨åˆ†æ”¯åˆ†ç±»å™¨ï¼ˆå›¾ä¸­çš„studentï¼‰è’¸é¦ä¸»å¹²åˆ†ç±»å™¨ï¼ˆå›¾ä¸­çš„teacherï¼‰çš„æ¦‚ç‡åˆ†å¸ƒ</strong>ã€‚ä¹‹æ‰€ä»¥å«è‡ªè’¸é¦ï¼Œæ˜¯å› ä¸ºä¹‹å‰çš„è’¸é¦éƒ½æ˜¯ç”¨ä¸¤ä¸ªæ¨¡å‹å»åšï¼Œä¸€ä¸ªæ¨¡å‹å­¦ä¹ å¦ä¸€ä¸ªæ¨¡å‹çš„çŸ¥è¯†ï¼Œè€ŒFastBERTæ˜¯è‡ªå·±ï¼ˆåˆ†æ”¯ï¼‰è’¸é¦è‡ªå·±ï¼ˆä¸»å¹²ï¼‰çš„çŸ¥è¯†ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè’¸é¦æ—¶éœ€è¦freezeä¸»å¹²éƒ¨åˆ†ï¼Œä¿è¯pretrainå’Œfinetuneé˜¶æ®µå­¦ä¹ çš„çŸ¥è¯†ä¸è¢«å½±å“ï¼Œä»…ç”¨brach æ¥å°½å¯èƒ½çš„æ‹Ÿåˆteacherçš„åˆ†å¸ƒã€‚åŒæ—¶ï¼Œä½¿ç”¨è‡ªè’¸é¦è¿˜æœ‰ä¸€ç‚¹é‡è¦çš„å¥½å¤„ï¼Œå°±æ˜¯<strong>ä¸å†ä¾èµ–äºæ ‡æ³¨æ•°æ®</strong>ã€‚è’¸é¦çš„æ•ˆæœå¯ä»¥é€šè¿‡æºæºä¸æ–­çš„æ— æ ‡ç­¾æ•°æ®æ¥æå‡ã€‚</p>
<h4 id="æ€»ç»“-6"><a href="#æ€»ç»“-6" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>FastBERTé€šè¿‡æå‰è¾“å‡ºç®€å•æ ·æœ¬çš„é¢„æµ‹ç»“æœï¼Œå‡å°‘æ¨¡å‹çš„è®¡ç®—è´Ÿæ‹…ï¼Œä»è€Œæé«˜æ¨ç†é€Ÿåº¦ã€‚è™½ç„¶æ¯å±‚éƒ½å¤šäº†ä¸€ä¸ªåˆ†ç±»å™¨ï¼Œä½†åˆ†ç±»å™¨çš„è®¡ç®—é‡ä¹Ÿæ¯”Transformerå°äº†ä¸¤ä¸ªæ•°é‡çº§ï¼Œå¯¹é€Ÿåº¦å½±å“è¾ƒå°ã€‚åç»­çš„åˆ†æ”¯è‡ªè’¸é¦ä¹Ÿè®¾è®¡çš„æ¯”è¾ƒå·§å¦™ï¼Œå¯ä»¥åˆ©ç”¨æ— ç›‘ç£æ•°æ®ä¸æ–­æå‡åˆ†æ”¯åˆ†ç±»å™¨çš„æ•ˆæœã€‚</p>
<h3 id="æ€»ç»“-7"><a href="#æ€»ç»“-7" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ€§èƒ½ï¼š</p>
<ol>
<li>BERT-WWM</li>
<li>XLNetï¼ˆé•¿æ–‡æœ¬è¡¨ç°æ›´å¥½ä¸€äº›ï¼‰</li>
<li>RoBERTaï¼ˆåŠ¨æ€maskã€without NSPã€æ›´å¤§batchï¼Œæ›´å¤šæ•°æ®ï¼Œæ›´é•¿è®­ç»ƒæ—¶é—´ï¼‰</li>
<li>SpanBERT(åŸºäºåˆ†è¯çš„é¢„è®­ç»ƒæ¨¡å‹)</li>
<li>MT-DNN(é¢„è®­ç»ƒ+å¤šä»»åŠ¡)</li>
<li>ERNIRï¼ˆå¼•å…¥å®ä½“ä¿¡æ¯ï¼‰</li>
</ol>
<p>æ•ˆç‡ï¼š</p>
<ol>
<li>DistilBertï¼ˆçŸ¥è¯†è’¸é¦ï¼‰</li>
<li>ALBertï¼ˆå› å¼åˆ†è§£ã€è·¨å±‚æƒé‡å…±äº«ï¼‰</li>
<li>TinyBertï¼ˆçŸ¥è¯†è’¸é¦ï¼‰</li>
</ol>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://zhuanlan.zhihu.com/p/46652512" target="_blank" rel="noopener">ã€NLPã€‘Google BERTè¯¦è§£</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/81157740" target="_blank" rel="noopener">å¸¦ä½ è¯»è®ºæ–‡ä¸¨8ç¯‡è®ºæ–‡æ¢³ç†BERTç›¸å…³æ¨¡å‹è¿›å±•ä¸åæ€</a></li>
<li><a href="https://blog.csdn.net/u012526436/article/details/93196139" target="_blank" rel="noopener">æœ€é€šä¿—æ˜“æ‡‚çš„XLNETè¯¦è§£</a></li>
<li><a href="https://www.jianshu.com/p/eddf04ba8545" target="_blank" rel="noopener">æ”¹è¿›ç‰ˆçš„RoBERTaåˆ°åº•æ”¹è¿›äº†ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="https://www.bilibili.com/video/av73657563/" target="_blank" rel="noopener">ã€AIæ¨¡å‹ã€‘æœ€é€šä¿—æ˜“æ‡‚çš„XLNetè¯¦è§£</a></li>
<li>Liu Y, Ott M, Goyal N, et al. Roberta: A robustly optimized bert pretraining approach[J]. arXiv preprint arXiv:1907.11692, 2019</li>
<li>Sennrich R, Haddow B, Birch A. Neural machine translation of rare words with subword units[J]. arXiv preprint arXiv:1508.07909, 2015.</li>
<li><a href="http://fancyerii.github.io/2019/03/09/bert-codes/#dataprocessor" target="_blank" rel="noopener">bertä»£ç é˜…è¯»</a></li>
<li><a href="https://www.infoq.cn/article/STabowUeFupgc4gRqRQj" target="_blank" rel="noopener">æ›´å°ã€æ›´å¿«ã€æ›´ä¾¿å®œã€æ›´è½»é‡ï¼šå¼€æº DistilBERTï¼ŒBERT çš„ç²¾ç®€ç‰ˆæœ¬</a></li>
<li>Michel, P., Levy, O., &amp; Neubig, G. (2019). Are Sixteen Heads Really Better than One? Retrieved from <a href="https://arxiv.org/abs/1905.10650" target="_blank" rel="noopener">https://arxiv.org/abs/1905.10650</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/94359189" target="_blank" rel="noopener">æ¯” Bert ä½“ç§¯æ›´å°é€Ÿåº¦æ›´å¿«çš„ TinyBERT</a></li>
<li><a href="https://arxiv.org/abs/1906.04341" target="_blank" rel="noopener">https://arxiv.org/abs/1906.04341</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/87562926" target="_blank" rel="noopener">ã€è®ºæ–‡é˜…è¯»ã€‘ALBERT</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/59436589" target="_blank" rel="noopener">ä¸­æ–‡ä»»åŠ¡å…¨é¢è¶…è¶ŠBERTï¼šç™¾åº¦æ­£å¼å‘å¸ƒNLPé¢„è®­ç»ƒæ¨¡å‹ERNIE</a></li>
<li><a href="https://www.jianshu.com/p/5e12e6edbd59" target="_blank" rel="noopener">BERTæ³›è¯»ç³»åˆ—ï¼ˆä¸‰ï¼‰â€”â€” ERNIE: Enhanced Language Representation with Informative Entitiesè®ºæ–‡ç¬”è®°</a></li>
<li><a href="https://blog.csdn.net/ljp1919/article/details/90269059" target="_blank" rel="noopener">æ–‡çŒ®é˜…è¯»ï¼šMT-DNNæ¨¡å‹</a></li>
<li><a href="https://blog.csdn.net/Magical_Bubble/article/details/89517709" target="_blank" rel="noopener">MT-DNNè§£è¯»(è®ºæ–‡ + PyTorchæºç )</a></li>
</ol>
]]></content>
      <categories>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>BERT</tag>
        <tag>BERT-WWM</tag>
        <tag>XLNet</tag>
        <tag>RoBERTa</tag>
        <tag>SpanBERT</tag>
        <tag>ernie</tag>
        <tag>MT-DNN</tag>
        <tag>DistillBERT</tag>
        <tag>ALBERT</tag>
        <tag>TinyBERT</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»</title>
    <url>/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å¯¹äºäº‹ä»¶æŠ½å–ä¸­å•å¥å¤šäº‹ä»¶çš„é—®é¢˜ï¼Œæ‰“ç®—ç”¨æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»æ¥è¿›è¡Œè§£å†³ã€‚</p>
<h3 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h3><ol>
<li>ç±»æ ‡æ•°é‡ä¸ç¡®å®šï¼Œæœ‰äº›æ ·æœ¬å¯èƒ½åªæœ‰ä¸€ä¸ªç±»æ ‡ï¼Œæœ‰äº›æ ·æœ¬çš„ç±»æ ‡å¯èƒ½é«˜è¾¾å‡ åç”šè‡³ä¸Šç™¾ä¸ªã€‚â€‚</li>
<li>ç±»æ ‡ä¹‹é—´ç›¸äº’ä¾èµ–ï¼Œä¾‹å¦‚åŒ…å«è“å¤©ç±»æ ‡çš„æ ·æœ¬å¾ˆå¤§æ¦‚ç‡ä¸ŠåŒ…å«ç™½äº‘ï¼Œå¦‚ä½•è§£å†³ç±»æ ‡ä¹‹é—´çš„ä¾èµ–æ€§é—®é¢˜ä¹Ÿæ˜¯ä¸€å¤§éš¾ç‚¹ã€‚</li>
<li>å¤šæ ‡ç­¾çš„è®­ç»ƒé›†æ¯”è¾ƒéš¾ä»¥è·å–ã€‚</li>
</ol>
<a id="more"></a>
<h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><p>å‰æœ‰å¾ˆå¤šå…³äºå¤šæ ‡ç­¾çš„å­¦ä¹ ç®—æ³•ï¼Œä¾æ®è§£å†³é—®é¢˜çš„è§’åº¦ï¼Œè¿™äº›ç®—æ³•å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»:ä¸€æ˜¯åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•ï¼ŒäºŒæ˜¯åŸºäºç®—æ³•é€‚ç”¨çš„æ–¹æ³•ã€‚åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•æ˜¯è½¬åŒ–é—®é¢˜æ•°æ®ï¼Œä½¿ä¹‹ä½¿ç”¨ç°æœ‰ç®—æ³•ï¼›åŸºäºç®—æ³•é€‚ç”¨çš„æ–¹æ³•æ˜¯æŒ‡é’ˆå¯¹æŸä¸€ç‰¹å®šçš„ç®—æ³•è¿›è¡Œæ‰©å±•ï¼Œä»è€Œèƒ½å¤Ÿå¤„ç†å¤šæ ‡è®°æ•°æ®ï¼Œæ”¹è¿›ç®—æ³•ï¼Œé€‚ç”¨æ•°æ®ã€‚</p>
<h4 id="åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•"><a href="#åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•" class="headerlink" title="åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•"></a><strong>åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•</strong></h4><p>åŸºäºé—®é¢˜è½¬åŒ–çš„æ–¹æ³•ä¸­æœ‰çš„è€ƒè™‘æ ‡ç­¾ä¹‹é—´çš„å…³è”æ€§ï¼Œæœ‰çš„ä¸è€ƒè™‘æ ‡ç­¾çš„å…³è”æ€§ã€‚æœ€ç®€å•çš„ä¸è€ƒè™‘å…³è”æ€§çš„ç®—æ³•å°†å¤šæ ‡ç­¾ä¸­çš„æ¯ä¸€ä¸ªæ ‡ç­¾å½“æˆæ˜¯å•æ ‡ç­¾ï¼Œå¯¹æ¯ä¸€ä¸ªæ ‡ç­¾å®æ–½å¸¸è§çš„åˆ†ç±»ç®—æ³•ã€‚å…·ä½“è€Œè¨€ï¼Œåœ¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ çš„æ¨¡å‹ä¸­å¯¹æ¯ä¸€ç±»æ ‡ç­¾åšäºŒåˆ†ç±»ï¼Œå¯ä»¥ä½¿ç”¨SVMã€DTã€NaÃ¯ve Bayesã€DTã€Xgboostç­‰ç®—æ³•ï¼›åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œå¯¹æ¯ä¸€ç±»è®­ç»ƒä¸€ä¸ªæ–‡æœ¬åˆ†ç±»æ¨¡å‹(å¦‚ï¼štextCNNã€textRNNç­‰)ã€‚è€ƒè™‘å¤šæ ‡ç­¾çš„ç›¸å…³æ€§æ—¶å€™å¯ä»¥å°†ä¸Šä¸€ä¸ªè¾“å‡ºçš„æ ‡ç­¾å½“æˆæ˜¯ä¸‹ä¸€ä¸ªæ ‡ç­¾åˆ†ç±»å™¨çš„è¾“å…¥ã€‚åœ¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹ä¸­å¯ä»¥ä½¿ç”¨<strong>åˆ†ç±»å™¨é“¾</strong>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªåˆ†ç±»å™¨åªåœ¨è¾“å…¥æ•°æ®ä¸Šè¿›è¡Œè®­ç»ƒï¼Œç„¶åæ¯ä¸ªåˆ†ç±»å™¨éƒ½åœ¨è¾“å…¥ç©ºé—´å’Œé“¾ä¸Šçš„æ‰€æœ‰ä¹‹å‰çš„åˆ†ç±»å™¨ä¸Šè¿›è¡Œè®­ç»ƒã€‚è®©æˆ‘ä»¬è¯•ç€é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£è¿™ä¸ªé—®é¢˜ã€‚åœ¨ä¸‹é¢ç»™å‡ºçš„æ•°æ®é›†é‡Œï¼Œæˆ‘ä»¬å°†Xä½œä¸ºè¾“å…¥ç©ºé—´ï¼Œè€ŒYä½œä¸ºæ ‡ç­¾ã€‚åœ¨åˆ†ç±»å™¨é“¾ä¸­ï¼Œè¿™ä¸ªé—®é¢˜å°†è¢«è½¬æ¢æˆ4ä¸ªä¸åŒçš„æ ‡ç­¾é—®é¢˜ï¼Œå°±åƒä¸‹é¢æ‰€ç¤ºã€‚é»„è‰²éƒ¨åˆ†æ˜¯è¾“å…¥ç©ºé—´ï¼Œç™½è‰²éƒ¨åˆ†ä»£è¡¨ç›®æ ‡å˜é‡ã€‚</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/1.png" alt="avatar"></p>
<p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œäºè¾“å‡ºå±‚åŠ ä¸Šä¸€ä¸ªæ—¶åºæ¨¡å‹ï¼Œå°†æ¯ä¸€æ—¶åˆ»è¾“å…¥çš„æ•°æ®åºåˆ—ä¸­åŠ å…¥ä¸Šä¸€æ—¶åˆ»è¾“å‡ºçš„ç»“æœå€¼ã€‚åœ¨è·å¾—æ–‡ç« çš„æ•´ä½“è¯­ä¹‰(Text feature vector)åï¼Œå°†Text feature vectorè¾“å…¥åˆ°ä¸€ä¸ªRNNçš„åºåˆ—ä¸­ä½œä¸ºåˆå§‹å€¼ï¼Œæ¯ä¸€æ—¶åˆ»è¾“å…¥æ˜¯ä¸Šä¸€æ—¶åˆ»çš„è¾“å‡ºã€‚ä»æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ï¼Œä¸‹å›¾æ‰€ç¤ºçš„æ¨¡å‹å°†å¤šæ ‡ç­¾ä»»åŠ¡å½“æˆäº†åºåˆ—ç”Ÿæˆä»»åŠ¡æ¥å¤„ç†ã€‚</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/cnn_rnn.png" alt="avatar"></p>
<p>é™¤äº†å°†æ ‡ç­¾åˆ†å¼€çœ‹ä¹‹å¤–ï¼Œè¿˜æœ‰å°†æ ‡ç­¾ç»Ÿä¸€æ¥çœ‹(Label Powerset)ã€‚åœ¨è¿™æ–¹é¢ï¼Œæˆ‘ä»¬å°†é—®é¢˜è½¬åŒ–ä¸ºä¸€ä¸ªå¤šç±»é—®é¢˜ï¼Œä¸€ä¸ªå¤šç±»åˆ†ç±»å™¨åœ¨è®­ç»ƒæ•°æ®ä¸­å‘ç°çš„æ‰€æœ‰å”¯ä¸€çš„æ ‡ç­¾ç»„åˆä¸Šè¢«è®­ç»ƒã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£å®ƒã€‚</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/multi_one.png" alt="avatar"></p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å‘ç°x1å’Œx4æœ‰ç›¸åŒçš„æ ‡ç­¾ã€‚åŒæ ·çš„ï¼Œx3å’Œx6æœ‰ç›¸åŒçš„æ ‡ç­¾ã€‚å› æ­¤ï¼Œæ ‡ç­¾powersetå°†è¿™ä¸ªé—®é¢˜è½¬æ¢ä¸ºä¸€ä¸ªå•ä¸€çš„å¤šç±»é—®é¢˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/multi_two.png" alt="avatar"></p>
<p>å› æ­¤ï¼Œæ ‡ç­¾powersetç»™è®­ç»ƒé›†ä¸­çš„æ¯ä¸€ä¸ªå¯èƒ½çš„æ ‡ç­¾ç»„åˆæä¾›äº†ä¸€ä¸ªç‹¬ç‰¹çš„ç±»ã€‚è½¬åŒ–ä¸ºå•æ ‡ç­¾åå°±å¯ä»¥ä½¿ç”¨SVMã€textCNNã€textRNNç­‰åˆ†ç±»ç®—æ³•è®­ç»ƒæ¨¡å‹äº†ã€‚</p>
<p>æ„Ÿè§‰Label Powersetåªé€‚åˆæ ‡ç­¾æ•°å°‘çš„æ•°æ®ï¼Œä¸€æ—¦æ ‡ç­¾æ•°ç›®å¤ªå¤š(å‡è®¾æœ‰nä¸ª)ï¼Œä½¿ç”¨Label Powersetåå¯èƒ½çš„æ•°æ®é›†å°†åˆ†å¸ƒåœ¨[0,$2^{n-1}$]ç©ºé—´å†…ï¼Œæ•°æ®ä¼šå¾ˆç¨€ç–ã€‚</p>
<h4 id="åŸºäºç®—æ³•é€‚ç”¨çš„æ–¹æ³•"><a href="#åŸºäºç®—æ³•é€‚ç”¨çš„æ–¹æ³•" class="headerlink" title="åŸºäºç®—æ³•é€‚ç”¨çš„æ–¹æ³•"></a><strong>åŸºäºç®—æ³•é€‚ç”¨çš„æ–¹æ³•</strong></h4><p>æ”¹å˜ç®—æ³•æ¥ç›´æ¥æ‰§è¡Œå¤šæ ‡ç­¾åˆ†ç±»ï¼Œè€Œä¸æ˜¯å°†é—®é¢˜è½¬åŒ–ä¸ºä¸åŒçš„é—®é¢˜å­é›†ã€‚åœ¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹ä¸­é€‚ç”¨äºçš„å¤šæ ‡ç­¾åˆ†ç±»æ¨¡å‹æœ‰:kNNå¤šæ ‡ç­¾ç‰ˆæœ¬MLkNNï¼ŒSVMçš„å¤šæ ‡ç­¾ç‰ˆæœ¬Rank-SVMç­‰ã€‚åœ¨æ·±åº¦å­¦ä¹ ä¸­å¸¸å¸¸æ˜¯ä¿®æ”¹å¤šåˆ†ç±»æ¨¡å‹çš„è¾“å‡ºå±‚ï¼Œä½¿å…¶é€‚ç”¨äºå¤šæ ‡ç­¾çš„åˆ†ç±»ï¼Œå¦‚ï¼šåœ¨è¾“å‡ºå±‚å¯¹æ¯ä¸€ä¸ªæ ‡ç­¾çš„è¾“å‡ºå€¼ä½¿ç”¨sigmodå‡½æ•°è¿›è¡Œ2åˆ†ç±»(æ ‡ç­¾ä¹‹é—´æ— å…³è”ä¿¡æ¯)ã€‚æˆ–è€…ä½¿ç”¨ä¸€èˆ¬çš„CNNæå–å¥å­çš„è¯­ä¹‰ä¿¡æ¯ï¼Œä½†è€ƒè™‘åˆ°å¥å­è¡¨ç¤ºçš„ä¸åŒéƒ¨åˆ†åœ¨å¥å­åˆ†ç±»çš„è¿‡ç¨‹ä¸­ä¼šèµ·ä¸åŒçš„ä½œç”¨ï¼Œæ•…åœ¨è¿›è¡Œåˆ†ç±»æ—¶å€™ä½¿ç”¨äº†Attentionæœºåˆ¶(è§å›¾)ï¼Œä½¿å¾—åœ¨é¢„æµ‹æ¯ä¸€ç±»æ—¶å€™å¥å­çš„ä¸åŒéƒ¨åˆ†çš„è¡¨ç¤ºèµ·ä¸åŒçš„ä½œç”¨ã€‚</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/3.png" alt="avatar"></p>
<h3 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h3><ol>
<li><a href="https://ai.baidu.com/tech/nlp/doctagger" target="_blank" rel="noopener">ç™¾åº¦AIå¼€æ”¾å¹³å°(æ–‡ç« æ ‡ç­¾)</a></li>
<li><a href="https://github.com/inspirehep/magpie" target="_blank" rel="noopener">Magpie(å¤šæ ‡ç­¾åˆ†ç±»å·¥å…·)</a></li>
<li><a href="https://biendata.com/competition/zhihu/" target="_blank" rel="noopener">2017çŸ¥ä¹â€œçœ‹å±±æ¯â€æ¯”èµ›</a></li>
<li>[è‹±æ–‡æ–°é—»å¤š æ ‡ç­¾åˆ†ç±»æ•°æ®é›†](<a href="https://drive.google.com/file/d/18-JOCIj9v5bZCrn9CIsk23W4wyhroCp_/view?usp=sharing" target="_blank" rel="noopener">https://drive.google.com/file/d/18-JOCIj9v5bZCrn9CIsk23W4wyhroCp_/view?usp=sharing</a></li>
<li>[ç½‘ä¸Šå¯é‡‡é›†çš„ã€è´¨é‡è¾ƒé«˜çš„å¤šæ ‡ç­¾åˆ†ç±»æ•°æ®é›†(<a href="https://movie.douban.com/" target="_blank" rel="noopener">è±†ç“£ç”µå½±è¯„è®º</a>)</li>
<li>GitHubä¸Šæ¯”è¾ƒå®Œå–„çš„<a href="https://github.com/brightmart/text_classification" target="_blank" rel="noopener">æ–‡æœ¬å¤šæ ‡ç­¾åˆ†ç±»é¡¹ç›®</a></li>
<li>NLPCC2018ï¼Œtask6å’Œtesk8å‡å¯ä»¥å½“æˆæ˜¯å¤šæ ‡ç­¾çš„åˆ†ç±»ä»»åŠ¡ï¼›</li>
</ol>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://www.cnblogs.com/cxf-zzj/p/10049613.html" target="_blank" rel="noopener">å¤šæ ‡ç­¾åˆ†ç±»(multi-label classification)ç»¼è¿°</a></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>pythonæ•°æ®ç§‘å­¦é€ŸæŸ¥</title>
    <url>/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="é€ŸæŸ¥è¡¨"><a href="#é€ŸæŸ¥è¡¨" class="headerlink" title="é€ŸæŸ¥è¡¨"></a>é€ŸæŸ¥è¡¨</h2><h3 id="python-åŸºç¡€"><a href="#python-åŸºç¡€" class="headerlink" title="python åŸºç¡€"></a>python åŸºç¡€</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/python.png" alt="avatar"></p>
<a id="more"></a>
<h3 id="å¯¼å…¥æ•°æ®"><a href="#å¯¼å…¥æ•°æ®" class="headerlink" title="å¯¼å…¥æ•°æ®"></a>å¯¼å…¥æ•°æ®</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/import_data.png" alt="avatar"></p>
<h3 id="jupyter-notebook"><a href="#jupyter-notebook" class="headerlink" title="jupyter notebook"></a>jupyter notebook</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/jupyter_notebook.png" alt="avatar"></p>
<h3 id="numpy"><a href="#numpy" class="headerlink" title="numpy"></a>numpy</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/numpy.png" alt="avatar"></p>
<h3 id="pandas"><a href="#pandas" class="headerlink" title="pandas"></a>pandas</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/pandas_1.png" alt="avatar"></p>
<p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/pandas_2.png" alt="avatar"></p>
<h3 id="matplotlib"><a href="#matplotlib" class="headerlink" title="matplotlib"></a>matplotlib</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/matplotlib.png" alt="avatar"></p>
<h3 id="Seaborn"><a href="#Seaborn" class="headerlink" title="Seaborn"></a>Seaborn</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/seaborn.png" alt="avatar"></p>
<h3 id="SciPy"><a href="#SciPy" class="headerlink" title="SciPy"></a>SciPy</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/scipy.png" alt="avatar"></p>
<h3 id="scikit-learn"><a href="#scikit-learn" class="headerlink" title="scikit-learn"></a>scikit-learn</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/scikit_learn.png" alt="avatar"></p>
<h3 id="keras"><a href="#keras" class="headerlink" title="keras"></a>keras</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/kearas.png" alt="avatar"></p>
<h3 id="bokeh"><a href="#bokeh" class="headerlink" title="bokeh"></a>bokeh</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/bokeh.png" alt="avatar"></p>
<h3 id="PySpark"><a href="#PySpark" class="headerlink" title="PySpark"></a>PySpark</h3><h4 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h4><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/spark_sql.png" alt="avatar"></p>
<h4 id="RDD"><a href="#RDD" class="headerlink" title="RDD"></a>RDD</h4><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/spark_rdd.png" alt="avatar"></p>
<h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><h3 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:     <span class="comment"># Runs main() if file wasn't imported.</span></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = &lt;list&gt;[from_inclusive : to_exclusive : Â±step_size]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt;.append(&lt;el&gt;)            <span class="comment"># Or: &lt;list&gt; += [&lt;el&gt;]</span></span><br><span class="line">&lt;list&gt;.extend(&lt;collection&gt;)    <span class="comment"># Or: &lt;list&gt; += &lt;collection&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt;.sort()</span><br><span class="line">&lt;list&gt;.reverse()</span><br><span class="line">&lt;list&gt; = sorted(&lt;collection&gt;)</span><br><span class="line">&lt;iter&gt; = reversed(&lt;list&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sum_of_elements  = sum(&lt;collection&gt;)</span><br><span class="line">elementwise_sum  = [sum(pair) <span class="keyword">for</span> pair <span class="keyword">in</span> zip(list_a, list_b)]</span><br><span class="line">sorted_by_second = sorted(&lt;collection&gt;, key=<span class="keyword">lambda</span> el: el[<span class="number">1</span>])</span><br><span class="line">sorted_by_both   = sorted(&lt;collection&gt;, key=<span class="keyword">lambda</span> el: (el[<span class="number">1</span>], el[<span class="number">0</span>]))</span><br><span class="line">flatter_list     = list(itertools.chain.from_iterable(&lt;list&gt;))</span><br><span class="line">product_of_elems = functools.reduce(<span class="keyword">lambda</span> out, x: out * x, &lt;collection&gt;)</span><br><span class="line">list_of_chars    = list(&lt;str&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">index = &lt;list&gt;.index(&lt;el&gt;)     <span class="comment"># Returns index of first occurrence or raises ValueError.</span></span><br><span class="line">&lt;list&gt;.insert(index, &lt;el&gt;)     <span class="comment"># Inserts item at index and moves the rest to the right.</span></span><br><span class="line">&lt;el&gt; = &lt;list&gt;.pop([index])     <span class="comment"># Removes and returns item at index or from the end.</span></span><br><span class="line">&lt;list&gt;.remove(&lt;el&gt;)            <span class="comment"># Removes first occurrence of item or raises ValueError.</span></span><br><span class="line">&lt;list&gt;.clear()                 <span class="comment"># Removes all items. Also works on dict and set.</span></span><br></pre></td></tr></table></figure>
<h3 id="Dictionary"><a href="#Dictionary" class="headerlink" title="Dictionary"></a>Dictionary</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;view&gt; = &lt;dict&gt;.keys()                          <span class="comment"># Coll. of keys that reflects changes.</span></span><br><span class="line">&lt;view&gt; = &lt;dict&gt;.values()                        <span class="comment"># Coll. of values that reflects changes.</span></span><br><span class="line">&lt;view&gt; = &lt;dict&gt;.items()                         <span class="comment"># Coll. of key-value tuples.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">value  = &lt;dict&gt;.get(key, default=<span class="literal">None</span>)          <span class="comment"># Returns default if key does not exist.</span></span><br><span class="line">value  = &lt;dict&gt;.setdefault(key, default=<span class="literal">None</span>)   <span class="comment"># Same, but also adds default to dict.</span></span><br><span class="line">&lt;dict&gt; = collections.defaultdict(&lt;type&gt;)        <span class="comment"># Creates a dict with default value of type.</span></span><br><span class="line">&lt;dict&gt; = collections.defaultdict(<span class="keyword">lambda</span>: <span class="number">1</span>)     <span class="comment"># Creates a dict with default value 1.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;dict&gt;.update(&lt;dict&gt;)</span><br><span class="line">&lt;dict&gt; = dict(&lt;collection&gt;)                     <span class="comment"># Creates a dict from coll. of key-value pairs.</span></span><br><span class="line">&lt;dict&gt; = dict(zip(keys, values))                <span class="comment"># Creates a dict from two collections.</span></span><br><span class="line">&lt;dict&gt; = dict.fromkeys(keys [, value])          <span class="comment"># Creates a dict from collection of keys.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">value = &lt;dict&gt;.pop(key)                         <span class="comment"># Removes item from dictionary.</span></span><br><span class="line">&#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> &lt;dict&gt;.items() <span class="keyword">if</span> k <span class="keyword">in</span> keys&#125;  <span class="comment"># Filters dictionary by keys.</span></span><br></pre></td></tr></table></figure>
<h3 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>colors = [<span class="string">'red'</span>, <span class="string">'blue'</span>, <span class="string">'yellow'</span>, <span class="string">'blue'</span>, <span class="string">'red'</span>, <span class="string">'blue'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = Counter(colors)</span><br><span class="line">Counter(&#123;<span class="string">'blue'</span>: <span class="number">3</span>, <span class="string">'red'</span>: <span class="number">2</span>, <span class="string">'yellow'</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter.most_common()[<span class="number">0</span>]</span><br><span class="line">(<span class="string">'blue'</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;set&gt; = set()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;set&gt;.add(&lt;el&gt;)                               <span class="comment"># Or: &lt;set&gt; |= &#123;&lt;el&gt;&#125;</span></span><br><span class="line">&lt;set&gt;.update(&lt;collection&gt;)                    <span class="comment"># Or: &lt;set&gt; |= &lt;set&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;set&gt;  = &lt;set&gt;.union(&lt;coll.&gt;)                 <span class="comment"># Or: &lt;set&gt; | &lt;set&gt;</span></span><br><span class="line">&lt;set&gt;  = &lt;set&gt;.intersection(&lt;coll.&gt;)          <span class="comment"># Or: &lt;set&gt; &amp; &lt;set&gt;</span></span><br><span class="line">&lt;set&gt;  = &lt;set&gt;.difference(&lt;coll.&gt;)            <span class="comment"># Or: &lt;set&gt; - &lt;set&gt;</span></span><br><span class="line">&lt;set&gt;  = &lt;set&gt;.symmetric_difference(&lt;coll.&gt;)  <span class="comment"># Or: &lt;set&gt; ^ &lt;set&gt;</span></span><br><span class="line">&lt;bool&gt; = &lt;set&gt;.issubset(&lt;coll.&gt;)              <span class="comment"># Or: &lt;set&gt; &lt;= &lt;set&gt;</span></span><br><span class="line">&lt;bool&gt; = &lt;set&gt;.issuperset(&lt;coll.&gt;)            <span class="comment"># Or: &lt;set&gt; &gt;= &lt;set&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;set&gt;.remove(&lt;el&gt;)                            <span class="comment"># Raises KeyError.</span></span><br><span class="line">&lt;set&gt;.discard(&lt;el&gt;)                           <span class="comment"># Doesn't raise an error.</span></span><br></pre></td></tr></table></figure>
<h4 id="Frozen-Set"><a href="#Frozen-Set" class="headerlink" title="Frozen Set"></a>Frozen Set</h4><ul>
<li><strong>Is immutable and hashable.</strong></li>
<li><strong>That means it can be used as a key in a dictionary or as an element in a set.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;frozenset&gt; = frozenset(&lt;collection&gt;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Tuple"><a href="#Tuple" class="headerlink" title="Tuple"></a>Tuple</h3><hr>
<p><strong>Tuple is an immutable and hashable list.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;tuple&gt; = ()</span><br><span class="line">&lt;tuple&gt; = (&lt;el&gt;, )</span><br><span class="line">&lt;tuple&gt; = (&lt;el_1&gt;, &lt;el_2&gt;, ...)</span><br></pre></td></tr></table></figure></p>
<h4 id="Named-Tuple"><a href="#Named-Tuple" class="headerlink" title="Named Tuple"></a>Named Tuple</h4><p><strong>Tupleâ€™s subclass with named elements.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Point = namedtuple(<span class="string">'Point'</span>, <span class="string">'x y'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Point(<span class="number">1</span>, y=<span class="number">2</span>)</span><br><span class="line">Point(x=<span class="number">1</span>, y=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p[<span class="number">0</span>]</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.x</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(p, <span class="string">'y'</span>)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p._fields  <span class="comment"># Or: Point._fields</span></span><br><span class="line">(<span class="string">'x'</span>, <span class="string">'y'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Range"><a href="#Range" class="headerlink" title="Range"></a>Range</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;range&gt; = range(to_exclusive)</span><br><span class="line">&lt;range&gt; = range(from_inclusive, to_exclusive)</span><br><span class="line">&lt;range&gt; = range(from_inclusive, to_exclusive, Â±step_size)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">from_inclusive = &lt;range&gt;.start</span><br><span class="line">to_exclusive   = &lt;range&gt;.stop</span><br></pre></td></tr></table></figure>
<h3 id="Enumerate"><a href="#Enumerate" class="headerlink" title="Enumerate"></a>Enumerate</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i, el <span class="keyword">in</span> enumerate(&lt;collection&gt; [, i_start]):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h3 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = iter(&lt;collection&gt;)                 <span class="comment"># Calling `iter(&lt;iter&gt;)` returns unmodified iterator.</span></span><br><span class="line">&lt;iter&gt; = iter(&lt;function&gt;, to_exclusive)     <span class="comment"># Sequence of return values until 'to_exclusive'.</span></span><br><span class="line">&lt;el&gt;   = next(&lt;iter&gt; [, default])           <span class="comment"># Raises StopIteration or returns 'default' on end.</span></span><br></pre></td></tr></table></figure>
<h4 id="Itertools"><a href="#Itertools" class="headerlink" title="Itertools"></a>Itertools</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count, repeat, cycle, chain, islice</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = count(start=<span class="number">0</span>, step=<span class="number">1</span>)             <span class="comment"># Returns incremented value endlessly.</span></span><br><span class="line">&lt;iter&gt; = repeat(&lt;el&gt; [, times])             <span class="comment"># Returns element endlessly or 'times' times.</span></span><br><span class="line">&lt;iter&gt; = cycle(&lt;collection&gt;)                <span class="comment"># Repeats the sequence indefinitely.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = chain(&lt;coll.&gt;, &lt;coll.&gt; [, ...])    <span class="comment"># Empties collections in order.</span></span><br><span class="line">&lt;iter&gt; = chain.from_iterable(&lt;collection&gt;)  <span class="comment"># Empties collections inside a collection in order.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = islice(&lt;collection&gt;, to_exclusive)</span><br><span class="line">&lt;iter&gt; = islice(&lt;collection&gt;, from_inclusive, to_exclusive)</span><br><span class="line">&lt;iter&gt; = islice(&lt;collection&gt;, from_inclusive, to_exclusive, +step_size)</span><br></pre></td></tr></table></figure>
<h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><hr>
<ul>
<li><strong>Convenient way to implement the iterator protocol.</strong></li>
<li><strong>Any function that contains a yield statement returns a generator object.</strong></li>
<li><strong>Generators and iterators are interchangeable.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(start, step)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> start</span><br><span class="line">        start += step</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = count(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(counter), next(counter), next(counter)</span><br><span class="line">(<span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h3><hr>
<ul>
<li><strong>Everything is an object.</strong></li>
<li><strong>Every object has a type.</strong></li>
<li><strong>Type and class are synonymous.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;type&gt; = type(&lt;el&gt;)                <span class="comment"># Or: &lt;el&gt;.__class__</span></span><br><span class="line">&lt;bool&gt; = isinstance(&lt;el&gt;, &lt;type&gt;)  <span class="comment"># Or: issubclass(type(&lt;el&gt;), &lt;type&gt;)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(<span class="string">'a'</span>), <span class="string">'a'</span>.__class__, str</span><br><span class="line">(&lt;class 'str'&gt;, &lt;class 'str'&gt;, &lt;class 'str'&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Some-types-do-not-have-builtin-names-so-they-must-be-imported"><a href="#Some-types-do-not-have-builtin-names-so-they-must-be-imported" class="headerlink" title="Some types do not have builtin names, so they must be imported:"></a>Some types do not have builtin names, so they must be imported:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> FunctionType, MethodType, LambdaType, GeneratorType</span><br></pre></td></tr></table></figure>
<h4 id="ABC"><a href="#ABC" class="headerlink" title="ABC"></a>ABC</h4><p><strong>An abstract base class introduces virtual subclasses, that donâ€™t inherit from it but are still recognized by isinstance() and issubclass().</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Sequence, Collection, Iterable</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], Iterable)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+------------------+----------+------------+----------+</span><br><span class="line">|                  | Sequence | Collection | Iterable |</span><br><span class="line">+------------------+----------+------------+----------+</span><br><span class="line">| list, range, str |   yes    |    yes     |   yes    |</span><br><span class="line">| dict, set        |          |    yes     |   yes    |</span><br><span class="line">| iter             |          |            |   yes    |</span><br><span class="line">+------------------+----------+------------+----------+</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> numbers <span class="keyword">import</span> Integral, Rational, Real, Complex, Number</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(<span class="number">123</span>, Number)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+--------------------+----------+----------+------+---------+--------+</span><br><span class="line">|                    | Integral | Rational | Real | Complex | Number |</span><br><span class="line">+--------------------+----------+----------+------+---------+--------+</span><br><span class="line">| int                |   yes    |   yes    | yes  |   yes   |  yes   |</span><br><span class="line">| fractions.Fraction |          |   yes    | yes  |   yes   |  yes   |</span><br><span class="line">| float              |          |          | yes  |   yes   |  yes   |</span><br><span class="line">| complex            |          |          |      |   yes   |  yes   |</span><br><span class="line">+--------------------+----------+----------+------+---------+--------+</span><br></pre></td></tr></table></figure>
<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = &lt;str&gt;.strip()                       <span class="comment"># Strips all whitespace characters from both ends.</span></span><br><span class="line">&lt;str&gt;  = &lt;str&gt;.strip(<span class="string">'&lt;chars&gt;'</span>)              <span class="comment"># Strips all passed characters from both ends.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = &lt;str&gt;.split()                       <span class="comment"># Splits on one or more whitespace characters.</span></span><br><span class="line">&lt;list&gt; = &lt;str&gt;.split(sep=<span class="literal">None</span>, maxsplit=<span class="number">-1</span>)  <span class="comment"># Splits on 'sep' str at most 'maxsplit' times.</span></span><br><span class="line">&lt;list&gt; = &lt;str&gt;.splitlines(keepends=<span class="literal">False</span>)    <span class="comment"># Splits on line breaks. Keeps them if 'keepends'.</span></span><br><span class="line">&lt;str&gt;  = &lt;str&gt;.join(&lt;coll_of_strings&gt;)       <span class="comment"># Joins elements using string as separator.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = &lt;sub_str&gt; <span class="keyword">in</span> &lt;str&gt;                  <span class="comment"># Checks if string contains a substring.</span></span><br><span class="line">&lt;bool&gt; = &lt;str&gt;.startswith(&lt;sub_str&gt;)         <span class="comment"># Pass tuple of strings for multiple options.</span></span><br><span class="line">&lt;bool&gt; = &lt;str&gt;.endswith(&lt;sub_str&gt;)           <span class="comment"># Pass tuple of strings for multiple options.</span></span><br><span class="line">&lt;int&gt;  = &lt;str&gt;.find(&lt;sub_str&gt;)               <span class="comment"># Returns start index of first match or -1.</span></span><br><span class="line">&lt;int&gt;  = &lt;str&gt;.index(&lt;sub_str&gt;)              <span class="comment"># Same but raises ValueError.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = &lt;str&gt;.replace(old, new [, count])   <span class="comment"># Replaces 'old' with 'new' at most 'count' times.</span></span><br><span class="line">&lt;bool&gt; = &lt;str&gt;.isnumeric()                   <span class="comment"># True if str contains only numeric characters.</span></span><br><span class="line">&lt;list&gt; = textwrap.wrap(&lt;str&gt;, width)         <span class="comment"># Nicely breaks string into lines.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Also: <code>&#39;lstrip()&#39;</code>, <code>&#39;rstrip()&#39;</code>.</strong></li>
<li><strong>Also: <code>&#39;lower()&#39;</code>, <code>&#39;upper()&#39;</code>, <code>&#39;capitalize()&#39;</code> and <code>&#39;title()&#39;</code>.</strong></li>
</ul>
<h4 id="Char"><a href="#Char" class="headerlink" title="Char"></a>Char</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt; = chr(&lt;int&gt;)  <span class="comment"># Converts int to unicode char.</span></span><br><span class="line">&lt;int&gt; = ord(&lt;str&gt;)  <span class="comment"># Converts unicode char to int.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ord(<span class="string">'0'</span>), ord(<span class="string">'9'</span>)</span><br><span class="line">(<span class="number">48</span>, <span class="number">57</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ord(<span class="string">'A'</span>), ord(<span class="string">'Z'</span>)</span><br><span class="line">(<span class="number">65</span>, <span class="number">90</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ord(<span class="string">'a'</span>), ord(<span class="string">'z'</span>)</span><br><span class="line">(<span class="number">97</span>, <span class="number">122</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Regex"><a href="#Regex" class="headerlink" title="Regex"></a>Regex</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">&lt;str&gt;   = re.sub(&lt;regex&gt;, new, text, count=<span class="number">0</span>)  <span class="comment"># Substitutes all occurrences.</span></span><br><span class="line">&lt;list&gt;  = re.findall(&lt;regex&gt;, text)            <span class="comment"># Returns all occurrences.</span></span><br><span class="line">&lt;list&gt;  = re.split(&lt;regex&gt;, text, maxsplit=<span class="number">0</span>)  <span class="comment"># Use brackets in regex to keep the matches.</span></span><br><span class="line">&lt;Match&gt; = re.search(&lt;regex&gt;, text)             <span class="comment"># Searches for first occurrence of pattern.</span></span><br><span class="line">&lt;Match&gt; = re.match(&lt;regex&gt;, text)              <span class="comment"># Searches only at the beginning of the text.</span></span><br><span class="line">&lt;iter&gt;  = re.finditer(&lt;regex&gt;, text)           <span class="comment"># Returns all occurrences as match objects.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Argument <code>&#39;flags=re.IGNORECASE&#39;</code> can be used with all functions.</strong></li>
<li><strong>Argument <code>&#39;flags=re.MULTILINE&#39;</code> makes <code>&#39;^&#39;</code> and <code>&#39;$&#39;</code> match the start/end of each line.</strong></li>
<li><strong>Argument <code>&#39;flags=re.DOTALL&#39;</code> makes dot also accept newline.</strong></li>
<li><strong>Use <code>r&#39;\1&#39;</code> or <code>&#39;\\1&#39;</code> for backreference.</strong></li>
<li><strong>Use <code>&#39;?&#39;</code> to make an operator non-greedy.</strong></li>
</ul>
<h4 id="Match-Object"><a href="#Match-Object" class="headerlink" title="Match Object"></a>Match Object</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;   = &lt;Match&gt;.group()   <span class="comment"># Whole match. Also group(0).</span></span><br><span class="line">&lt;str&gt;   = &lt;Match&gt;.group(<span class="number">1</span>)  <span class="comment"># Part in first bracket.</span></span><br><span class="line">&lt;tuple&gt; = &lt;Match&gt;.groups()  <span class="comment"># All bracketed parts.</span></span><br><span class="line">&lt;int&gt;   = &lt;Match&gt;.start()   <span class="comment"># Start index of a match.</span></span><br><span class="line">&lt;int&gt;   = &lt;Match&gt;.end()     <span class="comment"># Exclusive end index of a match.</span></span><br></pre></td></tr></table></figure>
<h4 id="Special-Sequences"><a href="#Special-Sequences" class="headerlink" title="Special Sequences"></a>Special Sequences</h4><ul>
<li><strong>By default digits, whitespaces and alphanumerics from all alphabets are matched, unless <code>&#39;flags=re.ASCII&#39;</code> argument is used.</strong></li>
<li><strong>Use capital letters for negation.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'\d'</span> == <span class="string">'[0-9]'</span>             <span class="comment"># Digit</span></span><br><span class="line"><span class="string">'\s'</span> == <span class="string">'[ \t\n\r\f\v]'</span>     <span class="comment"># Whitespace</span></span><br><span class="line"><span class="string">'\w'</span> == <span class="string">'[a-zA-Z0-9_]'</span>      <span class="comment"># Alphanumeric</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Format"><a href="#Format" class="headerlink" title="Format"></a>Format</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt; = <span class="string">f'<span class="subst">&#123;&lt;el_1&gt;&#125;</span>, <span class="subst">&#123;&lt;el_2&gt;&#125;</span>'</span></span><br><span class="line">&lt;str&gt; = <span class="string">'&#123;&#125;, &#123;&#125;'</span>.format(&lt;el_1&gt;, &lt;el_2&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Person = namedtuple(<span class="string">'Person'</span>, <span class="string">'name height'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person = Person(<span class="string">'Jean-Luc'</span>, <span class="number">187</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f'<span class="subst">&#123;person.height&#125;</span>'</span></span><br><span class="line"><span class="string">'187'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'&#123;p.height&#125;'</span>.format(p=person)</span><br><span class="line"><span class="string">'187'</span></span><br></pre></td></tr></table></figure>
<h4 id="General-Options"><a href="#General-Options" class="headerlink" title="General Options"></a>General Options</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&lt;el&gt;:&lt;<span class="number">10</span>&#125;       <span class="comment"># '&lt;el&gt;      '</span></span><br><span class="line">&#123;&lt;el&gt;:^<span class="number">10</span>&#125;       <span class="comment"># '   &lt;el&gt;   '</span></span><br><span class="line">&#123;&lt;el&gt;:&gt;<span class="number">10</span>&#125;       <span class="comment"># '      &lt;el&gt;'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&lt;el&gt;:.&lt;<span class="number">10</span>&#125;      <span class="comment"># '&lt;el&gt;......'</span></span><br><span class="line">&#123;&lt;el&gt;:&gt;<span class="number">0</span>&#125;        <span class="comment"># '&lt;el&gt;'</span></span><br></pre></td></tr></table></figure>
<h4 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h4><p><strong><code>&#39;!r&#39;</code> calls objectâ€™s repr() method, instead of str(), to get a string.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">'abcde'</span>!r:&lt;<span class="number">10</span>&#125;  <span class="comment"># "'abcde'   "</span></span><br><span class="line">&#123;<span class="string">'abcde'</span>:<span class="number">.3</span>&#125;     <span class="comment"># 'abc'</span></span><br><span class="line">&#123;<span class="string">'abcde'</span>:<span class="number">10.3</span>&#125;   <span class="comment"># 'abc       '</span></span><br></pre></td></tr></table></figure></p>
<h4 id="Numbers"><a href="#Numbers" class="headerlink" title="Numbers"></a>Numbers</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123; <span class="number">123456</span>:<span class="number">10</span>,&#125;    <span class="comment"># '   123,456'</span></span><br><span class="line">&#123; <span class="number">123456</span>:<span class="number">10</span>_&#125;    <span class="comment"># '   123_456'</span></span><br><span class="line">&#123; <span class="number">123456</span>:+<span class="number">10</span>&#125;    <span class="comment"># '   +123456'</span></span><br><span class="line">&#123;<span class="number">-123456</span>:=<span class="number">10</span>&#125;    <span class="comment"># '-   123456'</span></span><br><span class="line">&#123; <span class="number">123456</span>: &#125;      <span class="comment"># ' 123456'</span></span><br><span class="line">&#123;<span class="number">-123456</span>: &#125;      <span class="comment"># '-123456'</span></span><br></pre></td></tr></table></figure>
<h4 id="Floats"><a href="#Floats" class="headerlink" title="Floats"></a>Floats</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>&#125;   <span class="comment"># '      1.23'</span></span><br><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>f&#125;  <span class="comment"># '     1.235'</span></span><br><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>e&#125;  <span class="comment"># ' 1.235e+00'</span></span><br><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>%&#125;  <span class="comment"># '  123.456%'</span></span><br></pre></td></tr></table></figure>
<h4 id="Comparison-of-float-presentation-types"><a href="#Comparison-of-float-presentation-types" class="headerlink" title="Comparison of float presentation types:"></a>Comparison of float presentation types:</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|                |    &#123;&lt;float&gt;&#125;   |  &#123;&lt;float&gt;:f&#125;  |   &#123;&lt;float&gt;:e&#125;  |   &#123;&lt;float&gt;:%&#125;   |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|    0.000056789 |   &#39;5.6789e-05&#39; |    &#39;0.000057&#39; | &#39;5.678900e-05&#39; |     &#39;0.005679%&#39; |</span><br><span class="line">|    0.00056789  |   &#39;0.00056789&#39; |    &#39;0.000568&#39; | &#39;5.678900e-04&#39; |     &#39;0.056789%&#39; |</span><br><span class="line">|    0.0056789   |   &#39;0.0056789&#39;  |    &#39;0.005679&#39; | &#39;5.678900e-03&#39; |     &#39;0.567890%&#39; |</span><br><span class="line">|    0.056789    |   &#39;0.056789&#39;   |    &#39;0.056789&#39; | &#39;5.678900e-02&#39; |     &#39;5.678900%&#39; |</span><br><span class="line">|    0.56789     |   &#39;0.56789&#39;    |    &#39;0.567890&#39; | &#39;5.678900e-01&#39; |    &#39;56.789000%&#39; |</span><br><span class="line">|    5.6789      |   &#39;5.6789&#39;     |    &#39;5.678900&#39; | &#39;5.678900e+00&#39; |   &#39;567.890000%&#39; |</span><br><span class="line">|   56.789       |  &#39;56.789&#39;      |   &#39;56.789000&#39; | &#39;5.678900e+01&#39; |  &#39;5678.900000%&#39; |</span><br><span class="line">|  567.89        | &#39;567.89&#39;       |  &#39;567.890000&#39; | &#39;5.678900e+02&#39; | &#39;56789.000000%&#39; |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|                |  &#123;&lt;float&gt;:.2&#125;  | &#123;&lt;float&gt;:.2f&#125; |  &#123;&lt;float&gt;:.2e&#125; |  &#123;&lt;float&gt;:.2%&#125;  |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|    0.000056789 |   &#39;5.7e-05&#39;    |      &#39;0.00&#39;   |   &#39;5.68e-05&#39;   |       &#39;0.01%&#39;   |</span><br><span class="line">|    0.00056789  |   &#39;0.00057&#39;    |      &#39;0.00&#39;   |   &#39;5.68e-04&#39;   |       &#39;0.06%&#39;   |</span><br><span class="line">|    0.0056789   |   &#39;0.0057&#39;     |      &#39;0.01&#39;   |   &#39;5.68e-03&#39;   |       &#39;0.57%&#39;   |</span><br><span class="line">|    0.056789    |   &#39;0.057&#39;      |      &#39;0.06&#39;   |   &#39;5.68e-02&#39;   |       &#39;5.68%&#39;   |</span><br><span class="line">|    0.56789     |   &#39;0.57&#39;       |      &#39;0.57&#39;   |   &#39;5.68e-01&#39;   |      &#39;56.79%&#39;   |</span><br><span class="line">|    5.6789      |   &#39;5.7&#39;        |      &#39;5.68&#39;   |   &#39;5.68e+00&#39;   |     &#39;567.89%&#39;   |</span><br><span class="line">|   56.789       |   &#39;5.7e+01&#39;    |     &#39;56.79&#39;   |   &#39;5.68e+01&#39;   |    &#39;5678.90%&#39;   |</span><br><span class="line">|  567.89        |   &#39;5.7e+02&#39;    |    &#39;567.89&#39;   |   &#39;5.68e+02&#39;   |   &#39;56789.00%&#39;   |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br></pre></td></tr></table></figure>
<h4 id="Ints"><a href="#Ints" class="headerlink" title="Ints"></a>Ints</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="number">90</span>:c&#125;           <span class="comment"># 'Z'</span></span><br><span class="line">&#123;<span class="number">90</span>:X&#125;           <span class="comment"># '5A'</span></span><br><span class="line">&#123;<span class="number">90</span>:b&#125;           <span class="comment"># '1011010'</span></span><br></pre></td></tr></table></figure>
<h3 id="Numbers-1"><a href="#Numbers-1" class="headerlink" title="Numbers"></a>Numbers</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;int&gt;      = int(&lt;float/str/bool&gt;)    <span class="comment"># Or: math.floor(&lt;float&gt;)</span></span><br><span class="line">&lt;float&gt;    = float(&lt;int/str/bool&gt;)</span><br><span class="line">&lt;complex&gt;  = complex(real=<span class="number">0</span>, imag=<span class="number">0</span>)  <span class="comment"># Or: &lt;real&gt; + &lt;real&gt;j</span></span><br><span class="line">&lt;Fraction&gt; = fractions.Fraction(numerator=<span class="number">0</span>, denominator=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>&#39;int(&lt;str&gt;)&#39;</code> and <code>&#39;float(&lt;str&gt;)&#39;</code> raise â€˜ValueErrorâ€™ on malformed strings.</strong></li>
</ul>
<h4 id="Basic-Functions"><a href="#Basic-Functions" class="headerlink" title="Basic Functions"></a>Basic Functions</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;num&gt;  = pow(&lt;num&gt;, &lt;num&gt;)            <span class="comment"># Or: &lt;num&gt; ** &lt;num&gt;</span></span><br><span class="line">&lt;real&gt; = abs(&lt;num&gt;)</span><br><span class="line">&lt;int&gt;  = round(&lt;real&gt;)</span><br><span class="line">&lt;real&gt; = round(&lt;real&gt;, Â±ndigits)      <span class="comment"># `round(126, -1) == 130`</span></span><br></pre></td></tr></table></figure>
<h4 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> e, pi, inf, nan</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> cos, acos, sin, asin, tan, atan, degrees, radians</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> log, log10, log2</span><br></pre></td></tr></table></figure>
<h4 id="Statistics"><a href="#Statistics" class="headerlink" title="Statistics"></a>Statistics</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> statistics <span class="keyword">import</span> mean, median, variance, pvariance, pstdev</span><br></pre></td></tr></table></figure>
<h4 id="Random"><a href="#Random" class="headerlink" title="Random"></a>Random</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> random, randint, choice, shuffle</span><br><span class="line">&lt;float&gt; = random()</span><br><span class="line">&lt;int&gt;   = randint(from_inclusive, to_inclusive)</span><br><span class="line">&lt;el&gt;    = choice(&lt;list&gt;)</span><br><span class="line">shuffle(&lt;list&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Bin-Hex"><a href="#Bin-Hex" class="headerlink" title="Bin, Hex"></a>Bin, Hex</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;int&gt;     = <span class="number">0</span>b&lt;bin&gt;            <span class="comment"># Or: 0x&lt;hex&gt;</span></span><br><span class="line">&lt;int&gt;     = int(<span class="string">'0b&lt;bin&gt;'</span>, <span class="number">0</span>)  <span class="comment"># Or: int('0x&lt;hex&gt;', 0)</span></span><br><span class="line">&lt;int&gt;     = int(<span class="string">'&lt;bin&gt;'</span>, <span class="number">2</span>)    <span class="comment"># Or: int('&lt;hex&gt;', 16)</span></span><br><span class="line"><span class="string">'0b&lt;bin&gt;'</span> = bin(&lt;int&gt;)         <span class="comment"># Or: '0x&lt;hex&gt;' = hex(&lt;int&gt;)</span></span><br></pre></td></tr></table></figure>
<h4 id="Bitwise-Operators"><a href="#Bitwise-Operators" class="headerlink" title="Bitwise Operators"></a>Bitwise Operators</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;int&gt;     = &lt;int&gt; &amp; &lt;int&gt;      <span class="comment"># And</span></span><br><span class="line">&lt;int&gt;     = &lt;int&gt; | &lt;int&gt;      <span class="comment"># Or</span></span><br><span class="line">&lt;int&gt;     = &lt;int&gt; ^ &lt;int&gt;      <span class="comment"># Xor (0 if both bits equal)</span></span><br><span class="line">&lt;int&gt;     = &lt;int&gt; &lt;&lt; n_bits    <span class="comment"># Shift left</span></span><br><span class="line">&lt;int&gt;     = &lt;int&gt; &gt;&gt; n_bits    <span class="comment"># Shift right</span></span><br><span class="line">&lt;int&gt;     = ~&lt;int&gt;             <span class="comment"># Compliment (flips bits)</span></span><br></pre></td></tr></table></figure>
<h3 id="Combinatorics"><a href="#Combinatorics" class="headerlink" title="Combinatorics"></a>Combinatorics</h3><hr>
<ul>
<li><strong>Every function returns an iterator.</strong></li>
<li><strong>If you want to print the iterator, you need to pass it to the list() function!</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product, combinations, combinations_with_replacement, permutations</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>product([<span class="number">0</span>, <span class="number">1</span>], repeat=<span class="number">3</span>)</span><br><span class="line">[(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>product(<span class="string">'ab'</span>, <span class="string">'12'</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'1'</span>), (<span class="string">'a'</span>, <span class="string">'2'</span>),</span><br><span class="line"> (<span class="string">'b'</span>, <span class="string">'1'</span>), (<span class="string">'b'</span>, <span class="string">'2'</span>)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>combinations(<span class="string">'abc'</span>, <span class="number">2</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'b'</span>), (<span class="string">'a'</span>, <span class="string">'c'</span>), (<span class="string">'b'</span>, <span class="string">'c'</span>)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>combinations_with_replacement(<span class="string">'abc'</span>, <span class="number">2</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'a'</span>), (<span class="string">'a'</span>, <span class="string">'b'</span>), (<span class="string">'a'</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="string">'b'</span>, <span class="string">'b'</span>), (<span class="string">'b'</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="string">'c'</span>, <span class="string">'c'</span>)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>permutations(<span class="string">'abc'</span>, <span class="number">2</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'b'</span>), (<span class="string">'a'</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="string">'b'</span>, <span class="string">'a'</span>), (<span class="string">'b'</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="string">'c'</span>, <span class="string">'a'</span>), (<span class="string">'c'</span>, <span class="string">'b'</span>)]</span><br></pre></td></tr></table></figure>
<h3 id="Datetime"><a href="#Datetime" class="headerlink" title="Datetime"></a>Datetime</h3><hr>
<ul>
<li><strong>Module â€˜datetimeâ€™ provides â€˜dateâ€™ <code>&lt;D&gt;</code>, â€˜timeâ€™ <code>&lt;T&gt;</code>, â€˜datetimeâ€™ <code>&lt;DT&gt;</code> and â€˜timedeltaâ€™ <code>&lt;TD&gt;</code> classes. All are immutable and hashable.</strong></li>
<li><strong>Time and datetime can be â€˜awareâ€™ <code>&lt;a&gt;</code>, meaning they have defined timezone, or â€˜naiveâ€™ <code>&lt;n&gt;</code>, meaning they donâ€™t.</strong></li>
<li><strong>If object is naive it is presumed to be in systemâ€™s timezone.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date, time, datetime, timedelta</span><br><span class="line"><span class="keyword">from</span> dateutil.tz <span class="keyword">import</span> UTC, tzlocal, gettz</span><br></pre></td></tr></table></figure>
<h4 id="Constructors"><a href="#Constructors" class="headerlink" title="Constructors"></a>Constructors</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;D&gt;  = date(year, month, day)</span><br><span class="line">&lt;T&gt;  = time(hour=<span class="number">0</span>, minute=<span class="number">0</span>, second=<span class="number">0</span>, microsecond=<span class="number">0</span>, tzinfo=<span class="literal">None</span>, fold=<span class="number">0</span>)</span><br><span class="line">&lt;DT&gt; = datetime(year, month, day, hour=<span class="number">0</span>, minute=<span class="number">0</span>, second=<span class="number">0</span>, ...)</span><br><span class="line">&lt;TD&gt; = timedelta(days=<span class="number">0</span>, seconds=<span class="number">0</span>, microseconds=<span class="number">0</span>, milliseconds=<span class="number">0</span>,</span><br><span class="line">                 minutes=<span class="number">0</span>, hours=<span class="number">0</span>, weeks=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Use <code>&#39;&lt;D/DT&gt;.weekday()&#39;</code> to get the day of the week (Mon == 0).</strong></li>
<li><strong><code>&#39;fold=1&#39;</code> means second pass in case of time jumping back for one hour.</strong></li>
</ul>
<h4 id="Now"><a href="#Now" class="headerlink" title="Now"></a>Now</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;D/DTn&gt;  = D/DT.today()                     <span class="comment"># Current local date or naive datetime.</span></span><br><span class="line">&lt;DTn&gt;    = DT.utcnow()                      <span class="comment"># Naive datetime from current UTC time.</span></span><br><span class="line">&lt;DTa&gt;    = DT.now(&lt;tzinfo&gt;)                 <span class="comment"># Aware datetime from current tz time.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>To extract time use <code>&#39;&lt;DTn&gt;.time()&#39;</code>, <code>&#39;&lt;DTa&gt;.time()&#39;</code> or <code>&#39;&lt;DTa&gt;.timetz()&#39;</code>.</strong></li>
</ul>
<h4 id="Timezone"><a href="#Timezone" class="headerlink" title="Timezone"></a>Timezone</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;tzinfo&gt; = UTC                              <span class="comment"># UTC timezone. London without DST.</span></span><br><span class="line">&lt;tzinfo&gt; = tzlocal()                        <span class="comment"># Local timezone. Also gettz().</span></span><br><span class="line">&lt;tzinfo&gt; = gettz(<span class="string">'&lt;Cont.&gt;/&lt;City&gt;'</span>)          <span class="comment"># Timezone from 'Continent/City_Name' str.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;DTa&gt;    = &lt;DT&gt;.astimezone(&lt;tzinfo&gt;)        <span class="comment"># Datetime, converted to passed timezone.</span></span><br><span class="line">&lt;Ta/DTa&gt; = &lt;T/DT&gt;.replace(tzinfo=&lt;tzinfo&gt;)  <span class="comment"># Unconverted object with new timezone.</span></span><br></pre></td></tr></table></figure>
<h4 id="Encode"><a href="#Encode" class="headerlink" title="Encode"></a>Encode</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;D/T/DT&gt; = D/T/DT.fromisoformat(<span class="string">'&lt;iso&gt;'</span>)    <span class="comment"># Object from ISO string.</span></span><br><span class="line">&lt;DT&gt;     = DT.strptime(&lt;str&gt;, <span class="string">'&lt;format&gt;'</span>)   <span class="comment"># Datetime from str, according to format.</span></span><br><span class="line">&lt;D/DTn&gt;  = D/DT.fromordinal(&lt;int&gt;)          <span class="comment"># D/DTn from days since Christ, at midnight.</span></span><br><span class="line">&lt;DTn&gt;    = DT.fromtimestamp(&lt;real&gt;)         <span class="comment"># Local time DTn from seconds since Epoch.</span></span><br><span class="line">&lt;DTa&gt;    = DT.fromtimestamp(&lt;real&gt;, &lt;tz.&gt;)  <span class="comment"># Aware datetime from seconds since Epoch.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ISO strings come in following forms: <code>&#39;YYYY-MM-DD&#39;</code>, <code>&#39;HH:MM:SS.ffffff[Â±&lt;offset&gt;]&#39;</code>, or both separated by <code>&#39;T&#39;</code>. Offset is formatted as: <code>&#39;HH:MM&#39;</code>.</strong></li>
<li><strong>On Unix systems Epoch is <code>&#39;1970-01-01 00:00 UTC&#39;</code>, <code>&#39;1970-01-01 01:00 CET&#39;</code>, â€¦</strong></li>
</ul>
<h4 id="Decode"><a href="#Decode" class="headerlink" title="Decode"></a>Decode</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;    = &lt;D/T/DT&gt;.isoformat()             <span class="comment"># ISO string representation.</span></span><br><span class="line">&lt;str&gt;    = &lt;D/T/DT&gt;.strftime(<span class="string">'&lt;format&gt;'</span>)    <span class="comment"># Custom string representation.</span></span><br><span class="line">&lt;int&gt;    = &lt;D/DT&gt;.toordinal()               <span class="comment"># Days since Christ, ignoring time and tz.</span></span><br><span class="line">&lt;float&gt;  = &lt;DTn&gt;.timestamp()                <span class="comment"># Seconds since Epoch from DTn in local time.</span></span><br><span class="line">&lt;float&gt;  = &lt;DTa&gt;.timestamp()                <span class="comment"># Seconds since Epoch from DTa.</span></span><br></pre></td></tr></table></figure>
<h4 id="Format-1"><a href="#Format-1" class="headerlink" title="Format"></a>Format</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = datetime.strptime(<span class="string">'2015-05-14 23:39:00.00 +0200'</span>, <span class="string">'%Y-%m-%d %H:%M:%S.%f %z'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt.strftime(<span class="string">"%A, %dth of %B '%y, %I:%M%p %Z"</span>)</span><br><span class="line"><span class="string">"Thursday, 14th of May '15, 11:39PM UTC+02:00"</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>For abbreviated weekday and month use <code>&#39;%a&#39;</code> and <code>&#39;%b&#39;</code>.</strong></li>
<li><strong>When parsing, <code>&#39;%z&#39;</code> also accepts <code>&#39;Â±HH:MM&#39;</code>.</strong></li>
</ul>
<h4 id="Arithmetics"><a href="#Arithmetics" class="headerlink" title="Arithmetics"></a>Arithmetics</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;D/DT&gt;   = &lt;D/DT&gt; Â±  &lt;TD&gt;</span><br><span class="line">&lt;TD&gt;     = &lt;TD&gt;   Â±  &lt;TD&gt;</span><br><span class="line">&lt;TD&gt;     = &lt;TD&gt;   */ &lt;real&gt;</span><br><span class="line">&lt;float&gt;  = &lt;TD&gt;   /  &lt;TD&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Arguments"><a href="#Arguments" class="headerlink" title="Arguments"></a>Arguments</h3><hr>
<h4 id="Inside-Function-Call"><a href="#Inside-Function-Call" class="headerlink" title="Inside Function Call"></a>Inside Function Call</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;function&gt;(&lt;positional_args&gt;)                  <span class="comment"># f(0, 0)</span></span><br><span class="line">&lt;function&gt;(&lt;keyword_args&gt;)                     <span class="comment"># f(x=0, y=0)</span></span><br><span class="line">&lt;function&gt;(&lt;positional_args&gt;, &lt;keyword_args&gt;)  <span class="comment"># f(0, y=0)</span></span><br></pre></td></tr></table></figure>
<h4 id="Inside-Function-Definition"><a href="#Inside-Function-Definition" class="headerlink" title="Inside Function Definition"></a>Inside Function Definition</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(&lt;nondefault_args&gt;)</span>:</span>                      <span class="comment"># def f(x, y):</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(&lt;default_args&gt;)</span>:</span>                         <span class="comment"># def f(x=0, y=0):</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(&lt;nondefault_args&gt;, &lt;default_args&gt;)</span>:</span>      <span class="comment"># def f(x, y=0):</span></span><br></pre></td></tr></table></figure>
<h3 id="Splat-Operator"><a href="#Splat-Operator" class="headerlink" title="Splat Operator"></a>Splat Operator</h3><hr>
<h4 id="Inside-Function-Call-1"><a href="#Inside-Function-Call-1" class="headerlink" title="Inside Function Call"></a>Inside Function Call</h4><p><strong>Splat expands a collection into positional arguments, while splatty-splat expands a dictionary into keyword arguments.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">args   = (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">kwargs = &#123;<span class="string">'x'</span>: <span class="number">3</span>, <span class="string">'y'</span>: <span class="number">4</span>, <span class="string">'z'</span>: <span class="number">5</span>&#125;</span><br><span class="line">func(*args, **kwargs)</span><br></pre></td></tr></table></figure></p>
<h5 id="Is-the-same-as"><a href="#Is-the-same-as" class="headerlink" title="Is the same as:"></a>Is the same as:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, x=<span class="number">3</span>, y=<span class="number">4</span>, z=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Inside-Function-Definition-1"><a href="#Inside-Function-Definition-1" class="headerlink" title="Inside Function Definition"></a>Inside Function Definition</h4><p><strong>Splat combines zero or more positional arguments into a tuple, while splatty-splat combines zero or more keyword arguments into a dictionary.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(*a)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> sum(a)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>
<h5 id="Legal-argument-combinations"><a href="#Legal-argument-combinations" class="headerlink" title="Legal argument combinations:"></a>Legal argument combinations:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, y, z)</span>:</span>                <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3) | f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*, x, y, z)</span>:</span>             <span class="comment"># f(x=1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *, y, z)</span>:</span>             <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, y, *, z)</span>:</span>             <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*args)</span>:</span>                  <span class="comment"># f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *args)</span>:</span>               <span class="comment"># f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*args, z)</span>:</span>               <span class="comment"># f(1, 2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *args, z)</span>:</span>            <span class="comment"># f(1, 2, z=3)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(**kwargs)</span>:</span>               <span class="comment"># f(x=1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, **kwargs)</span>:</span>            <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*, x, **kwargs)</span>:</span>         <span class="comment"># f(x=1, y=2, z=3)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*args, **kwargs)</span>:</span>        <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3) | f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *args, **kwargs)</span>:</span>     <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3) | f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*args, y, **kwargs)</span>:</span>     <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *args, z, **kwargs)</span>:</span>  <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3)</span></span><br></pre></td></tr></table></figure>
<h4 id="Other-Uses"><a href="#Other-Uses" class="headerlink" title="Other Uses"></a>Other Uses</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt;  = [*&lt;collection&gt; [, ...]]</span><br><span class="line">&lt;set&gt;   = &#123;*&lt;collection&gt; [, ...]&#125;</span><br><span class="line">&lt;tuple&gt; = (*&lt;collection&gt;, [...])</span><br><span class="line">&lt;dict&gt;  = &#123;**&lt;dict&gt; [, ...]&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">head, *body, tail = &lt;collection&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Inline"><a href="#Inline" class="headerlink" title="Inline"></a>Inline</h3><hr>
<h4 id="Lambda"><a href="#Lambda" class="headerlink" title="Lambda"></a>Lambda</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;function&gt; = <span class="keyword">lambda</span>: &lt;return_value&gt;</span><br><span class="line">&lt;function&gt; = <span class="keyword">lambda</span> &lt;argument_1&gt;, &lt;argument_2&gt;: &lt;return_value&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Comprehension"><a href="#Comprehension" class="headerlink" title="Comprehension"></a>Comprehension</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = [i+<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]                   <span class="comment"># [1, 2, ..., 10]</span></span><br><span class="line">&lt;set&gt;  = &#123;i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> i &gt; <span class="number">5</span>&#125;            <span class="comment"># &#123;6, 7, 8, 9&#125;</span></span><br><span class="line">&lt;iter&gt; = (i+<span class="number">5</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>))                   <span class="comment"># (5, 6, ..., 14)</span></span><br><span class="line">&lt;dict&gt; = &#123;i: i*<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)&#125;                <span class="comment"># &#123;0: 0, 1: 2, ..., 9: 18&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">out = [i+j <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br></pre></td></tr></table></figure>
<h4 id="Is-the-same-as-1"><a href="#Is-the-same-as-1" class="headerlink" title="Is the same as:"></a>Is the same as:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">out = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        out.append(i+j)</span><br></pre></td></tr></table></figure>
<h3 id="Map-Filter-Reduce"><a href="#Map-Filter-Reduce" class="headerlink" title="Map, Filter, Reduce"></a>Map, Filter, Reduce</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line">&lt;iter&gt; = map(<span class="keyword">lambda</span> x: x + <span class="number">1</span>, range(<span class="number">10</span>))            <span class="comment"># (1, 2, ..., 10)</span></span><br><span class="line">&lt;iter&gt; = filter(<span class="keyword">lambda</span> x: x &gt; <span class="number">5</span>, range(<span class="number">10</span>))         <span class="comment"># (6, 7, 8, 9)</span></span><br><span class="line">&lt;int&gt;  = reduce(<span class="keyword">lambda</span> out, x: out + x, range(<span class="number">10</span>))  <span class="comment"># 45</span></span><br></pre></td></tr></table></figure>
<h4 id="Any-All"><a href="#Any-All" class="headerlink" title="Any, All"></a>Any, All</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = any(&lt;collection&gt;)                          <span class="comment"># False if empty.</span></span><br><span class="line">&lt;bool&gt; = all(el[<span class="number">1</span>] <span class="keyword">for</span> el <span class="keyword">in</span> &lt;collection&gt;)          <span class="comment"># True if empty.</span></span><br></pre></td></tr></table></figure>
<h4 id="If-Else"><a href="#If-Else" class="headerlink" title="If - Else"></a>If - Else</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;expression_if_true&gt; <span class="keyword">if</span> &lt;condition&gt; <span class="keyword">else</span> &lt;expression_if_false&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[a <span class="keyword">if</span> a <span class="keyword">else</span> <span class="string">'zero'</span> <span class="keyword">for</span> a <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>)]</span><br><span class="line">[<span class="string">'zero'</span>, <span class="number">1</span>, <span class="string">'zero'</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<h4 id="Namedtuple-Enum-Dataclass"><a href="#Namedtuple-Enum-Dataclass" class="headerlink" title="Namedtuple, Enum, Dataclass"></a>Namedtuple, Enum, Dataclass</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">Point     = namedtuple(<span class="string">'Point'</span>, <span class="string">'x y'</span>)</span><br><span class="line">point     = Point(<span class="number">0</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line">Direction = Enum(<span class="string">'Direction'</span>, <span class="string">'n e s w'</span>)</span><br><span class="line">direction = Direction.n</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> make_dataclass</span><br><span class="line">Creature  = make_dataclass(<span class="string">'Creature'</span>, [<span class="string">'location'</span>, <span class="string">'direction'</span>])</span><br><span class="line">creature  = Creature(Point(<span class="number">0</span>, <span class="number">0</span>), Direction.n)</span><br></pre></td></tr></table></figure>
<h3 id="Closure"><a href="#Closure" class="headerlink" title="Closure"></a>Closure</h3><hr>
<p><strong>We have a closure in Python when:</strong></p>
<ul>
<li><strong>A nested function references a value of its enclosing function and then</strong></li>
<li><strong>the enclosing function returns the nested function.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_multiplier</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(b)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> a * b</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3 = get_multiplier(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If multiple nested functions within enclosing function reference the same value, that value gets shared.</strong></li>
<li><strong>To dynamically access functionâ€™s first free variable use <code>&#39;&lt;function&gt;.__closure__[0].cell_contents&#39;</code>.</strong></li>
</ul>
<h4 id="Partial"><a href="#Partial" class="headerlink" title="Partial"></a>Partial</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line">&lt;function&gt; = partial(&lt;function&gt; [, &lt;arg_1&gt;, &lt;arg_2&gt;, ...])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> operator <span class="keyword">as</span> op</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3 = partial(op.mul, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Partial is also useful in cases when a function needs to be passed as an argument, because it enables us to set its arguments beforehand.</strong></li>
<li><strong>A few examples being <code>&#39;defaultdict(&lt;function&gt;)&#39;</code>, <code>&#39;iter(&lt;function&gt;, to_exclusive)&#39;</code> and dataclassâ€™s <code>&#39;field(default_factory=&lt;function&gt;)&#39;</code>.</strong></li>
</ul>
<h4 id="Nonlocal"><a href="#Nonlocal" class="headerlink" title="Nonlocal"></a>Nonlocal</h4><p><strong>If variable is being assigned to anywhere in the scope, it is regarded as a local variable, unless it is declared as a â€˜globalâ€™ or a â€˜nonlocalâ€™.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_counter</span><span class="params">()</span>:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = get_counter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter(), counter(), counter()</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Decorator"><a href="#Decorator" class="headerlink" title="Decorator"></a>Decorator</h3><hr>
<p><strong>A decorator takes a function, adds some functionality and returns it.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@decorator_name</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function_that_gets_passed_to_decorator</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h4 id="Debugger-Example"><a href="#Debugger-Example" class="headerlink" title="Debugger Example"></a>Debugger Example</h4><p><strong>Decorator that prints functionâ€™s name every time it gets called.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(func.__name__)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="meta">@debug</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Wraps is a helper decorator that copies metadata of function add() to function out().</strong></li>
<li><strong>Without it <code>&#39;add.__name__&#39;</code> would return <code>&#39;out&#39;</code>.</strong></li>
</ul>
<h4 id="LRU-Cache"><a href="#LRU-Cache" class="headerlink" title="LRU Cache"></a>LRU Cache</h4><p><strong>Decorator that caches functionâ€™s return values. All functionâ€™s arguments must be hashable.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"></span><br><span class="line"><span class="meta">@lru_cache(maxsize=None)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> n <span class="keyword">if</span> n &lt; <span class="number">2</span> <span class="keyword">else</span> fib(n<span class="number">-2</span>) + fib(n<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Recursion depth is limited to 1000 by default. To increase it use <code>&#39;sys.setrecursionlimit(&lt;depth&gt;)&#39;</code>.</strong></li>
</ul>
<h4 id="Parametrized-Decorator"><a href="#Parametrized-Decorator" class="headerlink" title="Parametrized Decorator"></a>Parametrized Decorator</h4><p><strong>A decorator that accepts arguments and returns a normal decorator that accepts a function.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">(print_result=False)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">        @wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            result = func(*args, **kwargs)</span><br><span class="line">            print(func.__name__, result <span class="keyword">if</span> print_result <span class="keyword">else</span> <span class="string">''</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@debug(print_result=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure></p>
<h3 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">name</span>&gt;:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        class_name = self.__class__.__name__</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'<span class="subst">&#123;class_name&#125;</span>(<span class="subst">&#123;self.a!r&#125;</span>)'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self.a)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_class_name</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.__name__</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Return value of repr() should be unambiguous and of str() readable.</strong></li>
<li><strong>If only repr() is defined, it will be also used for str().</strong></li>
</ul>
<h4 id="Str-use-cases"><a href="#Str-use-cases" class="headerlink" title="Str() use cases:"></a>Str() use cases:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(&lt;el&gt;)</span><br><span class="line">print(<span class="string">f'<span class="subst">&#123;&lt;el&gt;&#125;</span>'</span>)</span><br><span class="line"><span class="keyword">raise</span> Exception(&lt;el&gt;)</span><br><span class="line">logging.debug(&lt;el&gt;)</span><br><span class="line">csv.writer(&lt;file&gt;).writerow([&lt;el&gt;])</span><br></pre></td></tr></table></figure>
<h4 id="Repr-use-cases"><a href="#Repr-use-cases" class="headerlink" title="Repr() use cases:"></a>Repr() use cases:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print([&lt;el&gt;])</span><br><span class="line">print(<span class="string">f'<span class="subst">&#123;&lt;el&gt;!r&#125;</span>'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&lt;el&gt;</span><br><span class="line">loguru.logger.exception()</span><br><span class="line">Z = dataclasses.make_dataclass(<span class="string">'Z'</span>, [<span class="string">'a'</span>]); print(Z(&lt;el&gt;))</span><br></pre></td></tr></table></figure>
<h4 id="Constructor-Overloading"><a href="#Constructor-Overloading" class="headerlink" title="Constructor Overloading"></a>Constructor Overloading</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">name</span>&gt;:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a=None)</span>:</span></span><br><span class="line">        self.a = a</span><br></pre></td></tr></table></figure>
<h4 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age  = age</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span><span class="params">(Person)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, staff_num)</span>:</span></span><br><span class="line">        super().__init__(name, age)</span><br><span class="line">        self.staff_num = staff_num</span><br></pre></td></tr></table></figure>
<h4 id="Multiple-Inheritance"><a href="#Multiple-Inheritance" class="headerlink" title="Multiple Inheritance"></a>Multiple Inheritance</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span> <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span> <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A, B)</span>:</span> <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><strong>MRO determines the order in which parent classes are traversed when searching for a method:</strong><br><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>C.mro()</span><br><span class="line">[&lt;class 'C'&gt;, &lt;class 'A'&gt;, &lt;class 'B'&gt;, &lt;class 'object'&gt;]</span><br></pre></td></tr></table></figure></p>
<h4 id="Property"><a href="#Property" class="headerlink" title="Property"></a>Property</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._a</span><br><span class="line"></span><br><span class="line"><span class="meta">    @a.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self._a = value</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>el = MyClass()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>el.a = <span class="number">123</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>el.a</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure>
<h4 id="Dataclass"><a href="#Dataclass" class="headerlink" title="Dataclass"></a>Dataclass</h4><p><strong>Decorator that automatically generates init(), repr() and eq() special methods.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, field</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass(order=False, frozen=False)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">class_name</span>&gt;:</span></span><br><span class="line">    &lt;attr_name_1&gt;: &lt;type&gt;</span><br><span class="line">    &lt;attr_name_2&gt;: &lt;type&gt; = &lt;default_value&gt;</span><br><span class="line">    &lt;attr_name_3&gt;: list/dict/set = field(default_factory=list/dict/set)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>An object can be made sortable with <code>&#39;order=True&#39;</code> or immutable with <code>&#39;frozen=True&#39;</code>.</strong></li>
<li><strong>Function field() is needed because <code>&#39;&lt;attr_name&gt;: list = []&#39;</code> would make a list that is shared among all instances.</strong></li>
<li><strong>Default_factory can be any callable.</strong></li>
</ul>
<h4 id="Slots"><a href="#Slots" class="headerlink" title="Slots"></a>Slots</h4><p><strong>Mechanism that restricts objects to attributes listed in â€˜slotsâ€™ and significantly reduces their memory footprint.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClassWithSlots</span>:</span></span><br><span class="line">    __slots__ = [<span class="string">'a'</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.a = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="Copy"><a href="#Copy" class="headerlink" title="Copy"></a>Copy</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> copy, deepcopy</span><br><span class="line">&lt;object&gt; = copy(&lt;object&gt;)</span><br><span class="line">&lt;object&gt; = deepcopy(&lt;object&gt;)</span><br></pre></td></tr></table></figure>
<h3 id="Duck-Types"><a href="#Duck-Types" class="headerlink" title="Duck Types"></a>Duck Types</h3><hr>
<p><strong>A duck type is an implicit type that prescribes a set of special methods. Any object that has those methods defined is considered a member of that duck type.</strong></p>
<h4 id="Comparable"><a href="#Comparable" class="headerlink" title="Comparable"></a>Comparable</h4><ul>
<li><strong>If eq() method is not overridden, it returns <code>&#39;id(self) == id(other)&#39;</code>, which is the same as <code>&#39;self is other&#39;</code>.</strong></li>
<li><strong>That means all objects compare not equal by default.</strong></li>
<li><strong>Only left side object has eq() method called, unless it returns â€˜NotImplementedâ€™, in which case the right object is consulted.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComparable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(other, type(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a == other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br></pre></td></tr></table></figure>
<h4 id="Hashable"><a href="#Hashable" class="headerlink" title="Hashable"></a>Hashable</h4><ul>
<li><strong>Hashable object needs both hash() and eq() methods and its hash value should never change.</strong></li>
<li><strong>Hashable objects that compare equal must have the same hash value, meaning default hash() that returns <code>&#39;id(self)&#39;</code> will not do.</strong></li>
<li><strong>That is why Python automatically makes classes unhashable if you only implement eq().</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHashable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self._a = copy.deepcopy(a)</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(other, type(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a == other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> hash(self.a)</span><br></pre></td></tr></table></figure>
<h4 id="Sortable"><a href="#Sortable" class="headerlink" title="Sortable"></a>Sortable</h4><ul>
<li><strong>With â€˜total_orderingâ€™ decorator you only need to provide eq() and one of lt(), gt(), le() or ge() special methods.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> total_ordering</span><br><span class="line"></span><br><span class="line"><span class="meta">@total_ordering</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySortable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(other, type(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a == other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(other, type(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a &lt; other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Iterator-1"><a href="#Iterator-1" class="headerlink" title="Iterator"></a>Iterator</h4><ul>
<li><strong>Next() should return next item or raise â€˜StopIterationâ€™.</strong></li>
<li><strong>Iter() should return â€˜selfâ€™.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.i = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.i</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = Counter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(counter), next(counter), next(counter)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.i = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.i</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = Counter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter(), counter(), counter()</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Context-Manager"><a href="#Context-Manager" class="headerlink" title="Context Manager"></a>Context Manager</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOpen</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">        self.filename = filename</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.file = open(self.filename)</span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, *args)</span>:</span></span><br><span class="line">        self.file.close()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> open(<span class="string">'test.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> file:</span><br><span class="line"><span class="meta">... </span>    file.write(<span class="string">'Hello World!'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> MyOpen(<span class="string">'test.txt'</span>) <span class="keyword">as</span> file:</span><br><span class="line"><span class="meta">... </span>    print(file.read())</span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure>
<h4 id="List-of-existing-context-managers"><a href="#List-of-existing-context-managers" class="headerlink" title="List of existing context managers:"></a>List of existing context managers:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'&lt;path&gt;'</span>, ...) <span class="keyword">as</span> file: ...</span><br><span class="line"><span class="keyword">with</span> wave.open(<span class="string">'&lt;path&gt;'</span>, ...) <span class="keyword">as</span> wave_file: ...</span><br><span class="line"><span class="keyword">with</span> memoryview(&lt;bytes/bytearray/array&gt;) <span class="keyword">as</span> view: ...</span><br><span class="line">db = sqlite3.connect(<span class="string">'&lt;path&gt;'</span>); <span class="keyword">with</span> db: db.execute(<span class="string">'&lt;insert_query&gt;'</span>)</span><br><span class="line">lock = threading.RLock(); <span class="keyword">with</span> lock: ...</span><br></pre></td></tr></table></figure>
<h3 id="Iterable-Duck-Types"><a href="#Iterable-Duck-Types" class="headerlink" title="Iterable Duck Types"></a>Iterable Duck Types</h3><hr>
<h4 id="Iterable"><a href="#Iterable" class="headerlink" title="Iterable"></a>Iterable</h4><ul>
<li><strong>Only required method is iter(). It should return an iterator of objectâ€™s items.</strong></li>
<li><strong>Contains() automatically works on any object that has iter() defined.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyIterable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> el <span class="keyword">in</span> self.a:</span><br><span class="line">            <span class="keyword">yield</span> el</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = MyIterable([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iter(a)</span><br><span class="line">&lt;generator object MyIterable.__iter__ at <span class="number">0x1026c18b8</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> <span class="keyword">in</span> a</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h4 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h4><ul>
<li><strong>Only required methods are iter() and len().</strong></li>
<li><strong>This cheatsheet actually means <code>&#39;&lt;iterable&gt;&#39;</code> when it uses <code>&#39;&lt;collection&gt;&#39;</code>.</strong></li>
<li><strong>I chose not to use the name â€˜iterableâ€™ because it sounds scarier and more vague than â€˜collectionâ€™.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCollection</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> el <span class="keyword">in</span> self.a:</span><br><span class="line">            <span class="keyword">yield</span> el</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, el)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> el <span class="keyword">in</span> self.a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.a)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Sequence"><a href="#Sequence" class="headerlink" title="Sequence"></a>Sequence</h4><ul>
<li><strong>Only required methods are len() and getitem(), that should return an item at index or raise â€˜IndexErrorâ€™.</strong></li>
<li><strong>Iter() and contains() automatically work on any object that has getitem() defined.</strong></li>
<li><strong>Reversed() automatically works on any object that has getitem() and len() defined.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySequence</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> el <span class="keyword">in</span> self.a:</span><br><span class="line">            <span class="keyword">yield</span> el</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, el)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> el <span class="keyword">in</span> self.a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.a)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.a[i]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reversed__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> reversed(self.a)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Collections-abc-Sequence"><a href="#Collections-abc-Sequence" class="headerlink" title="Collections.abc.Sequence"></a>Collections.abc.Sequence</h4><ul>
<li><strong>Itâ€™s a richer interface than the basic sequence.</strong></li>
<li><strong>Extending it generates iter(), contains(), reversed(), index(), and count().</strong></li>
<li><strong>Unlike <code>&#39;abc.Iterable&#39;</code> and <code>&#39;abc.Collection&#39;</code>, it is not a duck type. That is why <code>&#39;issubclass(MySequence, collections.abc.Sequence)&#39;</code> would return â€˜Falseâ€™ even if it had all the methods defined.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyAbcSequence</span><span class="params">(collections.abc.Sequence)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.a)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.a[i]</span><br></pre></td></tr></table></figure>
<h4 id="Table-of-required-and-available-special-methods"><a href="#Table-of-required-and-available-special-methods" class="headerlink" title="Table of required and available special methods:"></a>Table of required and available special methods:</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+------------+----------+------------+----------+--------------+</span><br><span class="line">|            | Iterable | Collection | Sequence | abc.Sequence |</span><br><span class="line">+------------+----------+------------+----------+--------------+</span><br><span class="line">| iter()     |   REQ    |    REQ     |   yes    |     yes      |</span><br><span class="line">| contains() |   yes    |    yes     |   yes    |     yes      |</span><br><span class="line">| len()      |          |    REQ     |   REQ    |     REQ      |</span><br><span class="line">| getitem()  |          |            |   REQ    |     REQ      |</span><br><span class="line">| reversed() |          |            |   yes    |     yes      |</span><br><span class="line">| index()    |          |            |          |     yes      |</span><br><span class="line">| count()    |          |            |          |     yes      |</span><br><span class="line">+------------+----------+------------+----------+--------------+</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Other useful ABCs that automatically generate missing methods are: MutableSequence, Set, MutableSet, Mapping and MutableMapping.</strong></li>
</ul>
<h3 id="Enum"><a href="#Enum" class="headerlink" title="Enum"></a>Enum</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum, auto</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">enum_name</span>&gt;<span class="params">(Enum)</span>:</span></span><br><span class="line">    &lt;member_name_1&gt; = &lt;value_1&gt;</span><br><span class="line">    &lt;member_name_2&gt; = &lt;value_2_a&gt;, &lt;value_2_b&gt;</span><br><span class="line">    &lt;member_name_3&gt; = auto()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_member_names</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> [a.name <span class="keyword">for</span> a <span class="keyword">in</span> cls.__members__.values()]</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If there are no numeric values before auto(), it returns 1.</strong></li>
<li><strong>Otherwise it returns an increment of last numeric value.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;member&gt; = &lt;enum&gt;.&lt;member_name&gt;</span><br><span class="line">&lt;member&gt; = &lt;enum&gt;[<span class="string">'&lt;member_name&gt;'</span>]</span><br><span class="line">&lt;member&gt; = &lt;enum&gt;(&lt;value&gt;)</span><br><span class="line">name     = &lt;member&gt;.name</span><br><span class="line">value    = &lt;member&gt;.value</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">list_of_members = list(&lt;enum&gt;)</span><br><span class="line">member_names    = [a.name <span class="keyword">for</span> a <span class="keyword">in</span> &lt;enum&gt;]</span><br><span class="line">member_values   = [a.value <span class="keyword">for</span> a <span class="keyword">in</span> &lt;enum&gt;]</span><br><span class="line">random_member   = random.choice(list(&lt;enum&gt;))</span><br></pre></td></tr></table></figure>
<h3 id="Inline-1"><a href="#Inline-1" class="headerlink" title="Inline"></a>Inline</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Cutlery = Enum(<span class="string">'Cutlery'</span>, [<span class="string">'fork'</span>, <span class="string">'knife'</span>, <span class="string">'spoon'</span>])</span><br><span class="line">Cutlery = Enum(<span class="string">'Cutlery'</span>, <span class="string">'fork knife spoon'</span>)</span><br><span class="line">Cutlery = Enum(<span class="string">'Cutlery'</span>, &#123;<span class="string">'fork'</span>: <span class="number">1</span>, <span class="string">'knife'</span>: <span class="number">2</span>, <span class="string">'spoon'</span>: <span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="Functions-can-not-be-values-so-they-must-be-wrapped"><a href="#Functions-can-not-be-values-so-they-must-be-wrapped" class="headerlink" title="Functions can not be values, so they must be wrapped:"></a>Functions can not be values, so they must be wrapped:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line">LogicOp = Enum(<span class="string">'LogicOp'</span>, &#123;<span class="string">'AND'</span>: partial(<span class="keyword">lambda</span> l, r: l <span class="keyword">and</span> r),</span><br><span class="line">                           <span class="string">'OR'</span> : partial(<span class="keyword">lambda</span> l, r: l <span class="keyword">or</span> r)&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Another solution in this particular case, is to use <code>&#39;and_&#39;</code> and <code>&#39;or_&#39;</code> functions from module <a href="#operator">Operator</a>.</strong></li>
</ul>
<h3 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h3><hr>
<h4 id="Basic-Example"><a href="#Basic-Example" class="headerlink" title="Basic Example"></a>Basic Example</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    &lt;code&gt;</span><br><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line">    &lt;code&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Complex-Example"><a href="#Complex-Example" class="headerlink" title="Complex Example"></a>Complex Example</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    &lt;code_1&gt;</span><br><span class="line"><span class="keyword">except</span> &lt;exception_a&gt;:</span><br><span class="line">    &lt;code_2_a&gt;</span><br><span class="line"><span class="keyword">except</span> &lt;exception_b&gt;:</span><br><span class="line">    &lt;code_2_b&gt;</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    &lt;code_2_c&gt;</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    &lt;code_3&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Catching-Exceptions"><a href="#Catching-Exceptions" class="headerlink" title="Catching Exceptions"></a>Catching Exceptions</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line"><span class="keyword">except</span> &lt;exception&gt; <span class="keyword">as</span> &lt;name&gt;:</span><br><span class="line"><span class="keyword">except</span> (&lt;exception_1&gt;, &lt;exception_2&gt;, ...):</span><br><span class="line"><span class="keyword">except</span> (&lt;exception_1&gt;, &lt;exception_2&gt;, ...) <span class="keyword">as</span> &lt;name&gt;:</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Also catches subclasses of the exception.</strong></li>
</ul>
<h4 id="Raising-Exceptions"><a href="#Raising-Exceptions" class="headerlink" title="Raising Exceptions"></a>Raising Exceptions</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">raise</span> &lt;exception&gt;</span><br><span class="line"><span class="keyword">raise</span> &lt;exception&gt;()</span><br><span class="line"><span class="keyword">raise</span> &lt;exception&gt;(&lt;el&gt;)</span><br><span class="line"><span class="keyword">raise</span> &lt;exception&gt;(&lt;el_1&gt;, &lt;el_2&gt;, ...)</span><br></pre></td></tr></table></figure>
<h4 id="Useful-built-in-exceptions"><a href="#Useful-built-in-exceptions" class="headerlink" title="Useful built-in exceptions:"></a>Useful built-in exceptions:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">raise</span> ValueError(<span class="string">'Argument is of right type but inappropriate value!'</span>)</span><br><span class="line"><span class="keyword">raise</span> TypeError(<span class="string">'Argument is of wrong type!'</span>)</span><br><span class="line"><span class="keyword">raise</span> RuntimeError(<span class="string">'None of above!'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Re-raising-caught-exception"><a href="#Re-raising-caught-exception" class="headerlink" title="Re-raising caught exception:"></a>Re-raising caught exception:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line">    &lt;code&gt;</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>
<h4 id="Common-Built-in-Exceptions"><a href="#Common-Built-in-Exceptions" class="headerlink" title="Common Built-in Exceptions"></a>Common Built-in Exceptions</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">BaseException</span><br><span class="line"> +-- SystemExit                   # Raised by the sys.exit() function.</span><br><span class="line"> +-- KeyboardInterrupt            # Raised when the user hits the interrupt key.</span><br><span class="line"> +-- Exception                    # User-defined exceptions should be derived from this class.</span><br><span class="line">      +-- StopIteration           # Raised by next() when run on an empty iterator.</span><br><span class="line">      +-- ArithmeticError         # Base class for arithmetic errors.</span><br><span class="line">      |    +-- ZeroDivisionError  # Raised when dividing by zero.</span><br><span class="line">      +-- AttributeError          # Raised when an attribute is missing.</span><br><span class="line">      +-- EOFError                # Raised by input() when it hits end-of-file condition.</span><br><span class="line">      +-- LookupError             # Raised when a look-up on sequence or dict fails.</span><br><span class="line">      |    +-- IndexError         # Raised when a sequence index is out of range.</span><br><span class="line">      |    +-- KeyError           # Raised when a dictionary key is not found.</span><br><span class="line">      +-- NameError               # Raised when a variable name is not found.</span><br><span class="line">      +-- OSError                 # Failures such as â€œfile not foundâ€ or â€œdisk fullâ€.</span><br><span class="line">      |    +-- FileNotFoundError  # When a file or directory is requested but doesn&#39;t exist.</span><br><span class="line">      +-- RuntimeError            # Raised by errors that don&#39;t fall in other categories.</span><br><span class="line">      |    +-- RecursionError     # Raised when the the maximum recursion depth is exceeded.</span><br><span class="line">      +-- TypeError               # Raised when an argument is of wrong type.</span><br><span class="line">      +-- ValueError              # When an argument is of right type but inappropriate value.</span><br><span class="line">           +-- UnicodeError       # Raised when encoding&#x2F;decoding strings from&#x2F;to bytes fails.</span><br></pre></td></tr></table></figure>
<h4 id="User-defined-Exceptions"><a href="#User-defined-Exceptions" class="headerlink" title="User-defined Exceptions"></a>User-defined Exceptions</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyError</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInputError</span><span class="params">(MyError)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="Print"><a href="#Print" class="headerlink" title="Print"></a>Print</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(&lt;el_1&gt;, ..., sep=<span class="string">' '</span>, end=<span class="string">'\n'</span>, file=sys.stdout, flush=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Use <code>&#39;file=sys.stderr&#39;</code> for errors.</strong></li>
<li><strong>Use <code>&#39;flush=True&#39;</code> to forcibly flush the stream.</strong></li>
</ul>
<h4 id="Pretty-Print"><a href="#Pretty-Print" class="headerlink" title="Pretty Print"></a>Pretty Print</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pprint(dir())</span><br><span class="line">[<span class="string">'__annotations__'</span>,</span><br><span class="line"> <span class="string">'__builtins__'</span>,</span><br><span class="line"> <span class="string">'__doc__'</span>, ...]</span><br></pre></td></tr></table></figure>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><hr>
<ul>
<li><strong>Reads a line from user input or pipe if present.</strong></li>
<li><strong>Trailing newline gets stripped.</strong></li>
<li><strong>Prompt string is printed to the standard output before reading input.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt; = input(prompt=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Prints-lines-until-EOF"><a href="#Prints-lines-until-EOF" class="headerlink" title="Prints lines until EOF:"></a>Prints lines until EOF:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(input())</span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h3 id="Command-Line-Arguments"><a href="#Command-Line-Arguments" class="headerlink" title="Command Line Arguments"></a>Command Line Arguments</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">script_name = sys.argv[<span class="number">0</span>]</span><br><span class="line">arguments   = sys.argv[<span class="number">1</span>:]</span><br></pre></td></tr></table></figure>
<h4 id="Argparse"><a href="#Argparse" class="headerlink" title="Argparse"></a>Argparse</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> argparse <span class="keyword">import</span> ArgumentParser, FileType</span><br><span class="line">p = ArgumentParser(description=&lt;str&gt;)</span><br><span class="line">p.add_argument(<span class="string">'-&lt;short_name&gt;'</span>, <span class="string">'--&lt;name&gt;'</span>, action=<span class="string">'store_true'</span>)  <span class="comment"># Flag</span></span><br><span class="line">p.add_argument(<span class="string">'-&lt;short_name&gt;'</span>, <span class="string">'--&lt;name&gt;'</span>, type=&lt;type&gt;)          <span class="comment"># Option</span></span><br><span class="line">p.add_argument(<span class="string">'&lt;name&gt;'</span>, type=&lt;type&gt;, nargs=<span class="number">1</span>)                    <span class="comment"># Argument</span></span><br><span class="line">p.add_argument(<span class="string">'&lt;name&gt;'</span>, type=&lt;type&gt;, nargs=<span class="string">'+'</span>)                  <span class="comment"># Arguments</span></span><br><span class="line">args  = p.parse_args()</span><br><span class="line">value = args.&lt;name&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Use <code>&#39;help=&lt;str&gt;&#39;</code> for argument description.</strong></li>
<li><strong>Use <code>&#39;type=FileType(&lt;mode&gt;)&#39;</code> for files.</strong></li>
</ul>
<h3 id="Open"><a href="#Open" class="headerlink" title="Open"></a>Open</h3><hr>
<p><strong>Opens a file and returns a corresponding file object.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;file&gt; = open(<span class="string">'&lt;path&gt;'</span>, mode=<span class="string">'r'</span>, encoding=<span class="literal">None</span>, newline=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>&#39;encoding=None&#39;</code> means default encoding is used, which is platform dependent. Best practice is to use <code>&#39;encoding=&quot;utf-8&quot;&#39;</code> whenever possible.</strong></li>
<li><strong><code>&#39;newline=None&#39;</code> means all different end of line combinations are converted to â€˜\nâ€™ on read, while on write all â€˜\nâ€™ characters are converted to systemâ€™s default line separator.</strong></li>
<li><strong><code>&#39;newline=&quot;&quot;&#39;</code> means no conversions take place, but lines are still broken by readline() on either â€˜\nâ€™, â€˜\râ€™ or â€˜\r\nâ€™.</strong></li>
</ul>
<h4 id="Modes"><a href="#Modes" class="headerlink" title="Modes"></a>Modes</h4><ul>
<li><strong><code>&#39;r&#39;</code>  - Read (default).</strong></li>
<li><strong><code>&#39;w&#39;</code>  - Write (truncate).</strong></li>
<li><strong><code>&#39;x&#39;</code>  - Write or fail if the file already exists.</strong></li>
<li><strong><code>&#39;a&#39;</code>  - Append.</strong></li>
<li><strong><code>&#39;w+&#39;</code> - Read and write (truncate).</strong></li>
<li><strong><code>&#39;r+&#39;</code> - Read and write from the start.</strong></li>
<li><strong><code>&#39;a+&#39;</code> - Read and write from the end.</strong></li>
<li><strong><code>&#39;t&#39;</code>  - Text mode (default).</strong></li>
<li><strong><code>&#39;b&#39;</code>  - Binary mode.</strong></li>
</ul>
<h4 id="Exceptions-1"><a href="#Exceptions-1" class="headerlink" title="Exceptions"></a>Exceptions</h4><ul>
<li><strong><code>&#39;FileNotFoundError&#39;</code> can be risen when reading with <code>&#39;r&#39;</code> or <code>&#39;r+&#39;</code>.</strong>  </li>
<li><strong><code>&#39;FileExistsError&#39;</code> can be risen when writing with <code>&#39;x&#39;</code>.</strong></li>
<li><strong><code>&#39;IsADirectoryError&#39;</code> and <code>&#39;PermissionError&#39;</code> can be risen by any.</strong></li>
<li><strong><code>&#39;OSError&#39;</code> is the parent class of all listed exceptions.</strong></li>
</ul>
<h4 id="File"><a href="#File" class="headerlink" title="File"></a>File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;file&gt;.seek(<span class="number">0</span>)                      <span class="comment"># Moves to the start of the file.</span></span><br><span class="line">&lt;file&gt;.seek(offset)                 <span class="comment"># Moves 'offset' chars/bytes from the start.</span></span><br><span class="line">&lt;file&gt;.seek(<span class="number">0</span>, <span class="number">2</span>)                   <span class="comment"># Moves to the end of the file.</span></span><br><span class="line">&lt;bin_file&gt;.seek(Â±offset, &lt;anchor&gt;)  <span class="comment"># Anchor: 0 start, 1 current pos., 2 end.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str/bytes&gt; = &lt;file&gt;.read(size=<span class="number">-1</span>)  <span class="comment"># Reads 'size' chars/bytes or until EOF.</span></span><br><span class="line">&lt;str/bytes&gt; = &lt;file&gt;.readline()     <span class="comment"># Returns a line or empty string on EOF.</span></span><br><span class="line">&lt;list&gt;      = &lt;file&gt;.readlines()    <span class="comment"># Returns a list of lines or empty list.</span></span><br><span class="line">&lt;str/bytes&gt; = next(&lt;file&gt;)          <span class="comment"># Returns a line using buffer. Do not mix.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;file&gt;.write(&lt;str/bytes&gt;)           <span class="comment"># Writes a string or bytes object.</span></span><br><span class="line">&lt;file&gt;.writelines(&lt;coll.&gt;)          <span class="comment"># Writes a coll. of strings or bytes objects.</span></span><br><span class="line">&lt;file&gt;.flush()                      <span class="comment"># Flushes write buffer.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Methods do not add or strip trailing newlines, even writelines().</strong></li>
</ul>
<h4 id="Read-Text-from-File"><a href="#Read-Text-from-File" class="headerlink" title="Read Text from File"></a>Read Text from File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> file.readlines()</span><br></pre></td></tr></table></figure>
<h4 id="Write-Text-to-File"><a href="#Write-Text-to-File" class="headerlink" title="Write Text to File"></a>Write Text to File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_file</span><span class="params">(filename, text)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(text)</span><br></pre></td></tr></table></figure>
<h3 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path, listdir</span><br><span class="line"><span class="keyword">from</span> glob <span class="keyword">import</span> glob</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = path.exists(<span class="string">'&lt;path&gt;'</span>)</span><br><span class="line">&lt;bool&gt; = path.isfile(<span class="string">'&lt;path&gt;'</span>)</span><br><span class="line">&lt;bool&gt; = path.isdir(<span class="string">'&lt;path&gt;'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = listdir(<span class="string">'&lt;path&gt;'</span>)         <span class="comment"># List of filenames located at 'path'. </span></span><br><span class="line">&lt;list&gt; = glob(<span class="string">'&lt;pattern&gt;'</span>)         <span class="comment"># Filenames matching the wildcard pattern.</span></span><br></pre></td></tr></table></figure>
<h4 id="Pathlib"><a href="#Pathlib" class="headerlink" title="Pathlib"></a>Pathlib</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cwd    = Path()</span><br><span class="line">&lt;Path&gt; = Path(<span class="string">'&lt;path&gt;'</span> [, <span class="string">'&lt;path&gt;'</span>, &lt;Path&gt;, ...])</span><br><span class="line">&lt;Path&gt; = &lt;Path&gt; / <span class="string">'&lt;dir&gt;'</span> / <span class="string">'&lt;file&gt;'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = &lt;Path&gt;.exists()</span><br><span class="line">&lt;bool&gt; = &lt;Path&gt;.is_file()</span><br><span class="line">&lt;bool&gt; = &lt;Path&gt;.is_dir()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = &lt;Path&gt;.iterdir()          <span class="comment"># Iterator of filenames located at path.</span></span><br><span class="line">&lt;iter&gt; = &lt;Path&gt;.glob(<span class="string">'&lt;pattern&gt;'</span>)  <span class="comment"># Filenames matching the wildcard pattern.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = str(&lt;Path&gt;)               <span class="comment"># Returns path as a string.</span></span><br><span class="line">&lt;tup.&gt; = &lt;Path&gt;.parts              <span class="comment"># Returns all components as strings.</span></span><br><span class="line">&lt;Path&gt; = &lt;Path&gt;.resolve()          <span class="comment"># Returns absolute Path without symlinks.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = &lt;Path&gt;.name               <span class="comment"># Final component.</span></span><br><span class="line">&lt;str&gt;  = &lt;Path&gt;.stem               <span class="comment"># Final component without extension.</span></span><br><span class="line">&lt;str&gt;  = &lt;Path&gt;.suffix             <span class="comment"># Final component's extension.</span></span><br><span class="line">&lt;Path&gt; = &lt;Path&gt;.parent             <span class="comment"># Path without final component.</span></span><br></pre></td></tr></table></figure>
<h3 id="Command-Execution"><a href="#Command-Execution" class="headerlink" title="Command Execution"></a>Command Execution</h3><hr>
<h4 id="Files-and-Directories-Commands"><a href="#Files-and-Directories-Commands" class="headerlink" title="Files and Directories Commands"></a>Files and Directories Commands</h4><ul>
<li><strong>Paths can be either strings or Path objects.</strong></li>
<li><strong>All exceptions are either â€˜OSErrorâ€™ or its subclasses.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.chdir(&lt;path&gt;)                  <span class="comment"># Changes the current working directory.</span></span><br><span class="line">&lt;str&gt; = os.getcwd()               <span class="comment"># Returns current working directory.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.remove(&lt;path&gt;)                 <span class="comment"># Deletes the file.</span></span><br><span class="line">os.rmdir(&lt;path&gt;)                  <span class="comment"># Deletes empty directory.</span></span><br><span class="line">shutil.rmtree(&lt;path&gt;)             <span class="comment"># Deletes an entire directory tree.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.rename(<span class="keyword">from</span>, to)               <span class="comment"># Renames the file or directory.</span></span><br><span class="line">os.replace(<span class="keyword">from</span>, to)              <span class="comment"># Same, but overwrites 'to' if it exists.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.mkdir(&lt;path&gt;, mode=<span class="number">0o777</span>)      <span class="comment"># Creates a directory.</span></span><br><span class="line">&lt;iter&gt; = os.scandir(path=<span class="string">'.'</span>)     <span class="comment"># Returns os.DirEntry objects located at path.</span></span><br></pre></td></tr></table></figure>
<h4 id="DirEntry"><a href="#DirEntry" class="headerlink" title="DirEntry:"></a>DirEntry:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = &lt;DirEntry&gt;.name          <span class="comment"># Final component of the path.</span></span><br><span class="line">&lt;str&gt;  = &lt;DirEntry&gt;.path          <span class="comment"># Path with final component.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = &lt;DirEntry&gt;.is_file()</span><br><span class="line">&lt;bool&gt; = &lt;DirEntry&gt;.is_dir()</span><br><span class="line">&lt;bool&gt; = &lt;DirEntry&gt;.is_symlink()</span><br><span class="line">&lt;Path&gt; = Path(&lt;DirEntry&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Shell-Commands"><a href="#Shell-Commands" class="headerlink" title="Shell Commands"></a>Shell Commands</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">&lt;str&gt; = os.popen(<span class="string">'&lt;shell_command&gt;'</span>).read()</span><br></pre></td></tr></table></figure>
<h4 id="Using-subprocess"><a href="#Using-subprocess" class="headerlink" title="Using subprocess:"></a>Using subprocess:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> subprocess, shlex</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = subprocess.run(shlex.split(<span class="string">'ls -a'</span>), stdout=subprocess.PIPE)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.stdout</span><br><span class="line"><span class="string">b'.\n..\nfile1.txt\nfile2.txt\n'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.returncode</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>
<h3 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line">&lt;reader&gt; = csv.reader(&lt;file&gt;, dialect=<span class="string">'excel'</span>, delimiter=<span class="string">','</span>)</span><br><span class="line">&lt;list&gt;   = next(&lt;reader&gt;)  <span class="comment"># Returns a row as list of strings.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;writer&gt; = csv.writer(&lt;file&gt;, dialect=<span class="string">'excel'</span>, delimiter=<span class="string">','</span>)</span><br><span class="line">&lt;writer&gt;.writerow(&lt;collection&gt;)</span><br><span class="line">&lt;writer&gt;.writerows(&lt;coll_of_coll&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h4><ul>
<li><strong><code>&#39;dialect&#39;</code> - Master parameter that sets the default values.</strong></li>
<li><strong><code>&#39;delimiter&#39;</code> - A one-character string used to separate fields.</strong></li>
<li><strong><code>&#39;quotechar&#39;</code> - Character for quoting fields that contain special characters.</strong></li>
<li><strong><code>&#39;doublequote&#39;</code> - Whether quotechars inside fields get doubled or escaped.</strong></li>
<li><strong><code>&#39;skipinitialspace&#39;</code> - Whether whitespace after delimiter gets stripped.</strong></li>
<li><strong><code>&#39;lineterminator&#39;</code> - How does writer terminate lines.</strong></li>
<li><strong><code>&#39;quoting&#39;</code> - Controls the amount of quoting: 0 - as necessary, 1 - all.</strong></li>
<li><strong><code>&#39;escapechar&#39;</code> - Character for escaping quotechar if doublequote is false.</strong></li>
</ul>
<h4 id="Dialects"><a href="#Dialects" class="headerlink" title="Dialects"></a>Dialects</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+------------------+-----------+-----------+--------------+</span><br><span class="line">|                  |   excel   | excel_tab | unix_dialect |</span><br><span class="line">+------------------+-----------+-----------+--------------+</span><br><span class="line">| delimiter        |      &#39;,&#39;  |     &#39;\t&#39;  |       &#39;,&#39;    |</span><br><span class="line">| quotechar        |      &#39;&quot;&#39;  |      &#39;&quot;&#39;  |       &#39;&quot;&#39;    |</span><br><span class="line">| doublequote      |     True  |     True  |      True    |</span><br><span class="line">| skipinitialspace |    False  |    False  |     False    |</span><br><span class="line">| lineterminator   |   &#39;\r\n&#39;  |   &#39;\r\n&#39;  |      &#39;\n&#39;    |</span><br><span class="line">| quoting          |        0  |        0  |         1    |</span><br><span class="line">| escapechar       |     None  |     None  |      None    |</span><br><span class="line">+------------------+-----------+-----------+--------------+</span><br></pre></td></tr></table></figure>
<h4 id="Read-Rows-from-CSV-File"><a href="#Read-Rows-from-CSV-File" class="headerlink" title="Read Rows from CSV File"></a>Read Rows from CSV File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_csv_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, encoding=<span class="string">'utf-8'</span>, newline=<span class="string">''</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> csv.reader(file)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If <code>&#39;newline=&quot;&quot;&#39;</code> is not specified, then newlines embedded inside quoted fields will not be interpreted correctly.</strong></li>
</ul>
<h4 id="Write-Rows-to-CSV-File"><a href="#Write-Rows-to-CSV-File" class="headerlink" title="Write Rows to CSV File"></a>Write Rows to CSV File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_csv_file</span><span class="params">(filename, rows)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>, newline=<span class="string">''</span>) <span class="keyword">as</span> file:</span><br><span class="line">        writer = csv.writer(file)</span><br><span class="line">        writer.writerows(rows)</span><br></pre></td></tr></table></figure>
<h3 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">&lt;str&gt;    = json.dumps(&lt;object&gt;, ensure_ascii=<span class="literal">True</span>, indent=<span class="literal">None</span>)</span><br><span class="line">&lt;object&gt; = json.loads(&lt;str&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Read-Object-from-JSON-File"><a href="#Read-Object-from-JSON-File" class="headerlink" title="Read Object from JSON File"></a>Read Object from JSON File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_json_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> json.load(file)</span><br></pre></td></tr></table></figure>
<h4 id="Write-Object-to-JSON-File"><a href="#Write-Object-to-JSON-File" class="headerlink" title="Write Object to JSON File"></a>Write Object to JSON File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_json_file</span><span class="params">(filename, an_object)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        json.dump(an_object, file, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Pickle"><a href="#Pickle" class="headerlink" title="Pickle"></a>Pickle</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line">&lt;bytes&gt;  = pickle.dumps(&lt;object&gt;)</span><br><span class="line">&lt;object&gt; = pickle.loads(&lt;bytes&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Read-Object-from-File"><a href="#Read-Object-from-File" class="headerlink" title="Read Object from File"></a>Read Object from File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_pickle_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> pickle.load(file)</span><br></pre></td></tr></table></figure>
<h4 id="Write-Object-to-File"><a href="#Write-Object-to-File" class="headerlink" title="Write Object to File"></a>Write Object to File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_pickle_file</span><span class="params">(filename, an_object)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        pickle.dump(an_object, file)</span><br></pre></td></tr></table></figure>
<h3 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h3><hr>
<p><strong>Server-less database engine that stores each database into separate file.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line">db = sqlite3.connect(<span class="string">'&lt;path&gt;'</span>)                <span class="comment"># Also ':memory:'.</span></span><br><span class="line">...</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>New database will be created if path doesnâ€™t exist.</strong></li>
</ul>
<h4 id="Read"><a href="#Read" class="headerlink" title="Read"></a>Read</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cursor = db.execute(<span class="string">'&lt;query&gt;'</span>)</span><br><span class="line"><span class="keyword">if</span> cursor:</span><br><span class="line">    &lt;tuple&gt; = cursor.fetchone()               <span class="comment"># First row.</span></span><br><span class="line">    &lt;list&gt;  = cursor.fetchall()               <span class="comment"># Remaining rows.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Returned values can be of type str, int, float, bytes or None.</strong></li>
</ul>
<h4 id="Write"><a href="#Write" class="headerlink" title="Write"></a>Write</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">db.execute(<span class="string">'&lt;query&gt;'</span>)</span><br><span class="line">db.commit()</span><br></pre></td></tr></table></figure>
<h4 id="Placeholders"><a href="#Placeholders" class="headerlink" title="Placeholders"></a>Placeholders</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">db.execute(<span class="string">'&lt;query&gt;'</span>, &lt;list/tuple&gt;)           <span class="comment"># Replaces '?'s in query with values.</span></span><br><span class="line">db.execute(<span class="string">'&lt;query&gt;'</span>, &lt;dict/namedtuple&gt;)      <span class="comment"># Replaces ':&lt;key&gt;'s with values.</span></span><br><span class="line">db.executemany(<span class="string">'&lt;query&gt;'</span>, &lt;coll_of_above&gt;)    <span class="comment"># Runs execute() many times.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Passed values can be of type str, int, float, bytes, None, bool, datetime.date or datetime.datetme.</strong></li>
</ul>
<h4 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h4><p><strong>Has a very similar interface, with differences listed below.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install mysql-connector</span></span><br><span class="line"><span class="keyword">from</span> mysql <span class="keyword">import</span> connector</span><br><span class="line">db = connector.connect(host=&lt;str&gt;, user=&lt;str&gt;, password=&lt;str&gt;, database=&lt;str&gt;)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">cursor.execute(<span class="string">'&lt;query&gt;'</span>)                     <span class="comment"># Connector doesn't have execute method.</span></span><br><span class="line">cursor.execute(<span class="string">'&lt;query&gt;'</span>, &lt;list/tuple&gt;)       <span class="comment"># Replaces '%s's in query with values.</span></span><br><span class="line">cursor.execute(<span class="string">'&lt;query&gt;'</span>, &lt;dict/namedtuple&gt;)  <span class="comment"># Replaces '%(&lt;key&gt;)s's with values.</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Bytes"><a href="#Bytes" class="headerlink" title="Bytes"></a>Bytes</h3><hr>
<p><strong>Bytes object is an immutable sequence of single bytes. Mutable version is called â€˜bytearrayâ€™.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bytes&gt; = <span class="string">b'&lt;str&gt;'</span>                       <span class="comment"># Only accepts ASCII characters and \x00 - \xff.</span></span><br><span class="line">&lt;int&gt;   = &lt;bytes&gt;[&lt;index&gt;]               <span class="comment"># Returns int in range from 0 to 255.</span></span><br><span class="line">&lt;bytes&gt; = &lt;bytes&gt;[&lt;slice&gt;]               <span class="comment"># Returns bytes even if it has only one element.</span></span><br><span class="line">&lt;bytes&gt; = &lt;bytes&gt;.join(&lt;coll_of_bytes&gt;)  <span class="comment"># Joins elements using bytes object as separator.</span></span><br></pre></td></tr></table></figure>
<h4 id="Encode-1"><a href="#Encode-1" class="headerlink" title="Encode"></a>Encode</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bytes&gt; = &lt;str&gt;.encode(<span class="string">'utf-8'</span>)          <span class="comment"># Or: bytes(&lt;str&gt;, 'utf-8')</span></span><br><span class="line">&lt;bytes&gt; = bytes(&lt;coll_of_ints&gt;)          <span class="comment"># Ints must be in range from 0 to 255.</span></span><br><span class="line">&lt;bytes&gt; = &lt;int&gt;.to_bytes(&lt;length&gt;, byteorder=<span class="string">'big|little'</span>, signed=<span class="literal">False</span>)</span><br><span class="line">&lt;bytes&gt; = bytes.fromhex(<span class="string">'&lt;hex&gt;'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Decode-1"><a href="#Decode-1" class="headerlink" title="Decode"></a>Decode</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;   = &lt;bytes&gt;.decode(<span class="string">'utf-8'</span>)        <span class="comment"># Or: str(&lt;bytes&gt;, 'utf-8')</span></span><br><span class="line">&lt;list&gt;  = list(&lt;bytes&gt;)                  <span class="comment"># Returns ints in range from 0 to 255.</span></span><br><span class="line">&lt;int&gt;   = int.from_bytes(&lt;bytes&gt;, byteorder=<span class="string">'big|little'</span>, signed=<span class="literal">False</span>)</span><br><span class="line"><span class="string">'&lt;hex&gt;'</span> = &lt;bytes&gt;.hex()</span><br></pre></td></tr></table></figure>
<h4 id="Read-Bytes-from-File"><a href="#Read-Bytes-from-File" class="headerlink" title="Read Bytes from File"></a>Read Bytes from File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_bytes</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> file.read()</span><br></pre></td></tr></table></figure>
<h4 id="Write-Bytes-to-File"><a href="#Write-Bytes-to-File" class="headerlink" title="Write Bytes to File"></a>Write Bytes to File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_bytes</span><span class="params">(filename, bytes_obj)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(bytes_obj)</span><br></pre></td></tr></table></figure>
<h3 id="Struct"><a href="#Struct" class="headerlink" title="Struct"></a>Struct</h3><hr>
<ul>
<li><strong>Module that performs conversions between a sequence of numbers and a C struct, represented as a Python bytes object.</strong></li>
<li><strong>Machineâ€™s native type sizes and byte order are used by default.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack, unpack, iter_unpack, calcsize</span><br><span class="line">&lt;bytes&gt;  = pack(<span class="string">'&lt;format&gt;'</span>, &lt;num_1&gt; [, &lt;num_2&gt;, ...])</span><br><span class="line">&lt;tuple&gt;  = unpack(<span class="string">'&lt;format&gt;'</span>, &lt;bytes&gt;)</span><br><span class="line">&lt;tuples&gt; = iter_unpack(<span class="string">'&lt;format&gt;'</span>, &lt;bytes&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pack(<span class="string">'&gt;hhl'</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="string">b'\x00\x01\x00\x02\x00\x00\x00\x03'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>unpack(<span class="string">'&gt;hhl'</span>, <span class="string">b'\x00\x01\x00\x02\x00\x00\x00\x03'</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calcsize(<span class="string">'&gt;hhl'</span>)</span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure>
<h4 id="Format-2"><a href="#Format-2" class="headerlink" title="Format"></a>Format</h4><h5 id="For-standard-sizes-start-format-string-with"><a href="#For-standard-sizes-start-format-string-with" class="headerlink" title="For standard sizes start format string with:"></a>For standard sizes start format string with:</h5><ul>
<li><strong><code>&#39;=&#39;</code> - native byte order</strong></li>
<li><strong><code>&#39;&lt;&#39;</code> - little-endian</strong></li>
<li><strong><code>&#39;&gt;&#39;</code> - big-endian</strong></li>
</ul>
<h5 id="Integer-types-Use-capital-letter-for-unsigned-type-Standard-sizes-are-in-brackets"><a href="#Integer-types-Use-capital-letter-for-unsigned-type-Standard-sizes-are-in-brackets" class="headerlink" title="Integer types. Use capital letter for unsigned type. Standard sizes are in brackets:"></a>Integer types. Use capital letter for unsigned type. Standard sizes are in brackets:</h5><ul>
<li><strong><code>&#39;x&#39;</code> - pad byte</strong></li>
<li><strong><code>&#39;b&#39;</code> - char (1)</strong></li>
<li><strong><code>&#39;h&#39;</code> - short (2)</strong></li>
<li><strong><code>&#39;i&#39;</code> - int (4)</strong></li>
<li><strong><code>&#39;l&#39;</code> - long (4)</strong></li>
<li><strong><code>&#39;q&#39;</code> - long long (8)</strong></li>
</ul>
<h5 id="Floating-point-types"><a href="#Floating-point-types" class="headerlink" title="Floating point types:"></a>Floating point types:</h5><ul>
<li><strong><code>&#39;f&#39;</code> - float (4)</strong></li>
<li><strong><code>&#39;d&#39;</code> - double (8)</strong></li>
</ul>
<h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><hr>
<p><strong>List that can only hold numbers of predefined type. Available types and their sizes in bytes are listed above.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line">&lt;array&gt; = array(<span class="string">'&lt;typecode&gt;'</span> [, &lt;collection&gt;])</span><br></pre></td></tr></table></figure>
<h3 id="Memory-View"><a href="#Memory-View" class="headerlink" title="Memory View"></a>Memory View</h3><hr>
<p><strong>Used for accessing the internal data of an object that supports the buffer protocol.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;memoryview&gt; = memoryview(&lt;bytes&gt; / &lt;bytearray&gt; / &lt;array&gt;)</span><br><span class="line">&lt;memoryview&gt;.release()</span><br></pre></td></tr></table></figure>
<h3 id="Deque"><a href="#Deque" class="headerlink" title="Deque"></a>Deque</h3><hr>
<p><strong>A thread-safe list with efficient appends and pops from either side. Pronounced â€œdeckâ€.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line">&lt;deque&gt; = deque(&lt;collection&gt;, maxlen=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;deque&gt;.appendleft(&lt;el&gt;)</span><br><span class="line">&lt;el&gt; = &lt;deque&gt;.popleft()</span><br><span class="line">&lt;deque&gt;.extendleft(&lt;collection&gt;)            <span class="comment"># Collection gets reversed.</span></span><br><span class="line">&lt;deque&gt;.rotate(n=<span class="number">1</span>)                         <span class="comment"># Rotates elements to the right.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = deque([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], maxlen=<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.append(<span class="number">4</span>)</span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.appendleft(<span class="number">5</span>)</span><br><span class="line">[<span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.insert(<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line">IndexError: deque already at its maximum size</span><br></pre></td></tr></table></figure>
<h3 id="Threading"><a href="#Threading" class="headerlink" title="Threading"></a>Threading</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, RLock</span><br></pre></td></tr></table></figure>
<h4 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a>Thread</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">thread = Thread(target=&lt;function&gt;, args=(&lt;first_arg&gt;, ))</span><br><span class="line">thread.start()</span><br><span class="line">...</span><br><span class="line">thread.join()</span><br></pre></td></tr></table></figure>
<h4 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lock = RLock()</span><br><span class="line">lock.acquire()</span><br><span class="line">...</span><br><span class="line">lock.release()</span><br></pre></td></tr></table></figure>
<h5 id="Or"><a href="#Or" class="headerlink" title="Or:"></a>Or:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lock = RLock()</span><br><span class="line"><span class="keyword">with</span> lock:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h3 id="Introspection"><a href="#Introspection" class="headerlink" title="Introspection"></a>Introspection</h3><hr>
<p><strong>Inspecting code at runtime.</strong></p>
<h4 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = dir()      <span class="comment"># Names of variables in current scope.</span></span><br><span class="line">&lt;dict&gt; = locals()   <span class="comment"># Dict of local variables. Also vars().</span></span><br><span class="line">&lt;dict&gt; = globals()  <span class="comment"># Dict of global variables.</span></span><br></pre></td></tr></table></figure>
<h4 id="Attributes-1"><a href="#Attributes-1" class="headerlink" title="Attributes"></a>Attributes</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;dict&gt; = vars(&lt;object&gt;)</span><br><span class="line">&lt;bool&gt; = hasattr(&lt;object&gt;, <span class="string">'&lt;attr_name&gt;'</span>)</span><br><span class="line">value  = getattr(&lt;object&gt;, <span class="string">'&lt;attr_name&gt;'</span>)</span><br><span class="line">setattr(&lt;object&gt;, <span class="string">'&lt;attr_name&gt;'</span>, value)</span><br></pre></td></tr></table></figure>
<h4 id="Parameters-1"><a href="#Parameters-1" class="headerlink" title="Parameters"></a>Parameters</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> inspect <span class="keyword">import</span> signature</span><br><span class="line">&lt;sig&gt;        = signature(&lt;function&gt;)</span><br><span class="line">no_of_params = len(&lt;sig&gt;.parameters)</span><br><span class="line">param_names  = list(&lt;sig&gt;.parameters.keys())</span><br></pre></td></tr></table></figure>
<h3 id="Metaprograming"><a href="#Metaprograming" class="headerlink" title="Metaprograming"></a>Metaprograming</h3><hr>
<p><strong>Code that generates code.</strong></p>
<h4 id="Type-1"><a href="#Type-1" class="headerlink" title="Type"></a>Type</h4><p><strong>Type is the root class. If only passed an object it returns its type (class). Otherwise it creates a new class.</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;class&gt; = type(&lt;class_name&gt;, &lt;parents_tuple&gt;, &lt;attributes_dict&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Z = type(<span class="string">'Z'</span>, (), &#123;<span class="string">'a'</span>: <span class="string">'abcde'</span>, <span class="string">'b'</span>: <span class="number">12345</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>z = Z()</span><br></pre></td></tr></table></figure>
<h4 id="Meta-Class"><a href="#Meta-Class" class="headerlink" title="Meta Class"></a>Meta Class</h4><p><strong>Class that creates class.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_meta_class</span><span class="params">(name, parents, attrs)</span>:</span></span><br><span class="line">    attrs[<span class="string">'a'</span>] = <span class="string">'abcde'</span></span><br><span class="line">    <span class="keyword">return</span> type(name, parents, attrs)</span><br></pre></td></tr></table></figure>
<h5 id="Or-1"><a href="#Or-1" class="headerlink" title="Or:"></a>Or:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyMetaClass</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, name, parents, attrs)</span>:</span></span><br><span class="line">        attrs[<span class="string">'a'</span>] = <span class="string">'abcde'</span></span><br><span class="line">        <span class="keyword">return</span> type.__new__(cls, name, parents, attrs)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>New() is a class method that gets called before init(). If it returns an instance of its class, then that instance gets passed to init() as a â€˜selfâ€™ argument.</strong></li>
<li><strong>It receives the same arguments as init(), except for the first one that specifies the desired class of returned instance (</strong><code>&#39;MyMetaClass&#39;</code> <strong>in our case).</strong></li>
<li><strong>New() can also be called directly, usually from a new() method of a child class (</strong><code>def __new__(cls): return super().__new__(cls)</code><strong>), in which case init() is not called.</strong></li>
</ul>
<h4 id="Metaclass-Attribute"><a href="#Metaclass-Attribute" class="headerlink" title="Metaclass Attribute"></a>Metaclass Attribute</h4><p><strong>Right before a class is created it checks if it has metaclass defined. If not, it recursively checks if any of his parents has it defined and eventually comes to type().</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(metaclass=MyMetaClass)</span>:</span></span><br><span class="line">    b = <span class="number">12345</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>MyClass.a, MyClass.b</span><br><span class="line">(<span class="string">'abcde'</span>, <span class="number">12345</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Type-Diagram"><a href="#Type-Diagram" class="headerlink" title="Type Diagram"></a>Type Diagram</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">type(MyClass)     == MyMetaClass  <span class="comment"># MyClass is an instance of MyMetaClass.</span></span><br><span class="line">type(MyMetaClass) == type         <span class="comment"># MyMetaClass is an instance of type.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+---------+-------------+</span><br><span class="line">| Classes | Metaclasses |</span><br><span class="line">+---------+-------------|</span><br><span class="line">| MyClass &gt; MyMetaClass |</span><br><span class="line">|         |     v       |</span><br><span class="line">|  object ---&gt; type &lt;+  |</span><br><span class="line">|         |    ^ +---+  |</span><br><span class="line">|   str -------+        |</span><br><span class="line">+---------+-------------+</span><br></pre></td></tr></table></figure>
<h4 id="Inheritance-Diagram"><a href="#Inheritance-Diagram" class="headerlink" title="Inheritance Diagram"></a>Inheritance Diagram</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MyClass.__base__     == object    <span class="comment"># MyClass is a subclass of object.</span></span><br><span class="line">MyMetaClass.__base__ == type      <span class="comment"># MyMetaClass is a subclass of type.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+---------+-------------+</span><br><span class="line">| Classes | Metaclasses |</span><br><span class="line">+---------+-------------|</span><br><span class="line">| MyClass | MyMetaClass |</span><br><span class="line">|    v    |     v       |</span><br><span class="line">|  object &lt;--- type     |</span><br><span class="line">|    ^    |             |</span><br><span class="line">|   str   |             |</span><br><span class="line">+---------+-------------+</span><br></pre></td></tr></table></figure>
<h3 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> add, sub, mul, truediv, floordiv, mod, pow, neg, abs</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> eq, ne, lt, le, gt, ge</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> and_, or_, not_</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter, attrgetter, methodcaller</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> operator <span class="keyword">as</span> op</span><br><span class="line">sorted_by_second = sorted(&lt;collection&gt;, key=op.itemgetter(<span class="number">1</span>))</span><br><span class="line">sorted_by_both   = sorted(&lt;collection&gt;, key=op.itemgetter(<span class="number">1</span>, <span class="number">0</span>))</span><br><span class="line">product_of_elems = functools.reduce(op.mul, &lt;collection&gt;)</span><br><span class="line">LogicOp          = enum.Enum(<span class="string">'LogicOp'</span>, &#123;<span class="string">'AND'</span>: op.and_, <span class="string">'OR'</span> : op.or_&#125;)</span><br><span class="line">last_el          = op.methodcaller(<span class="string">'pop'</span>)(&lt;list&gt;)</span><br></pre></td></tr></table></figure>
<h3 id="Eval"><a href="#Eval" class="headerlink" title="Eval"></a>Eval</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> ast <span class="keyword">import</span> literal_eval</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>literal_eval(<span class="string">'1 + 2'</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>literal_eval(<span class="string">'[1, 2, 3]'</span>)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>literal_eval(<span class="string">'abs(1)'</span>)</span><br><span class="line">ValueError: malformed node <span class="keyword">or</span> string</span><br></pre></td></tr></table></figure>
<h3 id="Coroutine"><a href="#Coroutine" class="headerlink" title="Coroutine"></a>Coroutine</h3><hr>
<ul>
<li><strong>Similar to generator, but generator pulls data through the pipe with iteration, while coroutine pushes data into the pipeline with send().</strong></li>
<li><strong>Coroutines provide more powerful data routing possibilities than iterators.</strong></li>
<li><strong>If you build a collection of simple data processing components, you can glue them together into complex arrangements of pipes, branches, merging, etc.</strong></li>
</ul>
<h4 id="Helper-Decorator"><a href="#Helper-Decorator" class="headerlink" title="Helper Decorator"></a>Helper Decorator</h4><ul>
<li><strong>All coroutines must be â€œprimedâ€ by first calling next().</strong></li>
<li><strong>Remembering to call next() is easy to forget.</strong></li>
<li><strong>Solved by wrapping coroutines with a decorator:</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">coroutine</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        cr = func(*args, **kwargs)</span><br><span class="line">        next(cr)</span><br><span class="line">        <span class="keyword">return</span> cr</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h4 id="Pipeline-Example"><a href="#Pipeline-Example" class="headerlink" title="Pipeline Example"></a>Pipeline Example</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reader</span><span class="params">(target)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        target.send(i)</span><br><span class="line">    target.close()</span><br><span class="line"></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adder</span><span class="params">(target)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        value = (<span class="keyword">yield</span>)</span><br><span class="line">        target.send(value + <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printer</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        value = (<span class="keyword">yield</span>)</span><br><span class="line">        print(value)</span><br><span class="line"></span><br><span class="line">reader(adder(printer()))  <span class="comment"># 100, 101, ..., 109</span></span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h2 id="Libraries"><a href="#Libraries" class="headerlink" title="Libraries"></a>Libraries</h2><h3 id="Progress-Bar"><a href="#Progress-Bar" class="headerlink" title="Progress Bar"></a>Progress Bar</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install tqdm</span></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]):</span><br><span class="line">    sleep(<span class="number">0.2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">100</span>)):</span><br><span class="line">    sleep(<span class="number">0.02</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Plot"><a href="#Plot" class="headerlink" title="Plot"></a>Plot</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install matplotlib</span></span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot</span><br><span class="line">pyplot.plot(&lt;data_1&gt; [, &lt;data_2&gt;, ...])  <span class="comment"># Or: hist(&lt;data&gt;).</span></span><br><span class="line">pyplot.savefig(&lt;filename&gt;)</span><br><span class="line">pyplot.show()</span><br><span class="line">pyplot.clf()                             <span class="comment"># Clears figure.</span></span><br></pre></td></tr></table></figure>
<h3 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h3><hr>
<h4 id="Prints-a-CSV-file-as-an-ASCII-table"><a href="#Prints-a-CSV-file-as-an-ASCII-table" class="headerlink" title="Prints a CSV file as an ASCII table:"></a>Prints a CSV file as an ASCII table:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install tabulate</span></span><br><span class="line"><span class="keyword">from</span> tabulate <span class="keyword">import</span> tabulate</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(&lt;filename&gt;, encoding=<span class="string">'utf-8'</span>, newline=<span class="string">''</span>) <span class="keyword">as</span> file:</span><br><span class="line">    lines   = csv.reader(file)</span><br><span class="line">    headers = [header.title() <span class="keyword">for</span> header <span class="keyword">in</span> next(lines)]</span><br><span class="line">    table   = tabulate(lines, headers)</span><br><span class="line">    print(table)</span><br></pre></td></tr></table></figure>
<h3 id="Curses"><a href="#Curses" class="headerlink" title="Curses"></a>Curses</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> curses <span class="keyword">import</span> wrapper, ascii</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    wrapper(draw)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw</span><span class="params">(screen)</span>:</span></span><br><span class="line">    screen.clear()</span><br><span class="line">    screen.addstr(<span class="number">0</span>, <span class="number">0</span>, <span class="string">'Press ESC to quit.'</span>)</span><br><span class="line">    <span class="keyword">while</span> screen.getch() != ascii.ESC:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_border</span><span class="params">(screen)</span>:</span></span><br><span class="line">    <span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">    P = namedtuple(<span class="string">'P'</span>, <span class="string">'y x'</span>)</span><br><span class="line">    height, width = screen.getmaxyx()</span><br><span class="line">    <span class="keyword">return</span> P(height<span class="number">-1</span>, width<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h3 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install loguru</span></span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">logger.add(<span class="string">'debug_&#123;time&#125;.log'</span>, colorize=<span class="literal">True</span>)  <span class="comment"># Connects a log file.</span></span><br><span class="line">logger.add(<span class="string">'error_&#123;time&#125;.log'</span>, level=<span class="string">'ERROR'</span>)  <span class="comment"># Another file for errors or higher.</span></span><br><span class="line">logger.&lt;level&gt;(<span class="string">'A logging message.'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Levels: <code>&#39;debug&#39;</code>, <code>&#39;info&#39;</code>, <code>&#39;success&#39;</code>, <code>&#39;warning&#39;</code>, <code>&#39;error&#39;</code>, <code>&#39;critical&#39;</code>.</strong></li>
</ul>
<h4 id="Exceptions-2"><a href="#Exceptions-2" class="headerlink" title="Exceptions"></a>Exceptions</h4><p><strong>Error description, stack trace and values of variables are appended automatically.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line">    logger.exception(<span class="string">'An error happened.'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Rotation"><a href="#Rotation" class="headerlink" title="Rotation"></a>Rotation</h4><p><strong>Argument that sets a condition when a new log file is created.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rotation=&lt;int&gt;|&lt;datetime.timedelta&gt;|&lt;datetime.time&gt;|&lt;str&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong><code>&#39;&lt;int&gt;&#39;</code> - Max file size in bytes.</strong></li>
<li><strong><code>&#39;&lt;timedelta&gt;&#39;</code> - Max age of a file.</strong></li>
<li><strong><code>&#39;&lt;time&gt;&#39;</code> - Time of day.</strong></li>
<li><strong><code>&#39;&lt;str&gt;&#39;</code> - Any of above as a string: <code>&#39;100 MB&#39;</code>, <code>&#39;1 month&#39;</code>, <code>&#39;monday at 12:00&#39;</code>, â€¦</strong></li>
</ul>
<h4 id="Retention"><a href="#Retention" class="headerlink" title="Retention"></a>Retention</h4><p><strong>Sets a condition which old log files are deleted.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">retention=&lt;int&gt;|&lt;datetime.timedelta&gt;|&lt;str&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong><code>&#39;&lt;int&gt;&#39;</code> - Max number of files.</strong></li>
<li><strong><code>&#39;&lt;timedelta&gt;&#39;</code> - Max age of a file.</strong></li>
<li><strong><code>&#39;&lt;str&gt;&#39;</code> - Max age as a string: <code>&#39;1 week, 3 days&#39;</code>, <code>&#39;2 months&#39;</code>, â€¦</strong></li>
</ul>
<h3 id="Scraping"><a href="#Scraping" class="headerlink" title="Scraping"></a>Scraping</h3><hr>
<h4 id="Scrapes-and-prints-Pythonâ€™s-URL-and-version-number-from-Wikipedia"><a href="#Scrapes-and-prints-Pythonâ€™s-URL-and-version-number-from-Wikipedia" class="headerlink" title="Scrapes and prints Pythonâ€™s URL and version number from Wikipedia:"></a>Scrapes and prints Pythonâ€™s URL and version number from Wikipedia:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install requests beautifulsoup4</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">url   = <span class="string">'https://en.wikipedia.org/wiki/Python_(programming_language)'</span></span><br><span class="line">page  = requests.get(url)</span><br><span class="line">doc   = BeautifulSoup(page.text, <span class="string">'html.parser'</span>)</span><br><span class="line">table = doc.find(<span class="string">'table'</span>, class_=<span class="string">'infobox vevent'</span>)</span><br><span class="line">rows  = table.find_all(<span class="string">'tr'</span>)</span><br><span class="line">link  = rows[<span class="number">11</span>].find(<span class="string">'a'</span>)[<span class="string">'href'</span>]</span><br><span class="line">ver   = rows[<span class="number">6</span>].find(<span class="string">'div'</span>).text.split()[<span class="number">0</span>]</span><br><span class="line">print(link, ver)</span><br></pre></td></tr></table></figure>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install bottle</span></span><br><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> run, route, post, template, request, response</span><br><span class="line"><span class="keyword">import</span> json</span><br></pre></td></tr></table></figure>
<h4 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">run(host=<span class="string">'localhost'</span>, port=<span class="number">8080</span>)</span><br><span class="line">run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">80</span>, server=<span class="string">'cherrypy'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Static-Request"><a href="#Static-Request" class="headerlink" title="Static Request"></a>Static Request</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@route('/img/&lt;image&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_image</span><span class="params">(image)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> static_file(image, <span class="string">'images/'</span>, mimetype=<span class="string">'image/png'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Dynamic-Request"><a href="#Dynamic-Request" class="headerlink" title="Dynamic Request"></a>Dynamic Request</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@route('/&lt;sport&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_page</span><span class="params">(sport)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> template(<span class="string">'&lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;'</span>, title=sport)</span><br></pre></td></tr></table></figure>
<h4 id="REST-Request"><a href="#REST-Request" class="headerlink" title="REST Request"></a>REST Request</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@post('/odds/&lt;sport&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">odds_handler</span><span class="params">(sport)</span>:</span></span><br><span class="line">    team = request.forms.get(<span class="string">'team'</span>)</span><br><span class="line">    home_odds, away_odds = <span class="number">2.44</span>, <span class="number">3.29</span></span><br><span class="line">    response.headers[<span class="string">'Content-Type'</span>] = <span class="string">'application/json'</span></span><br><span class="line">    response.headers[<span class="string">'Cache-Control'</span>] = <span class="string">'no-cache'</span></span><br><span class="line">    <span class="keyword">return</span> json.dumps([team, home_odds, away_odds])</span><br></pre></td></tr></table></figure>
<h4 id="Test"><a href="#Test" class="headerlink" title="Test:"></a>Test:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install requests</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> requests</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>url  = <span class="string">'http://localhost:8080/odds/football'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = &#123;<span class="string">'team'</span>: <span class="string">'arsenal f.c.'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = requests.post(url, data=data)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.json()</span><br><span class="line">[<span class="string">'arsenal f.c.'</span>, <span class="number">2.44</span>, <span class="number">3.29</span>]</span><br></pre></td></tr></table></figure>
<h3 id="Profile"><a href="#Profile" class="headerlink" title="Profile"></a>Profile</h3><hr>
<h3 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line">start_time = time()                  <span class="comment"># Seconds since Epoch.</span></span><br><span class="line">...</span><br><span class="line">duration = time() - start_time</span><br></pre></td></tr></table></figure>
<h4 id="High-Performance"><a href="#High-Performance" class="headerlink" title="High Performance"></a>High Performance</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> perf_counter <span class="keyword">as</span> pc</span><br><span class="line">start_time = pc()                    <span class="comment"># Seconds since restart.</span></span><br><span class="line">...</span><br><span class="line">duration = pc() - start_time</span><br></pre></td></tr></table></figure>
<h4 id="Timing-a-Snippet"><a href="#Timing-a-Snippet" class="headerlink" title="Timing a Snippet"></a>Timing a Snippet</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> timeit <span class="keyword">import</span> timeit</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(<span class="string">'"-".join(str(a) for a in range(100))'</span>,</span><br><span class="line"><span class="meta">... </span>       number=<span class="number">10000</span>, globals=globals(), setup=<span class="string">'pass'</span>)</span><br><span class="line"><span class="number">0.34986</span></span><br></pre></td></tr></table></figure>
<h4 id="Line-Profiler"><a href="#Line-Profiler" class="headerlink" title="Line Profiler"></a>Line Profiler</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install line_profiler</span></span><br><span class="line"><span class="meta">@profile</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    a = [*range(<span class="number">10000</span>)]</span><br><span class="line">    b = &#123;*range(<span class="number">10000</span>)&#125;</span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<h4 id="Usage"><a href="#Usage" class="headerlink" title="Usage:"></a>Usage:</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ kernprof -lv test.py</span><br><span class="line">Line #      Hits         Time  Per Hit   % Time  Line Contents</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">     1                                           @profile</span><br><span class="line">     2                                           def main():</span><br><span class="line">     3         1       1128.0   1128.0     27.4      a &#x3D; [*range(10000)]</span><br><span class="line">     4         1       2994.0   2994.0     72.6      b &#x3D; &#123;*range(10000)&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Call-Graph"><a href="#Call-Graph" class="headerlink" title="Call Graph"></a>Call Graph</h4><h5 id="Generates-a-PNG-image-of-a-call-graph-with-highlighted-bottlenecks"><a href="#Generates-a-PNG-image-of-a-call-graph-with-highlighted-bottlenecks" class="headerlink" title="Generates a PNG image of a call graph with highlighted bottlenecks:"></a>Generates a PNG image of a call graph with highlighted bottlenecks:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install pycallgraph</span></span><br><span class="line"><span class="keyword">from</span> pycallgraph <span class="keyword">import</span> output, PyCallGraph</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">time_str = datetime.now().strftime(<span class="string">'%Y%m%d%H%M%S'</span>)</span><br><span class="line">filename = <span class="string">f'profile-<span class="subst">&#123;time_str&#125;</span>.png'</span></span><br><span class="line">drawer = output.GraphvizOutput(output_file=filename)</span><br><span class="line"><span class="keyword">with</span> PyCallGraph(drawer):</span><br><span class="line">    &lt;code_to_be_profiled&gt;</span><br></pre></td></tr></table></figure>
<h3 id="NumPy"><a href="#NumPy" class="headerlink" title="NumPy"></a>NumPy</h3><hr>
<p><strong>Array manipulation mini language. Can run up to one hundred times faster than equivalent Python code.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install numpy</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;array&gt; = np.array(&lt;list&gt;)</span><br><span class="line">&lt;array&gt; = np.arange(from_inclusive, to_exclusive, Â±step_size)</span><br><span class="line">&lt;array&gt; = np.ones(&lt;shape&gt;)</span><br><span class="line">&lt;array&gt; = np.random.randint(from_inclusive, to_exclusive, &lt;shape&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;array&gt;.shape = &lt;shape&gt;</span><br><span class="line">&lt;view&gt;  = &lt;array&gt;.reshape(&lt;shape&gt;)</span><br><span class="line">&lt;view&gt;  = np.broadcast_to(&lt;array&gt;, &lt;shape&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;array&gt; = &lt;array&gt;.sum(axis)</span><br><span class="line">indexes = &lt;array&gt;.argmin(axis)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Shape is a tuple of dimension sizes.</strong></li>
<li><strong>Axis is an index of dimension that gets collapsed. Leftmost dimension has index 0.</strong></li>
</ul>
<h4 id="Indexing"><a href="#Indexing" class="headerlink" title="Indexing"></a>Indexing</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;el&gt;       = &lt;2d_array&gt;[0, 0]        <span class="comment"># First element.</span></span><br><span class="line">&lt;1d_view&gt;  = &lt;2d_array&gt;[0]           <span class="comment"># First row.</span></span><br><span class="line">&lt;1d_view&gt;  = &lt;2d_array&gt;[:, 0]        <span class="comment"># First column. Also [..., 0].</span></span><br><span class="line">&lt;3d_view&gt;  = &lt;2d_array&gt;[None, :, :]  <span class="comment"># Expanded by dimension of size 1.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;1d_array&gt; = &lt;2d_array&gt;[&lt;1d_row_indexes&gt;, &lt;1d_column_indexes&gt;]</span><br><span class="line">&lt;2d_array&gt; = &lt;2d_array&gt;[&lt;2d_row_indexes&gt;, &lt;2d_column_indexes&gt;]</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;2d_bools&gt; = &lt;2d_array&gt; &gt; 0</span><br><span class="line">&lt;1d_array&gt; = &lt;2d_array&gt;[&lt;2d_bools&gt;]</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If row and column indexes differ in shape, they are combined with broadcasting.</strong></li>
</ul>
<h4 id="Broadcasting"><a href="#Broadcasting" class="headerlink" title="Broadcasting"></a>Broadcasting</h4><p><strong>Broadcasting is a set of rules by which NumPy functions operate on arrays of different sizes and/or dimensions.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">left  = [[<span class="number">0.1</span>], [<span class="number">0.6</span>], [<span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 1)</span></span><br><span class="line">right = [ <span class="number">0.1</span> ,  <span class="number">0.6</span> ,  <span class="number">0.8</span> ]  <span class="comment"># Shape: (3)</span></span><br></pre></td></tr></table></figure>
<h5 id="1-If-array-shapes-differ-in-length-left-pad-the-shorter-shape-with-ones"><a href="#1-If-array-shapes-differ-in-length-left-pad-the-shorter-shape-with-ones" class="headerlink" title="1. If array shapes differ in length, left-pad the shorter shape with ones:"></a>1. If array shapes differ in length, left-pad the shorter shape with ones:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">left  = [[<span class="number">0.1</span>], [<span class="number">0.6</span>], [<span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 1)</span></span><br><span class="line">right = [[<span class="number">0.1</span> ,  <span class="number">0.6</span> ,  <span class="number">0.8</span>]]  <span class="comment"># Shape: (1, 3) &lt;- !</span></span><br></pre></td></tr></table></figure>
<h5 id="2-If-any-dimensions-differ-in-size-expand-the-ones-that-have-size-1-by-duplicating-their-elements"><a href="#2-If-any-dimensions-differ-in-size-expand-the-ones-that-have-size-1-by-duplicating-their-elements" class="headerlink" title="2. If any dimensions differ in size, expand the ones that have size 1 by duplicating their elements:"></a>2. If any dimensions differ in size, expand the ones that have size 1 by duplicating their elements:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">left  = [[<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.1</span>], [<span class="number">0.6</span>, <span class="number">0.6</span>, <span class="number">0.6</span>], [<span class="number">0.8</span>, <span class="number">0.8</span>, <span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 3) &lt;- !</span></span><br><span class="line">right = [[<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>], [<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>], [<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 3) &lt;- !</span></span><br></pre></td></tr></table></figure>
<h5 id="3-If-neither-non-matching-dimension-has-size-1-rise-an-error"><a href="#3-If-neither-non-matching-dimension-has-size-1-rise-an-error" class="headerlink" title="3. If neither non-matching dimension has size 1, rise an error."></a>3. If neither non-matching dimension has size 1, rise an error.</h5><h4 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h4><h5 id="For-each-point-returns-index-of-its-nearest-point-0-1-0-6-0-8-gt-1-2-1"><a href="#For-each-point-returns-index-of-its-nearest-point-0-1-0-6-0-8-gt-1-2-1" class="headerlink" title="For each point returns index of its nearest point ([0.1, 0.6, 0.8] =&gt; [1, 2, 1]):"></a>For each point returns index of its nearest point (<code>[0.1, 0.6, 0.8] =&gt; [1, 2, 1]</code>):</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>points = np.array([<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>])</span><br><span class="line">[ <span class="number">0.1</span>,  <span class="number">0.6</span>,  <span class="number">0.8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>wrapped_points = points.reshape(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">[[ <span class="number">0.1</span>],</span><br><span class="line"> [ <span class="number">0.6</span>],</span><br><span class="line"> [ <span class="number">0.8</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances = wrapped_points - points</span><br><span class="line">[[ <span class="number">0.</span> , <span class="number">-0.5</span>, <span class="number">-0.7</span>],</span><br><span class="line"> [ <span class="number">0.5</span>,  <span class="number">0.</span> , <span class="number">-0.2</span>],</span><br><span class="line"> [ <span class="number">0.7</span>,  <span class="number">0.2</span>,  <span class="number">0.</span> ]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances = np.abs(distances)</span><br><span class="line">[[ <span class="number">0.</span> ,  <span class="number">0.5</span>,  <span class="number">0.7</span>],</span><br><span class="line"> [ <span class="number">0.5</span>,  <span class="number">0.</span> ,  <span class="number">0.2</span>],</span><br><span class="line"> [ <span class="number">0.7</span>,  <span class="number">0.2</span>,  <span class="number">0.</span> ]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>i = np.arange(<span class="number">3</span>)</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances[i, i] = np.inf</span><br><span class="line">[[ inf,  <span class="number">0.5</span>,  <span class="number">0.7</span>],</span><br><span class="line"> [ <span class="number">0.5</span>,  inf,  <span class="number">0.2</span>],</span><br><span class="line"> [ <span class="number">0.7</span>,  <span class="number">0.2</span>,  inf]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances.argmin(<span class="number">1</span>)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<h3 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install pillow</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br></pre></td></tr></table></figure>
<h4 id="Creates-a-PNG-image-of-a-rainbow-gradient"><a href="#Creates-a-PNG-image-of-a-rainbow-gradient" class="headerlink" title="Creates a PNG image of a rainbow gradient:"></a>Creates a PNG image of a rainbow gradient:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">width  = <span class="number">100</span></span><br><span class="line">height = <span class="number">100</span></span><br><span class="line">size   = width * height</span><br><span class="line">pixels = [<span class="number">255</span> * i/size <span class="keyword">for</span> i <span class="keyword">in</span> range(size)]</span><br><span class="line"></span><br><span class="line">img = Image.new(<span class="string">'HSV'</span>, (width, height))</span><br><span class="line">img.putdata([(int(a), <span class="number">255</span>, <span class="number">255</span>) <span class="keyword">for</span> a <span class="keyword">in</span> pixels])</span><br><span class="line">img.convert(mode=<span class="string">'RGB'</span>).save(<span class="string">'test.png'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Adds-noise-to-a-PNG-image"><a href="#Adds-noise-to-a-PNG-image" class="headerlink" title="Adds noise to a PNG image:"></a>Adds noise to a PNG image:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">add_noise = <span class="keyword">lambda</span> value: max(<span class="number">0</span>, min(<span class="number">255</span>, value + randint(<span class="number">-20</span>, <span class="number">20</span>)))</span><br><span class="line">img = Image.open(<span class="string">'test.png'</span>).convert(mode=<span class="string">'HSV'</span>)</span><br><span class="line">img.putdata([(add_noise(h), s, v) <span class="keyword">for</span> h, s, v <span class="keyword">in</span> img.getdata()])</span><br><span class="line">img.convert(mode=<span class="string">'RGB'</span>).save(<span class="string">'test.png'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Modes-1"><a href="#Modes-1" class="headerlink" title="Modes"></a>Modes</h4><ul>
<li><strong><code>&#39;1&#39;</code> - 1-bit pixels, black and white, stored with one pixel per byte.</strong></li>
<li><strong><code>&#39;L&#39;</code> - 8-bit pixels, greyscale.</strong></li>
<li><strong><code>&#39;RGB&#39;</code> - 3x8-bit pixels, true color.</strong></li>
<li><strong><code>&#39;RGBA&#39;</code> - 4x8-bit pixels, true color with transparency mask.</strong></li>
<li><strong><code>&#39;HSV&#39;</code> - 3x8-bit pixels, Hue, Saturation, Value color space.</strong></li>
</ul>
<h3 id="Audio"><a href="#Audio" class="headerlink" title="Audio"></a>Audio</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> wave</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack, iter_unpack</span><br></pre></td></tr></table></figure>
<h4 id="Read-Frames-from-WAV-File"><a href="#Read-Frames-from-WAV-File" class="headerlink" title="Read Frames from WAV File"></a>Read Frames from WAV File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_wav_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> wave.open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> wf:</span><br><span class="line">        frames = wf.readframes(wf.getnframes())</span><br><span class="line">        <span class="keyword">return</span> [a[<span class="number">0</span>] <span class="keyword">for</span> a <span class="keyword">in</span> iter_unpack(<span class="string">'&lt;h'</span>, frames)]</span><br></pre></td></tr></table></figure>
<h4 id="Write-Frames-to-WAV-File"><a href="#Write-Frames-to-WAV-File" class="headerlink" title="Write Frames to WAV File"></a>Write Frames to WAV File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_wav_file</span><span class="params">(filename, frames_int, mono=True)</span>:</span></span><br><span class="line">    frames_short = (pack(<span class="string">'&lt;h'</span>, a) <span class="keyword">for</span> a <span class="keyword">in</span> frames_int)</span><br><span class="line">    <span class="keyword">with</span> wave.open(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> wf:</span><br><span class="line">        wf.setnchannels(<span class="number">1</span> <span class="keyword">if</span> mono <span class="keyword">else</span> <span class="number">2</span>)</span><br><span class="line">        wf.setsampwidth(<span class="number">2</span>)</span><br><span class="line">        wf.setframerate(<span class="number">44100</span>)</span><br><span class="line">        wf.writeframes(<span class="string">b''</span>.join(frames_short))</span><br></pre></td></tr></table></figure>
<h4 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><h5 id="Saves-a-sine-wave-to-a-mono-WAV-file"><a href="#Saves-a-sine-wave-to-a-mono-WAV-file" class="headerlink" title="Saves a sine wave to a mono WAV file:"></a>Saves a sine wave to a mono WAV file:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> pi, sin</span><br><span class="line">frames_f = (sin(i * <span class="number">2</span> * pi * <span class="number">440</span> / <span class="number">44100</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100000</span>))</span><br><span class="line">frames_i = (int(a * <span class="number">30000</span>) <span class="keyword">for</span> a <span class="keyword">in</span> frames_f)</span><br><span class="line">write_to_wav_file(<span class="string">'test.wav'</span>, frames_i)</span><br></pre></td></tr></table></figure>
<h5 id="Adds-noise-to-a-mono-WAV-file"><a href="#Adds-noise-to-a-mono-WAV-file" class="headerlink" title="Adds noise to a mono WAV file:"></a>Adds noise to a mono WAV file:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">add_noise = <span class="keyword">lambda</span> value: max(<span class="number">-32768</span>, min(<span class="number">32767</span>, value + randint(<span class="number">-500</span>, <span class="number">500</span>)))</span><br><span class="line">frames_i  = (add_noise(a) <span class="keyword">for</span> a <span class="keyword">in</span> read_wav_file(<span class="string">'test.wav'</span>))</span><br><span class="line">write_to_wav_file(<span class="string">'test.wav'</span>, frames_i)</span><br></pre></td></tr></table></figure>
<h4 id="Synthesizer"><a href="#Synthesizer" class="headerlink" title="Synthesizer"></a>Synthesizer</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install simpleaudio</span></span><br><span class="line"><span class="keyword">import</span> simpleaudio, math, struct</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain, repeat</span><br><span class="line">F  = <span class="number">44100</span></span><br><span class="line">P1 = <span class="string">'71â™ª,69,,71â™ª,66,,62â™ª,66,,59â™ª,,,'</span></span><br><span class="line">P2 = <span class="string">'71â™ª,73,,74â™ª,73,,74,,71,,73â™ª,71,,73,,69,,71â™ª,69,,71,,67,,71â™ª,,,'</span></span><br><span class="line">get_pause  = <span class="keyword">lambda</span> seconds: repeat(<span class="number">0</span>, int(seconds * F))</span><br><span class="line">sin_f      = <span class="keyword">lambda</span> i, hz: math.sin(i * <span class="number">2</span> * math.pi * hz / F)</span><br><span class="line">get_wave   = <span class="keyword">lambda</span> hz, seconds: (sin_f(i, hz) <span class="keyword">for</span> i <span class="keyword">in</span> range(int(seconds * F)))</span><br><span class="line">get_hz     = <span class="keyword">lambda</span> key: <span class="number">8.176</span> * <span class="number">2</span> ** (int(key) / <span class="number">12</span>)</span><br><span class="line">parse_note = <span class="keyword">lambda</span> note: (get_hz(note[:<span class="number">2</span>]), <span class="number">0.25</span> <span class="keyword">if</span> <span class="string">'â™ª'</span> <span class="keyword">in</span> note <span class="keyword">else</span> <span class="number">0.125</span>)</span><br><span class="line">get_frames = <span class="keyword">lambda</span> note: get_wave(*parse_note(note)) <span class="keyword">if</span> note <span class="keyword">else</span> get_pause(<span class="number">0.125</span>)</span><br><span class="line">frames_f   = chain.from_iterable(get_frames(n) <span class="keyword">for</span> n <span class="keyword">in</span> <span class="string">f'<span class="subst">&#123;P1&#125;</span><span class="subst">&#123;P1&#125;</span><span class="subst">&#123;P2&#125;</span>'</span>.split(<span class="string">','</span>))</span><br><span class="line">frames_b   = <span class="string">b''</span>.join(struct.pack(<span class="string">'&lt;h'</span>, int(f * <span class="number">30000</span>)) <span class="keyword">for</span> f <span class="keyword">in</span> frames_f)</span><br><span class="line">simpleaudio.play_buffer(frames_b, <span class="number">1</span>, <span class="number">2</span>, F)</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>åºåˆ—æ ‡æ³¨</title>
    <url>/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åé¢éœ€è¦è¡¥å……åºåˆ—æ ‡æ³¨åœ¨åˆ†è¯ã€è¯æ€§æ ‡æ³¨ã€å‘½åå®ä½“è¯†åˆ«ç­‰ç›¸å…³ä»»åŠ¡çš„ä»£ç å®è·µ(èµ°è¿‡çš„å‘ã€‚ã€‚)åŠç›¸å…³ç†è®ºçŸ¥è¯†ã€‚</p>
<h3 id="æ¡ä»¶éšæœºåœº-CRF"><a href="#æ¡ä»¶éšæœºåœº-CRF" class="headerlink" title="æ¡ä»¶éšæœºåœº(CRF)"></a>æ¡ä»¶éšæœºåœº(CRF)</h3><h4 id="crf-ç”¨äºåºåˆ—æ ‡æ³¨é—®é¢˜"><a href="#crf-ç”¨äºåºåˆ—æ ‡æ³¨é—®é¢˜" class="headerlink" title="crf ç”¨äºåºåˆ—æ ‡æ³¨é—®é¢˜"></a>crf ç”¨äºåºåˆ—æ ‡æ³¨é—®é¢˜</h4><p>åœ¨ CRF çš„åºåˆ—æ ‡æ³¨é—®é¢˜ä¸­ï¼Œè¦è®¡ç®—çš„æ˜¯æ¡ä»¶æ¦‚ç‡ï¼š</p>
<script type="math/tex; mode=display">
P\left(y_{1}, \ldots, y_{n} | x_{1}, \ldots, x_{n}\right)=P\left(y_{1}, \ldots, y_{n} | \boldsymbol{x}\right), \quad \boldsymbol{x}=\left(x_{1}, \ldots, x_{n}\right) \tag{1}</script><a id="more"></a>
<p>ä¸ºäº†å¾—åˆ°è¿™ä¸ªæ¦‚ç‡çš„ä¼°è®¡ï¼ŒCRF åšäº†ä¸¤ä¸ªå‡è®¾ï¼š</p>
<h5 id="å‡è®¾ä¸€ï¼šè¯¥åˆ†å¸ƒæ˜¯æŒ‡æ•°æ—åˆ†å¸ƒã€‚"><a href="#å‡è®¾ä¸€ï¼šè¯¥åˆ†å¸ƒæ˜¯æŒ‡æ•°æ—åˆ†å¸ƒã€‚" class="headerlink" title="å‡è®¾ä¸€ï¼šè¯¥åˆ†å¸ƒæ˜¯æŒ‡æ•°æ—åˆ†å¸ƒã€‚"></a><strong>å‡è®¾ä¸€ï¼šè¯¥åˆ†å¸ƒæ˜¯æŒ‡æ•°æ—åˆ†å¸ƒã€‚</strong></h5><p>è¿™ä¸ªå‡è®¾æ„å‘³ç€å­˜åœ¨å‡½æ•° $f(y_1,â€¦,y_n;x)$ï¼Œä½¿å¾—ï¼š</p>
<script type="math/tex; mode=display">
P\left(y_{1}, \ldots, y_{n} | \boldsymbol{x}\right)=\frac{1}{Z(\boldsymbol{x})} \exp \left(f\left(y_{1}, \ldots, y_{n} ; \boldsymbol{x}\right)\right) \tag{2}</script><p>å…¶ä¸­ Z(x) æ˜¯å½’ä¸€åŒ–å› å­ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯æ¡ä»¶åˆ†å¸ƒï¼Œæ‰€ä»¥å½’ä¸€åŒ–å› å­è·Ÿ x æœ‰å…³ã€‚è¿™ä¸ª f å‡½æ•°å¯ä»¥è§†ä¸ºä¸€ä¸ªæ‰“åˆ†å‡½æ•°ï¼Œæ‰“åˆ†å‡½æ•°å–æŒ‡æ•°å¹¶å½’ä¸€åŒ–åå°±å¾—åˆ°æ¦‚ç‡åˆ†å¸ƒã€‚ </p>
<h5 id="å‡è®¾äºŒï¼šè¾“å‡ºä¹‹é—´çš„å…³è”ä»…å‘ç”Ÿåœ¨ç›¸é‚»ä½ç½®ï¼Œå¹¶ä¸”å…³è”æ˜¯æŒ‡æ•°åŠ æ€§çš„ã€‚"><a href="#å‡è®¾äºŒï¼šè¾“å‡ºä¹‹é—´çš„å…³è”ä»…å‘ç”Ÿåœ¨ç›¸é‚»ä½ç½®ï¼Œå¹¶ä¸”å…³è”æ˜¯æŒ‡æ•°åŠ æ€§çš„ã€‚" class="headerlink" title="å‡è®¾äºŒï¼šè¾“å‡ºä¹‹é—´çš„å…³è”ä»…å‘ç”Ÿåœ¨ç›¸é‚»ä½ç½®ï¼Œå¹¶ä¸”å…³è”æ˜¯æŒ‡æ•°åŠ æ€§çš„ã€‚"></a><strong>å‡è®¾äºŒï¼šè¾“å‡ºä¹‹é—´çš„å…³è”ä»…å‘ç”Ÿåœ¨ç›¸é‚»ä½ç½®ï¼Œå¹¶ä¸”å…³è”æ˜¯æŒ‡æ•°åŠ æ€§çš„ã€‚</strong></h5><p>è¿™ä¸ªå‡è®¾æ„å‘³ç€ f(y1,â€¦,yn;x) å¯ä»¥æ›´è¿›ä¸€æ­¥ç®€åŒ–ä¸ºï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
f\left(y_{1}, \ldots, y_{n} ; \boldsymbol{x}\right)=h\left(y_{1} ; \boldsymbol{x}\right) &+g\left(y_{1}, y_{2} ; \boldsymbol{x}\right)+h\left(y_{2} ; \boldsymbol{x}\right)+\ldots \\
&+g\left(y_{n-1}, y_{n} ; \boldsymbol{x}\right)+h\left(y_{n} ; \boldsymbol{x}\right)
\end{aligned} \tag{3}</script><p>è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦å¯¹æ¯ä¸€ä¸ªæ ‡ç­¾å’Œæ¯ä¸€ä¸ªç›¸é‚»æ ‡ç­¾å¯¹åˆ†åˆ«æ‰“åˆ†ï¼Œç„¶åå°†æ‰€æœ‰æ‰“åˆ†ç»“æœæ±‚å’Œå¾—åˆ°æ€»åˆ†ã€‚</p>
<h5 id="çº¿æ€§é“¾crf"><a href="#çº¿æ€§é“¾crf" class="headerlink" title="çº¿æ€§é“¾crf"></a>çº¿æ€§é“¾crf</h5><p>å°½ç®¡å·²ç»åšäº†å¤§é‡ç®€åŒ–ï¼Œä½†ä¸€èˆ¬æ¥è¯´ï¼Œ(3)å¼æ‰€è¡¨ç¤ºçš„æ¦‚ç‡æ¨¡å‹è¿˜æ˜¯è¿‡äºå¤æ‚ï¼Œéš¾ä»¥æ±‚è§£ã€‚<strong>äºæ˜¯è€ƒè™‘åˆ°å½“å‰æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­ï¼ŒRNN æˆ–è€…å±‚å  CNN ç­‰æ¨¡å‹å·²ç»èƒ½å¤Ÿæ¯”è¾ƒå……åˆ†æ•æ‰å„ä¸ª y ä¸è¾“å‡º x çš„è”ç³»</strong>ï¼Œå› æ­¤ï¼Œä¸å¦¨è€ƒè™‘å‡½æ•° g è·Ÿ x æ— å…³ï¼Œé‚£ä¹ˆï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
f\left(y_{1}, \ldots, y_{n} ; \boldsymbol{x}\right)=h\left(y_{1} ; \boldsymbol{x}\right) &+g\left(y_{1}, y_{2}\right)+h\left(y_{2} ; \boldsymbol{x}\right)+\ldots \\
&+g\left(y_{n-1}, y_{n}\right)+h\left(y_{n} ; \boldsymbol{x}\right)
\end{aligned}</script><p>è¿™æ—¶å€™ g å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæœ‰é™çš„ã€å¾…è®­ç»ƒçš„å‚æ•°çŸ©é˜µè€Œå·²ï¼Œè€Œå•æ ‡ç­¾çš„æ‰“åˆ†å‡½æ•° $h(y_i;x$) å¯ä»¥é€šè¿‡ RNN æˆ–è€… CNN æ¥å»ºæ¨¡ã€‚å› æ­¤ï¼Œè¯¥æ¨¡å‹æ˜¯å¯ä»¥å»ºç«‹çš„ï¼Œå…¶ä¸­æ¦‚ç‡åˆ†å¸ƒå˜ä¸ºï¼š</p>
<script type="math/tex; mode=display">
P\left(y_{1}, \ldots, y_{n} | x\right)=\frac{1}{Z(x)} \exp \left(h\left(y_{1} ; x\right)+\sum_{k=1}^{n-1} g\left(y_{k}, y_{k+1}\right)+h\left(y_{k+1} ; x\right)\right)</script><h5 id="å½’ä¸€åŒ–å› å­"><a href="#å½’ä¸€åŒ–å› å­" class="headerlink" title="å½’ä¸€åŒ–å› å­"></a>å½’ä¸€åŒ–å› å­</h5><p>ä¸ºäº†è®­ç»ƒ CRF æ¨¡å‹ï¼Œç”¨æœ€å¤§ä¼¼ç„¶æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç”¨ï¼š$-\log P\left(y_{1}, \ldots, y_{n} | x\right)$ï¼Œä½œä¸ºæŸå¤±å‡½æ•°ï¼Œå¯ä»¥ç®—å‡ºå®ƒç­‰äºï¼š</p>
<script type="math/tex; mode=display">
-\left(h\left(y_{1} ; \boldsymbol{x}\right)+\sum_{k=1}^{n-1} g\left(y_{k}, y_{k+1}\right)+h\left(y_{k+1} ; \boldsymbol{x}\right)\right)+\log Z(\boldsymbol{x})</script><p>å…¶ä¸­ç¬¬ä¸€é¡¹æ˜¯åŸæ¥æ¦‚ç‡å¼çš„<strong>åˆ†å­</strong>çš„å¯¹æ•°ï¼Œå®ƒæ˜¯å¯¹ç›®æ ‡çš„åºåˆ—çš„æ‰“åˆ†ï¼Œè™½ç„¶å®ƒçœ‹ä¸Šå»æŒºè¿‚å›çš„ï¼Œä½†æ˜¯å¹¶ä¸éš¾è®¡ç®—ã€‚çœŸæ­£çš„éš¾åº¦åœ¨äº<strong>åˆ†æ¯</strong>çš„å¯¹æ•° $logZ(x)$ è¿™ä¸€é¡¹ã€‚</p>
<p>å½’ä¸€åŒ–å› å­ï¼Œåœ¨ç‰©ç†ä¸Šä¹Ÿå«é…åˆ†å‡½æ•°ï¼Œåœ¨è¿™é‡Œå®ƒéœ€è¦æˆ‘ä»¬å¯¹æ‰€æœ‰å¯èƒ½çš„è·¯å¾„çš„æ‰“åˆ†è¿›è¡ŒæŒ‡æ•°æ±‚å’Œï¼Œè€Œæˆ‘ä»¬å‰é¢å·²ç»è¯´åˆ°ï¼Œè¿™æ ·çš„è·¯å¾„æ•°æ˜¯æŒ‡æ•°é‡çº§çš„ï¼ˆk^nï¼‰ï¼Œå› æ­¤ç›´æ¥æ¥ç®—å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚</p>
<p>äº‹å®ä¸Šï¼Œ<strong>å½’ä¸€åŒ–å› å­éš¾ç®—ï¼Œå‡ ä¹æ˜¯æ‰€æœ‰æ¦‚ç‡å›¾æ¨¡å‹çš„å…¬å…±éš¾é¢˜</strong>ã€‚å¹¸è¿çš„æ˜¯ï¼Œåœ¨ CRF æ¨¡å‹ä¸­ï¼Œç”±äºæˆ‘ä»¬åªè€ƒè™‘äº†ä¸´è¿‘æ ‡ç­¾çš„è”ç³»ï¼ˆé©¬å°”å¯å¤«å‡è®¾ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€’å½’åœ°ç®—å‡ºå½’ä¸€åŒ–å› å­ï¼Œè¿™ä½¿å¾—åŸæ¥æ˜¯æŒ‡æ•°çº§çš„è®¡ç®—é‡é™ä½ä¸ºçº¿æ€§çº§åˆ«ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°†è®¡ç®—åˆ°æ—¶åˆ» $t$ çš„å½’ä¸€åŒ–å› å­è®°ä¸º$Z_t$ï¼Œå¹¶å°†å®ƒåˆ†ä¸º $k$ ä¸ªéƒ¨åˆ†ï¼š</p>
<script type="math/tex; mode=display">
Z_{t}=Z_{t}^{(1)}+Z_{t}^{(2)}+\cdots+Z_{t}^{(k)}</script><p>åˆ†åˆ«æ˜¯æˆªæ­¢åˆ°å½“å‰æ—¶åˆ» $t$ ä¸­ã€ä»¥æ ‡ç­¾ $1,â€¦,k$ ä¸ºç»ˆç‚¹çš„æ‰€æœ‰è·¯å¾„çš„å¾—åˆ†æŒ‡æ•°å’Œã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥é€’å½’åœ°è®¡ç®—ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
Z_{t+1}^{(1)} &=\left(Z_{t}^{(1)} G_{11}+Z_{t}^{(2)} G_{21}+\cdots+Z_{t}^{(k)} G_{k 1}\right) h_{t+1}(1 | x) \\
Z_{t+1}^{(2)} &=\left(Z_{t}^{(1)} G_{12}+Z_{t}^{(2)} G_{22}+\cdots+Z_{t}^{(k)} G_{k 2}\right) h_{t+1}(2 | x) \\
& \vdots \\
Z_{t+1}^{(k)} &=\left(Z_{t}^{(1)} G_{1 k}+Z_{t}^{(2)} G_{2 k}+\cdots+Z_{t}^{(k)} G_{k k}\right) h_{t+1}(k | x)
\end{aligned}</script><p>å®ƒå¯ä»¥ç®€å•å†™ä¸ºçŸ©é˜µå½¢å¼ï¼š</p>
<script type="math/tex; mode=display">
\mathbf{Z}_{t+1}=\mathbf{Z}_{t} \boldsymbol{G} \otimes H\left(y_{t+1} | \boldsymbol{x}\right)</script><p>å…¶ä¸­,$Z_{t}=\left[Z_{t}^{(1)}, \ldots, Z_{t}^{(k)}\right]$,è€Œ G æ˜¯å¯¹ g(yi,yj) (çŠ¶æ€è½¬ç§»)å„ä¸ªå…ƒç´ å–æŒ‡æ•°åçš„çŸ©é˜µï¼Œå³$G=e^{g(y i, y j)}$,è€Œ$H(y_{t+1}|x)$,æ˜¯ç¼–ç æ¨¡å‹$h(y_{t+1}|x)$,ï¼ˆRNNã€CNNç­‰ï¼‰å¯¹ä½ç½® t+1 çš„å„ä¸ªæ ‡ç­¾çš„æ‰“åˆ†çš„æŒ‡æ•°ï¼Œå³$H\left(y_{t+1} | x\right)=e^{h\left(y_{t+1} | x\right)}$ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå‘é‡ã€‚$Z_tG$ è¿™ä¸€æ­¥æ˜¯çŸ©é˜µä¹˜æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªå‘é‡ï¼Œè€Œ $âŠ—$ æ˜¯ä¸¤ä¸ªå‘é‡çš„é€ä½å¯¹åº”ç›¸ä¹˜ã€‚</p>
<p><img src="/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/decode-crf.png" alt="avatar"></p>
<p>ä»tåˆ°t+1æ—¶åˆ»çš„è®¡ç®—ï¼ŒåŒ…æ‹¬è½¬ç§»æ¦‚ç‡å’Œj+1èŠ‚ç‚¹æœ¬èº«çš„æ¦‚ç‡</p>
<h5 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h5><p>å†™å‡ºæŸå¤±å‡½æ•° $-logP(y_1,â€¦,y_n|x)$ åï¼Œå°±å¯ä»¥å®Œæˆæ¨¡å‹çš„è®­ç»ƒäº†ï¼Œå› ä¸ºç›®å‰çš„æ·±åº¦å­¦ä¹ æ¡†æ¶éƒ½å·²ç»å¸¦æœ‰è‡ªåŠ¨æ±‚å¯¼çš„åŠŸèƒ½ï¼Œåªè¦æˆ‘ä»¬èƒ½å†™å‡ºå¯å¯¼çš„ lossï¼Œå°±å¯ä»¥å¸®æˆ‘ä»¬å®Œæˆä¼˜åŒ–è¿‡ç¨‹äº†ã€‚ </p>
<p>é‚£ä¹ˆå‰©ä¸‹çš„æœ€åä¸€æ­¥ï¼Œå°±æ˜¯æ¨¡å‹è®­ç»ƒå®Œæˆåï¼Œå¦‚ä½•æ ¹æ®è¾“å…¥æ‰¾å‡ºæœ€ä¼˜è·¯å¾„æ¥ã€‚è·Ÿå‰é¢ä¸€æ ·ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªä» $k^n$ æ¡è·¯å¾„ä¸­é€‰æœ€ä¼˜çš„é—®é¢˜ï¼Œè€ŒåŒæ ·åœ°ï¼Œå› ä¸ºé©¬å°”å¯å¤«å‡è®¾çš„å­˜åœ¨ï¼Œå®ƒå¯ä»¥è½¬åŒ–ä¸ºä¸€ä¸ªåŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œç”¨ viterbi ç®—æ³•è§£å†³ï¼Œè®¡ç®—é‡æ­£æ¯”äº nã€‚ </p>
<p>åŠ¨æ€è§„åˆ’åœ¨æœ¬åšå®¢å·²ç»å‡ºç°äº†å¤šæ¬¡äº†ï¼Œ<strong>å®ƒçš„é€’å½’æ€æƒ³å°±æ˜¯ï¼šä¸€æ¡æœ€ä¼˜è·¯å¾„åˆ‡æˆä¸¤æ®µï¼Œé‚£ä¹ˆæ¯ä¸€æ®µéƒ½æ˜¯ä¸€æ¡ï¼ˆå±€éƒ¨ï¼‰æœ€ä¼˜è·¯å¾„</strong>ã€‚</p>
<h5 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List, Optional</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRF</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"""Conditional random field.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This module implements a conditional random field [LMP01]_. The forward computation</span></span><br><span class="line"><span class="string">    of this class computes the log likelihood of the given sequence of tags and</span></span><br><span class="line"><span class="string">    emission score tensor. This class also has `~CRF.decode` method which finds</span></span><br><span class="line"><span class="string">    the best tag sequence given an emission score tensor using `Viterbi algorithm`_.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        num_tags: Number of tags.</span></span><br><span class="line"><span class="string">        batch_first: Whether the first dimension corresponds to the size of a minibatch.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Attributes:</span></span><br><span class="line"><span class="string">        start_transitions (`~torch.nn.Parameter`): Start transition score tensor of size</span></span><br><span class="line"><span class="string">            ``(num_tags,)``.</span></span><br><span class="line"><span class="string">        end_transitions (`~torch.nn.Parameter`): End transition score tensor of size</span></span><br><span class="line"><span class="string">            ``(num_tags,)``.</span></span><br><span class="line"><span class="string">        transitions (`~torch.nn.Parameter`): Transition score tensor of size</span></span><br><span class="line"><span class="string">            ``(num_tags, num_tags)``.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. [LMP01] Lafferty, J., McCallum, A., Pereira, F. (2001).</span></span><br><span class="line"><span class="string">       "Conditional random fields: Probabilistic models for segmenting and</span></span><br><span class="line"><span class="string">       labeling sequence data". *Proc. 18th International Conf. on Machine</span></span><br><span class="line"><span class="string">       Learning*. Morgan Kaufmann. pp. 282â€“289.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. _Viterbi algorithm: https://en.wikipedia.org/wiki/Viterbi_algorithm</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num_tags: int, batch_first: bool = False)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> num_tags &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f'invalid number of tags: <span class="subst">&#123;num_tags&#125;</span>'</span>)</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.num_tags = num_tags</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line">        self.start_transitions = nn.Parameter(torch.empty(num_tags))</span><br><span class="line">        self.end_transitions = nn.Parameter(torch.empty(num_tags))</span><br><span class="line">        self.transitions = nn.Parameter(torch.empty(num_tags, num_tags))</span><br><span class="line"></span><br><span class="line">        self.reset_parameters()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset_parameters</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">"""Initialize the transition parameters.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        The parameters will be initialized randomly from a uniform distribution</span></span><br><span class="line"><span class="string">        between -0.1 and 0.1.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        nn.init.uniform_(self.start_transitions, <span class="number">-0.1</span>, <span class="number">0.1</span>)</span><br><span class="line">        nn.init.uniform_(self.end_transitions, <span class="number">-0.1</span>, <span class="number">0.1</span>)</span><br><span class="line">        nn.init.uniform_(self.transitions, <span class="number">-0.1</span>, <span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span> -&gt; str:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'<span class="subst">&#123;self.__class__.__name__&#125;</span>(num_tags=<span class="subst">&#123;self.num_tags&#125;</span>)'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            self,</span></span></span><br><span class="line"><span class="function"><span class="params">            emissions: torch.Tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            tags: torch.LongTensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            mask: Optional[torch.ByteTensor] = None,</span></span></span><br><span class="line"><span class="function"><span class="params">            reduction: str = <span class="string">'sum'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span> -&gt; torch.Tensor:</span></span><br><span class="line">        <span class="string">"""Compute the conditional log likelihood of a sequence of tags given emission scores.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            emissions (`~torch.Tensor`): Emission score tensor of size</span></span><br><span class="line"><span class="string">                ``(seq_length, batch_size, num_tags)`` if ``batch_first`` is ``False``,</span></span><br><span class="line"><span class="string">                ``(batch_size, seq_length, num_tags)`` otherwise.</span></span><br><span class="line"><span class="string">            tags (`~torch.LongTensor`): Sequence of tags tensor of size</span></span><br><span class="line"><span class="string">                ``(seq_length, batch_size)`` if ``batch_first`` is ``False``,</span></span><br><span class="line"><span class="string">                ``(batch_size, seq_length)`` otherwise.</span></span><br><span class="line"><span class="string">            mask (`~torch.ByteTensor`): Mask tensor of size ``(seq_length, batch_size)``</span></span><br><span class="line"><span class="string">                if ``batch_first`` is ``False``, ``(batch_size, seq_length)`` otherwise.</span></span><br><span class="line"><span class="string">            reduction: Specifies  the reduction to apply to the output:</span></span><br><span class="line"><span class="string">                ``none|sum|mean|token_mean``. ``none``: no reduction will be applied.</span></span><br><span class="line"><span class="string">                ``sum``: the output will be summed over batches. ``mean``: the output will be</span></span><br><span class="line"><span class="string">                averaged over batches. ``token_mean``: the output will be averaged over tokens.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            `~torch.Tensor`: The log likelihood. This will have size ``(batch_size,)`` if</span></span><br><span class="line"><span class="string">            reduction is ``none``, ``()`` otherwise.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self._validate(emissions, tags=tags, mask=mask)</span><br><span class="line">        <span class="keyword">if</span> reduction <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">'none'</span>, <span class="string">'sum'</span>, <span class="string">'mean'</span>, <span class="string">'token_mean'</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f'invalid reduction: <span class="subst">&#123;reduction&#125;</span>'</span>)</span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            mask = torch.ones_like(tags, dtype=torch.uint8)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.batch_first:</span><br><span class="line">            emissions = emissions.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            tags = tags.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            mask = mask.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        numerator = self._compute_score(emissions, tags, mask)</span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        denominator = self._compute_normalizer(emissions, mask)</span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        llh = numerator - denominator</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> reduction == <span class="string">'none'</span>:</span><br><span class="line">            <span class="keyword">return</span> llh</span><br><span class="line">        <span class="keyword">if</span> reduction == <span class="string">'sum'</span>:</span><br><span class="line">            <span class="keyword">return</span> llh.sum()</span><br><span class="line">        <span class="keyword">if</span> reduction == <span class="string">'mean'</span>:</span><br><span class="line">            <span class="keyword">return</span> llh.mean()</span><br><span class="line">        <span class="keyword">assert</span> reduction == <span class="string">'token_mean'</span></span><br><span class="line">        <span class="keyword">return</span> llh.sum() / mask.type_as(emissions).sum()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(self, emissions: torch.Tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">               mask: Optional[torch.ByteTensor] = None)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        <span class="string">"""Find the most likely tag sequence using Viterbi algorithm.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            emissions (`~torch.Tensor`): Emission score tensor of size</span></span><br><span class="line"><span class="string">                ``(seq_length, batch_size, num_tags)`` if ``batch_first`` is ``False``,</span></span><br><span class="line"><span class="string">                ``(batch_size, seq_length, num_tags)`` otherwise.</span></span><br><span class="line"><span class="string">            mask (`~torch.ByteTensor`): Mask tensor of size ``(seq_length, batch_size)``</span></span><br><span class="line"><span class="string">                if ``batch_first`` is ``False``, ``(batch_size, seq_length)`` otherwise.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            List of list containing the best tag sequence for each batch.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self._validate(emissions, mask=mask)</span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            mask = emissions.new_ones(emissions.shape[:<span class="number">2</span>], dtype=torch.uint8)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.batch_first:</span><br><span class="line">            emissions = emissions.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            mask = mask.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self._viterbi_decode(emissions, mask)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_validate</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            self,</span></span></span><br><span class="line"><span class="function"><span class="params">            emissions: torch.Tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            tags: Optional[torch.LongTensor] = None,</span></span></span><br><span class="line"><span class="function"><span class="params">            mask: Optional[torch.ByteTensor] = None)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> emissions.dim() != <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f'emissions must have dimension of 3, got <span class="subst">&#123;emissions.dim()&#125;</span>'</span>)</span><br><span class="line">        <span class="keyword">if</span> emissions.size(<span class="number">2</span>) != self.num_tags:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(</span><br><span class="line">                <span class="string">f'expected last dimension of emissions is <span class="subst">&#123;self.num_tags&#125;</span>, '</span></span><br><span class="line">                <span class="string">f'got <span class="subst">&#123;emissions.size(<span class="number">2</span>)&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> tags <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> emissions.shape[:<span class="number">2</span>] != tags.shape:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(</span><br><span class="line">                    <span class="string">'the first two dimensions of emissions and tags must match, '</span></span><br><span class="line">                    <span class="string">f'got <span class="subst">&#123;tuple(emissions.shape[:<span class="number">2</span>])&#125;</span> and <span class="subst">&#123;tuple(tags.shape)&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> emissions.shape[:<span class="number">2</span>] != mask.shape:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(</span><br><span class="line">                    <span class="string">'the first two dimensions of emissions and mask must match, '</span></span><br><span class="line">                    <span class="string">f'got <span class="subst">&#123;tuple(emissions.shape[:<span class="number">2</span>])&#125;</span> and <span class="subst">&#123;tuple(mask.shape)&#125;</span>'</span>)</span><br><span class="line">            no_empty_seq = <span class="keyword">not</span> self.batch_first <span class="keyword">and</span> mask[<span class="number">0</span>].all()</span><br><span class="line">            no_empty_seq_bf = self.batch_first <span class="keyword">and</span> mask[:, <span class="number">0</span>].all()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> no_empty_seq <span class="keyword">and</span> <span class="keyword">not</span> no_empty_seq_bf:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">'mask of the first timestep must all be on'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_compute_score</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            self, emissions: torch.Tensor, tags: torch.LongTensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            mask: torch.ByteTensor)</span> -&gt; torch.Tensor:</span></span><br><span class="line">        <span class="comment"># emissions: (seq_length, batch_size, num_tags)</span></span><br><span class="line">        <span class="comment"># tags: (seq_length, batch_size)</span></span><br><span class="line">        <span class="comment"># mask: (seq_length, batch_size)</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.dim() == <span class="number">3</span> <span class="keyword">and</span> tags.dim() == <span class="number">2</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.shape[:<span class="number">2</span>] == tags.shape</span><br><span class="line">        <span class="keyword">assert</span> emissions.size(<span class="number">2</span>) == self.num_tags</span><br><span class="line">        <span class="keyword">assert</span> mask.shape == tags.shape</span><br><span class="line">        <span class="keyword">assert</span> mask[<span class="number">0</span>].all()</span><br><span class="line"></span><br><span class="line">        seq_length, batch_size = tags.shape</span><br><span class="line">        mask = mask.type_as(emissions)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Start transition score and first emission</span></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        score = self.start_transitions[tags[<span class="number">0</span>]]</span><br><span class="line">        score += emissions[<span class="number">0</span>, torch.arange(batch_size), tags[<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, seq_length):</span><br><span class="line">            <span class="comment"># Transition score to next tag, only added if next timestep is valid (mask == 1)</span></span><br><span class="line">            <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">            score += self.transitions[tags[i - <span class="number">1</span>], tags[i]] * mask[i]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Emission score for next tag, only added if next timestep is valid (mask == 1)</span></span><br><span class="line">            <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">            score += emissions[i, torch.arange(batch_size), tags[i]] * mask[i]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># End transition score</span></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        seq_ends = mask.long().sum(dim=<span class="number">0</span>) - <span class="number">1</span></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        last_tags = tags[seq_ends, torch.arange(batch_size)]</span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        score += self.end_transitions[last_tags]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_compute_normalizer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            self, emissions: torch.Tensor, mask: torch.ByteTensor)</span> -&gt; torch.Tensor:</span></span><br><span class="line">        <span class="comment"># emissions: (seq_length, batch_size, num_tags)</span></span><br><span class="line">        <span class="comment"># mask: (seq_length, batch_size)</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.dim() == <span class="number">3</span> <span class="keyword">and</span> mask.dim() == <span class="number">2</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.shape[:<span class="number">2</span>] == mask.shape</span><br><span class="line">        <span class="keyword">assert</span> emissions.size(<span class="number">2</span>) == self.num_tags</span><br><span class="line">        <span class="keyword">assert</span> mask[<span class="number">0</span>].all()</span><br><span class="line"></span><br><span class="line">        seq_length = emissions.size(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Start transition score and first emission; score has size of</span></span><br><span class="line">        <span class="comment"># (batch_size, num_tags) where for each batch, the j-th column stores</span></span><br><span class="line">        <span class="comment"># the score that the first timestep has tag j</span></span><br><span class="line">        <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">        score = self.start_transitions + emissions[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, seq_length):</span><br><span class="line">            <span class="comment"># Broadcast score for every possible next tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags, 1)</span></span><br><span class="line">            broadcast_score = score.unsqueeze(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Broadcast emission score for every possible current tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, 1, num_tags)</span></span><br><span class="line">            broadcast_emissions = emissions[i].unsqueeze(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Compute the score tensor of size (batch_size, num_tags, num_tags) where</span></span><br><span class="line">            <span class="comment"># for each sample, entry at row i and column j stores the sum of scores of all</span></span><br><span class="line">            <span class="comment"># possible tag sequences so far that end with transitioning from tag i to tag j</span></span><br><span class="line">            <span class="comment"># and emitting</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags, num_tags)</span></span><br><span class="line">            next_score = broadcast_score + self.transitions + broadcast_emissions</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Sum over all possible current tags, but we're in score space, so a sum</span></span><br><span class="line">            <span class="comment"># becomes a log-sum-exp: for each sample, entry i stores the sum of scores of</span></span><br><span class="line">            <span class="comment"># all possible tag sequences so far, that end in tag i</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">            next_score = torch.logsumexp(next_score, dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Set score to the next score if this timestep is valid (mask == 1)</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">            score = torch.where(mask[i].unsqueeze(<span class="number">1</span>), next_score, score)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># End transition score</span></span><br><span class="line">        <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">        score += self.end_transitions</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Sum (log-sum-exp) over all possible tags</span></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        <span class="keyword">return</span> torch.logsumexp(score, dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_viterbi_decode</span><span class="params">(self, emissions: torch.FloatTensor,</span></span></span><br><span class="line"><span class="function"><span class="params">                        mask: torch.ByteTensor)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        <span class="comment"># emissions: (seq_length, batch_size, num_tags)</span></span><br><span class="line">        <span class="comment"># mask: (seq_length, batch_size)</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.dim() == <span class="number">3</span> <span class="keyword">and</span> mask.dim() == <span class="number">2</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.shape[:<span class="number">2</span>] == mask.shape</span><br><span class="line">        <span class="keyword">assert</span> emissions.size(<span class="number">2</span>) == self.num_tags</span><br><span class="line">        <span class="keyword">assert</span> mask[<span class="number">0</span>].all()</span><br><span class="line"></span><br><span class="line">        seq_length, batch_size = mask.shape</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Start transition and first emission</span></span><br><span class="line">        <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">        score = self.start_transitions + emissions[<span class="number">0</span>]</span><br><span class="line">        history = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># score is a tensor of size (batch_size, num_tags) where for every batch,</span></span><br><span class="line">        <span class="comment"># value at column j stores the score of the best tag sequence so far that ends</span></span><br><span class="line">        <span class="comment"># with tag j</span></span><br><span class="line">        <span class="comment"># history saves where the best tags candidate transitioned from; this is used</span></span><br><span class="line">        <span class="comment"># when we trace back the best tag sequence</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Viterbi algorithm recursive case: we compute the score of the best tag sequence</span></span><br><span class="line">        <span class="comment"># for every possible next tag</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, seq_length):</span><br><span class="line">            <span class="comment"># Broadcast viterbi score for every possible next tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags, 1)</span></span><br><span class="line">            broadcast_score = score.unsqueeze(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Broadcast emission score for every possible current tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, 1, num_tags)</span></span><br><span class="line">            broadcast_emission = emissions[i].unsqueeze(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Compute the score tensor of size (batch_size, num_tags, num_tags) where</span></span><br><span class="line">            <span class="comment"># for each sample, entry at row i and column j stores the score of the best</span></span><br><span class="line">            <span class="comment"># tag sequence so far that ends with transitioning from tag i to tag j and emitting</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags, num_tags)</span></span><br><span class="line">            next_score = broadcast_score + self.transitions + broadcast_emission</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Find the maximum score over all possible current tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">            next_score, indices = next_score.max(dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Set score to the next score if this timestep is valid (mask == 1)</span></span><br><span class="line">            <span class="comment"># and save the index that produces the next score</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">            score = torch.where(mask[i].unsqueeze(<span class="number">1</span>), next_score, score)</span><br><span class="line">            history.append(indices)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># End transition score</span></span><br><span class="line">        <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">        score += self.end_transitions</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Now, compute the best path for each sample</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        seq_ends = mask.long().sum(dim=<span class="number">0</span>) - <span class="number">1</span></span><br><span class="line">        best_tags_list = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> idx <span class="keyword">in</span> range(batch_size):</span><br><span class="line">            <span class="comment"># Find the tag which maximizes the score at the last timestep; this is our best tag</span></span><br><span class="line">            <span class="comment"># for the last timestep</span></span><br><span class="line">            _, best_last_tag = score[idx].max(dim=<span class="number">0</span>)</span><br><span class="line">            best_tags = [best_last_tag.item()]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># We trace back where the best last tag comes from, append that to our best tag</span></span><br><span class="line">            <span class="comment"># sequence, and trace it back again, and so on</span></span><br><span class="line">            <span class="keyword">for</span> hist <span class="keyword">in</span> reversed(history[:seq_ends[idx]]):</span><br><span class="line">                best_last_tag = hist[idx][best_tags[<span class="number">-1</span>]]</span><br><span class="line">                best_tags.append(best_last_tag.item())</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Reverse the order because we start from the last timestep</span></span><br><span class="line">            best_tags.reverse()</span><br><span class="line">            best_tags_list.append(best_tags)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> best_tags_list</span><br></pre></td></tr></table></figure>
<h4 id="é€å¸§-softmax-å’Œ-CRF-çš„å¼‚åŒ"><a href="#é€å¸§-softmax-å’Œ-CRF-çš„å¼‚åŒ" class="headerlink" title="é€å¸§ softmax å’Œ CRF çš„å¼‚åŒ?"></a>é€å¸§ softmax å’Œ CRF çš„å¼‚åŒ?</h4><p><strong>é€å¸§softmax</strong></p>
<p>CRF ä¸»è¦ç”¨äºåºåˆ—æ ‡æ³¨é—®é¢˜ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºæ˜¯<strong>ç»™åºåˆ—ä¸­çš„æ¯ä¸€å¸§éƒ½è¿›è¡Œåˆ†ç±»</strong>ï¼Œæ—¢ç„¶æ˜¯åˆ†ç±»ï¼Œå¾ˆè‡ªç„¶æƒ³åˆ°å°†è¿™ä¸ªåºåˆ—ç”¨ CNN æˆ–è€… RNN è¿›è¡Œç¼–ç åï¼Œæ¥ä¸€ä¸ªå…¨è¿æ¥å±‚ç”¨ softmax æ¿€æ´»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/encoder.png" alt="avatar"></p>
<p>ç„¶è€Œï¼Œ<strong>é€å¸§softmaxå¹¶æ²¡æœ‰ç›´æ¥è€ƒè™‘è¾“å‡ºçš„ä¸Šä¸‹æ–‡å…³è”</strong>ã€‚æ¯”å¦‚ï¼šå½“æˆ‘ä»¬è®¾è®¡æ ‡ç­¾æ—¶ï¼Œæ¯”å¦‚ç”¨ sã€bã€mã€e çš„ 4 ä¸ªæ ‡ç­¾æ¥åšå­—æ ‡æ³¨æ³•çš„åˆ†è¯ï¼Œç›®æ ‡è¾“å‡ºåºåˆ—æœ¬èº«ä¼šå¸¦æœ‰ä¸€äº›ä¸Šä¸‹æ–‡å…³è”ï¼Œå¦‚ s åé¢å°±ä¸èƒ½æ¥ m å’Œ eï¼Œç­‰ç­‰ã€‚é€æ ‡ç­¾ softmax å¹¶æ²¡æœ‰è€ƒè™‘è¿™ç§è¾“å‡ºå±‚é¢çš„ä¸Šä¸‹æ–‡å…³è”ï¼Œæ‰€ä»¥å®ƒæ„å‘³ç€æŠŠè¿™äº›å…³è”æ”¾åˆ°äº†ç¼–ç å±‚é¢ï¼Œå¸Œæœ›æ¨¡å‹èƒ½è‡ªå·±å­¦åˆ°è¿™äº›å†…å®¹ï¼Œä½†æœ‰æ—¶å€™ä¼šâ€œå¼ºæ¨¡å‹æ‰€éš¾â€ã€‚ </p>
<p>è€Œ CRF åˆ™æ›´ç›´æ¥ä¸€ç‚¹ï¼Œå®ƒ<strong>å°†è¾“å‡ºå±‚é¢çš„å…³è”åˆ†ç¦»äº†å‡ºæ¥</strong>ï¼Œè¿™ä½¿å¾—æ¨¡å‹åœ¨å­¦ä¹ ä¸Šæ›´ä¸ºâ€œä»å®¹â€,CRFåœ¨è¾“å‡ºç«¯æ˜¾å¼åœ°è€ƒè™‘äº†ä¸Šä¸‹æ–‡å…³è”.</p>
<p><img src="/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/encoder-crf.png" alt="avatar"></p>
<p>å¦‚æœä»…ä»…æ˜¯å¼•å…¥è¾“å‡ºçš„å…³è”ï¼Œè¿˜ä¸ä»…ä»…æ˜¯ CRF çš„å…¨éƒ¨ï¼ŒCRF çš„çœŸæ­£ç²¾å·§çš„åœ°æ–¹ï¼Œæ˜¯å®ƒä»¥è·¯å¾„ä¸ºå•ä½ï¼Œè€ƒè™‘çš„æ˜¯è·¯å¾„çš„æ¦‚ç‡ã€‚ </p>
<p>å‡å¦‚ä¸€ä¸ªè¾“å…¥æœ‰ n å¸§ï¼Œæ¯ä¸€å¸§çš„æ ‡ç­¾æœ‰ k ä¸­å¯èƒ½æ€§ï¼Œé‚£ä¹ˆç†è®ºä¸Šå°±æœ‰$k^n$ä¸­ä¸åŒçš„è¾“å…¥ã€‚æˆ‘ä»¬å°†å®ƒç”¨å¦‚ä¸‹çš„ç½‘ç»œå›¾è¿›è¡Œç®€å•çš„å¯è§†åŒ–ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œæ¯ä¸ªç‚¹ä»£è¡¨ä¸€ä¸ªæ ‡ç­¾çš„å¯èƒ½æ€§ï¼Œç‚¹ä¹‹é—´çš„è¿çº¿è¡¨ç¤ºæ ‡ç­¾ä¹‹é—´çš„å…³è”ï¼Œè€Œæ¯ä¸€ç§æ ‡æ³¨ç»“æœï¼Œéƒ½å¯¹åº”ç€å›¾ä¸Šçš„ä¸€æ¡å®Œæ•´çš„è·¯å¾„ã€‚</p>
<p><img src="/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/crf-v.png" alt="avatar"></p>
<p>è€Œåœ¨åºåˆ—æ ‡æ³¨ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬çš„æ­£ç¡®ç­”æ¡ˆæ˜¯ä¸€èˆ¬æ˜¯å”¯ä¸€çš„ã€‚æ¯”å¦‚â€œä»Šå¤©å¤©æ°”ä¸é”™â€ï¼Œå¦‚æœå¯¹åº”çš„åˆ†è¯ç»“æœæ˜¯â€œä»Šå¤©/å¤©æ°”/ä¸/é”™â€ï¼Œé‚£ä¹ˆç›®æ ‡è¾“å‡ºåºåˆ—å°±æ˜¯ bebessï¼Œé™¤æ­¤ä¹‹å¤–åˆ«çš„è·¯å¾„éƒ½ä¸ç¬¦åˆè¦æ±‚ã€‚</p>
<p>æ¢è¨€ä¹‹ï¼Œåœ¨åºåˆ—æ ‡æ³¨ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬çš„ç ”ç©¶çš„åŸºæœ¬å•ä½åº”è¯¥æ˜¯è·¯å¾„ï¼Œæˆ‘ä»¬è¦åšçš„äº‹æƒ…ï¼Œæ˜¯ä» $k^n$ æ¡è·¯å¾„é€‰å‡ºæ­£ç¡®çš„ä¸€æ¡ï¼Œé‚£å°±æ„å‘³ç€ï¼Œå¦‚æœå°†å®ƒè§†ä¸ºä¸€ä¸ªåˆ†ç±»é—®é¢˜ï¼Œé‚£ä¹ˆå°†æ˜¯ $k^n$ ç±»ä¸­é€‰ä¸€ç±»çš„åˆ†ç±»é—®é¢˜ã€‚</p>
<p>è¿™å°±æ˜¯é€å¸§ softmax å’Œ CRF çš„æ ¹æœ¬ä¸åŒäº†ï¼š<strong>å‰è€…å°†åºåˆ—æ ‡æ³¨çœ‹æˆæ˜¯ n ä¸ª k åˆ†ç±»é—®é¢˜ï¼Œåè€…å°†åºåˆ—æ ‡æ³¨çœ‹æˆæ˜¯ 1 ä¸ª$ k^n$ åˆ†ç±»é—®é¢˜</strong>ã€‚</p>
<h4 id="CRF"><a href="#CRF" class="headerlink" title="CRF++"></a>CRF++</h4><h5 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h5><p>CRF++ æ˜¯C++ å®ç°çš„CRF å·¥å…·ã€‚</p>
<p><a href="https://taku910.github.io/crfpp/" target="_blank" rel="noopener">æ–‡æ¡£</a></p>
<h5 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/taku910/crfpp.git</span><br><span class="line">cd crfpp</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>å¦‚æœmakeçš„æ—¶å€™å‘ç”Ÿæ‰¾ä¸åˆ°winmain.hçš„é”™è¯¯: å¯ä»¥ä¸‹é¢è¿™ç§æ–¹å¼ä¿®å¤ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">'/#include "winmain.h"/d'</span> crf_test.cpp</span><br><span class="line">sed -i <span class="string">'/#include "winmain.h"/d'</span> crf_learn.cpp</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>åé¢éœ€è¦ç”¨åˆ°Python ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹æ‰€ä»¥ä¹Ÿä¸€èµ·å®‰è£…CRFPP, cd python ç›®å½•ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cd python</span><br><span class="line">python setup.py build</span><br><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨Python æˆ–è€…Ipython é‡Œè¾“å…¥ <code>import CRFPP</code> å¦‚æœå‘ç”Ÿå¦‚ä¸‹é”™è¯¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ImportError: libcrfpp.so<span class="number">.0</span>: cannot open shared object file: No such file <span class="keyword">or</span> directory</span><br></pre></td></tr></table></figure>
<p>å¯ç”¨ä¸‹é¢çš„æ–¹æ³•è§£å†³</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/ld.so.conf</span><br><span class="line"><span class="comment"># æ·»åŠ </span></span><br><span class="line">include /usr/local/lib</span><br><span class="line"><span class="comment"># ä¿å­˜ååŠ è½½ä¸€ä¸‹</span></span><br><span class="line">sudo /sbin/ldconfig -v</span><br></pre></td></tr></table></figure>
<h5 id="è®­ç»ƒæ•°æ®æ ¼å¼"><a href="#è®­ç»ƒæ•°æ®æ ¼å¼" class="headerlink" title="è®­ç»ƒæ•°æ®æ ¼å¼"></a>è®­ç»ƒæ•°æ®æ ¼å¼</h5><p>å¯¹äºè®­ç»ƒæ•°æ®ï¼Œé¦–å…ˆéœ€è¦å¤šåˆ—ï¼Œä½†ä¸èƒ½ä¸ä¸€è‡´ï¼Œæ—¢åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œæœ‰çš„è¡Œæ˜¯ä¸¤åˆ—ï¼Œæœ‰çš„è¡Œæ˜¯ä¸‰åˆ—ï¼ˆè¿™ç§æ ¼å¼æ˜¯é”™è¯¯çš„ï¼‰ï¼›å…¶æ¬¡ç¬¬ä¸€åˆ—ä»£è¡¨çš„æ˜¯éœ€è¦æ ‡æ³¨çš„<strong>å­—æˆ–è¯</strong>ï¼Œæœ€åä¸€åˆ—æ˜¯è¾“å‡ºä½æ ‡è®°tagï¼Œ\å¦‚æœæœ‰é¢å¤–çš„ç‰¹å¾ï¼Œä¾‹å¦‚è¯æ€§ä»€ä¹ˆçš„ï¼Œå¯ä»¥åŠ åˆ°ä¸­é—´åˆ—é‡Œï¼Œæ‰€ä»¥è®­ç»ƒé›†æˆ–è€…æµ‹è¯•é›†çš„æ–‡ä»¶æœ€å°‘è¦æœ‰ä¸¤åˆ—ã€‚ä»¥åˆ†è¯ä¸¾ä¾‹ï¼Œæ ‡ç­¾ä¸ºBMES</p>
<p>ä¸œ    N    B<br>å—    N    M<br>å¤§    N    M<br>å­¦    N    E<br>æ¬¢    V    B<br>è¿    V    E<br>æ‚¨    N    S</p>
<p>å…¶ä¸­ç¬¬3åˆ—æ˜¯æ ‡ç­¾ï¼Œä¹Ÿæ˜¯æµ‹è¯•æ–‡ä»¶ä¸­éœ€è¦é¢„æµ‹çš„ç»“æœï¼Œæœ‰BMES 4ç§çŠ¶æ€ã€‚ç¬¬äºŒåˆ—æ˜¯è¯æ€§ï¼Œä¸æ˜¯å¿…é¡»çš„ã€‚</p>
<h5 id="ç‰¹å¾æ¨¡æ¿"><a href="#ç‰¹å¾æ¨¡æ¿" class="headerlink" title="ç‰¹å¾æ¨¡æ¿"></a>ç‰¹å¾æ¨¡æ¿</h5><p>æ¯ä¸€è¡Œæ¨¡æ¿ç”Ÿæˆä¸€ç»„çŠ¶æ€ç‰¹å¾å‡½æ•°ï¼Œæ•°é‡æ˜¯$L<em>N$ ä¸ªï¼Œ$L$æ˜¯æ ‡ç­¾çŠ¶æ€æ•°æ˜¯4ä¸ªã€‚$N$æ˜¯æ­¤è¡Œæ¨¡æ¿åœ¨è®­ç»ƒé›†ä¸Šå±•å¼€åçš„å”¯ä¸€æ ·æœ¬æ•°ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€åˆ—çš„å”¯ä¸€å­—æ•°æ˜¯7ä¸ªï¼Œæ‰€ä»¥æœ‰$L</em>N = 4*7=28$ã€‚ä¾‹å¦‚ï¼šU01:%x[0,0]ï¼Œç”Ÿæˆå¦‚ä¸‹28ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">func1 = <span class="keyword">if</span> (output = B and feature=U01:<span class="string">"ä¸œ"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func2 = <span class="keyword">if</span> (output = M and feature=U01:<span class="string">"ä¸œ"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func3 = <span class="keyword">if</span> (output = E and feature=U01:<span class="string">"ä¸œ"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func4 = <span class="keyword">if</span> (output = S and feature=U01:<span class="string">"ä¸œ"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func5 = <span class="keyword">if</span> (output = B and feature=U01:<span class="string">"å—"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">...</span><br><span class="line">func25 = <span class="keyword">if</span> (output = B and feature=U01:<span class="string">"ä½ "</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func26 = <span class="keyword">if</span> (output = M and feature=U01:<span class="string">"ä½ "</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func27 = <span class="keyword">if</span> (output = E and feature=U01:<span class="string">"ä½ "</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func28 = <span class="keyword">if</span> (output = S and feature=U01:<span class="string">"ä½ "</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>è¿™äº›å‡½æ•°ç»è¿‡è®­ç»ƒåï¼Œå…¶æƒå€¼è¡¨ç¤ºå‡½æ•°å†…æ–‡å­—å¯¹åº”è¯¥æ ‡ç­¾çš„æ¦‚ç‡ï¼ˆå½¢è±¡è¯´æ³•ï¼Œæ¦‚ç‡å’Œå¯å¤§äº1ï¼‰ã€‚</p>
<h6 id="unigram"><a href="#unigram" class="headerlink" title="unigram"></a>unigram</h6><p>U00:%x[-2,0]<br>U01:%x[-1,0]<br>U02:%x[0,0]<br>U03:%x[1,0]<br>U04:%x[2,0]<br>U05:%x[-2,0]/%x[-1,0]/%x[0,0]<br>U06:%x[-1,0]/%x[0,0]/%x[1,0]<br>U07:%x[0,0]/%x[1,0]/%x[2,0]<br>U08:%x[-1,0]/%x[0,0]<br>U09:%x[0,0]/%x[1,0] </p>
<p>è¿™æ˜¯CRF++ä¾‹å­ä¸­ç»™å‡ºçš„æ¨¡æ¿ï¼Œä¸€å…±æœ‰ï¼™ä¸ªæ¨¡æ¿ï¼Œå…ˆçœ‹ç¬¬ä¸€ä¸ªæ¨¡æ¿ï¼Œè¡¨ç¤ºå½“å‰è¯å’Œå‰é¢çš„ç¬¬äºŒä¸ªè¯ç»„æˆçš„ç‰¹å¾ï¼Œä»¥â€˜å°æ˜ä»Šå¤©ç©¿äº†ä¸€ä»¶çº¢è‰²ä¸Šè¡£â€™ä¸ºä¾‹ï¼Œç¬¦åˆCRF++å¤„ç†æ ¼å¼çš„è¿™å¥è¯åº”è¯¥å˜æˆå¦‚ä¸‹å½¢å¼ï¼š<br>å°ã€€ï¼¢<br>æ˜ã€€ï¼©<br>ä»Šã€€ï¼¢   &lt;â€” current word<br>å¤©ã€€ï¼©<br>ç©¿ã€€ï¼³<br>äº†ã€€ï¼³<br>ä¸€ã€€ï¼¢<br>ä»¶ã€€ï¼©<br>çº¢ã€€ï¼¢<br>è‰²ã€€ï¼©<br>ä¸Šã€€ï¼¢<br>è¡£ã€€ï¼©<br>å‡è®¾æˆ‘ä»¬æœ‰ä¸‰ä¸ªæ ‡è®°tagï¼Œï¼¢ï¼ˆè¡¨ç¤ºä¸€ä¸ªè¯çš„å¼€å¤´é‚£ä¸ªå­—ï¼‰ï¼Œï¼©ï¼ˆè¡¨ç¤ºä¸€ä¸ªè¯çš„ç»“å°¾é‚£ä¸ªå­—ï¼‰ï¼Œï¼³ï¼ˆè¡¨ç¤ºå•ä¸ªå­—çš„è¯ï¼‰ï¼Œå…ˆçœ‹ç¬¬ä¸€ä¸ªæ¨¡æ¿ï¼µ00:%x[-2,0],ç¬¬ä¸€ä¸ªæ¨¡æ¿äº§ç”Ÿçš„ç‰¹å¾å¦‚ä¸‹ï¼š å¦‚æœå½“å‰è¯æ˜¯â€˜ä»Šâ€™ï¼Œé‚£-2ä½ç½®å¯¹åº”çš„å­—å°±æ˜¯â€˜å°â€™ï¼Œ æ¯ä¸ªç‰¹å¾å¯¹åº”çš„å­—å¦‚ä¸‹ï¼š </p>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç‰¹å¾æ¨¡æ¿</th>
<th>æ„ä¹‰</th>
<th>ä»£è¡¨ç‰¹å¾</th>
</tr>
</thead>
<tbody>
<tr>
<td>U00:%x[-2,0]</td>
<td>-2è¡Œï¼Œ0åˆ—</td>
<td>å°</td>
</tr>
<tr>
<td>U01:%x[-1,0]</td>
<td>-1è¡Œï¼Œ0åˆ—</td>
<td>æ˜</td>
</tr>
<tr>
<td>U02:%x[0,0]</td>
<td>0è¡Œï¼Œ0åˆ—</td>
<td>ä»Š</td>
</tr>
<tr>
<td>U03:%x[1,0]</td>
<td>1è¡Œï¼Œ0åˆ—</td>
<td>å¤©</td>
</tr>
<tr>
<td>U04:%x[2,0]</td>
<td>2è¡Œï¼Œ0åˆ—</td>
<td>ç©¿</td>
</tr>
<tr>
<td>U05:%x[-2,0]/%x[-1,0]/%x[0,0]</td>
<td>-2è¡Œ0åˆ—ã€-1è¡Œ0åˆ—ä¸0è¡Œ0åˆ—çš„ç»„åˆ</td>
<td>å°/æ˜/ä»Š</td>
</tr>
<tr>
<td>U06:%x[-1,0]/%x[0,0]/%x[1,0]</td>
<td>-1è¡Œ0åˆ—ã€0è¡Œ0åˆ—ä¸1è¡Œ0åˆ—çš„ç»„åˆ</td>
<td>æ˜/ä»Š/å¤©</td>
</tr>
<tr>
<td>U07:%x[0,0]/%x[1,0]/%x[2,0]</td>
<td>0è¡Œ0åˆ—ã€1è¡Œ0åˆ—ä¸2è¡Œ0åˆ—çš„ç»„åˆ</td>
<td>ä»Š/å¤©/ç©¿</td>
</tr>
<tr>
<td>U08:%x[-1,0]/%x[0,0]</td>
<td>-1è¡Œ0åˆ—ä¸0è¡Œ0åˆ—çš„ç»„åˆ</td>
<td>æ˜/ä»Š</td>
</tr>
<tr>
<td>U09:%x[0,0]/%x[1,0]</td>
<td>0è¡Œ0åˆ—ä¸1è¡Œ0åˆ—çš„ç»„åˆ</td>
<td>ä»Š/å¤©</td>
</tr>
</tbody>
</table>
</div>
<p>æ ¹æ®ç¬¬ä¸€ä¸ªæ¨¡æ¿U00:%x[-2,0]èƒ½å¾—åˆ°çš„è½¬ç§»ç‰¹å¾å‡½æ•°å¦‚ä¸‹ï¼š<br><code>func1=if(output=B and feature=&#39;U00:å°&#39; )ã€€return 1 else return 0</code><br>å…¶ä¸­output=B æŒ‡çš„æ˜¯å½“å‰è¯ï¼ˆå­—ï¼‰çš„é¢„æµ‹æ ‡è®°ï¼Œä¹Ÿå°±æ˜¯â€™ä»Šâ€˜çš„é¢„æµ‹æ ‡è®°ï¼Œæ¯ä¸ªæ¨¡æ¿ä¼šæŠŠæ‰€æœ‰å¯èƒ½çš„æ ‡è®°è¾“å‡ºéƒ½åˆ—ä¸€éï¼Œç„¶åé€šè¿‡è®­ç»ƒç¡®å®šæ¯ç§æ ‡è®°çš„æƒé‡ï¼Œåˆç†çš„æ ‡è®°åœ¨è®­ç»ƒæ ·æœ¬ä¸­å‡ºç°çš„æ¬¡æ•°å¤šï¼Œå¯¹åº”çš„æƒé‡å°±é«˜ï¼Œä¸åˆç†çš„æ ‡è®°åœ¨è®­ç»ƒæ ·æœ¬ä¸­å‡ºç°çš„å°‘ï¼Œå¯¹åº”çš„æƒé‡å°±å°‘ï¼Œä½†æ˜¯åœ¨åˆ©ç”¨æ¨¡æ¿ç”Ÿæˆè½¬ç§»ç‰¹å¾å‡½æ•°æ˜¯ä¼šæŠŠæ‰€æœ‰å¯èƒ½çš„ç‰¹å¾å‡½æ•°éƒ½åˆ—å‡ºæ¥ï¼Œç”±æ¨¡å‹é€šè¿‡è®­ç»ƒå†³å®šæ¯ä¸ªç‰¹å¾çš„é‡è¦ç¨‹åº¦ã€‚<br><code>func2=if(output=M and feature=â€™U00:å°â€™) return 1 else return 0</code><br><code>func3=if(output=E and feature=â€™U00:å°â€™) return 1 else return 0</code><br><code>func4=if(output=S and feature=â€™U00:å°) return 1 else return 0</code><br>å¾—åˆ°4ä¸ªç‰¹å¾å‡½æ•°ä¹‹åå½“å‰è¿™ä¸ªå­—â€™ä»Šâ€˜çš„ç‰¹å¾å‡½æ•°åˆ©ç”¨ç¬¬ä¸€ä¸ªæ¨¡æ¿å°±å¾—åˆ°å…¨éƒ¨äº†ï¼Œç„¶åæ‰«æä¸‹ä¸€ä¸ªå­—â€˜å¤©â€˜ï¼Œä»¥â€™å¤©â€˜å­—ä½œä¸ºå½“å‰å­—é¢„æµ‹è¿™ä¸ªå­—çš„æ ‡è®°tag,åŒæ ·ä¼šå¾—åˆ°4ä¸ªç‰¹å¾å‡½æ•°ï¼š<br><code>func5=if(output=B and feature=â€™U00:æ˜â€™) return 1 else return 0</code><br><code>func6=if(output=M and feature=â€™U00:æ˜â€™) return 1 else return 0</code><br><code>func7=if(output=E and feature=â€™U00:æ˜â€™) return 1 else return 0</code><br><code>func7=if(output=S and feature=â€™U00:æ˜â€™) return 1 else return 0</code><br>ç‰¹å¾å‡½æ•°ä¸­çš„featureæŒ‡çš„æ˜¯å½“å‰è¯çš„-2ä½ç½®å¯¹åº”çš„è¯æˆ–å¯¹åº”çš„è¯çš„ç‰¹å¾ï¼Œå› ä¸ºåœ¨è¿™é‡Œæ²¡æœ‰å…¶ä»–ç‰¹å¾äº†ï¼Œæ‰€ä»¥ç”¨å­—æœ¬èº«åšç‰¹å¾ï¼Œæœ‰çš„ä¼šæœ‰è¯æ€§ï¼Œé‚£featureå°±ä¼šæ˜¯â€™æ˜â€˜è¿™ä¸ªå­—å¯¹åº”çš„è¯æ€§è€Œä¸æ˜¯å­—æœ¬èº«äº†ã€‚ è¿™ä¸ªfeatureçš„ä½œç”¨å°±æ˜¯ç¡®å®šæ¨¡æ¿æ‰€ç¡®å®šçš„å½“å‰è¯å’Œä¸´è¿‘è¯</p>
<h6 id="bigram"><a href="#bigram" class="headerlink" title="bigram"></a>bigram</h6><p>ä¸Unigramä¸åŒçš„æ˜¯ï¼ŒBigramç±»å‹æ¨¡æ¿ç”Ÿæˆçš„å‡½æ•°ä¼šå¤šä¸€ä¸ªå‚æ•°ï¼šä¸Šä¸ªèŠ‚ç‚¹çš„æ ‡ç­¾ $y_{i-1}$ã€‚ç”Ÿæˆå‡½B01:%x[0,0] (å½“å‰è¯ä¸ºâ€œä¸œå—å¤§å­¦æ¬¢è¿æ‚¨â€ çš„â€œæ‚¨â€)ï¼š<code>func1 = if (prev_output = E and output = S and feature=B01:&quot;æ‚¨&quot;) return 1 else return 0</code></p>
<p>è¿™æ ·ï¼Œæ¯è¡Œæ¨¡æ¿åˆ™ä¼šç”Ÿæˆ $L<em>L</em>N$ ä¸ªç‰¹å¾å‡½æ•°ã€‚ç»è¿‡è®­ç»ƒåï¼Œè¿™äº›å‡½æ•°çš„æƒå€¼åæ˜ äº†ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„æ ‡ç­¾å¯¹å½“å‰èŠ‚ç‚¹çš„å½±å“ã€‚(Lè¡¨ç¤ºéšçŠ¶æ€çš„ä¸ªæ•°ï¼Œå¦‚BMESä¸ºå››ä¸ªéšçŠ¶æ€ï¼ŒNè¡¨ç¤ºè®­ç»ƒè¯­æ–™çš„å¤§å°ã€‚)</p>
<p>trigamç†è®ºä¸Šä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œè€ƒè™‘å‰$y_{i-2},y_{i-1}$å¯¹$y_i$çš„å½±å“ï¼Œä¸è¿‡crf++å¹¶æ²¡æœ‰å®ç°ï¼Œè¿™å®é™…å’ŒäºŒé˜¶HMMæ¨¡å‹ç±»ä¼¼çš„ï¼Œæœ‰è®ºæ–‡è¯¦ç»†æè¿°è¿‡å…¶æ±‚è§£ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œä½†æ˜¯å…¶æ•ˆæœæå‡å¹¶æœªå¤šå¤§ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä½¿ç”¨ã€‚</p>
<h6 id="äº§ç”Ÿç‰¹å¾å‡½æ•°"><a href="#äº§ç”Ÿç‰¹å¾å‡½æ•°" class="headerlink" title="äº§ç”Ÿç‰¹å¾å‡½æ•°"></a>äº§ç”Ÿç‰¹å¾å‡½æ•°</h6><p>è®­ç»ƒé˜¶æ®µå°†éå†æ•°æ®é€ä¸€äº§ç”Ÿç‰¹å¾å‡½æ•°ï¼Œå†™æˆä¼ªç è¿‡ç¨‹ä¸ºï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">mï¼šæ ·æœ¬ä¸ªæ•°</span><br><span class="line">kï¼šæ¨¡æ¿ä¸ªæ•°</span><br><span class="line">templatesï¼šä¸€ç»„ç‰¹å¾æ¨¡æ¿</span><br><span class="line">genFeatureFuncï¼šæ ¹æ®æ¨¡æ¿å’Œåºåˆ—xï¼Œyå’Œä½ç½®iäº§ç”Ÿç‰¹å¾å‡½æ•°</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; k; j++)&#123;</span><br><span class="line">        genFeatureFunc(templates[j],x,y,i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="ç‰¹å¾å‡½æ•°"><a href="#ç‰¹å¾å‡½æ•°" class="headerlink" title="ç‰¹å¾å‡½æ•°"></a>ç‰¹å¾å‡½æ•°</h6><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> B</span><br><span class="line"><span class="number">16</span> U00:-</span><br><span class="line"><span class="number">20</span> U00:<span class="number">0</span></span><br><span class="line"><span class="number">24</span> U00:<span class="number">1</span></span><br><span class="line"><span class="number">28</span> U00:<span class="number">2</span></span><br><span class="line"><span class="number">32</span> U00:<span class="number">3</span></span><br><span class="line"><span class="number">36</span> U00:<span class="number">4</span></span><br><span class="line"><span class="number">40</span> U00:<span class="number">5</span></span><br><span class="line"><span class="number">44</span> U00:<span class="number">6</span></span><br><span class="line"><span class="number">48</span> U00:<span class="number">7</span></span><br><span class="line"><span class="number">52</span> U00:<span class="number">8</span></span><br><span class="line"><span class="number">56</span> U00:<span class="number">9</span></span><br><span class="line"><span class="number">60</span> U00:_B<span class="number">-1</span></span><br><span class="line"><span class="number">64</span> U00:_B<span class="number">-2</span></span><br><span class="line">â€¦â€¦</span><br><span class="line"><span class="number">17404</span> U01:å¨</span><br><span class="line"><span class="number">17408</span> U01:å»</span><br><span class="line"><span class="number">17412</span> U01:å¿</span><br><span class="line"><span class="number">17416</span> U01:å‚</span><br><span class="line"><span class="number">17420</span> U01:åˆ</span><br><span class="line"><span class="number">17424</span> U01:å‰</span><br><span class="line"><span class="number">17428</span> U01:åŠ</span><br><span class="line"><span class="number">17432</span> U01:å‹</span><br><span class="line"><span class="number">17436</span> U01:åŒ</span><br><span class="line"><span class="number">17440</span> U01:å</span><br><span class="line"><span class="number">17444</span> U01:å‘</span><br><span class="line"><span class="number">17448</span> U01:å”</span><br><span class="line"><span class="number">17452</span> U01:å–</span><br><span class="line"><span class="number">17456</span> U01:å—</span><br><span class="line">â€¦â€¦</span><br><span class="line"><span class="number">77800</span> U05:_B<span class="number">-1</span>/ä¸€/ä¸ª</span><br><span class="line"><span class="number">107540</span> U05:ä¸€/æ–¹/é¢</span><br><span class="line"><span class="number">107544</span> U05:ä¸€/æ— /æ‰€</span><br><span class="line"><span class="number">107548</span> U05:ä¸€/æ—¥/ä¸‰</span><br><span class="line"><span class="number">107552</span> U05:ä¸€/æ—¥/ä¸º</span><br><span class="line"><span class="number">107556</span> U05:ä¸€/æ—¥/ä¹‹</span><br><span class="line">â€¦â€¦</span><br><span class="line"><span class="number">566536</span> U06:ä¸‡/å¨/_B+<span class="number">1</span></span><br><span class="line">â€¦â€¦</span><br><span class="line"><span class="number">2159864</span> U09:ï½–/ï½…</span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§[id] [å‚æ•°o]çš„æ ¼å¼æ’åˆ—ï¼Œæ³¨æ„åˆ°idä¸æ˜¯è¿ç»­çš„ï¼Œè€Œæ˜¯éš”äº†å››ä¸ªï¼ˆçŠ¶æ€séšè—èµ·æ¥äº†ï¼‰ï¼Œè¿™è¡¨ç¤ºè¿™å››ä¸ªæ ‡ç­¾ï¼ˆBMESï¼‰å’Œå…¬å…±çš„å‚æ•°oç»„åˆæˆäº†å››ä¸ªç‰¹å¾å‡½æ•°ã€‚ç‰¹åˆ«çš„ï¼Œ0-15ä¸ºBEMSè½¬ç§»åˆ°BEMSçš„è½¬ç§»å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯f(sâ€™, s, o=null)ã€‚_B-1è¡¨ç¤ºå¥å­ç¬¬ä¸€ä¸ªå•è¯å‰é¢çš„ä¸€ä¸ªå•è¯ï¼Œ_B+1è¡¨ç¤ºæœ«å°¾åé¢çš„ä¸€ä¸ªå•è¯.</p>
<h6 id="ç‰¹å¾å‡½æ•°æƒå€¼"><a href="#ç‰¹å¾å‡½æ•°æƒå€¼" class="headerlink" title="ç‰¹å¾å‡½æ•°æƒå€¼"></a>ç‰¹å¾å‡½æ•°æƒå€¼</h6><p>åé¢çš„å°æ•°ä¾idé¡ºåºå¯¹åº”æ¯ä¸ªç‰¹å¾å‡½æ•°çš„æƒå€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">9.0491453814148901</span></span><br><span class="line"><span class="number">7.0388286231971700</span></span><br><span class="line"><span class="number">-7.2545558164093009</span></span><br><span class="line"><span class="number">5.2799470769112835</span></span><br><span class="line"><span class="number">-8.5333633546653758</span></span><br><span class="line"><span class="number">-5.3549190735606933</span></span><br><span class="line"><span class="number">5.2575182675282477</span></span><br><span class="line"><span class="number">-5.4259109736696054</span></span><br></pre></td></tr></table></figure>
<p>æ¯”å¦‚è¯´æœ‰ä¸€ä¸ªå¥å­â€œå•†å“å’ŒæœåŠ¡â€ï¼Œå¯¹äºæ¯ä¸ªå­—éƒ½æŒ‰ç…§ä¸Šè¿°æ¨¡æ¿ç”Ÿæˆä¸€ç³»åˆ—Uç‰¹å¾å‡½æ•°çš„å‚æ•°ä»£å…¥ï¼Œå¾—åˆ°ä¸€äº›ç±»ä¼¼010101çš„å‡½æ•°è¿”å›å€¼ï¼Œä¹˜ä¸Šè¿™äº›å‡½æ•°çš„æƒå€¼æ±‚å’Œï¼Œå°±å¾—åˆ°äº†å„ä¸ªæ ‡ç­¾çš„åˆ†æ•°ï¼Œç”±å¤§åˆ°å°ä»£è¡¨è¾“å‡ºè¿™äº›æ ‡ç­¾çš„å¯èƒ½æ€§ã€‚è‡³äºBç‰¹å¾å‡½æ•°ï¼ˆè¿™é‡Œç‰¹æŒ‡ç®€å•çš„f(sâ€™, s)ï¼‰ï¼Œåœ¨Viterbiåå‘è§£ç çš„æ—¶å€™ï¼Œå‰ä¸€ä¸ªæ ‡ç­¾ç¡®å®šäº†åå°±å¯ä»¥ä»£å…¥å½“å‰çš„Bç‰¹å¾å‡½æ•°ï¼Œè®¡ç®—å‡ºæ¯ä¸ªè¾“å‡ºæ ‡ç­¾çš„åˆ†æ•°ï¼Œå†æ¬¡æ±‚å’Œæ’åºå³å¯ã€‚</p>
<h5 id="è®­ç»ƒåŠé¢„æµ‹"><a href="#è®­ç»ƒåŠé¢„æµ‹" class="headerlink" title="è®­ç»ƒåŠé¢„æµ‹"></a>è®­ç»ƒåŠé¢„æµ‹</h5><p>CRF++çš„è®­ç»ƒå‘½ä»¤ä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š<br><code>crf_learn  -f 3 -c 4.0 template train.data model -t</code><br>å…¶ä¸­ï¼Œtemplateä¸ºæ¨¡æ¿æ–‡ä»¶ï¼Œtrain.dataä¸ºè®­ç»ƒè¯­æ–™ï¼Œ-tè¡¨ç¤ºå¯ä»¥å¾—åˆ°ä¸€ä¸ªmodelæ–‡ä»¶å’Œä¸€ä¸ªmodel.txtæ–‡ä»¶ï¼Œå…¶ä»–å¯é€‰å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">-f, â€“freq=INTä½¿ç”¨å±æ€§çš„å‡ºç°æ¬¡æ•°ä¸å°‘äºINT(é»˜è®¤ä¸º<span class="number">1</span>)</span><br><span class="line">-m, â€“maxiter=INTè®¾ç½®INTä¸ºLBFGSçš„æœ€å¤§è¿­ä»£æ¬¡æ•° (é»˜è®¤<span class="number">10</span>k)</span><br><span class="line">-c, â€“cost=FLOAT    è®¾ç½®FLOATä¸ºä»£ä»·å‚æ•°ï¼Œè¿‡å¤§ä¼šè¿‡åº¦æ‹Ÿåˆ (é»˜è®¤<span class="number">1.0</span>)</span><br><span class="line">-e, â€“eta=FLOATè®¾ç½®ç»ˆæ­¢æ ‡å‡†FLOAT(é»˜è®¤<span class="number">0.0001</span>)</span><br><span class="line">-C, â€“convertå°†æ–‡æœ¬æ¨¡å¼è½¬ä¸ºäºŒè¿›åˆ¶æ¨¡å¼</span><br><span class="line">-t, â€“textmodelä¸ºè°ƒè¯•å»ºç«‹æ–‡æœ¬æ¨¡å‹æ–‡ä»¶</span><br><span class="line">-a, â€“algorithm=(CRF|MIRA)    é€‰æ‹©è®­ç»ƒç®—æ³•ï¼Œé»˜è®¤ä¸ºCRF-L2</span><br><span class="line">-p, â€“thread=INTçº¿ç¨‹æ•°(é»˜è®¤<span class="number">1</span>)ï¼Œåˆ©ç”¨å¤šä¸ªCPUå‡å°‘è®­ç»ƒæ—¶é—´</span><br><span class="line">-H, â€“shrinking-size=INT    è®¾ç½®INTä¸ºæœ€é€‚å®œçš„è·Œä»£å˜é‡æ¬¡æ•° (é»˜è®¤<span class="number">20</span>)</span><br><span class="line">-v, â€“versionæ˜¾ç¤ºç‰ˆæœ¬å·å¹¶é€€å‡º</span><br><span class="line">-h, â€“helpæ˜¾ç¤ºå¸®åŠ©å¹¶é€€å‡º</span><br></pre></td></tr></table></figure>
<p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¼šè¾“å‡ºä¸€äº›ä¿¡æ¯ï¼Œå…¶æ„ä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">iterï¼šè¿­ä»£æ¬¡æ•°ã€‚å½“è¿­ä»£æ¬¡æ•°è¾¾åˆ°maxiteræ—¶ï¼Œè¿­ä»£ç»ˆæ­¢</span><br><span class="line">terrï¼šæ ‡è®°é”™è¯¯ç‡</span><br><span class="line">serrï¼šå¥å­é”™è¯¯ç‡</span><br><span class="line">objï¼šå½“å‰å¯¹è±¡çš„å€¼ã€‚å½“è¿™ä¸ªå€¼æ”¶æ•›åˆ°ä¸€ä¸ªç¡®å®šå€¼çš„æ—¶å€™ï¼Œè®­ç»ƒå®Œæˆ</span><br><span class="line">diffï¼šä¸ä¸Šä¸€ä¸ªå¯¹è±¡å€¼ä¹‹é—´çš„ç›¸å¯¹å·®ã€‚å½“æ­¤å€¼ä½äºetaæ—¶ï¼Œè®­ç»ƒå®Œæˆ</span><br></pre></td></tr></table></figure>
<p>åœ¨è®­ç»ƒå®Œæ¨¡å‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹å¯¹æ–°æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œé¢„æµ‹å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š<br><code>crf_test -m model seg_word_predict.data &gt; predict.txt</code></p>
<p><code>-m model</code>è¡¨ç¤ºä½¿ç”¨æˆ‘ä»¬åˆšåˆšè®­ç»ƒå¥½çš„modelæ¨¡å‹ï¼Œé¢„æµ‹çš„æ•°æ®æ–‡ä»¶ä¸ºseg_word_predict.data, <code>&gt; predict.txt</code>è¡¨ç¤ºå°†é¢„æµ‹åçš„æ•°æ®å†™å…¥åˆ°predict.txtä¸­ã€‚</p>
<h6 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h6><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> CRFPP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRFModel</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, model=<span class="string">'model_name'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: ç±»åˆå§‹åŒ–</span></span><br><span class="line"><span class="string">        :param model: æ¨¡å‹åç§°</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.model = model</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_tagger</span><span class="params">(self, tag_data)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: æ·»åŠ è¯­æ–™</span></span><br><span class="line"><span class="string">        :param tag_data: æ•°æ®</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        word_str = tag_data.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.model):</span><br><span class="line">            print(<span class="string">'æ¨¡å‹ä¸å­˜åœ¨,è¯·ç¡®è®¤æ¨¡å‹è·¯å¾„æ˜¯å¦æ­£ç¡®!'</span>)</span><br><span class="line">            exit()</span><br><span class="line">        tagger = CRFPP.Tagger(<span class="string">"-m &#123;&#125; -v 3 -n2"</span>.format(self.model))</span><br><span class="line">        tagger.clear()</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> word_str:</span><br><span class="line">            tagger.add(word)</span><br><span class="line">        tagger.parse()</span><br><span class="line">        <span class="keyword">return</span> tagger</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">text_mark</span><span class="params">(self, tag_data, begin=<span class="string">'B'</span>, middle=<span class="string">'I'</span>, end=<span class="string">'E'</span>, single=<span class="string">'S'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ–‡æœ¬æ ‡è®°</span></span><br><span class="line"><span class="string">        :param tag_data: æ•°æ®</span></span><br><span class="line"><span class="string">        :param begin: å¼€å§‹æ ‡è®°</span></span><br><span class="line"><span class="string">        :param middle: ä¸­é—´æ ‡è®°</span></span><br><span class="line"><span class="string">        :param end: ç»“æŸæ ‡è®°</span></span><br><span class="line"><span class="string">        :param single: å•å­—ç»“æŸæ ‡è®°</span></span><br><span class="line"><span class="string">        :return result: æ ‡è®°åˆ—è¡¨</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        tagger = self.add_tagger(tag_data)</span><br><span class="line">        size = tagger.size()</span><br><span class="line">        tag_text = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, size):</span><br><span class="line">            word, tag = tagger.x(i, <span class="number">0</span>), tagger.y2(i)</span><br><span class="line">            <span class="keyword">if</span> tag <span class="keyword">in</span> [begin, middle]:</span><br><span class="line">                tag_text += word</span><br><span class="line">            <span class="keyword">elif</span> tag <span class="keyword">in</span> [end, single]:</span><br><span class="line">                tag_text += word + <span class="string">"*&amp;*"</span></span><br><span class="line">        result = tag_text.split(<span class="string">'*&amp;*'</span>)</span><br><span class="line">        result.pop()</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crf_test</span><span class="params">(self, tag_data, separator=<span class="string">'/'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: crfæµ‹è¯•</span></span><br><span class="line"><span class="string">        :param tag_data:</span></span><br><span class="line"><span class="string">        :param separator:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        result = self.text_mark(tag_data)</span><br><span class="line">        data = separator.join(result)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crf_learn</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‡½æ•°è¯´æ˜: è®­ç»ƒæ¨¡å‹</span></span><br><span class="line"><span class="string">        :param filename: å·²æ ‡æ³¨æ•°æ®æº</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        crf_bash = <span class="string">"crf_learn -f 3 -c 4.0 api/template.txt &#123;&#125; &#123;&#125;"</span>.format(filename, self.model)</span><br><span class="line">        process = subprocess.Popen(crf_bash.split(), stdout=subprocess.PIPE)</span><br><span class="line">        output = process.communicate()[<span class="number">0</span>]</span><br><span class="line">        print(output.decode(encoding=<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><p><a href="https://zhuanlan.zhihu.com/p/37163081" target="_blank" rel="noopener">ç®€æ˜æ¡ä»¶éšæœºåœºCRFä»‹ç» | é™„å¸¦çº¯Keraså®ç°</a></p>
</li>
<li><p><a href="https://blog.csdn.net/qq_37667364/article/details/82919560" target="_blank" rel="noopener">CRF++/CRF/æ¡ä»¶éšæœºåœºçš„ç‰¹å¾å‡½æ•°æ¨¡æ¿</a></p>
</li>
<li><p><a href="https://www.hankcs.com/nlp/the-crf-model-format-description.html" target="_blank" rel="noopener">CRF++æ¨¡å‹æ ¼å¼è¯´æ˜</a></p>
</li>
</ol>
]]></content>
      <categories>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ·±åº¦å­¦ä¹ </tag>
        <tag>åºåˆ—æ ‡æ³¨</tag>
        <tag>æ¡ä»¶éšæœºåœº</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡æœ¬åˆ†ç±»æ¨¡å‹åŠæ¯”è¾ƒ</title>
    <url>/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p>æ–‡æœ¬åˆ†ç±»å¯ä»¥ç”¨äºæ–°é—»åˆ†ç±»ã€ç®€å†åˆ†ç±»ã€é‚®ä»¶åˆ†ç±»ã€åŠå…¬æ–‡æ¡£åˆ†ç±»ã€åŒºåŸŸåˆ†ç±»ç­‰è¯¸å¤šæ–¹é¢ï¼Œè¿˜èƒ½å¤Ÿå®ç°æ–‡æœ¬è¿‡æ»¤ï¼Œä»å¤§é‡æ–‡æœ¬ä¸­å¿«é€Ÿè¯†åˆ«å’Œè¿‡æ»¤å‡ºç¬¦åˆç‰¹æ®Šè¦æ±‚çš„ä¿¡æ¯ã€‚</p>
<h3 id="æ•°æ®é›†"><a href="#æ•°æ®é›†" class="headerlink" title="æ•°æ®é›†"></a>æ•°æ®é›†</h3><p>å‡†å¤‡äº†é•¿çŸ­æ–‡æœ¬ï¼ŒäºŒåˆ†ç±»ååˆ†ç±»è¿›è¡Œæ¯”è¾ƒ</p>
<h4 id="æƒ…æ„ŸäºŒåˆ†ç±»"><a href="#æƒ…æ„ŸäºŒåˆ†ç±»" class="headerlink" title="æƒ…æ„ŸäºŒåˆ†ç±»"></a>æƒ…æ„ŸäºŒåˆ†ç±»</h4><p>weibo_senti_100kï¼šå…±119988æ¡æ•°æ®ï¼Œæ­£ä¾‹ï¼š59993,è´Ÿä¾‹59995   </p>
<p>å¥å­æœ€å¤§é•¿åº¦ï¼š260ï¼Œæœ€å°é•¿åº¦ï¼š3ï¼Œå¹³å‡é•¿åº¦ï¼š66.04</p>
<p>éƒ¨åˆ†æ ·ä¾‹</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>label</th>
<th>review</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>æ›´åšäº†ï¼Œçˆ†ç…§äº†ï¼Œå¸…çš„å‘€ï¼Œå°±æ˜¯è¶Šæ¥è¶Šçˆ±ä½ ï¼ç”Ÿå¿«å‚»ç¼º[çˆ±ä½ ][çˆ±ä½ ][çˆ±ä½ ]</td>
</tr>
<tr>
<td>1</td>
<td>@å¼ æ™“é¹jonathan åœŸè€³å…¶çš„äº‹è¦è®¤çœŸå¯¹å¾…[å“ˆå“ˆ]ï¼Œå¦åˆ™ç›´æ¥å¼€é™¤ã€‚@ä¸ä¸çœ‹ä¸–ç•Œ å¾ˆæ˜¯ç»†å¿ƒï¼Œé…’åº—éƒ½å…¨éƒ¨OKå•¦ã€‚</td>
</tr>
<tr>
<td>1</td>
<td>å§‘å¨˜éƒ½ç¾¡æ…•ä½ å‘¢â€¦è¿˜æœ‰æ‹›è´¢çŒ«é«˜å…´â€¦â€¦//@çˆ±åœ¨è”“å»¶-JC:[å“ˆå“ˆ]å°å­¦å¾’ä¸€æšï¼Œç­‰ç€æ˜å¤©è§æ‚¨å‘¢//@ææ¬£èŠ¸SharonLee:å¤§ä½¬èŒƒå„¿[ä¹¦å‘†å­]</td>
</tr>
<tr>
<td>1</td>
<td>ç¾<del>~</del>[çˆ±ä½ ]</td>
</tr>
<tr>
<td>1</td>
<td>æ¢¦æƒ³æœ‰å¤šå¤§ï¼Œèˆå°å°±æœ‰å¤šå¤§![é¼“æŒ]</td>
</tr>
<tr>
<td>0</td>
<td>ä»Šå¤©çœŸå†·å•Šï¼Œéš¾é“åˆè¦ç©¿æ£‰è¢„äº†[æ™•]ï¼Ÿä»Šå¹´çš„æ˜¥å¤©çœŸçš„æ˜¯ç™¾å˜è«æµ‹å•Š[æŠ“ç‹‚]</td>
</tr>
<tr>
<td>0</td>
<td>[è¡°][è¡°][è¡°]åƒç»™å‰¥äº†çš®çš„è›‡</td>
</tr>
<tr>
<td>0</td>
<td>é…’é©¾çš„å±å®³ï¼Œè¿™å›æ˜¯æ½œæ°´è‰‡ã€‚//@ä¸Šæµ·è¯‘æ–‡ä¸ä¸½æ´:[æ³ª]</td>
</tr>
<tr>
<td>0</td>
<td>ç§¯å‹äº†è¿™ä¹ˆå¤šçš„æ•è¾¹ä¹¦ï¼Œæ²¡ä¸€æœ¬çœ‹å®Œäº†çš„ï¼Œç°åœ¨æˆ‘è¯»ä¹¦çš„æœ€ä½³åœ°ç‚¹å°½ç„¶æ˜¯å…¬äº¤è½¦[æ™•]</td>
</tr>
<tr>
<td>0</td>
<td>[æ³ª]é”™è¿‡äº†â€¦â€¦</td>
</tr>
</tbody>
</table>
</div>
<p><a href="https://github.com/Embedding/Chinese-Word-Vectors" target="_blank" rel="noopener">è¯å‘é‡ä¸‹è½½</a></p>
<p><a href="https://github.com/ymcui/Chinese-BERT-wwm" target="_blank" rel="noopener">ä¸­æ–‡é¢„è®­ç»ƒbertæ¨¡å‹ä¸‹è½½</a></p>
<p><a href="https://github.com/jeffery0628/text_classification" target="_blank" rel="noopener">æƒ…æ„ŸäºŒåˆ†ç±»githubä»“åº“ä»£ç </a></p>
<a id="more"></a>
<h4 id="æ–°é—»ååˆ†ç±»"><a href="#æ–°é—»ååˆ†ç±»" class="headerlink" title="æ–°é—»ååˆ†ç±»"></a>æ–°é—»ååˆ†ç±»</h4><p>ç±»åˆ«ï¼šâ€™ä½“è‚²â€™ â€˜å¨±ä¹â€™ â€˜å®¶å±…â€™ â€˜æˆ¿äº§â€™ â€˜æ•™è‚²â€™ â€˜æ—¶å°šâ€™ â€˜æ—¶æ”¿â€™ â€˜æ¸¸æˆâ€™ â€˜ç§‘æŠ€â€™ â€˜è´¢ç»â€™<br>è®­ç»ƒé›†ï¼š50000 æ¡æ•°æ®ï¼Œæœ€å¤§é•¿åº¦ï¼š27467ï¼Œæœ€å°é•¿åº¦ï¼š8ï¼Œç±»åˆ«ä¸ªæ•°ï¼š10,å¹³å‡é•¿åº¦ï¼š913.31<br>éªŒè¯é›†ï¼š5000 æ¡æ•°æ®ï¼Œæœ€å¤§é•¿åº¦ï¼š10919ï¼Œæœ€å°é•¿åº¦ï¼š15ï¼Œç±»åˆ«ä¸ªæ•°ï¼š10<br>æµ‹è¯•é›†ï¼š10000 æ¡æ•°æ®ï¼Œæœ€å¤§é•¿åº¦ï¼š14720ï¼Œæœ€å°é•¿åº¦ï¼š13ï¼Œç±»åˆ«ä¸ªæ•°ï¼š10</p>
<p>ä½¿ç”¨æ•°æ®é›†<a href="https://pan.baidu.com/s/1OOTK374IZ1DHnz5COUcfbw" target="_blank" rel="noopener">cnews</a>  å¯†ç :hf6o</p>
<p>è®­ç»ƒé›†éƒ¨åˆ†æ ·ä¾‹åŠæ¯ä¸ªç±»åˆ«çš„ç»Ÿè®¡ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>label</th>
<th>text</th>
<th>æ•°é‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä½“è‚²</td>
<td>é»„èœ‚vsæ¹–äººé¦–å‘ï¼šç§‘æ¯”å¸¦ä¼¤æˆ˜ä¿ç½— åŠ ç´¢å°”æ•‘èµä¹‹æˆ˜ æ–°æµªä½“è‚²è®¯åŒ—äº¬æ—¶é—´4æœˆ27æ—¥ï¼ŒNBAå­£åèµ›é¦–è½®æ´›æ‰çŸ¶æ¹–äººä¸»åœºè¿æˆ˜æ–°å¥¥å°”è‰¯é»„èœ‚ï¼Œæ­¤å‰çš„æ¯”èµ›ä¸­ï¼ŒåŒæ–¹æˆ˜æˆ2-2å¹³ï¼Œå› æ­¤æœ¬åœºæ¯”èµ›å¯¹äºä¸¤æ”¯çƒé˜Ÿæ¥è¯´éƒ½éå¸¸é‡è¦ï¼Œèµ›å‰åŒæ–¹ä¹Ÿå…¬å¸ƒäº†é¦–å‘é˜µå®¹ï¼šæ¹–äººé˜Ÿï¼šè´¹èˆå°”ã€ç§‘æ¯”ã€é˜¿æ³°æ–¯ç‰¹ã€åŠ ç´¢å°”ã€æ‹œçº³å§†é»„èœ‚é˜Ÿï¼šä¿ç½—ã€è´é‡Œå†…åˆ©ã€é˜¿é‡Œæ‰ã€å…°å¾·é‡Œã€å¥¥å¡ç¦[æ–°æµªNBAå®˜æ–¹å¾®åš][æ–°æµªNBAæ¹–äººæ–°é—»åŠ¨æ€å¾®åš][æ–°æµªNBAä¸“é¢˜]<a href="æ–°æµªä½“è‚²">é»„èœ‚vsæ¹–äººå›¾æ–‡ç›´æ’­å®¤</a></td>
<td>5000</td>
</tr>
<tr>
<td>å¨±ä¹</td>
<td>çš®å…‹æ–¯é¦–éƒ¨3DåŠ¨ç”»ã€Šé£å±‹å†é™©è®°ã€‹é¢„å‘Šå‘å¸ƒ(å›¾)è§†é¢‘ï¼šåŠ¨ç”»ç‰‡ã€Šé£å±‹å†é™©è®°ã€‹å…ˆè¡Œç‰ˆ43ç§’é¢„å‘Šæ–°æµªå¨±ä¹è®¯ è¿ªå£«å°¼ã€çš®å…‹æ–¯2009æš‘æœŸ3DåŠ¨ç”»åŠ›ä½œã€Šé£å±‹å†é™©è®°ã€‹(Up)å‘å¸ƒé¢„å‘Šç‰‡ï¼Œè™½ç„¶è¿™æ¬¾é¢„å‘Šç‰‡ä»…æœ‰43ç§’ï¼Œå¹¶ä¸”åªå‡ºç°äº†è¢«æ±½çƒåŠèµ·æ¥çš„æˆ¿å±‹ï¼Œä½†é—¨å‰è€çˆ·çˆ·å¡å°”çš„ä¸€å£°â€œä¸‹åˆå¥½â€ç€å®è®©äººå¿ä¿Šä¸ç¦ã€‚è¯¥ç‰‡ç”±ã€Šæ€ªå…½ç”µåŠ›å…¬å¸ã€‹å¯¼æ¼”å½¼ç‰¹Â·é“æ ¼ç‰¹(Pete Docter)æ‰§å¯¼ï¼Œæ›¾åœ¨ã€Šæµ·åº•æ€»åŠ¨å‘˜ã€‹ã€ã€Šæ–™ç†é¼ ç‹ã€‹æ‹…ä»»ç¼–å‰§çš„çš®å…‹æ–¯è€ç­åº•é²å‹ƒ-æ´¾ç‰¹æ£®(Bob Peterson)äº¦å°†åœ¨æœ¬ç‰‡æ‹…ä»»å…±åŒå¯¼æ¼”ï¼ŒçŒ®å‡ºè‡ªå·±çš„å¯¼æ¼”å¤„å¥³ä½œã€‚ã€Šé£å±‹å†é™©è®°ã€‹åŒæ—¶ä¼šæ˜¯çš®å…‹æ–¯æœ‰å²ä»¥æ¥ç¬¬ä¸€éƒ¨ä»¥3-Dç”µå½±å‘ˆç°çš„é‡Œç¨‹ç¢‘ä½œå“ï¼Œä¹‹åçš®å…‹æ–¯çš„æ‰€æœ‰å½±ç‰‡éƒ½å°†åˆ¶ä½œæˆç«‹ä½“ç”µå½±ã€‚ã€Šé£å±‹å†é™©è®°ã€‹è®²è¿°äº†ä¸€è€ä¸€å°‘çš„å†’é™©æ—…ç¨‹ã€‚78å²çš„è€ç¿å¡å°”Â·å¼—é›·å¾·é‡Œå…‹æ£®(Carl Fredricksen)ä¸€ç”Ÿä¸­éƒ½æ¢¦æƒ³ç€èƒ½ç¯æ¸¸ä¸–ç•Œã€å‡ºæ²¡äºå¼‚å¢ƒé™©åœ°ä½“éªŒï¼Œå´å¹³æ·¡åœ°æ¸¡è¿‡äº†ä¸€ç”Ÿã€‚åœ¨ä»–ç”Ÿæ´»çš„æœ€åé˜¶æ®µï¼Œå¡è€Œä»¿ä½›åœ¨å‘½è¿çš„å®‰æ’ä¸‹ï¼Œå¸¦ç€8å²çš„äºšè£”å°é¬¼å¤´Russellä¸€åŒè¸ä¸Šäº†å†’é™©çš„æ—…ç¨‹ã€‚è¿™å¯¹ä¸€è€ä¸€å°çš„å¥‡ç‰¹ç»„åˆè‚©å¹¶è‚©é—¯è¡æ±Ÿæ¹–ï¼Œå…±åŒç»å†äº†è’é‡è·‹æ¶‰ã€ä¸›æ—é‡å…½ä¸åæ´¾åè›‹çš„ç‹™å‡»ã€‚ç”°é‡/æ–‡</td>
<td>5000</td>
</tr>
<tr>
<td>å®¶å±…</td>
<td>æ©±æŸœä»·æ ¼å…³é”®åœ¨è®¡ä»·æ–¹å¼ æ•™ä½ å¦‚ä½•æŒ‘é€‰ä¹°è¿‡æ©±æŸœçš„äººéƒ½çŸ¥é“ï¼Œæ©±æŸœçš„è®¡ä»·å¾ˆå¤æ‚ï¼Œå•†å®¶çš„æŠ¥ä»·æ–¹å¼ä¹Ÿä¸å°½ç›¸åŒï¼Œé‚£ä¹ˆå“ªç§è®¡ä»·æ–¹å¼å¯¹æ¶ˆè´¹è€…æ›´æœ‰åˆ©ï¼Ÿåœ¨è®¡ä»·è¿‡ç¨‹ä¸­åº”è¯¥æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿæ¶ˆè´¹è€…åœ¨è´­ä¹°æ©±æŸœä¹‹å‰ä¸€å®šè¦äº†è§£æ¸…æ¥šã€‚ æ©±æŸœçš„ä¸»è¦è®¡ä»·æ–¹å¼â€”â€”å»¶ç±³è®¡ä»·å’Œå•å…ƒæŸœä½“è®¡ä»· ç°åœ¨å¸‚åœºä¸Šæ©±æŸœä¸»è¦æœ‰ä¸¤ç§è®¡ä»·æ–¹å¼â€”â€”å»¶ç±³è®¡ä»·å’Œå•å…ƒæŸœä½“è®¡ä»·ã€‚ å»¶ç±³è®¡ä»·æ˜¯æŒ‡åœ°æŸœå’ŒåŠæŸœå„ä¸€ç±³çš„æ€»ä»·(æœ‰äº›è¿˜åŒ…å«å°é¢)ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¦‚æœæœ‰å±€éƒ¨åŒºåŸŸåªè¦åœ°æŸœä¸è¦åŠæŸœï¼Œå°±ä¼šæŒ‰å°±ä¼šæŒ‰â€œ2/8â€æˆ–â€œ4/6â€çš„æ¯”ä¾‹æŠ˜ç®—ã€‚å¦‚æŸæ©±æŸœææ–™çš„å»¶ç±³ä»·ä¸º2000å…ƒ/å»¶ç±³ï¼ŒæŸé¡¾å®¢åš2ç±³çš„åŠæŸœã€4ç±³çš„åœ°æŸœï¼Œåˆ™åŠæŸœä»·=2000X0.4X2=1600å…ƒï¼Œåœ°æŸœä»·=2000X0.6X4=4800å…ƒ(æ­¤åŠæŸœã€åœ°æŸœä»·æŒ‰4/6çš„æ¯”ä¾‹è®¡ç®—)ï¼Œå†åŠ ä¸Šæ‰€é€‰å°é¢ã€é…ä»¶ã€ç”µå™¨ç­‰é™„åŠ è´¹ç”¨å³ä¸ºæ•´å¥—æ©±æŸœçš„ä»·æ ¼ã€‚ å»¶ç±³æŠ¥ä»·æœ‰è®¸å¤šä¸åˆç†ä¹‹å¤„ï¼Œæ°´æ§½ã€ç‡ƒæ°”ç¶ã€åµŒå…¥å¼ç”µå™¨ç­‰éƒ¨åˆ†æ‰€éœ€é—¨æ¿å¾ˆå°‘ï¼Œä½†ä»æŒ‰å»¶ç±³æ¥ç®—ä»·ï¼Œå¯¹æ¶ˆè´¹è€…æ¥è¯´å¾ˆä¸åˆ’ç®—ã€‚ä¾‹å¦‚ä¸€æ¬¾1000å…ƒ/å»¶ç±³çš„æ©±æŸœï¼Œä¸€ä¸ªæ°´æ§½çº¦0.8ç±³é•¿ï¼Œä½†æ¶ˆè´¹è€…è¿˜æ˜¯è¦æŒ‰1000å…ƒçš„å•ä»·ä¹˜ä»¥0.8ç±³ä»˜è´¹ï¼Œè¿™ä¸ªå®é™…ä¸Šåªæ˜¯å‡ å—ææ–™ç®€å•ç»„åˆçš„æ°´æ§½æŸœéœ€è¦æ¶ˆè´¹è€…èŠ±800å…ƒï¼Œè€ŒåŒæ ·æè´¨ã€åŒæ ·å¤§å°çš„æ°´æ§½æŸœä»…éœ€400å…ƒå·¦å³ï¼ŒäºŒè€…ä»·æ ¼ç›¸å·®æ•°ç™¾å…ƒã€‚ æŒ‰å»¶ç±³è®¡ä»·ï¼Œæ‰€æœ‰çš„é…ä»¶è´¹ç”¨éƒ½æ˜¯åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šå¢åŠ ï¼Œè™½ç„¶æœ‰äº›å‚å®¶å®£ç§°æŠ½å±‰ã€æ‹‰ç¯®ä¸åŠ é’±ï¼Œä½†å…¶å®é‚£æ˜¯æœ€åŸºæœ¬çš„é…ç½®ï¼Œä¸€æ—¦é¡¾å®¢è¦æ±‚è°ƒæ•´æ–¹æ¡ˆï¼Œå°±ä¼šè¦å¤šåŠ é’±ï¼Œæ­¤å¤–ä¸è¶³ä¸€ç±³çš„éƒ¨åˆ†è¦æŒ‰ä¸€ç±³è®¡ä»·ï¼Œå› æ­¤å¯¹é¡¾å®¢æ¥è¯´ï¼Œå¦‚æ­¤è®¡ä»·ä¼šå¤šèŠ±ä¸å°‘å†¤æ‰é’±ã€‚ â€œå•å…ƒæŸœä½“è®¡ä»·â€æ˜¯å›½é™…æƒ¯ä¾‹çš„æ©±æŸœè®¡ä»·æ–¹å¼ï¼Œæ˜¯æŒ‰æ¯ä¸€ä¸ªç»„æˆå¨æŸœçš„å•å…ƒæŸœä»·æ ¼è¿›è¡Œè®¡ç®—ï¼Œç„¶ååŠ å‡ºæ€»ä»·ã€‚å…·ä½“ä¸ºï¼šæŸåŠæŸœå•ä»·Ã—ä¸ªæ•°+æŸåœ°æŸœå•ä»·Ã—ä¸ªæ•°â€¦â€¦ã€‚åˆ©ç”¨å•å…ƒæŸœä½“è®¡ä»·ï¼Œæ›´ä¸ºåˆç†ã€‚ä¸¾ä¸ªä¾‹å­è¯´ï¼Œå¤–è§‚ç›¸åŒçš„æŸœä½“ï¼ŒæŠ½å±‰æ•°é‡ã€äº”é‡‘ä»¶ã€æ‰˜æ¶æ•°é‡å¦‚æœä¸åŒï¼Œåœ¨ä»¥å»¶ç±³è®¡ä»·æ—¶ï¼Œå•†å®¶å¾€å¾€åªç»™æ¶ˆè´¹è€…æœ€ç®€å•ã€æœ€çœæˆæœ¬çš„äº§å“ã€‚è€ŒæŒ‰å•å…ƒæŸœä½“è®¡ä»·ï¼Œä¸€æ¬¾å°ºå¯¸ç›¸åŒçš„æŠ½å±‰æŸœå¯æŒ‰ä¸åŒé…ç½®æŠ¥å‡ºä¸åŒä»·æ ¼ï¼šåŒæ ·æ˜¯ä¸€æ¬¾30cmå®½ã€66cmé«˜çš„å•ä½“æŸœï¼Œå¦‚æœé—¨æ”¹æˆå¼§å‹ï¼Œæ˜¯å¤šå°‘é’±ï¼›å¦‚æœæŠ½å±‰é‡ŒåŠ ä¸Šå¯æ‹†è£…çš„é‡‘å±ç¯®ï¼Œæ˜¯å¤šå°‘é’±ï¼›å¦‚æœæŠ½å±‰çš„ä¾§æ¿æ˜¯æœ¨è´¨çš„å¤šå°‘é’±â€¦â€¦æŠŠæ©±æŸœçš„æ¯ä¸ªç»†èŠ‚éƒ½åˆ†è§£å¼€æ¥ï¼Œæ¶ˆè´¹è€…å¯ä»¥åœ¨é¢„ç®—ä¹‹å†…æŠŠå¯æœ‰å¯æ— çš„é…ç½®çœæ‰ï¼ŒæŠŠé’±èŠ±åœ¨è‡ªå·±æ›´éœ€è¦çš„åŠŸèƒ½ä¸Šã€‚ ä¸¤å…¨å…¶ç¾æŠ¥ä»·æ–¹å¼â€”â€”å»¶ç±³è®¡ä»·å’Œå•å…ƒæŸœä½“è®¡ä»·ç›¸ç»“åˆ ç°åœ¨ä¸­å›½æ©±æŸœå¸‚åœºä¸Šä»æ™®éé‡‡ç”¨å»¶ç±³è®¡ä»·ï¼Œä½†è¿›å£å“ç‰ŒåŠå›½å†…ä¸€äº›å¤§å“ç‰Œæ©±æŸœéƒ½é‡‡ç”¨å•å…ƒæŸœä½“è®¡ä»·æ–¹å¼ï¼Œå¦‚å¾·å®Â·è¥¿å…‹æ›¼ã€æµ·å°”ç­‰å“ç‰Œå³æ˜¯é‡‡ç”¨å•å…ƒæŸœä½“è®¡ä»·æ–¹å¼ã€‚ä¸è¿‡å¾·å®Â·è¥¿å…‹æ›¼å¨æŸœçš„å·¥ä½œäººå‘˜ä»‹ç»åˆ°ï¼Œå¦‚æœä¸€å¼€å§‹å°±ç”¨å•å…ƒæŸœä½“è®¡ä»·æ¥è¿›è¡ŒæŠ¥ä»·ï¼Œä¸å¤Ÿç›´è§‚ï¼ŒåŒæ—¶ä¸ºäº†ä¾¿äºé¡¾å®¢è¿›è¡Œæ¯”è¾ƒï¼Œä»–ä»¬ä¼šç”¨å»¶ç±³è®¡ä»·ç»™é¡¾å®¢æ‰€é€‰å®šçš„ææ–™è¿›è¡Œä¸€ä¸ªåˆå§‹æŠ¥ä»·ï¼Œè®©é¡¾å®¢å¯¹è‡ªå·±çš„å¨æˆ¿è£…ä¿®è¦èŠ±å¤šå°‘é’±å¿ƒé‡Œå¤§æ¦‚æœ‰ä¸ªåº•ã€‚åœ¨å¯¹å¨æˆ¿è¿›è¡Œé‡å°ºåï¼Œè®¾è®¡å¸ˆä¼šæŒ‰ç…§é¡¾å®¢çš„éœ€æ±‚ï¼Œè®¾è®¡å‡ºå¨æˆ¿æ•ˆæœå›¾ã€‚è¿™æ—¶ï¼Œé”€å”®äººå‘˜ä¼šæŒ‰å•å…ƒæŸœä½“è®¡ä»·ç»™é¡¾å®¢è¿›è¡Œä¸€ä¸ªæŠ¥ä»·ã€‚å¯¹äºæ¯ä¸€ç§æ ‡å‡†æŸœä½“éƒ½æœ‰ç›¸åº”çš„æŠ¥ä»·ï¼Œé¡¾å®¢å®é™…ç”¨åˆ°å‡ ç»„æŸœå­ï¼Œå°†è¿™äº›æŸœå­ä»·æ ¼ç´¯åŠ ï¼Œå†åŠ ä¸Šå°é¢åŠå…¶ä»–ç›¸å…³è´¹ç”¨ï¼Œä¾¿æ˜¯æ•´ä¸ªæ©±æŸœçš„ä»·æ ¼ã€‚</td>
<td>5000</td>
</tr>
<tr>
<td>æˆ¿äº§</td>
<td>å†¯ä»‘ï¼šç»§ç»­å¢æŒé«˜GDPåŸå¸‚å•†ä¸šåœ°äº§ç¡®ç«‹å•†ä¸šåœ°äº§æŠ•èµ„æˆ˜ç•¥ä¸ä¹…çš„ä¸‡é€šåœ°äº§(ä¼ä¸šä¸“åŒº,æ——ä¸‹æ¥¼ç›˜)(600246)ï¼Œä»Šå¹´ä¸ŠåŠå¹´é­é‡äº†ä¸šç»©ä¸‹æ»‘ã€‚å…¬å¸æ˜¨æ—¥å…¬å¸ƒçš„åŠå¹´æŠ¥æ˜¾ç¤ºï¼Œå…¶å•†ä¸šç‰©ä¸šåœ¨æŠ¥å‘ŠæœŸå†…å®ç°çš„è¥ä¸šæ”¶å…¥åŒæ¯”ä¸‹é™33.71%ï¼Œè¥ä¸šåˆ©æ¶¦ç‡æ¯”ä¸Šå¹´åŒæœŸä¸‹é™47.29ä¸ªç™¾åˆ†ç‚¹ã€‚ä¸è¿‡ï¼Œå…¬å¸è‘£äº‹é•¿å†¯ä»‘æ—¥å‰è¡¨ç¤ºï¼Œä¾ç„¶çœ‹å¥½äººå‡GDP8000ç¾å…ƒä»¥ä¸ŠåŸå¸‚çš„å•†ä¸šåœ°äº§ï¼Œä¸‡é€šå°†ç»§ç»­å¢åŠ é«˜GDPåŸå¸‚çš„å•†ä¸šåœ°äº§ï¼›è®¡åˆ’ç”¨5-10å¹´ï¼Œå•†ä¸šç‰©ä¸šæ”¶å…¥å æ¯”è¾¾åˆ°30%-50%ã€‚é€†å‘è¿ä½œåœ°äº§æŠ•èµ„å†¯ä»‘æŒ‡å‡ºï¼Œæ ¹æ®å†å²ç»éªŒï¼ŒGDPçš„å¢é•¿ã€åŸå¸‚åŒ–çš„å¢é•¿ï¼Œå’Œæˆ¿åœ°äº§ç‰©ä¸šå½¢æ€æœ‰ä¸€å®šå…³ç³»ï¼Œå³äººå‡GDPåœ¨8000ç¾å…ƒä»¥ä¸‹æ—¶ï¼Œä½å®…æ˜¯å¸‚åœºçš„æ ¸å¿ƒï¼Œä¸»æµäº§å“éƒ½å°†å›´ç»•ä½å®…å±•å¼€ã€‚ç›®å‰ï¼Œåœ¨ä¸­å›½çš„åŸå¸‚ä¸­ï¼Œäººå‡GDP8000ç¾å…ƒçš„åŸå¸‚å¤§çº¦æœ‰åä¸ªï¼Œå¤§éƒ¨åˆ†çœä¼šåŸå¸‚ä¾ç„¶åœ¨3000ç¾å…ƒè‡³5000ç¾å…ƒä¹‹é—´ï¼Œå› æ­¤ï¼Œæœªæ¥5-10å¹´ï¼Œä¸­å›½æˆ¿åœ°äº§å¸‚åœºçš„äº§å“ç»“æ„ä»ç„¶æ˜¯ä»¥ä½å®…ä¸ºä¸»ã€‚ å†¯ä»‘è®¤ä¸ºï¼Œä¸‡é€šåœ°äº§ä»ç°åœ¨å¼€å§‹æ‰©å¤§å•†ä¸šåœ°äº§çš„æ¯”é‡ï¼Œåœ¨ç›®å‰çš„å¸‚åœºä¸­ï¼Œæ˜¯ä¸€ç§é€†å‘è¿ä½œçš„æ€ç»´ï¼Œä½†ç¬¦åˆé•¿æœŸè¶‹åŠ¿ã€‚ä»–æŒ‡å‡ºï¼Œåœ¨äººå‡GDPè¾¾åˆ°8000ç¾å…ƒçš„ç»æµå®ä½“ä¸­ï¼Œå•†ç”¨ä¸åŠ¨äº§ä¼šæˆä¸ºåœ°äº§ä¸šçš„ä¸»è§’ã€‚ä»¥ç¾å›½ä¸ºä¾‹ï¼Œå•†ä¸šåœ°äº§çš„å¸‚åœºè§„æ¨¡å¤§çº¦æ˜¯ä½å®…çš„ä¸¤å€ã€‚ä¸­å›½å•†ä¸šåœ°äº§æœªæ¥çš„å¸‚åœºç©ºé—´å¾ˆå¤§ã€‚æ ¹æ®ä¸‡é€šåœ°äº§çš„å‘å±•æˆ˜ç•¥ï¼Œé™¤äº†åœ¨ç¯æ¸¤æµ·åŒºåŸŸå†…å‘å±•ä½å®…ä»¥å¤–ï¼Œè¿˜ä¼šé‡ç‚¹å‘å±•å•†ä¸šä¸åŠ¨äº§ã€‚æœªæ¥ï¼Œå…¬å¸ä¸šåŠ¡ç»“æ„å°†é€æ­¥è°ƒæ•´ï¼Œå•†ç”¨åœ°äº§çš„æ”¶å…¥ä¼šé€å¹´å¢åŠ ï¼›ä»Šåï¼Œå…¬å¸å•†ä¸šç‰©ä¸šæ”¶å…¥å°†å åˆ°æ•´ä½“è¥ä¸šæ”¶å…¥çš„ä¸€åŠå·¦å³ã€‚å¯¹äºç›®å‰å•†ä¸šåœ°äº§é¢ä¸´çš„ä¸æ™¯æ°”å±€é¢ï¼Œä¸‡é€šåœ°äº§è‘£äº‹ä¼šç§˜ä¹¦ç¨‹æ™“?æŒ‡å‡ºï¼Œå…¬å¸æˆ˜ç•¥ä¸ä¼šå› å¸‚åœºçš„çŸ­æœŸæ³¢åŠ¨è€Œæ”¹å˜ï¼Œå…¬å¸å°†ç»§ç»­åŠ å¤§å•†ç”¨ç‰©ä¸šé¡¹ç›®çš„æŠ•èµ„åŠ›åº¦ï¼Œä»¥è¥è¿å¸¦åŠ¨å¼€å‘ï¼Œä»¥è´¢åŠ¡å®‰æ’çš„å¤šæ ·åŒ–å®æ–½å•†ç”¨ç‰©ä¸šæŠ•èµ„ã€‚æ”¹å˜å•†ä¸šæ¨¡å¼å†¯ä»‘è¡¨ç¤ºï¼Œå°±æˆ¿åœ°äº§å¼€å‘æ¨¡å¼è€Œè¨€ï¼Œè¿‡å»ä¸¤ç™¾å¹´ä¸»è¦ç»å†äº†ä¸‰æ¬¡å˜åŒ–ï¼Œå³ä»â€œåœ°ä¸»åŠ å·¥å¤´â€åˆ°â€œå‚é•¿åŠ èµ„æœ¬å®¶â€ï¼Œå†åˆ°â€œå¯¼æ¼”åŠ åˆ¶ç‰‡â€ã€‚ç›®å‰ï¼Œå›½å†…å¤šæ•°åœ°äº§å•†çš„å¼€å‘æ¨¡å¼å±äºâ€œåœ°ä¸»åŠ å·¥å¤´â€å’Œâ€œå‚é•¿åŠ èµ„æœ¬å®¶â€çš„é˜¶æ®µï¼›è€Œå•†ä¸šåœ°äº§çš„å¼€å‘æ¨¡å¼ï¼Œä¸èƒ½åœç•™åœ¨è¿™ä¸¤ä¸ªé˜¶æ®µã€‚æ‰€è°“â€œå¯¼æ¼”åŠ åˆ¶ç‰‡â€æ¨¡å¼ï¼Œå³ç”±ä¸“ä¸šçš„æˆ¿åœ°äº§æŠ•èµ„å’Œèµ„äº§ç®¡ç†å…¬å¸è´Ÿè´£è¿è¥å•†ä¸šåœ°äº§é¡¹ç›®ï¼Œå®ç°æ”¶å…¥çš„å¤šå…ƒåŒ–ã€‚è€Œè¿™ç§æ¨¡å¼éœ€è¦ç›¸åº”çš„é‡‘èåˆ›æ–°äº§å“æ”¯æŒã€‚ä¸šå†…äººå£«æŒ‡å‡ºï¼Œæˆ¿åœ°äº§é‡‘èé¢†åŸŸå†…çš„REITSã€æŠµæŠ¼è´·æ¬¾ç­‰é‡‘èäº§å“ä½“ç³»çš„å®Œå–„ï¼Œå°†æ”¯æŒå•†ç”¨åœ°äº§åœ¨ä¸€ä¸ªå¤šå…ƒåŒ–çš„ä¸åŠ¨äº§ç»è¥ç¯å¢ƒä¸­å¿«é€Ÿçš„æˆé•¿ã€‚è€Œå•†ä¸šæ¨¡å¼çš„æ”¹å˜éœ€è¦è¾ƒé•¿ä¸€æ®µæ—¶é—´ã€‚æ•°æ®æ˜¾ç¤ºï¼Œé¦™æ¸¯ä¸»æµæˆ¿åœ°äº§ä¼ä¸šåœ¨äººå‡GDP10000ç¾å…ƒçš„æ—¶å€™å¼€å§‹é€æ­¥å‘å±•å•†ä¸šåœ°äº§ï¼Œå…ˆåç»è¿‡13-15å¹´ç¡®ç«‹èµ·æ–°çš„å•†ä¸šæ¨¡å¼ã€‚å…¶ä¸­ï¼Œé•¿æ±Ÿå®ä¸šç»è¿‡13å¹´çš„å‘å±•ï¼Œå•†ä¸šåœ°äº§åœ¨ä¸šåŠ¡æœºæ„çš„æ¯”é‡å åˆ°30%ï¼Œæ–°é¸¿åŸºåˆ™ç»è¿‡15å¹´çš„è°ƒæ•´ï¼Œå•†ä¸šåœ°äº§æ¯”é‡å åˆ°50%ã€‚SOHOä¸­å›½(ä¼ä¸šä¸“åŒº,æ——ä¸‹æ¥¼ç›˜)è‘£äº‹é•¿æ½˜çŸ³å±¹ä¹ŸæŒ‡å‡ºï¼Œç°åœ¨çš„å¸‚åœºè™½ç„¶åœ¨è°ƒæ•´ï¼Œä¸è¿‡ä¹Ÿç»™ä»äº‹å•†ä¸šåœ°äº§å¼€å‘çš„ä¼ä¸šæä¾›äº†è‰¯å¥½æœºä¼šå’Œå¹³å°ï¼Œåº”åŠæ—¶åœ¨åœ°åŸŸã€å¼€å‘ç‰©ä¸šçš„å“ç§ã€å“ç‰Œçš„å»ºè®¾ã€é”€å”®å’ŒæŒæœ‰ç‰©ä¸šçš„æ¯”é‡å››ä¸ªæ–¹é¢åšå‡ºè°ƒæ•´ã€‚ æˆ‘è¦è¯„è®º</td>
<td>5000</td>
</tr>
<tr>
<td>æ•™è‚²</td>
<td>2010å¹´6æœˆè‹±è¯­å…­çº§è€ƒè¯•è€ƒåéš¾åº¦è°ƒæŸ¥2010å¹´6æœˆå¤§å­¦è‹±è¯­å…­çº§è€ƒè¯•å°†äº19æ—¥ä¸‹åˆä¸¾è¡Œï¼Œæ¬¢è¿å„ä½è€ƒç”Ÿåœ¨è€ƒè¯•åå‚åŠ éš¾åº¦è°ƒæŸ¥ï¼Œå‘è¡¨ä½ å¯¹è¿™æ¬¡è€ƒè¯•çš„çœ‹æ³•ã€‚ç‚¹å‡»è¿›å…¥è®ºå›ï¼Œå‚ä¸è€ƒåå¤§è®¨è®º</td>
<td>5000</td>
</tr>
<tr>
<td>æ—¶å°š</td>
<td>ç»„å›¾ï¼šèè‰æ½®äººç¤ºèŒƒæ˜¥å­£å¤å¤å®ç©¿å¯¼è¯­ï¼šèè‰æ½®äººç¤ºèŒƒæ˜¥å­£å¤å¤å®ç©¿ï¼Œåœ¨ä¹æš–è¿˜å¯’çš„åˆæ˜¥ï¼Œæœ‰çš„ç”œç¾ã€æœ‰çš„ä¼˜é›…ã€æœ‰çš„æ€§æ„Ÿï¼Œä½†æ— è®ºæ˜¯å“ªç§é£æ ¼éƒ½ç»™äººå¼ºçƒˆçš„è§†è§‰å†²å‡»åŠ›ï¼Œåœ¨è¿™ä¸ªç¼¤çº·çš„æ˜¥å­£æ›´åŠ è„±ä¿—åŠ¨äººã€‚</td>
<td>5000</td>
</tr>
<tr>
<td>æ—¶æ”¿</td>
<td>é¦™æ¸¯ç‰¹åŒºè¡Œæ”¿é•¿å®˜æ›¾è«æƒå°†ç¦»æ¸¯ä¼‘å‡ä¸­æ–°ç¤¾é¦™æ¸¯å…«æœˆä¸ƒæ—¥ç”µ é¦™æ¸¯ç‰¹åŒºè¡Œæ”¿é•¿å®˜æ›¾è«æƒå°†äºå…«æœˆä¹æ—¥è‡³åäº”æ—¥ç¦»æ¸¯ä¼‘å‡ã€‚ç‰¹åŒºæ”¿åºœå‘è¨€äººä¸ƒæ—¥é€éœ²ï¼Œæ›¾è«æƒç¦»æ¸¯æœŸé—´ï¼Œå…«æœˆä¹æ—¥ç”±ç‰¹åŒºè´¢æ”¿å¸å¸é•¿æ›¾ä¿Šåç½²ç†è¡Œæ”¿é•¿å®˜èŒåŠ¡ï¼›å…«æœˆåæ—¥è‡³åäº”æ—¥ç”±æ”¿åŠ¡å¸å¸é•¿å”è‹±å¹´ç½²ç†è¡Œæ”¿é•¿å®˜èŒåŠ¡ã€‚(å®Œ)</td>
<td>5000</td>
</tr>
<tr>
<td>æ¸¸æˆ</td>
<td>å…¨å›½äººå¤§å¸¸å§”ä¼šå°†å¯¹59ä»¶æ³•å¾‹ç›¸å…³æ¡æ–‡ä½œå‡ºä¿®æ”¹æ–°åç¤¾å¿«è®¯ï¼šå…¨å›½äººå¤§å¸¸å§”ä¼š27æ—¥è¡¨å†³é€šè¿‡äº†å…³äºä¿®æ”¹éƒ¨åˆ†æ³•å¾‹çš„å†³å®šï¼Œå¯¹59ä»¶æ³•å¾‹çš„ç›¸å…³æ¡æ–‡ä½œå‡ºä¿®æ”¹ã€‚</td>
<td>5000</td>
</tr>
<tr>
<td>ç§‘æŠ€</td>
<td>å…¥é—¨çº§æ—¶å°šå¡ç‰‡æœº å°¼åº·S220å¥—è£…ä»…1150å°¼åº·S220å»¶ç»­äº†Sç³»åˆ—çº¤å·§è¶…è–„çš„æœºèº«è®¾è®¡ï¼Œé‡‡ç”¨é“åˆé‡‘æè´¨æ‰“é€ ï¼Œè¡¨é¢è´¨åœ°ç»†è…»ï¼Œä¸æ˜“æ²¾æŸ“æŒ‡çº¹ã€‚S220æ‹¥æœ‰ç´«è‰²ã€æ·±è“ã€æ´‹çº¢ã€æ°´æ™¶ç»¿å’ŒæŸ”é“¶äº”æ¬¾é“ä¸½é¢œè‰²å¯ä¾›é€‰æ‹©ã€‚</td>
<td>5000</td>
</tr>
</tbody>
</table>
</div>
<p>ä½¿ç”¨æœç‹—æ–°é—»è¯å‘é‡å’Œå­—å‘é‡ï¼Œ300dï¼š<a href="https://pan.baidu.com/s/1svFOwFBKnnlsqrF1t99Lnw" target="_blank" rel="noopener">è¯å‘é‡</a>,<a href="https://pan.baidu.com/s/1tUghuTno5yOvOx4LXA9-wg" target="_blank" rel="noopener">å­—å‘é‡</a></p>
<h3 id="æ•°æ®å¤„ç†ä»£ç ï¼ˆå¾®åšï¼‰"><a href="#æ•°æ®å¤„ç†ä»£ç ï¼ˆå¾®åšï¼‰" class="headerlink" title="æ•°æ®å¤„ç†ä»£ç ï¼ˆå¾®åšï¼‰"></a>æ•°æ®å¤„ç†ä»£ç ï¼ˆå¾®åšï¼‰</h3><h4 id="DataSet"><a href="#DataSet" class="headerlink" title="DataSet"></a>DataSet</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeiboDataset</span><span class="params">(NLPDataset)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,data_path,test=False,stop_words_path=None,batch_first=False,include_lengths=False,tokenizer_language=<span class="string">'cn'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param data_path:</span></span><br><span class="line"><span class="string">        :param test: å¦‚æœä¸ºæµ‹è¯•é›†ï¼Œåˆ™ä¸åŠ è½½label</span></span><br><span class="line"><span class="string">        :param stop_words_path:</span></span><br><span class="line"><span class="string">        :param batch_first:</span></span><br><span class="line"><span class="string">        :param include_lengths:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.data = pd.read_csv(data_path)</span><br><span class="line">        print(<span class="string">'read data from &#123;&#125;'</span>.format(data_path))</span><br><span class="line">        self.text_field = <span class="string">"review"</span></span><br><span class="line">        self.label_field = <span class="string">"label"</span></span><br><span class="line">        self.test = test</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> stop_words_path:</span><br><span class="line">            stop_words = read_stop_words(stop_words_path)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            stop_words = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        self.LABEL = LabelField(sequential=<span class="literal">False</span>, use_vocab=<span class="literal">False</span>, dtype=torch.float)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># lambda x: [y for y in x]</span></span><br><span class="line">        self.TEXT = Field(sequential=<span class="literal">True</span>,stop_words=stop_words, tokenize=<span class="keyword">lambda</span> x: [y <span class="keyword">for</span> y <span class="keyword">in</span> x], batch_first=batch_first,tokenizer_language=tokenizer_language,</span><br><span class="line">                          include_lengths=include_lengths)  <span class="comment"># include_lengths=True for LSTM</span></span><br><span class="line"></span><br><span class="line">        self.fields = [(<span class="string">"text"</span>, self.TEXT), (<span class="string">"label"</span>, self.LABEL)]</span><br><span class="line"></span><br><span class="line">        self.examples = self.build_examples()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_examples</span><span class="params">(self)</span>:</span></span><br><span class="line">        examples = []</span><br><span class="line">        <span class="keyword">if</span> self.test:</span><br><span class="line">            <span class="comment"># å¦‚æœä¸ºæµ‹è¯•é›†ï¼Œåˆ™ä¸åŠ è½½label</span></span><br><span class="line">            <span class="keyword">for</span> text <span class="keyword">in</span> tqdm(self.data[self.text_field]):</span><br><span class="line">                examples.append(Example.fromlist([text, <span class="literal">None</span>], self.fields))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> text, label <span class="keyword">in</span> tqdm(zip(self.data[self.text_field], self.data[self.label_field])):</span><br><span class="line">                <span class="comment"># Example: Defines a single training or test example.</span></span><br><span class="line">                <span class="comment"># Stores each column of the example as an attribute.</span></span><br><span class="line">                examples.append(Example.fromlist([text, label], self.fields))</span><br><span class="line">        <span class="keyword">return</span> examples</span><br></pre></td></tr></table></figure>
<h4 id="dataloader"><a href="#dataloader" class="headerlink" title="dataloader"></a>dataloader</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeiboDataLoader</span><span class="params">(NLPDataLoader)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,dataset,split_ratio=None, batch_size=<span class="number">64</span>, sort_key=None, device=None,train=True, repeat=False, shuffle=None, sort=None,sort_within_batch=False,</span></span></span><br><span class="line"><span class="function"><span class="params">                 batch_size_fn=None,  use_pretrained_word_embedding=False, word_embedding_path=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å¾®åšäºŒåˆ†ç±»æ•°æ®é›†åŠ è½½å™¨</span></span><br><span class="line"><span class="string">        :param dataset:</span></span><br><span class="line"><span class="string">        :param split_ratio:</span></span><br><span class="line"><span class="string">        :param batch_size:</span></span><br><span class="line"><span class="string">        :param device:</span></span><br><span class="line"><span class="string">        :param train: Whether the iterator represents a train set</span></span><br><span class="line"><span class="string">        :param repeat:</span></span><br><span class="line"><span class="string">        :param shuffle:</span></span><br><span class="line"><span class="string">        :param sort:</span></span><br><span class="line"><span class="string">        :param sort_within_batch:</span></span><br><span class="line"><span class="string">        :param use_pretrained_word_embedding:</span></span><br><span class="line"><span class="string">        :param word_embedding_path:</span></span><br><span class="line"><span class="string">        :param vocab_size:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># æ„å»ºæ•°æ®é›†</span></span><br><span class="line">        self.dataset = dataset</span><br><span class="line">        <span class="comment"># è¿­ä»£å™¨å‚æ•°</span></span><br><span class="line">        self.split_ratio = split_ratio</span><br><span class="line">        self.batch_size = batch_size</span><br><span class="line">        self.sort_key = sort_key</span><br><span class="line">        self.device = device</span><br><span class="line">        self.batch_size_fn = batch_size_fn</span><br><span class="line">        self.train = train</span><br><span class="line">        self.repeat = repeat</span><br><span class="line">        self.shuffle = shuffle</span><br><span class="line">        self.sort = sort</span><br><span class="line">        self.sort_within_batch = sort_within_batch</span><br><span class="line">        self.use_pretrained_word_embedding = use_pretrained_word_embedding</span><br><span class="line">        self.word_embedding_path = word_embedding_path</span><br><span class="line">        self.train_iter, self.valid_iter, self.test_iter = self.get_iterators()</span><br><span class="line">        self.vocab = self.dataset.TEXT.vocab</span><br><span class="line">        self.vocab.pad_index = self.dataset.TEXT.vocab.stoi[self.dataset.TEXT.pad_token]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_iterators</span><span class="params">(self)</span>:</span></span><br><span class="line">        train_iter, valid_iter, test_iter = <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.split_ratio:</span><br><span class="line">            <span class="comment"># æ„å»ºè¯æ±‡è¡¨</span></span><br><span class="line">            <span class="keyword">if</span> self.use_pretrained_word_embedding:</span><br><span class="line">                vectors = Vectors(name=self.word_embedding_path)  <span class="comment"># ä½¿ç”¨é¢„è®­ç»ƒçš„è¯å‘é‡</span></span><br><span class="line">                self.dataset.TEXT.build_vocab(self.dataset, vectors=vectors,</span><br><span class="line">                                              unk_init=torch.Tensor.normal_)</span><br><span class="line">                self.dataset.LABEL.build_vocab(self.dataset)</span><br><span class="line">                print(<span class="string">'label types:&#123;&#125;'</span>.format(self.dataset.LABEL.vocab.stoi))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.dataset.TEXT.build_vocab(self.dataset)  <span class="comment"># ä¸ä½¿ç”¨é¢„è®­ç»ƒçš„è¯å‘é‡</span></span><br><span class="line">                self.dataset.LABEL.build_vocab(self.dataset)</span><br><span class="line">                print(<span class="string">'label types:&#123;&#125;'</span>.format(self.dataset.LABEL.vocab.stoi))</span><br><span class="line"></span><br><span class="line">            train_iter = Iterator(self.dataset, batch_size=self.batch_size, device=self.device, sort_key=self.sort_key,</span><br><span class="line">                                  sort_within_batch=self.sort_within_batch, repeat=self.repeat,</span><br><span class="line">                                  batch_size_fn=self.batch_size_fn</span><br><span class="line">                                  , train=self.train, shuffle=self.shuffle, sort=self.sort)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            train_data, valid_data, test_data = <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> isinstance(self.split_ratio, list):</span><br><span class="line">                <span class="keyword">if</span> len(self.split_ratio) == <span class="number">3</span>:</span><br><span class="line">                    train_data, valid_data, test_data = self.dataset.split(split_ratio=self.split_ratio)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    train_data, valid_data = self.dataset.split(split_ratio=self.split_ratio)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                train_data, valid_data = self.dataset.split(split_ratio=self.split_ratio)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ„å»ºè¯æ±‡è¡¨</span></span><br><span class="line">            <span class="keyword">if</span> self.use_pretrained_word_embedding:</span><br><span class="line">                vectors = Vectors(name=self.word_embedding_path)  <span class="comment"># ä½¿ç”¨é¢„è®­ç»ƒçš„è¯å‘é‡</span></span><br><span class="line">                self.dataset.TEXT.build_vocab(train_data, vectors=vectors,</span><br><span class="line">                                              unk_init=torch.Tensor.normal_)</span><br><span class="line">                self.dataset.LABEL.build_vocab(train_data)</span><br><span class="line">                print(<span class="string">'label types:&#123;&#125;'</span>.format(self.dataset.LABEL.vocab.stoi))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.dataset.TEXT.build_vocab(train_data)  <span class="comment"># ä¸ä½¿ç”¨é¢„è®­ç»ƒçš„è¯å‘é‡</span></span><br><span class="line">                self.dataset.LABEL.build_vocab(train_data)</span><br><span class="line">                print(<span class="string">'label types:&#123;&#125;'</span>.format(self.dataset.LABEL.vocab.stoi))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ„å»ºè¿­ä»£å™¨</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> train_data:</span><br><span class="line">                train_iter = Iterator(train_data, batch_size=self.batch_size, device=self.device,</span><br><span class="line">                                      sort_key=self.sort_key,</span><br><span class="line">                                      sort_within_batch=self.sort_within_batch, repeat=self.repeat,</span><br><span class="line">                                      batch_size_fn=self.batch_size_fn</span><br><span class="line">                                      , train=self.train, shuffle=self.shuffle, sort=self.sort)</span><br><span class="line">            <span class="keyword">if</span> valid_data:</span><br><span class="line">                valid_iter = Iterator(valid_data, batch_size=self.batch_size, device=self.device,</span><br><span class="line">                                      sort_key=self.sort_key,</span><br><span class="line">                                      sort_within_batch=self.sort_within_batch, repeat=self.repeat,</span><br><span class="line">                                      batch_size_fn=self.batch_size_fn</span><br><span class="line">                                      , train=self.train, shuffle=self.shuffle, sort=self.sort)</span><br><span class="line">            <span class="keyword">if</span> test_data:</span><br><span class="line">                test_iter = Iterator(test_data, batch_size=self.batch_size, device=self.device, sort_key=self.sort_key,</span><br><span class="line">                                     sort_within_batch=self.sort_within_batch, repeat=self.repeat,</span><br><span class="line">                                     batch_size_fn=self.batch_size_fn</span><br><span class="line">                                     , train=self.train, shuffle=self.shuffle, sort=self.sort)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> train_iter, valid_iter, test_iter</span><br></pre></td></tr></table></figure>
<h4 id="Vocabå±æ€§ï¼š"><a href="#Vocabå±æ€§ï¼š" class="headerlink" title="Vocabå±æ€§ï¼š"></a>Vocabå±æ€§ï¼š</h4><ol>
<li>freqs</li>
<li>itos</li>
<li>stoi</li>
<li>vectors</li>
</ol>
<h4 id="Bert-Dataprocess"><a href="#Bert-Dataprocess" class="headerlink" title="Bert Dataprocess"></a>Bert Dataprocess</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertDataProcess</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data_path, batch_size, device, processed_data_path=None, bert_model_path=None)</span>:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        self.bert_model_path = bert_model_path</span><br><span class="line">        self.bert_tokenizer = BertTokenizer.from_pretrained(bert_model_path)</span><br><span class="line">        self.CLS = self.bert_tokenizer.cls_token</span><br><span class="line">        self.data_path = data_path</span><br><span class="line">        self.batch_size = batch_size</span><br><span class="line">        self.device = device</span><br><span class="line">        self.processed_data_path = processed_data_path  <span class="comment"># ç»è¿‡load_data å¤„ç†è¿‡çš„æ•°æ®ä¿å­˜åˆ°è¯¥è·¯å¾„ä¸‹ã€‚</span></span><br><span class="line">        self.train_data,self.val_data = self.built_dataset()</span><br><span class="line">        self.train_iter = self.built_iterater(self.train_data)</span><br><span class="line">        self.val_iter = self.built_iterater(self.val_data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load_dataset</span><span class="params">(self, path)</span>:</span></span><br><span class="line">        contents = []</span><br><span class="line">        <span class="keyword">with</span> open(path, <span class="string">'r'</span>, encoding=<span class="string">'UTF-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> tqdm(f):</span><br><span class="line">                lin = line.strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="string">'label,review'</span> <span class="keyword">in</span> lin:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> lin:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                label, content = lin.split(<span class="string">','</span>,<span class="number">1</span>)</span><br><span class="line">                <span class="comment"># print("content&gt;&gt;&gt;:", content)</span></span><br><span class="line">                token = self.bert_tokenizer.tokenize(content)</span><br><span class="line">                token = [self.CLS] + token</span><br><span class="line">                seq_len = len(token)</span><br><span class="line">                token_ids = self.bert_tokenizer.convert_tokens_to_ids(token)</span><br><span class="line">                contents.append((token_ids, int(label), seq_len))</span><br><span class="line">        <span class="keyword">return</span> contents</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">built_dataset</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.processed_data_path):</span><br><span class="line">            all_data = self.load_dataset(self.data_path)</span><br><span class="line">            pickle.dump(all_data, open(self.processed_data_path,<span class="string">'wb'</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            all_data = pickle.load(open(self.processed_data_path,<span class="string">'rb'</span>))</span><br><span class="line"></span><br><span class="line">        train_data, val_data = train_test_split(all_data, test_size=<span class="number">0.3</span>, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> train_data, val_data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">built_iterater</span><span class="params">(self, dataset)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> BertDatasetIterater(dataset, self.batch_size, self.device,self.bert_model_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertDatasetIterater</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, batches, batch_size, device,bert_model_path)</span>:</span></span><br><span class="line">        self.bert_tokenizer = BertTokenizer.from_pretrained(bert_model_path)</span><br><span class="line"></span><br><span class="line">        self.batch_size = batch_size</span><br><span class="line">        self.batches = batches</span><br><span class="line">        self.n_batches = len(batches) // batch_size</span><br><span class="line">        self.residue = <span class="literal">False</span>  <span class="comment"># è®°å½•batchæ•°é‡æ˜¯å¦ä¸ºæ•´æ•°</span></span><br><span class="line">        <span class="keyword">if</span> len(batches) % self.n_batches != <span class="number">0</span>:</span><br><span class="line">            self.residue = <span class="literal">True</span></span><br><span class="line">        self.index = <span class="number">0</span></span><br><span class="line">        self.device = device</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_mask_sentence_len</span><span class="params">(self,content,max_sent_len)</span>:</span></span><br><span class="line">        pad_index = self.bert_tokenizer.pad_token_id</span><br><span class="line">        sent_len = len(content)</span><br><span class="line">        mask = [<span class="number">1</span>]*sent_len + ([<span class="number">0</span>] * (max_sent_len-sent_len))</span><br><span class="line">        content = content.extend([pad_index] * (max_sent_len-sent_len))</span><br><span class="line">        <span class="keyword">return</span> mask</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_to_tensor</span><span class="params">(self, datas)</span>:</span></span><br><span class="line">        datas = pd.DataFrame(datas,columns=[<span class="string">'content'</span>,<span class="string">'label'</span>,<span class="string">'sent len'</span>])</span><br><span class="line">        max_sent_len = max(datas[<span class="string">'sent len'</span>])</span><br><span class="line">        datas[<span class="string">"mask"</span>] = datas[<span class="string">"content"</span>].apply(self._mask_sentence_len,args=&#123;max_sent_len&#125;)</span><br><span class="line"></span><br><span class="line">        x = torch.LongTensor(pd.DataFrame(datas[<span class="string">'content'</span>].to_list()).values).to(self.device)</span><br><span class="line">        y = torch.FloatTensor(datas[<span class="string">'label'</span>].values).to(self.device)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># padå‰çš„é•¿åº¦(è¶…è¿‡pad_sizeçš„è®¾ä¸ºpad_size)</span></span><br><span class="line">        seq_len = torch.LongTensor(datas[<span class="string">'sent len'</span>]).to(self.device)</span><br><span class="line">        mask = torch.LongTensor(pd.DataFrame(datas[<span class="string">'mask'</span>].to_list()).values).to(self.device)</span><br><span class="line">        <span class="keyword">return</span> (x, seq_len, mask), y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.residue <span class="keyword">and</span> self.index == self.n_batches:</span><br><span class="line">            batches = self.batches[self.index * self.batch_size: len(self.batches)]</span><br><span class="line">            self.index += <span class="number">1</span></span><br><span class="line">            batches = self._to_tensor(batches)</span><br><span class="line">            <span class="keyword">return</span> batches</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> self.index &gt; self.n_batches:</span><br><span class="line">            self.index = <span class="number">0</span></span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            batches = self.batches[self.index * self.batch_size: (self.index + <span class="number">1</span>) * self.batch_size]</span><br><span class="line">            self.index += <span class="number">1</span></span><br><span class="line">            batches = self._to_tensor(batches)</span><br><span class="line">            <span class="keyword">return</span> batches</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.residue:</span><br><span class="line">            <span class="keyword">return</span> self.n_batches + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self.n_batches</span><br></pre></td></tr></table></figure>
<h3 id="FastText"><a href="#FastText" class="headerlink" title="FastText"></a>FastText</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>fastTextæ˜¯Facebookäº2016å¹´å¼€æºçš„ä¸€ä¸ªè¯å‘é‡è®¡ç®—å’Œæ–‡æœ¬åˆ†ç±»å·¥å…·ã€‚åœ¨æ–‡æœ¬åˆ†ç±»ä»»åŠ¡ä¸­ï¼ŒfastTextï¼ˆæµ…å±‚ç½‘ç»œï¼‰å¾€å¾€èƒ½å–å¾—å’Œæ·±åº¦ç½‘ç»œç›¸åª²ç¾çš„ç²¾åº¦ï¼Œå´åœ¨è®­ç»ƒæ—¶é—´ä¸Šæ¯”æ·±åº¦ç½‘ç»œå¿«è®¸å¤šæ•°é‡çº§ã€‚åœ¨æ ‡å‡†çš„å¤šæ ¸CPUä¸Šï¼Œ åœ¨10åˆ†é’Ÿä¹‹å†…èƒ½å¤Ÿè®­ç»ƒ10äº¿è¯çº§åˆ«è¯­æ–™åº“çš„è¯å‘é‡ï¼Œåœ¨1åˆ†é’Ÿä¹‹å†…èƒ½å¤Ÿåˆ†ç±»æœ‰ç€30ä¸‡å¤šç±»åˆ«çš„50å¤šä¸‡å¥å­ã€‚</p>
<p>fastTextæ˜¯ä¸€ä¸ªå¿«é€Ÿæ–‡æœ¬åˆ†ç±»ç®—æ³•ï¼Œä¸åŸºäºç¥ç»ç½‘ç»œçš„åˆ†ç±»ç®—æ³•ç›¸æ¯”æœ‰ä¸¤å¤§ä¼˜ç‚¹ï¼š<br>1ã€fastTextåœ¨ä¿æŒé«˜ç²¾åº¦çš„æƒ…å†µä¸‹åŠ å¿«äº†è®­ç»ƒé€Ÿåº¦å’Œæµ‹è¯•é€Ÿåº¦<br>2ã€fastTextä¸éœ€è¦é¢„è®­ç»ƒå¥½çš„è¯å‘é‡ï¼ŒfastTextä¼šè‡ªå·±è®­ç»ƒè¯å‘é‡<br>3ã€fastTextä¸¤ä¸ªé‡è¦çš„ä¼˜åŒ–ï¼šHierarchical Softmaxã€N-gram</p>
<h4 id="fastTextæ¨¡å‹æ¶æ„"><a href="#fastTextæ¨¡å‹æ¶æ„" class="headerlink" title="fastTextæ¨¡å‹æ¶æ„"></a>fastTextæ¨¡å‹æ¶æ„</h4><p>fastTextæ¨¡å‹æ¶æ„å’Œword2vecä¸­çš„CBOWå¾ˆç›¸ä¼¼ï¼Œ ä¸åŒä¹‹å¤„æ˜¯fastTexté¢„æµ‹æ ‡ç­¾è€ŒCBOWé¢„æµ‹çš„æ˜¯ä¸­é—´è¯ï¼Œå³æ¨¡å‹æ¶æ„ç±»ä¼¼ä½†æ˜¯æ¨¡å‹çš„ä»»åŠ¡ä¸åŒã€‚ä¸‹é¢æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹CBOWçš„æ¶æ„ï¼š</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/cbow.png" alt="avatar"></p>
<p>word2vecå°†ä¸Šä¸‹æ–‡å…³ç³»è½¬åŒ–ä¸ºå¤šåˆ†ç±»ä»»åŠ¡ï¼Œè¿›è€Œè®­ç»ƒé€»è¾‘å›å½’æ¨¡å‹ï¼Œè¿™é‡Œçš„ç±»åˆ«æ•°é‡|V|è¯åº“å¤§å°ã€‚é€šå¸¸çš„æ–‡æœ¬æ•°æ®ä¸­ï¼Œè¯åº“å°‘åˆ™æ•°ä¸‡ï¼Œå¤šåˆ™ç™¾ä¸‡ï¼Œåœ¨è®­ç»ƒä¸­ç›´æ¥è®­ç»ƒå¤šåˆ†ç±»é€»è¾‘å›å½’å¹¶ä¸ç°å®ã€‚word2vecä¸­æä¾›äº†ä¸¤ç§é’ˆå¯¹å¤§è§„æ¨¡å¤šåˆ†ç±»é—®é¢˜çš„ä¼˜åŒ–æ‰‹æ®µï¼Œ negative sampling å’Œhierarchical softmaxã€‚åœ¨ä¼˜åŒ–ä¸­ï¼Œnegative sampling åªæ›´æ–°å°‘é‡è´Ÿé¢ç±»ï¼Œä»è€Œå‡è½»äº†è®¡ç®—é‡ã€‚hierarchical softmax å°†è¯åº“è¡¨ç¤ºæˆå‰ç¼€æ ‘ï¼Œä»æ ‘æ ¹åˆ°å¶å­çš„è·¯å¾„å¯ä»¥è¡¨ç¤ºä¸ºä¸€ç³»åˆ—äºŒåˆ†ç±»å™¨ï¼Œä¸€æ¬¡å¤šåˆ†ç±»è®¡ç®—çš„å¤æ‚åº¦ä»|V|é™ä½åˆ°äº†æ ‘çš„é«˜åº¦<br>fastTextæ¨¡å‹æ¶æ„:å…¶ä¸­x1,x2,â€¦,xNâˆ’1,xNè¡¨ç¤ºä¸€ä¸ªæ–‡æœ¬ä¸­çš„n-gramå‘é‡ï¼Œæ¯ä¸ªç‰¹å¾æ˜¯è¯å‘é‡çš„å¹³å‡å€¼ã€‚è¿™å’Œå‰æ–‡ä¸­æåˆ°çš„cbowç›¸ä¼¼ï¼Œcbowç”¨ä¸Šä¸‹æ–‡å»é¢„æµ‹ä¸­å¿ƒè¯ï¼Œè€Œæ­¤å¤„ç”¨å…¨éƒ¨çš„n-gramå»é¢„æµ‹æŒ‡å®šç±»åˆ«</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/fasttext.png" alt="avatar"></p>
<h4 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h4><blockquote>
<p>æˆ‘ä¸å–œæ¬¢è¿™ç±»ç”µå½±ï¼Œä½†æ˜¯å–œæ¬¢è¿™ä¸€ä¸ªã€‚</p>
<p>æˆ‘å–œæ¬¢è¿™ç±»ç”µå½±ï¼Œä½†æ˜¯ä¸å–œæ¬¢è¿™ä¸€ä¸ªã€‚</p>
</blockquote>
<p><strong>è¿™æ ·çš„ä¸¤å¥å¥å­ç»è¿‡è¯å‘é‡å¹³å‡ä»¥åå·²ç»é€å…¥å•å±‚ç¥ç»ç½‘ç»œçš„æ—¶å€™å·²ç»å®Œå…¨ä¸€æ¨¡ä¸€æ ·äº†ï¼Œåˆ†ç±»å™¨ä¸å¯èƒ½åˆ†è¾¨å‡ºè¿™ä¸¤å¥è¯çš„åŒºåˆ«</strong>ï¼Œåªæœ‰æ·»åŠ n-gramç‰¹å¾ä»¥åæ‰å¯èƒ½æœ‰åŒºåˆ«ã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨çš„æ—¶å€™éœ€è¦å¯¹æ•°æ®æœ‰è¶³å¤Ÿçš„äº†è§£,ç„¶ååœ¨é€‰æ‹©æ¨¡å‹ã€‚</p>
<h4 id="æ¨¡å‹ä»£ç "><a href="#æ¨¡å‹ä»£ç " class="headerlink" title="æ¨¡å‹ä»£ç "></a>æ¨¡å‹ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FastText</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab, embedding_dim, output_dim, use_pretrain_embedding=False)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.embedding_dim = embedding_dim</span><br><span class="line">        <span class="keyword">if</span> use_pretrain_embedding:</span><br><span class="line">            self.embedding = nn.Embedding.from_pretrained(vocab.vectors)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.embedding = nn.Embedding(len(vocab), embedding_dim, padding_idx=vocab.pad_index)</span><br><span class="line">        <span class="comment"># æŠŠunknown å’Œ pad å‘é‡è®¾ç½®ä¸ºé›¶</span></span><br><span class="line">        self.embedding.weight.data[vocab.unk_index] = torch.zeros(embedding_dim)</span><br><span class="line">        self.embedding.weight.data[vocab.pad_index] = torch.zeros(embedding_dim)</span><br><span class="line"></span><br><span class="line">        self.fc = nn.Linear(embedding_dim, output_dim)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text,text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text = [sent len, batch size]</span></span><br><span class="line"></span><br><span class="line">        embedded = self.embedding(text)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [sent len, batch size, emb dim]</span></span><br><span class="line"></span><br><span class="line">        embedded = embedded.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [batch size, sent len, emb dim]</span></span><br><span class="line"></span><br><span class="line">        pooled = F.avg_pool2d(embedded, (embedded.shape[<span class="number">1</span>], <span class="number">1</span>)).squeeze(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pooled = [batch size, embedding_dim]</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.fc(pooled)</span><br></pre></td></tr></table></figure>
<h3 id="TextCNN"><a href="#TextCNN" class="headerlink" title="TextCNN"></a>TextCNN</h3><h4 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p><strong>Yoon Kim</strong>åœ¨è®ºæ–‡<a href="https://arxiv.org/abs/1408.5882" target="_blank" rel="noopener">(2014 EMNLP) Convolutional Neural Networks for Sentence Classification</a>æå‡ºTextCNNã€‚</p>
<p>å°†<strong>å·ç§¯ç¥ç»ç½‘ç»œCNN</strong>åº”ç”¨åˆ°<strong>æ–‡æœ¬åˆ†ç±»</strong>ä»»åŠ¡ï¼Œåˆ©ç”¨<strong>å¤šä¸ªä¸åŒsizeçš„kernel</strong>æ¥æå–å¥å­ä¸­çš„å…³é”®ä¿¡æ¯ï¼ˆç±»ä¼¼äºå¤šçª—å£å¤§å°çš„ngram)ï¼Œä»è€Œèƒ½å¤Ÿæ›´å¥½åœ°æ•æ‰å±€éƒ¨ç›¸å…³æ€§ã€‚</p>
<h4 id="ç½‘ç»œç»“æ„"><a href="#ç½‘ç»œç»“æ„" class="headerlink" title="ç½‘ç»œç»“æ„"></a>ç½‘ç»œç»“æ„</h4><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/textcnn.png" alt="avatar"></p>
<h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>TextCNNçš„è¯¦ç»†è¿‡ç¨‹åŸç†å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/textcnndetail.png" alt="avatar"></p>
<p>TextCNNè¯¦ç»†è¿‡ç¨‹ï¼š</p>
<ul>
<li><strong>Embedding</strong>ï¼šç¬¬ä¸€å±‚æ˜¯å›¾ä¸­æœ€å·¦è¾¹çš„7ä¹˜5çš„å¥å­çŸ©é˜µï¼Œæ¯è¡Œæ˜¯è¯å‘é‡ï¼Œç»´åº¦=5ï¼Œè¿™ä¸ªå¯ä»¥ç±»æ¯”ä¸ºå›¾åƒä¸­çš„åŸå§‹åƒç´ ç‚¹ã€‚</li>
<li><strong>Convolution</strong>ï¼šç„¶åç»è¿‡ kernel_sizes=(2,3,4) çš„ä¸€ç»´å·ç§¯å±‚ï¼Œæ¯ä¸ªkernel_size æœ‰ä¸¤ä¸ªè¾“å‡º channelã€‚</li>
<li><strong>MaxPolling</strong>ï¼šç¬¬ä¸‰å±‚æ˜¯ä¸€ä¸ª1-max poolingå±‚ï¼Œè¿™æ ·ä¸åŒé•¿åº¦å¥å­ç»è¿‡poolingå±‚ä¹‹åéƒ½èƒ½å˜æˆå®šé•¿çš„è¡¨ç¤ºã€‚</li>
<li><p><strong>FullConnection and Softmax</strong>ï¼šæœ€åæ¥ä¸€å±‚å…¨è¿æ¥çš„ softmax å±‚ï¼Œè¾“å‡ºæ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ã€‚</p>
<p>é€šé“ï¼ˆChannelsï¼‰ï¼š</p>
</li>
<li><p>å›¾åƒä¸­å¯ä»¥åˆ©ç”¨ (R, G, B) ä½œä¸ºä¸åŒchannelï¼›</p>
</li>
<li>æ–‡æœ¬çš„è¾“å…¥çš„channelé€šå¸¸æ˜¯ä¸åŒæ–¹å¼çš„embeddingæ–¹å¼ï¼ˆæ¯”å¦‚ word2vecæˆ–Gloveï¼‰ï¼Œå®è·µä¸­ä¹Ÿæœ‰åˆ©ç”¨é™æ€è¯å‘é‡å’Œfine-tunningè¯å‘é‡ä½œä¸ºä¸åŒchannelçš„åšæ³•ã€‚</li>
</ul>
<p>ä¸€ç»´å·ç§¯ï¼ˆconv-1dï¼‰ï¼š</p>
<ul>
<li>å›¾åƒæ˜¯äºŒç»´æ•°æ®ï¼›</li>
<li><strong>æ–‡æœ¬æ˜¯ä¸€ç»´æ•°æ®ï¼Œå› æ­¤åœ¨TextCNNå·ç§¯ç”¨çš„æ˜¯ä¸€ç»´å·ç§¯</strong>ï¼ˆåœ¨<strong>word-level</strong>ä¸Šæ˜¯ä¸€ç»´å·ç§¯ï¼›è™½ç„¶æ–‡æœ¬ç»è¿‡è¯å‘é‡è¡¨è¾¾åæ˜¯äºŒç»´æ•°æ®ï¼Œä½†æ˜¯åœ¨embedding-levelä¸Šçš„äºŒç»´å·ç§¯æ²¡æœ‰æ„ä¹‰ï¼‰ã€‚ä¸€ç»´å·ç§¯å¸¦æ¥çš„é—®é¢˜æ˜¯éœ€è¦<strong>é€šè¿‡è®¾è®¡ä¸åŒ kernel_size çš„ filter è·å–ä¸åŒå®½åº¦çš„è§†é‡</strong>ã€‚</li>
</ul>
<h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><p>TextCNNæ¨¡å‹æœ€å¤§çš„é—®é¢˜ä¹Ÿæ˜¯è¿™ä¸ªå…¨å±€çš„max poolingä¸¢å¤±äº†ç»“æ„ä¿¡æ¯ï¼Œå› æ­¤å¾ˆéš¾å»å‘ç°æ–‡æœ¬ä¸­çš„è½¬æŠ˜å…³ç³»ç­‰å¤æ‚æ¨¡å¼ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å°è¯•k-max poolingåšä¸€äº›ä¼˜åŒ–ï¼Œk-max poolingé’ˆå¯¹æ¯ä¸ªå·ç§¯æ ¸éƒ½ä¸åªä¿ç•™æœ€å¤§çš„å€¼ï¼Œä»–ä¿ç•™å‰kä¸ªæœ€å¤§å€¼ï¼Œå¹¶ä¸”ä¿ç•™è¿™äº›å€¼å‡ºç°çš„é¡ºåºï¼Œä¹Ÿå³æŒ‰ç…§æ–‡æœ¬ä¸­çš„ä½ç½®é¡ºåºæ¥æ’åˆ—è¿™kä¸ªæœ€å¤§å€¼ã€‚åœ¨æŸäº›æ¯”è¾ƒå¤æ‚çš„æ–‡æœ¬ä¸Šç›¸å¯¹äº1-max poolingä¼šæœ‰æå‡ã€‚</p>
<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextCNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab, embedding_dim, n_filters, filter_sizes, output_dim,</span></span></span><br><span class="line"><span class="function"><span class="params">                 dropout, use_pretrain_embedding=False)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.embedding_dim = embedding_dim</span><br><span class="line">        <span class="keyword">if</span> use_pretrain_embedding:</span><br><span class="line">            self.embedding = nn.Embedding.from_pretrained(vocab.vectors)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.embedding = nn.Embedding(len(vocab), embedding_dim, padding_idx=vocab.pad_index)</span><br><span class="line">        <span class="comment"># æŠŠunknown å’Œ pad å‘é‡è®¾ç½®ä¸ºé›¶</span></span><br><span class="line">        self.embedding.weight.data[vocab.unk_index] = torch.zeros(embedding_dim)</span><br><span class="line">        self.embedding.weight.data[vocab.pad_index] = torch.zeros(embedding_dim)</span><br><span class="line"></span><br><span class="line">        self.convs = nn.ModuleList([</span><br><span class="line">            nn.Conv2d(in_channels=<span class="number">1</span>,</span><br><span class="line">                      out_channels=n_filters,</span><br><span class="line">                      kernel_size=(fs, embedding_dim))</span><br><span class="line">            <span class="keyword">for</span> fs <span class="keyword">in</span> filter_sizes</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">        self.fc = nn.Linear(len(filter_sizes) * n_filters, output_dim)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text,text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text = [batch size, sent len]</span></span><br><span class="line"></span><br><span class="line">        embedded = self.embedding(text)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [batch size, sent len, emb dim]</span></span><br><span class="line"></span><br><span class="line">        embedded = embedded.unsqueeze(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [batch size, 1, sent len, emb dim]</span></span><br><span class="line"></span><br><span class="line">        conved = [F.relu(conv(embedded)).squeeze(<span class="number">3</span>) <span class="keyword">for</span> conv <span class="keyword">in</span> self.convs]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># conved_n = [batch size, n_filters, sent len - filter_sizes[n] + 1]</span></span><br><span class="line"></span><br><span class="line">        pooled = [F.max_pool1d(conv, conv.shape[<span class="number">2</span>]).squeeze(<span class="number">2</span>) <span class="keyword">for</span> conv <span class="keyword">in</span> conved]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pooled_n = [batch size, n_filters]</span></span><br><span class="line"></span><br><span class="line">        cat = self.dropout(torch.cat(pooled, dim=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># cat = [batch size, n_filters * len(filter_sizes)]</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.fc(cat)</span><br></pre></td></tr></table></figure>
<h3 id="HANï¼ˆHierarchy-Attention-Networkï¼‰"><a href="#HANï¼ˆHierarchy-Attention-Networkï¼‰" class="headerlink" title="HANï¼ˆHierarchy Attention Networkï¼‰"></a>HANï¼ˆHierarchy Attention Networkï¼‰</h3><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/HAN.png" alt="avatar"></p>
<p>æ•´ä¸ªç½‘ç»œç»“æ„åŒ…æ‹¬äº”ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>è¯åºåˆ—ç¼–ç å™¨</li>
<li>åŸºäºè¯çº§çš„æ³¨æ„åŠ›å±‚</li>
<li>å¥å­ç¼–ç å™¨</li>
<li>åŸºäºå¥å­çº§çš„æ³¨æ„åŠ›å±‚</li>
<li>åˆ†ç±»</li>
</ol>
<p>æ•´ä¸ªç½‘ç»œç»“æ„ç”±åŒå‘GRUç½‘ç»œå’Œæ³¨æ„åŠ›æœºåˆ¶ç»„åˆè€Œæˆã€‚</p>
<h4 id="è¯åºåˆ—ç¼–ç å™¨"><a href="#è¯åºåˆ—ç¼–ç å™¨" class="headerlink" title="è¯åºåˆ—ç¼–ç å™¨"></a>è¯åºåˆ—ç¼–ç å™¨</h4><p>ç»™å®šä¸€ä¸ªå¥å­ä¸­çš„å•è¯$w_{it}$ï¼Œå…¶ä¸­ $i$ è¡¨ç¤ºç¬¬$i$ ä¸ªå¥å­ï¼Œ$t$ è¡¨ç¤ºç¬¬ $t$ ä¸ªè¯ã€‚é€šè¿‡ä¸€ä¸ªè¯åµŒå…¥çŸ©é˜µ $W_e$ å°†å•è¯è½¬æ¢æˆå‘é‡è¡¨ç¤ºï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<script type="math/tex; mode=display">
x_{it}=W_e w_{it}</script><p>åˆ©ç”¨åŒå‘GRUå®ç°çš„æ•´ä¸ªç¼–ç æµç¨‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
x_{i t} &=W_{e} w_{i t}, t \in[1, T] \\
\overrightarrow{h}_{i t} &=\overrightarrow{\operatorname{GRU}}\left(x_{i t}\right), t \in[1, T] \\
\overleftarrow{h}_{i t} &=\overleftarrow{\operatorname{GRU}}\left(x_{i t}\right), t \in[T, 1] \\
{h}_{i t} &= [\overrightarrow{h}_{i t},\overleftarrow{h}_{i t} ]
\end{aligned}</script><h4 id="è¯çº§çš„æ³¨æ„åŠ›å±‚"><a href="#è¯çº§çš„æ³¨æ„åŠ›å±‚" class="headerlink" title="è¯çº§çš„æ³¨æ„åŠ›å±‚"></a>è¯çº§çš„æ³¨æ„åŠ›å±‚</h4><p>ä½†æ˜¯å¯¹äºä¸€å¥è¯ä¸­çš„å•è¯ï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªå•è¯å¯¹åˆ†ç±»ä»»åŠ¡éƒ½æ˜¯æœ‰ç”¨çš„ï¼Œæ¯”å¦‚åœ¨åšæ–‡æœ¬çš„æƒ…ç»ªåˆ†ç±»æ—¶ï¼Œå¯èƒ½æˆ‘ä»¬å°±ä¼šæ¯”è¾ƒå…³æ³¨â€œå¾ˆå¥½â€ã€â€œä¼¤æ„Ÿâ€è¿™äº›è¯ã€‚ä¸ºäº†èƒ½ä½¿å¾ªç¯ç¥ç»ç½‘ç»œä¹Ÿèƒ½è‡ªåŠ¨å°†â€œæ³¨æ„åŠ›â€æ”¾åœ¨è¿™äº›è¯æ±‡ä¸Šï¼Œä½œè€…è®¾è®¡äº†åŸºäºå•è¯çš„æ³¨æ„åŠ›å±‚çš„å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
u_{i t} &=\tanh \left(W_{w} h_{i t}+b_{w}\right) \\
\alpha_{i t} &=\frac{\exp \left(u_{i t}^{\top} u_{w}\right)}{\sum_{t} \exp \left(u_{i t}^{\top} u_{w}\right)} \\
s_{i} &=\sum_{t} \alpha_{i t} h_{i t}
\end{aligned}</script><p>ä¸Šé¢å¼å­ä¸­ï¼Œ$u_{it}$ æ˜¯ $h_{it}$ çš„éšå±‚è¡¨ç¤ºï¼Œ$a_{it}$ æ˜¯ç» softmax å‡½æ•°å¤„ç†åçš„å½’ä¸€åŒ–æƒé‡ç³»æ•°ï¼Œ$u_w$æ˜¯ä¸€ä¸ªéšæœºåˆå§‹åŒ–çš„å‘é‡ï¼Œä¹‹åä¼šä½œä¸ºæ¨¡å‹çš„å‚æ•°ä¸€èµ·è¢«è®­ç»ƒï¼Œ$s_i$ å°±æ˜¯æˆ‘ä»¬å¾—åˆ°çš„ç¬¬ i ä¸ªå¥å­çš„å‘é‡è¡¨ç¤ºã€‚</p>
<h4 id="å¥å­ç¼–ç å™¨"><a href="#å¥å­ç¼–ç å™¨" class="headerlink" title="å¥å­ç¼–ç å™¨"></a>å¥å­ç¼–ç å™¨</h4><p>å¥å­ç¼–ç å™¨ä¹Ÿæ˜¯åŸºäºåŒå‘GRUå®ç°ç¼–ç çš„ï¼Œ</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\overrightarrow{h}_{i}=\overrightarrow{\operatorname{GRU}}\left(s_{i}\right), i \in[1, L]\\
&\overleftarrow{h}_{i}=\overleftarrow{\operatorname{GRU}}\left(s_{i}\right), t \in[L, 1]
\end{aligned}</script><p>å…¬å¼å’Œè¯ç¼–ç ç±»ä¼¼ï¼Œæœ€åçš„ $h_i$ ä¹Ÿæ˜¯é€šè¿‡æ‹¼æ¥å¾—åˆ°çš„.</p>
<h4 id="å¥å­çº§æ³¨æ„åŠ›å±‚"><a href="#å¥å­çº§æ³¨æ„åŠ›å±‚" class="headerlink" title="å¥å­çº§æ³¨æ„åŠ›å±‚"></a>å¥å­çº§æ³¨æ„åŠ›å±‚</h4><p>æ³¨æ„åŠ›å±‚çš„æµç¨‹å¦‚ä¸‹ï¼Œå’Œè¯çº§çš„ä¸€è‡´:</p>
<script type="math/tex; mode=display">
\begin{aligned}
u_{i} &=\tanh \left(W_{s} h_{i}+b_{s}\right) \\
\alpha_{i} &=\frac{\exp \left(u_{i}^{\top} u_{s}\right)}{\sum_{i} \exp \left(u_{i}^{\top} u_{s}\right)} \\
v &=\sum_{i} \alpha_{i} h_{i}
\end{aligned}</script><p>æœ€åå¾—åˆ°çš„å‘é‡$v$ å°±æ˜¯æ–‡æ¡£çš„å‘é‡è¡¨ç¤ºï¼Œè¿™æ˜¯æ–‡æ¡£çš„é«˜å±‚è¡¨ç¤ºã€‚æ¥ä¸‹æ¥å°±å¯ä»¥ç”¨å¯ä»¥ç”¨è¿™ä¸ªå‘é‡è¡¨ç¤ºä½œä¸ºæ–‡æ¡£çš„ç‰¹å¾ã€‚</p>
<h4 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h4><p>ä½¿ç”¨æœ€å¸¸ç”¨çš„softmaxåˆ†ç±»å™¨å¯¹æ•´ä¸ªæ–‡æœ¬è¿›è¡Œåˆ†ç±»äº†</p>
<script type="math/tex; mode=display">
p=\operatorname{softmax}\left(W_{c} v+b_{c}\right)</script><p>æŸå¤±å‡½æ•°</p>
<script type="math/tex; mode=display">
L=-\sum_{d} \log p_{d j}</script><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><h3 id="RNNç³»åˆ—"><a href="#RNNç³»åˆ—" class="headerlink" title="RNNç³»åˆ—"></a>RNNç³»åˆ—</h3><p>é€šè¿‡å°†å‰ä¸€æ—¶åˆ»çš„è¿ç®—ç»“æœæ·»åŠ åˆ°å½“å‰çš„è¿ç®—ä¸­ï¼Œä»è€Œå®ç°äº†â€œè€ƒè™‘ä¸Šæ–‡ä¿¡æ¯â€çš„åŠŸèƒ½ã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/rnn.png" alt="avatar"></p>
<p>RNNå¯ä»¥è€ƒè™‘ä¸Šæ–‡çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå¦‚ä½•å°†ä¸‹æ–‡çš„ä¿¡æ¯ä¹Ÿæ·»åŠ è¿›å»å‘¢ï¼Ÿè¿™å°±æ˜¯BiRNNè¦åšçš„äº‹æƒ…ã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/birnn.png" alt="avatar"></p>
<h4 id="LSTM"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h4><p>å› ä¸ºRNNå­˜åœ¨æ¢¯åº¦å¼¥æ•£å’Œæ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ï¼Œæ‰€ä»¥RNNå¾ˆéš¾å®Œç¾åœ°å¤„ç†å…·æœ‰é•¿æœŸä¾èµ–çš„ä¿¡æ¯ã€‚æ—¢ç„¶ä»…ä»…ä¾é ä¸€æ¡çº¿è¿æ¥åé¢çš„ç¥ç»å…ƒä¸è¶³ä»¥è§£å†³é—®é¢˜ï¼Œé‚£ä¹ˆå°±å†åŠ ä¸€æ¡çº¿å¥½äº†ï¼Œè¿™å°±æ˜¯LSTMã€‚</p>
<p>LSTMçš„å…³é”®åœ¨äºç»†èƒçš„çŠ¶æ€å’Œç©¿è¿‡ç»†èƒçš„çº¿ï¼Œç»†èƒçŠ¶æ€ç±»ä¼¼äºä¼ é€å¸¦ã€‚ç›´æ¥åœ¨æ•´ä¸ªé“¾ä¸Šè¿è¡Œï¼Œåªæœ‰ä¸€äº›å°‘é‡çš„çº¿æ€§äº¤äº’ã€‚ä¿¡æ¯åœ¨ä¸Šé¢æµåŠ¨ä¿æŒä¸å˜ä¼šå˜å¾—å®¹æ˜“ã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/lstm_c.png" alt="avatar"></p>
<p>åœ¨LSTMä¸­ï¼Œé—¨å¯ä»¥å®ç°é€‰æ‹©æ€§çš„è®©ä¿¡æ¯é€šè¿‡ï¼Œä¸»è¦é€šè¿‡ä¸€ä¸ªsigmoidçš„ç¥ç»å±‚å’Œä¸€ä¸ªé€ç‚¹ç›¸ä¹˜çš„æ“ä½œæ¥å®ç°ã€‚LSTMé€šè¿‡ä¸‰ä¸ªè¿™æ ·çš„é—¨ç»“æ„æ¥å®ç°ä¿¡æ¯çš„ä¿æŠ¤å’Œæ§åˆ¶ï¼Œåˆ†åˆ«æ˜¯é—å¿˜é—¨ï¼ˆforget gateï¼‰ã€è¾“å…¥é—¨ï¼ˆinput gateï¼‰ä¸è¾“å‡ºé—¨ï¼ˆoutput gateï¼‰ã€‚</p>
<h5 id="é—å¿˜é—¨"><a href="#é—å¿˜é—¨" class="headerlink" title="é—å¿˜é—¨"></a><strong>é—å¿˜é—¨</strong></h5><p>åœ¨LSTMä¸­çš„ç¬¬ä¸€æ­¥æ˜¯å†³å®šä»ç»†èƒçŠ¶æ€ä¸­ä¸¢å¼ƒä»€ä¹ˆä¿¡æ¯ã€‚è¿™ä¸ªå†³å®šé€šè¿‡ä¸€ä¸ªç§°ä¸ºé—å¿˜é—¨çš„ç»“æ„æ¥å®Œæˆã€‚é—å¿˜é—¨ä¼šè¯»å–$h_{t-1}$å’Œ$x_t$ï¼Œè¾“å‡ºä¸€ä¸ª0åˆ°1ä¹‹é—´çš„æ•°å€¼ç»™ç»†èƒçš„çŠ¶æ€$c_{t-1}$ä¸­çš„æ•°å­—ã€‚1è¡¨ç¤ºå®Œå…¨ä¿ç•™ï¼Œ0è¡¨ç¤ºå®Œå…¨èˆå¼ƒã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/lstm_forget_gate.png" alt="avatar"></p>
<h5 id="è¾“å…¥é—¨"><a href="#è¾“å…¥é—¨" class="headerlink" title="è¾“å…¥é—¨"></a><strong>è¾“å…¥é—¨</strong></h5><p>é—å¿˜é—¨å†³å®šè®©å¤šå°‘æ–°çš„ä¿¡æ¯åŠ å…¥åˆ°cellçš„çŠ¶æ€ä¸­æ¥ã€‚å®ç°è¿™ä¸ªéœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><p>é¦–å…ˆä¸€ä¸ªå«â€œinput gate layerâ€çš„sigmoidå±‚å†³å®šå“ªäº›ä¿¡æ¯éœ€è¦æ›´æ–°ï¼›ä¸€ä¸ªtanhå±‚ç”Ÿæˆä¸€ä¸ªå‘é‡ï¼Œç”¨æ¥æ›´æ–°çŠ¶æ€Cã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/input_gate.png" alt="avatar"></p>
</li>
<li><p>æŠŠ 1 ä¸­çš„ä¸¤éƒ¨åˆ†è”åˆèµ·æ¥ï¼Œå¯¹cellçš„çŠ¶æ€è¿›è¡Œæ›´æ–°ï¼Œæˆ‘ä»¬æŠŠæ—§çš„çŠ¶æ€ä¸$f_t$ç›¸ä¹˜ï¼Œä¸¢å¼ƒæ‰æˆ‘ä»¬ç¡®å®šéœ€è¦ä¸¢å¼ƒçš„ä¿¡æ¯ï¼Œæ¥ç€åŠ ä¸Š$i_t * \tilde{C}_{t}$</p>
</li>
</ol>
<h5 id="è¾“å‡ºé—¨"><a href="#è¾“å‡ºé—¨" class="headerlink" title="è¾“å‡ºé—¨"></a>è¾“å‡ºé—¨</h5><p>æœ€ç»ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šè¾“å‡ºä»€ä¹ˆå€¼ï¼Œè¿™ä¸ªè¾“å‡ºå°†ä¼šåŸºäºæˆ‘ä»¬çš„ç»†èƒçš„çŠ¶æ€ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸€ä¸ªè¿‡æ»¤åçš„ç‰ˆæœ¬ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªsigmoidå±‚æ¥ç¡®å®šç»†èƒçŠ¶æ€çš„å“ªäº›éƒ¨åˆ†å°†è¾“å‡ºå‡ºå»ã€‚æ¥ç€ï¼Œæˆ‘ä»¬æŠŠç»†èƒçŠ¶æ€é€šè¿‡tanhè¿›è¡Œå¤„ç†ï¼ˆå¾—åˆ°ä¸€ä¸ª-1åˆ°1ä¹‹é—´çš„å€¼ï¼‰å¹¶å°†å®ƒå’Œsigmoidé—¨çš„è¾“å‡ºç›¸ä¹˜ï¼Œæœ€ç»ˆæˆ‘ä»¬ä»…ä»…ä¼šè¾“å‡ºæˆ‘ä»¬ç¡®å®šè¾“å‡ºçš„éƒ¨åˆ†ã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/output_gate.png" alt="avatar"></p>
<h5 id="å…¬å¼"><a href="#å…¬å¼" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h5><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/lstm_all.png" alt="avatar"></p>
<h4 id="GRU"><a href="#GRU" class="headerlink" title="GRU"></a>GRU</h4><p>åœ¨LSTMä¸­å¼•å…¥äº†ä¸‰ä¸ªé—¨å‡½æ•°ï¼šè¾“å…¥é—¨ã€é—å¿˜é—¨å’Œè¾“å‡ºé—¨æ¥æ§åˆ¶è¾“å…¥å€¼ã€è®°å¿†å€¼å’Œè¾“å‡ºå€¼ã€‚è€Œåœ¨GRUæ¨¡å‹ä¸­åªæœ‰ä¸¤ä¸ªé—¨ï¼šåˆ†åˆ«æ˜¯æ›´æ–°é—¨å’Œé‡ç½®é—¨ã€‚</p>
<p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/GRU.png" alt="avatar"></p>
<p>å›¾ä¸­çš„$z_t$å’Œ$r_t$åˆ†åˆ«è¡¨ç¤ºæ›´æ–°é—¨å’Œé‡ç½®é—¨ã€‚æ›´æ–°é—¨ç”¨äºæ§åˆ¶å‰ä¸€æ—¶åˆ»çš„çŠ¶æ€ä¿¡æ¯è¢«å¸¦å…¥åˆ°å½“å‰çŠ¶æ€ä¸­çš„ç¨‹åº¦ï¼Œæ›´æ–°é—¨çš„å€¼è¶Šå¤§è¯´æ˜å‰ä¸€æ—¶åˆ»çš„çŠ¶æ€ä¿¡æ¯å¸¦å…¥è¶Šå¤šã€‚é‡ç½®é—¨æ§åˆ¶å‰ä¸€çŠ¶æ€æœ‰å¤šå°‘ä¿¡æ¯è¢«å†™å…¥åˆ°å½“å‰çš„å€™é€‰é›† $\tilde{h}_{t}$ä¸Šï¼Œé‡ç½®é—¨è¶Šå°ï¼Œå‰ä¸€çŠ¶æ€çš„ä¿¡æ¯è¢«å†™å…¥çš„è¶Šå°‘ã€‚</p>
<p>LSTMå’ŒCRUéƒ½æ˜¯é€šè¿‡å„ç§é—¨å‡½æ•°æ¥å°†é‡è¦ç‰¹å¾ä¿ç•™ä¸‹æ¥ï¼Œè¿™æ ·å°±ä¿è¯äº†åœ¨long-termä¼ æ’­çš„æ—¶å€™ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚æ­¤å¤–GRUç›¸å¯¹äºLSTMå°‘äº†ä¸€ä¸ªé—¨å‡½æ•°ï¼Œå› æ­¤åœ¨å‚æ•°çš„æ•°é‡ä¸Šä¹Ÿæ˜¯è¦å°‘äºLSTMçš„ï¼Œæ‰€ä»¥æ•´ä½“ä¸ŠGRUçš„è®­ç»ƒé€Ÿåº¦è¦å¿«äºLSTMçš„ã€‚</p>
<h4 id="Self-Attention"><a href="#Self-Attention" class="headerlink" title="Self-Attention"></a>Self-Attention</h4><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/self-attention.png" alt="avatar"></p>
<ol>
<li>Encodeæ‰€æœ‰è¾“å…¥åºåˆ—,å¾—åˆ°å¯¹åº”çš„$h_1,h_2, \cdots ,h_T$(Tä¸ºè¾“å…¥åºåˆ—é•¿åº¦)</li>
<li>Decodeè¾“å‡ºç›®æ ‡$y_t$ä¹‹å‰ï¼Œä¼šå°†ä¸Šä¸€æ­¥è¾“å‡ºçš„éšè—çŠ¶æ€$S_{t-1}$ä¸ä¹‹å‰encodeå¥½çš„$h_1,h_2,\cdots,h_T$è¿›è¡Œæ¯”å¯¹ï¼Œè®¡ç®—ç›¸ä¼¼åº¦ï¼ˆ$e_{t,j}=a(s_{t-1},h_j)$ï¼‰,$h_j$ä¸ºä¹‹å‰ç¬¬jä¸ªè¾“å…¥encodeå¾—åˆ°çš„éšè—å‘é‡ï¼Œaä¸ºä»»æ„ä¸€ç§è®¡ç®—ç›¸ä¼¼åº¦çš„æ–¹å¼</li>
<li>ç„¶åé€šè¿‡softmaxï¼Œå³$a_{t,j}=\frac{exp(e_{t,j})}{\sum^{T_x}_{k=1}exp(e_{t,k})}$å°†ä¹‹å‰å¾—åˆ°çš„å„ä¸ªéƒ¨åˆ†çš„ç›¸å…³ç³»æ•°è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¾—åˆ°$a_{t,1},a_{t,2},\cdots,a_{t,T}$</li>
<li>åœ¨å¯¹è¾“å…¥åºåˆ—çš„éšè—å±‚è¿›è¡Œç›¸å…³æ€§åŠ æƒæ±‚å’Œå¾—åˆ°æ­¤æ—¶decodeéœ€è¦çš„context vector ï¼š$</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RnnModel</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, rnn_type, vocab, embedding_dim, hidden_dim, output_dim, n_layers,</span></span></span><br><span class="line"><span class="function"><span class="params">                 bidirectional, dropout, batch_first=False,use_pretrain_embedding=False)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.embedding_dim = embedding_dim</span><br><span class="line">        <span class="keyword">if</span> use_pretrain_embedding:</span><br><span class="line">            self.embedding = nn.Embedding.from_pretrained(vocab.vectors)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.embedding = nn.Embedding(len(vocab), embedding_dim, padding_idx=vocab.pad_index)</span><br><span class="line">        <span class="comment"># æŠŠunknown å’Œ pad å‘é‡è®¾ç½®ä¸ºé›¶</span></span><br><span class="line">        self.embedding.weight.data[vocab.unk_index] = torch.zeros(embedding_dim)</span><br><span class="line">        self.embedding.weight.data[vocab.pad_index] = torch.zeros(embedding_dim)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(embedding_dim,</span><br><span class="line">                               hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(embedding_dim,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(embedding_dim,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line">        self.fc = nn.Linear(hidden_dim * n_layers, output_dim)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text, text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text = [sent len, batch size]</span></span><br><span class="line"></span><br><span class="line">        embedded = self.dropout(self.embedding(text))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [sent len, batch size, emb dim]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(embedded, text_lengths, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># unpack sequence</span></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.bidirectional:</span><br><span class="line">            hidden = torch.reshape(hidden,(hidden.shape[<span class="number">1</span>],self.hidden_dim * self.n_layers))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            hidden = torch.reshape(hidden, (<span class="number">-1</span>,hidden.shape[<span class="number">1</span>], self.hidden_dim * self.n_layers))</span><br><span class="line">            hidden = torch.mean(hidden,dim=<span class="number">0</span>)</span><br><span class="line">        output = torch.sum(output,dim=<span class="number">0</span>)</span><br><span class="line">        fc_input = self.dropout(output+hidden)</span><br><span class="line">        out = self.fc(fc_input)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h4 id="Rnn-Attenton"><a href="#Rnn-Attenton" class="headerlink" title="Rnn-Attenton"></a>Rnn-Attenton</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RnnAttentionModel</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, rnn_type, vocab, embedding_dim, hidden_dim, output_dim, n_layers,</span></span></span><br><span class="line"><span class="function"><span class="params">                 bidirectional, dropout, batch_first=False,use_pretrain_embedding=False)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.embedding_dim = embedding_dim</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> use_pretrain_embedding:</span><br><span class="line">            self.embedding = nn.Embedding.from_pretrained(vocab.vectors)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.embedding = nn.Embedding(len(vocab), embedding_dim, padding_idx=vocab.pad_index)</span><br><span class="line">        <span class="comment"># æŠŠunknown å’Œ pad å‘é‡è®¾ç½®ä¸ºé›¶</span></span><br><span class="line">        self.embedding.weight.data[vocab.unk_index] = torch.zeros(embedding_dim)</span><br><span class="line">        self.embedding.weight.data[vocab.pad_index] = torch.zeros(embedding_dim)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(embedding_dim,</span><br><span class="line">                               hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(embedding_dim,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(embedding_dim,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        self.tanh1 = nn.Tanh()</span><br><span class="line">        self.tanh2 = nn.Tanh()</span><br><span class="line">        <span class="comment"># self.u = nn.Parameter(torch.Tensor(self.hidden_dim * 2,self.hidden_dim*2))</span></span><br><span class="line">        self.w = nn.Parameter(torch.randn(hidden_dim),requires_grad=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        <span class="keyword">if</span> bidirectional:</span><br><span class="line">            self.w = nn.Parameter(torch.randn(hidden_dim * <span class="number">2</span>), requires_grad=<span class="literal">True</span>)</span><br><span class="line">            self.fc = nn.Linear(hidden_dim * <span class="number">2</span>, output_dim)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.w = nn.Parameter(torch.randn(hidden_dim), requires_grad=<span class="literal">True</span>)</span><br><span class="line">            self.fc = nn.Linear(hidden_dim, output_dim)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text, text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text = [sent len, batch size]</span></span><br><span class="line"></span><br><span class="line">        embedded = self.dropout(self.embedding(text))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [sent len, batch size, emb dim]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(embedded, text_lengths, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># unpack sequence</span></span><br><span class="line">        <span class="comment"># output = [sent len, batch size, hidden dim * num_direction]</span></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># attention</span></span><br><span class="line">        <span class="comment"># M = [sent len, batch size, hidden dim * num_direction]</span></span><br><span class="line">        <span class="comment"># M = self.tanh1(output)</span></span><br><span class="line"></span><br><span class="line">        alpha = F.softmax(torch.matmul(self.tanh1(output), self.w), dim=<span class="number">0</span>).unsqueeze(<span class="number">-1</span>) <span class="comment"># dim=0è¡¨ç¤ºé’ˆå¯¹æ–‡æœ¬ä¸­çš„æ¯ä¸ªè¯çš„è¾“å‡ºsoftmax</span></span><br><span class="line">        output_attention = output * alpha</span><br><span class="line"></span><br><span class="line">        <span class="comment"># hidden = [n_layers * num_direction,batch_size, hidden_dim]</span></span><br><span class="line">        <span class="keyword">if</span> self.bidirectional:</span><br><span class="line">            hidden = torch.mean(torch.reshape(hidden, (<span class="number">-1</span>,hidden.shape[<span class="number">1</span>], self.hidden_dim * <span class="number">2</span>)),dim=<span class="number">0</span>)  <span class="comment"># hidden = [batch_size, hidden_dim * num_direction]</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            hidden = torch.mean(torch.reshape(hidden, (<span class="number">-1</span>, hidden.shape[<span class="number">1</span>], self.hidden_dim)), dim=<span class="number">0</span>)   <span class="comment"># hidden = [batch_size, hidden_dim]</span></span><br><span class="line"></span><br><span class="line">        output_attention = torch.sum(output_attention,dim=<span class="number">0</span>)</span><br><span class="line">        output = torch.sum(output,dim=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        fc_input = self.dropout(output+output_attention+hidden)</span><br><span class="line">        <span class="comment"># fc_input = self.dropout(output_attention)</span></span><br><span class="line">        out = self.fc(fc_input)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h3 id="TextRCNN"><a href="#TextRCNN" class="headerlink" title="TextRCNN"></a>TextRCNN</h3><h4 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>å°±æ·±åº¦å­¦ä¹ é¢†åŸŸæ¥è¯´ï¼ŒRNNå’ŒCNNä½œä¸ºæ–‡æœ¬åˆ†ç±»é—®é¢˜çš„ä¸»è¦æ¨¡å‹æ¶æ„ï¼Œéƒ½å­˜åœ¨å„è‡ªçš„ä¼˜ç‚¹åŠå±€é™æ€§ã€‚RNNæ“…é•¿å¤„ç†åºåˆ—ç»“æ„ï¼Œèƒ½å¤Ÿè€ƒè™‘åˆ°å¥å­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä½†RNNå±äºâ€œbiased modelâ€ï¼Œä¸€ä¸ªå¥å­ä¸­è¶Šå¾€åçš„è¯é‡è¦æ€§è¶Šé«˜ï¼Œè¿™æœ‰å¯èƒ½å½±å“æœ€åçš„åˆ†ç±»ç»“æœï¼Œå› ä¸ºå¯¹å¥å­åˆ†ç±»å½±å“æœ€å¤§çš„è¯å¯èƒ½å¤„åœ¨å¥å­ä»»ä½•ä½ç½®ã€‚CNNå±äºæ— åæ¨¡å‹ï¼Œèƒ½å¤Ÿé€šè¿‡æœ€å¤§æ± åŒ–è·å¾—æœ€é‡è¦çš„ç‰¹å¾ï¼Œä½†æ˜¯CNNçš„æ»‘åŠ¨çª—å£å¤§å°ä¸å®¹æ˜“ç¡®å®šï¼Œé€‰çš„è¿‡å°å®¹æ˜“é€ æˆé‡è¦ä¿¡æ¯ä¸¢å¤±ï¼Œé€‰çš„è¿‡å¤§ä¼šé€ æˆå·¨å¤§å‚æ•°ç©ºé—´ã€‚ä¸ºäº†è§£å†³äºŒè€…çš„å±€é™æ€§ï¼Œè¿™ç¯‡æ–‡ç« æå‡ºäº†ä¸€ç§æ–°çš„ç½‘ç»œæ¶æ„ï¼Œç”¨åŒå‘å¾ªç¯ç»“æ„è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè¿™æ¯”ä¼ ç»Ÿçš„åŸºäºçª—å£çš„ç¥ç»ç½‘ç»œæ›´èƒ½å‡å°‘å™ªå£°ï¼Œè€Œä¸”åœ¨å­¦ä¹ æ–‡æœ¬è¡¨è¾¾æ—¶å¯ä»¥å¤§èŒƒå›´çš„ä¿ç•™è¯åºã€‚å…¶æ¬¡ä½¿ç”¨æœ€å¤§æ± åŒ–å±‚è·å–æ–‡æœ¬çš„é‡è¦éƒ¨åˆ†ï¼Œè‡ªåŠ¨åˆ¤æ–­å“ªä¸ªç‰¹å¾åœ¨æ–‡æœ¬åˆ†ç±»è¿‡ç¨‹ä¸­èµ·æ›´é‡è¦çš„ä½œç”¨ã€‚</p>
<p><a href="http://www.aaai.org/ocs/index.php/AAAI/AAAI15/paper/download/9745/9552" target="_blank" rel="noopener">è®ºæ–‡</a></p>
<h4 id="æ¨¡å‹ç»“æ„"><a href="#æ¨¡å‹ç»“æ„" class="headerlink" title="æ¨¡å‹ç»“æ„"></a>æ¨¡å‹ç»“æ„</h4><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/rcnn.png" alt="avatar"></p>
<h4 id="Word-Representation-Learning"><a href="#Word-Representation-Learning" class="headerlink" title="Word Representation Learning"></a>Word Representation Learning</h4><p>ä½œè€…æå‡ºå°†å•è¯çš„å·¦ä¸Šä¸‹æ–‡ã€å³ä¸Šä¸‹æ–‡ã€å•è¯æœ¬èº«ç»“åˆèµ·æ¥ä½œä¸ºå•è¯è¡¨ç¤ºã€‚ä½œè€…ä½¿ç”¨äº†åŒå‘RNNæ¥åˆ†åˆ«æå–å¥å­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å…¬å¼å¦‚ä¸‹:</p>
<script type="math/tex; mode=display">
\begin{array}{l}
c_{l}\left(w_{i}\right)=f\left(W^{(l)} c_{l}\left(w_{i-1}\right)+W^{(s l)} e\left(w_{i-1}\right)\right)  \\
c_{r}\left(w_{i}\right)=f\left(W^{(r)} c_{r}\left(w_{i+1}\right)+W^{(s r)} e\left(w_{i+1}\right)\right)
\end{array}</script><p>å…¶ä¸­ï¼Œ$c_l(w_i)$ä»£è¡¨å•è¯$w_i$çš„å·¦ä¸Šä¸‹æ–‡ï¼Œ$c_l(w_i)$ç”±ä¸Šä¸€ä¸ªå•è¯çš„å·¦ä¸Šä¸‹æ–‡$c_l$å’Œ$c_l(w_{i-1})$ä¸Šä¸€ä¸ªå•è¯çš„è¯åµŒå…¥å‘é‡ $e(w_{i-1})$è®¡ç®—å¾—åˆ°ï¼Œå¦‚å…¬å¼ï¼ˆ1ï¼‰æ‰€ç¤ºï¼Œæ‰€æœ‰å¥å­ç¬¬ä¸€ä¸ªå•è¯çš„å·¦ä¾§ä¸Šä¸‹æ–‡ä½¿ç”¨ç›¸åŒçš„å…±äº«å‚æ•°$c_l(w_1)$ã€‚ $W^{(l)},W^{(sl)}$ç”¨äºå°†ä¸Šä¸€ä¸ªå•è¯çš„å·¦ä¸Šä¸‹æ–‡è¯­ä¹‰å’Œä¸Šä¸€ä¸ªå•è¯çš„è¯­ä¹‰ç»“åˆåˆ°å•è¯ $w_i$çš„å·¦ä¸Šä¸‹æ–‡è¡¨ç¤ºä¸­ã€‚å³ä¸Šä¸‹æ–‡çš„å¤„ç†ä¸å·¦ä¸Šä¸‹æ–‡å®Œå…¨ç›¸åŒï¼ŒåŒæ ·æ‰€æœ‰å¥å­æœ€åä¸€ä¸ªå•è¯çš„å³ä¾§ä¸Šä¸‹æ–‡ä½¿ç”¨ç›¸åŒçš„å…±äº«å‚æ•°$c_r(w_n)$ã€‚ å¾—åˆ°å¥å­ä¸­æ¯ä¸ªå•è¯çš„å·¦ä¸Šä¸‹æ–‡è¡¨ç¤ºå’Œå³ä¸Šä¸‹æ–‡è¡¨ç¤ºåï¼Œå°±å¯ä»¥å®šä¹‰å•è¯  $w_i$çš„è¡¨ç¤ºå¦‚ä¸‹</p>
<script type="math/tex; mode=display">
\boldsymbol{x}_{i}=\left[\boldsymbol{c}_{l}\left(w_{i}\right) ; \boldsymbol{e}\left(w_{i}\right) ; \boldsymbol{c}_{r}\left(w_{i}\right)\right]</script><p>å®é™…å°±æ˜¯å•è¯$w_i$ï¼Œå•è¯çš„è¯åµŒå…¥è¡¨ç¤ºå‘é‡ $e(w_i)$ä»¥åŠå•è¯çš„å³ä¸Šä¸‹æ–‡å‘é‡$c_e(w_i)$ çš„æ‹¼æ¥åçš„ç»“æœã€‚å¾—åˆ°$w_i$çš„è¡¨ç¤º$x_i$åï¼Œå°±å¯ä»¥è¾“å…¥æ¿€æ´»å‡½æ•°å¾—åˆ°$w_i$çš„æ½œåœ¨è¯­ä¹‰å‘é‡ $y_i^{(2)}$ ã€‚</p>
<script type="math/tex; mode=display">
\boldsymbol{y}_{i}^{(2)}=\tanh \left(W^{(2)} \boldsymbol{x}_{i}+\boldsymbol{b}^{(2)}\right)</script><h4 id="Text-Representation-Learning"><a href="#Text-Representation-Learning" class="headerlink" title="Text Representation Learning"></a>Text Representation Learning</h4><p>ç»è¿‡å·ç§¯å±‚åï¼Œè·å¾—äº†æ‰€æœ‰è¯çš„è¡¨ç¤ºï¼Œé¦–å…ˆå¯¹å…¶è¿›è¡Œæœ€å¤§æ± åŒ–æ“ä½œï¼Œæœ€å¤§æ± åŒ–å¯ä»¥å¸®åŠ©æ‰¾åˆ°å¥å­ä¸­æœ€é‡è¦çš„æ½œåœ¨è¯­ä¹‰ä¿¡æ¯ã€‚</p>
<script type="math/tex; mode=display">
\boldsymbol{y}^{(3)}=\max _{i=1}^{n} \boldsymbol{y}_{i}^{(2)}</script><p>ç„¶åç»è¿‡å…¨è¿æ¥å±‚å¾—åˆ°æ–‡æœ¬çš„è¡¨ç¤ºï¼Œæœ€åé€šè¿‡softmaxå±‚è¿›è¡Œåˆ†ç±»ã€‚</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\boldsymbol{y}^{(4)}=W^{(4)} \boldsymbol{y}^{(3)}+\boldsymbol{b}^{(4)}\\
&p_{i}=\frac{\exp \left(\boldsymbol{y}_{i}^{(4)}\right)}{\sum_{k=1}^{n} \exp \left(\boldsymbol{y}_{k}^{(4)}\right)}
\end{aligned}</script><h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RCNNModel</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, rnn_type, vocab, embedding_dim, hidden_dim, output_dim, n_layers,</span></span></span><br><span class="line"><span class="function"><span class="params">                 bidirectional, dropout, pad_size=<span class="number">32</span>,batch_first=False,use_pretrain_embedding=False)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.embedding_dim = embedding_dim</span><br><span class="line">        self.pad_size = pad_size</span><br><span class="line">        <span class="keyword">if</span> use_pretrain_embedding:</span><br><span class="line">            self.embedding = nn.Embedding.from_pretrained(vocab.vectors)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.embedding = nn.Embedding(len(vocab), embedding_dim, padding_idx=vocab.pad_index)</span><br><span class="line">        <span class="comment"># æŠŠunknown å’Œ pad å‘é‡è®¾ç½®ä¸ºé›¶</span></span><br><span class="line">        self.embedding.weight.data[vocab.unk_index] = torch.zeros(embedding_dim)</span><br><span class="line">        self.embedding.weight.data[vocab.pad_index] = torch.zeros(embedding_dim)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(embedding_dim,</span><br><span class="line">                               hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(embedding_dim,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(embedding_dim,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># self.maxpool = nn.MaxPool1d()</span></span><br><span class="line">        self.fc = nn.Linear(hidden_dim * n_layers + embedding_dim, output_dim)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text, text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text = [sent len, batch size]</span></span><br><span class="line"></span><br><span class="line">        embedded = self.embedding(text)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># embedded = [sent len, batch size, emb dim]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(embedded, text_lengths, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># packed_output</span></span><br><span class="line">        <span class="comment"># hidden [n_layers * bi_direction,batch_size,hidden_dim]</span></span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># unpack sequence</span></span><br><span class="line">        <span class="comment"># output [sent len, batch_size * n_layers * bi_direction]</span></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># if not self.bidirectional:</span></span><br><span class="line">        <span class="comment">#     hidden = torch.reshape(hidden,(hidden.shape[1],self.hidden_dim * self.n_layers))</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     hidden = torch.reshape(hidden, (-1,hidden.shape[1], self.hidden_dim * self.n_layers))</span></span><br><span class="line">        <span class="comment">#     hidden = torch.mean(hidden,dim=0)</span></span><br><span class="line"></span><br><span class="line">        output = torch.cat((output,embedded),<span class="number">2</span>)</span><br><span class="line">        out = output.relu().permute(<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>)</span><br><span class="line">        max_sentence_len = output_lengths[<span class="number">0</span>].item()</span><br><span class="line">        out = nn.MaxPool1d(max_sentence_len)(out).squeeze()</span><br><span class="line">        out = self.fc(out)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h3 id="DPCNN"><a href="#DPCNN" class="headerlink" title="DPCNN"></a>DPCNN</h3><h4 id="ç®€ä»‹ï¼š"><a href="#ç®€ä»‹ï¼š" class="headerlink" title="ç®€ä»‹ï¼š"></a>ç®€ä»‹ï¼š</h4><p>ACL2017å¹´ä¸­ï¼Œè…¾è®¯AI-labæå‡ºäº†Deep Pyramid Convolutional Neural Networks for Text Categorization(DPCNN)ã€‚è®ºæ–‡ä¸­æå‡ºäº†ä¸€ç§åŸºäºword-levelçº§åˆ«çš„ç½‘ç»œ-DPCNNï¼Œç”±äºTextCNN ä¸èƒ½é€šè¿‡å·ç§¯è·å¾—æ–‡æœ¬çš„é•¿è·ç¦»ä¾èµ–å…³ç³»ï¼Œè€Œè®ºæ–‡ä¸­DPCNNé€šè¿‡ä¸æ–­åŠ æ·±ç½‘ç»œï¼Œå¯ä»¥æŠ½å–é•¿è·ç¦»çš„æ–‡æœ¬ä¾èµ–å…³ç³»ã€‚å®éªŒè¯æ˜åœ¨ä¸å¢åŠ å¤ªå¤šè®¡ç®—æˆæœ¬çš„æƒ…å†µä¸‹ï¼Œå¢åŠ ç½‘ç»œæ·±åº¦å°±å¯ä»¥è·å¾—æœ€ä½³çš„å‡†ç¡®ç‡ã€‚â€</p>
<h4 id="ç½‘ç»œç»“æ„-1"><a href="#ç½‘ç»œç»“æ„-1" class="headerlink" title="ç½‘ç»œç»“æ„"></a>ç½‘ç»œç»“æ„</h4><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/DPCNN.jpg" alt="avatar"></p>
<h5 id="Region-embedding"><a href="#Region-embedding" class="headerlink" title="Region embedding"></a>Region embedding</h5><p>ä½œè€…å°†TextCNNçš„åŒ…å«å¤šå°ºå¯¸å·ç§¯æ»¤æ³¢å™¨çš„å·ç§¯å±‚çš„å·ç§¯ç»“æœç§°ä¹‹ä¸ºRegion embeddingï¼Œæ„æ€å°±æ˜¯å¯¹ä¸€ä¸ªæ–‡æœ¬åŒºåŸŸ/ç‰‡æ®µï¼ˆæ¯”å¦‚3gramï¼‰è¿›è¡Œä¸€ç»„å·ç§¯æ“ä½œåç”Ÿæˆçš„embeddingã€‚<br>å·ç§¯æ“ä½œæœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<ol>
<li>ä¿ç•™è¯åºï¼šä¹Ÿå°±æ˜¯è®¾ç½®ä¸€ç»„size=3*Dçš„äºŒç»´å·ç§¯æ ¸å¯¹3gramè¿›è¡Œå·ç§¯ï¼ˆå…¶ä¸­Dæ˜¯word embeddingç»´åº¦ï¼‰</li>
<li>ä¸ä¿ç•™è¯åºï¼ˆå³ä½¿ç”¨è¯è¢‹æ¨¡å‹ï¼‰ï¼Œå³é¦–å…ˆå¯¹3gramä¸­çš„3ä¸ªè¯çš„embeddingå–å‡å€¼å¾—åˆ°ä¸€ä¸ªsize=Dçš„å‘é‡ï¼Œç„¶åè®¾ç½®ä¸€ç»„size=Dçš„ä¸€ç»´å·ç§¯æ ¸å¯¹è¯¥3gramè¿›è¡Œå·ç§¯ã€‚</li>
</ol>
<p>TextCNNé‡Œä½¿ç”¨çš„æ˜¯ä¿ç•™è¯åºçš„åšæ³•ï¼Œè€ŒDPCNNä½¿ç”¨çš„æ˜¯è¯è¢‹æ¨¡å‹çš„åšæ³•ï¼ŒDPCNNä½œè€…argueå‰è€…åšæ³•æ›´å®¹æ˜“é€ æˆè¿‡æ‹Ÿåˆï¼Œåè€…çš„æ€§èƒ½å´è·Ÿå‰è€…å·®ä¸å¤šã€‚</p>
<h4 id="å·ç§¯å’Œå…¨è¿æ¥çš„æƒè¡¡"><a href="#å·ç§¯å’Œå…¨è¿æ¥çš„æƒè¡¡" class="headerlink" title="å·ç§¯å’Œå…¨è¿æ¥çš„æƒè¡¡"></a>å·ç§¯å’Œå…¨è¿æ¥çš„æƒè¡¡</h4><p>äº§ç”Ÿregion embeddingåï¼ŒæŒ‰ç…§ç»å…¸çš„TextCNNçš„åšæ³•çš„è¯ï¼Œå°±æ˜¯ä»æ¯ä¸ªç‰¹å¾å›¾ä¸­æŒ‘é€‰å‡ºæœ€æœ‰ä»£è¡¨æ€§çš„ç‰¹å¾ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥åº”ç”¨å…¨å±€æœ€å¤§æ± åŒ–å±‚ï¼ˆmax-over-time-pooling layerï¼‰ï¼Œè¿™æ ·å°±ç”Ÿæˆäº†è¿™æ®µæ–‡æœ¬çš„ç‰¹å¾å‘é‡ï¼ˆå‡å¦‚å·ç§¯æ»¤æ³¢å™¨çš„sizeæœ‰3ï¼Œ4ï¼Œ5è¿™ä¸‰ç§ï¼Œæ¯ç§sizeåŒ…å«100ä¸ªå·ç§¯æ ¸ï¼Œé‚£ä¹ˆå½“ç„¶å°±ä¼šäº§ç”Ÿ3<em>100å¹…ç‰¹å¾å›¾ï¼Œç„¶åå°†max-over-time-poolingæ“ä½œåº”ç”¨åˆ°æ¯ä¸ªç‰¹å¾å›¾ä¸Šï¼Œäºæ˜¯æ–‡æœ¬çš„ç‰¹å¾å‘é‡å³3</em>100=300ç»´ï¼‰ã€‚<br>TextCNNè¿™æ ·åšçš„æ„ä¹‰æœ¬è´¨ä¸Šä¸è¯è¢‹æ¨¡å‹ï¼ˆå«ngramï¼‰+weighting+NB/MaxEnt/SVMçš„ç»å…¸æ–‡æœ¬åˆ†ç±»æ¨¡å‹æ²¡æœ¬è´¨åŒºåˆ«ï¼Œåªä¸è¿‡one-hotè¡¨ç¤ºåˆ°word embeddingè¡¨ç¤ºçš„è½¬å˜é¿å…äº†è¯è¢‹æ¨¡å‹é­é‡çš„æ•°æ®ç¨€ç–é—®é¢˜ã€‚å¯ä»¥è¯´ï¼ŒTextCNNæœ¬è´¨ä¸Šæ”¶ç›Šäºè¯å‘é‡çš„å¼•å…¥å¸¦æ¥çš„â€œè¿‘ä¹‰è¯æœ‰ç›¸è¿‘å‘é‡è¡¨ç¤ºâ€çš„bonusï¼ŒåŒæ—¶TextCNNæ°å¥½å¯ä»¥è¾ƒå¥½çš„åˆ©ç”¨è¯å‘é‡ä¸­çš„çŸ¥è¯†ï¼ˆè¿‘ä¹‰å…³ç³»ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œç»å…¸æ¨¡å‹é‡Œéš¾ä»¥å­¦ä¹ çš„è¿œè·ç¦»ä¿¡æ¯ï¼ˆå¦‚12gramï¼‰åœ¨TextCNNä¸­ä¾ç„¶éš¾ä»¥å­¦ä¹ ã€‚</p>
<h5 id="ç­‰é•¿å·ç§¯"><a href="#ç­‰é•¿å·ç§¯" class="headerlink" title="ç­‰é•¿å·ç§¯"></a>ç­‰é•¿å·ç§¯</h5><p>å‡è®¾è¾“å…¥çš„åºåˆ—é•¿åº¦ä¸ºnï¼Œå·ç§¯æ ¸å¤§å°ä¸ºmï¼Œæ­¥é•¿(stride)ä¸ºs,è¾“å…¥åºåˆ—ä¸¤ç«¯å„å¡«è¡¥pä¸ªé›¶(zero padding),é‚£ä¹ˆè¯¥å·ç§¯å±‚çš„è¾“å‡ºåºåˆ—ä¸º(n-m+2p)/s+1ã€‚</p>
<ol>
<li>çª„å·ç§¯(narrow convolution):æ­¥é•¿s=1,ä¸¤ç«¯ä¸è¡¥é›¶ï¼Œå³p=0ï¼Œå·ç§¯åè¾“å‡ºé•¿åº¦ä¸ºn-m+1ã€‚</li>
<li>å®½å·ç§¯(wide onvolution) ï¼šæ­¥é•¿s=1,ä¸¤ç«¯è¡¥é›¶p=m-1ï¼Œå·ç§¯åè¾“å‡ºé•¿åº¦ n+m-1ã€‚</li>
<li>ç­‰é•¿å·ç§¯(equal-width convolution): æ­¥é•¿s=1,ä¸¤ç«¯è¡¥é›¶p=(m-1)/2ï¼Œå·ç§¯åè¾“å‡ºé•¿åº¦ä¸ºnã€‚</li>
</ol>
<p>é‚£ä¹ˆå¯¹æ–‡æœ¬ï¼Œæˆ–è€…è¯´å¯¹word embeddingåºåˆ—è¿›è¡Œç­‰é•¿å·ç§¯çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br>æ—¢ç„¶è¾“å…¥è¾“å‡ºåºåˆ—çš„ä½ç½®æ•°ä¸€æ ·å¤šï¼Œæˆ‘ä»¬å°†è¾“å…¥è¾“å‡ºåºåˆ—çš„ç¬¬nä¸ªembeddingç§°ä¸ºç¬¬nä¸ªè¯ä½ï¼Œé‚£ä¹ˆè¿™æ—¶sizeä¸ºnçš„å·ç§¯æ ¸äº§ç”Ÿçš„ç­‰é•¿å·ç§¯çš„æ„ä¹‰å°±å¾ˆæ˜æ˜¾äº†ï¼Œé‚£å°±æ˜¯å°†è¾“å…¥åºåˆ—çš„æ¯ä¸ªè¯ä½åŠå…¶å·¦å³((n-1)/2)ä¸ªè¯çš„ä¸Šä¸‹æ–‡ä¿¡æ¯å‹ç¼©ä¸ºè¯¥è¯ä½çš„embeddingï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œäº§ç”Ÿäº†æ¯ä¸ªè¯ä½çš„è¢«ä¸Šä¸‹æ–‡ä¿¡æ¯ä¿®é¥°è¿‡çš„æ›´é«˜levelæ›´åŠ å‡†ç¡®çš„è¯­ä¹‰ã€‚</p>
<p>å›åˆ°DPCNNä¸Šæ¥ï¼Œæˆ‘ä»¬æƒ³è¦å…‹æœTextCNNçš„ç¼ºç‚¹ï¼Œæ•è·é•¿è·ç¦»æ¨¡å¼ï¼Œæ˜¾ç„¶å°±è¦ç”¨åˆ°æ·±å±‚CNNå•¦ã€‚é‚£ä¹ˆç›´æ¥ç­‰é•¿å·ç§¯å †ç­‰é•¿å·ç§¯å¯ä¸å¯ä»¥å‘¢ï¼Ÿ<br>æ˜¾ç„¶è¿™æ ·ä¼šè®©æ¯ä¸ªè¯ä½åŒ…å«è¿›å»è¶Šæ¥è¶Šå¤šï¼Œè¶Šæ¥è¶Šé•¿çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä½†æ˜¯è¿™æ ·æ•ˆç‡ä¹Ÿå¤ªä½äº†ï¼Œæ˜¾ç„¶ä¼šè®©ç½‘ç»œå±‚æ•°å˜å¾—éå¸¸éå¸¸éå¸¸æ·±ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å¤ªç¬¨é‡ã€‚ä¸è¿‡ï¼Œæ—¢ç„¶ç­‰é•¿å·ç§¯å †ç­‰é•¿å·ç§¯ä¼šè®©æ¯ä¸ªè¯ä½çš„embeddingæè¿°è¯­ä¹‰æè¿°çš„æ›´åŠ ä¸°å¯Œå‡†ç¡®ï¼Œé‚£ä¹ˆå½“ç„¶æˆ‘ä»¬å¯ä»¥é€‚å½“çš„å †ä¸¤å±‚æ¥æé«˜è¯ä½embeddingçš„è¡¨ç¤ºçš„ä¸°å¯Œæ€§ã€‚<br><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/equal_cnn.png" alt="avatar"></p>
<h5 id="å›ºå®šfeature-mapçš„æ•°é‡"><a href="#å›ºå®šfeature-mapçš„æ•°é‡" class="headerlink" title="å›ºå®šfeature mapçš„æ•°é‡"></a>å›ºå®šfeature mapçš„æ•°é‡</h5><p>åœ¨è¡¨ç¤ºå¥½æ¯ä¸ªè¯ä½çš„è¯­ä¹‰åï¼Œå…¶å®å¾ˆå¤šé‚»æ¥è¯æˆ–è€…é‚»æ¥ngramçš„è¯ä¹‰æ˜¯å¯ä»¥åˆå¹¶çš„ï¼Œä¾‹å¦‚â€œå°æ˜ äºº ä¸è¦ å¤ªå¥½â€ä¸­çš„â€œä¸è¦â€å’Œâ€œå¤ªå¥½â€è™½ç„¶è¯­ä¹‰æœ¬æ¥ç¦»å¾—å¾ˆè¿œï¼Œä½†æ˜¯ä½œä¸ºé‚»æ¥è¯â€œä¸è¦å¤ªå¥½â€å‡ºç°æ—¶å…¶è¯­ä¹‰åŸºæœ¬ç­‰ä»·ä¸ºâ€œå¾ˆå¥½â€ï¼Œè¿™æ ·å®Œå…¨å¯ä»¥æŠŠâ€œä¸è¦â€å’Œâ€œå¤ªå¥½â€çš„è¯­ä¹‰è¿›è¡Œåˆå¹¶ã€‚åŒæ—¶ï¼Œåˆå¹¶çš„è¿‡ç¨‹å®Œå…¨å¯ä»¥åœ¨åŸå§‹çš„embedding spaceä¸­è¿›è¡Œçš„ï¼Œæ¯•ç«ŸåŸæ–‡ä¸­ç›´æ¥æŠŠâ€œä¸è¦å¤ªå¥½â€åˆå¹¶ä¸ºâ€œå¾ˆå¥½â€æ˜¯å¾ˆå¯ä»¥çš„ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦åŠ¨æ•´ä¸ªè¯­ä¹‰ç©ºé—´ã€‚<br>å®é™…ä¸Šï¼Œç›¸æ¯”å›¾åƒä¸­è¿™ç§ä»â€œç‚¹ã€çº¿ã€å¼§â€è¿™ç§low-levelç‰¹å¾åˆ°â€œçœ¼ç›ã€é¼»å­ã€å˜´â€è¿™ç§high-levelç‰¹å¾çš„æ˜æ˜¾å±‚æ¬¡æ€§çš„ç‰¹å¾åŒºåˆ†ï¼Œæ–‡æœ¬ä¸­çš„ç‰¹å¾è¿›é˜¶æ˜æ˜¾è¦æ‰å¹³çš„å¤šï¼Œå³ä»å•è¯ï¼ˆ1gramï¼‰åˆ°çŸ­è¯­å†åˆ°3gramã€4gramçš„å‡çº§ï¼Œå…¶å®å¾ˆå¤§ç¨‹åº¦ä¸Šå‡æ»¡è¶³â€œè¯­ä¹‰å–ä»£â€çš„ç‰¹æ€§ã€‚è€Œå›¾åƒä¸­å°±å¾ˆéš¾å‘ç”Ÿè¿™ç§â€è¯­ä¹‰å–ä»£â€œç°è±¡<br>å› æ­¤ï¼ŒDPCNNä¸ResNetå¾ˆå¤§ä¸€ä¸ªä¸åŒå°±æ˜¯ï¼Œ<strong>åœ¨DPCNNä¸­å›ºå®šæ­»äº†feature mapçš„æ•°é‡</strong>ï¼Œä¹Ÿå°±æ˜¯å›ºå®šä½äº†embedding spaceçš„ç»´åº¦ï¼ˆä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œä»¥ä¸‹ç®€ç§°è¯­ä¹‰ç©ºé—´ï¼‰ï¼Œä½¿å¾—ç½‘ç»œæœ‰å¯èƒ½è®©æ•´ä¸ªé‚»æ¥è¯ï¼ˆé‚»æ¥ngramï¼‰çš„åˆå¹¶æ“ä½œåœ¨åŸå§‹ç©ºé—´æˆ–è€…ä¸åŸå§‹ç©ºé—´ç›¸ä¼¼çš„ç©ºé—´ä¸­è¿›è¡Œï¼ˆå½“ç„¶ï¼Œç½‘ç»œåœ¨å®é™…ä¸­ä¼šä¸ä¼šè¿™æ ·åšæ˜¯ä¸ä¸€å®šçš„ï¼Œåªæ˜¯æä¾›äº†è¿™ä¹ˆä¸€ç§æ¡ä»¶ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ªç½‘ç»œè™½ç„¶å½¢çŠ¶ä¸Šæ¥çœ‹æ˜¯æ·±å±‚çš„ï¼Œä½†æ˜¯ä»è¯­ä¹‰ç©ºé—´ä¸Šæ¥çœ‹å®Œå…¨å¯ä»¥æ˜¯æ‰å¹³çš„ã€‚è€ŒResNetåˆ™æ˜¯ä¸æ–­çš„æ”¹å˜è¯­ä¹‰ç©ºé—´ï¼Œä½¿å¾—å›¾åƒçš„è¯­ä¹‰éšç€ç½‘ç»œå±‚çš„åŠ æ·±ä¹Ÿä¸æ–­çš„è·³å‘æ›´é«˜levelçš„è¯­ä¹‰ç©ºé—´ã€‚</p>
<h5 id="æ± åŒ–"><a href="#æ± åŒ–" class="headerlink" title="æ± åŒ–"></a><strong>æ± åŒ–</strong></h5><p>æ‰€ä»¥æä¾›äº†è¿™ä¹ˆå¥½çš„åˆå¹¶æ¡ä»¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨pooling layerè¿›è¡Œåˆå¹¶å•¦ã€‚æ¯ç»è¿‡ä¸€ä¸ªsize=3, stride=2ï¼ˆå¤§å°ä¸º3ï¼Œæ­¥é•¿ä¸º2ï¼‰çš„æ± åŒ–å±‚ï¼ˆä»¥ä¸‹ç®€ç§°1/2æ± åŒ–å±‚ï¼‰ï¼Œåºåˆ—çš„é•¿åº¦å°±è¢«å‹ç¼©æˆäº†åŸæ¥çš„ä¸€åŠã€‚è¿™æ ·åŒæ ·æ˜¯size=3çš„å·ç§¯æ ¸ï¼Œæ¯ç»è¿‡ä¸€ä¸ª1/2æ± åŒ–å±‚åï¼Œå…¶èƒ½æ„ŸçŸ¥åˆ°çš„æ–‡æœ¬ç‰‡æ®µå°±æ¯”ä¹‹å‰é•¿äº†ä¸€å€ã€‚ä¾‹å¦‚ä¹‹å‰æ˜¯åªèƒ½æ„ŸçŸ¥3ä¸ªè¯ä½é•¿åº¦çš„ä¿¡æ¯ï¼Œç»è¿‡1/2æ± åŒ–å±‚åå°±èƒ½æ„ŸçŸ¥6ä¸ªè¯ä½é•¿åº¦çš„ä¿¡æ¯ï¼Œè¿™æ—¶æŠŠ1/2æ± åŒ–å±‚å’Œsize=3çš„å·ç§¯å±‚ç»„åˆèµ·æ¥å¦‚å›¾ï¼š<br><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/dpcnn_pooling.png" alt="avatar"></p>
<h5 id="æ®‹å·®è¿æ¥"><a href="#æ®‹å·®è¿æ¥" class="headerlink" title="æ®‹å·®è¿æ¥"></a>æ®‹å·®è¿æ¥</h5><p>äºæˆ‘ä»¬åœ¨åˆå§‹åŒ–æ·±åº¦CNNæ—¶ï¼Œå¾€å¾€å„å±‚æƒé‡éƒ½æ˜¯åˆå§‹åŒ–ä¸ºä¸€ä¸ªå¾ˆå°çš„å€¼ï¼Œè¿™å°±å¯¼è‡´æœ€å¼€å§‹çš„ç½‘ç»œä¸­ï¼Œåç»­å‡ ä¹æ¯å±‚çš„è¾“å…¥éƒ½æ˜¯æ¥è¿‘0ï¼Œè¿™æ—¶ç½‘ç»œçš„è¾“å‡ºè‡ªç„¶æ˜¯æ²¡æ„ä¹‰çš„ï¼Œè€Œè¿™äº›å°æƒé‡åŒæ—¶ä¹Ÿé˜»ç¢äº†æ¢¯åº¦çš„ä¼ æ’­ï¼Œä½¿å¾—ç½‘ç»œçš„åˆå§‹è®­ç»ƒé˜¶æ®µå¾€å¾€è¦è¿­ä»£å¥½ä¹…æ‰èƒ½å¯åŠ¨ã€‚<br>åŒæ—¶ï¼Œå°±ç®—ç½‘ç»œå¯åŠ¨å®Œæˆï¼Œç”±äºæ·±åº¦ç½‘ç»œä¸­ä»¿å°„çŸ©é˜µï¼ˆæ¯ä¸¤å±‚é—´çš„è¿æ¥è¾¹ï¼‰è¿‘ä¼¼è¿ä¹˜ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­ç½‘ç»œä¹Ÿéå¸¸å®¹æ˜“å‘ç”Ÿæ¢¯åº¦çˆ†ç‚¸æˆ–å¼¥æ•£é—®é¢˜ï¼ˆè™½ç„¶ç”±äºéå…±äº«æƒé‡ï¼Œæ·±åº¦CNNç½‘ç»œæ¯”RNNç½‘ç»œè¦å¥½ç‚¹ï¼‰ã€‚<br>é‚£ä¹ˆå¦‚ä½•è§£å†³æ·±åº¦CNNç½‘ç»œçš„æ¢¯åº¦å¼¥æ•£é—®é¢˜å‘¢ï¼Ÿ<br>ResNetä¸­æå‡ºçš„shortcut-connection/skip-connection/residual-connectionï¼ˆæ®‹å·®è¿æ¥ï¼‰å°±æ˜¯ä¸€ç§éå¸¸ç®€å•ã€åˆç†ã€æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚<br><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/dpcnn_resnet.png" alt="avatar"><br>æ—¢ç„¶æ¯ä¸ªblockçš„è¾“å…¥åœ¨åˆå§‹é˜¶æ®µå®¹æ˜“æ˜¯0è€Œæ— æ³•æ¿€æ´»ï¼Œé‚£ä¹ˆç›´æ¥ç”¨ä¸€æ¡çº¿æŠŠregion embeddingå±‚è¿æ¥åˆ°æ¯ä¸ªblockçš„è¾“å…¥ä¹ƒè‡³æœ€ç»ˆçš„æ± åŒ–å±‚/è¾“å‡ºå±‚ä¸å°±å¯ä»¥ã€‚æœ‰äº†shortcutåï¼Œæ¢¯åº¦å°±å¯ä»¥å¿½ç•¥å·ç§¯å±‚æƒé‡çš„å‰Šå¼±ï¼Œä»shortcutä¸€è·¯æ— æŸçš„ä¼ é€’åˆ°å„ä¸ªblockæ‰‹é‡Œï¼Œç›´è‡³ç½‘ç»œå‰ç«¯ï¼Œä»è€Œæå¤§çš„ç¼“è§£äº†æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</p>
<h4 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DPCNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab, embedding_dim, num_filters, use_pretrain_embedding,num_classes)</span>:</span></span><br><span class="line">        super(DPCNN, self).__init__()</span><br><span class="line">        <span class="keyword">if</span> use_pretrain_embedding:</span><br><span class="line">            self.embedding = nn.Embedding.from_pretrained(vocab.vectors)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.embedding = nn.Embedding(len(vocab), embedding_dim, padding_idx=vocab.pad_index)</span><br><span class="line">        self.conv_region = nn.Conv2d(<span class="number">1</span>, num_filters, (<span class="number">3</span>, embedding_dim), stride=<span class="number">1</span>)</span><br><span class="line">        self.conv = nn.Conv2d(num_filters, num_filters, (<span class="number">3</span>, <span class="number">1</span>), stride=<span class="number">1</span>)</span><br><span class="line">        self.max_pool = nn.MaxPool2d(kernel_size=(<span class="number">3</span>, <span class="number">1</span>), stride=<span class="number">2</span>)</span><br><span class="line">        self.padding1 = nn.ZeroPad2d((<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>))  <span class="comment"># top bottom</span></span><br><span class="line">        self.padding2 = nn.ZeroPad2d((<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>))  <span class="comment"># bottom</span></span><br><span class="line">        self.relu = nn.ReLU()</span><br><span class="line">        self.fc = nn.Linear(num_filters, num_classes)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text,text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text [batch_size,seq_len]</span></span><br><span class="line">        x = self.embedding(text) <span class="comment"># x=[batch_size,seq_len,embedding_dim]</span></span><br><span class="line">        x = x.unsqueeze(<span class="number">1</span>)  <span class="comment"># [batch_size, 1, seq_len, embedding_dim]</span></span><br><span class="line">        x = self.conv_region(x)  <span class="comment"># x = [batch_size, num_filters, seq_len-3+1, 1]</span></span><br><span class="line"></span><br><span class="line">        x = self.padding1(x)  <span class="comment"># [batch_size, num_filters, seq_len, 1]</span></span><br><span class="line">        x = self.relu(x)</span><br><span class="line">        x = self.conv(x)  <span class="comment"># [batch_size, num_filters, seq_len-3+1, 1]</span></span><br><span class="line">        x = self.padding1(x)  <span class="comment"># [batch_size, num_filters, seq_len, 1]</span></span><br><span class="line">        x = self.relu(x)</span><br><span class="line">        x = self.conv(x)  <span class="comment"># [batch_size, num_filters, seq_len-3+1, 1]</span></span><br><span class="line">        <span class="keyword">while</span> x.size()[<span class="number">2</span>] &gt;= <span class="number">2</span>:</span><br><span class="line">            x = self._block(x) <span class="comment"># [batch_size, num_filters,1,1]</span></span><br><span class="line">        x = x.squeeze()  <span class="comment"># [batch_size, num_filters]</span></span><br><span class="line">        x = self.fc(x) <span class="comment"># [batch_size, 1]</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_block</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x = self.padding2(x)</span><br><span class="line">        px = self.max_pool(x)</span><br><span class="line"></span><br><span class="line">        x = self.padding1(px)</span><br><span class="line">        x = F.relu(x)</span><br><span class="line">        x = self.conv(x)</span><br><span class="line"></span><br><span class="line">        x = self.padding1(x)</span><br><span class="line">        x = F.relu(x)</span><br><span class="line">        x = self.conv(x)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Short Cut</span></span><br><span class="line">        x = x + px</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure>
<h3 id="Bert"><a href="#Bert" class="headerlink" title="Bert"></a>Bert</h3><h4 id="BERT"><a href="#BERT" class="headerlink" title="BERT"></a>BERT</h4><p><img src="/2020/03/29/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E5%8F%8A%E6%AF%94%E8%BE%83/bert_gpt_elmo.png" alt="avatar"></p>
<h5 id="Task-1-MLM"><a href="#Task-1-MLM" class="headerlink" title="Task 1: MLM"></a>Task 1: MLM</h5><p>ç”±äºBERTéœ€è¦é€šè¿‡ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¥é¢„æµ‹ä¸­å¿ƒè¯çš„ä¿¡æ¯ï¼ŒåŒæ—¶åˆä¸å¸Œæœ›æ¨¡å‹æå‰çœ‹è§ä¸­å¿ƒè¯çš„ä¿¡æ¯ï¼Œå› æ­¤æå‡ºäº†ä¸€ç§ Masked Language Model çš„é¢„è®­ç»ƒæ–¹å¼ï¼Œå³éšæœºä»è¾“å…¥é¢„æ–™ä¸Š mask æ‰ä¸€äº›å•è¯ï¼Œç„¶åé€šè¿‡çš„ä¸Šä¸‹æ–‡é¢„æµ‹è¯¥å•è¯ï¼Œç±»ä¼¼äºä¸€ä¸ªå®Œå½¢å¡«ç©ºä»»åŠ¡ã€‚</p>
<p>åœ¨é¢„è®­ç»ƒä»»åŠ¡ä¸­ï¼Œ15%çš„ Word Piece ä¼šè¢«maskï¼Œè¿™15%çš„ Word Piece ä¸­ï¼Œ80%çš„æ—¶å€™ä¼šç›´æ¥æ›¿æ¢ä¸º [Mask] ï¼Œ10%çš„æ—¶å€™å°†å…¶æ›¿æ¢ä¸ºå…¶å®ƒä»»æ„å•è¯ï¼Œ10%çš„æ—¶å€™ä¼šä¿ç•™åŸå§‹Token</p>
<ul>
<li>æ²¡æœ‰100%maskçš„åŸå› <ul>
<li>å¦‚æœå¥å­ä¸­çš„æŸä¸ªToken100%éƒ½ä¼šè¢«maskæ‰ï¼Œé‚£ä¹ˆåœ¨fine-tuningçš„æ—¶å€™æ¨¡å‹å°±ä¼šæœ‰ä¸€äº›æ²¡æœ‰è§è¿‡çš„å•è¯</li>
</ul>
</li>
<li>åŠ å…¥10%éšæœºtokençš„åŸå› <ul>
<li>Transformerè¦ä¿æŒå¯¹æ¯ä¸ªè¾“å…¥tokençš„åˆ†å¸ƒå¼è¡¨å¾ï¼Œå¦åˆ™æ¨¡å‹å°±ä¼šè®°ä½è¿™ä¸ª[mask]æ˜¯token â€™hairyâ€˜</li>
<li>å¦å¤–ç¼–ç å™¨ä¸çŸ¥é“å“ªäº›è¯éœ€è¦é¢„æµ‹çš„ï¼Œå“ªäº›è¯æ˜¯é”™è¯¯çš„ï¼Œå› æ­¤è¢«è¿«éœ€è¦å­¦ä¹ æ¯ä¸€ä¸ªtokençš„è¡¨ç¤ºå‘é‡</li>
</ul>
</li>
<li>å¦å¤–ï¼Œæ¯ä¸ªbatchsizeåªæœ‰15%çš„å•è¯è¢«maskçš„åŸå› ï¼Œæ˜¯å› ä¸ºæ€§èƒ½å¼€é”€çš„é—®é¢˜ï¼ŒåŒå‘ç¼–ç å™¨æ¯”å•é¡¹ç¼–ç å™¨è®­ç»ƒè¦æ›´æ…¢</li>
</ul>
<h5 id="Task-2-NSP"><a href="#Task-2-NSP" class="headerlink" title="Task 2: NSP"></a>Task 2: NSP</h5><p>ä»…ä»…ä¸€ä¸ªMLMä»»åŠ¡æ˜¯ä¸è¶³ä»¥è®© BERT è§£å†³é˜…è¯»ç†è§£ç­‰å¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡çš„ï¼Œå› æ­¤æ·»åŠ äº†é¢å¤–çš„ä¸€ä¸ªé¢„è®­ç»ƒä»»åŠ¡ï¼Œå³ Next Sequence Predictionã€‚</p>
<p>å…·ä½“ä»»åŠ¡å³ä¸ºä¸€ä¸ªå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡ï¼Œå³åˆ¤æ–­å¥å­Bæ˜¯å¦æ˜¯å¥å­Açš„ä¸‹æ–‡ï¼Œå¦‚æœæ˜¯çš„è¯è¾“å‡ºâ€™IsNextâ€˜ï¼Œå¦åˆ™è¾“å‡ºâ€™NotNextâ€˜ã€‚</p>
<p>è®­ç»ƒæ•°æ®çš„ç”Ÿæˆæ–¹å¼æ˜¯ä»å¹³è¡Œè¯­æ–™ä¸­éšæœºæŠ½å–çš„è¿ç»­ä¸¤å¥è¯ï¼Œå…¶ä¸­50%ä¿ç•™æŠ½å–çš„ä¸¤å¥è¯ï¼Œå®ƒä»¬ç¬¦åˆIsNextå…³ç³»ï¼Œå¦å¤–50%çš„ç¬¬äºŒå¥è¯æ˜¯éšæœºä»é¢„æ–™ä¸­æå–çš„ï¼Œå®ƒä»¬çš„å…³ç³»æ˜¯NotNextçš„ã€‚è¿™ä¸ªå…³ç³»ä¿å­˜åœ¨å›¾4ä¸­çš„[CLS]ç¬¦å·ä¸­</p>
<h5 id="è¾“å…¥"><a href="#è¾“å…¥" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h5><ul>
<li>Token Embeddingsï¼šå³ä¼ ç»Ÿçš„è¯å‘é‡å±‚ï¼Œæ¯ä¸ªè¾“å…¥æ ·æœ¬çš„é¦–å­—ç¬¦éœ€è¦è®¾ç½®ä¸º[CLS]ï¼Œå¯ä»¥ç”¨äºä¹‹åçš„åˆ†ç±»ä»»åŠ¡ï¼Œè‹¥æœ‰ä¸¤ä¸ªä¸åŒçš„å¥å­ï¼Œéœ€è¦ç”¨[SEP]åˆ†éš”ï¼Œä¸”æœ€åä¸€ä¸ªå­—ç¬¦éœ€è¦ç”¨[SEP]è¡¨ç¤ºç»ˆæ­¢</li>
<li>Segment Embeddingsï¼šä¸º[0,1][0,1]åºåˆ—ï¼Œç”¨æ¥åœ¨NSPä»»åŠ¡ä¸­åŒºåˆ«ä¸¤ä¸ªå¥å­ï¼Œä¾¿äºåšå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡</li>
<li>Position Embeddingsï¼šä¸Transformerä¸­çš„ä½ç½®å‘é‡ä¸åŒï¼ŒBERTä¸­çš„ä½ç½®å‘é‡æ˜¯ç›´æ¥è®­ç»ƒå‡ºæ¥çš„</li>
</ul>
<h5 id="Fine-tunninng"><a href="#Fine-tunninng" class="headerlink" title="Fine-tunninng"></a>Fine-tunninng</h5><p>å¯¹äºä¸åŒçš„ä¸‹æ¸¸ä»»åŠ¡ï¼Œæˆ‘ä»¬ä»…éœ€è¦å¯¹BERTä¸åŒä½ç½®çš„è¾“å‡ºè¿›è¡Œå¤„ç†å³å¯ï¼Œæˆ–è€…ç›´æ¥å°†BERTä¸åŒä½ç½®çš„è¾“å‡ºç›´æ¥è¾“å…¥åˆ°ä¸‹æ¸¸æ¨¡å‹å½“ä¸­ã€‚å…·ä½“çš„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>å¯¹äºæƒ…æ„Ÿåˆ†æç­‰å•å¥åˆ†ç±»ä»»åŠ¡ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥å•ä¸ªå¥å­ï¼ˆä¸éœ€è¦[SEP]åˆ†éš”åŒå¥ï¼‰ï¼Œå°†[CLS]çš„è¾“å‡ºç›´æ¥è¾“å…¥åˆ°åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»</li>
<li>å¯¹äºå¥å­å¯¹ä»»åŠ¡ï¼ˆå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡ï¼‰ï¼Œéœ€è¦ç”¨[SEP]åˆ†éš”ä¸¤ä¸ªå¥å­è¾“å…¥åˆ°æ¨¡å‹ä¸­ï¼Œç„¶ååŒæ ·ä»…é¡»å°†[CLS]çš„è¾“å‡ºé€åˆ°åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»</li>
<li>å¯¹äºé—®ç­”ä»»åŠ¡ï¼Œå°†é—®é¢˜ä¸ç­”æ¡ˆæ‹¼æ¥è¾“å…¥åˆ°BERTæ¨¡å‹ä¸­ï¼Œç„¶åå°†ç­”æ¡ˆä½ç½®çš„è¾“å‡ºå‘é‡è¿›è¡ŒäºŒåˆ†ç±»å¹¶åœ¨å¥å­æ–¹å‘ä¸Šè¿›è¡Œsoftmaxï¼ˆåªéœ€é¢„æµ‹å¼€å§‹å’Œç»“æŸä½ç½®å³å¯ï¼‰</li>
<li>å¯¹äºå‘½åå®ä½“è¯†åˆ«ä»»åŠ¡ï¼Œå¯¹æ¯ä¸ªä½ç½®çš„è¾“å‡ºè¿›è¡Œåˆ†ç±»å³å¯ï¼Œå¦‚æœå°†æ¯ä¸ªä½ç½®çš„è¾“å‡ºä½œä¸ºç‰¹å¾è¾“å…¥åˆ°CRFå°†å–å¾—æ›´å¥½çš„æ•ˆæœã€‚</li>
</ul>
<h5 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul>
<li>BERTçš„é¢„è®­ç»ƒä»»åŠ¡MLMä½¿å¾—èƒ½å¤Ÿå€ŸåŠ©ä¸Šä¸‹æ–‡å¯¹åºåˆ—è¿›è¡Œç¼–ç ï¼Œä½†åŒæ—¶ä¹Ÿä½¿å¾—å…¶é¢„è®­ç»ƒè¿‡ç¨‹ä¸ä¸­çš„æ•°æ®ä¸å¾®è°ƒçš„æ•°æ®ä¸åŒ¹é…ï¼Œéš¾ä»¥é€‚åº”ç”Ÿæˆå¼ä»»åŠ¡</li>
<li>å¦å¤–ï¼ŒBERTæ²¡æœ‰è€ƒè™‘é¢„æµ‹[MASK]ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œæ˜¯å¯¹è¯­è¨€æ¨¡å‹è”åˆæ¦‚ç‡çš„æœ‰åä¼°è®¡</li>
<li>ç”±äºæœ€å¤§è¾“å…¥é•¿åº¦çš„é™åˆ¶ï¼Œé€‚åˆå¥å­å’Œæ®µè½çº§åˆ«çš„ä»»åŠ¡ï¼Œä¸é€‚ç”¨äºæ–‡æ¡£çº§åˆ«çš„ä»»åŠ¡ï¼ˆå¦‚é•¿æ–‡æœ¬åˆ†ç±»ï¼‰</li>
<li>é€‚åˆå¤„ç†è‡ªç„¶è¯­ä¹‰ç†è§£ç±»ä»»åŠ¡(NLU)ï¼Œè€Œä¸é€‚åˆè‡ªç„¶è¯­è¨€ç”Ÿæˆç±»ä»»åŠ¡(NLG)</li>
</ul>
<h5 id="ä»£ç -4"><a href="#ä»£ç -4" class="headerlink" title="ä»£ç "></a>ä»£ç </h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bert</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, bert_model_path,num_classes)</span>:</span></span><br><span class="line">        super(Bert, self).__init__()</span><br><span class="line">        self.bert = BertModel.from_pretrained(bert_model_path)</span><br><span class="line">        <span class="comment"># ä¸å¯¹bertè¿›è¡Œè®­ç»ƒ</span></span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> self.bert.parameters():</span><br><span class="line">            param.requires_grad = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        self.fc = nn.Linear(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],num_classes)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text,text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text [ batch_size,senten_len]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># context = x[0]  # è¾“å…¥çš„å¥å­</span></span><br><span class="line">        <span class="comment"># mask = x[2]  # å¯¹paddingéƒ¨åˆ†è¿›è¡Œmaskï¼Œå’Œå¥å­ä¸€ä¸ªsizeï¼Œpaddingéƒ¨åˆ†ç”¨0è¡¨ç¤ºï¼Œå¦‚ï¼š[1, 1, 1, 1, 0, 0]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># cls [batch_size, 768]</span></span><br><span class="line">        <span class="comment"># sentence [batch size,sen len,  768]</span></span><br><span class="line">        sentence, cls = self.bert(text)</span><br><span class="line"></span><br><span class="line">        out = self.fc(cls)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h4 id="bert-config-json"><a href="#bert-config-json" class="headerlink" title="bert_config.json"></a>bert_config.json</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "attention_probs_dropout_prob": 0.1, #ä¹˜æ³•attentionæ—¶ï¼Œsoftmaxådropoutæ¦‚ç‡ </span><br><span class="line">  "directionality": "bidi", </span><br><span class="line">  "hidden_act": "gelu",   #æ¿€æ´»å‡½æ•° </span><br><span class="line">  "hidden_dropout_prob": 0.1, #éšè—å±‚dropoutæ¦‚ç‡ </span><br><span class="line">  "hidden_size": 768, #éšè—å•å…ƒæ•° </span><br><span class="line">  "initializer_range": 0.02, #åˆå§‹åŒ–èŒƒå›´ </span><br><span class="line">  "intermediate_size": 3072, #å‡ç»´ç»´åº¦</span><br><span class="line">  "max_position_embeddings": 512, #ä¸€ä¸ªå¤§äºseq_lengthçš„å‚æ•°ï¼Œç”¨äºç”Ÿæˆposition_embedding</span><br><span class="line">  "num_attention_heads": 12,#æ¯ä¸ªéšè—å±‚ä¸­çš„attention headæ•° </span><br><span class="line">  "num_hidden_layers": 2, #éšè—å±‚æ•° </span><br><span class="line">  "pooler_fc_size": 768, </span><br><span class="line">  "pooler_num_attention_heads": 12, </span><br><span class="line">  "pooler_num_fc_layers": 3, </span><br><span class="line">  "pooler_size_per_head": 128, </span><br><span class="line">  "pooler_type": "first_token_transform", </span><br><span class="line">  "type_vocab_size": 2, #segment_idsç±»åˆ« [0,1] </span><br><span class="line">  "vocab_size": 21128#è¯å…¸ä¸­è¯æ•°</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¾®åšæƒ…æ„Ÿåˆ†ç±»ç»“æœæ¯”è¾ƒ"><a href="#å¾®åšæƒ…æ„Ÿåˆ†ç±»ç»“æœæ¯”è¾ƒ" class="headerlink" title="å¾®åšæƒ…æ„Ÿåˆ†ç±»ç»“æœæ¯”è¾ƒ"></a>å¾®åšæƒ…æ„Ÿåˆ†ç±»ç»“æœæ¯”è¾ƒ</h3><div class="table-container">
<table>
<thead>
<tr>
<th>æ¨¡å‹</th>
<th>é€Ÿåº¦</th>
<th style="text-align:center">æ•ˆæœ(best)ï¼š</th>
<th>æ•ˆæœï¼š</th>
<th>å‚æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>FastText</td>
<td>4.43s/epoch</td>
<td style="text-align:center">å­—å‘é‡,è®­ç»ƒé›†ï¼š97.30%,éªŒè¯é›†ï¼š96.39%ï¼Œæµ‹è¯•é›†ï¼š96.00%</td>
<td>è¯å‘é‡,é€Ÿåº¦ï¼š13.97s/epochï¼Œè®­ç»ƒé›†ï¼š95.92% éªŒè¯é›†ï¼š93.31%ï¼Œæµ‹è¯•é›†ï¼š92.19%</td>
<td>â€œembedding_dimâ€: 300, â€œoutput_dimâ€: 1</td>
</tr>
<tr>
<td>Textcnn</td>
<td>18.99s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼Œè®­ç»ƒé›†ï¼š97.28%,éªŒè¯é›†ï¼š97.68%ï¼Œæµ‹è¯•é›†ï¼š97.12%</td>
<td>è¯å‘é‡,é€Ÿåº¦ï¼š36.79s/epoch,è®­ç»ƒé›†ï¼š95.63ï¼ŒéªŒè¯é›†ï¼š94.08%ï¼Œæµ‹è¯•é›†ï¼š94.58%</td>
<td>embedding_dim: 300, n_filters: 100, filter_sizes: [3,4,5], dropout: 0.5, output_dim: 1</td>
</tr>
<tr>
<td>Rnn</td>
<td>23.33s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š97.81%,éªŒè¯é›†ï¼š97.67%ï¼Œæµ‹è¯•é›†ï¼š97.66%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š22.44s/epoch,è®­ç»ƒé›†ï¼š96.03%ï¼ŒéªŒè¯é›†ï¼š95.46%ï¼Œæµ‹è¯•é›†ï¼š95.12%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œn_layersâ€:1, â€œbidirectionalâ€: false, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Rnn</td>
<td>46.78s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š97.76%ï¼ŒéªŒè¯é›†ï¼š97.71%ï¼Œæµ‹è¯•é›†ï¼š97.65%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š32.34s/epoch,è®­ç»ƒé›†ï¼š92.49%ï¼ŒéªŒè¯é›†ï¼š95.43%ï¼Œæµ‹è¯•é›†ï¼š92.20%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œ<strong>n_layers</strong>â€œ:2, â€œ<strong>bidirectional</strong>â€œ: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Lstm</td>
<td>27.19s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š98.00%ï¼ŒéªŒè¯é›†ï¼š97.76%ï¼Œæµ‹è¯•é›†ï¼š97.68%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š24.14s/epoch,è®­ç»ƒé›†ï¼š93.99%ï¼ŒéªŒè¯é›†ï¼š96.16%ï¼Œæµ‹è¯•é›†ï¼š96.20%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œn_layersâ€:1, â€œbidirectionalâ€: false, â€œdropoutâ€: 0, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Lstm</td>
<td>65.50s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š98.03%ï¼ŒéªŒè¯é›†ï¼š97.95%ï¼Œæµ‹è¯•é›†ï¼š97.88%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š40.78s/epoch,è®­ç»ƒé›†ï¼š96.93%ï¼ŒéªŒè¯é›†ï¼š97.03%ï¼Œæµ‹è¯•é›†ï¼š96.80%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œ<strong>n_layers</strong>â€œ:2, â€œ<strong>bidirectional</strong>â€œ: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Rnn-attention</td>
<td>24.27s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š97.68%ï¼ŒéªŒè¯é›†ï¼š97.87%ï¼Œæµ‹è¯•é›†ï¼š97.66%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š22.53s/epoch,è®­ç»ƒé›†ï¼š96.18%ï¼ŒéªŒè¯é›†ï¼š95.61%ï¼Œæµ‹è¯•é›†ï¼š95.53%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œn_layersâ€: 1, â€œbidirectionalâ€: false, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Rnn-attention</td>
<td>48.73s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š98.24%ï¼ŒéªŒè¯é›†ï¼š97.89%ï¼Œæµ‹è¯•é›†ï¼š97.76%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š33.19s/epoch,è®­ç»ƒé›†ï¼š96.53%ï¼ŒéªŒè¯é›†ï¼š95.78%ï¼Œæµ‹è¯•é›†ï¼š95.50%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œ<strong>n_layers</strong>â€œ:2, â€œ<strong>bidirectional</strong>â€œ: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Rcnn</td>
<td>27.51s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š98.36%ï¼ŒéªŒè¯é›†ï¼š98.36%ï¼Œæµ‹è¯•é›†ï¼š98.30%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š23.61s/epoch,è®­ç»ƒé›†ï¼š97.66%ï¼ŒéªŒè¯é›†ï¼š97.29%ï¼Œæµ‹è¯•é›†ï¼š97.20%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œn_layersâ€:1, â€œbidirectionalâ€: false, â€œdropoutâ€: 0, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Rcnn</td>
<td>54.01s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š98.34%ï¼ŒéªŒè¯é›†ï¼š98.31%ï¼Œæµ‹è¯•é›†ï¼š98.30%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š34.92s/epoch,è®­ç»ƒé›†ï¼š95.77%ï¼ŒéªŒè¯é›†ï¼š97.57%ï¼Œæµ‹è¯•é›†ï¼š97.49%</td>
<td>â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 1, â€œ<strong>n_layers</strong>â€œ:2, â€œ<strong>bidirectional</strong>â€œ: true, â€œdropoutâ€: 0, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Bert</td>
<td>143.17s/epoch</td>
<td style="text-align:center">è®­ç»ƒé›†ï¼š97.47%ï¼ŒéªŒè¯é›†ï¼š97.78%ï¼Œæµ‹è¯•é›†ï¼š97.66%</td>
<td></td>
<td>â€œnum_classesâ€: 1</td>
</tr>
<tr>
<td>Bert-cnn</td>
<td>254.66s/epoch</td>
<td style="text-align:center">è®­ç»ƒé›†ï¼š98.01ï¼ŒéªŒè¯é›†ï¼š98.32%ï¼Œæµ‹è¯•é›†ï¼š98.21%</td>
<td></td>
<td>â€œnum_filtersâ€: 100, â€œhidden_sizeâ€: 768, â€œfilter_sizesâ€: [3,4,5], â€œdropoutâ€: 0.1, â€œnum_classesâ€: 1</td>
</tr>
<tr>
<td>Bert-rnn</td>
<td>195.59s/epoch</td>
<td style="text-align:center">è®­ç»ƒé›†ï¼š97.53%ï¼ŒéªŒè¯é›†ï¼š97.83%,æµ‹è¯•é›†ï¼š97.55%</td>
<td></td>
<td>â€œrnn_typeâ€: â€œrnnâ€, â€œbert_embedding_dimâ€: 768, â€œhidden_dimâ€: 256, â€œn_layersâ€: 2, â€œbidirectionalâ€: true, â€œbatch_firstâ€: true, â€œdropoutâ€: 0.1, â€œnum_classesâ€: 1</td>
</tr>
<tr>
<td>Bert-rcnn</td>
<td>200.17s/epoch</td>
<td style="text-align:center">è®­ç»ƒé›†ï¼š98.17%ï¼ŒéªŒè¯é›†ï¼š98.15%,æµ‹è¯•é›†ï¼š98.13%</td>
<td></td>
<td>â€œrnn_typeâ€: â€œrnnâ€, â€œbert_embedding_dimâ€: 768, â€œhidden_dimâ€: 256, â€œnum_classesâ€: 1, â€œn_layersâ€:2, â€œbidirectionalâ€: true, â€œdropoutâ€: 0, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>DPCNN</td>
<td>9.76s/epoch</td>
<td style="text-align:center">å­—å‘é‡ï¼šè®­ç»ƒé›†ï¼š97.93%ï¼ŒéªŒè¯é›†ï¼š97.72%,æµ‹è¯•é›†ï¼š97.62%</td>
<td>è¯å‘é‡ï¼šé€Ÿåº¦ï¼š7.62s/epoch,è®­ç»ƒé›†ï¼š93.16%ï¼ŒéªŒè¯é›†ï¼š91.70%ï¼Œæµ‹è¯•é›†ï¼š92.00%</td>
<td>â€œembedding_dimâ€: 300, â€œnum_filtersâ€: 100, â€œnum_classesâ€: 1</td>
</tr>
</tbody>
</table>
</div>
<h3 id="æ–°é—»ååˆ†ç±»ç»“æœæ¯”è¾ƒ"><a href="#æ–°é—»ååˆ†ç±»ç»“æœæ¯”è¾ƒ" class="headerlink" title="æ–°é—»ååˆ†ç±»ç»“æœæ¯”è¾ƒ"></a>æ–°é—»ååˆ†ç±»ç»“æœæ¯”è¾ƒ</h3><div class="table-container">
<table>
<thead>
<tr>
<th>æ¨¡å‹</th>
<th>é€Ÿåº¦</th>
<th>æ•ˆæœï¼š</th>
<th>æ•ˆæœï¼š</th>
<th>å‚æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fast_Text</td>
<td>17.68s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š96.57%,éªŒè¯é›†ï¼š92.87%</td>
<td>18.26s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š96.7%ï¼ŒéªŒè¯é›†ï¼š92.61%</td>
<td>â€œembedding_dimâ€: 300, â€œoutput_dimâ€: 10</td>
</tr>
<tr>
<td>TextCNN</td>
<td>143.61s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š98.13%,éªŒè¯é›†ï¼š96.42%</td>
<td>142.95s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š98.32%ï¼ŒéªŒè¯é›†ï¼š95.7%</td>
<td>â€œembedding_dimâ€: 300, â€œn_filtersâ€: 50, â€œfilter_sizesâ€: [3,4,5], â€œdropoutâ€: 0.5, â€œoutput_dimâ€: 10</td>
</tr>
<tr>
<td>TextCNN1d</td>
<td>58.45s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š99.09%,éªŒè¯é›†ï¼š96.42%</td>
<td>57.66s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š98.97%ï¼ŒéªŒè¯é›†ï¼š96.69%</td>
<td>â€œembedding_dimâ€: 300, â€œn_filtersâ€: 100, â€œfilter_sizesâ€: [3,4,5], â€œdropoutâ€: 0.5, â€œoutput_dimâ€: 10</td>
</tr>
<tr>
<td>DPCNN</td>
<td>58.19s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š97.12%,éªŒè¯é›†ï¼š93.98%</td>
<td>57.87s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š96.97%ï¼ŒéªŒè¯é›†ï¼š95.04%</td>
<td>â€œuse_pretrain_embeddingâ€: true, â€œembedding_dimâ€: 300, â€œnum_filtersâ€: 100, â€œnum_classesâ€: 10</td>
</tr>
<tr>
<td>rcnn</td>
<td>461s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š97.85%,éªŒè¯é›†ï¼š95.41%</td>
<td>461.04s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š98.5%ï¼ŒéªŒè¯é›†ï¼š95.9%</td>
<td>â€œrnn_typeâ€: â€œlstmâ€, â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 10, â€œn_layersâ€:2, â€œbidirectionalâ€: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>rnnï¼ˆ1 layerï¼‰</td>
<td>131.58s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š93.43%,éªŒè¯é›†ï¼š90.06%</td>
<td>131.04s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š98.06%ï¼ŒéªŒè¯é›†ï¼š93.19</td>
<td>â€œrnn_typeâ€: â€œrnnâ€, â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 10, â€œn_layersâ€:1, â€œbidirectionalâ€: false, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>rnnï¼ˆ2ï¼Œlayerï¼‰</td>
<td>304.57s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š96.5%,éªŒè¯é›†ï¼š92.6%</td>
<td>304s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š94.60%ï¼ŒéªŒè¯é›†ï¼š93.39%</td>
<td>â€œrnn_typeâ€: â€œrnnâ€, â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 10, â€œn_layersâ€:2, â€œbidirectionalâ€: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>lstm</td>
<td>437.34s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š98.45%,éªŒè¯é›†ï¼š96.01%</td>
<td>439.16s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š97.73%ï¼ŒéªŒè¯é›†ï¼š94.30%</td>
<td>â€œrnn_typeâ€: â€œlstmâ€, â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 10, â€œn_layersâ€:2, â€œbidirectionalâ€: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Lstm-attention</td>
<td>381.35s/epoch</td>
<td>å­—å‘é‡,è®­ç»ƒé›†ï¼š97.09%,éªŒè¯é›†ï¼š95.00%</td>
<td>380.58s/epoch,è¯å‘é‡ï¼Œè®­ç»ƒé›†ï¼š99.15%ï¼ŒéªŒè¯é›†ï¼š96.32</td>
<td>â€œrnn_typeâ€: â€œlstmâ€, â€œembedding_dimâ€: 300, â€œhidden_dimâ€: 256, â€œoutput_dimâ€: 10, â€œn_layersâ€: 2, â€œbidirectionalâ€: true, â€œdropoutâ€: 0.5, â€œbatch_firstâ€: false</td>
</tr>
<tr>
<td>Bert</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Bert-cnn</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Bert-rnn</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Bert-rcnn</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>HAN</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>ä½¿ç”¨bertè¿›è¡Œè®­ç»ƒï¼Œæœºå­è·‘æ­¥èµ·æ¥äº†ï¼Œè€Œä¸”å³ä½¿è·‘èµ·æ¥ä¹Ÿæ˜¯é˜‰å‰²ç‰ˆçš„ï¼Œä¼¼ä¹æ²¡ä»€ä¹ˆæ„ä¹‰ã€‚</p>
<h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="é•¿çŸ­æ–‡æœ¬åˆ†ç±»çš„æ¯”è¾ƒ"><a href="#é•¿çŸ­æ–‡æœ¬åˆ†ç±»çš„æ¯”è¾ƒ" class="headerlink" title="é•¿çŸ­æ–‡æœ¬åˆ†ç±»çš„æ¯”è¾ƒ"></a>é•¿çŸ­æ–‡æœ¬åˆ†ç±»çš„æ¯”è¾ƒ</h4><p>å¯¹äºè¯åµŒå…¥æŠ€æœ¯çš„æ–‡æœ¬è¡¨ç¤ºï¼ŒçŸ­æ–‡æœ¬å’Œé•¿æ–‡æœ¬è¡¨ç¤ºä¸Šæ²¡æœ‰å·®åˆ«ï¼Œæ­¤æ—¶åˆ†ç±»æ•ˆæœçš„ä¼˜åŠ£ä¸»è¦åœ¨åˆ†ç±»æ¨¡å‹å’Œè®­ç»ƒæ•°æ®ä¸Šã€‚</p>
<p>å¯¹äºæ•°æ®è€Œè¨€ï¼šéšç€æ–‡æœ¬è¶Šé•¿ï¼Œè¯­ä¹‰çš„é‡è¦æ€§å°±è¶Šé«˜ï¼Œåœ¨æ–‡æœ¬å¾ˆçŸ­çš„æƒ…å†µä¸‹ï¼Œè¯­ä¹‰çš„é‡è¦æ€§å°±å¾ˆå°ï¼Œæ¯”å¦‚ï¼šâ€œä»Šå¤© å¤©æ°” æ€ä¹ˆæ ·â€ï¼Œâ€œä»Šå¤© æ€ä¹ˆæ · å¤©æ°”â€ï¼Œâ€œæ€ä¹ˆæ · å¤©æ°” ä»Šå¤©â€ã€‚ä½ ç”šè‡³ä¸å¿…è¦è€ƒè™‘å¥å­æ˜¯å¦é€šé¡ºï¼ŒåŸºæœ¬ä¸Šå¯ä»¥å½“ä¸€å¥è¯å¤„ç†ï¼Œæ²¡æœ‰ç¬¬äºŒä¸ªæ„æ€ã€‚ä½†æ˜¯éšç€æ–‡æœ¬è¶Šæ¥è¶Šé•¿ï¼Œæ¯”å¦‚512ä¸ªå­—ç¬¦ï¼Œé¢ å€’ä¸€ä¸‹å¯èƒ½å°±è¦å½’ä¸ºä¸¤ç±»äº†ã€‚</p>
<p>å¯¹äºæ¨¡å‹è€Œè¨€ï¼šå¯¹äºçŸ­æ–‡æœ¬ï¼ŒCNNé…åˆMax-poolingæ± åŒ–(å¦‚TextCNNæ¨¡å‹)é€Ÿåº¦å¿«ï¼Œè€Œä¸”æ•ˆæœä¹Ÿå¾ˆå¥½ã€‚å› ä¸ºçŸ­æ–‡æœ¬ä¸Šçš„å…³é”®è¯æ¯”è¾ƒå®¹æ˜“æ‰¾åˆ°ï¼Œè€Œä¸”Max-poolingä¼šç›´æ¥è¿‡æ»¤æ‰æ¨¡å‹è®¤ä¸ºä¸é‡è¦ç‰¹å¾ã€‚å…·ä½“å·¥ä½œæœºåˆ¶æ˜¯ï¼šå·ç§¯çª—å£æ²¿ç€é•¿åº¦ä¸ºnçš„æ–‡æœ¬ä¸€ä¸ªä¸ªæ»‘åŠ¨ï¼Œç±»ä¼¼äºn-gramæœºåˆ¶å¯¹æ–‡æœ¬åˆ‡è¯ï¼Œç„¶åå’Œæ–‡æœ¬ä¸­çš„æ¯ä¸ªè¯è¿›è¡Œç›¸ä¼¼åº¦è®¡ç®—ï¼Œå› ä¸ºåé¢æ¥äº†ä¸ªMax-poolingï¼Œå› æ­¤åªä¼šä¿ç•™å’Œå·ç§¯æ ¸æœ€ç›¸è¿‘çš„è¯ã€‚å¾®åšæ•°æ®é›†å±äºæƒ…æ„Ÿåˆ†ç±»ï¼Œä¸ºäº†åˆ¤æ–­å¥å­çš„æƒ…æ„Ÿææ€§ï¼Œåªéœ€è¦è®©åˆ†ç±»å™¨èƒ½è¯†åˆ«å‡ºâ€œä¸å¼€å¿ƒâ€è¿™ç±»è¯æ˜¯ä¸ªè´Ÿææ€§çš„è¯ï¼Œâ€œé«˜å…´â€ã€â€œå¼€å¿ƒâ€ç­‰è¿™ç±»è¯æ˜¯æ­£ææ€§çš„è¯ï¼Œå…¶ä»–è¯æ˜¯åä¸­æ€§è¯å°±å¯ä»¥äº†ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬æŠŠè¯¥å¥å­ä¸­çš„å„ä¸ªè¯æ¡è¾“å…¥ç»™æ¨¡å‹å»åˆ†ç±»æ—¶ï¼Œå¹¶ä¸éœ€è¦å»â€œç»å‰é¡¾åâ€ï¼Œå› æ­¤ä½¿ç”¨ä¸€ä¸ªå…³æ³¨å±€éƒ¨çš„å‰é¦ˆç¥ç»ç½‘ç»œå¾€å¾€è¡¨ç°æ›´ä½³ã€‚è™½ç„¶Attentionä¹Ÿçªå‡ºäº†é‡ç‚¹ç‰¹å¾ï¼Œä½†æ˜¯éš¾ä»¥è¿‡æ»¤æ‰æ‰€æœ‰ä½åˆ†ç‰¹å¾ã€‚ä½†æ˜¯å¯¹äºé•¿æ–‡æœ¬ç›´æ¥ç”¨CNNå°±ä¸è¡Œäº†ï¼ŒTextCNNä¼šæ¯”HANæ¨¡å‹æ³›åŒ–èƒ½åŠ›å·®å¾ˆå¤šã€‚å¦‚æœåœ¨TextCNNå‰åŠ ä¸€å±‚LSTMï¼Œè¿™æ ·æ•ˆæœå¯ä»¥æå‡å¾ˆå¤§ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆé•¿æ–‡æœ¬åˆ†ç±»çš„å®éªŒä¸­ï¼Œcnn-å’Œ-rnn-æ²¡æœ‰æ‹‰å¼€å·®è·ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé•¿æ–‡æœ¬åˆ†ç±»çš„å®éªŒä¸­ï¼Œcnn-å’Œ-rnn-æ²¡æœ‰æ‹‰å¼€å·®è·ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé•¿æ–‡æœ¬åˆ†ç±»çš„å®éªŒä¸­ï¼Œcnn å’Œ rnn æ²¡æœ‰æ‹‰å¼€å·®è·ï¼Ÿ"></a>ä¸ºä»€ä¹ˆé•¿æ–‡æœ¬åˆ†ç±»çš„å®éªŒä¸­ï¼Œcnn å’Œ rnn æ²¡æœ‰æ‹‰å¼€å·®è·ï¼Ÿ</h4><p>cnnå’Œrnnçš„ç²¾åº¦éƒ½å¾ˆé«˜ï¼Œåˆ†æä¸»è¦è¿˜æ˜¯åˆ†ç±»çš„æ–‡ç« è§„åˆ™æ€§æ¯”è¾ƒå¼ºï¼Œä¸”å±äºç‰¹å®šé¢†åŸŸï¼Œè¯é‡ä¸å¤šï¼Œç±»åˆ«å·®å¼‚å¯èƒ½æ¯”è¾ƒæ˜æ˜¾ã€‚</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>å¤æ‚çš„æ¨¡å‹æœªå¿…ä¼šæœ‰å¾ˆå¥½çš„ç»“æœï¼Œç®€å•æ¨¡å‹æ•ˆæœæœªå¿…ä¸ç†æƒ³ï¼Œæ²¡å¿…è¦ä¸€å‘³è¿½æ±‚æ·±åº¦å­¦ä¹ ã€å¤æ‚æ¨¡å‹ä»€ä¹ˆçš„ã€‚é€‰ä»€ä¹ˆæ ·çš„æ¨¡å‹è¿˜æ˜¯è¦æ ¹æ®æ•°æ®æ¥çš„ã€‚åŒä¸€ç±»é—®é¢˜ï¼Œä¸åŒçš„æ•°æ®æ•ˆæœå·®å¼‚å¾ˆå¤§ï¼Œä¸è¦å°çœ‹ä»»ä½•ä¸€ç±»é—®é¢˜ï¼Œä¾‹å¦‚åˆ†ç±»ï¼Œæˆ‘ä»¬é€šå¸¸è§‰å¾—å®ƒå¾ˆç®€å•ï¼Œä½†æœ‰äº›æ•°æ®å¹¶éä½ æ‰€æƒ³ã€‚</p>
<h3 id="æ–‡æœ¬åˆ†ç±»tricks"><a href="#æ–‡æœ¬åˆ†ç±»tricks" class="headerlink" title="æ–‡æœ¬åˆ†ç±»tricks"></a>æ–‡æœ¬åˆ†ç±»tricks</h3><h4 id="åˆ†è¯å™¨"><a href="#åˆ†è¯å™¨" class="headerlink" title="åˆ†è¯å™¨"></a>åˆ†è¯å™¨</h4><p><strong>åˆ†è¯å™¨æ‰€åˆ†å‡ºçš„è¯ä¸è¯å‘é‡è¡¨ä¸­çš„tokenç²’åº¦matchæ˜¯æ›´é‡è¦çš„äº‹æƒ…</strong></p>
<h5 id="å·²çŸ¥é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨"><a href="#å·²çŸ¥é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨" class="headerlink" title="å·²çŸ¥é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨"></a>å·²çŸ¥é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨</h5><p>åƒword2vecã€gloveã€fasttextè¿™äº›å®˜æ–¹releaseçš„é¢„è®­ç»ƒè¯å‘é‡éƒ½ä¼šå…¬å¸ƒç›¸åº”è®­ç»ƒè¯­æ–™çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬é¢„å¤„ç†ç­–ç•¥å¦‚åˆ†è¯ï¼Œè¿™ç§æƒ…å†µä¸‹ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„è®­ç»ƒè¯¥è¯å‘é‡æ‰€ä½¿ç”¨çš„åˆ†è¯å™¨ï¼Œæ­¤åˆ†è¯å™¨åœ¨ä¸‹æ¸¸ä»»åŠ¡çš„è¡¨ç°åä¹‹å…«ä¹ä¼šæ¯”å…¶ä»–èŠ±é‡Œèƒ¡å“¨çš„åˆ†è¯å™¨å¥½ç”¨ã€‚</p>
<h5 id="ä¸çŸ¥é“é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨"><a href="#ä¸çŸ¥é“é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨" class="headerlink" title="ä¸çŸ¥é“é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨"></a>ä¸çŸ¥é“é¢„è®­ç»ƒè¯å‘é‡çš„åˆ†è¯å™¨</h5><p>è¿™æ—¶å°±éœ€è¦å»â€œçŒœâ€ä¸€ä¸‹åˆ†è¯å™¨ã€‚æ€ä¹ˆçŒœå‘¢ï¼Ÿ<br>é¦–å…ˆï¼Œæ‹¿åˆ°é¢„è®­ç»ƒè¯å‘é‡è¡¨åï¼Œå»é‡Œé¢searchä¸€äº›ç‰¹å®šè¯æ±‡æ¯”å¦‚ä¸€äº›ç½‘ç«™ã€é‚®ç®±ã€æˆè¯­ã€äººåç­‰ï¼Œè‹±æ–‡é‡Œè¿˜æœ‰nâ€™tç­‰ï¼Œçœ‹çœ‹è®­ç»ƒè¯å‘é‡ä½¿ç”¨çš„åˆ†è¯å™¨æ˜¯æŠŠå®ƒä»¬åˆ†æˆä»€ä¹ˆç²’åº¦ã€‚<br>ç„¶åè·‘å‡ ä¸ªåˆ†è¯å™¨ï¼Œçœ‹çœ‹å“ªä¸ªåˆ†è¯å™¨çš„ç²’åº¦è·Ÿä»–æœ€æ¥è¿‘å°±ç”¨å“ªä¸ªï¼Œå¦‚æœä¸æ”¾å¿ƒï¼Œå°±æ”¾åˆ°ä¸‹æ¸¸ä»»åŠ¡é‡Œè·‘è·‘çœ‹ã€‚</p>
<p>æœ€ç†æƒ³çš„æƒ…å†µæ˜¯ï¼šå…ˆç¡®å®šæœ€é€‚åˆå½“å‰ä»»åŠ¡æ•°æ®é›†çš„åˆ†è¯å™¨ï¼Œå†ä½¿ç”¨åŒåˆ†è¯å™¨äº§å‡ºçš„é¢„è®­ç»ƒè¯å‘é‡ã€‚å¦‚æœæ— æ³•æ»¡è¶³ç†æƒ³æƒ…å†µï¼Œåˆ™éœ€è¦è‡ªå·±åœ¨ä¸‹æ¸¸ä»»åŠ¡è®­ç»ƒé›†æˆ–è€…å¤§é‡åŒåˆ†å¸ƒæ— ç›‘ç£è¯­æ–™ä¸Šè®­ç»ƒçš„è¯å‘é‡æ›´æœ‰åˆ©äºè¿›ä¸€æ­¥å‹æ¦¨æ¨¡å‹çš„æ€§èƒ½ã€‚</p>
<h4 id="å…³äºä¸­æ–‡å­—å‘é‡"><a href="#å…³äºä¸­æ–‡å­—å‘é‡" class="headerlink" title="å…³äºä¸­æ–‡å­—å‘é‡"></a>å…³äºä¸­æ–‡å­—å‘é‡</h4><p>é¢„è®­ç»ƒä¸­æ–‡å­—å‘é‡çš„æ—¶å€™ï¼ŒæŠŠçª—å£å¼€å¤§ä¸€äº›ï¼Œä¸è¦ç›´æ¥ä½¿ç”¨word-levelçš„çª—å£å¤§å°ï¼Œæ•ˆæœä¼šæ¯”éšæœºåˆå§‹åŒ–çš„å­—å‘é‡æ˜æ˜¾çš„å¥½ã€‚</p>
<h4 id="æ•°æ®é›†å™ªå£°å¾ˆä¸¥é‡"><a href="#æ•°æ®é›†å™ªå£°å¾ˆä¸¥é‡" class="headerlink" title="æ•°æ®é›†å™ªå£°å¾ˆä¸¥é‡"></a>æ•°æ®é›†å™ªå£°å¾ˆä¸¥é‡</h4><p>é‡Œå™ªå£°ä¸¥é‡æœ‰ä¸¤ç§æƒ…å†µã€‚å¯¹äºæ•°æ®é›†D(X, Y)ï¼Œä¸€ç§æ˜¯Xå†…éƒ¨å™ªå£°å¾ˆå¤§ï¼ˆæ¯”å¦‚æ–‡æœ¬ä¸ºå£è¯­åŒ–è¡¨è¿°æˆ–ç”±äº’è”ç½‘ç”¨æˆ·ç”Ÿæˆï¼‰ï¼Œä¸€ç§æ˜¯Yçš„å™ªå£°å¾ˆå¤§ï¼ˆä¸€äº›æ ·æœ¬è¢«æ˜æ˜¾çš„é”™è¯¯æ ‡æ³¨ï¼Œä¸€äº›æ ·æœ¬äººä¹Ÿå¾ˆéš¾å®šä¹‰æ˜¯å±äºå“ªä¸€ç±»ï¼Œç”šè‡³å…·å¤‡ç±»åˆ«äºŒä¹‰æ€§ï¼‰ã€‚</p>
<h5 id="Xå†…éƒ¨å™ªå£°å¾ˆå¤§"><a href="#Xå†…éƒ¨å™ªå£°å¾ˆå¤§" class="headerlink" title="Xå†…éƒ¨å™ªå£°å¾ˆå¤§"></a>Xå†…éƒ¨å™ªå£°å¾ˆå¤§</h5><p>æ³•ä¸€ï¼šç›´æ¥å°†æ¨¡å‹çš„è¾“å…¥å˜æˆchar-levelï¼ˆä¸­æ–‡ä¸­å°±æ˜¯å­—çš„ç²’åº¦ï¼‰ï¼Œç„¶åtrain from scratchï¼ˆä¸ä½¿ç”¨é¢„è®­ç»ƒè¯å‘é‡ï¼‰å»è·Ÿword-levelçš„å¯¹æ¯”ä¸€ä¸‹ï¼Œå¦‚æœchar-levelçš„æ˜æ˜¾çš„æ•ˆæœå¥½ï¼Œé‚£ä¹ˆçŸ­æ—¶é—´ä¹‹å†…å°±ç›´æ¥åŸºäºchar-levelå»åšæ¨¡å‹ã€‚</p>
<p>æ³•äºŒï¼šä½¿ç”¨ç‰¹æ®Šè¶…å‚çš„FastTextå»è®­ç»ƒä¸€ä»½è¯å‘é‡ï¼š<br>ä¸€èˆ¬æ¥è¯´fasttextåœ¨è‹±æ–‡ä¸­çš„char ngramçš„çª—å£å¤§å°ä¸€èˆ¬å–å€¼3ï½6ï¼Œä½†æ˜¯åœ¨å¤„ç†ä¸­æ–‡æ—¶ï¼Œå¦‚æœæˆ‘ä»¬çš„ç›®çš„æ˜¯ä¸ºäº†å»é™¤è¾“å…¥ä¸­çš„å™ªå£°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªçª—å£é™åˆ¶ä¸º1ï½2ï¼Œè¿™ç§å°çª—å£æœ‰åˆ©äºæ¨¡å‹å»æ•è·é”™åˆ«å­—ï¼ˆæ¯”å¦‚ï¼Œæˆ‘ä»¬æ‰“ä¸€ä¸ªé”™è¯¯è¯çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½æ˜¯å°†å…¶ä¸­çš„ä¸€ä¸ªå­—è¾¾æˆåŒéŸ³å¼‚å½¢çš„å¦ä¸€ä¸ªå­—ï¼‰ï¼Œæ¯”å¦‚word2vecå­¦å‡ºæ¥çš„â€œä¼¼ä¹â€çš„æœ€è¿‘è¯å¯èƒ½æ˜¯â€œå¥½åƒâ€ï¼Œç„¶è€Œå°ngramçª—å£fasttextå­¦å‡ºæ¥çš„â€œä¼¼ä¹â€æœ€è¿‘è¯åˆ™å¾ˆæœ‰å¯èƒ½æ˜¯â€œæ˜¯ä¹â€ç­‰å†…éƒ¨åŒ…å«é”™åˆ«å­—çš„è¯ï¼Œè¿™æ ·å°±ä¸€ä¸‹å­è®©ä¸å¤ªè¿‡åˆ†çš„é”™åˆ«å­—æ„æˆçš„è¯ä»¬åˆé‡æ–°å›åˆ°äº†ä¸€èµ·ï¼Œç”šè‡³å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šå¯¹æŠ—åˆ†è¯å™¨äº§ç”Ÿçš„å™ªå£°ï¼ˆæŠŠä¸€ä¸ªè¯åˆ‡åˆ†æˆå¤šä¸ªå­—ï¼‰ã€‚</p>
<h5 id="Yçš„å™ªå£°å¾ˆå¤§"><a href="#Yçš„å™ªå£°å¾ˆå¤§" class="headerlink" title="Yçš„å™ªå£°å¾ˆå¤§"></a>Yçš„å™ªå£°å¾ˆå¤§</h5><p>é¦–å…ˆå¿½ç•¥è¿™ä¸ªå™ªå£°ï¼Œå¼ºè¡Œçš„æŠŠæ¨¡å‹å°½å¯èƒ½å¥½çš„è®­å‡ºæ¥ã€‚ç„¶åè®©è®­ç»ƒå¥½çš„æ¨¡å‹å»è·‘è®­ç»ƒé›†å’Œå¼€å‘é›†ï¼Œå–å‡ºè®­ç»ƒé›†ä¸­çš„é”™è¯¯æ ·æœ¬å’Œå¼€å‘é›†ä¸­é‚£äº›ä»¥å¾ˆé«˜çš„ç½®ä¿¡åº¦åšå‡ºé”™è¯¯å†³ç­–çš„æ ·æœ¬ï¼ˆæ¯”å¦‚ä»¥99%çš„æŠŠæ¡æŠŠä¸€ä¸ªæ ‡ç­¾ä¸º0çš„æ ·æœ¬é¢„æµ‹ä¸º1ï¼‰ï¼Œç„¶åå»åšè¿™äº›bad casesçš„åˆ†æï¼Œå¦‚æœå‘ç°é”™è¯¯æ ‡æ³¨æœ‰å¾ˆå¼ºçš„è§„å¾‹æ€§ï¼Œåˆ™ç›´æ¥æ’¸ä¸€ä¸ªè„šæœ¬æ‰¹é‡çº æ­£ä¸€ä¸‹ï¼ˆåªè¦ç¡®ä¿çº æ­£åçš„æ ‡æ³¨æ­£ç¡®ç‡æ¯”çº æ­£å‰æ˜æ˜¾é«˜å°±è¡Œï¼‰ã€‚<br>å¦‚æœæ²¡æœ‰ä»€ä¹ˆè§„å¾‹ï¼Œä½†æ˜¯å‘ç°æ¨¡å‹é«˜ç½®ä¿¡åº¦åšé”™çš„è¿™äº›æ ·æœ¬å¤§éƒ¨åˆ†éƒ½æ˜¯æ ‡æ³¨é”™è¯¯çš„è¯ï¼Œå°±ç›´æ¥æŠŠè¿™äº›æ ·æœ¬éƒ½åˆ æ‰ï¼Œå¸¸å¸¸ä¹Ÿå¯ä»¥æ¢æ¥æ€§èƒ½çš„å°å¹…æå‡ï¼Œæ¯•ç«Ÿæµ‹è¯•é›†éƒ½æ˜¯äººå·¥æ ‡æ³¨çš„ï¼Œå›°éš¾æ ·æœ¬å’Œé”™æ ‡æ ·æœ¬ä¸ä¼šå¤ªå¤šã€‚</p>
<h4 id="baselineé€‰ç”¨CNNè¿˜æ˜¯RNNï¼Ÿ"><a href="#baselineé€‰ç”¨CNNè¿˜æ˜¯RNNï¼Ÿ" class="headerlink" title="baselineé€‰ç”¨CNNè¿˜æ˜¯RNNï¼Ÿ"></a>baselineé€‰ç”¨CNNè¿˜æ˜¯RNNï¼Ÿ</h4><p>çœ‹æ•°æ®é›†ï¼Œå¦‚æœæ„Ÿè§‰æ•°æ®é›†é‡Œå¾ˆå¤šå¾ˆå¼ºçš„ngramå¯ä»¥ç›´æ¥å¸®åŠ©ç”Ÿæˆæ­£ç¡®å†³ç­–ï¼Œé‚£å°±CNNã€‚<br>å¦‚æœæ„Ÿè§‰å¾ˆå¤šcaseéƒ½æ˜¯é‚£ç§éœ€è¦æŠŠä¸€ä¸ªå¥å­çœ‹å®Œç”šè‡³çœ‹ä¸¤ä¸‰éæ‰å®¹æ˜“å¾—å‡ºæ­£ç¡®tagï¼Œé‚£å°±RNNã€‚<br>è¿˜å¯ä»¥CNNã€RNNçš„æ¨¡å‹éƒ½è·‘å‡ºæ¥ç®€å•é›†æˆä¸€ä¸‹ã€‚</p>
<h4 id="DropoutåŠ åœ¨å“ªé‡Œ"><a href="#DropoutåŠ åœ¨å“ªé‡Œ" class="headerlink" title="DropoutåŠ åœ¨å“ªé‡Œ"></a>DropoutåŠ åœ¨å“ªé‡Œ</h4><p>word embeddingå±‚åã€poolingå±‚åã€FCå±‚ï¼ˆå…¨è”æ¥å±‚ï¼‰åã€‚</p>
<h4 id="äºŒåˆ†ç±»"><a href="#äºŒåˆ†ç±»" class="headerlink" title="äºŒåˆ†ç±»"></a>äºŒåˆ†ç±»</h4><p>äºŒåˆ†ç±»é—®é¢˜ä¸ä¸€å®šè¦ç”¨sigmoidä½œä¸ºè¾“å‡ºå±‚çš„æ¿€æ´»å‡½æ•°ï¼Œå°è¯•ä¸€ä¸‹åŒ…å«ä¿©ç±»åˆ«çš„softmaxã€‚å¯èƒ½å¤šä¸€æ¡åˆ†æ”¯å°±å¤šä¸€ç‚¹ä¿¡æ¯ï¼Œå®è·µä¸­å¸¸å¸¸å¸¦æ¥é›¶ç‚¹å‡ ä¸ªç‚¹çš„æå‡ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒç„å­¦äº†ã€‚</p>
<h4 id="å¤šæ ‡ç­¾åˆ†ç±»"><a href="#å¤šæ ‡ç­¾åˆ†ç±»" class="headerlink" title="å¤šæ ‡ç­¾åˆ†ç±»"></a>å¤šæ ‡ç­¾åˆ†ç±»</h4><p>å¦‚æœä¸€ä¸ªæ ·æœ¬åŒæ—¶æ‹¥æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œç”šè‡³æ ‡ç­¾åŒæ—¶è¿˜æ„æˆäº†DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰ï¼Œå…ˆç”¨binary-cross-entropyè®­å‡ºä¸ªbaselineæ¥ï¼ˆå³æŠŠæ¯ä¸ªç±»åˆ«å˜æˆä¸€ä¸ªäºŒåˆ†ç±»é—®é¢˜ï¼Œè¿™æ ·Nä¸ªç±»åˆ«çš„å¤šæ ‡ç­¾åˆ†ç±»é—®é¢˜å°±å˜æˆäº†Nä¸ªäºŒåˆ†ç±»é—®é¢˜ï¼‰ï¼Œè¿™ä¸ªbaselineåšå¥½åå¥½åƒå¤šæ ‡ç­¾é—®é¢˜ä¸å¤§äº†ï¼ŒDAGé—®é¢˜è‡ªå·±ä¹ŸåŸºæœ¬è§£å†³äº†ï¼ˆè™½ç„¶æ¨¡å‹å±‚å¹¶æ²¡æœ‰ä¸“é—¨é’ˆå¯¹è¿™ä¸ªé—®é¢˜ä½œå¤„ç†ï¼‰ï¼Œç„¶åå°±å¯ä»¥å®‰å¿ƒåšæ¨¡å‹è¾£ã€‚</p>
<h4 id="æ ·æœ¬ç±»åˆ«ä¸å‡è¡¡é—®é¢˜"><a href="#æ ·æœ¬ç±»åˆ«ä¸å‡è¡¡é—®é¢˜" class="headerlink" title="æ ·æœ¬ç±»åˆ«ä¸å‡è¡¡é—®é¢˜"></a>æ ·æœ¬ç±»åˆ«ä¸å‡è¡¡é—®é¢˜</h4><p>å¦‚æœæ­£è´Ÿæ ·æœ¬æ¯”å°äº9:1çš„è¯ï¼Œç»§ç»­åšæ·±åº¦æ¨¡å‹è°ƒè¶…å‚ï¼Œæ¨¡å‹åšå¥½åä¼šå‘ç°è¿™ç‚¹ä¸å‡è¡¡å¯¹æ¨¡å‹æ¥è¯´ä¸å€¼ä¸€æï¼Œå†³ç­–é˜ˆå€¼ä¹Ÿå®Œå…¨ä¸ç”¨æ‰‹è°ƒã€‚<br>ä½†æ˜¯ï¼Œå¦‚æœç»å¸¸ä¸€ä¸ªbatchä¸­å®Œå…¨å°±æ˜¯åŒä¸€ä¸ªç±»åˆ«çš„æ ·æœ¬ï¼Œæˆ–è€…ä¸€äº›ç±»åˆ«çš„æ ·æœ¬ç»è¿‡å¥½å¤šbatchéƒ½éš¾é‡åˆ°ä¸€ä¸ªçš„è¯ï¼Œå‡è¡¡å°±éå¸¸éå¸¸æœ‰å¿…è¦äº†ã€‚<a href="https://mp.weixin.qq.com/s?__biz=MzIwNzc2NTk0NQ==&amp;mid=2247484993&amp;idx=1&amp;sn=0bd32089a638e5a1b48239656febb6e0&amp;chksm=970c2e97a07ba7818d63dddbb469486dccb369ecc11f38ffdea596452b9e5bf65772820a8ac9&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">å¦‚ä½•ä¼˜é›…è€Œæ—¶é«¦çš„è§£å†³ä¸å‡è¡¡åˆ†ç±»é—®é¢˜</a></p>
<h4 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h4><ol>
<li>åˆ«å¤ªçº ç»“æ–‡æœ¬æˆªæ–­é•¿åº¦ä½¿ç”¨120è¿˜æ˜¯150</li>
<li>åˆ«å¤ªçº ç»“å¯¹æ€§èƒ½ä¸æ•æ„Ÿçš„è¶…å‚æ•°å¸¦æ¥çš„å¼€å‘é›†æ€§èƒ½çš„å¾®å°æå‡</li>
<li>åˆ«å¤ªçº ç»“æœªç™»é™†è¯çš„embeddingæ˜¯åˆå§‹åŒ–æˆå…¨0è¿˜æ˜¯éšæœºåˆå§‹åŒ–ï¼Œåˆ«è·ŸPADå…±äº«embeddingå°±è¡Œ</li>
<li>åˆ«å¤ªçº ç»“ä¼˜åŒ–å™¨ç”¨Adamè¿˜æ˜¯MomentumSGDï¼Œå¦‚æœè·ŸSGDçš„æ„Ÿæƒ…è¿˜ä¸æ·±ï¼Œå°±æ— è„‘Adamï¼Œæœ€åå†ç”¨MomentumSGDè·‘å‡ é</li>
<li>è¿˜æ˜¯ä¸ä¼šç”¨tricksä½†æ˜¯å°±æ˜¯æƒ³è·‘å‡ºä¸ªå¥½ç»“æœï¼Œbertå¤§åŠ›å‡ºå¥‡è¿¹ã€‚</li>
</ol>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://blog.csdn.net/feilong_csdn/article/details/88655927" target="_blank" rel="noopener">fastTextåŸç†å’Œæ–‡æœ¬åˆ†ç±»å®æˆ˜ï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></li>
<li><a href="https://blog.csdn.net/asialee_bird/article/details/88813385#ä¸€ã€è®ºæ–‡ç¬”è®°" target="_blank" rel="noopener">TextCNNæ–‡æœ¬åˆ†ç±»ï¼ˆkeraså®ç°ï¼‰</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/55263066" target="_blank" rel="noopener">æµ…è°ˆåŸºäºæ·±åº¦å­¦ä¹ çš„æ–‡æœ¬åˆ†ç±»é—®é¢˜</a></li>
<li><a href="https://www.jiqizhixin.com/articles/2018-06-22-4" target="_blank" rel="noopener">ä»DPCNNå‡ºå‘ï¼Œæ’©ä¸€ä¸‹æ·±å±‚word-levelæ–‡æœ¬åˆ†ç±»æ¨¡å‹</a></li>
<li><a href="https://www.jiqizhixin.com/articles/2019-01-24-5" target="_blank" rel="noopener">æ–‡æœ¬åˆ†ç±»æœ‰å“ªäº›è®ºæ–‡ä¸­å¾ˆå°‘æåŠå´å¯¹æ€§èƒ½æœ‰é‡è¦å½±å“çš„tricksï¼Ÿ</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwNzc2NTk0NQ==&amp;mid=2247484682&amp;idx=1&amp;sn=51520138eed826ec891ac8154ee550f9&amp;chksm=970c2ddca07ba4ca33ee14542cff0457601bb16236f8edc1ff0e617051d1f063354dda0f8893&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">ä»å‰é¦ˆåˆ°åé¦ˆï¼šè§£æå¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰åŠå…¶tricks</a></li>
<li><a href="http://www.52nlp.cn/tag/é•¿æ–‡æœ¬åˆ†ç±»" target="_blank" rel="noopener"><a href="http://www.52nlp.cn/å¦‚ä½•ç”¨æ·±åº¦å­¦ä¹ åšå¥½é•¿æ–‡æœ¬åˆ†ç±»ä¸æ³•å¾‹æ–‡ä¹¦æ™ºèƒ½åŒ–" target="_blank" rel="noopener">è¾¾è§‚æ•°æ®æ›¾å½¦èƒ½ï¼šå¦‚ä½•ç”¨æ·±åº¦å­¦ä¹ åšå¥½é•¿æ–‡æœ¬åˆ†ç±»ä¸æ³•å¾‹æ–‡ä¹¦æ™ºèƒ½åŒ–å¤„ç†</a></a></li>
<li><a href="https://www.zhihu.com/question/326770917/answer/698646465" target="_blank" rel="noopener">çŸ­æ–‡æœ¬åˆ†ç±»å’Œé•¿æ–‡æœ¬åˆ†ç±»çš„æ¨¡å‹å¦‚ä½•è¿›è¡Œé€‰æ‹©ï¼Ÿ</a></li>
<li><a href="https://www.pianshen.com/article/4319299677/" target="_blank" rel="noopener">NLPå®è·µä¹ï¼šHANåŸç†ä¸æ–‡æœ¬åˆ†ç±»å®è·µ</a></li>
</ol>
]]></content>
      <categories>
        <category>æ–‡æœ¬åˆ†ç±»</category>
      </categories>
      <tags>
        <tag>è‡ªç„¶è¯­è¨€å¤„ç†</tag>
        <tag>FastText</tag>
      </tags>
  </entry>
  <entry>
    <title>BatchNormalization</title>
    <url>/2020/03/28/BatchNormalization/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æœºå™¨å­¦ä¹ é¢†åŸŸæœ‰ä¸ªå¾ˆé‡è¦çš„å‡è®¾ï¼š<strong>IIDç‹¬ç«‹åŒåˆ†å¸ƒå‡è®¾</strong>ï¼Œå°±æ˜¯å‡è®¾è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®æ˜¯æ»¡è¶³ç›¸åŒåˆ†å¸ƒçš„ï¼Œè¿™æ˜¯é€šè¿‡è®­ç»ƒæ•°æ®è·å¾—çš„æ¨¡å‹èƒ½å¤Ÿåœ¨æµ‹è¯•é›†è·å¾—å¥½çš„æ•ˆæœçš„ä¸€ä¸ªåŸºæœ¬ä¿éšœã€‚</p>
<p>é‚£BatchNormçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<strong>BatchNormå°±æ˜¯åœ¨æ·±åº¦ç¥ç»ç½‘ç»œè®­ç»ƒè¿‡ç¨‹ä¸­ä½¿å¾—æ¯ä¸€å±‚ç¥ç»ç½‘ç»œçš„è¾“å…¥ä¿æŒç›¸åŒåˆ†å¸ƒçš„ã€‚</strong></p>
<a id="more"></a>
<h3 id="Internal-Covariate-Shift-é—®é¢˜"><a href="#Internal-Covariate-Shift-é—®é¢˜" class="headerlink" title="Internal Covariate Shift é—®é¢˜"></a>Internal Covariate Shift é—®é¢˜</h3><p><strong>å¦‚æœMLç³»ç»Ÿå®ä¾‹é›†åˆä¸­çš„è¾“å…¥å€¼Xçš„åˆ†å¸ƒè€æ˜¯å˜ï¼Œè¿™ä¸ç¬¦åˆIIDå‡è®¾</strong>ï¼Œç½‘ç»œæ¨¡å‹å¾ˆéš¾<strong>ç¨³å®šçš„å­¦è§„å¾‹</strong>,å¯¹äºæ·±åº¦å­¦ä¹ è¿™ç§åŒ…å«å¾ˆå¤šéšå±‚çš„ç½‘ç»œç»“æ„ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå› ä¸ºå„å±‚å‚æ•°ä¸åœåœ¨å˜åŒ–ï¼Œæ‰€ä»¥æ¯ä¸ªéšå±‚éƒ½ä¼šé¢ä¸´covariate shiftçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯<strong>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œéšå±‚çš„è¾“å…¥åˆ†å¸ƒè€æ˜¯å˜æ¥å˜å»ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œInternal Covariate Shiftâ€ï¼ŒInternalæŒ‡çš„æ˜¯æ·±å±‚ç½‘ç»œçš„éšå±‚ï¼Œæ˜¯å‘ç”Ÿåœ¨ç½‘ç»œå†…éƒ¨çš„äº‹æƒ…ï¼Œè€Œä¸æ˜¯covariate shifté—®é¢˜åªå‘ç”Ÿåœ¨è¾“å…¥å±‚</strong>ã€‚</p>
<p>ç„¶åæå‡ºäº†BatchNormçš„åŸºæœ¬æ€æƒ³ï¼šèƒ½ä¸èƒ½<strong>è®©æ¯ä¸ªéšå±‚èŠ‚ç‚¹çš„æ¿€æ´»è¾“å…¥åˆ†å¸ƒå›ºå®šä¸‹æ¥å‘¢</strong>ï¼Ÿè¿™æ ·å°±é¿å…äº†â€œInternal Covariate Shiftâ€é—®é¢˜äº†ã€‚</p>
<p>BNä¸æ˜¯å‡­ç©ºæ‹è„‘è¢‹æ‹å‡ºæ¥çš„å¥½ç‚¹å­ï¼Œå®ƒæ˜¯æœ‰å¯å‘æ¥æºçš„ï¼šä¹‹å‰çš„ç ”ç©¶è¡¨æ˜å¦‚æœåœ¨å›¾åƒå¤„ç†ä¸­å¯¹è¾“å…¥å›¾åƒè¿›è¡Œç™½åŒ–ï¼ˆWhitenï¼‰æ“ä½œçš„è¯â€”â€”æ‰€è°“<strong>ç™½åŒ–</strong>ï¼Œ<strong>å°±æ˜¯å¯¹è¾“å…¥æ•°æ®åˆ†å¸ƒå˜æ¢åˆ°0å‡å€¼ï¼Œå•ä½æ–¹å·®çš„æ­£æ€åˆ†å¸ƒ</strong>â€”â€”é‚£ä¹ˆç¥ç»ç½‘ç»œä¼šè¾ƒå¿«æ”¶æ•›ï¼Œé‚£ä¹ˆBNä½œè€…å°±å¼€å§‹æ¨è®ºäº†ï¼šå›¾åƒæ˜¯æ·±åº¦ç¥ç»ç½‘ç»œçš„è¾“å…¥å±‚ï¼Œåšç™½åŒ–èƒ½åŠ å¿«æ”¶æ•›ï¼Œé‚£ä¹ˆå…¶å®å¯¹äºæ·±åº¦ç½‘ç»œæ¥è¯´ï¼Œå…¶ä¸­æŸä¸ªéšå±‚çš„ç¥ç»å…ƒæ˜¯ä¸‹ä¸€å±‚çš„è¾“å…¥ï¼Œæ„æ€æ˜¯å…¶å®æ·±åº¦ç¥ç»ç½‘ç»œçš„æ¯ä¸€ä¸ªéšå±‚éƒ½æ˜¯è¾“å…¥å±‚ï¼Œä¸è¿‡æ˜¯ç›¸å¯¹ä¸‹ä¸€å±‚æ¥è¯´è€Œå·²ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½å¯¹æ¯ä¸ªéšå±‚éƒ½åšç™½åŒ–å‘¢ï¼Ÿè¿™å°±æ˜¯å¯å‘BNäº§ç”Ÿçš„åŸåˆæƒ³æ³•ï¼Œè€ŒBNä¹Ÿç¡®å®å°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œ<strong>å¯ä»¥ç†è§£ä¸ºå¯¹æ·±å±‚ç¥ç»ç½‘ç»œæ¯ä¸ªéšå±‚ç¥ç»å…ƒçš„æ¿€æ´»å€¼åšç®€åŒ–ç‰ˆæœ¬çš„ç™½åŒ–æ“ä½œã€‚</strong></p>
<h3 id="BatchNormçš„æœ¬è´¨æ€æƒ³"><a href="#BatchNormçš„æœ¬è´¨æ€æƒ³" class="headerlink" title="BatchNormçš„æœ¬è´¨æ€æƒ³"></a>BatchNormçš„æœ¬è´¨æ€æƒ³</h3><p>BNçš„åŸºæœ¬æ€æƒ³å…¶å®ç›¸å½“ç›´è§‚ï¼šå› ä¸ºæ·±å±‚ç¥ç»ç½‘ç»œåœ¨åšéçº¿æ€§å˜æ¢å‰çš„<strong>æ¿€æ´»è¾“å…¥å€¼</strong>ï¼ˆå°±æ˜¯é‚£ä¸ªx=WU+Bï¼ŒUæ˜¯è¾“å…¥ï¼‰<strong>éšç€ç½‘ç»œæ·±åº¦åŠ æ·±æˆ–è€…åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå…¶åˆ†å¸ƒé€æ¸å‘ç”Ÿåç§»æˆ–è€…å˜åŠ¨ï¼Œä¹‹æ‰€ä»¥è®­ç»ƒæ”¶æ•›æ…¢ï¼Œä¸€èˆ¬æ˜¯æ•´ä½“åˆ†å¸ƒé€æ¸å¾€éçº¿æ€§å‡½æ•°çš„å–å€¼åŒºé—´çš„ä¸Šä¸‹é™ä¸¤ç«¯é è¿‘</strong>ï¼ˆå¯¹äºSigmoidå‡½æ•°æ¥è¯´ï¼Œæ„å‘³ç€æ¿€æ´»è¾“å…¥å€¼WU+Bæ˜¯å¤§çš„è´Ÿå€¼æˆ–æ­£å€¼ï¼‰ï¼Œæ‰€ä»¥è¿™<strong>å¯¼è‡´åå‘ä¼ æ’­æ—¶ä½å±‚ç¥ç»ç½‘ç»œçš„æ¢¯åº¦æ¶ˆå¤±</strong>ï¼Œè¿™æ˜¯è®­ç»ƒæ·±å±‚ç¥ç»ç½‘ç»œæ”¶æ•›è¶Šæ¥è¶Šæ…¢çš„<strong>æœ¬è´¨åŸå› </strong>ï¼Œ<strong>è€ŒBNå°±æ˜¯é€šè¿‡ä¸€å®šçš„è§„èŒƒåŒ–æ‰‹æ®µï¼ŒæŠŠæ¯å±‚ç¥ç»ç½‘ç»œä»»æ„ç¥ç»å…ƒè¿™ä¸ªè¾“å…¥å€¼çš„åˆ†å¸ƒå¼ºè¡Œæ‹‰å›åˆ°å‡å€¼ä¸º0æ–¹å·®ä¸º1çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒ</strong>ï¼Œå…¶å®å°±æ˜¯æŠŠè¶Šæ¥è¶Šåçš„åˆ†å¸ƒå¼ºåˆ¶æ‹‰å›æ¯”è¾ƒæ ‡å‡†çš„åˆ†å¸ƒï¼Œè¿™æ ·ä½¿å¾—æ¿€æ´»è¾“å…¥å€¼è½åœ¨éçº¿æ€§å‡½æ•°å¯¹è¾“å…¥æ¯”è¾ƒæ•æ„Ÿçš„åŒºåŸŸï¼Œè¿™æ ·è¾“å…¥çš„å°å˜åŒ–å°±ä¼šå¯¼è‡´æŸå¤±å‡½æ•°è¾ƒå¤§çš„å˜åŒ–ï¼Œæ„æ€æ˜¯<strong>è¿™æ ·è®©æ¢¯åº¦å˜å¤§ï¼Œé¿å…æ¢¯åº¦æ¶ˆå¤±é—®é¢˜äº§ç”Ÿï¼Œè€Œä¸”æ¢¯åº¦å˜å¤§æ„å‘³ç€å­¦ä¹ æ”¶æ•›é€Ÿåº¦å¿«ï¼Œèƒ½å¤§å¤§åŠ å¿«è®­ç»ƒé€Ÿåº¦ã€‚</strong></p>
<p><strong>å¯¹äºæ¯ä¸ªéšå±‚ç¥ç»å…ƒï¼ŒæŠŠé€æ¸å‘éçº¿æ€§å‡½æ•°æ˜ å°„åå‘å–å€¼åŒºé—´æé™é¥±å’ŒåŒºé æ‹¢çš„è¾“å…¥åˆ†å¸ƒå¼ºåˆ¶æ‹‰å›åˆ°å‡å€¼ä¸º0æ–¹å·®ä¸º1çš„æ¯”è¾ƒæ ‡å‡†çš„æ­£æ€åˆ†å¸ƒï¼Œä½¿å¾—éçº¿æ€§å˜æ¢å‡½æ•°çš„è¾“å…¥å€¼è½å…¥å¯¹è¾“å…¥æ¯”è¾ƒæ•æ„Ÿçš„åŒºåŸŸï¼Œä»¥æ­¤é¿å…æ¢¯åº¦æ¶ˆå¤±é—®é¢˜</strong>ã€‚å› ä¸ºæ¢¯åº¦ä¸€ç›´éƒ½èƒ½ä¿æŒæ¯”è¾ƒå¤§çš„çŠ¶æ€ï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾å¯¹ç¥ç»ç½‘ç»œçš„å‚æ•°è°ƒæ•´æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œå°±æ˜¯å˜åŠ¨å¤§ï¼Œå°±æ˜¯è¯´å‘æŸå¤±å‡½æ•°æœ€ä¼˜å€¼è¿ˆåŠ¨çš„æ­¥å­å¤§ï¼Œä¹Ÿå°±æ˜¯è¯´æ”¶æ•›åœ°å¿«ã€‚BNè¯´åˆ°åº•å°±æ˜¯è¿™ä¹ˆä¸ªæœºåˆ¶ï¼Œæ–¹æ³•å¾ˆç®€å•ï¼Œé“ç†å¾ˆæ·±åˆ»ã€‚</p>
<h3 id="è®­ç»ƒé˜¶æ®µå¦‚ä½•åšBatchNorm"><a href="#è®­ç»ƒé˜¶æ®µå¦‚ä½•åšBatchNorm" class="headerlink" title="è®­ç»ƒé˜¶æ®µå¦‚ä½•åšBatchNorm"></a>è®­ç»ƒé˜¶æ®µå¦‚ä½•åšBatchNorm</h3><p>å‡è®¾å¯¹äºä¸€ä¸ªæ·±å±‚ç¥ç»ç½‘ç»œæ¥è¯´ï¼Œå…¶ä¸­ä¸¤å±‚ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="/2020/03/28/BatchNormalization/bn1.png" alt="avatar"></p>
<p>è¦å¯¹æ¯ä¸ªéšå±‚ç¥ç»å…ƒçš„æ¿€æ´»å€¼åšBNï¼Œå¯ä»¥æƒ³è±¡æˆæ¯ä¸ªéšå±‚åˆåŠ ä¸Šäº†ä¸€å±‚BNæ“ä½œå±‚ï¼Œå®ƒä½äºX=WU+Bæ¿€æ´»å€¼è·å¾—ä¹‹åï¼Œéçº¿æ€§å‡½æ•°å˜æ¢ä¹‹å‰ï¼Œå…¶å›¾ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="/2020/03/28/BatchNormalization/bn2.png" alt="avatar"></p>
<p>å¯¹äºMini-Batch SGDæ¥è¯´ï¼Œä¸€æ¬¡è®­ç»ƒè¿‡ç¨‹é‡Œé¢åŒ…å«mä¸ªè®­ç»ƒå®ä¾‹ï¼Œå…¶å…·ä½“BNæ“ä½œå°±æ˜¯å¯¹äºéšå±‚å†…æ¯ä¸ªç¥ç»å…ƒçš„æ¿€æ´»å€¼æ¥è¯´ï¼Œè¿›è¡Œå¦‚ä¸‹å˜æ¢ï¼š</p>
<script type="math/tex; mode=display">
\hat{x}^{(k)}=\frac{x^{(k)}-E\left[x^{(k)}\right]}{\sqrt{\operatorname{Var}\left[x^{(k)}\right]}}</script><p>æŸä¸ªç¥ç»å…ƒå¯¹åº”çš„åŸå§‹çš„æ¿€æ´»xé€šè¿‡å‡å»mini-Batchå†…mä¸ªå®ä¾‹è·å¾—çš„mä¸ªæ¿€æ´»xæ±‚å¾—çš„å‡å€¼E(x)å¹¶é™¤ä»¥æ±‚å¾—çš„æ–¹å·®Var(x)æ¥è¿›è¡Œè½¬æ¢ã€‚</p>
<p>ç»è¿‡è¿™ä¸ª<strong>å˜æ¢åæŸä¸ªç¥ç»å…ƒçš„æ¿€æ´»xå½¢æˆäº†å‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º1çš„æ­£æ€åˆ†å¸ƒï¼Œç›®çš„æ˜¯æŠŠå€¼å¾€åç»­è¦è¿›è¡Œçš„éçº¿æ€§å˜æ¢çš„çº¿æ€§åŒºæ‹‰åŠ¨ï¼Œå¢å¤§å¯¼æ•°å€¼ï¼Œå¢å¼ºåå‘ä¼ æ’­ä¿¡æ¯æµåŠ¨æ€§ï¼ŒåŠ å¿«è®­ç»ƒæ”¶æ•›é€Ÿåº¦ã€‚ ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ç½‘ç»œè¡¨è¾¾èƒ½åŠ›ä¸‹é™ï¼Œä¸ºäº†é˜²æ­¢è¿™ä¸€ç‚¹ï¼Œæ¯ä¸ªç¥ç»å…ƒå¢åŠ ä¸¤ä¸ªè°ƒèŠ‚å‚æ•°ï¼ˆscaleå’Œshiftï¼‰ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ˜¯é€šè¿‡è®­ç»ƒæ¥å­¦ä¹ åˆ°çš„ï¼Œç”¨æ¥å¯¹å˜æ¢åçš„æ¿€æ´»åå˜æ¢ï¼Œä½¿å¾—ç½‘ç»œè¡¨è¾¾èƒ½åŠ›å¢å¼ºï¼Œå³å¯¹å˜æ¢åçš„æ¿€æ´»è¿›è¡Œå¦‚ä¸‹çš„scaleå’Œshiftæ“ä½œï¼Œè¿™å…¶å®æ˜¯å˜æ¢çš„åæ“ä½œï¼š</strong></p>
<script type="math/tex; mode=display">
y^{(k)}=\gamma^{(k)} \hat{x}^{(k)}+\beta^{(k)}</script><p>ç®—æ³•æè¿°ï¼š</p>
<p><img src="/2020/03/28/BatchNormalization/bn3.png" alt="avatar"></p>
<h3 id="æ¨ç†é˜¶æ®µå¦‚ä½•åšBatchNorm"><a href="#æ¨ç†é˜¶æ®µå¦‚ä½•åšBatchNorm" class="headerlink" title="æ¨ç†é˜¶æ®µå¦‚ä½•åšBatchNorm"></a>æ¨ç†é˜¶æ®µå¦‚ä½•åšBatchNorm</h3><p>BNåœ¨è®­ç»ƒçš„æ—¶å€™å¯ä»¥æ ¹æ®Mini-Batché‡Œçš„è‹¥å¹²è®­ç»ƒå®ä¾‹è¿›è¡Œæ¿€æ´»æ•°å€¼è°ƒæ•´ï¼Œä½†æ˜¯åœ¨æ¨ç†ï¼ˆinferenceï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆæ˜æ˜¾è¾“å…¥å°±åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œçœ‹ä¸åˆ°Mini-Batchå…¶å®ƒå®ä¾‹ï¼Œé‚£ä¹ˆè¿™æ—¶å€™æ€ä¹ˆå¯¹è¾“å…¥åšBNå‘¢ï¼Ÿå› ä¸ºå¾ˆæ˜æ˜¾ä¸€ä¸ªå®ä¾‹æ˜¯æ²¡æ³•ç®—å®ä¾‹é›†åˆæ±‚å‡ºçš„å‡å€¼å’Œæ–¹å·®çš„ã€‚è¿™å¯å¦‚ä½•æ˜¯å¥½ï¼Ÿ</p>
<p>æ—¢ç„¶æ²¡æœ‰ä»Mini-Batchæ•°æ®é‡Œå¯ä»¥å¾—åˆ°çš„ç»Ÿè®¡é‡ï¼Œé‚£å°±æƒ³å…¶å®ƒåŠæ³•æ¥è·å¾—è¿™ä¸ªç»Ÿè®¡é‡ï¼Œå°±æ˜¯å‡å€¼å’Œæ–¹å·®ã€‚å¯ä»¥ç”¨ä»æ‰€æœ‰è®­ç»ƒå®ä¾‹ä¸­è·å¾—çš„ç»Ÿè®¡é‡æ¥ä»£æ›¿Mini-Batché‡Œé¢mä¸ªè®­ç»ƒå®ä¾‹è·å¾—çš„å‡å€¼å’Œæ–¹å·®ç»Ÿè®¡é‡ï¼Œå› ä¸ºæœ¬æ¥å°±æ‰“ç®—ç”¨å…¨å±€çš„ç»Ÿè®¡é‡ï¼Œåªæ˜¯å› ä¸ºè®¡ç®—é‡ç­‰å¤ªå¤§æ‰€ä»¥æ‰ä¼šç”¨Mini-Batchè¿™ç§ç®€åŒ–æ–¹å¼çš„ï¼Œé‚£ä¹ˆåœ¨æ¨ç†çš„æ—¶å€™ç›´æ¥ç”¨å…¨å±€ç»Ÿè®¡é‡å³å¯ã€‚</p>
<p>å†³å®šäº†è·å¾—ç»Ÿè®¡é‡çš„æ•°æ®èŒƒå›´ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯å¦‚ä½•è·å¾—å‡å€¼å’Œæ–¹å·®çš„é—®é¢˜ã€‚å¾ˆç®€å•ï¼Œå› ä¸ºæ¯æ¬¡åšMini-Batchè®­ç»ƒæ—¶ï¼Œéƒ½ä¼šæœ‰é‚£ä¸ªMini-Batché‡Œmä¸ªè®­ç»ƒå®ä¾‹è·å¾—çš„å‡å€¼å’Œæ–¹å·®ï¼Œç°åœ¨è¦å…¨å±€ç»Ÿè®¡é‡ï¼Œåªè¦æŠŠæ¯ä¸ªMini-Batchçš„å‡å€¼å’Œæ–¹å·®ç»Ÿè®¡é‡è®°ä½ï¼Œç„¶åå¯¹è¿™äº›å‡å€¼å’Œæ–¹å·®æ±‚å…¶å¯¹åº”çš„æ•°å­¦æœŸæœ›å³å¯å¾—å‡ºå…¨å±€ç»Ÿè®¡é‡</p>
<script type="math/tex; mode=display">
\begin{aligned}
&E[x] \leftarrow E_{\mathrm{B}}\left[\mu_{\mathrm{B}}\right] \\
&\operatorname{Var}[x] \leftarrow \frac{m}{m-1} E_{\mathrm{B}}\left[\sigma_{\mathrm{B}}^{2}\right]
\end{aligned}</script><p>æœ‰äº†å‡å€¼å’Œæ–¹å·®ï¼Œæ¯ä¸ªéšå±‚ç¥ç»å…ƒä¹Ÿå·²ç»æœ‰å¯¹åº”è®­ç»ƒå¥½çš„Scalingå‚æ•°å’ŒShiftå‚æ•°ï¼Œå°±å¯ä»¥åœ¨æ¨å¯¼çš„æ—¶å€™å¯¹æ¯ä¸ªç¥ç»å…ƒçš„æ¿€æ´»æ•°æ®è®¡ç®—NBè¿›è¡Œå˜æ¢äº†ï¼Œåœ¨æ¨ç†è¿‡ç¨‹ä¸­è¿›è¡ŒBNé‡‡å–å¦‚ä¸‹æ–¹å¼ï¼š</p>
<script type="math/tex; mode=display">
y=\frac{\gamma}{\sqrt{\operatorname{Var}[x]+\varepsilon}} \cdot x+\left(\beta-\frac{\gamma \cdot E[x]}{\sqrt{\operatorname{Var}[x]+\varepsilon})}\right)</script><p>è¿™ä¸ªå…¬å¼å…¶å®å’Œè®­ç»ƒæ—¶</p>
<script type="math/tex; mode=display">
y^{(k)}=\gamma^{(k)} \hat{x}^{(k)}+\beta^{(k)}</script><p>æ˜¯ç­‰ä»·çš„ï¼Œé€šè¿‡ç®€å•çš„åˆå¹¶è®¡ç®—æ¨å¯¼å°±å¯ä»¥å¾—å‡ºè¿™ä¸ªç»“è®ºã€‚é‚£ä¹ˆä¸ºå•¥è¦å†™æˆè¿™ä¸ªå˜æ¢å½¢å¼å‘¢ï¼Ÿä½œè€…è¿™ä¹ˆå†™çš„æ„æ€æ˜¯ï¼šåœ¨å®é™…è¿è¡Œçš„æ—¶å€™ï¼ŒæŒ‰ç…§è¿™ç§å˜ä½“å½¢å¼å¯ä»¥å‡å°‘è®¡ç®—é‡ï¼Œä¸ºå•¥å‘¢ï¼Ÿå› ä¸ºå¯¹äºæ¯ä¸ªéšå±‚èŠ‚ç‚¹æ¥è¯´ï¼š</p>
<script type="math/tex; mode=display">
\frac{\gamma}{\sqrt{\operatorname{Var}[x]+\varepsilon}} \frac{\gamma \cdot E[x]}{\sqrt{\operatorname{Var}[x]+\varepsilon}}</script><p>éƒ½æ˜¯å›ºå®šå€¼ï¼Œè¿™æ ·è¿™ä¸¤ä¸ªå€¼å¯ä»¥äº‹å…ˆç®—å¥½å­˜èµ·æ¥ï¼Œåœ¨æ¨ç†çš„æ—¶å€™ç›´æ¥ç”¨å°±è¡Œäº†ï¼Œè¿™æ ·æ¯”åŸå§‹çš„å…¬å¼æ¯ä¸€æ­¥éª¤éƒ½ç°ç®—å°‘äº†é™¤æ³•çš„è¿ç®—è¿‡ç¨‹ï¼Œä¹ä¸€çœ‹ä¹Ÿæ²¡å°‘å¤šå°‘è®¡ç®—é‡ï¼Œä½†æ˜¯å¦‚æœéšå±‚èŠ‚ç‚¹ä¸ªæ•°å¤šçš„è¯èŠ‚çœçš„è®¡ç®—é‡å°±æ¯”è¾ƒå¤šäº†ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol>
<li><strong>ä¸ä»…ä»…æå¤§æå‡äº†è®­ç»ƒé€Ÿåº¦ï¼Œæ”¶æ•›è¿‡ç¨‹å¤§å¤§åŠ å¿«</strong></li>
<li><strong>è¿˜èƒ½å¢åŠ åˆ†ç±»æ•ˆæœï¼Œä¸€ç§è§£é‡Šæ˜¯è¿™æ˜¯ç±»ä¼¼äºDropoutçš„ä¸€ç§é˜²æ­¢è¿‡æ‹Ÿåˆçš„æ­£åˆ™åŒ–è¡¨è¾¾æ–¹å¼ï¼Œæ‰€ä»¥ä¸ç”¨Dropoutä¹Ÿèƒ½è¾¾åˆ°ç›¸å½“çš„æ•ˆæœ</strong></li>
<li>å¦å¤–è°ƒå‚è¿‡ç¨‹ä¹Ÿç®€å•å¤šäº†ï¼Œå¯¹äºåˆå§‹åŒ–è¦æ±‚æ²¡é‚£ä¹ˆé«˜ï¼Œè€Œä¸”å¯ä»¥ä½¿ç”¨å¤§çš„å­¦ä¹ ç‡ç­‰ã€‚æ€»è€Œè¨€ä¹‹ï¼Œç»è¿‡è¿™ä¹ˆç®€å•çš„å˜æ¢ï¼Œå¸¦æ¥çš„å¥½å¤„å¤šå¾—å¾ˆï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä½•ç°åœ¨BNè¿™ä¹ˆå¿«æµè¡Œèµ·æ¥çš„åŸå› ã€‚</li>
</ol>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://cloud.tencent.com/developer/article/1157136" target="_blank" rel="noopener">æ·±åº¦å­¦ä¹ ã€‘æ·±å…¥ç†è§£Batch Normalizationæ‰¹æ ‡å‡†åŒ–</a></li>
</ol>
]]></content>
      <categories>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ·±åº¦å­¦ä¹ </tag>
        <tag>batch normalization</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±åº¦å­¦ä¹ æ€»ç»“</title>
    <url>/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="ç¥ç»å…ƒ-æ„ŸçŸ¥å™¨"><a href="#ç¥ç»å…ƒ-æ„ŸçŸ¥å™¨" class="headerlink" title="ç¥ç»å…ƒ(æ„ŸçŸ¥å™¨)"></a>ç¥ç»å…ƒ(æ„ŸçŸ¥å™¨)</h4><ol>
<li>æ„ŸçŸ¥å™¨æ˜¯ä¸€ç§äººå·¥<strong>ç¥ç»å…ƒ</strong>.å®ƒæ¥å—å‡ ä¸ª<strong>äºŒè¿›åˆ¶è¾“å‡º</strong>å¹¶äº§ç”Ÿä¸€ä¸ª<strong>äºŒè¿›åˆ¶è¾“å…¥</strong>.å¦‚æœå¼•å…¥<strong>æƒé‡</strong>å’Œ<strong>é˜ˆå€¼</strong>,é‚£ä¹ˆæ„ŸçŸ¥å™¨çš„å‚æ•°å¯ä»¥è¡¨ç¤ºä¸º:$f(x)=sign(wx+b)$</li>
<li>æ„ŸçŸ¥å™¨æ˜¯<strong>å•è¾“å‡º</strong>çš„,ä½†è¿™ä¸ªå•è¾“å‡ºå¯ä»¥è¢«ç”¨äº<strong>å¤šä¸ª</strong>å…¶å®ƒæ„ŸçŸ¥å™¨çš„è¾“å…¥.</li>
<li>æ„ŸçŸ¥å™¨å¯ä»¥å¾ˆå®¹æ˜“åœ°è®¡ç®—åŸºæœ¬çš„<strong>é€»è¾‘åŠŸèƒ½</strong>,å¦‚<strong>ä¸</strong>,<strong>æˆ–</strong>,<strong>ä¸é</strong>.æ‰€ä»¥æ„ŸçŸ¥å™¨ç½‘ç»œå¯ä»¥è®¡ç®—ä»»ä½•é€»è¾‘åŠŸèƒ½</li>
<li>ä½¿æ„ŸçŸ¥å™¨èƒ½å¤Ÿè‡ªåŠ¨è°ƒæ•´æƒé‡å’Œåç½®çš„<strong>å­¦ä¹ ç®—æ³•</strong>æ˜¯ç¥ç»ç½‘ç»œæœ‰åˆ«äºä¼ ç»Ÿé€»è¾‘é—¨çš„å…³é”®.</li>
</ol>
<h4 id="Så‹ç¥ç»å…ƒ"><a href="#Så‹ç¥ç»å…ƒ" class="headerlink" title="Så‹ç¥ç»å…ƒ"></a>Så‹ç¥ç»å…ƒ</h4><ol>
<li>ç½‘ç»œä¸­å•ä¸ªæ„ŸçŸ¥å™¨ä¸Šæƒé‡æˆ–åç½®çš„<strong>å¾®å°æ”¹åŠ¨</strong>å¯èƒ½ä¼šå¼•èµ·<strong>è¾“å‡ºç¿»è½¬</strong>,ä»è€Œå¯¼è‡´å…¶ä½™ç½‘ç»œçš„è¡Œä¸ºæ”¹å˜.æ‰€ä»¥<strong>é€æ­¥ä¿®æ”¹</strong>æƒé‡å’Œåç½®æ¥è®©è¾“å‡ºæ¥è¿‘æœŸæœ›å¾ˆå›°éš¾,æ‰€ä»¥å¼•å…¥äº†<strong>Så‹ç¥ç»å…ƒ(é€»è¾‘ç¥ç»å…ƒ)</strong></li>
<li>Så‹ç¥ç»å…ƒå’Œæ„ŸçŸ¥å™¨ç±»ä¼¼,ä½†æ˜¯æƒé‡å’Œåç½®çš„å¾®å°æ”¹åŠ¨åªå¼•èµ·è¾“å‡ºçš„<strong>å¾®å°å˜åŒ–</strong>.Så‹ç¥ç»å…ƒçš„è¾“å…¥å¯ä»¥æ˜¯<strong>0å’Œ1ä¸­çš„ä»»æ„å€¼</strong>,è¾“å‡ºæ˜¯$Ïƒ(wx+b)$,å…¶ä¸­$Ïƒ$è¢«ç§°ä¸ºså‹å‡½æ•°(é€»è¾‘å‡½æ•°).</li>
<li>Ïƒå‡½æ•°æ˜¯é˜¶è·ƒå‡½æ•°çš„<strong>å¹³æ»‘</strong>ç‰ˆæœ¬.è¿™æ„å‘³ç€æƒé‡å’Œåç½®çš„å¾®å°å˜åŒ–ä¼šäº§ç”Ÿä¸€ä¸ªå¾®å°çš„è¾“å‡ºå˜åŒ–,$\Delta output \approx \sum_{j} \frac{\partial \text { output }}{\partial w_{j}} \Delta w_{j}+\frac{\partial \text { output }}{\partial b} \Delta b$,è¿™æ„å‘³ç€è¾“å‡ºçš„å˜åŒ–æ˜¯æƒé‡å’Œåç½®çš„å˜åŒ–çš„<strong>çº¿æ€§å‡½æ•°</strong>.</li>
</ol>
<a id="more"></a>
<h4 id="æ¢¯åº¦ä¸‹é™ç®—æ³•"><a href="#æ¢¯åº¦ä¸‹é™ç®—æ³•" class="headerlink" title="æ¢¯åº¦ä¸‹é™ç®—æ³•"></a>æ¢¯åº¦ä¸‹é™ç®—æ³•</h4><ol>
<li><p>ç¥ç»ç½‘ç»œä¸­ç»å¸¸éœ€è¦<strong>å¤§é‡</strong>å˜é‡,å› æ­¤é‡‡ç”¨<strong>æ¢¯åº¦ä¸‹é™æ³•</strong>æ¥è®¡ç®—ä»£ä»·å‡½æ•°æœ€å°å€¼:é‡å¤è®¡ç®—æ¢¯åº¦,ç„¶åæ²¿ç€<strong>ç›¸å</strong>çš„æ–¹å‘ç§»åŠ¨$v \rightarrow v^{\prime}=v-\eta \nabla C$</p>
</li>
<li><p>å‡å¦‚éœ€è¦è®¡ç®—æ¯ä¸ªè®­ç»ƒè¾“å…¥çš„æ¢¯åº¦å€¼,è®­ç»ƒé€Ÿåº¦ä¼šç›¸å½“ç¼“æ…¢.å› æ­¤å¼•å…¥äº†<strong>éšæœºæ¢¯åº¦ä¸‹é™</strong>,åªè®¡ç®—å°æ‰¹é‡æ•°æ®(mini-batch)çš„æ¢¯åº¦å€¼æ¥æ±‚å¹³å‡å€¼</p>
<script type="math/tex; mode=display">
\begin{aligned}
w_{k} \rightarrow w_{k}^{\prime} &=w_{k}-\frac{\eta}{m} \sum_{j} \frac{\partial C_{X_{j}}}{\partial w_{k}} \\
b_{l} \rightarrow b_{l}^{\prime} &=b_{l}-\frac{\eta}{m} \sum_{j} \frac{\partial C_{X_{j}}}{\partial b_{l}}
\end{aligned}</script></li>
<li><p>éšæœºæœºæ¢¯åº¦ä¸‹é™ä¸æ–­åœ°é€‰å®šå°æ‰¹é‡æ•°æ®æ¥è¿›è¡Œè®­ç»ƒ,ç›´åˆ°ç”¨å®Œäº†æ‰€æœ‰çš„è®­ç»ƒè¾“å…¥,å°±ç§°ä¸ºå®Œæˆäº†ä¸€ä¸ª<strong>è¿­ä»£æœŸ(epoch)</strong>,ç„¶åä¼šå¼€å§‹ä¸€ä¸ªæ–°çš„è¿­ä»£æœŸ.</p>
</li>
</ol>
<h4 id="åå‘ä¼ æ’­-BP-ç®—æ³•"><a href="#åå‘ä¼ æ’­-BP-ç®—æ³•" class="headerlink" title="åå‘ä¼ æ’­(BP)ç®—æ³•"></a>åå‘ä¼ æ’­(BP)ç®—æ³•</h4><h5 id="ç¥ç»ç½‘ç»œä¸­ä½¿ç”¨çŸ©é˜µå¿«é€Ÿè®¡ç®—è¾“å‡ºçš„æ–¹æ³•"><a href="#ç¥ç»ç½‘ç»œä¸­ä½¿ç”¨çŸ©é˜µå¿«é€Ÿè®¡ç®—è¾“å‡ºçš„æ–¹æ³•" class="headerlink" title="ç¥ç»ç½‘ç»œä¸­ä½¿ç”¨çŸ©é˜µå¿«é€Ÿè®¡ç®—è¾“å‡ºçš„æ–¹æ³•"></a>ç¥ç»ç½‘ç»œä¸­ä½¿ç”¨çŸ©é˜µå¿«é€Ÿè®¡ç®—è¾“å‡ºçš„æ–¹æ³•</h5><ol>
<li>$w^l_{jk}$è¡¨ç¤ºä»ç¬¬$(l-1)$å±‚çš„ç¬¬$k$ä¸ªç¥ç»å…ƒåˆ°ç¬¬$l$å±‚çš„ç¬¬$j$ä¸ªç¥ç»å…ƒçš„é“¾æ¥ä¸Šçš„<strong>æƒé‡</strong>,$b^l_j$è¡¨ç¤ºåœ¨ç¬¬lå±‚ç¬¬jä¸ªç¥ç»å…ƒçš„<strong>åç½®</strong>.$a^l_j$è¡¨ç¤ºç¬¬lå±‚ç¬¬jä¸ªç¥ç»å…ƒçš„<strong>æ¿€æ´»å€¼</strong>.ç”±æ­¤å¾—åˆ°äº†æ¿€æ´»å€¼ä¹‹é—´çš„å…³ç³»$a_{j}^{l}=\sigma\left(\sum_{k} w_{j k}^{l} a_{k}^{l-1}+b_{j}^{l}\right)$</li>
<li>å¯¹æ¯ä¸€å±‚lå®šä¹‰<strong>æƒé‡çŸ©é˜µ</strong>(å…¶ä¸­ç¬¬jè¡Œç¬¬kåˆ—çš„å…ƒç´ æ˜¯$w^l_{jk}$,<strong>åç½®å‘é‡</strong>(æ¯ä¸ªå…ƒç´ æ˜¯$b^l_j$)å’Œ<strong>æ¿€æ´»å‘é‡</strong>(æ¯ä¸ªå…ƒç´ æ˜¯$a^l_j$).æ‰€ä»¥ä¸Šå¼å¯ä»¥æ”¹å†™ä¸º$a^{l}=\sigma\left(w^{l} a^{l-1}+b^{l}\right)$,å…¶ä¸­Ïƒæ˜¯<strong>å‘é‡åŒ–å‡½æ•°</strong>(ä½œç”¨Ïƒåˆ°å‘é‡ä¸­çš„æ¯ä¸ªå…ƒç´ ).ä¸­é—´é‡$z^{l} \equiv w^{l} a^{l-1}+b^{l}$ç§°ä¸º<strong>å¸¦æƒè¾“</strong>å…¥(æ¯ä¸ªå…ƒç´ æ˜¯ç¬¬lå±‚ç¬¬jä¸ªç¥ç»å…ƒçš„æ¿€æ´»å‡½æ•°çš„å¸¦æƒè¾“å…¥<strong>)</strong>.</li>
</ol>
<h5 id="å…³äºä»£ä»·å‡½æ•°çš„ä¸¤ä¸ªå‡è®¾"><a href="#å…³äºä»£ä»·å‡½æ•°çš„ä¸¤ä¸ªå‡è®¾" class="headerlink" title="å…³äºä»£ä»·å‡½æ•°çš„ä¸¤ä¸ªå‡è®¾"></a>å…³äºä»£ä»·å‡½æ•°çš„ä¸¤ä¸ªå‡è®¾</h5><p><strong>åå‘ä¼ æ’­</strong>çš„ç›®æ ‡æ˜¯è®¡ç®—ä»£ä»·å‡½æ•°å…³äºwå’Œbçš„<strong>åå¯¼æ•°</strong>.ä¸ºäº†è®©åå‘ä¼ æ’­å¯è¡Œ,éœ€è¦ä½œå‡ºä¸¤ä¸ªä¸»è¦å‡è®¾</p>
<ol>
<li>ä»£ä»·å‡½æ•°å¯ä»¥è¢«å†™æˆä¸€ä¸ªåœ¨æ¯ä¸ªè®­ç»ƒæ ·æœ¬xä¸Šçš„ä»£ä»·å‡½æ•°çš„<strong>å‡å€¼</strong>$C=\frac{1}{n} \sum_{x} C_{x}$</li>
<li>ä»£ä»·å¯ä»¥å†™æˆç¥ç»ç½‘ç»œè¾“å‡ºçš„å‡½æ•°,ä»¥äºŒæ¬¡ä»£ä»·å‡½æ•°ä¸ºä¾‹$C=\frac{1}{2}\left|y-a^{L}\right|^{2}=\frac{1}{2} \sum_{j}\left(y_{j}-a_{j}^{L}\right)^{2}$</li>
</ol>
<h5 id="Hadamardä¹˜ç§¯-sâŠ™t"><a href="#Hadamardä¹˜ç§¯-sâŠ™t" class="headerlink" title="Hadamardä¹˜ç§¯,sâŠ™t"></a>Hadamardä¹˜ç§¯,sâŠ™t</h5><p>å‡è®¾så’Œtæ˜¯ä¸¤ä¸ªåŒæ ·ç»´åº¦çš„å‘é‡,é‚£ä¹ˆsâŠ™tè¡¨ç¤º<strong>æŒ‰å…ƒç´ çš„ä¹˜ç§¯</strong>,ç§°ä¸º<strong>Hadamardä¹˜ç§¯</strong></p>
<h5 id="åå‘ä¼ æ’­çš„å››ä¸ªåŸºæœ¬æ–¹ç¨‹"><a href="#åå‘ä¼ æ’­çš„å››ä¸ªåŸºæœ¬æ–¹ç¨‹" class="headerlink" title="åå‘ä¼ æ’­çš„å››ä¸ªåŸºæœ¬æ–¹ç¨‹"></a>åå‘ä¼ æ’­çš„å››ä¸ªåŸºæœ¬æ–¹ç¨‹</h5><p>åœ¨ç¬¬lå±‚ç¬¬jä¸ªç¥ç»å…ƒä¸Šçš„<strong>è¯¯å·®</strong>,è¢«å®šä¹‰ä¸º$\delta_{j}^{l} \equiv \frac{\partial C}{\partial z_{j}^{l}}$</p>
<p><strong>å››ä¸ªåŸºæœ¬æ–¹ç¨‹</strong></p>
<ol>
<li><p>è¾“å‡ºå±‚è¯¯å·®çš„æ–¹ç¨‹: $\delta_{j}^{L} = \frac{\partial C}{\partial a^L_j}\frac{\partial a^L_j}{\partial z^l_j} = \frac{\partial C}{\partial a_{j}^{L}} \sigma^{\prime}\left(z_{j}^{L}\right)$ </p>
<p> å³å¼ç¬¬â¼€ä¸ªé¡¹ $\frac{\partial C}{\partial a^L_j}$ è¡¨â½°ä»£ä»·éšç€ $j^{th}$è¾“å‡ºæ¿€æ´»å€¼çš„å˜åŒ–â½½ å˜åŒ–çš„é€Ÿåº¦ã€‚å‡å¦‚ $C$ ä¸å¤ªä¾èµ–â¼€ä¸ªç‰¹å®šçš„è¾“å‡ºç¥ç»å…ƒ $j$ï¼Œé‚£ä¹ˆ$\delta^L_j$å°±ä¼šå¾ˆâ¼©ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚å³å¼ç¬¬â¼†é¡¹ $\sigma^\prime(Z^L_j)$åˆ»ç”»äº†åœ¨$z^L_j$ å¤„æ¿€æ´»å‡½æ•° $\sigma$ å˜åŒ–çš„é€Ÿåº¦ã€‚</p>
</li>
<li><p>ä½¿ç”¨ä¸‹ä¸€å±‚çš„è¯¯å·®æ¥è¡¨ç¤ºå½“å‰å±‚çš„è¯¯å·®:$\delta^{l}=\left(\left(w^{l+1}\right)^{T} \delta^{l+1}\right) \odot \sigma^{\prime}\left(z^{l}\right)$</p>
<p> ç”±é€’æ¨å…¬å¼</p>
<script type="math/tex; mode=display">
\begin{aligned}
\frac{\partial  C}{\partial  z^l_j} &=\delta^l_j \\
& = \sum_i{\frac{\partial  C}{\partial  z^{l+1}_i}\frac{\partial  z^{l+1}_i}{\partial  z^l_j}} \\ 
&=\sum_i{\delta ^{l+1}_i \frac{\partial  z^{l+1}_i}{\partial  a^l_j}\frac{\partial  a^l_j}{\partial  z^l_j}} \\ 
&=\sum_i{\delta^{l+1}_i w^{l+1}_{ji} \sigma \prime (z^l_j)} \\
&=(w^{l+1}_j)^T\delta^{l+1}\sigma \prime(z^l_j) \\
&=(w^{l+1})^T \sigma^{l+1}\bigodot \sigma \prime (z^l)
\end{aligned}</script></li>
<li><p>ä»£ä»·å‡½æ•°å…³äºç½‘ç»œä¸­ä»»æ„åç½®çš„æ”¹å˜ç‡:$\frac{\partial C}{\partial b_{j}^{l}}=\delta_{j}^{l}$</p>
</li>
<li><p>ä»£ä»·å‡½æ•°å…³äºä»»ä½•ä¸€ä¸ªæƒé‡çš„æ”¹å˜ç‡:$\frac{\partial C}{\partial w_{j k}^{l}}=a_{k}^{l-1} \delta_{j}^{l}$ï¼ˆå› ä¸º$z^l = w^la^{l-1}+b^l$ï¼‰</p>
</li>
</ol>
<h5 id="ç®—æ³•æè¿°"><a href="#ç®—æ³•æè¿°" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h5><p>åå‘ä¼ æ’­æ–¹ç¨‹ç»™å‡ºäº†ä¸€ç§è®¡ç®—ä»£ä»·å‡½æ•°æ¢¯åº¦çš„æ–¹æ³•:</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/bp.png" alt="avatar"></p>
<ol>
<li><strong>è¾“å…¥x</strong>:ä¸ºè¾“å…¥å±‚è®¾ç½®å¯¹åº”çš„æ¿€æ´»å€¼$a1$</li>
<li><strong>å‰å‘ä¼ æ’­</strong>:å¯¹ä»å‰å¾€åå¯¹æ¯å±‚è®¡ç®—ç›¸åº”çš„$z=wa+b$å’Œ$a=Ïƒ(z)$</li>
<li><strong>è¾“å‡ºå±‚è¯¯å·®</strong>:æ ¹æ®BP1è®¡ç®—è¯¯å·®å‘é‡</li>
<li><strong>åå‘è¯¯å·®ä¼ æ’­</strong>:å¯¹åå¾€å‰æ ¹æ®BP2å¯¹æ¯å±‚è®¡ç®—è¯¯å·®å‘é‡</li>
<li><strong>è¾“å‡º</strong>:æ ¹æ®BP3å’ŒBP4è®¡ç®—ä»£ä»·å‡½æ•°çš„æ¢¯åº¦.</li>
</ol>
<h5 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Network</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">backprop</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">    <span class="string">"""Return a tuple "(nabla_b, nabla_w)" representing the</span></span><br><span class="line"><span class="string">    gradient for the cost function C_x.</span></span><br><span class="line"><span class="string">    "nabla_b" and "nabla_w" are layer-by-layer lists of numpy arrays, similar</span></span><br><span class="line"><span class="string">    to "self.biases" and "self.weights"."""</span></span><br><span class="line"></span><br><span class="line">    nabla_b = [np.zeros(b.shape) <span class="keyword">for</span> b <span class="keyword">in</span> self.biases]</span><br><span class="line">    nabla_w = [np.zeros(w.shape) <span class="keyword">for</span> w <span class="keyword">in</span> self.weights]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># feedforward</span></span><br><span class="line">    activation = x</span><br><span class="line">    activations = [x] <span class="comment"># list to store all the activations, layer by layer</span></span><br><span class="line">    zs = [] <span class="comment"># list to store all the z vectors, layer by layer</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> b, w <span class="keyword">in</span> zip(self.biases, self.weights):</span><br><span class="line">      z = np.dot(w, activation)+b</span><br><span class="line">      zs.append(z)</span><br><span class="line">      activation = sigmoid(z)</span><br><span class="line">      activations.append(activation)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># backward pass</span></span><br><span class="line">    delta = self.cost_derivative(activations[<span class="number">-1</span>], y) * sigmoid_prime(zs[<span class="number">-1</span>])</span><br><span class="line">    nabla_b[<span class="number">-1</span>] = delta</span><br><span class="line">    nabla_w[<span class="number">-1</span>] = np.dot(delta, activations[<span class="number">-2</span>].transpose())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Note that the variable l in the loop below is used a little</span></span><br><span class="line"><span class="comment"># differently to the notation in Chapter 2 of the book.</span></span><br><span class="line"><span class="comment"># Here,l = 1 means the last layer of neurons, l = 2 is the</span></span><br><span class="line"><span class="comment"># second-last layer, and so on.It's a renumbering of the</span></span><br><span class="line"><span class="comment"># scheme in the book, used here to take advantage of the fact</span></span><br><span class="line"><span class="comment"># that Python can use negative indices in lists.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> xrange(<span class="number">2</span>, self.num_layers):</span><br><span class="line">    	z = zs[-l]</span><br><span class="line">      sp = sigmoid_prime(z)</span><br><span class="line">    	delta = np.dot(self.weights[-l+<span class="number">1</span>].transpose(), delta) * sp</span><br><span class="line">    	nabla_b[-l] = delta</span><br><span class="line">    	nabla_w[-l] = np.dot(delta, activations[-l<span class="number">-1</span>].transpose())</span><br><span class="line">    <span class="keyword">return</span> (nabla_b, nabla_w)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cost_derivative</span><span class="params">(self, output_activations, y)</span>:</span></span><br><span class="line">  <span class="string">"""Return the vector of partial derivatives \partial C_x /</span></span><br><span class="line"><span class="string">  \partial a for the output activations."""</span></span><br><span class="line">  	<span class="keyword">return</span> (output_activations-y)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid</span><span class="params">(z)</span>:</span></span><br><span class="line"><span class="string">"""The sigmoid function."""</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">1.0</span>/(<span class="number">1.0</span>+np.exp(-z))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid_prime</span><span class="params">(z)</span>:</span></span><br><span class="line"><span class="string">"""Derivative of the sigmoid function."""</span></span><br><span class="line">  <span class="keyword">return</span> sigmoid(z)*(<span class="number">1</span>-sigmoid(z))</span><br></pre></td></tr></table></figure>
<h4 id="äº¤å‰ç†µä»£ä»·å‡½æ•°"><a href="#äº¤å‰ç†µä»£ä»·å‡½æ•°" class="headerlink" title="äº¤å‰ç†µä»£ä»·å‡½æ•°"></a>äº¤å‰ç†µä»£ä»·å‡½æ•°</h4><p>äººç±»é€šå¸¸åœ¨<strong>çŠ¯é”™æ¯”è¾ƒæ˜æ˜¾</strong>çš„æ—¶å€™å­¦ä¹ çš„<strong>é€Ÿåº¦æœ€å¿«</strong>.è€Œç¥ç»å…ƒåœ¨è¿™ç§<strong>é¥±å’Œ</strong>æƒ…å†µä¸‹å­¦ä¹ å¾ˆæœ‰<strong>éš¾åº¦</strong>(ä¹Ÿå°±æ˜¯åå¯¼æ•°å¾ˆå°),è¿™æ˜¯å› ä¸º<strong>äºŒæ¬¡ä»£ä»·å‡½æ•°</strong>å…³äºæƒé‡å’Œåç½®çš„<strong>åå¯¼æ•°</strong>æ˜¯$\frac{\partial C}{\partial w}=(a-y) \sigma^{\prime}(z) x=a \sigma^{\prime}(z)$å’Œ$\frac{\partial C}{\partial b}=(a-y) \sigma^{\prime}(z)=a \sigma^{\prime}(z)$è€ŒÏƒå‡½æ•°çš„<strong>å¯¼æ•°</strong>åœ¨æ¥è¿‘0å’Œ1æ—¶éƒ½å¾ˆå°ã€‚</p>
<p>è§£å†³ä¸Šè¿°é—®é¢˜çš„æ–¹æ³•æ˜¯å¼•å…¥<strong>äº¤å‰ç†µä»£ä»·å‡½æ•°</strong>:$C=-\frac{1}{n} \sum_{x}[y \ln a+(1-y) \ln (1-a)]$</p>
<ol>
<li>å®ƒæ˜¯<strong>éè´Ÿ</strong>çš„,å¹¶ä¸”å½“å®é™…è¾“å‡ºæ¥è¿‘ç›®æ ‡å€¼æ—¶å®ƒ<strong>æ¥è¿‘0</strong>,å› æ­¤å¯ä»¥ä½œä¸ºä»£ä»·å‡½æ•°.</li>
<li>å®ƒå…³äºæƒé‡çš„<strong>åå¯¼æ•°</strong>æ˜¯$\frac{\partial C}{\partial w_{j}}=\frac{1}{n} \sum_{x} x_{j}(\sigma(z)-y)$,ä¹Ÿå°±æ˜¯è¯¯å·®è¶Šå¤§,å­¦ä¹ é€Ÿåº¦è¶Šå¿«.</li>
<li>å¦‚æœè¾“å‡ºå±‚æ˜¯<strong>çº¿æ€§ç¥ç»å…ƒ</strong>,é‚£ä¹ˆ<strong>äºŒæ¬¡ä»£ä»·å‡½æ•°</strong>ä¸å†ä¼šå¯¼è‡´å­¦ä¹ é€Ÿåº¦ä¸‹é™çš„é—®é¢˜,å¯ä»¥é€‰ç”¨.å¦‚æœè¾“å‡ºç¥ç»å…ƒæ˜¯<strong>Så‹ç¥ç»å…ƒ</strong>,<strong>äº¤å‰ç†µ</strong>ä¸€èˆ¬éƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©. </li>
<li>å¯¹äºå¤šåˆ†ç±»äº¤å‰ç†µä»£ä»·å‡½æ•°ä¸ºï¼š$C=-\sum_{j=1}^{T} y_{j} \log {p_j}$,</li>
</ol>
<h4 id="è¿‡æ‹Ÿåˆ"><a href="#è¿‡æ‹Ÿåˆ" class="headerlink" title="è¿‡æ‹Ÿåˆ"></a>è¿‡æ‹Ÿåˆ</h4><ol>
<li>æœ€å¥½çš„é™ä½è¿‡æ‹Ÿåˆçš„æ–¹å¼å°±æ˜¯<strong>å¢åŠ è®­ç»ƒæ ·æœ¬é‡</strong>,ä½†è®­ç»ƒæ•°æ®å…¶å®æ˜¯å¾ˆ<strong>éš¾å¾—</strong>çš„èµ„æº.</li>
<li><strong>è§„èŒƒåŒ–</strong>ä¹Ÿæ˜¯ä¸€ç§ç¼“è§£è¿‡æ‹Ÿåˆçš„æŠ€æœ¯.æ•ˆæœæ˜¯è®©ç½‘ç»œå€¾å‘äºå­¦ä¹ <strong>å°ä¸€ç‚¹çš„æƒé‡</strong>,å®ƒæ˜¯å¯»æ‰¾å°çš„æƒé‡å’Œæœ€å°åŒ–åŸå§‹ä»£ä»·å‡½æ•°ä¹‹é—´çš„æŠ˜ä¸­,ç›¸å¯¹é‡è¦æ€§ç”±Î»æ§åˆ¶.<ol>
<li><strong>L2è§„èŒƒåŒ–(æƒé‡è¡°å‡)</strong>çš„æƒ³æ³•æ˜¯å¢åŠ ä¸€ä¸ªé¢å¤–çš„<strong>è§„èŒƒåŒ–é¡¹</strong>ï¼š$\frac{\lambda}{2 n} \sum_{w} w^{2}$åˆ°ä»£ä»·å‡½æ•°ä¸Š.å…¶ä¸­Î»æ˜¯<strong>è§„èŒƒåŒ–å‚æ•°</strong>,æ³¨æ„è§„èŒƒåŒ–é¡¹é‡Œ<strong>ä¸åŒ…å«åç½®</strong>.</li>
<li><strong>L1è§„èŒƒåŒ–</strong>çš„è§„èŒƒåŒ–é¡¹ä¸ºï¼š$\frac{\lambda}{n} \sum_{w}|w|$åœ¨L1è§„èŒƒåŒ–ä¸­,æƒé‡é€šè¿‡ä¸€ä¸ªå¸¸é‡<strong>å‘0</strong>è¿›è¡Œç¼©å°,åœ¨L2è§„èŒƒåŒ–ä¸­,æƒé‡é€šè¿‡ä¸€ä¸ªå’Œwæˆ<strong>æ¯”ä¾‹</strong>çš„é‡è¿›è¡Œç¼©å°.æ‰€ä»¥L1è§„èŒƒåŒ–å€¾å‘äº<strong>èšé›†</strong>ç½‘ç»œçš„æƒé‡åœ¨<strong>ç›¸å¯¹å°‘é‡</strong>çš„é«˜é‡è¦åº¦è¿æ¥ä¸Š.</li>
</ol>
</li>
<li><strong>dropout</strong></li>
<li><strong>äººä¸ºæ‰©å±•è®­ç»ƒæ•°æ®</strong></li>
</ol>
<h4 id="è°ƒå‚"><a href="#è°ƒå‚" class="headerlink" title="è°ƒå‚"></a>è°ƒå‚</h4><ol>
<li><strong>å­¦ä¹ é€Ÿç‡Î·</strong></li>
<li><strong>æ—©åœ</strong></li>
<li><strong>è§„èŒƒåŒ–å‚æ•°Î»</strong></li>
<li><strong>å°æ‰¹é‡æ•°æ®å¤§å°</strong></li>
<li><strong>ç½‘æ ¼æœç´¢(grid search)</strong></li>
</ol>
<h3 id="å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œ"></a>å¾ªç¯ç¥ç»ç½‘ç»œ</h3><h4 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h4><p>å¯¹äºå‰é¦ˆç¥ç»ç½‘ç»œæ¥è¯´å…¶å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
O=f(W*X+b)</script><p>å…¶ä¸­$W$å’Œ$b$æ˜¯æ¨¡å‹çš„å‚æ•°ï¼Œ$X$æ˜¯å½“å‰çš„è¾“å…¥ï¼Œ$f(Â·)$æ˜¯æ¿€æ´»å‡½æ•°ï¼Œ$*$æ˜¯çŸ©é˜µä¹˜æ³•ï¼Œ$O$æ˜¯å½“å‰çš„è¾“å‡ºã€‚å³è¾“å‡ºç­‰äºè¾“å…¥ç»è¿‡çº¿æ€§ä¸éçº¿æ€§æ˜ å°„åçš„ç»“æœã€‚</p>
<p>è€ŒRNNé€šè¿‡å°†å‰ä¸€æ—¶åˆ»çš„è¿ç®—ç»“æœæ·»åŠ åˆ°å½“å‰çš„è¿ç®—ä¸­ï¼Œä»è€Œå®ç°äº†â€œè€ƒè™‘ä¸Šæ–‡ä¿¡æ¯â€çš„åŠŸèƒ½ã€‚</p>
<script type="math/tex; mode=display">
\mathrm{O}_{\mathrm{t}}=\mathrm{f}\left(\mathrm{X} * \mathrm{W}+\mathrm{O}_{\mathrm{t}-1} * \mathrm{V}+\mathrm{b}\right)</script><p>å…¶ä¸­$W,V,b$æ˜¯æ¨¡å‹çš„å‚æ•°ï¼Œä¸‹æ ‡$t$ä»£è¡¨å½“å‰çš„åºåˆ—ä½ç½®ï¼æ—¶é—´ç‚¹ï¼Œ$t-1$ä»£è¡¨ä¸Šä¸ªä½ç½®/ä¸Šä¸ªæ—¶é—´ç‚¹ï¼Œ$X$æ˜¯å½“å‰çš„è¾“å…¥ï¼Œ$f(Â·)$æ˜¯æ¿€æ´»å‡½æ•°ï¼Œ$*$æ˜¯çŸ©é˜µä¹˜æ³•ï¼Œ$O$æ˜¯æ¨¡å‹è¾“å‡ºã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/rnn.png" alt="avatar"></p>
<p>BiRnn:RNNå¯ä»¥è€ƒè™‘ä¸Šæ–‡çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå¦‚ä½•å°†ä¸‹æ–‡çš„ä¿¡æ¯ä¹Ÿæ·»åŠ è¿›å»å‘¢ï¼Ÿè¿™å°±æ˜¯BiRNNè¦åšçš„äº‹æƒ…ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/birnn.png" alt="avatar"></p>
<h5 id="RNNå­˜åœ¨çš„é—®é¢˜"><a href="#RNNå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="RNNå­˜åœ¨çš„é—®é¢˜"></a>RNNå­˜åœ¨çš„é—®é¢˜</h5><p>é¦–å…ˆï¼Œä»RNNçš„å‰å‘è¿‡ç¨‹æ¥çœ‹ï¼Œå¯ä»¥è®¤ä¸ºå®ƒåªæœ‰ä¸€å±‚æƒé‡çŸ©é˜µWï¼ˆå…ˆä¸ç®¡Vï¼‰ã€‚ç”±æ­¤å¯è§ä»æ·±å±‚çš„è§’åº¦å»çœ‹RNNçš„å‰å‘è¿‡ç¨‹ï¼Œå°±å¯ä»¥è®¤ä¸ºRNNæ˜¯<strong>å„ä¸ªå±‚çš„æƒé‡çŸ©é˜µç›¸åŒ</strong>çš„æ·±å±‚ç½‘ç»œã€‚å¿½ç•¥Vå’Œæ¿€æ´»å‡½æ•°ï¼Œå°±å¯ä»¥è¿‘ä¼¼çš„è®¤ä¸ºç½‘ç»œä¸€å…±æœ‰Tå±‚ï¼ˆTç­‰äºåºåˆ—çš„é•¿åº¦ï¼‰ï¼Œé‚£ä¹ˆç¬¬tå±‚çš„è¾“å‡ºå°±æ˜¯è¿ä¹˜tæ¬¡Wï¼Œä¹Ÿå°±æ˜¯$W^t$ï¼,ç”±äº<strong>çŸ©é˜µå¯ä»¥ç”¨å®ƒçš„ç‰¹å¾å€¼çŸ©é˜µå’Œç‰¹å¾å‘é‡çŸ©é˜µå»è¿‘ä¼¼</strong>ï¼Œå³</p>
<script type="math/tex; mode=display">
W = V diag(\lambda) V^{-1}  \\
W^t = (V diag(\lambda) V^{-1})(V diag(\lambda) V^{-1})\cdots(V diag(\lambda) V^{-1})=V{ diag(\lambda)}^t V^{-1}</script><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ç‰¹å¾å€¼çŸ©é˜µä¸­çš„æ¯ä¸ªç‰¹å¾å€¼éƒ½ä¼šéšç€tçš„å¢å¤§å‘ç”ŸæŒ‡æ•°çº§å˜åŒ–ï¼</strong>æ‰€ä»¥æŸä¸ªç‰¹å¾å€¼å¤§äº1æ—¶ï¼Œå°±å®¹æ˜“å¯¼è‡´è¿™ä¸ªç»´åº¦çš„å€¼çˆ†ç‚¸æ€§å¢é•¿ï¼›å½“ç‰¹å¾å€¼å°äº1æ—¶ï¼Œä¼šå°±ä¼šå¯¼è‡´è¿™ä¸ªç»´åº¦çš„å€¼æŒ‡æ•°çº§é€Ÿåº¦è¡°å‡ä¸º0ï¼</p>
<p>å‰å‘è¿‡ç¨‹å¦‚æ­¤ï¼Œè¯¯å·®åå‘ä¼ æ’­çš„è¿‡ç¨‹ä¹Ÿå¿…ç„¶è¿‘ä¼¼ä¸ºè¾“å‡ºå±‚çš„è¯¯å·®ä¼šä¹˜ä»¥$W^t$æ¥å¾—åˆ°å€’æ•°ç¬¬tå±‚çš„æ¢¯åº¦ï¼Œç„¶è€Œç”±äºåˆšå„ä¸ªç»´åº¦ä¸æ˜¯æŒ‡æ•°çº§è¡°å‡å°±æ˜¯æŒ‡æ•°çº§çˆ†ç‚¸ï¼Œå¾ˆå®¹æ˜“çœ‹å‡ºå½“æ›´æ–°RNNçš„é å‰çš„å±‚çš„æ—¶å€™ï¼ˆå³ç¦»ç€è¾“å‡ºå±‚è¾ƒè¿œçš„é‚£äº›å±‚ï¼Œæˆ–è€…è¯´ä¸åºåˆ—æœ«ç«¯ç¦»å¾—è¿œçš„ä½ç½®ï¼‰ï¼Œè®¡ç®—å‡ºçš„æ¢¯åº¦è¦ä¹ˆå¤§çš„å“äººï¼Œè¦ä¹ˆå°çš„å¿½ç•¥ã€‚å°çš„å¿½ç•¥çš„å€¼ä¸ä¼šå¯¹Wçš„æ›´æ–°æœ‰ä»»ä½•æŒ‡å¯¼ä½œç”¨ï¼Œå¤§çš„å“äººçš„å€¼ä¸€ä¸‹å­å°±æŠŠWä¸­çš„æŸäº›å€¼å¼„çš„å¤§çš„å“äººäº†ï¼Œå®³å¾—å‰é¢çš„ä¼˜åŒ–éƒ½ç™½åšäº†ã€‚</p>
<p>ä¸€ä¸ªå¾ˆç®€å•çš„æƒ³æ³•æ˜¯è¿›è¡Œ<strong>æ¢¯åº¦æˆªæ–­</strong>ï¼Œåœ¨ä¼˜åŒ–RNNçš„å‚æ•°çš„æ—¶å€™ï¼Œç»™æ¢¯åº¦å€¼è®¾ç½®ä¸€ä¸ªä¸Šé™ã€‚ä½†æ˜¯è¿™æ ·æ˜¾ç„¶å°±ä¼šå¯¼è‡´æ¨¡å‹éš¾ä»¥å†é¡¾åŠå¾ˆé å‰çš„å†å²ä¿¡æ¯äº†ï¼Œå› æ­¤ç†è®ºä¸ŠRNNå¯ä»¥ä¿å­˜ä»»æ„é•¿çš„å†å²ä¿¡æ¯æ¥è¾…åŠ©å½“å‰æ—¶é—´ç‚¹çš„å†³ç­–ï¼Œç„¶è€Œç”±äºåœ¨ä¼˜åŒ–æ—¶ï¼ˆè®­ç»ƒRNNæ—¶ï¼‰ï¼Œæ¢¯åº¦æ— æ³•å‡†ç¡®åˆç†çš„ä¼ åˆ°å¾ˆé å‰çš„æ—¶é—´ç‚¹ï¼Œå› æ­¤RNNå®é™…ä¸Šåªèƒ½è®°ä½å¹¶ä¸é•¿çš„åºåˆ—ä¿¡æ¯ï¼ˆåœ¨NLPä¸­ï¼Œç»éªŒä¸Šè®¤ä¸ºåºåˆ—å¤§äº30çš„æ—¶å€™ï¼ŒRNNåŸºæœ¬è®°ä¸ä½å¤šäº30çš„éƒ¨åˆ†ï¼Œè€Œä»å¤šäº10çš„ä½ç½®å¼€å§‹å°±å˜å¾—è®°æ€§å¾ˆå·®äº†ï¼‰ï¼Œå› æ­¤RNNç›¸æ¯”å‰é¦ˆç½‘ç»œï¼Œå¯ä»¥è®°ä½çš„å†å²ä¿¡æ¯è¦é•¿ä¸€äº›ï¼Œä½†æ˜¯æ— æ³•è®°ä½é•¿è·ç¦»çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚æ®µè½çº§çš„åºåˆ—ç”šè‡³ç¯‡ç« çº§çš„åºåˆ—ï¼Œç”¨RNNå°±é¸¡è‚‹äº†ï¼‰ã€‚</p>
<h4 id="LSTM"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h4><p>å› ä¸ºRNNå­˜åœ¨æ¢¯åº¦å¼¥æ•£å’Œæ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ï¼Œæ‰€ä»¥RNNå¾ˆéš¾å®Œç¾åœ°å¤„ç†å…·æœ‰é•¿æœŸä¾èµ–çš„ä¿¡æ¯ã€‚æ—¢ç„¶ä»…ä»…ä¾é ä¸€æ¡çº¿è¿æ¥åé¢çš„ç¥ç»å…ƒä¸è¶³ä»¥è§£å†³é—®é¢˜ï¼Œé‚£ä¹ˆå°±å†åŠ ä¸€æ¡çº¿å¥½äº†ï¼Œè¿™å°±æ˜¯LSTMã€‚</p>
<p>LSTMçš„å…³é”®åœ¨äºç»†èƒçš„çŠ¶æ€å’Œç©¿è¿‡ç»†èƒçš„çº¿ï¼Œç»†èƒçŠ¶æ€ç±»ä¼¼äºä¼ é€å¸¦ã€‚ç›´æ¥åœ¨æ•´ä¸ªé“¾ä¸Šè¿è¡Œï¼Œåªæœ‰ä¸€äº›å°‘é‡çš„çº¿æ€§äº¤äº’ã€‚ä¿¡æ¯åœ¨ä¸Šé¢æµåŠ¨ä¿æŒä¸å˜ä¼šå˜å¾—å®¹æ˜“ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/lstm_c.png" alt="avatar"></p>
<p>åœ¨LSTMä¸­ï¼Œé—¨å¯ä»¥å®ç°é€‰æ‹©æ€§çš„è®©ä¿¡æ¯é€šè¿‡ï¼Œä¸»è¦é€šè¿‡ä¸€ä¸ªsigmoidçš„ç¥ç»å±‚å’Œä¸€ä¸ªé€ç‚¹ç›¸ä¹˜çš„æ“ä½œæ¥å®ç°ã€‚LSTMé€šè¿‡ä¸‰ä¸ªè¿™æ ·çš„é—¨ç»“æ„æ¥å®ç°ä¿¡æ¯çš„ä¿æŠ¤å’Œæ§åˆ¶ï¼Œåˆ†åˆ«æ˜¯é—å¿˜é—¨ï¼ˆforget gateï¼‰ã€è¾“å…¥é—¨ï¼ˆinput gateï¼‰ä¸è¾“å‡ºé—¨ï¼ˆoutput gateï¼‰ã€‚</p>
<h5 id="é—å¿˜é—¨"><a href="#é—å¿˜é—¨" class="headerlink" title="é—å¿˜é—¨"></a><strong>é—å¿˜é—¨</strong></h5><p>åœ¨LSTMä¸­çš„ç¬¬ä¸€æ­¥æ˜¯å†³å®šä»ç»†èƒçŠ¶æ€ä¸­ä¸¢å¼ƒä»€ä¹ˆä¿¡æ¯ã€‚è¿™ä¸ªå†³å®šé€šè¿‡ä¸€ä¸ªç§°ä¸ºé—å¿˜é—¨çš„ç»“æ„æ¥å®Œæˆã€‚é—å¿˜é—¨ä¼šè¯»å–$h_{t-1}$å’Œ$x_t$ï¼Œè¾“å‡ºä¸€ä¸ª0åˆ°1ä¹‹é—´çš„æ•°å€¼ç»™ç»†èƒçš„çŠ¶æ€$c_{t-1}$ä¸­çš„æ•°å­—ã€‚1è¡¨ç¤ºå®Œå…¨ä¿ç•™ï¼Œ0è¡¨ç¤ºå®Œå…¨èˆå¼ƒã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/lstm_forget_gate.png" alt="avatar"></p>
<h5 id="è¾“å…¥é—¨"><a href="#è¾“å…¥é—¨" class="headerlink" title="è¾“å…¥é—¨"></a><strong>è¾“å…¥é—¨</strong></h5><p>é—å¿˜é—¨å†³å®šè®©å¤šå°‘æ–°çš„ä¿¡æ¯åŠ å…¥åˆ°cellçš„çŠ¶æ€ä¸­æ¥ã€‚å®ç°è¿™ä¸ªéœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><p>é¦–å…ˆä¸€ä¸ªå«â€œinput gate layerâ€çš„sigmoidå±‚å†³å®šå“ªäº›ä¿¡æ¯éœ€è¦æ›´æ–°ï¼›ä¸€ä¸ªtanhå±‚ç”Ÿæˆä¸€ä¸ªå‘é‡ï¼Œç”¨æ¥æ›´æ–°çŠ¶æ€Cã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/input_gate.png" alt="avatar"></p>
</li>
<li><p>æŠŠ 1 ä¸­çš„ä¸¤éƒ¨åˆ†è”åˆèµ·æ¥ï¼Œå¯¹cellçš„çŠ¶æ€è¿›è¡Œæ›´æ–°ï¼Œæˆ‘ä»¬æŠŠæ—§çš„çŠ¶æ€ä¸$f_t$ç›¸ä¹˜ï¼Œä¸¢å¼ƒæ‰æˆ‘ä»¬ç¡®å®šéœ€è¦ä¸¢å¼ƒçš„ä¿¡æ¯ï¼Œæ¥ç€åŠ ä¸Š$i_t * \tilde{C}_{t}$</p>
</li>
</ol>
<h5 id="è¾“å‡ºé—¨"><a href="#è¾“å‡ºé—¨" class="headerlink" title="è¾“å‡ºé—¨"></a>è¾“å‡ºé—¨</h5><p>æœ€ç»ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šè¾“å‡ºä»€ä¹ˆå€¼ï¼Œè¿™ä¸ªè¾“å‡ºå°†ä¼šåŸºäºæˆ‘ä»¬çš„ç»†èƒçš„çŠ¶æ€ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸€ä¸ªè¿‡æ»¤åçš„ç‰ˆæœ¬ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªsigmoidå±‚æ¥ç¡®å®šç»†èƒçŠ¶æ€çš„å“ªäº›éƒ¨åˆ†å°†è¾“å‡ºå‡ºå»ã€‚æ¥ç€ï¼Œæˆ‘ä»¬æŠŠç»†èƒçŠ¶æ€é€šè¿‡tanhè¿›è¡Œå¤„ç†ï¼ˆå¾—åˆ°ä¸€ä¸ª-1åˆ°1ä¹‹é—´çš„å€¼ï¼‰å¹¶å°†å®ƒå’Œsigmoidé—¨çš„è¾“å‡ºç›¸ä¹˜ï¼Œæœ€ç»ˆæˆ‘ä»¬ä»…ä»…ä¼šè¾“å‡ºæˆ‘ä»¬ç¡®å®šè¾“å‡ºçš„éƒ¨åˆ†ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/output_gate.png" alt="avatar"></p>
<h5 id="å…¬å¼"><a href="#å…¬å¼" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h5><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/lstm_all.png" alt="avatar"></p>
<h4 id="GRU"><a href="#GRU" class="headerlink" title="GRU"></a>GRU</h4><p>åœ¨LSTMä¸­å¼•å…¥äº†ä¸‰ä¸ªé—¨å‡½æ•°ï¼šè¾“å…¥é—¨ã€é—å¿˜é—¨å’Œè¾“å‡ºé—¨æ¥æ§åˆ¶è¾“å…¥å€¼ã€è®°å¿†å€¼å’Œè¾“å‡ºå€¼ã€‚è€Œåœ¨GRUæ¨¡å‹ä¸­åªæœ‰ä¸¤ä¸ªé—¨ï¼šåˆ†åˆ«æ˜¯æ›´æ–°é—¨å’Œé‡ç½®é—¨ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/GRU.png" alt="avatar"></p>
<p>å›¾ä¸­çš„$z_t$å’Œ$r_t$åˆ†åˆ«è¡¨ç¤ºæ›´æ–°é—¨å’Œé‡ç½®é—¨ã€‚æ›´æ–°é—¨ç”¨äºæ§åˆ¶å‰ä¸€æ—¶åˆ»çš„çŠ¶æ€ä¿¡æ¯è¢«å¸¦å…¥åˆ°å½“å‰çŠ¶æ€ä¸­çš„ç¨‹åº¦ï¼Œæ›´æ–°é—¨çš„å€¼è¶Šå¤§è¯´æ˜å‰ä¸€æ—¶åˆ»çš„çŠ¶æ€ä¿¡æ¯å¸¦å…¥è¶Šå¤šã€‚é‡ç½®é—¨æ§åˆ¶å‰ä¸€çŠ¶æ€æœ‰å¤šå°‘ä¿¡æ¯è¢«å†™å…¥åˆ°å½“å‰çš„å€™é€‰é›† $\tilde{h}_{t}$ä¸Šï¼Œé‡ç½®é—¨è¶Šå°ï¼Œå‰ä¸€çŠ¶æ€çš„ä¿¡æ¯è¢«å†™å…¥çš„è¶Šå°‘ã€‚</p>
<p>LSTMå’ŒGRUéƒ½æ˜¯é€šè¿‡å„ç§é—¨å‡½æ•°æ¥å°†é‡è¦ç‰¹å¾ä¿ç•™ä¸‹æ¥ï¼Œè¿™æ ·å°±ä¿è¯äº†åœ¨long-termä¼ æ’­çš„æ—¶å€™ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚æ­¤å¤–GRUç›¸å¯¹äºLSTMå°‘äº†ä¸€ä¸ªé—¨å‡½æ•°ï¼Œå› æ­¤åœ¨å‚æ•°çš„æ•°é‡ä¸Šä¹Ÿæ˜¯è¦å°‘äºLSTMçš„ï¼Œæ‰€ä»¥æ•´ä½“ä¸ŠGRUçš„è®­ç»ƒé€Ÿåº¦è¦å¿«äºLSTMçš„ã€‚</p>
<h3 id="Self-Attention"><a href="#Self-Attention" class="headerlink" title="Self-Attention"></a>Self-Attention</h3><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention.png" alt="avatar"></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåœ¨decodingé˜¶æ®µå¯¹inputä¸­çš„ä¿¡æ¯èµ‹äºˆä¸åŒæƒé‡ã€‚</p>
<ol>
<li>Encodeæ‰€æœ‰è¾“å…¥åºåˆ—,å¾—åˆ°å¯¹åº”çš„$h_1,h_2, \cdots ,h_T$(Tä¸ºè¾“å…¥åºåˆ—é•¿åº¦)</li>
<li>Decodeè¾“å‡ºç›®æ ‡$y_t$ä¹‹å‰ï¼Œä¼šå°†ä¸Šä¸€æ­¥è¾“å‡ºçš„éšè—çŠ¶æ€$S_{t-1}$ä¸ä¹‹å‰encodeå¥½çš„$h_1,h_2,\cdots,h_T$è¿›è¡Œæ¯”å¯¹ï¼Œè®¡ç®—ç›¸ä¼¼åº¦ï¼ˆ$e_{t,j}=a(s_{t-1},h_j)$ï¼‰,$h_j$ä¸ºä¹‹å‰ç¬¬jä¸ªè¾“å…¥encodeå¾—åˆ°çš„éšè—å‘é‡ï¼Œaä¸ºä»»æ„ä¸€ç§è®¡ç®—ç›¸ä¼¼åº¦çš„æ–¹å¼</li>
<li>ç„¶åé€šè¿‡softmaxï¼Œå³$a_{t,j}=\frac{exp(e_{t,j})}{\sum^{T_x}_{k=1}exp(e_{t,k})}$å°†ä¹‹å‰å¾—åˆ°çš„å„ä¸ªéƒ¨åˆ†çš„ç›¸å…³ç³»æ•°è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¾—åˆ°$a_{t,1},a_{t,2},\cdots,a_{t,T}$</li>
<li>åœ¨å¯¹è¾“å…¥åºåˆ—çš„éšè—å±‚è¿›è¡Œç›¸å…³æ€§åŠ æƒæ±‚å’Œå¾—åˆ°æ­¤æ—¶decodeéœ€è¦çš„context vector ï¼š$c_j=\sum^{T_x}_{j=1}a_{i,j}h_j$</li>
</ol>
<h3 id="è¯å‘é‡æ¨¡å‹"><a href="#è¯å‘é‡æ¨¡å‹" class="headerlink" title="è¯å‘é‡æ¨¡å‹"></a>è¯å‘é‡æ¨¡å‹</h3><p>onehotç¼–ç æ–¹å¼çš„ç¼ºç‚¹ï¼š</p>
<ol>
<li>å®ƒæ˜¯ä¸€ä¸ªè¯è¢‹æ¨¡å‹ï¼Œä¸è€ƒè™‘è¯ä¸è¯ä¹‹é—´çš„é¡ºåºï¼ˆæ–‡æœ¬ä¸­è¯çš„é¡ºåºä¿¡æ¯ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼‰</li>
<li>å®ƒå‡è®¾è¯ä¸è¯ç›¸äº’ç‹¬ç«‹ï¼ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯ä¸è¯æ˜¯ç›¸äº’å½±å“çš„ï¼‰</li>
<li>å®ƒå¾—åˆ°çš„ç‰¹å¾æ˜¯ç¦»æ•£ç¨€ç–çš„ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œé¢ä¸´ç€å·¨å¤§çš„ç»´åº¦ç¾éš¾é—®é¢˜</li>
</ol>
<p>å°†é«˜ç»´è¯å‘é‡åµŒå…¥åˆ°ä¸€ä¸ªä½ç»´ç©ºé—´ã€‚word2vecæ˜¯è¯åµŒå…¥æ–¹å¼çš„ä¸€ç§ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/word_embedding.png" alt="avatar"></p>
<p>ä¸»è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>ä¸€ä¸ªæ˜¯ç»Ÿè®¡è¯­è¨€æ¨¡å‹é‡Œå…³æ³¨çš„æ¡ä»¶æ¦‚ç‡$ğ‘(ğ‘¤ğ‘¡|ğ‘ğ‘œğ‘›ğ‘¡ğ‘’ğ‘¥ğ‘¡)$çš„è®¡ç®—</li>
<li>ä¸€ä¸ªæ˜¯å‘é‡ç©ºé—´æ¨¡å‹é‡Œå…³æ³¨çš„è¯å‘é‡çš„è¡¨è¾¾</li>
</ol>
<h4 id="word2vec"><a href="#word2vec" class="headerlink" title="word2vec"></a>word2vec</h4><h5 id="CBoWæ¨¡å‹"><a href="#CBoWæ¨¡å‹" class="headerlink" title="CBoWæ¨¡å‹"></a><strong>CBoWæ¨¡å‹</strong></h5><p>CBOWæ˜¯å·²çŸ¥ä¸Šä¸‹æ–‡ï¼Œä¼°ç®—å½“å‰è¯è¯­çš„è¯­è¨€æ¨¡å‹ã€‚å…¶å­¦ä¹ ç›®æ ‡æ˜¯æœ€å¤§åŒ–å¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼š</p>
<script type="math/tex; mode=display">
\mathcal{L}=\sum_{w \in \mathcal{C}} \log p(w | \text {Context}(w))</script><p>å…¶ä¸­ï¼Œwè¡¨ç¤ºè¯­æ–™åº“Cä¸­ä»»æ„ä¸€ä¸ªè¯ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/CBOW.png" alt="avatar"></p>
<ol>
<li><strong>è¾“å…¥å±‚</strong>æ˜¯ä¸Šä¸‹æ–‡çš„è¯è¯­çš„è¯å‘é‡ï¼ˆåœ¨è®­ç»ƒCBOWæ¨¡å‹ï¼Œè¯å‘é‡åªæ˜¯ä¸ªå‰¯äº§å“ï¼Œç¡®åˆ‡æ¥è¯´ï¼Œæ˜¯CBOWæ¨¡å‹çš„ä¸€ä¸ªå‚æ•°ã€‚è®­ç»ƒå¼€å§‹çš„æ—¶å€™ï¼Œè¯å‘é‡æ˜¯ä¸ªéšæœºå€¼ï¼Œéšç€è®­ç»ƒçš„è¿›è¡Œä¸æ–­è¢«æ›´æ–°ï¼‰ã€‚</li>
<li><strong>æŠ•å½±å±‚</strong>å¯¹å…¶æ±‚å’Œï¼Œæ‰€è°“æ±‚å’Œï¼Œå°±æ˜¯ç®€å•çš„å‘é‡åŠ æ³•ã€‚</li>
<li><strong>è¾“å‡ºå±‚</strong>è¾“å‡ºæœ€å¯èƒ½çš„wã€‚ç”±äºè¯­æ–™åº“ä¸­è¯æ±‡é‡æ˜¯å›ºå®šçš„|C|ä¸ªï¼Œæ‰€ä»¥ä¸Šè¿°è¿‡ç¨‹å…¶å®å¯ä»¥çœ‹åšä¸€ä¸ªå¤šåˆ†ç±»é—®é¢˜ã€‚ç»™å®šç‰¹å¾ï¼Œä»|C|ä¸ªåˆ†ç±»ä¸­æŒ‘ä¸€ä¸ªã€‚</li>
</ol>
<p>å¯¹äºç¥ç»ç½‘ç»œæ¨¡å‹å¤šåˆ†ç±»ï¼Œæœ€æœ´ç´ çš„åšæ³•æ˜¯softmaxå›å½’ï¼š</p>
<script type="math/tex; mode=display">
h_{\theta}\left(x^{(i)}\right)=\left[\begin{array}{c}
p\left(y^{(i)}=1 | x^{(i)} ; \theta\right) \\
p\left(y^{(i)}=2 | x^{(i)} ; \theta\right) \\
\vdots \\
p\left(y^{(i)}=k | x^{(i)} ; \theta\right)
\end{array}\right]=\frac{1}{\sum_{j=1}^{k} e^{\theta_{j}^{T} x^{(i)}}}\left[\begin{array}{c}
e^{\theta_{1}^{T} x^{(i)}} \\
e^{\theta_{2}^{T} x^{(i)}} \\
\vdots \\
e^{\theta_{k}^{T} x^{(i)}}
\end{array}\right]</script><h5 id="skip-gramæ¨¡å‹"><a href="#skip-gramæ¨¡å‹" class="headerlink" title="skip-gramæ¨¡å‹"></a>skip-gramæ¨¡å‹</h5><p><strong>target wordå¯¹contextçš„é¢„æµ‹ä¸­å­¦ä¹ word vector</strong></p>
<script type="math/tex; mode=display">
p(\text {Context}(w) | w)=\prod_{u \in \text {Context}(w)} p(u | w)</script><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/skipgram.png" alt="avatar"></p>
<p>å¦‚ä½•å°†Skip-gramæ¨¡å‹çš„å‰å‘è®¡ç®—è¿‡ç¨‹å†™æˆæ•°å­¦å½¢å¼ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š</p>
<script type="math/tex; mode=display">
p\left(w_{o} | w_{i}\right)=\frac{e^{U_{o} \cdot V_{i}}}{\sum_{j} e^{U_{j} V_{i}}}</script><p>å…¶ä¸­ï¼Œå…¶ä¸­ï¼Œ$V_i$æ˜¯Embeddingå±‚çŸ©é˜µé‡Œçš„åˆ—å‘é‡ï¼Œä¹Ÿè¢«ç§°ä¸º$w_i$çš„input vectorã€‚$U_j$æ˜¯softmaxå±‚çŸ©é˜µé‡Œçš„è¡Œå‘é‡ï¼Œä¹Ÿè¢«ç§°ä¸º$w_i$çš„output vectorã€‚å› æ­¤ï¼ŒSkip-gramæ¨¡å‹çš„æœ¬è´¨æ˜¯<strong>è®¡ç®—è¾“å…¥wordçš„input vectorä¸ç›®æ ‡wordçš„output vectorä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œå¹¶è¿›è¡Œsoftmaxå½’ä¸€åŒ–</strong>ã€‚æˆ‘ä»¬è¦å­¦ä¹ çš„æ¨¡å‹å‚æ•°æ­£æ˜¯è¿™ä¸¤ç±»è¯å‘é‡ã€‚</p>
<p>ç„¶è€Œï¼Œç›´æ¥å¯¹è¯å…¸é‡Œçš„Vä¸ªè¯è®¡ç®—ç›¸ä¼¼åº¦å¹¶å½’ä¸€åŒ–ï¼Œæ˜¾ç„¶æ˜¯ä¸€ä»¶æå…¶è€—æ—¶çš„impossible missionã€‚å¼•å…¥äº†ä¸¤ç§ä¼˜åŒ–ç®—æ³•ï¼š<strong>å±‚æ¬¡Softmaxï¼ˆHierarchical Softmaxï¼‰</strong>å’Œ<strong>è´Ÿé‡‡æ ·ï¼ˆNegative Samplingï¼‰</strong>ã€‚</p>
<h5 id="Hierarchical-Softmax"><a href="#Hierarchical-Softmax" class="headerlink" title="Hierarchical Softmax"></a>Hierarchical Softmax</h5><p>softmaxå›å½’éœ€è¦å¯¹è¯­æ–™åº“ä¸­æ¯ä¸ªè¯è¯­ï¼ˆç±»ï¼‰éƒ½è®¡ç®—ä¸€éè¾“å‡ºæ¦‚ç‡å¹¶è¿›è¡Œå½’ä¸€åŒ–ï¼Œåœ¨å‡ åä¸‡è¯æ±‡é‡çš„è¯­æ–™ä¸Šæ— ç–‘æ˜¯ä»¤äººå¤´ç–¼çš„ã€‚åœ¨SVMä¸­çš„å¤šåˆ†ç±»ï¼Œå…¶å¤šåˆ†ç±»æ˜¯ç”±äºŒåˆ†ç±»ç»„åˆè€Œæ¥çš„ï¼š</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/svm_hierarchical.gif" alt="avatar"></p>
<p>è¿™æ˜¯ä¸€ç§äºŒå‰æ ‘ç»“æ„ï¼Œåº”ç”¨åˆ°word2vecä¸­è¢«ä½œè€…ç§°ä¸ºHierarchical Softmaxï¼š</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/cbow_hierarchical.jpg" alt="avatar"></p>
<p>ä¸Šå›¾è¾“å‡ºå±‚çš„æ ‘å½¢ç»“æ„å³ä¸ºHierarchical Softmaxã€‚éå¶å­èŠ‚ç‚¹ç›¸å½“äºä¸€ä¸ªç¥ç»å…ƒï¼ˆæ„ŸçŸ¥æœºï¼Œé€»è¾‘æ–¯è°›å›å½’å°±æ˜¯æ„ŸçŸ¥æœºçš„è¾“å‡ºä»£å…¥$f(x)=\frac{1}{1+e^x}$ï¼ŒäºŒåˆ†ç±»å†³ç­–è¾“å‡º1æˆ–0ï¼Œåˆ†åˆ«ä»£è¡¨å‘ä¸‹å·¦è½¬æˆ–å‘ä¸‹å³è½¬ï¼›æ¯ä¸ªå¶å­èŠ‚ç‚¹ä»£è¡¨è¯­æ–™åº“ä¸­çš„ä¸€ä¸ªè¯è¯­ï¼Œäºæ˜¯æ¯ä¸ªè¯è¯­éƒ½å¯ä»¥è¢«01å”¯ä¸€åœ°ç¼–ç ï¼Œå¹¶ä¸”å…¶ç¼–ç åºåˆ—å¯¹åº”ä¸€ä¸ªäº‹ä»¶åºåˆ—ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥è®¡ç®—æ¡ä»¶æ¦‚ç‡$p(w|Context(x))$ã€‚</p>
<p>åœ¨å¼€å§‹è®¡ç®—ä¹‹å‰ï¼Œè¿˜æ˜¯å¾—å¼•å…¥ä¸€äº›ç¬¦å·ï¼š</p>
<ol>
<li>$p^w$ä»æ ¹ç»“ç‚¹å‡ºå‘åˆ°è¾¾wå¯¹åº”å¶å­ç»“ç‚¹çš„è·¯å¾„.</li>
<li>$l^w$è·¯å¾„ä¸­åŒ…å«ç»“ç‚¹çš„ä¸ªæ•°</li>
<li>$p^w_1,p^w_2,\cdots,p^w_{l^w}$è·¯å¾„$p^w$ä¸­çš„å„ä¸ªèŠ‚ç‚¹</li>
<li>$d^w_2,d^w_3,\cdots,d^w_{l^w} \in {0,1}$è¯wçš„ç¼–ç ï¼Œ$d^w_j$è¡¨ç¤ºè·¯å¾„$p^w$ç¬¬jä¸ªèŠ‚ç‚¹å¯¹åº”çš„ç¼–ç ï¼ˆæ ¹èŠ‚ç‚¹æ— ç¼–ç ï¼‰</li>
<li>$\theta^w_1,\theta^w_2,\cdots,\theta^w_{l^w-1} \in R^m$è·¯å¾„$p^w$ä¸­éå¶èŠ‚ç‚¹å¯¹åº”çš„å‚æ•°å‘é‡</li>
</ol>
<p>äºæ˜¯å¯ä»¥ç»™å‡º$w$çš„æ¡ä»¶æ¦‚ç‡ï¼š</p>
<script type="math/tex; mode=display">
p(w | \text { Context }(w))=\prod_{j=2}^{l^{w}} p\left(d_{j}^{w} | \mathbf{x}_{w}, \theta_{j-1}^{w}\right)</script><p>è¿™æ˜¯ä¸ªç®€å•æ˜äº†çš„å¼å­ï¼Œä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹ç»è¿‡äº†$l^w-1$ä¸ªèŠ‚ç‚¹ï¼Œç¼–ç ä»ä¸‹æ ‡2å¼€å§‹ï¼ˆæ ¹èŠ‚ç‚¹æ— ç¼–ç ï¼‰ï¼Œå¯¹åº”çš„å‚æ•°å‘é‡ä¸‹æ ‡ä»1å¼€å§‹ï¼ˆæ ¹èŠ‚ç‚¹ä¸º1ï¼‰ã€‚å…¶ä¸­ï¼Œæ¯ä¸€é¡¹æ˜¯ä¸€ä¸ªé€»è¾‘æ–¯è°›å›å½’ï¼š</p>
<script type="math/tex; mode=display">
p\left(d_{j}^{w} | \mathbf{x}_{w}, \theta_{j-1}^{w}\right)=\left\{\begin{array}{ll}
\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right), & d_{j}^{w}=0 \\
1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right), & d_{j}^{w}=1
\end{array}\right.</script><p>è€ƒè™‘åˆ°dåªæœ‰0å’Œ1ä¸¤ç§å–å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æŒ‡æ•°å½¢å¼æ–¹ä¾¿åœ°å°†å…¶å†™åˆ°ä¸€èµ·ï¼š</p>
<script type="math/tex; mode=display">
p\left(d_{j}^{w} | \mathbf{x}_{w}, \theta_{j-1}^{w}\right)=\left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]^{1-d^w_{j}} \cdot\left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]^{d^w_{j}}</script><p>æˆ‘ä»¬çš„ç›®æ ‡å‡½æ•°å–å¯¹æ•°ä¼¼ç„¶ï¼š</p>
<script type="math/tex; mode=display">
\mathcal{L}=\sum_{w \in \mathcal{C}} \log p(w | \text { Context }(w))</script><p>å°†$p(w|Context(w))$ä»£å…¥ä¸Šå¼ï¼Œæœ‰</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathcal{L} &=\sum_{w \in \mathcal{C}} \log \prod_{j=2}^{l^{w}}\left\{\left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]^{1-d_{j}^{v}} \cdot\left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]^{d_{j}}\right\} \\
&=\sum_{w \in \mathcal{C}} \sum_{j=2}^{l^{w}}\left\{\left(1-d_{j}^{w}\right) \cdot \log \left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]+d_{j}^{w} \cdot \log \left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]\right\}
\end{aligned}</script><p>è¿™ä¹Ÿå¾ˆç›´ç™½ï¼Œè¿ä¹˜çš„å¯¹æ•°æ¢æˆæ±‚å’Œã€‚ä¸è¿‡è¿˜æ˜¯æœ‰ç‚¹é•¿ï¼Œæˆ‘ä»¬æŠŠæ¯ä¸€é¡¹ç®€è®°ä¸ºï¼š</p>
<script type="math/tex; mode=display">
\mathcal{L}(w, j)=\left(1-d_{j}^{w}\right) \cdot \log \left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]+d_{j}^{w} \cdot \log \left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]</script><p>æ€ä¹ˆæœ€å¤§åŒ–å¯¹æ•°ä¼¼ç„¶å‡½æ•°å‘¢ï¼Ÿåˆ†åˆ«æœ€å¤§åŒ–æ¯ä¸€é¡¹å³å¯ï¼ˆè¿™åº”è¯¥æ˜¯ä¸€ç§è¿‘ä¼¼ï¼Œæœ€å¤§åŒ–æŸä¸€é¡¹ä¸ä¸€å®šä½¿æ•´ä½“å¢å¤§ï¼Œå…·ä½“æ”¶æ•›çš„è¯æ˜è¿˜ä¸æ¸…æ¥šï¼‰ã€‚æ€ä¹ˆæœ€å¤§åŒ–æ¯ä¸€é¡¹å‘¢ï¼Ÿå…ˆæ±‚å‡½æ•°å¯¹æ¯ä¸ªå˜é‡çš„åå¯¼æ•°ï¼Œå¯¹æ¯ä¸€ä¸ªæ ·æœ¬ï¼Œä»£å…¥åå¯¼æ•°è¡¨è¾¾å¼å¾—åˆ°å‡½æ•°åœ¨è¯¥ç»´åº¦çš„å¢é•¿æ¢¯åº¦ï¼Œç„¶åè®©å¯¹åº”å‚æ•°åŠ ä¸Šè¿™ä¸ªæ¢¯åº¦ï¼Œå‡½æ•°åœ¨è¿™ä¸ªç»´åº¦ä¸Šå°±å¢é•¿äº†ã€‚</p>
<p>æ¯ä¸€é¡¹æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„å‚æ•°å‘é‡$\theta^w_{j-1}$ï¼Œå¦ä¸€ä¸ªæ˜¯è¾“å‡ºå±‚çš„è¾“å…¥$X_w$ï¼Œæˆ‘ä»¬åˆ†åˆ«å¯¹å…¶æ±‚åå¯¼æ•°ï¼š</p>
<script type="math/tex; mode=display">
\frac{\partial \mathcal{L}(w, j)}{\partial \theta_{j-1}^{w}}=\frac{\partial}{\partial \theta_{j-1}^{w}}\left\{\left(1-d_{j}^{w}\right) \cdot \log \left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]+d_{j}^{w} \cdot \log \left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]\right\}</script><p>å› ä¸ºsigmoidå‡½æ•°çš„å¯¼æ•°æœ‰ä¸ªå¾ˆæ£’çš„å½¢å¼ï¼š</p>
<script type="math/tex; mode=display">
\sigma^{\prime}(x)=\sigma(x)[1-\sigma(x)]</script><p>äºæ˜¯ä»£å…¥ä¸Šä¸Šå¼å¾—åˆ°ï¼š</p>
<script type="math/tex; mode=display">
\left(1-d_{j}^{w}\right)\left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right] \mathbf{x}_{w}-d_{j}^{w} \sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right) \mathbf{x}_{w}</script><p>åˆå¹¶åŒç±»é¡¹å¾—åˆ°ï¼š</p>
<script type="math/tex; mode=display">
\left[1-d_{j}^{w}-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right] \mathbf{x}_{w}</script><p>äºæ˜¯$\theta^w_{j-1}$çš„æ›´æ–°è¡¨è¾¾å¼å°±å¾—åˆ°äº†ï¼š</p>
<script type="math/tex; mode=display">
\theta_{j-1}^{w}:=\theta_{j-1}^{w}+\eta\left[1-d_{j}^{w}-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right] \mathbf{x}_{w}</script><p>å†æ¥$X_w$çš„åå¯¼æ•°ï¼Œæ³¨æ„åˆ°$\mathcal{L}(w, j)=\left(1-d_{j}^{w}\right) \cdot \log \left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]+d_{j}^{w} \cdot \log \left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]$ä¸­$X_w$å’Œ$\theta^w_{j-1}$æ˜¯å¯¹ç§°çš„ï¼Œæ‰€æœ‰ç›´æ¥å°†$\theta^w_{j-1}$çš„åå¯¼æ•°ä¸­çš„$\theta^w_{j-1}$æ›¿æ¢ä¸º$X_w$ï¼Œå¾—åˆ°å…³äº$X_w$çš„åå¯¼æ•°ï¼š</p>
<script type="math/tex; mode=display">
\frac{\partial \mathcal{L}(w, j)}{\partial \mathbf{x}_{w}}=\left[1-d_{j}^{w}-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right] \theta_{j-1}^{w}</script><p>ä¸è¿‡$X_w$æ˜¯ä¸Šä¸‹æ–‡çš„è¯å‘é‡çš„å’Œï¼Œä¸æ˜¯ä¸Šä¸‹æ–‡å•ä¸ªè¯çš„è¯å‘é‡ã€‚æ€ä¹ˆæŠŠè¿™ä¸ªæ›´æ–°é‡åº”ç”¨åˆ°å•ä¸ªè¯çš„è¯å‘é‡ä¸Šå»å‘¢ï¼Ÿword2vecé‡‡å–çš„æ˜¯ç›´æ¥å°†$X_w$çš„æ›´æ–°é‡æ•´ä¸ªåº”ç”¨åˆ°æ¯ä¸ªå•è¯çš„è¯å‘é‡ä¸Šå»ï¼š</p>
<script type="math/tex; mode=display">
\mathbf{v}(\tilde{w}):=\mathbf{v}(\tilde{w})+\eta \sum_{j=2}^{l^{w}} \frac{\partial \mathcal{L}(w, j)}{\partial \mathbf{x}_{w}}, \quad \tilde{w} \in \text { Context }(w)</script><p>å…¶ä¸­ï¼Œ$V(\tilde w)$ä»£è¡¨ä¸Šä¸‹æ–‡ä¸­æŸä¸€ä¸ªå•è¯çš„è¯å‘é‡ã€‚</p>
<h4 id="glove"><a href="#glove" class="headerlink" title="glove"></a>glove</h4><p>CBOWå’Œskip-gramè™½ç„¶å¯ä»¥å¾ˆå¥½åœ°è¿›è¡Œè¯æ±‡ç±»æ¯”ï¼Œä½†æ˜¯å› ä¸ºè¿™ä¸¤ç§æ–¹æ³•æ˜¯åŸºäºä¸€ä¸ªä¸ªå±€éƒ¨çš„ä¸Šä¸‹æ–‡çª—å£æ–¹æ³•ï¼Œå› æ­¤ï¼Œæ²¡æœ‰æœ‰æ•ˆåœ°åˆ©ç”¨å…¨å±€çš„è¯æ±‡å…±ç°ç»Ÿè®¡ä¿¡æ¯ã€‚ä¸ºäº†å…‹æœå…¨å±€çŸ©é˜µåˆ†è§£å’Œå±€éƒ¨ä¸Šä¸‹æ–‡çª—å£çš„ç¼ºé™·ï¼ŒGloVeæ–¹æ³•åŸºäºå…¨å±€è¯æ±‡å…±ç°çš„ç»Ÿè®¡ä¿¡æ¯æ¥å­¦ä¹ è¯å‘é‡ï¼Œä»è€Œå°†ç»Ÿè®¡ä¿¡æ¯ä¸å±€éƒ¨ä¸Šä¸‹æ–‡çª—å£æ–¹æ³•çš„ä¼˜ç‚¹éƒ½ç»“åˆèµ·æ¥ï¼Œå¹¶å‘ç°å…¶æ•ˆæœç¡®å®å¾—åˆ°äº†æå‡ã€‚</p>
<h5 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h5><p>å‡è®¾i=ice,j=steamå¹¶å¯¹kå–ä¸åŒçš„è¯æ±‡ï¼Œå¦‚â€œsolidâ€ï¼Œâ€œgasâ€ï¼Œâ€œwaterâ€ï¼Œâ€œfashionâ€ï¼Œæ ¹æ®ä¸Šé¢çš„å®šä¹‰ï¼Œæˆ‘ä»¬åˆ†åˆ«è®¡ç®—ä»–ä»¬çš„æ¦‚ç‡$P(kâˆ£ice)$ã€$P(kâˆ£steam)$ï¼Œå¹¶è®¡ç®—ä¸¤è€…çš„æ¯”ç‡$P(kâˆ£ice)/P(kâˆ£steam)$ï¼Œå¯ä»¥å‘ç°ï¼Œå¯¹äºâ€œsolidâ€ï¼Œå…¶å‡ºç°åœ¨â€œiceâ€ä¸Šä¸‹æ–‡çš„æ¦‚ç‡åº”è¯¥æ¯”è¾ƒå¤§ï¼Œå‡ºç°åœ¨â€œsteamâ€ä¸Šä¸‹æ–‡çš„æ¦‚ç‡åº”è¯¥æ¯”è¾ƒå°ï¼Œå› æ­¤ï¼Œä»–ä»¬çš„æ¯”å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ•°ï¼Œåœ¨ä¸‹è¡¨ä¸­æ˜¯8.9ï¼Œè€Œå¯¹äºâ€œgasâ€ï¼Œå‡ºç°åœ¨â€œiceâ€ä¸Šä¸‹æ–‡çš„æ¦‚ç‡åº”è¯¥æ¯”è¾ƒå°ï¼Œè€Œå‡ºç°åœ¨â€œsteamâ€ä¸Šä¸‹æ–‡çš„æ¦‚ç‡åº”è¯¥æ¯”è¾ƒå¤§ï¼Œå› æ­¤ï¼Œä¸¤è€…çš„æ¯”å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°ï¼Œåœ¨ä¸‹è¡¨ä¸­æ˜¯$8.5Ã—10^{-2}$ ï¼Œè€Œå¯¹äºâ€œwaterã€fashionâ€è¿™ä¸¤ä¸ªè¯æ±‡ï¼Œä»–ä»¬ä¸â€œiceâ€å’Œsteamâ€œçš„ç›¸å…³æ€§åº”è¯¥æ¯”è¾ƒå°ï¼Œå› æ­¤ï¼Œä»–ä»¬çš„æ¯”å€¼åº”è¯¥éƒ½æ˜¯æ¥è¿‘1ã€‚å› æ­¤ï¼Œè¿™æ ·æ¥çœ‹å¯ä»¥å‘ç°ï¼Œæ¯”å€¼$P(kâˆ£ice)/P(kâˆ£steam)$åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥åæ˜ è¯æ±‡ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œå½“ç›¸å…³æ€§æ¯”è¾ƒä½æ—¶ï¼Œå…¶å€¼åº”è¯¥åœ¨1é™„è¿‘ï¼Œå½“ç›¸å…³æ€§æ¯”è¾ƒé«˜æ—¶ï¼Œæ¯”å€¼åº”è¯¥åç¦»1æ¯”è¾ƒè¿œã€‚<br><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/glove.png" alt="avatar"></p>
<h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>åŸºäºè¿™æ ·çš„æ€æƒ³ï¼Œä½œè€…æå‡ºäº†è¿™æ ·ä¸€ç§çŒœæƒ³ï¼Œèƒ½ä¸èƒ½é€šè¿‡è®­ç»ƒè¯å‘é‡ï¼Œä½¿å¾—è¯å‘é‡ç»è¿‡æŸç§å‡½æ•°è®¡ç®—ä¹‹åå¯ä»¥å¾—åˆ°ä¸Šé¢çš„æ¯”å€¼ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
F\left(w_{i}, w_{j}, \tilde{w}_{k}\right)=\frac{P_{i k}}{P_{j k}}</script><p>å…¶ä¸­ï¼Œ$w_i$,$w_j$,$\tilde{w}_{k}$ ä¸ºè¯æ±‡i,j,kå¯¹åº”çš„è¯å‘é‡ï¼Œå…¶ç»´åº¦éƒ½ä¸ºdï¼Œè€Œ$P_{ik}$ï¼Œ$P_{jk}$ åˆ™å¯ä»¥ç›´æ¥é€šè¿‡è¯­æ–™è®¡ç®—å¾—åˆ°ï¼Œè¿™é‡ŒFä¸ºä¸€ä¸ªæœªçŸ¥çš„å‡½æ•°ã€‚ç”±äºè¯å‘é‡éƒ½æ˜¯åœ¨ä¸€ä¸ªçº¿æ€§å‘é‡ç©ºé—´ï¼Œå› æ­¤ï¼Œå¯ä»¥å¯¹$w_i$,$w_j$è¿›è¡Œå·®åˆ†ï¼Œå°†ä¸Šå¼è½¬å˜ä¸ºå¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
F\left(w_{i}-w_{j}, \tilde{w}_{k}\right)=\frac{P_{i k}}{P_{j k}}</script><p>ç”±äºä¸Šå¼ä¸­å·¦ä¾§æ‹¬å·ä¸­æ˜¯ä¸¤ä¸ªç»´åº¦ä¸ºdçš„è¯å‘é‡ï¼Œè€Œå³ä¾§æ˜¯ä¸€ä¸ªæ ‡é‡ï¼Œå› æ­¤ï¼Œå¾ˆå®¹æ˜“ä¼šæƒ³åˆ°å‘é‡çš„å†…ç§¯ï¼Œå› æ­¤ï¼Œä¸Šå¼å¯ä»¥è¿›ä¸€æ­¥æ”¹å˜ä¸º:</p>
<script type="math/tex; mode=display">
F\left(\left(w_{i}-w_{j}\right)^{T} \tilde{w}_{k}\right)=F\left(w_{i}^{T} w_{k}-w_{j}^{T} w_{k}\right)=\frac{P_{i k}}{P_{j k}}</script><p>ç”±äºä¸Šå¼ä¸­å·¦ä¾§æ˜¯ä¸€ç§å‡æ³•ï¼Œè€Œå³ä¾§æ˜¯ä¸€ç§é™¤æ³•ï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°æŒ‡æ•°è®¡ç®—ï¼Œå› æ­¤ï¼Œå¯ä»¥æŠŠFé™å®šä¸ºæŒ‡æ•°å‡½æ•°ï¼Œæ­¤æ—¶æœ‰ï¼š</p>
<script type="math/tex; mode=display">
\exp \left(w_{i}^{T} w_{k}-w_{j}^{T} w_{k}\right)=\frac{\exp \left(w_{i}^{T} w_{k}\right)}{\exp \left(w_{j}^{T} w_{k}\right)}=\frac{P_{i k}}{P_{j k}}</script><p>å› æ­¤ï¼Œæ­¤æ—¶åªè¦ç¡®ä¿ç­‰å¼ä¸¤è¾¹åˆ†å­åˆ†æ¯ç›¸ç­‰å³å¯ï¼Œå³ï¼š</p>
<script type="math/tex; mode=display">
\exp \left(w_{i}^{T} w_{k}\right)=P_{i k}, \exp \left(w_{j}^{T} w_{k}\right)=P_{j k}</script><p>è¿›ä¸€æ­¥çš„ï¼Œå¯ä»¥è½¬åŒ–ä¸ºå¯¹è¯­æ–™ä¸­çš„æ‰€æœ‰è¯æ±‡ï¼Œè€ƒå¯Ÿ$exp(w^T_iw_k)$=$P_{ik}$=$\frac{X_{ik}}{X_i}$ ï¼Œå³ï¼š</p>
<script type="math/tex; mode=display">
w_{i}^{T} w_{k}=\log \left(\frac{X_{i k}}{X_{i}}\right)=\log X_{i k}-\log X_{i}</script><p>ç”±äºä¸Šå¼å·¦ä¾§$w^T_iw_k$ä¸­ï¼Œè°ƒæ¢iå’Œkçš„å€¼ä¸ä¼šæ”¹å˜å…¶ç»“æœï¼Œå³å…·æœ‰å¯¹ç§°æ€§ï¼Œå› æ­¤ï¼Œä¸ºäº†ç¡®ä¿ç­‰å¼å³ä¾§ä¹Ÿå…·å¤‡å¯¹ç§°æ€§ï¼Œå¼•å…¥äº†ä¸¤ä¸ªåç½®é¡¹ï¼Œå³</p>
<script type="math/tex; mode=display">
w_{i}^{T} w_{k}=\log X_{i k}-b_{i}-b_{k}</script><p>æ­¤æ—¶ï¼Œ$logX_i$å·²ç»åŒ…å«åœ¨$bi$å½“ä¸­ã€‚å› æ­¤ï¼Œæ­¤æ—¶æ¨¡å‹çš„ç›®æ ‡å°±è½¬åŒ–ä¸ºé€šè¿‡å­¦ä¹ è¯å‘é‡çš„è¡¨ç¤ºï¼Œä½¿å¾—ä¸Šå¼ä¸¤è¾¹å°½é‡æ¥è¿‘ï¼Œå› æ­¤ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—ä¸¤è€…ä¹‹é—´çš„å¹³æ–¹å·®æ¥ä½œä¸ºç›®æ ‡å‡½æ•°ï¼Œå³ï¼š</p>
<script type="math/tex; mode=display">
J=\sum_{i, k=1}^{V}\left(w_{i}^{T} \tilde{w}_{k}+b_{i}+b_{k}-\log X_{i k}\right)^{2}</script><p>ä½†æ˜¯è¿™æ ·çš„ç›®æ ‡å‡½æ•°æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å¯¹æ‰€æœ‰çš„å…±ç°è¯æ±‡éƒ½æ˜¯é‡‡ç”¨åŒæ ·çš„æƒé‡ï¼Œå› æ­¤ï¼Œä½œè€…å¯¹ç›®æ ‡å‡½æ•°è¿›è¡Œäº†è¿›ä¸€æ­¥çš„ä¿®æ­£ï¼Œé€šè¿‡è¯­æ–™ä¸­çš„è¯æ±‡å…±ç°ç»Ÿè®¡ä¿¡æ¯æ¥æ”¹å˜ä»–ä»¬åœ¨ç›®æ ‡å‡½æ•°ä¸­çš„æƒé‡ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
J=\sum_{i, k=1}^{V} f\left(X_{i k}\right)\left(w_{i}^{T} \tilde{w}_{k}+b_{i}+b_{k}-\log X_{i k}\right)^{2}</script><p>è¿™é‡Œ$V$è¡¨ç¤ºè¯æ±‡çš„æ•°é‡ï¼Œå¹¶ä¸”æƒé‡å‡½æ•°$f$å¿…é¡»å…·å¤‡ä»¥ä¸‹çš„ç‰¹æ€§</p>
<ul>
<li>$f(0)=0$ï¼Œå½“è¯æ±‡å…±ç°çš„æ¬¡æ•°ä¸º0æ—¶ï¼Œæ­¤æ—¶å¯¹åº”çš„æƒé‡åº”è¯¥ä¸º0ã€‚</li>
<li>f(x)å¿…é¡»æ˜¯ä¸€ä¸ªéå‡å‡½æ•°ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯å½“è¯æ±‡å…±ç°çš„æ¬¡æ•°è¶Šå¤§æ—¶ï¼Œå…¶æƒé‡ä¸ä¼šå‡ºç°ä¸‹é™çš„æƒ…å†µã€‚</li>
<li>å¯¹äºé‚£äº›å¤ªé¢‘ç¹çš„è¯ï¼Œ$f(x)$åº”è¯¥èƒ½ç»™äºˆä»–ä»¬ä¸€ä¸ªç›¸å¯¹å°çš„æ•°å€¼ï¼Œè¿™æ ·æ‰ä¸ä¼šå‡ºç°è¿‡åº¦åŠ æƒã€‚</li>
</ul>
<p>ç»¼åˆä»¥ä¸Šä¸‰ç‚¹ç‰¹æ€§ï¼Œä½œè€…æå‡ºäº†ä¸‹é¢çš„æƒé‡å‡½æ•°ï¼š</p>
<script type="math/tex; mode=display">
f(x)=\left\{\begin{array}{cc}
\left(x / x_{\max }\right)^{\alpha} & \text { if } x<x_{\max } \\
1 & \text { otherwise }
\end{array}\right.</script><h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><ol>
<li>Gloveç»¼åˆäº†å…¨å±€è¯æ±‡å…±ç°çš„ç»Ÿè®¡ä¿¡æ¯å’Œå±€éƒ¨çª—å£ä¸Šä¸‹æ–‡æ–¹æ³•çš„ä¼˜ç‚¹ï¼Œå¯ä»¥è¯´æ˜¯ä¸¤ä¸ªä¸»æµæ–¹æ³•çš„ä¸€ç§ç»¼åˆï¼Œä½†æ˜¯ç›¸æ¯”äºå…¨å±€çŸ©é˜µåˆ†è§£æ–¹æ³•ï¼Œç”±äºGloVeä¸éœ€è¦è®¡ç®—é‚£äº›å…±ç°æ¬¡æ•°ä¸º0çš„è¯æ±‡ï¼Œå› æ­¤ï¼Œå¯ä»¥æå¤§çš„å‡å°‘è®¡ç®—é‡å’Œæ•°æ®çš„å­˜å‚¨ç©ºé—´ã€‚</li>
<li>ä½†æ˜¯GloVeæŠŠè¯­æ–™ä¸­çš„è¯é¢‘å…±ç°æ¬¡æ•°ä½œä¸ºè¯å‘é‡å­¦ä¹ é€¼è¿‘çš„ç›®æ ‡ï¼Œå½“è¯­æ–™æ¯”è¾ƒå°‘æ—¶ï¼Œæœ‰äº›è¯æ±‡å…±ç°çš„æ¬¡æ•°å¯èƒ½æ¯”è¾ƒå°‘ï¼Œç¬”è€…è§‰å¾—å¯èƒ½ä¼šå‡ºç°ä¸€ç§è¯¯å¯¼è¯å‘é‡è®­ç»ƒæ–¹å‘çš„ç°è±¡ã€‚</li>
</ol>
<h4 id="ELMO"><a href="#ELMO" class="headerlink" title="ELMO"></a>ELMO</h4><h5 id="é’ˆå¯¹çš„é—®é¢˜"><a href="#é’ˆå¯¹çš„é—®é¢˜" class="headerlink" title="é’ˆå¯¹çš„é—®é¢˜"></a>é’ˆå¯¹çš„é—®é¢˜</h5><p>word2vecä¸­ï¼Œåªæœ‰appleä¸€ä¸ªè¯å‘é‡ï¼Œæ— æ³•å¯¹ä¸€è¯å¤šä¹‰è¿›è¡Œå»ºæ¨¡ã€‚</p>
<h5 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h5><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/EMLO.png" alt="avatar"></p>
<p>ELMoçš„ä¸»è¦åšæ³•æ˜¯å…ˆè®­ç»ƒä¸€ä¸ªå®Œæ•´çš„è¯­è¨€æ¨¡å‹ï¼Œå†ç”¨è¿™ä¸ªè¯­è¨€æ¨¡å‹å»å¤„ç†éœ€è¦è®­ç»ƒçš„æ–‡æœ¬ï¼Œç”Ÿæˆç›¸åº”çš„è¯å‘é‡ï¼Œæ‰€ä»¥åœ¨æ–‡ä¸­ä¸€ç›´å¼ºè°ƒELMoçš„æ¨¡å‹å¯¹åŒä¸€ä¸ªå­—åœ¨ä¸åŒå¥å­ä¸­èƒ½ç”Ÿæˆä¸åŒçš„è¯å‘é‡ã€‚</p>
<p>åœ¨è¿›è¡Œæœ‰ç›‘ç£çš„NLPä»»åŠ¡æ—¶ï¼Œå¯ä»¥å°†ELMoç›´æ¥å½“åšç‰¹å¾æ‹¼æ¥åˆ°å…·ä½“ä»»åŠ¡æ¨¡å‹çš„è¯å‘é‡è¾“å…¥æˆ–è€…æ˜¯æ¨¡å‹çš„æœ€é«˜å±‚è¡¨ç¤ºä¸Šã€‚ä¸åƒä¼ ç»Ÿçš„è¯å‘é‡ï¼Œæ¯ä¸€ä¸ªè¯åªå¯¹åº”ä¸€ä¸ªè¯å‘é‡ï¼ŒELMoåˆ©ç”¨é¢„è®­ç»ƒå¥½çš„åŒå‘è¯­è¨€æ¨¡å‹ï¼Œç„¶åæ ¹æ®å…·ä½“è¾“å…¥ä»è¯¥è¯­è¨€æ¨¡å‹ä¸­å¯ä»¥å¾—åˆ°ä¸Šä¸‹æ–‡ä¾èµ–çš„å½“å‰è¯è¡¨ç¤ºï¼ˆ<strong>å¯¹äºä¸åŒä¸Šä¸‹æ–‡çš„åŒä¸€ä¸ªè¯çš„è¡¨ç¤ºæ˜¯ä¸ä¸€æ ·çš„</strong>ï¼‰ï¼Œå†å½“æˆç‰¹å¾åŠ å…¥åˆ°å…·ä½“çš„NLPæœ‰ç›‘ç£æ¨¡å‹é‡Œã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/emlo_embedding.png" alt="avatar"></p>
<p>EMLOä½¿ç”¨çš„æ˜¯ä¸€ä¸ª<strong>åŒå‘çš„LSTMè¯­è¨€æ¨¡å‹</strong>ï¼Œç”±ä¸€ä¸ªå‰å‘å’Œä¸€ä¸ªåå‘è¯­è¨€æ¨¡å‹æ„æˆï¼Œç›®æ ‡å‡½æ•°å°±æ˜¯å–è¿™ä¸¤ä¸ªæ–¹å‘è¯­è¨€æ¨¡å‹çš„æœ€å¤§ä¼¼ç„¶ã€‚</p>
<p>å‰å‘LSTMç»“æ„ï¼š</p>
<script type="math/tex; mode=display">
p\left(t_{1}, t_{2}, \ldots, t_{N}\right)=\prod_{k=1}^{N} p\left(t_{k} | t_{1}, t_{2}, \ldots, t_{k-1}\right)</script><p>åå‘LSTMç»“æ„ï¼š</p>
<script type="math/tex; mode=display">
p\left(t_{1}, t_{2}, \ldots, t_{N}\right)=\prod_{k=1}^{N} p\left(t_{k} | t_{k+1}, t_{k+2}, \ldots, t_{N}\right)</script><p>æœ€å¤§ä¼¼ç„¶å‡½æ•°ï¼š</p>
<script type="math/tex; mode=display">
\sum_{k=1}^{N}\left(\log p\left(t_{k} | t_{1}, t_{2}, \ldots, t_{k-1}\right)+\log p\left(t_{k} | t_{k+1}, t_{k+2}, \ldots, t_{N}\right)\right)</script><h5 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><ol>
<li>ELMoçš„å‡è®¾å‰æä¸€ä¸ªè¯çš„è¯å‘é‡ä¸åº”è¯¥æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥åœ¨ä¸€è¯å¤šæ„æ–¹é¢ELMoçš„æ•ˆæœä¸€å®šæ¯”word2vecè¦å¥½ã€‚</li>
<li>word2vecçš„å­¦ä¹ è¯å‘é‡çš„è¿‡ç¨‹æ˜¯é€šè¿‡ä¸­å¿ƒè¯çš„ä¸Šä¸‹çª—å£å»å­¦ä¹ ï¼Œå­¦ä¹ çš„èŒƒå›´å¤ªå°äº†ï¼Œè€ŒELMoåœ¨å­¦ä¹ è¯­è¨€æ¨¡å‹çš„æ—¶å€™æ˜¯ä»æ•´ä¸ªè¯­æ–™åº“å»å­¦ä¹ çš„ï¼Œè€Œåå†é€šè¿‡è¯­è¨€æ¨¡å‹ç”Ÿæˆçš„è¯å‘é‡å°±ç›¸å½“äºåŸºäºæ•´ä¸ªè¯­æ–™åº“å­¦ä¹ çš„è¯å‘é‡ï¼Œæ›´åŠ å‡†ç¡®ä»£è¡¨ä¸€ä¸ªè¯çš„æ„æ€ã€‚</li>
</ol>
<h4 id="GPT"><a href="#GPT" class="headerlink" title="GPT"></a>GPT</h4><p>ç”¨Transformerç½‘ç»œä»£æ›¿äº†LSTMä½œä¸ºè¯­è¨€æ¨¡å‹æ¥æ›´å¥½çš„æ•è·é•¿è·ç¦»è¯­è¨€ç»“æ„ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/gpt_1.png" alt="avatar"></p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/gpt_2.png" alt="avatar"></p>
<h5 id="Masked-Attention"><a href="#Masked-Attention" class="headerlink" title="Masked Attention"></a>Masked Attention</h5><p>åœ¨transformerä¸­ï¼ŒEncoderå› ä¸ºè¦ç¼–ç æ•´ä¸ªå¥å­ï¼Œæ‰€ä»¥æ¯ä¸ªè¯éƒ½éœ€è¦è€ƒè™‘ä¸Šä¸‹æ–‡çš„å…³ç³»ã€‚æ‰€ä»¥æ¯ä¸ªè¯åœ¨è®¡ç®—çš„è¿‡ç¨‹ä¸­éƒ½æ˜¯å¯ä»¥çœ‹åˆ°å¥å­ä¸­æ‰€æœ‰çš„è¯çš„ã€‚ä½†æ˜¯Decoderä¸Seq2Seqä¸­çš„è§£ç å™¨ç±»ä¼¼ï¼Œæ¯ä¸ªè¯éƒ½åªèƒ½çœ‹åˆ°å‰é¢è¯çš„çŠ¶æ€ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªå•å‘çš„Self-Attentionç»“æ„ã€‚Masked Attentionçš„å®ç°ä¹Ÿéå¸¸ç®€å•ï¼Œåªè¦åœ¨æ™®é€šçš„Self Attentionçš„Softmaxæ­¥éª¤ä¹‹å‰ï¼Œä¸æŒ‰ä½ä¹˜ä¸Šä¸€ä¸ªä¸‹ä¸‰è§’çŸ©é˜µMå°±å¥½äº†</p>
<p>attentionï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
Q &=X W_{Q} \\
K &=X W_{K} \\
V &=X W_{V} \\
\text {Attention}(Q, K, V) &=\operatorname{Softmax}\left(\frac{Q K^{T}}{\sqrt{d_{k}}}\right) V
\end{aligned}</script><p>masked-attention</p>
<script type="math/tex; mode=display">
\text { Attention }(Q, K, V)=\operatorname{Softmax}\left(\frac{Q K^{T} \Theta M}{\sqrt{d_{k}}}\right) V</script><h4 id="BERT"><a href="#BERT" class="headerlink" title="BERT"></a>BERT</h4><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/bert_gpt_elmo.png" alt="avatar"></p>
<h5 id="Task-1-MLM"><a href="#Task-1-MLM" class="headerlink" title="Task 1: MLM"></a>Task 1: MLM</h5><p>ç”±äºBERTéœ€è¦é€šè¿‡ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¥é¢„æµ‹ä¸­å¿ƒè¯çš„ä¿¡æ¯ï¼ŒåŒæ—¶åˆä¸å¸Œæœ›æ¨¡å‹æå‰çœ‹è§ä¸­å¿ƒè¯çš„ä¿¡æ¯ï¼Œå› æ­¤æå‡ºäº†ä¸€ç§ Masked Language Model çš„é¢„è®­ç»ƒæ–¹å¼ï¼Œå³éšæœºä»è¾“å…¥é¢„æ–™ä¸Š mask æ‰ä¸€äº›å•è¯ï¼Œç„¶åé€šè¿‡çš„ä¸Šä¸‹æ–‡é¢„æµ‹è¯¥å•è¯ï¼Œç±»ä¼¼äºä¸€ä¸ªå®Œå½¢å¡«ç©ºä»»åŠ¡ã€‚</p>
<p>åœ¨é¢„è®­ç»ƒä»»åŠ¡ä¸­ï¼Œ15%çš„ Word Piece ä¼šè¢«maskï¼Œè¿™15%çš„ Word Piece ä¸­ï¼Œ80%çš„æ—¶å€™ä¼šç›´æ¥æ›¿æ¢ä¸º [Mask] ï¼Œ10%çš„æ—¶å€™å°†å…¶æ›¿æ¢ä¸ºå…¶å®ƒä»»æ„å•è¯ï¼Œ10%çš„æ—¶å€™ä¼šä¿ç•™åŸå§‹Token</p>
<ul>
<li>æ²¡æœ‰100%maskçš„åŸå› <ul>
<li>å¦‚æœå¥å­ä¸­çš„æŸä¸ªToken100%éƒ½ä¼šè¢«maskæ‰ï¼Œé‚£ä¹ˆåœ¨fine-tuningçš„æ—¶å€™æ¨¡å‹å°±ä¼šæœ‰ä¸€äº›æ²¡æœ‰è§è¿‡çš„å•è¯</li>
</ul>
</li>
<li>åŠ å…¥10%éšæœºtokençš„åŸå› <ul>
<li>Transformerè¦ä¿æŒå¯¹æ¯ä¸ªè¾“å…¥tokençš„åˆ†å¸ƒå¼è¡¨å¾ï¼Œå¦åˆ™æ¨¡å‹å°±ä¼šè®°ä½è¿™ä¸ª[mask]æ˜¯token â€™hairyâ€˜</li>
<li>å¦å¤–ç¼–ç å™¨ä¸çŸ¥é“å“ªäº›è¯éœ€è¦é¢„æµ‹çš„ï¼Œå“ªäº›è¯æ˜¯é”™è¯¯çš„ï¼Œå› æ­¤è¢«è¿«éœ€è¦å­¦ä¹ æ¯ä¸€ä¸ªtokençš„è¡¨ç¤ºå‘é‡</li>
</ul>
</li>
<li>å¦å¤–ï¼Œæ¯ä¸ªbatchsizeåªæœ‰15%çš„å•è¯è¢«maskçš„åŸå› ï¼Œæ˜¯å› ä¸ºæ€§èƒ½å¼€é”€çš„é—®é¢˜ï¼ŒåŒå‘ç¼–ç å™¨æ¯”å•é¡¹ç¼–ç å™¨è®­ç»ƒè¦æ›´æ…¢</li>
</ul>
<h5 id="Task-2-NSP"><a href="#Task-2-NSP" class="headerlink" title="Task 2: NSP"></a>Task 2: NSP</h5><p>ä»…ä»…ä¸€ä¸ªMLMä»»åŠ¡æ˜¯ä¸è¶³ä»¥è®© BERT è§£å†³é˜…è¯»ç†è§£ç­‰å¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡çš„ï¼Œå› æ­¤æ·»åŠ äº†é¢å¤–çš„ä¸€ä¸ªé¢„è®­ç»ƒä»»åŠ¡ï¼Œå³ Next Sequence Predictionã€‚</p>
<p>å…·ä½“ä»»åŠ¡å³ä¸ºä¸€ä¸ªå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡ï¼Œå³åˆ¤æ–­å¥å­Bæ˜¯å¦æ˜¯å¥å­Açš„ä¸‹æ–‡ï¼Œå¦‚æœæ˜¯çš„è¯è¾“å‡ºâ€™IsNextâ€˜ï¼Œå¦åˆ™è¾“å‡ºâ€™NotNextâ€˜ã€‚</p>
<p>è®­ç»ƒæ•°æ®çš„ç”Ÿæˆæ–¹å¼æ˜¯ä»å¹³è¡Œè¯­æ–™ä¸­éšæœºæŠ½å–çš„è¿ç»­ä¸¤å¥è¯ï¼Œå…¶ä¸­50%ä¿ç•™æŠ½å–çš„ä¸¤å¥è¯ï¼Œå®ƒä»¬ç¬¦åˆIsNextå…³ç³»ï¼Œå¦å¤–50%çš„ç¬¬äºŒå¥è¯æ˜¯éšæœºä»é¢„æ–™ä¸­æå–çš„ï¼Œå®ƒä»¬çš„å…³ç³»æ˜¯NotNextçš„ã€‚è¿™ä¸ªå…³ç³»ä¿å­˜åœ¨å›¾4ä¸­çš„[CLS]ç¬¦å·ä¸­</p>
<h5 id="è¾“å…¥"><a href="#è¾“å…¥" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h5><ul>
<li>Token Embeddingsï¼šå³ä¼ ç»Ÿçš„è¯å‘é‡å±‚ï¼Œæ¯ä¸ªè¾“å…¥æ ·æœ¬çš„é¦–å­—ç¬¦éœ€è¦è®¾ç½®ä¸º[CLS]ï¼Œå¯ä»¥ç”¨äºä¹‹åçš„åˆ†ç±»ä»»åŠ¡ï¼Œè‹¥æœ‰ä¸¤ä¸ªä¸åŒçš„å¥å­ï¼Œéœ€è¦ç”¨[SEP]åˆ†éš”ï¼Œä¸”æœ€åä¸€ä¸ªå­—ç¬¦éœ€è¦ç”¨[SEP]è¡¨ç¤ºç»ˆæ­¢</li>
<li>Segment Embeddingsï¼šä¸º[0,1]åºåˆ—ï¼Œç”¨æ¥åœ¨NSPä»»åŠ¡ä¸­åŒºåˆ«ä¸¤ä¸ªå¥å­ï¼Œä¾¿äºåšå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡</li>
<li>Position Embeddingsï¼šä¸Transformerä¸­çš„ä½ç½®å‘é‡ä¸åŒï¼ŒBERTä¸­çš„ä½ç½®å‘é‡æ˜¯ç›´æ¥è®­ç»ƒå‡ºæ¥çš„</li>
</ul>
<h5 id="Fine-tunninng"><a href="#Fine-tunninng" class="headerlink" title="Fine-tunninng"></a>Fine-tunninng</h5><p>å¯¹äºä¸åŒçš„ä¸‹æ¸¸ä»»åŠ¡ï¼Œæˆ‘ä»¬ä»…éœ€è¦å¯¹BERTä¸åŒä½ç½®çš„è¾“å‡ºè¿›è¡Œå¤„ç†å³å¯ï¼Œæˆ–è€…ç›´æ¥å°†BERTä¸åŒä½ç½®çš„è¾“å‡ºç›´æ¥è¾“å…¥åˆ°ä¸‹æ¸¸æ¨¡å‹å½“ä¸­ã€‚å…·ä½“çš„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>å¯¹äºæƒ…æ„Ÿåˆ†æç­‰å•å¥åˆ†ç±»ä»»åŠ¡ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥å•ä¸ªå¥å­ï¼ˆä¸éœ€è¦[SEP]åˆ†éš”åŒå¥ï¼‰ï¼Œå°†[CLS]çš„è¾“å‡ºç›´æ¥è¾“å…¥åˆ°åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»</li>
<li>å¯¹äºå¥å­å¯¹ä»»åŠ¡ï¼ˆå¥å­å…³ç³»åˆ¤æ–­ä»»åŠ¡ï¼‰ï¼Œéœ€è¦ç”¨[SEP]åˆ†éš”ä¸¤ä¸ªå¥å­è¾“å…¥åˆ°æ¨¡å‹ä¸­ï¼Œç„¶ååŒæ ·ä»…é¡»å°†[CLS]çš„è¾“å‡ºé€åˆ°åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»</li>
<li>å¯¹äºé—®ç­”ä»»åŠ¡ï¼Œå°†é—®é¢˜ä¸ç­”æ¡ˆæ‹¼æ¥è¾“å…¥åˆ°BERTæ¨¡å‹ä¸­ï¼Œç„¶åå°†ç­”æ¡ˆä½ç½®çš„è¾“å‡ºå‘é‡è¿›è¡ŒäºŒåˆ†ç±»å¹¶åœ¨å¥å­æ–¹å‘ä¸Šè¿›è¡Œsoftmaxï¼ˆåªéœ€é¢„æµ‹å¼€å§‹å’Œç»“æŸä½ç½®å³å¯ï¼‰</li>
<li>å¯¹äºå‘½åå®ä½“è¯†åˆ«ä»»åŠ¡ï¼Œå¯¹æ¯ä¸ªä½ç½®çš„è¾“å‡ºè¿›è¡Œåˆ†ç±»å³å¯ï¼Œå¦‚æœå°†æ¯ä¸ªä½ç½®çš„è¾“å‡ºä½œä¸ºç‰¹å¾è¾“å…¥åˆ°CRFå°†å–å¾—æ›´å¥½çš„æ•ˆæœã€‚</li>
</ul>
<h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul>
<li>BERTçš„é¢„è®­ç»ƒä»»åŠ¡MLMä½¿å¾—èƒ½å¤Ÿå€ŸåŠ©ä¸Šä¸‹æ–‡å¯¹åºåˆ—è¿›è¡Œç¼–ç ï¼Œä½†åŒæ—¶ä¹Ÿä½¿å¾—å…¶é¢„è®­ç»ƒè¿‡ç¨‹ä¸ä¸­çš„æ•°æ®ä¸å¾®è°ƒçš„æ•°æ®ä¸åŒ¹é…ï¼Œéš¾ä»¥é€‚åº”ç”Ÿæˆå¼ä»»åŠ¡</li>
<li>å¦å¤–ï¼ŒBERTæ²¡æœ‰è€ƒè™‘é¢„æµ‹[MASK]ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œæ˜¯å¯¹è¯­è¨€æ¨¡å‹è”åˆæ¦‚ç‡çš„æœ‰åä¼°è®¡</li>
<li>ç”±äºæœ€å¤§è¾“å…¥é•¿åº¦çš„é™åˆ¶ï¼Œé€‚åˆå¥å­å’Œæ®µè½çº§åˆ«çš„ä»»åŠ¡ï¼Œä¸é€‚ç”¨äºæ–‡æ¡£çº§åˆ«çš„ä»»åŠ¡ï¼ˆå¦‚é•¿æ–‡æœ¬åˆ†ç±»ï¼‰</li>
<li>é€‚åˆå¤„ç†è‡ªç„¶è¯­ä¹‰ç†è§£ç±»ä»»åŠ¡(NLU)ï¼Œè€Œä¸é€‚åˆè‡ªç„¶è¯­è¨€ç”Ÿæˆç±»ä»»åŠ¡(NLG)</li>
</ul>
<h5 id="torchä½¿ç”¨"><a href="#torchä½¿ç”¨" class="headerlink" title="torchä½¿ç”¨"></a>torchä½¿ç”¨</h5><ol>
<li>å¯¼å…¥ç›¸å…³åº“</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> transformers <span class="keyword">as</span> ppb <span class="comment"># pytorch transformers</span></span><br></pre></td></tr></table></figure>
<ol>
<li>å¯¼å…¥é¢„è®­ç»ƒå¥½çš„ DistilBERT æ¨¡å‹ä¸åˆ†è¯å™¨</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">model_class, tokenizer_class, pretrained_weights = (ppb.DistilBertModel, ppb.DistilBertTokenizer, <span class="string">'distilbert-base-uncased'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Want BERT instead of distilBERT? Uncomment the following line:</span></span><br><span class="line"><span class="comment">#model_class, tokenizer_class, pretrained_weights = (ppb.BertModel, ppb.BertTokenizer, 'bert-base-uncased')# </span></span><br><span class="line"></span><br><span class="line">Load pretrained model/tokenizertokenizer = tokenizer_class.from_pretrained(pretrained_weights)</span><br><span class="line">model = model_class.from_pretrained(pretrained_weights)</span><br></pre></td></tr></table></figure>
<ol>
<li>tokenizeï¼šåˆ†è¯+[cls]+[sep]<br><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/bert_tokenize.png" alt="avatar"></li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tokenizer.encode(<span class="string">"a visually stunning rumination on love"</span>, add_special_tokens=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>padding</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">   max_len = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tokenized.values:</span><br><span class="line">    <span class="keyword">if</span> len(i) &gt; max_len:</span><br><span class="line">        max_len = len(i)</span><br><span class="line">padded = np.array([i + [<span class="number">0</span>]*(max_len-len(i)) <span class="keyword">for</span> i <span class="keyword">in</span> tokenized.values])</span><br></pre></td></tr></table></figure>
<ol>
<li>masking</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">attention_mask = np.where(padded != <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>ä½¿ç”¨bertè¿›è¡Œç¼–ç </li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    <span class="comment"># last_hidden_states = [batch_size, max_sentence_len, 768]</span></span><br><span class="line">    last_hidden_states = model(input_ids, attention_mask=attention_mask)</span><br></pre></td></tr></table></figure>
<h3 id="transformer"><a href="#transformer" class="headerlink" title="transformer"></a>transformer</h3><p>æ— è®ºæ˜¯RNNè¿˜æ˜¯CNNï¼Œåœ¨å¤„ç†NLPä»»åŠ¡æ—¶éƒ½æœ‰ç¼ºé™·ã€‚CNNæ˜¯å…¶å…ˆå¤©çš„å·ç§¯æ“ä½œä¸å¾ˆé€‚åˆåºåˆ—åŒ–çš„æ–‡æœ¬ï¼ŒRNNæ˜¯å…¶æ²¡æœ‰å¹¶è¡ŒåŒ–ï¼Œå¾ˆå®¹æ˜“è¶…å‡ºå†…å­˜é™åˆ¶ï¼ˆæ¯”å¦‚50tokensé•¿åº¦çš„å¥å­å°±ä¼šå æ®å¾ˆå¤§çš„å†…å­˜ï¼‰ã€‚</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/transformer.png" alt="avatar"></p>
<h4 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h4><ol>
<li>å¦‚ä½•å®ç°å¹¶è¡Œè®¡ç®—åŒæ—¶ç¼©çŸ­ä¾èµ–è·ç¦»ï¼Ÿé‡‡ç”¨è‡ªæ³¨æ„æœºåˆ¶</li>
<li>å¦‚ä½•å‘CNNä¸€æ ·è€ƒè™‘å¤šé€šé“ä¿¡æ¯ï¼Ÿé‡‡ç”¨å¤šå¤´æ³¨æ„åŠ›</li>
<li>è‡ªæ³¨æ„åŠ›æœºåˆ¶æŸå¤±äº†ä½ç½®ä¿¡æ¯ï¼Œå¦‚ä½•è¡¥å¿? ä½ç½®åµŒå…¥</li>
<li>åé¢çš„å±‚ä¸­ä½ç½®ä¿¡æ¯æ¶ˆæ•£ï¼Ÿ æ®‹å·®è¿æ¥</li>
</ol>
<h4 id="self-attention"><a href="#self-attention" class="headerlink" title="self-attention"></a>self-attention</h4><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention-1.png" alt="avatar"></p>
<h5 id="å¹¶è¡ŒåŒ–"><a href="#å¹¶è¡ŒåŒ–" class="headerlink" title="å¹¶è¡ŒåŒ–"></a>å¹¶è¡ŒåŒ–</h5><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention-2.png" alt="avatar" style="zoom:67%;"></p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention-3.png" alt="avatar" style="zoom: 67%;"></p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention-4.png" alt="avatar" style="zoom: 67%;"></p>
<h5 id="multi-head-self-attention"><a href="#multi-head-self-attention" class="headerlink" title="multi-head self-attention"></a>multi-head self-attention</h5><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/multi-head.png" alt="avatar" style="zoom:67%;"></p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/multi-head-1.png" alt="avatar"></p>
<h4 id="encoder"><a href="#encoder" class="headerlink" title="encoder"></a>encoder</h4><p>Encoderç”±N=6ä¸ªç›¸åŒçš„layerç»„æˆï¼ŒlayeræŒ‡çš„å°±æ˜¯ä¸Šå›¾å·¦ä¾§çš„å•å…ƒï¼Œæœ€å·¦è¾¹æœ‰ä¸ªâ€œNxâ€ï¼Œè¿™é‡Œæ˜¯x6ä¸ªã€‚æ¯ä¸ªLayerç”±ä¸¤ä¸ªsub-layerç»„æˆï¼Œåˆ†åˆ«æ˜¯multi-head self-attention mechanismå’Œfully connected feed-forward networkã€‚å…¶ä¸­æ¯ä¸ªsub-layeréƒ½åŠ äº†residual connectionå’Œnormalisationï¼Œå› æ­¤å¯ä»¥å°†sub-layerçš„è¾“å‡ºè¡¨ç¤ºä¸ºï¼š</p>
<script type="math/tex; mode=display">
sub_layer_output=LayerNorm(x+(\text {SubLayer}(x)))</script><h5 id="Multi-head-self-attention"><a href="#Multi-head-self-attention" class="headerlink" title="Multi-head self-attention"></a>Multi-head self-attention</h5><p>ç”±äºattentionï¼š</p>
<script type="math/tex; mode=display">
attention_output=Attention(Q, K, V)</script><p>multi-head attentionåˆ™æ˜¯é€šè¿‡hä¸ªä¸åŒçš„<strong>çº¿æ€§å˜æ¢</strong>å¯¹Qï¼ŒKï¼ŒVè¿›è¡ŒæŠ•å½±ï¼Œæœ€åå°†ä¸åŒçš„attentionç»“æœæ‹¼æ¥èµ·æ¥ï¼š</p>
<script type="math/tex; mode=display">
\begin{array}{l}\text { MultiHead(Q,K,V)}= Concat(head_1,\ldots,head_h)W^{O}  \\ head_i = Attention(QW_i\left.^{Q}, K W_{i}^{K}, V W_{i}^{V}\right) \\ \text { Attention }(Q, K, V)=\operatorname{softmax}\left(\frac{Q K^{T}}{\sqrt{d_{k}}}\right) V\end{array}</script><p>å¤šä¸ªheadå¸¦æ¥çš„ä¼˜åŠ¿æ˜¯ï¼šä¸åŒçš„headï¼Œæ‰€attentionçš„å†…å®¹ä¸åŒï¼Œæ¯”å¦‚ï¼š$head_1$ attention å…¨å±€çš„å†…å®¹ï¼Œ$head_2$ attention localçš„å†…å®¹ã€‚</p>
<h5 id="Position-wise-feed-forward-networks"><a href="#Position-wise-feed-forward-networks" class="headerlink" title="Position-wise feed-forward networks"></a>Position-wise feed-forward networks</h5><p>è¿™å±‚ä¸»è¦æ˜¯æä¾›éçº¿æ€§å˜æ¢ã€‚Attentionè¾“å‡ºçš„ç»´åº¦æ˜¯[bsz<em>seq_len, num_heads</em>head_size]ï¼Œç¬¬äºŒä¸ªsub-layeræ˜¯ä¸ªå…¨è¿æ¥å±‚ï¼Œä¹‹æ‰€ä»¥æ˜¯position-wiseæ˜¯å› ä¸ºè¿‡çº¿æ€§å±‚æ—¶æ¯ä¸ªä½ç½®içš„å˜æ¢å‚æ•°æ˜¯ä¸€æ ·çš„.</p>
<h4 id="Decoder"><a href="#Decoder" class="headerlink" title="Decoder"></a><strong>Decoder</strong></h4><p>Decoderå’ŒEncoderçš„ç»“æ„å·®ä¸å¤šï¼Œä½†æ˜¯å¤šäº†ä¸€ä¸ªattentionçš„sub-layer,decoderçš„è¾“å…¥è¾“å‡ºå’Œè§£ç è¿‡ç¨‹:</p>
<ul>
<li>è¾“å‡ºï¼šå¯¹åº”iä½ç½®çš„è¾“å‡ºè¯çš„æ¦‚ç‡åˆ†å¸ƒ</li>
<li>è¾“å…¥ï¼šencoderçš„è¾“å‡º &amp; å¯¹åº”i-1ä½ç½®decoderçš„è¾“å‡ºã€‚æ‰€ä»¥ä¸­é—´çš„attentionä¸æ˜¯self-attentionï¼Œå®ƒçš„Kï¼ŒVæ¥è‡ªencoderï¼ŒQæ¥è‡ªä¸Šä¸€ä½ç½®decoderçš„è¾“å‡º</li>
<li>è§£ç ï¼š<strong>ç¼–ç å¯ä»¥å¹¶è¡Œè®¡ç®—ï¼Œä¸€æ¬¡æ€§å…¨éƒ¨encodingå‡ºæ¥ï¼Œä½†è§£ç ä¸æ˜¯ä¸€æ¬¡æŠŠæ‰€æœ‰åºåˆ—è§£å‡ºæ¥çš„ï¼Œè€Œæ˜¯åƒrnnä¸€æ ·ä¸€ä¸ªä¸€ä¸ªè§£å‡ºæ¥çš„</strong>ï¼Œå› ä¸ºè¦ç”¨ä¸Šä¸€ä¸ªä½ç½®çš„è¾“å…¥å½“ä½œattentionçš„query</li>
</ul>
<h4 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ol>
<li><p>ä¸èƒ½ä¸€æ¬¡å¯¹å¾ˆé•¿æ–‡æœ¬è¿›è¡Œå»ºæ¨¡ï¼ˆå‡å¦‚æ–‡æœ¬é•¿åº¦ä¸º$10^5$,åœ¨ä¸€ä¸ªforwardçš„æ¨¡å—ä¸­éœ€è¦$10^5 * 10^5 = 10^{10}$å¤§å°çš„çŸ©é˜µæ¥ä¿å­˜scoreï¼Œå¾ˆå®¹æ˜“å¯¼è‡´ out of memory é—®é¢˜ï¼‰ã€‚è§£å†³æ–¹æ³•ï¼šdivide long sequence into smaller sequence. ä½†æ˜¯è¿™æ ·å¯¼è‡´smaller sequence ä¹‹é—´æ˜¯æ²¡æœ‰è”ç³»çš„ã€‚ï¼ˆä½¿ç”¨rnnçš„æ–¹å¼æ¥å»ºç«‹smaller sequence ä¹‹é—´çš„è”ç³»â€”&gt; transformer XLï¼‰</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/transformer-xl.png" alt="avatar"></p>
<p>åœ¨å¼•å…¥rnnçš„æ—¶å€™ï¼Œé‡åˆ°äº†absolute positionçš„é—®é¢˜ï¼Œç”¨relative positionè¿›è¡Œäº†è§£å†³ã€‚</p>
</li>
</ol>
<h5 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p>å¼•å…¥Self Attentionåä¼šæ›´å®¹æ˜“æ•è·å¥å­ä¸­é•¿è·ç¦»çš„ç›¸äº’ä¾èµ–çš„ç‰¹å¾ï¼Œå› ä¸ºå¦‚æœæ˜¯RNNæˆ–è€…LSTMï¼Œéœ€è¦ä¾æ¬¡åºåºåˆ—è®¡ç®—ï¼Œå¯¹äºè¿œè·ç¦»çš„ç›¸äº’ä¾èµ–çš„ç‰¹å¾ï¼Œè¦ç»è¿‡è‹¥å¹²æ—¶é—´æ­¥æ­¥éª¤çš„ä¿¡æ¯ç´¯ç§¯æ‰èƒ½å°†ä¸¤è€…è”ç³»èµ·æ¥ï¼Œè€Œè·ç¦»è¶Šè¿œï¼Œæœ‰æ•ˆæ•è·çš„å¯èƒ½æ€§è¶Šå°ã€‚</p>
<p>ä½†æ˜¯Self Attentionåœ¨è®¡ç®—è¿‡ç¨‹ä¸­ä¼šç›´æ¥å°†å¥å­ä¸­ä»»æ„ä¸¤ä¸ªå•è¯çš„è”ç³»é€šè¿‡ä¸€ä¸ªè®¡ç®—æ­¥éª¤ç›´æ¥è”ç³»èµ·æ¥ï¼Œæ‰€ä»¥è¿œè·ç¦»ä¾èµ–ç‰¹å¾ä¹‹é—´çš„è·ç¦»è¢«æå¤§ç¼©çŸ­ï¼Œæœ‰åˆ©äºæœ‰æ•ˆåœ°åˆ©ç”¨è¿™äº›ç‰¹å¾ã€‚é™¤æ­¤å¤–ï¼ŒSelf Attentionå¯¹äºå¢åŠ è®¡ç®—çš„å¹¶è¡Œæ€§ä¹Ÿæœ‰ç›´æ¥å¸®åŠ©ä½œç”¨ã€‚è¿™æ˜¯ä¸ºä½•Self Attentioné€æ¸è¢«å¹¿æ³›ä½¿ç”¨çš„ä¸»è¦åŸå› ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwNzc2NTk0NQ==&amp;mid=2247484682&amp;idx=1&amp;sn=51520138eed826ec891ac8154ee550f9&amp;chksm=970c2ddca07ba4ca33ee14542cff0457601bb16236f8edc1ff0e617051d1f063354dda0f8893&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">ä»å‰é¦ˆåˆ°åé¦ˆï¼šè§£æå¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰åŠå…¶tricks</a></li>
<li><a href="https://www.jiqizhixin.com/articles/2018-07-06-7" target="_blank" rel="noopener">Step-by-step to LSTM: è§£æLSTMç¥ç»ç½‘ç»œè®¾è®¡åŸç†</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/43493999" target="_blank" rel="noopener">AttentionåŸç†å’Œæºç è§£æ</a></li>
<li><a href="https://www.jiqizhixin.com/articles/2019-12-28?from=synced&amp;keyword=bert" target="_blank" rel="noopener">BERTæ¨¡å‹è¶…é…·ç‚«ï¼Œä¸Šæ‰‹åˆå¤ªéš¾ï¼Ÿè¯·æŸ¥æ”¶è¿™ä»½BERTå¿«é€Ÿå…¥é—¨æŒ‡å—ï¼</a></li>
</ol>
]]></content>
      <categories>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ·±åº¦å­¦ä¹ </tag>
        <tag>è‡ªç„¶è¯­è¨€å¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>æœºå™¨å­¦ä¹ å¤§æ€»ç»“</title>
    <url>/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="æœºå™¨å­¦ä¹ å¤§æ€»ç»“"><a href="#æœºå™¨å­¦ä¹ å¤§æ€»ç»“" class="headerlink" title="æœºå™¨å­¦ä¹ å¤§æ€»ç»“"></a>æœºå™¨å­¦ä¹ å¤§æ€»ç»“</h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹"></a><strong>è¿›ç¨‹å’Œçº¿ç¨‹</strong></h4><p>è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯ä¸€ä¸ªæ—¶é—´æ®µçš„æè¿°ï¼Œæ˜¯CPUå·¥ä½œæ—¶é—´æ®µçš„æè¿°ï¼Œä¸è¿‡æ˜¯é¢—ç²’å¤§å°ä¸åŒ.è¿›ç¨‹å°±æ˜¯åŒ…æ¢ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ç¨‹åºæ‰§è¡Œæ—¶é—´æ€»å’Œ = CPUåŠ è½½ä¸Šä¸‹æ–‡+CPUæ‰§è¡Œ+CPUä¿å­˜ä¸Šä¸‹æ–‡.çº¿ç¨‹æ˜¯å…±äº«äº†è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ç¯å¢ƒçš„æ›´ä¸ºç»†å°çš„CPUæ—¶é—´æ®µã€‚</p>
<h4 id="åˆ¤åˆ«å¼æ¨¡å‹å’Œç”Ÿæˆå¼æ¨¡å‹"><a href="#åˆ¤åˆ«å¼æ¨¡å‹å’Œç”Ÿæˆå¼æ¨¡å‹" class="headerlink" title="åˆ¤åˆ«å¼æ¨¡å‹å’Œç”Ÿæˆå¼æ¨¡å‹:"></a><strong>åˆ¤åˆ«å¼æ¨¡å‹å’Œç”Ÿæˆå¼æ¨¡å‹</strong>:</h4><ol>
<li>åˆ¤åˆ«å¼æ¨¡å‹ç›´æ¥å­¦ä¹ å†³ç­–å‡½æ•°$f(X)$æˆ–æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ$P(Y|X)$ä½œä¸ºé¢„æµ‹çš„æ¨¡å‹.å¾€å¾€å‡†ç¡®ç‡æ›´é«˜,å¹¶ä¸”å¯ä»¥ç®€åŒ–å­¦ä¹ é—®é¢˜.<ol>
<li>kè¿‘é‚»æ³•ã€æ„ŸçŸ¥æœºã€å†³ç­–æ ‘ã€æœ€å¤§ç†µæ¨¡å‹ã€Logisticå›å½’ã€çº¿æ€§åˆ¤åˆ«åˆ†æ(LDA)ã€æ”¯æŒå‘é‡æœº(SVM)ã€Boostingã€CRFã€çº¿æ€§å›å½’ã€ç¥ç»ç½‘ç»œ</li>
</ol>
</li>
<li>ç”Ÿæˆå¼æ¨¡å‹ç”±æ•°æ®å­¦ä¹ <strong>è”åˆæ¦‚ç‡åˆ†å¸ƒP(X,Y)</strong>,ç„¶åç”±P(Y|X)=P(X,Y)/P(X)æ±‚å‡ºæ¡ä»¶æ¦‚ç‡åˆ†å¸ƒä½œä¸ºé¢„æµ‹çš„æ¨¡å‹,å³ç”Ÿæˆæ¨¡å‹.å½“å­˜åœ¨éšå˜é‡æ—¶åªèƒ½ç”¨ç”Ÿæˆæ–¹æ³•å­¦ä¹ .<ol>
<li>æ··åˆé«˜æ–¯æ¨¡å‹å’Œå…¶ä»–æ··åˆæ¨¡å‹ã€éšé©¬å°”å¯å¤«æ¨¡å‹(HMM)ã€æœ´ç´ è´å¶æ–¯ã€ä¾èµ–è´å¶æ–¯(AODE)ã€LDAæ–‡æ¡£ä¸»é¢˜ç”Ÿæˆæ¨¡å‹</li>
</ol>
</li>
</ol>
<a id="more"></a>
<h4 id="æ¦‚ç‡è´¨é‡å‡½æ•°-æ¦‚ç‡å¯†åº¦å‡½æ•°-ç´¯ç§¯åˆ†å¸ƒå‡½æ•°"><a href="#æ¦‚ç‡è´¨é‡å‡½æ•°-æ¦‚ç‡å¯†åº¦å‡½æ•°-ç´¯ç§¯åˆ†å¸ƒå‡½æ•°" class="headerlink" title="æ¦‚ç‡è´¨é‡å‡½æ•°,æ¦‚ç‡å¯†åº¦å‡½æ•°,ç´¯ç§¯åˆ†å¸ƒå‡½æ•°:"></a><strong>æ¦‚ç‡è´¨é‡å‡½æ•°,æ¦‚ç‡å¯†åº¦å‡½æ•°,ç´¯ç§¯åˆ†å¸ƒå‡½æ•°</strong>:</h4><ol>
<li>æ¦‚ç‡è´¨é‡å‡½æ•° (probability mass functionï¼ŒPMF)æ˜¯ç¦»æ•£éšæœºå˜é‡åœ¨å„ç‰¹å®šå–å€¼ä¸Šçš„æ¦‚ç‡ã€‚</li>
<li>æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆprobability density functionï¼ŒPDF)æ˜¯å¯¹ è¿ç»­éšæœºå˜é‡ å®šä¹‰çš„ï¼Œæœ¬èº«ä¸æ˜¯æ¦‚ç‡ï¼Œåªæœ‰å¯¹è¿ç»­éšæœºå˜é‡çš„å–å€¼è¿›è¡Œç§¯åˆ†åæ‰æ˜¯æ¦‚ç‡ã€‚</li>
<li><p>ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆcumulative distribution functionï¼ŒCDF)èƒ½å®Œæ•´æè¿°ä¸€ä¸ªå®æ•°éšæœºå˜é‡Xçš„æ¦‚ç‡åˆ†å¸ƒï¼Œæ˜¯æ¦‚ç‡å¯†åº¦å‡½æ•°çš„ç§¯åˆ†ã€‚å¯¹æ–¼æ‰€æœ‰å®æ•°x ï¼Œä¸pdfç›¸å¯¹ã€‚</p>
<h4 id="æå¤§ä¼¼ç„¶ä¼°è®¡"><a href="#æå¤§ä¼¼ç„¶ä¼°è®¡" class="headerlink" title="æå¤§ä¼¼ç„¶ä¼°è®¡"></a><strong>æå¤§ä¼¼ç„¶ä¼°è®¡</strong></h4></li>
</ol>
<p>å·²çŸ¥æŸä¸ªå‚æ•°èƒ½ä½¿è¿™ä¸ªæ ·æœ¬å‡ºç°çš„æ¦‚ç‡æœ€å¤§ï¼Œæˆ‘ä»¬å½“ç„¶ä¸ä¼šå†å»é€‰æ‹©å…¶ä»–å°æ¦‚ç‡çš„æ ·æœ¬ï¼Œæ‰€ä»¥å¹²è„†å°±æŠŠè¿™ä¸ªå‚æ•°ä½œä¸ºä¼°è®¡çš„çœŸå®å€¼ã€‚</p>
<h4 id="æœ€å°äºŒä¹˜æ³•"><a href="#æœ€å°äºŒä¹˜æ³•" class="headerlink" title="æœ€å°äºŒä¹˜æ³•"></a>æœ€å°äºŒä¹˜æ³•</h4><p>äºŒä¹˜çš„è‹±æ–‡æ˜¯least square,æ‰¾ä¸€ä¸ªï¼ˆç»„ï¼‰ä¼°è®¡å€¼,ä½¿å¾—å®é™…å€¼ä¸ä¼°è®¡å€¼ä¹‹å·®çš„å¹³æ–¹åŠ æ€»ä¹‹åçš„å€¼æœ€å°$Q=\min \sum_{i}^{n}\left(y_{i e}-y_{i}\right)^{2}$.æ±‚è§£æ–¹å¼æ˜¯å¯¹å‚æ•°æ±‚åå¯¼,ä»¤åå¯¼ä¸º0å³å¯.æ ·æœ¬é‡å°æ—¶é€Ÿåº¦å¿«.</p>
<h4 id="æ¢¯åº¦ä¸‹é™æ³•"><a href="#æ¢¯åº¦ä¸‹é™æ³•" class="headerlink" title="æ¢¯åº¦ä¸‹é™æ³•"></a><strong>æ¢¯åº¦ä¸‹é™æ³•</strong></h4><p>è´Ÿæ¢¯åº¦æ–¹å‘æ˜¯å‡½æ•°å€¼ä¸‹é™æœ€å¿«çš„æ–¹å‘,æ¯æ¬¡æ›´æ–°å€¼éƒ½ç­‰äºåŸå€¼åŠ å­¦ä¹ ç‡(<strong>æ­¥é•¿</strong>)ä¹˜æŸå¤±å‡½æ•°çš„<strong>æ¢¯åº¦</strong>.æ¯æ¬¡éƒ½è¯•ä¸€ä¸ªæ­¥é•¿çœ‹ä¼šä¸ä¼šä¸‹é™ä¸€å®šçš„ç¨‹åº¦,å¦‚æœæ²¡æœ‰çš„è¯å°±æŒ‰æ¯”ä¾‹å‡å°æ­¥é•¿.ä¸æ–­åº”ç”¨å‚æ•°æ›´æ–°å…¬å¼ç›´åˆ°æ”¶æ•›,å¯ä»¥å¾—åˆ°å±€éƒ¨æœ€å°å€¼.åˆå§‹å€¼çš„ä¸åŒç»„åˆå¯ä»¥å¾—åˆ°ä¸åŒå±€éƒ¨æœ€å°å€¼.åœ¨æœ€ä¼˜ç‚¹æ—¶ä¼šæœ‰éœ‡è¡.</p>
<ol>
<li><p><strong>æ‰¹é‡æ¢¯åº¦ä¸‹é™(BGD)</strong>:æ¯æ¬¡éƒ½ä½¿ç”¨æ‰€æœ‰çš„mä¸ªæ ·æœ¬æ¥æ›´æ–°,å®¹æ˜“æ‰¾åˆ°å…¨å±€æœ€ä¼˜è§£,ä½†æ˜¯mè¾ƒå¤§æ—¶é€Ÿåº¦è¾ƒæ…¢ã€‚$\theta_{j}^{\prime}=\theta_{j}+\frac{1}{m} \sum_{i=1}^{m}\left(y^{i}-h_{\theta}\left(x^{i}\right)\right) x_{j}^{i}$</p>
</li>
<li><p><strong>éšæœºæ¢¯åº¦ä¸‹é™(SGD)</strong>ï¼šæ¯æ¬¡åªä½¿ç”¨ä¸€ä¸ªæ ·æœ¬æ¥æ›´æ–°,è®­ç»ƒé€Ÿåº¦å¿«,ä½†æ˜¯å™ªéŸ³è¾ƒå¤š,ä¸å®¹æ˜“æ‰¾åˆ°å…¨å±€æœ€ä¼˜è§£,ä»¥æŸå¤±å¾ˆå°çš„ä¸€éƒ¨åˆ†ç²¾ç¡®åº¦å’Œå¢åŠ ä¸€å®šæ•°é‡çš„è¿­ä»£æ¬¡æ•°ä¸ºä»£ä»·,æ¢å–äº†æ€»ä½“çš„ä¼˜åŒ–æ•ˆç‡çš„æå‡.æ³¨æ„æ§åˆ¶æ­¥é•¿ç¼©å°,å‡å°‘éœ‡è¡.</p>
</li>
</ol>
<script type="math/tex; mode=display">
\theta_{j}=\theta_{j}+\left(y^{i}-h_{\theta}\left(x^{i}\right)\right) x_{j}^{i}</script><ol>
<li><strong>å°æ‰¹é‡æ¢¯åº¦ä¸‹é™(MBGD)</strong>:æ¯æ¬¡ä½¿ç”¨ä¸€éƒ¨åˆ†æ ·æœ¬æ¥æ›´æ–°.</li>
</ol>
<h4 id="ç‰›é¡¿æ³•"><a href="#ç‰›é¡¿æ³•" class="headerlink" title="ç‰›é¡¿æ³•"></a><strong>ç‰›é¡¿æ³•</strong></h4><p>ç‰›é¡¿æ³•æ˜¯<strong>äºŒæ¬¡æ”¶æ•›</strong>,å› æ­¤æ”¶æ•›é€Ÿåº¦å¿«.ä»å‡ ä½•ä¸Šçœ‹æ˜¯æ¯æ¬¡ç”¨ä¸€ä¸ªäºŒæ¬¡æ›²é¢æ¥æ‹Ÿåˆå½“å‰æ‰€å¤„ä½ç½®çš„å±€éƒ¨æ›²é¢,è€Œæ¢¯åº¦ä¸‹é™æ³•æ˜¯ç”¨ä¸€ä¸ªå¹³é¢æ¥æ‹Ÿåˆ.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/newton.png" alt="avatar"></p>
<ol>
<li><strong>é»‘å¡çŸ©é˜µ</strong>æ˜¯ç”±ç›®æ ‡å‡½æ•°f(x)åœ¨ç‚¹Xå¤„çš„äºŒé˜¶åå¯¼æ•°ç»„æˆçš„n*né˜¶å¯¹ç§°çŸ©é˜µã€‚</li>
<li><strong>ç‰›é¡¿æ³•</strong>:å°†f(x)åœ¨x(k)é™„è¿‘è¿›è¡Œ<strong>äºŒé˜¶æ³°å‹’å±•å¼€</strong>:$f(x)=f\left(x^{(k)}\right)+g_{k}^{\top}\left(x-x^{(k)}\right)+\frac{1}{2}\left(x-x^{(k)}\right)^{\mathrm{T}} H\left(x^{(k)}\right)\left(x-x^{(k)}\right)$ã€‚å…¶ä¸­$g_k$æ˜¯$f(x)$çš„æ¢¯åº¦å‘é‡åœ¨$x^{(k)}$çš„å€¼,$H(x^{(k)})$æ˜¯$f(x)$çš„é»‘å¡çŸ©é˜µåœ¨ç‚¹$x^k$çš„å€¼.ç‰›é¡¿æ³•åˆ©ç”¨æå°ç‚¹çš„å¿…è¦æ¡ä»¶$f(x)$å¤„çš„æ¢¯åº¦ä¸º0,æ¯æ¬¡è¿­ä»£ä¸­ä»ç‚¹$x^{(k)}$å¼€å§‹,å‡è®¾$\nabla f\left(x^{(k+1)}\right)=0$ï¼Œå¯¹äºŒé˜¶æ³°å‹’å±•å¼€æ±‚åå¯¼æœ‰ $\nabla f(x)=g_{k}+H_{k}\left(x-x^{(k)}\right)$ï¼Œä»£å…¥å¾—åˆ°$g_{k}+H_{k}\left(x^{(k+1)}-x^{(k)}\right)=0$,å³$\quad x^{(k+1)}=x^{(k)}-H_{k}^{-1} g_{k}$,ä»¥æ­¤ä¸ºè¿­ä»£å…¬å¼å°±æ˜¯ç‰›é¡¿æ³•.</li>
</ol>
<h4 id="æ‹Ÿç‰›é¡¿æ³•"><a href="#æ‹Ÿç‰›é¡¿æ³•" class="headerlink" title="æ‹Ÿç‰›é¡¿æ³•"></a>æ‹Ÿç‰›é¡¿æ³•</h4><p>ç”¨ä¸€ä¸ª<strong>né˜¶æ­£å®šçŸ©é˜µGk</strong>=G(x(k))æ¥<strong>è¿‘ä¼¼ä»£æ›¿</strong>é»‘å¡çŸ©é˜µçš„<strong>é€†çŸ©é˜µ</strong>å°±æ˜¯æ‹Ÿç‰›é¡¿æ³•çš„åŸºæœ¬æ€æƒ³.åœ¨ç‰›é¡¿æ³•ä¸­é»‘å¡çŸ©é˜µæ»¡è¶³çš„æ¡ä»¶å¦‚ä¸‹:$g_{k+1}-g_{k}=H_{k}\left(x^{(k+1)}-x^{(k)}\right)$,ä»¤$ {y_{k}}=g_{k+1}-g_{k}, \quad \delta_{k}=x^{(k+1)}-x^{(k)}$ï¼Œåˆ™æœ‰  $ H_{k}^{-1} y_{k}=\delta_{k}$,ç§°ä¸ºæ‹Ÿç‰›é¡¿æ¡ä»¶.</p>
<ol>
<li><strong>DFPç®—æ³•</strong>:å‡è®¾æ¯ä¸€æ­¥$G_{k+1}=G_{k}+P_{k}+Q_{k}$ï¼Œä¸ºä½¿$G_{k+1}$æ»¡è¶³æ‹Ÿç‰›é¡¿æ¡ä»¶,å¯ä½¿$P_k$å’Œ$Q_k$æ»¡è¶³$P_{k} y_{k}=\delta_{k}, Q_{k} y_{k}=-G_{k} y_{k}$,ä¾‹å¦‚å–$P_{k}=\frac{\delta_{k} \delta_{k}^{\tau}}{\delta_{k}^{\top} y_{k}} \quad Q_{k}=-\frac{G_{k} y_{k} y_{k}^{\top} G_{k}}{y_{k}^{\top} G_{k} y_{k}}$ï¼Œå°±å¾—åˆ°è¿­ä»£å…¬å¼$G_{k+1}=G_{k}+\frac{\delta_{k} \delta_{k}^{\top}}{\delta_{k}^{\tau} y_{k}}-\frac{G_{k} y_{k} y_{k}^{\top} G_{k}}{y_{k}^{T} G_{k} y_{k}}$</li>
<li><strong>BFGSç®—æ³•</strong>: æœ€æµè¡Œçš„æ‹Ÿç‰›é¡¿ç®—æ³•.å®ƒç”¨$B_k$é€¼è¿‘é»‘å¡çŸ©é˜µ,æ­¤æ—¶ç›¸åº”çš„æ‹Ÿç‰›é¡¿æ¡ä»¶æ˜¯$B_{k+1} \delta_{k}=y_{k}$,å‡è®¾æ¯ä¸€æ­¥$B_{k+1}=B_{k}+P_{k}+Q_{k}$ï¼Œåˆ™ $P_k$ å’Œ $Q_k$ æ»¡è¶³$P_{k} \delta_{k}=y_{k}, \quad Q_{k} \delta_{k}=-B_{k} \delta_{k}$ï¼Œç±»ä¼¼å¾—åˆ°è¿­ä»£å…¬å¼$B_{k+1}=B_{k}+\frac{y_{k} y_{k}^{\top}}{y_{k}^{\top} \delta_{k}}-\frac{B_{k} \delta_{k} \delta_{k}^{\mathrm{T}} B_{k}}{\delta_{k}^{\top} B_{k} \delta_{k}}$</li>
</ol>
<h4 id="å…ˆéªŒæ¦‚ç‡å’ŒåéªŒæ¦‚ç‡"><a href="#å…ˆéªŒæ¦‚ç‡å’ŒåéªŒæ¦‚ç‡" class="headerlink" title="å…ˆéªŒæ¦‚ç‡å’ŒåéªŒæ¦‚ç‡"></a><strong>å…ˆéªŒæ¦‚ç‡å’ŒåéªŒæ¦‚ç‡</strong></h4><ol>
<li>å…ˆéªŒæ¦‚ç‡å°±æ˜¯äº‹æƒ…å‘ç”Ÿå‰çš„é¢„æµ‹æ¦‚ç‡.</li>
<li>åéªŒæ¦‚ç‡æ˜¯ä¸€ç§æ¡ä»¶æ¦‚ç‡ï¼Œå®ƒé™å®šäº†äº‹ä»¶ä¸ºéšå˜é‡å–å€¼ï¼Œè€Œæ¡ä»¶ä¸ºè§‚æµ‹ç»“æœã€‚ä¸€èˆ¬çš„æ¡ä»¶æ¦‚ç‡ï¼Œæ¡ä»¶å’Œäº‹ä»¶å¯ä»¥æ˜¯ä»»æ„çš„.</li>
<li>è´å¶æ–¯å…¬å¼$P(y|x) = ( P(x|y) * P(y) ) / P(x)$ä¸­,$P(y|x)$æ˜¯åéªŒæ¦‚ç‡,$P(x|y)$æ˜¯æ¡ä»¶æ¦‚ç‡,$P(y)$æ˜¯å…ˆéªŒæ¦‚ç‡.</li>
</ol>
<h4 id="åå·®-æ–¹å·®-å™ªå£°"><a href="#åå·®-æ–¹å·®-å™ªå£°" class="headerlink" title="åå·®,æ–¹å·®,å™ªå£°"></a><strong>åå·®,æ–¹å·®,å™ªå£°</strong></h4><ol>
<li>åå·®:åº¦é‡äº†å­¦ä¹ ç®—æ³•çš„æœŸæœ›é¢„æµ‹å’ŒçœŸå®ç»“æœåç¦»ç¨‹åº¦</li>
<li>æ–¹å·®:åº¦é‡äº†åŒæ ·å¤§å°çš„è®­ç»ƒé›†çš„å˜åŠ¨æ‰€å¯¼è‡´çš„å­¦ä¹ æ€§èƒ½çš„å˜åŒ–ï¼Œå³åˆ»ç”»äº†æ•°æ®æ‰°åŠ¨æ‰€é€ æˆçš„å½±å“</li>
<li>å™ªå£°:å¯ä»¥è®¤ä¸ºæ˜¯æ•°æ®è‡ªèº«çš„æ³¢åŠ¨æ€§ï¼Œè¡¨è¾¾äº†ç›®å‰ä»»ä½•å­¦ä¹ ç®—æ³•æ‰€èƒ½è¾¾åˆ°æ³›åŒ–è¯¯å·®çš„ä¸‹é™</li>
<li><p><strong>æ³›åŒ–è¯¯å·®</strong>å¯ä»¥åˆ†è§£ä¸ºåå·®ã€æ–¹å·®ä¸å™ªå£°ä¹‹å’Œ</p>
<h4 id="å¯¹å¶åŸç†"><a href="#å¯¹å¶åŸç†" class="headerlink" title="å¯¹å¶åŸç†"></a><strong>å¯¹å¶åŸç†</strong></h4></li>
</ol>
<p>ä¸€ä¸ªä¼˜åŒ–é—®é¢˜å¯ä»¥ä»ä¸»é—®é¢˜å’Œå¯¹å¶é—®é¢˜ä¸¤ä¸ªæ–¹é¢è€ƒè™‘.åœ¨æ¨å¯¼å¯¹å¶é—®é¢˜æ—¶,é€šè¿‡å°†æ‹‰æ ¼æœ—æ—¥å‡½æ•°å¯¹$x$æ±‚å¯¼å¹¶ä½¿å¯¼æ•°ä¸º0æ¥è·å¾—å¯¹å¶å‡½æ•°.å¯¹å¶å‡½æ•°ç»™å‡ºäº†ä¸»é—®é¢˜æœ€ä¼˜è§£çš„ä¸‹ç•Œ,å› æ­¤å¯¹å¶é—®é¢˜ä¸€èˆ¬æ˜¯å‡¸é—®é¢˜,é‚£ä¹ˆåªéœ€æ±‚è§£å¯¹å¶å‡½æ•°çš„æœ€ä¼˜è§£å°±å¯ä»¥äº†.</p>
<h4 id="KKTæ¡ä»¶"><a href="#KKTæ¡ä»¶" class="headerlink" title="KKTæ¡ä»¶"></a><strong>KKTæ¡ä»¶</strong></h4><p>é€šå¸¸æˆ‘ä»¬è¦æ±‚è§£çš„æœ€ä¼˜åŒ–æ¡ä»¶æœ‰å¦‚ä¸‹ä¸‰ç§:</p>
<ol>
<li>æ— çº¦æŸä¼˜åŒ–é—®é¢˜:é€šå¸¸ä½¿ç”¨æ±‚å¯¼,ä½¿å¯¼æ•°ä¸ºé›¶,æ±‚è§£å€™é€‰æœ€ä¼˜å€¼</li>
<li>æœ‰ç­‰å¼çº¦æŸçš„ä¼˜åŒ–é—®é¢˜:é€šå¸¸ä½¿ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•,å³æŠŠç­‰å¼çº¦æŸç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜å­å’Œä¼˜åŒ–é—®é¢˜åˆå¹¶ä¸ºä¸€ä¸ªå¼å­,é€šè¿‡å¯¹å„ä¸ªå˜é‡æ±‚å¯¼ä½¿å…¶ä¸ºé›¶,æ±‚è§£å€™é€‰æœ€ä¼˜å€¼.æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•å…¶å®æ˜¯KKTæ¡ä»¶åœ¨ç­‰å¼çº¦æŸä¼˜åŒ–é—®é¢˜çš„ç®€åŒ–ç‰ˆ.</li>
<li>æœ‰ä¸ç­‰å¼çº¦æŸçš„ä¼˜åŒ–é—®é¢˜:é€šå¸¸ä½¿ç”¨KKTæ¡ä»¶.å³æŠŠä¸ç­‰å¼çº¦æŸ,ç­‰å¼çº¦æŸå’Œä¼˜åŒ–é—®é¢˜åˆå¹¶ä¸ºä¸€ä¸ªå¼å­.å‡è®¾æœ‰å¤šä¸ªç­‰å¼çº¦æŸ$h(x)$å’Œä¸ç­‰å¼çº¦æŸ$g(x)$,$L(\boldsymbol{x}, \boldsymbol{\lambda}, \boldsymbol{\mu})=f(\boldsymbol{x})+\sum_{i=1}^{m} \lambda_{i} h_{i}(\boldsymbol{x})+\sum_{i=1}^{n} \mu_{j} g_{j}(\boldsymbol{x})$,åˆ™ä¸ç­‰å¼çº¦æŸå¼•å…¥çš„KKTæ¡ä»¶å¦‚ä¸‹:<br>$\left\{\begin{array}{l}g_{j}(\boldsymbol{x}) \leqslant 0 \\ mu_{j} \geqslant 0  \\mu_{j} g_{j}(\boldsymbol{x})=0\end{array}\right.$ ,å®è´¨æ˜¯æœ€ä¼˜è§£åœ¨$g(x)&lt;0$åŒºåŸŸå†…æ—¶,çº¦æŸæ¡ä»¶ä¸èµ·ä½œç”¨,ç­‰ä»·äºå¯¹$Î¼$ç½®é›¶ç„¶åå¯¹åŸå‡½æ•°çš„åå¯¼æ•°ç½®é›¶;å½“$g(x)=0$æ—¶ä¸æƒ…å†µ2ç›¸è¿‘.ç»“åˆä¸¤ç§æƒ…å†µ,é‚£ä¹ˆåªéœ€è¦ä½¿$L$å¯¹$x$æ±‚å¯¼ä¸ºé›¶,ä½¿$h(x)$ä¸ºé›¶,ä½¿$Î¼g(x)$ä¸ºé›¶ä¸‰å¼å³å¯æ±‚è§£å€™é€‰æœ€ä¼˜å€¼.</li>
</ol>
<h4 id="é™ç»´æ–¹æ³•"><a href="#é™ç»´æ–¹æ³•" class="headerlink" title="é™ç»´æ–¹æ³•"></a><strong>é™ç»´æ–¹æ³•</strong></h4><ol>
<li>ä¸»æˆåˆ†åˆ†æ(PCA):é™ç»´,ä¸æ–­é€‰æ‹©ä¸å·²æœ‰åæ ‡è½´æ­£äº¤ä¸”æ–¹å·®æœ€å¤§çš„åæ ‡è½´.</li>
<li>å¥‡å¼‚å€¼åˆ†è§£(SVD):çŸ©é˜µåˆ†è§£,é™ç»´,æ¨èç³»ç»Ÿ. </li>
<li>çº¿æ€§åˆ¤åˆ«åˆ†æ(LDA)</li>
</ol>
<h4 id="é›†æˆæ–¹æ³•"><a href="#é›†æˆæ–¹æ³•" class="headerlink" title="é›†æˆæ–¹æ³•"></a>é›†æˆæ–¹æ³•</h4><h5 id="bagging"><a href="#bagging" class="headerlink" title="bagging"></a>bagging</h5><p>è£…è¢‹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ„å»ºå¤šä¸ªç›¸äº’ç‹¬ç«‹çš„è¯„ä¼°å™¨ï¼Œç„¶åå¯¹å…¶é¢„æµ‹è¿›è¡Œå¹³å‡æˆ–å¤šæ•°è¡¨å†³åŸåˆ™æ¥å†³å®šé›†æˆè¯„ä¼°å™¨çš„ç»“æœã€‚</p>
<ol>
<li>è¯„ä¼°å™¨ï¼šç›¸äº’ç‹¬ç«‹ï¼ŒåŒæ—¶è¿è¡Œ</li>
<li>æŠ½æ ·ï¼šæœ‰æ”¾å›æŠ½æ ·</li>
<li>å¦‚ä½•å†³å®šé›†æˆçš„ç»“æœï¼šå¹³å‡æˆ–è€…å°‘æ•°æœä»å¤šæ•°</li>
<li>ç›®æ ‡ï¼šé™ä½æ–¹å·®</li>
<li>åŸºå­¦ä¹ å™¨è¿‡æ‹Ÿåˆï¼šèƒ½å¤Ÿä¸€å®šç¨‹åº¦ä¸Šè§£å†³åŸºå­¦ä¹ å™¨è¿‡æ‹Ÿåˆçš„é—®é¢˜</li>
<li>åŸºå­¦ä¹ å™¨å­¦ä¹ èƒ½åŠ›å¼±ï¼šä¸æ˜¯å¾ˆæœ‰å¸®åŠ©</li>
<li>ä»£è¡¨ç®—æ³•ï¼šéšæœºæ£®æ—<h5 id="boosting"><a href="#boosting" class="headerlink" title="boosting"></a>boosting</h5>æå‡æ–¹æ³•ä¸­ï¼ŒåŸºè¯„ä¼°å™¨æ˜¯ç›¸å…³çš„ï¼Œæ˜¯æŒ‰é¡ºåºä¸€ä¸€æ„å»ºçš„ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ç»“åˆå¼±è¯„ä¼°å™¨çš„åŠ›é‡ä¸€æ¬¡æ¬¡å¯¹éš¾ä»¥è¯„ä¼°çš„æ ·æœ¬è¿›è¡Œé¢„æµ‹ï¼Œä»è€Œæ„æˆä¸€ä¸ªå¼ºè¯„ä¼°å™¨ã€‚æå‡æ³•çš„ä»£è¡¨æ¨¡å‹æœ‰Adaboostå’Œæ¢¯åº¦æå‡æ ‘ã€‚</li>
<li>è¯„ä¼°å™¨ï¼šç›¸äº’å…³è”ï¼ŒæŒ‰é¡ºåºä¾æ¬¡æ„å»ºï¼Œåå»ºçš„æ¨¡å‹åœ¨å…ˆå»ºæ¨¡å‹é¢„æµ‹å¤±è´¥çš„æ ·æœ¬ä¸Šæœ‰æ›´å¤šçš„æƒé‡</li>
<li>æŠ½æ ·ï¼šæœ‰æ”¾å›çš„é‡‡æ ·ï¼Œä½†ä¼šç¡®è®¤æ•°æ®çš„æƒé‡ï¼Œæ¯æ¬¡æŠ½æ ·éƒ½ä¼šç»™é¢„æµ‹å¤±è´¥çš„æ ·æœ¬æ›´å¤šçš„æƒé‡</li>
<li>å¦‚ä½•å†³å®šé›†æˆçš„ç»“æœï¼šåŠ æƒå¹³å‡ï¼Œåœ¨è®­ç»ƒé›†ä¸Šè¡¨ç°å¥½çš„æ¨¡å‹ä¼šæœ‰æ›´å¤§çš„æƒé‡</li>
<li>ç›®æ ‡ï¼šé™ä½åå·®ï¼Œæé«˜æ¨¡å‹æ•´ä½“çš„ç²¾ç¡®åº¦</li>
<li>åŸºå­¦ä¹ å™¨è¿‡æ‹Ÿåˆï¼šåŠ å‰§è¿‡æ‹Ÿåˆé—®é¢˜</li>
<li>åŸºå­¦ä¹ å™¨å­¦ä¹ èƒ½åŠ›å¼±ï¼šæå‡æ¨¡å‹è¡¨ç°</li>
<li>ä»£è¡¨ç®—æ³•ï¼šGBDT,Adaboost<h5 id="stacking"><a href="#stacking" class="headerlink" title="stacking"></a>stacking</h5>Stackingæ¨¡å‹æ˜¯æŒ‡å°†å¤šç§åˆ†ç±»å™¨ç»„åˆåœ¨ä¸€èµ·æ¥å–å¾—æ›´å¥½è¡¨ç°çš„ä¸€ç§é›†æˆå­¦ä¹ æ¨¡å‹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒStackingæ¨¡å‹åˆ†ä¸ºä¸¤å±‚ã€‚ç¬¬ä¸€å±‚ä¸­æˆ‘ä»¬è®­ç»ƒå¤šä¸ªä¸åŒçš„æ¨¡å‹ï¼Œç„¶åå†ä»¥ç¬¬ä¸€å±‚è®­ç»ƒçš„å„ä¸ªæ¨¡å‹çš„è¾“å‡ºä½œä¸ºè¾“å…¥æ¥è®­ç»ƒç¬¬äºŒå±‚çš„æ¨¡å‹ï¼Œä»¥å¾—åˆ°ä¸€ä¸ªæœ€ç»ˆçš„è¾“å‡ºã€‚</li>
</ol>
<h4 id="æ€§èƒ½åº¦é‡"><a href="#æ€§èƒ½åº¦é‡" class="headerlink" title="æ€§èƒ½åº¦é‡"></a><strong>æ€§èƒ½åº¦é‡</strong></h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center">é¢„æµ‹å€¼</th>
<th style="text-align:center">é¢„æµ‹å€¼</th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">çœŸå®å€¼</td>
<td style="text-align:center">1</td>
<td style="text-align:center">11</td>
<td style="text-align:center">10</td>
<td style="text-align:center">Recall = $\frac{11}{11+10}$</td>
</tr>
<tr>
<td style="text-align:center">çœŸå®å€¼</td>
<td style="text-align:center">0</td>
<td style="text-align:center">01</td>
<td style="text-align:center">00</td>
<td style="text-align:center">FPR = $\frac{01}{01+00}$</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">Precision=$\frac{11}{11+01}$</td>
<td style="text-align:center"></td>
<td style="text-align:center">Acc = $\frac{11+00}{11+10+01+00}$</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li><strong>å‡†ç¡®åº¦</strong>,æœ€å¸¸ç”¨,ä½†åœ¨æ•°æ®é›†ä¸å¹³è¡¡çš„æƒ…å†µä¸‹ä¸å¥½</li>
<li><strong>Precision(ç²¾ç¡®åº¦/æŸ¥å‡†ç‡)</strong>:$P=TP/(TP+FP)$</li>
<li><strong>Recall(å¬å›ç‡/æŸ¥å…¨ç‡)</strong>:$R=TP/(TP+FN)$</li>
<li><strong>FÎ²åº¦é‡</strong>:$F_{\beta}=\frac{\left(1+\beta^{2}\right) r p}{\beta^{2} * p+r}$,å½“Î²=1æ—¶é€€åŒ–ä¸ºF1åº¦é‡,æ˜¯ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå‡å€¼.</li>
<li><strong>TPR(çœŸæ­£ä¾‹ç‡)</strong>:$TPR=TP/(TP+FN)$</li>
<li><strong>FPR(å‡æ­£ä¾‹ç‡)</strong>:$FPR=FP/(TN+FP)$</li>
<li><strong>PRæ›²çº¿</strong>:çºµè½´ä¸ºPrecision,æ¨ªè½´ä¸ºRecall,ä¸€èˆ¬ä½¿ç”¨å¹³è¡¡ç‚¹(BEP,å³Precsion=Recallçš„ç‚¹)ä½œä¸ºè¡¡é‡æ ‡å‡†.</li>
<li><strong>ROC(æ¥å—è€…æ“ä½œç‰¹å¾)æ›²çº¿</strong>:ï¼ˆ<strong>æ¯åˆ¤æ–­æ­£ç¡®ä¸€ä¸ªå°‘æ•°ç±»ï¼Œå°±æœ‰å¤šå°‘ä¸ªå¤šæ•°ç±»ä¼šè¢«åˆ¤æ–­é”™è¯¯ã€‚</strong>ï¼‰çºµè½´ä¸ºTRP,æ¨ªè½´ä¸ºFPR,åœ¨ç»˜å›¾æ—¶å°†åˆ†ç±»é˜ˆå€¼ä¾æ¬¡è®¾ä¸ºæ¯ä¸ªæ ·ä¾‹çš„é¢„æµ‹å€¼,å†è¿æ¥å„ç‚¹.ROCæ›²çº¿å›´ä½çš„é¢ç§¯ç§°ä¸ºAOC,AOCè¶Šå¤§åˆ™å­¦ä¹ å™¨æ€§èƒ½è¶Šå¥½.</li>
</ol>
<h4 id="æŸå¤±å‡½æ•°å’Œé£é™©å‡½æ•°"><a href="#æŸå¤±å‡½æ•°å’Œé£é™©å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°å’Œé£é™©å‡½æ•°"></a><strong>æŸå¤±å‡½æ•°å’Œé£é™©å‡½æ•°</strong></h4><ol>
<li>æŸå¤±å‡½æ•°åº¦é‡æ¨¡å‹ä¸€æ¬¡é¢„æµ‹çš„å¥½å.å¸¸ç”¨çš„æŸå¤±å‡½æ•°æœ‰:0-1æŸå¤±å‡½æ•°,å¹³æ–¹æŸå¤±å‡½æ•°,ç»å¯¹æŸå¤±å‡½æ•°,å¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°.</li>
<li>æŸå¤±å‡½æ•°çš„æœŸæœ›æ˜¯ç†è®ºä¸Šæ¨¡å‹å…³äºè”åˆåˆ†å¸ƒP(X,Y)çš„å¹³å‡æ„ä¹‰ä¸‹çš„æŸå¤±,ç§°ä¸ºé£é™©å‡½æ•°,ä¹Ÿå«<strong>æœŸæœ›é£é™©</strong>.ä½†æ˜¯è”åˆåˆ†å¸ƒæ˜¯æœªçŸ¥çš„,æœŸæœ›é£é™©ä¸èƒ½ç›´æ¥è®¡ç®—.</li>
<li>å½“æ ·æœ¬å®¹é‡Nè¶‹äºæ— ç©·æ—¶ç»éªŒé£é™©è¶‹äºæœŸæœ›é£é™©,ä½†ç°å®ä¸­è®­ç»ƒæ ·æœ¬æ•°ç›®æœ‰é™.</li>
</ol>
<h4 id="ç»éªŒé£é™©æœ€å°åŒ–å’Œç»“æ„é£é™©æœ€å°åŒ–"><a href="#ç»éªŒé£é™©æœ€å°åŒ–å’Œç»“æ„é£é™©æœ€å°åŒ–" class="headerlink" title="ç»éªŒé£é™©æœ€å°åŒ–å’Œç»“æ„é£é™©æœ€å°åŒ–"></a><strong>ç»éªŒé£é™©æœ€å°åŒ–å’Œç»“æ„é£é™©æœ€å°åŒ–</strong></h4><ol>
<li>æ¨¡å‹å…³äºè®­ç»ƒæ•°æ®é›†çš„å¹³å‡æŸå¤±ç§°ä¸ºç»éªŒé£é™©.ç»éªŒé£é™©æœ€å°åŒ–çš„ç­–ç•¥å°±æ˜¯æœ€å°åŒ–ç»éªŒé£é™©.å½“æ ·æœ¬æ•°é‡è¶³å¤Ÿå¤§æ—¶å­¦ä¹ æ•ˆæœè¾ƒå¥½.æ¯”å¦‚å½“æ¨¡å‹æ˜¯æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ,æŸå¤±å‡½æ•°æ˜¯å¯¹æ•°æŸå¤±å‡½æ•°æ—¶,ç»éªŒé£é™©æœ€å°åŒ–å°±ç­‰ä»·äºæå¤§ä¼¼ç„¶ä¼°è®¡.ä½†æ˜¯å½“æ ·æœ¬å®¹é‡å¾ˆå°æ—¶ä¼šå‡ºç°è¿‡æ‹Ÿåˆ.</li>
<li>ç»“æ„é£é™©æœ€å°åŒ–ç­‰äºæ­£åˆ™åŒ–.ç»“æ„é£é™©åœ¨ç»éªŒé£é™©ä¸ŠåŠ ä¸Šè¡¨ç¤ºæ¨¡å‹å¤æ‚åº¦çš„æ­£åˆ™åŒ–é¡¹.æ¯”å¦‚å½“æ¨¡å‹æ˜¯æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ,æŸå¤±å‡½æ•°æ˜¯å¯¹æ•°æŸå¤±å‡½æ•°,æ¨¡å‹å¤æ‚åº¦ç”±æ¨¡å‹çš„å…ˆéªŒæ¦‚ç‡è¡¨ç¤ºæ—¶,ç»“æ„é£é™©æœ€å°åŒ–å°±ç­‰ä»·äºæœ€å¤§åéªŒæ¦‚ç‡ä¼°è®¡.</li>
</ol>
<h4 id="è¿‡æ‹Ÿåˆ"><a href="#è¿‡æ‹Ÿåˆ" class="headerlink" title="è¿‡æ‹Ÿåˆ"></a><strong>è¿‡æ‹Ÿåˆ</strong></h4><p>æŒ‡å­¦ä¹ æ—¶é€‰æ‹©çš„æ¨¡å‹æ‰€åŒ…å«çš„å‚æ•°è¿‡å¤š,ä»¥è‡´äºå¯¹å·²çŸ¥æ•°æ®é¢„æµ‹å¾—å¾ˆå¥½,ä½†å¯¹æœªçŸ¥æ•°æ®é¢„æµ‹å¾ˆå·®çš„ç°è±¡.æ¨¡å‹é€‰æ‹©æ—¨åœ¨é¿å…è¿‡æ‹Ÿåˆå¹¶æé«˜æ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›.</p>
<h4 id="æ­£åˆ™åŒ–"><a href="#æ­£åˆ™åŒ–" class="headerlink" title="æ­£åˆ™åŒ–"></a><strong>æ­£åˆ™åŒ–</strong></h4><p>æ¨¡å‹é€‰æ‹©çš„å…¸å‹æ–¹æ³•.æ­£åˆ™åŒ–é¡¹ä¸€èˆ¬æ˜¯æ¨¡å‹å¤æ‚åº¦çš„å•è°ƒé€’å¢å‡½æ•°,æ¯”å¦‚æ¨¡å‹å‚æ•°å‘é‡çš„èŒƒæ•°.</p>
<h4 id="äº¤å‰éªŒè¯"><a href="#äº¤å‰éªŒè¯" class="headerlink" title="äº¤å‰éªŒè¯"></a><strong>äº¤å‰éªŒè¯</strong></h4><p>æ˜¯å¦ä¸€å¸¸ç”¨çš„æ¨¡å‹é€‰æ‹©æ–¹æ³•,å¯åˆ†ä¸ºç®€å•äº¤å‰éªŒè¯,KæŠ˜äº¤å‰éªŒè¯,ç•™ä¸€äº¤å‰éªŒè¯ç­‰.</p>
<h4 id="sklearn"><a href="#sklearn" class="headerlink" title="sklearn"></a>sklearn</h4><p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/sklearn.png" alt="avatar"></p>
<h3 id="æ„ŸçŸ¥æœº"><a href="#æ„ŸçŸ¥æœº" class="headerlink" title="æ„ŸçŸ¥æœº"></a>æ„ŸçŸ¥æœº</h3><p>æ„ŸçŸ¥æœºæ˜¯<strong>äºŒç±»åˆ†ç±»</strong>çš„çº¿æ€§æ¨¡å‹,å±äºåˆ¤åˆ«æ¨¡å‹.æ„ŸçŸ¥æœºå­¦ä¹ æ—¨åœ¨æ±‚å‡ºå°†è®­ç»ƒæ•°æ®è¿›è¡Œçº¿æ€§åˆ’åˆ†çš„åˆ†ç¦»è¶…å¹³é¢.æ˜¯ç¥ç»ç½‘ç»œå’Œæ”¯æŒå‘é‡æœºçš„åŸºç¡€.</p>
<h4 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p>$f(x)=sign(wx + b)$,$w$å«ä½œæƒå€¼å‘é‡,$b$å«åšåç½®,$sign$æ˜¯ç¬¦å·å‡½æ•°.</p>
<h4 id="æ„ŸçŸ¥æœºçš„å‡ ä½•è§£é‡Š"><a href="#æ„ŸçŸ¥æœºçš„å‡ ä½•è§£é‡Š" class="headerlink" title="æ„ŸçŸ¥æœºçš„å‡ ä½•è§£é‡Š"></a><strong>æ„ŸçŸ¥æœºçš„å‡ ä½•è§£é‡Š</strong></h4><p>$wx+b$å¯¹åº”äºç‰¹å¾ç©ºé—´ä¸­çš„ä¸€ä¸ªåˆ†ç¦»è¶…å¹³é¢S,å…¶ä¸­$w$æ˜¯$S$çš„æ³•å‘é‡,$b$æ˜¯$S$çš„æˆªè·.$S$å°†ç‰¹å¾ç©ºé—´åˆ’åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†,ä½äºä¸¤ä¸ªéƒ¨åˆ†çš„ç‚¹åˆ†åˆ«è¢«åˆ†ä¸ºæ­£è´Ÿä¸¤ç±».</p>
<h4 id="ç­–ç•¥"><a href="#ç­–ç•¥" class="headerlink" title="ç­–ç•¥"></a>ç­–ç•¥</h4><p>å‡è®¾è®­ç»ƒæ•°æ®é›†æ˜¯çº¿æ€§å¯åˆ†çš„,æ„ŸçŸ¥æœºçš„æŸå¤±å‡½æ•°æ˜¯è¯¯åˆ†ç±»ç‚¹åˆ°è¶…å¹³é¢$S$çš„æ€»è·ç¦».å› ä¸ºè¯¯åˆ†ç±»ç‚¹åˆ°è¶…å¹³é¢$S$çš„è·ç¦»æ˜¯$\frac{1}{|w|}\left|w \cdot x_{0}+b\right|$,ä¸”å¯¹äºè¯¯åˆ†ç±»çš„æ•°æ®æ¥è¯´,æ€»æœ‰$-y_i(wx_i+b)&gt;0$æˆç«‹,å› æ­¤ä¸è€ƒè™‘$\frac{1}{|w|}$,å°±å¾—åˆ°æ„ŸçŸ¥æœºçš„æŸå¤±å‡½æ•°:</p>
<p>$L(w, b)=-\sum_{x \in M} y_{i}\left(w \cdot x_{i}+b\right)$,å…¶ä¸­Mæ˜¯è¯¯åˆ†ç±»ç‚¹çš„é›†åˆ.æ„ŸçŸ¥æœºå­¦ä¹ çš„ç­–ç•¥å°±æ˜¯é€‰å–ä½¿æŸå¤±å‡½æ•°æœ€å°çš„æ¨¡å‹å‚æ•°.</p>
<h4 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h4><p>æ„ŸçŸ¥æœºçš„æœ€ä¼˜åŒ–æ–¹æ³•é‡‡ç”¨<strong>éšæœºæ¢¯åº¦ä¸‹é™æ³•</strong>.é¦–å…ˆä»»æ„é€‰å–ä¸€ä¸ªè¶…å¹³é¢$w_0,b_0$,ç„¶åä¸æ–­åœ°æå°åŒ–ç›®æ ‡å‡½æ•°.åœ¨æå°åŒ–è¿‡ç¨‹ä¸­ä¸€æ¬¡éšæœºé€‰å–ä¸€ä¸ªè¯¯åˆ†ç±»ç‚¹æ›´æ–°$w,b$,ç›´åˆ°æŸå¤±å‡½æ•°ä¸º0.$w \leftarrow w+\eta y_{i} x_{i}$ ï¼Œ $b \leftarrow b+\eta y_{i}$ï¼Œå…¶ä¸­$Î·$è¡¨ç¤ºæ­¥é•¿.è¯¥ç®—æ³•çš„ç›´è§‚è§£é‡Šæ˜¯:å½“ä¸€ä¸ªç‚¹è¢«è¯¯åˆ†ç±»,å°±è°ƒæ•´$w,b$ä½¿åˆ†ç¦»è¶…å¹³é¢å‘è¯¥è¯¯åˆ†ç±»ç‚¹æ¥è¿‘.æ„ŸçŸ¥æœºçš„è§£å¯ä»¥ä¸åŒ.</p>
<h4 id="å¯¹å¶å½¢å¼"><a href="#å¯¹å¶å½¢å¼" class="headerlink" title="å¯¹å¶å½¢å¼"></a><strong>å¯¹å¶å½¢å¼</strong></h4><p>å‡è®¾åŸå§‹å½¢å¼ä¸­çš„$w_0$å’Œ$b_0$å‡ä¸º0,è®¾é€æ­¥ä¿®æ”¹$w$å’Œ$b$å…±næ¬¡,ä»¤$a=nÎ·$,æœ€åå­¦ä¹ åˆ°çš„$w,b$å¯ä»¥è¡¨ç¤ºä¸º$w =\sum_{i=1}^{N} \alpha_{i} y_{i} x_{i}$,$b =\sum_{i=1}^{N}{\alpha_{i} y_{i}}$ ,é‚£ä¹ˆå¯¹å¶ç®—æ³•å°±å˜ä¸ºè®¾åˆå§‹$a$å’Œ$b$å‡ä¸º0,æ¯æ¬¡é€‰å–æ•°æ®æ›´æ–°$a$å’Œ$b$ç›´è‡³æ²¡æœ‰è¯¯åˆ†ç±»ç‚¹ä¸ºæ­¢.å¯¹å¶å½¢å¼çš„æ„ä¹‰åœ¨äºå¯ä»¥å°†è®­ç»ƒé›†ä¸­å®ä¾‹é—´çš„å†…ç§¯è®¡ç®—å‡ºæ¥,å­˜åœ¨GramçŸ©é˜µä¸­,å¯ä»¥å¤§å¤§åŠ å¿«è®­ç»ƒé€Ÿåº¦.</p>
<h3 id="kè¿‘é‚»æ³•"><a href="#kè¿‘é‚»æ³•" class="headerlink" title="kè¿‘é‚»æ³•"></a>kè¿‘é‚»æ³•</h3><p>kè¿‘é‚»æ³•æ ¹æ®å…¶<strong>kä¸ªæœ€è¿‘é‚»</strong>çš„è®­ç»ƒå®ä¾‹çš„ç±»åˆ«,é€šè¿‡å¤šæ•°è¡¨å†³ç­‰æ–¹å¼è¿›è¡Œé¢„æµ‹.å½“k=1æ—¶ç§°ä¸ºæœ€è¿‘é‚»ç®—æ³•.</p>
<h4 id="ä¸‰ä¸ªåŸºæœ¬è¦ç´ "><a href="#ä¸‰ä¸ªåŸºæœ¬è¦ç´ " class="headerlink" title="ä¸‰ä¸ªåŸºæœ¬è¦ç´ :"></a>ä¸‰ä¸ªåŸºæœ¬è¦ç´ :</h4><ol>
<li>kå€¼çš„é€‰æ‹©</li>
<li>è·ç¦»åº¦é‡</li>
<li>åˆ†ç±»å†³ç­–è§„åˆ™</li>
</ol>
<h4 id="æ¨¡å‹-1"><a href="#æ¨¡å‹-1" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p>å½“è®­ç»ƒé›†,è·ç¦»åº¦é‡,kå€¼ä»¥åŠåˆ†ç±»å†³ç­–è§„åˆ™ç¡®å®šå,ç‰¹å¾ç©ºé—´å·²ç»æ ¹æ®è¿™äº›è¦ç´ è¢«åˆ’åˆ†ä¸ºä¸€äº›å­ç©ºé—´,ä¸”å­ç©ºé—´é‡Œæ¯ä¸ªç‚¹æ‰€å±çš„ç±»ä¹Ÿå·²è¢«ç¡®å®š.</p>
<h4 id="ç­–ç•¥-1"><a href="#ç­–ç•¥-1" class="headerlink" title="ç­–ç•¥"></a><strong>ç­–ç•¥</strong></h4><ol>
<li><strong>è·ç¦»</strong>:ç‰¹å¾ç©ºé—´ä¸­ä¸¤ä¸ªå®ä¾‹ç‚¹çš„è·ç¦»æ˜¯ç›¸ä¼¼ç¨‹åº¦çš„åæ˜ ,kè¿‘é‚»ç®—æ³•ä¸€èˆ¬ä½¿ç”¨æ¬§æ°è·ç¦»,ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´ä¸€èˆ¬çš„Lpè·ç¦»æˆ–Minkowskiè·ç¦».</li>
<li><strong>kå€¼</strong>:kå€¼è¾ƒå°æ—¶,æ•´ä½“æ¨¡å‹å˜å¾—å¤æ‚,å®¹æ˜“å‘ç”Ÿè¿‡æ‹Ÿåˆ.kå€¼è¾ƒå¤§æ—¶,æ•´ä½“æ¨¡å‹å˜å¾—ç®€å•.åœ¨åº”ç”¨ä¸­kä¸€èˆ¬å–è¾ƒå°çš„å€¼,é€šè¿‡äº¤å‰éªŒè¯æ³•é€‰å–æœ€ä¼˜çš„k.</li>
<li><p><strong>åˆ†ç±»å†³ç­–è§„åˆ™</strong>:kè¿‘é‚»ä¸­çš„åˆ†ç±»å†³ç­–è§„åˆ™å¾€å¾€æ˜¯å¤šæ•°è¡¨å†³,å¤šæ•°è¡¨å†³è§„åˆ™ç­‰ä»·äºç»éªŒé£é™©æœ€å°åŒ–.</p>
<h4 id="ç®—æ³•-1"><a href="#ç®—æ³•-1" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h4></li>
</ol>
<p>æ ¹æ®ç»™å®šçš„è·ç¦»åº¦é‡,åœ¨è®­ç»ƒé›†ä¸­æ‰¾å‡ºä¸xæœ€é‚»è¿‘çš„kä¸ªç‚¹,æ ¹æ®åˆ†ç±»è§„åˆ™å†³å®šxçš„ç±»åˆ«y.</p>
<p><strong>kdæ ‘</strong></p>
<ol>
<li><p>kdæ ‘å°±æ˜¯ä¸€ç§å¯¹kç»´ç©ºé—´ä¸­çš„å®ä¾‹ç‚¹è¿›è¡Œå­˜å‚¨ä»¥ä¾¿å¯¹å…¶è¿›è¡Œå¿«é€Ÿæ£€ç´¢çš„æ ‘å½¢æ•°æ®ç»“æ„.kdæ ‘æ›´é€‚ç”¨äº<strong>è®­ç»ƒå®ä¾‹æ•°è¿œå¤§äºç©ºé—´ç»´æ•°</strong>æ—¶çš„kè¿‘é‚»æœç´¢.</p>
</li>
<li><p><strong>æ„é€ </strong>:å¯ä»¥é€šè¿‡å¦‚ä¸‹<strong>é€’å½’</strong>å®ç°:åœ¨è¶…çŸ©å½¢åŒºåŸŸä¸Šé€‰æ‹©ä¸€ä¸ª<strong>åæ ‡è½´</strong>å’Œæ­¤åæ ‡è½´ä¸Šçš„ä¸€ä¸ª<strong>åˆ‡åˆ†ç‚¹</strong>,ç¡®å®šä¸€ä¸ªè¶…å¹³é¢,è¯¥è¶…å¹³é¢å°†å½“å‰è¶…çŸ©å½¢åŒºåŸŸåˆ‡åˆ†ä¸ºä¸¤ä¸ªå­åŒºåŸŸ.åœ¨å­åŒºåŸŸä¸Šé‡å¤åˆ‡åˆ†ç›´åˆ°å­åŒºåŸŸå†…æ²¡æœ‰å®ä¾‹æ—¶ç»ˆæ­¢.é€šå¸¸ä¾æ¬¡é€‰æ‹©åæ ‡è½´å’Œé€‰å®šåæ ‡è½´ä¸Šçš„<strong>ä¸­ä½æ•°ç‚¹</strong>ä¸ºåˆ‡åˆ†ç‚¹,è¿™æ ·å¯ä»¥å¾—åˆ°å¹³è¡¡kdæ ‘.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/kd_tree.png" alt="avatar"></p>
</li>
</ol>
<h4 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a><strong>æœç´¢</strong></h4><p>ä»æ ¹èŠ‚ç‚¹å‡ºå‘,è‹¥ç›®æ ‡ç‚¹xå½“å‰ç»´çš„åæ ‡å°äºåˆ‡åˆ†ç‚¹çš„åæ ‡åˆ™ç§»åŠ¨åˆ°å·¦å­ç»“ç‚¹,å¦åˆ™ç§»åŠ¨åˆ°å³å­ç»“ç‚¹,ç›´åˆ°å­ç»“ç‚¹ä¸ºå¶ç»“ç‚¹ä¸ºæ­¢.ä»¥æ­¤å¶ç»“ç‚¹ä¸ºâ€å½“å‰æœ€è¿‘ç‚¹â€,<strong>é€’å½’</strong>åœ°å‘ä¸Šå›é€€,åœ¨æ¯ä¸ªç»“ç‚¹:(a)å¦‚æœè¯¥ç»“ç‚¹æ¯”å½“å‰æœ€è¿‘ç‚¹è·ç¦»ç›®æ ‡ç‚¹æ›´è¿‘,åˆ™ä»¥è¯¥ç»“ç‚¹ä¸ºâ€å½“å‰æœ€è¿‘ç‚¹â€(b)â€å½“å‰æœ€è¿‘ç‚¹â€ä¸€å®šå­˜åœ¨äºè¯¥ç»“ç‚¹ä¸€ä¸ªå­ç»“ç‚¹å¯¹åº”çš„åŒºåŸŸ,æ£€æŸ¥è¯¥ç»“ç‚¹çš„å¦ä¸€å­ç»“ç‚¹å¯¹åº”çš„åŒºåŸŸæ˜¯å¦ä¸ä»¥ç›®æ ‡ç‚¹ä¸ºçƒå¿ƒ,ä»¥ç›®æ ‡ç‚¹ä¸â€å½“å‰æœ€è¿‘ç‚¹â€é—´çš„è·ç¦»ä¸ºåŠå¾„çš„è¶…çƒä½“ç›¸äº¤.å¦‚æœç›¸äº¤,ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå­ç»“ç‚¹,å¦‚æœä¸ç›¸äº¤,å‘ä¸Šå›é€€.æŒç»­è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°å›é€€åˆ°æ ¹ç»“ç‚¹,æœ€åçš„â€å½“å‰æœ€è¿‘ç‚¹â€å³ä¸ºæœ€è¿‘é‚»ç‚¹.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/search_kd.png" alt="avatar"></p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/search_kd_2.png" alt="avatar"></p>
<h3 id="æœ´ç´ è´å¶æ–¯"><a href="#æœ´ç´ è´å¶æ–¯" class="headerlink" title="æœ´ç´ è´å¶æ–¯"></a>æœ´ç´ è´å¶æ–¯</h3><p>æœ´ç´ è´å¶æ–¯æ˜¯åŸºäº<strong>è´å¶æ–¯å®šç†</strong>å’Œ<strong>ç‰¹å¾æ¡ä»¶ç‹¬ç«‹å‡è®¾</strong>çš„åˆ†ç±»æ–¹æ³•.é¦–å…ˆå­¦ä¹ è¾“å…¥/è¾“å‡ºçš„è”åˆæ¦‚ç‡åˆ†å¸ƒ,ç„¶ååŸºäºæ­¤æ¨¡å‹,å¯¹ç»™å®šçš„è¾“å…¥x,åˆ©ç”¨è´å¶æ–¯å®šç†æ±‚å‡ºåéªŒæ¦‚ç‡æœ€å¤§çš„è¾“å‡ºy.å±äºç”Ÿæˆæ¨¡å‹.</p>
<h4 id="æ¨¡å‹-2"><a href="#æ¨¡å‹-2" class="headerlink" title="æ¨¡å‹"></a><strong>æ¨¡å‹</strong></h4><ol>
<li>é¦–å…ˆå­¦ä¹ å…ˆéªŒæ¦‚ç‡åˆ†å¸ƒ$p(c_k),k=1,2,3,4,â€¦,k$</li>
<li>ç„¶åå­¦ä¹ æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ,$P\left(X=x | Y=c_{k}\right)=P\left(X^{(1)}=x^{(1)}, \cdots, X^{(n)}=x^{(n)} | Y=c_{k}\right)$.å¦‚æœä¼°è®¡å®é™…,éœ€è¦æŒ‡æ•°çº§çš„è®¡ç®—,æ‰€ä»¥æœ´ç´ è´å¶æ–¯æ³•å¯¹æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒä½œäº†æ¡ä»¶ç‹¬ç«‹æ€§çš„å‡è®¾,ä¸Šå¼å˜æˆ$\prod_{j=1}^{n} P\left(X^{(n)}=x^{(n)} | Y=c_{k}\right)$</li>
<li>åœ¨åˆ†ç±»æ—¶,é€šè¿‡å­¦ä¹ åˆ°çš„æ¨¡å‹è®¡ç®—åéªŒæ¦‚ç‡åˆ†å¸ƒ,ç”±è´å¶æ–¯å®šç†å¾—åˆ°$P\left(Y=c_{k} | X=x\right)=\frac{P\left(X=x | Y=c_{k}\right) P\left(Y=c_{k}\right)}{\sum_{k} P\left(X=x | Y=c_{k}\right) P\left(Y=c_{k}\right)}$</li>
<li>å°†æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾å¾—åˆ°çš„ç­‰å¼ä»£å…¥,å¹¶ä¸”æ³¨æ„åˆ°åˆ†æ¯éƒ½æ˜¯ç›¸åŒçš„,æ‰€ä»¥å¾—åˆ°æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨:$y=\arg \max _{a_{k}} P\left(Y=c_{k}\right) \prod_{j} P\left(X^{(l)}=x^{(l)} | Y=c_{k}\right)$</li>
</ol>
<p>æœ´ç´ è´å¶æ–¯å°†å®ä¾‹åˆ†åˆ°åéªŒæ¦‚ç‡æœ€å¤§çš„ç±»ä¸­,è¿™ç­‰ä»·äºæœŸæœ›é£é™©æœ€å°åŒ–.</p>
<h4 id="ç®—æ³•-2"><a href="#ç®—æ³•-2" class="headerlink" title="ç®—æ³•"></a><strong>ç®—æ³•</strong></h4><ol>
<li>ä½¿ç”¨<strong>æå¤§ä¼¼ç„¶ä¼°è®¡æ³•</strong>ä¼°è®¡ç›¸åº”çš„å…ˆéªŒæ¦‚ç‡:$P\left(Y=c_{k}\right)=\frac{\sum_{i=1}^{N} I\left(y_{i}=c_{k}\right)}{N}, \quad k=1,2, \cdots, K$å’Œæ¡ä»¶æ¦‚ç‡$P\left(X^{(j)}=a_{n} | Y=c_{k}\right)=\frac{\sum_{i=1}^{N} I\left(x_{i}^{(n)}=a_{j i} y_{i}=c_{k}\right)}{\sum_{i=1}^{N} I\left(y_{i}=c_{k}\right)}$</li>
<li>è®¡ç®—æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾ä¸‹çš„å®ä¾‹å„ä¸ªå–å€¼çš„å¯èƒ½æ€§,$P\left(Y=c_{k}\right) \prod_{j=1}^{n} P\left(X^{(j)}=x^{(j)} | Y=c_{k}\right), \quad k=1,2, \cdots, K$</li>
<li>é€‰å–å…¶ä¸­çš„æœ€å¤§å€¼ä½œä¸ºè¾“å‡º.</li>
</ol>
<h4 id="ç‰¹æ®Šæƒ…å†µ"><a href="#ç‰¹æ®Šæƒ…å†µ" class="headerlink" title="ç‰¹æ®Šæƒ…å†µ"></a>ç‰¹æ®Šæƒ…å†µ</h4><ol>
<li>ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡å¯èƒ½ä¼šå‡ºç°æ‰€è¦ä¼°è®¡çš„æ¦‚ç‡å€¼ä¸º0çš„æƒ…å†µ,åœ¨ç´¯ä¹˜åä¼šå½±å“åéªŒæ¦‚ç‡çš„è®¡ç®—ç»“æœ,ä½¿åˆ†ç±»äº§ç”Ÿåå·®.å¯ä»¥é‡‡ç”¨<strong>è´å¶æ–¯ä¼°è®¡</strong>,åœ¨éšæœºå˜é‡å„ä¸ªå–å€¼çš„é¢‘æ•°ä¸Šèµ‹äºˆä¸€ä¸ªæ­£æ•°.$P_{\lambda}\left(X^{(1)}=a_{j q} | Y=c_{k}\right)=\frac{\sum_{i=1}^{N} I\left(x_{i}^{(l)}=a_{\beta}, y_{i}=c_{k}\right)+\lambda}{\sum_{i=1}^{N} I\left(y_{i}=c_{k}\right)+S_{j} \lambda}$ï¼Œ$S_j$ä¸ºjå±æ€§å¯èƒ½å–å€¼æ•°é‡,å½“$Î»=0$æ—¶å°±æ˜¯æå¤§ä¼¼ç„¶ä¼°è®¡.å¸¸å–$Î»=1$,ç§°ä¸º<strong>æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘</strong>.</li>
<li>å¦‚æœæ˜¯è¿ç»­å€¼çš„æƒ…å†µ,å¯ä»¥å‡è®¾è¿ç»­å˜é‡æœä»é«˜æ–¯åˆ†å¸ƒ,ç„¶åç”¨è®­ç»ƒæ•°æ®ä¼°è®¡å‚æ•°.$P\left(X_{i}=x_{i} | Y=y_{i}\right)=\frac{1}{\sqrt{2 \pi} \sigma_{i j}^{2}} e^{\frac{\left(x_{i}-\mu_{j}\right)^{2}}{2 \sigma_{i}^{2}}}$</li>
</ol>
<h3 id="å†³ç­–æ ‘"><a href="#å†³ç­–æ ‘" class="headerlink" title="å†³ç­–æ ‘"></a>å†³ç­–æ ‘</h3><p>å†³ç­–æ ‘æ˜¯ä¸€ç§åŸºæœ¬çš„åˆ†ç±»ä¸å›å½’æ–¹æ³•.å®ƒå¯ä»¥è®¤ä¸ºæ˜¯<strong>if-thenè§„åˆ™</strong>çš„é›†åˆ,ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯å®šä¹‰åœ¨ç‰¹å¾ç©ºé—´ä¸ç±»ç©ºé—´ä¸Šçš„<strong>æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ</strong>.ä¸»è¦ä¼˜ç‚¹æ˜¯æ¨¡å‹å…·æœ‰å¯è¯»æ€§,åˆ†ç±»é€Ÿåº¦å¿«.å…¶ä¸»è¦å›´ç»•ç€ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>å¦‚ä½•ä»æ•°æ®è¡¨ä¸­æ‰¾å‡ºæœ€ä½³èŠ‚ç‚¹å’Œæœ€ä½³åˆ†æï¼Ÿ</li>
<li>å¦‚ä½•è®©å†³ç­–æ ‘åœæ­¢ç”Ÿé•¿ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆï¼Ÿ</li>
</ol>
<h4 id="æ¨¡å‹-3"><a href="#æ¨¡å‹-3" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p>åˆ†ç±»å†³ç­–æ ‘ç”±<strong>ç»“ç‚¹</strong>å’Œ<strong>æœ‰å‘è¾¹</strong>ç»„æˆ.ç»“ç‚¹åˆ†ä¸º<strong>å†…éƒ¨ç»“ç‚¹</strong>(è¡¨ç¤ºä¸€ä¸ªç‰¹å¾æˆ–å±æ€§)å’Œ<strong>å¶ç»“ç‚¹</strong>(è¡¨ç¤ºä¸€ä¸ªç±»).å†³ç­–æ ‘çš„è·¯å¾„å…·æœ‰<strong>äº’æ–¥ä¸”å®Œå¤‡</strong>çš„æ€§è´¨.</p>
<h4 id="ç­–ç•¥-2"><a href="#ç­–ç•¥-2" class="headerlink" title="ç­–ç•¥"></a>ç­–ç•¥</h4><p>å†³ç­–æ ‘å­¦ä¹ æœ¬è´¨ä¸Šæ˜¯ä»è®­ç»ƒæ•°æ®é›†ä¸­å½’çº³å‡ºä¸€ç»„åˆ†ç±»è§„åˆ™.æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªä¸è®­ç»ƒæ•°æ®<strong>çŸ›ç›¾è¾ƒå°</strong>,åŒæ—¶å…·æœ‰å¾ˆå¥½çš„<strong>æ³›åŒ–èƒ½åŠ›</strong>çš„å†³ç­–æ ‘.ä»æ‰€æœ‰å¯èƒ½çš„å†³ç­–æ ‘ä¸­é€‰å–æœ€ä¼˜å†³ç­–æ ‘æ˜¯NPå®Œå…¨é—®é¢˜,æ‰€ä»¥ç°å®ä¸­å¸¸é‡‡ç”¨<strong>å¯å‘å¼æ–¹æ³•</strong>è¿‘ä¼¼æ±‚è§£.</p>
<h4 id="ç®—æ³•-3"><a href="#ç®—æ³•-3" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h4><p>å†³ç­–æ ‘å­¦ä¹ ç®—æ³•åŒ…å«<strong>ç‰¹å¾é€‰æ‹©</strong>,<strong>å†³ç­–æ ‘çš„ç”Ÿæˆ</strong>ä¸<strong>å†³ç­–æ ‘çš„å‰ªæè¿‡ç¨‹</strong>.ç”Ÿæˆåªè€ƒè™‘å±€éƒ¨æœ€ä¼˜,å‰ªæåˆ™è€ƒè™‘å…¨å±€æœ€ä¼˜ã€‚</p>
<h4 id="ç‰¹å¾é€‰æ‹©"><a href="#ç‰¹å¾é€‰æ‹©" class="headerlink" title="ç‰¹å¾é€‰æ‹©"></a>ç‰¹å¾é€‰æ‹©</h4><p>å¦‚æœåˆ©ç”¨ä¸€ä¸ªç‰¹å¾è¿›è¡Œåˆ†ç±»çš„ç»“æœä¸éšæœºåˆ†ç±»çš„ç»“æœæ²¡æœ‰å¾ˆå¤§å·®åˆ«,åˆ™ç§°è¿™ä¸ªç‰¹å¾æ˜¯<strong>æ²¡æœ‰åˆ†ç±»èƒ½åŠ›</strong>çš„.æ‰”æ‰è¿™æ ·çš„ç‰¹å¾å¯¹å†³ç­–æ ‘å­¦ä¹ çš„ç²¾åº¦å½±å“ä¸å¤§.</p>
<ol>
<li><strong>ä¿¡æ¯ç†µ</strong>ï¼šç†µæ˜¯è¡¡é‡<strong>éšæœºå˜é‡ä¸ç¡®å®šæ€§</strong>çš„åº¦é‡.ç†µè¶Šå¤§,éšæœºå˜é‡çš„ä¸ç¡®å®šæ€§å°±è¶Šå¤§.ä¿¡æ¯ç†µæ˜¯ä¿¡æ¯é‡çš„æœŸæœ›ï¼Œ$\left.H(X)=-\sum_{x \in X} P(x) \log P(x)\right)$</li>
<li><strong>æ¡ä»¶ç†µ</strong>ï¼šæ¡ä»¶ç†µè¡¨ç¤ºåœ¨å·²çŸ¥éšæœºå˜é‡Xçš„æ¡ä»¶ä¸‹éšæœºå˜é‡Yçš„ä¸ç¡®å®šæ€§.$H(Y | X)=\sum_{i=1}^{n} p_{i} H\left(Y | X=x_{i}\right)$</li>
<li><strong>ä¿¡æ¯å¢ç›Š</strong>ï¼šè¡¨ç¤ºå¾—çŸ¥ç‰¹å¾Xçš„ä¿¡æ¯è€Œä½¿å¾—ç±»Yçš„ä¿¡æ¯çš„<strong>ä¸ç¡®å®šæ€§å‡å°‘</strong>çš„ç¨‹åº¦.å®šä¹‰ä¸ºé›†åˆDçš„ç»éªŒç†µä¸ç‰¹å¾Aåœ¨ç»™å®šæ¡ä»¶ä¸‹Dçš„ç»éªŒæ¡ä»¶ç†µä¹‹å·®$g(D,A)=H(D)-H(D|A)$,ä¹Ÿå°±æ˜¯è®­ç»ƒæ•°æ®é›†ä¸­ç±»ä¸ç‰¹å¾çš„<strong>äº’ä¿¡æ¯</strong>.</li>
<li><strong>ä¿¡æ¯å¢ç›Šç®—æ³•</strong>:è®¡ç®—æ•°æ®é›†Dçš„ç»éªŒç†µ$H(D)=-\sum_{k=1}^{K} \frac{\left|C_{k}\right|_{\mathrm{log}_{2}}\left|C_{k}\right|}{|D|}$,è®¡ç®—ç‰¹å¾Aå¯¹æ•°æ®é›†Dçš„ç»éªŒæ¡ä»¶ç†µ$H(D | A)=\sum_{i=1}^{n} \frac{\left|D_{i}\right|}{|D|} H\left(D_{i}\right)=-\sum_{i=1}^{n} \frac{\left|D_{i}\right|}{|D|} \sum_{k=1}^{K} \frac{\left|D_{\mu}\right|}{\left|D_{i}\right|} \log _{2} \frac{\left|D_{k}\right|}{\left|D_{i}\right|}$,è®¡ç®—ä¿¡æ¯å¢ç›Š,é€‰å–ä¿¡æ¯å¢ç›Šæœ€å¤§çš„ç‰¹å¾.</li>
<li><strong>ä¿¡æ¯å¢ç›Šæ¯”</strong>:ä¿¡æ¯å¢ç›Šå€¼çš„å¤§å°æ˜¯ç›¸å¯¹äºè®­ç»ƒæ•°æ®é›†è€Œè¨€çš„,å¹¶æ— ç»å¯¹æ„ä¹‰.ä½¿ç”¨ä¿¡æ¯å¢ç›Šæ¯”,$g_{R}(D, A)=\frac{g(D, A)}{H(D)}$å¯ä»¥å¯¹è¿™ä¸€é—®é¢˜è¿›è¡Œæ ¡æ­£.</li>
</ol>
<h4 id="å†³ç­–æ ‘çš„ç”Ÿæˆ"><a href="#å†³ç­–æ ‘çš„ç”Ÿæˆ" class="headerlink" title="å†³ç­–æ ‘çš„ç”Ÿæˆ"></a><strong>å†³ç­–æ ‘çš„ç”Ÿæˆ</strong></h4><ol>
<li><strong>ID3ç®—æ³•</strong>:æ ¸å¿ƒæ˜¯åœ¨å†³ç­–æ ‘å„ä¸ªç»“ç‚¹ä¸Šåº”ç”¨<strong>ä¿¡æ¯å¢ç›Šå‡†åˆ™</strong>é€‰æ‹©ä¿¡æ¯å¢ç›Šæœ€å¤§ä¸”å¤§äºé˜ˆå€¼çš„ç‰¹å¾,é€’å½’åœ°æ„å»ºå†³ç­–æ ‘.ID3ç›¸å½“äºç”¨æå¤§ä¼¼ç„¶æ³•è¿›è¡Œæ¦‚ç‡æ¨¡å‹çš„é€‰æ‹©.ç”±äºç®—æ³•åªæœ‰æ ‘çš„ç”Ÿæˆ,æ‰€ä»¥å®¹æ˜“äº§ç”Ÿè¿‡æ‹Ÿåˆ.</li>
<li><strong>C4.5ç®—æ³•</strong>:C4.5ç®—æ³•ä¸ID3ç®—æ³•ç›¸ä¼¼,æ”¹ç”¨<strong>ä¿¡æ¯å¢ç›Šæ¯”</strong>æ¥é€‰æ‹©ç‰¹å¾.</li>
</ol>
<h4 id="å†³ç­–æ ‘çš„å‰ªæ"><a href="#å†³ç­–æ ‘çš„å‰ªæ" class="headerlink" title="å†³ç­–æ ‘çš„å‰ªæ"></a><strong>å†³ç­–æ ‘çš„å‰ªæ</strong></h4><ol>
<li>åœ¨å­¦ä¹ æ—¶è¿‡å¤šè€ƒè™‘å¦‚ä½•æé«˜å¯¹è®­ç»ƒæ•°æ®çš„æ­£ç¡®åˆ†ç±»,ä»è€Œæ„å»ºå‡ºè¿‡äºå¤æ‚çš„å†³ç­–æ ‘,äº§ç”Ÿ<strong>è¿‡æ‹Ÿåˆ</strong>ç°è±¡.è§£å†³æ–¹æ³•æ˜¯å¯¹å·²ç”Ÿæˆçš„å†³ç­–æ ‘è¿›è¡Œç®€åŒ–,ç§°ä¸ºå‰ªæ.</li>
<li>è®¾æ ‘çš„å¶ç»“ç‚¹ä¸ªæ•°ä¸º$|T|$,æ¯ä¸ªå¶ç»“ç‚¹æœ‰$N_t$ä¸ªæ ·æœ¬ç‚¹,å…¶ä¸­$k$ç±»æ ·æœ¬ç‚¹æœ‰$N_{tk}$ä¸ª,å‰ªæå¾€å¾€é€šè¿‡æå°åŒ–å†³ç­–æ ‘æ•´ä½“çš„æŸå¤±å‡½æ•°$C_{\alpha}(T)=\sum_{i=1}^{\pi} N_{i} H_{i}(T)+\alpha|T|$æ¥å®ç°,å…¶ä¸­ç»éªŒç†µ$H_{t}(T)=-\sum_{k} \frac{N_{a}}{N_{t}} \log \frac{N_{u}}{N_{t}}$.å‰ªæé€šè¿‡åŠ å…¥$a|T|$é¡¹æ¥è€ƒè™‘æ¨¡å‹å¤æ‚åº¦,å®é™…ä¸Šå°±æ˜¯ç”¨æ­£åˆ™åŒ–çš„æå¤§ä¼¼ç„¶ä¼°è®¡è¿›è¡Œæ¨¡å‹é€‰æ‹©.</li>
<li><strong>å‰ªæç®—æ³•</strong>:å‰ªå»æŸä¸€å­ç»“ç‚¹,å¦‚æœç”Ÿæˆçš„æ–°çš„æ•´ä½“æ ‘çš„<strong>æŸå¤±å‡½æ•°å€¼</strong>å°äºåŸæ ‘,åˆ™è¿›è¡Œå‰ªæ,ç›´åˆ°ä¸èƒ½ç»§ç»­ä¸ºæ­¢.å…·ä½“å¯ä»¥ç”±åŠ¨æ€è§„åˆ’å®ç°.</li>
</ol>
<h4 id="CARTç®—æ³•"><a href="#CARTç®—æ³•" class="headerlink" title="CARTç®—æ³•"></a><strong>CARTç®—æ³•</strong></h4><ol>
<li><p>CARTæ—¢å¯ä»¥ç”¨äº<strong>åˆ†ç±»ä¹Ÿ</strong>å¯ä»¥ç”¨äº<strong>å›å½’</strong>.å®ƒå‡è®¾å†³ç­–æ ‘æ˜¯<strong>äºŒå‰æ ‘</strong>,å†…éƒ¨ç»“ç‚¹ç‰¹å¾çš„å–å€¼ä¸ºâ€æ˜¯â€å’Œâ€å¦â€.é€’å½’åœ°æ„å»ºäºŒå‰æ ‘,å¯¹å›å½’æ ‘ç”¨<strong>å¹³æ–¹è¯¯å·®</strong>æœ€å°åŒ–å‡†åˆ™,å¯¹åˆ†ç±»æ•°ç”¨<strong>åŸºå°¼æŒ‡æ•°</strong>æœ€å°åŒ–å‡†åˆ™.</p>
</li>
<li><p><strong>å›å½’æ ‘çš„ç”Ÿæˆ</strong>:åœ¨è®­ç»ƒæ•°æ®é›†æ‰€åœ¨çš„è¾“å…¥ç©ºé—´ä¸­,é€’å½’åœ°å°†æ¯ä¸ªåŒºåŸŸåˆ’åˆ†ä¸ºä¸¤ä¸ªå­åŒºåŸŸ.é€‰æ‹©ç¬¬jä¸ªå˜é‡å’Œå®ƒå–çš„å€¼sä½œä¸ºåˆ‡åˆ†å˜é‡å’Œåˆ‡åˆ†ç‚¹,å¹¶å®šä¹‰ä¸¤ä¸ªåŒºåŸŸ$R_{1}(j, s)=\left\{x | x^{(j)} \leqslant s\right\} \quad$å’Œ$\quad R_{2}(j, s)=\left\{x | x^{(l)}&gt;s\right\}$,éå†å˜é‡j,å¯¹å›ºå®šçš„jæ‰«æåˆ‡åˆ†ç‚¹s,æ±‚è§£$\min _{j, z}\left[\min _{c_1} \sum_{x \in R_{1}(j, x)}\left(y_{i}-c_{1}\right)^{2}+\min _{c_{2}} \sum_{x \in R_{2}(j, x)}\left(y_{i}-c_{2}\right)^{2}\right]$.ç”¨é€‰å®šçš„å¯¹(j,s)åˆ’åˆ†åŒºåŸŸå¹¶å†³å®šç›¸åº”çš„è¾“å‡ºå€¼$\hat{c}_{m}=\frac{1}{N_{m}} \sum_{x_{i} \in R_{m}(j, x)} y_{i}, x \in R_{m}, \quad m=1,2$,ç›´åˆ°æ»¡è¶³åœæ­¢æ¡ä»¶.</p>
</li>
<li><p><strong>åŸºå°¼æŒ‡æ•°</strong>:å‡è®¾æœ‰Kä¸ªç±»,æ ·æœ¬å±äºç¬¬kç±»çš„æ¦‚ç‡ä¸º$p_k$,åˆ™æ¦‚ç‡åˆ†å¸ƒçš„åŸºå°¼æŒ‡æ•°ä¸º:$\operatorname{Gini}(p)=\sum_{k=1}^{K} p_{k}\left(1-p_{k}\right)=1-\sum_{k=1}^{K} p_{k}^{2}$,è¡¨ç¤ºä¸ç¡®å®šæ€§.åœ¨ç‰¹å¾Açš„æ¡ä»¶ä¸‹é›†åˆDçš„åŸºå°¼æŒ‡æ•°å®šä¹‰ä¸º$\operatorname{Gini}(D, A)=\frac{\left|D_{1}\right|}{|D|} \operatorname{Gini}\left(D_{1}\right)+\frac{\left|D_{2}\right|}{|D|} \operatorname{Gini}\left(D_{2}\right)$,è¡¨ç¤ºåˆ†å‰²åé›†åˆDçš„ä¸ç¡®å®šæ€§.åŸºå°¼æŒ‡æ•°è¶Šå¤§,æ ·æœ¬é›†åˆçš„<strong>ä¸ç¡®å®šæ€§</strong>ä¹Ÿå°±è¶Šå¤§.</p>
</li>
<li><p><strong>åˆ†ç±»æ ‘çš„ç”Ÿæˆ</strong></p>
<ol>
<li>ä»æ ¹ç»“ç‚¹å¼€å§‹,è®¾ç»“ç‚¹çš„è®­ç»ƒæ•°æ®é›†ä¸ºD,å¯¹æ¯ä¸ªç‰¹å¾Aå’Œå…¶å¯èƒ½å–çš„æ¯ä¸ªå€¼a,è®¡ç®—A=aæ—¶çš„åŸºå°¼æŒ‡æ•°,</li>
<li>é€‰æ‹©<strong>åŸºå°¼æŒ‡æ•°æœ€å°</strong>çš„ç‰¹å¾åŠå…¶å¯¹åº”çš„åˆ‡åˆ†ç‚¹ä½œä¸º<strong>æœ€ä¼˜ç‰¹å¾</strong>ä¸<strong>æœ€ä¼˜åˆ‡åˆ†ç‚¹</strong>,ç”Ÿæˆä¸¤ä¸ªå­ç»“ç‚¹</li>
<li>é€’å½’è¿›è¡Œä»¥ä¸Šæ“ä½œ,ç›´è‡³æ»¡è¶³<strong>åœæ­¢æ¡ä»¶</strong>.åœæ­¢æ¡ä»¶ä¸€èˆ¬æ˜¯ç»“ç‚¹ä¸­çš„æ ·æœ¬ä¸ªæ•°å°äºé˜ˆå€¼,æˆ–æ ·æœ¬é›†çš„åŸºå°¼æŒ‡æ•°å°äºé˜ˆå€¼,æˆ–æ²¡æœ‰æ›´å¤šç‰¹å¾.</li>
</ol>
</li>
<li><p><strong>CARTå‰ªæ</strong></p>
<p>$T_t$è¡¨ç¤ºä»¥tä¸ºæ ¹ç»“ç‚¹çš„å­æ ‘,$|T_t|$æ˜¯$T_t$çš„å¶ç»“ç‚¹ä¸ªæ•°.å¯ä»¥è¯æ˜å½“$\alpha=\frac{C(t)-C\left(T_{t}\right)}{\left|T_{t}\right|-1}$æ—¶,$T_t$ä¸$t$æœ‰ç›¸åŒçš„æŸå¤±å‡½æ•°å€¼,ä¸”$t$çš„ç»“ç‚¹å°‘,å› æ­¤$t$æ¯”$T_t$æ›´å¯å–,å¯¹$T_t$è¿›è¡Œå‰ªæ.<strong>è‡ªä¸‹è€Œä¸Š</strong>åœ°å¯¹å„å†…éƒ¨ç»“ç‚¹tè®¡ç®—$g(t)=\frac{C(t)-C\left(T_{t}\right)}{\left|T_{t}\right|-1}$,å¹¶ä»¤$a=min(g(t))$,<strong>è‡ªä¸Šè€Œä¸‹</strong>åœ°è®¿é—®å†…éƒ¨èŠ‚ç‚¹t,å¦‚æœæœ‰$g(t)=a$,è¿›è¡Œå‰ªæ,å¹¶å¯¹tä»¥<strong>å¤šæ•°è¡¨å†³æ³•</strong>å†³å®šå…¶ç±»,å¾—åˆ°å­æ ‘T,å¦‚æ­¤å¾ªç¯åœ°ç”Ÿæˆä¸€ä¸²<strong>å­æ ‘åºåˆ—</strong>,ç›´åˆ°æ–°ç”Ÿæˆçš„Tæ˜¯ç”±æ ¹ç»“ç‚¹å•ç‹¬æ„æˆçš„æ ‘ä¸ºæ­¢.åˆ©ç”¨<strong>äº¤å‰éªŒè¯æ³•</strong>åœ¨å­æ ‘åºåˆ—ä¸­é€‰å–æœ€ä¼˜å­æ ‘.</p>
<p>å¦‚æœæ˜¯<strong>è¿ç»­å€¼</strong>çš„æƒ…å†µ,ä¸€èˆ¬ç”¨<strong>äºŒåˆ†æ³•</strong>ä½œä¸ºç»“ç‚¹æ¥åˆ’åˆ†.</p>
</li>
</ol>
<h3 id="logisticå›å½’å’Œæœ€å¤§ç†µæ¨¡å‹"><a href="#logisticå›å½’å’Œæœ€å¤§ç†µæ¨¡å‹" class="headerlink" title="logisticå›å½’å’Œæœ€å¤§ç†µæ¨¡å‹"></a>logisticå›å½’å’Œæœ€å¤§ç†µæ¨¡å‹</h3><h4 id="é€»è¾‘æ–¯è°›åˆ†å¸ƒ"><a href="#é€»è¾‘æ–¯è°›åˆ†å¸ƒ" class="headerlink" title="é€»è¾‘æ–¯è°›åˆ†å¸ƒ"></a><strong>é€»è¾‘æ–¯è°›åˆ†å¸ƒ</strong></h4><p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/logistic.png" alt="avatar"></p>
<p>åˆ†å¸ƒå‡½æ•°$f(x)$ä»¥ç‚¹$(Î¼,1/2)$ä¸ºä¸­å¿ƒå¯¹ç§°,$Î³$çš„å€¼è¶Šå°,æ›²çº¿åœ¨ä¸­å¿ƒé™„è¿‘å¢é•¿å¾—è¶Šå¿«.</p>
<h4 id="é€»è¾‘æ–¯è°›å›å½’æ¨¡å‹"><a href="#é€»è¾‘æ–¯è°›å›å½’æ¨¡å‹" class="headerlink" title="é€»è¾‘æ–¯è°›å›å½’æ¨¡å‹"></a><strong>é€»è¾‘æ–¯è°›å›å½’æ¨¡å‹</strong></h4><p>å¯¹äºç»™å®šçš„è¾“å…¥x,æ ¹æ®$P(Y=1 | x)=\frac{\exp (w \cdot x+b)}{1+\exp (w \cdot x+b)}$ å’Œ $P(Y=0 | x)=\frac{1}{1+\exp (w \cdot x+b)}$è®¡ç®—å‡ºä¸¤ä¸ªæ¡ä»¶æ¦‚ç‡å€¼çš„å¤§å°,å°†xåˆ†åˆ°æ¦‚ç‡å€¼è¾ƒå¤§çš„é‚£ä¸€ç±».å°†åç½®båŠ å…¥åˆ°æƒå€¼å‘é‡wä¸­,å¹¶åœ¨xçš„æœ€åæ·»åŠ å¸¸æ•°é¡¹1,å¾—åˆ°$P(Y=1 | x)=\frac{\exp (w \cdot x)}{1+\exp (w \cdot x)}$ å’Œ $P(Y=0 | x)=\frac{1}{1+\exp (w \cdot x)}$ã€‚</p>
<h4 id="å¯¹æ•°å‡ ç‡"><a href="#å¯¹æ•°å‡ ç‡" class="headerlink" title="å¯¹æ•°å‡ ç‡"></a>å¯¹æ•°å‡ ç‡</h4><p>å¦‚æœæŸäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡æ˜¯p,åˆ™è¯¥äº‹ä»¶å‘ç”Ÿçš„<strong>å‡ ç‡</strong>(æ­¤å¤„å‡ ç‡æŒ‡è¯¥äº‹ä»¶å‘ç”Ÿæ¦‚ç‡ä¸ä¸å‘ç”Ÿæ¦‚ç‡ä¹‹æ¯”)æ˜¯$\frac{p}{1-p}$,<strong>å¯¹æ•°å‡ ç‡</strong>æ˜¯$log(\frac{p}{1-p})$,é‚£ä¹ˆ$\log \frac{P(Y=1 | x)}{1-P(Y=1 | x)}=w \cdot x$ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨é€»è¾‘æ–¯è°›å›å½’æ¨¡å‹ä¸­,è¾“å‡ºY=1çš„å¯¹æ•°å‡ ç‡æ˜¯è¾“å…¥xçš„<strong>çº¿æ€§å‡½æ•°</strong>,çº¿æ€§å‡½æ•°å€¼è¶Šæ¥è¿‘æ­£æ— ç©·,æ¦‚ç‡å€¼å°±è¶Šæ¥è¿‘1,åä¹‹åˆ™è¶Šæ¥è¿‘0.</p>
<h4 id="ä¼¼ç„¶ä¼°è®¡"><a href="#ä¼¼ç„¶ä¼°è®¡" class="headerlink" title="ä¼¼ç„¶ä¼°è®¡"></a><strong>ä¼¼ç„¶ä¼°è®¡</strong></h4><p>ç»™å®šxçš„æƒ…å†µä¸‹å‚æ•°Î¸æ˜¯çœŸå®å‚æ•°çš„å¯èƒ½æ€§.</p>
<h4 id="æ¨¡å‹å‚æ•°ä¼°è®¡"><a href="#æ¨¡å‹å‚æ•°ä¼°è®¡" class="headerlink" title="æ¨¡å‹å‚æ•°ä¼°è®¡"></a><strong>æ¨¡å‹å‚æ•°ä¼°è®¡</strong></h4><p>å¯¹äºç»™å®šçš„äºŒåˆ†ç±»è®­ç»ƒæ•°æ®é›†,å¯¹æ•°ä¼¼ç„¶å‡½æ•°ä¸º</p>
<script type="math/tex; mode=display">
\begin{aligned} L(w) &=\sum_{i=1}^{N}\left[y_{i} \log \pi\left(x_{i}\right)+\left(1-y_{i}\right)\log\left(1-\pi\left(x_{i}\right)\right)\right]\\ &=\sum_{i=1}^{N}\left[y_{i} \log \frac{\pi\left(x_{i}\right)}{1-\pi\left(x_{i}\right)}+\log \left(1-\pi\left(x_{i}\right)\right)\right]\\&=\sum_{i=1}^{N}\left[y_{i}\left(w \cdot x_{i}\right)-\log \left(1+\exp \left(w \cdot x_{i}\right)\right]\right.\end{aligned}</script><p>ä¹Ÿå°±æ˜¯<strong>æŸå¤±å‡½æ•°</strong>.å…¶ä¸­$P(Y=1|x)=Ï€(x)$,å¯¹$L(w)$æ±‚æå¤§å€¼,å°±å¯ä»¥å¾—åˆ°$w$çš„ä¼°è®¡å€¼.é—®é¢˜å˜æˆäº†ä»¥å¯¹æ•°ä¼¼ç„¶å‡½æ•°ä¸ºç›®æ ‡å‡½æ•°çš„æœ€ä¼˜åŒ–é—®é¢˜.</p>
<h4 id="å¤šé¡¹é€»è¾‘æ–¯è°›å›å½’"><a href="#å¤šé¡¹é€»è¾‘æ–¯è°›å›å½’" class="headerlink" title="å¤šé¡¹é€»è¾‘æ–¯è°›å›å½’"></a><strong>å¤šé¡¹é€»è¾‘æ–¯è°›å›å½’</strong></h4><p>å½“é—®é¢˜æ˜¯å¤šåˆ†ç±»é—®é¢˜æ—¶,å¯ä»¥ä½œå¦‚ä¸‹æ¨å¹¿:è®¾Yæœ‰Kç±»å¯èƒ½å–å€¼,$P(Y=k | x)=\frac{\exp \left(w_{k} \cdot x\right)}{1+\sum_{k=1}^{K-1} \exp \left(w_{k} \cdot x\right)}, \quad k=1,2, \cdots, K-1 \quad P(Y=K | x)=\frac{1}{1+\sum_{k=1}^{K-1} \exp \left(w_{k} \cdot x\right)}$,å®é™…ä¸Šå°±æ˜¯<strong>one-vs-all</strong>çš„æ€æƒ³,å°†å…¶ä»–æ‰€æœ‰ç±»å½“ä½œä¸€ä¸ªç±»,é—®é¢˜è½¬æ¢ä¸ºäºŒåˆ†ç±»é—®é¢˜.</p>
<p>ä½¿ç”¨æœ€å¤§ä¼¼ç„¶æ³•è¡¡é‡æ¨¡å‹è¾“å‡ºçš„æ¦‚ç‡ä¸çœŸå®æ¦‚ç‡çš„å·®åˆ«ï¼Œå‡è®¾æ ·æœ¬ä¸€å…±æœ‰Nä¸ªï¼Œé‚£ä¹ˆè¿™ç»„æ ·æœ¬å‘ç”Ÿçš„æ€»æ¦‚ç‡å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<script type="math/tex; mode=display">
P(\boldsymbol{W})=\prod_{n=1}^{N}\left(\frac{e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}}{\sum_{k^{\prime}}^{C} e^{\boldsymbol{w}_{k^{\prime}}^{T} \boldsymbol{x}_{n}}}\right)</script><p>å¯¹å‡½æ•°å–å¯¹æ•°å†ä¹˜ä»¥-1ï¼Œæ¨å¯¼å¾—åˆ°ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
F(\boldsymbol{W})=-\ln (P(\boldsymbol{W})) &=\sum_{n=1}^{N} \ln \left(\frac{\sum_{k^{\prime}}^{C} e^{\boldsymbol{w}_{k^{\prime}}^{T} \boldsymbol{x}_{n}}}{e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}}\right) \\
&=\sum_{n=1}^{N} \ln \left(\frac{e^{\boldsymbol{w}_{1}^{T} \boldsymbol{x}}+e^{\boldsymbol{w}_{2}^{T} \boldsymbol{x}}+\ldots+e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}+\ldots+e^{\boldsymbol{w}_{c}^{T} \boldsymbol{x}}}{e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}}\right) \\
&=\sum_{n=1}^{N} \ln \left(1+\sum_{k \neq y_{n}} e^{\boldsymbol{w}_{k} \boldsymbol{x}_{n}-\boldsymbol{w}_{y_{n}} \boldsymbol{x}_{n}}\right)
\end{aligned}</script><h4 id="æœ€å¤§ç†µåŸç†"><a href="#æœ€å¤§ç†µåŸç†" class="headerlink" title="æœ€å¤§ç†µåŸç†"></a><strong>æœ€å¤§ç†µåŸç†</strong></h4><p>å­¦ä¹ æ¦‚ç‡æ¨¡å‹æ—¶,åœ¨æ‰€æœ‰å¯èƒ½çš„æ¦‚ç‡æ¨¡å‹ä¸­,<strong>ç†µæœ€å¤§</strong>çš„æ¨¡å‹æ˜¯æœ€å¥½çš„æ¨¡å‹.ç›´è§‚åœ°,æœ€å¤§ç†µåŸç†è®¤ä¸ºæ¨¡å‹é¦–å…ˆè¦æ»¡è¶³å·²æœ‰çš„äº‹å®,å³<strong>çº¦æŸæ¡ä»¶</strong>.åœ¨æ²¡æœ‰æ›´å¤šä¿¡æ¯çš„æƒ…å†µä¸‹,é‚£äº›ä¸ç¡®å®šçš„éƒ¨åˆ†éƒ½æ˜¯â€<strong>ç­‰å¯èƒ½çš„</strong>â€œ.</p>
<h4 id="æœ€å¤§ç†µæ¨¡å‹"><a href="#æœ€å¤§ç†µæ¨¡å‹" class="headerlink" title="æœ€å¤§ç†µæ¨¡å‹"></a><strong>æœ€å¤§ç†µæ¨¡å‹</strong></h4><p>ç»™å®šè®­ç»ƒæ•°æ®é›†,å¯ä»¥ç¡®å®šè”åˆåˆ†å¸ƒP(X,Y)çš„ç»éªŒåˆ†å¸ƒ$\tilde{P}(X=x, Y=y)=\frac{v(X=x, Y=y)}{N}$å’Œè¾¹ç¼˜åˆ†å¸ƒP(X)çš„ç»éªŒåˆ†å¸ƒ$\tilde{P}(X=x)=\frac{v(X=x)}{N}$,å…¶ä¸­vè¡¨ç¤ºé¢‘æ•°,Nè¡¨ç¤ºæ ·æœ¬å®¹é‡.ç”¨<strong>ç‰¹å¾å‡½æ•°$f(x,y)$</strong>=1æè¿°xä¸yæ»¡è¶³æŸä¸€äº‹å®,å¯ä»¥å¾—åˆ°ç‰¹å¾å‡½æ•°å…³äºP(X,Y)çš„ç»éªŒåˆ†å¸ƒçš„æœŸæœ›å€¼å’Œå…³äºæ¨¡å‹P(Y|X)ä¸P(X)çš„ç»éªŒåˆ†å¸ƒçš„æœŸæœ›å€¼,å‡è®¾ä¸¤è€…ç›¸ç­‰,å°±å¾—åˆ°äº†<strong>çº¦æŸæ¡ä»¶</strong>$\sum_{x, y} \tilde{P}(x) P(y | x) f(x, y)=\sum_{x, y} \tilde{P}(x, y) f(x, y)$.å®šä¹‰åœ¨æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒP(Y|X)ä¸Šçš„æ¡ä»¶ç†µä¸º$H(P)=-\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)$,åˆ™<strong>æ¡ä»¶ç†µæœ€å¤§</strong>çš„æ¨¡å‹ç§°ä¸ºæœ€å¤§ç†µæ¨¡å‹.</p>
<h4 id="æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ "><a href="#æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ " class="headerlink" title="æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ "></a><strong>æœ€å¤§ç†µæ¨¡å‹çš„å­¦ä¹ </strong></h4><p>å°±æ˜¯æ±‚è§£æœ€å¤§ç†µæ¨¡å‹çš„è¿‡ç¨‹.ç­‰ä»·äº<strong>çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜</strong></p>
<script type="math/tex; mode=display">
\begin{aligned}
&\max _{P_{e c}} H(P)=-\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)\\
&\text { s.t. } \quad E_{p}\left(f_{i}\right)=E_{p}\left(f_{i}\right), \quad i=1,2, \cdots, n\\
     &\sum_{y} P(y | x)=1
\end{aligned}</script><p>,å°†æ±‚æœ€å¤§å€¼é—®é¢˜æ”¹ä¸ºç­‰ä»·çš„æ±‚æœ€å°å€¼é—®é¢˜</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\min _{R \in C}-H(P)=\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)\\
&\text { s.t. } \quad E_{P}\left(f_{i}\right)-E_{\beta}\left(f_{i}\right)=0, \quad i=1,2, \cdots, n\\
&\sum_{y} P(y | x)=1
\end{aligned}</script><p>å¼•å…¥<strong>æ‹‰æ ¼æœ—æ—¥ä¹˜å­</strong></p>
<script type="math/tex; mode=display">
\begin{aligned}
L(P, w) & \equiv-H(P)+w_{0}\left(1-\sum_{y} P(y | x)\right)+\sum_{i=1}^{n} w_{i}\left(E_{p}\left(f_{i}\right)-E_{P}\left(f_{i}\right)\right) \\
&=\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)+w_{0}\left(1-\sum_{y} P(y | x)\right) \\
&+\sum_{i=1}^{n} w_{i}\left(\sum_{x, y} \tilde{P}(x, y) f_{i}(x, y)-\sum_{x, y} \tilde{P}(x) P(y | x) f_{i}(x, y)\right)
\end{aligned}</script><p>å°†åŸå§‹é—®é¢˜$\min _{p \in C} \max _{w} L(P, w)$è½¬æ¢ä¸ºæ— çº¦æŸæœ€ä¼˜åŒ–çš„<strong>å¯¹å¶é—®é¢˜</strong>$\max _{w} \min _{P \in \mathbf{C}} L(P, w)$.é¦–å…ˆæ±‚è§£å†…éƒ¨çš„<strong>æå°åŒ–é—®é¢˜</strong>,å³æ±‚$L(P,W)$å¯¹$P(y|x)$çš„åå¯¼æ•°.</p>
<script type="math/tex; mode=display">
\begin{aligned}
\frac{\partial L(P, w)}{\partial P(y | x)} &=\sum_{x, y} \tilde{P}(x)(\log P(y | x)+1)-\sum_{y} w_{0}-\sum_{x, y}\left(\tilde{P}(x) \sum_{i=1}^{n} w_{i} f_{i}(x, y)\right) \\
&=\sum_{x, y} \tilde{P}(x)\left(\log P(y | x)+1-w_{0}-\sum_{i=1}^{n} w_{i} f_{i}(x, y)\right)
\end{aligned}</script><p>,å¹¶ä»¤åå¯¼æ•°ç­‰äº0,è§£å¾—$Z_{w}(x)=\sum_{y} \exp \left(\sum_{i=1}^{n} w_{i} f_{i}(x, y)\right)$.å¯ä»¥è¯æ˜å¯¹å¶å‡½æ•°ç­‰ä»·äºå¯¹æ•°ä¼¼ç„¶å‡½æ•°,é‚£ä¹ˆå¯¹å¶å‡½æ•°æå¤§åŒ–ç­‰ä»·äºæœ€å¤§ç†µæ¨¡å‹çš„<strong>æå¤§ä¼¼ç„¶ä¼°è®¡</strong>$L(w)=\sum_{x, y} \tilde{P}(x, y) \sum_{i=1}^{n} w_{i} f_{i}(x, y)-\sum_{x} \tilde{P}(x) \log Z_{w}(x)$.ä¹‹åå¯ä»¥ç”¨æœ€ä¼˜åŒ–ç®—æ³•æ±‚è§£å¾—åˆ°w.</p>
<h4 id="é€»è¾‘å›å½’ä¸æœ€å¤§ç†µæ¨¡å‹çš„å…±åŒç‚¹"><a href="#é€»è¾‘å›å½’ä¸æœ€å¤§ç†µæ¨¡å‹çš„å…±åŒç‚¹" class="headerlink" title="é€»è¾‘å›å½’ä¸æœ€å¤§ç†µæ¨¡å‹çš„å…±åŒç‚¹"></a>é€»è¾‘å›å½’ä¸æœ€å¤§ç†µæ¨¡å‹çš„å…±åŒç‚¹</h4><p>æœ€å¤§ç†µæ¨¡å‹ä¸é€»è¾‘æ–¯è°›å›å½’æ¨¡å‹æœ‰ç±»ä¼¼çš„å½¢å¼,å®ƒä»¬åˆç§°ä¸º<strong>å¯¹æ•°çº¿æ€§æ¨¡å‹</strong>.æ¨¡å‹å­¦ä¹ å°±æ˜¯åœ¨ç»™å®šçš„è®­ç»ƒæ•°æ®æ¡ä»¶ä¸‹å¯¹æ¨¡å‹è¿›è¡Œæå¤§ä¼¼ç„¶ä¼°è®¡æˆ–æ­£åˆ™åŒ–çš„æå¤§ä¼¼ç„¶ä¼°è®¡.</p>
<h4 id="ä¼˜åŒ–ç®—æ³•"><a href="#ä¼˜åŒ–ç®—æ³•" class="headerlink" title="ä¼˜åŒ–ç®—æ³•"></a>ä¼˜åŒ–ç®—æ³•</h4><p>ä¼¼ç„¶å‡½æ•°æ˜¯<strong>å…‰æ»‘çš„å‡¸å‡½æ•°</strong>,å› æ­¤å¤šç§æœ€ä¼˜åŒ–æ–¹æ³•éƒ½é€‚ç”¨.</p>
<ol>
<li><strong>æ”¹è¿›çš„è¿­ä»£å°ºåº¦æ³•(IIS)</strong>:å‡è®¾å½“å‰çš„å‚æ•°å‘é‡æ˜¯w,å¦‚æœèƒ½æ‰¾åˆ°ä¸€ç§æ–¹æ³•<strong>w-&gt;w+Î´</strong>ä½¿å¯¹æ•°ä¼¼ç„¶å‡½æ•°å€¼å˜å¤§,å°±å¯ä»¥<strong>é‡å¤</strong>ä½¿ç”¨è¿™ä¸€æ–¹æ³•,ç›´åˆ°æ‰¾åˆ°æœ€å¤§å€¼.</li>
<li>é€»è¾‘æ–¯è°›å›å½’å¸¸åº”ç”¨æ¢¯åº¦ä¸‹é™æ³•,ç‰›é¡¿æ³•æˆ–æ‹Ÿç‰›é¡¿æ³•.</li>
</ol>
<h3 id="æ”¯æŒå‘é‡æœº"><a href="#æ”¯æŒå‘é‡æœº" class="headerlink" title="æ”¯æŒå‘é‡æœº"></a>æ”¯æŒå‘é‡æœº</h3><h4 id="æ¨¡å‹-4"><a href="#æ¨¡å‹-4" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p>æ”¯æŒå‘é‡æœº(SVM)æ˜¯ä¸€ç§<strong>äºŒç±»åˆ†ç±»æ¨¡å‹</strong>.å®ƒçš„åŸºæœ¬æ¨¡å‹æ˜¯å®šä¹‰åœ¨ç‰¹å¾ç©ºé—´ä¸Šçš„<strong>é—´éš”æœ€å¤§</strong>çš„çº¿æ€§åˆ†ç±»å™¨.æ”¯æŒå‘é‡æœºè¿˜åŒ…æ‹¬<strong>æ ¸æŠ€å·§</strong>,ä½¿å®ƒæˆä¸ºå®è´¨ä¸Šçš„éçº¿æ€§åˆ†ç±»å™¨.<strong>åˆ†ç¦»è¶…å¹³é¢</strong>$w^\star x+b^\star =0$,<strong>åˆ†ç±»å†³ç­–å‡½æ•°</strong>$f(s)=sign(w^\star x + b^\star)$.</p>
<h4 id="ç­–ç•¥-3"><a href="#ç­–ç•¥-3" class="headerlink" title="ç­–ç•¥"></a>ç­–ç•¥</h4><p><strong>é—´éš”æœ€å¤§åŒ–</strong>,å¯å½¢å¼åŒ–ä¸ºä¸€ä¸ªæ±‚è§£<strong>å‡¸äºŒæ¬¡è§„åˆ’</strong>çš„é—®é¢˜,ä¹Ÿç­‰ä»·äºæ­£åˆ™åŒ–çš„<strong>åˆé¡µæŸå¤±å‡½æ•°</strong>çš„æœ€å°åŒ–é—®é¢˜.</p>
<h4 id="æ•°æ®å¯åˆ†ã€è¿‘ä¼¼å¯åˆ†ã€ä¸å¯åˆ†"><a href="#æ•°æ®å¯åˆ†ã€è¿‘ä¼¼å¯åˆ†ã€ä¸å¯åˆ†" class="headerlink" title="æ•°æ®å¯åˆ†ã€è¿‘ä¼¼å¯åˆ†ã€ä¸å¯åˆ†"></a>æ•°æ®å¯åˆ†ã€è¿‘ä¼¼å¯åˆ†ã€ä¸å¯åˆ†</h4><p>å½“è®­ç»ƒæ•°æ®<strong>çº¿æ€§å¯åˆ†</strong>æ—¶,é€šè¿‡ç¡¬é—´éš”æœ€å¤§åŒ–,å­¦ä¹ å‡º<strong>çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº</strong>.å½“è®­ç»ƒæ•°æ®<strong>è¿‘ä¼¼çº¿æ€§å¯åˆ†</strong>æ—¶,é€šè¿‡è½¯é—´éš”æœ€å¤§åŒ–,å­¦ä¹ å‡º<strong>çº¿æ€§æ”¯æŒå‘é‡æœº</strong>.å½“è®­ç»ƒæ•°æ®<strong>çº¿æ€§ä¸å¯åˆ†</strong>æ—¶,é€šè¿‡ä½¿ç”¨æ ¸æŠ€å·§åŠè½¯é—´éš”æœ€å¤§åŒ–,å­¦ä¹ <strong>éçº¿æ€§æ”¯æŒå‘é‡æœº</strong>.</p>
<h4 id="æ ¸æŠ€å·§"><a href="#æ ¸æŠ€å·§" class="headerlink" title="æ ¸æŠ€å·§"></a>æ ¸æŠ€å·§</h4><p>å½“è¾“å…¥ç©ºé—´ä¸ºæ¬§å¼ç©ºé—´æˆ–ç¦»æ•£é›†åˆ,ç‰¹å¾ç©ºé—´ä¸ºå¸Œå°”ä¼¯ç‰¹ç©ºé—´æ—¶,æ ¸å‡½æ•°è¡¨ç¤ºå°†è¾“å…¥ä»è¾“å…¥ç©ºé—´<strong>æ˜ å°„</strong>åˆ°ç‰¹å¾ç©ºé—´å¾—åˆ°çš„ç‰¹å¾å‘é‡ä¹‹é—´çš„<strong>å†…ç§¯</strong>.é€šè¿‡æ ¸å‡½æ•°å­¦ä¹ éçº¿æ€§æ”¯æŒå‘é‡æœºç­‰ä»·äºåœ¨é«˜ç»´çš„ç‰¹å¾ç©ºé—´ä¸­å­¦ä¹ çº¿æ€§æ”¯æŒå‘é‡æœº.è¿™æ ·çš„æ–¹æ³•ç§°ä¸ºæ ¸æŠ€å·§.</p>
<h4 id="è¾“å…¥ç©ºé—´å’Œç‰¹å¾ç©ºé—´"><a href="#è¾“å…¥ç©ºé—´å’Œç‰¹å¾ç©ºé—´" class="headerlink" title="è¾“å…¥ç©ºé—´å’Œç‰¹å¾ç©ºé—´"></a>è¾“å…¥ç©ºé—´å’Œç‰¹å¾ç©ºé—´</h4><p>è€ƒè™‘ä¸€ä¸ªäºŒç±»åˆ†ç±»é—®é¢˜,å‡è®¾è¾“å…¥ç©ºé—´ä¸ç‰¹å¾ç©ºé—´ä¸ºä¸¤ä¸ªä¸åŒçš„ç©ºé—´,è¾“å…¥ç©ºé—´ä¸º<strong>æ¬§æ°ç©ºé—´æˆ–ç¦»æ•£é›†åˆ</strong>,ç‰¹å¾ç©ºé—´ä¸º<strong>æ¬§æ°ç©ºé—´æˆ–å¸Œå°”ä¼¯ç‰¹ç©ºé—´</strong>.æ”¯æŒå‘é‡æœºéƒ½å°†è¾“å…¥æ˜ å°„ä¸ºç‰¹å¾å‘é‡,æ‰€ä»¥æ”¯æŒå‘é‡æœºçš„å­¦ä¹ æ˜¯åœ¨<strong>ç‰¹å¾ç©ºé—´</strong>è¿›è¡Œçš„.</p>
<h4 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><p>æ”¯æŒå‘é‡æœºçš„æœ€ä¼˜åŒ–é—®é¢˜ä¸€èˆ¬é€šè¿‡å¯¹å¶é—®é¢˜åŒ–ä¸º<strong>å‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜</strong>æ±‚è§£,å…·ä½“æ­¥éª¤æ˜¯å°†ç­‰å¼çº¦æŸæ¡ä»¶ä»£å…¥ä¼˜åŒ–ç›®æ ‡,é€šè¿‡æ±‚åå¯¼æ±‚å¾—ä¼˜åŒ–ç›®æ ‡åœ¨ä¸ç­‰å¼çº¦æŸæ¡ä»¶ä¸‹çš„æå€¼.</p>
<h4 id="çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº"><a href="#çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº" class="headerlink" title="çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº"></a><strong>çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº</strong></h4><p>å½“è®­ç»ƒæ•°æ®é›†çº¿æ€§å¯åˆ†æ—¶,å­˜åœ¨æ— ç©·ä¸ªåˆ†ç¦»è¶…å¹³é¢å¯å°†ä¸¤ç±»æ•°æ®æ­£ç¡®åˆ†å¼€.åˆ©ç”¨<strong>é—´éš”æœ€å¤§åŒ–</strong>å¾—åˆ°<strong>å”¯ä¸€</strong>æœ€ä¼˜åˆ†ç¦»è¶…å¹³é¢$w^\star x +b = 0$å’Œç›¸åº”çš„åˆ†ç±»å†³ç­–å‡½æ•°$f(s)=sign(w^\star x + b^\star)$.ç§°ä¸ºçº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº.</p>
<h5 id="å‡½æ•°é—´éš”"><a href="#å‡½æ•°é—´éš”" class="headerlink" title="å‡½æ•°é—´éš”"></a>å‡½æ•°é—´éš”</h5><p>ä¸€èˆ¬æ¥è¯´,ä¸€ä¸ªç‚¹è·ç¦»åˆ†ç¦»è¶…å¹³é¢çš„<strong>è¿œè¿‘</strong>å¯ä»¥è¡¨ç¤ºåˆ†ç±»é¢„æµ‹çš„<strong>ç¡®ä¿¡ç¨‹åº¦</strong>.åœ¨è¶…å¹³é¢$w^\star x +b = 0$ç¡®å®šçš„æƒ…å†µä¸‹,$|wx+b|$èƒ½å¤Ÿç›¸å¯¹åœ°è¡¨ç¤ºç‚¹xè·ç¦»è¶…å¹³é¢çš„è¿œè¿‘,è€Œ$wx+b$ä¸$y$çš„ç¬¦å·æ˜¯å¦ä¸€è‡´èƒ½å¤Ÿè¡¨ç¤ºåˆ†ç±»æ˜¯å¦æ­£ç¡®.æ‰€ä»¥å¯ç”¨$\hat{\gamma}_{i}=y_{i}\left(w \cdot x_{i}+b\right)$æ¥è¡¨ç¤ºåˆ†ç±»çš„æ­£ç¡®æ€§åŠç¡®ä¿¡åº¦,è¿™å°±æ˜¯<strong>å‡½æ•°é—´éš”</strong>.æ³¨æ„åˆ°å³ä½¿è¶…å¹³é¢ä¸å˜,å‡½æ•°é—´éš”ä»ä¼šå—wå’Œbçš„ç»å¯¹å¤§å°å½±å“.</p>
<h5 id="å‡ ä½•é—´éš”"><a href="#å‡ ä½•é—´éš”" class="headerlink" title="å‡ ä½•é—´éš”"></a><strong>å‡ ä½•é—´éš”</strong></h5><p>ä¸€èˆ¬åœ°,å½“æ ·æœ¬ç‚¹è¢«è¶…å¹³é¢æ­£ç¡®åˆ†ç±»æ—¶,ç‚¹xä¸è¶…å¹³é¢çš„è·ç¦»æ˜¯$\gamma_{i}=y_{i}\left(\frac{w}{|w|} \cdot x_{i}+\frac{b}{|w|}\right)$å…¶ä¸­$||w||$æ˜¯$w$çš„$l2$èŒƒæ•°.è¿™å°±æ˜¯<strong>å‡ ä½•é—´éš”</strong>çš„å®šä¹‰.å®šä¹‰è¶…å¹³é¢å…³äºè®­ç»ƒæ•°æ®é›†Tçš„å‡ ä½•é—´éš”ä¸ºè¶…å¹³é¢å…³äºTä¸­æ‰€æœ‰æ ·æœ¬ç‚¹çš„å‡ ä½•é—´éš”ä¹‹<strong>æœ€å°å€¼</strong>$\gamma=\min _{i,â€¦,N} \gamma_{1}$.å¯çŸ¥$\gamma=\frac{\hat{\gamma}}{|\boldsymbol{w}|}$å½“$||w||=1$æ—¶å‡ ä½•é—´éš”å’Œå‡½æ•°é—´éš”<strong>ç›¸ç­‰</strong>.</p>
<h5 id="ç¡¬é—´éš”æœ€å¤§åŒ–"><a href="#ç¡¬é—´éš”æœ€å¤§åŒ–" class="headerlink" title="ç¡¬é—´éš”æœ€å¤§åŒ–"></a><strong>ç¡¬é—´éš”æœ€å¤§åŒ–</strong></h5><p>å¯¹çº¿æ€§å¯åˆ†çš„è®­ç»ƒé›†è€Œè¨€,è¿™é‡Œçš„é—´éš”æœ€å¤§åŒ–åˆç§°ä¸º<strong>ç¡¬é—´éš”æœ€å¤§åŒ–</strong>.ç›´è§‚è§£é‡Šæ˜¯å¯¹è®­ç»ƒé›†æ‰¾åˆ°å‡ ä½•é—´éš”æœ€å¤§çš„è¶…å¹³é¢æ„å‘³ç€ä»¥<strong>å……åˆ†å¤§çš„ç¡®ä¿¡åº¦</strong>å¯¹è®­ç»ƒæ•°æ®è¿›è¡Œåˆ†ç±».æ±‚æœ€å¤§é—´éš”åˆ†ç¦»è¶…å¹³é¢å³çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜:</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\max _{w, b} \quad \gamma\\
&\text { s.t. } \quad y_{i}\left(\frac{w}{\|w\|} \cdot x_{i}+\frac{b}{\|w\|}\right) \geqslant \gamma, \quad i=1,2, \cdots, N
\end{aligned}</script><p>,å°†å‡ ä½•é—´éš”ç”¨å‡½æ•°é—´éš”è¡¨ç¤º:</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\max _{w, b} \frac{\hat{\gamma}}{\|w\|}\\
&\text { s.t. } \quad y_{i}\left(w \cdot x_{i}+b\right) \geqslant \hat{p}, \quad i=1,2, \cdots, N
\end{aligned}</script><p>,å¹¶ä¸”æ³¨æ„åˆ°å‡½æ•°é—´éš”çš„å–å€¼å¹¶ä¸å½±å“æœ€ä¼˜åŒ–é—®é¢˜çš„è§£,ä¸å¦¨ä»¤å‡½æ•°é—´éš”=1,å¹¶è®©æœ€å¤§åŒ–$\frac{1}{||w||}$ç­‰ä»·ä¸ºæœ€å°åŒ–$\frac{||w||^2}{2}$,é—®é¢˜å˜ä¸º<strong>å‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜</strong></p>
<script type="math/tex; mode=display">
\min _{w, b} \frac{1}{2}\|w\|^{2} \\
s.t. \quad y_{i}\left(w \cdot x_{i}+b\right)-1 \geqslant 0, \quad i=1,2, \cdots, N</script><h5 id="æ”¯æŒå‘é‡å’Œé—´éš”è¾¹ç•Œ"><a href="#æ”¯æŒå‘é‡å’Œé—´éš”è¾¹ç•Œ" class="headerlink" title="æ”¯æŒå‘é‡å’Œé—´éš”è¾¹ç•Œ"></a><strong>æ”¯æŒå‘é‡å’Œé—´éš”è¾¹ç•Œ</strong></h5><p>ä¸åˆ†ç¦»è¶…å¹³é¢è·ç¦»<strong>æœ€è¿‘çš„æ ·æœ¬ç‚¹</strong>çš„å®ä¾‹ç§°ä¸º<strong>æ”¯æŒå‘é‡</strong>.æ”¯æŒå‘é‡æ˜¯ä½¿æœ€ä¼˜åŒ–é—®é¢˜ä¸­çš„çº¦æŸæ¡ä»¶ç­‰å·æˆç«‹çš„ç‚¹.å› æ­¤å¯¹$y=+1$çš„æ­£ä¾‹ç‚¹å’Œ$y=-1$çš„è´Ÿä¾‹ç‚¹,æ”¯æŒå‘é‡åˆ†åˆ«åœ¨è¶…å¹³é¢H1:$wx+b=+1$å’ŒH2:$wx+b=-1$.H1å’ŒH2å¹³è¡Œ,ä¸¤è€…ä¹‹é—´å½¢æˆä¸€æ¡é•¿å¸¦,é•¿å¸¦çš„å®½åº¦!ç§°$\frac{2}{||w||}$ä¸º<strong>é—´éš”</strong>,H1å’ŒH2ç§°ä¸º<strong>é—´éš”è¾¹ç•Œ</strong>.åœ¨å†³å®šåˆ†ç¦»è¶…å¹³é¢æ—¶åªæœ‰æ”¯æŒå‘é‡èµ·ä½œç”¨,æ‰€ä»¥æ”¯æŒå‘é‡æœºæ˜¯ç”±å¾ˆå°‘çš„â€é‡è¦çš„â€è®­ç»ƒæ ·æœ¬ç¡®å®šçš„.ç”±å¯¹å¶é—®é¢˜åŒæ ·å¯ä»¥å¾—åˆ°æ”¯æŒå‘é‡ä¸€å®šåœ¨é—´éš”è¾¹ç•Œä¸Š.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/support_vector.png" alt="avatar"></p>
<h5 id="å¯¹å¶ç®—æ³•"><a href="#å¯¹å¶ç®—æ³•" class="headerlink" title="å¯¹å¶ç®—æ³•"></a><strong>å¯¹å¶ç®—æ³•</strong></h5><p>å¼•è¿›æ‹‰æ ¼æœ—æ—¥ä¹˜å­,å®šä¹‰æ‹‰æ ¼æœ—æ—¥å‡½æ•°$L(w, b, \alpha)=\frac{1}{2}|w|^{2}-\sum_{i=1}^{N} \alpha_{i} y_{i}\left(w \cdot x_{i}+b\right)+\sum_{i=1}^{N} \alpha_{i}$,æ ¹æ®æ‹‰æ ¼æœ—æ—¥å¯¹å¶æ€§,åŸå§‹é—®é¢˜çš„å¯¹å¶é—®é¢˜æ˜¯æå¤§æå°é—®é¢˜:$\max _{\alpha} \min _{w, b} L(w, b, \alpha)$.å…ˆæ±‚å¯¹w,bçš„<strong>æå°å€¼</strong>.å°†$L(w,b,a)$åˆ†åˆ«å¯¹w,bæ±‚åå¯¼æ•°å¹¶ä»¤å…¶ç­‰äº0,å¾—</p>
<script type="math/tex; mode=display">
\begin{array}{l}
w=\sum_{i=1}^{N} \alpha_{i} y_{i} x_{i} \\
\sum_{i=1}^{N} \alpha_{i} y_{i}=0
\end{array}</script><p>,ä»£å…¥æ‹‰æ ¼æœ—æ—¥å‡½æ•°å¾—</p>
<script type="math/tex; mode=display">
\begin{aligned}
L(w, b, \alpha) &=\frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)-\sum_{i=1}^{N} \alpha_{i} y_{i}\left(\left(\sum_{j=1}^{N} \alpha_{j} y_{j} x_{j}\right) \cdot x_{i}+b\right)+\sum_{i=1}^{N} \alpha_{i} \\
&=-\frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)+\sum_{i=1}^{N} \alpha_{i}
\end{aligned}</script><p>è¿™å°±æ˜¯æå°å€¼.æ¥ä¸‹æ¥å¯¹æå°å€¼æ±‚å¯¹açš„æå¤§,å³æ˜¯<strong>å¯¹å¶é—®é¢˜</strong></p>
<script type="math/tex; mode=display">
\begin{array}{l}
\max _{a}-\frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)+\sum_{i=1}^{N} \alpha_{i} \\
\text { s.t. } \sum_{i=1}^{N} \alpha_{i} y_{i}=0 \\
\quad \alpha_{i} \geqslant 0, \quad i=1,2, \cdots, N
\end{array}</script><p>.å°†æ±‚æå¤§è½¬æ¢ä¸ºæ±‚æå°</p>
<script type="math/tex; mode=display">
\begin{array}{cl}
\min _{\alpha} & \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)-\sum_{i=1}^{N} \alpha_{i} \\
\text { s.t. } & \sum_{i=1}^{N} \alpha_{i} y_{i}=0 \\
& \alpha_{i} \geqslant 0, \quad i=1,2, \cdots, N
\end{array}</script><p>.ç”±<strong>KKTæ¡ä»¶</strong>æˆç«‹å¾—åˆ°</p>
<script type="math/tex; mode=display">
\begin{aligned}
&w^{*}=\sum_{i=1}^{N} \alpha_{i}^{*} y_{i} x_{i}\\
&b^{*}=y_{j}-\sum_{i=1}^{N} \alpha_{i}^{*} y_{i}\left(x_{i} \cdot x_{j}\right)
\end{aligned}</script><p>,å…¶ä¸­$j$ä¸ºä½¿$a_j^<em>&gt;0$çš„ä¸‹æ ‡ä¹‹ä¸€.æ‰€ä»¥é—®é¢˜å°±å˜ä¸ºæ±‚å¯¹å¶é—®é¢˜çš„è§£$a^</em>$,å†æ±‚å¾—åŸå§‹é—®é¢˜çš„è§£$w^<em>,b^</em>$,ä»è€Œå¾—åˆ†ç¦»è¶…å¹³é¢åŠåˆ†ç±»å†³ç­–å‡½æ•°å¯ä»¥çœ‹å‡º$w^<em>$å’Œ$b^</em>$éƒ½åªä¾èµ–è®­ç»ƒæ•°æ®ä¸­$a_i^<em>&gt;0$çš„æ ·æœ¬ç‚¹Z$(x_i,y_i)$,è¿™äº›å®ä¾‹ç‚¹$x_i$è¢«ç§°ä¸º<em>*æ”¯æŒå‘é‡</em></em>.</p>
<h4 id="çº¿æ€§æ”¯æŒå‘é‡æœº"><a href="#çº¿æ€§æ”¯æŒå‘é‡æœº" class="headerlink" title="çº¿æ€§æ”¯æŒå‘é‡æœº"></a><strong>çº¿æ€§æ”¯æŒå‘é‡æœº</strong></h4><p>å¦‚æœè®­ç»ƒæ•°æ®æ˜¯<strong>çº¿æ€§ä¸å¯åˆ†</strong>çš„(è¿‘ä¼¼çº¿æ€§å¯åˆ†),é‚£ä¹ˆä¸Šè¿°æ–¹æ³•ä¸­çš„ä¸ç­‰å¼çº¦æŸå¹¶ä¸èƒ½éƒ½æˆç«‹,éœ€è¦ä¿®æ”¹ç¡¬é—´éš”æœ€å¤§åŒ–,ä½¿å…¶æˆä¸º<strong>è½¯é—´éš”æœ€å¤§åŒ–</strong>.</p>
<h5 id="æ¾å¼›å˜é‡"><a href="#æ¾å¼›å˜é‡" class="headerlink" title="æ¾å¼›å˜é‡"></a>æ¾å¼›å˜é‡</h5><p>çº¿æ€§ä¸å¯åˆ†æ„å‘³ç€æŸäº›<strong>ç‰¹å¼‚ç‚¹</strong>ä¸èƒ½æ»¡è¶³å‡½æ•°é—´éš”å¤§äºç­‰äº1çš„çº¦æŸæ¡ä»¶,å¯ä»¥å¯¹æ¯ä¸ªæ ·æœ¬ç‚¹å¼•è¿›ä¸€ä¸ª<strong>æ¾å¼›å˜é‡</strong>,ä½¿å‡½æ•°é—´éš”åŠ ä¸Šæ¾å¼›å˜é‡å¤§äºç­‰äº1,çº¦æŸæ¡ä»¶å˜ä¸º$y_{i}\left(w \cdot x_{i}+b\right) \geqslant 1-\xi_{i}$,åŒæ—¶å¯¹æ¯ä¸ªæ¾å¼›å˜é‡,æ”¯ä»˜ä¸€ä¸ªä»£ä»·,ç›®æ ‡å‡½æ•°å˜ä¸º$\frac{1}{2}|w|^{2}+C \sum_{i=1}^{N} \xi_{i}$,å…¶ä¸­$C&gt;0$ç§°ä¸º<strong>æƒ©ç½šå‚æ•°</strong>,Cå€¼è¶Šå¤§å¯¹è¯¯åˆ†ç±»çš„æƒ©ç½šä¹Ÿè¶Šå¤§.æ–°ç›®æ ‡å‡½æ•°åŒ…å«äº†ä¸¤å±‚å«ä¹‰:ä½¿<strong>é—´éš”å°½é‡å¤§</strong>,åŒæ—¶ä½¿è¯¯åˆ†ç±»ç‚¹çš„<strong>ä¸ªæ•°å°½é‡å°</strong>.</p>
<h5 id="è½¯é—´éš”æœ€å¤§åŒ–"><a href="#è½¯é—´éš”æœ€å¤§åŒ–" class="headerlink" title="è½¯é—´éš”æœ€å¤§åŒ–"></a>è½¯é—´éš”æœ€å¤§åŒ–</h5><p>å­¦ä¹ é—®é¢˜å˜æˆå¦‚ä¸‹<strong>å‡¸äºŒæ¬¡è§„åˆ’</strong>é—®é¢˜:</p>
<script type="math/tex; mode=display">
\min _{w, b, k} \frac{1}{2}\|w\|^{2}+C \sum_{i=1}^{N} \xi_{i} \\
s.t. \quad y_{i}\left(w \cdot x_{i}+b\right) \geqslant 1-\xi_{i}, \quad i=1,2, \cdots, N \\
\xi_{i} \geqslant 0, \quad i=1,2, \cdots, N</script><p>,å¯ä»¥è¯æ˜wçš„è§£æ˜¯å”¯ä¸€çš„,ä½†bçš„è§£å­˜åœ¨ä¸€ä¸ª<strong>åŒºé—´</strong>.çº¿æ€§æ”¯æŒå‘é‡æœºåŒ…å«çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœº,å› æ­¤<strong>é€‚ç”¨æ€§æ›´å¹¿</strong>.</p>
<h5 id="å¯¹å¶ç®—æ³•-1"><a href="#å¯¹å¶ç®—æ³•-1" class="headerlink" title="å¯¹å¶ç®—æ³•"></a>å¯¹å¶ç®—æ³•</h5><p>åŸå§‹é—®é¢˜çš„å¯¹å¶é—®é¢˜æ˜¯,æ„é€ <strong>æ‹‰æ ¼æœ—æ—¥å‡½æ•°</strong> $L(w, b, \xi, \alpha, \mu) \equiv \frac{1}{2}|w|^{2}+C \sum_{i=1}^{N} \xi_{i}-\sum_{i=1}^{N} \alpha_{i}\left(y_{i}\left(w \cdot x_{i}+b\right)-1+\xi_{i}\right)-\sum_{i=1}^{N} \mu_{i} \xi_{i}$ ï¼Œå…ˆæ±‚å¯¹w,b,Î¾çš„<strong>æå°å€¼</strong>,åˆ†åˆ«æ±‚åå¯¼å¹¶ä»¤å¯¼æ•°ä¸º0,å¾—</p>
<script type="math/tex; mode=display">
\begin{aligned}
&w=\sum_{i=1} \alpha_{i} y_{i} x_{i}\\
&\sum_{i=1}^{N} \alpha_{i} y_{i}=0\\
&C-\alpha_{i}-\mu_{i}=0
\end{aligned}</script><p>,ä»£å…¥åŸå‡½æ•°,å†å¯¹æå°å€¼æ±‚açš„<strong>æå¤§å€¼</strong>,å¾—åˆ°</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\max _{a}-\frac{1}{2} \sum_{i=1}^{N} \sum_{i=1}^{N} \alpha_{i} \alpha, y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)+\sum_{i=1}^{N} \alpha_{i}\\
&\text { s.t. } \quad \sum_{i=1}^{N} \alpha_{i} y_{i}=0\\
&\begin{array}{l}
C-\alpha_{i}-\mu_{i}=0 \\
\alpha_{i} \geqslant 0 \\
\mu_{i} \geqslant 0, \quad i=1,2, \cdots, N
\end{array}
\end{aligned}</script><p>,åˆ©ç”¨åä¸‰æ¡çº¦æŸ<strong>æ¶ˆå»Î¼</strong>,å†å°†æ±‚æå¤§è½¬æ¢ä¸º<strong>æ±‚æå°</strong>,å¾—åˆ°<strong>å¯¹å¶é—®é¢˜</strong></p>
<script type="math/tex; mode=display">
\begin{aligned}
&\min _{\alpha} \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)-\sum_{i=1}^{N} \alpha_{i}\\
&\text { s.t. } \quad \sum_{i=1}^{N} \alpha_{i} y_{i}=0\\
&0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2, \cdots, N
\end{aligned}</script><p>ç”±<strong>KKTæ¡ä»¶</strong>æˆç«‹å¯ä»¥å¾—åˆ°</p>
<script type="math/tex; mode=display">
\begin{array}{c}
w^{*}=\sum_{i=1}^{N} \alpha_{i}^{*} y_{i} x_{i} \\
b^{*}=y_{j}-\sum_{i=1}^{N} y_{i} \alpha_{i}^{*}\left(x_{i} \cdot x_{j}\right)
\end{array}</script><p>$j$æ˜¯æ»¡è¶³$0&lt;\alpha_j^<em><C$çš„ä¸‹æ ‡ä¹‹ä¸€.é—®é¢˜å°±å˜ä¸ºé€‰æ‹©æƒ©ç½šå‚æ•°$C>0$,æ±‚å¾—å¯¹å¶é—®é¢˜(<strong>å‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜</strong>)çš„**æœ€ä¼˜è§£$\alpha^</C$çš„ä¸‹æ ‡ä¹‹ä¸€.é—®é¢˜å°±å˜ä¸ºé€‰æ‹©æƒ©ç½šå‚æ•°$C></em>$<strong>,ä»£å…¥è®¡ç®—$w^<em>$å’Œ$b^</em>$,æ±‚å¾—åˆ†ç¦»è¶…å¹³é¢å’Œåˆ†ç±»å†³ç­–å‡½æ•°.å› ä¸º$b$çš„è§£å¹¶ä¸å”¯ä¸€,æ‰€ä»¥å®é™…è®¡ç®—$b^*$æ—¶å¯ä»¥å–æ‰€æœ‰æ ·æœ¬ç‚¹ä¸Šçš„</strong>å¹³å‡å€¼**.</p>
<h5 id="æ”¯æŒå‘é‡"><a href="#æ”¯æŒå‘é‡" class="headerlink" title="æ”¯æŒå‘é‡"></a>æ”¯æŒå‘é‡</h5><p>åœ¨<strong>çº¿æ€§ä¸å¯åˆ†</strong>çš„æƒ…å†µä¸‹,å°†å¯¹åº”ä¸$\alpha_i^<em>&gt;0$çš„æ ·æœ¬ç‚¹$(x_i,y_i)$çš„å®ä¾‹ç‚¹$x_i$ç§°ä¸º<em>*æ”¯æŒå‘é‡</em></em>.è½¯é—´éš”çš„æ”¯æŒå‘é‡æˆ–è€…åœ¨é—´éš”è¾¹ç•Œä¸Š,æˆ–è€…åœ¨é—´éš”è¾¹ç•Œä¸åˆ†ç±»è¶…å¹³é¢ä¹‹é—´,æˆ–è€…å†åˆ†ç¦»è¶…å¹³é¢è¯¯åˆ†ä¸€ä¾§.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/support_soft.png" alt="avatar"></p>
<h5 id="åˆé¡µæŸå¤±"><a href="#åˆé¡µæŸå¤±" class="headerlink" title="åˆé¡µæŸå¤±"></a>åˆé¡µæŸå¤±</h5><p>å¯ä»¥è®¤ä¸ºæ˜¯0-1æŸå¤±å‡½æ•°çš„ä¸Šç•Œ,è€Œçº¿æ€§æ”¯æŒå‘é‡æœºå¯ä»¥è®¤ä¸ºæ˜¯ä¼˜åŒ–åˆé¡µæŸå¤±å‡½æ•°æ„æˆçš„ç›®æ ‡å‡½æ•°.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/0_1loss.png" alt="avatar"></p>
<h4 id="éçº¿æ€§æ”¯æŒå‘é‡æœº"><a href="#éçº¿æ€§æ”¯æŒå‘é‡æœº" class="headerlink" title="éçº¿æ€§æ”¯æŒå‘é‡æœº"></a><strong>éçº¿æ€§æ”¯æŒå‘é‡æœº</strong></h4><p>å¦‚æœåˆ†ç±»é—®é¢˜æ˜¯<strong>éçº¿æ€§</strong>çš„,å°±è¦ä½¿ç”¨<strong>éçº¿æ€§æ”¯æŒå‘é‡æœº</strong>.ä¸»è¦ç‰¹ç‚¹æ˜¯ä½¿ç”¨<strong>æ ¸æŠ€å·§</strong>.</p>
<h5 id="éçº¿æ€§åˆ†ç±»é—®é¢˜"><a href="#éçº¿æ€§åˆ†ç±»é—®é¢˜" class="headerlink" title="éçº¿æ€§åˆ†ç±»é—®é¢˜"></a><strong>éçº¿æ€§åˆ†ç±»é—®é¢˜</strong></h5><p>ç”¨çº¿æ€§åˆ†ç±»æ–¹æ³•æ±‚è§£éçº¿æ€§åˆ†ç±»é—®é¢˜åˆ†ä¸ºä¸¤æ­¥:é¦–å…ˆä½¿ç”¨ä¸€ä¸ªå˜æ¢å°†åŸç©ºé—´çš„æ•°æ®æ˜ å°„åˆ°æ–°ç©ºé—´,ç„¶ååœ¨æ–°ç©ºé—´é‡Œç”¨çº¿æ€§åˆ†ç±»å­¦ä¹ æ–¹æ³•ä»è®­ç»ƒæ•°æ®ä¸­å­¦ä¹ åˆ†ç±»æ¨¡å‹.</p>
<h5 id="æ ¸å‡½æ•°"><a href="#æ ¸å‡½æ•°" class="headerlink" title="æ ¸å‡½æ•°"></a><strong>æ ¸å‡½æ•°</strong></h5><p>è®¾Xæ˜¯<strong>è¾“å…¥ç©ºé—´</strong>(æ¬§å¼ç©ºé—´çš„å­é›†æˆ–ç¦»æ•£é›†åˆ),Hä¸º<strong>ç‰¹å¾ç©ºé—´</strong>(å¸Œå°”ä¼¯ç‰¹ç©ºé—´),ä¸€èˆ¬æ˜¯<strong>é«˜ç»´</strong>ç”šè‡³æ— ç©·ç»´çš„.å¦‚æœå­˜åœ¨ä¸€ä¸ªä»Xåˆ°Hçš„æ˜ å°„$\phi(x): \mathcal{X} \rightarrow \mathcal{H}$ä½¿å¾—å¯¹æ‰€æœ‰x,zå±äºX,å‡½æ•°K(x,z)æ»¡è¶³æ¡ä»¶$K(x, z)=\phi(x) \cdot \phi(z)$,ç‚¹ä¹˜ä»£è¡¨<strong>å†…ç§¯</strong>,åˆ™ç§°K(x,z)ä¸º<strong>æ ¸å‡½æ•°</strong>.</p>
<h5 id="æ ¸æŠ€å·§-1"><a href="#æ ¸æŠ€å·§-1" class="headerlink" title="æ ¸æŠ€å·§"></a><strong>æ ¸æŠ€å·§</strong></h5><p>åŸºæœ¬æ€æƒ³æ˜¯é€šè¿‡ä¸€ä¸ª<strong>éçº¿æ€§å˜æ¢</strong>å°†è¾“å…¥ç©ºé—´å¯¹åº”äºä¸€ä¸ª<strong>ç‰¹å¾ç©ºé—´</strong>,ä½¿å¾—åœ¨è¾“å…¥ç©ºé—´ä¸­çš„<strong>è¶…æ›²é¢æ¨¡å‹</strong>å¯¹åº”äºç‰¹å¾ç©ºé—´ä¸­çš„<strong>è¶…å¹³é¢æ¨¡å‹</strong>(æ”¯æŒå‘é‡æœº).åœ¨å­¦ä¹ å’Œé¢„æµ‹ä¸­åªå®šä¹‰æ ¸å‡½æ•°$K(x,z)$,è€Œ<strong>ä¸æ˜¾å¼</strong>åœ°å®šä¹‰æ˜ å°„å‡½æ•°.å¯¹äºç»™å®šçš„æ ¸$K(x,z)$,ç‰¹å¾ç©ºé—´å’Œæ˜ å°„å‡½æ•°çš„å–æ³•å¹¶<strong>ä¸å”¯ä¸€</strong>.æ³¨æ„åˆ°åœ¨çº¿æ€§æ”¯æŒå‘é‡æœºçš„å¯¹å¶é—®é¢˜ä¸­,ç›®æ ‡å‡½æ•°å’Œå†³ç­–å‡½æ•°éƒ½åªæ¶‰åŠè¾“å…¥å®ä¾‹ä¸å®ä¾‹ä¹‹é—´çš„<strong>å†…ç§¯</strong>,$x_i,x_j$å¯ä»¥ç”¨æ ¸å‡½æ•°$K(x_i,x_j)=\phi (x_i)\phi (x_j)$æ¥<strong>ä»£æ›¿</strong>.å½“æ˜ å°„å‡½æ•°æ˜¯éçº¿æ€§å‡½æ•°æ—¶,å­¦ä¹ åˆ°çš„å«æœ‰æ ¸å‡½æ•°çš„æ”¯æŒå‘é‡æœºæ˜¯éçº¿æ€§åˆ†ç±»æ¨¡å‹.åœ¨å®é™…åº”ç”¨ä¸­,å¾€å¾€ä¾èµ–é¢†åŸŸçŸ¥è¯†<strong>ç›´æ¥é€‰æ‹©</strong>æ ¸å‡½æ•°.</p>
<h5 id="æ­£å®šæ ¸"><a href="#æ­£å®šæ ¸" class="headerlink" title="æ­£å®šæ ¸"></a><strong>æ­£å®šæ ¸</strong></h5><p>é€šå¸¸æ‰€è¯´çš„æ ¸å‡½æ•°æ˜¯æŒ‡<strong>æ­£å®šæ ¸å‡½æ•°</strong>.åªè¦æ»¡è¶³æ­£å®šæ ¸çš„å……è¦æ¡ä»¶,é‚£ä¹ˆç»™å®šçš„å‡½æ•°K(x,z)å°±æ˜¯æ­£å®šæ ¸å‡½æ•°.è®¾Kæ˜¯å®šä¹‰åœ¨X<em>Xä¸Šçš„<strong>å¯¹ç§°å‡½æ•°</strong>,å¦‚æœä»»æ„xiå±äºX,K(x,z)å¯¹åº”çš„<strong>GramçŸ©é˜µ</strong>$K=\left[K\left(x_{i}, x_{j}\right)\right]_{mxm}$æ˜¯<em>*åŠæ­£å®šçŸ©é˜µ</em></em>,åˆ™ç§°$K(x,z)$æ˜¯æ­£å®šæ ¸.è¿™ä¸€å®šä¹‰åœ¨æ„é€ æ ¸å‡½æ•°æ—¶å¾ˆæœ‰ç”¨,ä½†è¦éªŒè¯ä¸€ä¸ªå…·ä½“å‡½æ•°æ˜¯å¦ä¸ºæ­£å®šæ ¸å‡½æ•°å¹¶ä¸å®¹æ˜“,æ‰€ä»¥åœ¨å®é™…é—®é¢˜ä¸­å¾€å¾€åº”ç”¨å·²æœ‰çš„æ ¸å‡½æ•°.</p>
<h5 id="ç®—æ³•-4"><a href="#ç®—æ³•-4" class="headerlink" title="ç®—æ³•"></a><strong>ç®—æ³•</strong></h5><p>é€‰å–é€‚å½“çš„æ ¸å‡½æ•°K(x,z)å’Œé€‚å½“çš„å‚æ•°C,å°†çº¿æ€§æ”¯æŒå‘é‡æœºå¯¹å¶å½¢å¼ä¸­çš„å†…ç§¯æ¢æˆæ ¸å‡½æ•°,æ„é€ å¹¶æ±‚è§£æœ€ä¼˜åŒ–é—®é¢˜</p>
<script type="math/tex; mode=display">
\min _{a} \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j} K\left(x_{i}, x_{j}\right)-\sum_{i=1}^{N} \alpha_{i} \\
s.t. \quad \sum_{i=1}^{N} \alpha_{i} y_{i}=0 \\
0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2, \cdots, N</script><p>,é€‰æ‹©æœ€ä¼˜è§£$a^<em>$çš„ä¸€ä¸ªæ­£åˆ†é‡$0&lt;a_j^</em>&lt;C$è®¡ç®—$b^{<em>}=y_{j}-\sum_{i=1}^{N} \alpha_{i}^{</em>} y_{i} K\left(x_{i} \cdot x_{j}\right)$,æ„é€ å†³ç­–å‡½æ•°$f(x)=\operatorname{sign}\left(\sum_{i=1}^{N} \alpha_{i}^{<em>} y_{i} K\left(x \cdot x_{i}\right)+b^{</em>}\right)$</p>
<h5 id="å¸¸ç”¨æ ¸å‡½æ•°"><a href="#å¸¸ç”¨æ ¸å‡½æ•°" class="headerlink" title="å¸¸ç”¨æ ¸å‡½æ•°"></a><strong>å¸¸ç”¨æ ¸å‡½æ•°</strong></h5><ol>
<li><strong>å¤šé¡¹å¼æ ¸å‡½æ•°(polynomial kernel function)</strong> :$K(x, z)=(x \cdot z+1)^{p}$,å¯¹åº”çš„æ”¯æŒå‘é‡æœºæ˜¯ä¸€ä¸ªpæ¬¡å¤šé¡¹å¼åˆ†ç±»å™¨,åˆ†ç±»å†³ç­–å‡½æ•°ä¸º:$f(x)=\operatorname{sign}\left(\sum_{i=1}^{N_{i}} a_{i}^{<em>} y_{i}\left(x_{i} \cdot x+1\right)^{p}+b^{</em>}\right)$</li>
<li><strong>é«˜æ–¯æ ¸å‡½æ•°(Gaussian krenel function)</strong> :$K(x, z)=\exp \left(-\frac{|x-z|^{2}}{2 \sigma^{2}}\right)$ ,å¯¹åº”çš„æ”¯æŒå‘é‡æœºæ˜¯é«˜æ–¯å¾„å‘åŸºå‡½æ•°(RBF)åˆ†ç±»å™¨.åˆ†ç±»å†³ç­–å‡½æ•°ä¸º$f(x)=\operatorname{sign}\left(\sum_{i=1}^{N_{t}} a_{i}^{<em>} y_{i} \exp \left(-\frac{|x-z|^{2}}{2 \sigma^{2}}\right)+b^{</em>}\right)$</li>
<li><strong>å­—ç¬¦ä¸²æ ¸å‡½æ•°(string kernel function)</strong>: æ ¸å‡½æ•°ä¸ä»…å¯ä»¥å®šä¹‰åœ¨æ¬§æ°ç©ºé—´ä¸Š,è¿˜å¯ä»¥å®šä¹‰åœ¨<strong>ç¦»æ•£æ•°æ®çš„é›†åˆ</strong>ä¸Š.å­—ç¬¦ä¸²æ ¸å‡½æ•°ç»™å‡ºäº†å­—ç¬¦ä¸²ä¸­é•¿åº¦ç­‰äºnçš„æ‰€æœ‰å­ä¸²ç»„æˆçš„ç‰¹å¾å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦.</li>
</ol>
<h5 id="åºåˆ—æœ€å°æœ€ä¼˜åŒ–-SMO-ç®—æ³•"><a href="#åºåˆ—æœ€å°æœ€ä¼˜åŒ–-SMO-ç®—æ³•" class="headerlink" title="åºåˆ—æœ€å°æœ€ä¼˜åŒ–(SMO)ç®—æ³•"></a><strong>åºåˆ—æœ€å°æœ€ä¼˜åŒ–(SMO)ç®—æ³•</strong></h5><p>SMOæ˜¯ä¸€ç§<em>å¿«é€Ÿæ±‚è§£å‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜</em></p>
<script type="math/tex; mode=display">
\begin{aligned}
&\min _{\alpha} \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j} K\left(x_{i}, x_{j}\right)-\sum_{i=1}^{N} \alpha_{i}\\
&\text { s.t. } \quad \sum_{i=1}^{N} \alpha_{i} y_{i}=0\\
&0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2, \cdots, N
\end{aligned}</script><p>çš„ç®—æ³•.åŸºæœ¬æ€è·¯æ˜¯:å¦‚æœæ‰€æœ‰å˜é‡éƒ½æ»¡è¶³æ­¤ä¼˜åŒ–é—®é¢˜çš„KKTæ¡ä»¶,é‚£ä¹ˆè§£å°±å¾—åˆ°äº†.å¦åˆ™,é€‰æ‹©<strong>ä¸¤ä¸ªå˜é‡</strong>,å›ºå®šå…¶ä»–å˜é‡,é’ˆå¯¹è¿™ä¸¤ä¸ªå˜é‡æ„å»ºä¸€ä¸ªäºŒæ¬¡è§„åˆ’é—®é¢˜.ä¸æ–­åœ°å°†åŸé—®é¢˜åˆ†è§£ä¸º<strong>å­é—®é¢˜</strong>å¹¶å¯¹å­é—®é¢˜æ±‚è§£,å°±å¯ä»¥æ±‚è§£åŸé—®é¢˜.æ³¨æ„å­é—®é¢˜ä¸¤ä¸ªå˜é‡ä¸­åªæœ‰ä¸€ä¸ªæ˜¯<strong>è‡ªç”±å˜é‡</strong>,å¦ä¸€ä¸ªç”±<strong>ç­‰å¼çº¦æŸ</strong>ç¡®å®š.</p>
<h5 id="ä¸¤ä¸ªå˜é‡äºŒæ¬¡è§„åˆ’çš„æ±‚è§£æ–¹æ³•"><a href="#ä¸¤ä¸ªå˜é‡äºŒæ¬¡è§„åˆ’çš„æ±‚è§£æ–¹æ³•" class="headerlink" title="ä¸¤ä¸ªå˜é‡äºŒæ¬¡è§„åˆ’çš„æ±‚è§£æ–¹æ³•"></a><strong>ä¸¤ä¸ªå˜é‡äºŒæ¬¡è§„åˆ’çš„æ±‚è§£æ–¹æ³•</strong></h5><p>å‡è®¾é€‰æ‹©çš„ä¸¤ä¸ªå˜é‡æ˜¯a1,a2,å…¶ä»–å˜é‡æ˜¯å›ºå®šçš„,äºæ˜¯å¾—åˆ°å­é—®é¢˜</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\begin{aligned}
\min _{\alpha, \alpha_{i}} W\left(\alpha_{1}, \alpha_{2}\right)=& \frac{1}{2} K_{11} \alpha_{1}^{2}+\frac{1}{2} K_{22} \alpha_{2}^{2}+y_{1} y_{2} K_{12} \alpha_{1} \alpha_{2} \\
&-\left(\alpha_{1}+\alpha_{2}\right)+y_{1} \alpha_{1} \sum_{i=1}^{N} y_{i} \alpha_{i} K_{n}+y_{2} \alpha_{2} \sum_{i=1}^{N} y_{i} \alpha_{i} K_{i}
\end{aligned}\\
&\text { s.t. } \quad \alpha_{1} y_{1}+\alpha_{2} y_{2}=-\sum_{i=3}^{N} y_{i} \alpha_{i}=\zeta\\
&0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2
\end{aligned}</script><p>,$\epsilon$æ˜¯å¸¸æ•°,ç›®æ ‡å‡½æ•°å¼çœç•¥äº†ä¸å«$a_1,a_2$çš„å¸¸æ•°é¡¹.è€ƒè™‘ä¸ç­‰å¼çº¦æŸå’Œç­‰å¼çº¦æŸ,è¦æ±‚çš„æ˜¯ç›®æ ‡å‡½æ•°åœ¨ä¸€æ¡å¹³è¡Œäºå¯¹è§’çº¿çš„çº¿æ®µä¸Šçš„æœ€ä¼˜å€¼</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/1.png" alt="avatar"></p>
<p>é—®é¢˜å˜ä¸º<strong>å•å˜é‡</strong>çš„æœ€ä¼˜åŒ–é—®é¢˜.å‡è®¾åˆå§‹å¯è¡Œè§£ä¸ºaold,æœ€ä¼˜è§£ä¸ºanew,è€ƒè™‘æ²¿ç€çº¦æŸæ–¹å‘æœªç»å‰ªè¾‘çš„æœ€ä¼˜è§£anew,unc(å³æœªè€ƒè™‘ä¸ç­‰å¼çº¦æŸ).å¯¹è¯¥é—®é¢˜æ±‚åå¯¼æ•°,å¹¶ä»¤å¯¼æ•°ä¸º0,ä»£å…¥åŸå¼,ä»¤$E_{i}=g\left(x_{i}\right)-y_{i}=\left(\sum_{j=1}^{N} \alpha, y_{j} K\left(x_{j}, x_{i}\right)+b\right)-y_{i}, \quad i=1,2$,å¾—åˆ°$\alpha_{2}^{\text {new, } \text { unc }}=\alpha_{2}^{\text {old }}+\frac{y_{2}\left(E_{1}-E_{2}\right)}{\eta}$,ç»å‰ªè¾‘åa2çš„è§£æ˜¯</p>
<script type="math/tex; mode=display">
\alpha_{2}^{\text {new }}=\left\{\begin{array}{ll}H, & \alpha_{2}^{\text {new }, \text { unc }}>H \\ \alpha_{2}^{\text {new }, \text { unc }}, & L \leqslant \alpha_{2}^{\text {new}, \text { unc}} \leqslant H \\ L, & \alpha_{2}^{\text {new }, \text { unc }}<L\end{array}\right.</script><p>Lä¸Hæ˜¯$a_2^{new}$æ‰€åœ¨çš„å¯¹è§’çº¿æ®µç«¯ç‚¹çš„ç•Œ.å¹¶è§£å¾—$\alpha_{1}^{\mathrm{new}}=\alpha_{1}^{\mathrm{old}}+y_{1} y_{2}\left(\alpha_{2}^{\mathrm{old}}-\alpha_{2}^{\mathrm{new}}\right)$</p>
<h5 id="å˜é‡çš„é€‰æ‹©æ–¹æ³•"><a href="#å˜é‡çš„é€‰æ‹©æ–¹æ³•" class="headerlink" title="å˜é‡çš„é€‰æ‹©æ–¹æ³•"></a><strong>å˜é‡çš„é€‰æ‹©æ–¹æ³•</strong></h5><p>åœ¨æ¯ä¸ªå­é—®é¢˜ä¸­é€‰æ‹©ä¸¤ä¸ªå˜é‡ä¼˜åŒ–,å…¶ä¸­è‡³å°‘ä¸€ä¸ªå˜é‡æ˜¯è¿åKKTæ¡ä»¶çš„.ç¬¬ä¸€ä¸ªå˜é‡çš„é€‰å–æ ‡å‡†æ˜¯<strong>è¿åKKTæ¡ä»¶æœ€ä¸¥é‡</strong>çš„æ ·æœ¬ç‚¹,ç¬¬äºŒä¸ªå˜é‡çš„é€‰å–æ ‡å‡†æ˜¯å¸Œæœ›èƒ½ä½¿è¯¥å˜é‡æœ‰<strong>è¶³å¤Ÿå¤§çš„å˜åŒ–</strong>,ä¸€èˆ¬å¯ä»¥é€‰å–ä½¿å¯¹åº”çš„$|E1-E2|$æœ€å¤§çš„ç‚¹.åœ¨æ¯æ¬¡é€‰å–å®Œç‚¹å,<strong>æ›´æ–°</strong>é˜ˆå€¼$b$å’Œå·®å€¼$Ei$.</p>
<h3 id="æå‡æ–¹æ³•"><a href="#æå‡æ–¹æ³•" class="headerlink" title="æå‡æ–¹æ³•"></a>æå‡æ–¹æ³•</h3><h4 id="æå‡æ–¹æ³•-1"><a href="#æå‡æ–¹æ³•-1" class="headerlink" title="æå‡æ–¹æ³•"></a>æå‡æ–¹æ³•</h4><p>boostingæ˜¯<strong>ä¸€ç§å¸¸ç”¨çš„ç»Ÿè®¡å­¦ä¹ æ–¹æ³•,æ˜¯é›†æˆå­¦ä¹ çš„ä¸€ç§.å®ƒé€šè¿‡æ”¹å˜è®­ç»ƒæ ·æœ¬çš„æƒé‡(æ¦‚ç‡åˆ†å¸ƒ),å­¦ä¹ </strong>å¤šä¸ª<strong>å¼±åˆ†ç±»å™¨(åŸºæœ¬åˆ†ç±»å™¨),å¹¶å°†è¿™äº›åˆ†ç±»å™¨</strong>çº¿æ€§ç»„åˆ**æ¥æ„æˆä¸€ä¸ªå¼ºåˆ†ç±»å™¨æé«˜åˆ†ç±»çš„æ€§èƒ½.</p>
<h4 id="åŠ æ³•æ¨¡å‹å’Œå‰å‘åˆ†æ­¥ç®—æ³•"><a href="#åŠ æ³•æ¨¡å‹å’Œå‰å‘åˆ†æ­¥ç®—æ³•" class="headerlink" title="åŠ æ³•æ¨¡å‹å’Œå‰å‘åˆ†æ­¥ç®—æ³•"></a>åŠ æ³•æ¨¡å‹å’Œå‰å‘åˆ†æ­¥ç®—æ³•</h4><p>åŠ æ³•æ¨¡å‹$f(x)= \sum_{m=1}^M{\beta_mb(x;\gamma_m)}$,å…¶ä¸­ï¼Œ$b(x;\gamma_m)$ä¸ºåŸºå‡½æ•°ï¼Œ$\gamma_m$ä¸ºåŸºå‡½æ•°å‚æ•°ï¼Œ$\beta_m$ä¸ºåŸºå‡½æ•°çš„ç³»æ•°ã€‚åœ¨ç»™å®šè®­ç»ƒæ•°æ®åŠæŸå¤±å‡½æ•°$L(y,f(x))$çš„æ¡ä»¶ä¸‹ï¼Œå­¦ä¹ åŠ æ³•æ¨¡å‹$f(x)$æˆä¸ºç»éªŒé£é™©æå°åŒ–å³æŸå¤±å‡½æ•°æå°åŒ–é—®é¢˜ï¼š</p>
<script type="math/tex; mode=display">
min_{\beta_m,\gamma_m}\sum_{m=1}^{M}{\beta_m b(x_i;\gamma_m)}</script><p>é€šå¸¸è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ä¼˜åŒ–é—®é¢˜ã€‚</p>
<p>å‰å‘åˆ†æ­¥ç®—æ³•æ±‚è§£è¿™ä¸€ä¼˜åŒ–é—®é¢˜çš„æƒ³æ³•æ˜¯ï¼šå› ä¸ºå­¦ä¹ çš„æ˜¯åŠ æ³•æ¨¡å‹ï¼Œå¦‚æœèƒ½å¤Ÿä»å‰å‘åï¼Œæ¯ä¸€æ­¥åªå­¦ä¹ ä¸€ä¸ªåŸºå‡½æ•°åŠå…¶ç³»æ•°ï¼š$\left(\beta_{m}, \gamma_{m}\right)=\arg \min _{\beta, y} \sum_{i=1}^{N} L\left(y_{i}, f_{m-1}\left(x_{i}\right)+\beta b\left(x_{i} ; \gamma\right)\right)$ï¼Œå¾—åˆ°å‚æ•°Î²må’ŒÎ³m,æ›´æ–°$f_{m}(x)=f_{m-1}(x)+\beta_{m} b\left(x ; \gamma_{m}\right)$,é€æ­¥é€¼è¿‘ä¼˜åŒ–ç›®æ ‡å‡½æ•°å¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç®€åŒ–ä¼˜åŒ–çš„å¤æ‚åº¦ï¼Œæœ€ç»ˆå¾—åˆ°åŠ æ³•æ¨¡å‹ã€‚</p>
<h4 id="AdaBoost"><a href="#AdaBoost" class="headerlink" title="AdaBoost"></a><strong>AdaBoost</strong></h4><h5 id="æ€æƒ³ï¼š"><a href="#æ€æƒ³ï¼š" class="headerlink" title="æ€æƒ³ï¼š"></a>æ€æƒ³ï¼š</h5><p>AdaBoostæé«˜é‚£äº›è¢«å‰ä¸€è½®å¼±åˆ†ç±»å™¨é”™è¯¯åˆ†ç±»æ ·æœ¬çš„æƒå€¼,è€Œé™ä½é‚£äº›è¢«æ­£ç¡®åˆ†ç±»æ ·æœ¬çš„æƒå€¼.ç„¶åé‡‡å–<strong>åŠ æƒå¤šæ•°è¡¨å†³</strong>çš„æ–¹æ³•ç»„åˆå¼±åˆ†ç±»å™¨.</p>
<h5 id="ç®—æ³•-5"><a href="#ç®—æ³•-5" class="headerlink" title="ç®—æ³•"></a><strong>ç®—æ³•</strong></h5><p>é¦–å…ˆå‡è®¾è®­ç»ƒæ•°æ®é›†å…·æœ‰å‡åŒ€çš„æƒå€¼åˆ†å¸ƒD1,ä½¿ç”¨å…·æœ‰<strong>æƒå€¼åˆ†å¸ƒ</strong>Dmçš„è®­ç»ƒæ•°æ®é›†å­¦ä¹ å¾—åˆ°<strong>åŸºæœ¬åˆ†ç±»å™¨</strong>Gm(x),è®¡ç®—<strong>åˆ†ç±»è¯¯å·®ç‡</strong>$e_{m}=P\left(G_{m}\left(x_{i}\right) \neq y_{i}\right)=\sum_{i=1}^{N} w_{m i} I\left(G_{m}\left(x_{i}\right) \neq y_{i}\right)$å’ŒGm(x)çš„<strong>ç³»æ•°</strong>$\alpha_{m}=\frac{1}{2} \log \frac{1-e_{m}}{e_{m}}$,æ›´æ–°è®­ç»ƒæ•°æ®é›†çš„æƒå€¼åˆ†å¸ƒ$D_{m+1}=\left(w_{m+1,1}, \cdots, w_{m+1, i}, \cdots, w_{m+1, N}\right)$ï¼Œå…¶ä¸­</p>
<script type="math/tex; mode=display">
w_{m+1, i}=\left\{\begin{array}{ll}
\frac{w_{mi}}{Z_{m}} \mathrm{e}^{-\alpha_{m}}, & G_{m}\left(x_{i}\right)=y_{i} \\
\frac{w_{m i}}{Z_{m}} \mathrm{e}^{\alpha_{m}}, & G_{m}\left(x_{i}\right) \neq y_{i}
\end{array}\right.</script><p>$Z_m$æ˜¯ä½¿Dm+1æˆä¸ºæ¦‚ç‡åˆ†å¸ƒçš„<strong>è§„èŒƒåŒ–å› å­</strong>$Z_{m}=\sum_{i=1}^{N} w_{m i} \exp \left(-\alpha_{m} y_{i} G_{m}\left(x_{i}\right)\right)$.é‡å¤ä¸Šè¿°æ“ä½œMæ¬¡åå¾—åˆ°Mä¸ªå¼±åˆ†ç±»å™¨,æ„å»ºçº¿æ€§ç»„åˆå¾—åˆ°<strong>æœ€ç»ˆåˆ†ç±»å™¨</strong>$G(x)=\operatorname{sign}(f(x))=\operatorname{sign}\left(\sum_{m=1}^{M} \alpha_{m} G_{m}(x)\right)$</p>
<h4 id="æå‡æ ‘"><a href="#æå‡æ ‘" class="headerlink" title="æå‡æ ‘"></a><strong>æå‡æ ‘</strong></h4><p>æå‡æ ‘æ˜¯æ¨¡å‹ä¸ºåŠ æ³•æ¨¡å‹,ç®—æ³•ä¸ºå‰å‘åˆ†å¸ƒç®—æ³•,åŸºå‡½æ•°ä¸º<strong>å†³ç­–æ ‘</strong>çš„æå‡æ–¹æ³•.ç¬¬mæ­¥çš„æ¨¡å‹æ˜¯$f_{m}(x)=f_{m-1}(x)+T\left(x ; \Theta_{m}\right)$,é€šè¿‡ç»éªŒé£é™©æå°åŒ–ç¡®å®šä¸‹ä¸€æ£µå†³ç­–æ ‘çš„å‚æ•°$\hat{\Theta}_{m}=\arg \min _{\theta_{m}} \sum_{i=1}^{N} L\left(y_{i}, f_{m-1}\left(x_{i}\right)+T\left(x_{i} ; \Theta_{m}\right)\right)$.ä¸åŒé—®é¢˜çš„æå‡æ ‘å­¦ä¹ ç®—æ³•ä¸»è¦åŒºåˆ«åœ¨äºä½¿ç”¨çš„<strong>æŸå¤±å‡½æ•°</strong>ä¸åŒ.</p>
<h5 id="äºŒç±»åˆ†ç±»é—®é¢˜"><a href="#äºŒç±»åˆ†ç±»é—®é¢˜" class="headerlink" title="äºŒç±»åˆ†ç±»é—®é¢˜"></a><strong>äºŒç±»åˆ†ç±»é—®é¢˜</strong></h5><p>åªéœ€å°†AdaBoostç®—æ³•ä¸­çš„åŸºæœ¬åˆ†ç±»å™¨é™åˆ¶ä¸ºäºŒç±»åˆ†ç±»æ•°å³å¯.</p>
<h5 id="å›å½’é—®é¢˜"><a href="#å›å½’é—®é¢˜" class="headerlink" title="å›å½’é—®é¢˜"></a><strong>å›å½’é—®é¢˜</strong></h5><p>å¦‚æœå°†è¾“å…¥ç©ºé—´åˆ’åˆ†ä¸ºJä¸ªäº’ä¸ç›¸äº¤çš„åŒºåŸŸ,å¹¶ä¸”åœ¨æ¯ä¸ªåŒºåŸŸä¸Šç¡®å®šè¾“å‡ºçš„å¸¸é‡$C_j$,é‚£ä¹ˆæ ‘å¯è¡¨ç¤ºä¸º$T(x ; \Theta)=\sum_{j=1}^{J} c_{j} I\left(x \in R_{j}\right)$,å…¶ä¸­$\Theta=\left\{\left(R_{1}, c_{1}\right),\left(R_{2}, c_{2}\right), \cdots,\left(R_{J}, c_{J}\right)\right\}$æå‡æ ‘é‡‡ç”¨<strong>å‰å‘åˆ†æ­¥ç®—æ³•</strong>:</p>
<script type="math/tex; mode=display">
\begin{aligned}
&f_{0}(x)=0\\
&\begin{array}{l}
f_{m}(x)=f_{m-1}(x)+T\left(x ; \Theta_{m}\right), m=1,2, \cdots, M \\
f_{M}(x)=\sum_{m=1}^{M} T\left(x ; \Theta_{m}\right)
\end{array}
\end{aligned}</script><p>.å½“é‡‡ç”¨å¹³æ–¹è¯¯å·®æŸå¤±å‡½æ•°æ—¶,æŸå¤±å˜ä¸º</p>
<script type="math/tex; mode=display">
\begin{array}{l}
L\left(y, f_{m-1}(x)+T\left(x ; \Theta_{m}\right)\right) \\
\quad=\left[y-f_{m-1}(x)-T\left(x ; \Theta_{m}\right)\right]^{2} \\
\quad=\left[r-T\left(x ; \Theta_{m}\right)\right]^{2}
\end{array}</script><p>,å…¶ä¸­ræ˜¯å½“å‰æ¨¡å‹æ‹Ÿåˆæ•°æ®çš„<strong>æ®‹å·®</strong>.æ¯ä¸€æ­¥éƒ½åªéœ€<strong>æ‹Ÿåˆæ®‹å·®</strong>å­¦ä¹ ä¸€ä¸ªå›å½’æ ‘å³å¯.</p>
<h5 id="å­˜åœ¨çš„ç¼ºç‚¹"><a href="#å­˜åœ¨çš„ç¼ºç‚¹" class="headerlink" title="å­˜åœ¨çš„ç¼ºç‚¹"></a>å­˜åœ¨çš„ç¼ºç‚¹</h5><p>å½“æŸå¤±å‡½æ•°å¼å¹³æ–¹è¯¯å·®æŸå¤±å‡½æ•°æˆ–è€…äº¤å‰ç†µæŸå¤±å‡½æ•°çš„æ—¶å€™ï¼Œæ®‹å·®å³ä¸ºå¯¹åº”çš„æ¢¯åº¦ï¼Œè¿™ä¸ªæ—¶å€™æŸå¤±å‡½æ•°æ²¿ç€æ¢¯åº¦çš„æ–¹å‘ä¸‹é™æœ€å¿«ã€‚å½“æŸå¤±å‡½æ•°å¼å…¶ä»–æŸå¤±å‡½æ•°çš„æ—¶å€™ï¼Œæ®‹å·®å’ŒæŸå¤±å‡½æ•°çš„å¯¼æ•°å¹¶ä¸ç›¸ç­‰ï¼Œå‡½æ•°æ”¶æ•›çš„é€Ÿåº¦å°±ä¼šæ²¡æœ‰æ²¿ç€æ¢¯åº¦çš„æ–¹å‘æ”¶æ•›çš„å¿«ã€‚</p>
<h4 id="æ¢¯åº¦æå‡æ ‘-GBDT"><a href="#æ¢¯åº¦æå‡æ ‘-GBDT" class="headerlink" title="æ¢¯åº¦æå‡æ ‘(GBDT)"></a>æ¢¯åº¦æå‡æ ‘(GBDT)</h4><p>åˆ©ç”¨æœ€é€Ÿä¸‹é™æ³•çš„è¿‘ä¼¼æ–¹æ³•æ¥å®ç°æ¯ä¸€æ­¥çš„ä¼˜åŒ–,å…³é”®åœ¨äºç”¨æŸå¤±å‡½æ•°çš„<strong>è´Ÿæ¢¯åº¦</strong>åœ¨å½“å‰æ¨¡å‹çš„å€¼$-\left[\frac{\partial L\left(y, f\left(x_{i}\right)\right)}{\partial f\left(x_{i}\right)}\right]_{f(x)=f_{-1}(x)}$ä½œä¸ºå›å½’é—®é¢˜ä¸­æå‡æ ‘ç®—æ³•ä¸­çš„æ®‹å·®çš„<strong>è¿‘ä¼¼å€¼</strong>,æ¯ä¸€æ­¥ä»¥æ­¤æ¥ä¼°è®¡å›å½’æ ‘å¶ç»“ç‚¹åŒºåŸŸä»¥æ‹Ÿåˆæ®‹å·®çš„è¿‘ä¼¼å€¼,å¹¶åˆ©ç”¨çº¿æ€§æœç´¢ä¼°è®¡å¶ç»“ç‚¹åŒºåŸŸçš„å€¼ä½¿æŸå¤±å‡½æ•°æœ€å°åŒ–,ç„¶åæ›´æ–°å›å½’æ ‘å³å¯.</p>
<h4 id="Xgboost"><a href="#Xgboost" class="headerlink" title="Xgboost"></a>Xgboost</h4><p>ç›¸æ¯”ä¼ ç»ŸGBDTæœ‰ä»¥ä¸‹ä¼˜ç‚¹:</p>
<ol>
<li>åœ¨ä¼˜åŒ–æ—¶ç”¨åˆ°äº†äºŒé˜¶å¯¼æ•°ä¿¡æ¯.</li>
<li>åœ¨ä»£ä»·å‡½æ•°é‡ŒåŠ å…¥äº†æ­£åˆ™é¡¹.</li>
<li>æ¯æ¬¡è¿­ä»£åéƒ½å°†å¶å­ç»“ç‚¹çš„æƒé‡ä¹˜ä¸Šä¸€ä¸ªç³»æ•°,å‰Šå¼±æ¯æ£µæ ‘çš„å½±å“.</li>
<li>åˆ—æŠ½æ ·.</li>
<li>åœ¨è®­ç»ƒå‰å¯¹æ•°æ®è¿›è¡Œæ’åº,ä¿å­˜ä¸ºblockç»“æ„,å¹¶è¡Œåœ°å¯¹å„ä¸ªç‰¹å¾è¿›è¡Œå¢ç›Šè®¡ç®—.</li>
</ol>
<h3 id="EMç®—æ³•"><a href="#EMç®—æ³•" class="headerlink" title="EMç®—æ³•"></a>EMç®—æ³•</h3><p>EMç®—æ³•æ˜¯ä¸€ç§<strong>è¿­ä»£</strong>ç®—æ³•,ç”¨äºå«æœ‰<strong>éšå˜é‡</strong>çš„æ¦‚ç‡æ¨¡å‹å‚æ•°çš„æå¤§ä¼¼ç„¶ä¼°è®¡.æ¯æ¬¡è¿­ä»£ç”±ä¸¤æ­¥ç»„æˆ:Eæ­¥,æ±‚<strong>æœŸæœ›</strong>(expectation),Mæ­¥,æ±‚<strong>æå¤§å€¼</strong>(maximization),ç›´è‡³æ”¶æ•›ä¸ºæ­¢.</p>
<h4 id="éšå˜é‡"><a href="#éšå˜é‡" class="headerlink" title="éšå˜é‡"></a><strong>éšå˜é‡</strong></h4><p>ä¸èƒ½è¢«ç›´æ¥è§‚å¯Ÿåˆ°ï¼Œä½†æ˜¯å¯¹ç³»ç»Ÿçš„çŠ¶æ€å’Œèƒ½è§‚å¯Ÿåˆ°çš„è¾“å‡ºå­˜åœ¨å½±å“çš„ä¸€ç§ä¸œè¥¿.</p>
<h4 id="ç®—æ³•-6"><a href="#ç®—æ³•-6" class="headerlink" title="ç®—æ³•"></a><strong>ç®—æ³•</strong></h4><ol>
<li>é€‰æ‹©å‚æ•°çš„åˆå§‹å€¼Î¸(0),å¼€å§‹è¿­ä»£.æ³¨æ„EMç®—æ³•å¯¹åˆå€¼æ˜¯<strong>æ•æ„Ÿ</strong>çš„.</li>
<li><strong>Eæ­¥</strong>:Î¸(i)ä¸ºç¬¬iæ¬¡è¿­ä»£å‚æ•°Î¸çš„ä¼°è®¡å€¼,åœ¨ç¬¬i+1æ¬¡è¿­ä»£çš„Eæ­¥,è®¡ç®—$\begin{aligned} Q\left(\theta, \theta^{(i)}\right) &amp;=E_{z}\left[\log P(Y, Z | \theta) | Y, \theta^{(i)}\right] =\sum_{z} \log P(Y, Z | \theta) P\left(Z | Y, \theta^{(i)}\right) \end{aligned}$ ,$P(Z|Y,Î¸(i))$æ˜¯åœ¨ç»™å®š<strong>è§‚æµ‹æ•°æ®</strong>Yå’Œå½“å‰å‚æ•°ä¼°è®¡Î¸(i)ä¸‹<strong>éšå˜é‡æ•°æ®</strong>Zçš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ.</li>
<li><strong>Mæ­¥</strong>:æ±‚ä½¿Q(Î¸,Î¸(i))æå¤§åŒ–çš„Î¸,ç¡®å®šç¬¬i+1æ¬¡è¿­ä»£çš„å‚æ•°çš„ä¼°è®¡å€¼$\theta^{(i+1)}=\arg \max _{\theta} Q\left(\theta, \theta^{(i)}\right)$</li>
<li>é‡å¤2å’Œ3ç›´åˆ°<strong>æ”¶æ•›</strong>,ä¸€èˆ¬æ˜¯å¯¹è¾ƒå°çš„æ­£æ•°$\varepsilon1$å’Œ$\varepsilon2$æ»¡è¶³$\left|\theta^{(i+1)}-\theta^{(i)}\right|&lt;\varepsilon_{1} \quad$ æˆ–$\quad\left|Q\left(\theta^{(i+1)}, \theta^{(i)}\right)-Q\left(\theta^{(i)}, \theta^{(i)}\right)\right|&lt;\varepsilon_{2}$åˆ™åœæ­¢è¿­ä»£.</li>
</ol>
<h4 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h4><p>EMç®—æ³•æ˜¯é€šè¿‡ä¸æ–­æ±‚è§£<strong>ä¸‹ç•Œ</strong>çš„æå¤§åŒ–é€¼è¿‘æ±‚è§£å¯¹æ•°ä¼¼ç„¶å‡½æ•°æå¤§åŒ–çš„ç®—æ³•.å¯ä»¥ç”¨äºç”Ÿæˆæ¨¡å‹çš„<strong>éç›‘ç£å­¦ä¹ </strong>.ç”Ÿæˆæ¨¡å‹ç”±è”åˆæ¦‚ç‡åˆ†å¸ƒP(X,Y)è¡¨ç¤º.Xä¸ºè§‚æµ‹æ•°æ®,Yä¸ºæœªè§‚æµ‹æ•°æ®.</p>
<h3 id="éšé©¬å°”ç§‘å¤«æ¨¡å‹-HMM"><a href="#éšé©¬å°”ç§‘å¤«æ¨¡å‹-HMM" class="headerlink" title="éšé©¬å°”ç§‘å¤«æ¨¡å‹(HMM)"></a>éšé©¬å°”ç§‘å¤«æ¨¡å‹(HMM)</h3><p>éšé©¬å°”å¯å¤«æ¨¡å‹æ˜¯å…³äº<strong>æ—¶åº</strong>çš„æ¦‚ç‡æ¨¡å‹,æè¿°ç”±ä¸€ä¸ªéšè—çš„é©¬å°”å¯å¤«é“¾éšæœºç”Ÿæˆä¸å¯è§‚æµ‹çš„<strong>çŠ¶æ€åºåˆ—</strong>,å†ç”±å„ä¸ªçŠ¶æ€ç”Ÿæˆä¸€ä¸ªè§‚æµ‹è€Œäº§ç”Ÿ<strong>è§‚æµ‹éšæœºåºåˆ—</strong>çš„è¿‡ç¨‹.HMMæ˜¯ä¸€ç§ç”Ÿæˆå¼æ¨¡å‹ï¼Œå®ƒçš„ç†è®ºåŸºç¡€æ˜¯æœ´ç´ è´å¶æ–¯ï¼Œæœ¬è´¨ä¸Šå°±ç±»ä¼¼äºæˆ‘ä»¬å°†æœ´ç´ è´å¶æ–¯åœ¨å•æ ·æœ¬åˆ†ç±»é—®é¢˜ä¸Šçš„åº”ç”¨æ¨å¹¿åˆ°åºåˆ—æ ·æœ¬åˆ†ç±»é—®é¢˜ä¸Šã€‚</p>
<h4 id="æ¨¡å‹è¡¨ç¤º"><a href="#æ¨¡å‹è¡¨ç¤º" class="headerlink" title="æ¨¡å‹è¡¨ç¤º"></a>æ¨¡å‹è¡¨ç¤º</h4><p>è®¾Qæ˜¯æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€çš„é›†åˆ$Q=\left\{q_{1}, q_{2}, \cdots, q_{N}\right\}$,Væ˜¯æ‰€æœ‰å¯èƒ½çš„è§‚æµ‹çš„é›†åˆ$V=\left\{v_{1}, v_{2}, \cdots, v_{M}\right\}$,Iæ˜¯é•¿åº¦ä¸ºTçš„çŠ¶æ€åºåˆ—$I=\left(i_{1}, i_{2}, \cdots, i_{T}\right)$, Oæ˜¯å¯¹åº”çš„è§‚æµ‹åºåˆ—$O=\left(o_{1}, o_{2}, \cdots, o_{T}\right)$,</p>
<ol>
<li>Aæ˜¯<strong>çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µ</strong>$A=\left[a_{i j}\right]_{N \times N}$,$a_{ij}$è¡¨ç¤ºåœ¨æ—¶åˆ»tå¤„äºçŠ¶æ€$q_i$çš„æ¡ä»¶ä¸‹åœ¨æ—¶åˆ»t+1è½¬ç§»åˆ°çŠ¶æ€$q_j$çš„æ¦‚ç‡.</li>
<li>.Bæ˜¯<strong>è§‚æµ‹æ¦‚ç‡çŸ©é˜µ</strong> $B=\left[b_{j}(k)\right]_{N \times M}$,$b_{ij}$æ˜¯åœ¨æ—¶åˆ»tå¤„äºçŠ¶æ€$q_j$çš„æ¡ä»¶ä¸‹ç”Ÿæˆè§‚æµ‹$v_k$çš„æ¦‚ç‡.</li>
<li>$\pi$æ˜¯<strong>åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡</strong>$\pi=\pi(x)$,$\pi_i$è¡¨ç¤ºæ—¶åˆ»t=1å¤„äºçŠ¶æ€qiçš„æ¦‚ç‡.</li>
</ol>
<p>éšé©¬å°”å¯å¤«æ¨¡å‹ç”±åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡$pi$,çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µAä»¥åŠè§‚æµ‹æ¦‚ç‡çŸ©é˜µBç¡®å®š.$\pi$å’ŒAå†³å®šå³éšè—çš„<strong>é©¬å°”å¯å¤«é“¾</strong>,ç”Ÿæˆä¸å¯è§‚æµ‹çš„<strong>çŠ¶æ€åºåˆ—</strong>.Bå†³å®šå¦‚ä½•ä»çŠ¶æ€ç”Ÿæˆè§‚æµ‹,ä¸çŠ¶æ€åºåˆ—ç»¼åˆç¡®å®šäº†<strong>è§‚æµ‹åºåˆ—</strong>.å› æ­¤,éšé©¬å°”å¯å¤«æ¨¡å‹å¯ä»¥ç”¨<strong>ä¸‰å…ƒç¬¦å·</strong>è¡¨ç¤º$\lambda = (A,B,\pi)$</p>
<h4 id="ä¸¤ä¸ªåŸºæœ¬å‡è®¾"><a href="#ä¸¤ä¸ªåŸºæœ¬å‡è®¾" class="headerlink" title="ä¸¤ä¸ªåŸºæœ¬å‡è®¾"></a>ä¸¤ä¸ªåŸºæœ¬å‡è®¾</h4><ol>
<li><strong>é½æ¬¡é©¬å°”å¯å¤«æ€§å‡è®¾</strong>:å‡è®¾éšè—çš„é©¬å°”å¯å¤«é“¾åœ¨ä»»æ„æ—¶åˆ»tçš„çŠ¶æ€åªä¾èµ–äºå…¶å‰ä¸€æ—¶åˆ»çš„çŠ¶æ€.</li>
<li><strong>è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾</strong>:å‡è®¾ä»»æ„æ—¶åˆ»çš„è§‚æµ‹åªä¾èµ–äºè¯¥æ—¶åˆ»çš„é©¬å°”å¯å¤«é“¾çš„çŠ¶æ€.</li>
</ol>
<h4 id="ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"><a href="#ä¸‰ä¸ªåŸºæœ¬é—®é¢˜" class="headerlink" title="ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"></a>ä¸‰ä¸ªåŸºæœ¬é—®é¢˜</h4><h5 id="1-æ¦‚ç‡è®¡ç®—é—®é¢˜"><a href="#1-æ¦‚ç‡è®¡ç®—é—®é¢˜" class="headerlink" title="1. æ¦‚ç‡è®¡ç®—é—®é¢˜"></a><strong>1. æ¦‚ç‡è®¡ç®—é—®é¢˜</strong></h5><p>ç»™å®šæ¨¡å‹$\lambda = (A,B,\pi)$å’Œè§‚æµ‹åºåˆ—,$O=\left(o_{1}, o_{2}, \cdots, o_{T}\right)$è®¡ç®—åœ¨æ¨¡å‹$\lambda$ä¸‹è§‚æµ‹åºåˆ—Oå‡ºç°çš„æ¦‚ç‡$P(O|Î»)$.</p>
<ol>
<li>ç›´æ¥è®¡ç®—ï¼šåˆ—ä¸¾æ‰€æœ‰å¯èƒ½é•¿åº¦ä¸ºTçš„çŠ¶æ€åºåˆ—,æ±‚å„ä¸ªçŠ¶æ€åºåˆ—Iä¸è§‚æµ‹åºåˆ—Oçš„è”åˆæ¦‚ç‡,ä½†è®¡ç®—é‡å¤ªå¤§,å®é™…æ“ä½œä¸å¯è¡Œ.</li>
<li><strong>å‰å‘ç®—æ³•</strong>ï¼šå®šä¹‰åˆ°æ—¶åˆ»téƒ¨åˆ†è§‚æµ‹åºåˆ—ä¸º$o_1$~$o_t$ä¸”çŠ¶æ€ä¸º$q_i$çš„æ¦‚ç‡ä¸º<strong>å‰å‘æ¦‚ç‡</strong>,è®°ä½œ$\alpha_{t}(i)=P\left(o_{1}, o_{2}, \cdots, o_{t}, i_{t}=q_{i} | \lambda\right)$.åˆå§‹åŒ–å‰å‘æ¦‚ç‡$\alpha_{1}(i)=\pi_{i} b_{i}\left(o_{1}\right), \quad i=1,2, \cdots, N$ï¼Œé€’æ¨ï¼Œå¯¹$t=1$ ~ $T-1$,$\alpha_{t+1}(i)=\left[\sum_{j=1}^{N} \alpha_{t}(j) a_{j i}\right] b_{i}\left(o_{t+1}\right), \quad i=1,2, \cdots, N$,å¾—åˆ°$P(O | \lambda)=\sum_{i=1}^{N} \alpha_{T}(i)$å‡å°‘è®¡ç®—é‡çš„åŸå› åœ¨äºæ¯ä¸€æ¬¡è®¡ç®—ç›´æ¥å¼•ç”¨å‰ä¸€ä¸ªæ—¶åˆ»çš„è®¡ç®—ç»“æœ,é¿å…é‡å¤è®¡ç®—.</li>
<li><strong>åå‘ç®—æ³•</strong>:å®šä¹‰åœ¨æ—¶åˆ»tçŠ¶æ€ä¸º$q_i$çš„æ¡ä»¶ä¸‹,ä»t+1åˆ°Tçš„éƒ¨åˆ†è§‚æµ‹åºåˆ—ä¸º$o_{i+1}$~$o_T$çš„æ¦‚ç‡ä¸º<strong>åå‘æ¦‚ç‡</strong>,è®°ä½œ$\beta_{t}(i)=P\left(o_{t+1}, o_{t+2}, \cdots, o_{r} | i_{t}=q_{i}, \lambda\right)$.åˆå§‹åŒ–åå‘æ¦‚ç‡$\beta_{r}(i)=1, \quad i=1,2, \cdots, N$,é€’æ¨,å¯¹$t=T-1$~$1$$\beta_{t}(i)=\sum_{j=1}^{N} a_{i j} b_{j}\left(o_{i+1}\right) \beta_{i+1}(j), \quad i=1,2, \cdots, N$,å¾—åˆ°$P(O | \lambda)=\sum_{i=1}^{N} \pi_{i} b_{i}\left(o_{1}\right) \beta_{1}(i)$</li>
</ol>
<h5 id="2-å­¦ä¹ ç®—æ³•"><a href="#2-å­¦ä¹ ç®—æ³•" class="headerlink" title="2. å­¦ä¹ ç®—æ³•"></a><strong>2. å­¦ä¹ ç®—æ³•</strong></h5><p>å·²çŸ¥è§‚æµ‹åºåˆ—$O=(o_1,o_2, \cdots,o_r)$,ä¼°è®¡æ¨¡å‹$\lambda = (A,B,\pi)$,çš„å‚æ•°,ä½¿å¾—åœ¨è¯¥æ¨¡å‹ä¸‹è§‚æµ‹åºåˆ—æ¦‚ç‡$p(O|\lambda)$æœ€å¤§.æ ¹æ®è®­ç»ƒæ•°æ®æ˜¯å¦åŒ…æ‹¬è§‚å¯Ÿåºåˆ—å¯¹åº”çš„çŠ¶æ€åºåˆ—åˆ†åˆ«ç”±ç›‘ç£å­¦ä¹ ä¸éç›‘ç£å­¦ä¹ å®ç°.</p>
<ol>
<li><p>ç›‘ç£å­¦ä¹ ï¼šä¼°è®¡è½¬ç§»æ¦‚ç‡$\hat{a}_{i j}=\frac{A_{i j}}{\sum_{j=1}^{N} A_{i j}}, \quad i=1,2, \cdots, N ; \quad j=1,2, \cdots, N$ å’Œè§‚æµ‹æ¦‚ç‡$\hat{b}_{j}(k)=\frac{B_{j k}}{\sum_{k=1}^{M} B_{j k}}, \quad j=1,2, \cdots, N, k=1,2, \cdots, M$.åˆå§‹çŠ¶æ€æ¦‚ç‡$\pi_i$çš„ä¼°è®¡ä¸ºSä¸ªæ ·æœ¬ä¸­åˆå§‹çŠ¶æ€ä¸º$q_i$çš„é¢‘ç‡.</p>
</li>
<li><p><strong>éç›‘ç£å­¦ä¹ (Baum-Welchç®—æ³•)</strong>:å°†è§‚æµ‹åºåˆ—æ•°æ®çœ‹ä½œè§‚æµ‹æ•°æ®O,çŠ¶æ€åºåˆ—æ•°æ®çœ‹ä½œä¸å¯è§‚æµ‹çš„<strong>éšæ•°æ®</strong>I.é¦–å…ˆç¡®å®šå®Œå…¨æ•°æ®çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°$log p(O,I|\lambda)$,æ±‚Qå‡½æ•°</p>
<script type="math/tex; mode=display">
\begin{aligned}
Q(\lambda, \bar{\lambda})=& \sum_{t} \log \pi_{i_1} P(O, I | \bar{\lambda}) \\
&+\sum_{I}\left(\sum_{i=1}^{I-1} \log a_{i_t,i_{t+1}}\right) P(O, I | \bar{\lambda}) \\
&+\sum_{I}\left(\sum_{i=1}^{T} \log b_{i_t}\left(o_{t}\right)\right) P(O, I | \bar{\lambda})
\end{aligned}</script><p>,ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•æå¤§åŒ–Qå‡½æ•°æ±‚æ¨¡å‹å‚æ•°$\pi_{i}=\frac{P\left(O, i_{1}=i | \bar{\lambda}\right)}{P(O | \bar{\lambda})}$,$a_{i j}=\frac{\sum_{i=1}^{T-1} P\left(O, i_{t}=i, i_{t+1}=j | \bar{\lambda}\right)}{\sum_{t=1}^{T-1} P\left(O, i_{t}=i | \bar{\lambda}\right)}$,$b_{j}(k)=\frac{\sum_{i=1}^{T} P\left(O, i_{t}=j | \bar{\lambda}\right) I\left(o_{i}=v_{k}\right)}{\sum_{i=1}^{T} P\left(O, i_{t}=j | \bar{\lambda}\right)}$,</p>
</li>
</ol>
<h5 id="3-é¢„æµ‹é—®é¢˜"><a href="#3-é¢„æµ‹é—®é¢˜" class="headerlink" title="3. é¢„æµ‹é—®é¢˜"></a><strong>3. é¢„æµ‹é—®é¢˜</strong></h5><p>ä¹Ÿç§°ä¸ºè§£ç é—®é¢˜.å·²çŸ¥æ¨¡å‹$\lambda = (A,B,\pi)$å’Œè§‚æµ‹åºåˆ—$O=(O_1,O_2,\cdots,O_T)$,æ±‚å¯¹ç»™å®šè§‚æµ‹åºåˆ—æ¡ä»¶æ¦‚ç‡$P(I|O)$æœ€å¤§çš„çŠ¶æ€åºåˆ—$I=(i_1,i_2,\cdots,i_T)$</p>
<ol>
<li><p><strong>è¿‘ä¼¼ç®—æ³•</strong>: åœ¨æ¯ä¸ªæ—¶åˆ»té€‰æ‹©åœ¨è¯¥æ—¶åˆ»æœ€æœ‰å¯èƒ½å‡ºç°çš„çŠ¶æ€$i_t^<em>$,ä»è€Œå¾—åˆ°ä¸€ä¸ªçŠ¶æ€åºåˆ—ä½œä¸ºé¢„æµ‹çš„ç»“æœ.ä¼˜ç‚¹æ˜¯<em>*è®¡ç®—ç®€å•</em></em>,ç¼ºç‚¹æ˜¯ä¸èƒ½ä¿è¯çŠ¶æ€åºåˆ—æ•´ä½“æ˜¯æœ€æœ‰å¯èƒ½çš„çŠ¶æ€åºåˆ—</p>
</li>
<li><p><strong>ç»´ç‰¹æ¯”ç®—æ³•</strong>:ç”¨<strong>åŠ¨æ€è§„åˆ’</strong>æ±‚æ¦‚ç‡æœ€å¤§è·¯å¾„,è¿™ä¸€æ¡è·¯å¾„å¯¹åº”ç€ä¸€ä¸ªçŠ¶æ€åºåˆ—.ä»t=1å¼€å§‹,é€’æ¨åœ°è®¡ç®—åœ¨æ—¶åˆ»tçŠ¶æ€ä¸ºiçš„å„æ¡éƒ¨åˆ†è·¯å¾„çš„æœ€å¤§æ¦‚ç‡,ç›´è‡³å¾—åˆ°æ—¶åˆ»t=TçŠ¶æ€ä¸ºiçš„å„æ¡è·¯å¾„çš„æœ€å¤§æ¦‚ç‡.æ—¶åˆ»t=Tçš„æœ€å¤§æ¦‚ç‡å³ä¸º<strong>æœ€ä¼˜è·¯å¾„</strong>çš„æ¦‚ç‡$P^\star$,æœ€ä¼˜è·¯å¾„çš„<strong>ç»ˆç»“ç‚¹</strong>$i_t^\star$ä¹ŸåŒæ—¶å¾—åˆ°,ä¹‹åä»ç»ˆç»“ç‚¹å¼€å§‹ç”±åå‘å‰é€æ­¥æ±‚å¾—<strong>ç»“ç‚¹</strong>,å¾—åˆ°æœ€ä¼˜è·¯å¾„.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">viterbi</span><span class="params">(obs, states, Pi, A, B)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param obs:è§‚æµ‹åºåˆ—</span></span><br><span class="line"><span class="string">    :param states:éšçŠ¶æ€</span></span><br><span class="line"><span class="string">    :param Pi:åˆå§‹æ¦‚ç‡ï¼ˆéšçŠ¶æ€ï¼‰</span></span><br><span class="line"><span class="string">    :param A:è½¬ç§»æ¦‚ç‡ï¼ˆéšçŠ¶æ€ï¼‰</span></span><br><span class="line"><span class="string">    :param B: å‘å°„æ¦‚ç‡ ï¼ˆéšçŠ¶æ€è¡¨ç°ä¸ºæ˜¾çŠ¶æ€çš„æ¦‚ç‡ï¼‰</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># è·¯å¾„æ¦‚ç‡è¡¨ V[æ—¶é—´][éšçŠ¶æ€] = æ¦‚ç‡</span></span><br><span class="line">    V = [&#123;&#125;]</span><br><span class="line">    <span class="comment"># ä¸€ä¸ªä¸­é—´å˜é‡ï¼Œä»£è¡¨å½“å‰çŠ¶æ€æ˜¯å“ªä¸ªéšçŠ¶æ€</span></span><br><span class="line">    path = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–åˆå§‹çŠ¶æ€ (t == 0)</span></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">        V[<span class="number">0</span>][y] = Pi[y] * B[y][obs[<span class="number">0</span>]]</span><br><span class="line">        path[y] = [y]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¹ t &gt; 0 è·‘ä¸€éç»´ç‰¹æ¯”ç®—æ³•</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">1</span>, len(obs)):</span><br><span class="line">        V.append(&#123;&#125;)</span><br><span class="line">        newpath = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">            <span class="comment"># æ¦‚ç‡ éšçŠ¶æ€ =    å‰çŠ¶æ€æ˜¯y0çš„æ¦‚ç‡ * y0è½¬ç§»åˆ°yçš„æ¦‚ç‡ * yè¡¨ç°ä¸ºå½“å‰çŠ¶æ€çš„æ¦‚ç‡</span></span><br><span class="line">            (prob, state) = max([(V[t - <span class="number">1</span>][y0] * A[y0][y] * B[y][obs[t]], y0) <span class="keyword">for</span> y0 <span class="keyword">in</span> states])</span><br><span class="line">            <span class="comment"># è®°å½•æœ€å¤§æ¦‚ç‡</span></span><br><span class="line">            V[t][y] = prob</span><br><span class="line">            <span class="comment"># è®°å½•è·¯å¾„</span></span><br><span class="line">            newpath[y] = path[state] + [y]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¸éœ€è¦ä¿ç•™æ—§è·¯å¾„</span></span><br><span class="line">        path = newpath</span><br><span class="line"></span><br><span class="line">    print_dptable(V)</span><br><span class="line">    (prob, state) = max([(V[len(obs) - <span class="number">1</span>][y], y) <span class="keyword">for</span> y <span class="keyword">in</span> states])</span><br><span class="line">    <span class="keyword">return</span> (prob, path[state])</span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ‰“å°è·¯å¾„æ¦‚ç‡è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_dptable</span><span class="params">(V)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"    "</span>,</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(V)): <span class="keyword">print</span> <span class="string">"%7d"</span> % i,</span><br><span class="line">    <span class="keyword">print</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> V[<span class="number">0</span>].keys():</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"%.5s: "</span> % y,</span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> range(len(V)):</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"%.7s"</span> % (<span class="string">"%f"</span> % V[t][y]),</span><br><span class="line">        <span class="keyword">print</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="æœ€å¤§ç†µé©¬å°”ç§‘å¤«æ¨¡å‹-MEMM"><a href="#æœ€å¤§ç†µé©¬å°”ç§‘å¤«æ¨¡å‹-MEMM" class="headerlink" title="æœ€å¤§ç†µé©¬å°”ç§‘å¤«æ¨¡å‹(MEMM)"></a>æœ€å¤§ç†µé©¬å°”ç§‘å¤«æ¨¡å‹(MEMM)</h3><p>æœ€å¤§ç†µé©¬å°”ç§‘å¤«æ¨¡å‹åˆ©ç”¨åˆ¤åˆ«å¼æ¨¡å‹çš„ç‰¹ç‚¹ï¼Œç›´æ¥å¯¹æ¯ä¸€ä¸ªæ—¶åˆ»çš„çŠ¶æ€å»ºç«‹ä¸€ä¸ªåˆ†ç±»å™¨ï¼Œç„¶åå°†æ‰€æœ‰çš„åˆ†ç±»å™¨çš„æ¦‚ç‡å€¼è¿ä¹˜èµ·æ¥$P\left(y_{1}^{n} | x_{1}^{n}\right)=\prod_{t=1}^{n} P\left(y_{t} | y_{t-1}, x_{t}\right)$ã€‚ä¸ºäº†å®ç°æ˜¯å¯¹æ•´ä¸ªåºåˆ—è¿›è¡Œçš„åˆ†ç±»ï¼Œåœ¨æ¯ä¸ªæ—¶åˆ»tæ—¶ï¼Œå®ƒçš„ç‰¹å¾ä¸ä»…æ¥è‡ªå½“å‰è§‚æµ‹å€¼$x_t$ï¼Œè€Œä¸”è¿˜æ¥è‡ªå‰ä¸€çŠ¶æ€å€¼$y_{t-1}$,é€šè¿‡æœ€å¤§ç†µåˆ†ç±»å™¨å»ºæ¨¡$P\left(y_{t}=y^{<em>} | y_{t-1}=y^{\prime}, x_{t}\right)=\frac{1}{Z\left(x_{t}, y^{\prime}\right)} \exp \left(\sum_{a} \lambda_{a} f_{a}\left(x_{t}, y^{\prime}, y^{</em>}\right)\right)$,å…¶ä¸­ï¼Œ$Z\left(x_{t}, y \prime\right)=\sum_{y} \exp \left(\sum_{a} \lambda_{a} f_{a}\left(x_{t}, y \prime, y\right)\right)$ï¼Œ</p>
<h4 id="æ ‡æ³¨åç½®é—®é¢˜"><a href="#æ ‡æ³¨åç½®é—®é¢˜" class="headerlink" title="æ ‡æ³¨åç½®é—®é¢˜"></a>æ ‡æ³¨åç½®é—®é¢˜</h4><p>ä½¿ç”¨ç»´ç‰¹æ¯”ç®—æ³•è¿›è¡Œè§£ç æ—¶ï¼Œ$v_{t}(j)=\max _{i} v_{t-1}(i) * P\left(y_{j} | y_{i}, x_{t}\right) 1 \leq j \leq n, 1&lt;t&lt;T$ã€‚æœ€å¤§ç†µæ¨¡å‹åœ¨æ¯ä¸€ä¸ªæ—¶åˆ»ï¼Œé’ˆå¯¹ä¸åŒçš„å‰ä¸€çŠ¶æ€yâ€²è¿›è¡Œå½’ä¸€åŒ–æ“ä½œï¼Œè¿™æ˜¯ä¸€ç§å±€éƒ¨çš„å½’ä¸€åŒ–æ“ä½œï¼Œä¼šå­˜åœ¨æ ‡ç­¾åç½®é—®é¢˜ã€‚</p>
<h5 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h5><p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/label_bias.png" alt="avatar"></p>
<p>çŠ¶æ€è½¬æ¢(1â†’2),(2â†’3),(4â†’5),(5â†’3)çš„æ¦‚ç‡å€¼éƒ½æ˜¯1ï¼Œè€Œæ— è®ºè§‚æµ‹å€¼æ˜¯ä»€ä¹ˆï¼Œæ¢è¨€ä¹‹æœ‰$P(2|1,i)=P(2|1,o)=1$</p>
<p>ä½ å¯èƒ½ä¼šå¾ˆæƒŠè®¶$P(2âˆ£1,i)=1,P(2âˆ£1,o)=1$æ€ä¹ˆå¯èƒ½ä¼šæˆç«‹å‘¢ï¼Ÿä½ å¯ä»¥å¥—ç”¨ä¸Šé¢çš„å…¬å¼è¯•ä¸€è¯•ï¼Œç”±äºçŠ¶æ€â€1â€çš„åªèƒ½è½¬æ¢ä¸ºâ€2â€ï¼Œæ‰€ä»¥è®¡ç®—å½’ä¸€åŒ–é¡¹æ—¶ï¼Œ å…¶å®åªæœ‰ä¸€ä¸ªæšä¸¾å€¼ï¼Œå°±æ˜¯çŠ¶æ€â€2â€ï¼Œæ‰€ä»¥æ— è®ºä½ åˆ†å­ä¸ºå¤šå°‘ï¼Œåˆ†æ¯éƒ½å’Œå®ƒä¸€æ ·ï¼Œæ‰€ä»¥æ¦‚ç‡å€¼å°±æ˜¯1ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶å®è§‚æµ‹å€¼å¹¶æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œè¿™å°±æ˜¯æ ‡ç­¾åç½®ã€‚</p>
<h5 id="åæœï¼š"><a href="#åæœï¼š" class="headerlink" title="åæœï¼š"></a><strong>åæœï¼š</strong></h5><p>å®ƒä¼šé€ æˆä»€ä¹ˆåæœå‘¢ï¼Ÿ<br>ä»–ä¼šå¯¼è‡´æ¨¡å‹è¿›è¡Œé¢„æµ‹æ—¶åªä¾èµ–æ•°æ®ç»Ÿè®¡å‡ºæ¥çš„æ¦‚ç‡å€¼ï¼Œæ²¡æœ‰åˆ©ç”¨åˆ°æ ·æœ¬çš„ç‰¹å¾ã€‚<br>å‡è®¾è®­ç»ƒé›†ç°åœ¨æœ‰3ä¸ªribå’Œ1ä¸ªrobï¼Œå½“æˆ‘ä»¬åœ¨æµ‹è¯•é˜¶æ®µï¼Œé‡åˆ°è¯robï¼Œå®ƒä¼šè¢«è§£ç æˆä»€ä¹ˆçŠ¶æ€åºåˆ—å‘¢ï¼Ÿç­”æ¡ˆæ˜¯(0â†’1â†’2â†’3)ï¼ä½ å¯ä»¥å¥—å…¬å¼è¯•ä¸€è¯•ï¼Œå› ä¸º$P(1âˆ£0,r)&gt;P(4âˆ£0,r)$,$P(2âˆ£1,o)=P(5âˆ£4,0)=1,P(3âˆ£2,b)&gt;P(3âˆ£5,b)$ã€‚</p>
<h5 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a><strong>åŸå› </strong></h5><p>é‚£ä¹ˆé—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ï¼Ÿå› ä¸ºMEMMä¸­åœ¨æ¯ä¸€æ—¶åˆ»tï¼Œéƒ½åœ¨å‰ä¸€æ—¶åˆ»æŸçŠ¶æ€yâ€²ä¸‹åšäº†å±€éƒ¨çš„å½’ä¸€åŒ–æ“ä½œï¼Œå¦‚ä½•è§£å†³è¿™ç§æ ‡ç­¾åç½®é—®é¢˜å‘¢ï¼Ÿ<br>åœ¨CRFä¸­å¹¶ä¸æ˜¯å¯¹æ¯ä¸ªæ—¶åˆ»éƒ½è¿›è¡Œä¸€æ¬¡åˆ†ç±»ï¼Œè€Œæ˜¯ç›´æ¥å¯¹æ•´ä¸ªåºåˆ—è¿›è¡Œåˆ†ç±»ï¼Œåšä¸€ä¸ªå…¨å±€çš„å½’ä¸€åŒ–æ“ä½œã€‚</p>
<h3 id="æ¡ä»¶éšæœºåœºCRF"><a href="#æ¡ä»¶éšæœºåœºCRF" class="headerlink" title="æ¡ä»¶éšæœºåœºCRF"></a>æ¡ä»¶éšæœºåœºCRF</h3><h4 id="æ¦‚ç‡å›¾æ¨¡å‹"><a href="#æ¦‚ç‡å›¾æ¨¡å‹" class="headerlink" title="æ¦‚ç‡å›¾æ¨¡å‹"></a>æ¦‚ç‡å›¾æ¨¡å‹</h4><p>ç»“ç‚¹è¡¨ç¤ºéšæœºå˜é‡ï¼Œè¾¹è¡¨ç¤ºéšæœºå˜é‡ä¹‹é—´çš„æ¦‚ç‡ä¾èµ–å…³ç³»ã€‚</p>
<h5 id="é©¬å°”ç§‘å¤«æ€§"><a href="#é©¬å°”ç§‘å¤«æ€§" class="headerlink" title="é©¬å°”ç§‘å¤«æ€§"></a>é©¬å°”ç§‘å¤«æ€§</h5><ol>
<li>æˆå¯¹é©¬å°”å¯å¤«æ€§</li>
<li>å±€éƒ¨é©¬å°”ç§‘å¤«æ€§</li>
<li>å…¨å±€é©¬å°”ç§‘å¤«æ€§</li>
</ol>
<h5 id="æ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„å› å¼åˆ†è§£"><a href="#æ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„å› å¼åˆ†è§£" class="headerlink" title="æ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„å› å¼åˆ†è§£"></a>æ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„å› å¼åˆ†è§£</h5><h6 id="å›¢ä¸æœ€å¤§å›¢"><a href="#å›¢ä¸æœ€å¤§å›¢" class="headerlink" title="å›¢ä¸æœ€å¤§å›¢"></a>å›¢ä¸æœ€å¤§å›¢</h6><p>æ— å‘å›¾Gä¸­ä»»ä½•ä¸¤ä¸ªç»“ç‚¹å‡æœ‰è¾¹è¿æ¥çš„ç»“ç‚¹å­é›†ç§°ä¸º<strong>å›¢</strong>ã€‚è‹¥Cæ˜¯æ— å‘å›¾Gçš„ä¸€ä¸ªå›¢ï¼Œå¹¶ä¸”ä¸èƒ½å†åŠ è¿›ä»»ä½•ä¸€ä¸ªGçš„ç»“ç‚¹ä½¿å…¶æˆä¸ºä¸€ä¸ªæ›´å¤§çš„å›¢ï¼Œç§°æ­¤Cä¸º<strong>æœ€å¤§å›¢</strong>ã€‚</p>
<p>ç»™å®šæ¦‚ç‡æ— å‘å›¾æ¨¡å‹ï¼Œè®¾å…¶æ— å‘å›¾ä¸ºGï¼ŒCä¸ºGä¸Šçš„æœ€å¤§å›¢ï¼Œ$Y_C$è¡¨ç¤ºCå¯¹åº”çš„éšæœºå˜é‡ã€‚é‚£ä¹ˆæ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„è”åˆæ¦‚ç‡åˆ†å¸ƒ$P(Y)$å¯å†™ä½œå›¾ä¸­æ‰€æœ‰æœ€å¤§å›¢Cä¸Šçš„å‡½æ•°$\phi_C(Y_C)$çš„ä¹˜ç§¯çš„å½¢å¼ã€‚</p>
<p><strong>Hammersley-Cliffordå®šç†</strong><br>æ¦‚ç‡æ— å‘å›¾æ¨¡å‹çš„è”åˆæ¦‚ç‡åˆ†å¸ƒ$P(Y)$å¯ä»¥è¡¨ç¤ºä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p>
<script type="math/tex; mode=display">
P(Y)=\frac{1}{Z}\prod_C{\phi_C(Y_C)}\\
Z=\sum_Y\prod_C{\phi_C(Y_C)}</script><h5 id="æ¡ä»¶éšæœºåœºCRF-1"><a href="#æ¡ä»¶éšæœºåœºCRF-1" class="headerlink" title="æ¡ä»¶éšæœºåœºCRF"></a>æ¡ä»¶éšæœºåœºCRF</h5><p>æ¡ä»¶éšæœºåœºåŸºäºæ¦‚ç‡æ— å‘å›¾æ¨¡å‹ï¼Œåˆ©ç”¨æœ€å¤§å›¢ç†è®ºï¼Œå¯¹éšæœºå˜é‡çš„è”åˆåˆ†å¸ƒ$P(Y)$è¿›è¡Œå»ºæ¨¡ã€‚</p>
<p>åœ¨åºåˆ—æ ‡æ³¨ä»»åŠ¡ä¸­çš„æ¡ä»¶éšæœºåœºï¼Œå¾€å¾€æ˜¯æŒ‡<strong>çº¿æ€§é“¾æ¡ä»¶éšæœºåœº</strong></p>
<h6 id="æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼"><a href="#æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼" class="headerlink" title="æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼"></a>æ¡ä»¶éšæœºåœºçš„å‚æ•°åŒ–å½¢å¼</h6><script type="math/tex; mode=display">
P(y|x)=\frac{1}{Z(x)} \exp \left(\sum_{i, k} \lambda_{k} t_{k}\left(y_{i-1}, y_{i}, x, i\right)+\sum_{i, j} \mu_{l} s_{l}\left(y_{i}, x, i\right)\right) 
\\
Z(x)=\sum_{y} \exp \left(\sum_{i, k} \lambda_{k} t_{k}\left(y_{i-1}, y_{i}, x, i\right)+\sum_{i, j} \mu_{l} s_{l}\left(y_{i}, x, i\right)\right)</script><h6 id="æ¡ä»¶éšæœºåœºçš„ç®€åŒ–å½¢å¼"><a href="#æ¡ä»¶éšæœºåœºçš„ç®€åŒ–å½¢å¼" class="headerlink" title="æ¡ä»¶éšæœºåœºçš„ç®€åŒ–å½¢å¼"></a>æ¡ä»¶éšæœºåœºçš„ç®€åŒ–å½¢å¼</h6><script type="math/tex; mode=display">
\begin{aligned}
P(y | x) &=\frac{1}{Z(x)} \exp \sum_{k=1}^{K} w_{k} f_{k}(y, x) \\
Z(x) &=\sum_{y} \exp \sum_{k=1}^{K} w_{k} f_{k}(y, x)
\end{aligned}</script><h6 id="æ¡ä»¶éšæœºåœºçš„çŸ©é˜µå½¢å¼"><a href="#æ¡ä»¶éšæœºåœºçš„çŸ©é˜µå½¢å¼" class="headerlink" title="æ¡ä»¶éšæœºåœºçš„çŸ©é˜µå½¢å¼"></a>æ¡ä»¶éšæœºåœºçš„çŸ©é˜µå½¢å¼</h6><script type="math/tex; mode=display">
P_{w}(y | x)=\frac{1}{Z_{w}(x)} \prod_{i=1}^{n+1} M_{i}\left(y_{i-1}, y_{i} | x\right)\\
Z_{w}(x)=\left(M_{1}(x) M_{2}(x) \cdots M_{n+1}(x)\right)_{\text {start, stop }}</script><h3 id="K-Means"><a href="#K-Means" class="headerlink" title="K-Means"></a>K-Means</h3><p>K-Meansæ˜¯<strong>æ— ç›‘ç£</strong>çš„<strong>èšç±»</strong>ç®—æ³•.æ€æƒ³æ˜¯å¯¹äºç»™å®šçš„æ ·æœ¬é›†,æŒ‰ç…§æ ·æœ¬ä¹‹é—´çš„è·ç¦»å¤§å°å°†æ ·æœ¬é›†åˆ’åˆ†ä¸ºKä¸ªç°‡,è®©ç°‡å†…çš„ç‚¹å°½é‡ç´§å¯†åœ°è¿åœ¨ä¸€èµ·,è€Œè®©ç°‡é—´çš„è·ç¦»å°½é‡çš„å¤§.</p>
<h4 id="ä¼ ç»Ÿç®—æ³•"><a href="#ä¼ ç»Ÿç®—æ³•" class="headerlink" title="ä¼ ç»Ÿç®—æ³•"></a>ä¼ ç»Ÿç®—æ³•</h4><ol>
<li>ç”¨å…ˆéªŒçŸ¥è¯†æˆ–äº¤å‰éªŒè¯é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„<strong>k</strong>å€¼.</li>
<li>éšæœºé€‰æ‹©kä¸ªæ ·æœ¬ä½œä¸ºåˆå§‹çš„<strong>è´¨å¿ƒ</strong>.æ³¨æ„åˆå§‹åŒ–è´¨å¿ƒçš„é€‰æ‹©å¯¹æœ€åçš„èšç±»ç»“æœå’Œè¿è¡Œæ—¶é—´éƒ½æœ‰å¾ˆå¤§çš„å½±å“.</li>
<li>è®¡ç®—æ¯ä¸ªæ ·æœ¬ç‚¹å’Œå„ä¸ªè´¨å¿ƒçš„è·ç¦»,å°†æ ·æœ¬ç‚¹æ ‡è®°ä¸º<strong>è·ç¦»æœ€å°</strong>çš„è´¨å¿ƒæ‰€å¯¹åº”çš„ç°‡.</li>
<li>é‡æ–°è®¡ç®—æ¯ä¸ª<strong>ç°‡</strong>çš„è´¨å¿ƒ,å–è¯¥ç°‡ä¸­æ¯ä¸ªç‚¹ä½ç½®çš„å¹³å‡å€¼.</li>
<li>é‡å¤2,3,4æ­¥ç›´åˆ°kä¸ªè´¨å¿ƒéƒ½æ²¡æœ‰å‘ç”Ÿå˜åŒ–ä¸ºæ­¢.</li>
</ol>
<h4 id="K-Means-1"><a href="#K-Means-1" class="headerlink" title="K-Means++"></a>K-Means++</h4><p>ç”¨äºä¼˜åŒ–éšæœºåˆå§‹åŒ–è´¨å¿ƒçš„æ–¹æ³•</p>
<ol>
<li>ä»è¾“å…¥æ ·æœ¬ç‚¹ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªç‚¹ä½œä¸ºç¬¬ä¸€ä¸ªè´¨å¿ƒ.</li>
<li>è®¡ç®—æ¯ä¸€ä¸ªæ ·æœ¬ç‚¹åˆ°å·²é€‰æ‹©çš„è´¨å¿ƒä¸­<strong>æœ€è¿‘è´¨å¿ƒ</strong>çš„è·ç¦»D(x).</li>
<li>é€‰æ‹©ä¸€ä¸ªæ–°çš„æ ·æœ¬ç‚¹ä½œä¸ºæ–°çš„è´¨å¿ƒ,é€‰æ‹©åŸåˆ™æ˜¯D(x)è¶Šå¤§çš„ç‚¹è¢«é€‰ä¸­çš„æ¦‚ç‡è¶Šå¤§.</li>
<li>é‡å¤2å’Œ3ç›´åˆ°é€‰å‡ºkä¸ªè´¨å¿ƒ.</li>
</ol>
<h4 id="Elkan-K-Means"><a href="#Elkan-K-Means" class="headerlink" title="Elkan K-Means"></a><strong>Elkan K-Means</strong></h4><p>åˆ©ç”¨ä¸¤è¾¹ä¹‹å’Œå¤§äºç¬¬ä¸‰è¾¹ä»¥åŠä¸¤è¾¹ä¹‹å·®å°äºç¬¬ä¸‰è¾¹æ¥å‡å°‘è·ç¦»çš„è®¡ç®—.ä¸é€‚ç”¨äºç‰¹å¾ç¨€ç–çš„æƒ…å†µ.</p>
<h4 id="Mini-Batch-K-Means"><a href="#Mini-Batch-K-Means" class="headerlink" title="Mini Batch K-Means"></a><strong>Mini Batch K-Means</strong></h4><p>æ ·æœ¬é‡å¾ˆå¤§æ—¶,åªç”¨å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ¥åšä¼ ç»Ÿçš„K-Means.ä¸€èˆ¬å¤šç”¨å‡ æ¬¡è¯¥ç®—æ³•,ä»ä¸åŒçš„éšå³é‡‡æ ·ä¸­é€‰æ‹©æœ€ä¼˜çš„èšç±»ç°‡.</p>
<h3 id="Apriori"><a href="#Apriori" class="headerlink" title="Apriori"></a>Apriori</h3><p>Aprioriæ˜¯å¸¸ç”¨çš„æŒ–æ˜å‡º<strong>æ•°æ®å…³è”è§„åˆ™</strong>çš„ç®—æ³•,ç”¨äºæ‰¾å‡ºæ•°æ®å€¼ä¸­<strong>é¢‘ç¹</strong>å‡ºç°çš„æ•°æ®é›†åˆ.ä¸€èˆ¬ä½¿ç”¨æ”¯æŒåº¦æˆ–è€…æ”¯æŒåº¦ä¸ç½®ä¿¡åº¦çš„ç»„åˆä½œä¸º<strong>è¯„ä¼°æ ‡å‡†</strong>.</p>
<ol>
<li>æ”¯æŒåº¦ï¼šå‡ ä¸ªå…³è”çš„æ•°æ®åœ¨æ•°æ®é›†ä¸­å‡ºç°çš„æ¬¡æ•°å æ€»æ•°æ®é›†çš„æ¯”é‡Support$(X, Y)=P(X Y)=\frac{\text {number}(X Y)}{\text {num}(\text {AllSamples})}$</li>
<li><strong>ç½®ä¿¡åº¦</strong>ï¼šä¸€ä¸ªæ•°æ®å‡ºç°å.å¦ä¸€ä¸ªæ•°æ®å‡ºç°çš„æ¦‚ç‡Confidence$(X \Leftarrow Y)=P(X | Y)=P(X Y) / P(Y)$</li>
</ol>
<p>Aprioriç®—æ³•çš„ç›®æ ‡æ˜¯æ‰¾åˆ°æœ€å¤§çš„<strong>Ké¡¹é¢‘ç¹é›†</strong>.å‡è®¾ä½¿ç”¨æ”¯æŒåº¦æ¥ä½œä¸ºè¯„ä¼°æ ‡å‡†,é¦–å…ˆæœç´¢å‡º<strong>å€™é€‰1é¡¹é›†</strong>åŠå¯¹åº”çš„æ”¯æŒåº¦,<strong>å‰ªæ</strong>å»æ‰ä½äºæ”¯æŒåº¦çš„1é¡¹é›†,å¾—åˆ°<strong>é¢‘ç¹1é¡¹é›†</strong>.ç„¶åå¯¹å‰©ä¸‹çš„é¢‘ç¹1é¡¹é›†è¿›è¡Œ<strong>è¿æ¥</strong>,å¾—åˆ°å€™é€‰çš„é¢‘ç¹2é¡¹é›†â€¦â€¦ä»¥æ­¤ç±»æ¨,ä¸æ–­è¿­ä»£,ç›´åˆ°æ— æ³•æ‰¾åˆ°é¢‘ç¹k+1é¡¹é›†ä¸ºæ­¢,å¯¹åº”çš„é¢‘ç¹ké¡¹é›†çš„é›†åˆå³ä¸ºè¾“å‡ºç»“æœ.</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://blog.csdn.net/qq_20989105/article/details/81218696" target="_blank" rel="noopener">HMMéšé©¬å°”å¯å¤«æ¨¡å‹ä¸viterbiç»´ç‰¹æ¯”ç®—æ³•</a></li>
</ol>
]]></content>
      <categories>
        <category>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•</category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>ç»Ÿè®¡å­¦ä¹ æ–¹æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>scrapy</title>
    <url>/2019/08/31/scrapy/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id><a href="#" class="headerlink" title=" "></a> </h3><p><img src="/2019/08/31/scrapy/scrapy_framework.png" alt="avatar"></p>
<a id="more"></a>
<p><a href="https://scrapy-chs.readthedocs.io/zh_CN/1.0/" target="_blank" rel="noopener">scrapyä¸­æ–‡æ–‡æ¡£</a></p>
<h3 id="1-ç¼–å†™scrapyçˆ¬è™«æ­¥éª¤"><a href="#1-ç¼–å†™scrapyçˆ¬è™«æ­¥éª¤" class="headerlink" title="1. ç¼–å†™scrapyçˆ¬è™«æ­¥éª¤"></a>1. ç¼–å†™scrapyçˆ¬è™«æ­¥éª¤</h3><ol>
<li><p>æ–°å»ºé¡¹ç›®ï¼šï¼ˆscrapy startproject projectnameï¼‰:æ–°å»ºçˆ¬è™«é¡¹ç›®</p>
</li>
<li><p>åˆ›å»ºçˆ¬è™«ï¼šscrapy genspider spidername â€œ<a href="http://www.xxx.cn/" target="_blank" rel="noopener">http://www.xxx.cn/</a>â€œ</p>
</li>
<li><p>æ˜ç¡®ç›®æ ‡ï¼šï¼ˆç¼–å†™items.pyï¼‰ï¼šæ˜ç¡®æƒ³è¦æŠ“å–çš„ç›®æ ‡</p>
</li>
<li><p>åˆ¶ä½œçˆ¬è™«ï¼šï¼ˆspiders/xxspider.pyï¼‰:åˆ¶ä½œçˆ¬è™«å¼€å§‹çˆ¬å–çš„ç½‘é¡µ</p>
</li>
<li><p>ç¼–å†™pipeline.pyï¼Œå¤„ç†spiderè¿”å›çš„itemæ•°æ®ã€‚å†™Pipelineå‡½æ•°</p>
</li>
<li><p>ç¼–å†™settings.py,å¯åŠ¨ç®¡é“ç»„ä»¶ITEM_PIPELINES={}ï¼Œä»¥åŠå…¶ä»–ç›¸å…³è®¾ç½®USER_AGENT,DEFAULT_REQUEST_HEADERS</p>
</li>
<li><p>æ‰§è¡Œçˆ¬è™«</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> cmdline</span><br><span class="line">cmdline.execute([<span class="string">'scrapy'</span>,<span class="string">'crawl'</span>,<span class="string">'cib'</span>])</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="2-åˆ›å»ºçˆ¬è™«"><a href="#2-åˆ›å»ºçˆ¬è™«" class="headerlink" title="2. åˆ›å»ºçˆ¬è™«"></a>2. åˆ›å»ºçˆ¬è™«</h3><ol>
<li>scrapy genspider spidername â€œ<a href="http://www.xxx.cn/" target="_blank" rel="noopener">http://www.xxx.cn/</a>â€œ<ul>
<li>genspider:è¡¨ç¤ºç”Ÿæˆä¸€ä¸ªçˆ¬è™«ï¼ˆé»˜è®¤æ˜¯scrapy.Spiderç±»ï¼‰</li>
<li>spidernameï¼šè¡¨ç¤ºçˆ¬è™«åï¼ˆå¯¹åº”çˆ¬è™«ä»£ç é‡Œçš„nameå‚æ•°ï¼‰</li>
<li>â€œ<a href="http://www.xxx.cn/" target="_blank" rel="noopener">http://www.xxx.cn/</a>â€œ ï¼šè¡¨ç¤ºå…è®¸çˆ¬è™«çˆ¬å–çš„åŸŸèŒƒå›´</li>
</ul>
</li>
<li>spidername.py<ul>
<li>name= â€˜â€™:çˆ¬è™«çš„è¯†åˆ«åç§°ï¼Œå”¯ä¸€</li>
<li>allow_domains=[] ï¼šæœç´¢çš„åŸŸåèŒƒå›´ï¼Œçˆ¬è™«çš„çº¦æŸåŒºåŸŸï¼Œè§„å®šçˆ¬è™«åªçˆ¬å–è¿™ä¸ªåŸŸåä¸‹çš„ç½‘é¡µï¼Œä¸å­˜åœ¨çš„urlä¼šè¢«å¿½ç•¥</li>
<li>start_urls=():çˆ¬å–çš„urlåˆ—è¡¨ã€‚çˆ¬è™«ä»è¿™é‡Œå¼€å§‹æŠ“å–æ•°æ®ï¼Œæ‰€ä»¥ï¼Œç¬¬ä¸€æ¬¡ä¸‹è½½çš„æ•°æ®å°†ä¼šä»è¿™äº›urlså¼€å§‹ã€‚å…¶ä»–å­URLå°†ä¼šä»è¿™äº›èµ·å§‹URLä¸­ç»§æ‰¿æ€§ç”Ÿæˆ</li>
<li>parse(self,response):è§£æçš„æ–¹æ³•ï¼Œæ¯ä¸ªåˆå§‹URLå®Œæˆä¸‹è½½åå°†è¢«è°ƒç”¨ï¼Œè°ƒç”¨çš„æ—¶å€™ä¼ å…¥æ¯ä¸€ä¸ªURLä¼ å›çš„Responseå¯¹è±¡æ¥ä½œä¸ºå”¯ä¸€å‚æ•°ï¼Œä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š</li>
<li>è´Ÿè´£è§£æè¿”å›çš„ç½‘é¡µæ•°æ®ï¼ˆresponse.bodyï¼‰ï¼Œæå–ç»“æ„åŒ–æ•°æ®ï¼ˆç”Ÿæˆitemï¼‰</li>
<li>ç”Ÿæˆéœ€è¦ä¸‹ä¸€é¡µçš„URLè¯·æ±‚</li>
<li>start_requests(self):è¿™ä¸ªæ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚è¯¥å¯¹è±¡åŒ…å«spiderç”¨äºçˆ¬å–ï¼ˆé»˜è®¤å®ç°æ˜¯ä½¿ç”¨start_urlsçš„urlï¼‰çš„ç¬¬ä¸€ä¸ªRequestã€‚å½“spiderå¯åŠ¨çˆ¬å–å¹¶ä¸”ä¸ºæŒ‡å®šstart_urlsæ—¶ï¼Œè°ƒç”¨è¯¥æ–¹æ³•</li>
<li>logï¼ˆself,message[,level,component]ï¼‰:ä½¿ç”¨scrapy.log.msg()æ–¹æ³•è®°å½•ï¼ˆlogï¼‰message</li>
</ul>
</li>
</ol>
<h3 id="3-æ‰§è¡Œçˆ¬è™«"><a href="#3-æ‰§è¡Œçˆ¬è™«" class="headerlink" title="3. æ‰§è¡Œçˆ¬è™«"></a>3. æ‰§è¡Œçˆ¬è™«</h3><ol>
<li>scrapy crawl spidername -o save_filename<ul>
<li>crawlï¼šè¡¨ç¤ºå¯åŠ¨ä¸€ä¸ªscrapyçˆ¬è™«</li>
<li>spidernameï¼šè¡¨ç¤ºéœ€è¦å¯åŠ¨çš„çˆ¬è™«åï¼ˆå¯¹åº”çˆ¬è™«ä»£ç é‡Œçš„nameå‚æ•°ï¼‰</li>
<li>-0 :è¡¨ç¤ºè¾“å‡ºåˆ°æ–‡ä»¶</li>
<li>save_filename:è¡¨ç¤ºä¿å­˜æ–‡ä»¶çš„åç§°,ï¼Œé»˜è®¤4ç§è¾“å‡ºæ–‡ä»¶æ ¼å¼ï¼šjsonï¼Œjsonlï¼Œcsvï¼Œxml</li>
</ul>
</li>
</ol>
<h3 id="4-æŸ¥çœ‹å½“å‰é¡¹ç›®ä¸‹çš„çˆ¬è™«"><a href="#4-æŸ¥çœ‹å½“å‰é¡¹ç›®ä¸‹çš„çˆ¬è™«" class="headerlink" title="4. æŸ¥çœ‹å½“å‰é¡¹ç›®ä¸‹çš„çˆ¬è™«"></a>4. æŸ¥çœ‹å½“å‰é¡¹ç›®ä¸‹çš„çˆ¬è™«</h3><ol>
<li>scrapy list</li>
</ol>
<h3 id="5-pipeline-çš„ä¸€äº›å…¸å‹åº”ç”¨"><a href="#5-pipeline-çš„ä¸€äº›å…¸å‹åº”ç”¨" class="headerlink" title="5. pipeline çš„ä¸€äº›å…¸å‹åº”ç”¨"></a>5. pipeline çš„ä¸€äº›å…¸å‹åº”ç”¨</h3><ol>
<li>éªŒè¯çˆ¬å–çš„æ•°æ®ï¼ˆæ£€æŸ¥itemåŒ…å«æŸäº›å­—æ®µï¼Œæ¯”å¦‚è¯´nameï¼‰</li>
<li>æ•°æ®æŸ¥é‡ï¼ˆå¹¶ä¸¢å¼ƒï¼‰</li>
<li>å°†çˆ¬å–ç»“æœä¿å­˜åˆ°æ–‡ä»¶æˆ–è€…æ•°æ®åº“ä¸­</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomethingPiple</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="comment"># å¯é€‰å®ç°ï¼Œåšå‚æ•°åˆå§‹åŒ–ï¼Œæ¯”å¦‚æ‰“å¼€æ–‡ä»¶æ“ä½œf.open('xxx','w',edcoding='utf-8')</span></span><br><span class="line">            <span class="comment"># doing something</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self,spider)</span>:</span></span><br><span class="line">            <span class="comment"># spider(Spider å¯¹è±¡) - è¢«å…³é—­çš„spider</span></span><br><span class="line">            <span class="comment"># å¯é€‰å®ç°ï¼Œå½“spiderè¢«å¼€å¯æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨ã€‚</span></span><br><span class="line">            <span class="comment"># è¯¥æ–¹æ³•å’Œ__init__æ–¹æ³•åŠŸèƒ½åŸºæœ¬ç›¸åŒã€‚</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self,item,spider)</span>:</span></span><br><span class="line">            <span class="comment"># item(Itemå¯¹è±¡) - è¢«çˆ¬å–çš„item</span></span><br><span class="line">            <span class="comment"># spider ï¼ˆSpiderå¯¹è±¡ï¼‰ - çˆ¬å–è¯¥itemçš„spider</span></span><br><span class="line">            <span class="comment"># è¿™ä¸ªæ–¹æ³•å¿…é¡»å®ç°ï¼Œæ¯ä¸ªitem pipeline ç»„ä»¶éƒ½éœ€è¦è°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line">            <span class="comment"># è¿™ä¸ªæ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªItemå¯¹è±¡ï¼Œè¢«ä¸¢å¼ƒçš„itemå°†ä¸ä¼šè¢«ä¹‹åçš„pipelineç»„ä»¶å¤„ç†</span></span><br><span class="line">            <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self,spider)</span>:</span></span><br><span class="line">            <span class="comment"># spider(Spider å¯¹è±¡) - è¢«å…³é—­çš„spider</span></span><br><span class="line">            <span class="comment"># å¯é€‰å®ç°ï¼Œå½“spiderè¢«å…³é—­æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨ã€‚</span></span><br><span class="line">            <span class="comment"># æ¯”å¦‚å…³é—­åˆå§‹åŒ–æ‰“å¼€çš„æ–‡ä»¶f.close()</span></span><br></pre></td></tr></table></figure>
<h3 id="6-å¯åŠ¨Scrapy-Shell"><a href="#6-å¯åŠ¨Scrapy-Shell" class="headerlink" title="6. å¯åŠ¨Scrapy Shell"></a>6. å¯åŠ¨Scrapy Shell</h3><p>å‘½ä»¤ï¼šscrapy shell â€œwww.baidu.comâ€</p>
<h3 id="7-selector-é€‰æ‹©å™¨"><a href="#7-selector-é€‰æ‹©å™¨" class="headerlink" title="7. selector é€‰æ‹©å™¨"></a>7. selector é€‰æ‹©å™¨</h3><ol>
<li><p>Selectoræœ‰å››ä¸ªåŸºæœ¬æ–¹æ³•ï¼Œæœ€å¸¸ç”¨çš„æ˜¯xpathï¼š</p>
<ol>
<li><p>xpathï¼ˆï¼‰ï¼šä¼ å…¥xpathè¡¨è¾¾å¼ï¼Œè¿”å›è¯¥è¡¨è¾¾å¼æ‰€å¯¹åº”çš„æ‰€æœ‰èŠ‚ç‚¹çš„selector liståˆ—è¡¨</p>
<p>XPathè¡¨è¾¾å¼çš„ä¾‹å­åŠå¯¹åº”å«ä¹‰ï¼š</p>
<ul>
<li>/html/head/title:é€‰æ‹©<html>æ–‡æ¡£ä¸­<head>æ ‡ç­¾å†…çš„<title>å…ƒç´ </title></head></html></li>
<li>/html/head/title/text():é€‰æ‹©<html>æ–‡æ¡£ä¸­<head>æ ‡ç­¾å†…çš„<title>å…ƒç´ çš„æ–‡å­—</title></head></html></li>
<li>//tdï¼šé€‰æ‹©æ‰€æœ‰çš„<td>å…ƒç´ </td></li>
<li>//div[@class=â€mineâ€]:é€‰æ‹©æ‰€æœ‰å…·æœ‰class=â€mineâ€å±æ€§çš„divå…ƒç´ </li>
</ul>
</li>
<li><p>extractï¼ˆï¼‰ï¼šåºåˆ—åŒ–è¯¥ç»“ç‚¹ä¸ºUnicodeå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›list</p>
</li>
<li><p>css()ï¼šä¼ å…¥cssè¡¨è¾¾å¼ï¼Œè¿”å›è¯¥è¡¨è¾¾å¼æ‰€å¯¹åº”çš„æ‰€æœ‰èŠ‚ç‚¹çš„selector liståˆ—è¡¨ï¼Œè¯­æ³•åŒBeautifulSoup4</p>
</li>
<li><p>re()ï¼šæ ¹æ®ä¼ å…¥çš„æ­£åˆ™è¡¨è¾¾å¼å¯¹æ•°æ®è¿›è¡Œæå–ï¼Œè¿”å›Unicodeå­—ç¬¦ä¸²liståˆ—è¡¨</p>
</li>
</ol>
</li>
<li><p>æ³¨æ„</p>
<ol>
<li><p>xpath è¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨</p>
</li>
<li><p>xpath.extract():å°†xpathå¯¹è±¡è½¬æ¢æˆUnicodeå­—ç¬¦ä¸²</p>
</li>
<li><p>settingsè®¾ç½®</p>
<ul>
<li><p>HTTPERROR_ALLOWED_CODES = [403, 500, 404]</p>
</li>
<li><p>ROBOTSTXT_OBEY = False</p>
</li>
<li><p>ä¸‹è½½ä¸­é—´ä»¶ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DOWNLOAD_DELAY = <span class="number">2</span></span><br><span class="line">        RANDOMIZE_DOWNLOAD_DELAY = <span class="literal">True</span></span><br><span class="line">        COOKIES_ENABLED = <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">        <span class="string">'bank_info.middlewares.MyUserAgentMiddleware'</span>: <span class="number">300</span>,</span><br><span class="line">        <span class="string">'bank_info.middlewares.BankInfoDownloaderMiddleware'</span>: <span class="number">543</span>, <span class="comment"># å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        ITEM_PIPELINES = &#123;</span><br><span class="line">        <span class="string">'bank_info.pipelines.BankInfoPipeline'</span>: <span class="number">300</span>, <span class="comment"># å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="8-scrapyé«˜çº§"><a href="#8-scrapyé«˜çº§" class="headerlink" title="8. scrapyé«˜çº§"></a>8. scrapyé«˜çº§</h3><ol>
<li><p>ç¿»é¡µåŠŸèƒ½ï¼šscrapy.follow(next_page,callback=self.parse)   ä¼šè‡ªåŠ¨æ‹¼æ¥urlå’Œnext_page</p>
</li>
<li><p>æŠ½å–responseä¸­æ»¡è¶³xpathè§„åˆ™çš„é“¾æ¥ï¼šLinkExtractor(restrict_xpath=â€™xxxxâ€™), links = link.extract_links(response)</p>
</li>
<li><p>è¦é˜²æ­¢scrapyè¢«banï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç­–ç•¥ï¼š</p>
<ul>
<li><p>åŠ¨æ€è®¾ç½®user agentï¼ˆ åœ¨middleware.pyä¸­éšæœºé€‰å–user-agent,å¹¶æŠŠå®ƒèµ‹å€¼ç»™requestï¼‰</p>
<ol>
<li><p>åœ¨settingså¼€å¯UAMiddlewareè¿™ä¸ªä¸­é—´ä»¶ï¼šDOWNLOADER_MIDDLEWARES</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UAMiddleware</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># å®šä¹‰ä¸€ä¸ªUser-Agentçš„List</span></span><br><span class="line">    ua_list = [</span><br><span class="line">    <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 '</span>,</span><br><span class="line">    <span class="string">'(KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36'</span>,</span><br><span class="line">    <span class="string">'Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)'</span>,</span><br><span class="line">    <span class="string">'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)'</span>,</span><br><span class="line">    <span class="string">'Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)'</span>,</span><br><span class="line">    <span class="string">'Mozilla/5.0 (compatible; bingbot/2.0; +http://www.bing.com/bingbot.htm)'</span>,</span><br><span class="line">    ]</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request, spider)</span>:</span> <span class="comment"># å¯¹requestè¿›è¡Œæ‹¦æˆª</span></span><br><span class="line">        ua = random.choices(self.ua_list) <span class="comment"># ä½¿ç”¨randomæ¨¡å—ï¼Œéšæœºåœ¨ua_listä¸­é€‰å–User-Agent</span></span><br><span class="line">        request.headers[<span class="string">'User-Agent'</span>] = ua <span class="comment"># æŠŠé€‰å–å‡ºæ¥çš„User-Agentèµ‹ç»™request</span></span><br><span class="line">        print(request.url) <span class="comment"># æ‰“å°å‡ºrequestçš„url</span></span><br><span class="line">        print(request.headers[<span class="string">'User-Agent'</span>]) <span class="comment"># æ‰“å°å‡ºrequestçš„headers</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response, spider)</span>:</span> <span class="comment"># å¯¹responseè¿›è¡Œæ‹¦æˆª</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(self, request, exception, spider)</span>:</span> <span class="comment"># å¯¹process_requestæ–¹æ³•ä¼ å‡ºæ¥çš„å¼‚å¸¸è¿›è¡Œå¤„ç†</span></span><br><span class="line">       <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>ç¦ç”¨cookies ï¼š COOKIES_ENABLED=False</p>
</li>
<li><p>è®¾ç½®å»¶è¿Ÿä¸‹è½½ ï¼š DOWNLOAD_DELAY=2</p>
</li>
<li><p>ä½¿ç”¨Google cache</p>
</li>
<li><p>ä½¿ç”¨IPåœ°å€æ± ï¼ˆTor projectã€VPNå’Œä»£ç†IPï¼‰</p>
</li>
<li><p>ä½¿ç”¨Crawlera</p>
</li>
</ul>
</li>
<li><p>scrapyä¸­é—´ä»¶çš„åˆ†ç±»ï¼š</p>
<ul>
<li>scrapyçš„ä¸­é—´ä»¶ç†è®ºä¸Šæœ‰ä¸‰ç§(Schduler Middleware,Spider Middleware,Downloader Middleware),åœ¨åº”ç”¨ä¸Šä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š<ol>
<li>çˆ¬è™«ä¸­é—´ä»¶Spider Middlewareï¼šå¯ä»¥æ·»åŠ ä»£ç æ¥å¤„ç†å‘é€ç»™ Spiders çš„responseåŠspideräº§ç”Ÿçš„itemå’Œrequest.<ul>
<li>å½“èœ˜è››ä¼ é€’è¯·æ±‚å’Œitemsç»™å¼•æ“çš„è¿‡ç¨‹ä¸­ï¼Œèœ˜è››ä¸­é—´ä»¶å¯ä»¥å¯¹å…¶è¿›è¡Œå¤„ç†ï¼ˆè¿‡æ»¤å‡º URL é•¿åº¦æ¯” URLLENGTH_LIMIT çš„ requestã€‚ï¼‰</li>
<li>å½“å¼•æ“ä¼ é€’å“åº”ç»™èœ˜è››çš„è¿‡ç¨‹ä¸­ï¼Œèœ˜è››ä¸­é—´ä»¶å¯ä»¥å¯¹å“åº”è¿›è¡Œè¿‡æ»¤ï¼ˆä¾‹å¦‚è¿‡æ»¤å‡ºæ‰€æœ‰å¤±è´¥(é”™è¯¯)çš„ HTTP responseï¼‰</li>
</ul>
</li>
<li>ä¸‹è½½å™¨ä¸­é—´ä»¶Downloader Middlewareï¼šä¸»è¦åŠŸèƒ½åœ¨è¯·æ±‚åˆ°ç½‘é¡µå,é¡µé¢è¢«ä¸‹è½½æ—¶è¿›è¡Œä¸€äº›å¤„ç†.ï¼ˆåçˆ¬ç­–ç•¥éƒ½æ˜¯éƒ¨ç½²åœ¨ä¸‹è½½ä¸­é—´ä»¶çš„ï¼‰<ul>
<li>å½“å¼•æ“ä¼ é€’è¯·æ±‚ç»™ä¸‹è½½å™¨çš„è¿‡ç¨‹ä¸­ï¼Œä¸‹è½½ä¸­é—´ä»¶å¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œå¤„ç† ï¼ˆä¾‹å¦‚å¢åŠ http headerä¿¡æ¯ï¼Œå¢åŠ proxyä¿¡æ¯ç­‰ï¼‰</li>
<li>åœ¨ä¸‹è½½å™¨å®Œæˆhttpè¯·æ±‚ï¼Œä¼ é€’å“åº”ç»™å¼•æ“çš„è¿‡ç¨‹ä¸­ï¼Œ ä¸‹è½½ä¸­é—´ä»¶å¯ä»¥å¯¹å“åº”è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚è¿›è¡Œgzipçš„è§£å‹ç­‰ï¼‰</li>
<li>ä¸‹è½½ä¸­é—´ä»¶ä¸‰å¤§å‡½æ•°ï¼š<ol>
<li>process_request(request, spider)â€”â€”ä¸»è¦å‡½æ•°<ul>
<li>process_request() å¿…é¡»è¿”å›å…¶ä¸­ä¹‹ä¸€: è¿”å› None ã€è¿”å›ä¸€ä¸ª Response å¯¹è±¡ã€è¿”å›ä¸€ä¸ª Request å¯¹è±¡æˆ–raise IgnoreRequest</li>
<li>å¦‚æœå…¶è¿”å› Noneï¼š Scrapyå°†ç»§ç»­å¤„ç†è¯¥requestï¼Œæ‰§è¡Œå…¶ä»–çš„ä¸­é—´ä»¶çš„ç›¸åº”æ–¹æ³•ï¼Œç›´åˆ°åˆé€‚çš„ä¸‹è½½å™¨å¤„ç†å‡½æ•°(download handler)è¢«è°ƒç”¨ï¼Œ è¯¥requestè¢«æ‰§è¡Œ(å…¶responseè¢«ä¸‹è½½)</li>
<li>å¦‚æœå…¶è¿”å›Response å¯¹è±¡ï¼š Scrapyå°†ä¸ä¼šè°ƒç”¨ä»»ä½•å…¶ä»–çš„process_request()æˆ– process_exception()æ–¹æ³•ï¼Œæˆ–ç›¸åº”çš„ä¸‹è½½å‡½æ•°ã€‚å…¶å°†è¿”å›è¯¥responseï¼Œå·²å®‰è£…çš„ä¸­é—´ä»¶çš„ process_response() æ–¹æ³•åˆ™ä¼šåœ¨æ¯ä¸ªresponseè¿”å›æ—¶è¢«è°ƒç”¨</li>
<li>å¦‚æœå…¶è¿”å› Requestå¯¹è±¡ ï¼š Scrapyåˆ™ä¼šåœæ­¢è°ƒç”¨ process_requestæ–¹æ³•å¹¶é‡æ–°è°ƒåº¦è¿”å›çš„requestï¼Œä¹Ÿå°±æ˜¯æŠŠrequesté‡æ–°è¿”å›ï¼Œè¿›å…¥è°ƒåº¦å™¨é‡æ–°å…¥é˜Ÿåˆ—</li>
<li>å¦‚æœå…¶è¿”å›raise IgnoreRequestå¼‚å¸¸ ï¼š åˆ™å®‰è£…çš„ä¸‹è½½ä¸­é—´ä»¶çš„ process_exception()æ–¹æ³• ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ä¸ªæ–¹æ³•å¤„ç†è¯¥å¼‚å¸¸ï¼Œ åˆ™requestçš„errback(Request.errback)æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœæ²¡æœ‰ä»£ç å¤„ç†æŠ›å‡ºçš„å¼‚å¸¸ï¼Œ åˆ™è¯¥å¼‚å¸¸è¢«å¿½ç•¥ä¸”ä¸è®°å½•(ä¸åŒäºå…¶ä»–å¼‚å¸¸é‚£æ ·)</li>
</ul>
</li>
<li>process_response(request, response, spider)â€”â€”ä¸»è¦å‡½æ•°<ul>
<li>process_response() å¿…é¡»è¿”å›ä»¥ä¸‹ä¹‹ä¸€ï¼šè¿”å›ä¸€ä¸ªResponse å¯¹è±¡ã€ è¿”å›ä¸€ä¸ªRequest å¯¹è±¡æˆ–raise IgnoreRequest å¼‚å¸¸</li>
<li>å¦‚æœå…¶è¿”å›ä¸€ä¸ª Responseå¯¹è±¡ï¼š (å¯ä»¥ä¸ä¼ å…¥çš„responseç›¸åŒï¼Œä¹Ÿå¯ä»¥æ˜¯å…¨æ–°çš„å¯¹è±¡)ï¼Œ è¯¥responseä¼šè¢«åœ¨é“¾ä¸­çš„å…¶ä»–ä¸­é—´ä»¶çš„ process_response() æ–¹æ³•å¤„ç†</li>
<li>å¦‚æœå…¶è¿”å›ä¸€ä¸ª Requestå¯¹è±¡ï¼š åˆ™ä¸­é—´ä»¶é“¾åœæ­¢ï¼Œ è¿”å›çš„requestä¼šè¢«é‡æ–°è°ƒåº¦ä¸‹è½½ã€‚å¤„ç†ç±»ä¼¼äº process_request() è¿”å›requestæ‰€åšçš„é‚£æ ·</li>
<li>å¦‚æœå…¶æŠ›å‡ºä¸€ä¸ªIgnoreRequestå¼‚å¸¸ ï¼šåˆ™è°ƒç”¨requestçš„errback(Request.errback)ã€‚</li>
<li>å¦‚æœæ²¡æœ‰ä»£ç å¤„ç†æŠ›å‡ºçš„å¼‚å¸¸ï¼Œåˆ™è¯¥å¼‚å¸¸è¢«å¿½ç•¥ä¸”ä¸è®°å½•(ä¸åŒäºå…¶ä»–å¼‚å¸¸é‚£æ ·)</li>
</ul>
</li>
<li>process_exception(request, exception, spider)<ul>
<li>å¦‚æœå…¶è¿”å› None ï¼š Scrapyå°†ä¼šç»§ç»­å¤„ç†è¯¥å¼‚å¸¸ï¼Œæ¥ç€è°ƒç”¨å·²å®‰è£…çš„å…¶ä»–ä¸­é—´ä»¶çš„ process_exception()æ–¹æ³•ï¼Œç›´åˆ°æ‰€æœ‰ä¸­é—´ä»¶éƒ½è¢«è°ƒç”¨å®Œæ¯•ï¼Œåˆ™è°ƒç”¨é»˜è®¤çš„å¼‚å¸¸å¤„ç†</li>
<li>å¦‚æœå…¶è¿”å›ä¸€ä¸ª Response å¯¹è±¡ï¼š ç›¸å½“äºå¼‚å¸¸è¢«çº æ­£äº†ï¼Œåˆ™å·²å®‰è£…çš„ä¸­é—´ä»¶é“¾çš„ process_response()æ–¹æ³•è¢«è°ƒç”¨ã€‚Scrapyå°†ä¸ä¼šè°ƒç”¨ä»»ä½•å…¶ä»–ä¸­é—´ä»¶çš„ process_exception()æ–¹æ³•</li>
<li>å¦‚æœå…¶è¿”å›ä¸€ä¸ª Request å¯¹è±¡ï¼š åˆ™è¿”å›çš„requestå°†ä¼šè¢«é‡æ–°è°ƒç”¨ä¸‹è½½ã€‚è¿™å°†åœæ­¢ä¸­é—´ä»¶çš„ process_exception() æ–¹æ³•æ‰§è¡Œï¼Œå°±å¦‚è¿”å›ä¸€ä¸ªresponseçš„é‚£æ ·</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li><p>å…¶ä»–å†…ç½®downloader middleware</p>
<p>| item | value |<br>| â€”- | â€”- |<br>| DefaultHeadersMiddleware | å°†æ‰€æœ‰requestçš„å¤´è®¾ç½®ä¸ºé»˜è®¤æ¨¡å¼ |<br>| DownloadTimeoutMiddleware | è®¾ç½®requestçš„timeout |<br>| HttpAuthMiddleware | å¯¹æ¥è‡ªç‰¹å®šspiderçš„requestæˆæƒ |<br>| HttpCacheMiddleware | ç»™request&amp;responseè®¾ç½®ç¼“å­˜ç­–ç•¥ |<br>| HttpProxyMiddleware | ç»™æ‰€æœ‰requestè®¾ç½®httpä»£ç† |<br>| RedirectMiddleware | å¤„ç†requestçš„é‡å®šå‘ |<br>| MetaRefreshMiddleware | æ ¹æ®meta-refresh html tagå¤„ç†é‡å®šå‘ |<br>| RetryMiddleware | å¤±è´¥é‡è¯•ç­–ç•¥ |<br>| RobotsTxtMiddleware | robotså°ç¦å¤„ç† |<br>| UserAgentMiddleware | æ”¯æŒuser agenté‡å†™ |</p>
</li>
<li><p>æŠŠæ•°æ®ä¿å­˜åˆ°jsonæ–‡ä»¶</p>
<p>ä¸‹é¢è¿™ä¸ªä¾‹å­å°†ä¼šæŠŠæ‰€æœ‰çˆ¬è™«æ‰€çˆ¬å–åˆ°çš„æ•°æ®ä¿å­˜åˆ° items.jl æ–‡ä»¶ä¸­ï¼Œ.jlæ—¢æ˜¯è¡¨ç¤º JSON Lines æ ¼å¼ï¼Œæ—¢æ˜¯æ¯ä¸€è¡Œå­˜å‚¨ä¸€ä¸ª itemï¼›</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JsonWriterPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.file = open(<span class="string">'items.jl'</span>, <span class="string">'w'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.file.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        line = json.dumps(dict(item)) + <span class="string">"\n"</span></span><br><span class="line">        self.file.write(line)</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŠŠæ•°æ®å†™åˆ°MongoDB</p>
<p>MongoDB address ä»¥åŠ database name æ˜¯é€šè¿‡ Scrapy settings é…ç½®çš„ï¼›ä¸‹é¢è¿™ä¸ªç”¨ä¾‹ä¸»è¦ç”¨æ¥å±•ç¤ºå¦‚ä½•ä½¿ç”¨ from_crawler çš„ç”¨æ³•ä»¥åŠå¦‚ä½•æ­£ç¡®çš„æ¸…ç†æ‰è¿™äº›ç›¸å…³çš„ resources</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MongoPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    collection_name = <span class="string">'scrapy_items'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, mongo_uri, mongo_db)</span>:</span></span><br><span class="line">        self.mongo_uri = mongo_uri</span><br><span class="line">        self.mongo_db = mongo_db</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_crawler</span><span class="params">(cls, crawler)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls(</span><br><span class="line">            mongo_uri=crawler.settings.get(<span class="string">'MONGO_URI'</span>),</span><br><span class="line">            mongo_db=crawler.settings.get(<span class="string">'MONGO_DATABASE'</span>, <span class="string">'items'</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.client = pymongo.MongoClient(self.mongo_uri)</span><br><span class="line">        self.db = self.client[self.mongo_db]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.client.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        self.db[self.collection_name].insert_one(dict(item))</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="9-çˆ¬å–åŠ¨æ€é¡µé¢"><a href="#9-çˆ¬å–åŠ¨æ€é¡µé¢" class="headerlink" title="9. çˆ¬å–åŠ¨æ€é¡µé¢"></a>9. çˆ¬å–åŠ¨æ€é¡µé¢</h3><p>åœ¨scrapyä¸­ä½¿ç”¨splash</p>
<ol>
<li><p>å®‰è£…docker ï¼š</p>
</li>
<li><p>å®‰è£…splashï¼šdocker pull scrapinghub/splash</p>
</li>
<li><p>å¼€å¯ç«¯å£:docker run -p 5023:5023 -p 8050:8050 -p 8051:8051 scrapinghub/splash</p>
</li>
<li><p>å®‰è£… scrapy-splash: pip install scrapy-splash</p>
</li>
<li><p>ä¿®æ”¹setting.pyæ–‡ä»¶å¯¹scrapy-splashè¿›è¡Œé…ç½®</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#SplashæœåŠ¡å™¨åœ°å€</span></span><br><span class="line"><span class="string">SPLASH_URL</span> <span class="string">=</span> <span class="string">'http://localhost:8050'</span></span><br><span class="line"><span class="comment">#å¼€å¯Splashçš„ä¸¤ä¸ªä¸‹è½½ä¸­é—´ä»¶å¹¶è°ƒæ•´HttpCompressionMiddlewareçš„æ¬¡åº</span></span><br><span class="line"> <span class="string">DOWNLOADER_MIDDLEWARES</span> <span class="string">=</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">'scrapy_splash.SplashCookiesMiddleware':</span> <span class="number">723</span><span class="string">,</span></span><br><span class="line">    <span class="attr">'scrapy_splash.SplashMiddleware':</span> <span class="number">725</span><span class="string">,</span></span><br><span class="line">    <span class="attr">'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware':</span> <span class="number">810</span><span class="string">,</span></span><br><span class="line"> <span class="string">&#125;</span></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line"> <span class="comment">#è®¾ç½®å»é‡è¿‡æ»¤å™¨</span></span><br><span class="line"> <span class="string">DUPEFILTER_CLASS</span> <span class="string">=</span> <span class="string">'scrapy_splash.SplashAwareDupeFilter'</span></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line"> <span class="comment">#ç”¨æ¥æ”¯æŒcache_argsï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"> <span class="string">SPIDER_MIDDLEWARES</span> <span class="string">=</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">'scrapy_splash.SplashDeduplicateArgsMiddleware':</span> <span class="number">100</span><span class="string">,</span></span><br><span class="line"> <span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>çˆ¬è™«</category>
      </categories>
      <tags>
        <tag>ä¸“ä¸šæŠ€èƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title>selenium</title>
    <url>/2019/08/09/selenium/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><ol>
<li><p>å®‰è£…ï¼špip install selenium</p>
<p>å› ä¸ºseleniumæ˜¯é…åˆæµè§ˆå™¨ä¸€èµ·ä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦ä¸‹è½½æµè§ˆå™¨çš„é©±åŠ¨(webdriver)ï¼Œä»¥chromeä¸ºä¾‹ï¼šchromeçš„webdriverï¼š <a href="http://chromedriver.storage.googleapis.com/index.html" target="_blank" rel="noopener">chromedriver</a> ä¸åŒçš„Chromeçš„ç‰ˆæœ¬å¯¹åº”çš„chromedriver.exe ç‰ˆæœ¬ä¹Ÿä¸ä¸€æ ·ã€‚å¦‚æœæ˜¯æœ€æ–°çš„Chrome, ä¸‹è½½æœ€æ–°çš„chromedriver.exe å°±å¯ä»¥ã€‚æŠŠchromedriverçš„è·¯å¾„ä¹ŸåŠ åˆ°<strong>ç¯å¢ƒå˜é‡</strong>é‡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver      <span class="comment"># å¼•å…¥webdriver api</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()     <span class="comment"># ä½¿ç”¨chromeæµè§ˆå™¨å£°æ˜ä¸€ä¸ªwebdriverå¯¹è±¡</span></span><br><span class="line"><span class="comment"># driver = webdriver.Chrome('/your path /webdriver')</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  driver.get(<span class="string">'http://www.baidu.com/'</span>) <span class="comment"># è¡¨ç¤ºä½¿ç”¨chromeä»¥getçš„æ–¹å¼è¯·æ±‚ç™¾åº¦çš„url</span></span><br><span class="line">  driver.find_element_by_id(<span class="string">"kw"</span>).send_keys(<span class="string">"selenium"</span>)   <span class="comment"># æ£€ç´¢åˆ°ç™¾åº¦çš„è¾“å…¥æ¡†ï¼Œè¾“å…¥selenium</span></span><br><span class="line">  driver.find_element_by_id(<span class="string">"su"</span>).click() <span class="comment"># æ£€ç´¢åˆ°ç™¾åº¦çš„æœç´¢æŒ‰é’®å¹¶ç‚¹å‡»</span></span><br><span class="line">  wait = WebDriverWait(driever,<span class="number">10</span>) <span class="comment"># ç­‰å¾…åŠ è½½</span></span><br><span class="line">  wait.until(EC.presence_of_element_located((By.ID,<span class="string">'content_left'</span>)))</span><br><span class="line">  print(driver.current_url)  <span class="comment"># è¾“å‡ºå½“å‰é¡µé¢url</span></span><br><span class="line">  print(driver.get_cookies) <span class="comment"># è¾“å‡ºcookies</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">  driver.close()</span><br></pre></td></tr></table></figure>
<a id="more"></a>
</li>
<li><p>å…ƒç´ é€‰å–</p>
<ol>
<li><p>å•å…ƒç´ é€‰å–</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">find_element_by_id      <span class="comment"># é€šè¿‡å…ƒç´ id</span></span><br><span class="line">find_element_by_name    <span class="comment"># é€šè¿‡nameå±æ€§</span></span><br><span class="line">find_element_by_xpath   <span class="comment"># é€šè¿‡xpath</span></span><br><span class="line">find_element_by_link_text   <span class="comment"># é€šè¿‡é“¾æ¥æ–‡æœ¬</span></span><br><span class="line">find_element_by_partial_link_text</span><br><span class="line">find_element_by_tag_name    <span class="comment"># é€šè¿‡æ ‡ç­¾å</span></span><br><span class="line">find_element_by_class_name      <span class="comment"># é€šè¿‡classåç§°å®šä½</span></span><br><span class="line">find_element_by_css_selector    <span class="comment"># é€šè¿‡cssé€‰æ‹©å™¨å®šä½</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¤šå…ƒç´ é€‰å–</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">find_elements_by_name</span><br><span class="line">find_elements_by_xpath</span><br><span class="line">find_elements_by_link_text</span><br><span class="line">find_elements_by_partial_link_text</span><br><span class="line">find_elements_by_tag_name</span><br><span class="line">find_elements_by_class_name</span><br><span class="line">find_elements_by_css_selector</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>å…ƒç´ æ“ä½œ</p>
<ul>
<li>clear æ¸…é™¤å…ƒç´ çš„å†…å®¹ï¼šclear(self)</li>
<li>send_keys æ¨¡æ‹ŸæŒ‰é”®è¾“å…¥ï¼šsend_keys(self, *value)</li>
<li>click ç‚¹å‡»å…ƒç´ ï¼šclick(self)</li>
<li>submit æäº¤è¡¨å•ï¼šsubmit(self)</li>
<li>è·å–å…ƒç´ å±æ€§ï¼šget_attribute(self, name)</li>
<li>è·å–å…ƒç´ æ–‡æœ¬ï¼štext</li>
</ul>
</li>
</ol>
   <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">driver.find_element_by_id(<span class="string">"kw"</span>).clear()</span><br></pre></td></tr></table></figure>
<ol>
<li><p><strong>é¡µé¢æ“ä½œæ–¹æ³•</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰“å¼€æµè§ˆå™¨</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"><span class="comment"># è¯·æ±‚ä¸€ä¸ªurl</span></span><br><span class="line">driver.get(<span class="string">"www.baidu.com"</span>)</span><br><span class="line"><span class="comment"># è¿”å›å½“å‰é¡µé¢çš„title</span></span><br><span class="line">title = driver.title</span><br><span class="line"><span class="comment"># è¿”å›å½“å‰é¡µé¢çš„url</span></span><br><span class="line">url = driver.current_url</span><br><span class="line"><span class="comment"># è¿”å›å½“å‰é¡µé¢çš„æºç </span></span><br><span class="line">source = driver.page_source</span><br><span class="line"><span class="comment"># å…³é—­å½“å‰é¡µé¢</span></span><br><span class="line">driver.close()</span><br><span class="line"><span class="comment"># æ³¨é”€å¹¶å…³é—­æµè§ˆå™¨</span></span><br><span class="line">driver.quit()</span><br><span class="line"><span class="comment"># æµè§ˆå™¨å‰è¿›</span></span><br><span class="line">driver.forward()</span><br><span class="line"><span class="comment"># æµè§ˆå™¨åé€€</span></span><br><span class="line">driver.back()</span><br><span class="line"><span class="comment"># åˆ·æ–°å½“å‰é¡µé¢</span></span><br><span class="line">driver.refresh()</span><br><span class="line"><span class="comment"># è·å–å½“å‰sessionä¸­çš„å…¨éƒ¨cookie</span></span><br><span class="line">get_cookies(self)</span><br><span class="line"><span class="comment"># è·å–å½“å‰ä¼šä¸­ä¸­çš„æŒ‡å®šcookie</span></span><br><span class="line">get_cookie(self, name)</span><br><span class="line"><span class="comment"># åœ¨å½“å‰ä¼šè¯ä¸­æ·»åŠ cookie</span></span><br><span class="line">add_cookie(self, cookie_dict)</span><br><span class="line"><span class="comment"># æ·»åŠ æµè§ˆå™¨User-Agentï¼š</span></span><br><span class="line">options.add_argument(<span class="string">'User-Agent=Mozilla/5.0 (Linux; U; Android 4.0.2; en-us; Galaxy Nexus Build/ICL53F) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30'</span>)</span><br><span class="line"><span class="comment"># æ·»åŠ è®¾ç½®é¡¹Chrome Optionsï¼š</span></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'xxxx'</span>)</span><br><span class="line">driver = webdriver.Chrome(chrome_options=options)</span><br></pre></td></tr></table></figure>
</li>
<li><p>é¡µé¢ç­‰å¾…</p>
<ol>
<li><p>éšå¼ç­‰å¾…ï¼šç®€å•çš„è®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œå•ä½ä¸ºï¼šç§’</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>) <span class="comment"># seconds</span></span><br><span class="line">driver.get(<span class="string">"http://somedomain/url_that_delays_loading"</span>)</span><br><span class="line">myDynamicElement = driver.find_element_by_id(<span class="string">"myDynamicElement"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ˜¾å¼ç­‰å¾…ï¼šæŒ‡å®šæŸä¸ªæ¡ä»¶ï¼Œç„¶åè®¾ç½®æœ€é•¿ç­‰å¾…æ—¶é—´ã€‚å¦‚æœåœ¨è¿™ä¸ªæ—¶é—´è¿˜æ²¡æœ‰æ‰¾åˆ°å…ƒç´ ï¼Œä¾¿ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(<span class="string">"http://somedomain/url_that_delays_loading"</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"> 	<span class="comment"># è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯untilæˆ–until_notä¸­çš„å¯æ‰§è¡Œæ–¹æ³•methodå‚æ•°ï¼Œå¾ˆå¤šäººä¼ å…¥äº†WebElementå¯¹è±¡</span></span><br><span class="line">  <span class="comment"># WebDriverWait(driver, 10).until(driver.find_element_by_id('kw'))  é”™è¯¯</span></span><br><span class="line">  element = WebDriverWait(driver, <span class="number">10</span>).until(</span><br><span class="line">            EC.presence_of_element_located((By.ID, <span class="string">"myDynamicElement"</span>))</span><br><span class="line">            )</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>expected_conditions(17ä¸ªæ¡ä»¶)ï¼šexpected_conditionsæ˜¯seleniumçš„ä¸€ä¸ªæ¨¡å—ï¼Œå…¶ä¸­åŒ…å«ä¸€ç³»åˆ—å¯ç”¨äºåˆ¤æ–­çš„æ¡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">selenium.webdriver.support.expected_conditions</span><br><span class="line"></span><br><span class="line">è¿™ä¸¤ä¸ªæ¡ä»¶ç±»éªŒè¯titleï¼ŒéªŒè¯ä¼ å…¥çš„å‚æ•°titleæ˜¯å¦ç­‰äºæˆ–åŒ…å«äºdriver.title</span><br><span class="line">title_is</span><br><span class="line">title_contains</span><br><span class="line"></span><br><span class="line">ä¸€ä¸ªåªè¦ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å…ƒç´ åŠ è½½å‡ºæ¥å°±é€šè¿‡ï¼›å¦ä¸€ä¸ªå¿…é¡»æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å…ƒç´ éƒ½åŠ è½½å‡ºæ¥æ‰è¡Œ</span><br><span class="line">presence_of_element_located</span><br><span class="line">presence_of_all_elements_located</span><br><span class="line"></span><br><span class="line">è¿™ä¸‰ä¸ªæ¡ä»¶éªŒè¯å…ƒç´ æ˜¯å¦å¯è§ï¼Œå‰ä¸¤ä¸ªä¼ å…¥å‚æ•°æ˜¯å…ƒç»„ç±»å‹çš„locatorï¼Œç¬¬ä¸‰ä¸ªä¼ å…¥WebElement</span><br><span class="line">ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªå…¶å®è´¨æ˜¯ä¸€æ ·çš„</span><br><span class="line">visibility_of_element_located</span><br><span class="line">invisibility_of_element_located</span><br><span class="line">visibility_of</span><br><span class="line"></span><br><span class="line">è¿™ä¸¤ä¸ªäººæ¡ä»¶åˆ¤æ–­æŸæ®µæ–‡æœ¬æ˜¯å¦å‡ºç°åœ¨æŸå…ƒç´ ä¸­ï¼Œä¸€ä¸ªåˆ¤æ–­å…ƒç´ çš„textï¼Œä¸€ä¸ªåˆ¤æ–­å…ƒç´ çš„value</span><br><span class="line">text_to_be_present_in_element</span><br><span class="line">text_to_be_present_in_element_value</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªæ¡ä»¶åˆ¤æ–­frameæ˜¯å¦å¯åˆ‡å…¥ï¼Œå¯ä¼ å…¥locatorå…ƒç»„æˆ–è€…ç›´æ¥ä¼ å…¥å®šä½æ–¹å¼ï¼šidã€nameã€indexæˆ–WebElement</span><br><span class="line">frame_to_be_available_and_switch_to_it</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªæ¡ä»¶åˆ¤æ–­æ˜¯å¦æœ‰alertå‡ºç°</span><br><span class="line">alert_is_present</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªæ¡ä»¶åˆ¤æ–­å…ƒç´ æ˜¯å¦å¯ç‚¹å‡»ï¼Œä¼ å…¥locator</span><br><span class="line">element_to_be_clickable</span><br><span class="line"></span><br><span class="line">è¿™å››ä¸ªæ¡ä»¶åˆ¤æ–­å…ƒç´ æ˜¯å¦è¢«é€‰ä¸­ï¼Œç¬¬ä¸€ä¸ªæ¡ä»¶ä¼ å…¥WebElementå¯¹è±¡ï¼Œç¬¬äºŒä¸ªä¼ å…¥locatorå…ƒç»„</span><br><span class="line">ç¬¬ä¸‰ä¸ªä¼ å…¥WebElementå¯¹è±¡ä»¥åŠçŠ¶æ€ï¼Œç›¸ç­‰è¿”å›<span class="literal">True</span>ï¼Œå¦åˆ™è¿”å›<span class="literal">False</span></span><br><span class="line">ç¬¬å››ä¸ªä¼ å…¥locatorä»¥åŠçŠ¶æ€ï¼Œç›¸ç­‰è¿”å›<span class="literal">True</span>ï¼Œå¦åˆ™è¿”å›<span class="literal">False</span></span><br><span class="line">element_to_be_selected</span><br><span class="line">element_located_to_be_selected</span><br><span class="line">element_selection_state_to_be</span><br><span class="line">element_located_selection_state_to_be</span><br><span class="line"></span><br><span class="line">æœ€åä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦ä»åœ¨DOMä¸­ï¼Œä¼ å…¥WebElementå¯¹è±¡ï¼Œå¯ä»¥åˆ¤æ–­é¡µé¢æ˜¯å¦åˆ·æ–°äº†</span><br><span class="line">staleness_of</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>é¼ æ ‡æ“ä½œ</strong></p>
<ul>
<li>context_click(elem) å³å‡»é¼ æ ‡ç‚¹å‡»å…ƒç´ elemï¼Œå¦å­˜ä¸ºç­‰è¡Œä¸º</li>
<li>double_click(elem) åŒå‡»é¼ æ ‡ç‚¹å‡»å…ƒç´ elemï¼Œåœ°å›¾webå¯å®ç°æ”¾å¤§åŠŸèƒ½</li>
<li>drag_and_drop(source,target) æ‹–åŠ¨é¼ æ ‡ï¼Œæºå…ƒç´ æŒ‰ä¸‹å·¦é”®ç§»åŠ¨è‡³ç›®æ ‡å…ƒç´ é‡Šæ”¾</li>
<li>move_to_element(elem) é¼ æ ‡ç§»åŠ¨åˆ°ä¸€ä¸ªå…ƒç´ ä¸Š</li>
<li>click_and_hold(elem) æŒ‰ä¸‹é¼ æ ‡å·¦é”®åœ¨ä¸€ä¸ªå…ƒç´ ä¸Š</li>
<li>perform() åœ¨é€šè¿‡è°ƒç”¨è¯¥å‡½æ•°æ‰§è¡ŒActionChainsä¸­å­˜å‚¨è¡Œä¸º</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è·å–é€šè¿‡é¼ æ ‡å³é”®å¦å­˜ä¸ºç™¾åº¦å›¾ç‰‡logoçš„ä¾‹å­</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains</span><br><span class="line"> </span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line">driver.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#é¼ æ ‡ç§»åŠ¨è‡³å›¾ç‰‡ä¸Š å³é”®ä¿å­˜å›¾ç‰‡</span></span><br><span class="line">elem_pic = driver.find_element_by_xpath(<span class="string">"//div[@id='lg']/img"</span>)</span><br><span class="line"><span class="keyword">print</span> elem_pic.get_attribute(<span class="string">"src"</span>)</span><br><span class="line">action = ActionChains(driver).move_to_element(elem_pic)</span><br><span class="line">action.context_click(elem_pic)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#é‡ç‚¹:å½“å³é”®é¼ æ ‡ç‚¹å‡»é”®ç›˜å…‰æ ‡å‘ä¸‹åˆ™ç§»åŠ¨è‡³å³é”®èœå•ç¬¬ä¸€ä¸ªé€‰é¡¹</span></span><br><span class="line">action.send_keys(Keys.ARROW_DOWN)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">action.send_keys(<span class="string">'v'</span>) <span class="comment">#å¦å­˜ä¸º</span></span><br><span class="line">action.perform()</span><br><span class="line"> </span><br><span class="line"><span class="comment">#è·å–å¦å­˜ä¸ºå¯¹è¯æ¡†(å¤±è´¥)</span></span><br><span class="line">alert.switch_to_alert()</span><br><span class="line">alert.accept()</span><br><span class="line"><span class="comment"># driver.switch_to_alert().accept()  # ç‚¹å‡»å¼¹å‡ºé‡Œé¢çš„ç¡®å®šæŒ‰é’®</span></span><br><span class="line"><span class="comment"># driver.switch_to_alert().dismiss() # ç‚¹å‡»å¼¹å‡ºä¸Šé¢çš„XæŒ‰é’®</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>é”®ç›˜æ“ä½œ</strong></p>
<ul>
<li>send_keys(Keys.ENTER) æŒ‰ä¸‹å›è½¦é”®</li>
<li>send_keys(Keys.TAB) æŒ‰ä¸‹Tabåˆ¶è¡¨é”®</li>
<li>send_keys(Keys.SPACE) æŒ‰ä¸‹ç©ºæ ¼é”®space</li>
<li>send_keys(Kyes.ESCAPE) æŒ‰ä¸‹å›é€€é”®Esc</li>
<li>send_keys(Keys.BACK_SPACE) æŒ‰ä¸‹åˆ é™¤é”®BackSpace</li>
<li>send_keys(Keys.SHIFT) æŒ‰ä¸‹shifté”®</li>
<li>send_keys(Keys.CONTROL) æŒ‰ä¸‹Ctrlé”®</li>
<li>send_keys(Keys.ARROW_DOWN) æŒ‰ä¸‹é¼ æ ‡å…‰æ ‡å‘ä¸‹æŒ‰é”®</li>
<li>send_keys(Keys.CONTROL,â€™aâ€™) ç»„åˆé”®å…¨é€‰Ctrl+A</li>
<li>send_keys(Keys.CONTROL,â€™câ€™) ç»„åˆé”®å¤åˆ¶Ctrl+C</li>
<li>send_keys(Keys.CONTROL,â€™xâ€™) ç»„åˆé”®å‰ªåˆ‡Ctrl+X</li>
<li>send_keys(Keys.CONTROL,â€™vâ€™) ç»„åˆé”®ç²˜è´´Ctrl+V</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"> </span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line">driver.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#è¾“å…¥æ¡†è¾“å…¥å†…å®¹</span></span><br><span class="line">elem = driver.find_element_by_id(<span class="string">"kw"</span>)</span><br><span class="line">elem.send_keys(<span class="string">"Eastmount CSDN"</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#åˆ é™¤ä¸€ä¸ªå­—ç¬¦CSDN å›é€€é”®</span></span><br><span class="line">elem.send_keys(Keys.BACK_SPACE)</span><br><span class="line">elem.send_keys(Keys.BACK_SPACE)</span><br><span class="line">elem.send_keys(Keys.BACK_SPACE)</span><br><span class="line">elem.send_keys(Keys.BACK_SPACE)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#è¾“å…¥ç©ºæ ¼+"åšå®¢"</span></span><br><span class="line">elem.send_keys(Keys.SPACE)</span><br><span class="line">elem.send_keys(<span class="string">u"åšå®¢"</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#ctrl+a å…¨é€‰è¾“å…¥æ¡†å†…å®¹</span></span><br><span class="line">elem.send_keys(Keys.CONTROL,<span class="string">'a'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#ctrl+x å‰ªåˆ‡è¾“å…¥æ¡†å†…å®¹</span></span><br><span class="line">elem.send_keys(Keys.CONTROL,<span class="string">'x'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#è¾“å…¥æ¡†é‡æ–°è¾“å…¥æœç´¢</span></span><br><span class="line">elem.send_keys(Keys.CONTROL,<span class="string">'v'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#é€šè¿‡å›è½¦é”®æ›¿ä»£ç‚¹å‡»æ“ä½œ</span></span><br><span class="line">driver.find_element_by_id(<span class="string">"su"</span>).send_keys(Keys.ENTER)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
</li>
<li><p>æˆªå›¾ä¿å­˜ï¼šå½“çˆ¬è™«å‡ºé”™æ—¶å¯ä»¥æˆªå›¾ä¿å­˜å½“æ—¶é¡µé¢ï¼Œä»¥ä¾¿å¤ç°bugï¼Œè¿›è¡Œåˆ†æã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">driver.maximize_window()</span><br><span class="line">driver.get_screenshot_as_file(<span class="string">"screen shot saved path/pic_&#123;&#125;.png"</span>.format(xx))</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯¹seleniumäºŒæ¬¡å°è£…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasePage</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ä¸»è¦æ˜¯æŠŠå¸¸ç”¨çš„å‡ ä¸ªSeleniumæ–¹æ³•å°è£…åˆ°BasePageè¿™ä¸ªç±»ï¼Œæˆ‘ä»¬è¿™é‡Œæ¼”ç¤ºä»¥ä¸‹å‡ ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="string">    back()</span></span><br><span class="line"><span class="string">    forward()</span></span><br><span class="line"><span class="string">    get()</span></span><br><span class="line"><span class="string">    quit()</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, driver)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å†™ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæœ‰ä¸€ä¸ªå‚æ•°driver</span></span><br><span class="line"><span class="string">        :param driver:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver = driver</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">back</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æµè§ˆå™¨åé€€æŒ‰é’®</span></span><br><span class="line"><span class="string">        :param none:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver.back()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æµè§ˆå™¨å‰è¿›æŒ‰é’®</span></span><br><span class="line"><span class="string">        :param none:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver.forward()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_url</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ‰“å¼€urlç«™ç‚¹</span></span><br><span class="line"><span class="string">        :param url:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver.get(url)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">quit_browser</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å…³é—­å¹¶åœæ­¢æµè§ˆå™¨æœåŠ¡</span></span><br><span class="line"><span class="string">        :param none:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver.quit()</span><br><span class="line">       </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BrowserEngine</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    å®šä¹‰ä¸€ä¸ªæµè§ˆå™¨å¼•æ“ç±»ï¼Œæ ¹æ®browser_typeçš„å€¼å»ï¼Œæ§åˆ¶å¯åŠ¨ä¸åŒçš„æµè§ˆå™¨ï¼Œè¿™é‡Œä¸»è¦æ˜¯IEï¼ŒFirefox, Chrome</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, driver)</span>:</span></span><br><span class="line">        self.driver = driver</span><br><span class="line"> </span><br><span class="line">    browser_type = <span class="string">"IE"</span>   <span class="comment"># maybe Firefox, Chrome, IE</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_browser</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        é€šè¿‡ifè¯­å¥ï¼Œæ¥æ§åˆ¶åˆå§‹åŒ–ä¸åŒæµè§ˆå™¨çš„å¯åŠ¨ï¼Œé»˜è®¤æ˜¯å¯åŠ¨Chrome</span></span><br><span class="line"><span class="string">        :return: driver</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> self.browser_type == <span class="string">'Firefox'</span>:</span><br><span class="line">            driver = webdriver.Firefox()</span><br><span class="line">        <span class="keyword">elif</span> self.browser_type == <span class="string">'Chrome'</span>:</span><br><span class="line">            driver = webdriver.Chrome()</span><br><span class="line">        <span class="keyword">elif</span> self.browser_type == <span class="string">'IE'</span>:</span><br><span class="line">            driver = webdriver.Ie()</span><br><span class="line">        <span class="keyword">else</span>: driver = webdriver.Chrome()</span><br><span class="line"> </span><br><span class="line">        driver.maximize_window()</span><br><span class="line">        driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> driver</span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>çˆ¬è™«</category>
      </categories>
      <tags>
        <tag>ä¸“ä¸šæŠ€èƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title>requests</title>
    <url>/2019/07/19/requests/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><ol>
<li>çˆ¬è™«çš„åŸºæœ¬æµç¨‹<ul>
<li><strong>å‘èµ·è¯·æ±‚</strong><br>é€šè¿‡HTTPåº“å‘ç›®æ ‡ç«™ç‚¹å‘èµ·è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯å‘é€ä¸€ä¸ªRequestï¼Œè¯·æ±‚å¯ä»¥åŒ…å«é¢å¤–çš„headerç­‰ä¿¡æ¯ï¼Œç­‰å¾…æœåŠ¡å™¨å“åº”</li>
<li><strong>è·å–å“åº”å†…å®¹</strong><br>å¦‚æœæœåŠ¡å™¨èƒ½æ­£å¸¸å“åº”ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªResponseï¼ŒResponseçš„å†…å®¹ä¾¿æ˜¯æ‰€è¦è·å–çš„é¡µé¢å†…å®¹ï¼Œç±»å‹å¯èƒ½æ˜¯HTML,Jsonå­—ç¬¦ä¸²ï¼ŒäºŒè¿›åˆ¶æ•°æ®ï¼ˆå›¾ç‰‡æˆ–è€…è§†é¢‘ï¼‰ç­‰ç±»å‹</li>
<li><strong>è§£æå†…å®¹</strong><br>å¾—åˆ°çš„å†…å®¹å¯èƒ½æ˜¯HTML,å¯ä»¥ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œé¡µé¢è§£æåº“è¿›è¡Œè§£æï¼Œå¯èƒ½æ˜¯Json,å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºJsonå¯¹è±¡è§£æï¼Œå¯èƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå¯ä»¥åšä¿å­˜æˆ–è€…è¿›ä¸€æ­¥çš„å¤„ç†</li>
<li><strong>ä¿å­˜æ•°æ®</strong><br>ä¿å­˜å½¢å¼å¤šæ ·ï¼Œå¯ä»¥å­˜ä¸ºæ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥ä¿å­˜åˆ°æ•°æ®åº“ï¼Œæˆ–è€…ä¿å­˜ç‰¹å®šæ ¼å¼çš„æ–‡ä»¶</li>
</ul>
</li>
</ol>
<a id="more"></a>
<ol>
<li><p><strong>Requestä¸­åŒ…å«ä»€ä¹ˆï¼Ÿ</strong></p>
<ul>
<li><p><strong>è¯·æ±‚æ–¹å¼</strong></p>
<p>ä¸»è¦æœ‰ï¼šGET/POSTä¸¤ç§ç±»å‹å¸¸ç”¨ï¼Œå¦å¤–è¿˜æœ‰HEAD/PUT/DELETE/OPTIONS</p>
<ol>
<li><p>GETå’ŒPOSTçš„åŒºåˆ«å°±æ˜¯ï¼šè¯·æ±‚çš„æ•°æ®GETæ˜¯åœ¨urlä¸­ï¼ŒPOSTåˆ™æ˜¯å­˜æ”¾åœ¨å¤´éƒ¨</p>
<p>GET:å‘æŒ‡å®šçš„èµ„æºå‘å‡ºâ€œæ˜¾ç¤ºâ€è¯·æ±‚ã€‚ä½¿ç”¨GETæ–¹æ³•åº”è¯¥åªç”¨åœ¨è¯»å–æ•°æ®ï¼Œè€Œä¸åº”å½“è¢«ç”¨äºäº§ç”Ÿâ€œå‰¯ä½œç”¨â€çš„æ“ä½œä¸­ï¼Œä¾‹å¦‚åœ¨Web Applicationä¸­ã€‚å…¶ä¸­ä¸€ä¸ªåŸå› æ˜¯GETå¯èƒ½ä¼šè¢«ç½‘ç»œèœ˜è››ç­‰éšæ„è®¿é—®</p>
<p>POST:å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®ï¼Œè¯·æ±‚æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚æœ¬æ–‡ä¸­ã€‚è¿™ä¸ªè¯·æ±‚å¯èƒ½ä¼šåˆ›å»ºæ–°çš„èµ„æºæˆ–ä¿®æ”¹ç°æœ‰èµ„æºï¼Œæˆ–äºŒè€…çš†æœ‰ã€‚</p>
</li>
<li><p>HEADï¼šä¸GETæ–¹æ³•ä¸€æ ·ï¼Œéƒ½æ˜¯å‘æœåŠ¡å™¨å‘å‡ºæŒ‡å®šèµ„æºçš„è¯·æ±‚ã€‚åªä¸è¿‡æœåŠ¡å™¨å°†ä¸ä¼ å›èµ„æºçš„æœ¬æ–‡éƒ¨åˆ†ã€‚å®ƒçš„å¥½å¤„åœ¨äºï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨ä¸å¿…ä¼ è¾“å…¨éƒ¨å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥è·å–å…¶ä¸­â€œå…³äºè¯¥èµ„æºçš„ä¿¡æ¯â€ï¼ˆå…ƒä¿¡æ¯æˆ–ç§°å…ƒæ•°æ®ï¼‰ã€‚</p>
</li>
<li><p>PUTï¼šå‘æŒ‡å®šèµ„æºä½ç½®ä¸Šä¼ å…¶æœ€æ–°å†…å®¹ã€‚</p>
</li>
<li><p>OPTIONSï¼šè¿™ä¸ªæ–¹æ³•å¯ä½¿æœåŠ¡å™¨ä¼ å›è¯¥èµ„æºæ‰€æ”¯æŒçš„æ‰€æœ‰HTTPè¯·æ±‚æ–¹æ³•ã€‚ç”¨â€™*â€™æ¥ä»£æ›¿èµ„æºåç§°ï¼Œå‘WebæœåŠ¡å™¨å‘é€OPTIONSè¯·æ±‚ï¼Œå¯ä»¥æµ‹è¯•æœåŠ¡å™¨åŠŸèƒ½æ˜¯å¦æ­£å¸¸è¿ä½œã€‚</p>
</li>
<li><p>DELETEï¼šè¯·æ±‚æœåŠ¡å™¨åˆ é™¤Request-URIæ‰€æ ‡è¯†çš„èµ„æºã€‚</p>
</li>
</ol>
</li>
</ul>
</li>
<li><p><strong>è¯·æ±‚URL</strong></p>
<p>URLï¼Œå³ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„ç½‘å€ï¼Œç»Ÿä¸€èµ„æºå®šä½ç¬¦æ˜¯å¯¹å¯ä»¥ä»äº’è”ç½‘ä¸Šå¾—åˆ°çš„èµ„æºçš„ä½ç½®å’Œè®¿é—®æ–¹æ³•çš„ä¸€ç§ç®€æ´çš„è¡¨ç¤ºï¼Œæ˜¯äº’è”ç½‘ä¸Šæ ‡å‡†èµ„æºçš„åœ°å€ã€‚äº’è”ç½‘ä¸Šçš„æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„URLï¼Œå®ƒåŒ…å«çš„ä¿¡æ¯æŒ‡å‡ºæ–‡ä»¶çš„ä½ç½®ä»¥åŠæµè§ˆå™¨åº”è¯¥æ€ä¹ˆå¤„ç†å®ƒã€‚</p>
<p>URLçš„æ ¼å¼ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>ç¬¬ä¸€éƒ¨åˆ†æ˜¯åè®®(æˆ–ç§°ä¸ºæœåŠ¡æ–¹å¼)ã€‚</li>
<li>ç¬¬äºŒéƒ¨åˆ†æ˜¯å­˜æœ‰è¯¥èµ„æºçš„ä¸»æœºIPåœ°å€(æœ‰æ—¶ä¹ŸåŒ…æ‹¬ç«¯å£å·)ã€‚</li>
<li>ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ä¸»æœºèµ„æºçš„å…·ä½“åœ°å€ï¼Œå¦‚ç›®å½•å’Œæ–‡ä»¶åç­‰ã€‚</li>
</ul>
<p>çˆ¬è™«çˆ¬å–æ•°æ®æ—¶å¿…é¡»è¦æœ‰ä¸€ä¸ªç›®æ ‡çš„URLæ‰å¯ä»¥è·å–æ•°æ®ï¼Œå› æ­¤ï¼Œå®ƒæ˜¯çˆ¬è™«è·å–æ•°æ®çš„åŸºæœ¬ä¾æ®ã€‚</p>
</li>
<li><p><strong>è¯·æ±‚å¤´</strong></p>
<p>åŒ…å«è¯·æ±‚æ—¶çš„å¤´éƒ¨ä¿¡æ¯ï¼Œå¦‚User-Agent,Host,Cookiesç­‰ä¿¡æ¯.</p>
</li>
<li><p><strong>è¯·æ±‚ä½“</strong></p>
<p>è¯·æ±‚æ˜¯æºå¸¦çš„æ•°æ®ï¼Œå¦‚æäº¤è¡¨å•æ•°æ®æ—¶å€™çš„è¡¨å•æ•°æ®ï¼ˆPOSTï¼‰</p>
</li>
<li><p>èƒ½çˆ¬å–ä»€ä¹ˆæ ·çš„æ•°æ®ï¼Ÿ</p>
<ul>
<li>ç½‘é¡µæ–‡æœ¬ï¼šå¦‚HTMLæ–‡æ¡£ï¼ŒJsonæ ¼å¼åŒ–æ–‡æœ¬ç­‰</li>
<li>å›¾ç‰‡ï¼šè·å–åˆ°çš„æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¿å­˜ä¸ºå›¾ç‰‡æ ¼å¼</li>
<li>è§†é¢‘ï¼šåŒæ ·æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶</li>
<li>å…¶ä»–ï¼šåªè¦è¯·æ±‚åˆ°çš„ï¼Œéƒ½å¯ä»¥è·å–</li>
</ul>
</li>
<li><p><strong>å¦‚ä½•è§£ææ•°æ®ï¼Ÿ</strong></p>
<ol>
<li>ç›´æ¥å¤„ç†</li>
<li>Jsonè§£æ</li>
<li>æ­£åˆ™è¡¨è¾¾å¼å¤„ç†</li>
<li>BeautifulSoupè§£æå¤„ç†</li>
<li>PyQueryè§£æå¤„ç†</li>
<li>XPathè§£æå¤„ç†</li>
</ol>
</li>
<li><p><strong>å…³äºæŠ“å–çš„é¡µé¢æ•°æ®å’Œæµè§ˆå™¨é‡Œçœ‹åˆ°çš„ä¸ä¸€æ ·çš„é—®é¢˜ï¼Ÿ</strong></p>
<p>å‡ºç°è¿™ç§æƒ…å†µæ˜¯å› ä¸ºï¼Œå¾ˆå¤šç½‘ç«™ä¸­çš„æ•°æ®éƒ½æ˜¯é€šè¿‡jsï¼ŒajaxåŠ¨æ€åŠ è½½çš„ï¼Œæ‰€ä»¥ç›´æ¥é€šè¿‡getè¯·æ±‚è·å–çš„é¡µé¢å’Œæµè§ˆå™¨æ˜¾ç¤ºçš„ä¸åŒã€‚</p>
</li>
<li><p><strong>å¦‚ä½•è§£å†³jsæ¸²æŸ“çš„é—®é¢˜ï¼Ÿ</strong></p>
<ul>
<li>åˆ†æajax</li>
<li>Selenium/webdriver</li>
<li>Splash</li>
</ul>
</li>
<li><p><strong>æ€æ ·ä¿å­˜æ•°æ®ï¼Ÿ</strong></p>
<ul>
<li>æ–‡æœ¬ï¼šçº¯æ–‡æœ¬ï¼ŒJson,Xmlç­‰</li>
<li>å…³ç³»å‹æ•°æ®åº“ï¼šå¦‚mysql,oracle,sql serverç­‰ç»“æ„åŒ–æ•°æ®åº“</li>
<li>éå…³ç³»å‹æ•°æ®åº“ï¼šMongoDB,Redisç­‰key-valueå½¢å¼å­˜å‚¨</li>
</ul>
</li>
<li><p><strong>requestçš„åº”ç”¨</strong></p>
<ol>
<li><p>Requestsæ˜¯ç”¨pythonè¯­è¨€åŸºäºurllibç¼–å†™çš„ï¼Œé‡‡ç”¨çš„æ˜¯Apache2 Licensedå¼€æºåè®®çš„HTTPåº“ã€‚ä¸€å¥è¯ï¼Œrequestsæ˜¯pythonå®ç°çš„æœ€ç®€å•æ˜“ç”¨çš„HTTPåº“ï¼Œå»ºè®®çˆ¬è™«ä½¿ç”¨requestsåº“ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response  = requests.get(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">print(type(response))</span><br><span class="line">print(response.status_code)</span><br><span class="line">print(response.text) </span><br><span class="line">print(response.cookies)</span><br><span class="line">print(response.content) <span class="comment">#è¿™æ ·è·å–çš„æ•°æ®æ˜¯äºŒè¿›åˆ¶æ•°æ®</span></span><br><span class="line">print(response.content.decode(<span class="string">"utf-8"</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¾ˆå¤šæƒ…å†µä¸‹çš„ç½‘ç«™å¦‚æœç›´æ¥response.textä¼šå‡ºç°ä¹±ç çš„é—®é¢˜ï¼Œæ‰€ä»¥è¿™ä¸ªä½¿ç”¨response.contentè¿™æ ·è¿”å›çš„æ•°æ®æ ¼å¼å…¶å®æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œç„¶åé€šè¿‡decode()è½¬æ¢ä¸ºutf-8ï¼Œè¿™æ ·å°±è§£å†³äº†é€šè¿‡response.textç›´æ¥è¿”å›æ˜¾ç¤ºä¹±ç çš„é—®é¢˜.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response =requests.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">response.encoding=<span class="string">"utf-8"</span></span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<p>ä¸ç®¡æ˜¯é€šè¿‡response.content.decode(â€œutf-8)çš„æ–¹å¼è¿˜æ˜¯é€šè¿‡response.encoding=â€utf-8â€çš„æ–¹å¼éƒ½å¯ä»¥é¿å…ä¹±ç çš„é—®é¢˜å‘ç”Ÿ</p>
</li>
<li><p><strong>requestsåŒ…ä¸­çš„è¯·æ±‚æ–¹å¼</strong></p>
<p>requestsé‡Œæä¾›ä¸ªå„ç§è¯·æ±‚æ–¹å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">requests.post(<span class="string">"http://httpbin.org/post"</span>)</span><br><span class="line">requests.put(<span class="string">"http://httpbin.org/put"</span>)</span><br><span class="line">requests.delete(<span class="string">"http://httpbin.org/delete"</span>)</span><br><span class="line">requests.head(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line">requests.options(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºæœ¬GETè¯·æ±‚</span></span><br><span class="line">requests.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line"><span class="comment"># å¸¦å‚æ•°çš„GETè¯·æ±‚</span></span><br><span class="line">requests.get(<span class="string">"http://httpbin.org/get?name=zhaofan&amp;age=23"</span>)</span><br><span class="line"><span class="comment"># æˆ–è€… ä½¿ç”¨paramså…³é”®å­—ä¼ é€’å‚æ•°ï¼Œå¦‚æœå­—å…¸ä¸­çš„å‚æ•°ä¸ºNoneåˆ™ä¸ä¼šæ·»åŠ åˆ°urlä¸Š</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"name"</span>:<span class="string">"zhaofan"</span>,</span><br><span class="line">    <span class="string">"age"</span>:<span class="number">22</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">"http://httpbin.org/get"</span>,params=data)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>responseçš„ä¸»è¦å±æ€§</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = requests.get(<span class="string">'http://www.jianshu.com'</span>)</span><br><span class="line">print(type(response.status_code), response.status_code)</span><br><span class="line">print(type(response.headers), response.headers)</span><br><span class="line">print(type(response.cookies), response.cookies)</span><br><span class="line">print(type(response.url), response.url)</span><br><span class="line">print(type(response.history), response.history)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è§£æjson</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = requests.get(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line"><span class="comment"># requestsé‡Œé¢é›†æˆçš„jsonå…¶å®å°±æ˜¯æ‰§è¡Œäº†json.loads()æ–¹æ³•ï¼Œä¸¤è€…çš„ç»“æœæ˜¯ä¸€æ ·çš„</span></span><br><span class="line">print(response.json())</span><br><span class="line">print(json.loads(response.text))</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ·»åŠ headers</strong></p>
<p>å¯ä»¥å®šåˆ¶headersçš„ä¿¡æ¯ï¼Œå¦‚å½“æˆ‘ä»¬ç›´æ¥é€šè¿‡requestsè¯·æ±‚çŸ¥ä¹ç½‘ç«™çš„æ—¶å€™ï¼Œé»˜è®¤æ˜¯æ— æ³•è®¿é—®çš„,å› ä¸ºè®¿é—®çŸ¥ä¹éœ€è¦å¤´éƒ¨ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨è°·æ­Œæµè§ˆå™¨é‡Œè¾“å…¥chrome://version,å°±å¯ä»¥çœ‹åˆ°ç”¨æˆ·ä»£ç†ï¼Œå°†ç”¨æˆ·ä»£ç†æ·»åŠ åˆ°å¤´éƒ¨ä¿¡æ¯.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36"</span></span><br><span class="line">&#125;</span><br><span class="line">response =requests.get(<span class="string">"https://www.zhihu.com"</span>,headers=headers)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>åŸºæœ¬POSTè¯·æ±‚</strong></p>
<p>é€šè¿‡åœ¨å‘é€postè¯·æ±‚æ—¶æ·»åŠ ä¸€ä¸ªdataå‚æ•°ï¼Œè¿™ä¸ªdataå‚æ•°å¯ä»¥é€šè¿‡å­—å…¸æ„é€ æˆï¼Œè¿™æ ·å¯¹äºå‘é€postè¯·æ±‚å°±éå¸¸æ–¹ä¾¿.åŒæ ·çš„åœ¨å‘é€postè¯·æ±‚çš„æ—¶å€™ä¹Ÿå¯ä»¥å’Œå‘é€getè¯·æ±‚ä¸€æ ·é€šè¿‡headerså‚æ•°ä¼ é€’ä¸€ä¸ªå­—å…¸ç±»å‹çš„æ•°æ®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"name"</span>:<span class="string">"zhaofan"</span>,</span><br><span class="line">    <span class="string">"age"</span>:<span class="number">23</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(<span class="string">"http://httpbin.org/post"</span>,data=data)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å…³äºè¯·æ±‚çŠ¶æ€</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response= requests.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"><span class="keyword">if</span> response.status_code == requests.codes.ok:</span><br><span class="line">    print(<span class="string">"è®¿é—®æˆåŠŸ"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ–‡ä»¶ä¸Šä¼ </strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">files= &#123;<span class="string">"files"</span>:open(<span class="string">"git.jpeg"</span>,<span class="string">"rb"</span>)&#125;</span><br><span class="line">response = requests.post(<span class="string">"http://httpbin.org/post"</span>,files=files)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è·å–cookie</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = requests.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">print(response.cookies)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key,value <span class="keyword">in</span> response.cookies.items():</span><br><span class="line">    print(key+<span class="string">"="</span>+value)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ä¼šè¯ç»´æŒ</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.get(<span class="string">"http://httpbin.org/cookies/set/number/123456"</span>)</span><br><span class="line">response = s.get(<span class="string">"http://httpbin.org/cookies"</span>)</span><br><span class="line">print(response.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹é¢æ˜¯é”™è¯¯ç¤ºèŒƒ</span></span><br><span class="line">requests.get(<span class="string">"http://httpbin.org/cookies/set/number/123456"</span>)</span><br><span class="line">response = requests.get(<span class="string">"http://httpbin.org/cookies"</span>)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è¯ä¹¦éªŒè¯</strong></p>
<p>ç°åœ¨å¾ˆå¤šç½‘ç«™éƒ½éœ€è¦è¯ä¹¦çš„éªŒè¯ï¼Œæ²¡æœ‰è¯ä¹¦ä¼šå‡ºç°â€œä½ è®¿é—®çš„ä¸æ˜¯ä¸€ä¸ªç§å¯†é“¾æ¥â€ä¹‹ç±»çš„é”™è¯¯ã€‚å¯¹äºHttpsåè®®ï¼Œç›´é¦–å…ˆä¼šæ£€æŸ¥è¯ä¹¦æ˜¯å¦åˆæ³•ï¼Œå¦‚æœè¯ä¹¦ä¸åˆæ³•ï¼Œåˆ™ä¼šæŠ›å‡ºï¼šSSLErrorã€‚é’ˆå¯¹è¿™ä¸€ç‚¹æœ‰ä¸¤ç§æªæ–½ï¼š<br>ä¸‹é¢è¿™ç§æ–¹æ³•ï¼šåœ¨è®¿é—®çš„æ—¶å€™ï¼Œè®¾ç½®ä¸è¿›è¡Œè¯ä¹¦çš„éªŒè¯ï¼Œæ­¤æ—¶è¿”å›çŠ¶æ€ç 200ï¼Œä½†æ˜¯ä¾æ—§ä¼šæœ‰è­¦å‘Šã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.packages <span class="keyword">import</span> urllib3</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line">response = requests.get(<span class="string">'https://www.12306.cn'</span>, verify=<span class="literal">False</span>)</span><br><span class="line">print(response.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨æŒ‡å®šè¯ä¹¦</span></span><br><span class="line">response = requests.get(<span class="string">'https://www.12306.cn'</span>, cert=(<span class="string">'/path/server.crt'</span>, <span class="string">'/path/key'</span>))</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ä»£ç†çš„è®¾ç½®</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">proxies = &#123;</span><br><span class="line">  <span class="string">"http"</span>: <span class="string">"http://127.0.0.1:9743"</span>,</span><br><span class="line">  <span class="string">"https"</span>: <span class="string">"https://127.0.0.1:9743"</span>,</span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</span><br><span class="line">print(response.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹äºéœ€è¦ç”¨æˆ·åå’Œå¯†ç çš„ä»£ç†</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">"http"</span>: <span class="string">"http://user:password@127.0.0.1:9743/"</span>,<span class="comment">#æŒ‡å®šå¥½ç”¨æˆ·åå’Œå¯†ç </span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</span><br><span class="line">print(response.status_code)</span><br><span class="line"><span class="comment"># socksä»£ç†ï¼šå…ˆå®‰è£…è¯¥æ¨¡å—   pip3 install 'requests[socks]'</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'socks5://127.0.0.1:9742'</span>,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'socks5://127.0.0.1:9742'</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è¶…æ—¶è®¾ç½®</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> ReadTimeout</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">"http://httpbin.org/get"</span>, timeout = <span class="number">0.5</span>)</span><br><span class="line">    print(response.status_code)</span><br><span class="line"><span class="keyword">except</span> ReadTimeout:</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>éœ€è¦ç™»å½•è®¤è¯æ‰èƒ½è®¿é—®çš„ç½‘ç«™</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://120.27.34.24:9001'</span>, auth=HTTPBasicAuth(<span class="string">'user'</span>, <span class="string">'123'</span>))</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">r = requests.get(<span class="string">'http://120.27.34.24:9001'</span>, auth=(<span class="string">'user'</span>, <span class="string">'123'</span>))</span><br><span class="line">print(r.status_code)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¼‚å¸¸å¤„ç†</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> ReadTimeout, ConnectionError, RequestException</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">"http://httpbin.org/get"</span>, timeout = <span class="number">0.5</span>)</span><br><span class="line">    print(response.status_code)</span><br><span class="line"><span class="keyword">except</span> ReadTimeout:</span><br><span class="line">    print(<span class="string">'Timeout'</span>)</span><br><span class="line"><span class="keyword">except</span> ConnectionError:</span><br><span class="line">    print(<span class="string">'Connection error'</span>)</span><br><span class="line"><span class="keyword">except</span> RequestException:</span><br><span class="line">    print(<span class="string">'Error'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>çˆ¬è™«</category>
      </categories>
      <tags>
        <tag>ä¸“ä¸šæŠ€èƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¿€æ´»å‡½æ•°</title>
    <url>/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="sigmoid"><a href="#sigmoid" class="headerlink" title="sigmoid"></a>sigmoid</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>sigmoidå‡½æ•°ä¹Ÿå«Logisticå‡½æ•°ï¼Œç”¨äºéšå±‚ç¥ç»å…ƒè¾“å‡ºï¼Œå–å€¼èŒƒå›´ä¸º(0,1)ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªå®æ•°æ˜ å°„åˆ°(0,1)çš„åŒºé—´ï¼Œå¯ä»¥ç”¨æ¥åšäºŒåˆ†ç±»ã€‚</p>
<p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/sigmoid.png" alt="avatat"></p>
<a id="more"></a>
<p>Sigmoidå‡½æ•°å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
S(x)=\frac{1}{1+e^{-x}}</script><p>å…¶å¯¹xçš„å¯¼æ•°å¯ä»¥ç”¨è‡ªèº«è¡¨ç¤º:</p>
<script type="math/tex; mode=display">
S^{\prime}(x)=\frac{e^{-x}}{\left(1+e^{-x}\right)^{2}}=S(x)(1-S(x))</script><h4 id="æ¢¯åº¦æ¶ˆå¤±"><a href="#æ¢¯åº¦æ¶ˆå¤±" class="headerlink" title="æ¢¯åº¦æ¶ˆå¤±"></a>æ¢¯åº¦æ¶ˆå¤±</h4><p>ä¼˜åŒ–ç¥ç»ç½‘ç»œçš„æ–¹æ³•æ˜¯Back Propagationï¼Œå³å¯¼æ•°çš„åå‘ä¼ é€’ï¼šå…ˆè®¡ç®—è¾“å‡ºå±‚å¯¹åº”çš„lossï¼Œç„¶åå°†lossä»¥å¯¼æ•°çš„å½¢å¼ä¸æ–­å‘ä¸Šä¸€å±‚ç½‘ç»œä¼ é€’ï¼Œä¿®æ­£ç›¸åº”çš„å‚æ•°ï¼Œè¾¾åˆ°é™ä½lossçš„ç›®çš„ã€‚ Sigmoidå‡½æ•°åœ¨æ·±åº¦ç½‘ç»œä¸­å¸¸å¸¸ä¼šå¯¼è‡´å¯¼æ•°é€æ¸å˜ä¸º0ï¼Œä½¿å¾—å‚æ•°æ— æ³•è¢«æ›´æ–°ï¼Œç¥ç»ç½‘ç»œæ— æ³•è¢«ä¼˜åŒ–ã€‚åŸå› åœ¨äºä¸¤ç‚¹ï¼š</p>
<ol>
<li>åœ¨ä¸Šå›¾ä¸­å®¹æ˜“çœ‹å‡ºï¼Œå½“$\sigma(x)$ä¸­$x$è¾ƒå¤§æˆ–è¾ƒå°æ—¶ï¼Œå¯¼æ•°æ¥è¿‘0ï¼Œè€Œåå‘ä¼ é€’çš„æ•°å­¦ä¾æ®æ˜¯å¾®ç§¯åˆ†æ±‚å¯¼çš„é“¾å¼æ³•åˆ™ï¼Œå½“å‰å±‚çš„å¯¼æ•°éœ€è¦ä¹‹å‰å„å±‚å¯¼æ•°çš„ä¹˜ç§¯ï¼Œå‡ ä¸ªå°æ•°çš„ç›¸ä¹˜ï¼Œç»“æœä¼šå¾ˆæ¥è¿‘0 .</li>
<li>Sigmoidå¯¼æ•°çš„æœ€å¤§å€¼æ˜¯0.25ï¼Œè¿™æ„å‘³ç€å¯¼æ•°åœ¨æ¯ä¸€å±‚è‡³å°‘ä¼šè¢«å‹ç¼©ä¸ºåŸæ¥çš„1/4ï¼Œé€šè¿‡ä¸¤å±‚åè¢«å˜ä¸º1/16ï¼Œâ€¦ï¼Œé€šè¿‡10å±‚åä¸º$\frac{1}{4^10}$ã€‚è¯·æ³¨æ„è¿™é‡Œæ˜¯â€œè‡³å°‘â€ï¼Œå¯¼æ•°è¾¾åˆ°æœ€å¤§å€¼è¿™ç§æƒ…å†µè¿˜æ˜¯å¾ˆå°‘è§çš„ã€‚</li>
</ol>
<p>ä¼˜ç‚¹ï¼šå¹³æ»‘ã€æ˜“äºæ±‚å¯¼ã€‚<br>ç¼ºç‚¹ï¼šæ¿€æ´»å‡½æ•°è®¡ç®—é‡å¤§ï¼Œåå‘ä¼ æ’­æ±‚è¯¯å·®æ¢¯åº¦æ—¶ï¼Œæ±‚å¯¼æ¶‰åŠé™¤æ³•ï¼›åå‘ä¼ æ’­æ—¶ï¼Œå¾ˆå®¹æ˜“å°±ä¼šå‡ºç°æ¢¯åº¦æ¶ˆå¤±çš„æƒ…å†µï¼Œä»è€Œæ— æ³•å®Œæˆæ·±å±‚ç½‘ç»œçš„è®­ç»ƒã€‚<strong>å¹‚è¿ç®—ç›¸å¯¹è€—æ—¶</strong></p>
<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1.0</span>/(<span class="number">1</span>+np.exp(-x))</span><br></pre></td></tr></table></figure>
<h3 id="tanh"><a href="#tanh" class="headerlink" title="tanh"></a>tanh</h3><p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/tanh.png" alt="avatar"></p>
<p>tanhå…¬å¼</p>
<script type="math/tex; mode=display">
\tanh x=\frac{e^{x}-e^{-x}}{e^{x}+e^{-x}}</script><h3 id="ReLU"><a href="#ReLU" class="headerlink" title="ReLU"></a>ReLU</h3><p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/relu.png" alt="avatar"></p>
<script type="math/tex; mode=display">
ReLU = max(0,x)</script><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>è§£å†³äº†gradient vanishingé—®é¢˜ (åœ¨æ­£åŒºé—´)</li>
<li>è®¡ç®—é€Ÿåº¦éå¸¸å¿«ï¼Œåªéœ€è¦åˆ¤æ–­è¾“å…¥æ˜¯å¦å¤§äº0</li>
<li>æ”¶æ•›é€Ÿåº¦è¿œå¿«äºsigmoidå’Œtanh</li>
</ul>
<p>å­˜åœ¨çš„é—®é¢˜ï¼š</p>
<ol>
<li>ReLUçš„è¾“å‡ºä¸æ˜¯zero-centered</li>
<li>Dead ReLU Problemï¼ŒæŒ‡çš„æ˜¯æŸäº›ç¥ç»å…ƒå¯èƒ½æ°¸è¿œä¸ä¼šè¢«æ¿€æ´»ï¼Œå¯¼è‡´ç›¸åº”çš„å‚æ•°æ°¸è¿œä¸èƒ½è¢«æ›´æ–°ã€‚æœ‰ä¸¤ä¸ªä¸»è¦åŸå› å¯èƒ½å¯¼è‡´è¿™ç§æƒ…å†µäº§ç”Ÿ: <ol>
<li>éå¸¸ä¸å¹¸çš„å‚æ•°åˆå§‹åŒ–ï¼Œè¿™ç§æƒ…å†µæ¯”è¾ƒå°‘è§ </li>
<li>learning rateå¤ªé«˜å¯¼è‡´åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å‚æ•°æ›´æ–°å¤ªå¤§ï¼Œä¸å¹¸ä½¿ç½‘ç»œè¿›å…¥è¿™ç§çŠ¶æ€ã€‚è§£å†³æ–¹æ³•æ˜¯å¯ä»¥é‡‡ç”¨Xavieråˆå§‹åŒ–æ–¹æ³•ï¼Œä»¥åŠé¿å…å°†learning rateè®¾ç½®å¤ªå¤§æˆ–ä½¿ç”¨adagradç­‰è‡ªåŠ¨è°ƒèŠ‚learning rateçš„ç®—æ³•ã€‚</li>
</ol>
</li>
</ol>
<h3 id="Leaky-ReLU"><a href="#Leaky-ReLU" class="headerlink" title="Leaky ReLU"></a>Leaky ReLU</h3><p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/leakrelu.png" alt="avatar"></p>
<script type="math/tex; mode=display">
f(x)=max(\alpha x,x)</script><p>äººä»¬ä¸ºäº†è§£å†³Dead ReLU Problemï¼Œæå‡ºäº†å°†ReLUçš„å‰åŠæ®µè®¾ä¸º$0.01x$è€Œé0ã€‚å¦å¤–ä¸€ç§ç›´è§‚çš„æƒ³æ³•æ˜¯åŸºäºå‚æ•°çš„æ–¹æ³•ï¼Œå³Parametric ReLU:$f(x)=max(\alpha x,x)$ï¼Œå…¶ä¸­$\alpha$å¯ç”±back propagationå­¦å‡ºæ¥ã€‚ç†è®ºä¸Šæ¥è®²ï¼ŒLeaky ReLUæœ‰ReLUçš„æ‰€æœ‰ä¼˜ç‚¹ï¼Œå¤–åŠ ä¸ä¼šæœ‰Dead ReLUé—®é¢˜ï¼Œä½†æ˜¯åœ¨å®é™…æ“ä½œå½“ä¸­ï¼Œå¹¶æ²¡æœ‰å®Œå…¨è¯æ˜Leaky ReLUæ€»æ˜¯å¥½äºReLUã€‚</p>
<h3 id="ELU-Exponential-Linear-Units"><a href="#ELU-Exponential-Linear-Units" class="headerlink" title="ELU (Exponential Linear Units)"></a><strong>ELU (Exponential Linear Units)</strong></h3><p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/ELU.png" alt="avata"></p>
<script type="math/tex; mode=display">
f(x)=\left\{\begin{array}{ll}
x, & \text { if } x>0 \\
\alpha\left(e^{x}-1\right), & \text { otherwise }
\end{array}\right.</script><p>ELUä¹Ÿæ˜¯ä¸ºè§£å†³ReLUå­˜åœ¨çš„é—®é¢˜è€Œæå‡ºï¼Œæ˜¾ç„¶ï¼ŒELUæœ‰ReLUçš„åŸºæœ¬æ‰€æœ‰ä¼˜ç‚¹ï¼Œä»¥åŠï¼š</p>
<ul>
<li>ä¸ä¼šæœ‰Dead ReLUé—®é¢˜</li>
<li>è¾“å‡ºçš„å‡å€¼æ¥è¿‘0ï¼Œzero-centered</li>
</ul>
<p>å®ƒçš„ä¸€ä¸ªå°é—®é¢˜åœ¨äºè®¡ç®—é‡ç¨å¤§ã€‚ç±»ä¼¼äºLeaky ReLUï¼Œç†è®ºä¸Šè™½ç„¶å¥½äºReLUï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­ç›®å‰å¹¶æ²¡æœ‰å¥½çš„è¯æ®ELUæ€»æ˜¯ä¼˜äºReLUã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol>
<li><a href="https://baike.baidu.com/item/Sigmoidå‡½æ•°/7981407?fr=aladdin" target="_blank" rel="noopener">Sigmoidå‡½æ•°</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwNzc2NTk0NQ==&amp;mid=2247484448&amp;idx=1&amp;sn=80479bf682d7ade4184fde809ea0cc3e&amp;chksm=970c2cf6a07ba5e0e046e4d5b8169e8fb58c9e858878840b571d43060e30986152a534830bc6&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">ç¥ç»ç½‘ç»œæ¿€æ´»å‡½æ•°=ç”Ÿç‰©è½¬æ¢å™¨ï¼Ÿ</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/25110450" target="_blank" rel="noopener">èŠä¸€èŠæ·±åº¦å­¦ä¹ çš„activation function</a></li>
</ol>
]]></content>
      <categories>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ¿€æ´»å‡½æ•°</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¼˜åŒ–ç®—æ³•</title>
    <url>/2018/07/11/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="æ¢¯åº¦ä¸‹é™ç®—æ³•"><a href="#æ¢¯åº¦ä¸‹é™ç®—æ³•" class="headerlink" title="æ¢¯åº¦ä¸‹é™ç®—æ³•"></a>æ¢¯åº¦ä¸‹é™ç®—æ³•</h2><p>æ¢¯åº¦ä¸‹é™æ³•(Gradient descent)æˆ–æœ€é€Ÿä¸‹é™æ³•(steepest descent)æ˜¯æ±‚è§£æ— çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜çš„ä¸€ç§å¸¸ç”¨çš„ã€å®ç°ç®€å•çš„æ–¹æ³•ã€‚<br>å‡è®¾$f(x)$æ˜¯$R^n$ä¸Šå…·æœ‰ä¸€é˜¶è¿ç»­åå¯¼æ•°çš„å‡½æ•°ã€‚æ±‚è§£</p>
<script type="math/tex; mode=display">
   min_{x \in R^n}f(x)</script><p>æ— çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜ã€‚ $f^\ast$è¡¨ç¤ºç›®æ ‡å‡½æ•°$f(x)$çš„æå°ç‚¹ã€‚<br>æ¢¯åº¦ä¸‹é™æ³•æ˜¯ä¸€ç§è¿­ä»£ç®—æ³•ï¼Œé€‰å–é€‚å½“çš„åˆå€¼$x^0$,ä¸æ–­è¿­ä»£ï¼Œæ›´æ–°xçš„å€¼ï¼Œè¿›è¡Œç›®æ ‡å‡½æ•°çš„æå°åŒ–ï¼Œç›´åˆ°æ”¶æ•›ã€‚ç”±äºè´Ÿæ¢¯åº¦çš„æ–¹å‘æ˜¯ä½¿å‡½æ•°ä¸‹é™æœ€å¿«çš„æ–¹å‘ï¼Œåœ¨è¿­ä»£çš„æ¯ä¸€æ­¥ï¼Œä»¥è´Ÿæ¢¯åº¦æ–¹å‘æ›´æ–°xçš„å€¼ï¼Œä»è€Œè¾¾åˆ°å‡å°‘å‡½æ•°å€¼çš„ç›®çš„ã€‚<br>ç¬¬k+1æ¬¡è¿­ä»£å€¼ï¼š</p>
<script type="math/tex; mode=display">
x^{(k+1)} \leftarrow x^{(k)}+\lambda_{k} p_{k}</script><p>å…¶ä¸­ï¼Œ$p_k$æ˜¯æœç´¢æ–¹å‘ï¼Œå–è´Ÿæ¢¯åº¦æ–¹å‘$p_k = - \nabla f(x^k)$,$\lambda_k$ä½¿å¾—</p>
<script type="math/tex; mode=display">
f\left(x^{(k)}+\lambda_{k} p_{k}\right)=\min _{\lambda \geq 0} f\left(x^{(k)}+\lambda p_{k}\right)</script><a id="more"></a>
<h3 id="ç®—æ³•æè¿°ï¼š"><a href="#ç®—æ³•æè¿°ï¼š" class="headerlink" title="ç®—æ³•æè¿°ï¼š"></a>ç®—æ³•æè¿°ï¼š</h3><p>è¾“å…¥:ç›®æ ‡å‡½æ•°$f(x)$ï¼Œæ¢¯åº¦å‡½æ•°$g(x^k)=\nabla f(x^k)$,è®¡ç®—$\epsilon$.<br>è¾“å‡ºï¼š$f(x)$çš„æå°å€¼ç‚¹$x^\star$</p>
<ol>
<li>å–åˆå€¼$x^0 \in R^n$,ç½®k=0</li>
<li>è®¡ç®—$f(x^k)$</li>
<li>è®¡ç®—æ¢¯åº¦$g_k = g(x^k)$,å½“$\left|g_{k}\right|&lt;\varepsilon$æ—¶ï¼Œåœæ­¢è¿­ä»£ï¼Œä»¤$p_k = -g(x^k)$æ±‚$\lambda_k$,ä½¿<script type="math/tex; mode=display">
f\left(x^{(k)}+\lambda_{k} p_{k}\right)=\min _{\lambda \geq 0} f\left(x^{(k)}+\lambda p_{k}\right)</script></li>
<li>ç½®$x^{k+1}=x^k+\lambda_k p_k$,è®¡ç®—$f(x^{k+1})$å½“$<br>\left|f\left(x^{(k+1)}\right)-f\left(x^{(k)}\right)\right|&lt;\varepsilon<br>$æˆ–$\left|x^{(k+1)}-x^{(k)}\right|&lt;\varepsilon$åœæ­¢è¿­ä»£ã€‚ä»¤$x^\star = x^{k+1}$</li>
<li>å¦åˆ™ï¼Œç½®$k=k+1$,è½¬3.</li>
</ol>
<h3 id="æ¢¯åº¦ä¸‹é™è°ƒä¼˜"><a href="#æ¢¯åº¦ä¸‹é™è°ƒä¼˜" class="headerlink" title="æ¢¯åº¦ä¸‹é™è°ƒä¼˜"></a>æ¢¯åº¦ä¸‹é™è°ƒä¼˜</h3><ol>
<li><strong>ç®—æ³•çš„æ­¥é•¿é€‰æ‹©</strong>ã€‚æ­¥é•¿å–å€¼å–å†³äºæ•°æ®æ ·æœ¬ï¼Œå¯ä»¥å¤šå–ä¸€äº›å€¼ï¼Œä»å¤§åˆ°å°ï¼Œåˆ†åˆ«è¿è¡Œç®—æ³•ï¼Œçœ‹çœ‹è¿­ä»£æ•ˆæœï¼Œå¦‚æœæŸå¤±å‡½æ•°åœ¨å˜å°ï¼Œè¯´æ˜å–å€¼æœ‰æ•ˆï¼Œå¦åˆ™è¦å¢å¤§æ­¥é•¿ã€‚æ­¥é•¿å¤ªå¤§ï¼Œä¼šå¯¼è‡´è¿­ä»£è¿‡å¿«ï¼Œç”šè‡³æœ‰å¯èƒ½é”™è¿‡æœ€ä¼˜è§£ã€‚æ­¥é•¿å¤ªå°ï¼Œè¿­ä»£é€Ÿåº¦å¤ªæ…¢ï¼Œå¾ˆé•¿æ—¶é—´ç®—æ³•éƒ½ä¸èƒ½ç»“æŸã€‚æ‰€ä»¥ç®—æ³•çš„æ­¥é•¿éœ€è¦å¤šæ¬¡è¿è¡Œåæ‰èƒ½å¾—åˆ°ä¸€ä¸ªè¾ƒä¸ºä¼˜çš„å€¼ã€‚</li>
<li><strong>ç®—æ³•å‚æ•°çš„åˆå§‹å€¼é€‰æ‹©</strong>ã€‚åˆå§‹å€¼ä¸åŒï¼Œè·å¾—çš„æœ€å°å€¼ä¹Ÿæœ‰å¯èƒ½ä¸åŒï¼Œå› æ­¤æ¢¯åº¦ä¸‹é™æ±‚å¾—çš„åªæ˜¯å±€éƒ¨æœ€å°å€¼ï¼›å½“ç„¶å¦‚æœæŸå¤±å‡½æ•°æ˜¯å‡¸å‡½æ•°åˆ™ä¸€å®šæ˜¯æœ€ä¼˜è§£ã€‚ç”±äºæœ‰å±€éƒ¨æœ€ä¼˜è§£çš„é£é™©ï¼Œéœ€è¦å¤šæ¬¡ç”¨ä¸åŒåˆå§‹å€¼è¿è¡Œç®—æ³•ï¼Œå…³é”®æŸå¤±å‡½æ•°çš„æœ€å°å€¼ï¼Œé€‰æ‹©æŸå¤±å‡½æ•°æœ€å°åŒ–çš„åˆå€¼ã€‚</li>
<li><strong>å½’ä¸€åŒ–</strong>ã€‚ç”±äºæ ·æœ¬ä¸åŒç‰¹å¾çš„å–å€¼èŒƒå›´ä¸ä¸€æ ·ï¼Œå¯èƒ½å¯¼è‡´è¿­ä»£å¾ˆæ…¢ï¼Œä¸ºäº†å‡å°‘ç‰¹å¾å–å€¼çš„å½±å“ï¼Œå¯ä»¥å¯¹ç‰¹å¾æ•°æ®å½’ä¸€åŒ–ã€‚</li>
</ol>
<h3 id="æ¢¯åº¦ä¸‹é™æ³•å¤§å®¶æ—ï¼ˆBGDï¼ŒSGDï¼ŒMBGDï¼‰"><a href="#æ¢¯åº¦ä¸‹é™æ³•å¤§å®¶æ—ï¼ˆBGDï¼ŒSGDï¼ŒMBGDï¼‰" class="headerlink" title="æ¢¯åº¦ä¸‹é™æ³•å¤§å®¶æ—ï¼ˆBGDï¼ŒSGDï¼ŒMBGDï¼‰"></a>æ¢¯åº¦ä¸‹é™æ³•å¤§å®¶æ—ï¼ˆBGDï¼ŒSGDï¼ŒMBGDï¼‰</h3><ol>
<li><strong>æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•ï¼ˆBatch Gradient Descentï¼‰</strong> æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•ï¼Œæ˜¯æ¢¯åº¦ä¸‹é™æ³•æœ€å¸¸ç”¨çš„å½¢å¼ï¼Œå…·ä½“åšæ³•ä¹Ÿå°±æ˜¯åœ¨æ›´æ–°å‚æ•°æ—¶ä½¿ç”¨æ‰€æœ‰çš„æ ·æœ¬æ¥è¿›è¡Œæ›´æ–°ã€‚</li>
<li><strong>éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼ˆStochastic Gradient Descentï¼‰</strong> å…¶å®å’Œæ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•åŸç†ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨ä¸æ±‚æ¢¯åº¦æ—¶æ²¡æœ‰ç”¨æ‰€æœ‰çš„æ ·æœ¬çš„æ•°æ®ï¼Œè€Œæ˜¯ä»…ä»…é€‰å–ä¸€ä¸ªæ ·æœ¬æ¥æ±‚æ¢¯åº¦ã€‚éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼Œå’Œæ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•æ˜¯ä¸¤ä¸ªæç«¯ï¼Œä¸€ä¸ªé‡‡ç”¨æ‰€æœ‰æ•°æ®æ¥æ¢¯åº¦ä¸‹é™ï¼Œä¸€ä¸ªç”¨ä¸€ä¸ªæ ·æœ¬æ¥æ¢¯åº¦ä¸‹é™ã€‚è‡ªç„¶å„è‡ªçš„ä¼˜ç¼ºç‚¹éƒ½éå¸¸çªå‡ºã€‚å¯¹äºè®­ç»ƒé€Ÿåº¦æ¥è¯´ï¼Œéšæœºæ¢¯åº¦ä¸‹é™æ³•ç”±äºæ¯æ¬¡ä»…ä»…é‡‡ç”¨ä¸€ä¸ªæ ·æœ¬æ¥è¿­ä»£ï¼Œè®­ç»ƒé€Ÿåº¦å¾ˆå¿«ï¼Œè€Œæ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•åœ¨æ ·æœ¬é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œè®­ç»ƒé€Ÿåº¦ä¸èƒ½è®©äººæ»¡æ„ã€‚å¯¹äºå‡†ç¡®åº¦æ¥è¯´ï¼Œéšæœºæ¢¯åº¦ä¸‹é™æ³•ç”¨äºä»…ä»…ç”¨ä¸€ä¸ªæ ·æœ¬å†³å®šæ¢¯åº¦æ–¹å‘ï¼Œå¯¼è‡´è§£å¾ˆæœ‰å¯èƒ½ä¸æ˜¯æœ€ä¼˜ã€‚å¯¹äºæ”¶æ•›é€Ÿåº¦æ¥è¯´ï¼Œç”±äºéšæœºæ¢¯åº¦ä¸‹é™æ³•ä¸€æ¬¡è¿­ä»£ä¸€ä¸ªæ ·æœ¬ï¼Œå¯¼è‡´è¿­ä»£æ–¹å‘å˜åŒ–å¾ˆå¤§ï¼Œä¸èƒ½å¾ˆå¿«çš„æ”¶æ•›åˆ°å±€éƒ¨æœ€ä¼˜è§£ã€‚</li>
<li><strong>å°æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•ï¼ˆMini-batch Gradient Descentï¼‰</strong> å°æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•æ˜¯æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•å’Œéšæœºæ¢¯åº¦ä¸‹é™æ³•çš„æŠ˜è¡·ï¼Œä¹Ÿå°±æ˜¯å¯¹äº$m$ä¸ªæ ·æœ¬ï¼Œæˆ‘ä»¬é‡‡ç”¨$x$ä¸ªæ ·æœ¬æ¥è¿­ä»£ï¼Œ$1&lt;x&lt;m$ã€‚ä¸€èˆ¬å¯ä»¥å–$x=16,32,64â€¦$ï¼Œå½“ç„¶æ ¹æ®æ ·æœ¬çš„æ•°æ®ï¼Œå¯ä»¥è°ƒæ•´è¿™ä¸ª$x$ çš„å€¼ã€‚</li>
</ol>
<p>ä¸Šè¿°ä¸‰ç§æ–¹æ³•å¾—åˆ°å±€éƒ¨æœ€ä¼˜è§£çš„è¿‡ç¨‹ï¼š<br><img src="/2018/07/11/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/C80A2811-1678-4371-BCCD-8AA51A777820.jpg" alt="avatar"></p>
<h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(X, y, W, B, alpha, max_iters)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    ä½¿ç”¨äº†æ‰€æœ‰çš„æ ·æœ¬è¿›è¡Œæ¢¯åº¦ä¸‹é™</span></span><br><span class="line"><span class="string">    X: è®­ç»ƒé›†,</span></span><br><span class="line"><span class="string">    y: æ ‡ç­¾,</span></span><br><span class="line"><span class="string">    W: æƒé‡å‘é‡,</span></span><br><span class="line"><span class="string">    B: bias,</span></span><br><span class="line"><span class="string">    alpha: å­¦ä¹ ç‡,</span></span><br><span class="line"><span class="string">    max_iters: æœ€å¤§è¿­ä»£æ¬¡æ•°.</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    dW = <span class="number">0</span> <span class="comment"># æƒé‡æ¢¯åº¦æ”¶é›†å™¨</span></span><br><span class="line">    dB = <span class="number">0</span> <span class="comment"># Biasæ¢¯åº¦çš„æ”¶é›†å™¨</span></span><br><span class="line">    m = X.shape[<span class="number">0</span>] <span class="comment"># æ ·æœ¬æ•°</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(max_iters):</span><br><span class="line">        dW = <span class="number">0</span> <span class="comment"># æ¯æ¬¡è¿­ä»£é‡ç½®</span></span><br><span class="line">        dB = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">            <span class="comment"># 1. è¿­ä»£æ‰€æœ‰çš„æ ·æœ¬</span></span><br><span class="line">            <span class="comment"># 2. è®¡ç®—æƒé‡å’Œbiasçš„æ¢¯åº¦ä¿å­˜åœ¨w_gradå’Œb_grad,</span></span><br><span class="line">            <span class="comment"># 3. é€šè¿‡å¢åŠ w_gradå’Œb_gradæ¥æ›´æ–°dWå’ŒdB</span></span><br><span class="line">            W = W - alpha * (dW / m) <span class="comment"># æ›´æ–°æƒé‡</span></span><br><span class="line">            B = B - alpha * (dB / m) <span class="comment"># æ›´æ–°bias</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> W, B</span><br></pre></td></tr></table></figure>
<h3 id="æ¢¯åº¦ä¸‹é™å’Œæœ€å°äºŒä¹˜æ³•"><a href="#æ¢¯åº¦ä¸‹é™å’Œæœ€å°äºŒä¹˜æ³•" class="headerlink" title="æ¢¯åº¦ä¸‹é™å’Œæœ€å°äºŒä¹˜æ³•"></a>æ¢¯åº¦ä¸‹é™å’Œæœ€å°äºŒä¹˜æ³•</h3><p>æ¢¯åº¦ä¸‹é™æ³•å’Œæœ€å°äºŒä¹˜æ³•ç›¸æ¯”ï¼Œæ¢¯åº¦ä¸‹é™æ³•éœ€è¦é€‰æ‹©æ­¥é•¿ï¼Œè€Œæœ€å°äºŒä¹˜æ³•ä¸éœ€è¦ã€‚æ¢¯åº¦ä¸‹é™æ³•æ˜¯è¿­ä»£æ±‚è§£ï¼Œæœ€å°äºŒä¹˜æ³•æ˜¯è®¡ç®—è§£æè§£ã€‚å¦‚æœæ ·æœ¬é‡ä¸ç®—å¾ˆå¤§ï¼Œä¸”å­˜åœ¨è§£æè§£ï¼Œæœ€å°äºŒä¹˜æ³•æ¯”èµ·æ¢¯åº¦ä¸‹é™æ³•è¦æœ‰ä¼˜åŠ¿ï¼Œè®¡ç®—é€Ÿåº¦å¾ˆå¿«ã€‚ä½†æ˜¯å¦‚æœæ ·æœ¬é‡å¾ˆå¤§ï¼Œç”¨æœ€å°äºŒä¹˜æ³•ç”±äºéœ€è¦æ±‚ä¸€ä¸ªè¶…çº§å¤§çš„é€†çŸ©é˜µï¼Œè¿™æ—¶å°±å¾ˆéš¾æˆ–è€…å¾ˆæ…¢æ‰èƒ½æ±‚è§£è§£æè§£äº†ï¼Œä½¿ç”¨è¿­ä»£çš„æ¢¯åº¦ä¸‹é™æ³•æ¯”è¾ƒæœ‰ä¼˜åŠ¿ã€‚</p>
<h2 id="ç‰›é¡¿æ³•"><a href="#ç‰›é¡¿æ³•" class="headerlink" title="ç‰›é¡¿æ³•"></a>ç‰›é¡¿æ³•</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œç‰›é¡¿æ³•ä¸»è¦åº”ç”¨åœ¨ä¸¤ä¸ªæ–¹é¢ï¼Œ1ï¼šæ±‚æ–¹ç¨‹çš„æ ¹ï¼›2ï¼šæœ€ä¼˜åŒ–ã€‚</p>
<h3 id="æ±‚è§£è¿‡ç¨‹"><a href="#æ±‚è§£è¿‡ç¨‹" class="headerlink" title="æ±‚è§£è¿‡ç¨‹"></a>æ±‚è§£è¿‡ç¨‹</h3><p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ–¹ç¨‹éƒ½æœ‰æ±‚æ ¹å…¬å¼ï¼Œæˆ–è€…æ±‚æ ¹å…¬å¼å¾ˆå¤æ‚ï¼Œå¯¼è‡´æ±‚è§£å›°éš¾ã€‚åˆ©ç”¨ç‰›é¡¿æ³•ï¼Œå¯ä»¥è¿­ä»£æ±‚è§£ã€‚</p>
<p>åŸç†æ˜¯åˆ©ç”¨æ³°å‹’å…¬å¼ï¼Œåœ¨ $x_0$å¤„å±•å¼€ï¼Œä¸”å±•å¼€åˆ°ä¸€é˜¶, å³ $f(x)=f(x_0)+f^\prime{x_0}(x-x_0)$ ã€‚æ±‚è§£æ–¹ç¨‹$f(x)=0$ï¼Œç­‰ä»·äº$f(x_0)+f^\prime(x_0)(x-x_0)=0$ï¼Œæ±‚è§£ $x=x_1=x_0-\frac{f(x_0)}{f^\prime(x_0)}$ã€‚å› ä¸ºè¿™æ˜¯åˆ©ç”¨æ³°å‹’å…¬å¼çš„ä¸€é˜¶å±•å¼€,$f(x)=f(x_0)+f^\prime(x_0)(x-x_0)$ å¤„å¹¶ä¸æ˜¯å®Œå…¨ç›¸ç­‰ï¼Œè€Œæ˜¯è¿‘ä¼¼ç›¸ç­‰ï¼Œè¿™é‡Œæ±‚å¾—çš„çš„$x_1$å¹¶ä¸èƒ½è®© $f(x)=0$ï¼Œåªèƒ½è¯´ $f(x_1)$ çš„å€¼æ¯”$f(x_9)$çš„å€¼æ›´æ¥è¿‘äº0ï¼Œäºæ˜¯è¿­ä»£çš„æƒ³æ³•å°±å¾ˆè‡ªç„¶äº†ï¼Œå¯ä»¥è¿›è€Œæ¨å‡º $x_{n+1}=x_n-\frac{f(x_n)}{f\prime(x_n)}$ï¼Œé€šè¿‡è¿­ä»£ï¼Œè¿™ä¸ªå¼å­å¿…ç„¶åœ¨ $f(x^\star)=0$ çš„æ—¶å€™æ”¶æ•›ã€‚æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š<br><img src="/2018/07/11/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/B03C2A8B-AF9F-4871-94F6-0E7F6D6EC890.png" alt="avatar"></p>
<h3 id="æœ€ä¼˜åŒ–"><a href="#æœ€ä¼˜åŒ–" class="headerlink" title="æœ€ä¼˜åŒ–"></a>æœ€ä¼˜åŒ–</h3><p>æ— çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜</p>
<script type="math/tex; mode=display">
min_{x \in R^N}f(x)</script><p>å…¶ä¸­$s^\star$ä¸ºç›®æ ‡å‡½æ•°çš„æå°ç‚¹</p>
<p>è®¾$f(x)$å…·æœ‰äºŒé˜¶è¿ç»­åå¯¼ï¼Œè‹¥ç¬¬$k$æ¬¡è¿­ä»£å€¼ä¸º$x^k$,åˆ™å¯å°†$f(x)$åœ¨$x^k$é™„è¿‘è¿›è¡ŒäºŒé˜¶æ³°å‹’å±•å¼€ï¼š</p>
<script type="math/tex; mode=display">
f(x)=f\left(x^{(k)}\right)+g_{k}^{T}\left(x-x^{(k)}\right)+\frac{1}{2}\left(x-x^{(k)}\right)^{T} H\left(x^{(k)}\right)\left(x-x^{(x)}\right)</script><p>å…¶ä¸­ï¼Œ$g_k=g(x^k)=\nabla f(x^k)$æ˜¯$f(x)$çš„æ¢¯åº¦å‘é‡åœ¨ç‚¹$x^k$çš„å€¼ï¼Œ$H(x^k)$æ˜¯$f(x)$çš„æµ·å¡çŸ©é˜µ</p>
<script type="math/tex; mode=display">
H(x)=\left[\frac{\partial^{2} f}{\partial x_{i} \partial x_{j}}\right]_{n \times n}</script><p>åœ¨ç‚¹$x^k$çš„å€¼ã€‚</p>
<p>å‡½æ•°$f(x)$æœ‰æå€¼çš„å¿…è¦æ¡ä»¶æ˜¯åœ¨æå€¼ç‚¹å¤„ä¸€é˜¶å¯¼æ•°ä¸º0ï¼Œå³æ¢¯åº¦å‘é‡ä¸º0ã€‚ç‰¹åˆ«çš„å½“$H(x^k)$æ˜¯æ­£å®šçŸ©é˜µæ—¶ï¼Œå‡½æ•°$f(x)$çš„æå€¼ä¸ºæœ€å°å€¼ã€‚</p>
<p>ä¸ºäº†çš„å¾—åˆ°ä¸€é˜¶å¯¼æ•°ä¸º0çš„ç‚¹ï¼Œå¯ä»¥ç”¨åˆ°<strong>æ±‚è§£æ–¹ç¨‹</strong>éƒ¨åˆ†çš„æ–¹æ³•ã€‚æ ¹æ®äºŒé˜¶æ³°å‹’å±•å¼€ï¼Œå¯¹$\nabla f(x)$åœ¨$x^k$è¿›è¡Œå±•å¼€å¾—ï¼ˆä¹Ÿå¯ä»¥å¯¹æ³°å‹’å…¬å¼å†è¿›è¡Œæ±‚å¯¼ï¼‰ï¼š</p>
<script type="math/tex; mode=display">
\nabla f(x)=g_{k}+H_{k}\left(x-x^{(k)}\right)</script><p>å…¶ä¸­ï¼Œ$H_k=H(x^k)$åˆ™ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}&g_{k}+H_{k}\left(x^{(k+1)}-x^{(k)}\right)=0\\&x^{(k+1)}=x^{(k)}-H_{k}^{-1} g_{k}\end{aligned}</script><p>ä»¤</p>
<script type="math/tex; mode=display">
H_kp_k = -g_k</script><p>å¾—åˆ°è¿­ä»£å…¬å¼ï¼š</p>
<script type="math/tex; mode=display">
x^{k+1} = x^k+p_k</script><p>æœ€ç»ˆåœ¨$\nabla f(x^\star)=0$æ”¶æ•›</p>
<h3 id="ç®—æ³•æè¿°"><a href="#ç®—æ³•æè¿°" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h3><p>è¾“å…¥ï¼šç›®æ ‡å‡½æ•°$f(x)$ï¼Œæ¢¯åº¦$g(x) = \nabla f(x)$,æµ·å¡çŸ©é˜µ$H(x)$,ç²¾åº¦(é˜ˆå€¼)$\epsilon$</p>
<p>è¾“å‡ºï¼š$f(x)$çš„æå°å€¼ç‚¹$x^\star$</p>
<ol>
<li><p>å–åˆå§‹ç‚¹$x^0$,ç½®k=0</p>
</li>
<li><p>è®¡ç®—$g_k = g(x^k)$</p>
</li>
<li><p>è‹¥$\left|g_k \right| &lt; \epsilon$ï¼Œåˆ™åœæ­¢è®¡ç®—ï¼Œæ±‚å¾—è¿‘ä¼¼è§£:$x^\star = x^k$</p>
</li>
<li><p>è®¡ç®—$H_k = H(x^k)$,å¹¶æ±‚$p_k$ã€‚</p>
<script type="math/tex; mode=display">
H_kp_k = -g_k</script></li>
<li><p>ç½® $x(k+1) = x^k + p_k$</p>
</li>
<li>ç½® k=k+1, è½¬2.</li>
</ol>
<h3 id="ç‰›é¡¿æ³•å’Œæ¢¯åº¦ä¸‹é™"><a href="#ç‰›é¡¿æ³•å’Œæ¢¯åº¦ä¸‹é™" class="headerlink" title="ç‰›é¡¿æ³•å’Œæ¢¯åº¦ä¸‹é™"></a>ç‰›é¡¿æ³•å’Œæ¢¯åº¦ä¸‹é™</h3><p>æ¢¯åº¦ä¸‹é™æ³•å’Œç‰›é¡¿æ³•ç›¸æ¯”ï¼Œä¸¤è€…éƒ½æ˜¯è¿­ä»£æ±‚è§£ï¼Œä¸è¿‡æ¢¯åº¦ä¸‹é™æ³•æ˜¯æ¢¯åº¦æ±‚è§£ï¼Œè€Œç‰›é¡¿æ³•æ˜¯ç”¨äºŒé˜¶çš„æµ·æ£®çŸ©é˜µçš„é€†çŸ©é˜µæ±‚è§£ã€‚ç›¸å¯¹è€Œè¨€ï¼Œä½¿ç”¨ç‰›é¡¿æ³•æ”¶æ•›æ›´å¿«ï¼ˆè¿­ä»£æ›´å°‘æ¬¡æ•°ï¼‰ã€‚ä½†æ˜¯æ¯æ¬¡è¿­ä»£çš„æ—¶é—´æ¯”æ¢¯åº¦ä¸‹é™æ³•é•¿ã€‚</p>
<p>æ¢¯åº¦ä¸‹é™æ³•ï¼š </p>
<script type="math/tex; mode=display">
x^{k+1} = x^k - \lambda \nabla f(x^k)</script><p>ç‰›é¡¿æ³•ï¼š</p>
<script type="math/tex; mode=display">
x^{k+1} = x^k-\lambda(H^k)^{-1}\nabla f(x^k)</script><p>è‡³äºä¸ºä»€ä¹ˆç‰›é¡¿æ³•æ”¶æ•›æ›´å¿«ï¼Œé€šä¿—æ¥è¯´æ¢¯åº¦ä¸‹é™æ³•æ¯æ¬¡åªä»ä½ å½“å‰æ‰€å¤„ä½ç½®é€‰ä¸€ä¸ªå¡åº¦æœ€å¤§çš„æ–¹å‘èµ°ä¸€æ­¥ï¼Œç‰›é¡¿æ³•åœ¨é€‰æ‹©æ–¹å‘æ—¶ï¼Œä¸ä»…ä¼šè€ƒè™‘å¡åº¦æ˜¯å¦å¤Ÿå¤§ï¼Œè¿˜ä¼šè€ƒè™‘ä½ èµ°äº†ä¸€æ­¥ä¹‹åï¼Œå¡åº¦æ˜¯å¦ä¼šå˜å¾—æ›´å¤§ã€‚æ‰€ä»¥ï¼Œå¯ä»¥è¯´ç‰›é¡¿æ³•æ¯”æ¢¯åº¦ä¸‹é™æ³•çœ‹å¾—æ›´è¿œä¸€ç‚¹ï¼Œèƒ½æ›´å¿«åœ°èµ°åˆ°æœ€åº•éƒ¨ã€‚ä»å‡ ä½•ä¸Šè¯´ï¼Œç‰›é¡¿æ³•å°±æ˜¯ç”¨ä¸€ä¸ªäºŒæ¬¡æ›²é¢å»æ‹Ÿåˆä½ å½“å‰æ‰€å¤„ä½ç½®çš„å±€éƒ¨æ›²é¢ï¼Œè€Œæ¢¯åº¦ä¸‹é™æ³•æ˜¯ç”¨ä¸€ä¸ªå¹³é¢å»æ‹Ÿåˆå½“å‰çš„å±€éƒ¨æ›²é¢ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼ŒäºŒæ¬¡æ›²é¢çš„æ‹Ÿåˆä¼šæ¯”å¹³é¢æ›´å¥½ï¼Œæ‰€ä»¥ç‰›é¡¿æ³•é€‰æ‹©çš„ä¸‹é™è·¯å¾„ä¼šæ›´ç¬¦åˆçœŸå®çš„æœ€ä¼˜ä¸‹é™è·¯å¾„ã€‚<br><img src="/2018/07/11/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/84835FEB-0EA4-41E5-B07D-41BBEB49AE9B.jpg" alt="9c6e73f0200cbe504e0370a18ca3a95a"><br>çº¢è‰²çš„ç‰›é¡¿æ³•çš„è¿­ä»£è·¯å¾„ï¼Œç»¿è‰²çš„æ˜¯æ¢¯åº¦ä¸‹é™æ³•çš„è¿­ä»£è·¯å¾„ã€‚<br>ç‰›é¡¿æ³•æ˜¯æ¢¯åº¦ä¸‹é™æ³•çš„è¿›ä¸€æ­¥å‘å±•ï¼Œæ¢¯åº¦æ³•åˆ©ç”¨äº†ç›®æ ‡å‡½æ•°çš„ä¸€é˜¶åå¯¼ä¿¡æ¯ã€ä¸€è´Ÿæ¢¯åº¦æ–¹å‘ä½œä¸ºæœç´¢æ–¹å‘ï¼Œåªè€ƒè™‘ç›®æ ‡å‡½æ•°åœ¨è¿­ä»£ç‚¹çš„å±€éƒ¨æ€§è´¨ï¼›è€Œç‰›é¡¿æ³•ä¸ä»…ä½¿ç”¨ç›®æ ‡å‡½æ•°çš„ä¸€é˜¶åå¯¼æ•°ï¼Œè¿˜è¿›ä¸€æ­¥åˆ©ç”¨äº†ç›®æ ‡å‡½æ•°çš„äºŒé˜¶åå¯¼æ•°ï¼Œè¿™æ ·å°±è€ƒè™‘äº†æ¢¯åº¦å˜åŒ–çš„è¶‹åŠ¿ï¼Œå› è€Œèƒ½æ›´å…¨é¢åœ°ç¡®å®šåˆé€‚çš„æœç´¢æ–¹å‘ä»¥åŠ å¿«æ”¶æ•›ï¼Œå®ƒå…·æœ‰äºŒé˜¶æ”¶æ•›é€Ÿåº¦ï¼Œä½†æ˜¯ç‰›é¡¿æ³•ä¹Ÿå­˜åœ¨ä¸¤ä¸ª<strong>ç¼ºç‚¹</strong> ï¼š</p>
<ul>
<li>å¯¹ç›®æ ‡å‡½æ•°æœ‰è¾ƒä¸¥æ ¼çš„è¦æ±‚ï¼Œå‡½æ•°å¿…é¡»å…·æœ‰è¿ç»­çš„ä¸€ã€äºŒé˜¶åå¯¼ï¼Œæµ·å¡çŸ©é˜µå¿…é¡»æ­£å®šã€‚</li>
<li>è®¡ç®—ç›¸å½“å¤æ‚ï¼Œé™¤äº†éœ€è¦è®¡ç®—æ¢¯åº¦å¤–ï¼Œè¿˜éœ€è®¡ç®—äºŒé˜¶åå¯¼çŸ©é˜µå’Œå®ƒçš„é€†çŸ©é˜µã€‚è®¡ç®—é‡ã€å­˜å‚¨é‡éƒ½å¾ˆå¤§ã€‚ä¸”å‡ä»¥ç»´æ•°Nçš„å¹³æ–¹æ¯”å¢åŠ ï¼Œå½“Nå¾ˆå¤§æ—¶ï¼Œè¿™ä¸ªé—®é¢˜å°±æ›´åŠ çªå‡ºã€‚</li>
</ul>
<h2 id="æ‹Ÿç‰›é¡¿æ³•"><a href="#æ‹Ÿç‰›é¡¿æ³•" class="headerlink" title="æ‹Ÿç‰›é¡¿æ³•"></a>æ‹Ÿç‰›é¡¿æ³•</h2><p>åœ¨ç‰›é¡¿æ³•çš„è¿­ä»£è®¡ç®—ä¸­ï¼Œéœ€è¦è®¡ç®—æµ·å¡çŸ©é˜µçš„é€†çŸ©é˜µ$H^-1$ï¼Œè¿™ä¸€è®¡ç®—æ¯”è¾ƒå¤æ‚ï¼Œè€ƒè™‘ç”¨ä¸€ä¸ªné˜¶çŸ©é˜µ$G_k=G(x^k)$æ¥è¿‘ä¼¼æ›¿ä»£$H^{-1}_{k}=H^{-1}(x^k)$ã€‚è¿™å°±æ˜¯æ‹Ÿç‰›é¡¿çš„åŸºæœ¬æƒ³æ³•ã€‚</p>
<p>è¦æ‰¾åˆ°è¿‘ä¼¼çš„æ›¿ä»£çŸ©é˜µï¼Œå¿…å®šè¦å’Œ$H_k$æœ‰ç±»ä¼¼çš„æ€§è´¨ã€‚å…ˆçœ‹ä¸‹ç‰›é¡¿æ³•è¿­ä»£ä¸­æµ·å¡çŸ©é˜µ$H_k$æ»¡è¶³çš„æ¡ä»¶ã€‚é¦–å…ˆï¼Œ$H_k$æ»¡è¶³ä»¥ä¸‹å…³ç³»ï¼š</p>
<p>å–$x=x^{k-1}$ï¼Œç”±</p>
<script type="math/tex; mode=display">
\nabla f(x)=g_k+H_k(x-x^k)</script><p>å¾—ï¼š</p>
<script type="math/tex; mode=display">
g_{k-1}-g_k = H_k(x^{k-1}-x^k)</script><p>è®°$y_k=g_k-g_{k-1},\delta_k = x^k-x^{k-1}$,åˆ™ï¼š</p>
<script type="math/tex; mode=display">
y_{k-1}=H_k\delta_{k-1}H^{-1}_ky_{k-1}=\delta_{k-1}</script><p>ç§°ä¸ºæ‹Ÿç‰›é¡¿æ¡ä»¶ã€‚</p>
<p>å…¶æ¬¡ï¼Œå¦‚æœ$H_k$æ˜¯æ­£å®šçš„ï¼ˆ$H_k^{-1}$ä¹Ÿæ˜¯æ­£å®šçš„ï¼‰ï¼Œé‚£ä¹ˆä¿è¯ç‰›é¡¿æ³•çš„æœç´¢æ–¹å‘$p_k$æ˜¯ä¸‹é™æ–¹å‘ã€‚è¿™æ˜¯å› ä¸ºæœç´¢æ–¹å‘æ˜¯$p_k = -H_k^{-1}g_k$,</p>
<p>ç”±</p>
<script type="math/tex; mode=display">
x^{k+1} = x^k -H^{-1}_kg_k</script><p>æœ‰</p>
<script type="math/tex; mode=display">
x = x^k - \lambda H_k^{-1}g_k = x^k+\lambda p_k</script><p>åˆ™$f(x)$åœ¨$x^k$çš„æ³°å‹’å±•å¼€å¯è¿‘ä¼¼ä¸ºï¼š</p>
<script type="math/tex; mode=display">
f(x) = f(x^k) - \lambda g^T_kH_k^{-1}g_k</script><p>ç”±äº$H_k^{-1}$æ­£å®šï¼Œæ•…$g_k^TH_k^{-1}g_k&gt;0$ã€‚å½“$\lambda$ä¸ºä¸€ä¸ªå……åˆ†å°çš„æ­£æ•°æ—¶ï¼Œæœ‰$f(x)&lt;f(x^k)$,å³æœç´¢æ–¹å‘$p_k$æ˜¯ä¸‹é™æ–¹å‘ã€‚</p>
<p>å› æ­¤æ‹Ÿç‰›é¡¿æ³•å°†$G_k$ä½œä¸º$H^{-1}_k$è¿‘ä¼¼ã€‚è¦æ±‚$G_k$æ»¡è¶³åŒæ ·çš„æ¡ä»¶ã€‚é¦–å…ˆï¼Œæ¯æ¬¡è¿­ä»£çŸ©é˜µ$G_k$æ˜¯æ­£å®šçš„ã€‚åŒæ—¶ï¼Œ$G_kæ»¡è¶³ä¸‹é¢çš„æ‹Ÿç‰›é¡¿æ¡ä»¶</p>
<script type="math/tex; mode=display">
G_{k+1}y_k = \delta_k</script><p>æŒ‰ç…§æ‹Ÿç‰›é¡¿æ¡ä»¶ï¼Œåœ¨æ¯æ¬¡è¿­ä»£ä¸­å¯ä»¥é€‰æ‹©æ›´æ–°çŸ©é˜µ$G_{k+1}$:</p>
<script type="math/tex; mode=display">
G_{k+1} = G_k + \nabla G_k</script><h3 id="DFP"><a href="#DFP" class="headerlink" title="DFP"></a>DFP</h3><h3 id="BFGS"><a href="#BFGS" class="headerlink" title="BFGS"></a>BFGS</h3><h3 id="Broyden"><a href="#Broyden" class="headerlink" title="Broyden"></a>Broyden</h3>]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ä¼˜åŒ–ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>linuxå‘½ä»¤é€ŸæŸ¥</title>
    <url>/2018/06/25/linux%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="linuxçš„æ–‡ä»¶ç³»ç»Ÿ"><a href="#linuxçš„æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="linuxçš„æ–‡ä»¶ç³»ç»Ÿ"></a>linuxçš„æ–‡ä»¶ç³»ç»Ÿ</h2><ol>
<li>/boot:ç³»ç»Ÿå¯åŠ¨ç›¸å…³çš„æ–‡ä»¶ï¼Œå¦‚å†…æ ¸ã€initrdã€ä»¥åŠgrubï¼ˆbootloaderï¼‰</li>
<li>/dev:è®¾å¤‡æ–‡ä»¶ï¼š<ol>
<li>å—è®¾å¤‡ï¼šéšæœºè®¿é—®ï¼Œæ•°æ®å—</li>
<li>å­—ç¬¦è®¾å¤‡ï¼šçº¿æ€§è®¿é—®ï¼ŒæŒ‰å­—ç¬¦ä¸ºå•ä½</li>
<li>è®¾å¤‡å·ï¼šä¸»è®¾å¤‡å·ï¼ˆmajorï¼‰å’Œæ¬¡è®¾å¤‡å·ï¼ˆminorï¼‰</li>
</ol>
</li>
<li>/etcï¼šé…ç½®æ–‡ä»¶</li>
<li>/homeï¼šç”¨æˆ·çš„å®¶ç›®å½•ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·çš„å®¶ç›®å½•é€šå¸¸é»˜è®¤ä¸º/home/username</li>
<li>/rootï¼šç®¡ç†å‘˜çš„å®¶ç›®å½•ï¼›</li>
<li>/lib:åº“æ–‡ä»¶<ol>
<li>é™æ€åº“ï¼š.a</li>
<li>åŠ¨æ€åº“ï¼š.dll, .so(shared object)</li>
<li>/lib/moudules:å†…æ ¸æ¨¡å—æ–‡ä»¶</li>
</ol>
</li>
<li>/lib64</li>
<li>/media:æŒ‚è½½ç‚¹ç›®å½•ï¼Œç§»åŠ¨è®¾å¤‡</li>
<li>/mnt:æŒ‚è½½ç‚¹ç›®å½•ï¼Œé¢å¤–çš„ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ</li>
<li>/opt:å¯é€‰ç›®å½•ï¼Œç¬¬ä¸‰æ–¹ç¨‹åºçš„å®‰è£…ç›®å½•</li>
<li>/procï¼šä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå†…æ ¸æ˜ å°„æ–‡ä»¶</li>
<li>/sysï¼šä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œè·Ÿç¡¬ä»¶è®¾å¤‡ç›¸å…³çš„å±æ€§æ˜ å°„æ–‡ä»¶</li>
<li>/tmp:ä¸´æ—¶æ–‡ä»¶ï¼Œ/var/tmp</li>
<li>/var:å¯å˜åŒ–çš„æ–‡ä»¶</li>
<li>/bin:å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç”¨æˆ·å‘½ä»¤</li>
<li>/sbinï¼šç®¡ç†å‘½ä»¤</li>
</ol>
<a id="more"></a>
<h2 id="terminal-å‘½ä»¤"><a href="#terminal-å‘½ä»¤" class="headerlink" title="terminal å‘½ä»¤"></a>terminal å‘½ä»¤</h2><ol>
<li>printenvï¼šæ‰“å°ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡</li>
<li>whereis: æŸ¥æ‰¾æ–‡ä»¶orå‘½ä»¤</li>
<li>æŸ¥çœ‹å·²ç»å­˜åœ¨çš„ssh key : cat ~/.ssh/id_rsa.pub</li>
</ol>
<h3 id="å‹ç¼©"><a href="#å‹ç¼©" class="headerlink" title="å‹ç¼©"></a>å‹ç¼©</h3><ol>
<li>tar  <ol>
<li>è§£åŒ…ï¼štar zxvf filename.tar  </li>
<li>æ‰“åŒ…ï¼štar czvf filename.tar dirname</li>
</ol>
</li>
<li>gzå‘½ä»¤  <ol>
<li>è§£å‹1ï¼šgunzip filename.gz  </li>
<li>è§£å‹2ï¼šgzip -d filename.gz  </li>
<li>å‹ç¼©ï¼šgzip filename<ol>
<li>.tar.gz å’Œ  .tgz      </li>
<li>è§£å‹ï¼štar zxvf filename.tar.gz      </li>
<li>å‹ç¼©ï¼štar zcvf filename.tar.gz dirname      </li>
<li>å‹ç¼©å¤šä¸ªæ–‡ä»¶ï¼štar zcvf filename.tar.gz dirname1 dirname2 dirname3â€¦..</li>
</ol>
</li>
</ol>
</li>
<li>bz2å‘½ä»¤  <ol>
<li>è§£å‹1ï¼šbzip2 -d filename.bz2  </li>
<li>è§£å‹2ï¼šbunzip2 filename.bz2  </li>
<li>å‹ç¼©ï¼šbzip2 -z filename       </li>
<li>.tar.bz2       <ol>
<li>è§£å‹ï¼štar jxvf filename.tar.bz2       </li>
<li>å‹ç¼©ï¼štar jcvf filename.tar.bz2 dirname</li>
</ol>
</li>
</ol>
</li>
<li>bzå‘½ä»¤    <ol>
<li>è§£å‹1ï¼šbzip2 -d filename.bz    </li>
<li>è§£å‹2ï¼šbunzip2 filename.bz         </li>
<li>.tar.bz       <ol>
<li>è§£å‹ï¼štar jxvf filename.tar.bz</li>
</ol>
</li>
<li>zå‘½ä»¤    <ol>
<li>è§£å‹ï¼šuncompress filename.z    </li>
<li>å‹ç¼©ï¼šcompress filename       </li>
<li>.tar.z          <ol>
<li>è§£å‹ï¼štar zxvf filename.tar.z          </li>
<li>å‹ç¼©ï¼štar zcvf filename.tar.z dirname</li>
</ol>
</li>
</ol>
</li>
<li>zipå‘½ä»¤        <ol>
<li>è§£å‹ï¼šunzip filename.zip    </li>
<li>å‹ç¼©ï¼šzip filename.zip dirname</li>
</ol>
</li>
</ol>
</li>
<li><p>æ€»ç»“ï¼šz ä»¥gzipæ ¼å¼å‹ç¼©ï¼Œcè¡¨ç¤ºcreateï¼Œvæ˜¾ç¤ºå‹ç¼©çš„è¯¦ç»†æƒ…å†µ f file</p>
<ol>
<li>å‹ç¼©<ol>
<li>tar â€“cvf jpg.tar *.jpg //å°†ç›®å½•é‡Œæ‰€æœ‰jpgæ–‡ä»¶æ‰“åŒ…æˆtar.jpg </li>
<li>tar â€“czf jpg.tar.gz *.jpg //å°†ç›®å½•é‡Œæ‰€æœ‰jpgæ–‡ä»¶æ‰“åŒ…æˆjpg.taråï¼Œå¹¶ä¸”å°†å…¶ç”¨gzipå‹ç¼©ï¼Œç”Ÿæˆä¸€ä¸ªgzipå‹ç¼©è¿‡çš„åŒ…ï¼Œå‘½åä¸ºjpg.tar.gz </li>
<li>tar â€“cjf jpg.tar.bz2 *.jpg //å°†ç›®å½•é‡Œæ‰€æœ‰jpgæ–‡ä»¶æ‰“åŒ…æˆjpg.taråï¼Œå¹¶ä¸”å°†å…¶ç”¨bzip2å‹ç¼©ï¼Œç”Ÿæˆä¸€ä¸ªbzip2å‹ç¼©è¿‡çš„åŒ…ï¼Œå‘½åä¸ºjpg.tar.bz2 </li>
<li>tar â€“cZf jpg.tar.Z *.jpg //å°†ç›®å½•é‡Œæ‰€æœ‰jpgæ–‡ä»¶æ‰“åŒ…æˆjpg.taråï¼Œå¹¶ä¸”å°†å…¶ç”¨compresså‹ç¼©ï¼Œç”Ÿæˆä¸€ä¸ªumcompresså‹ç¼©è¿‡çš„åŒ…ï¼Œå‘½åä¸ºjpg.tar.Z </li>
<li>rar a jpg.rar *.jpg //raræ ¼å¼çš„å‹ç¼©ï¼Œéœ€è¦å…ˆä¸‹è½½rar for linux </li>
<li>zip jpg.zip *.jpg //zipæ ¼å¼çš„å‹ç¼©ï¼Œéœ€è¦å…ˆä¸‹è½½zip for linux </li>
<li>è§£å‹</li>
<li>tar â€“xvf file.tar //è§£å‹ taråŒ… </li>
<li>tar -xzvf file.tar.gz //è§£å‹tar.gz </li>
<li>tar -xjvf file.tar.bz2 //è§£å‹ </li>
<li>tar.bz2 tar â€“xZvf file.tar.Z //è§£å‹tar.Z </li>
<li>unrar e file.rar //è§£å‹rar </li>
<li>unzip file.zip //è§£å‹zip </li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h3><ol>
<li>æ–°å»ºä¸€ä¸ªå«session_nameçš„sessionï¼šscreen -S session_name</li>
<li>åˆ—å‡ºå½“å‰æ‰€æœ‰çš„sessionï¼šscreen -ls</li>
<li>å›åˆ°session_nameè¿™ä¸ªsessionï¼šscreen -r session_name</li>
<li>è¿œç¨‹detachæŸä¸ªsessionï¼šscreen -d session_name</li>
<li>ç»“æŸå½“å‰sessionå¹¶å›åˆ°session_nameè¿™ä¸ªsessionï¼šscreen -d -r session_name        </li>
<li>åˆ©ç”¨exité€€å‡ºå¹¶killæ‰session</li>
</ol>
<h3 id="æŸ¥çœ‹æ˜¾å¡å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ"><a href="#æŸ¥çœ‹æ˜¾å¡å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹æ˜¾å¡å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ"></a>æŸ¥çœ‹æ˜¾å¡å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ</h3><ol>
<li>æŸ¥çœ‹æ˜¾å¡ä½¿ç”¨æƒ…å†µï¼šwatch -n 5 nvidia-smi</li>
<li>æŸ¥çœ‹ç£ç›˜ä½¿ç”¨ï¼šdf -h</li>
</ol>
<h3 id="ç§»åŠ¨é‡å‘½å"><a href="#ç§»åŠ¨é‡å‘½å" class="headerlink" title="ç§»åŠ¨é‡å‘½å"></a>ç§»åŠ¨é‡å‘½å</h3><ol>
<li>å°†/usr/udtä¸­çš„æ‰€æœ‰æ–‡ä»¶ç§»åˆ°å½“å‰ç›®å½•(ç”¨â€.â€è¡¨ç¤º)ä¸­ï¼š$ mv /usr/udt/* .</li>
<li>å°†æ–‡ä»¶test.txté‡å‘½åä¸ºwbk.txtï¼š$ mv test.txt wbk.txt</li>
</ol>
<h3 id="ç›®å½•ç®¡ç†"><a href="#ç›®å½•ç®¡ç†" class="headerlink" title="ç›®å½•ç®¡ç†"></a>ç›®å½•ç®¡ç†</h3><ol>
<li>ls</li>
<li>cd</li>
<li>pwd</li>
<li>mkdir</li>
<li>rmdir</li>
<li>tree</li>
</ol>
<h3 id="æ–‡ä»¶ç®¡ç†"><a href="#æ–‡ä»¶ç®¡ç†" class="headerlink" title="æ–‡ä»¶ç®¡ç†"></a>æ–‡ä»¶ç®¡ç†</h3><ol>
<li>touch</li>
<li>stat</li>
<li>file</li>
<li>rm<ol>
<li>-i: è‹¥æŒ‡å®šç›®å½•å·²æœ‰åŒåæ–‡ä»¶ï¼Œåˆ™å…ˆè¯¢é—®æ˜¯å¦è¦†ç›–æ—§æ–‡ä»¶;</li>
<li>-f: åœ¨mvæ“ä½œè¦è¦†ç›–æŸå·²æœ‰çš„ç›®æ ‡æ–‡ä»¶æ—¶ä¸ç»™ä»»ä½•æŒ‡ç¤º;</li>
</ol>
</li>
<li>cp [options] source dest<ol>
<li>-a:æ­¤é€‰é¡¹é€šå¸¸åœ¨å¤åˆ¶ç›®å½•æ—¶ä½¿ç”¨ï¼Œå®ƒä¿ç•™é“¾æ¥ã€æ–‡ä»¶å±æ€§ï¼Œå¹¶å¤åˆ¶ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹ã€‚å…¶ä½œç”¨ç­‰äºdprå‚æ•°ç»„åˆã€‚</li>
<li>-dï¼šå¤åˆ¶æ—¶ä¿ç•™é“¾æ¥ã€‚è¿™é‡Œæ‰€è¯´çš„é“¾æ¥ç›¸å½“äºWindowsç³»ç»Ÿä¸­çš„å¿«æ·æ–¹å¼ã€‚</li>
<li>-fï¼šè¦†ç›–å·²ç»å­˜åœ¨çš„ç›®æ ‡æ–‡ä»¶è€Œä¸ç»™å‡ºæç¤ºã€‚</li>
<li>-iï¼šä¸-fé€‰é¡¹ç›¸åï¼Œåœ¨è¦†ç›–ç›®æ ‡æ–‡ä»¶ä¹‹å‰ç»™å‡ºæç¤ºï¼Œè¦æ±‚ç”¨æˆ·ç¡®è®¤æ˜¯å¦è¦†ç›–ï¼Œå›ç­”â€yâ€æ—¶ç›®æ ‡æ–‡ä»¶å°†è¢«è¦†ç›–ã€‚</li>
<li>-pï¼šé™¤å¤åˆ¶æ–‡ä»¶çš„å†…å®¹å¤–ï¼Œè¿˜æŠŠä¿®æ”¹æ—¶é—´å’Œè®¿é—®æƒé™ä¹Ÿå¤åˆ¶åˆ°æ–°æ–‡ä»¶ä¸­ã€‚</li>
<li>-rï¼šè‹¥ç»™å‡ºçš„æºæ–‡ä»¶æ˜¯ä¸€ä¸ªç›®å½•æ–‡ä»¶ï¼Œæ­¤æ—¶å°†å¤åˆ¶è¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„å­ç›®å½•å’Œæ–‡ä»¶ã€‚</li>
<li>-lï¼šä¸å¤åˆ¶æ–‡ä»¶ï¼Œåªæ˜¯ç”Ÿæˆé“¾æ¥æ–‡ä»¶ã€‚</li>
</ol>
</li>
<li>mv</li>
<li>nano</li>
<li>vi</li>
<li>vim</li>
</ol>
<h3 id="æ—¥æœŸæ—¶é—´"><a href="#æ—¥æœŸæ—¶é—´" class="headerlink" title="æ—¥æœŸæ—¶é—´"></a>æ—¥æœŸæ—¶é—´</h3><ol>
<li>data</li>
<li>clock</li>
<li>hwclock</li>
<li>cal</li>
<li>ntpdate</li>
</ol>
<h3 id="æŸ¥çœ‹æ–‡æœ¬"><a href="#æŸ¥çœ‹æ–‡æœ¬" class="headerlink" title="æŸ¥çœ‹æ–‡æœ¬"></a>æŸ¥çœ‹æ–‡æœ¬</h3><ol>
<li>cat</li>
<li>tac</li>
<li>more</li>
<li>less</li>
<li>head</li>
<li>tail</li>
</ol>
<h3 id="æ–‡æœ¬æŸ¥æ‰¾"><a href="#æ–‡æœ¬æŸ¥æ‰¾" class="headerlink" title="æ–‡æœ¬æŸ¥æ‰¾"></a>æ–‡æœ¬æŸ¥æ‰¾</h3><ol>
<li>findï¼šæŸ¥æ‰¾æ–‡ä»¶ï¼Œegï¼šfind /etc/pass* åœ¨/etcç›®å½•ä¸‹æŸ¥æ‰¾ä»¥passå¼€å¤´çš„æ–‡ä»¶</li>
<li>grepï¼šæŸ¥æ‰¾æ–‡æœ¬å†…å®¹ï¼Œeg: grep â€˜^rootâ€™ /etc/passwd åœ¨/etc/passwdæ–‡ä»¶ä¸­æŸ¥æ‰¾ä»¥rootå¼€å¤´çš„å†…å®¹<h3 id="ç®¡é“"><a href="#ç®¡é“" class="headerlink" title="ç®¡é“"></a>ç®¡é“</h3></li>
<li>| è¡¨ç¤ºç®¡é“ï¼Œè¡¨ç¤ºç®¡é“å·¦è¾¹å‘½ä»¤çš„ç»“æœä¼ ç»™ç®¡é“å³è¾¹ã€‚eg: ls -l | moreã€ ps aux | grep xxx</li>
<li>å‘½ä»¤1 | å‘½ä»¤2 | å‘½ä»¤3</li>
</ol>
<h3 id="æ–‡æœ¬å¤„ç†"><a href="#æ–‡æœ¬å¤„ç†" class="headerlink" title="æ–‡æœ¬å¤„ç†"></a>æ–‡æœ¬å¤„ç†</h3><ol>
<li>cut<ol>
<li>-dï¼šæŒ‡å®šå­—æ®µåˆ†å‰²ç¬¦ï¼Œé»˜è®¤æ˜¯ç©ºæ ¼<ol>
<li>-dâ€,â€</li>
</ol>
</li>
<li>-fï¼š æŒ‡å®šè¦æ˜¾ç¤ºçš„å­—æ®µ<ol>
<li>-f 1,3</li>
<li>-f 1-3</li>
</ol>
</li>
</ol>
</li>
<li>sortï¼šæ–‡æœ¬æ’åº<ol>
<li>-nï¼šæ•°å€¼æ’åº</li>
<li>-rï¼šé™åº</li>
<li>-tï¼šå­—æ®µåˆ†éš”ç¬¦</li>
<li>-kï¼šä»¥å“ªä¸ªå­—æ®µä¸ºå…³é”®å­—è¿›è¡Œæ’åº</li>
<li>-uï¼šæ’åºåç›¸åŒçš„è¡Œåªæ˜¾ç¤ºä¸€æ¬¡</li>
<li>-fï¼šæ’åºæ—¶å¿½ç•¥å­—ç¬¦å¤§å°å†™</li>
</ol>
</li>
<li>join</li>
<li>sed</li>
<li>awk</li>
</ol>
<h3 id="ç³»ç»Ÿç®¡ç†å‘½ä»¤"><a href="#ç³»ç»Ÿç®¡ç†å‘½ä»¤" class="headerlink" title="ç³»ç»Ÿç®¡ç†å‘½ä»¤"></a>ç³»ç»Ÿç®¡ç†å‘½ä»¤</h3><ol>
<li>ps å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¿›ç¨‹çš„è¯¦ç»†çŠ¶å†µ<ol>
<li>-a æ˜¾ç¤ºç»ˆç«¯ä¸Šæ‰€æœ‰è¿›ç¨‹ï¼ŒåŒ…æ‹¬å…¶ä»–ç”¨æˆ·çš„è¿›ç¨‹</li>
<li>-u æ˜¾ç¤ºè¿›ç¨‹çš„è¯¦ç»†çŠ¶æ€</li>
<li>-x æ˜¾ç¤ºæ²¡æœ‰æ§åˆ¶ç»ˆç«¯çš„è¿›ç¨‹</li>
<li>-w æ˜¾ç¤ºåŠ å®½ï¼Œä»¥ä¾¿æ˜¾ç¤ºæ›´å¤šçš„ä¿¡æ¯</li>
<li>-r åªæ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹</li>
</ol>
</li>
<li>top å‘½ä»¤ç”¨æ¥åŠ¨æ€æ˜¾ç¤ºè¿è¡Œä¸­çš„è¿›ç¨‹ï¼Œå¯ä»¥åœ¨ä½¿ç”¨topå‘½ä»¤æ—¶åŠ ä¸Š-dæ¥æŒ‡å®šæ˜¾ç¤ºä¿¡æ¯æ›´æ–°çš„æ—¶é—´é—´éš”ã€‚åœ¨topå‘½ä»¤ä¸‹ï¼Œé€šè¿‡æŒ‰ä¸‹ä¸‹åˆ—å­—æ¯ï¼Œæ¥å¯¹æ˜¾ç¤ºç»“æœè¿›è¡Œæ’åº<ol>
<li>m æ ¹æ®å†…å­˜ä½¿ç”¨é‡æ¥æ’åº</li>
<li>p  æ ¹æ®cpuå æœ‰ç‡æ¥æ’åº</li>
<li>t   æ ¹æ®è¿›ç¨‹è¿è¡Œæ—¶é—´çš„é•¿çŸ­æ¥æ’åº</li>
<li>u  å¯ä»¥æ ¹æ®åé¢è¾“å…¥çš„ç”¨æˆ·åæ¥ç­›é€‰è¿›ç¨‹</li>
<li>k  å¯ä»¥æ ¹æ®åé¢è¾“å…¥çš„pidæ¥æ€æ­»è¿›ç¨‹</li>
<li>q  é€€å‡º</li>
<li>h  è·å¾—å¸®åŠ©</li>
</ol>
</li>
<li>kill ï¼Œkillall<ol>
<li>kill -9 pid</li>
<li>killall è¿›ç¨‹å</li>
</ol>
</li>
</ol>
<h3 id="ç£ç›˜ç©ºé—´å‘½ä»¤"><a href="#ç£ç›˜ç©ºé—´å‘½ä»¤" class="headerlink" title="ç£ç›˜ç©ºé—´å‘½ä»¤"></a>ç£ç›˜ç©ºé—´å‘½ä»¤</h3><ol>
<li>df å‘½ä»¤ç”¨äºæ£€æµ‹æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´å ç”¨å’Œå‰©ä½™æƒ…å†µï¼Œå¯ä»¥æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿå¯¹èŠ‚ç‚¹å’Œç£ç›˜å—çš„ä½¿ç”¨æƒ…å†µ<ol>
<li>a æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ä½¿ç”¨æƒ…å†µ</li>
<li>m ä»¥1024å­—èŠ‚ä¸ºå•ä½æ˜¾ç¤º</li>
<li>t æ˜¾ç¤ºå„æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ</li>
<li>T æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿ</li>
</ol>
</li>
<li>du å‘½ä»¤ç”¨äºç»Ÿè®¡ç›®å½•æˆ–æ–‡ä»¶æ‰€å ç£ç›˜ç©ºé—´çš„å¤§å°ï¼Œè¯¥å‘½ä»¤çš„æ‰§è¡Œç»“æœä¸dfç±»ä¼¼ï¼Œduæ›´ä¾§é‡äºç£ç›˜çš„ä½¿ç”¨æƒ…å†µã€‚ æ ¼å¼ï¼š du [é€‰é¡¹] ç›®å½•æˆ–æ–‡ä»¶å<ol>
<li>a é€’å½’æ˜¾ç¤ºæŒ‡å®šç›®å½•ä¸­å„æ–‡ä»¶å’Œå­ç›®å½•ä¸­æ–‡ä»¶å ç”¨çš„æ•°æ®å—</li>
<li>s æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•å ç”¨çš„æ•°æ®å—</li>
<li>b ä»¥å­—èŠ‚ä¸ºå•ä½æ˜¾ç¤ºç£ç›˜å ç”¨æƒ…å†µ</li>
<li>l è®¡ç®—æ‰€æœ‰æ–‡ä»¶å¤§å°ï¼Œå¯¹ç¡¬é“¾æ¥æ–‡ä»¶è®¡ç®—å¤šæ¬¡</li>
</ol>
</li>
</ol>
<h3 id="æŸ¥çœ‹æˆ–é…ç½®ç½‘å¡ä¿¡æ¯ï¼šifconfig"><a href="#æŸ¥çœ‹æˆ–é…ç½®ç½‘å¡ä¿¡æ¯ï¼šifconfig" class="headerlink" title="æŸ¥çœ‹æˆ–é…ç½®ç½‘å¡ä¿¡æ¯ï¼šifconfig"></a>æŸ¥çœ‹æˆ–é…ç½®ç½‘å¡ä¿¡æ¯ï¼šifconfig</h3><h3 id="æµ‹è¯•è¿œç¨‹ä¸»æœºè¿é€šæ€§ï¼šping"><a href="#æµ‹è¯•è¿œç¨‹ä¸»æœºè¿é€šæ€§ï¼šping" class="headerlink" title="æµ‹è¯•è¿œç¨‹ä¸»æœºè¿é€šæ€§ï¼šping"></a>æµ‹è¯•è¿œç¨‹ä¸»æœºè¿é€šæ€§ï¼šping</h3><ol>
<li>ping -c4 www.baidu.com<h3 id="æŸ¥çœ‹ç½‘ç»œæƒ…å†µï¼š-netstat-ntpl"><a href="#æŸ¥çœ‹ç½‘ç»œæƒ…å†µï¼š-netstat-ntpl" class="headerlink" title="æŸ¥çœ‹ç½‘ç»œæƒ…å†µï¼š netstat -ntpl"></a>æŸ¥çœ‹ç½‘ç»œæƒ…å†µï¼š netstat -ntpl</h3></li>
</ol>
<h3 id="linuxå¼•å·"><a href="#linuxå¼•å·" class="headerlink" title="linuxå¼•å·"></a>linuxå¼•å·</h3><ol>
<li>åå¼•å·ï¼š` ï¼Œ å‘½ä»¤æ›¿æ¢</li>
<li>å•å¼•å·ï¼šâ€™â€™,å­—ç¬¦ä¸²</li>
<li>åŒå¼•å·ï¼šâ€â€,å˜é‡æ›¿æ¢</li>
</ol>
<h2 id="è½¯ä»¶å®‰è£…å’Œç®¡ç†"><a href="#è½¯ä»¶å®‰è£…å’Œç®¡ç†" class="headerlink" title="è½¯ä»¶å®‰è£…å’Œç®¡ç†"></a>è½¯ä»¶å®‰è£…å’Œç®¡ç†</h2><h3 id="è½¯ä»¶åŒ…"><a href="#è½¯ä»¶åŒ…" class="headerlink" title="è½¯ä»¶åŒ…"></a>è½¯ä»¶åŒ…</h3><ol>
<li>binæ–‡ä»¶ï¼ˆé€‚åˆæ‰€æœ‰Linuxå‘è¡Œç‰ˆï¼‰ï¼Œæ˜¯å¯æ‰§è¡Œçš„æ–‡ä»¶</li>
<li>rpmåŒ…ï¼Œyumï¼ˆredhatç³»åˆ—ï¼‰<ol>
<li>rpmå‘½ä»¤ï¼šå®‰è£…è¿‡ç¨‹ä¸­ä¸éœ€è¦æŒ‡å®šå®‰è£…è·¯å¾„ï¼Œrpmæ–‡ä»¶åœ¨åˆ¶ä½œçš„æ—¶å€™å·²ç»ç¡®å®šäº†å®‰è£…è·¯å¾„</li>
<li>æŸ¥è¯¢è½¯ä»¶å®‰è£…è·¯å¾„ï¼šrpm -ql xxx</li>
</ol>
</li>
<li>æºç å‹ç¼©åŒ…ï¼ˆé€‚åˆæ‰€æœ‰çš„Linuxå‘è¡Œç‰ˆï¼‰</li>
<li>å®˜æ–¹å·²ç»ç¼–è¯‘å¥½çš„ï¼Œä¸‹è½½è½¯ä»¶åŒ…ç›´æ¥å¯ä»¥ä½¿ç”¨</li>
<li>å®‰è£…æ­¥éª¤ï¼š<ol>
<li>æ£€æŸ¥æ˜¯å¦å·²ç»å®‰è£…ï¼šrpm -qa | grep jdk</li>
<li>ä¸‹è½½è½¯ä»¶åŒ…</li>
<li>å®‰è£…ä¾èµ–<h3 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h3></li>
</ol>
</li>
<li>è§£å†³rpmä¸‹è½½é—®é¢˜</li>
<li>è§£å†³rpmæ–‡ä»¶çš„æŸ¥è¯¢é—®é¢˜</li>
<li>è§£å†³rpmå®‰è£…é—®é¢˜</li>
<li>è§£å†³rpmçš„ä¾èµ–é—®é¢˜</li>
</ol>
]]></content>
      <categories>
        <category>é€ŸæŸ¥</category>
      </categories>
      <tags>
        <tag>é€ŸæŸ¥</tag>
        <tag>linuxå‘½ä»¤</tag>
      </tags>
  </entry>
  <entry>
    <title>pythoné«˜çº§</title>
    <url>/2018/06/05/python%E9%AB%98%E7%BA%A7/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="range-start-stop-step"><a href="#range-start-stop-step" class="headerlink" title="range(start, stop[, step])"></a>range(start, stop[, step])</h3><ul>
<li>start: è®¡æ•°ä» start å¼€å§‹ã€‚é»˜è®¤æ˜¯ä» 0 å¼€å§‹ã€‚</li>
<li>stop: è®¡æ•°åˆ° stop ç»“æŸï¼Œ</li>
<li>stepï¼šæ­¥é•¿ï¼Œé»˜è®¤ä¸º1ã€‚</li>
</ul>
<a id="more"></a>
<h3 id="lambda-map-filter-reduce-yieldå‡½æ•°çš„åº”ç”¨"><a href="#lambda-map-filter-reduce-yieldå‡½æ•°çš„åº”ç”¨" class="headerlink" title="lambda,map,filter,reduce,yieldå‡½æ•°çš„åº”ç”¨"></a>lambda,map,filter,reduce,yieldå‡½æ•°çš„åº”ç”¨</h3><h4 id="åŒ¿åå‡½æ•°lambda"><a href="#åŒ¿åå‡½æ•°lambda" class="headerlink" title="åŒ¿åå‡½æ•°lambda"></a><strong>åŒ¿åå‡½æ•°lambda</strong></h4><p>å†’å·å·¦è¾¹æ”¾åŸå‡½æ•°çš„å‚æ•°ï¼Œå¯ä»¥æœ‰å¤šä¸ªå‚æ•°ï¼Œç”¨é€—å·(,)éš”å¼€ï¼Œå†’å·å³è¾¹æ˜¯è¿”å›å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">lambda</span> x,y:x+y</span><br></pre></td></tr></table></figure>
<h4 id="éå†å‡½æ•°-map"><a href="#éå†å‡½æ•°-map" class="headerlink" title="éå†å‡½æ•°:map"></a><strong>éå†å‡½æ•°</strong>:map</h4><p>mapå‡½æ•°ç”¨äºéå†åºåˆ—</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">li = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">lo = [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line">list(map(<span class="keyword">lambda</span> x, y: x**<span class="number">2</span> + y**<span class="number">2</span>, li, lo))</span><br><span class="line"><span class="comment"># [26, 40, 58, 80]</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (x*x)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (x+x)</span><br><span class="line"></span><br><span class="line">funcs = [multiply, add]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    value = map(<span class="keyword">lambda</span> x: x(i), funcs)</span><br><span class="line">print(list(value))</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="comment"># [0, 0]</span></span><br><span class="line"><span class="comment"># [1, 2]</span></span><br><span class="line"><span class="comment"># [4, 4]</span></span><br><span class="line"><span class="comment"># [9, 6]</span></span><br></pre></td></tr></table></figure>
<h4 id="ç­›é€‰å‡½æ•°-filter"><a href="#ç­›é€‰å‡½æ•°-filter" class="headerlink" title="ç­›é€‰å‡½æ•°:filter"></a><strong>ç­›é€‰å‡½æ•°</strong>:filter</h4><p>ç­›é€‰å‡½æ•°ç”¨äºå¯¹åºåˆ—ä¸­çš„å…ƒç´ è¿›è¡Œç­›é€‰ï¼Œæœ€ç»ˆè·å–ç¬¦åˆæ¡ä»¶çš„åºåˆ—ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">li = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line">list(filter(<span class="keyword">lambda</span> x: x&gt;<span class="number">5</span>, li))</span><br><span class="line"><span class="comment">#Output</span></span><br><span class="line"><span class="comment"># [6, 7, 8, 9]</span></span><br></pre></td></tr></table></figure>
<h4 id="ç´¯è®¡å‡½æ•°-reduce"><a href="#ç´¯è®¡å‡½æ•°-reduce" class="headerlink" title="ç´¯è®¡å‡½æ•°:reduce"></a><strong>ç´¯è®¡å‡½æ•°</strong>:reduce</h4><p>å¯¹åºåˆ—ä¸­çš„æ‰€æœ‰å‡½æ•°è¿›è¡Œç´¯ç§¯æ“ä½œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">li = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">reduce(<span class="keyword">lambda</span> a, b: a+b, li) <span class="comment"># ç»“æœä¸º15</span></span><br><span class="line">reduce(<span class="keyword">lambda</span> a, b: a+b, li, <span class="number">100</span>)<span class="comment">#ç»“æœä¸º115ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºåˆå§‹å€¼ï¼Œåœ¨æ­¤å€¼ä¹‹è¿›è¡Œç´¯è®¡</span></span><br></pre></td></tr></table></figure>
<h4 id="å…³é”®å­—-yield"><a href="#å…³é”®å­—-yield" class="headerlink" title="å…³é”®å­—: yield"></a><strong>å…³é”®å­—</strong>: yield</h4><p>yieldå¯ä»¥å°†å‡½æ•°æ‰§è¡Œçš„ä¸­é—´ç»“æœè¿”å›ä½†æ˜¯ä¸ç»“æŸç¨‹åºã€‚æŠŠä¸€ä¸ªå‡½æ•°å˜æˆä¸€ä¸ªç”Ÿæˆå™¨.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(x)</span>:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i&lt;x:</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        i+=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="args-å’Œ-kwargs"><a href="#args-å’Œ-kwargs" class="headerlink" title="args å’Œ *kwargs"></a>args å’Œ *kwargs</h3><h4 id="argsï¼šé¢„å…ˆå¹¶ä¸çŸ¥é“-å‡½æ•°ä½¿ç”¨è€…ä¼šä¼ é€’å¤šå°‘ä¸ªå‚æ•°"><a href="#argsï¼šé¢„å…ˆå¹¶ä¸çŸ¥é“-å‡½æ•°ä½¿ç”¨è€…ä¼šä¼ é€’å¤šå°‘ä¸ªå‚æ•°" class="headerlink" title="argsï¼šé¢„å…ˆå¹¶ä¸çŸ¥é“, å‡½æ•°ä½¿ç”¨è€…ä¼šä¼ é€’å¤šå°‘ä¸ªå‚æ•°"></a>argsï¼šé¢„å…ˆå¹¶ä¸çŸ¥é“, å‡½æ•°ä½¿ç”¨è€…ä¼šä¼ é€’å¤šå°‘ä¸ªå‚æ•°</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_var_args</span><span class="params">(f_arg, *argv)</span>:</span></span><br><span class="line">print(<span class="string">"first normal arg:"</span>, f_arg)</span><br><span class="line"><span class="keyword">for</span> arg <span class="keyword">in</span> argv:</span><br><span class="line">    print(<span class="string">"another arg through *argv:"</span>, arg)</span><br><span class="line"></span><br><span class="line">test_var_args(<span class="string">'yasoob'</span>, <span class="string">'python'</span>, <span class="string">'eggs'</span>, <span class="string">'test'</span>)</span><br><span class="line"></span><br><span class="line">first normal arg: yasoob</span><br><span class="line">another arg through *argv: python</span><br><span class="line">another arg through *argv: eggs</span><br><span class="line">another arg through *argv: test</span><br></pre></td></tr></table></figure>
<h4 id="argsï¼šå°†ä¸å®šé•¿åº¦çš„é”®å€¼å¯¹-ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ã€‚"><a href="#argsï¼šå°†ä¸å®šé•¿åº¦çš„é”®å€¼å¯¹-ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ã€‚" class="headerlink" title="**argsï¼šå°†ä¸å®šé•¿åº¦çš„é”®å€¼å¯¹, ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ã€‚"></a>**argsï¼šå°†ä¸å®šé•¿åº¦çš„é”®å€¼å¯¹, ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ã€‚</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greet_me</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> kwargs.items():</span><br><span class="line">    print(<span class="string">"&#123;0&#125; == &#123;1&#125;"</span>.format(key, value))</span><br><span class="line"></span><br><span class="line">greet_me(name=<span class="string">"yasoob"</span>)</span><br><span class="line">name == yasoob</span><br></pre></td></tr></table></figure>
<h3 id="ç”Ÿæˆå™¨-Generators"><a href="#ç”Ÿæˆå™¨-Generators" class="headerlink" title="ç”Ÿæˆå™¨ Generators"></a>ç”Ÿæˆå™¨ Generators</h3><p>ç”Ÿæˆå™¨å¹¶ä¸æŠŠæ‰€æœ‰çš„å€¼å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆå€¼ã€‚é€šè¿‡éå†æ¥ä½¿ç”¨ï¼Œè¦ä¹ˆç”¨ä¸€ä¸ªâ€œforâ€å¾ªç¯ï¼Œè¦ä¹ˆå°†å®ƒä¼ é€’ç»™ä»»æ„å¯ä»¥è¿›è¡Œè¿­ä»£çš„å‡½æ•°å’Œç»“æ„ã€‚å¤§å¤šæ•°æ—¶å€™ç”Ÿæˆå™¨æ˜¯ä»¥å‡½æ•°æ¥å®ç°çš„ã€‚ç„¶è€Œï¼Œå®ƒä»¬å¹¶ä¸è¿”å›ä¸€ä¸ªå€¼ï¼Œè€Œæ˜¯yield(æš‚ä¸”è¯‘ä½œâ€œç”Ÿå‡ºâ€)ä¸€ä¸ªå€¼ã€‚</p>
<h4 id="å¯è¿­ä»£å¯¹è±¡-Iterable"><a href="#å¯è¿­ä»£å¯¹è±¡-Iterable" class="headerlink" title="å¯è¿­ä»£å¯¹è±¡(Iterable)"></a>å¯è¿­ä»£å¯¹è±¡(Iterable)</h4><p> Pythonä¸­ä»»æ„çš„å¯¹è±¡ï¼Œåªè¦å®ƒå®šä¹‰äº†å¯ä»¥è¿”å›ä¸€ä¸ªè¿­ä»£å™¨çš„<strong>iter</strong>æ–¹æ³•ï¼Œæˆ–è€…å®šä¹‰äº†å¯ä»¥æ”¯æŒä¸‹æ ‡ç´¢å¼•çš„<strong>getitem</strong>æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚</p>
<h4 id="è¿­ä»£å™¨-Iterator"><a href="#è¿­ä»£å™¨-Iterator" class="headerlink" title="è¿­ä»£å™¨(Iterator)"></a>è¿­ä»£å™¨(Iterator)</h4><p>ä»»æ„å¯¹è±¡ï¼Œåªè¦å®šä¹‰äº†next(Python2) æˆ–è€…<strong>next</strong>æ–¹æ³•ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚å¯¹äºpythonä¸­çš„å­—ç¬¦ä¸²å¦‚ï¼šp_s = â€˜pythonâ€™æ¥è¯´ï¼Œp_sæ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œä½†ä¸æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œä¸å¯ä»¥ä½¿ç”¨next(p_s),ä½†å¯ä»¥ä½¿ç”¨iter()å‡½æ•°ï¼Œä½¿å¾—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡å˜æˆä¸€ä¸ªè¿­ä»£å™¨ï¼šiter(p_s)</p>
<h4 id="è¿­ä»£-Iteration"><a href="#è¿­ä»£-Iteration" class="headerlink" title="è¿­ä»£(Iteration)"></a>è¿­ä»£(Iteration)</h4><p>ç”¨ä¸€ä¸ªå¾ªç¯æ¥éå†æŸä¸ªä¸œè¥¿æ—¶ï¼Œè¿™ä¸ªè¿‡ç¨‹æœ¬èº«å°±å«è¿­ä»£ã€‚</p>
   <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Python</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generator_function</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> generator_function():</span><br><span class="line">  print(item)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output: 0</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line"><span class="comment"># 7</span></span><br><span class="line"><span class="comment"># 8</span></span><br><span class="line"><span class="comment"># 9</span></span><br></pre></td></tr></table></figure>
<h3 id="è£…é¥°å™¨"><a href="#è£…é¥°å™¨" class="headerlink" title="è£…é¥°å™¨"></a>è£…é¥°å™¨</h3><p>è£…é¥°å™¨æ˜¯ï¼šæ˜¯ä¿®æ”¹å…¶ä»–å‡½æ•°çš„åŠŸèƒ½çš„å‡½æ•°</p>
<h4 id="åœ¨å‡½æ•°ä¸­å®šä¹‰å‡½æ•°"><a href="#åœ¨å‡½æ•°ä¸­å®šä¹‰å‡½æ•°" class="headerlink" title="åœ¨å‡½æ•°ä¸­å®šä¹‰å‡½æ•°"></a><strong>åœ¨å‡½æ•°ä¸­å®šä¹‰å‡½æ•°</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hi</span><span class="params">(name=<span class="string">"yasoob"</span>)</span>:</span></span><br><span class="line">     print(<span class="string">"now you are inside the hi() function"</span>)</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">greet</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"now you are in the greet() function"</span></span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">welcome</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"now you are in the welcome() function"</span></span><br><span class="line"> </span><br><span class="line"> print(greet())</span><br><span class="line"> print(welcome())</span><br><span class="line"> print(<span class="string">"now you are back in the hi() function"</span>)</span><br><span class="line"> </span><br><span class="line"> hi()</span><br><span class="line"> <span class="comment">#output:now you are inside the hi() function</span></span><br><span class="line"> <span class="comment">#       now you are in the greet() function</span></span><br><span class="line"> <span class="comment">#       now you are in the welcome() function</span></span><br><span class="line"> <span class="comment">#       now you are back in the hi() function</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># ä¸Šé¢å±•ç¤ºäº†æ— è®ºä½•æ—¶ä½ è°ƒç”¨hi(), greet()å’Œwelcome()å°†ä¼šåŒæ—¶è¢«è°ƒç”¨ã€‚</span></span><br><span class="line"> <span class="comment"># ç„¶ågreet()å’Œwelcome()å‡½æ•°åœ¨hi()å‡½æ•°ä¹‹å¤–æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œæ¯”å¦‚ï¼š</span></span><br><span class="line"> </span><br><span class="line"> greet()</span><br><span class="line"> <span class="comment">#outputs: NameError: name 'greet' is not defined</span></span><br></pre></td></tr></table></figure>
<h4 id="ä»å‡½æ•°ä¸­è¿”å›å‡½æ•°"><a href="#ä»å‡½æ•°ä¸­è¿”å›å‡½æ•°" class="headerlink" title="ä»å‡½æ•°ä¸­è¿”å›å‡½æ•°"></a><strong>ä»å‡½æ•°ä¸­è¿”å›å‡½æ•°</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hi</span><span class="params">(name=<span class="string">"yasoob"</span>)</span>:</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">greet</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"now you are in the greet() function"</span></span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">welcome</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"now you are in the welcome() function"</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">if</span> name == <span class="string">"yasoob"</span>:</span><br><span class="line">     <span class="keyword">return</span> greet</span><br><span class="line"> <span class="keyword">else</span>:</span><br><span class="line">     <span class="keyword">return</span> welcome</span><br><span class="line"> </span><br><span class="line"> a = hi()</span><br><span class="line"> print(a)</span><br><span class="line"> <span class="comment">#outputs: &lt;function greet at 0x7f2143c01500&gt;</span></span><br><span class="line"> <span class="comment">#ä¸Šé¢æ¸…æ™°åœ°å±•ç¤ºäº†`a`ç°åœ¨æŒ‡å‘åˆ°hi()å‡½æ•°ä¸­çš„greet()å‡½æ•°</span></span><br><span class="line"> <span class="comment">#ç°åœ¨è¯•è¯•è¿™ä¸ª</span></span><br><span class="line"> print(a())</span><br><span class="line"> <span class="comment">#outputs: now you are in the greet() function</span></span><br></pre></td></tr></table></figure>
<h4 id="å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°"><a href="#å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°" class="headerlink" title="å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°"></a><strong>å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hi</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">"hi yasoob!"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doSomethingBeforeHi</span><span class="params">(func)</span>:</span></span><br><span class="line">print(<span class="string">"I am doing some boring work before executing hi()"</span>)</span><br><span class="line">print(func())</span><br><span class="line">doSomethingBeforeHi(hi)</span><br><span class="line"><span class="comment">#outputs:I am doing some boring work before executing hi()</span></span><br><span class="line"><span class="comment">#        hi yasoob!</span></span><br></pre></td></tr></table></figure>
<h4 id="è£…é¥°å™¨-1"><a href="#è£…é¥°å™¨-1" class="headerlink" title="è£…é¥°å™¨"></a><strong>è£…é¥°å™¨</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_new_decorator</span><span class="params">(a_func)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapTheFunction</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"I am doing some boring work before executing a_func()"</span>)</span><br><span class="line"></span><br><span class="line">        a_func()</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"I am doing some boring work after executing a_func()"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapTheFunction</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_function_requiring_decoration</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"I am the function which needs some decoration to remove my foul smell"</span>)</span><br><span class="line"></span><br><span class="line">a_function_requiring_decoration()</span><br><span class="line"><span class="comment">#outputs: "I am the function which needs some decoration to remove my foul smell"</span></span><br><span class="line"></span><br><span class="line">a_function_requiring_decoration = a_new_decorator(a_function_requiring_decoration)</span><br><span class="line"><span class="comment">#now a_function_requiring_decoration is wrapped by wrapTheFunction()</span></span><br><span class="line"></span><br><span class="line">a_function_requiring_decoration()</span><br><span class="line"><span class="comment">#outputs:I am doing some boring work before executing a_func()</span></span><br><span class="line"><span class="comment">#        I am the function which needs some decoration to remove my foul smell</span></span><br><span class="line"><span class="comment">#        I am doing some boring work after executing a_func()</span></span><br></pre></td></tr></table></figure>
<h4 id="è¯­æ³•ç³–"><a href="#è¯­æ³•ç³–" class="headerlink" title="@è¯­æ³•ç³–"></a><strong>@è¯­æ³•ç³–</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@a_new_decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_function_requiring_decoration</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""Hey you! Decorate me!"""</span></span><br><span class="line">    print(<span class="string">"I am the function which needs some decoration to "</span></span><br><span class="line">        <span class="string">"remove my foul smell"</span>)</span><br><span class="line"></span><br><span class="line">a_function_requiring_decoration()</span><br><span class="line"><span class="comment">#outputs: I am doing some boring work before executing a_func()</span></span><br><span class="line"><span class="comment">#         I am the function which needs some decoration to remove my foul smell</span></span><br><span class="line"><span class="comment">#         I am doing some boring work after executing a_func()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#the @a_new_decorator is just a short way of saying:</span></span><br><span class="line">a_function_requiring_decoration = a_new_decorator(a_function_requiring_decoration)</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>functools.wraps</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(a_function_requiring_decoration.__name__)</span><br><span class="line"><span class="comment"># Output: wrapTheFunction</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æœŸå¾…çš„è¾“å‡ºåº”è¯¥æ˜¯â€œa_function_requiring_decorationâ€ï¼Œè¿™é‡Œçš„å‡½æ•°è¢«warpTheFunctionæ›¿ä»£äº†ã€‚Pythonæä¾›ä¸€ä¸ªç®€å•çš„å‡½æ•°æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šfunctools.wrapã€‚</p>
<p>@wrapsæ¥å—ä¸€ä¸ªå‡½æ•°æ¥è¿›è¡Œè£…é¥°ï¼Œå¹¶åŠ å…¥äº†å¤åˆ¶å‡½æ•°åç§°ã€æ³¨é‡Šæ–‡æ¡£ã€å‚æ•°åˆ—è¡¨ç­‰ç­‰çš„åŠŸèƒ½ã€‚è¿™å¯ä»¥è®©æˆ‘ä»¬åœ¨è£…é¥°å™¨é‡Œé¢è®¿é—®åœ¨è£…é¥°ä¹‹å‰çš„å‡½æ•°çš„å±æ€§ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_new_decorator</span><span class="params">(a_func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(a_func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapTheFunction</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"I am doing some boring work before executing a_func()"</span>)</span><br><span class="line">        a_func()</span><br><span class="line">        print(<span class="string">"I am doing some boring work after executing a_func()"</span>)</span><br><span class="line">    <span class="keyword">return</span> wrapTheFunction</span><br><span class="line"></span><br><span class="line"><span class="meta">@a_new_decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_function_requiring_decoration</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""Hey yo! Decorate me!"""</span></span><br><span class="line">    print(<span class="string">"I am the function which needs some decoration to "</span></span><br><span class="line">        <span class="string">"remove my foul smell"</span>)</span><br><span class="line"></span><br><span class="line">print(a_function_requiring_decoration.__name__)</span><br><span class="line"><span class="comment"># Output: a_function_requiring_decoration</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="åº”ç”¨1-æ—¥å¿—"><a href="#åº”ç”¨1-æ—¥å¿—" class="headerlink" title="åº”ç”¨1:æ—¥å¿—"></a>åº”ç”¨1:æ—¥å¿—</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">logit</span><span class="params">(logfile=<span class="string">'out.log'</span>)</span>:</span></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">logging_decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">         @wraps(func)</span></span><br><span class="line">         <span class="function"><span class="keyword">def</span> <span class="title">wrapped_function</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">             log_string = func.__name__ + <span class="string">" was called"</span></span><br><span class="line">             print(log_string)</span><br><span class="line">             <span class="comment"># æ‰“å¼€logfileï¼Œå¹¶å†™å…¥å†…å®¹</span></span><br><span class="line">             <span class="keyword">with</span> open(logfile, <span class="string">'a'</span>) <span class="keyword">as</span> opened_file:</span><br><span class="line">                 <span class="comment"># ç°åœ¨å°†æ—¥å¿—æ‰“åˆ°æŒ‡å®šçš„logfile</span></span><br><span class="line">                 opened_file.write(log_string + <span class="string">'\n'</span>)</span><br><span class="line">             <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">         <span class="keyword">return</span> wrapped_function</span><br><span class="line">     <span class="keyword">return</span> logging_decorator</span><br><span class="line"> </span><br><span class="line"><span class="meta"> @logit()</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">myfunc1</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"> myfunc1()</span><br><span class="line"> <span class="comment"># Output: myfunc1 was called</span></span><br><span class="line"> <span class="comment"># ç°åœ¨ä¸€ä¸ªå«åš out.log çš„æ–‡ä»¶å‡ºç°äº†ï¼Œé‡Œé¢çš„å†…å®¹å°±æ˜¯ä¸Šé¢çš„å­—ç¬¦ä¸²</span></span><br><span class="line"> </span><br><span class="line"><span class="meta"> @logit(logfile='func2.log')</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">myfunc2</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"> myfunc2()</span><br><span class="line"> <span class="comment"># Output: myfunc2 was called</span></span><br><span class="line"> <span class="comment"># ç°åœ¨ä¸€ä¸ªå«åš func2.log çš„æ–‡ä»¶å‡ºç°äº†ï¼Œé‡Œé¢çš„å†…å®¹å°±æ˜¯ä¸Šé¢çš„å­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure>
<h5 id="åº”ç”¨2ï¼šè®¡ç®—å‡½æ•°è¿è¡Œæ—¶é—´"><a href="#åº”ç”¨2ï¼šè®¡ç®—å‡½æ•°è¿è¡Œæ—¶é—´" class="headerlink" title="åº”ç”¨2ï¼šè®¡ç®—å‡½æ•°è¿è¡Œæ—¶é—´"></a>åº”ç”¨2ï¼šè®¡ç®—å‡½æ•°è¿è¡Œæ—¶é—´</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timethis</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="string">"""Decorator that reports the execution time."""</span></span><br><span class="line"><span class="meta">@wraps(func)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    result = func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        print(func.__name__, end - start, <span class="string">'s'</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    eturn wrapper</span><br></pre></td></tr></table></figure>
<h4 id="è£…é¥°å™¨ç±»"><a href="#è£…é¥°å™¨ç±»" class="headerlink" title="è£…é¥°å™¨ç±»"></a>è£…é¥°å™¨ç±»</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">logit</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, logfile=<span class="string">'out.log'</span>)</span>:</span></span><br><span class="line">        self.logfile = logfile</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, func)</span>:</span></span><br><span class="line"><span class="meta">        @wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapped_function</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            log_string = func.__name__ + <span class="string">" was called"</span></span><br><span class="line">            print(log_string)</span><br><span class="line">            <span class="comment"># æ‰“å¼€logfileå¹¶å†™å…¥</span></span><br><span class="line">            <span class="keyword">with</span> open(self.logfile, <span class="string">'a'</span>) <span class="keyword">as</span> opened_file:</span><br><span class="line">                <span class="comment"># ç°åœ¨å°†æ—¥å¿—æ‰“åˆ°æŒ‡å®šçš„æ–‡ä»¶</span></span><br><span class="line">                opened_file.write(log_string + <span class="string">'\n'</span>)</span><br><span class="line">            <span class="comment"># ç°åœ¨ï¼Œå‘é€ä¸€ä¸ªé€šçŸ¥</span></span><br><span class="line">            self.notify()</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> wrapped_function</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">notify</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># logitåªæ‰“æ—¥å¿—ï¼Œä¸åšåˆ«çš„</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="å¯¹è±¡è‡ªçœ"><a href="#å¯¹è±¡è‡ªçœ" class="headerlink" title="å¯¹è±¡è‡ªçœ"></a>å¯¹è±¡è‡ªçœ</h3><h4 id="dir"><a href="#dir" class="headerlink" title="dir"></a>dir</h4><p>ç”¨äºè‡ªçœçš„æœ€é‡è¦çš„å‡½æ•°ä¹‹ä¸€ã€‚å®ƒè¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—å‡ºäº†ä¸€ä¸ªå¯¹è±¡æ‰€æ‹¥æœ‰çš„å±æ€§å’Œæ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">my_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">dir(my_list)</span><br><span class="line"><span class="comment"># Output: ['__add__', '__class__', '__contains__', '__delattr__', '__delitem__',</span></span><br><span class="line"><span class="comment"># '__delslice__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__',</span></span><br><span class="line"><span class="comment"># '__getitem__', '__getslice__', '__gt__', '__hash__', '__iadd__', '__imul__',</span></span><br><span class="line"><span class="comment"># '__init__', '__iter__', '__le__', '__len__', '__lt__', '__mul__', '__ne__',</span></span><br><span class="line"><span class="comment"># '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__reversed__', '__rmul__',</span></span><br><span class="line"><span class="comment"># '__setattr__', '__setitem__', '__setslice__', '__sizeof__', '__str__',</span></span><br><span class="line"><span class="comment"># '__subclasshook__', 'append', 'count', 'extend', 'index', 'insert', 'pop',</span></span><br><span class="line"><span class="comment"># 'remove', 'reverse', 'sort']</span></span><br></pre></td></tr></table></figure>
<h4 id="type-å’Œ-id"><a href="#type-å’Œ-id" class="headerlink" title="type  å’Œ id"></a>type  å’Œ id</h4><h4 id="inspect"><a href="#inspect" class="headerlink" title="inspect"></a>inspect</h4><p>inspectæ¨¡å—å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜</p>
<h3 id="æ¨å¯¼å¼"><a href="#æ¨å¯¼å¼" class="headerlink" title="æ¨å¯¼å¼"></a>æ¨å¯¼å¼</h3><h4 id="åˆ—è¡¨æ¨å¯¼å¼"><a href="#åˆ—è¡¨æ¨å¯¼å¼" class="headerlink" title="åˆ—è¡¨æ¨å¯¼å¼"></a>åˆ—è¡¨æ¨å¯¼å¼</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">variable = [out_exp <span class="keyword">for</span> out_exp <span class="keyword">in</span> input_list <span class="keyword">if</span> out_exp == <span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<h4 id="å­—å…¸æ¨å¯¼å¼"><a href="#å­—å…¸æ¨å¯¼å¼" class="headerlink" title="å­—å…¸æ¨å¯¼å¼"></a>å­—å…¸æ¨å¯¼å¼</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;v: k <span class="keyword">for</span> k, v <span class="keyword">in</span> some_dict.items()&#125;</span><br></pre></td></tr></table></figure>
<h3 id="For-else"><a href="#For-else" class="headerlink" title="For - else"></a>For - else</h3><p>   forå¾ªç¯è¿˜æœ‰ä¸€ä¸ªelseä»å¥,è¿™ä¸ªelseä»å¥ä¼šåœ¨å¾ªç¯æ­£å¸¸ç»“æŸæ—¶æ‰§è¡Œã€‚</p>
   <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">10</span>):</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">2</span>, n):</span><br><span class="line">    <span class="keyword">if</span> n % x == <span class="number">0</span>:</span><br><span class="line">        print(n, <span class="string">'equals'</span>, x, <span class="string">'*'</span>, n / x)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># loop fell through without finding a factor</span></span><br><span class="line">    print(n, <span class="string">'is a prime number'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="å‡½æ•°ç¼“å­˜"><a href="#å‡½æ•°ç¼“å­˜" class="headerlink" title="å‡½æ•°ç¼“å­˜"></a>å‡½æ•°ç¼“å­˜</h3><p>å‡½æ•°ç¼“å­˜å…è®¸æˆ‘ä»¬å°†ä¸€ä¸ªå‡½æ•°å¯¹äºç»™å®šå‚æ•°çš„è¿”å›å€¼ç¼“å­˜èµ·æ¥ã€‚å½“ä¸€ä¸ªI/Oå¯†é›†çš„å‡½æ•°è¢«é¢‘ç¹ä½¿ç”¨ç›¸åŒçš„å‚æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œå‡½æ•°ç¼“å­˜å¯ä»¥èŠ‚çº¦æ—¶é—´ã€‚</p>
<p>Python3.2+</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="meta">@lru_cache(maxsize=32)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print([fib(n) <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">10</span>)])</span><br><span class="line"><span class="comment"># Output: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹è¿”å›å€¼æ¸…ç©ºç¼“å­˜</span></span><br><span class="line">fib.cache_clear()</span><br></pre></td></tr></table></figure>
<p>python2</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">memoize</span><span class="params">(function)</span>:</span></span><br><span class="line">    memo = &#123;&#125;</span><br><span class="line"><span class="meta">    @wraps(function)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> args <span class="keyword">in</span> memo:</span><br><span class="line">            <span class="keyword">return</span> memo[args]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rv = function(*args)</span><br><span class="line">            memo[args] = rv</span><br><span class="line">            <span class="keyword">return</span> rv</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@memoize</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>: <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> fibonacci(n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">fibonacci(<span class="number">25</span>)</span><br></pre></td></tr></table></figure>
<h3 id="With-ä¸Šä¸‹æ–‡ç®¡ç†å™¨"><a href="#With-ä¸Šä¸‹æ–‡ç®¡ç†å™¨" class="headerlink" title="With ä¸Šä¸‹æ–‡ç®¡ç†å™¨"></a>With ä¸Šä¸‹æ–‡ç®¡ç†å™¨</h3><p>å¯ä»¥ç”¨æ¥ç®¡ç†æ•°æ®åº“è¿æ¥å…³é—­ï¼Œæ–‡ä»¶æ‰“å¼€å…³é—­ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„ç±»ï¼Œèµ·ç è¦å®šä¹‰<strong>enter</strong>å’Œ<strong>exit</strong>æ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, file_name, method)</span>:</span></span><br><span class="line">        self.file_obj = open(file_name, method)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.file_obj</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼ŒPythonä¼šå°†å¼‚å¸¸çš„type,valueå’Œtracebackä¼ é€’ç»™__exit__æ–¹æ³•ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, type, value, traceback)</span>:</span></span><br><span class="line">        print(<span class="string">"Exception has been handled"</span>)</span><br><span class="line">        self.file_obj.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> File(<span class="string">'demo.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> opened_file:</span><br><span class="line">    opened_file.undefined_function()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output: Exception has been handled</span></span><br></pre></td></tr></table></figure>
<h3 id="Collections"><a href="#Collections" class="headerlink" title="Collections"></a>Collections</h3><h4 id="Defaultdict"><a href="#Defaultdict" class="headerlink" title="Defaultdict"></a>Defaultdict</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">dict_list = defaultdict(list)</span><br><span class="line">dict_int = defaultdict(int) <span class="comment">#0</span></span><br></pre></td></tr></table></figure>
<h4 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h4><p>Counteræ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå®ƒå¯ä»¥é’ˆå¯¹æŸé¡¹æ•°æ®è¿›è¡Œè®¡æ•°ã€‚</p>
<h4 id="Deque"><a href="#Deque" class="headerlink" title="Deque"></a>Deque</h4><p>dequeæä¾›äº†ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œå¯ä»¥ä»å¤´/å°¾ä¸¤ç«¯æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d = deque(range(<span class="number">5</span>))</span><br><span class="line">print(len(d))</span><br><span class="line"><span class="comment">## è¾“å‡º: 5</span></span><br><span class="line">d.popleft()</span><br><span class="line"><span class="comment">## è¾“å‡º: 0</span></span><br><span class="line">d.pop()</span><br><span class="line"><span class="comment">## è¾“å‡º: 4</span></span><br><span class="line">print(d)</span><br><span class="line"><span class="comment">## è¾“å‡º: deque([1, 2, 3])</span></span><br></pre></td></tr></table></figure>
<h4 id="Namedtuple"><a href="#Namedtuple" class="headerlink" title="Namedtuple"></a>Namedtuple</h4><p>å¯ä»¥åƒå­—å…¸(dict)ä¸€æ ·è®¿é—®namedtuplesï¼Œä½†namedtuplesæ˜¯ä¸å¯å˜çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">Animal = namedtuple(<span class="string">'Animal'</span>, <span class="string">'name age type'</span>)</span><br><span class="line">perry = Animal(name=<span class="string">"perry"</span>, age=<span class="number">31</span>, type=<span class="string">"cat"</span>)</span><br><span class="line"></span><br><span class="line">print(perry)</span><br><span class="line"><span class="comment">## è¾“å‡º: Animal(name='perry', age=31, type='cat')</span></span><br><span class="line"></span><br><span class="line">print(perry.name)</span><br><span class="line"><span class="comment">## è¾“å‡º: 'perry'</span></span><br></pre></td></tr></table></figure>
<h4 id="enum-Enum"><a href="#enum-Enum" class="headerlink" title="enum.Enum"></a>enum.Enum</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Species</span><span class="params">(Enum)</span>:</span></span><br><span class="line">    cat = <span class="number">1</span></span><br><span class="line">    dog = <span class="number">2</span></span><br><span class="line">    horse = <span class="number">3</span></span><br><span class="line">    aardvark = <span class="number">4</span></span><br><span class="line">    butterfly = <span class="number">5</span></span><br><span class="line">    owl = <span class="number">6</span></span><br><span class="line">    platypus = <span class="number">7</span></span><br><span class="line">    dragon = <span class="number">8</span></span><br><span class="line">    unicorn = <span class="number">9</span></span><br><span class="line">    <span class="comment"># ä¾æ¬¡ç±»æ¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½†æˆ‘ä»¬å¹¶ä¸æƒ³å…³å¿ƒåŒä¸€ç‰©ç§çš„å¹´é¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåˆ«å</span></span><br><span class="line">    kitten = <span class="number">1</span>  <span class="comment"># (è¯‘è€…æ³¨ï¼šå¹¼å°çš„çŒ«å’ª)</span></span><br><span class="line">    puppy = <span class="number">2</span>   <span class="comment"># (è¯‘è€…æ³¨ï¼šå¹¼å°çš„ç‹—ç‹—)</span></span><br><span class="line"></span><br><span class="line">Animal = namedtuple(<span class="string">'Animal'</span>, <span class="string">'name age type'</span>)</span><br><span class="line">perry = Animal(name=<span class="string">"Perry"</span>, age=<span class="number">31</span>, type=Species.cat)</span><br><span class="line">drogon = Animal(name=<span class="string">"Drogon"</span>, age=<span class="number">4</span>, type=Species.dragon)</span><br><span class="line">tom = Animal(name=<span class="string">"Tom"</span>, age=<span class="number">75</span>, type=Species.cat)</span><br><span class="line">charlie = Animal(name=<span class="string">"Charlie"</span>, age=<span class="number">2</span>, type=Species.kitten)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>charlie.type == tom.type</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>charlie.type</span><br><span class="line">&lt;Species.cat: <span class="number">1</span>&gt;</span><br></pre></td></tr></table></figure>
<h3 id="itertools"><a href="#itertools" class="headerlink" title="itertools"></a>itertools</h3><p>itertoolsæä¾›çš„å·¥å…·ç›¸å½“é«˜æ•ˆä¸”èŠ‚çœå†…å­˜ã€‚ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œä½ å°†èƒ½å¤Ÿåˆ›å»ºè‡ªå·±å®šåˆ¶çš„è¿­ä»£å™¨ç”¨äºé«˜æ•ˆç‡çš„å¾ªç¯ã€‚itertoolsä¸»è¦æ¥åˆ†ä¸ºä¸‰ç±»å‡½æ•°ï¼Œåˆ†åˆ«ä¸ºæ— é™è¿­ä»£å™¨ã€è¾“å…¥åºåˆ—è¿­ä»£å™¨ã€ç»„åˆç”Ÿæˆå™¨</p>
<h4 id="æ— é™è¿­ä»£å™¨"><a href="#æ— é™è¿­ä»£å™¨" class="headerlink" title="æ— é™è¿­ä»£å™¨"></a>æ— é™è¿­ä»£å™¨</h4><h5 id="Itertools-count-start-0-step-1"><a href="#Itertools-count-start-0-step-1" class="headerlink" title="Itertools.count(start=0, step=1)"></a><strong>Itertools.count(start=0, step=1)</strong></h5><p>åˆ›å»ºä¸€ä¸ªè¿­ä»£å¯¹è±¡ï¼Œç”Ÿæˆä»startå¼€å§‹çš„è¿ç»­æ•´æ•°ï¼Œæ­¥é•¿ä¸ºstepã€‚å¦‚æœçœç•¥äº†startåˆ™é»˜è®¤ä»0å¼€å§‹ï¼Œæ­¥é•¿é»˜è®¤ä¸º1ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.count():</span><br><span class="line">  <span class="keyword">print</span> i</span><br></pre></td></tr></table></figure>
<h5 id="Itertools-cycle-iterable"><a href="#Itertools-cycle-iterable" class="headerlink" title="Itertools.cycle(iterable)"></a><strong>Itertools.cycle(iterable)</strong></h5><p>åˆ›å»ºä¸€ä¸ªè¿­ä»£å¯¹è±¡ï¼Œå¯¹äºè¾“å…¥çš„iterableçš„å…ƒç´ åå¤æ‰§è¡Œå¾ªç¯æ“ä½œï¼Œå†…éƒ¨ç”Ÿæˆiterableä¸­çš„å…ƒç´ çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œè¿™ä¸ªå‰¯æœ¬ç”¨æ¥è¿”å›å¾ªç¯ä¸­çš„é‡å¤é¡¹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> itertools.cycle([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]):</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">print</span> (i, item)</span><br></pre></td></tr></table></figure>
<h5 id="Itertools-repeat-object-times"><a href="#Itertools-repeat-object-times" class="headerlink" title="Itertools.repeat(object[, times])"></a><strong>Itertools.repeat(object[, times])</strong></h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.repeat(<span class="string">'kivinsae'</span>, <span class="number">5</span>):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br></pre></td></tr></table></figure>
<h4 id="è¾“å…¥åºåˆ—è¿­ä»£å™¨"><a href="#è¾“å…¥åºåˆ—è¿­ä»£å™¨" class="headerlink" title="è¾“å…¥åºåˆ—è¿­ä»£å™¨"></a>è¾“å…¥åºåˆ—è¿­ä»£å™¨</h4><h5 id="itertools-accumulate-iterables"><a href="#itertools-accumulate-iterables" class="headerlink" title="itertools.accumulate(*iterables)"></a>itertools.accumulate(*iterables)</h5><p>è¿™ä¸ªå‡½æ•°ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªç´¯åŠ å™¨ï¼Œä¸åœå¯¹åˆ—è¡¨æˆ–è€…è¿­ä»£å™¨è¿›è¡Œç´¯åŠ æ“ä½œï¼ˆè¿™é‡ŒæŒ‡æ¯é¡¹ç´¯åŠ ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = itertools.accumulate(range(<span class="number">10</span>))</span><br><span class="line">print(list(x))</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># [0, 1, 3, 6, 10, 15, 21, 28, 36, 45]</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-chain-iterables"><a href="#itertools-chain-iterables" class="headerlink" title="itertools.chain(*iterables)"></a><strong>itertools.chain(*iterables)</strong></h5><p>æŠŠå¤šä¸ªè¿­ä»£å™¨ä½œä¸ºå‚æ•°ï¼Œä½†æ˜¯åªä¼šè¿”å›å•ä¸ªè¿­ä»£å™¨ã€‚äº§ç”Ÿæ‰€æœ‰å‚æ•°è¿­ä»£å™¨çš„å†…å®¹ï¼Œå´å¥½ä¼¼æ¥è‡ªäºä¸€ä¸ªå•ä¸€çš„åºåˆ—ã€‚ç®€å•äº†è®²å°±æ˜¯è¿æ¥å¤šä¸ª åˆ—è¡¨ æˆ–è€… è¿­ä»£å™¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.chain([<span class="string">'p'</span>,<span class="string">'x'</span>,<span class="string">'e'</span>], [<span class="string">'scp'</span>, <span class="string">'nmb'</span>, <span class="string">'balenciaga'</span>]):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># p</span></span><br><span class="line"><span class="comment"># x</span></span><br><span class="line"><span class="comment"># e</span></span><br><span class="line"><span class="comment"># scp</span></span><br><span class="line"><span class="comment"># nmb</span></span><br><span class="line"><span class="comment"># balenciaga</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-compress-data-selectors"><a href="#itertools-compress-data-selectors" class="headerlink" title="itertools.compress(data,selectors)"></a><strong>itertools.compress(data,selectors)</strong></h5><p>compressæä¾›äº†ä¸€ä¸ªå¯¹äºåŸå§‹æ•°æ®çš„ç­›é€‰åŠŸèƒ½ï¼Œå…·ä½“æ¡ä»¶å¯ä»¥è®¾ç½®çš„éå¸¸å¤æ‚ï¼Œä¸‹é¢åˆ—å‡ºç›¸å…³çš„å®šä¹‰ä»£ç æ¥è§£é‡Šã€‚ç®€å•æ¥ç†è§£ï¼Œå°±æ˜¯æŒ‰ç…§çœŸå€¼è¡¨è¿›è¡Œå…ƒç´ ç­›é€‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  ä¾‹ï¼š</span></span><br><span class="line">list(itertools.compress(<span class="string">'ABCDEF'</span>, [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]))</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># ['A', 'B', 'D', 'F']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…·ä½“å®ç°ï¼š</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress</span><span class="params">(data, selectors)</span>:</span></span><br><span class="line">    <span class="comment"># compress('ABCDEF', [1,0,1,0,1,1]) --&gt; A C E F</span></span><br><span class="line">    <span class="keyword">return</span> (d <span class="keyword">for</span> d, s <span class="keyword">in</span> izip(data, selectors) <span class="keyword">if</span> s)</span><br></pre></td></tr></table></figure>
<h5 id="itertools-dropwhile-predicate-iterable"><a href="#itertools-dropwhile-predicate-iterable" class="headerlink" title="itertools.dropwhile(predicate,iterable)"></a><strong>itertools.dropwhile(predicate,iterable)</strong></h5><p>dropwhileä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œåªè¦æ˜¯å‡½æ•°predicate(item)ä¸ºTrueï¼Œåˆ™ä¸¢æ‰iterableä¸­çš„é¡¹ï¼Œä½†æ˜¯å¦‚æœpredicateè¿”å›çš„æ˜¯Falseï¼Œåˆ™ç”Ÿæˆiterableä¸­çš„é¡¹å’Œæ‰€æœ‰çš„åç»­é¡¹ã€‚<br>å…·ä½“æ¥è¯´å°±æ˜¯ï¼Œåœ¨æ¡ä»¶ä¸ºFalseä¹‹åçš„ç¬¬ä¸€æ¬¡ï¼Œå°±è¿”å›è¿­ä»£å™¨ä¸­å‰©ä½™çš„æ‰€æœ‰é¡¹ã€‚åœ¨è¿™ä¸ªå‡½æ•°è¡¨è¾¾å¼é‡Œé¢iterableçš„å€¼ä¼šæŒ‰ç´¢å¼•ä¸€ä¸ªä¸ªä½œä¸ºpredicateçš„å‚æ•°è¿›è¡Œè®¡ç®—ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŒ‰ç…§çœŸå€¼å‡½æ•°ä¸¢å¼ƒæ‰åˆ—è¡¨å’Œè¿­ä»£å™¨å‰é¢çš„å…ƒç´ ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">should_drop</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="keyword">return</span> (x &lt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.dropwhile(should_drop, [<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">-2</span>]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># Testing: -1</span></span><br><span class="line"><span class="comment"># Testing: 0</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Yielding: 2</span></span><br><span class="line"><span class="comment"># Yielding: 3</span></span><br><span class="line"><span class="comment"># Yielding: 4</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Yielding: -2</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-groupby-iterable-key"><a href="#itertools-groupby-iterable-key" class="headerlink" title="itertools.groupby(iterable[,key])"></a><strong>itertools.groupby(iterable[,key])</strong></h5><p>è¿”å›ä¸€ä¸ªé›†åˆçš„è¿­ä»£å™¨ï¼Œé›†åˆå†…æ˜¯æŒ‰ç…§keyè¿›è¡Œåˆ†ç»„åçš„å€¼ã€‚<br>å¦‚æœiterableåœ¨å¤šæ¬¡è¿ç»­çš„è¿­ä»£ä¸­ç”Ÿæˆäº†åŒä¸€é¡¹ï¼Œåˆ™ä¼šå®šä¹‰ä¸€ä¸ªç»„ï¼Œå¦‚æœå¯¹è¿™ä¸ªå‡½æ•°åº”ç”¨ä¸€ä¸ªåˆ†ç±»åˆ—è¡¨ï¼Œé‚£ä¹ˆåˆ†ç»„ä¼šå®šä¹‰è¿™ä¸ªåˆ—è¡¨ä¸­æ‰€æœ‰çš„å”¯ä¸€é¡¹ï¼Œkeyæ˜¯ä¸€ä¸ªå‡½æ•°å¹¶åº”ç”¨äºæ¯ä¸€é¡¹ã€‚å¦‚æœè¿™ä¸ªå‡½æ•°æœ‰è¿”å›å€¼ï¼Œåˆ™è¿™ä¸ªå€¼ä¼šç”¨äºåç»­çš„é¡¹ï¼Œè€Œä¸æ˜¯å’Œè¯¥é¡¹æœ¬èº«è¿›è¡Œæ¯”è¾ƒã€‚è¿™ä¸ªå‡½æ•°è¿”å›çš„è¿­ä»£å™¨ç”Ÿæˆå…ƒç´ (key,group)ï¼Œkeyæ˜¯åˆ†ç»„çš„é”®å€¼ï¼Œgroupæ˜¯è¿­ä»£å™¨ï¼Œä»è€Œç”Ÿæˆç»„æˆè¿™ä¸ªç»„çš„æ‰€æœ‰é¡¹ç›®ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="string">'aa'</span>, <span class="string">'ab'</span>, <span class="string">'abc'</span>, <span class="string">'bcd'</span>, <span class="string">'abcde'</span>]</span><br><span class="line"><span class="keyword">for</span> i, k <span class="keyword">in</span> itertools.groupby(a, len):</span><br><span class="line">    <span class="keyword">print</span> i, list(k)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># 2 ['aa', 'ab']</span></span><br><span class="line"><span class="comment"># 3 ['abc', 'bcd']</span></span><br><span class="line"><span class="comment"># 5 ['abcde']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…·ä½“å®ç°</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">groupby</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="comment"># [k for k, g in groupby('AAAABBBCCDAABBB')] --&gt; A B C D A B</span></span><br><span class="line">        <span class="comment"># [list(g) for k, g in groupby('AAAABBBCCD')] --&gt; AAAA BBB CC D</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, iterable, key=None)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> key <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                key = <span class="keyword">lambda</span> x: x</span><br><span class="line">            self.keyfunc = key</span><br><span class="line">            self.it = iter(iterable)</span><br><span class="line">            self.tgtkey = self.currkey = self.currvalue = object()</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">next</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">while</span> self.currkey == self.tgtkey:</span><br><span class="line">                self.currvalue = next(self.it)    <span class="comment"># Exit on StopIteration</span></span><br><span class="line">                self.currkey = self.keyfunc(self.currvalue)</span><br><span class="line">            self.tgtkey = self.currkey</span><br><span class="line">            <span class="keyword">return</span> (self.currkey, self._grouper(self.tgtkey))</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">_grouper</span><span class="params">(self, tgtkey)</span>:</span></span><br><span class="line">            <span class="keyword">while</span> self.currkey == tgtkey:</span><br><span class="line">                <span class="keyword">yield</span> self.currvalue</span><br><span class="line">                self.currvalue = next(self.it)    <span class="comment"># Exit on StopIteration</span></span><br><span class="line">                self.currkey = self.keyfunc(self.currvalue)</span><br></pre></td></tr></table></figure>
<h5 id="itertools-ifilter-predicate-iterable"><a href="#itertools-ifilter-predicate-iterable" class="headerlink" title="itertools.ifilter(predicate,iterable)"></a><strong>itertools.ifilter(predicate,iterable)</strong></h5><p>å‡½æ•°è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œç±»ä¼¼äºé’ˆå¯¹äºåˆ—è¡¨çš„å‡½æ•°filter()ï¼Œä½†æ˜¯åªåŒ…æ‹¬æµ‹è¯•å‡½æ•°è¿”å›Trueæ—¶å€™çš„å€¼ã€‚å’Œdropwhile()ä½œç”¨ä¸åŒã€‚<br>å‡½æ•°åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œåªç”Ÿæˆpredicate(iterable)ä¸ºTrueçš„é¡¹ï¼Œç®€å•æ¥è¯´å°±æ˜¯è¿”å›iterableä¸­æ‰€æœ‰è®¡ç®—åä¸ºTrueçš„é¡¹ã€‚å¦‚æœæ˜¯éTrueåˆ™è¿›è¡Œä¹‹åçš„å…¶ä»–æ“ä½œã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_item</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="keyword">return</span> (x&lt;<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.ifilter(check_item, [ <span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">-2</span> ]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># Testing: -1</span></span><br><span class="line"><span class="comment"># Yielding: -1</span></span><br><span class="line"><span class="comment"># Testing: 0</span></span><br><span class="line"><span class="comment"># Yielding: 0</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Testing: 2</span></span><br><span class="line"><span class="comment"># Testing: 3</span></span><br><span class="line"><span class="comment"># Testing: 4</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Testing: -2</span></span><br><span class="line"><span class="comment"># Yielding: -2</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-ifilterfalse-predicate-iterable"><a href="#itertools-ifilterfalse-predicate-iterable" class="headerlink" title="itertools.ifilterfalse(predicate,iterable)"></a><strong>itertools.ifilterfalse(predicate,iterable)</strong></h5><p>æœ¬å‡½æ•°å’Œä¸Šé¢çš„ifilterä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯åªæœ‰å½“predicate(iterable)ä¸ºFalseæ—¶å€™æ‰è¿›è¡Œpredicateçš„è¾“å‡ºã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_item</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="keyword">return</span> (x &lt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.ifilterfalse(check_item, [<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">-2</span>]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># Testing: -1</span></span><br><span class="line"><span class="comment"># Testing: 0</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Testing: 2</span></span><br><span class="line"><span class="comment"># Yielding: 2</span></span><br><span class="line"><span class="comment"># Testing: 3</span></span><br><span class="line"><span class="comment"># Yielding: 3</span></span><br><span class="line"><span class="comment"># Testing: 4</span></span><br><span class="line"><span class="comment"># Yielding: 4</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Testing: -2</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-islice-iterable-stop"><a href="#itertools-islice-iterable-stop" class="headerlink" title="itertools.islice(iterable,stop)"></a><strong>itertools.islice(iterable,stop)</strong></h5><p>ç®€å•æ¥è¯´è¿™ä¸ªå‡½æ•°ï¼Œå°±æ˜¯å¯¹äºä¸€ä¸ªè¿­ä»£å¯¹è±¡iterableï¼Œè®¾å®šä¸€ä¸ªç‰¹å®šçš„åˆ‡ç‰‡/é€‰å–/æˆªå–è§„åˆ™ï¼Œç„¶åæœ€åè¾“å‡ºä¸€ä¸ªç‰¹å®šçš„æ–°çš„è¿­ä»£å¯¹è±¡çš„è¿‡ç¨‹ã€‚è¿™ä¸ªstopå®é™…ä¸Šä»£è¡¨ä¸€ä¸ªä¸‰å…ƒæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯startï¼Œstopï¼Œstepã€‚å¦‚æœstartçœç•¥ï¼Œé»˜è®¤ä»ç´¢å¼•0å¼€å§‹ï¼›å¦‚æœstepè¢«çœç•¥ï¼Œåˆ™é»˜è®¤æ­¥é•¿ä¸º1ï¼›stopä¸èƒ½è¢«çœç•¥ã€‚æœ¬è´¨å°±æ˜¯ä¸€ä¸ªåˆ‡ç‰‡å·¥å…·ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Stop at 5:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.islice(itertools.count(), <span class="number">5</span>):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Start at 5, Stop at 10:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.islice(itertools.count(), <span class="number">5</span>, <span class="number">10</span>):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="keyword">print</span> <span class="string">'By tens to 100:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.islice(itertools.count(), <span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># Stop</span></span><br><span class="line"><span class="comment"># at</span></span><br><span class="line"><span class="comment"># 5:</span></span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># Start</span></span><br><span class="line"><span class="comment"># at</span></span><br><span class="line"><span class="comment"># 5, Stop</span></span><br><span class="line"><span class="comment"># at</span></span><br><span class="line"><span class="comment"># 10:</span></span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line"><span class="comment"># 7</span></span><br><span class="line"><span class="comment"># 8</span></span><br><span class="line"><span class="comment"># 9</span></span><br><span class="line"><span class="comment"># By</span></span><br><span class="line"><span class="comment"># tens</span></span><br><span class="line"><span class="comment"># to</span></span><br><span class="line"><span class="comment"># 100:</span></span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"><span class="comment"># 20</span></span><br><span class="line"><span class="comment"># 30</span></span><br><span class="line"><span class="comment"># 40</span></span><br><span class="line"><span class="comment"># 50</span></span><br><span class="line"><span class="comment"># 60</span></span><br><span class="line"><span class="comment"># 70</span></span><br><span class="line"><span class="comment"># 80</span></span><br><span class="line"><span class="comment"># 90</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-imap-function-iterable"><a href="#itertools-imap-function-iterable" class="headerlink" title="itertools.imap(function,*iterable)"></a><strong>itertools.imap(function,*iterable)</strong></h5><p>æœ¬å‡½æ•°åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œä½œç”¨å‡½æ•°ä¸ºfunction1ï¼Œfunction2ï¼Œfunction3â€¦ï¼Œå¯¹åº”çš„å˜é‡æ¥è‡ªè¿­ä»£å™¨iterable1ï¼Œiterable2ï¼Œiterable3â€¦ã€‚ç„¶åè¿”å›ä¸€ä¸ª(f1,f2,f3â€¦)å½¢å¼çš„å…ƒç»„ã€‚åªè¦å…¶ä¸­ä¸€ä¸ªè¿­ä»£å™¨ä¸å†ç”Ÿæˆå€¼ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šåœæ­¢ã€‚æ‰€ä»¥è¦å¤„ç†å¥½Noneçš„æƒ…å†µï¼Œç”¨ä¸€ä¸‹æ›¿ä»£è¾“å‡ºä¹‹ç±»çš„æ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="string">'Doubles:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.imap(<span class="keyword">lambda</span> x:<span class="number">2</span>*x, xrange(<span class="number">5</span>)):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Multiples:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.imap(<span class="keyword">lambda</span> x,y:(x, y, x*y), xrange(<span class="number">5</span>), xrange(<span class="number">5</span>,<span class="number">10</span>)):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'%d * %d = %d'</span> % i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># Doubles:</span></span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line"><span class="comment"># 8</span></span><br><span class="line"><span class="comment"># Multiples:</span></span><br><span class="line"><span class="comment"># 0 * 5 = 0</span></span><br><span class="line"><span class="comment"># 1 * 6 = 6</span></span><br><span class="line"><span class="comment"># 2 * 7 = 14</span></span><br><span class="line"><span class="comment"># 3 * 8 = 24</span></span><br><span class="line"><span class="comment"># 4 * 9 = 36</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-starmap-function-iterable"><a href="#itertools-starmap-function-iterable" class="headerlink" title="itertools.starmap(function,iterable)"></a><strong>itertools.starmap(function,iterable)</strong></h5><p>å‡½æ•°åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä¸­å†…è°ƒç”¨çš„function(*item)ï¼Œitemæ¥è‡ªäºiterableã€‚åªæœ‰å½“è¿­ä»£å¯¹è±¡iterableç”Ÿæˆçš„é¡¹é€‚åˆè¿™ä¸ªå‡½æ•°çš„è°ƒç”¨å½¢å¼çš„æ—¶å€™ï¼Œstarmapæ‰ä¼šæœ‰æ•ˆã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.starmap(<span class="keyword">lambda</span> x,y:(x, y, x*y), [(<span class="number">0</span>, <span class="number">5</span>), (<span class="number">1</span>, <span class="number">6</span>), (<span class="number">2</span>, <span class="number">7</span>), (<span class="number">3</span>, <span class="number">8</span>), (<span class="number">4</span>, <span class="number">9</span>)]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'%d * %d = %d'</span> % i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># 0 * 5 = 0</span></span><br><span class="line"><span class="comment"># 1 * 6 = 6</span></span><br><span class="line"><span class="comment"># 2 * 7 = 14</span></span><br><span class="line"><span class="comment"># 3 * 8 = 24</span></span><br><span class="line"><span class="comment"># 4 * 9 = 36</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-tee-iterable-n-2"><a href="#itertools-tee-iterable-n-2" class="headerlink" title="itertools.tee(iterable[,n=2])"></a><strong>itertools.tee(iterable[,n=2])</strong></h5><p>å‡½æ•°ä¼šè¿”å›è‹¥å¹²ä¸ªåŸºäºæŸä¸ªåŸå§‹è¾“å…¥çš„ç‹¬ç«‹è¿­ä»£å™¨ã€‚ç±»ä¼¼äºLinuxç³»ç»Ÿä¸Šçš„teeæŒ‡ä»¤ã€‚å¦‚æœä¸ç‰¹åœ°åˆ¶å®šnçš„è¯ï¼Œå‡½æ•°ä¼šé»˜è®¤æ˜¯2ã€‚teeæ‹¬å·é‡Œé¢æœ€å¥½ä½¿ç”¨æ ‡å‡†è¾“å…¥ï¼Œè€Œä¸æ˜¯åŸå§‹è¿­ä»£å™¨ã€‚ä¸ç„¶ä¼šåœ¨æŸäº›ç¼“å­˜è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">r = itertools.islice(itertools.count(), <span class="number">5</span>)</span><br><span class="line">i1, i2 = itertools.tee(r)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> i1:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'i1:'</span>, i</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> i2:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'i2:'</span>, i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># i1: 0</span></span><br><span class="line"><span class="comment"># i1: 1</span></span><br><span class="line"><span class="comment"># i1: 2</span></span><br><span class="line"><span class="comment"># i1: 3</span></span><br><span class="line"><span class="comment"># i1: 4</span></span><br><span class="line"><span class="comment"># i2: 0</span></span><br><span class="line"><span class="comment"># i2: 1</span></span><br><span class="line"><span class="comment"># i2: 2</span></span><br><span class="line"><span class="comment"># i2: 3</span></span><br><span class="line"><span class="comment"># i2: 4</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-takewhile-predicate-iterable"><a href="#itertools-takewhile-predicate-iterable" class="headerlink" title="itertools.takewhile(predicate,iterable)"></a><strong>itertools.takewhile(predicate,iterable)</strong></h5><p>å‡½æ•°å’Œdropwhileåˆšå¥½ç›¸åï¼Œåªè¦predicateè®¡ç®—åä¸ºFalseï¼Œè¿­ä»£è¿‡ç¨‹ç«‹åˆ»åœæ­¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">should_take</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="keyword">return</span> (x&lt;<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.takewhile(should_take, [ <span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">-2</span> ]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># Testing: -1</span></span><br><span class="line"><span class="comment"># Yielding: -1</span></span><br><span class="line"><span class="comment"># Testing: 0</span></span><br><span class="line"><span class="comment"># Yielding: 0</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Testing: 2</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-izip-iterables"><a href="#itertools-izip-iterables" class="headerlink" title="itertools.izip( *iterables)"></a><strong>itertools.izip( *iterables)</strong></h5><p>è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªåˆå¹¶å¤šä¸ªè¿­ä»£å™¨ï¼Œæˆä¸ºä¸€ä¸ªå…ƒç»„çš„è¿­ä»£å¯¹è±¡ã€‚ç±»ä¼¼äºå†…ç½®å‡½æ•°zipï¼Œä½†è¿”å›çš„æ˜¯è¿­ä»£å¯¹è±¡è€Œéåˆ—è¡¨ã€‚<br>åˆ›å»ºä¸€ä¸ªè¿­ä»£å¯¹è±¡ï¼Œç”Ÿæˆå…ƒç»„(i1,i2,i3â€¦)åˆ†åˆ«æ¥è‡ªäºi1,i2,i3â€¦ï¼Œåªè¦æä¾›çš„æŸä¸ªè¿­ä»£å™¨ä¸åœ¨ç”Ÿæˆå€¼ï¼Œå‡½æ•°å°±ä¼šç«‹åˆ»åœæ­¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.izip([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># (1, 'a')</span></span><br><span class="line"><span class="comment"># (2, 'b')</span></span><br><span class="line"><span class="comment"># (3, 'c')</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-izip-longest-iterable-fillvalue"><a href="#itertools-izip-longest-iterable-fillvalue" class="headerlink" title="itertools.izip_longest(*iterable[,fillvalue])"></a><strong>itertools.izip_longest(*iterable[,fillvalue])</strong></h5><p>å‡½æ•°å’Œizipé›·åŒï¼Œä½†æ˜¯åŒºåˆ«åœ¨äºä¸ä¼šåœæ­¢ï¼Œä¼šæŠŠæ‰€æœ‰è¾“å…¥çš„è¿­ä»£å¯¹è±¡å…¨éƒ¨è€—å°½ä¸ºæ­¢ï¼Œå¯¹äºå‚æ•°ä¸åŒ¹é…çš„é¡¹ï¼Œä¼šç”¨Noneä»£æ›¿ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.izip_longest([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="string">'a'</span>, <span class="string">'b'</span>]):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># (1, 'a')</span></span><br><span class="line"><span class="comment"># (2, 'b')</span></span><br><span class="line"><span class="comment"># (3, None)</span></span><br></pre></td></tr></table></figure>
<h4 id="ç»„åˆç”Ÿæˆå™¨"><a href="#ç»„åˆç”Ÿæˆå™¨" class="headerlink" title="ç»„åˆç”Ÿæˆå™¨"></a>ç»„åˆç”Ÿæˆå™¨</h4><h5 id="itertools-product-iterable-repeat"><a href="#itertools-product-iterable-repeat" class="headerlink" title="itertools.product(*iterable[,repeat])"></a><strong>itertools.product(*iterable[,repeat])</strong></h5><p>è¿™ä¸ªå·¥å…·å°±æ˜¯äº§ç”Ÿå¤šä¸ªåˆ—è¡¨æˆ–è€…è¿­ä»£å™¨çš„nç»´ç§¯ã€‚å¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡å®šrepeaté»˜è®¤ä¸ºåˆ—è¡¨å’Œè¿­ä»£å™¨çš„æ•°é‡ã€‚ï¼ˆç¬›å¡å°”ç§¯ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">b = (<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>)</span><br><span class="line">c = itertools.product(a,b)</span><br><span class="line"><span class="keyword">for</span> elem <span class="keyword">in</span> c:</span><br><span class="line">    <span class="keyword">print</span> elem</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># (1, 'A')</span></span><br><span class="line"><span class="comment"># (1, 'B')</span></span><br><span class="line"><span class="comment"># (1, 'C')</span></span><br><span class="line"><span class="comment"># (2, 'A')</span></span><br><span class="line"><span class="comment"># (2, 'B')</span></span><br><span class="line"><span class="comment"># (2, 'C')</span></span><br><span class="line"><span class="comment"># (3, 'A')</span></span><br><span class="line"><span class="comment"># (3, 'B')</span></span><br><span class="line"><span class="comment"># (3, 'C')</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-permutations-iterable-r"><a href="#itertools-permutations-iterable-r" class="headerlink" title="itertools.permutations(iterable[,r])"></a><strong>itertools.permutations(iterable[,r])</strong></h5><p>å‡½æ•°ä½œç”¨å…¶å®å°±æ˜¯äº§ç”ŸæŒ‡å®šæ•°ç›®repeatçš„å…ƒç´ çš„æ‰€æœ‰æ’åˆ—ï¼Œä¸”é¡ºåºæœ‰å…³ï¼Œä½†æ˜¯é‡åˆ°åŸåˆ—è¡¨æˆ–è€…è¿­ä»£å™¨æœ‰é‡å¤å…ƒç´ çš„ç°è±¡çš„æ—¶å€™ï¼Œä¹Ÿä¼šå¯¹åº”çš„äº§ç”Ÿé‡å¤é¡¹ã€‚è¿™ä¸ªæ—¶å€™æœ€å¥½ç”¨groupbyæˆ–è€…å…¶ä»–filterå»ä¸€ä¸‹é‡ï¼Œå¦‚æœæœ‰éœ€è¦çš„è¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = itertools.permutations(range(<span class="number">4</span>), <span class="number">3</span>)</span><br><span class="line">print(list(x))</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># [(0, 1, 2), </span></span><br><span class="line"><span class="comment"># (0, 1, 3), </span></span><br><span class="line"><span class="comment"># (0, 2, 1), </span></span><br><span class="line"><span class="comment"># (0, 2, 3), </span></span><br><span class="line"><span class="comment"># (0, 3, 1), </span></span><br><span class="line"><span class="comment"># (0, 3, 2), </span></span><br><span class="line"><span class="comment"># (1, 0, 2), </span></span><br><span class="line"><span class="comment"># (1, 0, 3), </span></span><br><span class="line"><span class="comment"># (1, 2, 0), </span></span><br><span class="line"><span class="comment"># (1, 2, 3), </span></span><br><span class="line"><span class="comment"># (1, 3, 0), </span></span><br><span class="line"><span class="comment"># (1, 3, 2), </span></span><br><span class="line"><span class="comment"># (2, 0, 1), </span></span><br><span class="line"><span class="comment"># (2, 0, 3), </span></span><br><span class="line"><span class="comment"># (2, 1, 0), </span></span><br><span class="line"><span class="comment"># (2, 1, 3), </span></span><br><span class="line"><span class="comment"># (2, 3, 0), </span></span><br><span class="line"><span class="comment"># (2, 3, 1), </span></span><br><span class="line"><span class="comment"># (3, 0, 1),</span></span><br><span class="line"><span class="comment"># (3, 0, 2), </span></span><br><span class="line"><span class="comment"># (3, 1, 0), </span></span><br><span class="line"><span class="comment"># (3, 1, 2), </span></span><br><span class="line"><span class="comment"># (3, 2, 0), </span></span><br><span class="line"><span class="comment"># (3, 2, 1)</span></span><br><span class="line"><span class="comment"># ]</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-combinations-iterable-r"><a href="#itertools-combinations-iterable-r" class="headerlink" title="itertools.combinations(iterable,r)"></a><strong>itertools.combinations(iterable,r)</strong></h5><p>è¿™ä¸ªå‡½æ•°ç”¨æ¥ç”ŸæˆæŒ‡å®šæ•°ç›®rçš„å…ƒç´ ä¸é‡å¤çš„æ‰€æœ‰ç»„åˆã€‚æ³¨æ„å’Œpermutationçš„åŒºåˆ†ï¼Œä»¥åŠè¿™ä¸ªç»„åˆæ˜¯æ— åºçš„ï¼Œåªè€ƒè™‘å…ƒç´ æœ¬èº«çš„uniqueæ€§ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = itertools.combinations(range(<span class="number">4</span>), <span class="number">3</span>)</span><br><span class="line">print(list(x))</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># [(0, 1, 2), (0, 1, 3), (0, 2, 3), (1, 2, 3)]</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-combinations-with-replacement-iterable-r"><a href="#itertools-combinations-with-replacement-iterable-r" class="headerlink" title="itertools.combinations_with_replacement(iterable,r)"></a><strong>itertools.combinations_with_replacement(iterable,r)</strong></h5><p>è¿™ä¸ªå‡½æ•°ç”¨æ¥ç”ŸæˆæŒ‡å®šæ•°ç›®rçš„å…ƒç´ å¯é‡å¤çš„æ‰€æœ‰ç»„åˆã€‚ç„¶è€Œè¿™ä¸ªå‡½æ•°ä¾ç„¶è¦ä¿è¯å…ƒç´ ç»„åˆçš„uniqueæ€§ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = itertools.combinations_with_replacement(<span class="string">'ABC'</span>, <span class="number">2</span>)</span><br><span class="line">print(list(x))</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment"># [('A', 'A'), </span></span><br><span class="line"><span class="comment"># ('A', 'B'), </span></span><br><span class="line"><span class="comment"># ('A', 'C'), </span></span><br><span class="line"><span class="comment"># ('B', 'B'), </span></span><br><span class="line"><span class="comment"># ('B', 'C'), </span></span><br><span class="line"><span class="comment"># ('C', 'Câ€™)</span></span><br><span class="line"><span class="comment"># ]</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>python</category>
      </categories>
  </entry>
  <entry>
    <title>Vimé€ŸæŸ¥</title>
    <url>/2018/05/29/Vim%E9%80%9F%E6%9F%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="vimï¼ˆVisual-Interfaceï¼‰"><a href="#vimï¼ˆVisual-Interfaceï¼‰" class="headerlink" title="vimï¼ˆVisual Interfaceï¼‰"></a>vimï¼ˆVisual Interfaceï¼‰</h2><p><img src="/2018/05/29/Vim%E9%80%9F%E6%9F%A5/NSFileHandle.png" alt="avatar"></p>
<a id="more"></a>
<h3 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h3><ol>
<li>hï¼šå·¦ç§»</li>
<li>jï¼šä¸‹ç§»</li>
<li>kï¼šä¸Šç§»</li>
<li>l(L)ï¼šå³ç§»</li>
<li><code>^</code> æˆ– <code>0</code>ï¼šå…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„è¡Œé¦–ã€‚</li>
<li><code>1$</code>ï¼šå…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„è¡Œæœ«ï¼Œ<code>2$</code>:å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œçš„è¡Œæœ«,â€¦ã€‚</li>
<li>Mï¼šå…‰æ ‡ç§»åŠ¨åˆ°ä¸­é—´è¡Œ</li>
<li>Lï¼šå…‰æ ‡ç§»åŠ¨åˆ°å±å¹•æœ€åä¸€è¡Œè¡Œé¦–</li>
<li>Gï¼šç§»åŠ¨åˆ°æŒ‡å®šè¡Œï¼Œè¡Œå· -Gï¼Œåªæœ‰Gçš„è¯ï¼Œåˆ°æ–‡ä»¶æœ€æœ«å°¾</li>
<li>ggï¼šæ–‡ä»¶ç¬¬ä¸€ä¸ªå­—ç¬¦</li>
<li>w:å‘åä¸€æ¬¡ç§»åŠ¨ä¸€ä¸ªå­—</li>
<li>bï¼šå‘å‰ä¸€æ¬¡ç§»åŠ¨ä¸€ä¸ªå­—</li>
<li>{ï¼šæŒ‰æ®µç§»åŠ¨ï¼Œä¸Šç§»</li>
<li>}ï¼šæŒ‰æ®µä¸‹ç§»ï¼Œä¸‹ç§»</li>
<li>ctrl+dï¼šå‘ä¸‹ç¿»åŠå±</li>
<li>ctrl+uï¼šå‘ä¸Šç¿»åŠå±</li>
<li>ctrl+fï¼šå‘ä¸‹ç¿»ä¸€å±</li>
<li>ctrl+bï¼šå‘ä¸Šç¿»ä¸€å±</li>
</ol>
<h4 id="å¯è§†æ¨¡å¼"><a href="#å¯è§†æ¨¡å¼" class="headerlink" title="å¯è§†æ¨¡å¼"></a>å¯è§†æ¨¡å¼</h4><ol>
<li>v:æŒ‰å­—ç¬¦ç§»åŠ¨ï¼Œç»“åˆh,j,k,lé€‰ä¸­æ–‡æœ¬å†…å®¹ã€‚</li>
<li>Vï¼šæŒ‰è¡Œç§»åŠ¨ï¼Œé€‰ä¸­æ–‡æœ¬å¯è§†æ¨¡å¼ï¼Œå¯ä»¥é…åˆdï¼Œyï¼Œ&gt;&gt;,&lt;&lt;å®ç°å¯¹æ–‡æœ¬å—çš„åˆ é™¤ï¼Œå¤åˆ¶ï¼Œå·¦å³ç§»åŠ¨ã€‚</li>
</ol>
<h4 id="åˆ é™¤å‘½ä»¤"><a href="#åˆ é™¤å‘½ä»¤" class="headerlink" title="åˆ é™¤å‘½ä»¤"></a>åˆ é™¤å‘½ä»¤</h4><ol>
<li>xï¼šåˆ é™¤å…‰æ ‡åä¸€ä¸ªå­—ç¬¦ï¼Œn x åˆ é™¤å…‰æ ‡åçš„nä¸ªå­—ç¬¦</li>
<li>Xï¼šåˆ é™¤å…‰æ ‡å‰ä¸€ä¸ªå­—ç¬¦ï¼Œç›¸å½“äºBackspace</li>
<li>ddï¼šåˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œï¼Œn ddåˆ é™¤æŒ‡å®šçš„nè¡Œ</li>
<li>Dï¼šåˆ é™¤å…‰æ ‡åæœ¬è¡Œæ‰€æœ‰å†…å®¹ï¼ŒåŒ…å«å…‰æ ‡æ‰€åœ¨å­—ç¬¦</li>
<li>d0ï¼šåˆ é™¤å…‰æ ‡å‰æœ¬è¡Œæ‰€æœ‰å†…å®¹ï¼Œä¸åŒ…å«å…‰æ ‡æ‰€åœ¨å­—ç¬¦</li>
<li>dwï¼šåˆ é™¤å…‰æ ‡å¼€å§‹ä½ç½®çš„å­—ï¼ŒåŒ…å«å…‰æ ‡æ‰€åœ¨å­—ç¬¦</li>
</ol>
<h4 id="æ’¤é”€å‘½ä»¤"><a href="#æ’¤é”€å‘½ä»¤" class="headerlink" title="æ’¤é”€å‘½ä»¤"></a>æ’¤é”€å‘½ä»¤</h4><ol>
<li>uï¼šä¸€æ­¥ä¸€æ­¥æ’¤é”€</li>
<li>ctrl+rï¼šåæ’¤é”€</li>
</ol>
<h4 id="é‡å¤å‘½ä»¤"><a href="#é‡å¤å‘½ä»¤" class="headerlink" title="é‡å¤å‘½ä»¤"></a>é‡å¤å‘½ä»¤</h4><ol>
<li>. ï¼šé‡å¤ä¸Šä¸€æ¬¡æ“ä½œçš„å‘½ä»¤</li>
</ol>
<h4 id="æ–‡æœ¬ç§»åŠ¨"><a href="#æ–‡æœ¬ç§»åŠ¨" class="headerlink" title="æ–‡æœ¬ç§»åŠ¨"></a>æ–‡æœ¬ç§»åŠ¨</h4><ol>
<li>>&gt;:æ–‡æœ¬è¡Œå³ç§»</li>
<li>\&lt;&lt;:æ–‡æœ¬è¡Œå·¦ç§»</li>
</ol>
<h4 id="å¤åˆ¶ç²˜è´´"><a href="#å¤åˆ¶ç²˜è´´" class="headerlink" title="å¤åˆ¶ç²˜è´´"></a>å¤åˆ¶ç²˜è´´</h4><ol>
<li>yyï¼šå¤åˆ¶å½“å‰è¡Œï¼Œn yyå¤åˆ¶nè¡Œ</li>
<li>åœ¨æœ«è¡Œæ¨¡å¼ï¼Œè¾“å…¥ï¼ša,by å¤åˆ¶ä»ç¬¬aè¡Œå¼€å§‹ï¼Œåˆ°ç¬¬bè¡Œç»“æŸçš„å†…å®¹</li>
<li>pï¼šåœ¨å…‰æ ‡ååœ¨ä½ç½®å‘ä¸‹æ–°å¼€è¾Ÿä¸€è¡Œï¼Œç²˜è´´</li>
<li>dï¼šå‰ªåˆ‡é€‰ä¸­å†…å®¹</li>
</ol>
<h4 id="æŸ¥æ‰¾å‘½ä»¤"><a href="#æŸ¥æ‰¾å‘½ä»¤" class="headerlink" title="æŸ¥æ‰¾å‘½ä»¤"></a>æŸ¥æ‰¾å‘½ä»¤</h4><ol>
<li>/str : æŸ¥æ‰¾strï¼Œä»å…‰æ ‡æ‰€åœ¨è¡Œå¾€ä¸‹æŸ¥æ‰¾</li>
<li>ï¼Ÿstrï¼šæŸ¥æ‰¾strï¼Œä»å…‰æ ‡æ‰€åœ¨è¡Œå¾€ä¸ŠæŸ¥æ‰¾</li>
<li>nï¼šæŸ¥æ‰¾ä¸‹ä¸€ä¸ª</li>
<li>Nï¼šæŸ¥æ‰¾ä¸Šä¸€ä¸ª </li>
</ol>
<h4 id="æ›¿æ¢æ“ä½œ"><a href="#æ›¿æ¢æ“ä½œ" class="headerlink" title="æ›¿æ¢æ“ä½œ"></a>æ›¿æ¢æ“ä½œ</h4><ol>
<li>rï¼šæ›¿æ¢å½“å‰å­—ç¬¦</li>
<li>Ræ›¿æ¢å½“å‰è¡Œå…‰æ ‡åçš„å­—ç¬¦</li>
</ol>
<h4 id="æ›¿æ¢å‘½ä»¤"><a href="#æ›¿æ¢å‘½ä»¤" class="headerlink" title="æ›¿æ¢å‘½ä»¤"></a>æ›¿æ¢å‘½ä»¤</h4><ol>
<li>æœ«è¡Œæ¨¡å¼ä¸‹ï¼Œå°†å…‰æ ‡æ‰€åœ¨è¡Œçš„abcæ›¿æ¢æˆ123ï¼Œï¼šs/abc/123/g</li>
<li>æœ«è¡Œæ¨¡å¼ä¸‹ï¼Œå°†ç¬¬ä¸€è¡Œåˆ°ç¬¬10è¡Œä¹‹é—´çš„abcæ›¿æ¢æˆ123ï¼Œ:1,10s/abc/123/g</li>
<li>æœ«è¡Œæ¨¡å¼ä¸‹ï¼ŒæŠŠæ–‡ä»¶ä¸­çš„abcå…¨éƒ¨æ›¿æ¢æˆ123ï¼Œ:%s/abc/123</li>
</ol>
<h3 id="è¾“å…¥æ¨¡å¼"><a href="#è¾“å…¥æ¨¡å¼" class="headerlink" title="è¾“å…¥æ¨¡å¼"></a>è¾“å…¥æ¨¡å¼</h3><ol>
<li>iï¼šæ’å…¥å…‰æ ‡å‰ä¸€ä¸ªå­—ç¬¦</li>
<li>Iï¼šæ’å…¥è¡Œé¦–</li>
<li>aï¼šæ’å…¥å…‰æ ‡åä¸€ä¸ªå­—ç¬¦</li>
<li>A: æ’å…¥è¡Œæœ«</li>
<li>oï¼šå‘ä¸‹æ–°å¼€ä¸€è¡Œï¼Œæ’å…¥è¡Œé¦–</li>
<li><p>Oï¼šå‘ä¸Šæ–°å¼€ä¸€è¡Œï¼Œæ’å…¥è¡Œé¦–</p>
<h3 id="æœ«è¡Œæ¨¡å¼"><a href="#æœ«è¡Œæ¨¡å¼" class="headerlink" title="æœ«è¡Œæ¨¡å¼"></a>æœ«è¡Œæ¨¡å¼</h3></li>
<li><p>ï¼šset nu æ˜¾ç¤ºè¡Œå·</p>
</li>
<li>! shellå‘½ä»¤</li>
<li>wqï¼šä¿å­˜é€€å‡º</li>
<li>ZZï¼š ä¿å­˜é€€å‡º</li>
<li>qï¼ï¼šä¸ä¿å­˜é€€å‡º</li>
</ol>
<h3 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h3><p>ä¿®æ”¹ç”¨æˆ·ç›®å½•ä¸‹çš„vimrcï¼ˆ~/.vimrcï¼‰æ–‡ä»¶ï¼Œä¿®æ”¹vimé…ç½®</p>
<ol>
<li>set nu :è®¾ç½®æ¯æ¬¡vim æ‰“å¼€æ–‡ä»¶æ˜¾ç¤ºè¡Œå·ã€‚</li>
<li>set ts=4:è®¾ç½®tabé”®æ¯æ¬¡4ä¸ªç©ºæ ¼</li>
</ol>
]]></content>
      <categories>
        <category>soft skill</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Vim</tag>
        <tag>é€ŸæŸ¥</tag>
      </tags>
  </entry>
  <entry>
    <title>latexå…¬å¼é€ŸæŸ¥</title>
    <url>/2018/05/10/latex%E5%85%AC%E5%BC%8F%E9%80%9F%E6%9F%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ä¸Šä¸‹æ ‡"><a href="#ä¸Šä¸‹æ ‡" class="headerlink" title="ä¸Šä¸‹æ ‡"></a>ä¸Šä¸‹æ ‡</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>x_{2}</td>
<td>$x_{2}$</td>
</tr>
<tr>
<td>x^2</td>
<td>$x^{2}$</td>
</tr>
</tbody>
</table>
</div>
<a id="more"></a>
<h3 id="å…¬å¼åºå·"><a href="#å…¬å¼åºå·" class="headerlink" title="å…¬å¼åºå·"></a>å…¬å¼åºå·</h3><script type="math/tex; mode=display">
y = wx+b \tag{1.1}</script><h3 id="æ‹¬å·"><a href="#æ‹¬å·" class="headerlink" title="æ‹¬å·"></a>æ‹¬å·</h3><ol>
<li><p>() [] ç›´æ¥å†™å°±è¡Œï¼Œè€Œ {} åˆ™éœ€è¦è½¬ä¹‰</p>
<ol>
<li>y \in \{3, 4, 5\} : $y \in \{3, 4, 5\}$</li>
</ol>
</li>
<li><p>æœ‰æ—¶å€™æ‹¬å·éœ€è¦å¤§å·çš„ï¼Œæ­¤æ—¶éœ€è¦ä½¿ç”¨\leftå’Œ\rightåŠ å¤§æ‹¬å·çš„å¤§å°ã€‚</p>
<ol>
<li>\left(\frac {x} {y} \right)^2 : $\left(\frac {x} {y} \right)^2$</li>
</ol>
</li>
<li><p>\left å’Œ \rightå¿…é¡»æˆå¯¹å‡ºç°ï¼Œå¯¹äºä¸æ˜¾ç¤ºçš„ä¸€è¾¹å¯ä»¥ä½¿ç”¨ . ä»£æ›¿</p>
</li>
<li><p>\left. \frac{du}{dx} \right| _{x=0} : $\left. \frac{du}{dx} \right| _{x=0}$</p>
</li>
<li><p>åŒæ‹¬å·$\left|g_{k}\right|$</p>
</li>
<li><p>å·¦å¤§æ‹¬å·ï¼š</p>
<p> <code>\left\{\begin{array}{ll}
 x=\frac{3 \pi}{2}(1+2 t) \cos \left(\frac{3 \pi}{2}(1+2 t)\right) &amp; \\
 y=s, &amp; 0 \leq s \leq L,|t| \leq 1 \\
 z=\frac{3 \pi}{2}(1+2 t) \sin \left(\frac{3 \pi}{2}(1+2 t)\right)
 \end{array}\right.</code></p>
<script type="math/tex; mode=display">
 \left\{\begin{array}{ll}
 x=\frac{3 \pi}{2}(1+2 t) \cos \left(\frac{3 \pi}{2}(1+2 t)\right) & \\
 y=s, & 0 \leq s \leq L,|t| \leq 1 \\
 z=\frac{3 \pi}{2}(1+2 t) \sin \left(\frac{3 \pi}{2}(1+2 t)\right)
 \end{array}\right.</script></li>
</ol>
<h3 id="åˆ†æ•°"><a href="#åˆ†æ•°" class="headerlink" title="åˆ†æ•°"></a>åˆ†æ•°</h3><p>ä¸¤ç§å†™æ³•ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">å‘½ä»¤</th>
<th style="text-align:center">æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">\frac{1}{2x+1}</td>
<td style="text-align:center">$\frac{1}{2x+1}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="å¼€æ–¹"><a href="#å¼€æ–¹" class="headerlink" title="å¼€æ–¹"></a>å¼€æ–¹</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\sqrt[n]{a}</td>
<td>$\sqrt[n]{a}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="å¯¹æ•°"><a href="#å¯¹æ•°" class="headerlink" title="å¯¹æ•°"></a>å¯¹æ•°</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\log</td>
<td>$\log$</td>
</tr>
<tr>
<td>\lg</td>
<td>$\lg$</td>
</tr>
<tr>
<td>\ln</td>
<td>$\ln$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="å‘é‡"><a href="#å‘é‡" class="headerlink" title="å‘é‡"></a>å‘é‡</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\vec{a}</td>
<td>$\vec{a}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="ä¸‰è§’è¿ç®—"><a href="#ä¸‰è§’è¿ç®—" class="headerlink" title="ä¸‰è§’è¿ç®—"></a>ä¸‰è§’è¿ç®—</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\bot</td>
<td>$\bot$</td>
<td></td>
<td>\angle</td>
<td>$\angle$</td>
</tr>
<tr>
<td>\sin</td>
<td>$\sin$</td>
<td></td>
<td>\cos</td>
<td>$\cos$</td>
</tr>
<tr>
<td>\tan</td>
<td>$\tan$</td>
<td></td>
<td>\cot</td>
<td>$\cot$</td>
</tr>
<tr>
<td>\sec</td>
<td>$\sec$</td>
<td></td>
<td>\csc</td>
<td>$\csc$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="çœç•¥å·"><a href="#çœç•¥å·" class="headerlink" title="çœç•¥å·"></a>çœç•¥å·</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\ldots</td>
<td>$\ldots$</td>
</tr>
<tr>
<td>\cdots</td>
<td>$\cdots$</td>
</tr>
<tr>
<td>\cdot</td>
<td>$\cdot$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="éœ€è¦è½¬ä¹‰çš„å­—ç¬¦"><a href="#éœ€è¦è½¬ä¹‰çš„å­—ç¬¦" class="headerlink" title="éœ€è¦è½¬ä¹‰çš„å­—ç¬¦"></a>éœ€è¦è½¬ä¹‰çš„å­—ç¬¦</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\#</td>
<td>$#$</td>
<td></td>
<td>\_</td>
<td>$_$</td>
</tr>
<tr>
<td>\$</td>
<td>$$$</td>
<td></td>
<td>\\%</td>
<td>$\%$</td>
</tr>
<tr>
<td>\\&amp;</td>
<td>$\&amp;$</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>\\{</td>
<td>$\{$</td>
<td></td>
<td>\\}</td>
<td>$\}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="æ™®é€šç¬¦å·"><a href="#æ™®é€šç¬¦å·" class="headerlink" title="æ™®é€šç¬¦å·"></a>æ™®é€šç¬¦å·</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\pm</td>
<td>$\pm$</td>
<td></td>
<td>\times</td>
<td>$\times$</td>
</tr>
<tr>
<td>\div</td>
<td>$\div$</td>
<td></td>
<td>\mid</td>
<td>$\mid$</td>
</tr>
<tr>
<td>\cdot</td>
<td>$\cdot$</td>
<td></td>
<td>\circ</td>
<td>$\circ$</td>
</tr>
<tr>
<td>\ast</td>
<td>$\ast$</td>
<td></td>
<td>\bigodot</td>
<td>$\bigodot$</td>
</tr>
<tr>
<td>\bigotimes</td>
<td>$\bigotimes$</td>
<td></td>
<td>\equiv</td>
<td>$\equiv$</td>
</tr>
<tr>
<td>\leq or \le</td>
<td>$\leq$</td>
<td></td>
<td>\geq or \ge</td>
<td>$\geq$</td>
</tr>
<tr>
<td>\ll</td>
<td>$\ll$</td>
<td></td>
<td>\gg</td>
<td>$\gg$</td>
</tr>
<tr>
<td>\neq or  \ne</td>
<td>$\neq$</td>
<td></td>
<td>\approx</td>
<td>$\approx$</td>
</tr>
<tr>
<td>\succeq</td>
<td>$\succeq$</td>
<td></td>
<td>\preceq</td>
<td>$\preceq$</td>
</tr>
<tr>
<td>\doteq</td>
<td>$\doteq$</td>
<td></td>
<td>\cong</td>
<td>$\cong$</td>
</tr>
<tr>
<td>\sim</td>
<td>$\sim$</td>
<td></td>
<td>\simeq</td>
<td>$\simeq$</td>
</tr>
<tr>
<td>\vdash</td>
<td>$\vdash$</td>
<td></td>
<td>\dashv</td>
<td>$\dashv$</td>
</tr>
<tr>
<td>\models</td>
<td>$\models$</td>
<td></td>
<td>\perp</td>
<td>$\perp$</td>
</tr>
<tr>
<td>\smile</td>
<td>$\smile$</td>
<td></td>
<td>\frown</td>
<td>$\frown$</td>
</tr>
<tr>
<td>\saymp</td>
<td>$\asymp$</td>
<td></td>
<td>\:</td>
<td>$\:$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="å¸Œè…Šå­—æ¯"><a href="#å¸Œè…Šå­—æ¯" class="headerlink" title="å¸Œè…Šå­—æ¯"></a>å¸Œè…Šå­—æ¯</h3><p>å¤§å†™ï¼šå¼€å¤´å­—æ¯å¤§å†™<br>æ–œä½“ï¼šå‘½ä»¤å‰é¢åŠ var</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th>å¤§å†™</th>
<th>æ–œä½“</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th>å¤§å†™</th>
<th>æ–œä½“</th>
</tr>
</thead>
<tbody>
<tr>
<td>\alpha</td>
<td>$\alpha$</td>
<td>A</td>
<td></td>
<td></td>
<td>\beta</td>
<td>$\beta$</td>
<td>B</td>
<td></td>
</tr>
<tr>
<td>\gamma</td>
<td>$\gamma$</td>
<td>$\Gamma$</td>
<td>$\varGamma$</td>
<td></td>
<td>\delta</td>
<td>$\delta$</td>
<td>$\Delta$</td>
<td>$\varDelta$</td>
</tr>
<tr>
<td>\epsilon</td>
<td>$\epsilon$</td>
<td>E</td>
<td>$\varepsilon$</td>
<td></td>
<td>\zeta</td>
<td>$\zeta$</td>
<td>Z</td>
<td></td>
</tr>
<tr>
<td>\eta</td>
<td>$\eta$</td>
<td>H</td>
<td></td>
<td></td>
<td>\theta</td>
<td>$\theta$</td>
<td>$\Theta$</td>
<td>$\varTheta$</td>
</tr>
<tr>
<td>\iota</td>
<td>$\iota$</td>
<td>I</td>
<td></td>
<td></td>
<td>\kappa</td>
<td>$\kappa$</td>
<td>K</td>
<td></td>
</tr>
<tr>
<td>\lambda</td>
<td>$\lambda$</td>
<td>$\Lambda$</td>
<td>$\varLambda$</td>
<td></td>
<td>\mu</td>
<td>$\mu$</td>
<td>M</td>
<td></td>
</tr>
<tr>
<td>\xi</td>
<td>$\xi$</td>
<td>$\Xi$</td>
<td>$\varXi$</td>
<td></td>
<td>\nu</td>
<td>$\nu$</td>
<td>N</td>
<td></td>
</tr>
<tr>
<td>\pi</td>
<td>$\pi$</td>
<td>$\Pi$</td>
<td>$\varPi$</td>
<td></td>
<td>\rho</td>
<td>$\rho$</td>
<td>P</td>
<td>$\varrho$</td>
</tr>
<tr>
<td>\sigma</td>
<td>$\sigma$</td>
<td>$\Sigma$</td>
<td>$\varSigma$</td>
<td></td>
<td>\tau</td>
<td>$\tau$</td>
<td>T</td>
<td></td>
</tr>
<tr>
<td>\upsilon</td>
<td>$\upsilon$</td>
<td>$\Upsilon$</td>
<td>$\varUpsilon$</td>
<td></td>
<td>\phi</td>
<td>$\phi$</td>
<td>$\Phi$</td>
<td>$\varPhi$</td>
</tr>
<tr>
<td>\chi</td>
<td>$\chi$</td>
<td>X</td>
<td></td>
<td></td>
<td>\psi</td>
<td>$\psi$</td>
<td>$\Psi$</td>
<td>$\varPsi$</td>
</tr>
<tr>
<td>\omega</td>
<td>$\omega$</td>
<td>$\Omega$</td>
<td>$\varOmega$</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p><img src="/2018/05/10/latex%E5%85%AC%E5%BC%8F%E9%80%9F%E6%9F%A5/NSFileHandle.png" alt="5f979c551b937e468a1ed99ff62134d4"></p>
<h3 id="é›†åˆè¿ç®—"><a href="#é›†åˆè¿ç®—" class="headerlink" title="é›†åˆè¿ç®—"></a>é›†åˆè¿ç®—</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\emptyset</td>
<td>$\emptyset$</td>
<td></td>
<td>\propto</td>
<td>$\propto$</td>
</tr>
<tr>
<td>\notin</td>
<td>$\notin$</td>
<td></td>
<td>\Join or \bowtie</td>
<td>$\Join$</td>
</tr>
<tr>
<td>\supset</td>
<td>$\supset$</td>
<td></td>
<td>\subseteq</td>
<td>$\subseteq$</td>
</tr>
<tr>
<td>\subset</td>
<td>$\subset$</td>
<td></td>
<td>\supseteq</td>
<td>$\supseteq$</td>
</tr>
<tr>
<td>\sqsubset</td>
<td>$\sqsubset$</td>
<td></td>
<td>\sqsupseteq</td>
<td>$\sqsupseteq$</td>
</tr>
<tr>
<td>\bigcap</td>
<td>$\bigcap$</td>
<td></td>
<td>\bigcup</td>
<td>$\bigcup$</td>
</tr>
<tr>
<td>\bigvee</td>
<td>$\bigvee$</td>
<td></td>
<td>\bigwedge</td>
<td>$\bigwedge$</td>
</tr>
<tr>
<td>\biguplus</td>
<td>$\biguplus$</td>
<td></td>
<td>\bigsqcup</td>
<td>$\bigsqcup$</td>
</tr>
<tr>
<td>\in</td>
<td>$\in$</td>
<td></td>
<td>\ni or \owns</td>
<td>$\owns$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="é€»è¾‘è¿ç®—"><a href="#é€»è¾‘è¿ç®—" class="headerlink" title="é€»è¾‘è¿ç®—"></a>é€»è¾‘è¿ç®—</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\because</td>
<td>$\because$</td>
<td></td>
<td>\therefore</td>
<td>$\therefore$</td>
</tr>
<tr>
<td>\forall</td>
<td>$\forall$</td>
<td></td>
<td>\exists</td>
<td>$\exists$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="å¾®åˆ†"><a href="#å¾®åˆ†" class="headerlink" title="å¾®åˆ†"></a>å¾®åˆ†</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>y{\prime}x</td>
<td>$y{\prime}x$</td>
<td></td>
<td>\int</td>
<td>$\int$</td>
</tr>
<tr>
<td>\iint</td>
<td>$\iint$</td>
<td></td>
<td>\iiint</td>
<td>$\iiint$</td>
</tr>
<tr>
<td>\oint</td>
<td>$oint$</td>
<td></td>
<td>\lim</td>
<td>$lim$</td>
</tr>
<tr>
<td>\infty</td>
<td>$\infty$</td>
<td></td>
<td>\nabla</td>
<td>$\nabla$</td>
</tr>
<tr>
<td>\partial</td>
<td>$\partial$</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h3 id="ç®­å¤´"><a href="#ç®­å¤´" class="headerlink" title="ç®­å¤´"></a>ç®­å¤´</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\uparrow</td>
<td>$\uparrow$</td>
<td></td>
<td>\downarrow</td>
<td>$\downarrow$</td>
</tr>
<tr>
<td>\Uparrow</td>
<td>$\Uparrow$</td>
<td></td>
<td>\Downarrow</td>
<td>$\Downarrow$</td>
</tr>
<tr>
<td>\leftarrow</td>
<td>$\leftarrow$</td>
<td></td>
<td>\rightarrow</td>
<td>$\rightarrow$</td>
</tr>
<tr>
<td>\Leftarrow</td>
<td>$\Leftarrow$</td>
<td></td>
<td>\Rightarrow</td>
<td>$\Rightarrow$</td>
</tr>
<tr>
<td>\longleftarrow</td>
<td>$\longleftarrow$</td>
<td></td>
<td>\longrightarrow</td>
<td>$\longrightarrow$</td>
</tr>
<tr>
<td>\Longrightarrow</td>
<td>$\Longrightarrow$</td>
<td></td>
<td>\Longrightarrow</td>
<td>$\Longrightarrow$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="æ±‚å’Œã€è¿ä¹˜å’Œç§¯åˆ†å·"><a href="#æ±‚å’Œã€è¿ä¹˜å’Œç§¯åˆ†å·" class="headerlink" title="æ±‚å’Œã€è¿ä¹˜å’Œç§¯åˆ†å·"></a>æ±‚å’Œã€è¿ä¹˜å’Œç§¯åˆ†å·</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th>ä½¿ç”¨</th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody>
<tr>
<td>\sum</td>
<td>$\sum$</td>
<td>\sum_{i=1}^{N}</td>
<td>$\sum_{i=1}^{N}$</td>
</tr>
<tr>
<td>\prod</td>
<td>$\prod$</td>
<td>\prod_{i=1}^{N}</td>
<td>$\prod_{i=1}^{N}$</td>
</tr>
<tr>
<td>\coprod</td>
<td>$\coprod$</td>
<td>\coprod_{i=1}^{N}</td>
<td>$\coprod_{i=1}^{N}$</td>
</tr>
<tr>
<td>\int</td>
<td>$\int$</td>
<td>\int_{a}^{b}</td>
<td>$\int_{a}^{b}$</td>
</tr>
<tr>
<td>\iint</td>
<td>$\iint$</td>
<td>\iint_{a}^{b}</td>
<td>$\iint_{a}^{b}$</td>
</tr>
<tr>
<td>\bigcup</td>
<td>$\bigcup$</td>
<td>\bigcup_{i=1}^{N}</td>
<td>$\bigcup_{i=1}^{N}$</td>
</tr>
<tr>
<td>\bigcap</td>
<td>$\bigcap$</td>
<td>\bigcap_{i=1}^{N}</td>
<td>$\bigcap_{i=1}^{N}$</td>
</tr>
<tr>
<td>\lim_{n\rightarrow+\infty}</td>
<td>$lim_{n\rightarrow+\infty}$</td>
<td>\lim_{n\rightarrow+\infty}\frac{1}{n(n+1)}</td>
<td>$\lim_{n\rightarrow+\infty}\frac{1}{n(n+1)}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="æ•°å­—æ¨¡å¼é‡éŸ³ç¬¦"><a href="#æ•°å­—æ¨¡å¼é‡éŸ³ç¬¦" class="headerlink" title="æ•°å­—æ¨¡å¼é‡éŸ³ç¬¦"></a>æ•°å­—æ¨¡å¼é‡éŸ³ç¬¦</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
<th></th>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\hat{a}</td>
<td>$\hat{a}$</td>
<td></td>
<td>\dot{a}</td>
<td>$\dot{a}$</td>
</tr>
<tr>
<td>\grave{a}</td>
<td>$\grave{a}$</td>
<td></td>
<td>\acute{a}</td>
<td>$\acute{a}$</td>
</tr>
<tr>
<td>\bar{a}</td>
<td>$\bar{a}$</td>
<td></td>
<td>\tilde{a}</td>
<td>$\tilde{a}$</td>
</tr>
<tr>
<td>\check{a}</td>
<td>$\check{a}$</td>
<td></td>
<td>\ddot{a}</td>
<td>$\ddot{a}$</td>
</tr>
<tr>
<td>\widehat{A}</td>
<td>$\widehat{A}$</td>
<td></td>
<td>\widetilde{A}</td>
<td>$\widetilde{A}$</td>
</tr>
<tr>
<td>\vec{a}</td>
<td>$\vec{a}$</td>
<td></td>
<td>\breve{a}</td>
<td>$\breve{a}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="è¿çº¿ç¬¦å·"><a href="#è¿çº¿ç¬¦å·" class="headerlink" title="è¿çº¿ç¬¦å·"></a>è¿çº¿ç¬¦å·</h3><div class="table-container">
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æ˜¾ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td>\overline{a+b+c+d}</td>
<td>$\overline{a+b+c+d}$</td>
</tr>
<tr>
<td>\underline{a+b+c+d}</td>
<td>$\underline{a+b+c+d}$</td>
</tr>
<tr>
<td>\overbrace{a+\underbrace{b+c}_{1.0}+d}^{2.0}</td>
<td>$\overbrace{a+\underbrace{b+c}_{1.0}+d}^{2.0}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="çŸ©é˜µ"><a href="#çŸ©é˜µ" class="headerlink" title="çŸ©é˜µ"></a>çŸ©é˜µ</h3><p>å‘½ä»¤</p>
<p>\left|\begin{array}{cccc}<br>     1 &amp; 6 &amp; 9 \\\<br>     7 &amp; 9 &amp; 0 \\\<br>     9 &amp; 5 &amp; 0<br>\end{array}\right|</p>
<p>æ˜¾ç¤ºï¼š</p>
<script type="math/tex; mode=display">
\left|\begin{array}{cccc}
     1 & 6 & 9 \\ 
     7 & 9 & 0 \\
     9 & 5 & 0
\end{array}\right|</script><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><p><a href="https://mathpix.com/" target="_blank" rel="noopener">https://mathpix.com/</a></p>
<p><a href="https://houmin.cc/posts/fedfc052/" target="_blank" rel="noopener">https://houmin.cc/posts/fedfc052/</a></p>
]]></content>
      <categories>
        <category>soft skill</category>
      </categories>
      <tags>
        <tag>é€ŸæŸ¥</tag>
        <tag>latex</tag>
      </tags>
  </entry>
  <entry>
    <title>å›¾è®º</title>
    <url>/2018/03/21/%E5%9B%BE%E8%AE%BA/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="æ— å‘å›¾"><a href="#æ— å‘å›¾" class="headerlink" title="æ— å‘å›¾"></a>æ— å‘å›¾</h3><h4 id="å®šä¹‰æ— å‘å›¾æ•°æ®ç»“æ„"><a href="#å®šä¹‰æ— å‘å›¾æ•°æ®ç»“æ„" class="headerlink" title="å®šä¹‰æ— å‘å›¾æ•°æ®ç»“æ„"></a>å®šä¹‰æ— å‘å›¾æ•°æ®ç»“æ„</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Graph</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        self.n = n</span><br><span class="line">        self.e = <span class="number">0</span></span><br><span class="line">        self.adj = [[] <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_edge</span><span class="params">(self, v, w)</span>:</span></span><br><span class="line">        self.adj[v].append(w)</span><br><span class="line">        self.adj[w].append(v)</span><br><span class="line">        self.e += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="æ— å‘å›¾åˆ¤ç¯"><a href="#æ— å‘å›¾åˆ¤ç¯" class="headerlink" title="æ— å‘å›¾åˆ¤ç¯"></a>æ— å‘å›¾åˆ¤ç¯</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cycle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, G)</span>:</span></span><br><span class="line">        self.vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.has_cycle = <span class="literal">False</span></span><br><span class="line">        self.G = G</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> range(G.n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[s]:</span><br><span class="line">                self.dfs(s, s)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(self, v, parent)</span>:</span></span><br><span class="line">        self.vis[v] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> self.G.adj[v]:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[w]:</span><br><span class="line">                self.dfs(w, v)</span><br><span class="line">            <span class="comment"># ç›¸é‚»èŠ‚ç‚¹å·²è¢«è®¿é—®è¿‡ï¼ŒåŒæ—¶è¿˜ä¸æ˜¯parentèŠ‚ç‚¹ï¼Œåˆ™å­˜åœ¨ç¯</span></span><br><span class="line">            <span class="keyword">elif</span> w != parent:</span><br><span class="line">                self.has_cycle = <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h4 id="æ— å‘å›¾æ˜¯å¦ä¸ºäºŒåˆ†å›¾"><a href="#æ— å‘å›¾æ˜¯å¦ä¸ºäºŒåˆ†å›¾" class="headerlink" title="æ— å‘å›¾æ˜¯å¦ä¸ºäºŒåˆ†å›¾"></a>æ— å‘å›¾æ˜¯å¦ä¸ºäºŒåˆ†å›¾</h4><p>äºŒåˆ†å›¾åˆå«äºŒéƒ¨å›¾ï¼Œæ˜¯å›¾è®ºä¸­çš„ä¸€ç§ç‰¹æ®Šæ¨¡å‹ã€‚è®¾G=(V,E)æ˜¯ä¸€ä¸ªæ— å‘å›¾ï¼Œå¦‚æœé¡¶ç‚¹Vå¯åˆ†å‰²ä¸ºä¸¤ä¸ªäº’ä¸ç›¸äº¤çš„å­é›†<code>(A,B)</code>ï¼Œå¹¶ä¸”å›¾ä¸­çš„æ¯æ¡è¾¹<code>ï¼ˆiï¼Œjï¼‰</code>æ‰€å…³è”çš„ä¸¤ä¸ªé¡¶ç‚¹iå’Œjåˆ†åˆ«å±äºè¿™ä¸¤ä¸ªä¸åŒçš„é¡¶ç‚¹é›†<code>(i in A,j in B)</code>ï¼Œåˆ™ç§°å›¾Gä¸ºä¸€ä¸ªäºŒåˆ†å›¾ã€‚</p>
<p><img src="/2018/03/21/%E5%9B%BE%E8%AE%BA/äºŒåˆ†å›¾.png" alt="avatar"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TwoColor</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, G)</span>:</span></span><br><span class="line">        self.vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.color = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.G = G</span><br><span class="line">        self.is_two_colorable = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> range(G.n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[s]:</span><br><span class="line">                self.dfs(s)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(self, v)</span>:</span></span><br><span class="line">        self.vis[v] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> self.G.adj[v]:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[w]:</span><br><span class="line">                self.color[w] = <span class="keyword">not</span> self.color[v]</span><br><span class="line">                self.dfs(w)</span><br><span class="line">            <span class="keyword">elif</span> self.color[w] == self.color[v]:</span><br><span class="line">                self.is_two_colorable = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h3 id="æœ€å°ç”Ÿæˆæ ‘"><a href="#æœ€å°ç”Ÿæˆæ ‘" class="headerlink" title="æœ€å°ç”Ÿæˆæ ‘"></a>æœ€å°ç”Ÿæˆæ ‘</h3><h4 id="prime-ç®—æ³•"><a href="#prime-ç®—æ³•" class="headerlink" title="prime ç®—æ³•"></a>prime ç®—æ³•</h4><p><img src="/2018/03/21/%E5%9B%BE%E8%AE%BA/prime.gif" alt="avatar"></p>
<p>æ¯æ¬¡å‘æœ€å°ç”Ÿæˆæ ‘ä¸­åŠ å…¥æƒé‡æœ€å°çš„æ¨ªåˆ‡è¾¹ï¼Œæ¨ªåˆ‡è¾¹æ˜¯è¿æ¥æ ‘ä¸éæ ‘é¡¶ç‚¹çš„è¾¹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prim</span><span class="params">(adj_matrix)</span>:</span></span><br><span class="line">    <span class="string">"""ç»™å®šé‚»æ¥çŸ©é˜µï¼Œè¿”å›MSTæƒå€¼ï¼Œè¿”å›-1è¡¨ç¤ºå›¾ä¸è¿é€š"""</span></span><br><span class="line">    n = len(adj_matrix)  <span class="comment"># é¡¶ç‚¹0~n-1</span></span><br><span class="line">    vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">    low_cut = [float(<span class="string">'inf'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]  <span class="comment"># æ¨ªåˆ‡è¾¹çš„æƒé‡</span></span><br><span class="line"></span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line">    vis[<span class="number">0</span>] = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">        low_cut[i] = adj_matrix[<span class="number">0</span>][i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">        min_cut = float(<span class="string">'inf'</span>)</span><br><span class="line">        p = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> vis[j] <span class="keyword">and</span> min_cut &gt; low_cut[j]:</span><br><span class="line">                min_cut = low_cut[j]</span><br><span class="line">                p = j</span><br><span class="line">        <span class="keyword">if</span> min_cut == float(<span class="string">'inf'</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>  <span class="comment"># åŸå›¾ä¸è¿é€š</span></span><br><span class="line">        ans += min_cut</span><br><span class="line">        vis[p] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="comment"># æ¨ªåˆ‡è¾¹æ›´æ–°ä¸ºæ›´å°çš„æƒé‡</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> vis[j] <span class="keyword">and</span> low_cut[j] &gt; adj_matrix[p][j]:</span><br><span class="line">                low_cut[j] = adj_matrix[p][j]</span><br><span class="line">    <span class="keyword">return</span> ans</span><br></pre></td></tr></table></figure>
<h4 id="Kuskal-ç®—æ³•"><a href="#Kuskal-ç®—æ³•" class="headerlink" title="Kuskal ç®—æ³•"></a>Kuskal ç®—æ³•</h4><p><img src="/2018/03/21/%E5%9B%BE%E8%AE%BA/Kuskal.png" alt="avatar"></p>
<p>å°†å›¾ä¸­æ‰€æœ‰è¾¹æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºåŠ å…¥æœ€å°ç”Ÿæˆæ ‘ï¼ŒåŠ å…¥çš„è¾¹ä¸ä¼šä¸å·²åŠ å…¥çš„è¾¹æ„æˆæ¢ã€‚(åˆ©ç”¨å¹¶æŸ¥é›†UFåˆ¤æ–­è¿é€šæ€§)ï¼Œç›´åˆ°æ ‘ä¸­å«æœ‰n-1æ¡è¾¹ä¸ºæ­¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kruskal</span><span class="params">(edges, n)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    æ±‚æœ€å°ç”Ÿæˆæ ‘æƒå€¼</span></span><br><span class="line"><span class="string">    :param edges: [(u, v, w), ...]ï¼Œä¸‰å…ƒç»„å«ä¹‰(é¡¶ç‚¹uï¼Œé¡¶ç‚¹vï¼Œè¾¹æƒé‡w)</span></span><br><span class="line"><span class="string">    :param n: é¡¶ç‚¹æ•°ï¼Œé¡¶ç‚¹èŒƒå›´0~n-1</span></span><br><span class="line"><span class="string">    :return: æœ€å°ç”Ÿæˆæ ‘æƒå€¼ï¼ˆå›¾ä¸è¿é€šï¼Œè¿”å›-1ï¼‰</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    uf = UnionFind(n)  <span class="comment"># å¹¶æŸ¥é›†</span></span><br><span class="line">    edges.sort(key=<span class="keyword">lambda</span> item: item[<span class="number">2</span>])</span><br><span class="line">    edge_cnt = <span class="number">0</span></span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(edges)):</span><br><span class="line">        u, v, w = edges[i]</span><br><span class="line">        root_u, root_v = uf.find(u), uf.find(v)</span><br><span class="line">        <span class="keyword">if</span> root_u != root_v:</span><br><span class="line">            ans += w</span><br><span class="line">            uf.union(u, v)</span><br><span class="line">            edge_cnt += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> edge_cnt == n<span class="number">-1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> edge_cnt &lt; n<span class="number">-1</span>:  <span class="comment"># ä¸è¿é€š</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnionFind</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""å¹¶æŸ¥é›†ç±»"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        <span class="string">"""é•¿åº¦ä¸ºnçš„å¹¶æŸ¥é›†"""</span></span><br><span class="line">        self.uf = [<span class="number">-1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n + <span class="number">1</span>)]    <span class="comment"># åˆ—è¡¨0ä½ç½®ç©ºå‡º</span></span><br><span class="line">        self.sets_count = n                     <span class="comment"># åˆ¤æ–­å¹¶æŸ¥é›†é‡Œå…±æœ‰å‡ ä¸ªé›†åˆ, åˆå§‹åŒ–é»˜è®¤äº’ç›¸ç‹¬ç«‹</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># def find(self, p):</span></span><br><span class="line">    <span class="comment">#     """æŸ¥æ‰¾pçš„æ ¹ç»“ç‚¹(ç¥–å…ˆ)"""</span></span><br><span class="line">    <span class="comment">#     r = p                                   # åˆå§‹p</span></span><br><span class="line">    <span class="comment">#     while self.uf[p] &gt; 0:</span></span><br><span class="line">    <span class="comment">#         p = self.uf[p]</span></span><br><span class="line">    <span class="comment">#     while r != p:                           # è·¯å¾„å‹ç¼©, æŠŠæœç´¢ä¸‹æ¥çš„ç»“ç‚¹ç¥–å…ˆå…¨æŒ‡å‘æ ¹ç»“ç‚¹</span></span><br><span class="line">    <span class="comment">#         self.uf[r], r = p, self.uf[r]</span></span><br><span class="line">    <span class="comment">#     return p</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># def find(self, p):</span></span><br><span class="line">    <span class="comment">#     while self.uf[p] &gt;= 0:</span></span><br><span class="line">    <span class="comment">#         p = self.uf[p]</span></span><br><span class="line">    <span class="comment">#     return p</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(self, p)</span>:</span></span><br><span class="line">        <span class="string">"""å°¾é€’å½’"""</span></span><br><span class="line">        <span class="keyword">if</span> self.uf[p] &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line">        self.uf[p] = self.find(self.uf[p])</span><br><span class="line">        <span class="keyword">return</span> self.uf[p]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">union</span><span class="params">(self, p, q)</span>:</span></span><br><span class="line">        <span class="string">"""è¿é€šp,q è®©qæŒ‡å‘p"""</span></span><br><span class="line">        proot = self.find(p)</span><br><span class="line">        qroot = self.find(q)</span><br><span class="line">        <span class="keyword">if</span> proot == qroot:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">elif</span> self.uf[proot] &gt; self.uf[qroot]:   <span class="comment"># è´Ÿæ•°æ¯”è¾ƒ, å·¦è¾¹è§„æ¨¡æ›´å°</span></span><br><span class="line">            self.uf[qroot] += self.uf[proot]</span><br><span class="line">            self.uf[proot] = qroot</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.uf[proot] += self.uf[qroot]  <span class="comment"># è§„æ¨¡ç›¸åŠ </span></span><br><span class="line">            self.uf[qroot] = proot</span><br><span class="line">        self.sets_count -= <span class="number">1</span>                    <span class="comment"># è¿é€šåé›†åˆæ€»æ•°å‡ä¸€</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_connected</span><span class="params">(self, p, q)</span>:</span></span><br><span class="line">        <span class="string">"""åˆ¤æ–­pqæ˜¯å¦å·²ç»è¿é€š"""</span></span><br><span class="line">        <span class="keyword">return</span> self.find(p) == self.find(q)     <span class="comment"># å³åˆ¤æ–­ä¸¤ä¸ªç»“ç‚¹æ˜¯å¦æ˜¯å±äºåŒä¸€ä¸ªç¥–å…ˆ</span></span><br></pre></td></tr></table></figure>
<h3 id="æœ‰å‘å›¾"><a href="#æœ‰å‘å›¾" class="headerlink" title="æœ‰å‘å›¾"></a>æœ‰å‘å›¾</h3><h4 id="å®šä¹‰æ— å‘å›¾çš„æ•°æ®ç»“æ„"><a href="#å®šä¹‰æ— å‘å›¾çš„æ•°æ®ç»“æ„" class="headerlink" title="å®šä¹‰æ— å‘å›¾çš„æ•°æ®ç»“æ„"></a>å®šä¹‰æ— å‘å›¾çš„æ•°æ®ç»“æ„</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DiGraph</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        self.n = n</span><br><span class="line">        self.e = <span class="number">0</span></span><br><span class="line">        self.adj = [[] <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_edge</span><span class="params">(self, v, w)</span>:</span></span><br><span class="line">        self.adj[v].append(w)</span><br><span class="line">        self.e += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="æœ‰å‘å›¾åˆ¤ç¯"><a href="#æœ‰å‘å›¾åˆ¤ç¯" class="headerlink" title="æœ‰å‘å›¾åˆ¤ç¯"></a>æœ‰å‘å›¾åˆ¤ç¯</h4><p>å¯¹æœ‰å‘å›¾ä½¿ç”¨dfsæœç´¢ï¼Œç³»ç»Ÿè°ƒç”¨æ ˆè¡¨ç¤ºäº†å½“å‰éå†äº†çš„æœ‰å‘è·¯å¾„</p>
<p>è‹¥é€’å½’è¿‡ç¨‹è®¿é—®åˆ°å‡ºç°åœ¨æ ˆä¸­çš„èŠ‚ç‚¹ï¼Œåˆ™å›¾ä¸­å­˜åœ¨äº†ç¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DirectedCycle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, G)</span>:</span></span><br><span class="line">        self.on_stack = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.has_cycle = <span class="literal">False</span></span><br><span class="line">        self.G = G</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> range(G.n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[s]:</span><br><span class="line">                self.dfs(s)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(self, v)</span>:</span></span><br><span class="line">        self.on_stack[v] = <span class="literal">True</span></span><br><span class="line">        self.vis[v] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> self.G.adj[v]:</span><br><span class="line">            <span class="keyword">if</span> self.has_cycle:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="keyword">not</span> self.vis[w]:</span><br><span class="line">                self.dfs(w)</span><br><span class="line">            <span class="keyword">elif</span> self.on_stack[w]:</span><br><span class="line">                self.has_cycle = <span class="literal">True</span></span><br><span class="line">        self.on_stack[v] = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>ä¸€ä¸ªæœ‰å‘äº”ç¯å›¾çš„æ‹“æ‰‘æ’åºå³ä¸ºæ‰€æœ‰é¡¶ç‚¹dfsçš„é€†ååºæ’åˆ—</p>
<p>å¼ºè¿é€šæ€§ï¼šæœ‰å‘å›¾ä»»æ„ä¸¤ç‚¹äº’ç›¸å¯è¾¾ï¼Œåˆ™ä¸ºå¼ºè¿é€šå›¾ã€‚</p>
<p><strong>Kosaraju ç®—æ³•</strong>ï¼š</p>
<ol>
<li>æœ‰å‘å›¾Gç¿»è½¬å¾—åˆ°$G^R$</li>
<li>dfså¾—åˆ°$G^R$ä¸­é¡¶ç‚¹çš„é€†ååºæ’åˆ—</li>
<li>æŒ‰ç…§è¿™ä¸ªä½ ååºæ’åˆ—åœ¨Gä¸­æ‰§è¡Œæ ‡å‡†dfsï¼Œæ¯æ¬¡é€’å½’è°ƒç”¨æ‰€æ ‡è®°çš„é¡¶ç‚¹åœ¨åŒä¸€å¼ºè¿é€šåˆ†é‡é‡</li>
</ol>
<p><strong>æœ€çŸ­è·¯å¾„æ¯”è¾ƒã€æ€»ç»“</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç®—æ³•</th>
<th>æ¡ä»¶</th>
<th>å¹³å‡</th>
<th>æœ€å</th>
<th>ç©ºé—´å¤æ‚åº¦</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Dijkstra</td>
<td>è¾¹æƒä¸ºæ­£</td>
<td>$ElogV$</td>
<td>$ElogV$</td>
<td>$V$</td>
<td></td>
</tr>
<tr>
<td>æ‹“æ‰‘æ’åº</td>
<td>æ— ç¯</td>
<td>$E$</td>
<td>$E+V$</td>
<td>$V$</td>
<td>æ— ç¯å›¾æœ€ä¼˜ç®—æ³•</td>
</tr>
<tr>
<td>Bellman-Fordï¼ˆåŸºäºé˜Ÿåˆ—ï¼‰</td>
<td>æ— è´Ÿæƒé‡</td>
<td>$E+V$</td>
<td>$VE$</td>
<td>$V$</td>
</tr>
</tbody>
</table>
</div>
<p>Dijkstra ç®—æ³•ï¼šæ¯æ¬¡æ·»åŠ ç¦»èµ·ç‚¹æœ€è¿‘çš„éæ ‘èŠ‚ç‚¹</p>
<p>primï¼šæ¯æ¬¡æ·»åŠ ç¦»æ ‘æœ€è¿‘çš„éæ ‘èŠ‚ç‚¹</p>
<h4 id="å•æºæœ€çŸ­è·¯å¾„ï¼Œé‚»æ¥çŸ©é˜µå½¢å¼"><a href="#å•æºæœ€çŸ­è·¯å¾„ï¼Œé‚»æ¥çŸ©é˜µå½¢å¼" class="headerlink" title="å•æºæœ€çŸ­è·¯å¾„ï¼Œé‚»æ¥çŸ©é˜µå½¢å¼"></a>å•æºæœ€çŸ­è·¯å¾„ï¼Œé‚»æ¥çŸ©é˜µå½¢å¼</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dijkstra</span><span class="params">(adj_matrix, s)</span>:</span></span><br><span class="line">    <span class="string">"""ç»™å®šé‚»æ¥çŸ©é˜µå’Œèµ·ç‚¹sï¼Œè¿”å›såˆ°æ‰€æœ‰ç‚¹çš„æœ€çŸ­è·¯å¾„"""</span></span><br><span class="line">    n = len(adj_matrix)  <span class="comment"># é¡¶ç‚¹0~n-1</span></span><br><span class="line">    vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">    edge_to = [<span class="number">-1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]  <span class="comment"># è·¯å¾„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    dist = [float(<span class="string">'inf'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]  <span class="comment"># æœ€çŸ­è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">    dist[s] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        min_dist = float(<span class="string">'inf'</span>)</span><br><span class="line">        p = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> vis[j] <span class="keyword">and</span> dist[j] &lt; min_dist:</span><br><span class="line">                min_dist = dist[j]</span><br><span class="line">                p = j</span><br><span class="line">        <span class="keyword">if</span> p == <span class="number">-1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        vis[p] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> vis[j] <span class="keyword">and</span> dist[p] + adj_matrix[p][j] &lt; dist[j]:</span><br><span class="line">                dist[j] = dist[p] + adj_matrix[p][j]</span><br><span class="line">                edge_to[j] = p</span><br><span class="line">    <span class="keyword">return</span> dist, edge_to</span><br></pre></td></tr></table></figure>
<p>å•å…ƒæœ€çŸ­è·¯å¾„ï¼Œé‚»æ¥è¡¨å½¢å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dijkstra</span><span class="params">(adj, s)</span>:</span></span><br><span class="line">    n = len(adj)</span><br><span class="line">    dist = [float(<span class="string">'inf'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line"></span><br><span class="line">    dist[s] = <span class="number">0</span></span><br><span class="line">    pq = [(<span class="number">0</span>, s)]</span><br><span class="line">    <span class="keyword">while</span> pq:</span><br><span class="line">        <span class="comment"># u, væ˜¯é¡¶ç‚¹ï¼Œdæ˜¯è·ç¦»ï¼Œwæ˜¯è¾¹æƒé‡</span></span><br><span class="line">        d, u = heappop(pq)</span><br><span class="line">        <span class="keyword">if</span> d &gt; dist[u]:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> v, w <span class="keyword">in</span> adj[u]:</span><br><span class="line">            <span class="keyword">if</span> d + w &lt; dist[v]:</span><br><span class="line">                dist[v] = d + w</span><br><span class="line">                heappush(pq, (dist[v], v))</span><br><span class="line">    <span class="keyword">return</span> dist</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>å›¾è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜</title>
    <url>/2018/03/14/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜"><a href="#å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜" class="headerlink" title="å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜"></a>å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜</h2><p>ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²<code>S,P</code>,å…¶ä¸­<code>S</code>ä¸²é•¿åº¦ä¸º<code>n</code>ï¼Œ<code>P</code>ä¸²é•¿åº¦ä¸º<code>m</code>, <code>(m&lt;=n)</code>ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²<code>P</code>æ˜¯å¦æ˜¯<code>S</code>çš„å­ä¸²</p>
<h4 id="å¤æ‚åº¦"><a href="#å¤æ‚åº¦" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><p>å®¹æ˜“è®¡ç®—å¤æ‚åº¦ï¼š<code>O(m*n)</code></p>
<h3 id="Brute-Force-ç®€å•åŒ¹é…"><a href="#Brute-Force-ç®€å•åŒ¹é…" class="headerlink" title="Brute-Force(ç®€å•åŒ¹é…)"></a>Brute-Force(ç®€å•åŒ¹é…)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">naive_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    m, n = len(s), len(p)</span><br><span class="line">    <span class="keyword">if</span> m-n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m-n+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> s[i:i+n] == p:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="Rabin-Karpç®—æ³•"><a href="#Rabin-Karpç®—æ³•" class="headerlink" title="Rabin-Karpç®—æ³•"></a>Rabin-Karpç®—æ³•</h3><h4 id="æ€æƒ³"><a href="#æ€æƒ³" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4><p>åŸºæœ¬æ€æƒ³å’Œæš´åŠ›ç ´è§£ç®—æ³•æ˜¯ä¸€æ ·çš„ã€‚ä¹Ÿéœ€è¦ä¸€ä¸ªå¤§å°ä¸º<strong>m</strong>çš„çª—å£ï¼Œä½†æ˜¯ä¸ä¸€æ ·çš„æ˜¯ï¼Œä¸æ˜¯ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªé•¿åº¦ä¸º<strong>m</strong>çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æ¯”è¾ƒä»–ä»¬çš„å“ˆå¸Œå€¼ã€‚</p>
<h4 id="å¤æ‚åº¦åˆ†æ"><a href="#å¤æ‚åº¦åˆ†æ" class="headerlink" title="å¤æ‚åº¦åˆ†æ"></a>å¤æ‚åº¦åˆ†æ</h4><p>ä¸€å…±ä¼šæœ‰(<strong>n-m+1</strong>)ä¸ªçª—å£æ»‘åŠ¨ï¼Œè¿™ä¸€æ­¥çš„å¤æ‚åº¦æ˜¯<strong>O(n)</strong>ã€‚</p>
<p>è®¡ç®—å“ˆå¸Œå€¼:</p>
<p>å‡è®¾ç°åœ¨çª—å£çš„èµ·ç‚¹åœ¨<strong>j</strong>è¿™ä¸ªä½ç½®ï¼Œæ­¤æ—¶çª—å£å†…çš„å­—ç¬¦ä¸²å“ˆå¸Œå€¼ä¸ºï¼Œ</p>
<script type="math/tex; mode=display">
H(S, j)=\sum_{i=0}^{m-1} \alpha^{m-(i+1)} \times \operatorname{char}\left(s_{i}\right)</script><p>é‚£ä¹ˆï¼Œå½“è®¡ç®—ä¸‹ä¸€ä¸ªçª—å£çš„å“ˆå¸Œå€¼æ—¶ï¼Œä¹Ÿå°±æ˜¯å½“çª—å£çš„èµ·ç‚¹ä¸º<strong>j+1</strong>æ—¶ï¼Œå“ˆå¸Œå‡½æ•°å€¼å¯ç”±å¦‚ä¸‹æ–¹æ³•è®¡ç®—ï¼š</p>
<script type="math/tex; mode=display">
H(S, j+1)=\alpha\left(H(S, j)-\alpha^{m-1} \operatorname{char}\left(s_{j}\right)\right)+\operatorname{char}\left(s_{j+m}\right)</script><p>è¿™æ ·çœ‹æ¥ï¼Œåœ¨è®¡ç®—å‡ºç¬¬ä¸€ä¸ªçª—å£çš„å‡½æ•°å€¼ä¹‹åï¼Œåé¢çš„æ¯ä¸€ä¸ªçª—å£å“ˆå¸Œå€¼éƒ½å¯ä»¥æ ¹æ®ä¸Šè¿°å…¬å¼è®¡ç®—ï¼Œåªéœ€è¦åšä¸€æ¬¡å‡æ³•ï¼Œä¸€æ¬¡ä¹˜æ³•ï¼Œä¸€æ¬¡åŠ æ³•ã€‚ä¹‹åçš„æ¯ä¸€æ¬¡å“ˆå¸Œå€¼è®¡ç®—éƒ½æ˜¯<strong>O(1)</strong>çš„å¤æ‚åº¦ã€‚æ‰€ä»¥è®¡ç®—ç¬¬ä¸€ä¸ªçª—å£çš„å¤æ‚åº¦ï¼Œ<strong>O(m)</strong>ï¼Œæ­¤åè®¡ç®—æ¯ä¸€ä¸ªçª—å£çš„å¤æ‚åº¦<strong>O(1)</strong>ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦ï¼š<code>O(n+m)</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rabin_karp_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    n = len(s)</span><br><span class="line">    m = len(p)</span><br><span class="line">    h1 = hash(p)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, n-m+<span class="number">1</span>):</span><br><span class="line">        h2 = hash(s[i:i+m])</span><br><span class="line">        <span class="keyword">if</span> h1 != h2:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> s[i:i+m] == p:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<h3 id="KMPç®—æ³•"><a href="#KMPç®—æ³•" class="headerlink" title="KMPç®—æ³•"></a>KMPç®—æ³•</h3><p>æœ‰ç‚¹å¤æ‚ï¼Œæœ‰æ—¶é—´å†å†™ä¸Šã€‚</p>
<h4 id="æ€æƒ³-1"><a href="#æ€æƒ³-1" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4><h4 id="å¤æ‚åº¦åˆ†æ-1"><a href="#å¤æ‚åº¦åˆ†æ-1" class="headerlink" title="å¤æ‚åº¦åˆ†æ"></a>å¤æ‚åº¦åˆ†æ</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># KMPç®—æ³•ï¼š</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kmp_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    m, n = len(s), len(p)</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span> <span class="keyword">or</span> m - n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    table = partial_table(p)</span><br><span class="line">    i, cur = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> i &lt; m-n+<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> p[cur] == s[i+cur]:</span><br><span class="line">            cur += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> cur == <span class="number">0</span>:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                i += cur - table[cur<span class="number">-1</span>]  <span class="comment"># ç§»åŠ¨ä½æ•°=å·²åŒ¹é…çš„å­—ç¬¦æ•°-å¯¹åº”çš„éƒ¨åˆ†åŒ¹é…å€¼</span></span><br><span class="line">                cur = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> cur == n:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">partial_table</span><span class="params">(p)</span>:</span></span><br><span class="line">    m = len(p)</span><br><span class="line">    table = [<span class="number">0</span>] * m</span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> q <span class="keyword">in</span> range(<span class="number">1</span>, m):</span><br><span class="line">        <span class="keyword">if</span> p[k] == p[q]:</span><br><span class="line">            k = k + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            k = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> p[k] == p[q]:</span><br><span class="line">                k = k + <span class="number">1</span></span><br><span class="line">        table[q] = k</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> table</span><br></pre></td></tr></table></figure>
<h3 id="Horspoolç®—æ³•"><a href="#Horspoolç®—æ³•" class="headerlink" title="Horspoolç®—æ³•"></a>Horspoolç®—æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shift_table</span><span class="params">(p)</span>:</span></span><br><span class="line">    <span class="comment"># ç”Ÿæˆ Horspool ç®—æ³•çš„ç§»åŠ¨è¡¨</span></span><br><span class="line">    <span class="comment"># å½“å‰æ£€æµ‹å­—ç¬¦ä¸ºcï¼Œæ¨¡å¼é•¿åº¦ä¸ºm</span></span><br><span class="line">    <span class="comment"># å¦‚æœå½“å‰cä¸åŒ…å«åœ¨æ¨¡å¼çš„å‰m-1ä¸ªå­—ç¬¦ä¸­ï¼Œç§»åŠ¨æ¨¡å¼çš„é•¿åº¦m</span></span><br><span class="line">    <span class="comment"># å…¶ä»–æƒ…å†µä¸‹ç§»åŠ¨æœ€å³è¾¹çš„çš„cåˆ°æ¨¡å¼æœ€åä¸€ä¸ªå­—ç¬¦çš„è·ç¦»</span></span><br><span class="line">    <span class="comment"># from collections import defaultdict</span></span><br><span class="line">    <span class="comment"># table = defaultdict(lambda: len(p))</span></span><br><span class="line">    table = dict()</span><br><span class="line">    <span class="comment"># print table</span></span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> range(<span class="number">0</span>, len(p) - <span class="number">1</span>):</span><br><span class="line">        table[p[index]] = len(p) - <span class="number">1</span> - index</span><br><span class="line">    <span class="comment"># print table</span></span><br><span class="line">    <span class="keyword">return</span> table</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">horspool_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    m, n = len(s), len(p)</span><br><span class="line">    table = shift_table(p)</span><br><span class="line">    index = len(p) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> index &lt;= m - <span class="number">1</span>:</span><br><span class="line">        <span class="comment"># print("start matching at", index)</span></span><br><span class="line">        match_count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> match_count &lt; n <span class="keyword">and</span> p[n - <span class="number">1</span> - match_count] == s[index - match_count]:</span><br><span class="line">            match_count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> match_count == len(p):</span><br><span class="line">            <span class="keyword">return</span> index - match_count + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># print s[index], table.get(s[index])</span></span><br><span class="line">            <span class="keyword">if</span> table.get(s[index]) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                table[s[index]] = n</span><br><span class="line">            index += table[s[index]]</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<h3 id="Sunday-ç®—æ³•"><a href="#Sunday-ç®—æ³•" class="headerlink" title="Sunday ç®—æ³•"></a>Sunday ç®—æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sunday_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    char_pos = dict()</span><br><span class="line">    <span class="keyword">for</span> i, ch <span class="keyword">in</span> enumerate(p):</span><br><span class="line">        char_pos[ch] = i</span><br><span class="line">    <span class="comment"># print "char_pos:", char_pos</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    m, n = len(s), len(p)</span><br><span class="line">    <span class="keyword">while</span> i &lt;= m - n:</span><br><span class="line">        found = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j, ch <span class="keyword">in</span> enumerate(p):</span><br><span class="line">            <span class="keyword">if</span> s[i + j] != ch:</span><br><span class="line">                found = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">if</span> (i + n) &lt; m:</span><br><span class="line">                    <span class="keyword">if</span> s[i + n] <span class="keyword">not</span> <span class="keyword">in</span> char_pos:</span><br><span class="line">                        i += (n + <span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        i += (n - char_pos[s[i + n]])</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<h3 id="Boyer-Mooreç®—æ³•"><a href="#Boyer-Mooreç®—æ³•" class="headerlink" title="Boyer_Mooreç®—æ³•"></a>Boyer_Mooreç®—æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">boyer_moore_search</span><span class="params">(string, des)</span>:</span></span><br><span class="line">    l = len(des) - <span class="number">1</span></span><br><span class="line">    strlen = len(string) - <span class="number">1</span></span><br><span class="line">    start, end = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> strlen &gt;= <span class="number">0</span>:</span><br><span class="line">        end = start + len(des)</span><br><span class="line">        <span class="comment"># print string[start:end]</span></span><br><span class="line">        cr = compare(string[start:end], des)</span><br><span class="line">        <span class="keyword">if</span> cr[<span class="number">0</span>] == <span class="number">-2</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'not found'</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> cr[<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># return end - l</span></span><br><span class="line">            <span class="keyword">return</span> start</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pos = is_character_in(des, cr[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> cr[<span class="number">0</span>] == (len(des) - <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> pos != <span class="number">-1</span>:</span><br><span class="line">                    start += len(des) - <span class="number">1</span> - pos</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    start += len(des)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> pos == <span class="number">-1</span>:</span><br><span class="line">                    <span class="comment">#  have good  string</span></span><br><span class="line">                    goodPos = is_character_in(des, des[l])</span><br><span class="line">                    <span class="keyword">if</span> goodPos == l:</span><br><span class="line">                        start += l + <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        start += l - goodPos</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_character_in</span><span class="params">(s, c)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> pos <span class="keyword">in</span> range(len(s)):</span><br><span class="line">        <span class="keyword">if</span> s[pos] == c:</span><br><span class="line">            <span class="keyword">return</span> pos</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare</span><span class="params">(str1, str2)</span>:</span></span><br><span class="line">    l1 = len(str1) - <span class="number">1</span></span><br><span class="line">    l2 = len(str2) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> l1 != l2:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> l1 &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> str1[l1] != str2[l1]:</span><br><span class="line">            <span class="keyword">return</span> l1, str1[l1]</span><br><span class="line">        l1 -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<h3 id="BMHBNFSç®—æ³•ï¼ˆå¿«é€ŸåŒ¹é…ç®—æ³•ï¼‰"><a href="#BMHBNFSç®—æ³•ï¼ˆå¿«é€ŸåŒ¹é…ç®—æ³•ï¼‰" class="headerlink" title="BMHBNFSç®—æ³•ï¼ˆå¿«é€ŸåŒ¹é…ç®—æ³•ï¼‰"></a>BMHBNFSç®—æ³•ï¼ˆå¿«é€ŸåŒ¹é…ç®—æ³•ï¼‰</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_skip</span><span class="params">(p)</span>:</span></span><br><span class="line">    m = len(p)</span><br><span class="line">    a = p[m<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m<span class="number">-2</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        <span class="keyword">if</span> p[i] == a:</span><br><span class="line">            <span class="keyword">return</span> m<span class="number">-2</span>-i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bmhbnfs_find</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    <span class="comment"># find first occurrence of p in s</span></span><br><span class="line">    m = len(s)</span><br><span class="line">    n = len(p)</span><br><span class="line">    <span class="comment"># skipæ˜¯æŠŠç¦»p[m-1]æœ€è¿‘ä¸”å­—ç¬¦ç›¸åŒçš„å­—ç¬¦ç§»åˆ°m-1ä½éœ€è¦è·³è¿‡çš„æ­¥æ•°-1</span></span><br><span class="line">    <span class="comment"># skip = delta1(p)[p[m - 1]]</span></span><br><span class="line">    skip = compute_skip(p)</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt;= m - n:</span><br><span class="line">        <span class="keyword">if</span> s[i + n - <span class="number">1</span>] == p[n - <span class="number">1</span>]:  <span class="comment"># (boyer-moore)</span></span><br><span class="line">            <span class="comment"># potential match</span></span><br><span class="line">            <span class="keyword">if</span> s[i:i + n - <span class="number">1</span>] == p[:n - <span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">            <span class="keyword">if</span> s[i + n] <span class="keyword">not</span> <span class="keyword">in</span> p:</span><br><span class="line">                i = i + n + <span class="number">1</span>  <span class="comment"># (sunday)</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                i = i + skip  <span class="comment"># (horspool)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># skip</span></span><br><span class="line">            <span class="keyword">if</span> s[i + n] <span class="keyword">not</span> <span class="keyword">in</span> p:</span><br><span class="line">                i = i + n + <span class="number">1</span>  <span class="comment"># (sunday)</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                i = i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>  <span class="comment"># not found</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>å­—ç¬¦ä¸²åŒ¹é…</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ¨æ€è§„åˆ’</title>
    <url>/2018/03/09/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2018/03/09/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/dynamic_programming.png" alt="avatar"></p>
<a id="more"></a>
<h2 id="åŸºæœ¬æ€è·¯"><a href="#åŸºæœ¬æ€è·¯" class="headerlink" title="åŸºæœ¬æ€è·¯"></a>åŸºæœ¬æ€è·¯</h2><h3 id="æ€è€ƒçŠ¶æ€"><a href="#æ€è€ƒçŠ¶æ€" class="headerlink" title="æ€è€ƒçŠ¶æ€"></a>æ€è€ƒçŠ¶æ€</h3><p>çŠ¶æ€å…ˆå°è¯•â€œé¢˜ç›®é—®ä»€ä¹ˆï¼Œå°±æŠŠä»€ä¹ˆè®¾ç½®ä¸ºçŠ¶æ€â€ã€‚ç„¶åè€ƒè™‘â€œçŠ¶æ€å¦‚ä½•è½¬ç§»â€ï¼Œå¦‚æœâ€œçŠ¶æ€è½¬ç§»æ–¹ç¨‹â€ä¸å®¹æ˜“å¾—åˆ°ï¼Œå°è¯•ä¿®æ”¹å®šä¹‰ï¼Œç›®çš„ä»ç„¶æ˜¯ä¸ºäº†æ–¹ä¾¿å¾—åˆ°â€œçŠ¶æ€è½¬ç§»æ–¹ç¨‹â€ã€‚</p>
<h3 id="æ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ˆæ ¸å¿ƒã€éš¾ç‚¹ï¼‰"><a href="#æ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ˆæ ¸å¿ƒã€éš¾ç‚¹ï¼‰" class="headerlink" title="æ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ˆæ ¸å¿ƒã€éš¾ç‚¹ï¼‰"></a>æ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ˆæ ¸å¿ƒã€éš¾ç‚¹ï¼‰</h3><p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ˜¯éå¸¸é‡è¦çš„ï¼Œæ˜¯åŠ¨æ€è§„åˆ’çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯éš¾ç‚¹ï¼Œèµ·åˆ°æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ã€‚</p>
<blockquote>
<p>æŠ€å·§æ˜¯åˆ†ç±»è®¨è®ºã€‚å¯¹çŠ¶æ€ç©ºé—´è¿›è¡Œåˆ†ç±»ï¼Œæ€è€ƒæœ€ä¼˜å­ç»“æ„åˆ°åº•æ˜¯ä»€ä¹ˆã€‚å³å¤§é—®é¢˜çš„æœ€ä¼˜è§£å¦‚ä½•ç”±å°é—®é¢˜çš„æœ€ä¼˜è§£å¾—åˆ°ã€‚</p>
</blockquote>
<p>å½’çº³â€œçŠ¶æ€è½¬ç§»æ–¹ç¨‹â€æ˜¯ä¸€ä¸ªå¾ˆçµæ´»çš„äº‹æƒ…ï¼Œå¾—å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œé™¤äº†æŒæ¡ç»å…¸çš„åŠ¨æ€è§„åˆ’é—®é¢˜ä»¥å¤–ï¼Œè¿˜éœ€è¦å¤šåšé¢˜ã€‚å¦‚æœæ˜¯é’ˆå¯¹é¢è¯•ï¼Œè¯·è‡ªè¡ŒæŠŠæ¡éš¾åº¦ï¼Œæˆ‘ä¸ªäººè§‰å¾—æŒæ¡å¸¸è§é—®é¢˜çš„åŠ¨æ€è§„åˆ’è§£æ³•ï¼Œæ˜ç™½åŠ¨æ€è§„åˆ’çš„æœ¬è´¨å°±æ˜¯æ‰“è¡¨æ ¼ï¼Œä»ä¸€ä¸ªå°è§„æ¨¡é—®é¢˜å‡ºå‘ï¼Œé€æ­¥å¾—åˆ°å¤§é—®é¢˜çš„è§£ï¼Œå¹¶è®°å½•è¿‡ç¨‹ã€‚åŠ¨æ€è§„åˆ’ä¾ç„¶æ˜¯â€œç©ºé—´æ¢æ—¶é—´â€æ€æƒ³çš„ä½“ç°ã€‚</p>
<h3 id="æ€è€ƒåˆå§‹åŒ–"><a href="#æ€è€ƒåˆå§‹åŒ–" class="headerlink" title="æ€è€ƒåˆå§‹åŒ–"></a>æ€è€ƒåˆå§‹åŒ–</h3><p>åˆå§‹åŒ–æ˜¯éå¸¸é‡è¦çš„ï¼Œä¸€æ­¥é”™ï¼Œæ­¥æ­¥é”™ï¼Œåˆå§‹åŒ–çŠ¶æ€ä¸€å®šè¦è®¾ç½®å¯¹ï¼Œæ‰å¯èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚</p>
<p>è§’åº¦ 1ï¼šç›´æ¥ä»çŠ¶æ€çš„è¯­ä¹‰å‡ºå‘ï¼›</p>
<p>è§’åº¦ 2ï¼šå¦‚æœçŠ¶æ€çš„è¯­ä¹‰ä¸å¥½æ€è€ƒï¼Œå°±è€ƒè™‘â€œçŠ¶æ€è½¬ç§»æ–¹ç¨‹â€çš„è¾¹ç•Œéœ€è¦ä»€ä¹ˆæ ·åˆå§‹åŒ–çš„æ¡ä»¶ï¼›</p>
<p>è§’åº¦ 3ï¼šä»â€œçŠ¶æ€è½¬ç§»æ–¹ç¨‹â€æ–¹ç¨‹çš„ä¸‹æ ‡çœ‹æ˜¯å¦éœ€è¦å¤šè®¾ç½®ä¸€è¡Œã€ä¸€åˆ—è¡¨ç¤ºâ€œå“¨å…µâ€ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€äº›è¾¹ç•Œçš„è®¨è®ºï¼Œä½¿å¾—ä»£ç å˜å¾—æ¯”è¾ƒçŸ­ã€‚</p>
<h3 id="æ€è€ƒè¾“å‡º"><a href="#æ€è€ƒè¾“å‡º" class="headerlink" title="æ€è€ƒè¾“å‡º"></a>æ€è€ƒè¾“å‡º</h3><p>æœ‰äº›æ—¶å€™æ˜¯æœ€åä¸€ä¸ªçŠ¶æ€ï¼Œæœ‰äº›æ—¶å€™å¯èƒ½ä¼šç»¼åˆæ‰€æœ‰è®¡ç®—è¿‡çš„çŠ¶æ€ã€‚</p>
<h3 id="æ€è€ƒçŠ¶æ€å‹ç¼©"><a href="#æ€è€ƒçŠ¶æ€å‹ç¼©" class="headerlink" title="æ€è€ƒçŠ¶æ€å‹ç¼©"></a>æ€è€ƒçŠ¶æ€å‹ç¼©</h3><p>  â€œçŠ¶æ€å‹ç¼©â€ä¼šä½¿å¾—ä»£ç éš¾äºç†è§£ï¼Œåˆå­¦çš„æ—¶å€™å¯ä»¥ä¸ä¸€æ­¥åˆ°ä½ã€‚å…ˆæŠŠä»£ç å†™æ­£ç¡®ï¼Œç„¶åå†æ€è€ƒçŠ¶æ€å‹ç¼©ã€‚</p>
<p>  çŠ¶æ€å‹ç¼©åœ¨æœ‰ä¸€ç§æƒ…å†µä¸‹æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œé‚£å°±æ˜¯çŠ¶æ€ç©ºé—´éå¸¸åºå¤§çš„æ—¶å€™ï¼ˆå¤„ç†æµ·é‡æ•°æ®ï¼‰ï¼Œæ­¤æ—¶ç©ºé—´ä¸å¤Ÿç”¨ï¼Œå°±å¿…é¡»çŠ¶æ€å‹ç¼©ã€‚</p>
<hr>
<h2 id="é¢˜ç›®ï¼ˆLeetCodeï¼‰"><a href="#é¢˜ç›®ï¼ˆLeetCodeï¼‰" class="headerlink" title="é¢˜ç›®ï¼ˆLeetCodeï¼‰"></a>é¢˜ç›®ï¼ˆLeetCodeï¼‰</h2><h3 id="5-æœ€é•¿å›æ–‡å­ä¸²"><a href="#5-æœ€é•¿å›æ–‡å­ä¸²" class="headerlink" title="5. æœ€é•¿å›æ–‡å­ä¸²"></a>5. <a href="https://leetcode-cn.com/problems/longest-palindromic-substring/" target="_blank" rel="noopener">æœ€é•¿å›æ–‡å­ä¸²</a></h3><p>æè¿°ï¼šç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ° s ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚ä½ å¯ä»¥å‡è®¾ s çš„æœ€å¤§é•¿åº¦ä¸º 1000ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<p>è¾“å…¥: â€œbabadâ€</p>
<p>è¾“å‡º: â€œbabâ€</p>
<p>æ³¨æ„: â€œabaâ€ ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆç­”æ¡ˆã€‚</p>
<p>ç¤ºä¾‹ 2ï¼š</p>
<p>è¾“å…¥: â€œcbbdâ€</p>
<p>è¾“å‡º: â€œbbâ€</p>
<p>â€œåŠ¨æ€è§„åˆ’â€æœ€å…³é”®çš„æ­¥éª¤æ˜¯æƒ³æ¸…æ¥šâ€œçŠ¶æ€å¦‚ä½•è½¬ç§»â€ï¼Œäº‹å®ä¸Šï¼Œâ€œå›æ–‡â€æ˜¯å¤©ç„¶å…·æœ‰â€œçŠ¶æ€è½¬ç§»â€æ€§è´¨çš„ï¼š</p>
<blockquote>
<p>ä¸€ä¸ªå›æ–‡å»æ‰ä¸¤å¤´ä»¥åï¼Œå‰©ä¸‹çš„éƒ¨åˆ†ä¾ç„¶æ˜¯å›æ–‡ï¼ˆè¿™é‡Œæš‚ä¸è®¨è®ºè¾¹ç•Œï¼‰ã€‚</p>
</blockquote>
<p>ä¾ç„¶ä»å›æ–‡ä¸²çš„å®šä¹‰å±•å¼€è®¨è®ºï¼š</p>
<ol>
<li><p>å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²çš„å¤´å°¾ä¸¤ä¸ªå­—ç¬¦éƒ½ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²ä¸€å®šä¸æ˜¯å›æ–‡ä¸²ï¼›</p>
</li>
<li><p>å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²çš„å¤´å°¾ä¸¤ä¸ªå­—ç¬¦ç›¸ç­‰ï¼Œæ‰æœ‰å¿…è¦ç»§ç»­åˆ¤æ–­ä¸‹å»ã€‚</p>
</li>
<li><p>å¦‚æœé‡Œé¢çš„å­ä¸²æ˜¯å›æ–‡ï¼Œæ•´ä½“å°±æ˜¯å›æ–‡ä¸²ï¼›</p>
</li>
<li><p>å¦‚æœé‡Œé¢çš„å­ä¸²ä¸æ˜¯å›æ–‡ä¸²ï¼Œæ•´ä½“å°±ä¸æ˜¯å›æ–‡ä¸²ã€‚</p>
</li>
</ol>
<p>å³åœ¨å¤´å°¾å­—ç¬¦ç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œé‡Œé¢å­ä¸²çš„å›æ–‡æ€§è´¨æ®å®šäº†æ•´ä¸ªå­ä¸²çš„å›æ–‡æ€§è´¨ï¼Œè¿™å°±æ˜¯çŠ¶æ€è½¬ç§»ã€‚å› æ­¤å¯ä»¥æŠŠâ€œçŠ¶æ€â€å®šä¹‰ä¸ºåŸå­—ç¬¦ä¸²çš„ä¸€ä¸ªå­ä¸²æ˜¯å¦ä¸ºå›æ–‡å­ä¸²ã€‚</p>
<h4 id="ç¬¬-1-æ­¥ï¼šå®šä¹‰çŠ¶æ€"><a href="#ç¬¬-1-æ­¥ï¼šå®šä¹‰çŠ¶æ€" class="headerlink" title="ç¬¬ 1 æ­¥ï¼šå®šä¹‰çŠ¶æ€"></a>ç¬¬ 1 æ­¥ï¼šå®šä¹‰çŠ¶æ€</h4><p><code>dp[i][j]</code> è¡¨ç¤ºå­ä¸² <code>s[i,j]</code> æ˜¯å¦ä¸ºå›æ–‡å­ä¸²ã€‚</p>
<h4 id="ç¬¬-2-æ­¥ï¼šæ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹"><a href="#ç¬¬-2-æ­¥ï¼šæ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹" class="headerlink" title="ç¬¬ 2 æ­¥ï¼šæ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹"></a>ç¬¬ 2 æ­¥ï¼šæ€è€ƒçŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><p>è¿™ä¸€æ­¥åœ¨åšåˆ†ç±»è®¨è®ºï¼ˆæ ¹æ®å¤´å°¾å­—ç¬¦æ˜¯å¦ç›¸ç­‰ï¼‰ï¼Œæ ¹æ®ä¸Šé¢çš„åˆ†æå¾—åˆ°ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">dp[<span class="string">i</span>][<span class="symbol">j</span>] = (s[<span class="string">i</span>] == s[<span class="string">j</span>]) and dp[<span class="string">i + 1</span>][<span class="symbol">j - 1</span>]</span><br></pre></td></tr></table></figure>
<p>åˆ†æï¼š</p>
<ol>
<li><p><code>i</code> å’Œ <code>j</code> çš„å…³ç³»æ˜¯ <code>i &lt;= j</code>ï¼Œå› æ­¤ï¼Œåªéœ€è¦å¡«è¿™å¼ è¡¨çš„ä¸ŠåŠéƒ¨åˆ†ï¼›</p>
</li>
<li><p>çœ‹åˆ° <code>dp[i + 1][j - 1]</code> å°±å¾—è€ƒè™‘è¾¹ç•Œæƒ…å†µã€‚è¾¹ç•Œæ¡ä»¶æ˜¯ï¼šè¡¨è¾¾å¼ <code>[i + 1, j - 1]</code>ä¸æ„æˆåŒºé—´ï¼Œå³é•¿åº¦ä¸¥æ ¼å°äº 2ï¼Œå³<code>j - 1 - (i + 1) + 1 &lt; 2</code> ï¼Œæ•´ç†å¾— <code>j - i &lt; 3</code>ã€‚</p>
</li>
</ol>
<p>è¿™ä¸ªç»“è®ºå¾ˆæ˜¾ç„¶ï¼šå½“å­ä¸² <code>s[i, j]</code> çš„é•¿åº¦ç­‰äº 2 æˆ–è€…ç­‰äº 3 çš„æ—¶å€™ï¼Œæˆ‘å…¶å®åªéœ€è¦åˆ¤æ–­ä¸€ä¸‹å¤´å°¾ä¸¤ä¸ªå­—ç¬¦æ˜¯å¦ç›¸ç­‰å°±å¯ä»¥ç›´æ¥ä¸‹ç»“è®ºäº†ã€‚</p>
<ul>
<li><p>å¦‚æœå­ä¸² <code>s[i + 1, j - 1]</code> åªæœ‰ 1 ä¸ªå­—ç¬¦ï¼Œå³å»æ‰ä¸¤å¤´ï¼Œå‰©ä¸‹ä¸­é—´éƒ¨åˆ†åªæœ‰ 1 ä¸ªå­—ç¬¦ï¼Œå½“ç„¶æ˜¯å›æ–‡ï¼›</p>
</li>
<li><p>å¦‚æœå­ä¸² <code>s[i + 1, j - 1]</code> ä¸ºç©ºä¸²ï¼Œé‚£ä¹ˆå­ä¸² <code>s[i, j]</code> ä¸€å®šæ˜¯å›æ–‡å­ä¸²ã€‚</p>
</li>
</ul>
<p>å› æ­¤ï¼Œåœ¨ <code>s[i] == s[j]</code> æˆç«‹å’Œ <code>j - i &lt; 3</code> çš„å‰æä¸‹ï¼Œç›´æ¥å¯ä»¥ä¸‹ç»“è®ºï¼Œ<code>dp[i][j] = true</code>ï¼Œå¦åˆ™æ‰æ‰§è¡ŒçŠ¶æ€è½¬ç§»ã€‚</p>
<h4 id="ç¬¬-3-æ­¥-è€ƒè™‘åˆå§‹åŒ–"><a href="#ç¬¬-3-æ­¥-è€ƒè™‘åˆå§‹åŒ–" class="headerlink" title="ç¬¬ 3 æ­¥:è€ƒè™‘åˆå§‹åŒ–"></a>ç¬¬ 3 æ­¥:è€ƒè™‘åˆå§‹åŒ–</h4><p>åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå•ä¸ªå­—ç¬¦ä¸€å®šæ˜¯å›æ–‡ä¸²ï¼Œå› æ­¤æŠŠå¯¹è§’çº¿å…ˆåˆå§‹åŒ–ä¸º 1ï¼Œå³ <code>dp[i][i] = 1</code>ã€‚</p>
<h4 id="ç¬¬-4-æ­¥-è€ƒè™‘è¾“å‡º"><a href="#ç¬¬-4-æ­¥-è€ƒè™‘è¾“å‡º" class="headerlink" title="ç¬¬ 4 æ­¥:è€ƒè™‘è¾“å‡º"></a>ç¬¬ 4 æ­¥:è€ƒè™‘è¾“å‡º</h4><p>åªè¦ä¸€å¾—åˆ° <code>dp[i][j] = true</code>ï¼Œå°±è®°å½•å­ä¸²çš„é•¿åº¦å’Œèµ·å§‹ä½ç½®ï¼Œæ²¡æœ‰å¿…è¦æˆªå–ï¼Œå› ä¸ºæˆªå–å­—ç¬¦ä¸²ä¹Ÿè¦æ¶ˆè€—æ€§èƒ½ï¼Œè®°å½•æ­¤æ—¶çš„å›æ–‡å­ä¸²çš„â€œèµ·å§‹ä½ç½®â€å’Œâ€œå›æ–‡é•¿åº¦â€å³å¯ã€‚</p>
<h4 id="ç¬¬-5-æ­¥-è€ƒè™‘çŠ¶æ€æ˜¯å¦å¯ä»¥å‹ç¼©"><a href="#ç¬¬-5-æ­¥-è€ƒè™‘çŠ¶æ€æ˜¯å¦å¯ä»¥å‹ç¼©" class="headerlink" title="ç¬¬ 5 æ­¥:è€ƒè™‘çŠ¶æ€æ˜¯å¦å¯ä»¥å‹ç¼©"></a>ç¬¬ 5 æ­¥:è€ƒè™‘çŠ¶æ€æ˜¯å¦å¯ä»¥å‹ç¼©</h4><p>åœ¨å¡«è¡¨çš„è¿‡ç¨‹ä¸­ï¼Œåªå‚è€ƒäº†å·¦ä¸‹æ–¹çš„æ•°å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">longestPalindrome</span><span class="params">(self,s)</span>:</span></span><br><span class="line"></span><br><span class="line">size = len(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> size &lt; <span class="number">2</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">dp = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(size)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(size)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(size):</span><br><span class="line"></span><br><span class="line">dp[_][_] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">start_idx = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">max_len = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,size):</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(j):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s[i] == s[j]:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> j - i &lt; <span class="number">3</span>: <span class="comment"># i,j ä¹‹é—´åªæœ‰ä¸€ä¸ªå­—ç¬¦æˆ–è€…æ²¡æœ‰å­—ç¬¦</span></span><br><span class="line"></span><br><span class="line">dp[i][j] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">dp[i][j] = dp[i+<span class="number">1</span>][j<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dp[i][j] == <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">cur_len = j - i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> cur_len &gt; max_len:</span><br><span class="line"></span><br><span class="line">max_len = cur_len</span><br><span class="line"></span><br><span class="line">start_idx = i</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> s[start_idx:start_idx+max_len]</span><br></pre></td></tr></table></figure>
<h3 id="1143-æœ€é•¿å…¬å…±å­åºåˆ—"><a href="#1143-æœ€é•¿å…¬å…±å­åºåˆ—" class="headerlink" title="1143. æœ€é•¿å…¬å…±å­åºåˆ—"></a>1143. <a href="https://leetcode-cn.com/problems/longest-common-subsequence/" target="_blank" rel="noopener">æœ€é•¿å…¬å…±å­åºåˆ—</a></h3><p>æè¿°ï¼šç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² text1 å’Œ text2ï¼Œè¿”å›è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—ã€‚ä¸€ä¸ªå­—ç¬¦ä¸²çš„ å­åºåˆ—æ˜¯æŒ‡è¿™æ ·ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼šå®ƒæ˜¯ç”±åŸå­—ç¬¦ä¸²åœ¨ä¸æ”¹å˜å­—ç¬¦çš„ç›¸å¯¹é¡ºåºçš„æƒ…å†µä¸‹åˆ é™¤æŸäº›å­—ç¬¦ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ä»»ä½•å­—ç¬¦ï¼‰åç»„æˆçš„æ–°å­—ç¬¦ä¸²ã€‚</p>
<p>ä¾‹å¦‚ï¼Œâ€aceâ€ æ˜¯ â€œabcdeâ€ çš„å­åºåˆ—ï¼Œä½† â€œaecâ€ ä¸æ˜¯ â€œabcdeâ€ çš„å­åºåˆ—ã€‚ä¸¤ä¸ªå­—ç¬¦ä¸²çš„ã€Œå…¬å…±å­åºåˆ—ã€æ˜¯è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ‰€å…±åŒæ‹¥æœ‰çš„å­åºåˆ—ã€‚è‹¥è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ²¡æœ‰å…¬å…±å­åºåˆ—ï¼Œåˆ™è¿”å› 0ã€‚</p>
<p>ç¤ºä¾‹ 1:</p>
<p>è¾“å…¥ï¼štext1 = â€œabcdeâ€, text2 = â€œaceâ€</p>
<p>è¾“å‡ºï¼š3</p>
<p>è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ â€œaceâ€ï¼Œå®ƒçš„é•¿åº¦ä¸º 3ã€‚</p>
<p>ç¤ºä¾‹ 2:</p>
<p>è¾“å…¥ï¼štext1 = â€œabcâ€, text2 = â€œabcâ€</p>
<p>è¾“å‡ºï¼š3</p>
<p>è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ â€œabcâ€ï¼Œå®ƒçš„é•¿åº¦ä¸º 3ã€‚</p>
<p>ç¤ºä¾‹ 3:</p>
<p>è¾“å…¥ï¼štext1 = â€œabcâ€, text2 = â€œdefâ€</p>
<p>è¾“å‡ºï¼š0</p>
<p>è§£é‡Šï¼šä¸¤ä¸ªå­—ç¬¦ä¸²æ²¡æœ‰å…¬å…±å­åºåˆ—ï¼Œè¿”å› 0ã€‚</p>
<p>æç¤º:</p>
<p>1 &lt;= text1.length &lt;= 1000</p>
<p>1 &lt;= text2.length &lt;= 1000</p>
<p>è¾“å…¥çš„å­—ç¬¦ä¸²åªå«æœ‰å°å†™è‹±æ–‡å­—ç¬¦ã€‚</p>
<h4 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h4><ol>
<li><p>çŠ¶æ€ï¼šé—®é¢˜è¦æ±‚æœ€é•¿å…¬å…±å­åºåˆ—ï¼Œé‚£å°±è®©dpè¡¨å­˜å‚¨é•¿åº¦ã€‚</p>
</li>
<li><p>çŠ¶æ€è½¬ç§»ï¼š</p>
</li>
<li><p>å½“ <code>S1i==S2j</code> æ—¶ï¼Œé‚£ä¹ˆå°±èƒ½åœ¨ <code>S1</code> çš„å‰ <code>i-1</code> ä¸ªå­—ç¬¦ä¸ <code>S2</code> çš„å‰ <code>j-1</code> ä¸ªå­—ç¬¦æœ€é•¿å…¬å…±å­åºåˆ—çš„åŸºç¡€ä¸Šå†åŠ ä¸Š <code>S1i</code> è¿™ä¸ªå€¼ï¼Œæœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦åŠ  <code>1</code>ï¼Œå³ <code>dp[i][j] = dp[i-1][j-1] + 1</code>ã€‚</p>
</li>
<li><p>å½“ <code>S1i != S2j</code> æ—¶ï¼Œæ­¤æ—¶æœ€é•¿å…¬å…±å­åºåˆ—ä¸º <code>S1</code> çš„å‰ <code>i-1</code> ä¸ªå­—ç¬¦å’Œ <code>S2</code> çš„å‰ <code>j</code> ä¸ªå­—ç¬¦æœ€é•¿å…¬å…±å­åºåˆ—ï¼Œæˆ–è€… <code>S1</code> çš„å‰ i ä¸ªå­—ç¬¦å’Œ <code>S2</code> çš„å‰ <code>j-1</code> ä¸ªå­—ç¬¦æœ€é•¿å…¬å…±å­åºåˆ—ï¼Œå–å®ƒä»¬çš„æœ€å¤§è€…ï¼Œå³ <code>dp[i][j] = max{ dp[i-1][j], dp[i][j-1] }</code>ã€‚</p>
</li>
</ol>
<p>ç»¼ä¸Šï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p>
<p><img src="/2018/03/09/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/dp_1.png" alt="avatar"></p>
<ol>
<li>è§£çš„å½¢å¼ï¼šè§£åœ¨dpè¡¨çš„å³ä¸‹è§’</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">longestCommonSubsequence</span><span class="params">(self, text1, text2)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type text1: str</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type text2: str</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:rtype: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> text1 <span class="keyword">or</span> <span class="keyword">not</span> text2:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">size_1 = len(text1)</span><br><span class="line"></span><br><span class="line">size_2 = len(text2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–è¡¨æ ¼</span></span><br><span class="line"></span><br><span class="line">dp = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(size_2+<span class="number">1</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(size_1+<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(size_1):</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(size_2):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> text1[i] == text2[j]:</span><br><span class="line"></span><br><span class="line">dp[i+<span class="number">1</span>][j+<span class="number">1</span>] = dp[i][j] + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">dp[i+<span class="number">1</span>][j+<span class="number">1</span>] = max(dp[i][j+<span class="number">1</span>],dp[i+<span class="number">1</span>][j])</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> dp[size_1][size_2]</span><br></pre></td></tr></table></figure>
<h3 id="53-æœ€å¤§åºåˆ—å’Œ"><a href="#53-æœ€å¤§åºåˆ—å’Œ" class="headerlink" title="53. æœ€å¤§åºåˆ—å’Œ"></a>53. <a href="https://leetcode-cn.com/problems/maximum-subarray/" target="_blank" rel="noopener">æœ€å¤§åºåˆ—å’Œ</a></h3><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚</p>
<p>ç¤ºä¾‹:</p>
<p>è¾“å…¥: [-2,1,-3,4,-1,2,1,-5,4],</p>
<p>è¾“å‡º: 6</p>
<p>è§£é‡Š: è¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚</p>
<p>è¿›é˜¶:</p>
<p>å¦‚æœä½ å·²ç»å®ç°å¤æ‚åº¦ä¸º O(n) çš„è§£æ³•ï¼Œå°è¯•ä½¿ç”¨æ›´ä¸ºç²¾å¦™çš„åˆ†æ²»æ³•æ±‚è§£ã€‚</p>
<h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>æ³•ä¸€ï¼šæš´åŠ›åŠ¨æ€è§„åˆ’ï¼šè¶…æ—¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maxSubArray</span><span class="params">(self, nums)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type nums: List[int]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:rtype: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">size = len(nums)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> size == <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> nums[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">dp = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(size)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(size)]</span><br><span class="line"></span><br><span class="line">start = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">end = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">max_val = float(<span class="string">'-inf'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(size):</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(j):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> j - i == <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">dp[i][j] = nums[i] + nums[j]</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">dp[i][j] = dp[i][j<span class="number">-1</span>] + nums[j]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> max_val &lt; dp[i][j]:</span><br><span class="line"></span><br><span class="line">start = i</span><br><span class="line"></span><br><span class="line">end = j</span><br><span class="line"></span><br><span class="line">max_val = dp[i][j]</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> max(max_val, max(nums))</span><br></pre></td></tr></table></figure>
<p>æ³•äºŒï¼šDPæ³•ï¼Œç”¨äº†äº›çµå·§çš„æ€è·¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maxSubArray</span><span class="params">(self, nums)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type nums: List[int]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:rtype: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">max_, sum_ = nums[<span class="number">0</span>],nums[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums[<span class="number">1</span>:]:</span><br><span class="line"></span><br><span class="line">sum_ = sum_ + num <span class="keyword">if</span> sum_ &gt; <span class="number">0</span> <span class="keyword">else</span> num</span><br><span class="line"></span><br><span class="line">max_ = max_ <span class="keyword">if</span> max_ &gt; sum_ <span class="keyword">else</span> sum_</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> max_</span><br></pre></td></tr></table></figure>
<h3 id="300-æœ€é•¿ä¸Šå‡å­åºåˆ—"><a href="#300-æœ€é•¿ä¸Šå‡å­åºåˆ—" class="headerlink" title="300. æœ€é•¿ä¸Šå‡å­åºåˆ—"></a>300. <a href="https://leetcode-cn.com/problems/longest-increasing-subsequence/" target="_blank" rel="noopener">æœ€é•¿ä¸Šå‡å­åºåˆ—</a></h3><p>ç»™å®šä¸€ä¸ªæ— åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ã€‚</p>
<p>ç¤ºä¾‹:</p>
<p>è¾“å…¥: [10,9,2,5,3,7,101,18]</p>
<p>è¾“å‡º: 4</p>
<p>è§£é‡Š: æœ€é•¿çš„ä¸Šå‡å­åºåˆ—æ˜¯ [2,3,7,101]ï¼Œå®ƒçš„é•¿åº¦æ˜¯ 4ã€‚</p>
<p>è¯´æ˜:å¯èƒ½ä¼šæœ‰å¤šç§æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ç»„åˆï¼Œä½ åªéœ€è¦è¾“å‡ºå¯¹åº”çš„é•¿åº¦å³å¯ã€‚ä½ ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥ä¸º $O(n^2)$ ã€‚</p>
<p>è¿›é˜¶: ä½ èƒ½å°†ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦é™ä½åˆ° <code>O(n log n)</code> å—?</p>
<h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>çŠ¶æ€ï¼šå®šä¹‰ dp[i]ä¸ºè€ƒè™‘å‰ iä¸ªå…ƒç´ ï¼Œä»¥ç¬¬ i ä¸ªæ•°å­—ç»“å°¾çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ï¼Œæ³¨æ„ nums[i]å¿…é¡»è¢«é€‰å–ã€‚</p>
<p>çŠ¶æ€è½¬ç§»ï¼šä»å°åˆ°å¤§è®¡ç®— dp[] æ•°ç»„çš„å€¼ï¼Œåœ¨è®¡ç®— dp[i] ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»è®¡ç®—å‡º dp[0â€¦iâˆ’1] çš„å€¼ï¼Œåˆ™çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š</p>
<p><img src="/2018/03/09/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/dp_2.png" alt="avatar"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lengthOfLIS</span><span class="params">(self, nums)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type nums: List[int]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:rtype: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">dp = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line"></span><br><span class="line">dp.append(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(i):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> nums[i] &gt; nums[j]:</span><br><span class="line"></span><br><span class="line">dp[i] = max(dp[i], dp[j] + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> max(dp)</span><br></pre></td></tr></table></figure>
<h3 id="10-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"><a href="#10-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…" class="headerlink" title="10. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"></a><a href="https://leetcode-cn.com/problems/regular-expression-matching/" target="_blank" rel="noopener">10. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</a></h3><p><strong>çŠ¶æ€</strong>ï¼šé—®é¢˜è¦æ±‚è§£çš„æ˜¯æ­£åˆ™ä¸²æ˜¯å¦å¯ä»¥åŒ¹é…ï¼Œåˆ™æŠŠçŠ¶æ€è®¾ä¸ºæ˜¯å¦å¯åŒ¹é…ã€‚<code>dp[i][j]</code> è¡¨ç¤º <code>s</code> çš„å‰ <code>i</code>ä¸ªæ˜¯å¦èƒ½è¢« <code>p</code> çš„å‰ <code>j</code> ä¸ªåŒ¹é…</p>
<p><strong>è½¬ç§»æ–¹ç¨‹</strong> ï¼š </p>
<ol>
<li><p><code>p[j] == s[i] or p[j] == &quot;.&quot; : dp[i][j] = dp[i-1][j-1]</code> </p>
</li>
<li><p><code>p[j] ==&quot; * &quot;</code>:     # æ¯”è¾ƒéš¾æƒ³</p>
<ol>
<li><code>p[j-1] != s[i]: dp[i][j] = dp[i][j-2]</code> # <code>*</code> å‰çš„å­—ç¬¦å’ŒåŸå­—ç¬¦ä¸²ä¸åŒ¹é…,ç›¸å½“äºè¯¥å­—ç¬¦åŒ¹é…0æ¬¡ã€‚</li>
<li><code>p[j-1] == s[i] or p[j-1] == &quot;.&quot;ï¼š</code> # åŒ¹é…<ol>
<li><code>dp[i][j] = dp[i-1][j]</code> # * åŒ¹é…å¤šæ¬¡</li>
<li><code>dp[i][j] = dp[i][j-1]</code> # * åŒ¹é…ä¸€æ¬¡</li>
<li><code>dp[i][j] = dp[i][j-2]</code> # * åŒ¹é…0æ¬¡</li>
</ol>
</li>
</ol>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isMatch</span><span class="params">(self, s, p)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> p:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">not</span> s</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s <span class="keyword">and</span> len(p) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        nrow = len(s) + <span class="number">1</span></span><br><span class="line">        ncol = len(p) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        dp = [[<span class="literal">False</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(ncol)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(nrow)]</span><br><span class="line"></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">True</span></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">1</span>] = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">2</span>, ncol):</span><br><span class="line">            j = c - <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> p[j] == <span class="string">'*'</span>:</span><br><span class="line">                dp[<span class="number">0</span>][c] = dp[<span class="number">0</span>][c - <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> range(<span class="number">1</span>, nrow): <span class="comment"># r åŸå§‹ä¸²</span></span><br><span class="line">            i = r - <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">1</span>, ncol): <span class="comment"># c æ­£åˆ™ä¸²</span></span><br><span class="line">                j = c - <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> s[i] == p[j] <span class="keyword">or</span> p[j] == <span class="string">'.'</span>:</span><br><span class="line">                    dp[r][c] = dp[r - <span class="number">1</span>][c - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">elif</span> p[j] == <span class="string">'*'</span>:</span><br><span class="line">                    <span class="keyword">if</span> p[j - <span class="number">1</span>] == s[i] <span class="keyword">or</span> p[j - <span class="number">1</span>] == <span class="string">'.'</span>:</span><br><span class="line">                        dp[r][c] = dp[r - <span class="number">1</span>][c] <span class="keyword">or</span> dp[r][c - <span class="number">2</span>]</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        dp[r][c] = dp[r][c - <span class="number">2</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[r][c] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[nrow - <span class="number">1</span>][ncol - <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ä¸“ä¸šæŠ€èƒ½</tag>
        <tag>åŠ¨æ€è§„åˆ’</tag>
      </tags>
  </entry>
  <entry>
    <title>èƒŒåŒ…é—®é¢˜</title>
    <url>/2018/03/01/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>æœ‰Nä»¶ç‰©å“å’Œä¸€ä¸ªå®¹é‡ä¸º<code>v</code>çš„èƒŒåŒ…ï¼Œæ”¾å…¥ç¬¬iä»¶ç‰©å“è€—è´¹ç©ºé—´<code>c[i]</code>å¾—åˆ°ä»·å€¼ä¸º<code>W[i]</code>,æ±‚å“ªäº›ç‰©å“è£…å…¥èƒŒåŒ…å¯ä½¿å¾—æ€»ä»·å€¼æœ€å¤§ï¼Ÿ</p>
<h4 id="åŠ¨æ€è§„åˆ’æ±‚è§£ï¼š"><a href="#åŠ¨æ€è§„åˆ’æ±‚è§£ï¼š" class="headerlink" title="åŠ¨æ€è§„åˆ’æ±‚è§£ï¼š"></a>åŠ¨æ€è§„åˆ’æ±‚è§£ï¼š</h4><p>çŠ¶æ€ï¼šé—®é¢˜æ‰€æ±‚æœ€å¤§ä»·å€¼ï¼Œè®¾çŠ¶æ€å³ä¸ºèƒŒåŒ…ä¸­ç‰©å“çš„ä»·å€¼</p>
<p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p>
<p><code>dp[i][j]</code>è¡¨ç¤ºå‰iä»¶ç‰©å“æ”¾å…¥ä¸€ä¸ªå®¹é‡ä¸ºVçš„èƒŒåŒ…è·å¾—çš„æœ€å¤§ä»·å€¼çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸º</p>
<script type="math/tex; mode=display">
\mathrm{dp}[\mathrm{i}][\mathrm{v}]=\max \left\{\begin{array}{l}
dp[i-1][v](\text {not select}) \\
dp[i-1][v-C[i]]+W[i](\text {select})
\end{array}\right.</script><p>å…¶ä¸­<code>dp[i-1][v-C[i]]</code>è¡¨ç¤ºå‰<code>i-1</code>ä»¶ç‰©å“æ”¾å…¥å®¹é‡ä¸º<code>v-C[i]</code>çš„èƒŒåŒ…ä¸­ã€‚</p>
<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># F[0, 0...V] = 0</span></span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>):</span><br><span class="line">    dp[<span class="number">0</span>][v] = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="comment"># å®¹é‡è£…ä¸ä¸‹å½“å‰ç‰©å“æ—¶ï¼Œä¿ç•™åŸå€¼</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(<span class="number">0</span>, C[i]):</span><br><span class="line">        dp[i][v] = dp[i<span class="number">-1</span>][v]</span><br><span class="line">    <span class="comment"># çŠ¶æ€è½¬ç§»</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(C[i], V+<span class="number">1</span>):</span><br><span class="line">        dp[i][v] = max(dp[i<span class="number">-1</span>][v], dp[i<span class="number">-1</span>][v-C[i]] + W[i])</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><ol>
<li><p>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(VN)</code></p>
</li>
<li><p>ç©ºé—´å¤æ‚åº¦ï¼š<code>O(VN)</code>å¯ä¼˜åŒ–æˆ<code>O(N)</code></p>
<p><code>dp[i][v]</code>ç”±<code>dp[i-1][v-C[i]]</code>å’Œ<code>dp[i-1][v]</code>ä¸¤ä¸ªå­é—®é¢˜é€’æ¨å¾—åˆ°ï¼Œæ‰€ä»¥ç¬¬<code>i</code>æ¬¡è¿­ä»£æ—¶ï¼Œ<code>v</code>æŒ‰ç…§<code>V-&gt;0</code>çš„é€†åºè®¡ç®—<code>dp[v]</code>å¯ä»¥ä¿è¯<code>dp[v]=max(dp[v],dp[v-C[i]]+W[i])</code>ï¼Œè¿™æ ·åœ¨èµ‹å€¼ä¹‹å‰ï¼Œè®¿é—®åˆ°çš„å‡ä¸º<code>i-1</code>æ¬¡è¿­ä»£ä¿ç•™çš„å€¼ã€‚</p>
<p>ç©ºé—´ä¸º<code>c[i]</code>çš„ç‰©å“ä¸ä¼šå—åˆ°çŠ¶æ€<code>dp[0...C[i]]</code>çš„å½±å“ï¼Œå³ä¸å½±å“è£…ä¸ä¸‹è¯¥ç‰©å“çš„èƒŒåŒ…èƒ½è£…å…¥çš„æœ€å¤§ä»·å€¼ï¼Œæ‰€ä»¥<code>v</code>ä¸­<code>V</code>é€’å‡åˆ°<code>C[i]</code>å°±å¯ä»¥äº†ã€‚</p>
</li>
<li><p>ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(V, C[i]<span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        dp[v] = max(dp[v], dp[v-C[i]] + W[i])</span><br></pre></td></tr></table></figure>
<p>å¯¹å¤„ç†0-1èƒŒåŒ…çš„ç‰©å“è¿›è¡ŒæŠ½è±¡ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">zero_one_pack</span><span class="params">(F, c, w)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(V, c<span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        dp[v] = max(dp[v], dp[v-c] + w)</span><br><span class="line"></span><br><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    zero_one_pack(dp, C[i], W[i])</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="åˆå§‹åŒ–ç»†èŠ‚"><a href="#åˆå§‹åŒ–ç»†èŠ‚" class="headerlink" title="åˆå§‹åŒ–ç»†èŠ‚"></a>åˆå§‹åŒ–ç»†èŠ‚</h4><p>åˆå§‹åŒ–dpçš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨æ²¡æœ‰ä»»ä½•ç‰©å“å¯ä»¥è£…å…¥èƒŒåŒ…æ—¶çš„åˆæ³•çŠ¶æ€ï¼ˆå¿…è¦ä½†ä¸å……åˆ†æ¡ä»¶ï¼‰</p>
<ol>
<li><p>æ°å¥½è£…æ»¡èƒŒåŒ…æ—¶ï¼Œæ±‚æœ€ä¼˜è§£ï¼š<code>dp[0]=0,dp[1...V]=</code>$-\infty$</p>
<ul>
<li><p>å®¹é‡ä¸º0æ—¶ï¼Œä»€ä¹ˆä¹Ÿè£…ä¸ä¸‹ï¼Œä»·å€¼ä¸º0ï¼Œæ‰€ä»¥<code>dp[0]=0</code></p>
</li>
<li><p>å®¹é‡ä¸ä¸º0çš„æ—¶å€™ï¼ŒçŠ¶æ€æœªå®šä¹‰ï¼ŒçŠ¶æ€è®¾ä¸º$-\infty$</p>
</li>
</ul>
<p>æŒ‰æ­¤è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œåªæœ‰èƒ½å¤Ÿæ°å¥½è£…å…¥çš„ç‰©å“æ‰ä¼šæ›´æ–°å‡ºåˆç†å€¼ï¼ˆæ­£å€¼ï¼‰ï¼ŒåŸºäº<code>dp[0]=0</code></p>
</li>
<li><p>æ²¡è¦æ±‚æŠŠèƒŒåŒ…è£…æ»¡ï¼š<code>dp[0...V]=0</code></p>
<p>ä»»ä½•å®¹é‡éƒ½æœ‰ä¸€ä¸ªåˆæ³•çš„â€œä»€ä¹ˆéƒ½ä¸è£…â€ï¼Œæ‰€ä»¥è®¾<code>dp[0...V]=0</code></p>
</li>
</ol>
<h3 id="å®Œå…¨èƒŒåŒ…"><a href="#å®Œå…¨èƒŒåŒ…" class="headerlink" title="å®Œå…¨èƒŒåŒ…"></a>å®Œå…¨èƒŒåŒ…</h3><p><img src="/Users/lizhen/Library/Application Support/typora-user-images/image-20200321181733468.png" alt="image-20200321181733468"></p>
<h4 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h4><p>æœ‰Nç§ç‰©å“å’Œ1ä¸ªå®¹é‡ä¸ºVçš„èƒŒåŒ…ï¼Œæ¯ç§ç‰©å“å¯ä»¥æœ‰ä»»æ„å¤šä¸ªï¼Œæ”¾å…¥ç¬¬iç§ç‰©å“çš„è€—è´¹ç©ºé—´<code>C[i]</code>ï¼Œä»·å€¼ä¸º<code>W[i]</code>,æ±‚èƒŒåŒ…èƒ½å¤Ÿè£…å…¥çš„æœ€å¤§ä»·å€¼ï¼Ÿ</p>
<h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>æ¯ç§ç‰©å“å¯ä»¥æ”¾å…¥0ä»¶ï¼Œ1ä»¶ï¼Œâ€¦ï¼Œ<code>int(V/C[i])</code>ä»¶ï¼Œä»¤<code>dp[i][v]</code>è¡¨ç¤ºå‰iç§ç‰©å“æ”¾å…¥å®¹é‡vçš„èƒŒåŒ…è·å–çš„æœ€å¤§ä»·å€¼ï¼Œåˆ™<code>dp[i][v]=max(dp[i-1][v-k*C[i]]+k*W[i]),0&lt;=k*C[i]&lt;=v</code></p>
<h4 id="ä¼˜åŒ–-1"><a href="#ä¼˜åŒ–-1" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><p>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(nv</code>$\sum \frac{V}{C[i]}$)</p>
<p>ç®€å•ä¼˜åŒ–ï¼šä¸€ä¸ªç®€å•æœ‰æ•ˆçš„ä¼˜åŒ–æ€è·¯æ˜¯ï¼šå•ä½ä»·å€¼æ›´ä¾¿å®œçš„åº”è¯¥ç›´æ¥è·³è¿‡</p>
<p>è‹¥ä¸¤ä»¶ç‰©å“<code>i,j</code>æœ‰<code>C[i]&lt;=C[j] and W[i]&gt;=W[j]</code>;åˆ™<code>j</code>å¯ä»¥ç›´æ¥è·³è¿‡ï¼Œä¸å¿…è€ƒè™‘ï¼Œå¯¹äºéšæœºæ•°æ®ï¼Œè¿™ä¼šå¤§å¤§å‡å°‘ç‰©å“æ•°é‡ï¼ŒåŠ å¿«é€Ÿåº¦ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sieve = &#123;C[i]: <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>)&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="comment"># è·³è¿‡è£…ä¸ä¸‹çš„</span></span><br><span class="line">    <span class="keyword">if</span> C[i] &gt; V:</span><br><span class="line">        sieve[C[i]] = <span class="number">-1</span></span><br><span class="line">    <span class="comment"># è·³è¿‡ C[i] == C[j] and W[i] &gt; W[j]çš„jç‰©å“</span></span><br><span class="line">    <span class="keyword">elif</span> sieve[C[i]] &lt; W[i]:</span><br><span class="line">        sieve[C[i]] = W[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> sieve[C[i]] &lt; <span class="number">0</span> <span class="keyword">or</span> W[i] &lt; sieve[C[i]]:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(C[i], V+<span class="number">1</span>):</span><br><span class="line">        max_k = V // C[i]</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">1</span>, max_k+<span class="number">1</span>):</span><br><span class="line">            dp[i][v] = max(dp[i<span class="number">-1</span>][v], dp[i<span class="number">-1</span>][v-k*C[i]] + k*W[i])</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆä¼˜åŒ–æ–¹æ¡ˆï¼š</p>
<p>æŒ‰ç…§æ­£åºå®¹é‡æ›´æ–°å½“å‰æ€»ä»·å€¼ï¼Œ<code>dp[v-C[i]]</code>ä¸­å¯èƒ½æ˜¯<code>i-1</code>æ¬¡è¿­ä»£ä¸­ä¿ç•™çš„å€¼ï¼Œä¹Ÿå¯èƒ½æ˜¯æœ¬æ¬¡è¿­ä»£ä¸­äº§ç”Ÿäº†å˜åŒ–çš„å€¼ã€‚ï¼ˆå¦‚æœåŠ é€‰ç¬¬iä»¶ç‰©å“ï¼‰</p>
<p>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(NV)</code></p>
<p>ç©ºé—´å¤æ‚åº¦:<code>O(V)</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(C[i], V+<span class="number">1</span>):</span><br><span class="line">        dp[v] = max(dp[v], dp[v-C[i]] + W[i])</span><br></pre></td></tr></table></figure>
<p>å¯¹å¤„ç†ä¸€ç§å®Œå…¨èƒŒåŒ…çš„ç‰©å“è¿‡ç¨‹è¿›è¡ŒæŠ½è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complete_pack</span><span class="params">(F, c, w)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(c, V+<span class="number">1</span>):</span><br><span class="line">        F[v] = max(F[v], F[v-c] + w)</span><br><span class="line"></span><br><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    complete_pack(dp, C[i], W[i])</span><br></pre></td></tr></table></figure>
<h4 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h4><p>0-1 èƒŒåŒ…ï¼šå€’åºå®¹é‡ï¼Œå½“å‰æ–°ç‰©å“ä¹‹å¤šå½±å“ä¸€æ¬¡å½“å‰æ€»ä»·å€¼</p>
<p>å®Œå…¨èƒŒåŒ…ï¼šæ­£åºå®¹é‡ï¼Œéšç€å®¹é‡å¢åŠ ï¼Œå½“å‰æ–°ç‰©å“å¯ä»¥å¤šæ¬¡å½±å“å½“å‰æ€»ä»·å€¼</p>
<h3 id="å¤šé‡èƒŒåŒ…"><a href="#å¤šé‡èƒŒåŒ…" class="headerlink" title="å¤šé‡èƒŒåŒ…"></a>å¤šé‡èƒŒåŒ…</h3><p>æœ‰<code>N</code>ç§ç‰©å“å’Œ1ä¸ªå®¹é‡ä¸º<code>V</code>çš„èƒŒåŒ…ï¼Œç¬¬iç§ç‰©å“æœ‰<code>M[i]</code>ä»¶ï¼Œæ¯ä»¶è€—è´¹ç©ºé—´<code>C[i]</code>,ä»·å€¼<code>W[i]</code>,æ±‚èƒ½è£…å…¥èƒŒåŒ…çš„æœ€å¤§ä»·å€¼ã€‚</p>
<h4 id="æ€è·¯1"><a href="#æ€è·¯1" class="headerlink" title="æ€è·¯1"></a>æ€è·¯1</h4><p>å’Œå®Œå…¨èƒŒåŒ…ç±»ä¼¼ï¼Œå¯¹iç§ç‰©å“æœ‰<code>M[i]+1</code>ç§ç­–ç•¥ï¼Œå–<code>0</code>ä»¶ï¼Œå–<code>1</code>ä»¶ï¼Œâ€¦ï¼Œå–<code>M[i]</code>,ä»¤<code>dp[i][v]</code>è¡¨ç¤ºå‰iä¸­ç‰©å“æ”¾å…¥å®¹é‡vä¸­è·å¾—çš„æœ€å¤§ä»·å€¼ï¼Œåˆ™<code>dp[i][v]=max(dp[i-1][v-k*C[i]]+k*W[i]),0&lt;=k&lt;=M[i]</code></p>
<p>æ—¶é—´å¤æ‚åº¦ï¼š`O(V<script type="math/tex">\sum M_i</script></p>
<h4 id="æ€è·¯2"><a href="#æ€è·¯2" class="headerlink" title="æ€è·¯2"></a>æ€è·¯2</h4><p>è½¬åŒ–ä¸º0-1èƒŒåŒ…é—®é¢˜ï¼ŒæŠŠç¬¬iç§ç‰©å“æ¢æˆ<code>M[i]</code>ä»¶<code>0-1</code>èƒŒåŒ…ä¸­çš„ç‰©å“ï¼Œå¾—åˆ°ç‰©å“æ•°ä¸º$\sum M_i$çš„<code>0-1</code>èƒŒåŒ…é—®é¢˜ï¼Œæ—¶é—´å¤æ‚åº¦ä»ä¸º$O(V\sum M_i)$ã€‚ä½¿ç”¨äºŒè¿›åˆ¶çš„æ€æƒ³ï¼Œå¯ä»¥æŠŠæ—¶é—´å¤æ‚åº¦ä¸‹é™ä¸º$O(V\sum{log{M_i}})$,å³æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼è¿›è¡Œæ‹†åˆ†ï¼š</p>
<p>$2^0,2^1,2^2,â€¦,2^{k-1},M_i-2^k+1$</p>
<p>è¿™æ ·æ‹¼æˆçš„æ–°ç‰©å“æ€»é‡ç­‰äºåŸæ¥ç‰©å“çš„æ•°é‡ï¼Œç¬¬iä»¶ç‰©å“æ‹†åˆ†æˆäº†$O(log{m_i})$</p>
<h5 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiple_pack</span><span class="params">(F, c, w, m)</span>:</span></span><br><span class="line">    <span class="comment"># å¦‚æœç‰©å“è¶³å¤Ÿå¤šï¼Œå°±å˜æˆäº†å®Œå…¨èƒŒåŒ…</span></span><br><span class="line">    <span class="keyword">if</span> c * m &gt;= V:</span><br><span class="line">        complete_pack(F, c, w)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># å¤šé‡èƒŒåŒ…æŒ‰ç…§2æ¬¡å¹‚è¿›è¡Œåˆ’åˆ†æˆ0-1èƒŒåŒ…</span></span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> k &lt; m:</span><br><span class="line">        zero_one_pack(F, k*c, k*w)</span><br><span class="line">        m = m - k</span><br><span class="line">        k = <span class="number">2</span> * k</span><br><span class="line">    <span class="comment"># æŠŠå‰©ä½™çš„ç‰©å“å½“ä½œ1ä»¶ç‰©å“</span></span><br><span class="line">    zero_one_pack(F, c * m, w * m)</span><br><span class="line"></span><br><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    multiple_pack(dp, C[i], W[i], M[i])</span><br></pre></td></tr></table></figure>
<h3 id="äºŒç»´è´¹ç”¨èƒŒåŒ…"><a href="#äºŒç»´è´¹ç”¨èƒŒåŒ…" class="headerlink" title="äºŒç»´è´¹ç”¨èƒŒåŒ…"></a>äºŒç»´è´¹ç”¨èƒŒåŒ…</h3><p>å¯¹äºæ¯ä»¶ç‰©å“æœ‰ä¸¤ç§ä¸åŒçš„costï¼Œæ¯ç§costæœ‰ä¸€ä¸ªæœ€å¤§å®¹çº³å€¼ï¼ˆèƒŒåŒ…å®¹é‡ï¼‰ï¼Œæ€æ ·é€‰æ‹©ç‰©å“ä½¿å¾—èƒŒåŒ…å®¹çº³æœ€å¤§ä»·å€¼ï¼Ÿç¬¬iç§ç‰©å“ä¸¤ç§è´¹ç”¨åˆ†åˆ«ä¸º<code>C[i]</code>å’Œ<code>D[i]</code>ï¼Œä¸¤ç§costæœ€å¤§å®¹çº³å€¼ä¸ºV,Uï¼Œç‰©å“çš„ä»·å€¼ä¸º<code>W[i]</code>(é¢˜ç›®åœºæ™¯æ ·ä¾‹ï¼šæ‰“çŸ©å½¢ä¸­æ”¾å°çŸ©å½¢ï¼Œæ±‚æœ€å¤§å®¹é‡)</p>
<h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>è´¹ç”¨åŠ 1ç»´ï¼ŒçŠ¶æ€åŠ 1ç»´ï¼›ä»¤<code>dp[i][v][u]</code>è¡¨ç¤ºå‰iä»¶ç‰©å“ä»˜å‡ºä¸¤ç§è´¹ç”¨åˆ†åˆ«ä¸ºvï¼Œuæ—¶å¯è·å¾—çš„æœ€å¤§ä»·å€¼ã€‚åˆ™<code>dp[i][v][u]=max(dp[i-1][v][u],dp[i-1][v-C[i]][u-D[i]]+W[i])</code></p>
<h4 id="ä¼˜åŒ–-2"><a href="#ä¼˜åŒ–-2" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><p>ç±»ä¼¼äºä¸€ç»´èƒŒåŒ…ç©ºé—´ä¼˜åŒ–æ–¹æ³•ï¼ŒäºŒç»´èƒŒåŒ…ä¸ä¹‹ç±»ä¼¼ï¼š</p>
<ol>
<li>äºŒç»´0-1èƒŒåŒ…ï¼švå’Œué‡‡ç”¨é€†åºå¾ªç¯</li>
<li>äºŒç»´å®Œå…¨èƒŒåŒ…ï¼švå’Œué‡‡ç”¨é¡ºåºå¾ªç¯</li>
<li>äºŒç»´å¤šé‡èƒŒåŒ…ï¼šæ‹†åˆ†ç‰©å“</li>
</ol>
<h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">two_dim_zero_one_pack</span><span class="params">(F, c, d, w)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(V, c<span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> range(U, d<span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            F[v][u] = max(F[v][u], F[v-c][u-d] + w)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">two_dim_complete_pack</span><span class="params">(F, c, d, w)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(c, V+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> range(d, U+<span class="number">1</span>):</span><br><span class="line">            F[v][u] = max(F[v][u], F[v-c][u-d] + w)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">two_dim_multiple_pack</span><span class="params">(F, c, d, w, m)</span>:</span></span><br><span class="line">    <span class="comment"># ä¸¤ç§costæ•°é‡éƒ½å……è¶³ï¼Œå¯ç›´æ¥æŒ‰ç…§å®Œå…¨èƒŒåŒ…å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> c * m &gt;= V <span class="keyword">and</span> d * m &gt;= U:</span><br><span class="line">        two_dim_complete_pack(F, c, d, w)</span><br><span class="line">    <span class="comment"># å¤šé‡èƒŒåŒ…æŒ‰ç…§2æ¬¡å¹‚è¿›è¡Œåˆ’åˆ†æˆ0-1èƒŒåŒ…</span></span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> k &lt; m:</span><br><span class="line">        two_dim_complete_pack(F, k * c, k * d, k * w)</span><br><span class="line">        m = m - k</span><br><span class="line">        k = <span class="number">2</span> * k</span><br><span class="line">    <span class="comment"># æŠŠå‰©ä½™çš„ç‰©å“å½“ä½œ1ä»¶ç‰©å“</span></span><br><span class="line">    two_dim_zero_one_pack(F, m * c, m * d, m * w)</span><br><span class="line"></span><br><span class="line">F = [[<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)] <span class="keyword">for</span> u <span class="keyword">in</span> range(U+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    two_dim_zero_one_pack(F, C[i], D[i], W[i])</span><br><span class="line">    <span class="comment"># two_dim_complete_pack(F, C[i], D[i], W[i])</span></span><br><span class="line">    <span class="comment"># two_dim_multiple_pack(F, C[i], D[i], W[i], M[i])</span></span><br></pre></td></tr></table></figure>
<h4 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h4><p>äºŒç»´è´¹ç”¨é¢˜ç›®çš„ä¸€ç§éšå«è¡¨è¿°æ–¹å¼ï¼šæœ€å¤šå–Uä»¶</p>
<p>å¯¹äºæœ‰è¿™ç§é™åˆ¶çš„é¢˜ç›®ï¼Œå¯ä»¥å°†â€™ä»¶æ•°â€™çœ‹ä½œä¸€ç§è´¹ç”¨ï¼Œæ¯ä»¶ç‰©å“ä»¶æ•°è´¹ç”¨ä¸º1ï¼Œå¯ä»¥è¾¾åˆ°çš„æœ€å¤§ä»¶æ•°è´¹ç”¨éUï¼Œ<code>dp[v][u]</code>è¡¨ç¤ºcostä¸ºvï¼Œæœ€å¤šé€‰æ‹©uä»¶ç‰©å“æ—¶æ‰€è¾¾åˆ°çš„æœ€å¤§ä»·å€¼ï¼ˆå†æ ¹æ®ç‰©å“çš„ç‰¹æ€§ï¼ˆ0-1,å®Œå…¨ï¼Œå¤šé‡ï¼‰é‡‡ç”¨ä¸åŒçš„æ–¹å¼è¿›è¡Œå¾ªç¯ï¼Œå¾—å‡ºç­”æ¡ˆï¼‰</p>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>èƒŒåŒ…é—®é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title>æ’åºç®—æ³•</title>
    <url>/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="æ’åºç®—æ³•"><a href="#æ’åºç®—æ³•" class="headerlink" title="æ’åºç®—æ³•"></a>æ’åºç®—æ³•</h2><p><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/æ’åº.png" alt="avatar"></p>
<a id="more"></a>
<h3 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h3><h4 id="æ€æƒ³"><a href="#æ€æƒ³" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4><p>æ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ã€‚å®ƒé‡å¤åœ°èµ°è®¿è¿‡è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœå®ƒä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠå®ƒä»¬äº¤æ¢è¿‡æ¥ã€‚èµ°è®¿æ•°åˆ—çš„å·¥ä½œæ˜¯é‡å¤åœ°è¿›è¡Œç›´åˆ°æ²¡æœ‰å†éœ€è¦äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ•°åˆ—å·²ç»æ’åºå®Œæˆã€‚è¿™ä¸ªç®—æ³•çš„åå­—ç”±æ¥æ˜¯å› ä¸ºè¶Šå°çš„å…ƒç´ ä¼šç»ç”±äº¤æ¢æ…¢æ…¢â€œæµ®â€åˆ°æ•°åˆ—çš„é¡¶ç«¯ã€‚</p>
<h4 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><ol>
<li>æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢å®ƒä»¬ä¸¤ä¸ªï¼›</li>
<li>å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ï¼Œè¿™æ ·åœ¨æœ€åçš„å…ƒç´ åº”è¯¥ä¼šæ˜¯æœ€å¤§çš„æ•°ï¼›</li>
<li>é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªï¼›</li>
<li><p>é‡å¤æ­¥éª¤1~3ï¼Œç›´åˆ°æ’åºå®Œæˆã€‚</p>
<h4 id="å¤æ‚åº¦"><a href="#å¤æ‚åº¦" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4></li>
<li><p>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(1)</code></p>
</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼š$O(n^2)$<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bubble_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="comment"># å¤–å±‚å¾ªç¯: èµ°è®¿æ•°æ®çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums) - <span class="number">1</span>):</span><br><span class="line">        <span class="comment"># è®¾ç½®æ˜¯å¦äº¤æ¢æ ‡å¿—ä½</span></span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="comment"># å†…å±‚å¾ªç¯: æ¯æ¬¡èµ°è®¿æ•°æ®æ—¶, ç›¸é‚»å¯¹æ¯”æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(nums) - i - <span class="number">1</span>):</span><br><span class="line">            <span class="comment"># è¦æ±‚ä»ä½åˆ°é«˜</span></span><br><span class="line">            <span class="comment"># å¦‚æ¬¡åºæœ‰è¯¯å°±äº¤æ¢</span></span><br><span class="line">            <span class="keyword">if</span> nums[j] &gt; nums[j + <span class="number">1</span>]:</span><br><span class="line">                nums[j], nums[j + <span class="number">1</span>] = nums[j + <span class="number">1</span>], nums[j]</span><br><span class="line">                <span class="comment"># å‘ç”Ÿäº†æ•°æ®äº¤æ¢</span></span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">        <span class="comment"># å¦‚æœæœªå‘ç”Ÿäº¤æ¢æ•°æ®, åˆ™è¯´æ˜åç»­æ•°æ®å‡æœ‰åº</span></span><br><span class="line">        <span class="keyword">if</span> flag == <span class="literal">False</span>:</span><br><span class="line">            <span class="keyword">break</span>  <span class="comment"># è·³å‡ºæ•°æ®èµ°è®¿</span></span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<h3 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h3><h4 id="æ€æƒ³-1"><a href="#æ€æƒ³-1" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4>å®ƒçš„å·¥ä½œåŸç†ï¼šé¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ï¼Œç„¶åï¼Œå†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚<h4 id="æ­¥éª¤-1"><a href="#æ­¥éª¤-1" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4>nä¸ªè®°å½•çš„ç›´æ¥é€‰æ‹©æ’åºå¯ç»è¿‡n-1è¶Ÿç›´æ¥é€‰æ‹©æ’åºå¾—åˆ°æœ‰åºç»“æœã€‚</li>
<li>åˆå§‹çŠ¶æ€ï¼šæ— åºåŒºä¸º<code>R[1â€¦n]</code>ï¼Œæœ‰åºåŒºä¸ºç©ºï¼›</li>
<li>ç¬¬iè¶Ÿæ’åº<code>(i=1,2,3â€¦n-1)</code>å¼€å§‹æ—¶ï¼Œå½“å‰æœ‰åºåŒºå’Œæ— åºåŒºåˆ†åˆ«ä¸º<code>R[1â€¦i-1]å’ŒR(iâ€¦nï¼‰</code>ã€‚è¯¥è¶Ÿæ’åºä»å½“å‰æ— åºåŒºä¸­-é€‰å‡ºå…³é”®å­—æœ€å°çš„è®°å½• <code>R[k]</code>ï¼Œå°†å®ƒä¸æ— åºåŒºçš„ç¬¬1ä¸ªè®°å½•Räº¤æ¢ï¼Œä½¿<code>R[1â€¦i]</code>å’Œ<code>R[i+1â€¦n)</code>åˆ†åˆ«å˜ä¸ºè®°å½•ä¸ªæ•°å¢åŠ 1ä¸ªçš„æ–°æœ‰åºåŒºå’Œè®°å½•ä¸ªæ•°å‡å°‘1ä¸ªçš„æ–°æ— åºåŒºï¼›</li>
<li>n-1è¶Ÿç»“æŸï¼Œæ•°ç»„æœ‰åºåŒ–äº†ã€‚<h4 id="å¤æ‚åº¦-1"><a href="#å¤æ‚åº¦-1" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4></li>
<li>æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(1)<h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">selection_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line">    size = len(nums)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(size):</span><br><span class="line">        min_idx = i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i+<span class="number">1</span>,size):</span><br><span class="line">            <span class="keyword">if</span> nums[j] &lt; nums[min_idx]:</span><br><span class="line">                min_idx = j</span><br><span class="line">        temp = nums[min_idx]</span><br><span class="line">        nums[min_idx] = nums[i]</span><br><span class="line">        nums[i] = temp</span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<h3 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h3><h4 id="æ€æƒ³-2"><a href="#æ€æƒ³-2" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4>å’Œé€‰æ‹©æ’åºä¸€æ ·ï¼Œå½’å¹¶æ’åºçš„æ€§èƒ½ä¸å—è¾“å…¥æ•°æ®çš„å½±å“ï¼Œä½†è¡¨ç°æ¯”é€‰æ‹©æ’åºå¥½çš„å¤šï¼Œå› ä¸ºå§‹ç»ˆéƒ½æ˜¯O(n log nï¼‰çš„æ—¶é—´å¤æ‚åº¦ã€‚ä»£ä»·æ˜¯éœ€è¦é¢å¤–çš„å†…å­˜ç©ºé—´ã€‚</li>
</ol>
<h4 id="æ­¥éª¤-2"><a href="#æ­¥éª¤-2" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><p><strong>å½’å¹¶æ’åº</strong>æ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚å½’å¹¶æ’åºæ˜¯ä¸€ç§ç¨³å®šçš„æ’åºæ–¹æ³•ã€‚å°†å·²æœ‰åºçš„å­åºåˆ—åˆå¹¶ï¼Œå¾—åˆ°å®Œå…¨æœ‰åºçš„åºåˆ—ï¼›å³å…ˆä½¿æ¯ä¸ªå­åºåˆ—æœ‰åºï¼Œå†ä½¿å­åºåˆ—æ®µé—´æœ‰åºã€‚è‹¥å°†ä¸¤ä¸ªæœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæœ‰åºè¡¨ï¼Œç§°ä¸º2-è·¯å½’å¹¶ã€‚</p>
<ol>
<li>æŠŠé•¿åº¦ä¸ºnçš„è¾“å…¥åºåˆ—åˆ†æˆä¸¤ä¸ªé•¿åº¦ä¸ºn/2çš„å­åºåˆ—ï¼›</li>
<li>å¯¹è¿™ä¸¤ä¸ªå­åºåˆ—åˆ†åˆ«é‡‡ç”¨å½’å¹¶æ’åºï¼›</li>
<li>å°†ä¸¤ä¸ªæ’åºå¥½çš„å­åºåˆ—åˆå¹¶æˆä¸€ä¸ªæœ€ç»ˆçš„æ’åºåºåˆ—ã€‚</li>
</ol>
<h4 id="å¤æ‚åº¦-2"><a href="#å¤æ‚åº¦-2" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><ol>
<li>æ—¶é—´å¤æ‚åº¦$O(nlog_2 n)$</li>
</ol>
<h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(nums) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line"></span><br><span class="line">    mid_idx = len(nums) / <span class="number">2</span></span><br><span class="line">    left_array = nums[<span class="number">0</span>:mid_idx]</span><br><span class="line">    right_array = nums[mid_idx:len(nums)]</span><br><span class="line">    <span class="keyword">return</span> merge(merge_sort(left_array),merge_sort(right_array))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(left_array,right_array)</span>:</span></span><br><span class="line">    <span class="comment"># åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</span></span><br><span class="line">    res = []</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; len(left_array) <span class="keyword">and</span> j &lt; len(right_array):</span><br><span class="line">        <span class="keyword">if</span> left_array[i] &lt; right_array[j]:</span><br><span class="line">            res.append(left_array[i])</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res.append(right_array[j])</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> i &lt; len(left_array):</span><br><span class="line">        res.extend(left_array[i:])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res.extend(right_array[j:])</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<h3 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h3><h4 id="æ€æƒ³-3"><a href="#æ€æƒ³-3" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4><p>é€šè¿‡æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚æ’å…¥æ’åºåœ¨å®ç°ä¸Šï¼Œé€šå¸¸é‡‡ç”¨in-placeæ’åºï¼ˆå³åªéœ€ç”¨åˆ°O(1)çš„é¢å¤–ç©ºé—´çš„æ’åºï¼‰ï¼Œå› è€Œåœ¨ä»åå‘å‰æ‰«æè¿‡ç¨‹ä¸­ï¼Œéœ€è¦åå¤æŠŠå·²æ’åºå…ƒç´ é€æ­¥å‘åæŒªä½ï¼Œä¸ºæœ€æ–°å…ƒç´ æä¾›æ’å…¥ç©ºé—´ã€‚</p>
<h4 id="æ­¥éª¤-3"><a href="#æ­¥éª¤-3" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ’å…¥æ’åºéƒ½é‡‡ç”¨in-placeåœ¨æ•°ç»„ä¸Šå®ç°ã€‚å…·ä½“ç®—æ³•æè¿°å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æ’åºï¼›</li>
<li>å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼›</li>
<li>å¦‚æœè¯¥å…ƒç´ ï¼ˆå·²æ’åºï¼‰å¤§äºæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ ç§»åˆ°ä¸‹ä¸€ä½ç½®ï¼›</li>
<li>é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æ’åºçš„å…ƒç´ å°äºæˆ–è€…ç­‰äºæ–°å…ƒç´ çš„ä½ç½®ï¼›</li>
<li>å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥ä½ç½®åï¼›</li>
<li><p>é‡å¤æ­¥éª¤2~5ã€‚</p>
<h4 id="å¤æ‚åº¦-3"><a href="#å¤æ‚åº¦-3" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4></li>
<li><p>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(1)</code></p>
</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼š$O(n^2)$</li>
</ol>
<h4 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(nums)):</span><br><span class="line">        temp = nums[i]</span><br><span class="line">        pos = i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> temp &lt; nums[j]:</span><br><span class="line">                nums[j + <span class="number">1</span>] = nums[j]</span><br><span class="line">                pos = j</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pos = j + <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        nums[pos] = temp</span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<h3 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h3><p>å¸Œå°”æ’åºæ˜¯å¸Œå°”ï¼ˆDonald Shellï¼‰ äº1959å¹´æå‡ºçš„ä¸€ç§æ’åºç®—æ³•ã€‚å¸Œå°”æ’åºä¹Ÿæ˜¯ä¸€ç§æ’å…¥æ’åºï¼Œå®ƒæ˜¯ç®€å•æ’å…¥æ’åºç»è¿‡æ”¹è¿›ä¹‹åçš„ä¸€ä¸ªæ›´é«˜æ•ˆçš„ç‰ˆæœ¬ï¼Œä¹Ÿç§°ä¸ºç¼©å°å¢é‡æ’åºï¼ŒåŒæ—¶è¯¥ç®—æ³•æ˜¯å†²ç ´O(n2ï¼‰çš„ç¬¬ä¸€æ‰¹ç®—æ³•ä¹‹ä¸€ã€‚å®ƒä¸æ’å…¥æ’åºçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä¼šä¼˜å…ˆæ¯”è¾ƒè·ç¦»è¾ƒè¿œçš„å…ƒç´ ã€‚å¸Œå°”æ’åºåˆå«ç¼©å°å¢é‡æ’åºã€‚</p>
<h4 id="æ€æƒ³-4"><a href="#æ€æƒ³-4" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h4><p>å¸Œå°”æ’åºæ˜¯æŠŠè®°å½•æŒ‰ä¸‹è¡¨çš„ä¸€å®šå¢é‡åˆ†ç»„ï¼Œå¯¹æ¯ç»„ä½¿ç”¨ç›´æ¥æ’å…¥æ’åºç®—æ³•æ’åºï¼›éšç€å¢é‡é€æ¸å‡å°‘ï¼Œæ¯ç»„åŒ…å«çš„å…³é”®è¯è¶Šæ¥è¶Šå¤šï¼Œå½“å¢é‡å‡è‡³1æ—¶ï¼Œæ•´ä¸ªæ–‡ä»¶æ°è¢«åˆ†æˆä¸€ç»„ï¼Œç®—æ³•ä¾¿ç»ˆæ­¢ã€‚</p>
<h4 id="æ­¥éª¤-4"><a href="#æ­¥éª¤-4" class="headerlink" title="æ­¥éª¤:"></a>æ­¥éª¤:</h4><p>å…ˆå°†æ•´ä¸ªå¾…æ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åº,å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>é€‰æ‹©ä¸€ä¸ªå¢é‡åºåˆ—<code>t1ï¼Œt2ï¼Œâ€¦ï¼Œtk</code>ï¼Œå…¶ä¸­<code>ti&gt;tjï¼Œtk=1</code>ï¼›</li>
<li>æŒ‰å¢é‡åºåˆ—ä¸ªæ•°kï¼Œå¯¹åºåˆ—è¿›è¡Œ k è¶Ÿæ’åºï¼›</li>
<li>æ¯è¶Ÿæ’åºï¼Œæ ¹æ®å¯¹åº”çš„å¢é‡tiï¼Œå°†å¾…æ’åºåˆ—åˆ†å‰²æˆè‹¥å¹²é•¿åº¦ä¸º m çš„å­åºåˆ—ï¼Œåˆ†åˆ«å¯¹å„å­è¡¨è¿›è¡Œç›´æ¥æ’å…¥æ’åºã€‚ä»…å¢é‡å› å­ä¸º1 æ—¶ï¼Œæ•´ä¸ªåºåˆ—ä½œä¸ºä¸€ä¸ªè¡¨æ¥å¤„ç†ï¼Œè¡¨é•¿åº¦å³ä¸ºæ•´ä¸ªåºåˆ—çš„é•¿åº¦ã€‚<br><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/aHR0cHM6Ly9pbWFnZXMyMDE4LmNuYmxvZ3MuY29tL2Jsb2cvMTE5MjY5OS8yMDE4MDMvMTE5MjY5OS0yMDE4MDMxOTA5NDExNjA0MC0xNjM4NzY2MjcxLnBuZw.png" alt="avat"><h4 id="å¤æ‚åº¦-4"><a href="#å¤æ‚åº¦-4" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4></li>
<li>æ—¶é—´å¤æ‚åº¦$O(nlog_2 n)$<h4 id="ä»£ç -4"><a href="#ä»£ç -4" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    size = len(nums)</span><br><span class="line">    gap = size / <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> gap:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(gap, size):</span><br><span class="line">            temp = nums[i]</span><br><span class="line">            pre_index = i - gap</span><br><span class="line">            <span class="comment"># å¯¹äºåˆ’åˆ†åˆ°ä¸€ç»„å†…çš„æ•°è¿›è¡Œæ’åº</span></span><br><span class="line">            <span class="keyword">while</span> pre_index &gt;= <span class="number">0</span> <span class="keyword">and</span> nums[pre_index] &gt; temp:</span><br><span class="line">                nums[pre_index + gap] = nums[pre_index]</span><br><span class="line">                pre_index -= gap</span><br><span class="line">            <span class="comment"># æ’å…¥</span></span><br><span class="line">            nums[pre_index+gap] = temp</span><br><span class="line">        </span><br><span class="line">        gap /= <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<h3 id="å¿«æ’"><a href="#å¿«æ’" class="headerlink" title="å¿«æ’"></a>å¿«æ’</h3><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/1450319-20190525163106857-545290968.png" alt="avatar"><h4 id="æ­¥éª¤-5"><a href="#æ­¥éª¤-5" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4>å¿«é€Ÿæ’åºä½¿ç”¨åˆ†æ²»æ³•æ¥æŠŠä¸€ä¸ªä¸²ï¼ˆlistï¼‰åˆ†ä¸ºä¸¤ä¸ªå­ä¸²ï¼ˆsub-listsï¼‰ã€‚</li>
<li>ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç§°ä¸º â€œåŸºå‡†â€ï¼ˆpivot ï¼‰</li>
<li>é‡æ–°æ’åºæ•°åˆ—ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹åï¼Œè¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸ºåˆ†åŒºï¼ˆpartitionï¼‰æ“ä½œ</li>
<li><p>é€’å½’åœ°ï¼ˆrecursiveï¼‰æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºã€‚<br>å¤æ‚åº¦:</p>
</li>
<li><p>æ—¶é—´å¤æ‚åº¦ï¼š$O(nlogn)$</p>
</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼š$O(logn)$</li>
<li>ç¨³å®šæ€§ï¼šä¸ç¨³å®š<h4 id="ä»£ç -5"><a href="#ä»£ç -5" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quick_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="comment"># é€’å½’é€€å‡ºæ¡ä»¶</span></span><br><span class="line">    <span class="comment"># ä»…å‰©ä¸€ä¸ªå…ƒç´ æ— éœ€ç»§ç»­åˆ†ç»„</span></span><br><span class="line">    <span class="keyword">if</span> len(nums) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line">        <span class="comment"># è®¾ç½®å…³é”®æ•°æ®</span></span><br><span class="line">    a = nums[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># æ‰¾å‡ºæ‰€æœ‰æ¯” a å¤§çš„æ•°æ®</span></span><br><span class="line">    big = [x <span class="keyword">for</span> x <span class="keyword">in</span> nums <span class="keyword">if</span> x &gt; a]</span><br><span class="line">    <span class="comment"># æ‰¾å‡ºæ‰€æœ‰æ¯” a å°çš„æ•°æ®</span></span><br><span class="line">    small = [x <span class="keyword">for</span> x <span class="keyword">in</span> nums <span class="keyword">if</span> x &lt; a]</span><br><span class="line">    <span class="comment"># æ‰¾å‡ºæ‰€æœ‰ä¸ a ç›¸ç­‰çš„æ•°æ®</span></span><br><span class="line">    same = [x <span class="keyword">for</span> x <span class="keyword">in</span> nums <span class="keyword">if</span> x == a]</span><br><span class="line">    <span class="comment"># æ‹¼æ¥æ•°æ®æ’åºçš„ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> quick_sort(small) + same + quick_sort(big)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h3><p>å †æ’åºï¼ˆHeapsortï¼‰ æ˜¯æŒ‡åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ã€‚å †ç§¯æ˜¯ä¸€ä¸ªè¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘çš„ç»“æ„ï¼Œå¹¶åŒæ—¶æ»¡è¶³å †ç§¯çš„æ€§è´¨ï¼šå³å­ç»“ç‚¹çš„é”®å€¼æˆ–ç´¢å¼•æ€»æ˜¯å°äºï¼ˆæˆ–è€…å¤§äºï¼‰å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚</p>
<h4 id="æ­¥éª¤-6"><a href="#æ­¥éª¤-6" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><ol>
<li>å°†åˆå§‹å¾…æ’åºå…³é”®å­—åºåˆ—(R1,R2â€¦.Rn)æ„å»ºæˆå¤§é¡¶å †ï¼Œæ­¤å †ä¸ºåˆå§‹çš„æ— åºåŒºï¼›</li>
<li>å°†å †é¡¶å…ƒç´ R[1]ä¸æœ€åä¸€ä¸ªå…ƒç´ R[n]äº¤æ¢ï¼Œæ­¤æ—¶å¾—åˆ°æ–°çš„æ— åºåŒº<code>(R1,R2,â€¦â€¦Rn-1)</code>å’Œæ–°çš„æœ‰åºåŒº(Rn),ä¸”æ»¡è¶³<code>R[1,2â€¦n-1]&lt;=R[n]</code>ï¼›</li>
<li>ç”±äºäº¤æ¢åæ–°çš„å †é¡¶R[1]å¯èƒ½è¿åå †çš„æ€§è´¨ï¼Œå› æ­¤éœ€è¦å¯¹å½“å‰æ— åºåŒº<code>(R1,R2,â€¦â€¦Rn-1)</code>è°ƒæ•´ä¸ºæ–°å †ï¼Œç„¶åå†æ¬¡å°†R[1]ä¸æ— åºåŒºæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œå¾—åˆ°æ–°çš„æ— åºåŒº<code>(R1,R2â€¦.Rn-2)</code>å’Œæ–°çš„æœ‰åºåŒº<code>(Rn-1,Rn)</code>ã€‚ä¸æ–­é‡å¤æ­¤è¿‡ç¨‹ç›´åˆ°æœ‰åºåŒºçš„å…ƒç´ ä¸ªæ•°ä¸ºn-1ï¼Œåˆ™æ•´ä¸ªæ’åºè¿‡ç¨‹å®Œæˆã€‚</li>
</ol>
<p><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/CA6B626B-98BA-4AA5-BC01-FDAFE554BB87.gif" alt="avatar"></p>
<h4 id="å¤æ‚åº¦-5"><a href="#å¤æ‚åº¦-5" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><ol>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO(nlogn)<h4 id="ä»£ç -6"><a href="#ä»£ç -6" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">heap_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    size = len(nums)</span><br><span class="line">    <span class="keyword">if</span> size &lt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line">    <span class="comment"># æ„å»ºä¸€ä¸ªæœ€å¤§å †</span></span><br><span class="line">    build_max_heap(nums)</span><br><span class="line">    <span class="comment"># å¾ªç¯å°†æ ¹å’Œæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œç„¶åé‡æ–°è°ƒæ•´æœ€å¤§å †ã€‚</span></span><br><span class="line">    <span class="keyword">while</span> size &gt; <span class="number">0</span>:</span><br><span class="line">        temp = nums[<span class="number">0</span>]</span><br><span class="line">        nums[<span class="number">0</span>] = nums[size - <span class="number">1</span>]</span><br><span class="line">        nums[size - <span class="number">1</span>] = temp</span><br><span class="line"></span><br><span class="line">        size -= <span class="number">1</span></span><br><span class="line">        adjust_heap(nums, <span class="number">0</span>,size)</span><br><span class="line">    <span class="keyword">return</span> nums</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_max_heap</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="comment"># ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹å‘ä¸Šæ„é€ æœ€å¤§å †</span></span><br><span class="line">    <span class="comment"># i çš„å·¦å­æ ‘å’Œå³å­æ ‘åˆ†åˆ«ä¸º2i+1 å’Œ 2(i+1)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums) / <span class="number">2</span><span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        adjust_heap(nums, i,len(nums))</span><br><span class="line">    <span class="comment"># return nums</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adjust_heap</span><span class="params">(nums, i,size)</span>:</span></span><br><span class="line">    max_index = i</span><br><span class="line">    <span class="comment"># å¦‚æœæœ‰å·¦å­æ ‘ï¼Œä¸”å·¦å­æ ‘å¤§äºçˆ¶èŠ‚ç‚¹ï¼Œåˆ™å°†æœ€å¤§æŒ‡é’ˆæŒ‡å‘å·¦å­æ ‘</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">2</span> * i + <span class="number">1</span> &lt; size <span class="keyword">and</span> nums[<span class="number">2</span> * i + <span class="number">1</span>] &gt; nums[max_index]:</span><br><span class="line">        max_index = <span class="number">2</span> * i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">2</span> * (i + <span class="number">1</span>) &lt; size <span class="keyword">and</span> nums[<span class="number">2</span> * (i + <span class="number">1</span>)] &gt; nums[max_index]:</span><br><span class="line">        max_index = <span class="number">2</span> * (i + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> max_index == i:</span><br><span class="line">        temp = nums[max_index]</span><br><span class="line">        nums[max_index] = nums[i]</span><br><span class="line">        nums[i] = temp</span><br><span class="line">        adjust_heap(nums, max_index,size)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="è®¡æ•°æ’åº"><a href="#è®¡æ•°æ’åº" class="headerlink" title="è®¡æ•°æ’åº"></a>è®¡æ•°æ’åº</h3><p><strong>è®¡æ•°æ’åº</strong>çš„æ ¸å¿ƒåœ¨äºå°†è¾“å…¥çš„æ•°æ®å€¼è½¬åŒ–ä¸ºé”®å­˜å‚¨åœ¨é¢å¤–å¼€è¾Ÿçš„æ•°ç»„ç©ºé—´ä¸­ã€‚ ä½œä¸ºä¸€ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºï¼Œè®¡æ•°æ’åºè¦æ±‚è¾“å…¥çš„æ•°æ®å¿…é¡»æ˜¯æœ‰ç¡®å®šèŒƒå›´çš„æ•´æ•°ã€‚</p>
<h4 id="åŸºæœ¬æ€æƒ³"><a href="#åŸºæœ¬æ€æƒ³" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h4><p>è®¡æ•°æ’åº(Counting sort) æ˜¯ä¸€ç§ç¨³å®šçš„æ’åºç®—æ³•ã€‚è®¡æ•°æ’åºä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„æ•°ç»„Cï¼Œå…¶ä¸­ç¬¬iä¸ªå…ƒç´ æ˜¯å¾…æ’åºæ•°ç»„Aä¸­å€¼ç­‰äºiçš„å…ƒç´ çš„ä¸ªæ•°ã€‚ç„¶åæ ¹æ®æ•°ç»„Cæ¥å°†Aä¸­çš„å…ƒç´ æ’åˆ°æ­£ç¡®çš„ä½ç½®ã€‚å®ƒ<strong>åªèƒ½å¯¹æ•´æ•°è¿›è¡Œæ’åº</strong>ã€‚<br><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/E4559E2C-6389-4EAB-976A-95289A079EB8.gif" alt="avatar"></p>
<h4 id="ç®—æ³•æ­¥éª¤"><a href="#ç®—æ³•æ­¥éª¤" class="headerlink" title="ç®—æ³•æ­¥éª¤"></a>ç®—æ³•æ­¥éª¤</h4><ol>
<li>æ‰¾å‡ºå¾…æ’åºçš„æ•°ç»„ä¸­æœ€å¤§å’Œæœ€å°çš„å…ƒç´ </li>
<li>ç»Ÿè®¡æ•°ç»„ä¸­æ¯ä¸ªå€¼ä¸ºiçš„å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå­˜å…¥æ•°ç»„Cçš„ç¬¬ié¡¹</li>
<li>å¯¹æ‰€æœ‰çš„è®¡æ•°ç´¯åŠ ï¼ˆä»Cä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œæ¯ä¸€é¡¹å’Œå‰ä¸€é¡¹ç›¸åŠ ï¼‰</li>
<li>åå‘å¡«å……ç›®æ ‡æ•°ç»„ï¼šå°†æ¯ä¸ªå…ƒç´ iæ”¾åœ¨æ–°æ•°ç»„çš„ç¬¬C(i)é¡¹ï¼Œæ¯æ”¾ä¸€ä¸ªå…ƒç´ å°±å°†C(i)å‡å»1ã€‚<h4 id="å¤æ‚åº¦-6"><a href="#å¤æ‚åº¦-6" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4></li>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO(n+k)<h4 id="ä»£ç -7"><a href="#ä»£ç -7" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_sort</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="comment"># è·å–arrä¸­çš„æœ€å¤§å€¼å’Œæœ€å°å€¼</span></span><br><span class="line">    max_num = max(arr)</span><br><span class="line">    min_num = min(arr)</span><br><span class="line">    <span class="comment"># ä»¥æœ€å¤§å€¼å’Œæœ€å°å€¼çš„å·®ä½œä¸ºä¸­é—´æ•°ç»„çš„é•¿åº¦,å¹¶æ„å»ºä¸­é—´æ•°ç»„ï¼Œåˆå§‹åŒ–ä¸º0</span></span><br><span class="line">    length = max_num - min_num + <span class="number">1</span></span><br><span class="line">    temp_arr = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(length)]</span><br><span class="line">    <span class="comment"># åˆ›å»ºç»“æœListï¼Œå­˜æ”¾æ’åºå®Œæˆçš„ç»“æœ</span></span><br><span class="line">    res_arr = list(range(len(arr)))</span><br><span class="line">    <span class="comment"># ç¬¬ä¸€æ¬¡å¾ªç¯éå†</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> arr:</span><br><span class="line">        temp_arr[num - min_num] += <span class="number">1</span></span><br><span class="line">    <span class="comment"># ç¬¬äºŒæ¬¡å¾ªç¯éå†</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, length):</span><br><span class="line">        temp_arr[i] = temp_arr[i] + temp_arr[i - <span class="number">1</span>]</span><br><span class="line">    <span class="comment"># ç¬¬ä¸‰æ¬¡å¾ªç¯éå†</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(arr) - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        res_arr[temp_arr[arr[i] - min_num] - <span class="number">1</span>] = arr[i]</span><br><span class="line">        temp_arr[arr[i] - min_num] -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res_arr</span><br></pre></td></tr></table></figure>
<h3 id="æ¡¶æ’åº"><a href="#æ¡¶æ’åº" class="headerlink" title="æ¡¶æ’åº"></a>æ¡¶æ’åº</h3>æ¡¶æ’åº æ˜¯è®¡æ•°æ’åºçš„å‡çº§ç‰ˆã€‚å®ƒåˆ©ç”¨äº†å‡½æ•°çš„æ˜ å°„å…³ç³»ï¼Œé«˜æ•ˆä¸å¦çš„å…³é”®å°±åœ¨äºè¿™ä¸ªæ˜ å°„å‡½æ•°çš„ç¡®å®šã€‚</li>
</ol>
<h4 id="åŸºæœ¬æ€æƒ³-1"><a href="#åŸºæœ¬æ€æƒ³-1" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h4><p>å‡è®¾è¾“å…¥æ•°æ®æœä»å‡åŒ€åˆ†å¸ƒï¼Œå°†æ•°æ®åˆ†åˆ°æœ‰é™æ•°é‡çš„æ¡¶é‡Œï¼Œæ¯ä¸ªæ¡¶å†åˆ†åˆ«æ’åºï¼ˆæœ‰å¯èƒ½å†ä½¿ç”¨åˆ«çš„æ’åºç®—æ³•æˆ–æ˜¯ä»¥é€’å½’æ–¹å¼ç»§ç»­ä½¿ç”¨æ¡¶æ’åºè¿›è¡Œæ’</p>
<p><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/D7FA465B-93A5-493B-BE2B-15375A28FAE2.gif" alt="avatar"></p>
<h4 id="ç®—æ³•æ­¥éª¤-1"><a href="#ç®—æ³•æ­¥éª¤-1" class="headerlink" title="ç®—æ³•æ­¥éª¤"></a>ç®—æ³•æ­¥éª¤</h4><ol>
<li>æ ¹æ®æ•°æ®åˆ†æ¡¶</li>
<li>éå†æ•°ç»„ï¼ŒæŠŠæ•°æ®ä¸€ä¸ªä¸€ä¸ªæ”¾åˆ°å¯¹åº”çš„æ¡¶ä¸­ã€‚</li>
<li>å¯¹æ¯ä¸ªä¸æ˜¯ç©ºçš„æ¡¶è¿›è¡Œæ’åºï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–æ’åºæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥é€’å½’ä½¿ç”¨æ¡¶æ’åºã€‚</li>
<li>ä»ä¸æ˜¯ç©ºçš„æ¡¶é‡ŒæŠŠæ’å¥½åºçš„æ•°æ®æ‹¼æ¥èµ·æ¥ã€‚<h4 id="å¤æ‚åº¦-7"><a href="#å¤æ‚åº¦-7" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4></li>
<li>æ—¶é—´å¤æ‚åº¦ï¼šæœ€å¥½æƒ…å†µä¸‹ä½¿ç”¨çº¿æ€§æ—¶é—´O(n)ï¼Œæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼Œå–å†³ä¸å¯¹å„ä¸ªæ¡¶ä¹‹é—´æ•°æ®è¿›è¡Œæ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼Œå› ä¸ºå…¶å®ƒéƒ¨åˆ†çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(n)ã€‚å¾ˆæ˜¾ç„¶ï¼Œæ¡¶åˆ’åˆ†çš„è¶Šå°ï¼Œå„ä¸ªæ¡¶ä¹‹é—´çš„æ•°æ®è¶Šå°‘ï¼Œæ’åºæ‰€ç”¨çš„æ—¶é—´ä¹Ÿä¼šè¶Šå°‘ã€‚<h4 id="ä»£ç -8"><a href="#ä»£ç -8" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, k)</span>:</span></span><br><span class="line">        self.key = k;</span><br><span class="line">        self.next = <span class="literal">None</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bucket_sort</span><span class="params">(arr,bucket_num)</span>:</span></span><br><span class="line">    h = [];</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, bucket_num):</span><br><span class="line">        h.append(node(<span class="number">0</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(arr)):</span><br><span class="line">        tmp = node(arr[i])</span><br><span class="line">        map = arr[i] / bucket_num</span><br><span class="line">        p = h[map]</span><br><span class="line">        <span class="keyword">if</span> p.key <span class="keyword">is</span> <span class="number">0</span>:</span><br><span class="line">            h[map].next = tmp</span><br><span class="line">            h[map].key = h[map].key + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">while</span> (p.next != <span class="literal">None</span> <span class="keyword">and</span> p.next.key &lt;= tmp.key):</span><br><span class="line">                p = p.next</span><br><span class="line">            tmp.next = p.next</span><br><span class="line">            p.next = tmp</span><br><span class="line">            h[map].key = h[map].key + <span class="number">1</span></span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">        q = h[i].next</span><br><span class="line">        <span class="keyword">while</span> (q != <span class="literal">None</span>):</span><br><span class="line">            arr[k] = q.key</span><br><span class="line">            k = k + <span class="number">1</span></span><br><span class="line">            q = q.next</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="åŸºæ•°æ’åº"><a href="#åŸºæ•°æ’åº" class="headerlink" title="åŸºæ•°æ’åº"></a>åŸºæ•°æ’åº</h3><p>åŸºæ•°æ’åºä¹Ÿæ˜¯éæ¯”è¾ƒçš„æ’åºç®—æ³•ï¼Œå¯¹æ¯ä¸€ä½è¿›è¡Œæ’åºï¼Œä»æœ€ä½ä½å¼€å§‹æ’åºï¼Œå¤æ‚åº¦ä¸ºO(kn),ä¸ºæ•°ç»„é•¿åº¦ï¼Œkä¸ºæ•°ç»„ä¸­çš„æ•°çš„æœ€å¤§çš„ä½æ•°ï¼›</p>
<h4 id="åŸºæœ¬æ€æƒ³-2"><a href="#åŸºæœ¬æ€æƒ³-2" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h4><p>åŸºæ•°æ’åºæ˜¯æŒ‰ç…§ä½ä½å…ˆæ’åºï¼Œç„¶åæ”¶é›†ï¼›å†æŒ‰ç…§é«˜ä½æ’åºï¼Œç„¶åå†æ”¶é›†ï¼›ä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°æœ€é«˜ä½ã€‚æœ‰æ—¶å€™æœ‰äº›å±æ€§æ˜¯æœ‰ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œå…ˆæŒ‰ä½ä¼˜å…ˆçº§æ’åºï¼Œå†æŒ‰é«˜ä¼˜å…ˆçº§æ’åºã€‚æœ€åçš„æ¬¡åºå°±æ˜¯é«˜ä¼˜å…ˆçº§é«˜çš„åœ¨å‰ï¼Œé«˜ä¼˜å…ˆçº§ç›¸åŒçš„ä½ä¼˜å…ˆçº§é«˜çš„åœ¨å‰ã€‚åŸºæ•°æ’åºåŸºäºåˆ†åˆ«æ’åºï¼Œåˆ†åˆ«æ”¶é›†ï¼Œæ‰€ä»¥æ˜¯ç¨³å®šçš„ã€‚<br><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/2BA80F27-FCDC-4BEA-BD0B-2AAB59242752.gif" alt="avatar"></p>
<h4 id="ç®—æ³•æ­¥éª¤-2"><a href="#ç®—æ³•æ­¥éª¤-2" class="headerlink" title="ç®—æ³•æ­¥éª¤"></a>ç®—æ³•æ­¥éª¤</h4><ol>
<li>å–å¾—æ•°ç»„ä¸­çš„æœ€å¤§æ•°ï¼Œå¹¶å–å¾—ä½æ•°ï¼›</li>
<li>arrä¸ºåŸå§‹æ•°ç»„ï¼Œä»æœ€ä½ä½å¼€å§‹å–æ¯ä¸ªä½ç»„æˆradixæ•°ç»„ï¼›</li>
<li>å¯¹radixè¿›è¡Œè®¡æ•°æ’åºï¼ˆåˆ©ç”¨è®¡æ•°æ’åºé€‚ç”¨äºå°èŒƒå›´æ•°çš„ç‰¹ç‚¹ï¼‰ï¼›</li>
</ol>
<h4 id="å¤æ‚åº¦-8"><a href="#å¤æ‚åº¦-8" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><ol>
<li>æ—¶é—´å¤æ‚åº¦ï¼šOï¼ˆknï¼‰</li>
</ol>
<h4 id="ä»£ç -9"><a href="#ä»£ç -9" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">radix_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    k = len(str(max(nums)))  <span class="comment"># æœ€å¤§çš„æ•°çš„ä½æ•°</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">        tong = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">            tong[int(num / (<span class="number">10</span> ** i)) % <span class="number">10</span>].append(num)  <span class="comment"># è·å–å½“å‰æ’åºä½æ•°ä¸Šçš„æ•°å­—</span></span><br><span class="line">        <span class="comment">#print(tong)</span></span><br><span class="line">        nums = []</span><br><span class="line">        <span class="keyword">for</span> zitong <span class="keyword">in</span> tong:</span><br><span class="line">            nums = nums + zitong</span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ä¸“ä¸šæŠ€èƒ½</tag>
        <tag>æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title>æŸ¥æ‰¾ç®—æ³•</title>
    <url>/2018/02/10/%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ç®€å•æœç´¢æŸ¥æ‰¾"><a href="#ç®€å•æœç´¢æŸ¥æ‰¾" class="headerlink" title="ç®€å•æœç´¢æŸ¥æ‰¾"></a>ç®€å•æœç´¢æŸ¥æ‰¾</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">brute_force_search</span><span class="params">(nums,key)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">        <span class="keyword">if</span> num == key:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="äºŒåˆ†æŸ¥æ‰¾"><a href="#äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾"></a>äºŒåˆ†æŸ¥æ‰¾</h3><p>å‰æï¼šæ•°ç»„æœ‰åº</p>
<h4 id="è¿­ä»£ç‰ˆæœ¬"><a href="#è¿­ä»£ç‰ˆæœ¬" class="headerlink" title="è¿­ä»£ç‰ˆæœ¬"></a>è¿­ä»£ç‰ˆæœ¬</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search</span><span class="params">(nums, key)</span>:</span></span><br><span class="line">    low = <span class="number">0</span></span><br><span class="line">    high = len(nums) - <span class="number">1</span></span><br><span class="line">    time = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> low &lt; high:</span><br><span class="line">        time += <span class="number">1</span></span><br><span class="line">        mid = int((low + high) / <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> key &lt; nums[mid]:</span><br><span class="line">            high = mid - <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> key &gt; nums[mid]:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># æ‰“å°æŠ˜åŠçš„æ¬¡æ•°</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"success! times: %s"</span> % time</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"fail! times: %s"</span> % time</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h4 id="é€’å½’ç‰ˆæœ¬"><a href="#é€’å½’ç‰ˆæœ¬" class="headerlink" title="é€’å½’ç‰ˆæœ¬"></a>é€’å½’ç‰ˆæœ¬</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search_recursive</span><span class="params">(nums, item)</span>:</span></span><br><span class="line">    mid = len(nums) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> nums[mid] == item:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> mid == <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># midç­‰äº0å°±æ˜¯æ‰¾åˆ°æœ€åä¸€ä¸ªå…ƒç´ äº†ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> item &gt; nums[mid]:  <span class="comment"># æ‰¾ååŠéƒ¨åˆ†</span></span><br><span class="line">            <span class="comment"># print(lst[mid:])</span></span><br><span class="line">            <span class="keyword">return</span> binary_search_recursive(nums[mid:], item)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> binary_search_recursive(nums[:mid], item)  <span class="comment"># æ‰¾å‰åŠéƒ¨åˆ†</span></span><br></pre></td></tr></table></figure>
<h3 id="Hash-æŸ¥æ‰¾"><a href="#Hash-æŸ¥æ‰¾" class="headerlink" title="Hash æŸ¥æ‰¾"></a>Hash æŸ¥æ‰¾</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashTable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size)</span>:</span></span><br><span class="line">        self.elem = [<span class="literal">None</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(size)]  <span class="comment"># ä½¿ç”¨listæ•°æ®ç»“æ„ä½œä¸ºå“ˆå¸Œè¡¨å…ƒç´ ä¿å­˜æ–¹æ³•</span></span><br><span class="line">        self.count = size  <span class="comment"># æœ€å¤§è¡¨é•¿</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hash</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> key % self.count  <span class="comment"># æ•£åˆ—å‡½æ•°é‡‡ç”¨é™¤ç•™ä½™æ•°æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert_hash</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""æ’å…¥å…³é”®å­—åˆ°å“ˆå¸Œè¡¨å†…"""</span></span><br><span class="line">        address = self.hash(key)  <span class="comment"># æ±‚æ•£åˆ—åœ°å€</span></span><br><span class="line">        <span class="keyword">while</span> self.elem[address]:  <span class="comment"># å½“å‰ä½ç½®å·²ç»æœ‰æ•°æ®äº†ï¼Œå‘ç”Ÿå†²çªã€‚</span></span><br><span class="line">            address = (address+<span class="number">1</span>) % self.count  <span class="comment"># çº¿æ€§æ¢æµ‹ä¸‹ä¸€åœ°å€æ˜¯å¦å¯ç”¨</span></span><br><span class="line">        self.elem[address] = key  <span class="comment"># æ²¡æœ‰å†²çªåˆ™ç›´æ¥ä¿å­˜ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search_hash</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""æŸ¥æ‰¾å…³é”®å­—ï¼Œè¿”å›å¸ƒå°”å€¼"""</span></span><br><span class="line">        star = address = self.hash(key)</span><br><span class="line">        <span class="keyword">while</span> self.elem[address] != key:</span><br><span class="line">            address = (address + <span class="number">1</span>) % self.count</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.elem[address] <span class="keyword">or</span> address == star:  <span class="comment"># è¯´æ˜æ²¡æ‰¾åˆ°æˆ–è€…å¾ªç¯åˆ°äº†å¼€å§‹çš„ä½ç½®</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">      </span><br><span class="line">     </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># hashæŸ¥æ‰¾</span></span><br><span class="line">    list_a = [<span class="number">12</span>, <span class="number">67</span>, <span class="number">56</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">37</span>, <span class="number">22</span>, <span class="number">29</span>, <span class="number">15</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">34</span>]</span><br><span class="line">    hash_table = HashTable(len(list_a))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> list_a:</span><br><span class="line">        hash_table.insert_hash(i)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> hash_table.elem:</span><br><span class="line">        <span class="keyword">if</span> i:</span><br><span class="line">            print(i, hash_table.elem.index(i))</span><br><span class="line"></span><br><span class="line">    print(hash_table.search_hash(<span class="number">15</span>))</span><br><span class="line">    print(hash_table.search_hash(<span class="number">33</span>))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>æŸ¥æ‰¾ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexoå†™ä½œæŠ€å·§</title>
    <url>/2018/02/09/hexo-writing-skills/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">è¯·è¾“å…¥å¯†ç ä»¥é˜…è¯»è¿™ç¯‡ç§å¯†æ–‡ç« ã€‚</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="25696393d6f71d079639de0fa8172f1bbe6fbd714ac0a326d0903292ca1500e2">04b96cf03f1b5d00286d72390b6bf2e0817acbfddb7147d2fcc01912c7f5c0f9713c9c317ba53b9347fde83c930f8c77af411014f8ec84eef7465f6027f6e563b20763efbf9fac1db105face649d36b82b8e5a28894e0322accb07eba0f38491487fddc38b18732e21e4d5a09a208486db90f1b471e152ae582639c98996b3d9545b516ad74403d379a378e897878b9754f5f3c9a9c1cbf034ea3b155b6217c7c2a8ce65fc5458e94d70325ea68e520ff9d6b828ab526fe7fe05cbc0fcd86680f8b6e3ff6f8afc23a74718d1d008f3c35f4cbafcc10bf91c3a2b5bfa650a66440cc37a4524508a7bf732a25f3d388b162081a5fd7febe0358a7bbe256f2301e683e2434b8817e162168a5ea3036a63c5be8ec887d02962b1d8926697b6d33ffaf796a5374b1fc68b99f6873958dfee2c2f487b83db41a280beecc891f16e0943fbabdd303b6d7b4a6d2f5dd4e7e5f6394931e7130285853f603ebd61df8c1c24e50a86e91dd95c2d90a5b271956ad0025e3d2ce28987dfe8c0ccc953f2b06297c3f82a6c649f49b15e6083e2260ebcf049b563c585d603b6dd263ed3fd7d367ce8518e6916fc3b6b548ccc9319466632e4da46b3196ab578c35defe9a37f952b09108be207c75368f3f474ca3d70b7c6ef83a90347263f1a83e74bff0129b2f935d13f8bc54ddaff7288e677bdd356c3d78aade1e98c89d7b8a1246620b7245dee579f5660ca79ef17c56e4890c83ed298a7c2d512ea81f6aaceee14d2f63cd7b163965b0f40988f37148789e8dbe4c000e140227f70958c781bcfc502f482bedc884bbae3faf5fc135dfe026c640aed147550ae410f03bc5152af3dda78fdb0fd3dbc65ec45257c92eaffaa5ba505ca2a7b85d73a531c032cafad1279de39c5880ecdf8c8bfea948e6d293b2a33e057eaf3ee036b1b979d2d673325f8cad7177d7dbf21abfefb1aa696439997ddacdf5d11d6c8d1879ec6c78a9083eeab781385acacd74edeba3767548cc82e2e913b1c92960b40334f5b53636560a2b42444ac4ee547a644704f66fa86a404067b8aa9e02057485a1b2105dbc89fa0c55f9f6c02f1fdbd6106fb9e357d110c643038bcb1dc07b99993298206d0fcfc4cd7dc2a66404aef372f26031850a2ede27073fdaaecd8d82f82c6a5ede6301b1806245844a33b9f19f79bb06a8e7d328189931c5c16bc983ed902d8efd04233b390a95e25739c8b0b79aee7bfda610adc790a8072d3c31639213fb3773a7be3eebd0b291f885fd9a41715201c18f44b71747f17417f5cdfb5ca2edbc13c7f73c44ad06ce61095d6769efb426c487a3acd312b2a61ade2fbd5e30f289be02c726ad5ec6c614478c9e2e62c47774e049d1192dde31af295912163294ee23b3eac50cd5d7bcdc44829bc66846e3086d9d8719cb520ec15eab3297afcac626490fead15c75119e8a5640e829d0499f2dc390f87f988026e7865dc568e6bf5f95c3968554eb6123fd9c614f53943748ee034d12eabb8fb891543dc7525e09f965b8cd612aea8dbbdd8002248799f8e321f775c3a7cc408c097ab4571b819a9ce71a8f519e5c5cff326d6a98c309d12667e2002316ecb502045680c6df872303586193e21680f5b7ba7f050a46bcf6309e507341b27086b9abd0ba0fa862ef0afc5286dd4dfadf445b011c31c548c3b9a4bd9b0cc4709c1911c6121e787d9fcc998cf30d5c21d84d55687dcfcffddc150018c7a1d0f87d5b378586485d21e7c90e17e8335b2f0c96bcb715f94e764a4cb977d1ea731a9bbfd3eec2e3bbfa20cb4bf945d2d9e74b5bd1ef764e2311f1e34b44dfe628fb4a67229fa77121e99f6e247aec1ccfa97b3a2f3be0a93b2a5940b0386ef6d5a48a78de215403a38c861b3997e23a805c99643b34fca4df421a2b375a480c243c560afab10f7a88a1a249613f9353daf83de11fd646e6c7b55161377a738830bc2fb5c455c59f9e0de5d84da32402aba77fcf69cbf5d7671dd7444c78731b0911948342eebd9ce24c5ebc9bd99fd97f4f175ce7536c0fbeacc096a010cf37b7c0f8a5baa85a0680e0d7bf7f6a68eb2fad36305ddc3e01ee840df7f0eecff0c7a8459c226adcc9e589362845489fd2ee67d83ba789ea256f99050666939e506abec27bbfe7f6e2249dacd7a29e7d5f060358b7d7f2ea92891cab6ca2a07ad3ae91d3514e70d54682c0649094ca2a6b85dcd850e84b10d153fe88fc7f78b7cb53b1f8680bc7d1e2117b683ccd788a78d35a2a7955526f0474e0ad1b04d87c72044935f365b6b068f8d6de1eb18a70563489fba8b71bfc63744a0ef420b81e2b2d72b21163c1791e543e7312ab56b8c6ebbd6f9099157aa3b2fdce7a99ee05fe0d5ac74a193b8358296c71ec3bb32fdcd34a4bfb13d3e1e8c61906cdd2a75927d7a983e19eb9b171b2eb3e78afdb66644e1a2c917264c74726bcb2b661a212d32a931e459e3ca41857deae94c28a66658d9e72b38974824a45c30ea6abcb7e59fdfc5c550cc53c1d9d18772fc95266eae09a99d95d61bc40c4093ea93d93400a4c2235ccd0a09875bda186ff47f25021cdf31bfc071c64085876e947da1e6ec7ebbf2abd695c57978d1e5059cf3ab9c0bceca8864fe256e8cfa1c0b48b1def64ec40bc7db8d302b2ab2418513e96243f6d63d2eb8e9229d428144d65852dd0e35f19b7d3cda4a3bbcd5f6f482755adc6ef52fcc0d44f75d67320e069a78ea9439c02b4d7fac0c02584289e0edbea9032eb8fe56d791a18d7b99440701fbd3446b37e2424a37049a0f67f07d635eaa97dac6651fd806b5f3d998b9557ed1ee498fc9714bcf0445f2756788edd76ac46d9a8027ed934ac4e93f790729b34581ab9a2ca13976e7fa0dd78361a436f2f1615277c6ad52e89d8a4aaf21e17f383b0dee5c3f6046d3ef29a497ef0ca1379e36b0f29d118886d3d31d0b6f36a8d0cb842ce3e6f1da9a40ea5cdb57f9ac493aec2e90dbe8b5e928f159d06ff44f74b9a12de4b128515bea2c52f86a9a19cc5ed71c587bd4298e7f715df58ef0fc489439087e8735a444ca5e31ed43eb78a3d80cbb2d348aea94091a9e656456e45ab44bd53c66fa1e45df3ac3676cd2e055d19195348f7428714bec6cd71934d56befee0c3463910a1e2eafce45e1e80ba7acb94d8ad06a2c069f2a6828f607ab3848963148acbc9583eb9ac37ac31825bf5b032c7b0401de68a2757959fceeb205d2aec3bdd3fca0b2aff01a1e29acd0ef004ca9b8472cb8f5933bc1cf3eb7fe8ba996b80159e6e4e94169b696069038962761fd217f0fb2514921b020d5163fad493ab9c2329a874364bd8afc707be27f164dbbc9c30fe98008382a23ffce374167bf15d6f74bf5247b648fc37b087cb4572e8d0a6329d0a0ddd9a39bb89b8cc2ccb03caf335169e02d0a54d2959ce8ea2237570ef0dd8fef5add9a3a64d563a59aa150498730f6b858268f96b14357fea7f9c31ce8dec826a02fdcd64debe678c0abe73837ada3fc5a04ff13a3b82211b52fabd571258404988b3c5dcbc22bcc1258722035c4e3a4b0bcb7805f7ae3ed69ad050f0bd71b66eeec0d046f6f3df40d7316323111cbb48046e0272a34f5288cdee990d563bbbef9359da4b16ad51c82b5ea38938b0e62295fa2573b55fe2dc0fee4b510509af67932173c228dc30c3eca00efe949c5776fb1ac8c33ef70eac431174fd135eb303a5ab824300695f8ea7624396370c8f14dc78ca6d6f8320334ac923c0aa7db2e601fcdf4641396cdbf99aef724e538c60de87e095f8f450f82484ad5662c8d85d840a4be3b9223757279f7c5b9f9084bca14b80749bff395e74e159ec637f78cbab2c034907d49520c053970da91cd896f2cc68bb815a5af27d216fbe89d3ef1b788a16bfca5054f8a9f8109a0f5c80f4225bd604ae869d7c66bfe44c048064f5e3222879d28773e650446453dc9ce4230e9198cf487de842f44cc1139621eff8524ee4a5682c775f4f329d906919c2eac34510545c32d3e1b565e673e0332489aea3d78505e0ac3b5d50e333bf00b3d466ad24a6757f48c63ed9fc0d4d15bcfdb8ce5a3c2de1f62d983d3809d0b75403a93ce5a810b286d63eb6174436608ab0e21dc6bd187b6414f010f68bbca943218918efcd60e660573b3931e187ab43fde42685972525b0aae0a313fcf7dd27be9a159cf53c2d8eeab46558fa29cd562bcb3c923c0aa0825c25ee901ecd5fccf4ab66997f568f7c0f9f38ffd6a5b5ff6836653922c68854a8f75c9b97090575c04d0b5ba8bb7312ac61e7963109618912b464bae75452a50ba7fda4e3f3ff67b017dde82b3eeeab835bc1c232b1cd7e1a944a4ef5dd2c8400403ca2f7c576a7b30e43bec6242cf6399b7c86a3684eb65c53775d0dff2b4d7fbef9ae41e002b4c9d8155f934fa58419004d19bd21cd5ad561379534940f77377e1cb6b3e8ba64f0e924c5fae60f1871f0f141483ccb49ee03d152f2e102b37e845321a2438836dd25618f15148fb2bdb5d6b5e6f12d1d3062995e64037c5df8adc655ad12e8e0121113c725fc8e804188f28974b5ce04af113595f8ca4d17da70df7a43f3586f9c1d47a5b035a013cc5b4b193bca7a5e586efbb13026c09887fd687de14746b89eb4e57fc51d1741e227601c2830dc7c7977d4d9980d48a344fb3820774324d6d38d82bac0ceaed2374d3c62c71662c0b497c2dfe08a78b47fb93a39a7fdf2108cea9be9e15958c423e5bee11351127618c5d2953ffe920773f904b99be1c517713eff150d55e5df79ddd79212e89b663dfce2bb1437f055d77132e32279658fc70c717f46260c8c144430e6d87e5bb9bc0a4845c5f5e6e63895feec0ebab738eac93a9de3028a515b4d9cc21a33cdc12d7c0c58e022b9d72d7b18f95f82be8acfcf4bc501f67fcd93277034be0d40ed9da94a49e43b38e9b8a3429b67c6869454651fcbe65dd7c392ec6ea177e7637af01e6649e5d02581a9e55229d93e500405c41e85fe92816a9f3512aa3ae9b7966e7308bc9858330313bd6d58a09ee74526836ad6abb367979060d08f87193e9a3cd85f561f190c20bb5667236e7a45a559543eda2adcf8d5607b5d150b55b219662e523c8aac26c23595c97772b4ac567703d1dbfaa18b3ad99367f04b51b9992df431d52c843ec48fdfcfa3e053fbda6e88c096452843480d45843f9d42fc5e5de8a23b7019a6884d703e1ebab8584b66d898ea8bb47b76929e6f9e954542c7f12111243f9840528cd1949b50f42eb03f05c765f6d9e9fe8dd9f17cba6aae5dc03d68b6e1a11137105db8fd5a7bc773ca74ac991fe1252aad060d83c9fe59ebe2a734ce3cd24b338ac34f009e0ba8514b2c57d70acb1a7f7c773ef12c8b30e3b820d04fe5567a0feb146c87db5d271e5dd18d9284c5a1067d595485e80f0ac84551a47c57562b1439445ee9ec7ed6070948caa222b15853068896116b3c6e37bebcf939e5924fa79513edc036ab65157d46867fe33ef9a9f76f3f2813d4b178e36d9d98d54dcc159c2d511fb70b70b2a9b696868c4468a987f924db42b4c20b309f8a699c8491a293e0e9ef0cb13ccbce63308d865cdfeae207b26325dee583df534ac8f0ffc3647f6499c4d2e77b838254fb50231a25817eaf627d4f8b2182db84b9e0904348e5a2375e9fe814e8ba435c88fc81fcafa16c5490391cefa8633e187b2e5a15ef5ad90154136f662ad9e219fb9032a838472fb46295504f1eb9782d7255a0a561c525ccce95144a0e454f4790d84721c4908a0f2c9d64e21bf1b638e10dd1bc6165e3a682e1806a172adafe8ac4235216a7c7132d9da5b9c708d22b2ff08b60d1c4afa820062e965a4ae2a5ff4d6303aa82f432dd9206f7055736367483fea126ed79347d8cb027ced7941f16a2d03cb676a6fe035bfa03cd08530939143c433e1be4726c43b1ab2dc4ceee5218c9cc420e087df0f4e4f1d9d0b0853e969eecc79ec5b2f9e4d8984708d4cf7de69ad695390c5cf69b68fea70e77b63fde1437817eaf6fe58b071fb8e6c589737918326bf1ee3609c21b7f155e0d4aa102a8110ff00cf09394d473179cb18ae529f5f942e22accd1d373c419a7ba57ff299dce848c074e1a3e1622d3ccf9a8972ec5db6bdd9a14afa9bd274fd8cca735080e25aa288684486ad9560a390b66b80f861d0ab13823a73c1d625b70ec65d9ae48396c62f2f4a7a9a390dd1afb240ede5142f48de065144ad04310853d9895a9b724efc421a31c5c8377fbd760a39aeff325e372297a19f0f90f7af62935838f177093224ad8b024eabc2ededd29b98fa56b7d465169654b1103cd4d74f32e46d73ce42939d9b83f8cf3927a34559e4b2065683edaf0197f75396b0a0bdf370e7d67e6b7b0639c783e5b13e59ab1e4a3db16c6df9717658f5975d0bbd549c5229714d26f13bfeed2f31ed6d784551bf86acaec6c2ff1dd1a61ed9ff0af41c5ec6344f4eb757d68248ab6b8d941875b970388b48fc8f0c041766b2eac9de5cb3293f549906fa0174a5725c1502adce67e8edfbb42971ae9debc80b08bbdb25bce29fff323b969b69dc095d11b6cf5a26935a396e5aa053ae51826b27497496be03bb05cd6de98e46d3edb50b411bf0debcc91a63700122618b7ee0ab8efc37ae00c3f9bcd40e2ad2d08958d7a57036867c3520e1440275bd94baa8e9cdda96b0d369f1804909f9aa89cd2d66349fa90fe8eb6b4b6f2eef402fb5acb1a4833a8465af790a025082bdcc369202f4cf2d6f520194e139d6e733efc0642a972e77c932a2547671f8633bb8772f1386b364f5b533f8d2af0100a942ec2ec1440f70fe2f1af8675d5b78c3c1fb1a09cb4349b496cfa22a490a7f4a97df08cd96dcd23eeb65abf8182cd2a53644330afa883cb1be1702b0890b542250ea754f1e2ee26f1abd34cd649b6588abb4823aec5995bf80eb722ded2e156a36c5edcb6d60e409c74ef5c6b625fa3cd5e13d707309d80b9697aee822e2ca982e6ae69ee6c7bbc5f6f1e4c0b14cfe6fec1ef66ce77f08451236159023508da4dd32fee28c1a47bc1ee22ed06736ad2c6b15889e2d39fcd7d02a994c18d7445c67208220651a4f405b880cc72eb164948a88b0d090c5ad6c7901a7d1a9a0c279873b26c4a2d4737929bc5da6e103ce80f9ffef722b4c9ec53b2c8762a9149f2ada016a3812e51e578433499240cdbc3737b2477366ee843956d84bdd131b93dd297a814694c0bb53d546101cb024dd7741fccee4666ba291591f6096c1fb8caba66cadbec774977bbee57ff9c73687b3d903067f9a2abd896a59cfe90dc417a42f93cdd88a58f3be1a4b64b204847dbd0c1923e9a94ac2890e99bce5fd242b31aa9b3c306349ade60ff4f978e92dabfaa16b903b4348f5072b9f180826b4424685f65c6933739e84e6f66c9f4f1f00e0f43f9485ba1faca248d3a389c102d85d83a0e5e1e898571ad9f81595dd031b46791b630a2e4f43df24451ccb9a1a8de553ec8e573c98dedfbe89484a64e8f034ca870cdbaa30e29d73345f761832f708c17d9a407d26403f5d6a07ec039ca30aded4b20afb4a7da9e7a5fd708943fd991277bccf969243342b7b06e19ca32cb3ac127aa2768599d2691bd4181830b8d0245ce819f3438692a8d1c2ef824c26ca1a12861fcd028eca6e3baca44c5a01ec098c961a82bc4a6f3de1b4d5d945207ae0093b33c7cf7f4f0a8343c60b7ab2ac90605c0b0a3e51600783b63cd45416dd9e6a6308f8a42058ea510aa33aeac45adba063d4b7d28914270780174ec4a763111fe316cf9bf95686bbf73a841950fb1693bf46ac9bf8a6f92a0031eaef6fb83bae4c09cbaffa68a0d4a28de537bfb68ebed82909c334011683edf059c98cc8b89fc292c77c0e36e4a892d28b02f27761fd43b441662aff015630e0f867e0ed69444b1c886144c7b8ebaf53838a88d49e1f548fd4d70001de14f42a15c2e3a44e8f24cc27476c306d7c47de39b6b64c855ad36f95f48028f95cc1c3a88508bfe2b9071cd05e219e74d74fed19f7368d93bd8f030ddcb0c6b75730e015573c5dfea4cdc4b3fa48ca107d64035d808084ce72c3fb6379df34402cca1b24faf19da0d21b15fb2a08c95315869b23769d09d768f7181d7638218ba92246f2cfde7f1dd9944f8f624bf1cffeddcec38ec53fd84ddc8b793b2402944ed7d94ecd752b0e4f5c5e396dea987a8a4eac4e56d13a56236192cce35b4cfbc898389f592fcb5bcdc8b39be025d0dd22fabd618dbe1ccaa22ffbcac6401a63b4c1cdaa9a96b5df0639153eb26bd2ee95dcb79cf60ff7746fd8267798e342eaeb85f3af42212156d1d9ed340f89ac1dca671a2634fe81a2fae3fa4c6e849d1153c23e276ce64e63473a34d1cd877b4c1cf6ab8994cef1dbd20ce4c27841c402c4ad2fa2b6c22716fb8089b4b5292ad95193655eb19d8615e7fd41b819c6b79bf4304727270159a3b96b96e4411b0023d4e594357dfea4697226a125598a3b9c24b1f899557c902e6a039272348b4fac87ecd1e5c901b0fcc651677cbab341157fd4693c52b7024659322bcef7ff8bf2580cbabc3cabe2e303b348ad9a030bd371abf1ffc6edcb387a1805fe0fd6ab4f9e2ee013132d56b717e7ecb85031ab15790f3fd140309f011425c103c0c13943a5d2e11e6c09b33a6dd391f229a6d4690b693373d5b7021e309a7023cec075208bcdebca9f05fa79a7d80576efc1dd71889431fd7d6e6c4649a0bb6efc486021dfd009db42623eda8ec9908cd890013001e92bad5642c8b209e3797877cf8fd3e3a1befa4397792eb30574d0a3852a88096d2a862e0fde9cd6f9b226ad90be7fe89476fd59c760343dd83a3c93483ad1a8c99e3b8323d2b0c8a270005fe60f3ef4d9e6c2a0c2b4de62d7f775f318d8a18a63fc83ee61ca6dd299fb8c4930fd073d9156c5dbd8ace3765b3172f85b67ab2607f06041adf790caee32c8de692f397296f8cc7fa65c76aaecca9201199fe144d138f71ccf116335d5263cc78fb7f2010f7b855938a868ae011aa453638899af0a1dc6a559e3503aec381ff3cd48b5244c4b46d34bcb9799cf125134e68ea62abb5fcc3f756df165db8706f26a2e14ad4be2d0206c968fa8bd0342f15e5bb4876c8db84c401edbd85f1165ccced2130d12c5bddcf90bad4f9e03c5d0f1d6c7c48529e1c47c41c99ecf72911ae4ecc395f5fa26293bcebf7b0c41722bdbe5e09490a5cb949a415b29575dd05ab77d90ac239acf39c8eb2b06c08a41ed255e38de8654874b6567f096ada13c38ef62f90c7ef7d95669925c7b8288e99a4938210bdfca2f4bc9d0da8a9958318f666975ed56cf4cfdeb1f0d41089cf38440da1d0f1714fef11bc3299945f2d1827ad1d5dbcb88b0ebd753c8e755b3c8c9e9ae11d95bcafc21320c97c91d2e594611e89c970918ba104ac6aaee6d23ba3a6919ce0314860c6b70a1812a1181785a49d45c0949f1722e9c5049395581c908a13bd51e414373384fca1d71f5a5952290702ab40ddf94d34c4a2deee8123858ed57b53584cbb46ea0e377b602fc3bb53fc91001ace5f0f92d04f5c71016a7bef2198dc8a6a6eb0d51aef48448f4d4afce0f512da6f7ea7dae2f6d2114bc977f2200b1fe20c1240233b801a9e73b44c484eaa46dbd626df41dc9022d2ca8d14f98c116a778d5d2cd7849eb726a39c24848014063bc1709b3fc4fb496606d0ae06a390466e9ae32f9daa239d845aa6c2de8a7ea2d36f22cdfbcbde4e9053696659e207b678476b67b1f2ea8aa16236817e3703d07df5cfcac50d1872f040d112cec0ed12d426bc83a31aec03908c79d24d00d7ec34a7ece071e0074d895fdf4cacd84495d773e5ec3dfbd188b75cccbb8e64603f590c47b7299c7010681f65ad73cf4d1f0feca961461ad68a3136c3a7973a6661a8c966e915f338ebd3334d46feaeb426331931b2cdd72dcacf14aea46107d24cfbc25d0b215bb110430d667b4a031ec22d607d7cf71ae531f7e4aa24378bd35b519ab3855231cf90bb9eb1db70df4ff16514f2a8a2d233146649171784171f7c6fbcdf2864be49b8edb92485e931e042e5294dbc772b429f80373ce77eb3831bfaa761a9b5586704ef42c065210f5da798f720ea33e451003202fb9c2430f34a95f4a81a202551f1f9d91a242ae5aaab29563372e5bc6d36d454f94fc5622b04ddae79cfa1ce057eddcb8641ade77d7366dd3fa32a70a0069b42e7413f812f13d43b752ec8094045f471f36335d339fb5ab3ce5be9256f3e445129a65fec3387708e920cfb9278c1200a27bd07f074477ee1d2ca9744c96458487ddc0edc714bcf2bd9f031bef2d2c00e77fffda3c2b3aaad2dffea280c9e6bda15d5ac84b01ba15a2941cf8cd2b2827f7926117bea1a2e3512e0d38d3a78fece76aa8d7149c355d7a65f878312b39d429ec9f2592724f148fc40d67fbf3188c500ecd058f4229d9a1bc8e04aba47e17cdca94c5974ab13119defe6c90e7808078c7b3540ffa726738accca462ae54ad30c096c561420b54296e504549638d795814f3b40ad77f8aacf1f75ed19ab852ac765f61cb6e5ba64e283bfbcc1bbaf950db8a051132cf760540dc726cbba96673ad52c93cd1179ccefb85dfa461a81808d82335ef5d9fa67838867554b852577778369f0b7470547bd1e2e37d232459c2f266a62c16a59ced4ddbca2907732624c7bc8b924a722287ef3e78570aa1665b3b7f1f886d41824d84ff5b8bf224f0656b15397a65114f02bb0ca097e0af3c2fae8ae1c3f63ae8448a60f6e88488c6a31e9331835beeab3e3d5619b50ae45aa95a8ef82461c11b762733f5ff0c9b2212017c49c263aff22b309c1235eb49caa78df711b08e5a6bd1ea06ac14530e4e62c6f63af3dbe3326e27b1ebb421a2da96d3ca8f0f4f36dd8c45282b2826053162a23d99bf9a3802d0c704094e714a9c3ca1b6d35a5134359829a32cda4026d8a102ce8b350c4e403491ce1e796de4259cb1f90f280fbd309a34820d08f19e6a815f3e9264ddda651f19d17d852dd294048163d03f95aac0b6531179f56d4ac54c0ae5776f20140112dac8f47240f8d78127530db624045b545699b58122b47321a5f6fec4b1bb4cec8852ce4850a1b46560c54eecaf81f9d274127bc38bdc76f1619fa4b09a9e10e780f8271665ca7c026480dd884b94385995ae7f4e7af35ba82b8a78ecb8e252be480e1f6f0843cb19fa6d78832165bfb65056077aabd3b7b2dd981d8b603ff84bd704b0887fcc8c0ab382c6b44ffc66d0e4818f48a69ecd8da55bedffc9acf9b709c2f9a547916631fe8a9ef9eae34329a1d837abe663f88f5c41c1083279ed3c3b4c2d00b5ccf27b4e658bb201d8155c87e80efde76a374b644a201f1cbc8d6185953cf7b149405af85520eaf8b950ab106127cace6473b2f1264058306d0273c57a305ebeea000174fc55c47d681da65fb504989590d57bce4d318140b479f8be338555b6a2e2b760b1a889a74702c008b0eff743c713a68f0ce67ee9f67f4af49d352fe4ebf9ea087ecb4ec664ebc584ce10bde4305a4de378192d48a8e1617eafb5a826400cd5d29d9722f5eb916fb2cf57e6ee72e611ae62a576461cf8f619f572418e84f494a8bd9d08a0bc5fc808bb03753d834fb5eb6fd1fc67425d0e8dcb31797fd9314e68b8f446ad7bd0460b07c7fb61190fbe5ff92c78c9210359560389d49a0b7f08e70da0f7b6e4579ee6dbd3ff7e66e06dab2334a3bcb00b97bc7443aeb791bcd93f79b63a7166194adb9ca3009a1889fc50614322a30b43c7f28c0225e5ef76d46bb033d3202675e9c3cd3e6528974400ec9b980ea3a1c8439b9cef172eecc20b1e6a37d029fb32005da88a1a75a9e96cc51a47d741a83c9a407efaefe9efb131488ed396d54a3f74d0ae6776204718ef192afe47eba450a9eb568ae194b274a53a21e4825a648d65084390f8cfbde2e15b2207a24a69782668d09f4775552c3e80693e11a5ec0572c1329b88d3a2b0ee78897e19bf3db81c36235566f628c749051815eda0ca0131913cc29bbbd45539e23a1134f5f47bbbdae5f7aa0e42566fb1844156faa245967df193e00b69c7064a3dc7369e44dd21c652b58daf42eac8f432ea725d0eeeed8a00ff4b726e96506167360dca7d6496e2fd6fb21f6e52aa2fb8b363eabfb22a1f39b91157d96b5e047a440a43cabcd628f92ab195b972e6ba459daca848dbfaf0cfc0c3bd706cc5dda1afdc5eef2ea3cad5d98b314490bbc99e1308beff16029d87ba1a8625f88731d62c196b58a8b93fed9af9bfeaa003da33de0597844dde6c13a5b8d79acbf1ee68d01853fdc7392c0b8b6ab1880d6e6aafdd25515b08bc2c4a1a3b55df2995a626a321a0b9a3ccea3b883f9ec8edc2567a1a1c1276f54402d7f160f719012527e6140d2bfa2a979e17cb23fa2497e0c5716f34ab937d87940daa62c7e79afa166c07f2f34a3f759bdb620e66174e38702925c4c82827d0ddeff833f84b6c4e86c2dbe824ec913e7264658dab8daa794d47f296632c173db8e80a89a6648debf0a719d9b126a733a24686ff0c0d5ae4270ea84bb6d85fcfa30550f6ebf1a810de2f3bd0a9ac57eedcfc08b9ad353e2d429ea9d00ac523c85f1ff06445dd7cdabf6ff34c4ff5cb62bb7342ae3c0eaa6b5fe5733ec5254ba34f98612c49dc23fd01b0dec3a649dfd54088483a8401c247d4397a15e8038b73d7da49eb9df8cae7aa470098e82a4f76b8beb3a87ff23c8694ac5653a3b0a3c5430adae22f58279437d63fb39711359a70a746fd1d913fb6a0edc4082e75579b1a578dd3c34fc3c1fc619248fca99b55c80550b8d408283b4e0f521dfe922043bb0e66d089c7efe6b1a878ad5a74e5ffe81ea349ecc869d313cea395c518a97a8845aaac88da4f6432c9074585270debcfbf96fc5fd76f1af8197b47f0856c62ab51a0a6915d7cc3a5a75cc8698d15dd50ed66ca375f3ef50bb599648ae2521355199fce92c7a836e2c80b3b5e906d092b38855b810735b3898ee6a192c4cb3db90ebe3541d9d84620735c0b6f6b02539713c62b9f65bdc3dae8bbeba07627af712265ad45cd643cc91c16936ac63ba36c3a30a866f65fbe1766a5c012ab602b0ce169a7a657212788171f6c23b336303016970f08d7fc0837a92e9baa7d75a1c1bfa21dd01c3fde798a236fdfa50fb198c7bc34b6f4838f3dc0bd6504f58a5a3da545cee3215180d4de1c315a45b53f1d3981c9152f3527f684e131330c27d4e1f43fc017182380f30ac5875f5354431978fcf08c06504403ab6c8eab089ec812c9b63a3f27059b7329dc4310383c2b33a5151a29710335bc5f3041dae1fdc1e7d86656871805668e835535a087fe112a42235d9f3280c6a22ab84537f1a54830e80dcefa432f8c936c5aab337802c43e4a18dc28c3e74a875c33879169abbf9bbf1f1a4eb37227aa0f5c928e9af6f0c25ebd249b0b424e96d8a252681fddca97e0f74bc206e39fbdec74c83c0120139989c8a92b31fbf1c6609641f6cec727a85ba262c0ed4203d05698823ffc34cba9d612ebb1730010f1304b03a0bb1f3c1a9d918482ace153d6e190d35052d01bddb70e71c587dc29f0bfffc0efc0d33abc556b7fe2ec783be357d662d556f0290ea87fe6f4b79131e1b19a488a1fe90c00797291ef969f36a6ea7c38b096a22b20383c6154ce57f711ce831cd58929be9b6e5903ca5f985398fdfd56caf98d407090e4b32b1e145bf782ece0ef38c01f4580c5e1cf34f8f9845cc0013ea22e382c74c61d5bb19ef905deab57e750b042ee9976671163892c3ddb144eb717eb214ebc6f599235f5ce1db1853e5712876a100a4be570de403c0e7184050afef2a483acda117bfa1d8c78c6a30193d45b515412706adf37f2e2caea636770a87080d6257031b5c65ec9e80f263d9e29e1355cea0e499ce77c480245bac1e3a091523482ec805f9b9d5e19ff9023f1b8079bfbfdebc59ce7ba63d8e9cc746f2eeaf5f4ca35a36c6d062df58d1e8c2b7b779e94e38ae83e674a514f708d7e721ae405206db6106172dd56af21786836db7c3aa3c8519f0e9e6459223cd41321c79e14ce348617348222e05f546270b1510266ebf493f96ec3ed9fc1435448d28bee824f29837aa627299f1a34d8a8d87186cdb8e3b2adfd9a6dfabc8a706358e92e2c4c54af14ace5b2d4e367a7d0af35037cd969b52d78c23821c7d43d62883489fe82bc856f6d5f71aaf18eefc412a25ce359d45ef3f2f7a71c133f82a15f6c13862f769c5756675282ced6d6673a04f7eb76be27d35fb950fdbc682afada9c209e5bece09b92fdb621bb9e2b178501040c915d26d4f8e28fd90cf67ea89c7ecb49430f99f15734cebdedb5a05eaa967fde6dc9b5e39b2ec509671f988c63e302fa960d2d07c9993af5615d7204d836ee51a421813c913d1a6094c1e7537280eee5961a995590f951ac7c35cbc6108a9fadd6bc3e3cb7cb3136acba28814ec70c9108ecf88aaa35e21f6cd78d7c1170e40ae694366a29723dc75725e3e6bc0ca424bf821e19904115911f918c41fdb3eb6913c1d1484ddd084d34fa438d876ce9a2552a38098a327af148412ad5acce87a31206d925a0e4a45e705f6f3713a5ad75902f6b4f8575a6cfb878acd4fba14b325c223b8d4df99177a129d0871e8b149aa88f42a75b002ef805618ca9415b51d401659f26440f3a6334916c2d02b764499515cc38f800607bbbb97623a157432989b0d149c06bf180a7cd094a1626356650c755341cc67cbc5f532dad269eaa23258798214f8c3900dfdc789b312d73209b4560e71a97ec723f37904df36b1e3efc231799899b84c3326926b2a14425a923ad7761d9a3685d866ca2fca8f34eec2ca1d5c128211e8b989590da05dff71e73a43664feadd99f0caad2d3266ab3bd35602f18a97d6e02987f6e48eaeb12312182b130224a88e683c12a3f33a629e6a7fae684ef9dad1990c9c4254c65cd640100373d326fdf7fd7679b46b550acfde05d8e7e0b48a3665e5eba64d3e11f792198dd90238e4218d3f0678221fb1acf3fea8355113f88b9d8e2681b4db0f5c140245f974042c32077b1b55f5043222debd4fc6e84f22c339b04694fec5e17f4eeeed4e8fcd3ff6ab6570de0fb03d43f3489f1a0b139fa4b8d0251d3068794b5ee0f01d282324dd9f0009213a8ba912cfb27d4cf49f0a549df038aef8b45ce480bfe2a05079abe12b9b42a0e7724f4be58e5c5e1c244a75726aa8b74691723066a3ffa8fb5dafa1a60fa372817e49c8de0379621cc5f43083084994af62327eb19bd207a9f278836cc11335b8b966dbad19ef414750797ad151a98e548cacd674bde18c9f0d8987647e74f6ad601310d31f2e6c1f22f2401ef2951d4988233af0464e52916de93b2ff46bb9e5f6bb83645154ef82f6fb6583999104a593088fe3ba688059ecdfe85b37270c9f758d9d89877ca7e47d24ce515d6356515f9d24ea93217b15b5cf6a1c678510c5590b79886069d8ab2e8183f49400a115bfe472316c30b7636956a427b435d2ef11571bfb438b2f0d8fab88127a049e4afe417f3845a409be95db53b3c9b91f69fc76985e972bde7ad9cefa12c7f5f00efd86678d4179970de96e55a36e30638239dc9e03c24489f218ba91814d38bfa52d8028409667eccd9046048f5913357578bcd84b1e3bdaf98e28c59f29e874656ef92cdfe222b731ed8ad965b92604732054b60101c9adbb1d28f2b8423104496f85ccdaca160a398394cd7c823f86df1181c30a64f0c46acf32faa5f8f5549aa35f57682e236b13dbc0d6e6ba344b558b028d4b6661769d10fc5c2259a2557f55719cc0675bf1365441cdb50f2560a4baf85f71b8ea05967d5071137ce6c367db7bd1c52529d1d05642f321a2d300ee492078f3b36e93e8f75090491f0876c89221251232dab647f081433dbdcd3da30be6e46a64546390e3c366cee84991c7aa983a85cf8550469c0f035708e7601c4febde6c27cc33f981061c7ccb06495c429b37d2a1994465ccfb9de7d29ad5d596ae811ef22f79f7fbde3760e65d160885d494e0170dfd0e44dfd5585ea2da3394aae3c0a26661f5f344d870cd9d87ff809533a4cb95a252d632df271ce53cd732f134e82054d4178c4e19de2684bc054ca75ecb6c1cce57dbd7a9bd1e27ea1b5a34e47828c63491f08a599c6610df93d3808e112386fda70a8fd0c734cd2db0bd3a6d2d7e3eed8c86ca878cb6a9e17221bcb1f0447ebac89bd0c2f60156ec68f101ae5e9c3ebe4c65d499243560756f3f63519baa0bf47e312f3c5793334dab381d275c637d43b517f906308c876c867be48997bf4b9b90ed939f34e30f668aac7cc9934e6bdb029624cba90f0140aad082ddc99683b68bdaa03e1a4c5a206fcc926cf26594e5ef9f5f248398674181b13ed42e92e334ca17b2066017c93ae10fdd1bc3cf490280f934b36febcf94971e70568cd7723ae523e0863cb3dab2530e6cf063321d390943229bcab528f98b90fe1cc07b85abba409e11cfb8fce303d45e287eafea49b483c2af3fef8bf7bf44d6997da5e2ef7beead8f48b32f27731e0fd31f966c073e066033109ddab61e62c294025676e0f57e51e839adb36df2240da7c798cbdb46191453d88da3aba19995929dd649e69929d4df608807bb33167adb896b0b68f9dbe94e6e462cbbec383373e1ae46787fecad6bba7b583c2730d6e0429a83561be55d87caea4dcc99cb63928a3b2b9718282a2c805a3bda1c11e034fa72a11cb9166a2b02e142d6abef290148637d632762ae51f3c67a4853aae66cc95df7d2ccb7bab8cea3996551b4ee5097f4f4dfe8f2e50fe68e5183ada47f1a795c6ecabbb9cbd80c50f3f41a282ed7de494f4aa3af2ed35720db43b83845d8773cd03a57507f67c3842195e6370df28f989f8e43c3fcbc2939a1f1e88e2cb083aaa0181653e6a0fa4508555d444d2d8a0b8f863bb3c840d110608806e74d5ee33074cda76e98dad65288ddb01a08784b80bc0720bbe943497adf365e65522689bd4744fc6690dc9f16c1e156ad20dcf1d6699743f3a998bfed731813b017a059ea25eeb5d766504cf9f86ace4ce46aae7e710bd23db3df5e1cdb844e51759af7acd38814923f4a54802abc852bd2e65780958e5627e9df9ababa3a736e493dce966507baaba5f69bc74e242b2bd1c2c83ebea83e730cede4e9829cd990c64110c82a2340d998f470ebb22d27ef9b3dc041353717ce44e41a955bef4ac8d314d751f1a19b784c3435161ca11973b863cf9a7d75d467a3a299e4356c7ac9b2c0e4678fab57d96725f406c4bf57f7d809ff9271b64d56d4cb8b85d38c7899c0bd0a867518476712c123c327efc7707e04eed5b54a7ca2e2c6ffdbe112ffc94081dd0fbc1f1faad121123f3d90123cc1751cb332998c421e99f2747869870210560a0fc9e5604a74a4de0115698329f56363552749e363ee639897ad5a81b4fddf60be01530d6f5344d7981828e45e5ad37678c06d811d29d5d066e118b9cd5b93beb1e75d431e3e19bd45bb7906ab20d5dd482c6347d57884d42354a4d7156f5f76bbc452e581bdcd59920d786fbbdba5e76e69d4a6c7a5260f057907af1dc8e6d680b222e435e6598dd1c03324085388eaaa4f7b727a57dce8bd4fc5429e2511557f2b7070c325111f4d3f9a7ab87ebb88bc5f14c719a96b0d0765ff62494a436f19665412f372909eb7cb466dd6a5fbcad749347947dbe19acba47beb0c99b4b50141e4f2dc4ffe1bbf0b903f4f04a80b4daa4da0927ed193dea07cbf1c0b5148a31905d0f70227dec745168f73bba9c43fd7188a8ed8eccea7e95028f1e26677aa7cc75df323e322ec786efc6504f8a8d5d9720b73913605f31bfc25064096d343fee83373ab68dd03f8329e9591a85401bb3ba9a744861651f7844223f3883258f1273ed05e55f59f527036f0fc89b43d9fd75be5150b45c359f17579928c7c66c292684664bd9e8df750ee7b31b5c1b8f9e5ca3675a906f95b4d08fd839b910ff6af56bdccc9b3937c3bf680b8bb0e41944a88d2bd54c321ef967b14dbd5ee67ab4af9860bad8121489da934c4bee2217e613def2cbba0cf040c37df2de501bcafd02fc84b2afb24e3271b1d2737fb4eae7e2bdb7b59f777a58ed690af9d72e56bb5bf00911c5d96042039a63db55edc25df85bb13532f29b1e0137e14cccc137d8ef4c2c77f99674bd4e83c693374f249b17bd1e943ea52c8096db46e6c07897b3bc58bca30257e01e7b3f11deeab21a46e125384b9e8b8f393140cb5312f0567c1f9189af431a7a5fc37121855665cdbe9e868df8beadfcf3e0bab5e4efbff792bf0f8515418d0cf3c4c810daa7b000fb5215851cb912a65bcc0567e84d7c0bfc7c85f1967341d1b68f6892bdb85c50e32a4c9340b32590f6616eb655875906281c152da6535d78373140924b65559d4954327f8c502780721fbfb1113924295782056e216120663899b456e3b0a303d9da45c331ac5de986deeaa5a4d3273c05c8d0ac8f136e3f363a61bf741d37ac9a12f5439d66b35ede8e1294058878f1e2065abfc155cbdb78aac34dd4d1ec98233aac94a29b107b960a9b329ee03c1cc580d32764e12d41c1ebeb67dfacc371f0e5ed3b463b7208d8bf89347371b24407113aa552bb51b7804f545d08cc85d76f1974e1f3b1d91ffa38d01bee5789cd3ff57601d0d9d845ab08525ded471de88cb3d87d1426ea84293edb7fe34e82728166b7c9744c40c872e120c464beed302e2e55821bb1aa94f75db20aeb7c2e905283e6456db45e1d11de34974b7c4958769175e97f7ad5e5f06e037a39a66108bfe0569e48fac106e6c31da15556bbaabdbb751b24180d22c113dd29e337ff0020ebed7cc4d91acfce5bb65cc52a5360c592a91c807a9a66c056863942e61399de05a6f9a8a54090622bdcf2d5f1a9c0b2f47805f71fefd10617b1f53d4ff1080f4c44f9b3d1101e3e9ca9a24e636c3953cc4f82375c0a4cee4ca4605ea896d7df64e6ba4bf833e57b786711569d0585fdd58d5fd68601efe68633e4e512de91e464fb4d12435223a68c3524d289c64dcc4a993a7b20f323c7651100cf5cc14587ed484fc6a18cce24cbf566e6086fc3da2a7ba4fad8c2acdec2943d77f1a9e076bdc35514620e4547524326f9ff2c324e2cacc39abea4b16fd510bd75656ce713bec96baea0989e2f72e7e08ee6da9dd7a061a702cd3e3e6c7e08af73c536e5697773f1fa3ba68bfc9cd0df781333ac5f78e6ee7c84da970de63620e82faae8b8fd99f2ced41b193c5379935df6c8dddaa7b56d27bdf222884bf0cbddf35fdfdedfdf8c4b918c71f42c276f48f11aad913d1202bc852d21a95b2dc515d11948bbaaf91128552f4f3d31990fa270ec5c7a818656d0dd0c0cc0f14e3cbbf072091a8d9cb4ef1c1575643c506605f5f0ad47cecf02a88399ffdd1be9944c1b2f9e4760a1af48ebdae2ab99ce5af74d218d62b0f38826ffeba0b09ad2e19e841e29c32507654936423d003b1eae805b9b2776339925bb719175de8ace19d3f08b4924067881997f56f3fa1eb06d0acf91fe0b262a5d96188ba3ee452bb84040a6f36924b103199d287d10f85620d95465044d30717e0ecc455b008fc48029bcaae18f4921f5c0eca7a0dc2dcb63ff59e2cab1af740cb5a5441c3b6f65b74933ec9953067d723cdba9da29d4eed2449f0ef495168e5348e9dd13d63b16f987cd5612c7ae58781f7a3755e7d308cae626b4c207d436d12fb772dce96f5cf91e7361c9e87254067cc6329869ec980540df69d8041009cd2ba623100cdf3e27dfb829dbf5aacd81c405581970976dcd8b760b8f96bd84a49330022c161a34737616152d78dae5049e7f961445bb8b52487b4dec0b3907e0e0204523358c03ba20392e50076373d8c3b77c3eea46f389227a13b6b5c07764b778fd435ceb8953700c9f4cd19ccddf4ae0b2ab1c997449aedc20adfbb39e6e2dd929605bb28cbdf647d5a56480483d68bf1c97fadd184d71824f2b086d7e5645bfdae9b97b1d63cc0cf4da9ce09028a8243ccf81aee736a60a634c9a293ec7dac1efba481aa662c3907bb3a9ed3098d7acdb296e9b2ba50325b8adf5a41b3b527abfbed208583367d4257286ee8d8951d67df6ab39a5200fac449ec00cb4f5b2928c8e22f451d8baa89d64cf8507739a4ef71544486e9131b56bc992c1fdf1634850893ba90c8898781226c87d1e815529e58e838b694e0e508e2f55cae369a5dd0c9ac60e8bbb17f6a23a6d40d246340bdb4b657dbfeae63b62b543d3cf45e11b2803dfdfa9b89ebbdd3474d80dc4803c544577dcbb17d2f34c8362c320ee187d2c97728962c42c69c213dce93bb1dd42cfae21a8df43de22e2d42305cfc3727c5cd03568da9f0011bfefc28328de07b0dbd0e81c6ecc83e208b92008dc3c5e5b1b7cd783098dd0f59680ef69695910361d80ab5a1de4e1b0af5fad7f64aa397aa84586f979b4098f5bca9aa2e1a0e659142c787b5212954f70196314d13ffb4c55c4f179875e2e822746923205d2de630f09cc4256fba4cf52708964b1371e6b4eea28728d529ef3330888727d20bfa0ef1c64fe594f5731c6f711b22c37d4c92c43c105c2be5a1bfa56b41f448f92034b5e27d5605a89713030bcc3afa13346f437815351fbb8b4a2f85a531bdb7abe6131c7a6d5f81160099a2c9fd3722aaf73a964bfca39e8d3fe7a91af6c4b7ecfe26b7ade654f6eaab245a09d63bd0603b71d7b18e6d38b0e0eb98b8364b9a85511739472c6d0a6d411a3fa3903acc48cb825740f0fca7ecacac2a24c702e982c1f0274eb4ae8ffb9d92ae75e7307ff826f7151a85b4099137677007f17c647b9e40bfd79db29d6c52bfa2c48ef4161c061afc675da8de409140273e7645ff93e987485bf564a288b0b9a404a8e3d8de1f7a04b94247263f2481be440a2b60d9e88bfa4c374c40b67a019e1b6b4a8173149e560ccbb5fc8ac1f2dca1a6daded9603b1ac61bb639d004ac1331cf27c350eba2c1f1426fbdd30ad217c9d35b433f7b4f46cc9928c0525388a0d8fb11a0a992f061cbb5895dd9958f3f2acc021414fc5bb8a52e95f99d5e99f446b370fa1b24fddc2860fd27b9e95c7785007f1d70445799e305299d9ef57d1ed67b44258a2d6e68a4e80f8b98e8e6b6e6b5cdd8944a89f1dde05e89b36b6b229b940ba300b5b7a68b71c4ce0bc74d1a5ae2c1dc732198ba1fe01dd9623a2c43c2add4954c28a4affd4c5f3e96cd9326c04fe06f4cca726f437617ec6f52288850483fd488568d5ed7f87f5c83103a5354877c87ee4d0db5123332568a633b1d4c5b2e3738656063bf14f0c28e8ed5bf5dd12a7e5882963be6beee2cca03ee402d9af6bc0eedeab80c09cd109a759f2b6fb1b6664c480e575eeb55885a893645594ea8de4419f62eccfa0c26ba2b11caf5c28e9673ad40a24c870094cff3ff07b2860accd28f16662878febb03ceb6a4564ad8bc6858beecb54c2fd830a8e70d4f2b326cac15e43e41b3e9f4a39bf899b7d29380083312984ad379297e064eeb8681e7b70c50779069183699ad0a0e822960d9880db7aea950a00026f40f3278086fe46924bdd4b1a7784d6557264b7ab579106f8e9823151fb333faa72f1f04afde29d9b7d995951bffdb4f6fbef1d9e633520129d43ec42f2595a5b4623e9ff317b306ecc568655cb3dd75063e636348813e4e022cccf8394341dcbf404d2343c130533d9079fce22dd2bb56063106ec9a50eb7a04fdefca1e0beed16aee0ee4b02e9c6144c567f6ff45228ddb9d2c02974103f9efad320a9fa96e7c385a5a7c62264606a3a147693fda6fc8903b38a21534d33e15334328d894c6a50eb294a8d85af25bb3b7b188c3208aae5c2fadfa599f7ac274c2f1619459812d7d71b38db1e142585f8163a62fc2f69a1f69df1fdead630e4e51d6bc4e5c8370c6c1d656fbbcb5fdc96eb804c1b4497a0f317a8582cc25f005ddbe93d2d2d7478b1c1c6144d2a36698f5195b6299b3cf68315d54fdb45dab08a0a75a183769c6ba1c13d624dc4f32b7e37a1c28117aa1faf49480f3ebe03b33054a7234052e5a309b8eba665a72dd1911ed18fbc50cd95cd43a38e6ae0c57862092a4b894460d3d05b513df795841faf94f06d9dc08644c7c2217bfc7a6fb9cc924fcea65af62f5d51b19e74bc8ad4c1e81b9a0eb0b345138860121966e868e29b81d8dbe05abba2b3bafb8847ccd633b78addac3ca5c929c0a6a6c0790d0e45d2ef2329757f6bb900c5375cb3eda1ae11df217f410cb7e3bfa82aa361254d64b1a13d3bb2e76f81adc2cf66f193815e9884f289498a7dbac9ac013373ed3fd6ac3e334a7679ffeaa034ae430a866daebbf18b06052936f2488e284d52e7c261ae0bca796c9d53489546625a01d07b0b06b3539d65b297adcae6b5f90e4595dcfbe9146a4b54b730f5c0f21c3ac26061839f01e91569eca9d625ee38bcfa2d8bdc4b7d16572d0bacf19d56b17c35398903b7f8b440287efc7ad844438940554a44a6b8e44d3d5ecb229a19d42c0dee5955f945907ba661b5f69edd5c4a0a0ae66daa3b657fb9d333f98dcd3fe3bb3b88f8f2841828bf755b97615d1f03c7f14522130d73e256ebcb5a1011789a8292fe168cdc4488a2a1550cb11c042607b69f6cbac67781138a2caf18ac420f1283fc8643828acede8f36e6b850773fd7ed3b5f1e5840ba4a290b53dcb4ab300882c289fe1a64a8ea76f62216fc9bb60c8e12caf4e112eb446053d40ad9588cbc75176ac034854a127cfe929f596d0452e87c85abd82bcae224c177f5d8a89f787078e7c2fd133cfbc9ca53d6d5f2fb260130a5482194bd0001b6602be2b50a721b74d6f867b473092002524a4653a1e7d1f5c0e6c635d0e49f2853d935cde964f3fb2b596dd0c6f997b21f033cc6bad4cce2d61c26a420269de6b685c4f8d0dd23a5ccd8bef1be3f44368b5787d5efffade38cd0decf5d6284aae3afa6ebeed2e295c2ae398ab10a13113443cf11274acdc7c3f15f495dad9607b9c2516febd7cec6627c41b2d80b9a0a2d80f084e27b1e4004eeffa2758332184153e5a03782e4eb71eecab78a07e9df1b1ef260dc19054e0195e0866a92ef0de74d154ec39fb090703d1b1b79645b5128afb2f9080b2c20b7805ce9bdd43df349343e48f074855f3b9f3cd4d081a86370f37e964f0b59fe3ed330c906759a5f950705f4f2c22650f86c8495529e3a474d2c96a40c2c12778ad03e6a6d7c6feb8dad3f9a08882f5b0d68866c9ce76bdcb2bd9d100e02d5cbe8001f5945c660afd48fb4ce461d20443f049040adf2e867e546b1bba067d64dafaa9fdc4b306d12d1cd5b51a76a34df830a14b21a9d2a0703f449dbb56c108b31e21f3b6f568d1bdf7363adc81d817561d0d9347f80a832b1ffeb2ebb890b2871704346d6eccbddb45e76d9e8ed82593c36d9ccd29bfdbcf2800c892d985a1fc1cb414443a414f613eee4a9abb8bf8bb0e771623fb93fbe3addacb403fd60a99b2349533f42f93897ef5fd3a9335e00af5c2a79f1e2e93501b0f92006ecfebcaa0f307da7e19b847fdb3a5cdd92ce2ede2ad86b46f2b088f4e86f73b18f2336847f72e8acdc7570b0242aa1d80b3d368bd29bab23f9338d3bfef6e067956f23f915bfec6e8d1180cb4ed09cecb88b0dd5271e23c260af424fa98ff0c28eb1e8497f9f3d9dee4b662bff64ef6aba425c03d12ffc0cf1645a68ff22019bf853f6670035b8d831dc9a9e131e739e91c2a5639d6589750f1b2ed60837719e6deb8bd756607b42448330b65ced5ffebb0fc8e577480b6a3d46c5e5f8ea780a7a4f54c0f6506c3d1211389d23695b0161c67537fc8bd00f449967c4f6ad463ae27b2456437561435a65b69050ef0d052fb00169d26fb493ffc18424d6fbe405143f56e14428d370859d4618eb97b44cd051d756a0b4584d2af4c90472f67cd3786e94abf2822424e198ad71626ab9995a8a1b64fa7c4c6dd69b4c4173bb405a5d192e79d068a7f802109e59afc7299033997610ad1ff5846645bc0c3d6082b1e1ce216837c1a9081f6186f81f7fafce8b8eb95ae98677d2bfd878376b121498b726f99fb92bf7bcf50ec3668103bcf6c8420cc28c984042d04df5ac6c2169bf6ff0f007ef94c82425cacf42b27750c858461041c8c6589b447ccc6e4c1343cb3f1b61d319dd07e426a155a05d60060cebc3e20e65cb29c84ff30c11fe78d2ddb20f0fbd86095010cc20baf3f396d6c5086f10523a23169250f10dda2fcc8833caea5f6cf6df4c47cc2c09a7f60ba45df494a36cc5d89e530f013c2c3c37408b94a4933cff4bb35d50879062212b123d7b54a55e3eed3f0ff9577ea418e64de8f66e3832910b91a386a99f23ecbd6c4ec6d90eb23dd3a90a7806490988d36296dacefd23c7e6519326054b35844f2223b4dbc6cdc4fa151c28ed63b29ddc03d05f6ded1ac14e8585631cf0f641a1cf6acd2e9df885cba5b458586d482d9715d202f6a9849c523cdb05fc09c0d7b6e991f906bf59588cf5705da9cc993ab5ce73fa87ec41b0015dae8199631cedc70df33de1805382d3ffc75eb8929ad3d1547847f6b6918dd3fc6e99516b8c562de009770a7d3302c3bc6803bcd41a51bdf54f281445963e2c9f9119efb252d67d04c89ffc0d963e057a351524bc9663d1d71b63f3d0d4c5e82d90f152a1525821c5e75ff0b01c8254137445fc63fbc0466f3b0b5f4e38d933dfb1f1986aeb2e27f409ca974f22849920bd2c0bed634b57fd80b4a23f0a7f6b93377b6570f165ca22233c21c0d10bea283494999d9039a28e5f7cc6b081b8c961cae21c1c84785a09925ad8275547ba768568bed239bf49ac01e4f5d7288fe517318d3892590c200e0398cf4f40eab59deae8f4c047c5c59158a730938f2c3d1190c45ccc80b030cb0ee635ddae6f5cc2150d2bdc267144ea82109dcaf44e610d258fcc592f5da06f7064031907eb0e477f6c847e34f41f4c796297319314511238fc2c527b3a73da17247fd4ec7549caa0e0f2015fb04c760cb11c44b6c1e80609a3b19b36bd4e1d6f7486090871ae4549fabce31eb34bab8dda2d6a79c9f4e706a2c9a4e3dfc2a13bb57c7999cd13d52cbf6598cf00537873ea1733b513bc14810080642b77f91e4f32bb48a999ac6a72e28e9eb91466e466d09b73c6adc7717149d462f0a8fe664d27f766e97064380590997175992be21482e2c932db73c1dfe1917828d14c45288da0b98fa61763b66e3f8e36571831a18cc3bcb134194d4ae6776288225d197ebf404b13214e55dea5a261efe50896aeeeeb25e6df3742bb8603652a420102a599b90a17cebe36fb2a13403fd1a41ec9632fa45236d1cf73707ecf605d63cd8659337ceed9e2b36af8e7e5718feb51e9ad00d3026263e4d8aac7eaade933c77b9de6d67632bed7ab73ebb8e7ee6f54bfae89fb19ffb9939be74541a33922631031386dfb10a27aee86c75154bd622d99c0022842a1d063999fcdc5f9df6608660ff05dfd4c1b94d4fd26552b1ef6a91dcfefab7c356241d0a3ee251b5644541db943105343ffc4e5458ebb61531353317e7ebdfcb3dc454bb82af2fd5f124d80fca4cfbd9ce5262314a4310550df1041b595fd5d439e1bfa82dc0afb199cad72b608d890c2c9d37e8769b8a29cd776e5995a1d4674904405f20e0638e836ef0f479869b13f3b127395e92b6ee36f77320ee3b1eda7c62b1c83493be2f966d54ef4b136ccb6f9b91042804a382823808fb2cd72cc8405b9d7c52108ad13a8f055e2c627d13c460b73490fe2c97abf4544d4793b91d5bf992ec1e59df15ad6d81394c47ddfb93a49e7c1094b48cc0c986ad0fe42ad410c4bd40108c9d5e168c9940138a6fd5fb4d922930e1c37861acd791a4fb59ed6dc4fadabaddfa147cb8e68b152f36d689925bf9932b022470a01a88cd0f0d6b19474f040915cb2a35b81a10c400880d68d0348af5ce1535c8fdeb87c796fada6404f450bb88da6ab8c2dd6b573c86f08c40c4702ffe9b40ab38c9e129d77eb887c9da1795fc67dea5655efab5c703a923ffad2d958c71bc4a7152dfc9d1bf818382f99fda186ffc7e430c0e4e122ba9bac46b8de823bc750f8ff9ab0fff8a4269e6c2ae4353c48524b218edac84621c261c393003538e494fa8599897896aef240ac35583e6456ca00856f0f4fc779574895a878216f80cb8c8e59b77ec394e6778d6a3009db5f3b125a28524d5f0b1dbc0bd1831df2ad1e94d9643b564b5bd1cd0fd1f50bb8a7c469a303981596fc6565a0a457bb7ed3e3d8a910730866c86a13c94bceee601bdb8d5fff8284bb1ecc4cfb6647378cbd6d3f2a33e5d46d81fdff48c57b271fd05c3ab433f34804302a68b477e8eabd08084f02479ca8906a796484341cb4c5c7345167adb6d5ee19406443305c5bad23c07d886510f2045936901d53b9ed83cd664e31f00441e3278157e71f81baf88c62a471c9b9ad21ac6cc811ccae92df340d84d77c49017b06135005b94fb1cdef17cb9c05b63e9c30e9ec063947ecdb6cdd366d93a38431be602397f56898f3b000358f1c357ba3bb97831e54904b44848ae06281088c6d25230a64de39b9be64610843e48dc430f8b77132a9b1518dfd954b7b1da9fd47a5710901bb498b3950e3ba3a8ef6af2f027c1a4636385da7dab450e0363f8ba3c06056cb3c6fc33e148b87bea2786f6a42eb281017d1be9b374b20dfb81726a957865767154b0ec8166f42b99850d20317324d64fc30f48ef6adb1aac80adeb79b95b3cfb14b3c2508e841c72e4deb10ca52cdb3d53512ee88bb8354711b44baebbcbbbe6da3584f936f1a46fbe4e00eba02bc2caa85083e952bf2ea2049341c5425778b633284b11d8b5bc1532d3daef299f8f4e2fd1720b2d2c2cfa7e2d82635488cbfe09817e10c4cd41e3405513a76b3c60648e8c129bfd9a26ad4bbd7074fee1da15dbb010ec0eba4cd6a8385e47eb6aa23e2a00d97399663dd92992e15ec32bf09c2afd805b4602a7abe464a419c3f89d9bac6a1d05b82b7fcf9b8445ccf3677de9c2e67986217919a20963058018a8d1d3c135379e60c2b00de6202afd785dd51a5e702f7007689e1c9a267f5725fb0ecd106ed6c0428588f17fce550f2ef6f6d1dd821a970fbea7a552fd3c82b3ed945bd727c909d2aeadef34fdc170d6ca3b0ebde7c492dd7399bd52d769b999419bb6a7ceabfc923bd9dd9fe28f3541174b079a87d9eda24efaeb91567546370fc672f1bd19ad3f7f34af6bb40abd5fafc5efb30a6601170612a1ec51d76ca9aeb03cc5a65eca6ddf8c43a8a49be40840b41fb91ce1d3d483ad1c69753191d41305ad7d67bb575dc7d456f530e4bc7eff3cbfa8fec5c3423ed9e9a13e549eec11424cda550eb7db835b4551836953aa078f6cece61702de1206bd6dde71f9fea3b91f573856ac02e91337c045fca456350036af28abea67271798e12c70921cf8cac4205c52de5b149a1d9d0bfb5236b851fd57ca6dd35efff710c2966beda86e9b10d39b9b9a37c7b6dcb6bf9d015ae2e520c98b154def8e21b0475190bec24e09ddccb8e49f11ecb2c46c653d4f5c4cbd5c074e1f04374ce3f42e51d5be2dad0bf7f09ce536b399e7dc748257111dce8f9c7243d741fce8a6a19392a8b215a181f5d67648de6ad307921a4ef0fb9728e1fa5c10df6633b7a443ad20401ffa10ae9c7b83cdee30962bab70eb0a199f134cec67801a8588c6105d0679420374e6778375c441b1748cfc4379465dc1d75aa735febddef596c06f3e05a3b64b5d642be6312acd27fabc44cb92b889beb1b5b5b86c49c5181ae2ff5af4025c2538f184b0f932f41b669b1cd728ddb493b0b8554f0aaef4d77088004adb30dafb4aa9bc4db7534695ac6940081fa8f31c9a35d3b4b0efd20e3034e3cc3650958348ac168c25d4cfa758a34193baee0e1eddea23850c4c024ec55730e35e2001fac4b6e35f4a8f72a26491feb9d9fbb261f50194afbfef8f473fc270cb57e5f9b43fd73d299a4471b75bdc92ca82880ceb6b7e21eccb2d9451d0044524c1c3b4572da52c21f814490d967793b056a49a6f7fdc06ac2ee715c2110a66d32a403d080d107fa7370ac757e745a64c151c89aa2b9f38dfa3fbd3e8181b663f401215ba3d43037484133b46658a0218f4a475c3a843db10b039ecfc081b4d2a803d7e5aab5ffb4339301c31d1844fd62118c0ce377a2fa956ad1d86f24f77159f6fb16c3cfd5c4b94cb12301d2d15835a4dd4f89483fbe066bff827b8f0ccba2039a9dc869f9b7991e260382f6ad5725be44b47421688cbd598db77d8e9bff7b17cd39bd62a5f275bcf58f42f4026fb7070b71e71458fcb29170054c45abb56eb756855f8e5cf23bdff491cdef924b3687b44e203dcfe70e4027569b23935a25465ecda1135335e38efce2dcbe54c0f61527696e695e82044427205fd46b89cbc0b58ae62be323cdd36293d143d453b7cbc3b08deb4a444c37bd11266fb63e3bf3d87c84a72148a7e91d3836f027be76c6985f7810a339e3e1ffaa8e6dbbc1299ee6238eb98dcc865fb305b8c27d60e52f46ed3e21e2d3ec07ac8cfe2083f425044ac899a2db71ad63edcb29a40816aab24083aa6c5d616c7a6080be0fec13748c6bd2700904287953780eae137d9c9d98b0b7498ba77f8644fb258be63730a7ebe85300091581026f065735f949c9edca30c4635a05396878b4962258bd3fb6884f0b6837811cfa44a226aab3db27b0e1e437440a864fcbcac76b2574928711ddec9a30857d176249bb37cd6c4e5c8519a0e16ab1bd85d79fbe173ef70c730ebac06208fc0cecdac05fc1f2f722e36019bf83e2b6cefa1db065c627cc864887b6bd060c7a0bfeb882eb45f7c0be3529e8623c0330a8648cf07abd1864ebd3bf031fb17b3a28b922475d9ea66b71d50e071fcd94bb60b01df7b76674cf9cab73ae6c9f736eb0e0c502a064b6d28bce23dd49429412afb3326aae57e67d9f523fadee57ad6cfd7c26353143d41a5984f3adb5b6fd552bba53b26438c72679ffbedf5dc359fccc0c07f0d655c3e84f089a05247c8631b703a23dbe0013a13bc2ebd574968a63f55c7933ccca8165b9fbe8074c4745ff1333e8c3af32c4f72b80ac4f087c7adef80001e74d081ed050d1c3e8ee667abba0d137026fb54b59d868ed15ae18f6660fa246d6ca41672598cc5e70a40eceb10ac1c178ffa5ecc6d6e9f40e4ddc944516e4978a62a64072537e56be115a12dde1a54d426da0eced6d913e98c57bd9254c3e77e12b9fa21a7df2897334264d4e707cd8edee4dc0d2d168f2520f6c63c52eb78a0b94b676d9af2de3e898b3d63adf01bda5b4cea19fb89181dae47ec7fc2a7199be48bebe30f2b3867a4c2b7e0aa151d0f13f97df816551655bf620cd6b8275d35335865b4c91505d776ca34a24d677d7bc26c1654609941b2db444e697dab62e30fab0ab71545eba42e72b0f194d77008a89fa9cb533605e73d3fa1a308123e51fd93f766984cf89b1c9d06fc04327de5586ce4413649cd956b894e9dad9624478d5f0899b3829c42e437f7b4d1dc1e8d6b5a68a5a18f55a57f8fc2bda4e1828d740702b80256d0e9972ff25e5fcacc10f400715e2608e721d2764e4ef0df4cf16498934fe4634e6a0606dd04018027f70d4a7ca3b29f9be2df78b10f951b04a5962c09afdace2773d41eeef83b27c55aaddf069402a195d5973eb2a5d044e08e7f3cc7d524b7262b389ca196f2c84b3b4605ac21bcc29217dd4a55b4c3f6ffd293421ec23caa3f65a5a59d9a00b249e54e6c1edbcfb8d2c072aa35cd82a86ac9de00782b6d9dc1367bc48d576e0bece7f772a4d5c8d2558c3785922667d7df9ae63ba7a1d0a9e197177c627c529e10a90afbe3df39ffe7d385e5ed811a51a188e00312219a611266e756745a64822379b87c77a993787fcd1eefd0af96ff25f3103b30f0358589c3e92e71f1633c9d4e608b02f0956ca70f0f426c8594deb7251e7519593ad26be24bd37d52d5d55da2c7a9da6833510cba9c2fab410d73b61eea3b78713e1832b331ed3f090f05cfca14944983cf10c1101cc54beda7ff1e927b212d92c8837a89fb0bdc74b8bc985a667a0745158475d3a6c3008e4af1ef67d3387e1bc1bcfadd0673a69c03bb2493572385b339dfbe39805b95c52ae21aaf618564ab680c407ba4da6e073f1148893c7003451b39a86b546518db677237156397910b7dda2706d39a0b2ab88a27e420a1c3ad0424591ae271e0393f572d918dc86741d38f60f0b06a14847c191de19139b2a6987d612f5a638a6c731d70cb89cb9284925ce77ba8aa6b6bdec5ab3f76678f5ee2ebfc5837732c2ae87d29f413b87a2353f68a29e1bb20d403e7c00ace28e2c49af2f0fbe8a2e1abc7f7260df58001134c72795d3d49104a93ceb0b4b8101a5f65063662de749f65f3ee94b459506c70029b7b46b627d99eb99490a88322f2e7df5e54910f0a4e434118cbee002546dc16df61f0409cfb0e64286440d7b9e7a73d537c15d46bd5cfd8a6271ed5f77acfd73cfded1ad4b137eb87437b665981540e58d0e29a9e264f02ae8c333f9950cb768344faf60c0a4b9161b634f1a119b75e9eceef253ab6e0c3ed55c63a64f17c1f08de113923b863bfced950f6b3bc3e316b5b9fa1340a7fcb3e1934c452744d9fbe64e4465559edaaa92a16248ce6f363c85494d4ca7b335913bd3a9f0c2a8659d73b2a78b0015ee81437ca456d128e0c0f3bb2d77fd6102215256136f643f7a76415002f04039a5abf8618fab37cb9a8fbf58777556d49f8064c12abc7b5e6ab818c8ad490a09d0d9bbe0dae624f5040d4b284c358b4e8f7934f9262bedc3cbe583cfed7c9dba6bd833568177545799342dd05119b16a985e12c96fc6d9e16731a0d8b173a29e2eef9d22830262c1e92447c4d48ab58195d1b7066c3d35240ceb4609a87afdb3e2b289b93280fc84f9287b5191e13f68b690caf38c6b2a1c3160b0e3234ce98f30f52a5dad079f735a0c90f1ea89c5cb1bc4ac461e705b2aeee1cf8f9406954c4ae26dbe33c88ea9a21e24401fe4ab7c3af922f294900a18c7d85f7155cef0f1d934e41a803606dce448c4348d86b16f49ea46958272972083e775df490e976f70e32c04cca2f385a65c914f1e249d18c62f65a854293d8b207d4ef635edb2fe71495633f1012c437df29eb127a5b740121d883e4752a071897d2445c6e81d4f1e92b41af615c17f2dad27db94e5d4afdd4ac525e409686790f0e04fa75b11e9fd7f32e6f07a7f7e24570246bd5d0feab4596b50de21c48a222baae42a20cded4107eecd72b12d41c433fa2f5e41bd9d014166df78100400101caba52e65a456176a1dda5cec7e3d2c5a026d18c1f3b99f03cedd4f8fc4f767ab2dccb36fc0c00fca80cb9eaf763a8ceb5ac3f57f5c683fc30696e8e0e587e7cefee0e76e04e0558f60ce49990e6ba79502228b611f1e5245f8be922f4071d98788ec11e399f97f436bb0d96b2b2d6f7c2898d5f80c6a41ec978470247022e7107a5fe2fa3e4b6b0de8afa56dfbb41d108c3cb68c09e7208d145c051e8b669e73d4539abf836584bad63324bd79ed8064313a76d896f4a6db69200d960539843959f3fe34962438b991c60fe59640f4ec87e4a9538747e2432971563e1338259dfe91439f7d78c434396d68992fa3dd7436849609951d96b33fcf217e705f44056e6bbff0dad3d71cf8a0dd6970c5486c3dadf787e9fcb24a12fd0e7c7255bdb18a077ec66bf3feb21bd3a54242795f24f07a2d869e2e3a76ce149605f33ded8af9ad669f0880419f55ac05563ddd7e566826aba56d32dca94294c454c4b9fa869663e2cee4fa3cd06bdf3f44208e2455f250c936f231ca5080806b5121daa53206a4198079a5156661239591b9ba815b03a03d3e3d8b89218b9b195521ebc566fa3d388c1a3031468094ed4c4746f6934b6b1d5f7b6523a20f1c95c80450cfccbe9741bbc6de6e3271d182de1fd4558cefcf0db81c1b69639c8c39bb80f9b223223c9da1ddae1c0825110d2d858be45c4cc8108576efca0ff6348e0919942ece4ddb5c96f89de1442118427e2ee2a817bbc208a7ed60856436c2f71d439b79ad4da33151128220b256b7364e7cfc90a56f12f48dc5bc44a2b4fecacc807c9e7858e576cd6b38f9cea1116e52dbc71f67b7a0cc05a0c9fab84fb674637fbd9940d401f7d09fb8f49630bb791b9ec5da59f2b4e53b178c6b8f94ce78dd55d0e2ae54cd59a021cb9b5f2e2396f7d30439802a39a193461165bf9ab98027693f3b6757a506299cf3e7ffd6a80118da64ba783cda48d1fb15444c9ea7bc82868f4d764e74e2d5fab3bb1bed27e28b1e553d869d3128d30cadff645f953536063bacdabda2d8086cd4dc15ac6562aa17ca5e8b1322892ebbfd2186ccf2258a5048e12b9b39cfd48a71d5bddd042680cb64a2b7da592af5a64b3e350360045cd14fe737597ff82f67631f755a7116adeb6a7a81f1e82a4fa97c70f99bba9677aee483844af42ad7c43183dccf2f6aa8c04cd93f4c08c92c50affcc511e9d4f16eb6ff2a402c85472f81b975aee4a1440446d88f55f7bda5881f2853546fb54bfe9c0f7c4473a04ce5f859c26f29b5c8208a97e9d5a0fa0e7d49162632bafa25c022804feffe1aefbdd61b68dbf3c6f380aea1fc12333a6d409e9aae631f469ac22521824e11ca4e56bbc3f1fd44692e7855eac826cb35d72865b608fb8c0a4454a051bd39a2352b57711fbb251a23eea7cdaf37eca4aaf82c7c9d066adeb053f52c91f26be848006c6a29dcab4e38aaa999191469b5941fba5722d874135953817a90389604ded1417dd3c531ecd608031eee2bbfb30afe6c3b2bf4320d201046c74231ce7d4c9f0763c2309fcccb44e95a802842fde1f3b749149b71967ee0e86ee687de17d12082104c068a632bbcc82c79c076cf2c5a6e3d17186ce31d6acba89f3730fb4fdd3a9483302f372737c63632788a12709240469baecaac89c283f69c70707da4daf3533a8f5a54c5f08a69889c0341cc7ea2934d22b8681bc7f3c78a5a08ff84c58c8727e40401261e5a4d86a271370859d3e56c5f4dbecda046b9059feaa657671f92c5dcbc7040bc3b6795473199150367d9a5d0c7914e9902ce49faad6eef29222d2f12ffff593beb714226caa0151e1f7b8cc5459f787179d4e6972a97a48075389a17bc5df7495ca9b7b288efc9e6559189618b079434175a52c9fdcc5e08f21696579d5f3cf3f8efd4be509e656fc47b8cae4036b3355d8c5ade7b24c7c981c9f78321d45abc12fde9f4e723b79e917db5fc0a882b3704d76094c30eaf0d73a5802539c3cc84e975386f5ac909558e901d6c85b75149c582c3955b23df3b391da2e3ea403fbe2afcd96b0e1be4aa184f3291aade14d11cd609ebc5da2a349a53c0fd52cd3131dfd7a3b534b9019b4bc375469220ccc941a5d6551113dc159c6acbd041fe59e7a87cc34aee359af9228b798123df99a54300fafae626b4363a1b6d8058dc50f4b17d7798b11ebf68728e95a694535f46cd24e90058b9119bb96fbb02126e46e5aadb3d403f8e2a0d06908bdcf94116c124801f99e6fb2743f14517dff775d1df1bc47b113e0981b3bceed6327f914bd4fc00ff8d6c6e26a591681bed4d3664de56d19e0b8b6319984c299fd99bf2e1c1a3a7b57c96ac1f0b3d1647fd6232ef650d135a6d52a9c3650b9c0b03e02165ff2c5743d3ca62f77f83fd26214efd6904218c570015bbe10b48e807f8161a15692e80eeb2b82ddf992694268518154489695cfcc3a97c4e77aea140bb494ebf68d4d8ea306d5d38e3e8a815094c7a12ad2b427a3267b513f959246f53b8a77b1fef73be6f7c9249ce224491817734d5c8d01cffe7b72e205ffe25df5018840a106fd81502379d2b2c7ce5c9c06526cfae6091de1330c2fa5f245cabfae8b90ac2ad760cfb77c30c8e88ab7235718ec96c0725bfccff3a29e8774c379f0e8038a33e4268e827b5a64b969ef42fedcdd5ee6449bdfa6b50fd3369be9b1942e340fff89186d213c3a9d667c17547e49ccc35de55e051129f8882a305f3077dc1850e7701a7c630e36e79260ecb7b535b2c5b9bec949dd3bec7bef4c6010a3c416b104b19314c51c47cefb91e7e229218b13ad0207f28046b154519084de8246498a8373c5fc8581a22c037d1abbb78140e78f1d3dcf3c6b1efdac6fe58041cc1b887562f2e79ae8297763cd04f4d091112fbf519251e50a19576ac644815152806a34d7b019d65e836c821c38a8323e55f5360615a06614eef3bca4631f96833b60ae1401dcbc11507f923578b2f0ade8c158c65d242d7a05554a73fdae68b5072f23b1f461af0812b95553bb567e66f597a59ce1ee05f5d1a93cc95c5ad94f47526fd83b8fd1dad08577645b965f8b7bb277d75390bce78fa290bd1c2bc2d8224343550b4fa9e6c865f14a65eae78535e4a6e724c6083bbe90568e22c7bf02cedcdf32c9325ea4a6b9b6127a3b5c98102f195425e83c2f32b692b1468a6de9110b145668c57124ee9d3c1a85dca164248e804d692c7c3d1d5093a221f31310e7ec2a063b6f1af5fa7dee40d68247bff847636941f23e740b4149b7ba3a8b7fcbc22100214ca74c98bcdbd37b080c63eb32312e2680fdc74ef508dfead14a7b274f1142302a32e0f215f3e52a3cb8417ca1c3f5b33c134298a537a85eaf99b65764c3a650481d6abd98b36b9609413b4e32ae1272a6f0d0d1af23a7a6231ccc76e54323b183692ebe74b1ae2a9dc74738fe5e2fe8f2a8ef051cd9205e6668c4756e2d8686a7d5f2d5604f169def9c983fe39de92ee1a6ba95d382ccea187e6197033598cf8b44f587ac66702ee94daf2a8b0aa15ae308ab488caedb34924d41a2ea73f448006a8f479f9ffb20741204ccb013fabd539fe9bb974535579ed24a9a662bafcefc6fdba4c1dba5eb325679305e7b8ae47985cdd92733f89dba10f7d3070c6f8b0a4178a88fce79b20ce09db71e7583f5b9a96a0639b4cd0e49ad5bccae10f11ce24910b95a6f7c74fbfaee0a3e6f22551372ea207b16f3759712372a525983dabded00a73d77b36d8f84ccc3900f0dd09b5c8b2f5f11f29a710284ccf516749cdb40283c123c739adca9acbb15f3a77713ffd1f067d0ab876b7bdb27dfe708f26141e021ad4da86f18e4fc50f9317bcc4b28a023eaccac0d9d3213c0f7f200a0ae24958ae82ae55e66d25452dee8e1e605271cd7afbc2b7176e72c8aff890fe299bb3d04bedd7fbb484f9d4852e556a5e8f8eaadca3ad3f0d698c450d1dc0c3cb4be54cf94914926cc6b77c09d077a46462e38c4df68cfa107c250f9aa7e1243c60bb235ac189cd4ad5b2f710274cd2504a3c98a1c977f037ef3414ddd79fb2d2ab571c85f1890dfebf298c0ea741f4e06f56e32450073cd1b18271c7603cafbed33feceec295117667f3bd2ccc4369e441aa2c94213ebf468f3719a36c78b027cb5d3b3c72bf436ca999b3961a5fd8622ca27be98dd8b8899daf7cd13ac7836252a91e81c44c2902f2c9166affad73b30fe654ced63e2e9314c24bc393de55e30c851bb51aafe88d6d254df42377c2d3874be2cfab982a9b459f66399bf4a1d145de356526801ea194bad3884e940b11c9af82d997dbd5c85a64a93a7d0662dcb79a555e2650ab4f19fc46e3e38391b19eb9c4ed86431df5aa7d9eb033374fa5a04a6843b08ce3c4ea31081238cdc10a7daf8eef62f5698f899430585816a0bd7c34aaee05d4f1db0a2632ea4e7c4fc48a95bf1be6063cfc34984bd7ee42533758255710b3f1a660cc80e80bd8f79542acb49f4bdc13f5551e8306fab2019fa8634f414a7bfe0ec411ca16e73951e2ed7a396ef0f10cb64b5aa2e496c0cc438456c994f78276ad3e10d83cc137329213dc95c9211fc98e6e3e91412b5683e79224f17845462af2463e843022a3ea9f07aec4cb9b90099973f52223c64a07937ea44b10373e6518a8920107821ec193e47273263c7c4b457fca4a2905f5631d349ed5b77366bbcb45f13621ff934757aadc87072a9205ea714822d4ebaa1f45f16c6f27415caeea95e0a86fd294807d7f1f688aac0a2791ac5490f09c5bcfda94c0d74c29606af4855b8eda272dc38dc75e7e1606b3b0a20e79c4dae1f9aa7fc58479eaacc2d368d0cccdb8c24d9c64a880bc9ffb4abf17ac76854a0a98d9afd54e1b6e67c8be3f634e9e3848d3be5e8745b129c3a0d57090865f566b74ca294be104c17f67386c33ee1250a495e300c4ae7fee0735f3147e0a61751911bb2839f6584722169b76bad5e96fca0218bb31364bba4c5c53efbfae4dbcee6305b91ffc94d665d58597320aeb68fd588167da05cee3ae0c4d3fe61feb5a41eac523dfe39c3f5714aa49b6454d66f4773e155561611c48ae031fb366a4d7ed1c16e6e52d18fc7b4c09429c9daeb8bac4f3f3a08d09609cb0389c1490aae7556920be8dd9946973248938dc5ba6ff76642bb81155fb820a82b083556574d27f17b59095d0ce81e11585b48117205d77fd517c966046ef43dfade0b02d62ae01f47f876ec0c3be40cd512d29cd77d8f1157bed46f4790a8dfd7c030def9addbcc4ad5aad820986784094af7dce19eb7f6b908dbac237c78a614cc4c7f0bb89db1e3450f41e73d46b84ca8edca77262ca537c48cdd7c1db2f4ae251a1756c28791b44401069d09985464db495e520011b27eb7b1e63fc0ecbfa2646eefd384b001836a577b219b024b0cdbc341457bad782e268e632d5c80d541be23cc1ca41bfed77563ce31d0bb58608a9124dd07cdce5acdac1130c0d1d6af8035c550e593d7b8092eb33c3f59a4dd7b7b575625acd3509296e5407b896b17abec134375263cc40961987ab228ab7c74f87efa1892f0192e219bd856094d5e8ebc0a8775aae9b4bf8cd4f278642fb20b9f976f06ae41cd7e3cd5d4d6e58de63e22d1017269d3d0cf64882a2dda2e557b35f36b64d0e932111c7422dfcb0883886df5e974885e87db346f15e590f901a0578f26ef5fd2381660086edb58b8d979dfc5d7af0a856eda809394efecfaade0fa500b22d4792cf751515f88d66c39fd890c162d175dd75d8d264a83369bf4373ff6c5dee1d4c78eb4eb6b0f84528bd4bf230555112e8fdd8bab88e80d626e619ceadc965fd2c78599f5f59135aa9c4e862c5ee25913927d152cf96d49b5b2813354d5c8805b7f0ec5b7843471881e23be4acaf274a2179f3855ede89c25645ab36f19fce69cdbaab4f1280a74de2242040be30b4c757bc2515fc0101e1a293065bfdfa9acd9aece0962932df2d6d66718d688959b61d79c7dc6bdfb9f456658ae809f4b926e124ad9a2de1b2e9e2653459223f7436c769f5c85e14370731c0c34d7674e51de8efdcd4eb56806de1cace39b05177c17ce3533de56e47a88899fb338043997b582c0a232f09c97a5814b6a19b8f3e328da7025d0f04780179e7ba7a4b1da73f779c0a8abb4b0ae7e91ab6ef6d39575e2f7f1fb3f1602b801e6962867a1fdc123c93933ce2271fb69f307c87e58bc3cb2bc1b532db635ecef6eba30fb1cd71f02a36c6461c76619ed2d0db2a60eece2f110eb30a7f2366d6226afe6450458e3be5c8f63e2756eecd8df11a01d18f8f50b07148b695d7444f3a192ab7b956fe759fcb5db3e7e7ec89f00db93f12f057c0ff334b7d24327c68ff699e2ccd63f62fcc0808be881e29f981121a5b27bdc946351f8ae6a64247ea062cade1a5e6e430f0289bd2fa192ad6cdf23231416e3628552eadc609ef0ba9c874d84f54eb192ec4f67325a4d1f768676642baf8290f8a3bf38637e5ebc2dce1372885df726721f0106a1f9689c187c364003061d1399803c6b304a561b231ccfe927f286759e0f0443c5a854b59eabb2a53ab9f18804a3fe82af8c254134fa520ac5c6f8c6964c93b6d6249f119393b6e03cfa3b017e27dafb8ca98ad431aea003583111ddb2c7abb4339512734596c091f41c3809628a05c8f0bccdbbd947671f45d164c85a75144495776dd19b03c1ab3129e298702996ee2b61fb2e0bd0f105c6b3eb1b4d956c6636155d55036aaebf3ebb7ce418690cd44fc0830378bf8f8bf81dc5d96f40c457013fb8e046759a45e7c1eab21285afd3c31891615df0a1095ee0a8b8695f2d8d276a3f89588b3b41ea56dc6d1f7d13b5f86d525358880d9dc5a5f44fff86ad16472fd7e9baa67b405afbeb5b02cf5677ac72ab1e554dd8addd7c08e25ab80b08659dcdb86b1c5e32bb18100b9d2cf1c192c3eda5d6bbaf74497898eb48bd4a1ae0ffab4804078f0fbf4eb19b5036e82c3bd822a1f576f3f3535f01b6861dee4ba1ed979f38591951bbbfad81d6c5ce03360fd13937fd55548a318294f5ff16fc9738f665c9b7eda4054c7ebc708e1caff8d03a7922e6a60f057bc3e2b80dc1e7db194ace5a3d86296ce0c3ed25e473879d7e8cb5b93ae5af9bee5b6336f5021aee7e9659f5a086b2fad6fb7b6cd06684597153cc2d6f0ef09d242190c1cfbced63fc054031ab6e50414bd92aa908cb3bc50288f70255c7e6407996912957c8dc71efa11e9bd1006f66c17b6c425bbefe6e8a4acb9e9bf0cf77451fb4b97b8736e8b56938c73acff2f262030780baec7e7c8b0cb520332fe81fa3b46b59e07bdbe002e53e6fb450b9fb7016d7995abbb77314b547ed06770e1ac857b61d101a044240768046e809af3f1d1b870cc2deada49b9af095f172f975cda71f9f7eb2e6754d62b3e37dc12fe0bbc43335f1d24b6c6996ffb70d7533b228666f305e7e422d704f5473c480b827934e19318a0a2fcf3b1491c4ea2537e145ca666bdfbb7261f57522240707d431cab9d5ec5099047aa0f939e0b11197f7a15d5f67735f9413a66a995aeb4d66b00b031f1c284ce66cd34f159f14c6ade824319c6760f0138b0fa51a9b2426263c4d3156d6cfcd05429cd059ac0da6bc45b28ceaf0ac7b1f334c5e45809878e9168a29100e415453cb18d43ae10b8db15da74e8f9bf7d26d3430ac75478d01285dbf5f96845e23d807c7162358ea7d03a12f65854e34e3840bb4285b67bc3b57f975a5f5d25436a1b26ff3600a6d8bce00a3c0d260b762868c8819c16aca6b0dad4201e3370dd4bf23f51e0e08742874970ff6b921f4c0c1eacb8b5a6b68aa77b98d6cf069381e54cce911c5fb5843a8a8cbf712d432c337cdbd2b91a3fbb10d044b6981f27a8ae57d564b59111967ba48d393dfa961c28369e6ea9cef2edcb5a7e15affac6c01de063000edc46a56a7a0687872dfd7bd5fabb9934beefdd6cf0db47c6c2605a325dbcf31b04e207a4424919949e57e8704da253968b13e8506e91e2dd978be5e8e3d9071fb8fb1e1a6971f86368bf29630dcedf6584565808f923db9d3a3596cef1c64cff7093bbc9e284d9e66d1cda41beb5b96d355571e9f6e80063c38c134c4546f045bf3b2ebe5b834262515aad7559754abbb739bc70682b1344e4a5341fafee08ad6f07bc617ac4cc9e6220be4047153fd3d9fc9eed3e45582af1c24db1186d26696f81bb516bbae96ac2917f82fe30c8711692a1dceb311e18aebfbba68170d47ccf188d6da9d1d2812b73d5851837afab2a9f8af8f3dd10243fb294fa15ca1992fbac5c3047b1cb3e703ddce82c0c201a0e7da7950ab4163b01e713f54af7b949afae7fd2f86b6d22ca306dc97dfa724647d1f8d538327565ec552f70d520eb5ee16719b3ee07a123d6bc0213aad1df9b99d1341cd7e51af835b38e14f7f00f853e4d50502b4f2910e8219e78a8aef77e7f55203acafd73b633541d44c037db3a03abd6f8c8b640b5bca1bb4885ce3fec4323c5409d084fec9c04a0fd4887783b5fac6667fae3ce6254ca75d0ac3487596c5cd8193b5c860efa7451a4532b1bc0b3e1125c588c5f698e616c96077fdae77aa45c58fd18382940bd3f0794d640aaf16c34426fb30f62a7423e6f3f44c415f225df29a89081f8f34e26049cf6554fe1e706c1accd61a4256332802dc6940c41eaeb9a56bcfcbb3f85b28c4bbf8c90fb8643383433bee8cb4dfaa00c6e3e3eaa1a70996ea91116dfa436182057d644283c93d53b69cfb757980c21ba6ef4f1f96423042392a1951a40a75c2581a46a5fdc4c62b08608b26373930743814448b0411b3ffb9c41ffb7fa7b91f928430e404c93c369cc335fe54be900de9e5f002ccd0482a6ff08e67afbf5ab8cec2a10c31310a446a9403a0d6f2560cee2616107ad8c6da2a01c8d652ca982caaf61fa6a820d06c8711f96ab8207de9aa0be8d65e94b26184efa3ad639285efcbb1b7932947fbfee0144fc204c19d60b7294ed6c8ebb80a4fc54ad4e3d9b9b5c33e7eb66f7bbf546dd12e8723cff739483e3a5270c6e3964ce2e6defbe7b05306571cd8c8d02ee8ea6db1caa821f7a1b824dddbd4826eed6082464463bacc5fc7eced31f142441f5913acf437db67ab42ac6438a34b102a3dc22ef234ff1e7d44589e61161ff14da0182b22918e565289bfc3751aa79b7ba532e27dac67f307f48c3174ed80a55bba5c957c1cb3a4d77bf36f5552eeb77c63ecd24a930598f4ba8c752349853993ee3255f9403dcb14817c41a165f7302ca3442b4cb7e586e9104603d175a7ae0d9523438bf2fb5cdc8172b7f7c4f86ac4ddbcc6c85797742ecddab708ca64df9fcd636cdea6bc413f4eb02700944edcd968d3c5cf09354f33c052db8bd589d1a9f927a1a40985b026b7bb935ea0d82f92a88b82ac30a6bc0aa3856d58e3a3699cf4c0deb48d575682fc129d1dae362e09d0d85100528e4f3938fadf8628d6e1be26fa996900719b56b0f726ef698cd860d035a2373018fd4e4fe8c3e4f752ebfdd705759534e505e0c17efbab6aac7ab665a3348ec2b5e55cadabd30ee490a29536237e85d911374c9e4822ceda15d6b69314bed438adc3486b16d2639e011f46c865c40573cf99feab0256dbcc3e1160d4a167fce8befd9fc52971b57e3811cacf50cccf793b441f5542c31b2dc9b9e1bada6042006ae477d2b2982f3fafe29a46ee2171ef8cd6881f10c1a892e7c8b30f5cc7899302c420f9b3c36d9327a3be299321204a008cb998f3aae8fa7f3985a955068eee6c4d37cf886987fb9071de6b9ce9d54bd08162d71a43ee669a0569b11fa1356ddd726c3f20a64fcce1f0fdacd458b035bcc3cecc1398a592161a7a83e860ad1288dcf826a3159a96f5237e69c54766f113c14af356934f8dd0c68a662b67a16be9e92c01029abff0bec087cb8f710145b8f1ccbd89f645068d6491b94b45a9f7d8461e1899f15026f5e7a27e7bdd1e776abef8c9be2ec25cb7562a9513eca91d7d151b4dca8109dad5520a8e34bd24f7897e331af4f2507d8e4326ac7b6a0f565cd97901bbd5c9a92f0fca7176e3c92b0433a45e7cdfd293f8a8b726fe457742a24d40542a6724941da71052e157731384433574b41f03a0dcaa21301d7055596a7085b63a65b4d882006c43e7a7c94c3efa75b4992a65c400ffebe0f130d34b92b9dbe58617c9af61e83678f8b43a9a04a62fd652b145ae53f28baf56e2f3f8e9553ac426357580140f1d767f82b93f1dd06cd433836c3a13942b7a8f64c039df27662926e2e13b26ab0efdd42e59fd15516ef2b9d23527798e4219370c194ebcc8f1ce5b1b67522ad7ca672b400118c767e3df2d27689875ae2d355ca17e89afe94a0f1c8373a48ff2a5cf982eeaadbdf6b1c8dc256619bf8e1e0afdfaea282774d47ddbacc79bc8af621c5652b60d8eb684a2b724481036c5d040b2e5e34fbe991ca72c5b0155e7894f4857b45ae5c639f5a7831f5bd102785cce9b41478a335cdf0c1698cd7d31fc6dbe0d2a56543e247da40c4d46b03d95cb3b0c33716e868eeaa842aeba0d37edb1bbced8243a2a31c54d6c84a1463330fc7a6e88716800a9397552721fc6ed38b7796df3fa92c22eb9d7ab424d5b28d039ab403eac05796084628f0f47fa09ace7496159caefa068674f5f83fea95d87dcfb1c6c7acabfee8f844f5d548b861c196a72e6cfb293e7328ae968ba2ef97ce804f22752e79efce3358258b39265dd92691f9f15d2a9eb722732a797c4d7448a2700a640e6faa21dccf60ffb1e199221e2de69a3d5596145ddb8b7f84c388b7be851f99a2b86be42bc19490800f07bda8bee1b0cdb70258612bccdf0df4768bc053a0a9ac63a848ea3e6ca31815476d9100cd626b79b7c8242a8245e2a480aced383b88563b829048b7538de980e3830764e60fcba2405e89c39f41f76996d821589071796b713fb1f13933f54701535e736cef6a7e6868daef9e71b156da09f04550c51eb9a5b00fa2290eb8831c3cbdad63fffba21fe39a41ca4b745e55f6c61f20021d2be6b51cb49f14d615a55d2534763713a0395f92d04189e386ecf6478217c72c5bc9de824e5d1d7d15028ab863b89970662c5b608467b55c9384cc27b87cec79e041fed0e23c335e8e0aa232a7e6d8b677b4dd2a80688804bdeba7da034c43e81d037cf7ce241ef36227dfdfb97967a6b5ed72198a1d3fa0009fbcc6a8b4ec37699ad01ff78334b5527c7df45dd293ae436cdbbfa1477755b05e3c1a5d64044d4ffb074dd64f05dceb9bada32c33df76f4dab1db6b7ce49e9072137e3b03736db0305e3eaa352d9e720c2697548e210f52cd243eae4d92c1f673a11805b5ef90107658716cf36fe7e19dd75f0e0bc7798fef3d3d80befc5f666c9166bed017a2baa4ba7b084516f8272df511dac660a0e7c06da3e590fcbdd33817fba03fc8cabf3423b901ae6554d06c6411d8a82adc403fc81923c05c172a917be6f2ae5f87d4aa8d81ef43da948add597ae3db1fc56374c6740ec14b7c84bc5992c950f51f334d77fccaea276e20b824ac79aa5131f918c7720c506ae7138098c3489dda97dfb7e1a23e46fc5c08ad1d15c528a26da0a371aa0202157eac5766da3af3dbc3678fae81817982cb618a6838ba70bb58aacc97e9fda3b78cfe2ce4750dc79c40251112f7e4f5632c8fb8d0f55b2807dded2ac03fa9aa393a909cc9426885aa10cfee1d0b143628a9578da9534b04f0246ccc2f6e618f704cdd4f9e2f640431d5365bdcba481a1735dcce996d62071cc0599bd3e3c90946619feb0ffabc5e4ee674fcfa97a02f882c774e52242b0c89fffe1bb68a978350eb528b55d27725ce3027a2f54d46d96eea489113b89601f8ec46c0d74ff4152c0b314dce52e7d6e02d74b43396e84a538d1fa59052e26f97f267e1d67f08d8b240470bbc1489a096e448758ed0340a2df37e66a06011a90fc94bec545af71957c0745e17106572c8d45cc574ad5e4fb2ef7d6b48f19cffdb650aa861eebd1082104e0716a745b35e92640e5fc949226ddfa01f2433c2d4c63a127af2fbc84da5e5558a28411634c928704bb54977a770616c84ef982e426a63a52d0f61e21d7a81e47d0dbb6b15c70afcd0302a8bbbfdafafec0be8a60446861afc96a9df8bb008b4c19fa46929098a0e2b6932e8cc2e1381bf6f80f96e6acb36cd53fa4856a40cc3372517af6adad191c88051426781479622d36f779b7db09c3aa95ca5bd6f2390d435acd2d604944e7c59a2520ce23cddde8155272d7a0d6c3ed008458b562b11a1c50e8df58d5e5595ce9f6bc25a290be8efd72d069f0d38f2a848e8dd26b0abc6a4b212cfa57b95364b3098102ae75718b04429b188684f1ca8e6754ad5fe2f201e56499506ccd7c9f7c003e4fa41cbe0941bc55b26a5e8c5fb6d4df917de552f4e88dd0ec3ab8fce19786f917a0fca823816dbb70bb7fa159a3b90f835cffe47bd3e82ad698e52cca3e5dff22b811e4263cbbb0e14ae7b6a45bf3538c5dd185d277a00974594b6cff37c0ba99660806a2e8566b7f68d5a6a16e90a4732eae169908bbc960380ad45e9069696d3540d0c2f565e8c7db55b5d3782342edec6acc7edacc87ffec65b7e4ff8e86ab663ad96edfb8098353b4abdf6f844c55ec129f931151a82d6edd37caeebc0e8efcaedfa5f2f3013407bf76efda8fbc620942a8c7206879164c61defb5fe82706d129860ec348fb844bcd59b4ebd3a65475898ad14382117a84cc046a0a8fe86104d83310e58fbb0d2e75ad05fbf12dfc5b4bf40ee4e3791e0fd33a373cdde505c44b232a1feb4588ed98ac3ad410dac8d6c511823f36a3145ba70b7a8be32af024bc0a6650e7d02f554129527f33a134fd1bd55b7c41043ec6973b0099bdbafe9042163a8c8fb60964829cc16c84739ae24882bfa58cc6b6147d3e412a46d5b48a4e09be4e59a5e2097acfdd1cbfec0a9e00de48c121a58a458f5d11214f3bb6e723daae5284a068df348b2d330ccdb77b6598a3dc39ae390c2a8d9881f3d16568c3c2079b0f6c164fbc2f4b7134a09baff822e6e793e05877507532a5afa80572ac2d581bf1fd7b2b4a2a4d77e77c8e5b173d8750cb185a1bf347f502bd2aeda61d521f2336c0209294b9f4d7ef20c047e19b1b2c587a047a25102cb09d2308bc1e2f2ed0a323f76d09910457b1c575ebdcec230b1b1bc98dde908b405632c7e792897f1a1676aa246c0fe0976cecc9ff3cad908feb1fcb193dad9eb40a2afca884fcdfe53a6c6c4cebc15f36254779c54375ac0aab3581896f291e135f9a509fa552c58045c5a004e6f3e44d9f85aa7fd0a141d23fb7e35f8d63e2fca5d6cfc88c7cf367cebb8b79fbfc9f5313f50dc779e62c9f2b5ccdb7765191dfa91187d35c40dc4c2dd712775e2bde9488ebe6fa944c458312cefc6b3bc6fccb69841e8ae78800f4065d0688ebe82e792dca3137c1818c570352e59ae293901395c6c77ec9ab3ba2f5111ed087185b311c54fc7b0ee13c64c2699439cf13fef4ff051782f2bf7e4aae61f4497aa8a336d3d8fe85a2363a49f331477de93e6486237e145ad650573a0cda71f9699763949adb1a1ecbf34d34362d4bc95e2ebbd989eacc34d6b2948639fe368d2a67a991cca3f1c6fc4c4c50e78cc82fb4886aaf5d2b029f40893680de2b02469b17385884719ef655b4a57c2a28e5cf31474e0475455174e2fa68c3cdfb76ea82bc80ac60595e23761fffbec88a3fcdcf33299446a8e7ba1123506d9c85750e033654091d4e76152b8d4c0e146fd954ad4ccd691c365dd324b97c0bb9dd238f97b3d7aa1b17def51098a801b519cecf7326664820f0befc965112b161e3f687ea90af22ca855dc55743f41431534b0f29f42c0981439efd2ca683b801909dd0dbdc3254c4269eebd12478e8d3c4bd607bda95c234c07134b4377bc15194f0d141c1e9880259f1eb35e5e26511d898326a6c02d50dd65691157c6f8a63a263a79584ade42fa235fce8b51a1539ec766dd15500a6a774669679588aebc5a32ca56ce0d66d6759d3199f1ef546e33948f3f32ef32fa289feee9c259592b720892fc2582bd0553acbba592f963c6607dfe70e1e4e4ec2ec64dd0520392b74178be23fd2a29b560c9529fe7b97d8c9b062260cc3340548d4436a8a6b1fb90175f1de9a3d685580bb2a2717d2ec16bcf01aa53b8ae3f78e559c4dc95f78837bcebf549ce2e2aad9b56a9146379147ca19e7c1ccd7d90f451b01ff58fa16fc7ed459b0a2046f95148721e6df94ef9b5c5023e7df6c3e671e1b30c63b15480e4daac61baba5b6679b81da35e81b7a51cb5c646fd79937e4cdbe84d465202851f8eb1bfaad8303c6b4251e1e601655d1108d0373b9fe3b00045268f3f18e84dac3814febba54b22f3af7b9093baaa36e6888b951cfe4da9881ec92509129835c43545905bf431dc2741011ffae00df5af1338ef871dfd253869d9cbc4865df5753f94d406ef4b965767cf29bd78c4c17dc0e7d9c1b4e5348a971b7fcf18ef3f41d3eb5efbd7c149ba26d275148c5f61c24d7739373ee867cf320b987b5a2c4facfc5addedbe53e0f9d99f267b59e19d30efb9de5180451f1ac8359727cce9e60e4cf370f20deb9f489afabe8185e8cfab94596eb927c457779153a6c7b65785018c2bfb0c280cf7bc444e1bad89d5da6752443cb4471bc43ddf4ed0e63dfe98647aaa78ee27f5c9c81de1e6105a4ee93d534a2c596126e8462970084f7f807ab24ab17d15c37003fe06d07c161040bdd258584ff7139e0f4875e1f36426b45fef9b632a04d790e24a9e901b7a2b8dc52ceb9941b7584f2816a446eb403c2934ac834764148909f7f943634bb2a03f8db17462a03cd34c07d5f26d2f6fc24a95a143949b7b7bc7049902a06a53c3025e9bbe8fecd29dafcdd03d060832eca3943cee6a04118db5e8ada4f4575a50f5d2b6a0e0b89c14151e722492b15708e68b58e9ccc80dcc3570aa812e246ce43f4f08a09ff55d7465204185dc1a29de07565e9952f8ff8f19150f3eb2ba46ffed34c63557cb3c2d7ab4d4b40923526065b4f9cb0c14ba282f4f96455493a05c7b0437f6af6544eb29bcb462104552821befac754a956936d3e53e68c620e7d394ccd34ea8663a15e11f8c4e4b585f424fa5ecdfd7229da50d3bf3ee7db527ae0b9b1ad130b32d4d95bbcef28b35970d290cb5276a799e233867b65a5cd3340d69b68fdff364cd41257ad4f5fca60b6c12b0e20cec5f62e512ac17d7d5a29483296c4532a516c91071bfe3b915d7403581465a33bf3d8bc88be34db108d9e864389a94dc1db7850decd4f079217f371930bb49f46f8d344d125abb7560b46d0d6275e420959eeaea8f7e5bc47ecb6460bbe2513918cfb17aa35bd26319b35cf3434ee3dbacc1a11b220c4d61eb6bd0d0991b24710cae2cf231e5987dfcafb1615b0c35d4e6e99031c2a86e0e60a02c17d8dac497982debcb357d0d11f56d6639a7e63595b2b2b3956dd749dbcd53e848afb0d747387a7d265d6ff67f7be2984784883ac562991db9ead21ae60e9b1ef10ce479dd585f8eb3dcd2ad64cb077e85e1fb3067a4718ad7f36e3619edc25155fe452a23cf8da47984aa655bd0b383d61ddd41d5307c767b28e31d7c20522500d23385cdafa80de3311351bb12f04908b3b8b025ea81695bc8495821c52d43c82782e21b42d20b8bb5a3a8b2c3097120e7a9893243fded2c679197d239a02aa95710ed90103bb859895def575dcfee5d0adae6541e74786edb75e4935eeef143e69ab8f6e7e233bc4d9ad63bda42828d0f079b0324217fcfe0e092335e70f52a2f9fd9ecc390135713ccd3307b50d2ae3fb6305384d242d3b60feabeff14801a0211b107793f83638333f7d4ee2dcf4b9e65aabdefabe2139d6772ca7bc8f1cec6c0bdd28aa667d5c567ae8b5b6242c8483d1b7193590b453e5580b4deecc867553a40764fe054f5a89548b54a0a1a0b70307587194834ca722130afd98b5419a5716d20d8c1a1a1e627f7c26c26c8ffe3076c5e9df50b89fd3f5d458713fb65e20b300b00cdf1ca46d9170448e04970147f97eeb1f08c26b5d2e0fc86a323804bf2fd16002730c68bcc60d6a5fca29c055d3900d6fe7d24b7b47d5f0e84a0f3e02fb8ae8f4013c51368e5c98320c22a024fcdf8ff4c43610626d802a2a27656e38a90c7a7b80cb4aea3a713b8da9e7d2f1dce9b8c9b3713ec274231bdbd70172db6e41318dba0dd0d7f8f827185b822e2f642c5d2cd03aca20d2caa121e3094f0b0968c9385698506077990b3433c7053b7d649bd4263c24317fd26d532969ab8de1db60fb5e4736d64b3a7ad53de4eea865a676cd860ded8218969257692651eb6a630cb859d0399d1579654b04c11fa779d16e9e43bf175781d5db8bc5835a847dae8db5f4697dc3e9262726068614a6c96a9d56bcbd7f2be8410b582ab77ea939c0518b8d2c421e277e45f6d16834283cb60a83fcf478739d08e748eabd7af3457a16a85ba42711416461965a3e535f12e9891d3fb1885298272bcb3be6bb6c44aa60835b68a6a0b9b17f1c67a55708a77fb36f3f207b6fb06841f4bc37e8acc444b47e1daefc427989171eb26504fc87c0cfe60b39e48e23db3e14092140ab439377252f4005904842a7ba17e537a6f174caa169e217254e75affe12a8f551443e509e349c65e9ace655491d86ec31283ef00892e697a27fea55477d40cb7e69bf3b5bf0d1bd33008eb2264028960c37516151a46e68b62f0c6bf71e17645b47e4b6fca30f76a7090359dd98f9ce70c124ba925ed6a648e1eef8a1e049db73324d5fe906091fe501c5bebf17b553c859b8031fafdf0a6caf976be745ccb023b24eab1bd62d0ede9ca69c3fe1a67445d5467faa2760ebf137022a9f637a59adbabc2445fac88746b2e1b2c8fc8bb7d1c01c8ea48459cbaab33d9e411bf4c37648eef5072fdd9d975c6bba7fbbb064775f49442681c317552ffab11638925847266c71842cd71275b90e34744a783b95ec117e13476ab315b4090e1857de880bc42e4f732d3538c1b3d82e3a674826d5a544466dff942945857de0d7e5d1c43798055116ce1a25f0f7f6f02730c0be492c0ffafb5319db3d2e03f1434531523eda0fb029523d7e98a226bdb4170b9250b102e919b6556e1176465be787df22f3a11a885c89e288854e8bc3cc6b08de349124ef15fdb793f2f35df43f4a89c2414bff7f70302efa5b04f567c0c9ee05fed3efd990c0fb29c5540b4c50071740f4196e99a08aa293f06ab4e2f257f7ebf6df8e439edd98f896eeada3776a76ece8e4e1cebf7860711d1a9fb4da899d1307115b7b9059f73ecf93a91b223c0cfa3f0bc888c5b033a9bed350ffc9c47bb308ac14fde8d9f9f8b8c1fbcdb006c378adae525b22758ebf5d21b1bb1b5a898951136c5fde77e12fdedee497bb09fef79eafc1c97fab8d997099d41c5c38a70c56c184a9878f388ea83f4fb0a04b6a6812b8063190c7afc27a7feb2d512302a73e4be9a782a1074e18dcb9fbcf058490b51c310f76a7586730e898e908c2df45be3561b327a0852db96e512ee0e3b48b82ac638a671c12ff8768acee0966097bbb5b0e705c9c252b65b48bf66175d7c1553face907692f5da8d06553dc9d36e60503a5084056c814c1ca7a028050d34a35bc1e0c19a95189029c6cc167939c7a080ee373417d4ec3b4de707eabb4d8ccac6fab932780da9bee31f8492b794a35a2aec0bafd3eb7aba6acadb609d66ab6bfec92e5d64d1a74742b61971e3c23d576bb156b3ffc3cda615d1ec56a5143958a9c4c38315d918d62840ce01ceb601f20f3a57b4cd6e3c51f06c6047d5e3f37e7deac5d0a01850f09a13af7ac87469ff14c19337904fb261f8b74eaf4d1800533eb8c4dec6db3294a0b884412de802e4627d615860cfd471b3facb14cd266643ce306ccc8438ee19c86d0105438a81e12b167224afa34e0e4ce5c24e83aa3ef7526d65402ec036963a184ed4ba87d11496006113b052f1f07b28585e7a1db700c819b9b10dbb2b22ed7fc27fba6b7d44816e62871614b3f61052af68271e312ff9181cc8f78ab5bb2b8cdb7f46e35fcbe327b15164cabe76dc0aa57bf502dd57c74d75ecd111e53fede5cee799a38755f43ba99160a5bd500473e6f0e165ad2e6cdafba641757573aa7c9a8ce7a51e386b1b06e4d487a4169576a796cd106a00fb67b0fb3a94b95a1f75718e6fafc1420b2a5dbbc45619c1281ed88d3ad59d5fee30f41dea19835810a88e209cf64b538e3b401dfce602b25f2b1b8c05b016ad3f6f8089d7ede98836d1d9304746670c7d7d319cdec814ef6f3a4a33f0b8a9ca10bcd2aa332b4128b7bc13648f5c6cbe0f579071acca83c7d19546b1bf622770a2f7ddf746ade0cc4c73e9ef1af860d60972ddf5afe124da7cb6c036c2b740849d65969a66de3e498d61882935066a202e701d208448d0ef272011403b8e3baba165c51a91b594aaad24d94bfa9d658bf38ce2f4c9b3202a011f7c936de7eb0e2a4732747764696ffd1aef9e24d4c3f9c2e7eaa22a974f046c1ff174726f205331b1d0471c2514f5f55a029521fc414195159ff88b96ac7fd701dadbb5eebae7e544968dec4a9dacc2dcae35ddc04cb2a73ccab57dde5e5f01797bcd1db7d80b8f5b84d42bc3297347b71bb02d5c301cf6b523c96afcbd080903b6d19050ad1a19a8c2d20c96bb706ac5add2034e63746161ef99ab7da102da46820afec94a87086f8f1dbf6643818e6d65292b86aa049ff9279b90f6b5b842dab63c0e61de75ebb4b786e114713115d30007bd48a8bcbe9fc3eab2bb618d57496e8761ea912794be914a6c4fe32099e75bd3ea34f0d4db83eddb8d8ee7a241a6defd0a9c469106f62e7dd31ec2feae8135e3d283b44ddaec8526d678ab883bbdbd728edcdfa72641860ffee3e9c159d0c711426c0ec8ab3efa387fae1943df0629273d9f20982aced9ec08aa6e699a679a53c75b972f0f0104a8b2e658086ab3922b0aadd41284fa6b6901f2133cf004cdda89ad192b941df2efe0eab5c174cea86f2bb6cc84ce1bef4044e44d22bda8a14648fce90216b8a3b62c25c460b67bd6d42e0f070d8d0cc0799d5db1bf11f528b7c607b62c66cbeb7dee463672d640bec4686b0a0315bc110341bb172c5fa798831731322424b924167c1c08b98cee626b69f950c73a0002b5db6f6454ddf3d018d8df48d9958372a2925cb119f034a7b32fc63a3232a94f15059b66f6179e720134b57341fd22839f48c5f3e3ddb3a8a14b0a916192614157897e207d62dbe2bb6945bbfbec14c0b3254b9b134e3a10fa06ca9514ba9654131e7462f9114a7d91919e716b0b117924f3bcd2c138cea6cfb5787cec03123dd89c7f3fe44ad22b222c32fbc9688792a5c170bfa8d480942649e1f97cab14f8e51bbe54d7d1668df7f44619ee728a26045cf5faffedb811d22a7c39b3f3b898eab0c3575e39d6dc15b36ad0bc17580cac825285f2de78e838da723f3b4012572188e7fa7e0e2e687590aaaaddb81bbda61f963e759213826d3bbc694a268dc56aec6a8630812694b1820ab802481a6a2a33a8ee85fa8d6137de91a4039d46009a430a20a0363fd896303257b51124899921715bc85067427f0a98413ae45b5d4ccef587a4a7ab320bab7c3faee89bb9c1bac1619b5f52a7d5af9cd26dc5d9a65b5cd9a8a8f141dd0f86c3719e03532659628646a6bcd0e0724174ed40f7ef4a7df3feaf2fd01f1510dfb3d4959117672a52923954aee3fd32ddc953b7717a3e5fe418b366ec1d28d9211b9740414983ee86814c003667cfaa9034a824d6f8dcef8efb0824df7db87350dd30164647471ef2d31a61c1344c8ef92d33a262121af21b6b98d2a9eaa8fdcdad22d42aa03ca380fea29bb75a68490983ae68d7f9e2a77c9138d237d50da6263b35af292c35ce82725e59c853adbd887c46245ba859e5511f9dc4dfe28263c7d8bc430332046041b68b320b6e3160f5fe4b069f7f87c5be04b789242339fb6718a17b4b6f11a99c38129a2f7d09fb6364232fa730fd934a473d4cf0826f065b76e43344e6f3bf420401183f76863f7098756c4f45bd874949d4f2aac7873dd670fa44ad40a794a60376e2b7e38eaafbbab6f90b36485798fd45ebee42f82616608819eafeccce596c7031fbcee9c71dfce2218f1cdf0e7d7da8a46eac6ff849e81f4dc69226d321578bd7d518a1ec4751b4180ca0f8781814213b96614bafa5ef7da1e4a3dcc78aa0195ec2efd49c2248b097f4786db2d19ce2876f680bc74c198ee6c4d7b599a773ac793d915ad787f6b3f12f0abfb3ea67a660f2b5072551ceb139a6c9dd221a662511ceeb750ed2009f71429d597ff6b5178a1cb771814f55b6a46fc37b865b044105d74aeb81613bab9cb1311348f7e6dd1929cae4cf528fc73f1437462c4e3571202747ec834b651a6df5923fd52bd76a8ffcf642ce53447ba9f25bf07318edec80f067697a1e22078cb13b40104c09cc5c213295b5ce242102dbdf1cc128be795294bce58d4f114d675ad4a9bb9afdedb6d44006faa1bbac955126f0910537278f19051334d6b9b7193afda440cc7d01fd17985d5f60d83d1b186473232de7891e9f12b636cb715d1bbe3215aba6fc4548c23fde34dcf254a09541b58f23ae19bf1645a1fd93ed6d8528a1f2198774a170b91857b5757ddc4784bb0cb24312037e9eebb2cd9080ce5fc0f900743bfbe861a3604b02dfd75bdc3761bb4658f717b92620e1d4ee3bc19a51cbffd4b7b7f65a6b65252ba625196188752a0583fff06d271622431aeb149f33d9460bc04689573a18e641642e1297d344d810e293382bca0509ff6e2e4ef6def07617297ef7a659402720357c9ca328d2a49558c89ec9136d4ddef3c262ac3518dc3fdf1063cda248f697582603afccfc5655e5649a8f1c8f5c6173dbe8c08d9e652b99f27ecb0a2dc4fb505ba51c9c074f57b3617427a5860ed8b9558ab5269e6f7a657f57e01c3f2622ab8a0526132c3c6694e0995e7fc71305ed24bc074bea35618ffe970ae5cd491f6079b2a1d7f00a8f40a67139d8d774567f90a8d2cc0df7b6928091f87c70c12da94aa986cb6b799e7cf1e7635023ea71d5be72e27b05e8856870f41751b813f0160a40067f86e204010de4d7a00d01689b969dbef16c633f795e02ace9e28647fee33e3821fb78636514127c0a4755adc8012f01da9c2a63bf9c2d60194e6e3ab24299f85eeeba88189449b7737595fed60551051dd61d72a8b7dd6a5dd0cfd0d8f9a5c099c256a8cbd322d6c2566d0f71db4baeeb48aad777068321d9f1fc2ebd11e4936820ea7523d78090eba78ebb4a401b3bb0374d95420327b51d2be12143a014821abaec61249070a3a2dc1020342c36d0b4e8b0e25a6fb4a945b3485dea0fe888f00357dc63fc530094dcfc70bcdcdc861f29bbeace64af6648580e2c57735f30325f6f92587662df8eba7ba2d1b59b6f8d29c098ed0bb3b53a3611053cd68a6f2c414df2837a990080a36dda591fcac9ba198c0202a46ac73b33b6044339b6b539d052d20dee9a28712569c417fc7f6df5762ac09a312a11ee70777edb24a3704f33425e7d729b22b4e6f7d0a76b5b87a708f8382409c22bcaddfdea1054ff460b251788aad828863839b102f1a218bad47f648987721657865afd808786b530ab97c6c54416cd2585721ebe628f373496c4dc2e2c85fb6fb2a3850c536fed524d621648155930824ad8baf07cfd1a9cc88fc93443b515ab85cdfc8474a11e518529b8316512e82dc200213397ca0cd29d355e1ae9b1c3760bd8fb15b9379bcbbe41843c073591707a2d38314f4811da56ed4bec450652f563472e6177a42092b13ec80dbd694521dbaabee3fec1addd23332968ef1c5f045ecdead8d160f6543f2cb7bb00678cb176d3cc39598e970d8b72d7b894355b616b9b998cb05a508a92b75872422b135f0d00c9ca2551ab8d3b113e38f5e37f3878f7d749d76766b329faefccaa6328e438b7fad8cf07b2f2207860fe40bc4de9dfa90c24f1f8026fa7b46474bb2ea96f368aa916873d6ecf91ee81c91e3e9bf5bf45180dc6ad84bbd867f7161d5b3e72e4d6cf510b18647614fbe7f80f96cb37c09a1df9846a4ee89be5d0e7cf187e0df5c3beb720fb8bda1a67fcffa3128316f5eee7d61e9a846d709ac84f111bc4c6c448e41bec7707badf9122904d1420a48702e4c97233b505d26f1fd163a61c924116e4b74294a6353ad8492e9b2ca4860a6999956b927da8b790cbc361e07a5c3059a45c72e76968a353587b9c04252ba00583c0110163c6713d8dbe854892347c374ba2be502fdd99770c4d6a24ad372b3bcf43148d1a861b13e183b4c1cf3411629617a0c0f6b7c804b54141d6f510de5994cf273e926eb1b16bf98c80fead5efc478d0412a9d46e1a04961eff79313fe5f38d6a706306b3c4dcf759188e4224f629c136a7c9ca5cf5195f34b656c2d20899029b4330de61784fd79e261960a6f5c5aa1dc89de78ae60624cd90dd3b0cdef404ff1764c0a5de4a20eebb7ebcc17d26501b16be60802856535743164112f5d3bc3afc42dc424d1b28ecea1ac4242af03f025e3f3169f4deb8db888dfb7a431f50d44f3ec54b0727eb19670456fdc93e6ec1906924c65096db8bec24cc21e9f4045987f506b1947e3da94cdd02f9284588024e15d819914d8ff54b377ccb5e263406b7e296a5adab7e5fb78cbc96fd85adbed805dc813286b71175705eeec9ef2d59e4f811221142417908b7509c671613a87dd68a43adf2c9417de44506e501b11316024e39c3a2506a41a827db7467f34e0928fc6fd311ff93967eccf1abe81cdb5794a47eb1f50a5d10428072c25107a9fcef45e8a46175924e9c1c5ab502a3641bdba0364a3453396dc95a6f070ae6b7b2af867c859df7711406cc8821d596171646cae44c192d8f0702f68c010ce8d00c059cf7d3fca2394e82631dab560ee687901fff1b9b58f1e71ae3a46c567b0f1dbd3bfb6b9e3083e6d968235c329e689da4939161e7a5d2fc905ff3f26b5190bf35444a1942b55d3438037f3bd51a3781adfb32b66eb07754e817bccb6664269ad2606233a6e8fbd365e1fe9fd4814c15b0577a64a09da59f47a65383b0f4248c8b323fb04d1d37c326c74bba38856a8ce5002f2650582eb70cc970411ac55ee690e756a7c11ec20e3b7c89de14799430475dcb24e2d63ffca65562c79049c9c4ad506ce452577fbde930ccc835ecf3b086c939d0d35e60087597c7eaac44dd11897779938cd2516a87ef78a0b9645483f86531efe28913bae680eaf4beabca4b0cdc3dbbe10c1fe6f81756f0dfe43eaab07dc3f06442a71dc855537718a9a632d61ffa093bb3e9e5eb5d1e815d7ca279f72a3cb6609cd5b566cc4f14f0210e0533c2ccdb45cd66ceba1804e6ada09d41b5717f7c68a144d18f29e73ea18aca9e2673960fd7cfee4f9b0d09695c02529091a38f841c980a24e206997a1717ed4bed69160944cd88dddc282e62d0238a90d8d6fc8910a8a16fbb619090625c17c1162bb8e5b07acc3b8738c70ebeffd39fbdccc2a819fd6a168416ff9de1ccde1189e65b6c11da11c5707872a5033f4efff5817e63e472a7f98360b0404d743f165156e0d58e69586b515b530c143390e6146156dc5030d65e3dc833313a6ea2a8e54ca28a6a37367ea8510f170756641d601d6cf92d95fce9c9cf276722b37b43e93166e4ee26edcd7d861b7eefb942e8047e0a4c065cb06131d53fd9184178a939b61464d99660fdb4731d3aa390672a8f423373b411471adae5b910b1d85bf41c1a53d56a87770169bbaeca34fabd4fd4ba93d034b51e314bdd67750e9b32684fcb9f0d288ffa6dafa7707f905c3e1d521d095e28c7ee4ec0ef91df14078ee270b458571bdbcaf6dde71b146628b372110508b6e244c08a2c9aa100483524010c8f1a2fd693ba66403155a5a74ae76f7d84004218039547ac042097754e90304332a31147e908cc2ebdf79087f86488725e331147bd686d7c918815a563bce38a3272e4ffb4fbaba794d95aab8f55403fa8641bec1951ce8d562953110ce3f84a958479d6f2d4e66e4aae0975a12d2b23d768ea5ec769b33bb490a8c422fc3a7f4276a026ff9482865396b0cf4646fc6c075e3cf044435c6eefeb9091c0b0ddc8adfc37d54aa2376032accde7cdd75bbbad94a8746a314bdf1940b9f21c9b59986f84f23fcd2538dc5a1d51a48ca5ee36e7dd03093d905f190fae8ce556a5e1c93e2e192b99ee78c443f675b043a2e3123bcd03e54f7ce68d4b93ae03a3e1bbb8a8d9a1df85e753e1347e2d0085002ecb4d5e9ce759501d249dc6adb43166abafbeb87a95bf36e748cb042a4977a8171b2d47ae8707f092647a8b46f7707aa2c0851edfd7f37178edf0693b6153c14feffb7ceb169a5492988feac58ece0b7b2dee9855e0c3695f79df567c6a390d0eb583aa3236aaa2422e5036eecc2829cfa056c2d0ed03737a6613f7a6722f15d52fd99f1c597852bef03bd538c7dfefd294a3acaebe5dc518abd9c928c115517f20f4577add646d854696073b03266a63f6a9a07956695e56d07c3fd0d91cedb6398a46639858fa93278875dc757a8e61b8c63f41046074c71ddfe83fcf430b7bd4dfeb8a08e3facefded8552a0b2da65cd4ae063c5150c2b1b21d06adeb65c1452e7f6ffe83e4a730a06553d48fd9ebc4a7978322e002c49dd20f964dc74adc31c84f0c6221010f4261fc5c47d156eaa136545d9df90f9f405ebc789de9885739ee5d475ab099638857a4998600ce3ba8f8c1bf3b0a1be49d10384c3c22c16dbd741bc5b7ee626ea15191fb890d94585e8cbdf5e2e3b3b2b01d937aa3a70aa19a93a09f5647002b1613d0fb95d031f21adffac4d0c0b17fb9a725a935cb94f8946c5ca2bf712b7bd8e4eed3d801fcb98c31e518f72e7f72d4bdbb75db09a2e2e3c0de77964ca2dfae2bd10565fa568bd6e0ff8df6d557c66b9c255cfc8cd8fc4ceb0e9675bf5be6ffa925b8c045c871ed24b00e5bf8b5c50bdebc630ae2e170fd08081acc39e9a7035065c409d7360576182df4a6c321b5549e2ee14e7b3cd2af29294bc75ea857e2f9c0325332f1bb75c649380073f310c34b6bd1dbe3a51b1044716a34e6f97eb98b9fb6c65e287fd3e9cc03401f7a09256f82b2a7bdbe6656839be1eb05bd09c032d8f7d33e81addd0576f9c288d5258b1e2317f282bf3dde63cdf05f8531511d0884cf089bd3112c832479988e36343e7ab0e604b374f9317d25ff4911607eda9f323b55963e0f8ca2c82eab2f45a93d7b9e625f1de34821f9af03c39d818eadfbcbb8e4b914510894712c8098f78bb1a60984a6737879c5fe563f6ef55671f748f543a42124f51e6425f9b43467793d6db59d688cc4069f67a59e64454726513d3622e33acee1f830525938a94a44e7ebbe74a4ea5175f9caf6ba3069f661461edfb85082ba963b54f05388e4d615f7cd2755abca4bcd0769d5663b98fa702790d5c6843c23feb1e5a7798208ceab92f20dd6b9f0c95d1e7b13b21c798251ead44fc6cc4d4e015063daa8f77c6f151e3d0a117f270c11987e70b6fd6644f9680a4bc98caad9fa256c09c43ca6afc1fe3fb3988d05931ea022b71e05f5dbcfc126a37531455ae1576449b2d719c9064bf89f2ba3a3f9975fe07d743ecc7c706cabad5d47cce41f0127b50a426707b875760ecec151f6cd2089e70e8c6d86fb9146a495476daa0e0bd24123979518aba6d3a3327a3ac278b38e9b045798ff95232aa3aa30030434929c72e18887c62142ea7b44be3450d08ec01c02586f8bac716a0aeb656e8770e5489385cd07cd1c9fdc33558388aa6ce69d8ca88d3159a8b858b280fda7bbfef9c2c99a6e2fdaaf36b70cc7ac0ee4a9773296cce21961a602230ecc0bcd1e862afd67bab84821e10d732ef21d682e6d076231b94f15dfb781bec34c5296c9210198b1475203672057b9670ef138919c3b091d49f916d269692f46c05458768cb8754067bb8279b7c03423a80c15ebc583fdd0de28741f9befdaddd1cb7234a8715a291609b47cfe064b501e1109b0c08548213370a2d6a391f05c95ae484bcfcfb6b0e192f44cdedd710788c25a0b9f64dbbe109e16eae2f105be9ea91f468a43215e92132175716a280a90a541e9cdbf3ec302deefab0cb324ad9523dd05edeb56447ac0f1b7c08c6eff8505cd127d3a17107647e29c8dadfc4c5cfab8f4eadf732559748d8b74e2ce654315bbae54e4b8a06b8fc5d7a106f0924b1b4c3cd96ad096594a9b0de9e94f74f9148f23c84a2d0d81f7b0395e8b6b57de74674b718373b463f2c6a6494ee0ff089e9f0611db89a67e03c43acec7239d34941eb2ba31e4cf458079088fa81f1cc03f160f8eb40b8b1ae55920e7acb6c18619bdca25c3f71375999f66792c861c4034364b05ab1360c16a4267218614ecbaf9c90e62f6085e4723887d9e443b299d5c4675e9d38644ec5fad60812afc2489b946016f260075d60a3e10efabcd6090bccdaa6b6f245b332ccf6f59b6fc87a84d6c4c29ae502ddfae8125b9233312405f7bee4a80d563301b13f94f4deb8b0aa7db5a6478ae9faafa7dfe74c5965f7894013c3976e02534632cea514d3c94902f02c0b0c164d299e7d46862101b073000afcfe239c6c8465061e3b3c2bd3e52ddf912bd806159e4f65c22e6553c1594e04a911c5bc2404701483e8fdfe23d4695aa1a372eb4c4988c395262ccfc6bc978d02f7687ff4d5818d932d1dae3529c2517dab7a16b99caebf2cf1bafa2d1305b4cd6dff3d65ce39568037572f37bf7dd90ceefedf3aa9faf58e233af8aeca62e48d5af68b5be7adec0e840b139e81eb0301516c697d4072c36af0f39fbd80904d310ee9aadf3f24e6430434bf8a3682e5f06442241f20215de0e60d9d30f42d49248066db653834332593e2dc3cb07b0a22f6b7465ae2f6cc14c7aed3fa140843ad96bf0ac5160248691dc824500816eb3befd3749dc7fa2b2141e4ff0aee523baf86a7e545b61546148e51b0afbee07d5b68c7b94cec723bc302af9ea4b5923deff4672cad56f1f7c905a658cbf3895c4a31df5ed2689afc05f43ce295d9ba1c07e68108dec7a2a38ae84b26d4ca97a82d8677e7ed1dc221a76a8b4bfe185f5f5f96bd78ee2c779bccf13fd04b2bc20b5d42b2ec374a3c32b99cffea00414293cac4b577bc3721c58efaefc89f1d711bf2365cec0368192bb9135208b0ce16f18aa3afb680c2c6fae90a7473534f97e77bdd161a3e1e8dd4bd6dc36456bfe9a58c35ee9be73ce17f8323f8bc143ca883fda1e6c1dc50d92eb1a43ae2906ebacfe053142be51dbcd97b2fca33473ac5ba2faa84c568b64d88745817d3749abb4414d4ee72f65a3e2acb3d026f01695c2f746d3467772467832e173489e6d124a59f28308c869ee272cf85c84e66f98a05dc148b10f79cc48bbf3f7bb603894547742aef0232560354411b9c665078d41b6e825aab55c81b3ff217fb708061a9c238613efded176e57dfb3a6c477659e68231bb77ec4794e8fa58925eb7997f834862e38e3f3611a63f293e8e6afe7dc96e788f7fa1572157a9ecf760e5b603bfd263a393966aacc67411a9c580c66a8311c5a29c8428ea8c1137dc9ede49106f92484802f5fb59e9a0bb428fa70e3e61e86067b0cc49babdd2f1471e24485ab59cd460517bd0f73397059b7f76e1c351e0d5b4aea7dd075f0a9672a5d06eef945821625125ac3a49e4cf518ea2c3dd47ee9f8cfafc70a697a2a2eeec7aa8e902bebff6ef46a94f7a490d6398d9ba5566c5dfac9e429c914c6ec88f9bc49f93af0165689488621dfc5b9a69b9ba881657ee78cc05206f488cd5678c1b3e209396d30e42954346999a8f737d753602a89b4724552d57a442badf252c01a53551724562868e7746e400110f35cbc05d0c9db7bd2f0916b9e9fc52663b9ba3355ec94f9ecad63e2bfd2f58f08175cc6e0b7629a1fcb8262272e677058c0f46609dbcce0e2a8ab1d641d775b7bb3070c387a679b0fe37c5079be9621029d6d6e2a5fe216c9768912e7b5ee9bcf45e068516e0f9d10aed0880bb95e91a3cfebe4d39aebade0ebd7faa2f60f5864cc6dd02fe32b9f6b4a53e87891e9e033f046ba8f76f8046837fa47b4325c2ccfad80d3ab8901caf2dd0f40f81875b4062687a203277fc840318b2bf0b4f0ec6b2c43137ec51de6f15a6c8cd0c5ef9b20f15b2ffb2d655cc7fdce7547b38982849033d6a2ecc389c14801f7ea1f816d236c9613d7b4cf244b07f4463e9df2bd4942b71f7caf1cbc405dcd748cdbafdc5ba04090a776fc13bb07947730b9e550fd4fdc7af714ac37a63d9e6310ec4b3734a822dc502c8a12f42c9c8a0b8dc8b2111a4c981b16b4a5ff50bb040fecf57536e2f54f3621a0c17a2d61d44aa993747c103d9f8c551041e54eda86a9aa0c3bb98506ae137b9555b4ab4254a128b4b5c5df5c6f266878e43a259cfca7e31376beedb84961b536a8bcf5771f06aab07304cb6c35062f10d4e329112eef61e98c244135440be2ecd9160e344eface42dbde462a91f272f9fba71c4ba34d44389ad40a4095b30a9065bd104ac437f0046cff3216aa0032999fb817d7ee02b2a80d649c20a1e7e014e9bf202c597e51dc906f77ea7778bf210a80ccf29710dfe9b294b844a1055a91b2200de36ace76f747771cd03de821196bfbbf1e8b23ee43a163b86a85ed50250dc3a34430c7f8dc28ef0e1ea30c434a21f346e1eb7de15cb9ecd04d6f222500ec9d963a2e1cdf9a241f13493d5a4c2116e9da822ba8c25241f87eaa6aa49743d73ea8a5be523829827d3bb42c73d496239ec4df86970d84805a6bee87f32d1fcd6a017a4937a9b5290b1a24ab8d4b182b6786fb7ab80ea5c2a05c6e74bd6d4d4d515d67a7d61dfd617be010e99dc0c113fcb6df1e36eee2318048c8e41c4588b4a5acf0ba3a4f47d0d1a95fca28c1b3ac968224bea484cd86b7484f84be87393ae21ebfdb41248070cf8689cee18b9a4f005302efc70781418c96bd18c250a0b6b210ad86fdb6f4e79c3d7e19dc209d7ece1ac4067993d99321c4601c2abbdb1f2b970a5bdbe559a8a508b0776fc4a67774c69f23c212e60117f73bc1292b159673d0c9b5d79b857bc99d370ce14596ba2dbb8f8a2f71553a75a2885feb2fa46d1a62b09553b24524f0d1b4007860759d217e34009a0aaec86e2cd823f37d66a168e74fef4222e763f6aa6b75e9e3513a39732eb9d960848e8f9b5f84d71b55cec148fb00ced13ea6cd06e9e4d89db1aec0ffaf26c7269813d9e81c27c59346f9aba241fecec04b97297c17c0cd8fd46ef8cac08eb948f5b92a5aba9b6b950f5eb7f883a29a43a0c8c90e1813aced60f246e1dfbc21c8764417ff5861f9004cbdf9bd58adfda431b5d3883d6673b24055f3a3cfd96424b70c9badf011036a3bdf49bb6ae6bd9c4fa67ac854f68739c0bc05db7fb37e27aac4a08a5a4ccbfadf24bcd1646ac87a27932340c9872b04cb04e94dce03ee38c8c9e86bd6cb6d2c621d1b5d1cecc3d30adfd37b39359e6292379530feac6c50b5b26f01749c18c19d62d309d82a106f61ef08c9417b53ac9a77803742bc1f9aa15b2a06ca10f14a00c745517bb08fbbe93af36c3d7089d3f673516dc7d123a45f0f58eb34ab8608c429cf2597d762a06f749fcf7642443c4870a1b814dee114d76b64bb97aa32963343d1e52b6445f8f72e5b4461cdcb029fe63de33a41e5ee440195aef6e39892d98f06d408e0c50b0d477c3ecffe4a17581c074bc161ede7f99991e203fc0592a70d20d9f4cba7c4d462356ceaa89873401f8d4fbb316a984769fb8334427327d007b26f54c611f4ed33e7f7e835da6e177a394102858a143e163bfc4f2c680c914e574c96649fec5fb856435f4365525039e38e68a3137c5626156e52dcef855787e1fdc14412c0ee9a4bbc727eff82549187c45ecbe34333ea0f49b391088501b6be5dcfa66fd343fead5328777574e6c25f86f7ea88980b4fb774b6d00a2f99c4933ac9ecb06cd6b7140c5e09fed49e2d4fbc0fab14c0b536aa7b6802b850fef864b1fb3f3e8978d31d5c6fc5ad09399287d14878b736e3575e8fb295df39839806450c64e6de08e06eee6b4d0c3c172b512c00384f4435b41a9e4f29eb107eccb59c5b129df1ccb30fd4eab3c6b86c469600220743146e8f81b2011a977ddab1e6cd06ac08a10bdfc9e810ca1e202ec31b7845ed72c8213d6564ce2278a914d4f3f14e85317a78ae7fb5abc7d92d165e398bbfbc1ca7f9cefcc0bdd14b388a8163703dde7228b1567a5a7223a5840fff0d6bae456e4c49d317851dab7827ee8e204b3e31aca522c75503b18ab716d87780aa8ea62d09bfa8fb139dae1b01a3a232fc44e4cee0f40d3a2726c99b59520e5f35bf36c5c527b059fdce038972683cfa2dd913dfc8624e01329300a027d81ad1acfa7567d069bb4c3126e499ccbcb86b39518940cde1a3c9bae80e8265d7f5b1f7f9978c6d4b9ddd160eebd31cd0e605547fd5fb286830c80017fb82dab75964134c6eceb27ea2413d082b1115b80a536207d10f0c6379482779531470e55a3c0afa016eb9b146fae0d02d3ca11e11eb0587158c32f2561aba22771ee72b300a3736f14de7d3219c9b721a56f1833dd90b42634e57a75d198b40b353e02c9ef7f760ef6c4eccd412adc9e2e6e9a21e3a7bdacc3150669c956d822196c8b3d29e21f12847ce10c69c4c8bb0b05585daf0d7a8f6babe1d718a45fb582f2829e4f0af156c0d9a2f2e054ee8e3d4b0bb7aa9e10a25c3b66ab79630491264bc4e4067c8a30aa9293afae2ce8f68f9863790ae3684c9e7fd611e82bf2c4a8ca489711841e264e757dd91dbfde3bd76625030c117f77101e508d0646d4cd40f433fa5190ce234807da3b234d434955efe8080798320a7d5869f131bfcf310a0a3e481f20d733bb273b420b47be934fda4f720559d5785f4fb2dd92a6a9802a8d3c6f6f70aff85e392d46726dd4401330dec9596a08b896470f8408c73187de690d593c597d0335b29b6c9703732eb8ab4585fe6282073231f559b493486ffd5d41b4384c2bb31da4ae7d08bc12810515d0892596db3da1280c8d73ff80aac8ea7f76aaf28592496f2536a39d4e11bca114239d934e7ef080b1d104edae852927e38fb30</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>æŠ€æœ¯/åšå®¢</category>
      </categories>
  </entry>
  <entry>
    <title>HexoåŸºç¡€å»ºç«™</title>
    <url>/2018/02/09/hexo-get-start/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">è¯·è¾“å…¥å¯†ç ä»¥é˜…è¯»è¿™ç¯‡ç§å¯†æ–‡ç« ã€‚</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="3bc6c6d2345e006bbeac2935935a354b0b85957348c84ccf26e08bf8c3560205">04b96cf03f1b5d00286d72390b6bf2e0817acbfddb7147d2fcc01912c7f5c0f9713c9c317ba53b9347fde83c930f8c77af411014f8ec84eef7465f6027f6e563b20763efbf9fac1db105face649d36b82b8e5a28894e0322accb07eba0f38491487fddc38b18732e21e4d5a09a208486db90f1b471e152ae582639c98996b3d9545b516ad74403d379a378e897878b9754f5f3c9a9c1cbf034ea3b155b6217c7c2a8ce65fc5458e94d70325ea68e520ff9d6b828ab526fe7fe05cbc0fcd86680f8b6e3ff6f8afc23a74718d1d008f3c35f4cbafcc10bf91c3a2b5bfa650a664448b6a7d8cd83c46257e4801044126e4196576d8e4a9dd9ef810f7d1ccf1e8722a8180ea841f477f55461567bc163202a1597e7078a9f439e4f8a83ab9613c05d5dbdcdf4feadc034d196ed9c7fc7d7f666a5b639e57bd197fce81356bf84cd6859687cf42d2058d781c9ad43aaadb18770a5dcfac9872b9cb89a42ff39884739f7b09cdd197b46890105a190d3160e2e18817e2b5d043c0648d7cab1c1e1e71742e0795bd54024e058233b1c2e5e220b66be9858d5d9781ae3d9633e4efa73edac643153d1ffcce1baaa5aa7f834b41630ef370a4062a906f04a718b4c5a483c4fc3271bc25760360b0bb08e42ce89cc7759239a4bed9121dc273cd286939bd1b63e1dbaeb321b4371e050618c8e8d2a6a36723545a383ef75513fcfa91a7af547132151dfa6980abebf781ca748d8c41065a891153e92af69af369535d9a66d5757377975554a58fa5b000e25fa979dd06eaee7fa80b71bf04a98561d32d889b2f3ba51fb367dd2a25d2dad5162c960e5a9aceeaffa0ac1411ea97cb3eaf2ee9155325d97471622707d66cc16f9ce7804c132b86dc42242a043296daf6283909894301ba0c85e08986e2d957ed7a1229563d48217f98f2da2fe01abff8bd0a36efafd5e62f10888d3e514b9e4f2cd8ac8f6196fdf18ff6d531418dfa5a7182d1c494e9b3be3d035e614c029bda3b282129fee9c12fe8a0d42450a1a9afe4a6266722c0f9647f3e1a972f09509358962cb64e145800f48b13e4402f3c22225950be9905bb32d4b050ccdafb769bec67e33e4b4b0d20d6261b7a807284a3338881f186133535decbe73c588feb9a82ebd2341e026b0f912243d5ea9fbc7210e6a63ec1f6256daeca5da4ffb11a3dfac7b26588176cb42718245339f9ad2a8289447dbda0e09c7fb71af2514142eef1f90cfe4a6f043d7dd15961aded5d2d48e343a7854a38461a87441781783ff88333d92e1d853efe750b40a041e92fcdfdd42be34db6ac4cf146f88f925b972540a498e31965b767e4cf154a1d6465f6f43c91b764c3b1bec870cd5914e9a46c8424e03748ccc7529392af559b0f96361c2d3f96534ffcae99b9b0292223bb4440329e3f55222179754a07057d12eac400372cbb23bdae068ef17b23f66212e0d0129d5c5154c7ed267c826fd26f6b75d247efbc859465fff11dcf062490c54b95ea84ab1f1508d4a8d9467f29b80b56280d17fa50ccf5c58b9456cce3933e8c0950a0f39ed22cbb56c2b43135808f0089d8212ed127f53cf7c7d19054e7178e21032d4e8ae501ff5604d1677a87d16f79c24c3b2189807028178e91e6e5618371cc6e131b255b2455fa6dd7041e2cee59483f2de37d973e472b1d02aca9bc0aeb962e53e4d7ac730a9f63001a0333407676b2bcbd17ac85459d5bd6f6e988ccee651c11d7d2bd29689f2ab0c1b315b593879d706d1ee7180fbbf5cf709ce5c6d365bb6ca098efb5b6bf923317a6840a232828fa3026a90279547df9591711cc3b014621c2e64ac960aaa133c4fae124ac31d84dd13296064c5578dac23315e61169f774683d76c5dd5e051256f6da1d3a3450b59cde7560c5a6d7f857b046f794a4a227798c159f6c0815e7f8ba61463a92a49c4af3d378bda4baa673d3adacd961279f462106a2cc5f6e1376c9824ffedfcf0a920a3f5bb83adb41105c8f21a0e8295b28c5eb4a4ad81a385fbc17517731b5a56c9033634a680e46ca86bf173bb022d5cf81b51e5cdc477fcb09155f056438fe71d21cee4b71ed38b50d0f71cbc02f506ad76a7da1a3ffe0188fecdac18205901f255054262fe5f5a8829a784b8d58b57ab710e8842bdf2ba8520267eb07263ba32720575478aee33507b503c3e2b3c752d68c27d916257497185fab63a55e34f4341fe9b20b5978666c093269416827c99dba2be6ebb33f243052d3b3515b6567c6d08cb1eda1c7f3b31d6cd00c4afd935de7620922f5897768ab55375e5937b1b353f3e35c4c2d3e3fd292f7b17d76c6410870006a6d090ec1024ea5c1122cf63c167fe2aa40ee25b0b9b4b4a18d9d55a621faa592a3f1a544e57cfe18f09d5ef110e0855b0cf9b0fef7a47c1524161f53a5184f4755190e5fbece2c9a375621062763c7f270d1884fd766f50d8cc44af00b5741651f379d9f6d1fce120b84707eb492186871149be0ed89580b05d060666c1165a8894d8816e0255f5888f0d2e75736aea81629143052818f46c5243ff28902e736dca8faf8fdea74fe44a7c38941c97871614b9c3578862a4eaa9395f1108c04a237405891e4c2a7a029f664252a5c609b42a41d521fdba708df61a2e706540ed107cfccdb1be7fae2624afbf706487561777d5e8958747bdfbb43891f048394db7ee8247a46d74ff93f4f18eae2954c0e6809e09c5fa76035772cd31894a0a79bc020dbd1d08d504f632d2b98c104106afceb3dc50e5946095b2604d6a90d400fe4ea3d8ed6a139b0715e6b30369897dbebca1aff81bc18366dc8364fd01c00fe29f74f2672b169f6ee9c47b184aad01fa34078bf38d8fbd7f215ba90df0c49325b22552de0f5d66d70f3ebd5151527ab950948afd7e46eee28ff0775ec4e5c45cc659fef6a5031d5b503db23b8bc01706965b3e114e72e8798597e355c1907e156a569c1fec53be6399030feeebf35c3d7cf362d7fd989a090c5c501910f0bc7eda059b5a7533fdb44a9ececb0d1223b37a5d16beb01ae66cefaf77286f2a1c056f3562423b27e1bec135bdbe4a93c3e8ff762ddb0b00eae4cbec433c84c9805360356816148a88cd28052b2a33fe27ba029012f52cd430a8fd52c841d0d43923d036e1b53f3ba590ad7a4cb85d8e6e2a721a3408cb4fd9f0ccec1fe52ff3b43363466eca2f8ad548e41e28477c73c8d4dfca8e8f94974e210ef6a041d5c3dd4e6644808c7a24dfb70916c90013083758a95247c3a98268118f96f95f973f19668edde7920ea42f85caa3b9b269747f65d2ead140583febe7fbcfb34e506b2e0025708fb2554914095f0c95c5bcf5190dc66e0e2626b53d7075e0472678fc6abd639a3e18a5d733573be9c0416012a386c0b579e156c151b063a90c8f7ea67e84d62c7c37585e4a870740f6b090ab404dcdbe022d555e2a9db76ceb9b3b38d13f9bbb91c0979947eb7a6c63545b02d0f66486389d9d2968ab0da85cd9b717d05e259d5fd2f7775499b2ce4ad1eae63a1144ad7d7d15285bdfda0bca0ee446326be1f876c492262889dddeeff6194351270dda2fe67f6c48472335b90b0ca4f69115a53c7171b695e68a16a924ace1bb6d69e68957ffbb7108d0708951171a6950cad42fbe879a4f7a69be776d9f243813e22ba2e554abb85b207a2089cdab6765a8814da0a6a00917fe709052f7fa85edd960e13ae7c11476213695d9ad5714223ca68423d3f1b48804771842c36bcb061fc119a0e3ef04ab3b6f4ab8c28208585a7ee649b3eca28933b3ed1d2eee4987ed72c3ac614814d0dbd57cd39dc7b360a5a10fed20133f4949762e175b4b623dc841761c44261cb4c5033a76a342b50666425b37eb55693abaa2113b908719897a60a87e171294cb1629781228a6a88452a48a1c447160d8bba2cc454df55cd35d8c6490a56cc3dd3184a432a6959803c36eeb60ff5ec407442459eabac4d80a54d93721e0e8a0430ef05fc0f5068bef3584a9434b4c862389a5b581d11866d9136821213407d32a539eec560281758d6cc34b74c0d6eceb9ea5b346e37188d485555494b00f9db9da7f2368fe443568e18a0ea2795902f3ca6fc9e467610f36f5a250867969a71678f6ad6098ce5a6c73b630bcde291e79efcf3e8d8f8e781b5ce8bea343b2c2114af953fd186d777de851621a2925b91c66d69442a59c84aa4f56605d60064f9c7ed6df331df0d5af28bf2981c7837758fad0badfbd0aeb472fb574e47cfbc4ca2de344c8375297fbbb2c5959f41f1362026a2d68847e979cb64ef6cf5fc50734ff0483dc5d8942bd87461a7aa896f39f508b2238357cb8227c51a0b2499449ca7aaf59a3d1d0c3cedc27640abdf5a55846f6459410e00c399ec3a8e2f24ca8f901e45db3fcbea1aed3318dd3d7c6bba6492713bc89f7987fe01ad4434c6ea9391e37ec34a44dee0a874cc7d2f554463d5f2529b4d6ce9b244d3f905ccdc98eedb24f508509134881f44abca4ff44a143dc8790ba261dc326dac98449a6aaee0965ff90f0ad0c98860dabecd7eb92fcea6045d3aa3f4b5d14b282ec5711b451320e9c614fe187ac441e36aa1b20c51257069ae6cbdcb2d9cf274ba9e9ea88d55fd4edd4c971527fa785a2cb981be51d941143e71e3f2090ebeb9c9f1c6b13c79b76f7345ad7ad31c898e2252608926d3ff0e9dac8d5402b0cc73e1bc78e6fcf8d1905049abd3e4d113b085c37a05b4d4806564b3ecb84ea3d2c6c370983e5a1653704a3c3e00799b17d9836da84d3f894c0c0eabc3d16122aa9d03080da68c135b14501c09c69678ac9237858a481eec16897fe24bd0a0431325338be1983ecf766f860b0820c49fc2f670b044f50253f28e918dccc2483da2488121b611094c496d5e3f1bf1cbeaa55f705025fc88f3bd1708c395643d18ecfcac48f3ca2ae367bf45ff65b4994db4808f98b37b19bcd4026dcc55492cd09a095c04881bbcc1f1e0a5565602278c427978cde0fa7840ced27a0207bf7c129e49e9f97d774c915d2853a87edf7f2ba854e643311f6440dd2b3142b903ef3bb6e639c9474d49682fcba6e95ce029d8be80e2eb322d6b8801c6809caaeac57e167cbdbdc823edd1bc6dea852c8fa1ff9a06516fad534770228e9b8fc6c7221236552cc478bc8c50eb31cbc87e98d4d9aa277332cdab77e0b495ea96678eaaf4df5087c0d9a7bfefbc88d857551f6b8102fd380672a6a135e940e9fcb0484d3635b5da37a374a934de6535422171ebdfbf2242007a149bc532fcdb05a10541a940318bef5c4dd4edf5c5b16de096659d35dfa7de00b53b0a8a2eb29754c70aa46e0aa576b159851f45a51a7215ca1285a0221ebb1a39dfa04ce90b2cbb382d29c93b5cdb83dbacf6b6aca9550d7c8d05ba4032273ee09d66abb8e5778325e8a2d4e0d97ad2645f77124e6789f400a0e03a5122fa2548afcc868f58b64410e24a7aaca35988f251651dcd8fe1839cfc1e5559eac04af9202c6b53cf68befba0bd9ef4eb32bf58141237a10f418791a4b1875936541ac1dc5e41dfbf68ba263a7a2846c09108357684613f1285561be09e07715bdf47e3b130777d6a8ecf7e4b602dae52d5be63884f0e38a36caf4a37673ddcf179a4bd0a88377389fcb23f09f6fddd4ea214eeaf6549ea20e87659b1b2b1ee519420f1e23855beca6a6c3c66ca534442e4adac74e921b561305ff2cfe10116412494a2e7270a2bdf25f84fecdb2961c45c8681470f5a5bebff32350e442a1649650e9f939d205b5c68e50dfa6e133984d4325df6ed7d8ad4b52e472550494e69055e8c57156b8926713573fb4be528cb150364e0f55231b7e0cfb2141fb7c68654dbff7ed894afe088e8be6d51d635abc67c56a28475d8adb8b4b3a4093f8bef41f60f78f43b17e95341407ce742bd669ba3a4912b811a6d7f42bc0eac6a21cf16b15da074097dac7073579c464161ff80457321c3174dc4d356a7c4cd0b97e8bd01d4c484bd6d341e2115d35ef9f973394416a4e5c5d227887c8e24cab95cda953ab231745ed1a2c6e547520a5b2d57b897d595c54d656ae504e3469860844a265265ee34934fc20452db9f8a75cfabb2858c83f06d09073acce753ca22f1604a029b25086be51dbe7f50296e08867ae5f3cbf5644fdac021792d690f68b63248e86a65f8220598ad0fc75f00872656303043f3afff51c49f25040358b0207a42ace5f188e9940a5512fc2d5b4b837409c225297a2f51e5bba18eda5fe69d7c01be6d77082e73684c0a919b12103e68ce3aea2c2e6474df93bc8f5133fd2545885f3916bbe2d3aca6cbff038e6e0ace799138cf8dbf4a8a75f64b671a361b82e2d6fd6afdc5cbfde091c4a9ad116378edfbeb90a6127fc78fefec5c10d9756f2253c0183d06e2cc30e32121e8fd68329ba2d65ac7adaada0d70febe678c7bff569571dbc4659f271a2155eca9ac6f54e3979b7b333c8021c54ef43204dee3e835668d9b76c21e4a5462b7e67413e027fd4be98657694fa1013244a8cd18a68385fd5c661118ad968c07c76814ab3face65dc94b14269acb13dcb9b76e606cc1e68e800fc6086175b3ce449e5d377e0a63052510c659d37ac15f09a83ccd980717dc90ac4cfb300e51d561809bc1ea4b5c5a76266764342348ea8caff77e646a0fe01941991511075a8f7423e67875a34a2c1a13b3a657e9106f45d5fa0971785fa8780a1bfa04cf56c0cca9636c1fb572a573ef0398806710bb38d21522e5c038a94a7c27f3bb891f45b93016adab53029b8f487c3f9c71c58d5aa37891a2ebb47692a5a9c1bcb5bf8f259a0871ce540b1224f51e737d9d0071c05749857738f1224959d64af728364fcf64dc5ca461a696a29dd706370ffec9d5027230acc3c1c2e40e80523b13ab45db5a761ee00ac5588b2c163afbeaee1b6e46070f92c06119dcf6e82e1878c1fdff07fe75707e53d5317f0d8201568bdb65570e2b11112fe9075771365c99e78d277b6e990b302f2414a4c012fb1be427ce40a8cf302c9bb25f8d532e80438641df696c82123c06a336ee3d903199e58f231225a850d8f3b07ed090d59fea52d4156fd1d03ee2092ebdf79b18bd15e8ea00fbe0f7581a372644107ca8dbdcf419e818c2dee04cbb7c2c59cd1ae67105c9b9683d1c687e044e02ef814c704588a94be2a9d78696e88674aee435426e66c5ca457befb4841bdff4c8a6e38a81c26977c4a61f57f5b84390ec6c98c0ddaa5401bbcd357a5a74a0bf00a86bec72f72d5e685d6e855d6aba9d4f17b848f76228a1fe548e8a7e7d4b6d2a44900f317d30e3cec1fbce16bad35989cca5369405b83d283a6d0f325ddb6274eaafa3bb84702f5cdab118b7fb28d0009470fe7a4aac2f86d07ee65959a41d0fea5d9053e8fc813fbfa1842cf97e1cf91762a02227f609c9bdf3df7f392622d8845e5e5775bd1cd6c30350a95bc8aec135b1406b4eb73d7e2c14f101bc660653e513d038e47ea50ef0e207ad8cd3dc4cd2042f785ab0179da1e12b9c5c5702ce07078e3e531671e7ef330a38af5ebee66b40bb808032bd8d80fc745242271bf64a7e6dc799753e664566caaa6e9419847482f1b93ca11401cbd2f3d3c61235fbd3597e90a146409c8d6aded4e14db6b59c783b1bbae82896f83e74b96e6b37c78d0dc0b4d722d4246d013d3432f67e9af22adbad7d45965509f58c21badc328e6196e48f5cdef6844e8e91d084c5a7f8e59631e6f7308eac9b04dc5192d950fcd7237a11f8e609e2cafe713df0645537bea1316cf59752919b843f9f23372fe2ec0974bd5a4db88a4a95ba0bf4a8918e2985ee228a5b18a9e80ee0b98d5f057e0206efb4db80f8cc3a6c6e608745fefdc11624241462fb4b6af3312446e5e9038d32cdb5979434340b52fad5901563f88b72adbf79d75208f0caa7e88142f4fd3642f3da424b96965b335728af45b2ebd7b667dff9d9532a22d63c8845c9fae60d7e70f406d98e90b632701c7f4fba9961ab2e37f4ff078584752fdfb0ab888f9668136cc56ce5841ff5ab85e72259cebb4c9f44874acf186b1ba65636bcb8983efb0dbc6e984f7fbf72a08f37ee06a6b52cbd245f5ea1e05a8f7102dcc87bfb86095656599587c559a0f2a6d5b7fe2e2b5fb10475b6bd1c09c62d64fcf42a60a430aba13de331636dcad92c4c186d768f3314dba321deca60d575291b6576d45bbf24de7223ee32779782ec67f9d7a9700babe47d12f31f549ef35c559c42af82b1668db0816172c66d713df8a2bf58ea3ceda6625e98770dc03483ec12cabbd1b917ff145d9698048b84dac04413a39f12c9fad566973a0bf850763365b06b6cfb7a36c45084c97004cb56dc99cf36a2738e8e73f181b8e358d972831a7bf2c819c95cdd5498564959989c7f97c2cb6302dba62a30a64501f71bbfd8af1f17ba3794a72233c93a3ce9663385ed1960be1b07dca4786f285b04923ef710a8798436e45445ed76689b8bc4e192e76956a41bbffe83b43bcd272446073cb1c0010d20344c7f21cf6ab367869e5def7d905a83ca1f90a44277822a524608a1387e3329c510a4bafe1c40c6721f574ea68332cd9d0a97122bf637b988b73044e5b1c79eb33f1562f23515c86b1cd5f9f365e85e91acb4712e3e9dcea2d8e5554e50b44245b77fe2dd2874f837be9636aded261474d041f209805840f3f69c294964009bb2d3b0fae004d305a93ecef1f1eeeaaa7c3fa1ef4a3217ebe0dc13d622f39d21c06f03626953c7ac1f5fd38f49b378a7c10c5c9ff8ef0ec28fc214abff0beae59ba1680049ff362c93968f6734c79afdc0cc62f0d765c7da72852fb9fb5cce0de0ec3b2257363e14c295c92e3da7b00cf2ff4d5885a1fe768a5678d8debb7e337ca28b352fd561c6b4cb6389626945aa058ae58c38a5ee2d5a7d6c3814f9c7c062699daef8b63ccb8c80dde73ffa55a50c6e91f9617ee9a65599fa9b7fb591b9c8bd54b1e4977c0dd2047fbbd2a51dea6cb5f8e112abd5b9cbd4ad429da3906a7e2b4e54b130c5499c7e7639316f436cf61dff848ea836ec1430b900ccbac08baa4fb94da69ba5b6999a6070abb927158abc7e69c3ecab2be0962ff78c68ce73f26a2cfee09e442d8cdf211505699f3cff79698d789b748d3929abb58bce3b2045215096570f082d2640e402b2fc95633ac53370e55f4de187896225bda38d0e1f22e3ae0a4238432763b15ad163165d7a319398399acdaf034cd7e1192cbac857bb74d7e308eee74799388d3d58b2d1557302b229487d641c4cdd5fa58721ff12df6256ec5cbcc62b341cc5df491826c62c17be3a30a939b30ec42cc52dabdabdcc5682388fc4886f56d5f447d613e07215ff87a26aa6236d4946bfb25f4721f5ca84f89fa804a6e402a3698def3030b9d478b015a0e7d4c79cc75367282b3d7d43ad3f5491a892272ed87c288b8f88bddd309a7be23937d6944ba2a03b548bc38eea3e0f5f183075f1103d560b3f5d805edcd7d69055775469c94f5d448aa0fb3a1bd938a03f3893dc68d66fa70527b0f7019fd997af7feee98cc2cd714615f6e9ba5e289b8951cb1a99b52344d79afa7685ca7ef9850e8eb3e4081cb84a526b4d0bc8e0f04ccb5385cb91ff25a6e3ae5704e9f4316ef1d2391e8c45801e2c30b8035c1a1327e69979e1a41bf02c5f0621416299e655c9cc11f6bc497fcd08720e38c066cbe0094b1dc61e3f69b9d334022bbb623e72060a6b3ad71d0d7915623d1f5e7d6fc3cb70c6b1f8d100f43d214195b8588fa2588cab5c409d6bb761a1e721db695bb68408535c1d77515767fc4ff6b113afdfa0ce43716aa2cffe952f7ba85393cb0cafbf9a7b0f236ed3cf38bad2ed1baf8e6b9714d2f961ea827c8df7aa9d55ac431b4bed7a9700f7792046c7fcc04fef7fa6540b3dd2d75036b7c48cb1e2db05e3c326ac7c9da5970c419477e8ed2956bdd3db005b9476537fdfe0c561c4b623f5c7a1addd29c52a8a0e23489191269f3b5a2d98ef225203878663febf3fa5f47a63273c8de8d6389996889731cacebb970c906a9383e6f4fcc5a42d2056c3396e5fe15fc86d67f9eddc4330acf6cdb1268fbef49108ebf464cb97b4116de10018a409a0e2dad79c4161e67eddf3c3415d164171f272d76253d0deedf9591a2f413c67550e317b7f798433dab96907a548524aaea0b0d2ea92d9149ee79addf8162bf7f1f9382e8df6a129047647fea1ed9c9403451c81afa10962ea888ddab00f89baae28687ffed145699ba286c4a4a3f961317e33f3e2c4af0a852496e32c0d324395f93ea3b5070876a93458fcc5973cb5054b14d2d31a972cd470e6768ae844c1688169d38878095b36e22e94c3f6231f6b319c92b30ad8174ce443639e06e0f75a4ef79514016b47ed3261e16c860bc2016f606fdcb5c3445f79e40fac06e3a0cf784b11dd7a905a37cbca65291763f9c07b41b4684501eb4e2ee594c603417f598620cca3e3937ee721bc74e1471d6cf69eccd61b12517f481f3ee55cc3aff4e8d59390937dde73182600d29624a13489d0f39a8faa6a6db9fa4136a087ab72ff088c9a01bc2245841214ae98cc1ba89f493891cfb1b4d5934295f979f75b37478d10c35b53f78c528abac2e97875f938c92fa4fe8d328712d00c598eb9f8d7a8982eb80e6add1bb4a28d905a073c35ba53ebacdc04ce8c4563f90ccc4e8b11128bfaa379340f0957501ca61e951e2ecf9802844e3134bcfea279a6cc1feabfc9dfc522cfccb9e9988c87f20df05a352bccaf4b7e3b01ca05e3616a630769b77446c91f756e3dfe5cbf7232e35315e4a8ff590f30e2eedef590eefa52e1e3dc49c60590e0acaa89dc3ab85733b8f666dfa1219ed1d3a22624491622f5613c2d9213845615b49e301416983850bee3f3666d2942247dad5922b5d50fa2dafc5639ba9e7870cd1f1944fe218a5d808045d19c0aac74abe6d5b32f2919a0532d108ca11a14fc7e944c19edc3b04bf15617a0aa66e0b5c5d8899a661622302abf4d9336dbdfd0b571992bb55f3f624038c598fc3731842d54305ce0f17856cbeba39ce3afd566be3176ce2a87ad65d60f1a84ed9bee89bbd677460ab557d393417e5d61c2959c06516a9e54067a0cbd68fea07330e32e28726bd1139690ce22694f2321910586c93e4bf0871c4d7197235c0abae437f5f0d547e9c79eebef9e2243ca586c75ca7ccfeb2fe1dd8d15ebfb8de2d08398ccbd407f2d448690fb684eb9b33664951bd62778589d628ba78586dbb80fbb497756692ae30ca754c561087913b3eeab9fee9bb99b9e1ac3d6df714a5329d8fcacbb20c2a624965277c2bfd39dcaee4b0f9cecf207fc60b5bffcc86b86e63a3f269453bda11650a845aa5a3eb69298b9a7d3f3c74b396405dd8371fc7c8fbaffc0dedf22192345db1a53c418b0591432e3e57a975684fe2a9cbb994f8a947eb92ffc9bd9c1a9da69e09a60e01791516593f162543e7ce5cf49b982ca2e6e4e2e75a0d0d13e930b2a633359183b0bf85541c2c7d2e0a34d0f91f69bc4cd46d2b04b224f0ca29c4446bb74b39fbf911fc08b25b6b2e7516d6a9ff837cbb464e23cf6e2c60c03efc61effd1c91a346b75dc8553c29019ec6717d61aa10b45610f51d9f52220cfd209a170a58d76194f19dcf13029e6443c540578086a1c9d941d5b26b51bac50321b6cc9933692cc8026e2bf1bd5ca78d739b22c1b554b14018ddda90a908110e940b1812e23242dad2220d08c4a5516e48cb669e70c9f91ba68564e68e0721386da3c8adec60adfaa5ab3b0916c05bf062d1e4f1e1c618dd82230e62be55f06b61c7dbe95c13015409bed51e7908ec0c5a6359167960015f7cdb7b2c4ea58ba8f867a06de6ddb025b3a812484df5db92f780d7c12ebeea94c35e5cebd209572699e8731ae98e8ed48ecf4862e35b0722891dc26d6377b1fc2eff272ed0d0ba0ca29184e15c23592f7af6fc25aebbf614e7238a85da22f8a2375ce6f2b63c6414109aa907eef823509bb14cba92fa32c8668551bc14b947afea7aa05917d4ff80f29f459a229e7287ace2e02718214e5bed5ad05132af931bd155a74b07d8f076ed68420d1039fb0129338b2acd7b7e81f1411e73819ea1d7828fb3fa815ce57fece70ab7ec1c63bdc9baf83fb7964d245b74ff66f0c63aebfc780f1aebe9d0c825c9ced0c518b2ec09d7f4f4e79bde9859af6cbbea6a69bdde0ee2545a3e4e0b2f4bf25a5667a8b43103eaf4793adb9a6274467dba6ece98ebb0ce1f9d0c6cb2aa119289ea73148674fdd33506dc9f58fa5649aafdf0faabf5dbf766b1be581c71bb0b1faddb6134a181da66dbbb130fcd2fa8c3007e57db478e2e8c5079b4530db142f7914e68cb6664d86b71fc2c0b299a5ca1cb96cc985897f62e4a190d22701dfb4d4470ae8f81855416f8e590b8f1b86fcf6a76e7b49e778e353e9ad8fb7b991acc4714bd79d64bce45dd782c7d28754925bacbeb2b98fc6e45fc050298cfb7cbcabf5272bfa87eac095ef03a0cc86cb2338ed9bd178e942ce1d575197c84dbeba20bb8d0a6389ad58dad866454cdbce678682cef73e108a3931dd329e16f03d4be38c9ff0471c8bcce436f20e968ec7b8663612bf0ceb54309d128c6638b129b29837997842679f030dbb3924b740bf57ee617b683cf4cf5c9fa5da087541c662825f984e00728df95dfc3a5f7a0bcafd631d6be71f056749cde1ea692a279aa1241fc6d4c7d965352fb41c39ba0b889d2eadec5eff28b84b23ddb331d68a0dfa29150e9802ac985a51050900426167f5dde06b43b93695aaa9c10df0e209fcd091870e2b5517d865746ff94639045ab7097423329de2a2ed01dd28bfec398f7cbf48ec338b2ea66a02db1aca8d25d85b73c73999d1d91c97b6a30d6bf8d90c02719bc1bb12b688269b15aab9b1fbd658c1b0dfd354d974d62c95a51d7439e033e85e2c4fb3d6a002721adfe5d67a938099e2e837f7165b57b38fddfa6e11bec805556dd9097a0bba267d9f9a21a540c42fd3169e55d19a533d8110a2c05c9616599bc5159077e94f4d3344ecf3b39b3674b21947815254e5e66b3471c2aebdf9f1ed8de1924f882a92e9d3c6d86c015649abcf0e8423cfc5167c18dea38186750681ad01b2be45341b0b7c2fdabf0db92cd7e2b3cad3787536c878b55db7d0866775be0269fede0e38196ac1c65b60d0ba1fe9be55da1b3fdff8c1bcab519f8d699ce7a0d1788bd4e254eb20233dc2528c3c33c0cb575ea6457b31825fe4aedc216d83c4daae4c8c50d4ac8af259bbb14f341b6dfab7b8ce31e8d4c71d967f2b2b17e13b186a829e53f0120191f12ec80c83f043bd64738805c27ad4eb3ae2953d6fac55864a59f096fc6e68acc520bf439d1982571ca5a96c4dc34705d8f4cd142db9ee7a3a126889ae176eb91300b3338d2e7285176a631433a30c21020a12c03221542a59de14e3605515dfee1b84c5e768ac5e186ef474a53a587e8d6179b9bd1cfbf78e2eacba1c8cf767e8f25edce4dc7d73815974da2c0047809b70a1d90cc165c8c1abac66d5812a108aabea03cdf5b0cb15b1263395946219ab858e517b401634377479a9d685b513adffc516679e904797767cac7742f943199e8becd021e543b7f8544252a3d3a42d58ead75c5ad9443decc80874736fe202460e18e6a72b6c660ae338060a0c80c31690419c696293fdade31d06f31ae2ea7914a87a0e904e089c73af80600873cffb64e6ef03c388113f24127df128087e91e3b84712970236928cebefd242b19d2430b78de69354ae43010d917b034cfada1485f8bdb8d4ab1959ae41b18c2b165f632c1df7ff163e314ab4add125166a133a7e8855f101bf8d75f376dfc2c2e5c33bfca6e7a7136a07d20258c7c81502b5a42457530f2c6133f0e8869ef2939cc2a756a9d076562a90ec30c352a0b90fc2a518e9a97441450640d03edf55819853e9f6669b304b6b9fdeb748a61429372c4dd48a82607c9ddc82c1fc8f465bc88ab32906fa4c85d8b7ff1343451419af202ccec60f2f60ee661d9676d889b254658a3fa16096f82cbe043db707125881b3c8493cdc63e88793d1ef3cd8241aa84533275ad8a3759a4a23ed8db6e920bbc8fd9a1fdb7751fd449ae8292d023f26535c518a76ec4605610ddc30d783982f4b40097462af1d2dc2a09a7193105a7561810eff445cabbcdc773f026db457e420b5a0ab127127af6bdc63cea7631691b9eeeb560e0371ae330b442dc1a3570acaf0ac8659d74f9b1919ac47a9c130f8a21d387e1aff409e5af8489fcb6996fe9712376244d29b281821089d3b87aeaa99663b277cff4424fc65845f313cb9e9598e1514dca82617bac9cdfb58c6b5f25490877fc4cfcf7f4b7db00733b11e0987907488403ecaec228a2ccac1d8fbf5ba8e3766c66ee8368d8d6b2263f525608560345721ad78c7d9c14cac385109de2a469f437b791ccee832ea07072ed5ca6c3a8f1019c73b9028b458f13a4f68dc22b65e4b3544d87f0df48982405db56ee769f9a68f9bb72be97c2943e730b707f995389b3815d92ea3f5d9ce02c1e0124e1350687113dbc64b3a9838e2238a1df1f62c1c2085bca48cd04398026954d20ecb63c52ce19d7d84559bd317aaf29286d3535201a67e04b72990063337809f33b9dcbedfcd2069482845145e1a2b36e95d00eeeec07bbe65e727ac60afba71ed368425aae36df7e2936da4b43aa8e5b4ca20997783f4cd5856248113cc16196ff7af7832f17d24bbb8670a33e01ad68dc6aef6c3c4ba23798152e21e27993ff343b08d956047686066611995000e9755fba2374f08f0d70bb5dc48f0c85089babaaee06d8f5df8b3edf6726cf7c17c506a71472b53a57408e6f8d2bddaa6151d3ae46b56a0d6caa213bf56ab21f157e4d1276d74d87cdbd929d457d18318a955adb94b8cdd30841c2a07166576145807bd77c622c71fe4e1b939fa940e531370ae78250e5d5acee2ac78761a066fd25902d7c8bfb8ba3eee41936c866227829598260ed5e5c2ebe142eb195861a7f332f5a15155acfd2d1a28bf3447f0d31a28e430bf298719c54821a8d607e6313f30fc48360ed25206ac479893cc75694e9ebeaa61ba38f9d003bb875c0e43a1b7623b471008fae7d4d5c18888d0dfe2af228d1add64842f3d9ee70f49314c89bbfabfde6fc8ea59a5f24705d424d6280ecfe31eabb47b28a769f2c35ee4c6859632d1b5dc3a03227e975f32be62c90fa316c4c1741cac7eb59b1abdc3a848cd980417f119881b039a50d54f0aa2ce20eb4496c928fa3ce5bebb0c9d7aa0cd153a3fb37978a0cbd922afcf932fb6c6007dbfcad7c3d164a5a93adc661a67c10af55f06c3cc930537d167f532b76def4c261c4ac18528347d5b46592a769a7f412ebf8f74721eadadee6d787ae9fca6261311cfe2d528489b3bfe72f26e33b6b7b7ee97be1da700ac5fccebb4010c1e5e3a9b180d8eebca613eaa56e7adf816003ea3f35e188eee6424dbc1d721d85d02965299d80dec899ddae27c44cde7ec84f44b95c01f21cac1c40c9ce71113824df9468ff13aef963d83dd6dabb068f2691e1a715a59d08697b59d0e677f2923fb47e0814a7bb23b4d696d924e163cb28738e11bb20386b600c6f1e0d8304f8f3cfa843a99118641fa6b31b8a7b6123f5405f043ad911e0f05ca6c40becdf483be8f6b8d62c8e4bedfe2865a10ebb9f8ce25fc502959135f3e55c7d098388162460484335a0c8e03213f6c76c813c8e5650538f0f6db99147e07becafc3a109dd40c6bbec781cf3e7014c98da9a5d9fbf6a0d528c393cc17cf7495d808c4bd540b9630ed891b6978fd307425ed22571b20ae435ba7abed77ed897294ad65087ee272d592d50968af8969ba940e379062d23e3d804465d390cc95fbb81d7495e437163bd93fb90e386120a566b35d00e28fb949c158e632570447b9b6bbd3460cdc87be8a3db2d40c3253527396e540ae396f1ba679b652942276b587206ecf90bde3eab7198a04e633c24bacf5cf87e601da04eae2ca41e7388e72d7474edb50843d279d5ffeb1d4e08a5dde462ed53f411ba7e50f4c6d755b2498a63dd541d6b0a7805fe468fa6d4511a1bc8e801c9a580d36cf61312390a6df2260dd73e817256ddad9b6a4c30b4070d93851dd4b21f3bd508712e3646ada524067143b0f714aef5647122205ddb96e334264d4ee870e68a0c88b76248b4ec9af8948c300dc134992e8c0f9877514acc1d20c75defb029be28f59d7df80f662cf25c9ee782a2e18db168da595b96e29c88c69ca33ace27454df2cfca4df99963e72be3431e09b25fb5b6830d27f48598e05612e865571097846e5b4f77802b7cfb475a45e35b7b53d4acbe999affb252c91e6eefef38a367f07ca8f2239b069307eafe6da8cdf1a8fe3eb70a07d92834cde100d00ae7d759b665fedcc98e71f2e1dea8c6630d513bc4882296cb6cf74430c7e1a0065a5f77c6902eb7f963a8cb7e6bf884fa4eca5a6bbf26c7087df1b6bf6e3a40fa7b1c5c46d7b646eebeb5d420cd4b901889efcaa54106d8724a479367cc6212f447e5510c4e62f5ddaaed72e02db65d8c85e7c427b33ee09623f0cccbdc5bb42e610e464e5ce6aadbe745c35450a86708faf126ce36343df3809b7994712e79e0b7fb529b5d7dbef5a77a60c4265d2b049e39c2659ecdcff5279ff9cc979947379575a19fb99d3db376cec3a0b3b61202640d8c7da2493020b58c38287d5626047d6a21245f523e7d061515dd004b1979b3975985eaa26e59c99ff5ab131965137b1b8bd655dfa6ff0d7c223df6c22daab5159b225fb4f5f57f7cc88cda4e32f05274776d5573705e3c1139dda84f06083ff37ff2a0cd39cc580c5103047aec013d4e0c38226787c962c361c6e49bc173d3850502ea69b2fda7f89bc76db680fa9fdd92a0684d0c01b7babde89ceaa5c769a5add03bdcbc7885a8aaf4f9db886af3075d544825c1ee5014b2fff88da6524dcd3eb6633fd3fb1ba782e30bbe55b536a29f30c48411765153aee1931c99fbc859cb06bc59897adc0aea06af04796d14da5171762717ed9133aa52ed77ae1c85a4ad02abdd41645b952cb2e653b7518674a6a4d8bf719d956f4da6b6ecb51e32e8351403981749cd68e74ed2773f9cbaa43fd788b0d566f68d504aa581f880c31153798c3535b61bcbaeec6d38468f6d7c6d001d3ff8b79783ae9c0742b6a8b17dde8147c3191c47ba6b6ad1657f756fc0db2f64db3e1492e7ceb7c97ca4f521ec68adc102d1dfa2f9392b039cb27c0d75411beebc89c956169724a75ea1d428c581fd5969989635db36c73a646a4f15a90726f3a99b300930d3e3ecafbc84b66cbc5ee64357c3e3defeef980037350c35dae60a9454106239db5c7bdeb8244b7251083bd30b19e42b8b075afd2810430febe1a522b570e3f196b328bc26485547f8b741f2d8d5a2690327f834e4979571e0f891cbcfcceb9f29ba7a71783b1c4790fd7d7cf9db320d09f06f8c188bca37c3743fc9f289b796eea0f76dd7d740f6499e725ffd86722b8fd83fae8b7d5c629b93c57ec788769ff16fb94f55fb9c319dd31ee209b7d15d3fb7a14e2aece47a101d3156ec422d36145ab93d8fa053837d7e40148db292d7422f266927f4757bda2e2176acc4e2bda8b66026c2aab558e3a275afbb8560f818381dcb85b0066d8048f51dc5ca8665bd8e1fcdeea15ad86caff4329d8b67328391862b780eaab335649921acba039d9b49e8ed0a55d86acf7bd31d1b0fdc59ba00900a35535abefa4e030cd19e5b4baba8a8a28a9839a027afe7a83ce7dee7d9e3f0c7d0e0593f54c3991a6bae13586874dd15ee895a95f8433f8b5fc534fb169ece21ec6e5d673790693694d24759d80758fec9203510b22593f5f1295576646c06fabd8679bfb14aab67aa221bc91836ddbf07e9e95d2dbcb3a80998352c8be07704dd66cf63a38873137ae3c08d47835237674dc003fad3cb5f36631fb2168db4168e51a14cb753193af4c2156fa2babb5a1ec4fbf789e55069cc27bbda8b590d951bea3b573450763315d91cb64b9b339ec4ff30b4cc0771e3304d2b63ca35548b1c53cb33c0cb06528c517b9bfe624474ac94db751712c1dc71c74b753482aa6d0de65b3e86adfce4305430eef9f8e381cc60ca5370859c9cfc83846fc0be0119d86db4eadb54f20356011ea617c18a64cf1779ebf3837855200173f1335662227e579000e840a44c96a838e4ce4dfedc8a2009f20c6cfeb8a4e505bcdf763e75f30c687110bfe7b81a41f6fcbbc9d4b169b449c4c31a2a1d07fe27717dfdc03b43467937132487e734b3d30d01c57085233ed26ef10d77059f849a4dafc8f63331e45f79623a02f400f28bfd5f8ade3ea0e1299f4ae6f1eeb9ad15b4f817d1569aeb89e47bf1f8cc568b843960483ac0a802da3ff326145d6f044c07d4b68783e7f2995d30758c9dd9eb48c9971e716eb318075485867ec38ed6edb01e3c49d2f793cda6c027ab7eb2960be5487fd0adca5929d2a39be113602cd33ecf2422d6bfa49e767687bf36681638494d77c45cf710e32f12abd169a5e3a3f7c0ad1c9241e4bc72ed988abd7687c28faae730a42f8b956dcb32f99fac539c81554f71125c5e85926f564169fe91d5098843c6f311c9bdde423eb6a15d01bc93582de006d5a0ffd6970d4b78a5da01b5cc2a582d8ad6918a5d6fbb859e8a27ed4a42aae6a96a1ffdbdef5f22c75b131b654e201689fbb1d26f110c995db7bc7da9a831d08f093c4048e939b78f6ba479404d1512e978cb30024ba4ef4c410a84cdf618a41b8e67d0169d7daff292a0b8cc53702c9c790344e5dd7acb5de3cef491a62e49bede402ebdc37fd6c403be780b4a0f125a1ab2b91db66b826ec6de999a09f37f284f1100c14866d37777e67200df9afe27d308c359616005515617c54e445ff1e83a1dbb8a428f35bb6e6bd3ddaf9e040fa1fc8320aac04fc91301ffdfba27440df5075a44dc9e65f39294ec19edc5ddb611c3ec8f0a9d41c9098ba4ab00789b3a1fc4330af0f4719077dffbd74a196702c5e1e15492eae75dbe403e17ecbc67c4a9daffcf3a24607ce65a97aa2ee73e12565533037755418df2a30c05927cffa7229e41607c2ba5dd3a61134835001af598b1fd80d75d3fdb626285783d1117928eb60f0f80ed4841fa8362d57e24b005e5a1fce756734b184450a7bd89543df5ca44af9ae07a8cf5dfb99c1e793cbd5237fa928f164d5b74b28ea8c7a2f3d26400723362aee2b8bdb5bb5a722da1926c3f0f8e46696ab5a73742047558374c325adadddb9904925c4c569b4a387dce81fcc80cc1af6bf3a78edc4109bb3543f1385b9a278a333bbb4613e120960d115ea2c7b3bd2d440db10cf28e8ae68be63a9dc7ef140883b06e923f32b85652b93ff724b4dfad74e156bb96bc0c6a2a0ee0ac47ca8d30ebfdf35d837ec082e230fe5e53dd09890e53b6e834e2136818f42ddcb5b8628502183bc7e738f9cfca279a14c17a9058e2cad3625ee0a5467a832c0c979db390cde203e4bcbf233a0b1df9c3ac50114e77795b98bc156f1fb1257c7fa34217013f0a901c77f1fbb4de6dac77c110d2aeb06268d7b5390eaeb31be459646c47016c37ee2ae81eda10dddfe924dddff2c0d7fa7926ce79b17d8e474e58dfb692ad1770e62f7f4b78b8c94d7f4e1eda20ec80a9142a61fc63d42b0789f2d64bc01e7ce2f1b55e16c39b56e06b8214ff8687cc748e24594089cbee2e472e4a3979fec1ffe605ce5f7cd7300100f1bb61d7e640b86fdd47f683a4aa28e88f360151722614eb0b9a36e38bd52df93fd0a3be281969416e234b3f6c857e33944b51ede0a8f09c1ebca9b8d829859a6e87a2eedb7ac40ff1f1c26b7f8502d8625e89360c89a42f5dbcc40f23c9a3135dd9703f9d67c607ebfb92d321a053bca804a197bfb4f4fb21a81a6c06120ac4d332bfcffd805cca33699234a2fc6f75bd59135073c15b1b688b92826d62d99bef29c4cf4d8d62450a78418dacd0b660d0223c25379123a53bdee2ecb9dff913e39837f47a760e90ead4061c06d6ea904f651d55980b4e5c35c50cbf8c3211fdac79e0ffcfc1827f384a1137ee7d1a8730710a5931d635cf624a6afdc82632ba1375070259ff46a47db4e42baffacc1127cdfac580db41f96f000dc9378c649f37d32fefb4c38cbf95446bf5bdbd10aaa40eec8a8d395dfb6a0a95927824454490cc46276de57ddefcde2dd8dc8615e02c9643aadaacbaa72f1b33b4928071f60a16ff0614ce535fd5cfe0cb75df168cb4069a12d17a9c8e7ca88a480b65521d2b04ece48a6e2d02268bfd692ccdd7687ffca7a9f82f366660318588014da8aed06628f87c13a1e5b0acf1f037a05216711e801a8998adf59750810e3bae38d9d0b3cf1ce4e81ff7885bb88199d586bc7c334d2be4e95ca64304b89af55a3170737008300030ce26e12a3d60de297127cf76575f4cc0fa8eab5986c29326b0912aad7a59111c3ee68ec436ee033c031ae9672201f844de7d27919ca2513517aa187b57630f5ae59f8fe468b50ace97e5d52808796680504475895646413d095c4e542d984ff8dd6ea0427d90dba77ff99bda23d0f3141662e727f07bc66ae2d6624b6314f02baf2a08caaa00ea38751dd3831316ebf07d8c46928370f3eb84ec3352002ce66c770b392a412fe6de577f2a5f896c8175b83f81581c2d8598f6302088df30de4c9e03dc74fea9452a6008924d3137855860ff3547d2495ec9c7a5449c3eaaf69433e8a4d952cb587dcb5e59cb66c3f917faf9b0041ec1efcc3b20923ee6c68b4b26b0678861ae5586dada71843c23bf0744a7750bb3623b45fe36f7bb1857ab731d36c00033502538bc7bbb7fd1739043c6c975c9624d81ba582913591e24ad88a7284d3cc59d78995f387310cb1585a610e764ef08844ed1094c14978bdde059b4ccaf17ecccef6cfad77c43d493841860050d12e962bdd25423fc5897808a0e29e34210d6b9bcfb1c5e0e33cc2ed468e812eb050abe1eabf06276a0015c6f1539fd92bec116d3260e3a16acc3d4429e4e952b66ccca2443e869218156d60ab095a545e0bef8e2d77262975be4754c5cae157cd0608d8dbd1fcdca05cbd08ffe24bb5060c46f6236c1d9d04dd6c1cb47d5eb7f57d6b53277c7bac9e56117fd36aa66fa5b7f51f9976328b5c7e3069a0aa9b7a79daa40abfe2684fbbc4b1f1b241b7db2851e082fa99d313303af2d303b964f1774f5f799d763f600fafee74b18faf13885b32942e20e2091628ba1538d719a5486b5f4cb1595a55f43e33ffeced989f6cc7d5c6296446054233aa62a95b1f8b9c95eea4be6a889616411ebf087f0e4fe2e6a3021a9ce160dc1c05907e09d3132c6a6315584aa86c74dc30776596bd39e6c21d2f8ddbd84d51bd77350b9d8f99cdf9b3065d9491036971d34c1e7889ae1798750baaa824e98198cb2aa46173e7bb90dbfacaa7702077fff3b92508bb55593ff4e32250dba6ca6e529375fa0f48369fb80aca72fc22f52f929b0284b761a4872dbc80df26f90c86b3bc6b38ec52b42877b3a803415714fdaf78a0aba53d3e2812319470f648853b9c5f0d1e97272ef9bc61a64c3e783f5c7f23eda3482e23a6f3008c3e32c70eb54c61a6d1ee5d8380acda97e395984a1788477bbba998e3cb69e0c9a75b417453b51a0a1bd87c9b4e31dccf10e472fb69f66e8c40b0da49bd14ffd93c7e3914c5d993b7e16e5a782e03508c2d6b04f15aff17423061f9d6fafe042af0a9ae2e395f2b12526b1003a89dbd79538a4a6a1fe7f95b8f0e26c35fb09a1b85d450c851465008389cf9e72f24cb2a2c0001a8fe5ad2a6e25810aee9953d34418afc17b06de19cf6206848a32d5897e9cc7cbaf3e93c35b3e6615e4ef83913447e7a3e831deb3762636cacec557d64002b07dd63e1940e5458a0943d86724b844c567bb80e389b0a3e84fb8dfa2e13472aebd7499d539ff5f7b9894de364f8f227cdd5da9fe58e4f8c712a19a09f6633341a9e6cdfa667c3a561b2a804600ba4ebd97c42feab1f58febb52d6bed4555849af0906b1879096c5d8147b787c64b795aa6d505a8328e1151e8975e788f5146374f932e6791e8c0e3d1429e3c74f93fe2fa4cfe20842df7f9504feee9b55bfe63cea29ef1449976b163d706823934aaa229b5585030b248474584f46e54a6abdaaf9166e885cd7229807a8f010f0741fb2b252b87f09d037c80c85110262d00e6c71d0d7f5bf30437a9290d4f1c03805e37b45f8161a65d3ee8a5cd9a1de3bce24e765b7e39dd65aa4a43805eac2f56b64fd8ec1c1d34790adc0446776d1606201335085165567b85b51b20c9b757639275b48d7ffb2afb344885b5dbf40b5ca3f172ea093e6e56201e95405832b7adade80c83feae2436010ceeffa161d2f0a6dbc8d35bf348a33e26f3ff7462faf27f42567a37dee8de0a5ea4ffbe4e39fdfe6322e3a54ac82f8c632aab4c554564ec5aa9672563d26197c6fc9d739c6a8b7067ebce072e935d613094141a74d8ffbbb14c8999ed50f8f52a7cf84488d96459a8986e3b3bd503d6a4811473959bb1d322e337189fff7608328f689ebeb1723a264cf74db8db40717dd5e9659f0fbe84346935d435c70f9ad08e20d11fb8054f64fec3c0e222d92302bbfeeb80fe86e0f9b1b77a96e94c748d1857f82cc9827d33c3b742f647fc8dbe9186350ed2217a1f9aada55d80a59b75b7d174643680a0c975aed07a9f8b6b6a428022d3c4b8b693e551457a2c979857479df3faf28d68d0e69cd1673a3b46f59a50551d6cba1d197048040f307e556e7b491498d4890304ca3e7399a2b4b66d971f1b7d3704f4b8ddb16cd0f90a21878e34cfaf86946a3b3a17360b8d7b9b2adaa4f8b72d488ae539dc9e45a39ba81bd3a951f7d7c7ae0120ebfd24494545eb6a11d2f96dcd13339b419fc3cd97f4eadd19c694c6ea48b1dec6df928f72168534822e86e5d90a3e49fbe107a80417c3eb829009aeaee8a5a881e8a349dcbe2ce9705f76c3d82026a60311c0b8c15fe300a585944c6d50ccfb1b8a7ed17aba1f5eb9baebaa1e1810127613901248264181e98a5b12241827dddb70f3c39ded27f2f512a80effd225f209ee57e90fdc34160c362ed0ad2a3ec616cabcd617c561effbd9b1b020f2c1d94943b9c0b15f8703c000d6b17e5016a9057b151854a294c44e790c79a3613380b75fa365a2863a4efac4e4fb5562670a86e62cc68922f0a6298dc333a32db39ea6846ed670c71db3f562c8c61311d78681d0f5be03aae54d22345dc06b49c0509afd9ad941c5ebb7ec826f7a7ac867bd628a16fa95d9dba84bf51fe687807caa21758008fd263a1fc6ebc980b9482be7eee76eca486fd694967347b7aefaeb35c55abb4ec0d7beaceba44428f99fcd08126eae59315c5ab55259e877dd23ce1cebe92e54a0710b83b5cb8d1172d6c020036f025dc591bb17f45be62284ded79e9000aebbd71afad55d785ae694c656d4d4524cb2beab708e66f51c3a170f6d0f24b38283336b413e230a0f14acd2b6ac177a64e86217fb97fbe9fb109f2e86c4ed803d3c32c5baa1b6d7c6eae4e7b696cca0c4133137926757ad381ca091ac5460443b15893abd6c2c2514cb4ab242dfa83f4043655c473095ea4a1db04734c1c9a18277a053221dbbaab4ae39a2a05f88f47a41e1e3868a62f6caf2f0f484b72e5013b08bdf0f6b7d484ac81c35f0ee05bef1a00de0d91dcbfbd039c743d22cfc2bb947d482ea6d5dc70d11a5cfe7e71d171678c5c407e153cff87b88666e5ad48b0d049aafb4749db62826704dd578ccf5bf06f4759e538ee5d226b84350daab2aa94a86f830a73243cf5a301f80b842e758182d9f2de792b9577169fd73d38c3fa3ee1b6cdb783120139154c1ed2203cbdec379adc7019daecd29b32f9f8d8457740e2528324135ba96edf85538e1115a4bdff3e12a79abc344aa45113f766d9a437d8c7b963428090bc61efbb7c8624ca0d159fff96193cd725101cbe59d1d51681ffa30b4a7321512a0d96f423bec4dfeb612ab00cee6df5e4c3e3d6e0623191e20855eb6c0de7690b46d83494e06f018de45024f1cd5db2d8b8a70e97dfa1e37c42d47eab8c2a04838aad05d4052fdde96950e141f68f4846882762b92d77e292f69ca73885a8be82a4489987025dc518f53d9770b73cebaca6b9e149f477fa6de2fb5166f7ffeddddb1ff6a383b4504474fa7f1c19b371465561de7397545a6c2e665af24ee69362859eaea149bebf93187fd55b680daf3bc02e923e99983bb3f3d056ab53c37cf69da913b8d90e8dafdb6bfeaf8c8dab1f51409ac1b300a73995acf13a79c7c272bafd802d157e03ef6eedd93ea7359a9b0169cfdf56aafd0dc8d8241f0318b45987c46478c0e6e128ca533209dfb1e33231660014bdacc760f29bb4a6b35f0a9e4cde3c6e37712ef303b06b84901e3a7f5f37f241069f48b349520801482b242a9d9162702e820f06f253c12fed78e7bc1a2146dc9c76b6fd6003750d0a141b42de093afa90df14180d3e4dfd6e8acf31b52613b5cdd2ab7f73f9287cd24e610d5cf645db4c74a2daf8b8882e1e9cb6e7f29743062ce00b10f4c57231a0efb041449d83f0dd4a28abd327650163f888be8ff538171cb5e666280fab457d4a16cf33e0899105d954698819e84005bd8728a0ec9ed77dabe5e103176cb7e673b452f107fbe8c49e7423dbc31364b485096d5a56189a7ad206a031ee3fce940424b998e7e88c6d884ccb21c56caccc3c5ab79117a94b4624a518728ec347ad287aef5cad1a311979cc2eec8ca93b42a8bad9928d8b960f5038f4f13688ef4e7f6fe32249ffc509e592677660ab8d0d3b8b3da1f0e4f7ea0ae51216853e5248bc2907c07d3d714e6ef030077095ffbd12110846f56f09e3f6186687e6675c1293f859c4671d324faddd87e851dc76f6f92a8f90e3d1122ce8b7f5bdef8182399c554cfd416fc6ec78ea9fae00a71c56dc1a9eaa9ba917de791815e6fd84892f20ea36b436815056e7bd5478dc80848f13ee4341e9460453adb06c2b16ed59c039aa29d7ce576308593c52e79af6f2599a3d9a7a51b3d0e4dc137db8de55bcd1a6670f493092ba414e3d7eb82cd095f8d68bdcaba2a6cb3ead57361124eac728d9aec0793a505e5250fb0009b9120b1dc9b5f4327cfb2e0cfad5c65f745a586d7de8c3256036e8cf59a84360c1778bcc4bf552f425bc772a5e59cb3ba62f6ff8c16ae5980fadf75c2f1a289f2297b199fd9e68b3c4778d905694c4f517e15bee8f4218ac53abba01f26a15ef4badfe11f7fae984845aedc9148cc1c65dc9a540571794b654194e920ebfe670d2e8becacb289ca68f0bd63a9c9f39d2ba4679b1a76b52b9d5e044f222455b88caf77b940f4e1944e60aeefe30ec0f50c10c8ba60a5ed6dc9f0f9d2e5c25daef77ac329676922327ab116e4eb6dc7d2f86f0b41d49ba043044cfcd7e0be135fdf1803a3d5f3d1451bbcbc7d195e844917cff5f11453560e589dcbcfe5dc21d1824c819919dbc86bf7e8bb30db360653c2f27260e896855cf60de67d8638ef47f2f768aceccce93d57a56235ea1d79e6e30327160718fa8f9573df7104a334fc571c19e683f6b5daf2c5aa7a60ff28ba3c3f0e64d7cd105c4bbd3fb82d59ce8f6933c3019aeded5be9375b730e0d871c615d13feb6b3b74df7a85367e1878fd61d86a352ed990212e322a0d6364d2b44ba00969dfea6ba7e5d4cd7e21264c02cf8ed531c5f5a8d698b011b5d9b4bdc44dd38d9dea7e44984ea7d53a13fc5b1a1e8efc2be20b984f0b113d0eab25a55313ad14e9a612f64d8a68423cd02e104ea52b8076c8ee5714d3b705eccf37bc7be96b43dcbde094c667bc2ce79f9d3e688e9933859d09ae9afc78fd550c51b78af5cba08db7e0677b04ee8c1db988216b3c79b91dcf544ea3c37c34b3259a7cba1dc72307282fb5d218b49219286368c834eb0e99dc1fe4c4ad620dc290a6ab02e64331fd299eb125b1c3c1271d5548b02a5aa15cb52a8af37ba4185e4a8e21266875c28f3e2950aa191226aeb29cdb443f60491367766a3a6199b9bb7d2de0ee8bfe36c1e1bde0ab6b04d0908df5d26982082416ac47bee0cd7d35473b9d7ef9e7d880f6e2ff4366831ec47205aad8e7e6f657ead1d237b1e8ea96c1893e815ed7493a05c1dd1c7a901b3e11db6927a78d9ba4b67fbcd673b2348cfbb2186ccf165f8ecb98ee97b7149316fe74acf86781058cf3b87174081be4dea47cd8ece060628a01872fc9476574f6cd81e3ecc7fa611c7810eb7f9f8977b7d65040d143f428b1882908067e8453b9d5638fd27c5a3825f71dc2e54faaeac55ef6624231bfc124a62bf369a2036bf054a7fc279d7899781b1fc6996e46806a827fd8ee78f4f58ba4dc92c81f6ca89c555d4dc277e1bdc0a1036fd49d32d9accc71bdf1e8c01f3527c271fd52caf8011852dacb901c27124577d48cbbc749209361334af8d85d38a479b7c1703a47181aa893107bcacca2b1f0626df9e88aa97684c6e752b42571c52730833ceddf02e9cd6de46aaee671ba0b7eb6b523b9697bbbf0851027e9242d32735d4bf6c50d24e9979edadd03ff1b3db9510224de8a079934d8816a7094ba1db47006e035fe19014e44f98a32fb0764742930a195e6dc956ca1576a358615a53fb02aaa1372e959896df79f04ded901eefcb76095e90e650ffa195212c273d36e935dad9195e5acf2df2c7a6f1741b43abdf20a052731dc59b6cee7b81671b7441edf733c87c909fe5b41115c8f6a0cc639e2ad5768fa35534406c82e47ad1110c4f0ccc11d1683aef85bcb1e59f2902aa1421a0d8392937c93fa97a3a20f0458f27c181dad010ec9f0e9474807280921accaf078e290a40d1b7442083dbf38b04fd5852305be3d45502dbb168b0770817f3081e9b556b64439edd41802eadcf2d2a808590fde70464a953254f1d98bf1080323df0d260ca4398c8aaad4bc7450ac5225e3848feecd48432e34a11d2a02300672b170fd45213d5743b669852ed50547a73370b19a0504d0e6fc1a25c4408b4ba50930e7f588ff2f7685267f1117478b3a95f88abc08f1388df1d785ea100c40667af0ad9a3c405901484d2868ef189840647b4a9315fb2d6e1b7dbaf6c7c07802b378e022d0e108cbd9be59aa24a18a31babdd907e1f7c2eeabeadabd2b1806dec4d397cf2ff84378fc8119ecf60104ecc2a4b60b43f307c4419f1f59bf5404ec16bbce7337932797607cb2e3fd9f54a2fc9a26fc846b6ba7edde6fff20a9f0bb55c8b630a26ff423fe90f8da28737ca3bea9eaf69a4fa67d086e001f4e20d3e06913deeed87495a00c24a1a3e4fb90b4d0a4a365cc64b748bd907fb9969cdcb4b6304591201e09d5c14d486ae511e430420a302b712ae1cc3100e55b869b0cbc3fb4eb26410e1df9c38b2e98ad67c3ac1e7e0d650b1aa894a22cce171906ec0cf79b5884da38b156c683ed49b66bf012aa9a1362cb94dcc4b1104b8ae22eb7138350adf3b95a73382a2bb0c251c293e739b19384ff0f0f6f34c7b05e818f25ce805803902551a32e1a3f1351765180a9976b53d3a7f60485428fa7a8cada0caa32670ef99c558f160ed90e450a03f3b73f68d475b42c30c34a0318925c1a4b2f17af9040617baa9e1a6ff82435c11cf7466a581490d45909a595873b2845fb42cd4b5cc9ad491caf0cd4da981b784904acbed24b0f099022db2e3b3595b76bbada4cf984a00b2ef2c0f2a0a5031f3cec3e0982dc0b5b92a0e95e1d09acf5bd8324be36d630b00ec9baa18f97e7a2e463dbee193da5bcc4fcab444f698e964ea644aa88e5bd718fdf3e50d331f93a2e02bccba53b9acf79b388020e31cae97d81f7f840449060b0ac79fdb5c6a43e99ed2a5fef10967ef8a6877c48783deee97b86fea89668f26811d244b144afb1fe768ea7d3fd1c1bf53e0913b5042a1659d4bb982d9d7b3cbb4eba15efd9d3c857168b1cfdf67831ce695b56287f2499fe4392b317fb10523769f35e58fb729e5a38a1f256c2bec0249b72051ac69311acba5e79ffae9a6d196b4a98b14e7043c74939d4820b8162bcc555e1a31a24a61ea35252a960b21d7ddc96547792145989abf0ab3ab6e9fbc5dce9221a8da6a326e753e70bd38c3b42fb1bfac3115ea3d3fa0c08ceac2dad34f21d692212a7a9b2a2f136b94bd9524576847cf4e5939e51fe341ab7dd7503602d125a106fbf615b34c37e2f39e1bb40afd32b8e3bcc8802c6d4ce91a58062eee2792963fa2b20dc6e9ed1965a563f08bcdd4a57a04711682f3c82f2b4401cfa96d489b8e20c4f843e0f3a0b8ee725b0390ee8300547fbda4efcad37fb9422476063f288ff8f8ee7c25fdd63a68082ae055c51cd0362fee05277f984d43fd8351f777df4fccb0100691533933018c3e6d2381b32e714fb7c7faef10d3f239b7249a2b56e312bab1830988cd3ae043831f1664e21b438d3a35f2e4df0f3dd7ff8c57c91402939d62aa51c785297ea1a919e0d2acb832d3f6cea5c68b00d381152165b94682db5b57204ff5c553d085b4053d4bb93620fbe3d1536c1ff963f57cb7454047471c9b0ee2e8a4ea3463bbe9b12165c39e851f6eb3e7e29d8cd698ecfeb435f268da8b4ef36aa3c8def3337810ca62d61b1ed831f34023f71adc8796964edb70d28b56f1fc6bda8c830a760fe7232ce10a323802086b8cb7c7fb9aaa4cbe2194cb244669ef3c179924f662e4bc9fd874d8d109e0a2878ede16f7c7658ed8898f8232f517ed741cef43c1503c4cb8951194e3b3da7b36fa2652194250161c2adb33da9600b0d770b6f0c5740e9f4444c704b711dfe2ddc09e982e6e6083f8e3e5841f31892efb49f6b69945641b4e6bd69cab7aa436a093a794a568ae0111713a5a4cbfb38d224af050752a70475f393c3265ad823759a56bf8dab7df52bc9f6efee35c770619611645137e18083d6b3611d30ddda920c5c4164ac414e97e25132fb83c0341dae8725b3ff2d2db58522f3d16829d617cb90cd7ce87bc3eea0c57fa86149e7cf26ccd81e7fa09768bc2c54af330844aa950fd78e21f151873b470ee8a0ce76080d076afeac44acc5bbe1dc3869d0400d74d434b1a0996fa4c2e01110ea81da5e87324070dfced70a48ff35f1cb8112db97fd71e6a2208f1b61f752f93054d2ea9aa8f54dd50480e27d1c775ec7310846c494f5c0da67178bfb3bbdcd581d8718687db53e2fb73647495151b384b88283515880f2eecd9625dc21f5401c43d1719301f18f0018e7d4b5fe83fea4f11ca76cf2e8ac651dd231d959d62d3d90ddd3f60f93c18764bcb8e5e9140f01019f20c6432f8846512143c4b00dc12d494817cdf2a6072afd59a4f00cc884da45e3c407ab4d1a73f38abe5621538d3ca11e6c7b6b49187e1f2699dfa77619dffd6c6bd753dab6b71f140e9690e4a169175f04177af89b3462a68c54e8fe308598bc7e95172c5cb18208117c7f2cc392496f7af458907440c0348721b6b97d57b247d2d78add4e1c65ac3c3d78f8bc66e2d727671baed932d6b49e0af489789d0e9d363452ffdd47c9cdffb739944e4e2800ca84de1e603216d70960a522abdca8e7f0733377ff25bf78d501969587df2310b8e530b63c950bbd38ae968a0964377d188660e24b3b32b2eeee414030c9edf2bd4f037e2d1c448be47dd12280e81adbbca83ffb39627e0c130cf1412dea85e7314a567971c87245146dcee23e5521b9fa385f2d84ec2437a306541318104d1c49e755bcdc89833386fcf672c53b21b75bf337a33016d8f2a99df19ff953accace185d310815bf16ad4fe741a855fad1f1001c3247c92294df002c59fc890818a319e1a1f9413e94ff0a8246c4e9efc06528948be6c5383536d038bde3c2ba8012c64a588444f977018d54e0706a80335da9fd309bec2281033166cb413c6792039fbbaefc185b8ac4e300c506db4adcf9e9f5bd42179e8f89f3c11e9d35db8ac89d8aa701c771532084891bef87c82e5c03d8d7a20168425820d61c64027ef172ea7efc4abe2ad401f981a69e4a44ac27a2647e87962a32e859dd110b6fe7dd670e2d8f73412c0a4d2ec456be0ce9fbcfa3ca660c8901b4bd85b30d498712c01522e23ea58c7173f5a6a9973abc22799ca193295082d06e3b081c503a763dd9956254c0cd8e0970db636f6e4614f7d01e62687df94f3a3821c979bb5e4ee5619f5a79b8a60ce6ecafd1824ec29723d7c2bbf26d6b1592212eef9b00a67aee2d4838dfe41f48e54ccd7369c8914de073913cce3af92f23df95329adb65d1aecb62b18feebde3ecf371855507349524e98d904f71fe6193189bc6be3491726b9663c5fcab07c3790372f2ac08a1ceb0ebe280b63f9d268d56dbfc62a05a10468c935f33921c33aa1df82b5ec5e6c512284e9365fa64e7da617b73615f108344c10ac4b49e7725d1ba670acf83a48ba950e7be4ecf74bffabc229ff78e96ac02acf2ac1e0c0da30d8ed18f1cd4d2e19c4cf2d46e1a441d5d94a369c55105a4b9644ceb0e219355090c5afcfb4aa60ca8db4b74ecfb0c05fe6cdb726a2c6acf9eace212813a6eb3f41aaa896705fff0bf39749ac35bfdc50ee06cced75353f9d231d32577df8114d39abfb43d742a4dd085d937732eb4340d21889de45a42d5756450ba945ca38bc7606361ce066e913fb574b660d20e11205a4f62a73259125afc3e2bd67f8d596f6162363a43eaa5c4631e7a5ccb96f3f115f862769e049b566631861c5efb45d5d147937d085943831200d4275de1d4d1c6fe0ba3527784f961fccc37114de5d07b922edeac30c1344e82c5aa4cbbd0feac62ca7a507fb14789ff96430f4dd7badd9623016986ffdc3232dc4b529558b680940c178b2e140a5f2bd33e38f65a1a30b7d9dfd3db36ca7af19e1280a7899519b6e953ccf491dc22d8de8d9a61bca259604bfb5e8b88648a374024f53cf01026c48206ee40d156e41bc9fa58ce4ff8ac0cfe6f5f8168b0d8e7891be52e87599c3d9a6e614277c50aed07b1ae9d4af9fcc1e9e0822e83d55bf0bbb4bda23124a9a343eaecd8e634664e8ffde9175ef8ac448df781efa91b8f7365627ae96a7ae86489e1f313e18b28094199a079ef95e1f2de8a9098ff8ae36436857c1a41782a8e54e39939bd98e7029dffbc8750fdd4a2d2f803910d5cbd21746f307cf3952ba363ac9754b4d70a207636bf639605078c1166a2b18c3a749065952904a320632e9bf0012f2dc963367857dd381af722b932fe1e740633ac6bf78210a24c671a1b042ab2e0ad0e6b5d0c1f1e5b49b11097598f965ad7796e7da4d4e9cd908c0d6b49dcd51425e5f4bed86b5d08b568aa6e0c11aa67c17206dc85d1bc4dbffd0512eb3b594adb1e14f7b7227fc5546a471ab9f65a34584d688c287669ee633cfb50ba3dc2d89e38882d65d00b450b9ea01c4b55d7a788461933e667b40e52ab327ba5702482463d8ffa827bd2db4b433b2935847abc7404d2636eb4c8ab388bb069e205a3356d3d77abe650139d62db02e75bd81c45f9aa3b97f23fea564eda37d7a1a68d55796ee8c733c3668346498b52394348a156503422d0536dd0e618ce1d7acf27f322a55ec72de6c29113ae150ce9dd7c4de57f1052d6f130bd8f936432849b2f13b2e65807703279a7f12d8fc11833df97b919b52a5ba1f63b3a88fc5df9972cacb64c6c1dabfc430f9daef58dd5ba23fabdbb0230df8124de28631d1c39417f454e465fc04353a68416fca97334b2295444bf771371212a09cfc6809be77fbb433edcf9a534fd4c8fb556b8480a856cb86ee4136a256b9117fe533b4b8a93d272c353444f5d8865b7d5c8e5aa7f474a2a206d2515f1b069ecd0a7c7306437a798acdfa027e484b630d88c53f528c6e4bf20c90bd5bf88638f31ef98c126015482bc50afc40342918adb2f65b5f4648dbe94f01e29195f13e66419816f8e69fe8e1f7a96351e7f006506e1d542b624045878a01564d8c0302564392151533fa778e6463b159e1c65727fd5c799ffcfff909b99f557fa5c73b1ebc9838b4ee2ee9fa64d4bbfef73fa547e07debd3ed2ed0ada83efdf432b8fb90449472ba70c066c4509aa64448eafc8ecf9a3c6dd99a8be85c72973b06b02dd3ac0b0e7acaae82e22d286e6bf82654a3abbe89ce45b98ecc56f1ca194daed8e2dce932e892bdca4966d310453823f4eafc99c2fc7fbf0a4444f6d0d4e3548f563dc11a19068373fa9bd9b8282867a36742aece0949be1361dd4b8a259eeef0da1fda9b2148d12fc2c9319f11d2e7ad0d0f3d4982d2d4ed270f81f7f2ccf7c125026f439ec3c891922f75fccba9ebb4511aa35856e2f15c00bf6059d87195c450a545f74c0b15270dbcd74682a2edd06193e302da56ee960cab6f3db4b078c23319ba08f5a6342afd078a2d810d04b6f847869e400523e008d3b31cedd0f03bf3652b874308eeba80d39e81693ede197e03d390a439b1b5cc0d94833af5d062c3b0a9e071d4eedb656a657e96fa576bfb8abc35fe089d7021d2ed47b5df04686298f0a8c02fd541a92d14dc8856709edd1bb1742f3122a2dca3b2fbc63232e71c2449837535f973b5777da140a644fb7cebedb13d1d257cfd1863247947f231112539519ac6240bf2a651feb32ea5029daf25dc775239115e498f165e132e799b39b3c3811023ec5af5bd5931d00fe5fa69144bab4eaa9b5d351b044692e9703b3dd6597b6b676e7a70c2d8aa357a6e60df2e6cc39c28547103542ac6f886912f4822db25343f747924c8f14e46fdee6d639e5124461ef38a8b5ec92452d7ab4ffc3bf3bde9ca0504a40defcf46012869f4af566b428b20099913b0fdd8cdaecfc0f3ffede2a694f37dbca7c0ec948f37fb6dbca82840f0e011e056f5a20fadd8abec2ae2746f507e9925d02175006630131753331724c55b07a87bd4576bfee24c01e46c949b4ee6a93812679deda73b8de153cace3b80afe4747274853177ca81c762d642b80a883362fd5e578652ae294644822f03058d6c7dc3d4a8fbd139bddaef5d32ac137f334c02df353d96b11d45bca4b6d83a4729eb9088476b332396d1156798ee27194abf8613289acc63a2237dcabe5f699b135ac933918b7b0ef4222fcd3010a0516788fda6ae4d894ba145f7c353ea3c1b79c2d5dc75808e8fead209b2885103f74ddd4c2d3efa9ea0c6ba95c03b6994f85523cdcb38159d999060b5db063eba97040b82b62d3e903de3f8700e535baf7a9bced9b40e8c5df34d5c7cbd404c876124ac220e2067de811236b18d4cc9e25d166588d01aa0dedf15ecb2c362d303f8827f1515a496334d4177205f45d85ce6aec009e8047413c6b3ad5b2324bdaf58a7086d64804b912bf69162128d8eccbd2eb9f08a635611d75daaa77789afcd3a6714912101203f403d9cf4d9d467b135086dfa3872f248fca1c2f2c72ed05730fcbb047d65c7e631fd86cfa8b54d5831142c1c07c19981be2f6c43db415b4970f7f8ec75001fb82b5d017530d3974b3fdf46617cf7039514b0c2c5b8352942a6bef7a6c0fc9e9c522b82d49bd40dc3d7e9509736e36f943d0eba367ef2718d344c4b471ed1ded8b8acfccb1417741b65c7a809ba8cbe9d1773c089dd3047b76f9b6f1bf168949d248b3e3362d58448a37879b721b3431b50972959dc82035caf9283e44360c7b4f13c6327bd1992fffecae35e69ece2afae20b2980868544bfa177c889ef044754319a4b6e974640d07c45f956d6d73ddd577fad19db8b75196af88c97ae7be20fad71da69b6297a07c82dfd32024105ef3a88781d2283a4aff1c2b6501426e20f79fdafe1b77c74a8b5a532ce478a0d06950fe0be72ebcd7c5415555c9f90988152505d88644e8039502d7afdbbfaba00838cee90d42dec595edbd6d54fb2fc3c775db1cfd0f7060d695e99bebfe4b5e9f7cba6c5ffb1492a58fcc75b60578f6951e0a4f2252e3ce19d58a8ac1abb4eaadde97ddcf7aacf2881fe3c306f338c315ba0e15c1b9d869fb137dc07eac37d5dd7df5ebb08c0db1cb84a8fca7b7211db3f9103f0809353ed5560c5c0446e77e027aa97caa06ed9eabf4ea4a7ff9a51d0379d8d48807d5efa7273647d7a08d41abe6fce7cceaaa2e4db3976b13f326fd20177798d93ec7c92458d69986a98fe5e23d126accb1c415f83144cd59d586ffc2b3c1a57aac34e70895dc596032f2f667a567f022cf4985d67f041ef44a936f84d234459287479e9fea8aa3bf5593b8bc099ce8fc82e1d263b5272603b53003906b5566245d830eb01a95656088455bafdfe718f902a7d30f453233dc0c911ff71e86ae7b9377b5fac03cf213c241b724a968a9164ac241e719e82355faa6d7a8609ee7d9fef3ee4dddfdda804faf5f86c0bb017d2363590f52e2eabf56e88306c2e86e4b42a104f0b05e73b538bbafa31f7ead0cbee1fac1c3a9c313571d54102988dcfa98cf1285067e0d9202041d5a9e452b1402084a0eeb03bd46f68dd16bcb358ac2744d6d7d68619b8df4db9d77f465685771d7350c507f5927ae199761d2a6fc1bdecf3e012462adefa236a8d88977459da8b3118dfb930797a2923a48a607e424c4a9633e331251bcc39e6847fc2b9befe8522096b454dea000dc3926f74c40e81aa985f7afbf08aa7360b1e5eaaf2606e7404a3672e93d7e757bd2cdc039cf773486a0c71ec30c09ec79c9e7c03e23bf9bf305365777c1bbba146b2d2355a5a13c02df44614be5dbd62a7c570d66634ec18d318e2d8c631405a7a5963d8dfc29c78daa79ff2bb802fc76f748423a949a956467d2deb038e5d02004bad8e2b47c30cf096850bd19b8b1242507a82169ddb621ae496367f85f92374e6f4c7cde9bf10742a78c7aad6c5060cbcc1c922113fa3bb0a2c3411eff96150670fb56bacadcaa2118497db388eb464b0046627ff4606062c3223ef0e8d932665b9862fd34c2edc14a44c2ccd936a34f2f9774804597e1c7166be49033731ea105e84ee7e29060d9598ea5fd73bd72f62da303a5fb14238d351fb2cb2910f1007c79ec9913b663636491a31a651b6bf56ba63dba8171788dca1433377a7d09141a4af63467856e7141a3cc3b85d0a35fa4e9b8456eb0ed6caec43ec061685c3d3083842a953c13ebb7e8c1802512d139c6798646b11b4c9d5b5d4641d58783db55e861af1b320382e7f74343edc5bd74bda9baa16ac08e8a70787363a1d26ed667ecda246dd7a75052c2182ea78773310bb5b3e0d2bdffd10179ac5e94570385990b7a3147e83f86ba39246308b3971493ba1d467b42144017462e9d3fb79129086a3a847d5ff482b137cccfc12cc99525acaa33e1f89c87e84c92d7ccbbb39f2098c5010a4927a10d548fb816c259cbf86e8c706b33d98ea94d6b8f97ae04577038a3d659c4d54a8d803b2f4413c6815c8419c10dd5d8710dafd79adfce715a9880254c5ba4b26360bd0c6598a96bbb9353df4839224fd78198c816c1274407a5f1b74d3e346c8f07e4a9306be7eaeb073dd7586537c933aa470c8ae7550d8171353446ad437cf4d5666a6442f77a0059ab8b61d17b0ba357b0773bbc430945710e155940a4b0332a97a134c7031854ce29736cbd7ecfbad5aa393e3ea59becc8d20a02cb245ce99ea2e44bde1ee5459b9e36144821c6ccabb8cab89763ae73e3ad37843742bbb6d7f2eeaaa203942ae805b6463cb46f8781a5542b7e7040bcbee8e39931b11ac34612338de23fe7559ed79517ab378d93aaa5e5be28d29893ef703b1305065c6c8ba876752061bb49ff1463e4bb4a66796f9137da8a574839b2c2b82cacbe38a6fdb300a4e3f96d4467c3e667446654ed5b575be4f6254e9d9ffea12d4c0b2bee21ed0d933640e138b5fb8bd3081c9b1e021e74bf8fe3da00c183004b17a46f594f85c7cff64b89d3f696cd08bb26cbc9716dae153ce078c7aff820e879ebf8e1752785e250e7cb1dd2aab1bc1d32492b755c5044ba881bd68aa6652ff3a1a5c3c13a5b16ce690be772494da645688eb0cbd5fa3262b39480d0beee7f8ee9dc8ee998343ee5fb58fa454d3fb58d6c5d0bc91740bca43271b7bef90771b283a23312469a59597058c54c851c372daf74fba1536ec575a32e4a840266940446b82fe70cb8c6ea7726d87c42c944f965e047efaa87b1613548b20b1c3d8819317c4301211fec237fab30c8131aea6da5a746da157b6a31d27ba1a9998c20c7a17f98469477e80bc32a5ebb110f5c1ee35597de8bccbfea944080a8dda60d3e04320873c089de36211715148ddb711095754fa658c019abd1ed7e9ab3f3620817ebf979117ad875d536f4486a881828459cd05d4118db5d4d920e24a828deab1bcdd44a910965668b79f86619ed79611f5bf2948bd9dc0b44c105279541052ec7c76b8a855b8b59e717a5aefd34d8be5955a5ffad211919bf49e56113facbb569181c24f0f8c80b642f4e318c1eb180719ce7a486538d93341fc9054bce02125252420a714a35f76d0189590425409b960c34bf33296b4f3e9d3cb4f1766fb2bf1faae90b06900cabaca5422338b3f4b3e6029c1658812d1691e541d44f972a4882419d4a01f0c7328c077bb8f09f4fdc2314a6e29dd6507660bb8fb54e165b813c63e86642ea7e5b77dee235d2665bbefe7e9af8943958d0cb1473f4cdc2e21f14a2eaf57b086bb0624a09b500cc352e37e54aa57bc2b6f3ad028c692e3630c0301e35b4d2fc87e7476bc29781eae738cf753a8b55847d0c4e960ab7c5cb6a29b672bcbeb1dc1ab220126befcb53f5d1e6191944e6c37196f70bb7db575951dcc7987238940e4e6afbe66d18599aa1d9ba6deb7973f0d171267c58a45eeb7b6a04e4ec90635e03eba74924963f18df0868ad343af659b6b09900cab94039531908e18d14b08b04baa50ca2a0fa816cc51f56ecb4f0ced633b83acb2c11987ce0cecc442bbaf8bef1c07e79207aae64827226fa28a5de31</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>æŠ€æœ¯/åšå®¢</category>
      </categories>
  </entry>
</search>
