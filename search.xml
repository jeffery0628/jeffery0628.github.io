<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>过去、现在、未来</title>
    <url>/2020/03/20/past-present-future/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">请输入密码以阅读这篇私密文章。</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="6f4e3df6304fa045dbe732f35aeca22f66b1fadeb40764fe46213fbe78dafe89">56e7118cb91cb57efe73888c23093e729f419eecdeccbf7727e2f4e8353c778c85a615fda438e8e4b97764d9746602fbb748080c761037a92d129bf1207fe230e5a4474e76fd6816b23483f9ec1d4d052e77db84672c6e034985b68e9d77bee270c2f6f15ca159ab26d6e1a7a682a77c99a11e413191fd870b2bde9e7de35ff7064e0d84bba08e70054cf16586b6ae003935f4385f2aa7a84b6f0b38ef664ece7e92c2458ec76780ee3c28fe9726497a7dde4cf41a3d74a9faaf1bae7977ac96a11794c9ecff23831171ab84447931cbe0571f2d2fd9b5374585773c34257dec78710d4e4f77af774b1a36816f05003b4a3ac7617e0f5637a2c1a28b3673567a0626c240289ff666f14acf7b4cc56623f3c0d7744dd43c2ba0043be4b2c72e4305628b34bf3354901ee77d07e7d43d4c7f246b3a6cb71727e7ce576a4e78a0afd694a58918b25f37ef676788445fa293efb892c45322392f33ebf2b9761f973a4fc1b154e9f60faf5754940e7b19f929f082cf76271f938cd56212a6dc503f2bb5b1c5704c254c6199be20681158dbeed70ae9a92fd809aa20e2da801db091f8cd44064c96b2280b4cfa8c010b897cb06f39369be045a283a12e1afeb8a40b7e3b71783eda82741d661cafd86101be4c81059f6f6e3cde754f518b7b45dd28c56a8434cbb1fb45e39aa1e658cfb97b6516f52c463a48f291567ccf186653f381a1785f716f4f8ff0a3a42085f964fab822f3e56bea8ca21694402edd7e46f8b62c274ebd22b91a90468baf6b75cd56272e29978839d776a61207829d991aac4b3cd621e8fe1ed03cb67354dc8424076efbdd95d4f6f2183644e62dede9605fde15166006af8b063cd4bdd6389fb2ef5f7ff9df6f2f51fe39dba9e185288dab15de83622a5aa3d45c4fe2d20526122a3021bc16581a095fd5c79f691b055dec89940beaedb974f416ff8c05d06da288a5f1b4fa4c5eea41b33872105191ee9914c9bd320cf0ac860ad3aca3fff5eadf3c408dc102468d2f32bef63b7a437cf0cff76d74b0ce6065bb33b06359b1af41004b1e7162f48cfbe37447f12b7ee7d92aafff945d5002bbc60c86b8d085c1bf779efb1add9bc66ee8127a2773d89ca5c0a21ec7b2a3b437fea6a11ba55d386c3bc7b322f9383864ce6953208668b173b8e58702a331d43fdb6c159e65baaaf2e76ebab45346ca6bea2454edcb5e14e5e2e0bdcbb4b79bf36b354f804fcac1b8fa05c71824de9b0e3fc9a9d00ba05d0c9b7d3a58a1d699c80a29ae3846408abce34b4eb9a014bf3c255203491698604e3c54c43ff3ae60f0796b96cdd9b31071ca8d01043bbcc2dcf3bbb2fd6617c659a6d6ba7f794d23ba155b92d7bbe74b8ad4ea3be525c98ae68b30798605ba3ad350924ddab19d7f18d24a18544f18b41b8c8f1162edb3b1c7759edd8baf4533badcb98c8d3df3d06123e7ba47e76c25de2ca886c6809cda4a79153170cee1bfbcd6fa575f2361e311c7e60e5211c936b18a9dbea2584f1aade45e044fbdbe12a2a0a92def8da51cd8a72fd2f01e8f8694aa8a62b61ba092c2e21f7f754cda4be7d177c171bd7e88e66ee9908a7b53f8efd75e75e6ce2b3a79a3ab9acf8e3cc2562300ccfb154b8661a66dc1a6d758d62d9b6793a7a97f2007bcbacef53e226c66cf27c8ad394566e4c80616261686899054f6fe9b6786bb174ba716d370abb2c1ecfa60cc3c65591eab29d235cbe06deb6ff06f134f0f5383c66547af321507543189ddab842129ab65d3b6a8dc033a4c0d245d9678584f61eac9a1647f5e175ce36fab6a1c1943153ba72e008caf5806a6cf78e3354560d3d0a7d7a41212fc918e506ec53dc93316459bf2b568064f79af2d6a32579404189ad7088e7108306bbb18b8cee0dd4d0165fa7026529f236b1176457e4fcf75b4d51c5e671d43b1120b64c3661c908d5ebf3012404e37a1d58f5146e27b5d8b0041ba3b0de0ea35efd1f6093d7b62cf3e3e876f89788984985848dc304e5dc48ded8a360ccebd9df25a5353750adb893294bdb002490c0b990801218985e51e35afc2f7ddc5e579ebfc2dc29ef5a68c86f4b30519299cd8b9c22fd4cfbfbb9c7646c507b8a67f92477c26ab19046281abf19862635e11486c0cd69adb62afc2343683478c353cceda84189e0fae0824c2a7219e58d2f383d18e45d16a18754e279af57431c52ac4aefc1420130654f4d64b7b1ea80260990ad3c2888a208dec804968c36019357f01e4125e145c361c9cb5235980140001c062be4859d3aeeb4cd8634c6b410db0aeefff1660497fd7ee55f9baced977193c5fd0870cb9dada23a2bb47688c3da2e97fde5f5609bbe14a7bb37e5d8393044aad3883e7c1a112a0857497f6cd95fa3a0008b1423811ba10b2cf2ce042acc61087813469f0aab0a7ba5f950c85b729a7e789b1d25d4ccf3cf96c36ace62db7f1b24d9823207638997e960b4bf46ff05724578205fb220398327269be8661f858229ff17f7554707b464f7eecd6b2f1ed64da2c8c769097957874d5c2d1494d9e9214c8be96a056bfd475e32a64cde4baddf89294e3fdcdaed5e4bed79cf4c9d7ecb91a1f2dd688ed88ac6166839d005d744314f25c977fe385ac822248a580111fa8a34bb3272429390203dcd0be9038badf7aece96edcca265cb20f1d44c059d652aaad6df94331048b4e0faa284cd7dfecd2b9e46aea2f1ff0d81b8fdb1def834ca71d55c4af2d9a0db38058d7c7aa4acd8cad46b7b8feb545cf5cf285060b7adc980aca2b7d20c642e2154d7a87b92485a3411980ab43278e91285821512767a5c27514fc76c79c24ab21c649cad79d19757f01865ea6feeae5101983dc4fec07e1bd1a94269a567bc3b0e6ef7bdb7e09d60052bed4793ff103af0c1432b9aaf5658cdc01228e1b6430cbd0035e943c11ab350cf2f578178a04d7861873a7615f5ba10760a16f8fa41742717484e20f5c59c1030226cc0c67ba9d246e88f2674dec76a27910d1052bb4699e03cd2a93cb16307f417d53bc821bbd5a725820a3b11700c4f7ac44b7a932cdcbf8ad040703816f49d5d5837e2b21216341fd20cfe668b5d6958a05f2e8aeec5878869ee93c352cf532f4c2ef9bd37e9d073bdbe136db1cfd6295b0a66975d59bc6085c36fadb082bcc6392f30e84adce8edcf2c823615171f168a51f92a5a877a66e835488efcd4451c31c4aa49c6ad8ad8a54236f6cbff8c3390908835c59f036d0a334c8e3101f02f866d6dbb6051974d0f07f1bdf5043f20cc5b5015b8bab8b8ea911401db6642914b598613642eedb66bc650290bc46a0e6691caffefcc9fd522e8cec1064827515fbbd4e2687cf92843d62395e6914216d438dd8fd7edb2bf47e19aa43ac7d8a5c06bfda616e8699600bec1a77079e2e292d5c3f1687e18398f9cfa9b505f833150f727a11fd3e31760b08eb61f5b040127fad95c97f6304a7ab9205b9afdff3760f2826eefcdaa05d48e845031ecf1c597a66b71571caa1998cf15bdbdb6124453d1b331d8d4aa51036dde1926101e27bf4f626fc458e3d2523fad0fb67e5c0c574b603fb28001333467c1f617d3fc9da695baeb6eed9f8fbbf41c9673d7417bc5602814b7acad9282930453b93eafe54aebe71a780f3417cdcb019bc3e5faa8efd200c08e132feb13ede2976ab0181237e002cdb31bb89330b7248553a78a6a0c0c100ee738c6922470f99a9cb7bbfddb6cbae0b982a1aee9e4bdd374afbe7b0be59cc1ec44117fa8c278a5b03b990d0346e77751049fb10a89009abafc96a9804c85da1374d00fa3e5a092d352a40f76248a8953730b10a485e76a21487b66b744bccac66cd4798533d55e5367f496d5b8d0c0d113a3742f66c671928804c259b5ccf0cf88fe882e3426704670c3d3c8b4d4eaf9ed7a5c601187390ec527536e39477096e6d04bb0191be798eea5cf02f464b7a001e2ad52c62e314b1e9ba182d91be17d4f5f05f7cd3113c308556665cd9d235930c4f601c8d08de73d45180dba8e52cdb8f5a52e9b5baeab25bbdc7e011807f1c3212382307673c4bd3c47e13c78796294037ff3457c4e16b10fcd56dae9742e342d66ea95492321743804cd7e148ff3e05aa5b58b74309415f72dc4c78e1f9cbf039e593da6d66585f8cd23ce4b2c3dd0b94c6f250e7b6395b6e357f0be8af7909c028027290a3ff1d1acc8151958740f02d91ace69545355854639cbc382fbab21509e7645d3245ef369859786a294d47cf7ce0ede683547a9f230700105a553a3fb28f503d9562b64a6dd7d02c5784f32cc931a7bd43c5fb1fc9bd60b95cd913fec366bf57d341d974ee64dd89ea9bccbca9bdee05d4e097f07138c6ac8e677c0e6768fab89410db5d859884fc9e9f81088e74cccfe49d23f1a573b335ed378c3482b5c51571e646cd31cb57fdfa6f76e13c079a92b6b5efe4b7dde88f79f799ec8ba3f9122c767cacee562f1a77a460d26ab82c838ef2e17a66e98b107e67191cde974b7e2f451bf749ffefbd36034ad43d211e</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>生活/成长</category>
      </categories>
      <tags>
        <tag>成长</tag>
      </tags>
  </entry>
  <entry>
    <title>命名实体识别</title>
    <url>/2020/05/26/named-entity-recognition/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2020/05/26/named-entity-recognition/3c5ea3534a4143adbca52823c5b757f1.jpg" alt></p>
<a id="more"></a>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>命名实体识别(Named Entity Recognition,NER)的主要任务是识别出文本中的人名、地名等专有名称和有意义的时间、日期等数量短语并加以归类。命名实体识别技术是信息抽取、信息检索、机器翻译、问答系统等多种自然语言处理技术必不可少的组成部分。</p>
<p>中文命名实体识别的难度要比英文的难度大（<strong>英文专有名词会大写</strong>）。</p>
<h1 id="研究主体"><a href="#研究主体" class="headerlink" title="研究主体"></a>研究主体</h1><p>命名实体是命名实体识别的研究主体,一般包括3大类(实体类、时间类和数字类)和7小类(人名、地名、机构名、时间、日期、货币和百分比)命名实体。实际研究中,命名实体的确切含义需要根据具体应用来确定。</p>
<h1 id="特点及难点"><a href="#特点及难点" class="headerlink" title="特点及难点"></a>特点及难点</h1><p>评判一个命名实体是否被正确识别包括两个方面:</p>
<ol>
<li>实体的边界是否正确</li>
<li>实体的类型是否标注正确。</li>
</ol>
<p>英语中的命名实体具有比较明显的形态标志,如人名、地名等实体中的每个词的第一个字母要大写等,所以实体边界识别相对汉语来说比较容易,任务的重点是确定实体的类型。</p>
<p>和英语相比,汉语命名实体识别任务更加复杂,一方面由于分词等因素的影响难度较大,另一方面，其难点主要表现在如下几个方面:</p>
<ol>
<li>命名实体类型多样,数量众多,不断有新的命名实体涌现,如新的人名、地名等,<strong>难以建立大而全的</strong>姓氏库、名字库、地址库等<strong>数据库</strong>。</li>
<li>命名实体构成结构比较复杂,<strong>存在大量的嵌套、别名、缩略词等问题</strong>,没有严格的规律可以遵循,对这类命名实体识别的<strong>召回率</strong>相对偏低。</li>
<li><strong>存在大量的交叉和互相包含现象</strong>,组织名称中也存在大量的人名、地名、数字的现象,要正确标注这些命名实体类型,要涉及上下文语义层面的分析,这些都给命名实体的识别带来困难。</li>
<li>误差传播，<strong>分词、语法分析系统的可靠性</strong>也直接决定命名实体识别的有效性,使得中文命名实体识别更加困难。</li>
</ol>
<h1 id="主要方法"><a href="#主要方法" class="headerlink" title="主要方法"></a>主要方法</h1><p>命名实体识别的主要技术方法分为:基于规则和词典的方法、基于统计的方法、基于深度学习的方法、混合方法等。</p>
<h2 id="基于规则和词典的方法"><a href="#基于规则和词典的方法" class="headerlink" title="基于规则和词典的方法"></a>基于规则和词典的方法</h2><p>基于规则的方法多采用语言学专家手工构造规则模板,特征包括统计信息、标点符号、关键字、指示词和方向词、位置词(如尾字)、中心词等, 以模式和字符串相匹配为主要手段,这类系统大多<strong>依赖于知识库和词典</strong>的建立。</p>
<h2 id="基于统计的方法"><a href="#基于统计的方法" class="headerlink" title="基于统计的方法"></a>基于统计的方法</h2><p>基于统计的方法利用人工标注的语料进行训练,标注语料时不需要广博的语言学知识,并且可以在较短时间内完成。基于统计机器学习的方法主要包括:隐马尔可夫模型(Hidden Markov Model,HMM)、最大熵(Maximum Entropy,ME)、支持向量机(Support Vector Machine,SVM)、条件随机场(Conditional Random Fields,CRF)等。</p>
<p>在这4种学习方法中,<strong>最大熵模型</strong>结构紧凑, 具有<strong>较好的通用性</strong>,主要缺点是<strong>训练时间复杂性非常高</strong>, 有时甚至导致训练代价难以承受,另外由于需要明确的归一化计算, 导致开销比较大。而<strong>条件随机场</strong>为命名实体识别提供了一个<strong>特征灵活、全局最优</strong>的标注框架,但同时存在<strong>收敛速度慢、训练时间长</strong>的问题。一般说来,最大熵和支持向量机在正确率上要比隐马尔可夫模型高一些,但是<strong>隐马尔可夫模型</strong>在训练和识别时的<strong>速度要快一些</strong>,主要是由于在利用Viterbi算法求解命名实体类别序列的效率较高。隐马尔可夫模型更适用于一些对实时性有要求以及像信息检索这样需要处理大量文本的应用,如短文本命名实体识别。</p>
<p><strong>基于统计的方法对特征选取的要求较高,需要从文本中选择对该项任务有影响的各种特征,并将这些特征加入到特征向量中</strong>（所以目前crf前面常常会用：rnn，cnn，预训练模型来提取特征）。依据特定命名实体识别所面临的主要困难和所表现出的特性,考虑选择能有效反映该类实体特性的特征集合。主要做法是通过对训练语料所包含的语言信息进行统计和分析,从训练语料中挖掘出特征。有关特征可以分为具体的单词特征、上下文特征、词典及词性特征、停用词特征、核心词特征以及语义特征等。</p>
<h3 id="隐马尔科夫模型"><a href="#隐马尔科夫模型" class="headerlink" title="隐马尔科夫模型"></a>隐马尔科夫模型</h3><p>隐马尔可夫模型描述由一个隐藏的马尔科夫链随机生成不可观测的状态随机序列，再由各个状态生成一个观测而产生观测随机序列的过程。隐马尔可夫模型由初始状态分布，状态转移概率矩阵以及观测概率矩阵所确定。</p>
<p>NER本质上可以看成是一种序列标注问题，在使用HMM解决NER这种序列标注问题的时候，我们所能观测到的是字组成的序列（观测序列），观测不到的是每个字对应的标注（状态序列）。对应的，HMM的<strong>三个要素</strong>可以解释为，<strong>初始状态分布</strong>就是每一个标注作为句子第一个字的标注的概率，<strong>状态转移概率矩阵</strong>就是由某一个标注转移到下一个标注的概率，<strong>观测概率矩阵</strong>就是指在某个标注下，生成某个词的概率。根据HMM的三个要素，可以定义如下的HMM模型:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HMM</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, N, M)</span>:</span></span><br><span class="line">        <span class="string">"""Args:</span></span><br><span class="line"><span class="string">            N: 状态数，这里对应存在的标注的种类</span></span><br><span class="line"><span class="string">            M: 观测数，这里对应有多少不同的字</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.N = N</span><br><span class="line">        self.M = M</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 状态转移概率矩阵 A[i][j]表示从i状态转移到j状态的概率</span></span><br><span class="line">        self.A = torch.zeros(N, N)</span><br><span class="line">        <span class="comment"># 观测概率矩阵, B[i][j]表示i状态下生成j观测的概率</span></span><br><span class="line">        self.B = torch.zeros(N, M)</span><br><span class="line">        <span class="comment"># 初始状态概率  Pi[i]表示初始时刻为状态i的概率</span></span><br><span class="line">        self.Pi = torch.zeros(N)</span><br></pre></td></tr></table></figure>
<p>HMM模型的训练过程对应隐马尔可夫模型的学习问题，根据训练数据利用<strong>最大似然</strong>的方法估计模型的三个要素：初始状态分布、状态转移概率矩阵以及观测概率矩阵。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HMM</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, N, M)</span>:</span></span><br><span class="line">        ....</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, word_lists, tag_lists, word2id, tag2id)</span>:</span></span><br><span class="line">        <span class="string">"""HMM的训练，即根据训练语料对模型参数进行估计,</span></span><br><span class="line"><span class="string">           因为我们有观测序列以及其对应的状态序列，所以我们</span></span><br><span class="line"><span class="string">           可以使用极大似然估计的方法来估计隐马尔可夫模型的参数</span></span><br><span class="line"><span class="string">        参数:</span></span><br><span class="line"><span class="string">            word_lists: 列表，其中每个元素由字组成的列表，如 ['担','任','科','员']</span></span><br><span class="line"><span class="string">            tag_lists: 列表，其中每个元素是由对应的标注组成的列表，如 ['O','O','B-TITLE', 'E-TITLE']</span></span><br><span class="line"><span class="string">            word2id: 将字映射为ID</span></span><br><span class="line"><span class="string">            tag2id: 字典，将标注映射为ID</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span> len(tag_lists) == len(word_lists)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 估计转移概率矩阵</span></span><br><span class="line">        <span class="keyword">for</span> tag_list <span class="keyword">in</span> tag_lists:</span><br><span class="line">            seq_len = len(tag_list)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(seq_len - <span class="number">1</span>):</span><br><span class="line">                current_tagid = tag2id[tag_list[i]]</span><br><span class="line">                next_tagid = tag2id[tag_list[i+<span class="number">1</span>]]</span><br><span class="line">                self.A[current_tagid][next_tagid] += <span class="number">1</span></span><br><span class="line">        <span class="comment"># 一个重要的问题：如果某元素没有出现过，该位置为0，这在后续的计算中是不允许的</span></span><br><span class="line">        <span class="comment"># 解决方法：我们将等于0的概率加上很小的数</span></span><br><span class="line">        self.A[self.A == <span class="number">0.</span>] = <span class="number">1e-10</span></span><br><span class="line">        self.A = self.A / self.A.sum(dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 估计观测概率矩阵</span></span><br><span class="line">        <span class="keyword">for</span> tag_list, word_list <span class="keyword">in</span> zip(tag_lists, word_lists):</span><br><span class="line">            <span class="keyword">assert</span> len(tag_list) == len(word_list)</span><br><span class="line">            <span class="keyword">for</span> tag, word <span class="keyword">in</span> zip(tag_list, word_list):</span><br><span class="line">                tag_id = tag2id[tag]</span><br><span class="line">                word_id = word2id[word]</span><br><span class="line">                self.B[tag_id][word_id] += <span class="number">1</span></span><br><span class="line">        self.B[self.B == <span class="number">0.</span>] = <span class="number">1e-10</span></span><br><span class="line">        self.B = self.B / self.B.sum(dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 估计初始状态概率</span></span><br><span class="line">        <span class="keyword">for</span> tag_list <span class="keyword">in</span> tag_lists:</span><br><span class="line">            init_tagid = tag2id[tag_list[<span class="number">0</span>]]</span><br><span class="line">            self.Pi[init_tagid] += <span class="number">1</span></span><br><span class="line">        self.Pi[self.Pi == <span class="number">0.</span>] = <span class="number">1e-10</span></span><br><span class="line">        self.Pi = self.Pi / self.Pi.sum()</span><br></pre></td></tr></table></figure>
<p>模型训练完毕之后，要利用训练好的模型进行解码，就是对给定的模型未见过的句子，求句子中的每个字对应的标注，针对解码问题，使用的是维特比（viterbi）算法。实现的细节如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HMM</span><span class="params">(object)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decoding</span><span class="params">(self, word_list, word2id, tag2id)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        使用维特比算法对给定观测序列求状态序列， 这里就是对字组成的序列,求其对应的标注。</span></span><br><span class="line"><span class="string">        维特比算法实际是用动态规划解隐马尔可夫模型预测问题，即用动态规划求概率最大路径（最优路径）</span></span><br><span class="line"><span class="string">        这时一条路径对应着一个状态序列</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># 问题:整条链很长的情况下，十分多的小概率相乘，最后可能造成下溢</span></span><br><span class="line">        <span class="comment"># 解决办法：采用对数概率，这样源空间中的很小概率，就被映射到对数空间的大的负数</span></span><br><span class="line">        <span class="comment">#  同时相乘操作也变成简单的相加操作</span></span><br><span class="line">        A = torch.log(self.A)</span><br><span class="line">        B = torch.log(self.B)</span><br><span class="line">        Pi = torch.log(self.Pi)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化 维比特矩阵viterbi 它的维度为[状态数, 序列长度]</span></span><br><span class="line">        <span class="comment"># 其中viterbi[i, j]表示标注序列的第j个标注为i的所有单个序列(i_1, i_2, ..i_j)出现的概率最大值</span></span><br><span class="line">        seq_len = len(word_list)</span><br><span class="line">        viterbi = torch.zeros(self.N, seq_len)</span><br><span class="line">        <span class="comment"># backpointer是跟viterbi一样大小的矩阵</span></span><br><span class="line">        <span class="comment"># backpointer[i, j]存储的是 标注序列的第j个标注为i时，第j-1个标注的id</span></span><br><span class="line">        <span class="comment"># 等解码的时候，我们用backpointer进行回溯，以求出最优路径</span></span><br><span class="line">        backpointer = torch.zeros(self.N, seq_len).long()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># self.Pi[i] 表示第一个字的标记为i的概率</span></span><br><span class="line">        <span class="comment"># Bt[word_id]表示字为word_id的时候，对应各个标记的概率</span></span><br><span class="line">        <span class="comment"># self.A.t()[tag_id]表示各个状态转移到tag_id对应的概率</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 所以第一步为</span></span><br><span class="line">        start_wordid = word2id.get(word_list[<span class="number">0</span>], <span class="literal">None</span>)</span><br><span class="line">        Bt = B.t()</span><br><span class="line">        <span class="keyword">if</span> start_wordid <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># 如果字不再字典里，则假设状态的概率分布是均匀的</span></span><br><span class="line">            bt = torch.log(torch.ones(self.N) / self.N)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            bt = Bt[start_wordid]</span><br><span class="line">        viterbi[:, <span class="number">0</span>] = Pi + bt</span><br><span class="line">        backpointer[:, <span class="number">0</span>] = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 递推公式：</span></span><br><span class="line">        <span class="comment"># viterbi[tag_id, step] = max(viterbi[:, step-1]* self.A.t()[tag_id] * Bt[word])</span></span><br><span class="line">        <span class="comment"># 其中word是step时刻对应的字</span></span><br><span class="line">        <span class="comment"># 由上述递推公式求后续各步</span></span><br><span class="line">        <span class="keyword">for</span> step <span class="keyword">in</span> range(<span class="number">1</span>, seq_len):</span><br><span class="line">            wordid = word2id.get(word_list[step], <span class="literal">None</span>)</span><br><span class="line">            <span class="comment"># 处理字不在字典中的情况</span></span><br><span class="line">            <span class="comment"># bt是在t时刻字为wordid时，状态的概率分布</span></span><br><span class="line">            <span class="keyword">if</span> wordid <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="comment"># 如果字不再字典里，则假设状态的概率分布是均匀的</span></span><br><span class="line">                bt = torch.log(torch.ones(self.N) / self.N)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                bt = Bt[wordid]  <span class="comment"># 否则从观测概率矩阵中取bt</span></span><br><span class="line">            <span class="keyword">for</span> tag_id <span class="keyword">in</span> range(len(tag2id)):</span><br><span class="line">                max_prob, max_id = torch.max(</span><br><span class="line">                    viterbi[:, step<span class="number">-1</span>] + A[:, tag_id],</span><br><span class="line">                    dim=<span class="number">0</span></span><br><span class="line">                )</span><br><span class="line">                viterbi[tag_id, step] = max_prob + bt[tag_id]</span><br><span class="line">                backpointer[tag_id, step] = max_id</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 终止， t=seq_len 即 viterbi[:, seq_len]中的最大概率，就是最优路径的概率</span></span><br><span class="line">        best_path_prob, best_path_pointer = torch.max(</span><br><span class="line">            viterbi[:, seq_len<span class="number">-1</span>], dim=<span class="number">0</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 回溯，求最优路径</span></span><br><span class="line">        best_path_pointer = best_path_pointer.item()</span><br><span class="line">        best_path = [best_path_pointer]</span><br><span class="line">        <span class="keyword">for</span> back_step <span class="keyword">in</span> range(seq_len<span class="number">-1</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">            best_path_pointer = backpointer[best_path_pointer, back_step]</span><br><span class="line">            best_path_pointer = best_path_pointer.item()</span><br><span class="line">            best_path.append(best_path_pointer)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将tag_id组成的序列转化为tag</span></span><br><span class="line">        <span class="keyword">assert</span> len(best_path) == len(word_list)</span><br><span class="line">        id2tag = dict((id_, tag) <span class="keyword">for</span> tag, id_ <span class="keyword">in</span> tag2id.items())</span><br><span class="line">        tag_list = [id2tag[id_] <span class="keyword">for</span> id_ <span class="keyword">in</span> reversed(best_path)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tag_list</span><br></pre></td></tr></table></figure>
<h3 id="条件随机场"><a href="#条件随机场" class="headerlink" title="条件随机场"></a>条件随机场</h3><p>HMM模型中存在两个假设，一是输出观察值之间严格独立（观测独立性假设），二是状态转移过程中当前状态只与前一状态有关（齐次马尔科夫性假设）。在命名实体识别的场景下，HMM认为观测到的句子中的每个字都是相互独立的，而且当前时刻的标注只与前一时刻的标注相关。但实际上，命名实体识别往往需要更多的特征，比如词性，词的上下文等等，同时当前时刻的标注应该与前一时刻以及后一时刻的标注都相关联。由于这两个假设的存在，显然HMM模型在解决命名实体识别的问题上是存在缺陷的。</p>
<p>而条件随机场就没有这种问题，它通过引入自定义的特征函数，不仅可以表达观测之间的依赖，还可表示当前观测与前后多个状态之间的复杂依赖，可以有效克服HMM模型面临的问题。</p>
<p>为了建立一个条件随机场，首先要定义一个<strong>特征函数集</strong>，该函数集内的每个特征函数都以标注序列作为输入，提取的特征作为输出。假设该函数集为：</p>
<script type="math/tex; mode=display">
\Phi\left(x_{1}, \ldots, x_{m}, s_{1}, \ldots, s_{m}\right) \in \mathbb{R}^{d}</script><p>其中 $x=(x_1,x_2,\ldots,x_m)$表示观测序列， $s=(s_1,s_2,\ldots,s_m)$表示状态序列。然后，条件随机场使用对数线性模型来计算给定观测序列下状态序列的条件概率：</p>
<script type="math/tex; mode=display">
p(s | x ; w)=\frac{\exp (w \cdot \Phi(x, s))}{\sum_{s^{\prime}} \exp \left(w \cdot \Phi\left(x, s^{\prime}\right)\right)}</script><p>其中 $s^\prime$是是所有可能的状态序列，$w$是条件随机场模型的参数，可以把它看成是每个特征函数的权重。CRF模型的训练其实就是对参数 <img src="https://www.zhihu.com/equation?tex=w" alt="[公式]"> 的估计。假设有 <img src="https://www.zhihu.com/equation?tex=n" alt="[公式]"> 个已经标注好的数据 <img src="https://www.zhihu.com/equation?tex=%7B%28x%5Ei%2C+s%5Ei%29%7D_%7Bi%3D1%7D%5En" alt="[公式]"> ，则其对数似然函数的正则化形式如下：</p>
<script type="math/tex; mode=display">
L(w)=\sum_{i=1}^{n} \log p\left(s^{i} | x^{i} ; w\right)-\frac{\lambda_{2}}{2}\|w\|_{2}^{2}-\lambda_{1}\|w\|_{1}</script><p>那么，最优参数 $w^\star$ 就是：</p>
<script type="math/tex; mode=display">
w^{*}=\arg \max _{w \in \mathbb{R}^{d}} L\left(w\right)</script><p>解码采用维特比算法。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn_crfsuite <span class="keyword">import</span> CRF   <span class="comment"># 借助一个外部的库</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">word2features</span><span class="params">(sent, i)</span>:</span></span><br><span class="line">    <span class="string">"""抽取单个字的特征"""</span></span><br><span class="line">    word = sent[i]</span><br><span class="line">    prev_word = <span class="string">"&lt;s&gt;"</span> <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">else</span> sent[i<span class="number">-1</span>]</span><br><span class="line">    next_word = <span class="string">"&lt;/s&gt;"</span> <span class="keyword">if</span> i == (len(sent)<span class="number">-1</span>) <span class="keyword">else</span> sent[i+<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># 因为每个词相邻的词会影响这个词的标记</span></span><br><span class="line">    <span class="comment"># 所以我们使用：</span></span><br><span class="line">    <span class="comment"># 前一个词，当前词，后一个词，</span></span><br><span class="line">    <span class="comment"># 前一个词+当前词， 当前词+后一个词</span></span><br><span class="line">    <span class="comment"># 作为特征</span></span><br><span class="line">    features = &#123;</span><br><span class="line">        <span class="string">'w'</span>: word,</span><br><span class="line">        <span class="string">'w-1'</span>: prev_word,</span><br><span class="line">        <span class="string">'w+1'</span>: next_word,</span><br><span class="line">        <span class="string">'w-1:w'</span>: prev_word+word,</span><br><span class="line">        <span class="string">'w:w+1'</span>: word+next_word,</span><br><span class="line">        <span class="string">'bias'</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> features</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sent2features</span><span class="params">(sent)</span>:</span></span><br><span class="line">    <span class="string">"""抽取序列特征"""</span></span><br><span class="line">    <span class="keyword">return</span> [word2features(sent, i) <span class="keyword">for</span> i <span class="keyword">in</span> range(len(sent))]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRFModel</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,</span></span></span><br><span class="line"><span class="function"><span class="params">                 algorithm=<span class="string">'lbfgs'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 c1=<span class="number">0.1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 c2=<span class="number">0.1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 max_iterations=<span class="number">100</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 all_possible_transitions=False</span></span></span><br><span class="line"><span class="function"><span class="params">                 )</span>:</span></span><br><span class="line"></span><br><span class="line">        self.model = CRF(algorithm=algorithm,</span><br><span class="line">                         c1=c1,</span><br><span class="line">                         c2=c2,</span><br><span class="line">                         max_iterations=max_iterations,</span><br><span class="line">                         all_possible_transitions=all_possible_transitions)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, sentences, tag_lists)</span>:</span></span><br><span class="line">        <span class="string">"""训练模型"""</span></span><br><span class="line">        features = [sent2features(s) <span class="keyword">for</span> s <span class="keyword">in</span> sentences]</span><br><span class="line">        self.model.fit(features, tag_lists)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self, sentences)</span>:</span></span><br><span class="line">        <span class="string">"""解码,对给定句子预测其标注"""</span></span><br><span class="line">        features = [sent2features(s) <span class="keyword">for</span> s <span class="keyword">in</span> sentences]</span><br><span class="line">        pred_tag_lists = self.model.predict(features)</span><br><span class="line">        <span class="keyword">return</span> pred_tag_lists</span><br></pre></td></tr></table></figure>
<h2 id="深度学习的方法"><a href="#深度学习的方法" class="headerlink" title="深度学习的方法"></a><strong>深度学习的方法</strong></h2><p>LSTM也常常被用来解决序列标注问题。和HMM、CRF不同的是，LSTM是依靠神经网络超强的非线性拟合能力，在训练时将样本通过高维空间中的复杂非线性变换，学习到从样本到标注的函数，之后使用这个函数为指定的样本预测每个token的标注。LSTM比起CRF模型最大的好处就是<strong>简单粗暴</strong>，不需要做繁杂的特征工程，直接训练即可.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn.utils.rnn <span class="keyword">import</span> pad_packed_sequence, pack_padded_sequence</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BiLSTM</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, emb_size, hidden_size, out_size)</span>:</span></span><br><span class="line">        <span class="string">"""初始化参数：</span></span><br><span class="line"><span class="string">            vocab_size:字典的大小</span></span><br><span class="line"><span class="string">            emb_size:词向量的维数</span></span><br><span class="line"><span class="string">            hidden_size：隐向量的维数</span></span><br><span class="line"><span class="string">            out_size:标注的种类</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        super(BiLSTM, self).__init__()</span><br><span class="line">        self.embedding = nn.Embedding(vocab_size, emb_size)</span><br><span class="line">        self.bilstm = nn.LSTM(emb_size, hidden_size,</span><br><span class="line">                              batch_first=<span class="literal">True</span>,</span><br><span class="line">                              bidirectional=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        self.lin = nn.Linear(<span class="number">2</span>*hidden_size, out_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, sents_tensor, lengths)</span>:</span></span><br><span class="line">        emb = self.embedding(sents_tensor)  <span class="comment"># [B, L, emb_size]</span></span><br><span class="line"></span><br><span class="line">        packed = pack_padded_sequence(emb, lengths, batch_first=<span class="literal">True</span>)</span><br><span class="line">        rnn_out, _ = self.bilstm(packed)</span><br><span class="line">        <span class="comment"># rnn_out:[B, L, hidden_size*2]</span></span><br><span class="line">        rnn_out, _ = pad_packed_sequence(rnn_out, batch_first=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        scores = self.lin(rnn_out)  <span class="comment"># [B, L, out_size]</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> scores</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self, sents_tensor, lengths, _)</span>:</span></span><br><span class="line">        <span class="string">"""解码"""</span></span><br><span class="line">        logits = self.forward(sents_tensor, lengths)  <span class="comment"># [B, L, out_size]</span></span><br><span class="line">        _, batch_tagids = torch.max(logits, dim=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> batch_tagid</span><br></pre></td></tr></table></figure>
<h2 id="混合方法"><a href="#混合方法" class="headerlink" title="混合方法"></a>混合方法</h2><h3 id="LSTM-CRF"><a href="#LSTM-CRF" class="headerlink" title="LSTM + CRF"></a>LSTM + CRF</h3><p>简单的LSTM的优点是能够通过<strong>双向</strong>的设置学习到观测序列（输入的字）之间的依赖，在训练过程中，LSTM能够根据目标，自动提取观测序列的特征，但是缺点是无法学习到状态序列（输出的标注）之间的关系，而在命名实体识别任务中，标注之间是有一定的关系的，比如O类标注后面不会接一个I类标注，所以LSTM在解决NER这类序列标注任务时，虽然可以省去很繁杂的特征工程，但是也存在无法学习到标注上下文的缺点。</p>
<p>相反，CRF的优点就是能对隐含状态建模，学习状态序列的特点，但它的缺点是需要手动提取序列特征。所以一般的做法是，在LSTM后面再加一层CRF，以获得两者的优点。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BiLSTM_CRF</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, emb_size, hidden_size, out_size)</span>:</span></span><br><span class="line">        <span class="string">"""初始化参数：</span></span><br><span class="line"><span class="string">            vocab_size:字典的大小</span></span><br><span class="line"><span class="string">            emb_size:词向量的维数</span></span><br><span class="line"><span class="string">            hidden_size：隐向量的维数</span></span><br><span class="line"><span class="string">            out_size:标注的种类</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        super(BiLSTM_CRF, self).__init__()</span><br><span class="line">        <span class="comment"># 这里的BiLSTM就是LSTM模型部分所定义的BiLSTM模型</span></span><br><span class="line">        self.bilstm = BiLSTM(vocab_size, emb_size, hidden_size, out_size)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># CRF实际上就是多学习一个转移矩阵 [out_size, out_size] 初始化为均匀分布</span></span><br><span class="line">        self.transition = nn.Parameter(</span><br><span class="line">            torch.ones(out_size, out_size) * <span class="number">1</span>/out_size)</span><br><span class="line">        <span class="comment"># self.transition.data.zero_()</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, sents_tensor, lengths)</span>:</span></span><br><span class="line">        <span class="comment"># [B, L, out_size]</span></span><br><span class="line">        emission = self.bilstm(sents_tensor, lengths)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算CRF scores, 这个scores大小为[B, L, out_size, out_size]</span></span><br><span class="line">        <span class="comment"># 也就是每个字对应对应一个 [out_size, out_size]的矩阵</span></span><br><span class="line">        <span class="comment"># 这个矩阵第i行第j列的元素的含义是：上一时刻tag为i，这一时刻tag为j的分数</span></span><br><span class="line">        batch_size, max_len, out_size = emission.size()</span><br><span class="line">        crf_scores = emission.unsqueeze(</span><br><span class="line">            <span class="number">2</span>).expand(<span class="number">-1</span>, <span class="number">-1</span>, out_size, <span class="number">-1</span>) + self.transition.unsqueeze(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> crf_scores</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self, test_sents_tensor, lengths, tag2id)</span>:</span></span><br><span class="line">        <span class="string">"""使用维特比算法进行解码"""</span></span><br><span class="line">        start_id = tag2id[<span class="string">'&lt;start&gt;'</span>]</span><br><span class="line">        end_id = tag2id[<span class="string">'&lt;end&gt;'</span>]</span><br><span class="line">        pad = tag2id[<span class="string">'&lt;pad&gt;'</span>]</span><br><span class="line">        tagset_size = len(tag2id)</span><br><span class="line"></span><br><span class="line">        crf_scores = self.forward(test_sents_tensor, lengths)</span><br><span class="line">        device = crf_scores.device</span><br><span class="line">        <span class="comment"># B:batch_size, L:max_len, T:target set size</span></span><br><span class="line">        B, L, T, _ = crf_scores.size()</span><br><span class="line">        <span class="comment"># viterbi[i, j, k]表示第i个句子，第j个字对应第k个标记的最大分数</span></span><br><span class="line">        viterbi = torch.zeros(B, L, T).to(device)</span><br><span class="line">        <span class="comment"># backpointer[i, j, k]表示第i个句子，第j个字对应第k个标记时前一个标记的id，用于回溯</span></span><br><span class="line">        backpointer = (torch.zeros(B, L, T).long() * end_id).to(device)</span><br><span class="line">        lengths = torch.LongTensor(lengths).to(device)</span><br><span class="line">        <span class="comment"># 向前递推</span></span><br><span class="line">        <span class="keyword">for</span> step <span class="keyword">in</span> range(L):</span><br><span class="line">            batch_size_t = (lengths &gt; step).sum().item()</span><br><span class="line">            <span class="keyword">if</span> step == <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># 第一个字它的前一个标记只能是start_id</span></span><br><span class="line">                viterbi[:batch_size_t, step,</span><br><span class="line">                        :] = crf_scores[: batch_size_t, step, start_id, :]</span><br><span class="line">                backpointer[: batch_size_t, step, :] = start_id</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                max_scores, prev_tags = torch.max(</span><br><span class="line">                    viterbi[:batch_size_t, step<span class="number">-1</span>, :].unsqueeze(<span class="number">2</span>) +</span><br><span class="line">                    crf_scores[:batch_size_t, step, :, :],     <span class="comment"># [B, T, T]</span></span><br><span class="line">                    dim=<span class="number">1</span></span><br><span class="line">                )</span><br><span class="line">                viterbi[:batch_size_t, step, :] = max_scores</span><br><span class="line">                backpointer[:batch_size_t, step, :] = prev_tags</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 在回溯的时候我们只需要用到backpointer矩阵</span></span><br><span class="line">        backpointer = backpointer.view(B, <span class="number">-1</span>)  <span class="comment"># [B, L * T]</span></span><br><span class="line">        tagids = []  <span class="comment"># 存放结果</span></span><br><span class="line">        tags_t = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> step <span class="keyword">in</span> range(L<span class="number">-1</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">            batch_size_t = (lengths &gt; step).sum().item()</span><br><span class="line">            <span class="keyword">if</span> step == L<span class="number">-1</span>:</span><br><span class="line">                index = torch.ones(batch_size_t).long() * (step * tagset_size)</span><br><span class="line">                index = index.to(device)</span><br><span class="line">                index += end_id</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                prev_batch_size_t = len(tags_t)</span><br><span class="line"></span><br><span class="line">                new_in_batch = torch.LongTensor(</span><br><span class="line">                    [end_id] * (batch_size_t - prev_batch_size_t)).to(device)</span><br><span class="line">                offset = torch.cat(</span><br><span class="line">                    [tags_t, new_in_batch],</span><br><span class="line">                    dim=<span class="number">0</span></span><br><span class="line">                )  <span class="comment"># 这个offset实际上就是前一时刻的</span></span><br><span class="line">                index = torch.ones(batch_size_t).long() * (step * tagset_size)</span><br><span class="line">                index = index.to(device)</span><br><span class="line">                index += offset.long()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            tags_t = backpointer[:batch_size_t].gather(</span><br><span class="line">                dim=<span class="number">1</span>, index=index.unsqueeze(<span class="number">1</span>).long())</span><br><span class="line">            tags_t = tags_t.squeeze(<span class="number">1</span>)</span><br><span class="line">            tagids.append(tags_t.tolist())</span><br><span class="line"></span><br><span class="line">        <span class="comment"># tagids:[L-1]（L-1是因为扣去了end_token),大小的liebiao</span></span><br><span class="line">        <span class="comment"># 其中列表内的元素是该batch在该时刻的标记</span></span><br><span class="line">        <span class="comment"># 下面修正其顺序，并将维度转换为 [B, L]</span></span><br><span class="line">        tagids = list(zip_longest(*reversed(tagids), fillvalue=pad))</span><br><span class="line">        tagids = torch.Tensor(tagids).long()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 返回解码的结果</span></span><br><span class="line">        <span class="keyword">return</span> tagids</span><br></pre></td></tr></table></figure>
<h3 id="BERT-（LSTM）-CRF"><a href="#BERT-（LSTM）-CRF" class="headerlink" title="BERT+（LSTM）+CRF"></a>BERT+（LSTM）+CRF</h3><p>BERT中蕴含了大量的通用知识，利用预训练好的BERT模型，再用少量的标注数据进行FINETUNE是一种快速的获得效果不错的NER的方法。</p>
<h1 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h1><p>一般来说越复杂的标签结构，效果越好，当然复杂的标签结构处理起来也很麻烦。</p>
<h1 id="数据集"><a href="#数据集" class="headerlink" title="数据集"></a>数据集</h1><ol>
<li>医疗数据集</li>
<li>kaggle数据集</li>
<li>BosonNLP命名实体识别数据</li>
</ol>
<h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left"><strong>工具</strong></th>
<th style="text-align:left"><strong>简介</strong></th>
<th style="text-align:left"><strong>访问地址</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Stanford NER</td>
<td style="text-align:left">斯坦福大学开发的基于条件随机场的命名实体识别系统，该系统参数是基于CoNLL、MUC-6、MUC-7和ACE命名实体语料训练出来的。</td>
<td style="text-align:left"><a href="https://nlp.stanford.edu/software/CRF-NER.shtml" target="_blank" rel="noopener">官网</a> \</td>
<td><a href="https://github.com/Lynten/stanford-corenlp" target="_blank" rel="noopener">GitHub 地址</a></td>
</tr>
<tr>
<td style="text-align:left">MALLET</td>
<td style="text-align:left">麻省大学开发的一个统计自然语言处理的开源包，其序列标注工具的应用中能够实现命名实体识别。</td>
<td style="text-align:left"><a href="http://mallet.cs.umass.edu/" target="_blank" rel="noopener">官网</a></td>
</tr>
<tr>
<td style="text-align:left">Hanlp</td>
<td style="text-align:left">HanLP是一系列模型与算法组成的NLP工具包，由大快搜索主导并完全开源，目标是普及自然语言处理在生产环境中的应用。支持命名实体识别。</td>
<td style="text-align:left"><a href="http://hanlp.linrunsoft.com/" target="_blank" rel="noopener">官网</a> \</td>
<td><a href="https://github.com/hankcs/pyhanlp" target="_blank" rel="noopener">GitHub 地址</a></td>
</tr>
<tr>
<td style="text-align:left"><a href="https://easyai.tech/ai-definition/nltk/" target="_blank" rel="noopener">NLTK</a></td>
<td style="text-align:left">NLTK是一个高效的Python构建的平台,用来处理人类自然语言数据。</td>
<td style="text-align:left"><a href="http://www.nltk.org/" target="_blank" rel="noopener">官网</a> \</td>
<td><a href="https://github.com/nltk/nltk" target="_blank" rel="noopener">GitHub 地址</a></td>
</tr>
<tr>
<td style="text-align:left">SpaCy</td>
<td style="text-align:left">工业级的自然语言处理工具，遗憾的是不支持中文。</td>
<td style="text-align:left"><a href="https://spacy.io/" target="_blank" rel="noopener">官网</a> \</td>
<td><a href="https://github.com/explosion/spaCy" target="_blank" rel="noopener">GitHub 地址</a></td>
</tr>
<tr>
<td style="text-align:left">Crfsuite</td>
<td style="text-align:left">可以载入自己的数据集去训练CRF实体识别模型。</td>
<td style="text-align:left"><a href="https://sklearn-crfsuite.readthedocs.io/en/latest/?badge=latest" target="_blank" rel="noopener">文档</a> \</td>
<td><a href="https://github.com/yuquanle/StudyForNLP/blob/master/NLPbasic/NER.ipynb" target="_blank" rel="noopener">GitHub 地址</a></td>
</tr>
</tbody>
</table>
</div>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://zhuanlan.zhihu.com/p/61227299" target="_blank" rel="noopener">NLP实战-中文命名实体识别</a></li>
<li><a href="https://blog.csdn.net/u014033218/article/details/89304699" target="_blank" rel="noopener">命名实体识别研究综述</a></li>
</ol>
]]></content>
      <categories>
        <category>技术/自然语言处理</category>
      </categories>
      <tags>
        <tag>ner</tag>
        <tag>命名实体识别</tag>
      </tags>
  </entry>
  <entry>
    <title>逻辑回归与最大熵模型</title>
    <url>/2020/05/23/machine-learning-logistic-regression/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2020/05/23/machine-learning-logistic-regression/Logistic-Regression-learning.png" alt></p>
<a id="more"></a>
<h1 id="逻辑回归"><a href="#逻辑回归" class="headerlink" title="逻辑回归"></a>逻辑回归</h1><h2 id="什么是逻辑回归"><a href="#什么是逻辑回归" class="headerlink" title="什么是逻辑回归"></a>什么是逻辑回归</h2><p>逻辑回归是用来做分类算法的，线性回归，一般形式是$y=w \ast x + b$，y的取值范围是$[- \infty, +\infty]$，有这么多取值，把$y$的结果带入一个非线性变换的<strong>Sigmoid函数</strong>中，即可得到[0,1]之间取值范围的数$S$，$S$可以看成是一个概率值，如果设置概率阈值为0.5，那么$S$大于0.5可以看成是正样本，小于0.5看成是负样本，这样就可以进行分类了。</p>
<h2 id="什么是对数几率"><a href="#什么是对数几率" class="headerlink" title="什么是对数几率"></a>什么是对数几率</h2><p>如果某事件发生的概率是p,则该事件发生的<strong>几率</strong>(此处几率指该事件发生概率与不发生概率之比)是$\frac{p}{1-p}$,<strong>对数几率</strong>是$log(\frac{p}{1-p})$,那么$\log \frac{P(Y=1 | x)}{1-P(Y=1 | x)}=w \cdot x$，也就是说在逻辑斯谛回归模型中,输出Y=1的对数几率是输入x的<strong>线性函数</strong>,线性函数值越接近正无穷,概率值就越接近1,反之则越接近0.</p>
<h2 id="什么是Sigmoid函数"><a href="#什么是Sigmoid函数" class="headerlink" title="什么是Sigmoid函数"></a>什么是Sigmoid函数</h2><p>公式及图像如下：</p>
<p><img src="/2020/05/23/machine-learning-logistic-regression/00630Defly1g4pvk2ctatj30cw0b63yq.jpg" alt></p>
<p>函数中$t$无论取什么值，其结果都在$[0,1]$的区间内，一个分类问题就有两种答案，一种是“是”，一种是“否”，那0对应着“否”，1对应着“是”，假设分类的<strong>阈值</strong>是0.5，那么超过0.5的归为1分类，低于0.5的归为0分类，阈值是可以自己设定的。把$w \ast x + b$带入t中就得到了逻辑回归的一般模型方程：</p>
<script type="math/tex; mode=display">
H_{w,b}(x)=\frac{1}{1+e^{(w \ast x+b)}}</script><p>结果可以理解为概率，概率大于0.5的属于1分类，概率小于0.5的属于0分类，这样就达到了分类的目的。</p>
<h2 id="损失函数是什么"><a href="#损失函数是什么" class="headerlink" title="损失函数是什么"></a>损失函数是什么</h2><p>逻辑回归的损失函数是 <strong>log loss</strong>，也就是<strong>对数似然函数</strong>，函数公式如下：</p>
<script type="math/tex; mode=display">
\operatorname{cost}\left(h_{\theta}(x), y\right)=\left\{\begin{aligned}
-\log \left(h_{\theta}(x)\right) & \text { if } y=1 \\
-\log \left(1-h_{\theta}(x)\right) & \text { if } y=0
\end{aligned}\right.</script><p>公式中的 $y=1$ 表示的是真实值为1时用第一个公式，真实 $y=0$ 用第二个公式计算损失。当真实样本为$y=1$时，但$h=0$概率，那么$log0=\infty$，这就对模型最大的惩罚力度；当真实样本$y=1$，并且$h=1$时，那么$log1=0$，相当于没有惩罚，也就是没有损失，达到最优结果。</p>
<p>上面公式也可以表示成：</p>
<script type="math/tex; mode=display">
\begin{aligned} L(w) &=\sum_{i=1}^{N}\left[y_{i} \log \pi\left(x_{i}\right)+\left(1-y_{i}\right)\log\left(1-\pi\left(x_{i}\right)\right)\right]\\ &=\sum_{i=1}^{N}\left[y_{i} \log \frac{\pi\left(x_{i}\right)}{1-\pi\left(x_{i}\right)}+\log \left(1-\pi\left(x_{i}\right)\right)\right]\\&=\sum_{i=1}^{N}\left[y_{i}\left(w \cdot x_{i}\right)-\log \left(1+\exp \left(w \cdot x_{i}\right)\right]\right.\end{aligned}</script><p>最后按照梯度下降法一样，求解极小值点，得到想要的模型效果。</p>
<h2 id="如何进行多项逻辑回归"><a href="#如何进行多项逻辑回归" class="headerlink" title="如何进行多项逻辑回归"></a>如何进行多项逻辑回归</h2><p>当问题是多分类问题时,可以作如下推广:设Y有K类可能取值,$P(Y=k | x)=\frac{\exp \left(w_{k} \cdot x\right)}{1+\sum_{k=1}^{K-1} \exp \left(w_{k} \cdot x\right)}, \quad k=1,2, \cdots, K-1 \quad P(Y=K | x)=\frac{1}{1+\sum_{k=1}^{K-1} \exp \left(w_{k} \cdot x\right)}$,实际上就是<strong>one-vs-all</strong>的思想,将其他所有类当作一个类,问题转换为二分类问题.</p>
<p>使用最大似然法衡量模型输出的概率与真实概率的差别，假设样本一共有N个，那么这组样本发生的总概率可以表示为：</p>
<script type="math/tex; mode=display">
P(\boldsymbol{W})=\prod_{n=1}^{N}\left(\frac{e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}}{\sum_{k^{\prime}}^{C} e^{\boldsymbol{w}_{k^{\prime}}^{T} \boldsymbol{x}_{n}}}\right)</script><p>对函数取对数再乘以-1，推导得到：</p>
<script type="math/tex; mode=display">
\begin{aligned}
F(\boldsymbol{W})=-\ln (P(\boldsymbol{W})) &=\sum_{n=1}^{N} \ln \left(\frac{\sum_{k^{\prime}}^{C} e^{\boldsymbol{w}_{k^{\prime}}^{T} \boldsymbol{x}_{n}}}{e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}}\right) \\
&=\sum_{n=1}^{N} \ln \left(\frac{e^{\boldsymbol{w}_{1}^{T} \boldsymbol{x}}+e^{\boldsymbol{w}_{2}^{T} \boldsymbol{x}}+\ldots+e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}+\ldots+e^{\boldsymbol{w}_{c}^{T} \boldsymbol{x}}}{e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}}\right) \\
&=\sum_{n=1}^{N} \ln \left(1+\sum_{k \neq y_{n}} e^{\boldsymbol{w}_{k} \boldsymbol{x}_{n}-\boldsymbol{w}_{y_{n}} \boldsymbol{x}_{n}}\right)
\end{aligned}</script><h2 id="逻辑回归有什么优点"><a href="#逻辑回归有什么优点" class="headerlink" title="逻辑回归有什么优点"></a>逻辑回归有什么优点</h2><ul>
<li>LR能以概率的形式输出结果，而非只是0,1判定。</li>
<li>LR的可解释性强，可控度高(你要给老板讲的嘛…)。</li>
<li>训练快，feature engineering之后效果赞。</li>
<li>因为结果是概率，可以做ranking model。</li>
</ul>
<h2 id="逻辑回归常用的优化方法有哪些"><a href="#逻辑回归常用的优化方法有哪些" class="headerlink" title="逻辑回归常用的优化方法有哪些"></a>逻辑回归常用的优化方法有哪些</h2><h3 id="一阶方法：梯度下降"><a href="#一阶方法：梯度下降" class="headerlink" title="一阶方法：梯度下降"></a>一阶方法：梯度下降</h3><p>梯度下降、随机梯度下降、mini 随机梯度下降降法。随机梯度下降不但速度上比原始梯度下降要快，局部最优化问题时可以一定程度上抑制局部最优解的发生。 </p>
<h3 id="二阶方法：牛顿法、拟牛顿法"><a href="#二阶方法：牛顿法、拟牛顿法" class="headerlink" title="二阶方法：牛顿法、拟牛顿法"></a>二阶方法：牛顿法、拟牛顿法</h3><p>牛顿法其实就是通过切线与x轴的交点不断更新切线的位置，直到达到曲线与x轴的交点得到方程解。在实际应用中我们因为常常要求解凸优化问题，也就是要求解函数一阶导数为0的位置，而牛顿法恰好可以给这种问题提供解决方法。</p>
<p>实际应用中牛顿法首先选择一个点作为起始点，并进行一次二阶泰勒展开得到导数为0的点进行一个更新，直到达到要求，这时牛顿法也就成了二阶求解问题，比一阶方法更快。我们常常看到的x通常为一个多维向量，这也就引出了Hessian矩阵的概念（就是x的二阶导数矩阵）。</p>
<p>缺点：牛顿法是定长迭代，没有步长因子，所以不能保证函数值稳定的下降，严重时甚至会失败。还有就是牛顿法要求函数一定是二阶可导的。而且计算Hessian矩阵的逆复杂度很大。</p>
<p>拟牛顿法： 不用二阶偏导而是构造出Hessian矩阵的近似正定对称矩阵的方法称为拟牛顿法。拟牛顿法的思路就是用一个特别的表达形式来模拟Hessian矩阵或者是他的逆使得表达式满足拟牛顿条件。主要有DFP法（逼近Hession的逆）、BFGS（直接逼近Hession矩阵）、 L-BFGS（可以减少BFGS所需的存储空间）。</p>
<h2 id="逻辑斯特回归为什么要对特征进行离散化"><a href="#逻辑斯特回归为什么要对特征进行离散化" class="headerlink" title="逻辑斯特回归为什么要对特征进行离散化"></a>逻辑斯特回归为什么要对特征进行离散化</h2><ol>
<li>非线性！逻辑回归属于广义线性模型，表达能力受限；单变量离散化为N个后，每个变量有单独的权重，相当于为模型引入了非线性，能够提升模型表达能力，加大拟合； 离散特征的增加和减少都很容易，易于模型的快速迭代； </li>
<li>速度快！稀疏向量内积乘法运算速度快，计算结果方便存储，容易扩展； </li>
<li>鲁棒性！离散化后的特征对异常数据有很强的鲁棒性：比如一个特征是年龄&gt;30是1，否则0。如果特征没有离散化，一个异常数据“年龄300岁”会给模型造成很大的干扰； </li>
<li>方便交叉与特征组合：离散化后可以进行特征交叉，由M+N个变量变为M*N个变量，进一步引入非线性，提升表达能力； </li>
<li>稳定性：特征离散化后，模型会更稳定，比如如果对用户年龄离散化，20-30作为一个区间，不会因为一个用户年龄长了一岁就变成一个完全不同的人。当然处于区间相邻处的样本会刚好相反，所以怎么划分区间是门学问； </li>
<li>简化模型：特征离散化以后，起到了简化了逻辑回归模型的作用，降低了模型过拟合的风险。</li>
</ol>
<h2 id="逻辑回归的目标函数中增大L1正则化会是什么结果"><a href="#逻辑回归的目标函数中增大L1正则化会是什么结果" class="headerlink" title="逻辑回归的目标函数中增大L1正则化会是什么结果"></a>逻辑回归的目标函数中增大L1正则化会是什么结果</h2><p>所有的参数w都会变成0。</p>
<h1 id="最大熵"><a href="#最大熵" class="headerlink" title="最大熵"></a>最大熵</h1><h2 id="最大熵原理"><a href="#最大熵原理" class="headerlink" title="最大熵原理"></a><strong>最大熵原理</strong></h2><p>学习概率模型时,在所有可能的概率模型中,<strong>熵最大</strong>的模型是最好的模型.直观地,最大熵原理认为模型首先要满足已有的事实,即<strong>约束条件</strong>.在没有更多信息的情况下,那些不确定的部分都是”<strong>等可能的</strong>“.</p>
<h2 id="最大熵模型"><a href="#最大熵模型" class="headerlink" title="最大熵模型"></a><strong>最大熵模型</strong></h2><p>给定训练数据集,可以确定联合分布P(X,Y)的经验分布$\tilde{P}(X=x, Y=y)=\frac{v(X=x, Y=y)}{N}$和边缘分布P(X)的经验分布$\tilde{P}(X=x)=\frac{v(X=x)}{N}$,其中v表示频数,N表示样本容量.用<strong>特征函数$f(x,y)$</strong>=1描述x与y满足某一事实,可以得到特征函数关于P(X,Y)的经验分布的期望值和关于模型P(Y|X)与P(X)的经验分布的期望值,假设两者相等,就得到了<strong>约束条件</strong>$\sum_{x, y} \tilde{P}(x) P(y | x) f(x, y)=\sum_{x, y} \tilde{P}(x, y) f(x, y)$.定义在条件概率分布P(Y|X)上的条件熵为$H(P)=-\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)$,则<strong>条件熵最大</strong>的模型称为最大熵模型.</p>
<h2 id="最大熵模型的学习"><a href="#最大熵模型的学习" class="headerlink" title="最大熵模型的学习"></a><strong>最大熵模型的学习</strong></h2><p>就是求解最大熵模型的过程.等价于<strong>约束最优化问题</strong></p>
<script type="math/tex; mode=display">
\begin{aligned}
&\max _{P_{e c}} H(P)=-\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)\\
&\text { s.t. } \quad E_{p}\left(f_{i}\right)=E_{p}\left(f_{i}\right), \quad i=1,2, \cdots, n\\
     &\sum_{y} P(y | x)=1
\end{aligned}</script><p>,将求最大值问题改为等价的求最小值问题</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\min _{R \in C}-H(P)=\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)\\
&\text { s.t. } \quad E_{P}\left(f_{i}\right)-E_{\beta}\left(f_{i}\right)=0, \quad i=1,2, \cdots, n\\
&\sum_{y} P(y | x)=1
\end{aligned}</script><p>引入<strong>拉格朗日乘子</strong></p>
<script type="math/tex; mode=display">
\begin{aligned}
L(P, w) & \equiv-H(P)+w_{0}\left(1-\sum_{y} P(y | x)\right)+\sum_{i=1}^{n} w_{i}\left(E_{p}\left(f_{i}\right)-E_{P}\left(f_{i}\right)\right) \\
&=\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)+w_{0}\left(1-\sum_{y} P(y | x)\right) \\
&+\sum_{i=1}^{n} w_{i}\left(\sum_{x, y} \tilde{P}(x, y) f_{i}(x, y)-\sum_{x, y} \tilde{P}(x) P(y | x) f_{i}(x, y)\right)
\end{aligned}</script><p>将原始问题$\min _{p \in C} \max _{w} L(P, w)$转换为无约束最优化的<strong>对偶问题</strong>$\max _{w} \min _{P \in \mathbf{C}} L(P, w)$.首先求解内部的<strong>极小化问题</strong>,即求$L(P,W)$对$P(y|x)$的偏导数.</p>
<script type="math/tex; mode=display">
\begin{aligned}
\frac{\partial L(P, w)}{\partial P(y | x)} &=\sum_{x, y} \tilde{P}(x)(\log P(y | x)+1)-\sum_{y} w_{0}-\sum_{x, y}\left(\tilde{P}(x) \sum_{i=1}^{n} w_{i} f_{i}(x, y)\right) \\
&=\sum_{x, y} \tilde{P}(x)\left(\log P(y | x)+1-w_{0}-\sum_{i=1}^{n} w_{i} f_{i}(x, y)\right)
\end{aligned}</script><p>,并令偏导数等于0,解得$Z_{w}(x)=\sum_{y} \exp \left(\sum_{i=1}^{n} w_{i} f_{i}(x, y)\right)$.可以证明对偶函数等价于对数似然函数,那么对偶函数极大化等价于最大熵模型的<strong>极大似然估计</strong>$L(w)=\sum_{x, y} \tilde{P}(x, y) \sum_{i=1}^{n} w_{i} f_{i}(x, y)-\sum_{x} \tilde{P}(x) \log Z_{w}(x)$.之后可以用最优化算法求解得到w.</p>
<h2 id="逻辑回归与最大熵模型的共同点"><a href="#逻辑回归与最大熵模型的共同点" class="headerlink" title="逻辑回归与最大熵模型的共同点"></a>逻辑回归与最大熵模型的共同点</h2><p>最大熵模型与逻辑斯谛回归模型有类似的形式,它们又称为<strong>对数线性模型</strong>.模型学习就是在给定的训练数据条件下对模型进行极大似然估计或正则化的极大似然估计.</p>
<h2 id="优化算法"><a href="#优化算法" class="headerlink" title="优化算法"></a>优化算法</h2><p>似然函数是<strong>光滑的凸函数</strong>,因此多种最优化方法都适用.</p>
<ol>
<li><strong>改进的迭代尺度法(IIS)</strong>:假设当前的参数向量是w,如果能找到一种方法<strong>w-&gt;w+δ</strong>使对数似然函数值变大,就可以<strong>重复</strong>使用这一方法,直到找到最大值.</li>
<li>逻辑斯谛回归常应用梯度下降法,牛顿法或拟牛顿法.</li>
</ol>
]]></content>
      <categories>
        <category>技术/机器学习</category>
      </categories>
      <tags>
        <tag>机器学习</tag>
        <tag>logistic</tag>
      </tags>
  </entry>
  <entry>
    <title>线性回归</title>
    <url>/2020/05/23/machine-linear-regression/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2020/05/23/machine-linear-regression/71505f8a532d4d5e9b259634ff1c99c3.jpeg" alt></p>
<a id="more"></a>
<h1 id="什么是线性回归"><a href="#什么是线性回归" class="headerlink" title="什么是线性回归"></a>什么是线性回归</h1><ul>
<li>线性：两个变量之间的关系是一次函数关系的——图象<strong>是直线</strong>，叫做线性。</li>
<li>非线性：两个变量之间的关系不是一次函数关系的——图象<strong>不是直线</strong>，叫做非线性。</li>
<li>回归：人们在测量事物的时候因为客观条件所限，求得的都是测量值，而不是事物真实的值，为了能够得到真实值，无限次的进行测量，最后通过这些测量数据计算<strong>回归到真实值</strong>，这就是回归的由来。</li>
</ul>
<h1 id="能够解决什么样的问题"><a href="#能够解决什么样的问题" class="headerlink" title="能够解决什么样的问题"></a>能够解决什么样的问题</h1><p>对大量的观测数据进行处理，从而得到比较符合事物内部规律的数学表达式。寻找到数据与数据之间的规律所在，从而就可以模拟出结果，也就是对结果进行预测。解决的就是通过已知的数据得到未知的结果。例如：对房价的预测、判断信用评价、电影票房预估等。</p>
<h2 id="表达式是什么"><a href="#表达式是什么" class="headerlink" title="表达式是什么"></a>表达式是什么</h2><script type="math/tex; mode=display">
Y=wx+b</script><p>$w$叫做$x$的系数，$b$叫做偏置项。</p>
<h1 id="如何计算"><a href="#如何计算" class="headerlink" title="如何计算"></a>如何计算</h1><h2 id="Loss-Function—MSE"><a href="#Loss-Function—MSE" class="headerlink" title="Loss Function—MSE"></a>Loss Function—MSE</h2><script type="math/tex; mode=display">
J=\frac{1}{2m}\sum^{i=1}_{m}(y^{'}-y)^2</script><p>利用<strong>梯度下降法</strong>找到最小值点，也就是最小误差，最后把$w$ 和$b$ 给求出来。</p>
<h1 id="过拟合、欠拟合如何解决"><a href="#过拟合、欠拟合如何解决" class="headerlink" title="过拟合、欠拟合如何解决"></a>过拟合、欠拟合如何解决</h1><p>使用正则化项，也就是给loss function加上一个参数项，正则化项有<strong>L1正则化、L2正则化、ElasticNet</strong>。加入这个正则化项好处：</p>
<ul>
<li>控制参数幅度，不让模型“无法无天”。</li>
<li>限制参数搜索空间</li>
<li>解决欠拟合与过拟合的问题。</li>
</ul>
<h2 id="什么是L2正则化-岭回归"><a href="#什么是L2正则化-岭回归" class="headerlink" title="什么是L2正则化(岭回归)"></a>什么是L2正则化(岭回归)</h2><p>方程：</p>
<script type="math/tex; mode=display">
J=J_0+\lambda\sum_{w}w^2</script><p>$J_0$表示上面的 loss function ，在loss function的基础上加入$w$参数的平方和乘以 $\lambda$ ，假设：</p>
<script type="math/tex; mode=display">
L=\lambda({w_1}^2 + {w_2}^2)</script><p>回忆以前学过的单位元的方程：</p>
<script type="math/tex; mode=display">
x^2+y^2=1</script><p>和L2正则化项一样，此时的任务变成在$L$约束下求出$J$取最小值的解。求解$J_0$的过程可以画出等值线。同时L2正则化的函数L也可以在$w_1w_2$的二维平面上画出来。如下图：</p>
<p><img src="/2020/05/23/machine-linear-regression/00630Defgy1g4ns9qha1nj308u089aav.jpg" alt></p>
<p>L表示为图中的黑色圆形，随着梯度下降法的不断逼近，与圆第一次产生交点，而这个交点很难出现在坐标轴上。这就说明了L2正则化不容易得到稀疏矩阵，同时为了求出损失函数的最小值，使得$w_1$和$w_2$无限接近于0，达到防止过拟合的问题。</p>
<h2 id="什么场景下用L2正则化"><a href="#什么场景下用L2正则化" class="headerlink" title="什么场景下用L2正则化"></a>什么场景下用L2正则化</h2><p>只要数据线性相关，用LinearRegression拟合的不是很好，<strong>需要正则化</strong>，可以考虑使用岭回归(L2), 如果输入特征的维度很高,而且是稀疏线性关系的话， 岭回归就不太合适,考虑使用Lasso回归。</p>
<h2 id="什么是L1正则化-Lasso回归"><a href="#什么是L1正则化-Lasso回归" class="headerlink" title="什么是L1正则化(Lasso回归)"></a>什么是L1正则化(Lasso回归)</h2><p>L1正则化与L2正则化的区别在于惩罚项的不同：</p>
<script type="math/tex; mode=display">
J=J_0+\lambda(|w_1|+|w_2|)</script><p>求解J0的过程可以画出等值线。同时L1正则化的函数也可以在w1w2的二维平面上画出来。如下图：</p>
<p><img src="/2020/05/23/machine-linear-regression/00630Defgy1g4nse7rf9xj308u089gme.jpg" alt></p>
<p>惩罚项表示为图中的黑色棱形，随着梯度下降法的不断逼近，与棱形第一次产生交点，而这个交点很容易出现在坐标轴上。<strong>这就说明了L1正则化容易得到稀疏矩阵。</strong></p>
<h2 id="什么场景下使用L1正则化"><a href="#什么场景下使用L1正则化" class="headerlink" title="什么场景下使用L1正则化"></a>什么场景下使用L1正则化</h2><p><strong>L1正则化(Lasso回归)可以使得一些特征的系数变小,甚至还使一些绝对值较小的系数直接变为0</strong>，从而增强模型的泛化能力 。对于高的特征数据,尤其是线性关系是稀疏的，就采用L1正则化(Lasso回归),或者是要在一堆特征里面找出主要的特征，那么L1正则化(Lasso回归)更是首选了。</p>
<h2 id="什么是ElasticNet回归"><a href="#什么是ElasticNet回归" class="headerlink" title="什么是ElasticNet回归"></a>什么是ElasticNet回归</h2><p><strong>ElasticNet综合了L1正则化项和L2正则化项</strong>，它的公式是:</p>
<script type="math/tex; mode=display">
min(\frac{1}{2m}[\sum_{i=1}^{m}({y_i}^{'}-y_i)^2+\lambda\sum_{j=1}^{n}\theta_j^2]+\lambda\sum_{j=1}^{n}|\theta|</script><h2 id="什么场景下使用ElasticNet回归"><a href="#什么场景下使用ElasticNet回归" class="headerlink" title="什么场景下使用ElasticNet回归"></a>什么场景下使用ElasticNet回归</h2><p>ElasticNet在我们发现用Lasso回归太过(太多特征被稀疏为0),而岭回归也正则化的不够(回归系数衰减太慢)的时候，可以考虑使用ElasticNet回归来综合，得到比较好的结果。</p>
<h1 id="线性回归要求因变量服从正态分布？"><a href="#线性回归要求因变量服从正态分布？" class="headerlink" title="线性回归要求因变量服从正态分布？"></a>线性回归要求因变量服从正态分布？</h1><p>我们假设线性回归的噪声服从均值为0的正态分布。 当噪声符合正态分布$N(0,\delta^2)$时，因变量则符合正态分布$N(wx(i)+b,\delta^2)$，其中预测函数$y=wx(i)+b$。这个结论可以由正态分布的概率密度函数得到。也就是说当噪声符合正态分布时，其因变量必然也符合正态分布。 </p>
<p><strong>在用线性回归模型拟合数据之前，首先要求数据应符合或近似符合正态分布，否则得到的拟合函数不正确。</strong></p>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><h2 id="数据介绍"><a href="#数据介绍" class="headerlink" title="数据介绍"></a>数据介绍</h2><p>数据主要包括2014年5月至2015年5月美国King County的房屋销售价格以及房屋的基本信息。 数据分为训练数据和测试数据，分别保存在kc_train.csv和kc_test.csv两个文件中。 其中训练数据主要包括10000条记录，14个字段，主要字段说明如下：</p>
<blockquote>
<ol>
<li>第一列“销售日期”：2014年5月到2015年5月房屋出售时的日期 </li>
<li>第二列“销售价格”：房屋交易价格，单位为美元，是目标预测值 </li>
<li>第三列“卧室数”：房屋中的卧室数目 </li>
<li>第四列“浴室数”：房屋中的浴室数目 </li>
<li>第五列“房屋面积”：房屋里的生活面积 </li>
<li>第六列“停车面积”：停车坪的面积 </li>
<li>第七列“楼层数”：房屋的楼层数 </li>
<li>第八列“房屋评分”：King County房屋评分系统对房屋的总体评分 </li>
<li>第九列“建筑面积”：除了地下室之外的房屋建筑面积 </li>
<li>第十列“地下室面积”：地下室的面积 </li>
<li>第十一列“建筑年份”：房屋建成的年份 </li>
<li>第十二列“修复年份”：房屋上次修复的年份 </li>
<li>第十三列”纬度”：房屋所在纬度 </li>
<li>第十四列“经度”：房屋所在经度。</li>
</ol>
</blockquote>
<p>测试数据主要包括3000条记录，13个字段，跟训练数据的不同是测试数据并不包括房屋销售价格，需要通过由训练数据所建立的模型以及所给的测试数据，得出测试数据相应的房屋销售价格预测值。</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p><img src="/2020/05/23/machine-linear-regression/687474703a2f2f7777772e7761696c69616e2e776f726b2f696d616765732f323031382f31322f31302f3132343030663535342e706e67.png" alt></p>
<blockquote>
<ol>
<li>选择合适的模型，对模型的好坏进行评估和选择。</li>
<li>对缺失的值进行补齐操作，可以使用均值的方式补齐数据，使得准确度更高。</li>
<li>数据的取值一般跟属性有关系，但世界万物的属性是很多的，有些值小，但不代表不重要，所有为了提高预测的准确度，统一数据维度进行计算，方法有特征缩放和归一法等。</li>
<li>数据处理好之后就可以进行调用模型库进行训练了。</li>
<li>使用测试数据进行目标函数预测输出，观察结果是否符合预期。或者通过画出对比函数进行结果线条对比。</li>
</ol>
</blockquote>
<h2 id="模型选择"><a href="#模型选择" class="headerlink" title="模型选择"></a>模型选择</h2><p>一元线性回归</p>
<script type="math/tex; mode=display">
y:h(x)=wx+b</script><p>n元线性回归</p>
<script type="math/tex; mode=display">
y:h(x)=\sum^n_{i=1}w_ix^i+b=WX+b</script><p>这里，y表示要求的销售价格，x表示特征值。需要调用sklearn库来进行训练。</p>
<h2 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#读取训练数据</span></span><br><span class="line">housing = pd.read_csv(<span class="string">'kc_train.csv'</span>)</span><br><span class="line"><span class="comment">#销售价格</span></span><br><span class="line">target=pd.read_csv(<span class="string">'kc_train2.csv'</span>)  </span><br><span class="line"><span class="comment">#测试数据</span></span><br><span class="line">t=pd.read_csv(<span class="string">'kc_test.csv'</span>)   </span><br><span class="line"></span><br><span class="line">train_set.info()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/23/machine-linear-regression/image-20200524102417564.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">label = train_set[<span class="number">1</span>]</span><br><span class="line">train_set = train_set.drop([<span class="number">1</span>],axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment">#特征缩放</span></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line">minmax_scaler=MinMaxScaler()</span><br><span class="line"><span class="comment">#进行拟合，内部参数会发生变化</span></span><br><span class="line">minmax_scaler.fit(train_set)   </span><br><span class="line">scaler_train_set=minmax_scaler.transform(train_set)</span><br><span class="line">scaler_test_set = minmax_scaler.transform(test_set)</span><br><span class="line">scaler_train_set=pd.DataFrame(scaler_train_set,columns=train_set.columns)</span><br><span class="line">scaler_test_set = pd.DataFrame(scaler_test_set,columns=train_set.columns)</span><br><span class="line">scaler_train_set.head()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/23/machine-linear-regression/image-20200524103226890.png" alt></p>
<h2 id="训练模型"><a href="#训练模型" class="headerlink" title="训练模型"></a>训练模型</h2><p>使用sklearn库的线性回归函数进行调用训练。梯度下降法获得误差最小值。最后使用均方误差法来评价模型的好坏程度，并画图进行比较。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#选择基于梯度下降的线性回归模型</span></span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression</span><br><span class="line">LR_reg=LinearRegression()</span><br><span class="line"><span class="comment">#进行拟合</span></span><br><span class="line">LR_reg.fit(scaler_housing,target)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用均方误差用于评价模型好坏</span></span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error</span><br><span class="line">preds=LR_reg.predict(scaler_housing)   <span class="comment">#输入数据进行预测得到结果</span></span><br><span class="line">mse=mean_squared_error(preds,target)   <span class="comment">#使用均方误差来评价模型好坏，可以输出mse进行查看评价值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#绘图进行比较</span></span><br><span class="line">plot.figure(figsize=(<span class="number">10</span>,<span class="number">7</span>))       <span class="comment">#画布大小</span></span><br><span class="line">num=<span class="number">100</span></span><br><span class="line">x=np.arange(<span class="number">1</span>,num+<span class="number">1</span>)              <span class="comment">#取100个点进行比较</span></span><br><span class="line">plot.plot(x,target[:num],label=<span class="string">'target'</span>)      <span class="comment">#目标取值</span></span><br><span class="line">plot.plot(x,preds[:num],label=<span class="string">'preds'</span>)        <span class="comment">#预测取值</span></span><br><span class="line">plot.legend(loc=<span class="string">'upper right'</span>)  <span class="comment">#线条显示位置</span></span><br><span class="line">plot.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/23/machine-linear-regression/687474703a2f2f7777772e7761696c69616e2e776f726b2f696d616765732f323031382f31322f31302f3132343039346539362e706e67.png" alt></p>
<p>这张结果对比图中就可以看出模型是否得到精确的目标函数，是否能够精确预测房价。如果想要预测test文件里的数据，那就把test文件里的数据进行读取，并且进行特征缩放，调用： <strong>LR_reg.predict(test)</strong> 就可以得到预测结果，并进行输出操作。</p>
]]></content>
      <categories>
        <category>技术/机器学习</category>
      </categories>
      <tags>
        <tag>机器学习</tag>
        <tag>线性回归</tag>
      </tags>
  </entry>
  <entry>
    <title>Pytorch Bugs</title>
    <url>/2020/05/20/pytorch_bugs/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2020/05/20/pytorch_bugs/computer-bug-850x479.jpg" alt></p>
<a id="more"></a>
<h1 id="显卡相关"><a href="#显卡相关" class="headerlink" title="显卡相关"></a>显卡相关</h1><h2 id="CUDA-error-invalid-device-ordinal"><a href="#CUDA-error-invalid-device-ordinal" class="headerlink" title="CUDA error: invalid device ordinal"></a>CUDA error: invalid device ordinal</h2><h3 id="bug-描述"><a href="#bug-描述" class="headerlink" title="bug 描述"></a>bug 描述</h3><p>这个问题是在有多张显卡的机器上，由于0卡被占用，而选择使用除0卡外的其他卡时出现的错误。</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>当<code>CUDA_VISIBLE_DEVICES</code>被赋值为单个值的时候(即使你使用的是1卡)，pytorch 会默认你的gpu_id为0。</p>
<p>所以如果想使用非0的单张卡，<code>CUDA_VISIBLE_DEVICES</code>应该被设置为多个值，比如<code>1,0</code>，这样主卡的id会被设置为1。从而解决问题。</p>
<h2 id="RuntimeError-cuDNN-error-CUDNN-STATUS-BAD-PARAM"><a href="#RuntimeError-cuDNN-error-CUDNN-STATUS-BAD-PARAM" class="headerlink" title="RuntimeError: cuDNN error: CUDNN_STATUS_BAD_PARAM"></a>RuntimeError: cuDNN error: CUDNN_STATUS_BAD_PARAM</h2><h3 id="bug-描述-1"><a href="#bug-描述-1" class="headerlink" title="bug 描述"></a>bug 描述</h3><p>这个问题是因为在处理cnews 的数据的时候，序列长度太长，超出了缓存容量，解决方案是把rnn的输入tensor的float64转成了float32.</p>
]]></content>
      <categories>
        <category>技术/pytorch</category>
      </categories>
      <tags>
        <tag>pytorch</tag>
        <tag>bugs</tag>
      </tags>
  </entry>
  <entry>
    <title>bert源码</title>
    <url>/2020/05/13/bert_code/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2020/05/13/bert_code/bert.jpg" alt></p>
<a id="more"></a>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>BERT——来自<strong>Transformer的双向编码器表征</strong>。与最近的语言表征模型不同，BERT旨在基于<strong>所有层</strong>的<strong>左、右语境</strong>来预训练深度双向表征。BERT是首个在<strong>大批句子层面</strong>和<strong>token层面</strong>任务中取得当前最优性能的<strong>基于微调的表征模型</strong>，其性能超越许多使用任务特定架构的系统，刷新了11项NLP任务的最优性能记录。</p>
<h2 id="motivation"><a href="#motivation" class="headerlink" title="motivation"></a>motivation</h2><p>作者认为现有的技术严重制约了预训练表征的能力，其主要局限在于语言模型是<strong>单向</strong>的，例如，OpenAI GPT使用的是<strong>从左到右</strong>的架构，其中<strong>每个token只能注意Transformer自注意力层中的先前token</strong>。这些局限对于<strong>句子层面的任务</strong>而言不是最佳选择，对于<strong>token级任务</strong>则可能是毁灭性的，<strong>因为在这种任务中，结合两个方向的语境至关重要</strong>BERT（Bidirectional Encoder Representations from Transformers）改进了<strong>基于微调的策略</strong>。</p>
<h2 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h2><p>BERT提出一种新的<strong>预训练目标</strong>——<strong>遮蔽语言模型（masked language model，MLM）</strong>，来克服上文提到的单向局限。MLM<strong>随机遮蔽输入中的一些token</strong>，通过遮蔽词的语境来<strong>预测其原始词汇id</strong>。与从左到右的语言模型预训练不同，MLM目标<strong>允许表征融合左右两侧的语境</strong>，从而预训练一个深度<strong>双向Transformer</strong>。除了 MLM，还引入了一个<strong>“下一句预测”（next sentence prediction）任务</strong>，该任务<strong>联合预训练</strong>文本对表征。</p>
<h2 id="contribution"><a href="#contribution" class="headerlink" title="contribution"></a>contribution</h2><ol>
<li>Bert模型的<strong>双向特性是最重要的一项新贡献</strong></li>
<li>BERT是首个在大批句子层面和token层面任务中取得当前最优性能的基于微调的表征模型，其性能超越许多使用任务特定架构的系统。证明了<strong>预训练表征</strong>可以<strong>消除对许多精心设计的任务特定架构的需求</strong>。</li>
</ol>
<p><a href="https://arxiv.org/pdf/1810.04805.pdf" target="_blank" rel="noopener">论文地址</a></p>
<h1 id="模型架构"><a href="#模型架构" class="headerlink" title="模型架构"></a>模型架构</h1><p>BERT 旨在基于所有层的左、右语境来预训练深度双向表征。因此，预训练的 BERT 表征可以仅用一个额外的输出层进行微调，进而为很多任务创建当前最优模型，无需对任务特定架构做出大量修改。</p>
<h2 id="Base-amp-Large"><a href="#Base-amp-Large" class="headerlink" title="Base &amp; Large"></a>Base &amp; Large</h2><blockquote>
<p>$BERT_{Base}:L=12,H=768,A=12,Total Parameters=110M$</p>
<p>$BERT_{Large}:L=24,H=1024,A=16,Total Parameters=340M$</p>
</blockquote>
<p>其中，$L$:表示层数，$H$:表示隐藏层的size，$A$:表示自注意力head的个数。feed-forward的size为$4H$,即$H=768$时为3072，$H=1024$时为4096。</p>
<h2 id="BERT-amp-OpenAI-GPT-amp-ELMo"><a href="#BERT-amp-OpenAI-GPT-amp-ELMo" class="headerlink" title="BERT &amp; OpenAI GPT &amp; ELMo"></a>BERT &amp; OpenAI GPT &amp; ELMo</h2><p>$BERT_{Base}$和OpenAI GPT的大小是一样的。BERT Transformer使用<strong>双向自注意力机制</strong>，而GPT Transformer使用受限的自注意力机制，导致每个token只能关注其左侧的语境。双向Transformer在文献中通常称为<strong>“Transformer 编码器”</strong>，而只<strong>关注左侧语境的版本</strong>则因能用于文本生成而被称为<strong>“Transformer 解码器”</strong>。</p>
<p><img src="/2020/05/13/bert_code/bert-gpt-transformer-elmo.png" alt></p>
<ul>
<li>BERT 使用双向Transformer</li>
<li>OpenAI GPT 使用从左到右的Transformer</li>
<li>ELMo 使用独立训练的从左到右和从右到左LSTM的级联来生成下游任务的特征。</li>
</ul>
<h2 id="Pre-training-Tasks"><a href="#Pre-training-Tasks" class="headerlink" title="Pre-training Tasks"></a>Pre-training Tasks</h2><h3 id="Task1-Masked-LM"><a href="#Task1-Masked-LM" class="headerlink" title="Task1:Masked LM"></a>Task1:Masked LM</h3><p>BERT训练双向语言模型时以较小的概率把少量的词替成了Mask或者另一个随机的词。其目的在于使模型被迫增加对上下文的记忆。标准语言模型只能从左到右或从右到左进行训练，使得每个单词在多层上下文中<strong>间接</strong>地“see itself”。</p>
<p>为了训练一个深度双向表示，研究团队采用了一种简单的方法，即随机屏蔽（masking）部分输入token，然后只预测那些被屏蔽的token。论文将这个过程称为“masked LM”(MLM)。与masked token对应的最终隐藏向量被输入到词汇表上的输出softmax中。</p>
<p>在实验中，随机地Mask每个序列中15%的WordPiece token。</p>
<p>虽然这确实能获得双向预训练模型，但这种方法有两个缺点。</p>
<ul>
<li><p>缺点1：预训练和finetuning之间不匹配，因为在finetuning期间从未看到<code>[MASK]</code>token。</p>
<p>为了解决这个问题，并不总是用实际的<code>[MASK]</code>token替换被“masked”的词汇。使用训练数据生成器<strong>随机选择15％的token</strong>。例如在这个句子“my dog is hairy”中，它选择的token是“hairy”。然后，执行以下过程：</p>
<ul>
<li>80％的时间：<strong>用<code>[MASK]</code>标记替换单词</strong>，例如，<code>my dog is hairy → my dog is [MASK]</code></li>
<li>10％的时间：用一个<strong>随机的单词</strong>替换该单词，例如，<code>my dog is hairy → my dog is apple</code></li>
<li>10％的时间：<strong>保持单词不变</strong>，例如，<code>my dog is hairy → my dog is hairy</code>. 这样做的目的是将表示偏向于实际观察到的单词。</li>
</ul>
<p>由于Transformer encoder不知道它将被要求预测哪些单词或哪些单词已被随机单词替换，因此它<strong>被迫保持每个输入token的分布式上下文表示</strong>。此外，因为随机替换只发生在所有token的1.5％（即<strong>15％的10％</strong>），这不会损害模型的语言理解能力。</p>
</li>
<li><p>缺点2：每个batch只预测了15％的token，这表明模型可能需要更多的预训练步骤才能收敛。</p>
<p>MLM的收敛速度略慢于 left-to-right的模型（预测每个token），但MLM模型在实验上获得的提升远远超过增加的训练成本。</p>
</li>
</ul>
<h3 id="Task2-Next-Sentence-Prediction"><a href="#Task2-Next-Sentence-Prediction" class="headerlink" title="Task2:Next Sentence Prediction"></a>Task2:Next Sentence Prediction</h3><p>为了训练一个<strong>理解句子关系</strong>的模型，预先训练一个二分类的下一句测任务，这一任务可以从任何单语语料库中生成。具体地说，当选择句子A和B作为预训练样本时，B有50％的可能是A的下一个句子，也有50％的可能是来自语料库的随机句子。（实际bert后续的研究中，表明这个任务在理解句子关系表现的不是很理想。）例如：</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><span class="line">Input = <span class="comment">[CLS]</span> the <span class="keyword">man</span> went to <span class="comment">[MASK]</span> store <span class="comment">[SEP]</span> he bought a gallon <span class="comment">[MASK]</span> milk <span class="comment">[SEP]</span></span><br><span class="line">Label = IsNext</span><br><span class="line"></span><br><span class="line">Input = <span class="comment">[CLS]</span> the <span class="keyword">man</span> <span class="comment">[MASK]</span> to the store <span class="comment">[SEP]</span> penguin <span class="comment">[MASK]</span> <span class="keyword">are</span> flight ##less birds <span class="comment">[SEP]</span></span><br><span class="line">Label = NotNext</span><br></pre></td></tr></table></figure>
<h1 id="代码实现（pytorch）"><a href="#代码实现（pytorch）" class="headerlink" title="代码实现（pytorch）"></a>代码实现（pytorch）</h1><p>参考<a href="https://github.com/huggingface/transformers" target="_blank" rel="noopener">transformers</a></p>
<h2 id="预训练模型"><a href="#预训练模型" class="headerlink" title="预训练模型"></a>预训练模型</h2><p><a href="https://github.com/ymcui/Chinese-BERT-wwm" target="_blank" rel="noopener">bert中文预训练模型下载</a>，解压缩之后，会有三个文件：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">bert_config.json <span class="comment"># 模型配置文件</span></span><br><span class="line">pytorch_model.bin <span class="comment"># 预训练好的模型</span></span><br><span class="line">vocab.txt <span class="comment">#词汇表</span></span><br></pre></td></tr></table></figure>
<p>vocab.txt是模型的词典，这个文件会经常要用到。<em>bert_config.json</em>是BERT的配置(超参数)，比如网络的层数，通常不需要修改，如果自己显存小的话，也可以调小一下bert的层数。pytorch_model是预训练好的模型的模型参数，Fine-Tuning模型的初始值就是来自这个文件，然后根据不同的任务进行Fine-Tuning。</p>
<figure class="highlight"><figcaption><span>bert_config.json</span></figcaption><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "attention_probs_dropout_prob": 0.1,  #乘法attention时，softmax后dropout概率 </span><br><span class="line">  "directionality": "bidi", </span><br><span class="line">  "hidden_act": "gelu",  #激活函数 </span><br><span class="line">  "hidden_dropout_prob": 0.1,  #隐藏层dropout概率 </span><br><span class="line">  "hidden_size": 768,  #隐藏单元数 (embedding_size)</span><br><span class="line">  "initializer_range": 0.02,   #初始化范围 </span><br><span class="line">  "intermediate_size": 3072,  #升维维度</span><br><span class="line">  "max_position_embeddings": 512,  #用于生成position_embedding。输入序列长度（seq_len）不能超过512</span><br><span class="line">  "num_attention_heads": 12,  #每个隐藏层中的attention head数 (则，每个head的embedding_size=768/12=64)</span><br><span class="line">  "num_hidden_layers": 12, #隐藏层数 </span><br><span class="line">  "pooler_fc_size": 768, </span><br><span class="line">  "pooler_num_attention_heads": 12, </span><br><span class="line">  "pooler_num_fc_layers": 3, </span><br><span class="line">  "pooler_size_per_head": 128, </span><br><span class="line">  "pooler_type": "first_token_transform", </span><br><span class="line">  "type_vocab_size": 2,  #segment_ids类别 [0,1] </span><br><span class="line">  "vocab_size": 21128 #词典中词数</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>vocab.txt中的部分内容<br><figure class="highlight plain"><figcaption><span>vocab.txt</span></figcaption><table><tr><td class="code"><pre><span class="line">馬</span><br><span class="line">高</span><br><span class="line">龍</span><br><span class="line">龸</span><br><span class="line">ﬁ</span><br><span class="line">ﬂ</span><br><span class="line">！</span><br><span class="line">（</span><br><span class="line">）</span><br><span class="line">，</span><br><span class="line">－</span><br><span class="line">．</span><br><span class="line">／</span><br><span class="line">：</span><br><span class="line">？</span><br><span class="line">～</span><br><span class="line">the</span><br><span class="line">of</span><br><span class="line">and</span><br><span class="line">in</span><br><span class="line">to</span><br></pre></td></tr></table></figure></p>
<h2 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h2><h3 id="step-1-read-example-from-file"><a href="#step-1-read-example-from-file" class="headerlink" title="step 1: read example from file"></a>step 1: read example from file</h3><figure class="highlight python"><figcaption><span>read_examples_from_file</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InputExample</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A single training/test example for token classification.</span></span><br><span class="line"><span class="string">	用于保存当个样本实例。</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        guid: 样本id.</span></span><br><span class="line"><span class="string">        words: 文本序列，list类型：[word1,word2,...wordn]. </span></span><br><span class="line"><span class="string">        labels: 序列对应的label， This should be specified for train and dev examples, but not for test examples.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 由于语法糖@dataclass,会自动对该类添加__init__()函数。</span></span><br><span class="line">    guid: str</span><br><span class="line">    words: List[str]</span><br><span class="line">    labels: Optional[List[str]]</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_examples_from_file</span><span class="params">(data_dir, mode: Union[Split, str])</span> -&gt; List[InputExample]:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    data_dir: 原始数据所在的文件夹</span></span><br><span class="line"><span class="string">    model：‘train’(‘valid’)对应的数据会有label，‘test’数据的label为0</span></span><br><span class="line"><span class="string">    return：</span></span><br><span class="line"><span class="string">    	examples：list类型，包含train or valid or test 中的所有样本。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(mode, Split):</span><br><span class="line">        mode = mode.value</span><br><span class="line">    file_path = os.path.join(data_dir, <span class="string">f"<span class="subst">&#123;mode&#125;</span>.txt"</span>)</span><br><span class="line">    guid_index = <span class="number">1</span></span><br><span class="line">    examples = []</span><br><span class="line">    <span class="keyword">with</span> open(file_path, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        words = []</span><br><span class="line">        labels = []</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            <span class="keyword">if</span> line.startswith(<span class="string">"-DOCSTART-"</span>) <span class="keyword">or</span> line == <span class="string">""</span> <span class="keyword">or</span> line == <span class="string">"\n"</span>:</span><br><span class="line">                <span class="keyword">if</span> words:</span><br><span class="line">                    examples.append(InputExample(guid=<span class="string">f"<span class="subst">&#123;mode&#125;</span>-<span class="subst">&#123;guid_index&#125;</span>"</span>, words=words, labels=labels))</span><br><span class="line">                    guid_index += <span class="number">1</span></span><br><span class="line">                    words = []</span><br><span class="line">                    labels = []</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                splits = line.split(<span class="string">" "</span>)</span><br><span class="line">                words.append(splits[<span class="number">0</span>])</span><br><span class="line">                <span class="keyword">if</span> len(splits) &gt; <span class="number">1</span>:</span><br><span class="line">                    labels.append(splits[<span class="number">-1</span>].replace(<span class="string">"\n"</span>, <span class="string">""</span>))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># Examples could have no label for mode = "test"</span></span><br><span class="line">                    labels.append(<span class="string">"O"</span>)</span><br><span class="line">        <span class="keyword">if</span> words:</span><br><span class="line">            examples.append(InputExample(guid=<span class="string">f"<span class="subst">&#123;mode&#125;</span>-<span class="subst">&#123;guid_index&#125;</span>"</span>, words=words, labels=labels))</span><br><span class="line">    <span class="keyword">return</span> examples</span><br></pre></td></tr></table></figure>
<h3 id="step-2-convert-example-into-feature"><a href="#step-2-convert-example-into-feature" class="headerlink" title="step 2:convert example into feature"></a>step 2:convert example into feature</h3><h4 id="BasicTokenizer"><a href="#BasicTokenizer" class="headerlink" title="BasicTokenizer"></a>BasicTokenizer</h4><p>在转化成feature之前需要先了解一下bert的分词：</p>
<ol>
<li>对于文本序列中不想被切分开的词可以放到一个列表中，通过never_split传入分词函数中，就不会对列表中的文字进行分词。</li>
<li>中文序列标注任务需要注意：<code>&#39;\t&#39;, &#39;\n&#39;, &#39;\r&#39;，&#39; &#39;</code>会被替换成空白字符<code>&#39; &#39;</code>添加到文本中，英文文本对文本进行分词的时候又会根据空白字符来进行分词，导致空白字符会被直接清洗掉，这样就会导致中文序列标注的标签中的<code>&#39;\t&#39;, &#39;\n&#39;, &#39;\r&#39;，&#39; &#39;</code>在分词之后找不到对应的位置。</li>
</ol>
<figure class="highlight python"><figcaption><span>BasicTokenizer</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicTokenizer</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""Runs basic tokenization (punctuation splitting, lower casing, etc.)."""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, do_lower_case=True, never_split=None, tokenize_chinese_chars=True)</span>:</span></span><br><span class="line">        <span class="string">""" Constructs a BasicTokenizer.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            **do_lower_case**: Whether to lower case the input.</span></span><br><span class="line"><span class="string">            **never_split**: (`optional`) List of token not to split.</span></span><br><span class="line"><span class="string">            **tokenize_chinese_chars**: (`optional`),是否对中文分词，默认是true</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> never_split <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            never_split = []</span><br><span class="line">        self.do_lower_case = do_lower_case</span><br><span class="line">        self.never_split = never_split</span><br><span class="line">        self.tokenize_chinese_chars = tokenize_chinese_chars</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tokenize</span><span class="params">(self, text, never_split=None)</span>:</span></span><br><span class="line">        <span class="string">""" Basic Tokenization of a piece of text.</span></span><br><span class="line"><span class="string">            仅仅根据 空白字符 来进行分词</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            **never_split**: (`optional`)，对哪些文字不进行分词，[person,people,..],如果正常分词的话，person 会被切成per ##son，但是person如果被放入这个列表中，就不会被切分开</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        never_split = self.never_split + (never_split <span class="keyword">if</span> never_split <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> [])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 注意： 非法中文字符会被从文本中删除，以及‘\t’, ‘\n’, and ‘\r’，‘ ’会被替换成空白字符‘ ’添加到文本中，对文本进行分词的时候又会根据空白字符来进行分词，导致空白字符会被直接清洗掉，对于序列标注任务来说，会造成文本与标签对不齐的问题。</span></span><br><span class="line">        text = self._clean_text(text)</span><br><span class="line">        <span class="keyword">if</span> self.tokenize_chinese_chars:</span><br><span class="line">            <span class="comment"># 对中文字符按 字 进行分词，对中文分词过滤一遍之后在对英文字符进行分词。</span></span><br><span class="line">            text = self._tokenize_chinese_chars(text)</span><br><span class="line">            </span><br><span class="line">        orig_tokens = whitespace_tokenize(text) <span class="comment"># 先按照空白字符进行分词。</span></span><br><span class="line">        split_tokens = []</span><br><span class="line">        <span class="keyword">for</span> token <span class="keyword">in</span> orig_tokens:</span><br><span class="line">            <span class="keyword">if</span> self.do_lower_case <span class="keyword">and</span> token <span class="keyword">not</span> <span class="keyword">in</span> never_split:</span><br><span class="line">                token = token.lower()</span><br><span class="line">                token = self._run_strip_accents(token)</span><br><span class="line">            split_tokens.extend(self._run_split_on_punc(token, never_split))</span><br><span class="line">        output_tokens = whitespace_tokenize(<span class="string">" "</span>.join(split_tokens))</span><br><span class="line">        <span class="keyword">return</span> output_tokens</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_run_strip_accents</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        <span class="string">"""Strips accents from a piece of text."""</span></span><br><span class="line">        text = unicodedata.normalize(<span class="string">"NFD"</span>, text)</span><br><span class="line">        output = []</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> text:</span><br><span class="line">            cat = unicodedata.category(char)</span><br><span class="line">            <span class="keyword">if</span> cat == <span class="string">"Mn"</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            output.append(char)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>.join(output)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_run_split_on_punc</span><span class="params">(self, text, never_split=None)</span>:</span></span><br><span class="line">        <span class="string">"""Splits punctuation on a piece of text."""</span></span><br><span class="line">        <span class="keyword">if</span> never_split <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> text <span class="keyword">in</span> never_split:</span><br><span class="line">            <span class="keyword">return</span> [text]</span><br><span class="line">        chars = list(text)</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        start_new_word = <span class="literal">True</span></span><br><span class="line">        output = []</span><br><span class="line">        <span class="keyword">while</span> i &lt; len(chars):</span><br><span class="line">            char = chars[i]</span><br><span class="line">            <span class="keyword">if</span> _is_punctuation(char):</span><br><span class="line">                output.append([char])</span><br><span class="line">                start_new_word = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> start_new_word:</span><br><span class="line">                    output.append([])</span><br><span class="line">                start_new_word = <span class="literal">False</span></span><br><span class="line">                output[<span class="number">-1</span>].append(char)</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="string">""</span>.join(x) <span class="keyword">for</span> x <span class="keyword">in</span> output]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_tokenize_chinese_chars</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        <span class="string">"""对中文合法字符按字进行分割。"""</span></span><br><span class="line">        output = []</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> text:</span><br><span class="line">            cp = ord(char)</span><br><span class="line">            <span class="keyword">if</span> self._is_chinese_char(cp):</span><br><span class="line">                output.append(<span class="string">" "</span>)</span><br><span class="line">                output.append(char)</span><br><span class="line">                output.append(<span class="string">" "</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                output.append(char)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>.join(output)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_is_chinese_char</span><span class="params">(self, cp)</span>:</span></span><br><span class="line">        <span class="string">"""判断cp是否是中文合法字符</span></span><br><span class="line"><span class="string">        0x4e00-0x9fff cjk 统一字型 常用字 共 20992个（实际只定义到0x9fc3)</span></span><br><span class="line"><span class="string">        0x3400-0x4dff cjk 统一字型扩展表a 少用字 共 6656个</span></span><br><span class="line"><span class="string">        0x20000-0x2a6df cjk 统一字型扩展表b 少用字，历史上使用 共42720个</span></span><br><span class="line"><span class="string">        0xf900-0xfaff cjk 兼容字型 重复字，可统一变体，共同字 共512个</span></span><br><span class="line"><span class="string">        0x2f800-0x2fa1f cjk 兼容字型补遗 可统一变体 共544个</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            (cp &gt;= <span class="number">0x4E00</span> <span class="keyword">and</span> cp &lt;= <span class="number">0x9FFF</span>)</span><br><span class="line">            <span class="keyword">or</span> (cp &gt;= <span class="number">0x3400</span> <span class="keyword">and</span> cp &lt;= <span class="number">0x4DBF</span>)  <span class="comment">#</span></span><br><span class="line">            <span class="keyword">or</span> (cp &gt;= <span class="number">0x20000</span> <span class="keyword">and</span> cp &lt;= <span class="number">0x2A6DF</span>)  <span class="comment">#</span></span><br><span class="line">            <span class="keyword">or</span> (cp &gt;= <span class="number">0x2A700</span> <span class="keyword">and</span> cp &lt;= <span class="number">0x2B73F</span>)  <span class="comment">#</span></span><br><span class="line">            <span class="keyword">or</span> (cp &gt;= <span class="number">0x2B740</span> <span class="keyword">and</span> cp &lt;= <span class="number">0x2B81F</span>)  <span class="comment">#</span></span><br><span class="line">            <span class="keyword">or</span> (cp &gt;= <span class="number">0x2B820</span> <span class="keyword">and</span> cp &lt;= <span class="number">0x2CEAF</span>)  <span class="comment">#</span></span><br><span class="line">            <span class="keyword">or</span> (cp &gt;= <span class="number">0xF900</span> <span class="keyword">and</span> cp &lt;= <span class="number">0xFAFF</span>)</span><br><span class="line">            <span class="keyword">or</span> (cp &gt;= <span class="number">0x2F800</span> <span class="keyword">and</span> cp &lt;= <span class="number">0x2FA1F</span>)  <span class="comment">#</span></span><br><span class="line">        ):  <span class="comment">#</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_clean_text</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        <span class="string">"""过滤掉非法字符，把`'\t', '\n', '\r'，' '`会被替换成空白字符`' '`"""</span></span><br><span class="line">        output = []</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> text:</span><br><span class="line">            cp = ord(char)</span><br><span class="line">            <span class="keyword">if</span> cp == <span class="number">0</span> <span class="keyword">or</span> cp == <span class="number">0xFFFD</span> <span class="keyword">or</span> _is_control(char):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> _is_whitespace(char):</span><br><span class="line">                output.append(<span class="string">" "</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                output.append(char)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>.join(output)</span><br></pre></td></tr></table></figure>
<h4 id="WordpieceTokenizer"><a href="#WordpieceTokenizer" class="headerlink" title="WordpieceTokenizer"></a>WordpieceTokenizer</h4><p>经过<code>BasicTokenizer</code>处理成空格隔开的单词之后，还需要在经过WordpieceTokenizer对英文单词进行更细粒度的切分：</p>
<blockquote>
<p>input = “unaffable”</p>
<p>output = [“un”, “##aff”, “##able”]</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WordpieceTokenizer</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""Runs WordPiece tokenization."""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab, unk_token, max_input_chars_per_word=<span class="number">100</span>)</span>:</span></span><br><span class="line">        self.vocab = vocab</span><br><span class="line">        self.unk_token = unk_token</span><br><span class="line">        self.max_input_chars_per_word = max_input_chars_per_word</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tokenize</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        For example:input = "unaffable"output = ["un", "##aff", "##able"]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">          text: 经过`BasicTokenizer`分词之后，</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">          A list of wordpiece tokens.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        output_tokens = []</span><br><span class="line">        <span class="keyword">for</span> token <span class="keyword">in</span> whitespace_tokenize(text):</span><br><span class="line">            chars = list(token)</span><br><span class="line">            <span class="keyword">if</span> len(chars) &gt; self.max_input_chars_per_word:</span><br><span class="line">                output_tokens.append(self.unk_token)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            is_bad = <span class="literal">False</span></span><br><span class="line">            start = <span class="number">0</span></span><br><span class="line">            sub_tokens = []</span><br><span class="line">            <span class="keyword">while</span> start &lt; len(chars):</span><br><span class="line">                end = len(chars)</span><br><span class="line">                cur_substr = <span class="literal">None</span></span><br><span class="line">                <span class="keyword">while</span> start &lt; end:</span><br><span class="line">                    substr = <span class="string">""</span>.join(chars[start:end])</span><br><span class="line">                    <span class="keyword">if</span> start &gt; <span class="number">0</span>:</span><br><span class="line">                        substr = <span class="string">"##"</span> + substr</span><br><span class="line">                    <span class="keyword">if</span> substr <span class="keyword">in</span> self.vocab: <span class="comment"># 如果在词汇表中存在该wordpiece</span></span><br><span class="line">                        cur_substr = substr</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    end -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> cur_substr <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    is_bad = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                sub_tokens.append(cur_substr)</span><br><span class="line">                start = end</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> is_bad:</span><br><span class="line">                output_tokens.append(self.unk_token)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                output_tokens.extend(sub_tokens)</span><br><span class="line">        <span class="keyword">return</span> output_tokens</span><br></pre></td></tr></table></figure>
<h4 id="BertTokenizer"><a href="#BertTokenizer" class="headerlink" title="BertTokenizer"></a>BertTokenizer</h4><p><code>BertTokenizer</code>基于<code>WordPiece</code>，需要注意的地方是，对于中文文本来说，中文文本是没有空格分隔的文本，所以是需要在WordPiece之前do_basic_tokenize，也就是对于中文来说，需要<code>do_basic_tokenize=True</code>,不然对于没有分隔的中文字符会由于其长度超过词的最大长度，被修改为<code>[UNK]</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertTokenizer</span><span class="params">(PreTrainedTokenizer)</span>:</span></span><br><span class="line">    <span class="string">r"""</span></span><br><span class="line"><span class="string">    Constructs a BERT tokenizer. Based on WordPiece.</span></span><br><span class="line"><span class="string">    这是一个替换原文本中符号，检测元文本中的单词是否在预训练字典中，将单词替换成字典中对应的id，对文本的长度进行padding的一个类。</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        vocab_file:词汇表文件</span></span><br><span class="line"><span class="string">        do_lower_case:是否大写变小写，默认True</span></span><br><span class="line"><span class="string">        do_basic_tokenize:是否在WordPiece之前做basci tokenize,对于中文字符来说</span></span><br><span class="line"><span class="string">        never_split：哪些词不需要在进行更细粒度的切分，前提需要`do_basic_tokenize=True`，才会起作用。</span></span><br><span class="line"><span class="string">        unk_token：对于不在词汇表中的词汇被修改成unk_token，默认是 "[UNK]"，无特殊需要，使用默认就好。</span></span><br><span class="line"><span class="string">        sep_token：分隔句子的标识，默认是"[SEP]"，无特殊需要，使用默认就好。</span></span><br><span class="line"><span class="string">        pad_token:超出句子长度的内容被填补pad_token, 默认是"[PAD]"，无特殊需要，使用默认就好。</span></span><br><span class="line"><span class="string">        cls_token：句子分类，默认"[CLS]"，原用于NSP任务，可用该字符对应的输出向量做文本分类任务</span></span><br><span class="line"><span class="string">        mask_token：对文本进行mask的字符，用于MAKS LM 任务，被mask住的字符需要在训练阶段进行predict，默认是"[MASK]"，无特殊需要，使用默认就好。</span></span><br><span class="line"><span class="string">        tokenize_chinese_chars：是否对中文字符进行分词。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    vocab_files_names = VOCAB_FILES_NAMES <span class="comment"># 词汇表文件名</span></span><br><span class="line">    pretrained_vocab_files_map = PRETRAINED_VOCAB_FILES_MAP</span><br><span class="line">    pretrained_init_configuration = PRETRAINED_INIT_CONFIGURATION</span><br><span class="line">    max_model_input_sizes = PRETRAINED_POSITIONAL_EMBEDDINGS_SIZES</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        self,</span></span></span><br><span class="line"><span class="function"><span class="params">        vocab_file,</span></span></span><br><span class="line"><span class="function"><span class="params">        do_lower_case=True,</span></span></span><br><span class="line"><span class="function"><span class="params">        do_basic_tokenize=True,</span></span></span><br><span class="line"><span class="function"><span class="params">        never_split=None,</span></span></span><br><span class="line"><span class="function"><span class="params">        unk_token=<span class="string">"[UNK]"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        sep_token=<span class="string">"[SEP]"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        pad_token=<span class="string">"[PAD]"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        cls_token=<span class="string">"[CLS]"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        mask_token=<span class="string">"[MASK]"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        tokenize_chinese_chars=True,</span></span></span><br><span class="line"><span class="function"><span class="params">        **kwargs</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span>:</span></span><br><span class="line">        super().__init__(</span><br><span class="line">            unk_token=unk_token,</span><br><span class="line">            sep_token=sep_token,</span><br><span class="line">            pad_token=pad_token,</span><br><span class="line">            cls_token=cls_token,</span><br><span class="line">            mask_token=mask_token,</span><br><span class="line">            **kwargs,</span><br><span class="line">        )</span><br><span class="line">        self.max_len_single_sentence = self.max_len - <span class="number">2</span>  <span class="comment"># take into account special tokens</span></span><br><span class="line">        self.max_len_sentences_pair = self.max_len - <span class="number">3</span>  <span class="comment"># roberta，take into account special tokens</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(vocab_file):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(</span><br><span class="line">                <span class="string">"Can't find a vocabulary file at path '&#123;&#125;'. To load the vocabulary from a Google pretrained "</span></span><br><span class="line">                <span class="string">"model use `tokenizer = BertTokenizer.from_pretrained(PRETRAINED_MODEL_NAME)`"</span>.format(vocab_file)</span><br><span class="line">            )</span><br><span class="line">        <span class="comment"># 加载词汇表文件</span></span><br><span class="line">        self.vocab = load_vocab(vocab_file)</span><br><span class="line">        <span class="comment"># id 到 token 的映射</span></span><br><span class="line">        self.ids_to_tokens = collections.OrderedDict([(ids, tok) <span class="keyword">for</span> tok, ids <span class="keyword">in</span> self.vocab.items()])</span><br><span class="line">        self.do_basic_tokenize = do_basic_tokenize</span><br><span class="line">        <span class="keyword">if</span> do_basic_tokenize:</span><br><span class="line">            self.basic_tokenizer = BasicTokenizer(</span><br><span class="line">                do_lower_case=do_lower_case, never_split=never_split, tokenize_chinese_chars=tokenize_chinese_chars</span><br><span class="line">            )</span><br><span class="line">        self.wordpiece_tokenizer = WordpieceTokenizer(vocab=self.vocab, unk_token=self.unk_token)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">vocab_size</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.vocab)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_vocab</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> dict(self.vocab, **self.added_tokens_encoder)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_tokenize</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        split_tokens = []</span><br><span class="line">        <span class="keyword">if</span> self.do_basic_tokenize:</span><br><span class="line">            <span class="keyword">for</span> token <span class="keyword">in</span> self.basic_tokenizer.tokenize(text, never_split=self.all_special_tokens):</span><br><span class="line">                <span class="keyword">for</span> sub_token <span class="keyword">in</span> self.wordpiece_tokenizer.tokenize(token):</span><br><span class="line">                    split_tokens.append(sub_token)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            split_tokens = self.wordpiece_tokenizer.tokenize(text)</span><br><span class="line">        <span class="keyword">return</span> split_tokens</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_convert_token_to_id</span><span class="params">(self, token)</span>:</span></span><br><span class="line">        <span class="string">""" 把词映射到id"""</span></span><br><span class="line">        <span class="keyword">return</span> self.vocab.get(token, self.vocab.get(self.unk_token))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_convert_id_to_token</span><span class="params">(self, index)</span>:</span></span><br><span class="line">        <span class="string">"""把token id 映射成词"""</span></span><br><span class="line">        <span class="keyword">return</span> self.ids_to_tokens.get(index, self.unk_token)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">convert_tokens_to_string</span><span class="params">(self, tokens)</span>:</span></span><br><span class="line">        <span class="string">""" 英文：把wordpiece之后的tokens 还原成文本。没有处理中文的换行等"""</span></span><br><span class="line">        out_string = <span class="string">" "</span>.join(tokens).replace(<span class="string">" ##"</span>, <span class="string">""</span>).strip()</span><br><span class="line">        <span class="keyword">return</span> out_string</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_inputs_with_special_tokens</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        self, token_ids_0: List[int], token_ids_1: Optional[List[int]] = None</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span> -&gt; List[int]:</span></span><br><span class="line">        <span class="string">"""为分词后的句子添加special token：[CLS]、[SEP]</span></span><br><span class="line"><span class="string">        - single sequence: ``[CLS] X [SEP]``</span></span><br><span class="line"><span class="string">        - pair of sequences: ``[CLS] A [SEP] B [SEP]``</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> token_ids_1 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> [self.cls_token_id] + token_ids_0 + [self.sep_token_id]</span><br><span class="line">        cls = [self.cls_token_id]</span><br><span class="line">        sep = [self.sep_token_id]</span><br><span class="line">        <span class="keyword">return</span> cls + token_ids_0 + sep + token_ids_1 + sep</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_special_tokens_mask</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        self, token_ids_0: List[int], token_ids_1: Optional[List[int]] = None, already_has_special_tokens: bool = False</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span> -&gt; List[int]:</span></span><br><span class="line">        <span class="string">"""判断token_ids 是否已经添加过special token，用mask序列来表示：[0,1,1,1,1,0],0表示special token，返回mask 序列</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> already_has_special_tokens:</span><br><span class="line">            <span class="keyword">if</span> token_ids_1 <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(</span><br><span class="line">                    <span class="string">"You should not supply a second sequence if the provided sequence of "</span></span><br><span class="line">                    <span class="string">"ids is already formated with special tokens for the model."</span></span><br><span class="line">                )</span><br><span class="line">            <span class="keyword">return</span> list(map(<span class="keyword">lambda</span> x: <span class="number">1</span> <span class="keyword">if</span> x <span class="keyword">in</span> [self.sep_token_id, self.cls_token_id] <span class="keyword">else</span> <span class="number">0</span>, token_ids_0))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> token_ids_1 <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> [<span class="number">1</span>] + ([<span class="number">0</span>] * len(token_ids_0)) + [<span class="number">1</span>] + ([<span class="number">0</span>] * len(token_ids_1)) + [<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> [<span class="number">1</span>] + ([<span class="number">0</span>] * len(token_ids_0)) + [<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_token_type_ids_from_sequences</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        self, token_ids_0: List[int], token_ids_1: Optional[List[int]] = None</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span> -&gt; List[int]:</span></span><br><span class="line">        <span class="string">"""根据序列创建 token type ids，用于表示句子分割，如果只有一个句子，返回全为0的列表，如果是两个句子，则表示成如下：</span></span><br><span class="line"><span class="string">            0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1</span></span><br><span class="line"><span class="string">            | first sequence    | second sequence |</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        sep = [self.sep_token_id]</span><br><span class="line">        cls = [self.cls_token_id]</span><br><span class="line">        <span class="keyword">if</span> token_ids_1 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> len(cls + token_ids_0 + sep) * [<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> len(cls + token_ids_0 + sep) * [<span class="number">0</span>] + len(token_ids_1 + sep) * [<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save_vocabulary</span><span class="params">(self, vocab_path)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Save the sentencepiece vocabulary (copy original file) and special tokens file to a directory.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(vocab_path):</span><br><span class="line">            vocab_file = os.path.join(vocab_path, VOCAB_FILES_NAMES[<span class="string">"vocab_file"</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            vocab_file = vocab_path</span><br><span class="line">        <span class="keyword">with</span> open(vocab_file, <span class="string">"w"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> writer:</span><br><span class="line">            <span class="keyword">for</span> token, token_index <span class="keyword">in</span> sorted(self.vocab.items(), key=<span class="keyword">lambda</span> kv: kv[<span class="number">1</span>]):</span><br><span class="line">                <span class="keyword">if</span> index != token_index:</span><br><span class="line">                    logger.warning(</span><br><span class="line">                        <span class="string">"Saving vocabulary to &#123;&#125;: vocabulary indices are not consecutive."</span></span><br><span class="line">                        <span class="string">" Please check that the vocabulary is not corrupted!"</span>.format(vocab_file)</span><br><span class="line">                    )</span><br><span class="line">                    index = token_index</span><br><span class="line">                writer.write(token + <span class="string">"\n"</span>)</span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> (vocab_file,)</span><br></pre></td></tr></table></figure>
<p>由于BertTokenizer继承了PreTrainedTokenizer，对PreTrainedTokenizer感兴趣可以通过这个<a href="https://github.com/huggingface/transformers/blob/ef46ccb05c601f413a774d43524591816406778d/src/transformers/tokenization_utils.py#L693" target="_blank" rel="noopener">链接</a>在进行研究。</p>
<h4 id="Input-feature"><a href="#Input-feature" class="headerlink" title="Input feature"></a>Input feature</h4><figure class="highlight python"><figcaption><span>convert_example_to_features</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InputFeatures</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    InputExample 对应的 feature，该类变量名称与model中的变量是对应的。</span></span><br><span class="line"><span class="string">    @dataclass 自动为该类添加初始化函数__init__().</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    input_ids: List[int] <span class="comment"># 输入样本的id</span></span><br><span class="line">    attention_mask: List[int] <span class="comment"># </span></span><br><span class="line">    <span class="comment"># 用来指示第几个句子，比如：</span></span><br><span class="line">    <span class="comment"># tokens:   [CLS] is this jack ##son ##ville ? [SEP] no it is not . [SEP]</span></span><br><span class="line">    <span class="comment">#  type_ids:   0   0  0    0    0     0       0   0   1  1  1  1   1   1</span></span><br><span class="line">    token_type_ids: Optional[List[int]] = <span class="literal">None</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 由于是序列标注任务，所以label对应的也应该是一个序列。</span></span><br><span class="line">    label_ids: Optional[List[int]] = <span class="literal">None</span> </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># 实际上该函数没有处理中文分词中，换行（\n）,空格字符对齐的问题。    </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_examples_to_features</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    examples: List[InputExample], <span class="comment"># 样本集</span></span></span></span><br><span class="line"><span class="function"><span class="params">    label_list: List[str], <span class="comment"># 样本集对应的标签集</span></span></span></span><br><span class="line"><span class="function"><span class="params">    max_seq_length: int, <span class="comment"># 最大序列长度，但是不应该超过510（512应该包含[CLS],[SEP]两个字符）</span></span></span></span><br><span class="line"><span class="function"><span class="params">    tokenizer: PreTrainedTokenizer, <span class="comment"># 分词器</span></span></span></span><br><span class="line"><span class="function"><span class="params">    cls_token_at_end=False, <span class="comment"># [CLS]字符是否添加在序列最后，默认是放在序列最前面，False：[CLS] + A + [SEP] + B + [SEP]，True: A + [SEP] + B + [SEP] + [CLS]</span></span></span></span><br><span class="line"><span class="function"><span class="params">    cls_token=<span class="string">"[CLS]"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    cls_token_segment_id=<span class="number">1</span>, <span class="comment"># `cls_token_segment_id` define the segment id associated to the CLS token (0 for BERT, 2 for XLNet)</span></span></span></span><br><span class="line"><span class="function"><span class="params">    sep_token=<span class="string">"[SEP]"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    sep_token_extra=False, <span class="comment"># roberta 中会有extra sep token</span></span></span></span><br><span class="line"><span class="function"><span class="params">    pad_on_left=False, <span class="comment"># 是否在序列的左边进行pad</span></span></span></span><br><span class="line"><span class="function"><span class="params">    pad_token=<span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    pad_token_segment_id=<span class="number">0</span>, <span class="comment"># padding token_ids 的值为0</span></span></span></span><br><span class="line"><span class="function"><span class="params">    pad_token_label_id=<span class="number">-100</span>, <span class="comment"># 序列标注的tag，超出序列长度的部分，pad成：-100</span></span></span></span><br><span class="line"><span class="function"><span class="params">    sequence_a_segment_id=<span class="number">0</span>, <span class="comment"># 第一句对应的seg id：0  --&gt; type_ids:   0   0  0    0    0     0       0   0   1  1  1  1   1   1</span></span></span></span><br><span class="line"><span class="function"><span class="params">    mask_padding_with_zero=True, <span class="comment"># 对padding的部分，mask对应的值为0</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span> -&gt; List[InputFeatures]:</span></span><br><span class="line">        </span><br><span class="line">  <span class="comment"># label 到 index 的映射 ： [B,M,E,S]--&gt;[0,1,2,3]</span></span><br><span class="line">  label_map = &#123;label: i <span class="keyword">for</span> i, label <span class="keyword">in</span> enumerate(label_list)&#125; </span><br><span class="line">  </span><br><span class="line">  features = []</span><br><span class="line">  <span class="keyword">for</span> (ex_index, example) <span class="keyword">in</span> enumerate(examples):</span><br><span class="line">      <span class="keyword">if</span> ex_index % <span class="number">10</span>_000 == <span class="number">0</span>:</span><br><span class="line">          logger.info(<span class="string">"Writing example %d of %d"</span>, ex_index, len(examples))</span><br><span class="line">  </span><br><span class="line">      tokens = []  <span class="comment"># 文本序列分词之后的列表:sentence --&gt; [word1,wor2,word3,....]</span></span><br><span class="line">      label_ids = [] <span class="comment"># 由于分词之后，label 和 tokens 会产生错位现象（[CLS],[SEP],空格,换行等字符导致的问题），需要重新和分词之后的内容对齐。</span></span><br><span class="line">      <span class="keyword">for</span> word, label <span class="keyword">in</span> zip(example.words, example.labels):</span><br><span class="line">          word_tokens = tokenizer.tokenize(word)</span><br><span class="line">  </span><br><span class="line">          <span class="keyword">if</span> len(word_tokens) &gt; <span class="number">0</span>:</span><br><span class="line">              tokens.extend(word_tokens)</span><br><span class="line">              label_ids.extend([label_map[label]] + [pad_token_label_id] * (len(word_tokens) - <span class="number">1</span>))</span><br><span class="line">  </span><br><span class="line">      <span class="comment"># Account for [CLS] and [SEP] with "- 2" and with "- 3" for RoBERTa.</span></span><br><span class="line">      special_tokens_count = tokenizer.num_special_tokens_to_add()</span><br><span class="line">      <span class="comment"># 先取出不添加special token的序列，再在这个序列的基础上，添加special token</span></span><br><span class="line">      <span class="keyword">if</span> len(tokens) &gt; max_seq_length - special_tokens_count:</span><br><span class="line">          tokens = tokens[: (max_seq_length - special_tokens_count)]</span><br><span class="line">          label_ids = label_ids[: (max_seq_length - special_tokens_count)]</span><br><span class="line">  </span><br><span class="line">      <span class="comment"># 在序列末尾添加[SEP]</span></span><br><span class="line">      tokens += [sep_token]</span><br><span class="line">      label_ids += [pad_token_label_id]</span><br><span class="line">      </span><br><span class="line">      <span class="comment"># roberta 的extra token</span></span><br><span class="line">      <span class="keyword">if</span> sep_token_extra:</span><br><span class="line">          <span class="comment"># roberta uses an extra separator b/w pairs of sentences</span></span><br><span class="line">          tokens += [sep_token]</span><br><span class="line">          label_ids += [pad_token_label_id]</span><br><span class="line">          </span><br><span class="line">      <span class="comment"># 第一句对应的seg id：0  --&gt; type_ids: 0 0 0 0 0 0 0 0 1 1 1 1 1 1</span></span><br><span class="line">      segment_ids = [sequence_a_segment_id] * len(tokens)</span><br><span class="line">    </span><br><span class="line">      <span class="comment"># [CLS] 添加到句首还是句末</span></span><br><span class="line">      <span class="keyword">if</span> cls_token_at_end:</span><br><span class="line">          tokens += [cls_token]</span><br><span class="line">          label_ids += [pad_token_label_id]</span><br><span class="line">          segment_ids += [cls_token_segment_id]</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">          tokens = [cls_token] + tokens</span><br><span class="line">          label_ids = [pad_token_label_id] + label_ids</span><br><span class="line">          segment_ids = [cls_token_segment_id] + segment_ids</span><br><span class="line">    </span><br><span class="line">      <span class="comment"># 把词转化成token id</span></span><br><span class="line">      input_ids = tokenizer.convert_tokens_to_ids(tokens)</span><br><span class="line">  </span><br><span class="line">      <span class="comment"># The mask has 1 for real tokens and 0 for padding tokens. Only real tokens are attended to.</span></span><br><span class="line">      input_mask = [<span class="number">1</span> <span class="keyword">if</span> mask_padding_with_zero <span class="keyword">else</span> <span class="number">0</span>] * len(input_ids)</span><br><span class="line">  </span><br><span class="line">      <span class="comment"># 添加0padding到句子最大长度</span></span><br><span class="line">      padding_length = max_seq_length - len(input_ids)</span><br><span class="line">      <span class="comment"># 在句子的左边padding 0 还是在句子的右边padding 0</span></span><br><span class="line">      <span class="keyword">if</span> pad_on_left:</span><br><span class="line">          input_ids = ([pad_token] * padding_length) + input_ids</span><br><span class="line">          input_mask = ([<span class="number">0</span> <span class="keyword">if</span> mask_padding_with_zero <span class="keyword">else</span> <span class="number">1</span>] * padding_length) + input_mask</span><br><span class="line">          segment_ids = ([pad_token_segment_id] * padding_length) + segment_ids</span><br><span class="line">          label_ids = ([pad_token_label_id] * padding_length) + label_ids</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">          input_ids += [pad_token] * padding_length</span><br><span class="line">          input_mask += [<span class="number">0</span> <span class="keyword">if</span> mask_padding_with_zero <span class="keyword">else</span> <span class="number">1</span>] * padding_length</span><br><span class="line">          segment_ids += [pad_token_segment_id] * padding_length</span><br><span class="line">          label_ids += [pad_token_label_id] * padding_length</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">assert</span> len(input_ids) == max_seq_length</span><br><span class="line">      <span class="keyword">assert</span> len(input_mask) == max_seq_length</span><br><span class="line">      <span class="keyword">assert</span> len(segment_ids) == max_seq_length</span><br><span class="line">      <span class="keyword">assert</span> len(label_ids) == max_seq_length</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">if</span> ex_index &lt; <span class="number">5</span>:</span><br><span class="line">          logger.info(<span class="string">"*** Example ***"</span>)</span><br><span class="line">          logger.info(<span class="string">"guid: %s"</span>, example.guid)</span><br><span class="line">          logger.info(<span class="string">"tokens: %s"</span>, <span class="string">" "</span>.join([str(x) <span class="keyword">for</span> x <span class="keyword">in</span> tokens]))</span><br><span class="line">          logger.info(<span class="string">"input_ids: %s"</span>, <span class="string">" "</span>.join([str(x) <span class="keyword">for</span> x <span class="keyword">in</span> input_ids]))</span><br><span class="line">          logger.info(<span class="string">"input_mask: %s"</span>, <span class="string">" "</span>.join([str(x) <span class="keyword">for</span> x <span class="keyword">in</span> input_mask]))</span><br><span class="line">          logger.info(<span class="string">"segment_ids: %s"</span>, <span class="string">" "</span>.join([str(x) <span class="keyword">for</span> x <span class="keyword">in</span> segment_ids]))</span><br><span class="line">          logger.info(<span class="string">"label_ids: %s"</span>, <span class="string">" "</span>.join([str(x) <span class="keyword">for</span> x <span class="keyword">in</span> label_ids]))</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">if</span> <span class="string">"token_type_ids"</span> <span class="keyword">not</span> <span class="keyword">in</span> tokenizer.model_input_names:</span><br><span class="line">          segment_ids = <span class="literal">None</span></span><br><span class="line">  </span><br><span class="line">      features.append(</span><br><span class="line">          InputFeatures(</span><br><span class="line">              input_ids=input_ids, attention_mask=input_mask, token_type_ids=segment_ids, label_ids=label_ids</span><br><span class="line">          )</span><br><span class="line">      )</span><br><span class="line">  <span class="keyword">return</span> features</span><br></pre></td></tr></table></figure>
<h3 id="step-3-Dataset"><a href="#step-3-Dataset" class="headerlink" title="step 3:Dataset"></a>step 3:Dataset</h3><p>有了样本和特征，构建数据集类。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NerDataset</span><span class="params">(Dataset)</span>:</span></span><br><span class="line">    features: List[InputFeatures]</span><br><span class="line">    <span class="comment"># 对于pad的部分不计算损失 </span></span><br><span class="line">    pad_token_label_id: int = nn.CrossEntropyLoss().ignore_index</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        self,</span></span></span><br><span class="line"><span class="function"><span class="params">        data_dir: str,</span></span></span><br><span class="line"><span class="function"><span class="params">        tokenizer: PreTrainedTokenizer,</span></span></span><br><span class="line"><span class="function"><span class="params">        labels: List[str],</span></span></span><br><span class="line"><span class="function"><span class="params">        model_type: str,</span></span></span><br><span class="line"><span class="function"><span class="params">        max_seq_length: Optional[int] = None,</span></span></span><br><span class="line"><span class="function"><span class="params">        overwrite_cache=False,</span></span></span><br><span class="line"><span class="function"><span class="params">        mode: Split = Split.train,</span></span></span><br><span class="line"><span class="function"><span class="params">        local_rank=<span class="number">-1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        )</span>:</span></span><br><span class="line">        <span class="comment"># 加载数据集文件</span></span><br><span class="line">        cached_features_file = os.path.join(data_dir, <span class="string">"cached_&#123;&#125;_&#123;&#125;_&#123;&#125;"</span>.format(mode.value, tokenizer.__class__.__name__, str(max_seq_length)), )</span><br><span class="line">        <span class="keyword">with</span> torch_distributed_zero_first(local_rank):</span><br><span class="line">        <span class="comment"># Make sure only the first process in distributed training processes the dataset,</span></span><br><span class="line">        <span class="comment"># and the others will use the cache.</span></span><br><span class="line">            <span class="keyword">if</span> os.path.exists(cached_features_file) <span class="keyword">and</span> <span class="keyword">not</span> overwrite_cache:</span><br><span class="line">                logger.info(<span class="string">f"Loading features from cached file <span class="subst">&#123;cached_features_file&#125;</span>"</span>)</span><br><span class="line">                self.features = torch.load(cached_features_file)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                logger.info(<span class="string">f"Creating features from dataset file at <span class="subst">&#123;data_dir&#125;</span>"</span>)</span><br><span class="line">                examples = read_examples_from_file(data_dir, mode)</span><br><span class="line">                <span class="comment"># TODO clean up all this to leverage built-in features of tokenizers</span></span><br><span class="line">                self.features = convert_examples_to_features(</span><br><span class="line">                    examples,</span><br><span class="line">                    labels,</span><br><span class="line">                    max_seq_length,</span><br><span class="line">                    tokenizer,</span><br><span class="line">                    cls_token_at_end=bool(model_type <span class="keyword">in</span> [<span class="string">"xlnet"</span>]),</span><br><span class="line">                    <span class="comment"># xlnet has a cls token at the end</span></span><br><span class="line">                    cls_token=tokenizer.cls_token,</span><br><span class="line">                    cls_token_segment_id=<span class="number">2</span> <span class="keyword">if</span> model_type <span class="keyword">in</span> [<span class="string">"xlnet"</span>] <span class="keyword">else</span> <span class="number">0</span>,</span><br><span class="line">                    sep_token=tokenizer.sep_token,</span><br><span class="line">                    sep_token_extra=bool(model_type <span class="keyword">in</span> [<span class="string">"roberta"</span>]),</span><br><span class="line">                    <span class="comment"># roberta uses an extra separator b/w pairs of sentences, cf. github.com/pytorch/fairseq/commit/1684e166e3da03f5b600dbb7855cb98ddfcd0805</span></span><br><span class="line">                    pad_on_left=bool(tokenizer.padding_side == <span class="string">"left"</span>),</span><br><span class="line">                    pad_token=tokenizer.pad_token_id,</span><br><span class="line">                    pad_token_segment_id=tokenizer.pad_token_type_id,</span><br><span class="line">                    pad_token_label_id=self.pad_token_label_id,</span><br><span class="line">                )</span><br><span class="line">                <span class="comment"># 保存0卡上的数据到缓存</span></span><br><span class="line">                <span class="keyword">if</span> local_rank <span class="keyword">in</span> [<span class="number">-1</span>, <span class="number">0</span>]:</span><br><span class="line">                    logger.info(<span class="string">f"Saving features into cached file <span class="subst">&#123;cached_features_file&#125;</span>"</span>)</span><br><span class="line">                    torch.save(self.features, cached_features_file)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.features)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, i)</span> -&gt; InputFeatures:</span></span><br><span class="line">        <span class="keyword">return</span> self.features[i]</span><br></pre></td></tr></table></figure>
<h2 id="BertModel"><a href="#BertModel" class="headerlink" title="BertModel"></a>BertModel</h2><p><img src="/2020/05/13/bert_code/BertModel.png" alt></p>
<p>从整体来看BertModel由三部分组成：BertEmbeddings、BertEncoder、BertPooler,需要注意<code>attention_mask和head_mask</code>的处理。</p>
<p>forward：(符号’是可以为None的意思)</p>
<ul>
<li><p>接收参数：<code>inputs，segment，mask&#39;，position_ids&#39;，head_mask&#39;</code></p>
</li>
<li><p>输出：<code>元组 (最后一层的隐变量，最后一层第一个token的隐变量，最后一层的隐变量或每一层attentions 权重参数)</code></p>
</li>
<li><p>过程:<code>embedding-&gt;encoder-&gt;pooler</code></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertModel</span><span class="params">(BertPreTrainedModel)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, config)</span>:</span></span><br><span class="line">        super().__init__(config)</span><br><span class="line">        self.config = config</span><br><span class="line"></span><br><span class="line">        self.embeddings = BertEmbeddings(config)</span><br><span class="line">        self.encoder = BertEncoder(config)</span><br><span class="line">        self.pooler = BertPooler(config)</span><br><span class="line"></span><br><span class="line">        self.init_weights()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_input_embeddings</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.embeddings.word_embeddings</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_input_embeddings</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.embeddings.word_embeddings = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_prune_heads</span><span class="params">(self, heads_to_prune)</span>:</span></span><br><span class="line">        <span class="string">""" E.g. &#123;1: [0, 2], 2: [2, 3]&#125; will prune heads 0 and 2 on layer 1 and heads 2 and 3 on layer 2.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">for</span> layer, heads <span class="keyword">in</span> heads_to_prune.items():</span><br><span class="line">            self.encoder.layer[layer].attention.prune_heads(heads)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @add_start_docstrings_to_callable(BERT_INPUTS_DOCSTRING)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,input_ids=None,attention_mask=None,token_type_ids=None,position_ids=None,</span></span></span><br><span class="line"><span class="function"><span class="params">        head_mask=None,inputs_embeds=None,encoder_hidden_states=None,encoder_attention_mask=None,)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        参数：</span></span><br><span class="line"><span class="string">        head_mask: head_mask has shape [num_heads] or [num_hidden_layers x num_heads]</span></span><br><span class="line"><span class="string">        encoder_hidden_states: encoder 的输出</span></span><br><span class="line"><span class="string">        encoder_attention_mask:</span></span><br><span class="line"><span class="string">        返回值：</span></span><br><span class="line"><span class="string">        last_hidden_state :[batch_size, sequence_length, hidden_size]，是序列在模型最后一层的输出的隐藏层</span></span><br><span class="line"><span class="string">        pooler_output :[batch_size, hidden_size]:[CLS]对应的隐状态的输出，由于这个token是用来做NSP任务的，这个输出通常不能很好的summary 整个序列的语义，如果想要获取整句话的语义通常需要对整个序列取平均或者池化。</span></span><br><span class="line"><span class="string">        hidden_states:[batch_size, sequence_length, hidden_size],embedding + output of each layer.</span></span><br><span class="line"><span class="string">        attention:[batch_size, num_heads, sequence_length, sequence_length],矩阵的权值是经过softmax的。</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> input_ids <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> inputs_embeds <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"You cannot specify both input_ids and inputs_embeds at the same time"</span>)</span><br><span class="line">        <span class="keyword">elif</span> input_ids <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            input_shape = input_ids.size()</span><br><span class="line">        <span class="keyword">elif</span> inputs_embeds <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            input_shape = inputs_embeds.size()[:<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"You have to specify either input_ids or inputs_embeds"</span>)</span><br><span class="line"></span><br><span class="line">        device = input_ids.device <span class="keyword">if</span> input_ids <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> inputs_embeds.device</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> attention_mask <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># 全部mask成 1</span></span><br><span class="line">            attention_mask = torch.ones(input_shape, device=device)</span><br><span class="line">        <span class="keyword">if</span> token_type_ids <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># 全表示成0（第一句）</span></span><br><span class="line">            token_type_ids = torch.zeros(input_shape, dtype=torch.long, device=device)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 1. attention_mask:[bs,seq_len] --&gt; [bs,num_heads,seq_len,seq_len]</span></span><br><span class="line">        <span class="comment"># 2. attention_value:1 --&gt; 0, 0--&gt;-10000,这样做的目的是为了和算出来的score（没有经过softmax）相加，相当于从序列中移除掉了mask的内容。</span></span><br><span class="line">        extended_attention_mask: torch.Tensor = self.get_extended_attention_mask(attention_mask, input_shape, self.device)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.config.is_decoder <span class="keyword">and</span> encoder_hidden_states <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            encoder_batch_size, encoder_sequence_length, _ = encoder_hidden_states.size()</span><br><span class="line">            encoder_hidden_shape = (encoder_batch_size, encoder_sequence_length) <span class="comment"># [bs,seq_len]</span></span><br><span class="line">            <span class="keyword">if</span> encoder_attention_mask <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                encoder_attention_mask = torch.ones(encoder_hidden_shape, device=device)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 1. attention_mask:[bs,seq_len] --&gt; [bs,num_heads,seq_len,seq_len]</span></span><br><span class="line">            <span class="comment"># 2. attention_value:1 --&gt; 0, 0--&gt;-10000,这样做的目的是为了和算出来的score（没有经过softmax）相加，相当于从序列中移除掉了mask的内容。</span></span><br><span class="line">            encoder_extended_attention_mask = self.invert_attention_mask(encoder_attention_mask)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            encoder_extended_attention_mask = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># input head_mask： [num_heads] or [num_hidden_layers x num_heads]，1表示保留这个head。</span></span><br><span class="line">        <span class="comment"># 因为有多个head，每个head都需要mask序列中哪些是token，哪些是padding，所以需要转化head_mask为：[num_hidden_layers,bsz,num_heads,seq_length,seq_length]</span></span><br><span class="line">        head_mask = self.get_head_mask(head_mask, self.config.num_hidden_layers)</span><br><span class="line"></span><br><span class="line">        embedding_output = self.embeddings(</span><br><span class="line">            input_ids=input_ids, position_ids=position_ids, token_type_ids=token_type_ids, inputs_embeds=inputs_embeds</span><br><span class="line">        )</span><br><span class="line">        encoder_outputs = self.encoder(</span><br><span class="line">            embedding_output,</span><br><span class="line">            attention_mask=extended_attention_mask,</span><br><span class="line">            head_mask=head_mask,</span><br><span class="line">            encoder_hidden_states=encoder_hidden_states,</span><br><span class="line">            encoder_attention_mask=encoder_extended_attention_mask,</span><br><span class="line">        )</span><br><span class="line">        sequence_output = encoder_outputs[<span class="number">0</span>]</span><br><span class="line">        pooled_output = self.pooler(sequence_output)</span><br><span class="line">        <span class="comment"># add hidden_states and attentions if they are here</span></span><br><span class="line">        outputs = (sequence_output, pooled_output,) + encoder_outputs[<span class="number">1</span>:]  </span><br><span class="line">        <span class="keyword">return</span> outputs  <span class="comment"># sequence_output, pooled_output, (hidden_states), (attentions)</span></span><br></pre></td></tr></table></figure>
<h3 id="BertEmbeddings"><a href="#BertEmbeddings" class="headerlink" title="BertEmbeddings"></a>BertEmbeddings</h3><p>从Bert的论文中可以知道，Bert的词向量主要是由三个向量相加组合而成，分别是单词本身的向量，单词所在句子中位置的向量和句子所在单个训练文本中位置的向量。这样做的好处主要可以解决只有词向量时碰见多义词时模型预测不准的问题。</p>
<p><img src="/2020/05/13/bert_code/bert-input-representation.png" alt></p>
<p>forward：(符号’是可以为None的意思)</p>
<ul>
<li><p>接收参数：<code>inputs，segment&#39;，position_ids&#39;</code></p>
</li>
<li><p>输出：<code>words+position+segment的embedding</code></p>
</li>
<li><p>过程:<code>调用nn.Embedding构造words、position、segment的embedding -&gt; 三个embedding相加 -&gt; 规范化 LayerNorm（关联类BertLayerNorm）-&gt; dropout</code></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertEmbeddings</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"""Construct the embeddings from word, position and token_type embeddings.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, config)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.word_embeddings = nn.Embedding(config.vocab_size, config.hidden_size, padding_idx=config.pad_token_id)</span><br><span class="line">        self.position_embeddings = nn.Embedding(config.max_position_embeddings, config.hidden_size)</span><br><span class="line">        self.token_type_embeddings = nn.Embedding(config.type_vocab_size, config.hidden_size)</span><br><span class="line">        </span><br><span class="line">        self.LayerNorm = BertLayerNorm(config.hidden_size, eps=config.layer_norm_eps)</span><br><span class="line">        self.dropout = nn.Dropout(config.hidden_dropout_prob)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, input_ids=None, token_type_ids=None, position_ids=None, inputs_embeds=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> input_ids <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            input_shape = input_ids.size()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            input_shape = inputs_embeds.size()[:<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">        seq_length = input_shape[<span class="number">1</span>]</span><br><span class="line">        device = input_ids.device <span class="keyword">if</span> input_ids <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> inputs_embeds.device</span><br><span class="line">        <span class="keyword">if</span> position_ids <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># 生成token 的 index 信息。[seq_len]</span></span><br><span class="line">            position_ids = torch.arange(seq_length, dtype=torch.long, device=device)</span><br><span class="line">            position_ids = position_ids.unsqueeze(<span class="number">0</span>).expand(input_shape) <span class="comment">#[bs,seq_len]</span></span><br><span class="line">        <span class="keyword">if</span> token_type_ids <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            token_type_ids = torch.zeros(input_shape, dtype=torch.long, device=device)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> inputs_embeds <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            inputs_embeds = self.word_embeddings(input_ids)</span><br><span class="line">        position_embeddings = self.position_embeddings(position_ids)</span><br><span class="line">        token_type_embeddings = self.token_type_embeddings(token_type_ids)</span><br><span class="line"></span><br><span class="line">        embeddings = inputs_embeds + position_embeddings + token_type_embeddings</span><br><span class="line">        <span class="comment"># BertLayerNorm = torch.nn.LayerNorm</span></span><br><span class="line">        embeddings = self.LayerNorm(embeddings)</span><br><span class="line">        embeddings = self.dropout(embeddings)</span><br><span class="line">        <span class="keyword">return</span> embeddings</span><br></pre></td></tr></table></figure>
<p>从forward函数开始看，先有一个torch.arange函数。<code>torch.arange(seq_length, dtype=torch.long, device=input_ids.device)</code>来生成token 的index 信息,<span class="label danger">和transformer中的Positional Embedding不同，bert这里的positional embedding 需要通过训练进行学习，transformer中的positional embedding是使用公式计算出来的</span>(可以参考<a href="/2020/05/11/transformer/" title="Transformer">Transformer</a> 的Positional Embedding来进行比较)。此外，LayerNorm的数学表达为：$y = \frac{x - \mathrm{E}[x]}{ \sqrt{\mathrm{Var}[x] + \epsilon}} * \gamma + \beta$，$\gamma,\beta$可以通过仿射变换来进行学习。</p>
<h3 id="BertEncoder"><a href="#BertEncoder" class="headerlink" title="BertEncoder"></a>BertEncoder</h3><p>下面代码将原有的BertLayer一层一层剥开，如果想要输出每层的状态（output_hidden_states=True），则对hidden_states 进行累加，如果（output_hidden_states=False）则只与最后一层的状态相加。BertEncoder类，其实只是用来输出BertLayer类的状态的一个函数。真正模型内部的东西在BertLayer类中。</p>
<p>forward：(符号’是可以为None的意思)</p>
<ul>
<li><p>接收参数：<code>hidden_states（由BetEmbeddings输出），attention_mask，head_mask</code></p>
</li>
<li><p>输出：<code>元组 (最后一层隐变量+每层隐变量) 或者 (最后一层attention+每一层attention)</code></p>
</li>
<li><p>过程:<code>调用modulelist类实例layer使得每一层输出（关联类BertLayer）-&gt; 保存所有层的attention输出 和 隐变量 -&gt; 返回元组，元组第一个是最后一层的attention或hidden，再往后是每层的。</code></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertEncoder</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, config)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.output_attentions = config.output_attentions</span><br><span class="line">        self.output_hidden_states = config.output_hidden_states</span><br><span class="line">        self.layer = nn.ModuleList([BertLayer(config) <span class="keyword">for</span> _ <span class="keyword">in</span> range(config.num_hidden_layers)])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,hidden_states,attention_mask=None,head_mask=None,encoder_hidden_states=None,encoder_attention_mask=None,)</span>:</span></span><br><span class="line">        all_hidden_states = ()</span><br><span class="line">        all_attentions = ()</span><br><span class="line">        <span class="comment"># 将原有的BertLayer一层一层剥开</span></span><br><span class="line">        <span class="comment"># 如果想要输出每层的状态（output_hidden_states=True），则对hidden_states 进行累加</span></span><br><span class="line">        <span class="comment"># 如果（output_hidden_states=False）则只与最后一层的状态相加。</span></span><br><span class="line">        <span class="keyword">for</span> i, layer_module <span class="keyword">in</span> enumerate(self.layer):</span><br><span class="line">            <span class="keyword">if</span> self.output_hidden_states:</span><br><span class="line">                all_hidden_states = all_hidden_states + (hidden_states,)</span><br><span class="line"></span><br><span class="line">            layer_outputs = layer_module(hidden_states, attention_mask, head_mask[i], encoder_hidden_states, encoder_attention_mask)</span><br><span class="line">            hidden_states = layer_outputs[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> self.output_attentions:</span><br><span class="line">                all_attentions = all_attentions + (layer_outputs[<span class="number">1</span>],)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Add last layer</span></span><br><span class="line">        <span class="keyword">if</span> self.output_hidden_states:</span><br><span class="line">            all_hidden_states = all_hidden_states + (hidden_states,)</span><br><span class="line"></span><br><span class="line">        outputs = (hidden_states,)</span><br><span class="line">        <span class="keyword">if</span> self.output_hidden_states:</span><br><span class="line">            outputs = outputs + (all_hidden_states,)</span><br><span class="line">        <span class="keyword">if</span> self.output_attentions:</span><br><span class="line">            outputs = outputs + (all_attentions,)</span><br><span class="line">        <span class="keyword">return</span> outputs  <span class="comment"># last-layer hidden state, (all hidden states), (all attentions)</span></span><br></pre></td></tr></table></figure>
<h4 id="BertLayer"><a href="#BertLayer" class="headerlink" title="BertLayer"></a>BertLayer</h4><p>BertLayer 由三部分组成：<code>BertAttention，BertIntermeidiate，BertOutput</code>。</p>
<p>forward：(符号’是可以为None的意思)</p>
<ul>
<li><p>接收参数：<code>hidden_states（由上层BertLayer输出），attention_mask，head_mask</code></p>
</li>
<li><p>输出：<code>元组，(本层输出的隐变量，本层输出的attention)</code></p>
</li>
<li><p>过程:<code>调用attention得到attention_outputs -&gt; 取第一维attention_output[0]作为intermediate的参数 -&gt;调用intermediate-&gt; 调用output得到layer_output -&gt; layer_output 和 attention_outputs[1:]合并成元组返回</code></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertLayer</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, config)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.attention = BertAttention(config)</span><br><span class="line">        self.is_decoder = config.is_decoder</span><br><span class="line">        <span class="keyword">if</span> self.is_decoder:</span><br><span class="line">            self.crossattention = BertAttention(config)</span><br><span class="line">        self.intermediate = BertIntermediate(config)</span><br><span class="line">        self.output = BertOutput(config)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,hidden_states,attention_mask=None,head_mask=None,encoder_hidden_states=None,encoder_attention_mask=None,)</span>:</span></span><br><span class="line">        self_attention_outputs = self.attention(hidden_states, attention_mask, head_mask)</span><br><span class="line">        attention_output = self_attention_outputs[<span class="number">0</span>]</span><br><span class="line">        outputs = self_attention_outputs[<span class="number">1</span>:]  <span class="comment"># add self attentions if we output attention weights</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.is_decoder <span class="keyword">and</span> encoder_hidden_states <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            cross_attention_outputs = self.crossattention(</span><br><span class="line">                attention_output, attention_mask, head_mask, encoder_hidden_states, encoder_attention_mask</span><br><span class="line">            )</span><br><span class="line">            attention_output = cross_attention_outputs[<span class="number">0</span>]</span><br><span class="line">            outputs = outputs + cross_attention_outputs[<span class="number">1</span>:]  <span class="comment"># add cross attentions if we output attention weights</span></span><br><span class="line"></span><br><span class="line">        intermediate_output = self.intermediate(attention_output)</span><br><span class="line">        layer_output = self.output(intermediate_output, attention_output)</span><br><span class="line">        outputs = (layer_output,) + outputs</span><br><span class="line">        <span class="keyword">return</span> outputs</span><br></pre></td></tr></table></figure>
<p>从forward开始看，依次进入BertAttention，BertIntermediate和BertOutput这三个类。</p>
<h5 id="BertAttention"><a href="#BertAttention" class="headerlink" title="BertAttention"></a>BertAttention</h5><p>这个类由两个类组成：<code>BertSelfAttention,BertSelfOutput</code>.</p>
<p>forward：(符号’是可以为None的意思)</p>
<ul>
<li><p>接收参数：<code>input_tensor(就是BertLayer的hidden_states)，mask，head_mask&#39;</code></p>
</li>
<li><p>输出：<code>返回元组（attention_output，self_outputs[1:]）第一个是语义向量，第二个是概率</code></p>
</li>
<li><p>过程:<code>selfattention得到 self_outputs-&gt; 以self_outputs[0]作为参数调用selfoutput得到 attention_output-&gt; 返回元组（attention_output，self_outputs[1:]）第一个是语义向量，第二个是概率</code></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertAttention</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, config)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.self_att = BertSelfAttention(config)</span><br><span class="line">        self.output = BertSelfOutput(config)</span><br><span class="line">        self.pruned_heads = set()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prune_heads</span><span class="params">(self, heads)</span>:</span> <span class="comment"># </span></span><br><span class="line">        <span class="keyword">if</span> len(heads) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        mask = torch.ones(self.self_att.num_attention_heads, self.self_att.attention_head_size)</span><br><span class="line">        heads = set(heads) - self.pruned_heads  </span><br><span class="line">        <span class="keyword">for</span> head <span class="keyword">in</span> heads:</span><br><span class="line">            <span class="comment"># Compute how many pruned heads are before the head and move the index accordingly</span></span><br><span class="line">            head = head - sum(<span class="number">1</span> <span class="keyword">if</span> h &lt; head <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> h <span class="keyword">in</span> self.pruned_heads)</span><br><span class="line">            mask[head] = <span class="number">0</span></span><br><span class="line">        mask = mask.view(<span class="number">-1</span>).contiguous().eq(<span class="number">1</span>)</span><br><span class="line">        index = torch.arange(len(mask))[mask].long()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Prune linear layers</span></span><br><span class="line">        self.self_att.query = prune_linear_layer(self.self_att.query, index)</span><br><span class="line">        self.self_att.key = prune_linear_layer(self.self_att.key, index)</span><br><span class="line">        self.self_att.value = prune_linear_layer(self.self_att.value, index)</span><br><span class="line">        self.output.dense = prune_linear_layer(self.output.dense, index, dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Update hyper params and store pruned heads</span></span><br><span class="line">        self.self_att.num_attention_heads = self.self_att.num_attention_heads - len(heads)</span><br><span class="line">        self.self_att.all_head_size = self.self_att.attention_head_size * self.self_att.num_attention_heads</span><br><span class="line">        self.pruned_heads = self.pruned_heads.union(heads)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,hidden_states,attention_mask=None,head_mask=None,encoder_hidden_states=None,encoder_attention_mask=None,)</span>:</span></span><br><span class="line">        self_outputs = self.self_att(</span><br><span class="line">            hidden_states, attention_mask, head_mask, encoder_hidden_states, encoder_attention_mask</span><br><span class="line">        )</span><br><span class="line">        attention_output = self.output(self_outputs[<span class="number">0</span>], hidden_states)</span><br><span class="line">        outputs = (attention_output,) + self_outputs[<span class="number">1</span>:]  <span class="comment"># add attentions if we output them</span></span><br><span class="line">        <span class="keyword">return</span> outputs</span><br></pre></td></tr></table></figure>
<h6 id="BertSelfAttention"><a href="#BertSelfAttention" class="headerlink" title="BertSelfAttention"></a>BertSelfAttention</h6><p>forward：(符号’是可以为None的意思)</p>
<ul>
<li><p>接收参数：<code>hidden_states(由BertLayer输出),mask，head_mask</code></p>
</li>
<li><p>输出：<code>返回元组（context_layer语义向量，attention_prob概率）第一个是语义向量，第二个是概率</code></p>
</li>
<li><p>过程:<code>self-attention 过程</code></p>
</li>
</ul>
<p><img src="/2020/05/13/bert_code/image-20200515100926049.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertSelfAttention</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, config)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        <span class="keyword">if</span> config.hidden_size % config.num_attention_heads != <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">not</span> hasattr(config, <span class="string">"embedding_size"</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(</span><br><span class="line">                <span class="string">"The hidden size (%d) is not a multiple of the number of attention "</span></span><br><span class="line">                <span class="string">"heads (%d)"</span> % (config.hidden_size, config.num_attention_heads)</span><br><span class="line">            )</span><br><span class="line">        </span><br><span class="line">        self.output_attentions = config.output_attentions</span><br><span class="line">        <span class="comment"># 12</span></span><br><span class="line">        self.num_attention_heads = config.num_attention_heads</span><br><span class="line">        <span class="comment"># 64 = 768/12 </span></span><br><span class="line">        self.attention_head_size = int(config.hidden_size / config.num_attention_heads)</span><br><span class="line">        <span class="comment"># 768 = 12 * 64</span></span><br><span class="line">        self.all_head_size = self.num_attention_heads * self.attention_head_size</span><br><span class="line"></span><br><span class="line">        self.query = nn.Linear(config.hidden_size, self.all_head_size)</span><br><span class="line">        self.key = nn.Linear(config.hidden_size, self.all_head_size)</span><br><span class="line">        self.value = nn.Linear(config.hidden_size, self.all_head_size)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(config.attention_probs_dropout_prob)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">transpose_for_scores</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="comment"># x:[bs,seq_len,768]--&gt; x:[bs,seq_len, 12, 64]   multi-head</span></span><br><span class="line">        new_x_shape = x.size()[:<span class="number">-1</span>] + (self.num_attention_heads, self.attention_head_size)</span><br><span class="line">        x = x.view(*new_x_shape)</span><br><span class="line">        <span class="keyword">return</span> x.permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,hidden_states,attention_mask=None,head_mask=None,encoder_hidden_states=None,encoder_attention_mask=None, )</span>:</span></span><br><span class="line">        mixed_query_layer = self.query(hidden_states)</span><br><span class="line">    <span class="comment"># q,k,v</span></span><br><span class="line">        <span class="keyword">if</span> encoder_hidden_states <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            mixed_key_layer = self.key(encoder_hidden_states)</span><br><span class="line">            mixed_value_layer = self.value(encoder_hidden_states)</span><br><span class="line">            attention_mask = encoder_attention_mask</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            mixed_key_layer = self.key(hidden_states)</span><br><span class="line">            mixed_value_layer = self.value(hidden_states)</span><br><span class="line">    </span><br><span class="line">        <span class="comment"># multi-head </span></span><br><span class="line">        query_layer = self.transpose_for_scores(mixed_query_layer) <span class="comment"># [bs,seq_len, 12, 64]</span></span><br><span class="line">        key_layer = self.transpose_for_scores(mixed_key_layer) <span class="comment"># [bs,seq_len, 12, 64]</span></span><br><span class="line">        value_layer = self.transpose_for_scores(mixed_value_layer) <span class="comment"># [bs,seq_len, 12, 64]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 得到权值矩阵</span></span><br><span class="line">        attention_scores = torch.matmul(query_layer, key_layer.transpose(<span class="number">-1</span>, <span class="number">-2</span>))</span><br><span class="line">        attention_scores = attention_scores / math.sqrt(self.attention_head_size)</span><br><span class="line">        <span class="keyword">if</span> attention_mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># 用求和的方式，因为在attention_mask 中：1--&gt;0,0--&gt;-10000.</span></span><br><span class="line">            attention_scores = attention_scores + attention_mask</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 对最后一个维度用 softmax 计算概率</span></span><br><span class="line">        attention_probs = nn.Softmax(dim=<span class="number">-1</span>)(attention_scores)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># This is actually dropping out entire tokens to attend to, which might</span></span><br><span class="line">        <span class="comment"># seem a bit unusual, but is taken from the original Transformer paper .</span></span><br><span class="line">        attention_probs = self.dropout(attention_probs)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># </span></span><br><span class="line">        <span class="keyword">if</span> head_mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            attention_probs = attention_probs * head_mask</span><br><span class="line"></span><br><span class="line">        context_layer = torch.matmul(attention_probs, value_layer)</span><br><span class="line"></span><br><span class="line">        context_layer = context_layer.permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>).contiguous()</span><br><span class="line">        <span class="comment"># [bs,seq_len,12,64]--&gt; x:[bs,seq_len, 768]   把multi-head 再拼接回去</span></span><br><span class="line">        new_context_layer_shape = context_layer.size()[:<span class="number">-2</span>] + (self.all_head_size,)</span><br><span class="line">        context_layer = context_layer.view(*new_context_layer_shape)</span><br><span class="line"></span><br><span class="line">        outputs = (context_layer, attention_probs) <span class="keyword">if</span> self.output_attentions <span class="keyword">else</span> (context_layer,)</span><br><span class="line">        <span class="keyword">return</span> outputs</span><br></pre></td></tr></table></figure>
<h6 id="BertSelfOutput"><a href="#BertSelfOutput" class="headerlink" title="BertSelfOutput"></a>BertSelfOutput</h6><p>forward：(符号’是可以为None的意思)</p>
<ul>
<li><p>接收参数：<code>hidden_states（由BertSelfAttention输出）, input_tensor（就是BertAttention的input_tensor，也就是BertSelfAttention的输入）</code></p>
</li>
<li><p>输出：<code>hidden_states</code></p>
</li>
<li><p>过程:<code>对hidden_states加一层dense -&gt; dropout -&gt; 得到的hidden_states与input_tensor相加做LayerNorm #这种做法说是为了避免梯度消失，也就是曾经的残差网络解决办法：output=output+Q</code></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertSelfOutput</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, config)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.dense = nn.Linear(config.hidden_size, config.hidden_size)</span><br><span class="line">        self.LayerNorm = BertLayerNorm(config.hidden_size, eps=config.layer_norm_eps)</span><br><span class="line">        self.dropout = nn.Dropout(config.hidden_dropout_prob)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, hidden_states, input_tensor)</span>:</span></span><br><span class="line">        hidden_states = self.dense(hidden_states)</span><br><span class="line">        hidden_states = self.dropout(hidden_states)</span><br><span class="line">        hidden_states = self.LayerNorm(hidden_states + input_tensor)</span><br><span class="line">        <span class="keyword">return</span> hidden_states</span><br></pre></td></tr></table></figure>
<h5 id="BertIntermediate"><a href="#BertIntermediate" class="headerlink" title="BertIntermediate"></a>BertIntermediate</h5><p>forward：(符号’是可以为None的意思)</p>
<ul>
<li><p>接收参数：<code>hidden_states(BertSelfOutput的输出)</code></p>
</li>
<li><p>输出：<code>hidden_states</code></p>
</li>
<li><p>过程:<code>对hidden_states加一层dense，向量输出大小为intermedia_size -&gt; 调用intermediate_act_fn，这个函数是由config.hidden_act得来，是gelu、relu、swish方法中的一个 #中间层存在的意义：推测是能够使模型从低至高学习到多层级信息，从表面信息到句法到语义。还有人研究说中间层的可迁移性更好。</code></p>
</li>
</ul>
<p>ACT2FN：激活函数:<code>{&quot;gelu&quot;: gelu, &quot;relu&quot;: torch.nn.functional.relu, &quot;swish&quot;: swish}</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertIntermediate</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, config)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.dense = nn.Linear(config.hidden_size, config.intermediate_size)</span><br><span class="line">        <span class="keyword">if</span> isinstance(config.hidden_act, str):</span><br><span class="line">            <span class="comment"># ACT2FN = &#123;"gelu": gelu, "relu": torch.nn.functional.relu, "swish": swish&#125;</span></span><br><span class="line">            self.intermediate_act_fn = ACT2FN[config.hidden_act]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.intermediate_act_fn = config.hidden_act</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, hidden_states)</span>:</span></span><br><span class="line">        hidden_states = self.dense(hidden_states)</span><br><span class="line">        hidden_states = self.intermediate_act_fn(hidden_states)</span><br><span class="line">        <span class="keyword">return</span> hidden_states</span><br></pre></td></tr></table></figure>
<h5 id="BertOutput"><a href="#BertOutput" class="headerlink" title="BertOutput"></a>BertOutput</h5><p>forward：(符号’是可以为None的意思)</p>
<ul>
<li><p>接收参数：<code>hidden_states（由BertAttention输出）, input_tensor</code></p>
</li>
<li><p>输出：<code>hidden_states</code></p>
</li>
<li><p>过程:<code>对hidden_states加一层dense ，由intermedia_size 又变回hidden_size -&gt; dropout -&gt; 得到的hidden_states与input_tensor相加做LayerNorm #这种做法说是为了避免梯度消失，也就是曾经的残差网络解决办法：output=output+Q。</code></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertOutput</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, config)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.dense = nn.Linear(config.intermediate_size, config.hidden_size)</span><br><span class="line">        self.LayerNorm = BertLayerNorm(config.hidden_size, eps=config.layer_norm_eps)</span><br><span class="line">        self.dropout = nn.Dropout(config.hidden_dropout_prob)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, hidden_states, input_tensor)</span>:</span></span><br><span class="line">        hidden_states = self.dense(hidden_states)</span><br><span class="line">        hidden_states = self.dropout(hidden_states)</span><br><span class="line">        hidden_states = self.LayerNorm(hidden_states + input_tensor)</span><br><span class="line">        <span class="keyword">return</span> hidden_states</span><br></pre></td></tr></table></figure>
<p>可以看到BertOutput是一个输入size是<code>config.intermediate_size</code>，输出size是<code>config.hidden_size</code>。又把size从BertIntermediate中的<code>config.intermediate_size</code>变回<code>config.hidden_size</code>。然后又接了一个Dropout和一个归一化。</p>
<h3 id="BertPooler"><a href="#BertPooler" class="headerlink" title="BertPooler"></a>BertPooler</h3><p>forward：(符号’是可以为None的意思)</p>
<ul>
<li>接收参数：<code>hidden_states（由BertAttention输出）, input_tensor</code></li>
<li>输出：<code>pooled_output</code></li>
<li>过程:<code>简单取第一个token -&gt; 加一层dense -&gt; Tanh激活函数输出</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertPooler</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, config)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.dense = nn.Linear(config.hidden_size, config.hidden_size)</span><br><span class="line">        self.activation = nn.Tanh()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, hidden_states)</span>:</span></span><br><span class="line">        first_token_tensor = hidden_states[:, <span class="number">0</span>]</span><br><span class="line">        pooled_output = self.dense(first_token_tensor)</span><br><span class="line">        pooled_output = self.activation(pooled_output)</span><br><span class="line">        <span class="keyword">return</span> pooled_output</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>数据流：</p>
<ol>
<li>输入的数据首先经过<strong>BertEmbeddings</strong>类。在BertEmbeddings中将每个单词变为words_embeddings + position_embeddings +token_type_embeddings三项embeddings的和。</li>
<li>然后，把已经变为词向量的数据输入BertSelfAttention类中。BertSelfAttention类中是一个Multi-Head Attention（少一个Linear层）， 也就是说数据流入这个<strong>少一个Linear层的Multi-Head Attention</strong>。</li>
<li>之后，数据流入BertSelfOutput类。BertSelfOutput是一个Linear+Dropout+LayerNorm。<strong>补齐了BertSelfAttention中少的那个Linear层</strong>，并且进行一次LayerNorm。</li>
<li>再之后，数据经过BertIntermediate(Linear层+激活函数)和BertOutput(Linear+Dropout+LayerNorm)。这样整个Transformer的部分就算完成了。</li>
<li>最后，取出最后一层的<code>[CLS]</code>对应的向量，经过<code>(Linear+Tanh)</code>,得到pooled_out</li>
</ol>
<p>关于bert的训练优化参考<a href="https://github.com/huggingface/transformers/blob/master/src/transformers/trainer.py" target="_blank" rel="noopener">链接</a></p>
<p>其余类：</p>
<ol>
<li><p>BertConfig</p>
<p>保存BERT的各种参数配置</p>
</li>
<li><p>BertOnlyMLMHead<br>使用mask 方法训练语言模型时用的，返回预测值<br>过程：调用BertLMPredictionHead，返回的就是prediction_scores</p>
</li>
<li><p>BertLMPredictionHead<br>decode功能<br>过程：调用BertPredictionHeadTransform -&gt; linear层，输出维度是vocab_size</p>
</li>
<li><p>BertPredictionHeadTransform<br>过程：dense -&gt; 激活(gelu or relu or swish) -&gt; LayerNorm</p>
</li>
<li><p>BertOnlyNSPHead<br>NSP策略训练模型用的，返回0或1<br>过程：添加linear层输出size是2，返回seq_relationship_score</p>
</li>
<li><p>BertPreTrainingHeads<br>MLM和NSP策略都写在里面，输入的是Encoder的输出sequence_output, pooled_output<br>返回（prediction_scores, seq_relationship_score）分别是MLM和NSP下的分值</p>
</li>
<li><p>BertPreTrainedModel<br>从全局变量BERT_PRETRAINED_MODEL_ARCHIVE_MAP加载BERT模型的权重</p>
</li>
<li><p>BertForPreTraining<br>计算score和loss<br>通过BertPreTrainingHeads，得到prediction后计算loss，然后反向传播。</p>
</li>
<li><p>BertForMaskedLM<br>只有MLM策略的loss</p>
</li>
<li><p>BertForNextSentencePrediction<br>只有NSP策略的loss</p>
</li>
<li><p>BertForSequenceClassification<br>计算句子分类任务的loss</p>
</li>
<li><p>BertForMultipleChoice<br>计算句子选择任务的loss</p>
</li>
<li><p>BertForTokenClassification<br>计算对token分类or标注任务的loss</p>
</li>
<li><p>BertForQuestionAnswering<br>计算问答任务的loss</p>
</li>
</ol>
<h3 id="使用预训练模型"><a href="#使用预训练模型" class="headerlink" title="使用预训练模型"></a>使用预训练模型</h3><p>在BertModel class中有两个函数。get_pool_output表示获取每个batch第一个词的[CLS]表示结果。BERT认为这个词包含了整条语料的信息；适用于句子级别的分类问题。get_sequence_output表示BERT最终的输出结果,shape为[batch_size,seq_length,hidden_size]。可以直观理解为对每条语料的最终表示，适用于seq2seq问题。<br>对于其它序列标注或生成任务，也可以使用 BERT 对应的输出信息作出预测，例如每一个时间步输出一个标注或词等。下图展示了 BERT 在 11 种任务中的微调方法，它们都只添加了一个额外的输出层。在下图中，Tok 表示不同的词、E 表示输入的嵌入向量、$T_i$表示第$i$ 个词在经过 BERT 处理后输出的上下文向量。</p>
<p><img src="/2020/05/13/bert_code/bert-specific-models.png" alt></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="http://fancyerii.github.io/2019/03/09/bert-codes/" target="_blank" rel="noopener">BERT代码阅读</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/56103665" target="_blank" rel="noopener">一起读Bert文本分类代码 </a></li>
<li><a href="https://daiwk.github.io/posts/nlp-bert.html#pytorch版本" target="_blank" rel="noopener">bert</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/75558363" target="_blank" rel="noopener">快速掌握BERT源代码（pytorch）</a></li>
</ol>
]]></content>
      <categories>
        <category>技术/自然语言处理</category>
      </categories>
      <tags>
        <tag>transformer</tag>
        <tag>bert</tag>
      </tags>
  </entry>
  <entry>
    <title>Transformer</title>
    <url>/2020/05/11/transformer/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2020/05/11/transformer/Cg-4jlOszDCIbmRNAAo_4amaeggAAOn7APf2hoACj_5550.jpg" alt></p>
<a id="more"></a>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>自2017年提出以来，Transformer在众多自然语言处理问题中取得了非常好的效果。它不但训练速度更快，而且更适合建模长距离依赖关系，因此大有取代循环或卷积神经网络，一统自然语言处理的深度模型江湖之势。本文结合<a href="https://arxiv.org/abs/1706.03762" target="_blank" rel="noopener">《Attention is all you need》</a>论文与Harvard的代码<a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html" target="_blank" rel="noopener">《Annotated Transformer》</a>深入理解transformer模型。 </p>
<h1 id="Transformer"><a href="#Transformer" class="headerlink" title="Transformer"></a>Transformer</h1><p>Transformer的整体结构如下图所示，在Encoder和Decoder中都使用了Self-attention, Point-wise和全连接层。Encoder和decoder的大致结构分别如下图的左半部分和右半部分所示。</p>
<p><img src="/2020/05/11/transformer/over_all.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_model</span><span class="params">(src_vocab, tgt_vocab, N=<span class="number">6</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">               d_model=<span class="number">512</span>, d_ff=<span class="number">2048</span>, h=<span class="number">8</span>, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Helper: Construct a model from hyperparameters.</span></span><br><span class="line"><span class="string">    src_vocab: 输入词汇表大小</span></span><br><span class="line"><span class="string">    tgt_vocab:输出词汇表大小</span></span><br><span class="line"><span class="string">    N：堆叠个数</span></span><br><span class="line"><span class="string">    d_model:embedding_size</span></span><br><span class="line"><span class="string">    d_ff: 线形层输出维度</span></span><br><span class="line"><span class="string">    h:multi-head中 head 的个数</span></span><br><span class="line"><span class="string">    dropout：</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    c = copy.deepcopy</span><br><span class="line">    attn = MultiHeadedAttention(h, d_model)</span><br><span class="line">    ff = PositionwiseFeedForward(d_model, d_ff, dropout)</span><br><span class="line">    position = PositionalEncoding(d_model, dropout)</span><br><span class="line">    model = EncoderDecoder(</span><br><span class="line">        Encoder(EncoderLayer(d_model, c(attn), c(ff), dropout), N), <span class="comment"># encoder</span></span><br><span class="line">        Decoder(DecoderLayer(d_model, c(attn), c(attn), c(ff), dropout), N), <span class="comment"># decoder</span></span><br><span class="line">        nn.Sequential(Embeddings(d_model, src_vocab), c(position)), <span class="comment"># src_embed</span></span><br><span class="line">        nn.Sequential(Embeddings(d_model, tgt_vocab), c(position)), <span class="comment"># tgt_embed</span></span><br><span class="line">        Generator(d_model, tgt_vocab) <span class="comment"># generator</span></span><br><span class="line">    		)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># This was important from their code. </span></span><br><span class="line">    <span class="comment"># Initialize parameters with Glorot / fan_avg.</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> model.parameters():</span><br><span class="line">        <span class="keyword">if</span> p.dim() &gt; <span class="number">1</span>:</span><br><span class="line">            nn.init.xavier_uniform(p)</span><br><span class="line">    <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure>
<h2 id="Embedding"><a href="#Embedding" class="headerlink" title="Embedding"></a>Embedding</h2><p>transformer的输入是<strong>Word Embedding + Position Embedding</strong>。</p>
<h3 id="Word-Embedding"><a href="#Word-Embedding" class="headerlink" title="Word Embedding"></a>Word Embedding</h3><p>Word embedding在pytorch中通常用 nn.Embedding 实现，其权重矩阵通常有两种选择：</p>
<ol>
<li>使用 Pre-trained的<strong>Embeddings并freeze</strong>，这种情况下实际就是一个 Lookup Table。</li>
<li>对其进行随机初始化(当然也可以选择 Pre-trained 的结果)，但<strong>设为 Trainable</strong>。这样在 training 过程中不断地对 Embeddings 进行改进。</li>
</ol>
<p>transformer选择后者，代码实现如下：</p>
<figure class="highlight python"><figcaption><span>word_embedding</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Embeddings</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, vocab)</span>:</span></span><br><span class="line">        super(Embeddings, self).__init__()</span><br><span class="line">        self.lut = nn.Embedding(vocab, d_model) <span class="comment"># vocab 词汇表大小</span></span><br><span class="line">        self.d_model = d_model  <span class="comment">#表示embedding的维度</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.lut(x) * math.sqrt(self.d_model)</span><br></pre></td></tr></table></figure>
<h3 id="Positional-Embedding"><a href="#Positional-Embedding" class="headerlink" title="Positional Embedding"></a>Positional Embedding</h3><p>在RNN中，对句子的处理是一个个word按顺序输入的。但在 Transformer 中，输入句子的所有word是同时处理的，没有考虑词的排序和位置信息。因此，Transformer 的作者提出了加入 <code>positional encoding</code>的方法来解决这个问题。<code>positional encoding</code>使得 Transformer 可以衡量 word 位置有关的信息。</p>
<p><strong>如何实现具有位置信息的encoding？</strong></p>
<p>作者提供了两种思路：</p>
<ul>
<li>通过训练学习 positional encoding 向量；</li>
<li>使用公式来计算 positional encoding向量。</li>
</ul>
<p>试验后发现两种选择的结果是相似的，所以采用了第2种方法，优点是不需要训练参数，而且即使<strong>在训练集中没有出现过的句子长度上也能用</strong>。Positional Encoding的公式如下：</p>
<script type="math/tex; mode=display">
\begin{aligned}
P E_{(p o s, 2 i)} &=\sin \left(p o s / 10000^{2 i / d_{\text {model }}}\right) \\
P E_{(p o s, 2 i+1)} &=\cos \left(p o s / 10000^{2 i / d_{\text {model }}}\right.
\end{aligned}</script><p>其中，$pos$指的是这个 word 在这个句子中的位置；$2i$指的是 embedding 词向量的偶数维度，$2i+1$指的是embedding 词向量的奇数维度。具体实现如下：</p>
<figure class="highlight python"><figcaption><span>PositionalEncoding</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PositionalEncoding</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Implement the PE function."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, dropout, max_len=<span class="number">5000</span>)</span>:</span></span><br><span class="line">        super(PositionalEncoding, self).__init__()</span><br><span class="line">        self.dropout = nn.Dropout(p=dropout)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Compute the positional encodings once in log space.</span></span><br><span class="line">        pe = torch.zeros(max_len, d_model)</span><br><span class="line">        position = torch.arange(<span class="number">0</span>, max_len).unsqueeze(<span class="number">1</span>) <span class="comment"># [max_len, 1]</span></span><br><span class="line">        div_term = torch.exp(torch.arange(<span class="number">0</span>, d_model, <span class="number">2</span>) * -(math.log(<span class="number">10000.0</span>) / d_model)) </span><br><span class="line">        pe[:, <span class="number">0</span>::<span class="number">2</span>] = torch.sin(position * div_term) <span class="comment"># 偶数列</span></span><br><span class="line">        pe[:, <span class="number">1</span>::<span class="number">2</span>] = torch.cos(position * div_term) <span class="comment"># 奇数列</span></span><br><span class="line">        pe = pe.unsqueeze(<span class="number">0</span>)         <span class="comment"># [1, max_len, d_model]</span></span><br><span class="line">        self.register_buffer(<span class="string">'pe'</span>, pe) <span class="comment"># 上述代码只需计算一次，然后放到寄存器里，随用随取。</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x = x + Variable(self.pe[:, :x.size(<span class="number">1</span>)], </span><br><span class="line">                         requires_grad=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> self.dropout(x) <span class="comment"># 据说dropout=0.1</span></span><br></pre></td></tr></table></figure>
<p><code>x = x + Variable(self.pe[:, :x.size(1)], requires_grad=False)</code> 这行代码表示；输入模型的整个Embedding是Word Embedding与Positional Embedding直接相加之后的结果。</p>
<p>为什么上面的两个公式能体现单词的相对位置信息呢？</p>
<p>下面一段代码取词向量的4个维度：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在位置编码下方，将基于位置添加正弦波。对于每个维度，波的频率和偏移都不同。</span></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>, <span class="number">5</span>))</span><br><span class="line">pe = PositionalEncoding(<span class="number">20</span>, <span class="number">0</span>)</span><br><span class="line">y = pe.forward(Variable(torch.zeros(<span class="number">1</span>, <span class="number">100</span>, <span class="number">20</span>))) <span class="comment"># [bs=1,seq_len=100,embed_size=20]</span></span><br><span class="line">plt.plot(np.arange(<span class="number">100</span>), y[<span class="number">0</span>, :, <span class="number">4</span>:<span class="number">8</span>].data.numpy())</span><br><span class="line">plt.legend([<span class="string">"dim %d"</span> %p <span class="keyword">for</span> p <span class="keyword">in</span> [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]])</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/11/transformer/position_embedding.png" alt></p>
<p>可以看到某个序列中不同位置的单词，在某一维度上的位置编码数值不一样，即同一序列的不同单词在单个纬度符合某个正弦或者余弦，可认为他们的具有相对关系。</p>
<h2 id="Encoder"><a href="#Encoder" class="headerlink" title="Encoder"></a>Encoder</h2><p>Encoder部分是由个层相同小Encoder Layer串联而成。小Encoder Layer可以简化为两个部分：</p>
<ol>
<li>Multi-Head Self Attention</li>
<li>Feed-Forward Network</li>
</ol>
<p><code>Multi-Head Self Attention</code> 和<code>Feed-Forward Network</code>之后都接了一层<code>Add</code> 和<code>Norm</code></p>
<p>示意图如下:</p>
<p><img src="/2020/05/11/transformer/encoder_layer.png" alt></p>
<h3 id="Muti-Head-Attention"><a href="#Muti-Head-Attention" class="headerlink" title="Muti-Head-Attention"></a>Muti-Head-Attention</h3><p>Multi-Head Self Attention 实际上是<strong>由h个Self Attention 层并行组成，原文中h=8</strong>。</p>
<h4 id="Self-Attention"><a href="#Self-Attention" class="headerlink" title="Self-Attention"></a>Self-Attention</h4><p>self-attention的输入是序列词向量<code>x</code>。<code>x</code>经过一个线性变换得到<code>query(Q)</code>, <code>x</code>经过第二个线性变换得到<code>key(K)</code>,<code>x</code>经过第三个线性变换得到<code>value(V)</code>。也就是：</p>
<ul>
<li>Q = linear_q(x)</li>
<li>K = linear_k(x)</li>
<li>V = linear_v(x)</li>
</ul>
<p>即：</p>
<p><img src="/2020/05/11/transformer/qkv.png" alt></p>
<p>linear_k, linear_q, linear_v是相互独立、权重$𝑊^𝑄,𝑊^𝐾,W^V$)是不同的，通过训练可得到。得到query(Q)，key(K)，value(V)之后按照下面的公式计算attention(Q, K, V)：</p>
<script type="math/tex; mode=display">
\text {Attention}(Q, K, V)=\text {Softmax}\left(\frac{Q K^{T}}{\sqrt{d_{k}}}\right) V</script><p><img src="/2020/05/11/transformer/attention.png" alt></p>
<p>这里<code>Z</code>就是<code>attention(Q, K, V)</code>，$𝑑_𝑘=\frac{𝑑_{𝑚𝑜𝑑𝑒𝑙}}{ℎ}=\frac{512}{8}=64$。</p>
<ol>
<li><p>为什么要用$\sqrt{d_k}$ 对 $𝑄𝐾^𝑇$进行缩放呢？</p>
<p>$d_k$实际上是<code>Q/K/V</code>的最后一个维度，当$d_k$越大，$QK^T$就越大，可能会将softmax函数推入梯度极小的区域。</p>
</li>
<li><p>softmax之后值都介于0到1之间，可以理解成得到了 attention weights。然后基于这个 attention weights 对 V 求 weighted sum 值 Attention(Q, K, V)。 </p>
</li>
</ol>
<p>Multi-Head-Attention 就是将<code>embedding</code>之后的X按维度$𝑑_{𝑚𝑜𝑑𝑒𝑙}=512$ 切割成$ℎ=8$个，分别做self-attention之后再合并在一起。</p>
<p><img src="/2020/05/11/transformer/attention_1.png" alt></p>
<figure class="highlight python"><figcaption><span>Attention</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attention</span><span class="params">(query, key, value, mask=None, dropout=None)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Compute 'Scaled Dot Product Attention</span></span><br><span class="line"><span class="string">    qkv :[batch, h, seq_len, embed_size/h(d_k)]</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    d_k = query.size(<span class="number">-1</span>)</span><br><span class="line">    scores = torch.matmul(query, key.transpose(<span class="number">-2</span>, <span class="number">-1</span>)) / math.sqrt(d_k)</span><br><span class="line">    <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        scores = scores.masked_fill(mask == <span class="number">0</span>, <span class="number">-1e9</span>)  <span class="comment"># mask </span></span><br><span class="line">    p_attn = F.softmax(scores, dim = <span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">if</span> dropout <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        p_attn = dropout(p_attn)     <span class="comment"># dropout=0.1</span></span><br><span class="line">    <span class="keyword">return</span> torch.matmul(p_attn, value), p_attn</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/11/transformer/multi_head.png" alt></p>
<figure class="highlight python"><figcaption><span>MultiHeadedAttention</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MultiHeadedAttention</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, h, d_model, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">        <span class="string">"Take in model size and number of heads."</span></span><br><span class="line">        super(MultiHeadedAttention, self).__init__()</span><br><span class="line">        <span class="keyword">assert</span> d_model % h == <span class="number">0</span></span><br><span class="line">        <span class="comment"># We assume d_v always equals d_k</span></span><br><span class="line">        self.d_k = d_model // h</span><br><span class="line">        self.h = h</span><br><span class="line">        self.linears = clones(nn.Linear(d_model, d_model), <span class="number">4</span>)</span><br><span class="line">        self.attn = <span class="literal">None</span></span><br><span class="line">        self.dropout = nn.Dropout(p=dropout)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, query, key, value, mask=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        实现MultiHeadedAttention。</span></span><br><span class="line"><span class="string">           输入的q，k，v是形状 [batch, seq_len, embed_size(d_model)]。</span></span><br><span class="line"><span class="string">           输出的x 的形状同上。</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># Same mask applied to all h heads.</span></span><br><span class="line">            mask = mask.unsqueeze(<span class="number">1</span>)</span><br><span class="line">        nbatches = query.size(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1) Do all the linear projections in batch from d_model =&gt; h x d_k </span></span><br><span class="line">        <span class="comment">#    [batch, seq_len, embed_size] -&gt;[batch, h, seq_len, embed_size/h]</span></span><br><span class="line">        query, key, value = [l(x).view(nbatches, <span class="number">-1</span>, self.h, self.d_k).transpose(<span class="number">1</span>, <span class="number">2</span>) <span class="keyword">for</span> l, x <span class="keyword">in</span> zip(self.linears, (query, key, value))]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2) Apply attention on all the projected vectors in batch.</span></span><br><span class="line">        <span class="comment">#    计算注意力attn 得到attn*v 与attn </span></span><br><span class="line">        <span class="comment">#    qkv :[batch, h, seq_len, embed_size/h] --&gt;</span></span><br><span class="line">        <span class="comment">#              x:[batch, h, seq_len, embed_size/h], attn[batch, h, seq_len, seq_len]</span></span><br><span class="line">        x, self.attn = attention(query, key, value, mask=mask, dropout=self.dropout)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3) "Concat" using a view and apply a final linear.</span></span><br><span class="line">        <span class="comment">#     上一步的结果合并在一起还原成原始输入序列的形状</span></span><br><span class="line">        x = x.transpose(<span class="number">1</span>, <span class="number">2</span>).contiguous().view(nbatches, <span class="number">-1</span>, self.h * self.d_k)</span><br><span class="line">        <span class="keyword">return</span> self.linears[<span class="number">-1</span>](x)  <span class="comment"># 最后再过一个线性层</span></span><br></pre></td></tr></table></figure>
<h4 id="Self-Attention的优点"><a href="#Self-Attention的优点" class="headerlink" title="Self-Attention的优点"></a>Self-Attention的优点</h4><ol>
<li>因为每个词都和周围所有词做attention，所以任意两个位置都相当于有直连线路，可捕获长距离依赖。</li>
<li>Attention的可解释性更好，根据Attention score可以知道一个词和哪些词的关系比较大。</li>
<li>易于并行化，当前层的Attention计算只和前一层的值有关，所以一层的所有节点可并行执行self-attention操作。计算效率高，一次Self-Attention只需要两次矩阵运算，速度很快。</li>
</ol>
<h3 id="Add-amp-Norm"><a href="#Add-amp-Norm" class="headerlink" title="Add &amp; Norm"></a>Add &amp; Norm</h3><p><code>x</code> 序列经过<code>Multi-Head-Self-Attention</code> 之后实际经过一个<code>Add+Norm</code>层，再进入<code>feed-forward network(FFN)</code>，在<code>FFN</code>之后又经过一个<code>norm</code>再输入下一个encoder layer。几乎每个sub layer之后都会经过一个归一化，然后再加在原来的输入上。</p>
<figure class="highlight python"><figcaption><span>Norm</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LayerNorm</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Construct a layernorm module (See citation for details)."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, features, eps=<span class="number">1e-6</span>)</span>:</span></span><br><span class="line">        super(LayerNorm, self).__init__()</span><br><span class="line">        self.a_2 = nn.Parameter(torch.ones(features)) </span><br><span class="line">        self.b_2 = nn.Parameter(torch.zeros(features)) </span><br><span class="line">        self.eps = eps</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        mean = x.mean(<span class="number">-1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        std = x.std(<span class="number">-1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> self.a_2 * (x - mean) / (std + self.eps) + self.b_2</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><figcaption><span>Add</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SublayerConnection</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A residual connection followed by a layer norm.</span></span><br><span class="line"><span class="string">    Note for code simplicity the norm is first as opposed to last.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size, dropout)</span>:</span></span><br><span class="line">        super(SublayerConnection, self).__init__()</span><br><span class="line">        self.norm = LayerNorm(size)</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, sublayer)</span>:</span></span><br><span class="line">        <span class="string">"Apply residual connection to any sublayer with the same size."</span></span><br><span class="line">        <span class="comment"># sublayer &lt;-- encoder layer</span></span><br><span class="line">        <span class="keyword">return</span> x + self.dropout(sublayer(self.norm(x)))</span><br></pre></td></tr></table></figure>
<h3 id="Feed-Forward-Network"><a href="#Feed-Forward-Network" class="headerlink" title="Feed-Forward Network"></a>Feed-Forward Network</h3><p>Feed-Forward Network可以细分为有两层，第一层是一个线性激活函数，第二层是激活函数是ReLU。可以表示为：</p>
<script type="math/tex; mode=display">
F F N=\max \left(0, x W_{1}+b_{1}\right) W_{2}+b_{2}</script><figure class="highlight python"><figcaption><span>PositionwiseFeedForward</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PositionwiseFeedForward</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"""Implements FFN equation.</span></span><br><span class="line"><span class="string">    positionwise体现每个单词上做linear，单词之间各不相同</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, d_ff, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">      <span class="string">"""</span></span><br><span class="line"><span class="string">      d_model: embedding_size</span></span><br><span class="line"><span class="string">      d_ff: 线形层输出维度</span></span><br><span class="line"><span class="string">      """</span></span><br><span class="line">        super(PositionwiseFeedForward, self).__init__()</span><br><span class="line">        self.w_1 = nn.Linear(d_model, d_ff)</span><br><span class="line">        self.w_2 = nn.Linear(d_ff, d_model)</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.w_2(self.dropout(F.relu(self.w_1(x))))</span><br></pre></td></tr></table></figure>
<h3 id="组合出Encoder"><a href="#组合出Encoder" class="headerlink" title="组合出Encoder"></a>组合出Encoder</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clones</span><span class="params">(module, N)</span>:</span></span><br><span class="line">    <span class="string">"Produce N identical layers."</span></span><br><span class="line">    <span class="keyword">return</span> nn.ModuleList([copy.deepcopy(module) <span class="keyword">for</span> _ <span class="keyword">in</span> range(N)])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Encoder</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Core encoder is a stack of N layers"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, layer, N)</span>:</span></span><br><span class="line">        super(Encoder, self).__init__()</span><br><span class="line">        self.layers = clones(layer, N)  <span class="comment"># sub layer</span></span><br><span class="line">        self.norm = LayerNorm(layer.size)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, mask)</span>:</span></span><br><span class="line">        <span class="string">"Pass the input (and mask) through each layer in turn."</span></span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.layers:</span><br><span class="line">            x = layer(x, mask)</span><br><span class="line">        <span class="keyword">return</span> self.norm(x)</span><br></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>总的来说Encoder 是由上述小encoder layer 6个串行叠加组成。encoder sub layer主要包含两个部分：</p>
<ul>
<li>SubLayer-1 做 Multi-Headed Attention</li>
<li>SubLayer-2 做 Feed Forward Neural Network</li>
</ul>
<h2 id="Decoder"><a href="#Decoder" class="headerlink" title="Decoder"></a>Decoder</h2><p>Decoder与Encoder有所不同，Encoder与Decoder的关系可以用下图描述：</p>
<p><img src="/2020/05/11/transformer/decoder.png" alt></p>
<figure class="highlight python"><figcaption><span>Decoder</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Decoder</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Generic N layer decoder with masking."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, layer, N)</span>:</span></span><br><span class="line">        super(Decoder, self).__init__()</span><br><span class="line">        self.layers = clones(layer, N)</span><br><span class="line">        self.norm = LayerNorm(layer.size)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, memory, src_mask, tgt_mask)</span>:</span> </span><br><span class="line">      	<span class="comment"># memory Encoder最后的输出。 </span></span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.layers:</span><br><span class="line">            x = layer(x, memory, src_mask, tgt_mask)</span><br><span class="line">        <span class="keyword">return</span> self.norm(x)</span><br></pre></td></tr></table></figure>
<p>Decoder 子结构（sub layer）：</p>
<p><img src="/2020/05/11/transformer/decoder_layer.png" alt></p>
<p>Decoder 也是N=6层堆叠的结构。被分为3个 SubLayer，Encoder与Decoder有三大主要的不同：</p>
<ol>
<li>Decoder SubLayer-1 使用的是 “Masked” Multi-Headed Attention 机制，防止为了模型看到要预测的数据，防止泄露。</li>
<li>SubLayer-2 是一个 Encoder-Decoder Multi-head Attention。</li>
<li>LinearLayer 和 SoftmaxLayer 作用于 SubLayer-3 的输出后面，来预测对应的 word 的 probabilities 。</li>
</ol>
<h3 id="Mask-Multi-Head-Attention"><a href="#Mask-Multi-Head-Attention" class="headerlink" title="Mask-Multi-Head-Attention"></a>Mask-Multi-Head-Attention</h3><p>Mask 的目的是防止 Decoder “seeing the future”，防止提前知道预测的内容（ensures that the predictions for position $i$ can depend only on the known outputs at positions less than $i$.）,这也说明Transformer只是在Encoder阶段可以并行化，Decoder阶段需要一个个词顺序翻译，依然是<strong>串行</strong>的(参考Greedy Decoding代码部分。这里mask是一个下三角矩阵，对角线以及对角线左下都是1，其余都是0。</p>
<figure class="highlight python"><figcaption><span>subsequent_mask</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">subsequent_mask</span><span class="params">(size)</span>:</span></span><br><span class="line">    <span class="string">""""Mask out subsequent positions.</span></span><br><span class="line"><span class="string">    mask后续的位置，返回[size, size]尺寸下三角Tensor</span></span><br><span class="line"><span class="string">    对角线及其左下角全是1，右上角全是0</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    attn_shape = (<span class="number">1</span>, size, size)</span><br><span class="line">    <span class="comment"># np.triu()  Upper triangle of an array: 返回矩阵上三角</span></span><br><span class="line">    subsequent_mask = np.triu(np.ones(attn_shape), k=<span class="number">1</span>).astype(<span class="string">'uint8'</span>)</span><br><span class="line">    <span class="keyword">return</span> torch.from_numpy(subsequent_mask) == <span class="number">0</span> <span class="comment"># 等于0，返回的是矩阵的下三角</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">5</span>,<span class="number">5</span>))</span><br><span class="line">plt.imshow(subsequent_mask(<span class="number">20</span>)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="/2020/05/11/transformer/subsequent_mask.png" alt></p>
<p>subsequent_mask 返回结果：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tensor([[[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">         [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]]], dtype=torch.uint8)</span><br></pre></td></tr></table></figure>
<p>当mask不为空的时候，attention计算需要将x做一个操作：scores = scores.masked_fill(mask == 0, -1e9)。即将mask==0的替换为-1e9,其余不变。</p>
<h3 id="Encoder-Decoder-Multi-head-Attention"><a href="#Encoder-Decoder-Multi-head-Attention" class="headerlink" title="Encoder-Decoder Multi-head Attention"></a>Encoder-Decoder Multi-head Attention</h3><p>这部分和Multi-head Attention的区别是该层的输入来自encoder和上一次decoder的结果。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecoderLayer</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Decoder is made of self-attn, src-attn, and feed forward (defined below)"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size, self_attn, src_attn, feed_forward, dropout)</span>:</span></span><br><span class="line">        super(DecoderLayer, self).__init__()</span><br><span class="line">        self.size = size</span><br><span class="line">        self.self_attn = self_attn</span><br><span class="line">        self.src_attn = src_attn</span><br><span class="line">        self.feed_forward = feed_forward</span><br><span class="line">        self.sublayer = clones(SublayerConnection(size, dropout), <span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, memory, src_mask, tgt_mask)</span>:</span></span><br><span class="line">        <span class="string">"Follow Figure 1 (right) for connections."</span></span><br><span class="line">      	<span class="comment"># 将decoder的三个Sublayer串联起来</span></span><br><span class="line">        m = memory <span class="comment"># 为encoder 最后的输出</span></span><br><span class="line">        x = self.sublayer[<span class="number">0</span>](x, <span class="keyword">lambda</span> x: self.self_attn(x, x, x, tgt_mask))</span><br><span class="line">        x = self.sublayer[<span class="number">1</span>](x, <span class="keyword">lambda</span> x: self.src_attn(x, m, m, src_mask))</span><br><span class="line">        <span class="keyword">return</span> self.sublayer[<span class="number">2</span>](x, self.feed_forward)</span><br></pre></td></tr></table></figure>
<h3 id="Linear-and-Softmax-to-Produce-Output-Probabilities"><a href="#Linear-and-Softmax-to-Produce-Output-Probabilities" class="headerlink" title="Linear and Softmax to Produce Output Probabilities"></a>Linear and Softmax to Produce Output Probabilities</h3><p>Decoder的最后一个部分是过一个linear layer将decoder的输出扩展到与vocabulary size一样的维度上。经过softmax 后，选择概率最高的一个word作为预测结果。假设我们有一个已经训练好的网络，在做预测时，步骤如下：</p>
<ol>
<li>给 decoder 输入 encoder 对整个句子 embedding 的结果和一个特殊的开始符号 &lt;/s&gt;。decoder 将产生预测，在例子中应该是 <code>I</code>。</li>
<li>给 decoder 输入 encoder 的 embedding 结果和 “&lt;/s&gt; I”，在这一步 decoder 应该产生预测 <code>am</code>。</li>
<li>给 decoder 输入 encoder 的 embedding 结果和 “&lt;/s&gt; I am”，在这一步 decoder 应该产生预测 <code>a</code>。</li>
<li>给 decoder 输入 encoder 的 embedding 结果和 “&lt;/s&gt; I am a”，在这一步 decoder 应该产生预测 <code>student</code>。</li>
<li>给 decoder 输入 encoder 的 embedding 结果和 “&lt;/s&gt;I am a student”, decoder应该生成句子结尾的标记，decoder 应该输出 <code>&lt;/eos&gt;</code>。</li>
<li>然后 decoder 生成了 &lt;/eos&gt;，翻译完成。</li>
</ol>
<p>这部分的代码实现：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Generator</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Define standard linear + softmax generation step."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, vocab)</span>:</span></span><br><span class="line">    		<span class="string">"""</span></span><br><span class="line"><span class="string">    		d_model:decoder 输出的embedding size</span></span><br><span class="line"><span class="string">    		vocab：目标的词汇表大小</span></span><br><span class="line"><span class="string">    		"""</span></span><br><span class="line">        super(Generator, self).__init__()</span><br><span class="line">        self.proj = nn.Linear(d_model, vocab)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.proj(x), dim=<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="EncoderDecoder"><a href="#EncoderDecoder" class="headerlink" title="EncoderDecoder"></a>EncoderDecoder</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EncoderDecoder</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A standard Encoder-Decoder architecture. Base for this and many </span></span><br><span class="line"><span class="string">    other models.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, encoder, decoder, src_embed, tgt_embed, generator)</span>:</span></span><br><span class="line">        super(EncoderDecoder, self).__init__()</span><br><span class="line">        self.encoder = encoder</span><br><span class="line">        self.decoder = decoder</span><br><span class="line">        self.src_embed = src_embed <span class="comment"># embedding</span></span><br><span class="line">        self.tgt_embed = tgt_embed <span class="comment"># embedding</span></span><br><span class="line">        self.generator = generator <span class="comment"># 用于生成翻译目标（Linear + softmax --&gt; prob）</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, src, tgt, src_mask, tgt_mask)</span>:</span></span><br><span class="line">        <span class="string">"Take in and process masked src and target sequences."</span></span><br><span class="line">        <span class="keyword">return</span> self.decode(self.encode(src, src_mask), src_mask,</span><br><span class="line">                            tgt, tgt_mask)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(self, src, src_mask)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.encoder(self.src_embed(src), src_mask)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(self, memory, src_mask, tgt, tgt_mask)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.decoder(self.tgt_embed(tgt), memory, src_mask, tgt_mask)</span><br></pre></td></tr></table></figure>
<h2 id="Full-Model"><a href="#Full-Model" class="headerlink" title="Full Model"></a>Full Model</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_model</span><span class="params">(src_vocab, tgt_vocab, N=<span class="number">6</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">               d_model=<span class="number">512</span>, d_ff=<span class="number">2048</span>, h=<span class="number">8</span>, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">    <span class="string">"Helper: Construct a model from hyperparameters."</span></span><br><span class="line">    c = copy.deepcopy</span><br><span class="line">    attn = MultiHeadedAttention(h, d_model)</span><br><span class="line">    ff = PositionwiseFeedForward(d_model, d_ff, dropout) <span class="comment"># linear(relu(linear(x)))</span></span><br><span class="line">    position = PositionalEncoding(d_model, dropout)</span><br><span class="line">    model = EncoderDecoder(</span><br><span class="line">        Encoder(EncoderLayer(d_model, c(attn), c(ff), dropout), N),</span><br><span class="line">        Decoder(DecoderLayer(d_model, c(attn), c(attn), </span><br><span class="line">                             c(ff), dropout), N),</span><br><span class="line">        nn.Sequential(Embeddings(d_model, src_vocab), c(position)),</span><br><span class="line">        nn.Sequential(Embeddings(d_model, tgt_vocab), c(position)),</span><br><span class="line">        Generator(d_model, tgt_vocab))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># This was important from their code. </span></span><br><span class="line">    <span class="comment"># Initialize parameters with Glorot / fan_avg.</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> model.parameters():</span><br><span class="line">        <span class="keyword">if</span> p.dim() &gt; <span class="number">1</span>:</span><br><span class="line">            nn.init.xavier_uniform(p)</span><br><span class="line">    <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure>
<h1 id="Training"><a href="#Training" class="headerlink" title="Training"></a>Training</h1><p>这部分主要根据自己的理解对代码加注释</p>
<h2 id="Batches-and-Masking"><a href="#Batches-and-Masking" class="headerlink" title="Batches and Masking"></a>Batches and Masking</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Batch</span>:</span></span><br><span class="line">    <span class="string">"Object for holding a batch of data with mask during training."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, src, trg=None, pad=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self.src = src</span><br><span class="line">        self.src_mask = (src != pad).unsqueeze(<span class="number">-2</span>) <span class="comment"># 对超出句子长度部分mask</span></span><br><span class="line">        <span class="keyword">if</span> trg <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.trg = trg[:, :<span class="number">-1</span>]</span><br><span class="line">            self.trg_y = trg[:, <span class="number">1</span>:]</span><br><span class="line">            self.trg_mask = self.make_std_mask(self.trg, pad) <span class="comment"># mask to hide padding and future words</span></span><br><span class="line">            self.ntokens = (self.trg_y != pad).data.sum()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_std_mask</span><span class="params">(tgt, pad)</span>:</span></span><br><span class="line">        <span class="string">"Create a mask to hide padding and future words."</span></span><br><span class="line">        tgt_mask = (tgt != pad).unsqueeze(<span class="number">-2</span>)</span><br><span class="line">        tgt_mask = tgt_mask &amp; Variable(</span><br><span class="line">            subsequent_mask(tgt.size(<span class="number">-1</span>)).type_as(tgt_mask.data))</span><br><span class="line">        <span class="keyword">return</span> tgt_mask</span><br></pre></td></tr></table></figure>
<h2 id="Training-Loop"><a href="#Training-Loop" class="headerlink" title="Training Loop"></a>Training Loop</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_epoch</span><span class="params">(data_iter, model, loss_compute)</span>:</span></span><br><span class="line">    <span class="string">"Standard Training and Logging Function"</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    total_tokens = <span class="number">0</span></span><br><span class="line">    total_loss = <span class="number">0</span></span><br><span class="line">    tokens = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, batch <span class="keyword">in</span> enumerate(data_iter):</span><br><span class="line">        out = model.forward(batch.src, batch.trg, </span><br><span class="line">                            batch.src_mask, batch.trg_mask)</span><br><span class="line">        loss = loss_compute(out, batch.trg_y, batch.ntokens)</span><br><span class="line">        total_loss += loss</span><br><span class="line">        total_tokens += batch.ntokens</span><br><span class="line">        tokens += batch.ntokens</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">50</span> == <span class="number">1</span>:</span><br><span class="line">            elapsed = time.time() - start</span><br><span class="line">            print(<span class="string">"Epoch Step: %d Loss: %f Tokens per Sec: %f"</span> %</span><br><span class="line">                    (i, loss / batch.ntokens, tokens / elapsed))</span><br><span class="line">            start = time.time()</span><br><span class="line">            tokens = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> total_loss / total_tokens</span><br></pre></td></tr></table></figure>
<h2 id="Training-Data"><a href="#Training-Data" class="headerlink" title="Training Data"></a>Training Data</h2><p>使用标准WMT 2014英语-德语数据集进行了训练，该数据集包含大约450万个句子对。 使用字节对的编码方法对句子进行编码，该编码具有大约37000个词的共享源-目标词汇表。 对于英语-法语，使用了WMT 2014 英语-法语数据集，该数据集由36M个句子组成，并将词分成32000个词片(Word-piece)的词汇表。句子对按照近似的序列长度进行批处理。每个训练批包含一组句子对，包含大约25000个源词和25000个目标词。</p>
<p>使用torch text来创建batch。在torchtext的一个函数中创建batch，确保填充到最大batch训练长度的大小不超过阈值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">global</span> max_src_in_batch, max_tgt_in_batch</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">batch_size_fn</span><span class="params">(new, count, sofar)</span>:</span></span><br><span class="line">    <span class="string">"Keep augmenting batch and calculate total number of tokens + padding."</span></span><br><span class="line">    <span class="keyword">global</span> max_src_in_batch, max_tgt_in_batch</span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>: <span class="comment"># ？？</span></span><br><span class="line">        max_src_in_batch = <span class="number">0</span></span><br><span class="line">        max_tgt_in_batch = <span class="number">0</span></span><br><span class="line">    max_src_in_batch = max(max_src_in_batch,  len(new.src))</span><br><span class="line">    max_tgt_in_batch = max(max_tgt_in_batch,  len(new.trg) + <span class="number">2</span>)</span><br><span class="line">    src_elements = count * max_src_in_batch</span><br><span class="line">    tgt_elements = count * max_tgt_in_batch</span><br><span class="line">    <span class="keyword">return</span> max(src_elements, tgt_elements)</span><br></pre></td></tr></table></figure>
<h2 id="Optimizer"><a href="#Optimizer" class="headerlink" title="Optimizer"></a>Optimizer</h2><p>选择Adam作为优化器，其参数为$\beta_1 = 0.9, \beta_2=0.98,\epsilon=10^{-9}$。根据$lrate = d_{model}^{- \frac{1}{2}} * min(step_num^{- \frac{1}{2}},step_num \cdot warmup_steps^{-1.5})$，在训练过程中改变了学习率。在<code>warm_up</code>中随步数线性地增加学习速率，随后与步数的反平方根成比例地减小它。预热<code>warmup_steps</code>为4000。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoamOpt</span>:</span></span><br><span class="line">    <span class="string">"Optim wrapper that implements rate."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, model_size, factor, warmup, optimizer)</span>:</span></span><br><span class="line">        self.optimizer = optimizer</span><br><span class="line">        self._step = <span class="number">0</span></span><br><span class="line">        self.warmup = warmup</span><br><span class="line">        self.factor = factor</span><br><span class="line">        self.model_size = model_size</span><br><span class="line">        self._rate = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">step</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"Update parameters and rate"</span></span><br><span class="line">        self._step += <span class="number">1</span></span><br><span class="line">        rate = self.rate()</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> self.optimizer.param_groups:</span><br><span class="line">            p[<span class="string">'lr'</span>] = rate</span><br><span class="line">        self._rate = rate</span><br><span class="line">        self.optimizer.step()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rate</span><span class="params">(self, step = None)</span>:</span></span><br><span class="line">        <span class="string">"Implement `lrate` above"</span></span><br><span class="line">        <span class="keyword">if</span> step <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            step = self._step</span><br><span class="line">        <span class="comment"># 对应上面公式</span></span><br><span class="line">        <span class="keyword">return</span> self.factor * (self.model_size ** (<span class="number">-0.5</span>) * min(step ** (<span class="number">-0.5</span>), step * self.warmup ** (<span class="number">-1.5</span>)))</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_std_opt</span><span class="params">(model)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> NoamOpt(model.src_embed[<span class="number">0</span>].d_model, <span class="number">2</span>, <span class="number">4000</span>,torch.optim.Adam(model.parameters(), lr=<span class="number">0</span>, betas=(<span class="number">0.9</span>, <span class="number">0.98</span>), eps=<span class="number">1e-9</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">opts = [NoamOpt(<span class="number">512</span>, <span class="number">1</span>, <span class="number">4000</span>, <span class="literal">None</span>), </span><br><span class="line">        NoamOpt(<span class="number">512</span>, <span class="number">1</span>, <span class="number">8000</span>, <span class="literal">None</span>),</span><br><span class="line">        NoamOpt(<span class="number">256</span>, <span class="number">1</span>, <span class="number">4000</span>, <span class="literal">None</span>)]</span><br><span class="line">plt.plot(np.arange(<span class="number">1</span>, <span class="number">20000</span>), [[opt.rate(i) <span class="keyword">for</span> opt <span class="keyword">in</span> opts] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">20000</span>)])</span><br><span class="line">plt.legend([<span class="string">"512:4000"</span>, <span class="string">"512:8000"</span>, <span class="string">"256:4000"</span>])</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/11/transformer/warm_up.png" alt></p>
<p>也就是说：</p>
<ol>
<li>在embedding size相同的情况下，warm up步数越少，前期的学习率曲线越陡峭，学的越快。</li>
<li>在warm up步数相同的时候，embedding size 越小，前期的学习率曲线越陡峭，学的越快。</li>
</ol>
<h2 id="Regularization"><a href="#Regularization" class="headerlink" title="Regularization"></a>Regularization</h2><h3 id="Label-Smoothing"><a href="#Label-Smoothing" class="headerlink" title="Label Smoothing"></a>Label Smoothing</h3><h4 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h4><p>在多分类训练任务中，输入经过神级网络的计算，会得到当前输入对应于各个类别的置信度分数，这些分数会被softmax进行归一化处理，最终得到当前输入属于每个类别的概率。</p>
<script type="math/tex; mode=display">
q_{i}=\frac{\exp \left(z_{i}\right)}{\sum_{j=1}^{K} \exp \left(z_{j}\right)}</script><p>之后在使用交叉熵函数来计算损失值：</p>
<script type="math/tex; mode=display">
\begin{aligned}
&L o s s=-\sum_{i=1}^{K} p_{i} \log q_{i}\\
&p_{i}=\left\{\begin{array}{l}
1, \text { if }(i=y) \\
0, i f(i \neq y)
\end{array}\right.
\end{aligned}</script><p>其中，i表示多类中的某一类。</p>
<p>最终在训练网络时，最小化预测概率和标签真实概率的交叉熵，从而得到最优的预测概率分布。在此过程中，为了达到最好的拟合效果，最优的预测概率分布为：</p>
<script type="math/tex; mode=display">
Z_{i}=\left\{\begin{array}{l}
+\infty, i f(i=y) \\
0, i f(i \neq y)
\end{array}\right.</script><p>也就是说，网络会驱使自身往正确标签和错误标签差值大的方向学习，在训练数据不足以表征所以的样本特征的情况下，就<strong>会导致网络过拟合</strong>。</p>
<h4 id="label-smoothing原理"><a href="#label-smoothing原理" class="headerlink" title="label smoothing原理"></a>label smoothing原理</h4><p>label smoothing的提出就是为了解决上述问题，是一种正则化的策略。其通过”软化”传统的one-hot类型标签，使得在计算损失值时能够有效抑制过拟合现象。label smoothing相当于减少真实样本标签的类别在计算损失函数时的权重，最终起到抑制过拟合的效果。</p>
<p>1.label smoothing将真实概率分布作如下改变：</p>
<script type="math/tex; mode=display">
P_{i}=\left\{\begin{array}{l}
1, i f(i=y) \\
0, i f(i \neq y)
\end{array} \Longrightarrow  P_{i}=\left\{\begin{array}{l}
(1-\varepsilon), i f(i=y) \\
\frac{\varepsilon}{K-1}, i f(i \neq y)
\end{array}\right.\right.</script><p>其实更新后的分布就相当于往真实分布中加入了噪声，为了便于计算，该噪声服从简单的均匀分布。</p>
<p>2.与之对应，label smoothing将交叉熵损失函数作如下改变：</p>
<script type="math/tex; mode=display">
L o s s=-\sum_{i=1}^{K} p_{i} \log q_{i} \Longrightarrow \operatorname{Loss}_{i}=\left\{\begin{array}{l}
(1-\varepsilon)^{*} \operatorname{Loss}, \text {if}(i=y) \\
\varepsilon^{*} \operatorname{Loss}, \text {if}(i \neq y)
\end{array}\right.</script><p>3.与之对应，label smoothing将最优的预测概率分布作如下改变：</p>
<script type="math/tex; mode=display">
Z_{i}=\left\{\begin{array}{l}
+\infty, i f(i=y) \\
0, i f(i \neq y)
\end{array} \Longrightarrow Z_{i}=\left\{\begin{array}{l}
\log \frac{(k-1)(1-\varepsilon)}{\varepsilon+\alpha}, i f(i=y) \\
\alpha, i f(i \neq y)
\end{array}\right.\right.</script><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LabelSmoothing</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"Implement label smoothing."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size, padding_idx, smoothing=<span class="number">0.0</span>)</span>:</span></span><br><span class="line">        super(LabelSmoothing, self).__init__()</span><br><span class="line">        self.criterion = nn.KLDivLoss(size_average=<span class="literal">False</span>)</span><br><span class="line">        self.padding_idx = padding_idx</span><br><span class="line">        self.confidence = <span class="number">1.0</span> - smoothing</span><br><span class="line">        self.smoothing = smoothing</span><br><span class="line">        self.size = size</span><br><span class="line">        self.true_dist = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, target)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> x.size(<span class="number">1</span>) == self.size</span><br><span class="line">        true_dist = x.data.clone()</span><br><span class="line">        true_dist.fill_(self.smoothing / (self.size - <span class="number">2</span>)) <span class="comment"># 减2，是减去目标序列的&lt;s&gt; &lt;e&gt;标识位置。</span></span><br><span class="line">        true_dist.scatter_(<span class="number">1</span>, target.data.unsqueeze(<span class="number">1</span>), self.confidence)</span><br><span class="line">        true_dist[:, self.padding_idx] = <span class="number">0</span></span><br><span class="line">        mask = torch.nonzero(target.data == self.padding_idx)</span><br><span class="line">        <span class="keyword">if</span> mask.dim() &gt; <span class="number">0</span>:</span><br><span class="line">            true_dist.index_fill_(<span class="number">0</span>, mask.squeeze(), <span class="number">0.0</span>)</span><br><span class="line">        self.true_dist = true_dist</span><br><span class="line">        <span class="keyword">return</span> self.criterion(x, Variable(true_dist, requires_grad=<span class="literal">False</span>))</span><br></pre></td></tr></table></figure>
<p>在训练期间，采用了值 $\epsilon_{ls}=0.1$的标签平滑。 这种做法提高了困惑度，因为模型变得更加不确定，但提高了准确性和BLEU分数。使用KL div loss实现标签平滑。 相比使用独热目标分布，其包含正确单词的置信度和整个词汇表中分布的其余平滑项。可以看到标签平滑的示例:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Example of label smoothing.</span></span><br><span class="line"><span class="comment"># embed_size = 5, padding_idx=0,smoothing=0.4</span></span><br><span class="line">crit = LabelSmoothing(<span class="number">5</span>, <span class="number">0</span>, <span class="number">0.4</span>)</span><br><span class="line">predict = torch.FloatTensor([[<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">0.7</span>, <span class="number">0.1</span>, <span class="number">0</span>],</span><br><span class="line">                             [<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">0.7</span>, <span class="number">0.1</span>, <span class="number">0</span>], </span><br><span class="line">                             [<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">0.7</span>, <span class="number">0.1</span>, <span class="number">0</span>]])</span><br><span class="line">v = crit(Variable(predict.log()), </span><br><span class="line">         Variable(torch.LongTensor([<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>])))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show the target distributions expected by the system.</span></span><br><span class="line">plt.imshow(crit.true_dist)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/11/transformer/label_smooth.png" alt></p>
<p>以紫色为例：0号标签应该以<code>-0.5</code>为目标，<code>1,2,3,4</code>以<code>1.5</code>为目标</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">crit = LabelSmoothing(<span class="number">5</span>, <span class="number">0</span>, <span class="number">0.1</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loss</span><span class="params">(x)</span>:</span></span><br><span class="line">    d = x + <span class="number">3</span> * <span class="number">1</span></span><br><span class="line">    predict = torch.FloatTensor([[<span class="number">0</span>, x / d, <span class="number">1</span> / d, <span class="number">1</span> / d, <span class="number">1</span> / d],</span><br><span class="line">                                 ])</span><br><span class="line">    <span class="comment">#print(predict)</span></span><br><span class="line">    <span class="keyword">return</span> crit(Variable(predict.log()),</span><br><span class="line">                 Variable(torch.LongTensor([<span class="number">1</span>]))).data[<span class="number">0</span>]</span><br><span class="line">plt.plot(np.arange(<span class="number">1</span>, <span class="number">100</span>), [loss(x) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>)])</span><br></pre></td></tr></table></figure>
<p>如果对给定的选择非常有信心，标签平滑实际上会开始惩罚模型。</p>
<p><img src="/2020/05/11/transformer/penate.png" alt></p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><h3 id="Copy-Task"><a href="#Copy-Task" class="headerlink" title="Copy Task"></a>Copy Task</h3><h4 id="Synthetic-Data"><a href="#Synthetic-Data" class="headerlink" title="Synthetic Data"></a>Synthetic Data</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data_gen</span><span class="params">(V, batch, nbatches)</span>:</span></span><br><span class="line">    <span class="string">"Generate random data for a src-tgt copy task."</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(nbatches):</span><br><span class="line">        data = torch.from_numpy(np.random.randint(<span class="number">1</span>, V, size=(batch, <span class="number">10</span>)))</span><br><span class="line">        data[:, <span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">        src = Variable(data, requires_grad=<span class="literal">False</span>)</span><br><span class="line">        tgt = Variable(data, requires_grad=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">yield</span> Batch(src, tgt, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Loss-Computation"><a href="#Loss-Computation" class="headerlink" title="Loss Computation"></a>Loss Computation</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleLossCompute</span>:</span></span><br><span class="line">    <span class="string">"A simple loss compute and train function."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, generator, criterion, opt=None)</span>:</span></span><br><span class="line">        self.generator = generator</span><br><span class="line">        self.criterion = criterion</span><br><span class="line">        self.opt = opt</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, x, y, norm)</span>:</span></span><br><span class="line">        x = self.generator(x)</span><br><span class="line">        loss = self.criterion(x.contiguous().view(<span class="number">-1</span>, x.size(<span class="number">-1</span>)), </span><br><span class="line">                              y.contiguous().view(<span class="number">-1</span>)) / norm</span><br><span class="line">        loss.backward()</span><br><span class="line">        <span class="keyword">if</span> self.opt <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.opt.step()</span><br><span class="line">            self.opt.optimizer.zero_grad()</span><br><span class="line">        <span class="keyword">return</span> loss.data[<span class="number">0</span>] * norm</span><br></pre></td></tr></table></figure>
<h4 id="Greedy-Decoding"><a href="#Greedy-Decoding" class="headerlink" title="Greedy Decoding "></a><span id="greedy">Greedy Decoding </span></h4><p>贪心解码。。。大佬们真会起名字！！</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Train the simple copy task.</span></span><br><span class="line">V = <span class="number">11</span></span><br><span class="line">criterion = LabelSmoothing(size=V, padding_idx=<span class="number">0</span>, smoothing=<span class="number">0.0</span>)</span><br><span class="line">model = make_model(V, V, N=<span class="number">2</span>)</span><br><span class="line">model_opt = NoamOpt(model.src_embed[<span class="number">0</span>].d_model, <span class="number">1</span>, <span class="number">400</span>,</span><br><span class="line">        torch.optim.Adam(model.parameters(), lr=<span class="number">0</span>, betas=(<span class="number">0.9</span>, <span class="number">0.98</span>), eps=<span class="number">1e-9</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    model.train()</span><br><span class="line">    run_epoch(data_gen(V, <span class="number">30</span>, <span class="number">20</span>), model, </span><br><span class="line">              SimpleLossCompute(model.generator, criterion, model_opt))</span><br><span class="line">    model.eval()</span><br><span class="line">    print(run_epoch(data_gen(V, <span class="number">30</span>, <span class="number">5</span>), model, </span><br><span class="line">                    SimpleLossCompute(model.generator, criterion, <span class="literal">None</span>)))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greedy_decode</span><span class="params">(model, src, src_mask, max_len, start_symbol)</span>:</span></span><br><span class="line">    memory = model.encode(src, src_mask)</span><br><span class="line">    ys = torch.ones(<span class="number">1</span>, <span class="number">1</span>).fill_(start_symbol).type_as(src.data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(max_len<span class="number">-1</span>):</span><br><span class="line">        out = model.decode(memory, src_mask, </span><br><span class="line">                           Variable(ys), </span><br><span class="line">                           Variable(subsequent_mask(ys.size(<span class="number">1</span>))</span><br><span class="line">                                    .type_as(src.data)))</span><br><span class="line">        prob = model.generator(out[:, <span class="number">-1</span>])</span><br><span class="line">        _, next_word = torch.max(prob, dim = <span class="number">1</span>)</span><br><span class="line">        next_word = next_word.data[<span class="number">0</span>]</span><br><span class="line">        ys = torch.cat([ys, </span><br><span class="line">                        torch.ones(<span class="number">1</span>, <span class="number">1</span>).type_as(src.data).fill_(next_word)], dim=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> ys</span><br><span class="line"></span><br><span class="line">model.eval()</span><br><span class="line">src = Variable(torch.LongTensor([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]]) )</span><br><span class="line">src_mask = Variable(torch.ones(<span class="number">1</span>, <span class="number">1</span>, <span class="number">10</span>) )</span><br><span class="line">print(greedy_decode(model, src, src_mask, max_len=<span class="number">10</span>, start_symbol=<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><figcaption><span>result</span></figcaption><table><tr><td class="code"><pre><span class="line">  <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span>     <span class="number">4</span>     <span class="number">5</span>     <span class="number">6</span>     <span class="number">7</span>     <span class="number">8</span>     <span class="number">9</span>    <span class="number">10</span></span><br><span class="line">[torch.LongTensor of size <span class="number">1</span>x10]</span><br></pre></td></tr></table></figure>
<p>翻译的例子涉及GPU并行比较复杂，不做介绍。</p>
<h1 id="Attention-Visualization"><a href="#Attention-Visualization" class="headerlink" title="Attention Visualization"></a>Attention Visualization</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tgt_sent = trans.split()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw</span><span class="params">(data, x, y, ax)</span>:</span></span><br><span class="line">    seaborn.heatmap(data, </span><br><span class="line">                    xticklabels=x, square=<span class="literal">True</span>, yticklabels=y, vmin=<span class="number">0.0</span>, vmax=<span class="number">1.0</span>, </span><br><span class="line">                    cbar=<span class="literal">False</span>, ax=ax)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>):</span><br><span class="line">    fig, axs = plt.subplots(<span class="number">1</span>,<span class="number">4</span>, figsize=(<span class="number">20</span>, <span class="number">10</span>))</span><br><span class="line">    print(<span class="string">"Encoder Layer"</span>, layer+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        draw(model.encoder.layers[layer].self_attn.attn[<span class="number">0</span>, h].data, sent, sent <span class="keyword">if</span> h ==<span class="number">0</span> <span class="keyword">else</span> [], ax=axs[h])</span><br><span class="line">    plt.show()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>):</span><br><span class="line">    fig, axs = plt.subplots(<span class="number">1</span>,<span class="number">4</span>, figsize=(<span class="number">20</span>, <span class="number">10</span>))</span><br><span class="line">    print(<span class="string">"Decoder Self Layer"</span>, layer+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        draw(model.decoder.layers[layer].self_attn.attn[<span class="number">0</span>, h].data[:len(tgt_sent), :len(tgt_sent)], tgt_sent, tgt_sent <span class="keyword">if</span> h ==<span class="number">0</span> <span class="keyword">else</span> [], ax=axs[h])</span><br><span class="line">    plt.show()</span><br><span class="line">    print(<span class="string">"Decoder Src Layer"</span>, layer+<span class="number">1</span>)</span><br><span class="line">    fig, axs = plt.subplots(<span class="number">1</span>,<span class="number">4</span>, figsize=(<span class="number">20</span>, <span class="number">10</span>))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        draw(model.decoder.layers[layer].self_attn.attn[<span class="number">0</span>, h].data[:len(tgt_sent), :len(sent)],sent, tgt_sent <span class="keyword">if</span> h ==<span class="number">0</span> <span class="keyword">else</span> [], ax=axs[h])</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
<h2 id="Encoder-visualization"><a href="#Encoder-visualization" class="headerlink" title="Encoder visualization"></a>Encoder visualization</h2><div class="note info">
            <p>Encoder Layer 2</p>
          </div>
<p><img src="/2020/05/11/transformer/encoder_layer_2.png" alt></p>
<div class="note info">
            <p>Encoder Layer 2</p>
          </div>
<p><img src="/2020/05/11/transformer/encoder_layer_4.png" alt></p>
<div class="note info">
            <p>Encoder Layer 6</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511115252714.png" alt></p>
<p>同一行，比较不同的head,可以看出，不同的head，attention到的内容是各不相同的。</p>
<h2 id="Decoder-visualization"><a href="#Decoder-visualization" class="headerlink" title="Decoder visualization"></a>Decoder visualization</h2><div class="note info">
            <p>decoder Self Layer 2 :<code>&lt;s&gt;</code>会attention到所有单词，单词大多会attention到自己。</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511120009561.png" alt></p>
<div class="note info">
            <p>decoder Src Layer 2</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511120705604.png" alt></p>
<div class="note info">
            <p>decoder Self Layer 4</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511120927309.png" alt></p>
<div class="note info">
            <p>decoder Src Layer 4</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511120946538.png" alt></p>
<div class="note info">
            <p>decoder Self Layer 6</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511121002344.png" alt></p>
<div class="note info">
            <p>decoder Src Layer 6</p>
          </div>
<p><img src="/2020/05/11/transformer/image-20200511121021648.png" alt></p>
<p>上三角全黑：表示decoder是一个串行计算，每一个词只会attention到其前面的词。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h2 id="tricks"><a href="#tricks" class="headerlink" title="tricks"></a>tricks</h2><p>在训练过程中，模型没有收敛得很好时，Decoder预测产生的词很可能不是我们想要的。这个时候如果再把错误的数据再输给Decoder，就会越跑越偏。这个时候怎么办？</p>
<ul>
<li>在训练过程中可以使用 “teacher forcing”。因为我们知道应该预测的word是什么，那么可以给Decoder喂一个正确的结果作为输入。</li>
<li>除了选择最高概率的词 (greedy search)，还可以选择是比如 “Beam Search”，可以保留topK个预测的word。 Beam Search 方法不再是只得到一个输出放到下一步去训练了，我们可以设定一个值，拿多个值放到下一步去训练，这条路径的概率等于每一步输出的概率的乘积。</li>
</ul>
<h2 id="Transformer的优缺点"><a href="#Transformer的优缺点" class="headerlink" title="Transformer的优缺点"></a>Transformer的优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>每层计算复杂度比RNN要低。</li>
<li>可以进行<strong>并行计算</strong>。</li>
<li>从计算一个序列长度为n的信息要经过的路径长度来看, CNN需要增加卷积层数来扩大视野，RNN需要从1到n逐个进行计算，而Self-attention只需要一步矩阵计算就可以。Self-Attention可以比RNN更好地解决长时依赖问题。当然如果计算量太大，比如序列长度N大于序列维度D这种情况，也可以用窗口限制Self-Attention的计算数量。</li>
<li>从作者在附录中给出的栗子可以看出，Self-Attention模型更可解释，Attention结果的分布表明了该模型学习到了一些语法和语义信息。</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>实践上：有些RNN轻易可以解决的问题transformer没做到，比如<strong>复制string</strong>，或者推理时碰到的sequence长度比训练时更长（因为<strong>碰到了没见过的position embedding</strong>）。</li>
<li>理论上：transformers不是computationally universal(图灵完备)，这种非RNN式的模型是非图灵完备的的，<strong>无法单独完成NLP中推理、决策等计算问题</strong>（包括使用transformer的bert模型等等）。</li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://nlp.seas.harvard.edu/2018/04/03/attention.html" target="_blank" rel="noopener">The Annotated Transformer</a></li>
<li><a href="https://www.cnblogs.com/zingp/p/11696111.html" target="_blank" rel="noopener">深入理解Transformer及其源码</a></li>
</ol>
]]></content>
      <categories>
        <category>技术/自然语言处理</category>
      </categories>
      <tags>
        <tag>transformer</tag>
      </tags>
  </entry>
  <entry>
    <title>平滑方法</title>
    <url>/2020/05/08/%E5%B9%B3%E6%BB%91%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://protao.github.io/img/2gramsmooth.png" alt></p>
<a id="more"></a>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>在一个概率模型中，也就是 p(e)在 event space E 下的概率分布，模型很可能会用最大似然估计(MLE)：</p>
<script type="math/tex; mode=display">
P_{M L E}=\frac{c(x)}{\sum_{e} c(e)}</script><p>然而，由于并没有足够的数据，很多事件 $x$ 并没有在训练数据中出现，也就是 $c(x)=0$，$P_{MLE}=0$这是有问题的，没有在训练数据中出现的数据，并不代表不会在测试数据中出现，如果没有考虑到数据稀疏性，模型就显得太简单了。</p>
<p>Data sparsity 是 smoothing 的最大原因。Chen &amp; Goodman 在1998 年提到过，几乎所有数据稀疏的场景下，smoothing 都可以帮助提高 performance，而数据稀疏性几乎是所有统计模型都会遇到的问题。而如果你有足够多的训练数据，所有的 parameters 都可以在没有 smoothing 的情况下被准确的估计，那么你总是可以扩展模型，如原来是 bigram，没有数据稀疏，完全可以扩展到 trigram 来提高 performance，如果还没有出现稀疏，就再往高层推，当 parameters 越来越多的时候，数据稀疏再次成为了问题，这时候，用合适的平滑方法可以得到更准确的模型。实际上，无论有多少的数据，平滑几乎总是可以以很小的代价来提高 performance。</p>
<h3 id="平滑方法"><a href="#平滑方法" class="headerlink" title="平滑方法"></a>平滑方法</h3><h4 id="add-one-smoothing"><a href="#add-one-smoothing" class="headerlink" title="add-one smoothing"></a>add-one smoothing</h4><p>(也叫laplace smoothing),以bigram为例：</p>
<p>MLE estimate：</p>
<script type="math/tex; mode=display">
P_{M L E}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1} w_{i}\right)}{c\left(w_{i-1}\right)}</script><p>Add-one estimate:</p>
<script type="math/tex; mode=display">
P_{A d d-1}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1} w_{i}\right)+1}{c\left(w_{i-1}\right)+V}</script><p>其中，$V$表示词典大小。</p>
<p>假设语料库为：</p>
<blockquote>
<ol>
<li>john read moby dick</li>
<li>mary read a different book</li>
<li>she read a book by cher</li>
</ol>
</blockquote>
<p>那么，john read a book 这个句子的概率为：</p>
<script type="math/tex; mode=display">
\begin{aligned}
p(\text { john read a book })&=p(\text { john } |<s>)  p(\text { read } | \text { john })  p(\text { a } | \text { read })  p(\text { book } | a )  p(<e> | \text {book}) \\
&=\frac{c(<s>,john)}{\sum_{w} c(<s>,w)} \frac{c(john,read)}{\sum_{w} c(john,w)} \frac{c(read,a)}{\sum_{w} c(read,w)} \frac{c(a,book)}{\sum_{w} c(a,w)} \frac{c(book,<e>)}{\sum_{w} c(book,w)}\\
&= \frac{1}{3} * \frac{1}{1} * \frac{2}{3} * \frac{1}{2} * \frac{1}{2} \\
&\approx 0.006
\end{aligned}</script><p>而，cher read a book 这个句子出现的概率是：</p>
<script type="math/tex; mode=display">
\begin{aligned}
p(\text { cher read a book })&=p(\text { cher } |<s>)  p(\text { read } | \text { cher })  p(\text { a } | \text { read })  p(\text { book } | a )  p(<e> | \text {book}) \\
&=\frac{c(<s>,cher)}{\sum_{w} c(<s>,w)} \frac{c(cher,read)}{\sum_{w} c(cher,w)} \frac{c(read,a)}{\sum_{w} c(read,w)} \frac{c(a,book)}{\sum_{w} c(a,w)} \frac{c(book,<e>)}{\sum_{w} c(book,w)}\\
&= \frac{0}{3} * \frac{0}{1} * \frac{2}{3} * \frac{1}{2} * \frac{1}{2} \\
&\approx 0
\end{aligned}</script><p>如果使用add-one smoothing：</p>
<script type="math/tex; mode=display">
\begin{aligned}
p(\text { john read a book })&=p(\text { john } |<s>)  p(\text { read } | \text { john })  p(\text { a } | \text { read })  p(\text { book } | a )  p(<e> | \text {book}) \\
&= \frac{1+1}{3+11} * \frac{1+1}{1+11} * \frac{2+1}{3+11} * \frac{1+1}{2+11} * \frac{1+1}{2+11} \\
&\approx 0.0001
\end{aligned}</script><script type="math/tex; mode=display">
\begin{aligned}
p(\text { cher read a book })&=p(\text { cher } |<s>)  p(\text { read } | \text { cher })  p(\text { a } | \text { read })  p(\text { book } | a )  p(<e> | \text {book}) \\
&= \frac{0+1}{3+11} * \frac{0+1}{1+11} * \frac{2+1}{3+11} * \frac{1+1}{2+11} * \frac{1+1}{2+11} \\
&\approx 0.00003
\end{aligned}</script><p>加 1 平滑通常情况下是一种很糟糕的算法，与其他平滑方法相比显得非常差，可以把加 1 平滑用在其他任务中，如文本分类，或者非零计数没那么多的情况下。</p>
<h4 id="Additive-smoothing"><a href="#Additive-smoothing" class="headerlink" title="Additive smoothing"></a>Additive smoothing</h4><p>对加 1 平滑的改进就是把 1 改成 $\delta$，且 $0&lt;\delta$</p>
<script type="math/tex; mode=display">
P_{A d d-\delta}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1} w_{i}\right)+\delta}{c\left(w_{i-1}\right)+\delta V}</script><p>可以把$\delta$看作是一个可以调节的超参数。</p>
<h4 id="Good-Turing-smoothing"><a href="#Good-Turing-smoothing" class="headerlink" title="Good-Turing smoothing"></a>Good-Turing smoothing</h4><p><strong>基本思想:</strong> 用观察计数较高的 N-gram 数量来重新估计概率量大小，并把它指派给那些具有零计数或较低计数的 N-gram.</p>
<p>举个例子：假设你在钓鱼，然后抓到了 18 条鱼，种类如下：10条鲤鱼, 3条黑鱼, 2条刀鱼, 1条鲨鱼, 1条草鱼, 1条鳗鱼，那么</p>
<ol>
<li><p>下一个钓到的鱼是鲨鱼的概率是多少？</p>
<p>1/18</p>
</li>
<li><p>下一条与是新鱼种（之前没有出现过）的概率是多少？</p>
<p>3/18(没有出现过的按出现过一次算)</p>
</li>
<li><p>下一条抓到的鱼是鲨鱼的概率是多少？</p>
<p>首先肯定的是概率小于1/18  —&gt; good turing</p>
</li>
</ol>
<p>在good turing 下,对参数的估计分两种情况：</p>
<ol>
<li>没有出现过的：$P_{GT}=\frac{N_1}{N}$</li>
<li>出现过的：$P_{GT}=\frac{(c+1)N_{c+1}}{N_c*N}$</li>
</ol>
<p>其中，$N_c$表示出现c次的单词个数,$N$代表样本总数。<br>比如：</p>
<blockquote>
<p>sam i am i am sam i do not eat </p>
<p>sam：2次</p>
<p>i：3次</p>
<p>am：2次</p>
<p>do：1次</p>
<p>not：1次</p>
<p>eat：1次</p>
</blockquote>
<p>有：$N_3=1,N_2=2,N_1=3$</p>
<p>对于第3个问题：$P_{GT}=\frac{(1+1)<em>1}{3</em>18}=\frac{1}{27}$.</p>
<h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><p>由公式：$P_{GT}=\frac{(c+1)N_{c+1}}{N_c*N}$在计算当前项$c$ 的时候，需要计算到$c+1$的$N_{c+1}$,若$N_{c+1}=0$，则会导致概率为0.</p>
<p>解决方法：可以利用机器学习中回归算法对$N_1,N_2,\ldots,N_c,N_{c+1}$进行拟合，进而得出$N_{c+1}$的值。</p>
<h4 id="Interpolation"><a href="#Interpolation" class="headerlink" title="Interpolation"></a>Interpolation</h4><p><strong>基本思想</strong>：在计算Trigram概率的同时，考虑Unigram，Bigram，Trigram出现的次数。</p>
<p>举个例子：有</p>
<p><code>C(in the kitchen)=0</code>,<code>C(the kitchen)=3</code>,<code>C(kitchen)=4</code>,<code>C(arboretum)=0</code>.在计算<code>p(kitchen|in the)</code>和<code>p(arboretum|in the)</code>的时候，从语料计算得出：$p(kitchen|in,the)=p(arboretum|in,the)=0$,但是从经验上来讲$p(kitchen|in,the)&gt;p(arboretum|in,the)$，因为kitchen要比arboretum常见的多。要实现这个，我们就希望把 bigram 和 unigram 结合起来，interpolate 就是这样一种方法。用线性差值把不同阶的 N-gram 结合起来，这里结合了 trigram，bigram 和 unigram。用 lambda 进行加权</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathrm{p}\left(\mathrm{w}_{\mathrm{n}} | \mathrm{w}_{\mathrm{n}-1}, \mathrm{w}_{\mathrm{n}-2}\right)=& \lambda_{1} \mathrm{p}\left(\mathrm{w}_{\mathrm{n}} | \mathrm{w}_{\mathrm{n}-1}, \mathrm{w}_{\mathrm{n}-2}\right) \\
&+\lambda_{2} \mathrm{p}\left(\mathrm{w}_{\mathrm{n}} | \mathrm{w}_{\mathrm{n}-1}\right) \\
&+\lambda_{3} \mathrm{p}\left(\mathrm{w}_{\mathrm{n}}\right)\\
\sum_i\lambda_i=1
\end{aligned}</script><h5 id="怎样设置-lambdas？？？？"><a href="#怎样设置-lambdas？？？？" class="headerlink" title="怎样设置 lambdas？？？？"></a>怎样设置 lambdas？？？？</h5>]]></content>
      <categories>
        <category>自然语言处理</category>
      </categories>
      <tags>
        <tag>自然语言处理基础</tag>
      </tags>
  </entry>
  <entry>
    <title>分词算法</title>
    <url>/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/2.png" alt></p>
<a id="more"></a>
<h3 id="分词简介"><a href="#分词简介" class="headerlink" title="分词简介"></a>分词简介</h3><p>中文分词算法是指将一个汉字序列切分成一个一个单独的词，与英文以空格作为天然的分隔符不同，中文字符在语义识别时，需要把数个字符组合成词，才能表达出真正的含义。分词算法通常应用于自然语言处理、搜索引擎、智能推荐等领域。</p>
<p>分词算法根据其核心思想主要分为两种，第一种是基于词典的分词，先把句子按照字典切分成词，再寻找词的最佳组合方式；第二种是基于字的分词，即由字构词，先把句子分成一个个字，再将字组合成词，寻找最优的切分策略，同时也可以转化成序列标注问题。</p>
<p>其分类大致可分为：</p>
<ol>
<li><p>基于匹配规则的方法</p>
<ul>
<li>正向最大匹配法(forward maximum matching method, FMM)</li>
<li>逆向最大匹配法(backward maximum matching method, BMM)</li>
<li>最短路径分词算法</li>
</ul>
</li>
<li><p>基于统计以及机器学习的分词方法</p>
<ul>
<li>基于N-gram语言模型的分词方法</li>
<li>基于HMM的分词方法</li>
<li>基于CRF的分词方法</li>
<li>基于词感知机的分词方法</li>
<li>基于深度学习的端到端的分词方法</li>
</ul>
</li>
</ol>
<p>基于规则匹配的分词通常会加入一些启发式规则，比如“正向/反向最大匹配”，“长词优先”等。</p>
<p>基于统计以及机器学习的分词方法，它们基于人工标注的词性和统计特征，对中文进行建模，即根据观测到的数据(标注好的语料)对模型参数进行训练，在分词阶段再通过模型计算各种分词出现的概率，将概率最大的分词结果作为最终结果。这类分词算法能很好处理歧义和未登录词问题，效果比基于规则匹配的方法效果好，但是需要大量的人工标注数据，以及较慢的分词速度。</p>
<p><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">代码及数据</a></p>
<h4 id="中文分词的应用"><a href="#中文分词的应用" class="headerlink" title="中文分词的应用"></a>中文分词的应用</h4><p>目前在自然语言处理技术中，中文处理技术比西文处理技术要落后很大一段距离，许多西文的处理方法中文不能直接采用，就是因为中文必需有分词这道工序。中文分词是其他中文信息处理的基础，搜索引擎只是中文分词的一个应用。其他的比如机器翻译（MT）、语音合成、自动分类、自动摘要、自动校对等等，都需要用到分词。因为中文需要分词，可能会影响一些研究，但同时也为一些企业带来机会，因为国外的计算机处理技术要想进入中国市场，首先也是要解决中文分词问题。在中文研究方面，相比外国人来说，中国人有十分明显的优势。</p>
<p>分词准确性对搜索引擎来说十分重要，但如果分词速度太慢，即使准确性再高，对于搜索引擎来说也是不可用的，因为搜索引擎需要处理数以亿计的网页，如果分词耗用的时间过长，会严重影响搜索引擎内容更新的速度。因此对于搜索引擎来说，分词的准确性和速度，二者都需要达到很高的要求。目前研究中文分词的大多是科研院校，清华、北大、中科院、北京语言学院、东北大学、IBM研究院、微软中国研究院等都有自己的研究队伍，而真正专业研究中文分词的商业公司除了海量科技以外，几乎没有。</p>
<h3 id="基于匹配规则的方法"><a href="#基于匹配规则的方法" class="headerlink" title="基于匹配规则的方法"></a>基于匹配规则的方法</h3><p>主要是人工建立词库也叫做词典，通过词典匹配的方式对句子进行划分。其实现简单高效，但是对未登陆词很难进行处理。主要有前向最大匹配法，后向最大匹配法以及双向最大匹配法。</p>
<h4 id="前向最大匹配算法"><a href="#前向最大匹配算法" class="headerlink" title="前向最大匹配算法"></a>前向最大匹配算法</h4><p>前向最大匹配算法，是从待分词句子的左边向右边搜索，寻找词的最大匹配。规定一个词的最大长度，每次扫描的时候寻找当前开始的这个长度的词来和字典中的词匹配，如果没有找到，就缩短长度继续寻找，直到找到字典中的词或者成为单字。</p>
<h5 id="算法流程"><a href="#算法流程" class="headerlink" title="算法流程"></a>算法流程</h5><ol>
<li>从前向后扫描字典，测试读入的子串是否在字典中</li>
<li>如果存在，则从输入中删除掉该子串，重新按照规则取子串，重复1</li>
<li>如果不存在于字典中，则从右向左减少子串长度，重复1</li>
</ol>
<h5 id="分词实例："><a href="#分词实例：" class="headerlink" title="分词实例："></a>分词实例：</h5><p>比如说输入 “北京大学生前来应聘”，假设词典中最长的单词为 5 个（MAX_LENGTH）。</p>
<ol>
<li>第一轮：取子串 “北京大学生”，正向取词，如果匹配失败，<strong>每次去掉匹配字段最后面的一个字</strong><br>“北京大学生”，扫描 5 字词典，没有匹配，子串长度减 1 变为“北京大学”<br>“北京大学”，扫描 4 字词典，有匹配，输出“北京大学”，输入变为“生前来应聘”</li>
<li>第二轮：取子串“生前来应聘”<br>“生前来应聘”，扫描 5 字词典，没有匹配，子串长度减 1 变为“生前来应”<br>“生前来应”，扫描 4 字词典，没有匹配，子串长度减 1 变为“生前来”<br>“生前来”，扫描 3 字词典，没有匹配，子串长度减 1 变为“生前”<br>“生前”，扫描 2 字词典，有匹配，输出“生前”，输入变为“来应聘””</li>
<li>第三轮：取子串“来应聘”<br>“来应聘”，扫描 3 字词典，没有匹配，子串长度减 1 变为“来应”<br>“来应”，扫描 2 字词典，没有匹配，子串长度减 1 变为“来”<br>颗粒度最小为 1，直接输出“来”，输入变为“应聘”</li>
<li>第四轮：取子串“应聘”<br>“应聘”，扫描 2 字词典，有匹配，输出“应聘”，输入变为“”<br>输入长度为0，扫描终止</li>
</ol>
<h5 id="代码"><a href="#代码" class="headerlink" title="代码"></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">代码</a></h5><p>数据准备：词库</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward_max_match</span><span class="params">(sentence, window_size, word_dict)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    前向最大匹配算法：</span></span><br><span class="line"><span class="string">    （1）扫描字典，测试读入的子串是否在字典中</span></span><br><span class="line"><span class="string">    （2）如果存在，则从输入中删除掉该子串，重新按照规则取子串，重复（1）</span></span><br><span class="line"><span class="string">    （3）如果不存在于字典中，则从右向左减少子串长度，重复（1）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param sentence: 待分词的句子</span></span><br><span class="line"><span class="string">    :param window_size: 词的最大长度</span></span><br><span class="line"><span class="string">    :param word_dict: 词典</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    seg_words = []  <span class="comment"># 存放分词结果</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> sentence:</span><br><span class="line">        <span class="keyword">for</span> word_len <span class="keyword">in</span> range(window_size, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> sentence[:word_len] <span class="keyword">in</span> word_dict:</span><br><span class="line">                <span class="comment"># 如果该词再字典中，将该词保存到分词结果中,并将其从句中切出来</span></span><br><span class="line">                seg_words.append(sentence[:word_len])</span><br><span class="line">                sentence = sentence[word_len:]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果窗口中的词不在字典中，将第一个字切分出来</span></span><br><span class="line">            seg_words.append(sentence[:word_len])</span><br><span class="line">            sentence = sentence[word_len:]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'/'</span>.join(seg_words)</span><br></pre></td></tr></table></figure>
<h4 id="后向最大匹配算法"><a href="#后向最大匹配算法" class="headerlink" title="后向最大匹配算法"></a>后向最大匹配算法</h4><p>在词典中从句尾向句首进行扫描，尽可能地选择与词典中最长单词匹配的词作为目标分词，然后进行下一次匹配。</p>
<p>在实践中，逆向最大匹配算法性能优于正向最大匹配算法。 </p>
<h5 id="算法流程-1"><a href="#算法流程-1" class="headerlink" title="算法流程"></a>算法流程</h5><ol>
<li>从后向前扫描字典，测试读入的子串是否在字典中</li>
<li>如果存在，则从输入中删除掉该子串，重新按照规则取子串，重复1</li>
<li>如果不存在于字典中，则从左向右减少子串长度，重复1</li>
</ol>
<h5 id="分词实例"><a href="#分词实例" class="headerlink" title="分词实例"></a>分词实例</h5><p>输入 “北京大学生前来应聘”，假设词典中最长的单词为 5 个（MAX_LENGTH）。</p>
<ol>
<li>第一轮：取子串 “生前来应聘”，逆向取词，如果匹配失败，<strong>每次去掉匹配字段最前面的一个字</strong><br>“生前来应聘”，扫描 5 字词典，没有匹配，字串长度减 1 变为“前来应聘”<br>“前来应聘”，扫描 4 字词典，没有匹配，字串长度减 1 变为“来应聘”<br>“来应聘”，扫描 3 字词典，没有匹配，字串长度减 1 变为“应聘”<br>“应聘”，扫描 2 字词典，有匹配，输出“应聘”，输入变为“大学生前来”</li>
<li>第二轮：取子串“大学生前来”<br>“大学生前来”，扫描 5 字词典，没有匹配，字串长度减 1 变为“学生前来”<br>“学生前来”，扫描 4 字词典，没有匹配，字串长度减 1 变为“生前来”<br>“生前来”，扫描 3 字词典，没有匹配，字串长度减 1 变为“前来”<br>“前来”，扫描 2 字词典，有匹配，输出“前来”，输入变为“北京大学生”</li>
<li>第三轮：取子串“北京大学生”<br>“北京大学生”，扫描 5 字词典，没有匹配，字串长度减 1 变为“京大学生”<br>“京大学生”，扫描 4 字词典，没有匹配，字串长度减 1 变为“大学生”<br>“大学生”，扫描 3 字词典，有匹配，输出“大学生”，输入变为“北京”</li>
<li>第四轮：取子串“北京”<br>“北京”，扫描 2 字词典，有匹配，输出“北京”，输入变为“”<br>输入长度为0，扫描终止</li>
</ol>
<h5 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">代码</a></h5><p>数据准备：词库</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backward_max_match</span><span class="params">(sentence, window_size, word_dict)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    后向最大匹配算法：</span></span><br><span class="line"><span class="string">    （1）从后向前扫描字典，测试读入的子串是否在字典中</span></span><br><span class="line"><span class="string">    （2）如果存在，则从输入中删除掉该子串，重新按照规则取子串，重复（1）</span></span><br><span class="line"><span class="string">    （3）如果不存在于字典中，则从右向左减少子串长度，重复（1）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param sentence: 待分词的句子</span></span><br><span class="line"><span class="string">    :param window_size: 词的最大长度</span></span><br><span class="line"><span class="string">    :param word_dict: 词典</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    seg_words = []</span><br><span class="line">    <span class="keyword">while</span> sentence:</span><br><span class="line">        <span class="keyword">for</span> word_len <span class="keyword">in</span> range(window_size, <span class="number">0</span>, <span class="number">-1</span>):  <span class="comment"># 每次去掉匹配字段最前面的一个字</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> sentence[len(sentence) - word_len:] <span class="keyword">in</span> word_dict:</span><br><span class="line">                <span class="comment"># 如果该词再字典中，将该词保存到分词结果中,并将其从句中切出来</span></span><br><span class="line">                seg_words.append(sentence[len(sentence) - word_len:])</span><br><span class="line">                sentence = sentence[:len(sentence) - word_len]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果窗口中的词不在字典中，将最后一个字切分出来</span></span><br><span class="line">            seg_words.append(sentence[<span class="number">-1</span>:])</span><br><span class="line">            sentence = sentence[:<span class="number">-1</span>]</span><br><span class="line">    seg_words.reverse()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'/'</span>.join(seg_words)</span><br></pre></td></tr></table></figure>
<h4 id="双向最大匹配法"><a href="#双向最大匹配法" class="headerlink" title="双向最大匹配法"></a>双向最大匹配法</h4><p>因为同一个句子，在机械分词中经常会出现多种分词的组合，因此需要进行歧义消除，来得到最优的分词结果。</p>
<p>以很常见的MMSEG机械分词算法为例，MMSEG在搜索引擎Solr中经常使用到，是一种非常可靠高效的分词算法。MMSEG消除歧义的规则有四个，它在使用中依次用这四个规则进行过滤，直到只有一种结果或者第四个规则使用完毕。这个四个规则分别是：</p>
<ol>
<li><p>最大匹配。选择“词组长度最大的”那个词组，然后选择这个词组的第一个词，作为切分出的第一个词，如对于“中国人民万岁”，匹配结果分别为：</p>
<ul>
<li>中/国/人</li>
<li>中国/人/民</li>
<li>中国/人民/万岁</li>
<li>中国人/民/万岁</li>
</ul>
<p>在这个例子“词组长度最长的”词组为后两个，因此选择了“中国人/民/万岁”中的“中国人”，或者“中国/人民/万岁”中的“中国”。</p>
</li>
<li><p>最大平均词语长度。经过规则1过滤后，如果剩余的词组超过1个，那就选择平均词语长度最大的那个(平均词长=词组总字数/词语数量)。比如“生活水平”，可能得到如下词组：</p>
<ul>
<li>生/活水/平 (4/3=1.33)</li>
<li>生活/水/平 (4/3=1.33)</li>
<li>生活/水平 (4/2=2)</li>
</ul>
<p>根据此规则，就可以确定选择“生活/水平”这个词组</p>
</li>
<li><p>词语长度的最小变化率。这个变化率一般可以由标准差来决定。比如对于“中国人民万岁”这个短语，可以计算：</p>
<ul>
<li>中国/人民/万岁(标准差=sqrt(((2-2)^2+(2-2)^2+(2-2^2))/3)=0)</li>
<li>中国人/民/万岁(标准差=sqrt(((2-3)^2+(2-1)^2+(2-2)^2)/3)=0.8165)</li>
</ul>
<p>于是选择“中国/人民/万岁”这个词组。</p>
</li>
<li><p>计算词组中的所有单字词词频的自然对数，然后将得到的值相加，取总和最大的词组。比如：</p>
<ul>
<li>设施/和服/务</li>
<li>设施/和/服务</li>
</ul>
<p>这两个词组中分别有“务”和“和”这两个单字词，假设“务”作为单字词时候的频率是5，“和”作为单字词时候的频率是10，对5和10取自然对数，然后取最大值者，所以取“和”字所在的词组，即“设施/和/服务”。</p>
</li>
</ol>
<p>在实际中根据需求，选择或制定相应的规则来改善分词的质量。</p>
<h5 id="算法流程-2"><a href="#算法流程-2" class="headerlink" title="算法流程"></a>算法流程</h5><ol>
<li>比较正向最大匹配和逆向最大匹配结果</li>
<li>如果分词数量结果不同，那么取分词数量较少的那个</li>
<li>如果分词数量结果相同<ul>
<li>分词结果相同，可以返回任何一个</li>
<li>分词结果不同，返回单字数比较少的那个</li>
</ul>
</li>
</ol>
<p>这种规则的出发点来自语言学上的启发：汉语中单字词的数量要远小于非单字词。因此，算法应当尽量减少结果中的单字，保留更多的完整词语。</p>
<h5 id="分词实例-1"><a href="#分词实例-1" class="headerlink" title="分词实例"></a>分词实例</h5><p>正向匹配最终切分结果为：北京大学 / 生前 / 来 / 应聘，分词数量为 4，单字数为 1<br>逆向匹配最终切分结果为：”北京/ 大学生/ 前来 / 应聘，分词数量为 4，单字数为 0<br>逆向匹配单字数少，因此返回逆向匹配的结果。</p>
<h5 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">代码</a></h5><p>数据准备：词库</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_max_match</span><span class="params">(sentence,window_size,word_dict)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    1. 比较正向最大匹配和逆向最大匹配结果</span></span><br><span class="line"><span class="string">    2. 如果分词数量结果不同，那么取分词数量较少的那个</span></span><br><span class="line"><span class="string">    3. 如果分词数量结果相同</span></span><br><span class="line"><span class="string">       * 分词结果相同，可以返回任何一个</span></span><br><span class="line"><span class="string">       * 分词结果不同，返回单字数比较少的那个</span></span><br><span class="line"><span class="string">    :param sentence: 待分词的句子</span></span><br><span class="line"><span class="string">    :param window_size: 词的最大长度</span></span><br><span class="line"><span class="string">    :param word_dict: 词典</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    forward_seg = forward_max_match(sentence,window_size,word_dict)</span><br><span class="line">    backward_seg = backward_max_match(sentence,window_size,word_dict)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果分词结果不同，返回词数较小的分词结果</span></span><br><span class="line">    <span class="keyword">if</span> len(forward_seg) != len(backward_seg):</span><br><span class="line">        <span class="keyword">return</span> forward_seg <span class="keyword">if</span> len(forward_seg) &lt; len(backward_seg) <span class="keyword">else</span> backward_seg</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 如果分词结果词数相同，优先考虑返回包含单个字符最少的分词结果</span></span><br><span class="line">        forward_single_word_count = len([filter(<span class="keyword">lambda</span> x:len(x) == <span class="number">1</span>,forward_seg)])</span><br><span class="line">        backward_single_word_count = len([filter(<span class="keyword">lambda</span> x:len(x) == <span class="number">1</span>,backward_seg)])</span><br><span class="line">        <span class="keyword">if</span> forward_single_word_count != backward_single_word_count:</span><br><span class="line">            <span class="keyword">return</span> forward_seg <span class="keyword">if</span> forward_single_word_count &lt; backward_single_word_count <span class="keyword">else</span> backward_seg</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 否则，返回任意结果</span></span><br><span class="line">            <span class="keyword">return</span> forward_seg</span><br></pre></td></tr></table></figure>
<h5 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h5><p>对歧义问题的解决有点弱</p>
<h4 id="N-最短路径分词算法"><a href="#N-最短路径分词算法" class="headerlink" title="(N-)最短路径分词算法"></a>(N-)最短路径分词算法</h4><h5 id="基本思想"><a href="#基本思想" class="headerlink" title="基本思想"></a>基本思想</h5><p>首先基于词典对文本进行全切分(改编版最大匹配)；然后基于词语的临接关系构建一个有向图；使用模型(比如一阶马尔科夫模型)对图里的边加权；最后使用最短路径算法求，从句首到句末质量最高(比如概率最大)的路径，就得到了分词结果。</p>
<h5 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h5><p>最短路径分词算法首先将一句话中的所有词匹配出来，构成词图（有向无环图DAG），之后寻找从起始点到终点的最短路径作为最佳组合方式，以“他说的确实在理”为例，给出对这句话的3-最短路：<br><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/最短路径分词算法.png" alt="avatar"></p>
<ol>
<li><p>构建有向图：根据一个已有词典构造出的有向无环图（全切分，根据临接关系构建有向图）。它将字串分为单个的字，每个字用图中相邻的两个结点表示，故对于长度为n的字串，需要n+1个结点。两节点间若有边，则表示两节点间所包含的所有结点构成的词，如图中结点2、3、4构成词“的确”。</p>
</li>
<li><p>计算权重：本例子中权重为1（为了简单），实际应用中，可以使用一阶马尔科夫模型进行权重计算。</p>
<ul>
<li>p(实，在)=p(实)*p(在|实)。概率取值越大，说明一个边出现的概率越大，这条边会提升所在分句结果的概率，由于最后要计算最短路径，需要构造一个连接权重与分局结果质量成反比的指标，因此对概率取了倒：weight=1/p(实,在)</li>
<li><p>这个概率可能非常小，得到的权重取值非常大。而我们后面在计算路径的长度时，会将若干个边的权重加起来，这时候有上溢出的可能性。避免上溢出的常用策略是取对数。：weight=log(1/p(实，在))。</p>
</li>
<li><p>概率的估算：概率就用频率来估计，p(实) = （“实”字在语料中出现的次数）/（语料的总词数），</p>
<p>p(在|实) = p(实在)/p(实)=(“实在”在语料中出现的次数)/(“实”在语料中出现的次数)</p>
</li>
</ul>
</li>
</ol>
<h5 id="代码（维特比）"><a href="#代码（维特比）" class="headerlink" title="代码（维特比）"></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">代码（维特比）</a></h5><p>数据准备：1、词库，2、词语之间的条件概率（用来计算路径权重）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用维特比算法求词图的最短路径</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">viterbi</span><span class="params">(self, word_graph)</span>:</span></span><br><span class="line">    path_length_map = &#123;&#125;  <span class="comment"># 用于存储所有的路径，后面的邻接词语所在位置，以及对应的长度</span></span><br><span class="line">    word_graph = [[[<span class="string">"&lt;start&gt;"</span>, <span class="number">1</span>]]] + word_graph + [[[<span class="string">"&lt;end&gt;"</span>, <span class="number">-1</span>]]]</span><br><span class="line">    <span class="comment"># 这是一种比较简单的数据结构</span></span><br><span class="line">    path_length_map[(<span class="string">"&lt;start&gt;"</span>,)] = [<span class="number">1</span>, <span class="number">0</span>]  <span class="comment"># start处，后面的临接词语在列表的1处，路径长度是0,。</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(word_graph)):</span><br><span class="line">        distance_from_start2current = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> len(word_graph[i]) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> former_path <span class="keyword">in</span> list(path_length_map.keys()):  <span class="comment"># path_length_map内容一直在变，需要深拷贝key,也就是已经积累的所有路径</span></span><br><span class="line">            <span class="comment"># 取出已经积累的路径，后面的临接词语位置，以及路径的长度。</span></span><br><span class="line">            [next_index_4_former_path, former_distance] = path_length_map[former_path]</span><br><span class="line">            former_word = former_path[<span class="number">-1</span>]</span><br><span class="line">            later_path = list(former_path)</span><br><span class="line">            <span class="keyword">if</span> next_index_4_former_path == i:  <span class="comment"># 如果这条路径的临接词语的位置就是当前索引</span></span><br><span class="line">                <span class="keyword">for</span> current_word <span class="keyword">in</span> word_graph[i]:  <span class="comment"># 遍历词图数据中，这个位置上的所有换选词语，然后与former_path拼接新路径</span></span><br><span class="line">                    current_word, next_index = current_word</span><br><span class="line">                    new_path = tuple(later_path + [current_word])  <span class="comment"># 只有int, string, tuple这种不可修改的数据类型可以hash，</span></span><br><span class="line">                    <span class="comment"># 也就是成为dict的key</span></span><br><span class="line">                    <span class="comment"># 计算新路径的长度</span></span><br><span class="line">                    new_path_len = former_distance + self.word_distance.get((former_word, current_word), <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">                    path_length_map[new_path] = [next_index, new_path_len]  <span class="comment"># 存储新路径后面的临接词语，以及路径长度</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment"># 维特比的部分。选择到达当前节点的路径中，最短的那一条</span></span><br><span class="line">                    <span class="keyword">if</span> current_word <span class="keyword">in</span> distance_from_start2current:  <span class="comment"># 如果已经有到达当前词语的路径，需要择优</span></span><br><span class="line">                        <span class="keyword">if</span> distance_from_start2current[current_word][<span class="number">1</span>] &gt; new_path_len:  <span class="comment"># 如果当前新路径比已有的更短</span></span><br><span class="line">                            distance_from_start2current[current_word] = [new_path, new_path_len]  <span class="comment"># 用更短的路径数据覆盖原来的</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        distance_from_start2current[current_word] = [new_path, new_path_len]  <span class="comment"># 如果还没有这条路径，就记录它</span></span><br><span class="line">    shortest_path = distance_from_start2current[<span class="string">"&lt;end&gt;"</span>][<span class="number">0</span>]</span><br><span class="line">    shortest_path = shortest_path[<span class="number">1</span>:<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> shortest_path</span><br></pre></td></tr></table></figure>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ol>
<li>对歧义和新词的处理不是很好，对词典中未出现的词没法进行处理。</li>
<li>分词效果取决于词典的质量。</li>
</ol>
<h3 id="基于统计以及机器学习的分词方法"><a href="#基于统计以及机器学习的分词方法" class="headerlink" title="基于统计以及机器学习的分词方法"></a>基于统计以及机器学习的分词方法</h3><h4 id="基于N-gram语言模型的分词方法"><a href="#基于N-gram语言模型的分词方法" class="headerlink" title="基于N-gram语言模型的分词方法"></a>基于N-gram语言模型的分词方法</h4><h5 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h5><p>n-gram模型，称为N元模型，可用于定义字符串中的距离，也可用于中文的分词；该模型假设第n个词的出现只与前面n-1个词相关，与其他词都不相关，整个语句的概率就是各个词出现概率的乘积；而这些概率，利用语料，统计同时出现相关词的概率次数计算得到；常用的模型是Bi-gram和Tri-gram模型。<br>假设一个字符串s由m个词组成，因此我们需要计算出$p(w_1,w_2,\ldots,w_m)$的概率，根据概率论中的链式法则得到如下：</p>
<script type="math/tex; mode=display">
p(w_1,w_2,\ldots,w_m) = p(w_1)*p(w_2|w_1)*p(w_3|w_2,w_1)\ldots p(w_m|w_{m-1},\ldots,w_2,w_1)=\prod_{i}{p(w_i|w_1,w_2,\ldots,w_{i-1})}</script><p>那么下面的问题是如何计算上面每一个概率，比如$p(w_1,w_2,w_3,w_4,w_5)$，一种比较直观的计算就是计数然后用除法：</p>
<script type="math/tex; mode=display">
p(w_5|w_1,w_2,w_3,w_4) = \frac{Count(w_1,w_2,w_3,w_4,w_5)}{Count(w_1,w_2,w_3,w_4)}</script><p>直接计算这个概率的难度有点大：</p>
<ol>
<li><p>直接这样计算会导致参数空间过大。</p>
<p>一个语言模型的参数就是所有的这些条件概率，试想按上面方式计算$p(w_5|w_1,w_2,w_3,w_4)$,这里$w_5$有词典大小取值的可能，记词典大小：$|V|$，则该模型的参数个数是$|V|^5$，而且这还不包含$P(w_4|w_1,w_2,w_3)$的个数，可以看到这样去计算条件概率会使语言模型参数个数过多而无法使用。</p>
</li>
<li><p>数据稀疏严重。我的理解是像上面那样计数计算，比如计数分子$w_1,w_2,w_3,w_4,w_5$,在我们所能见的文本中出现的次数是很小的，这样计算的结果是过多的条件概率会等于0，因为我们根本没有看到足够的文本来统计！假设一个语料库中单词的数量为$|V|$个，一个句子由$n$个词组成，那么每个单词都可能有$|V|$个取值，那么由这些词组成的$n$元组合的数目为$|V|^n$种，也就是说，组合数会随着$n$的增加而呈现指数级别的增长，随着$n$的增加，语料数据库能够提供的数据是非常有限的，除非有海量的各种类型的语料数据，否则还有大量的$n$元组合都没有在语料库中出现过（即由$n$个单词所组成的一些句子根本就没出现过，可以理解为很多的$n$元组所组成的句子不能被人很好地理解）也就是说依据最大似然估计得到的概率将会是0，模型可能仅仅能够计算寥寥几个句子。怎么解决呢？</p>
</li>
</ol>
<p>解决參数空间过大的问题。引入了马尔科夫假设：<strong>随意一个词出现的概率只与它前面出现的有限的一个或者几个词有关。</strong>假设第$w_i$个词语只与它前面的$n$个词语相关，这样我们就得到前面的条件概率计算简化如下</p>
<script type="math/tex; mode=display">
p(w_i|w_{i-1},\ldots,w_2,w_1) \approx p(w_i|w_{i-1},\ldots,w_{i-n})\\
p(w_1,w_2,\ldots,w_m) \approx \prod_{i} p(w_i|w_{i-1},\ldots,w_{i-n})</script><p>当n=1，即一元模型（Uni-gram）,即$w_i$与它前面的0个词相关，即$w_i$不与任何词相关，每一个词都是相互独立的：</p>
<script type="math/tex; mode=display">
P\left(w_{1}, w_{2}, \cdots, w_{m}\right)=\prod_{i=1}^{m} P\left(w_{i}\right)</script><p>当n=2，即二元模型（Bi-gram）,此时$w_i$与它前面1个词相关：</p>
<script type="math/tex; mode=display">
P\left(w_{1}, w_{2}, \cdots, w_{m}\right)=\prod_{i=1}^{m} P\left(w_{i} | w_{i-1}\right)</script><p>当n=3时，即三元模型（Tri-gram）,此时$w_i$与它前面2个词相关：</p>
<script type="math/tex; mode=display">
P\left(w_{1}, w_{2}, \cdots, w_{m}\right)=\prod_{i=1}^{m} P\left(w_{i} | w_{i-2} w_{i-1}\right)</script><p>一般来说，N元模型就是假设当前词的出现概率只与它前面的N-1个词有关。而这些概率参数都是可以通过大规模语料库来计算。<strong>在实践中用的最多的就是bigram和trigram了，高于四元的用的非常少，由于训练它须要更庞大的语料，并且数据稀疏严重，时间复杂度高，精度却提高的不多。</strong></p>
<h5 id="参数估计"><a href="#参数估计" class="headerlink" title="参数估计"></a>参数估计</h5><p>要计算出模型中的条件概率，这些条件概率也称为模型的参数，得到这些参数的过程称为训练。用最大似然性估计计算下面的条件概率：</p>
<script type="math/tex; mode=display">
P\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1}, w_{i}\right)}{c\left(w_{i-1}\right)}</script><p>一元语言模型中：句子概率定义为：$P\left(s\right)=\prod_{i=1}^{m} P\left(w_{i}\right)$,这个式子成立的条件是有一个假设，就是条件无关假设，我们认为每个词都是条件无关的。这里的参数种类是一种 $P(w_n)$,但是参数实例有$|V|$个(V是词典大小),我们应该如何得到每个参数实例的值。用的是极大似然估计法。比如训练语料是:”星期五早晨，我特意起了个大早，为的就是看看早晨的天空。”那么我们的字典为：星 期 五 早 晨 ，我 特 意 起 了 个 大 早 为 的 就 是 看 天 空 。 22个不同词，每个词语的概率直接用极大似然估计法估计得到。如：p(星) = 1/27，p(期) = 1/27。于是需要存储学习得到的模型参数，一个向量，22维，每个维度保存着每个单词的概率值。当需要计算：p(我看看早晨的天空)=p(我)p(看)p(看)p(早)p(晨)p(的)p(天)p(空)=$\frac{1}{27}<em>\frac{1}{27}</em>\frac{1}{27}\ldots *\frac{1}{27}$，可以直接计算出来。于是只要将每句话拆开为每个单词然后用累积形式运算，这样就能算出每句话的概率。缺点是：不包含语序信息。</p>
<p>二元语言模型中：为了计算对应的二元模型的参数，即$P(w_i | w_{i-1})$，要先计数即$c(w_{i-1},w_i)$，然后计数$c(w_{i-1})$,再用除法可得到这些条件概率.可以看到对于$c(w_{i-1},w_i)$来说，$w_{i-1}$有语料库词典大小（记作$|V|$）的可能取值，$w_i$也是，所以$c(w_{i-1},w_i)$要计算的个数有$|V|^2$。</p>
<p>$c(w_{i-1},w_i)$计数结果如下:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>i</th>
<th>want</th>
<th>to</th>
<th>eat</th>
<th>chinese</th>
<th>food</th>
<th>lunch</th>
<th>english</th>
</tr>
</thead>
<tbody>
<tr>
<td>i</td>
<td>5</td>
<td>827</td>
<td>0</td>
<td>9</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
</tr>
<tr>
<td>want</td>
<td>2</td>
<td>0</td>
<td>608</td>
<td>1</td>
<td>6</td>
<td>6</td>
<td>5</td>
<td>1</td>
</tr>
<tr>
<td>to</td>
<td>2</td>
<td>0</td>
<td>4</td>
<td>686</td>
<td>2</td>
<td>0</td>
<td>6</td>
<td>211</td>
</tr>
<tr>
<td>eat</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>16</td>
<td>2</td>
<td>42</td>
<td>0</td>
</tr>
<tr>
<td>chinese</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>82</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>food</td>
<td>15</td>
<td>0</td>
<td>15</td>
<td>0</td>
<td>1</td>
<td>4</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>lunch</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>spend</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<p>$c(w_{i-1})$的计数如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>i</th>
<th>want</th>
<th>to</th>
<th>eat</th>
<th>chinese</th>
<th>food</th>
<th>lunch</th>
<th>english</th>
</tr>
</thead>
<tbody>
<tr>
<td>2533</td>
<td>927</td>
<td>2417</td>
<td>746</td>
<td>158</td>
<td>1093</td>
<td>341</td>
<td>278</td>
</tr>
</tbody>
</table>
</div>
<p>那么二元模型的参数计算结果如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>i</th>
<th>want</th>
<th>to</th>
<th>eat</th>
<th>chinese</th>
<th>food</th>
<th>lunch</th>
<th>english</th>
</tr>
</thead>
<tbody>
<tr>
<td>i</td>
<td>0.002</td>
<td>0.33</td>
<td>0</td>
<td>0.0036</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.00079</td>
</tr>
<tr>
<td>want</td>
<td>0.0022</td>
<td>0</td>
<td>0.66</td>
<td>0.0011</td>
<td>0.0065</td>
<td>0.0065</td>
<td>0.0054</td>
<td>0.0011</td>
</tr>
<tr>
<td>to</td>
<td>0.00083</td>
<td>0</td>
<td>0.0017</td>
<td>0.28</td>
<td>0.00083</td>
<td>0</td>
<td>0.0025</td>
<td>0.087</td>
</tr>
<tr>
<td>eat</td>
<td>0</td>
<td>0</td>
<td>0.0027</td>
<td>0</td>
<td>0.021</td>
<td>0.0027</td>
<td>0.056</td>
<td>0</td>
</tr>
<tr>
<td>chinese</td>
<td>0.0063</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.52</td>
<td>0.0063</td>
<td>0</td>
</tr>
<tr>
<td>food</td>
<td>0.014</td>
<td>0</td>
<td>0.0014</td>
<td>0</td>
<td>0.00092</td>
<td>0.0037</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>lunch</td>
<td>0.0059</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0029</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>spend</td>
<td>0.0036</td>
<td>0</td>
<td>0.0036</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<p>比如计算其中的P(want | i) = 0.33如:$p(want|i) = \frac{c(i,want)}{c(i)}=\frac{827}{2533} \approx0.33$,针对这个语料库的二元模型建立好了后，可以计算目标，即一个句子的概率了，一个例子如下：</p>
<p>$p(s)=p(i want english food) = p(i|<start>)<em>p(want|i)</em>p(english|want)<em>p(food|english)</em>p(<end>|food) \approx 0.000031$</end></start></p>
<p>该二元模型所捕捉到的一些实际信息:</p>
<ul>
<li>$p(english|want) = 0.0011,p(chinese|want)=0.0065$,want chinese 的概率更高，这和真实世界情况相对应，因为chinese food 比 English food 更受欢迎。</li>
<li>$p(to|want)=0.66$, want to 的概率很高，反映了语法特性</li>
<li>$p(food|to)=0$ ，to food 概率为0，因为这种搭配不常见</li>
<li>$p(want|spend)=0$, spend want 概率为0，因为这样违反了语法。</li>
</ul>
<p>常常在对数空间里面计算概率，原因有两个：</p>
<ol>
<li>防止溢出，如果计算的句子很长，最后得到的结果将非常小，甚至会溢出，比如计算得到的概率是0.001，那么假设以10为底取对数的结果就是-3，这样就不会溢出。</li>
<li>对数空间里面加法可以代替乘法，因为log(p1p2) = logp1 + logp2，而在计算机内部，显然加法比乘法执行更快！</li>
</ol>
<h5 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">代码</a></h5><p>数据准备：unigram:(word, freq),bigram:(word1,word2,freq) 语料数据。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="comment"># global parameter</span></span><br><span class="line">DELIMITER = <span class="string">" "</span>  <span class="comment"># 分词之后的分隔符</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DNASegment</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.word1_dict_prob = &#123;&#125;  <span class="comment"># 记录概率,1-gram</span></span><br><span class="line">        self.word1_dict_count = &#123;&#125;  <span class="comment"># 记录词频,1-gram</span></span><br><span class="line">        self.word1_dict_count[<span class="string">"&lt;S&gt;"</span>] = <span class="number">8310575403</span>  <span class="comment"># 开始的&lt;S&gt;的个数</span></span><br><span class="line"></span><br><span class="line">        self.word2_dict_prob = &#123;&#125;  <span class="comment"># 记录概率,2-gram</span></span><br><span class="line">        self.word2_dict_count = &#123;&#125;  <span class="comment"># 记录词频,2-gram</span></span><br><span class="line"></span><br><span class="line">        self.gmax_word_length = <span class="number">0</span></span><br><span class="line">        self.all_freq = <span class="number">0</span>  <span class="comment"># 所有词的词频总和,1-gram的</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 估算未出现的词的概率,根据beautiful data里面的方法估算</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_unkonw_word_prob</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> math.log(<span class="number">10.</span> / (self.all_freq * <span class="number">10</span> ** len(word)))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获得片段的概率</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_word_prob</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">in</span> self.word1_dict_prob:  <span class="comment"># 如果字典包含这个词</span></span><br><span class="line">            prob = self.word1_dict_prob[word]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prob = self.get_unkonw_word_prob(word)</span><br><span class="line">        <span class="keyword">return</span> prob</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获得两个词的转移概率(bigram)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_word_trans_prob</span><span class="params">(self, first_word, second_word)</span>:</span></span><br><span class="line">        trans_word = first_word + <span class="string">" "</span> + second_word</span><br><span class="line">        <span class="comment"># print trans_word</span></span><br><span class="line">        <span class="keyword">if</span> trans_word <span class="keyword">in</span> self.word2_dict_count:</span><br><span class="line">            trans_prob = math.log(self.word2_dict_count[trans_word] / self.word1_dict_count[first_word])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            trans_prob = self.get_word_prob(second_word)</span><br><span class="line">        <span class="keyword">return</span> trans_prob</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 寻找node的最佳前驱节点</span></span><br><span class="line">    <span class="comment"># 方法为寻找所有可能的前驱片段</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_best_pre_node</span><span class="params">(self, sequence, node, node_state_list)</span>:</span></span><br><span class="line">        <span class="comment"># 如果node比最大词长小，取的片段长度以node的长度为限</span></span><br><span class="line">        max_seg_length = min([node, self.gmax_word_length])</span><br><span class="line">        pre_node_list = []  <span class="comment"># 前驱节点列表</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获得所有的前驱片段，并记录累加概率</span></span><br><span class="line">        <span class="keyword">for</span> segment_length <span class="keyword">in</span> range(<span class="number">1</span>, max_seg_length + <span class="number">1</span>):</span><br><span class="line">            segment_start_node = node - segment_length</span><br><span class="line">            segment = sequence[segment_start_node:node]  <span class="comment"># 获取片段</span></span><br><span class="line"></span><br><span class="line">            pre_node = segment_start_node  <span class="comment"># 取该片段，则记录对应的前驱节点</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> pre_node == <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># 如果前驱片段开始节点是序列的开始节点，</span></span><br><span class="line">                <span class="comment"># 则概率为&lt;S&gt;转移到当前词的概率</span></span><br><span class="line">                <span class="comment"># segment_prob = self.get_word_prob(segment)</span></span><br><span class="line">                segment_prob = self.get_word_trans_prob(<span class="string">"&lt;S&gt;"</span>, segment)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 如果不是序列开始节点，按照二元概率计算</span></span><br><span class="line">                <span class="comment"># 获得前驱片段的前一个词</span></span><br><span class="line">                pre_pre_node = node_state_list[pre_node][<span class="string">"pre_node"</span>]</span><br><span class="line">                pre_pre_word = sequence[pre_pre_node:pre_node]</span><br><span class="line">                segment_prob = self.get_word_trans_prob(pre_pre_word, segment)</span><br><span class="line"></span><br><span class="line">            pre_node_prob_sum = node_state_list[pre_node][<span class="string">"prob_sum"</span>]  <span class="comment"># 前驱节点的概率的累加值</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 当前node一个候选的累加概率值</span></span><br><span class="line">            candidate_prob_sum = pre_node_prob_sum + segment_prob</span><br><span class="line"></span><br><span class="line">            pre_node_list.append((pre_node, candidate_prob_sum))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 找到最大的候选概率值</span></span><br><span class="line">        (best_pre_node, best_prob_sum) = max(pre_node_list, key=<span class="keyword">lambda</span> d: d[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> (best_pre_node, best_prob_sum)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 最大概率分词</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mp_seg</span><span class="params">(self, sequence)</span>:</span></span><br><span class="line">        sequence = sequence.strip()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化</span></span><br><span class="line">        node_state_list = []  <span class="comment"># 记录节点的最佳前驱，index就是位置信息</span></span><br><span class="line">        <span class="comment"># 初始节点，也就是0节点信息</span></span><br><span class="line">        ini_state = &#123;&#125;</span><br><span class="line">        ini_state[<span class="string">"pre_node"</span>] = <span class="number">-1</span>  <span class="comment"># 前一个节点</span></span><br><span class="line">        ini_state[<span class="string">"prob_sum"</span>] = <span class="number">0</span>  <span class="comment"># 当前的概率总和</span></span><br><span class="line">        node_state_list.append(ini_state)</span><br><span class="line">        <span class="comment"># 字符串概率为2元概率</span></span><br><span class="line">        <span class="comment"># P(a b c) = P(a|&lt;S&gt;)P(b|a)P(c|b)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 逐个节点寻找最佳前驱节点</span></span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> range(<span class="number">1</span>, len(sequence) + <span class="number">1</span>):</span><br><span class="line">            <span class="comment"># 寻找最佳前驱，并记录当前最大的概率累加值</span></span><br><span class="line">            (best_pre_node, best_prob_sum) = self.get_best_pre_node(sequence, node, node_state_list)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 添加到队列</span></span><br><span class="line">            cur_node = &#123;&#125;</span><br><span class="line">            cur_node[<span class="string">"pre_node"</span>] = best_pre_node</span><br><span class="line">            cur_node[<span class="string">"prob_sum"</span>] = best_prob_sum</span><br><span class="line">            node_state_list.append(cur_node)</span><br><span class="line">            <span class="comment"># print "cur node list",node_state_list</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 2, 获得最优路径,从后到前</span></span><br><span class="line">        best_path = []</span><br><span class="line">        node = len(sequence)  <span class="comment"># 最后一个点</span></span><br><span class="line">        best_path.append(node)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            pre_node = node_state_list[node][<span class="string">"pre_node"</span>]</span><br><span class="line">            <span class="keyword">if</span> pre_node == <span class="number">-1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            node = pre_node</span><br><span class="line">            best_path.append(node)</span><br><span class="line">        best_path.reverse()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 3, 构建切分</span></span><br><span class="line">        word_list = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(best_path) - <span class="number">1</span>):</span><br><span class="line">            left = best_path[i]</span><br><span class="line">            right = best_path[i + <span class="number">1</span>]</span><br><span class="line">            word = sequence[left:right]</span><br><span class="line">            word_list.append(word)</span><br><span class="line"></span><br><span class="line">        seg_sequence = DELIMITER.join(word_list)</span><br><span class="line">        <span class="keyword">return</span> seg_sequence</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 加载词典，为词\t词频的格式</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">initial_dict</span><span class="params">(self, gram1_file, gram2_file)</span>:</span></span><br><span class="line">        <span class="comment"># 读取unigram文件</span></span><br><span class="line">        dict_file = open(gram1_file, <span class="string">"r"</span>)</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> dict_file:</span><br><span class="line">            sequence = line.strip()</span><br><span class="line">            key = sequence.split(<span class="string">'\t'</span>)[<span class="number">0</span>]</span><br><span class="line">            value = float(sequence.split(<span class="string">'\t'</span>)[<span class="number">1</span>])</span><br><span class="line">            self.word1_dict_count[key] = value</span><br><span class="line">        <span class="comment"># 计算频率</span></span><br><span class="line">        self.all_freq = sum(self.word1_dict_count.values())  <span class="comment"># 所有词的词频</span></span><br><span class="line">        self.gmax_word_length = max(len(key) <span class="keyword">for</span> key <span class="keyword">in</span> self.word1_dict_count.keys())</span><br><span class="line">        self.gmax_word_length = <span class="number">20</span></span><br><span class="line">        self.all_freq = <span class="number">1024908267229.0</span></span><br><span class="line">        <span class="comment"># 计算1gram词的概率</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> self.word1_dict_count:</span><br><span class="line">            self.word1_dict_prob[key] = math.log(self.word1_dict_count[key] / self.all_freq)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 读取2_gram_file，同时计算转移概率</span></span><br><span class="line">        dict_file = open(gram2_file, <span class="string">"r"</span>)</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> dict_file:</span><br><span class="line">            sequence = line.strip()</span><br><span class="line">            key = sequence.split(<span class="string">'\t'</span>)[<span class="number">0</span>]</span><br><span class="line">            value = float(sequence.split(<span class="string">'\t'</span>)[<span class="number">1</span>])</span><br><span class="line">            first_word = key.split(<span class="string">" "</span>)[<span class="number">0</span>]</span><br><span class="line">            second_word = key.split(<span class="string">" "</span>)[<span class="number">1</span>]</span><br><span class="line">            self.word2_dict_count[key] = float(value)</span><br><span class="line">            <span class="keyword">if</span> first_word <span class="keyword">in</span> self.word1_dict_count:</span><br><span class="line">                <span class="comment"># 取自然对数</span></span><br><span class="line">                self.word2_dict_prob[key] = math.log(value / self.word1_dict_count[first_word])  </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.word2_dict_prob[key] = self.word1_dict_prob[second_word]</span><br></pre></td></tr></table></figure>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p><strong>列举出所有可能的分词方式，再分别计算句子概率，选择概率最大的作为最终分词结果。穷举法，速度慢。</strong></p>
<p>缺点：</p>
<ol>
<li>N-grams有一些不足，因为语言存在一个长距离依赖关系，比如：“The computer which I had just put into the machine room on the fifth floor crashed.”假如要预测最后一个词语crashed出现的概率，如果采用二元模型，那么crashed与floor实际关联可能性应该非常小，相反的，这句子的主语computer与crashed的相关性很大，但是n-grams并没有捕捉到这个信息。</li>
<li>一个词是由前一个或者几个词决定的，这样可以去除一部分歧义问题，但是n-gram模型还是基于马尔科夫模型的，其基本原理就是无后效性，就是后续的节点的状态不影响前面的状态，就是先前的分词形式一旦确定，无论后续跟的是什么词，都不会再有变化，这在现实中显然是不成立的。。因此就有一些可以考虑到后续词的算法，如crf等方法。</li>
</ol>
<h4 id="基于HMM的分词算法"><a href="#基于HMM的分词算法" class="headerlink" title="基于HMM的分词算法"></a>基于HMM的分词算法</h4><h5 id="隐马尔科夫模型-HMM"><a href="#隐马尔科夫模型-HMM" class="headerlink" title="隐马尔科夫模型(HMM)"></a>隐马尔科夫模型(HMM)</h5><p>隐马尔可夫模型是关于<strong>时序</strong>的概率模型,描述由一个隐藏的马尔可夫链随机生成不可观测的<strong>状态序列</strong>,再由各个状态生成一个观测而产生<strong>观测随机序列</strong>的过程.HMM是一种生成式模型，它的理论基础是朴素贝叶斯，本质上就类似于我们将朴素贝叶斯在单样本分类问题上的应用推广到序列样本分类问题上。</p>
<h6 id="模型表示"><a href="#模型表示" class="headerlink" title="模型表示"></a>模型表示</h6><p>设Q是所有可能的状态的集合$Q=\left\{q_{1}, q_{2}, \cdots, q_{N}\right\}$,V是所有可能的观测的集合$V=\left\{v_{1}, v_{2}, \cdots, v_{M}\right\}$,I是长度为T的状态序列$I=\left(i_{1}, i_{2}, \cdots, i_{T}\right)$, O是对应的观测序列$O=\left(o_{1}, o_{2}, \cdots, o_{T}\right)$,</p>
<ol>
<li>A是<strong>状态转移概率矩阵</strong>$A=\left[a_{i j}\right]_{N \times N}$,$a_{ij}$表示在时刻t处于状态$q_i$的条件下在时刻t+1转移到状态$q_j$的概率.</li>
<li>B是<strong>观测概率矩阵</strong> $B=\left[b_{j}(k)\right]_{N \times M}$,$b_{ij}$是在时刻t处于状态$q_j$的条件下生成观测$v_k$的概率.</li>
<li>$\pi$是<strong>初始状态概率向量</strong>$\pi=\pi(x)$,$\pi_i$表示时刻t=1处于状态qi的概率.</li>
</ol>
<p>隐马尔可夫模型由初始状态概率向量$pi$,状态转移概率矩阵A以及观测概率矩阵B确定.$\pi$和A决定即隐藏的<strong>马尔可夫链</strong>,生成不可观测的<strong>状态序列</strong>.B决定如何从状态生成观测,与状态序列综合确定了<strong>观测序列</strong>.因此,隐马尔可夫模型可以用<strong>三元符号</strong>表示$\lambda = (A,B,\pi)$</p>
<h6 id="两个基本假设"><a href="#两个基本假设" class="headerlink" title="两个基本假设"></a>两个基本假设</h6><ol>
<li><strong>齐次马尔可夫性假设</strong>:假设隐藏的马尔可夫链在任意时刻t的状态只依赖于其前一时刻的状态.</li>
<li><strong>观测独立性假设</strong>:假设任意时刻的观测只依赖于该时刻的马尔可夫链的状态.</li>
</ol>
<h6 id="三个基本问题"><a href="#三个基本问题" class="headerlink" title="三个基本问题"></a>三个基本问题</h6><p><strong>1. 概率计算问题</strong></p>
<p>给定模型$\lambda = (A,B,\pi)$和观测序列,$O=\left(o_{1}, o_{2}, \cdots, o_{T}\right)$计算在模型$\lambda$下观测序列O出现的概率$P(O|λ)$.</p>
<ol>
<li>直接计算：列举所有可能长度为T的状态序列,求各个状态序列I与观测序列O的联合概率,但计算量太大,实际操作不可行.</li>
<li><strong>前向算法</strong>：定义到时刻t部分观测序列为$o_1$~$o_t$且状态为$q_i$的概率为<strong>前向概率</strong>,记作$\alpha_{t}(i)=P\left(o_{1}, o_{2}, \cdots, o_{t}, i_{t}=q_{i} | \lambda\right)$.初始化前向概率$\alpha_{1}(i)=\pi_{i} b_{i}\left(o_{1}\right), \quad i=1,2, \cdots, N$，递推，对$t=1$ ~ $T-1$,$\alpha_{t+1}(i)=\left[\sum_{j=1}^{N} \alpha_{t}(j) a_{j i}\right] b_{i}\left(o_{t+1}\right), \quad i=1,2, \cdots, N$,得到$P(O | \lambda)=\sum_{i=1}^{N} \alpha_{T}(i)$减少计算量的原因在于每一次计算直接引用前一个时刻的计算结果,避免重复计算.</li>
<li><strong>后向算法</strong>:定义在时刻t状态为$q_i$的条件下,从t+1到T的部分观测序列为$o_{i+1}$~$o_T$的概率为<strong>后向概率</strong>,记作$\beta_{t}(i)=P\left(o_{t+1}, o_{t+2}, \cdots, o_{r} | i_{t}=q_{i}, \lambda\right)$.初始化后向概率$\beta_{r}(i)=1, \quad i=1,2, \cdots, N$,递推,对$t=T-1$~$1$$\beta_{t}(i)=\sum_{j=1}^{N} a_{i j} b_{j}\left(o_{i+1}\right) \beta_{i+1}(j), \quad i=1,2, \cdots, N$,得到$P(O | \lambda)=\sum_{i=1}^{N} \pi_{i} b_{i}\left(o_{1}\right) \beta_{1}(i)$</li>
</ol>
<p><strong>2. 学习算法</strong></p>
<p>已知观测序列$O=(o_1,o_2, \cdots,o_r)$,估计模型$\lambda = (A,B,\pi)$,的参数,使得在该模型下观测序列概率$p(O|\lambda)$最大.根据训练数据是否包括观察序列对应的状态序列分别由监督学习与非监督学习实现.</p>
<ol>
<li><p>监督学习：估计转移概率$\hat{a}_{i j}=\frac{A_{i j}}{\sum_{j=1}^{N} A_{i j}}, \quad i=1,2, \cdots, N ; \quad j=1,2, \cdots, N$ 和观测概率$\hat{b}_{j}(k)=\frac{B_{j k}}{\sum_{k=1}^{M} B_{j k}}, \quad j=1,2, \cdots, N, k=1,2, \cdots, M$.初始状态概率$\pi_i$的估计为S个样本中初始状态为$q_i$的频率.</p>
</li>
<li><p><strong>非监督学习(Baum-Welch算法)</strong>:将观测序列数据看作观测数据O,状态序列数据看作不可观测的<strong>隐数据</strong>I.首先确定完全数据的对数似然函数$log p(O,I|\lambda)$,求Q函数</p>
</li>
</ol>
<script type="math/tex; mode=display">
   \begin{aligned}
   Q(\lambda, \bar{\lambda})=& \sum_{t} \log \pi_{i_1} P(O, I | \bar{\lambda}) \\
   &+\sum_{I}\left(\sum_{i=1}^{I-1} \log a_{i_t,i_{t+1}}\right) P(O, I | \bar{\lambda}) \\
   &+\sum_{I}\left(\sum_{i=1}^{T} \log b_{i_t}\left(o_{t}\right)\right) P(O, I | \bar{\lambda})
   \end{aligned}</script><p>   ,用拉格朗日乘子法极大化Q函数求模型参数$\pi_{i}=\frac{P\left(O, i_{1}=i | \bar{\lambda}\right)}{P(O | \bar{\lambda})}$,$a_{i j}=\frac{\sum_{i=1}^{T-1} P\left(O, i_{t}=i, i_{t+1}=j | \bar{\lambda}\right)}{\sum_{t=1}^{T-1} P\left(O, i_{t}=i | \bar{\lambda}\right)}$,$b_{j}(k)=\frac{\sum_{i=1}^{T} P\left(O, i_{t}=j | \bar{\lambda}\right) I\left(o_{i}=v_{k}\right)}{\sum_{i=1}^{T} P\left(O, i_{t}=j | \bar{\lambda}\right)}$,</p>
<p><strong>3. 预测问题</strong></p>
<p>也称为解码问题.已知模型$\lambda = (A,B,\pi)$和观测序列$O=(O_1,O_2,\cdots,O_T)$,求对给定观测序列条件概率$P(I|O)$最大的状态序列$I=(i_1,i_2,\cdots,i_T)$</p>
<ol>
<li><p><strong>近似算法</strong>: 在每个时刻t选择在该时刻最有可能出现的状态$i_t^<em>$,从而得到一个状态序列作为预测的结果.优点是<em>*计算简单</em></em>,缺点是不能保证状态序列整体是最有可能的状态序列</p>
</li>
<li><p><strong>维特比算法</strong>:用<strong>动态规划</strong>求概率最大路径,这一条路径对应着一个状态序列.从t=1开始,递推地计算在时刻t状态为i的各条部分路径的最大概率,直至得到时刻t=T状态为i的各条路径的最大概率.时刻t=T的最大概率即为<strong>最优路径</strong>的概率$P^\star$,最优路径的<strong>终结点</strong>$i_t^\star$也同时得到,之后从终结点开始由后向前逐步求得<strong>结点</strong>,得到最优路径.</p>
</li>
</ol>
<h5 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h5><p>在分词算法中，分词对应着三大问题中的预测问题（解码问题），隐马尔可夫经常用作能够发现新词的算法，通过海量的数据学习，能够将人名、地名、互联网上的新词等一一识别出来，具有广泛的应用场景。</p>
<p>其分词过程:</p>
<p><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/hmm_seg.png" alt="avatar"></p>
<h5 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">代码</a></h5><p>数据准备：分好词的词库</p>
<p>step 1:通过统计语料库中词的频次，计算三个概率：初始状态概率start，状态转移概率矩阵trans，发射概率emit。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HmmTrain</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.line_index = <span class="number">-1</span></span><br><span class="line">        self.char_set = set()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">(self)</span>:</span>  <span class="comment"># 初始化字典</span></span><br><span class="line">        trans_dict = &#123;&#125;  <span class="comment"># 存储状态转移概率</span></span><br><span class="line">        emit_dict = &#123;&#125;  <span class="comment"># 发射概率(状态-&gt;词语的条件概率)</span></span><br><span class="line">        Count_dict = &#123;&#125;  <span class="comment"># 存储所有状态序列 ，用于归一化分母</span></span><br><span class="line">        start_dict = &#123;&#125;  <span class="comment"># 存储状态的初始概率</span></span><br><span class="line">        state_list = [<span class="string">'B'</span>, <span class="string">'M'</span>, <span class="string">'E'</span>, <span class="string">'S'</span>]  <span class="comment"># 状态序列</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> state <span class="keyword">in</span> state_list:</span><br><span class="line">            trans_dict[state] = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> state1 <span class="keyword">in</span> state_list:</span><br><span class="line">                trans_dict[state][state1] = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> state <span class="keyword">in</span> state_list:</span><br><span class="line">            start_dict[state] = <span class="number">0.0</span></span><br><span class="line">            emit_dict[state] = &#123;&#125;</span><br><span class="line">            Count_dict[state] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(trans_dict) #&#123;'B': &#123;'B': 0.0, 'S': 0.0, 'M': 0.0, 'E': 0.0&#125;, 'S': &#123;'B': 0.0, 'S': 0.0, 'M': 0.0, 'E': 0.0&#125;,。。。&#125;</span></span><br><span class="line">        <span class="comment"># print(emit_dict) # &#123;'B': &#123;&#125;, 'S': &#123;&#125;, 'M': &#123;&#125;, 'E': &#123;&#125;&#125;</span></span><br><span class="line">        <span class="comment"># print(start_dict) # &#123;'B': 0.0, 'S': 0.0, 'M': 0.0, 'E': 0.0&#125;</span></span><br><span class="line">        <span class="comment"># print(Count_dict) # &#123;'B': 0, 'S': 0, 'M': 0, 'E': 0&#125;</span></span><br><span class="line">        <span class="keyword">return</span> trans_dict, emit_dict, start_dict, Count_dict</span><br><span class="line"></span><br><span class="line">    <span class="string">'''保存模型'''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save_model</span><span class="params">(self, word_dict, model_path)</span>:</span></span><br><span class="line">        f = open(model_path, <span class="string">'w'</span>)</span><br><span class="line">        f.write(str(word_dict))</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="string">'''词语状态转换'''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_word_status</span><span class="params">(self, word)</span>:</span>  <span class="comment"># 根据词语，输出词语对应的SBME状态</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        S:单字词</span></span><br><span class="line"><span class="string">        B:词的开头</span></span><br><span class="line"><span class="string">        M:词的中间</span></span><br><span class="line"><span class="string">        E:词的末尾</span></span><br><span class="line"><span class="string">        能 ['S']</span></span><br><span class="line"><span class="string">        前往 ['B', 'E']</span></span><br><span class="line"><span class="string">        科威特 ['B', 'M', 'E']</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        word_status = []</span><br><span class="line">        <span class="keyword">if</span> len(word) == <span class="number">1</span>:</span><br><span class="line">            word_status.append(<span class="string">'S'</span>)</span><br><span class="line">        <span class="keyword">elif</span> len(word) == <span class="number">2</span>:</span><br><span class="line">            word_status = [<span class="string">'B'</span>, <span class="string">'E'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            M_num = len(word) - <span class="number">2</span></span><br><span class="line">            M_list = [<span class="string">'M'</span>] * M_num</span><br><span class="line">            word_status.append(<span class="string">'B'</span>)</span><br><span class="line">            word_status.extend(M_list)</span><br><span class="line">            word_status.append(<span class="string">'E'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> word_status</span><br><span class="line"></span><br><span class="line">    <span class="string">'''基于人工标注语料库，训练发射概率，初始状态， 转移概率'''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, train_filepath, trans_path, emit_path, start_path)</span>:</span></span><br><span class="line">        trans_dict, emit_dict, start_dict, Count_dict = self.init()</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> open(train_filepath):</span><br><span class="line">            self.line_index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            line = line.strip()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            char_list = []</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(line)):</span><br><span class="line">                <span class="keyword">if</span> line[i] == <span class="string">" "</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                char_list.append(line[i])</span><br><span class="line"></span><br><span class="line">            self.char_set = set(char_list)  <span class="comment"># 训练预料库中所有字的集合</span></span><br><span class="line"></span><br><span class="line">            word_list = line.split(<span class="string">" "</span>)</span><br><span class="line">            line_status = []  <span class="comment"># 统计状态序列</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> word <span class="keyword">in</span> word_list:</span><br><span class="line">                line_status.extend(self.get_word_status(word))  <span class="comment"># 一句话对应一行连续的状态</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> len(char_list) == len(line_status):</span><br><span class="line">                <span class="comment"># print(word_list) # ['但', '从', '生物学', '眼光', '看', '就', '并非', '如此', '了', '。']</span></span><br><span class="line">                <span class="comment"># print(line_status) # ['S', 'S', 'B', 'M', 'E', 'B', 'E', 'S', 'S', 'B', 'E', 'B', 'E', 'S', 'S']</span></span><br><span class="line">                <span class="comment"># print('******')</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(len(line_status)):</span><br><span class="line">                    <span class="keyword">if</span> i == <span class="number">0</span>:  <span class="comment"># 如果只有一个词，则直接算作是初始概率</span></span><br><span class="line">                        start_dict[line_status[<span class="number">0</span>]] += <span class="number">1</span>  <span class="comment"># start_dict记录句子第一个字的状态，用于计算初始状态概率</span></span><br><span class="line">                        Count_dict[line_status[<span class="number">0</span>]] += <span class="number">1</span>  <span class="comment"># 记录每一个状态的出现次数</span></span><br><span class="line">                    <span class="keyword">else</span>:  <span class="comment"># 统计上一个状态到下一个状态，两个状态之间的转移概率</span></span><br><span class="line">                        trans_dict[line_status[i - <span class="number">1</span>]][line_status[i]] += <span class="number">1</span>  <span class="comment"># 用于计算转移概率</span></span><br><span class="line">                        Count_dict[line_status[i]] += <span class="number">1</span></span><br><span class="line">                        <span class="comment"># 统计发射概率</span></span><br><span class="line">                        <span class="keyword">if</span> char_list[i] <span class="keyword">not</span> <span class="keyword">in</span> emit_dict[line_status[i]]:</span><br><span class="line">                            emit_dict[line_status[i]][char_list[i]] = <span class="number">0.0</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            emit_dict[line_status[i]][char_list[i]] += <span class="number">1</span>  <span class="comment"># 用于计算发射概率</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(emit_dict)#&#123;'S': &#123;'否': 10.0, '昔': 25.0, '直': 238.0, '六': 1004.0, '殖': 17.0, '仗': 36.0, '挪': 15.0, '朗': 151.0</span></span><br><span class="line">        <span class="comment"># print(trans_dict)#&#123;'S': &#123;'S': 747969.0, 'E': 0.0, 'M': 0.0, 'B': 563988.0&#125;, 'E': &#123;'S': 737404.0, 'E': 0.0, 'M': 0.0, 'B': 651128.0&#125;,</span></span><br><span class="line">        <span class="comment"># print(start_dict) #&#123;'S': 124543.0, 'E': 0.0, 'M': 0.0, 'B': 173416.0&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 进行归一化</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> start_dict:  <span class="comment"># 状态的初始概率</span></span><br><span class="line">            start_dict[key] = start_dict[key] * <span class="number">1.0</span> / self.line_index</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> trans_dict:  <span class="comment"># 状态转移概率</span></span><br><span class="line">            <span class="keyword">for</span> key1 <span class="keyword">in</span> trans_dict[key]:</span><br><span class="line">                trans_dict[key][key1] = trans_dict[key][key1] / Count_dict[key]</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> emit_dict:  <span class="comment"># 发射概率(状态-&gt;词语的条件概率)</span></span><br><span class="line">            <span class="keyword">for</span> word <span class="keyword">in</span> emit_dict[key]:</span><br><span class="line">                emit_dict[key][word] = emit_dict[key][word] / Count_dict[key]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(emit_dict)#&#123;'S': &#123;'否': 6.211504202703743e-06, '昔': 1.5528760506759358e-05, '直': 0.0001478338000243491,</span></span><br><span class="line">        <span class="comment"># print(trans_dict)#&#123;'S': &#123;'S': 0.46460125869921165, 'E': 0.0, 'M': 0.0, 'B': 0.3503213832274479&#125;,</span></span><br><span class="line">        <span class="comment"># print(start_dict)#&#123;'S': 0.41798844132394497, 'E': 0.0, 'M': 0.0, 'B': 0.5820149148537713&#125;</span></span><br><span class="line">        self.save_model(trans_dict, trans_path)</span><br><span class="line">        self.save_model(emit_dict, emit_path)</span><br><span class="line">        self.save_model(start_dict, start_path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> trans_dict, emit_dict, start_dict</span><br></pre></td></tr></table></figure>
<p>Step 2: 使用维特比算法，求解概率最大路径</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HmmCut</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,start_model_path,trans_model_path,emit_model_path)</span>:</span></span><br><span class="line">        self.prob_trans = self.load_model(trans_model_path)</span><br><span class="line">        self.prob_emit = self.load_model(emit_model_path)</span><br><span class="line">        self.prob_start = self.load_model(start_model_path)</span><br><span class="line"></span><br><span class="line">    <span class="string">'''加载模型'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load_model</span><span class="params">(self, model_path)</span>:</span></span><br><span class="line">        f = open(model_path, <span class="string">'r'</span>)</span><br><span class="line">        a = f.read()</span><br><span class="line">        word_dict = eval(a)</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">return</span> word_dict</span><br><span class="line"></span><br><span class="line">    <span class="string">'''verterbi算法求解'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">viterbi</span><span class="params">(self, obs, states, start_p, trans_p, emit_p)</span>:</span>  <span class="comment"># 维特比算法（一种递归算法）</span></span><br><span class="line">        <span class="comment"># 算法的局限在于训练语料要足够大，需要给每个词一个发射概率,.get(obs[0], 0)的用法是如果dict中不存在这个key,则返回0值</span></span><br><span class="line">        V = [&#123;&#125;]</span><br><span class="line">        path = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">            V[<span class="number">0</span>][y] = start_p[y] * emit_p[y].get(obs[<span class="number">0</span>], <span class="number">0</span>)  <span class="comment"># 在位置0，以y状态为末尾的状态序列的最大概率</span></span><br><span class="line">            path[y] = [y]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">1</span>, len(obs)):</span><br><span class="line">            V.append(&#123;&#125;)</span><br><span class="line">            newpath = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">                state_path = ([(V[t - <span class="number">1</span>][y0] * trans_p[y0].get(y, <span class="number">0</span>) * emit_p[y].get(obs[t], <span class="number">0</span>), y0) <span class="keyword">for</span> y0 <span class="keyword">in</span> states <span class="keyword">if</span> V[t - <span class="number">1</span>][y0] &gt; <span class="number">0</span>])</span><br><span class="line">                <span class="keyword">if</span> state_path == []:</span><br><span class="line">                    (prob, state) = (<span class="number">0.0</span>, <span class="string">'S'</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    (prob, state) = max(state_path)</span><br><span class="line">                V[t][y] = prob</span><br><span class="line">                newpath[y] = path[state] + [y]</span><br><span class="line"></span><br><span class="line">            path = newpath  <span class="comment"># 记录状态序列</span></span><br><span class="line">        (prob, state) = max([(V[len(obs) - <span class="number">1</span>][y], y) <span class="keyword">for</span> y <span class="keyword">in</span> states])  <span class="comment"># 在最后一个位置，以y状态为末尾的状态序列的最大概率</span></span><br><span class="line">        <span class="keyword">return</span> (prob, path[state])  <span class="comment"># 返回概率和状态序列</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 分词主控函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cut</span><span class="params">(self, sent)</span>:</span></span><br><span class="line">        prob, pos_list = self.viterbi(sent, (<span class="string">'B'</span>, <span class="string">'M'</span>, <span class="string">'E'</span>, <span class="string">'S'</span>), self.prob_start, self.prob_trans, self.prob_emit)</span><br><span class="line">        seglist = list()</span><br><span class="line">        word = list()</span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> range(len(pos_list)):</span><br><span class="line">            <span class="keyword">if</span> pos_list[index] == <span class="string">'S'</span>:</span><br><span class="line">                word.append(sent[index])</span><br><span class="line">                seglist.append(word)</span><br><span class="line">                word = []</span><br><span class="line">            <span class="keyword">elif</span> pos_list[index] <span class="keyword">in</span> [<span class="string">'B'</span>, <span class="string">'M'</span>]:</span><br><span class="line">                word.append(sent[index])</span><br><span class="line">            <span class="keyword">elif</span> pos_list[index] == <span class="string">'E'</span>:</span><br><span class="line">                word.append(sent[index])</span><br><span class="line">                seglist.append(word)</span><br><span class="line">                word = []</span><br><span class="line">        seglist = [<span class="string">''</span>.join(tmp) <span class="keyword">for</span> tmp <span class="keyword">in</span> seglist]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> seglist</span><br></pre></td></tr></table></figure>
<p>如果画出状态转移图像，发现状态只能在层间点转移，转移路径上的分数为概率，求一条概率最大的路径。这可以用维特比算法计算，本质上就是一个动态规划</p>
<p><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/hmm_viterbi.png" alt="avatar"></p>
<h5 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h5><p><strong>从三方面比较HMM和N-gram。</strong></p>
<ol>
<li>HMM模型是一个生成模型，区别于N-gram语言模型，HMM没有直接对给定观测值后状态的分布 $P(S|O)$（<em>O</em> 代表观测序列）进行建模，而是对状态序列本身的分布$P(S)$和给定状态后观测值的分布 $p(O|S)$建模 ；</li>
<li>学习过程与N-gram相同，HMM在有监督学习的情况下，使用极大似然估计参数；</li>
<li>预测时，HMM采用维特比算法。</li>
</ol>
<h4 id="CRF分词"><a href="#CRF分词" class="headerlink" title="CRF分词"></a>CRF分词</h4><h5 id="条件随机场CRF"><a href="#条件随机场CRF" class="headerlink" title="条件随机场CRF"></a>条件随机场CRF</h5><p>条件随机场基于概率无向图模型，利用最大团理论，对随机变量的联合分布$P(Y)$进行建模。</p>
<p>在序列标注任务中的条件随机场，往往是指<strong>线性链条件随机场</strong>，这时，在条件概率模型$P(Y|X)$中，$Y$是输出变量，表示标记序列（或状态序列），$X$是输入变量，表示需要标注的观测序列。学习时，利用训练数据集通过极大似然估计或正则化的极大似然估计得到条件概率模型$p(Y|X)$；预测时，对于给定的输入序列x，求出条件概率$p(y|x)$最大的输出序列y.</p>
<h6 id="条件随机场的参数化形式"><a href="#条件随机场的参数化形式" class="headerlink" title="条件随机场的参数化形式"></a>条件随机场的参数化形式</h6><script type="math/tex; mode=display">
P(y|x)=\frac{1}{Z(x)} \exp \left(\sum_{i, k} \lambda_{k} t_{k}\left(y_{i-1}, y_{i}, x, i\right)+\sum_{i, j} \mu_{l} s_{l}\left(y_{i}, x, i\right)\right) 
\\
Z(x)=\sum_{y} \exp \left(\sum_{i, k} \lambda_{k} t_{k}\left(y_{i-1}, y_{i}, x, i\right)+\sum_{i, j} \mu_{l} s_{l}\left(y_{i}, x, i\right)\right)</script><h5 id="条件随机场分词方法"><a href="#条件随机场分词方法" class="headerlink" title="条件随机场分词方法"></a>条件随机场分词方法</h5><p>条件随机场和隐马尔可夫一样，也是使用BMES四个状态位来进行分词。以如下句子为例：</p>
<p>中 国 是 泱 泱 大 国<br>B  B  B  B  B  B  B<br>M M M M M M M<br>E  E  E  E  E  E  E<br>S  S  S  S  S  S  S</p>
<p>条件随机场解码就是在以上由标记组成的数组中搜索一条最优的路径。</p>
<p>要把每一个字(即观察变量)对应的每一个状态BMES(即标记变量)的概率都求出来。例如对于观察变量“国”，当前标记变量为E，前一个观察变量为“中”，前一个标记变量为B，则：t(B, E, ‘国’) 对应到条件随机场里相邻标记变量$(y_{i-1},y_i)$的势函数。s(E, ‘国’) 对应到条件随机场里单个标记变量$y_i$对应的势函数$s_l(y_i,x,i)$。t(B, E, ‘国’), s(E, ‘国’)相应的权值$λ_k,\mu_l$， 都是由条件随机场用大量的标注语料训练出来。因此分词的标记识别就是求对于各个观察变量，它们的标记变量(BMES)状态序列的概率最大值，即求：的概率组合最大值。这个解法与隐马尔可夫类似，可以用viterbi算法求解。</p>
<h5 id="代码-5"><a href="#代码-5" class="headerlink" title="代码"></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">代码</a></h5><p>使用crf++实现对模型的训练，crf++ 安装、数据格式及模板参数请参考：<a href="https://jeffery0628.github.io/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/">序列标注</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> CRFPP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRFModel</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, model=<span class="string">'model_name'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        函数说明: 类初始化</span></span><br><span class="line"><span class="string">        :param model: 模型名称</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.model = model</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_tagger</span><span class="params">(self, tag_data)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        函数说明: 添加语料</span></span><br><span class="line"><span class="string">        :param tag_data: 数据</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        word_str = tag_data.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.model):</span><br><span class="line">            print(<span class="string">'模型不存在,请确认模型路径是否正确!'</span>)</span><br><span class="line">            exit()</span><br><span class="line">        tagger = CRFPP.Tagger(<span class="string">"-m &#123;&#125; -v 3 -n2"</span>.format(self.model))</span><br><span class="line">        tagger.clear()</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> word_str:</span><br><span class="line">            tagger.add(word)</span><br><span class="line">        tagger.parse()</span><br><span class="line">        <span class="keyword">return</span> tagger</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">text_mark</span><span class="params">(self, tag_data, begin=<span class="string">'B'</span>, middle=<span class="string">'I'</span>, end=<span class="string">'E'</span>, single=<span class="string">'S'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        文本标记</span></span><br><span class="line"><span class="string">        :param tag_data: 数据</span></span><br><span class="line"><span class="string">        :param begin: 开始标记</span></span><br><span class="line"><span class="string">        :param middle: 中间标记</span></span><br><span class="line"><span class="string">        :param end: 结束标记</span></span><br><span class="line"><span class="string">        :param single: 单字结束标记</span></span><br><span class="line"><span class="string">        :return result: 标记列表</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        tagger = self.add_tagger(tag_data)</span><br><span class="line">        size = tagger.size()</span><br><span class="line">        tag_text = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, size):</span><br><span class="line">            word, tag = tagger.x(i, <span class="number">0</span>), tagger.y2(i)</span><br><span class="line">            <span class="keyword">if</span> tag <span class="keyword">in</span> [begin, middle]:</span><br><span class="line">                tag_text += word</span><br><span class="line">            <span class="keyword">elif</span> tag <span class="keyword">in</span> [end, single]:</span><br><span class="line">                tag_text += word + <span class="string">"*&amp;*"</span></span><br><span class="line">        result = tag_text.split(<span class="string">'*&amp;*'</span>)</span><br><span class="line">        result.pop()</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crf_test</span><span class="params">(self, tag_data, separator=<span class="string">'/'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        函数说明: crf测试</span></span><br><span class="line"><span class="string">        :param tag_data:</span></span><br><span class="line"><span class="string">        :param separator:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        result = self.text_mark(tag_data)</span><br><span class="line">        data = separator.join(result)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crf_learn</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        函数说明: 训练模型</span></span><br><span class="line"><span class="string">        :param filename: 已标注数据源</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        crf_bash = <span class="string">"crf_learn -f 3 -c 4.0 data/template.txt &#123;&#125; &#123;&#125;"</span>.format(filename, self.model)</span><br><span class="line">        process = subprocess.Popen(crf_bash.split(), stdout=subprocess.PIPE)</span><br><span class="line">        output = process.communicate()[<span class="number">0</span>]</span><br><span class="line">        print(output.decode(encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 训练模型</span></span><br><span class="line">    crf_model = CRFModel(model=<span class="string">'data/model_crf'</span>)</span><br><span class="line">    crf_model.crf_learn(filename=<span class="string">'data/train_file_crf.txt'</span>)</span><br><span class="line">    <span class="comment"># 预测</span></span><br><span class="line">    print(crf_model.crf_test(tag_data=<span class="string">'我们一定要战胜敌人，我们认为它们都是纸老虎。'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="条件随机场分词的优缺点"><a href="#条件随机场分词的优缺点" class="headerlink" title="条件随机场分词的优缺点"></a>条件随机场分词的优缺点</h5><p>条件随机场分词是一种精度很高的分词方法，它比隐马尔可夫的精度要高，是因为隐马尔可夫假设观察变量$x_i$只与当前状态$y_i$有关，而与其它状态$y_{i-1}$，$y_{i+1}$无关;而条件随机场假设了当前观察变量$x_i$与上下文相关，如 ，就是考虑到上一个字标记状态为B时，当前标记状态为E并且输出“国”字的概率。因此通过上下文的分析，条件随机场分词会提升到更高的精度。但因为复杂度比较高，条件随机场一般训练代价都比较大。</p>
<h4 id="结构化感知机分词算法"><a href="#结构化感知机分词算法" class="headerlink" title="结构化感知机分词算法"></a>结构化感知机分词算法</h4><p>利用隐马尔科夫模型实现基于序列标注的中文分词器，效果并不理想。事实上，隐马尔可夫模型假设人们说的话仅仅取决于一个隐藏的BMES序列，这个假设太单纯了，不符合语言规律。语言不是由这么简单的标签序列生成，语言含有更多特征，而隐马尔科夫模型没有捕捉到。<strong>隐马弥可夫模型能捕捉的特征仅限于两种: 其一，前一个标签是什么；其二，当前字符是什么</strong>。为了利用更多的特征，线性模型( linear model )应运而生。线性模型由两部分构成: 一系列用来提取特征的特征函数$\phi$，以及相应的权重向量$w$。</p>
<h5 id="感知机算法"><a href="#感知机算法" class="headerlink" title="感知机算法"></a>感知机算法</h5><p>感知机算法是一种迭代式的算法：在训练集上运行多个迭代，每次读入一个样本，执行预测，将预测结果与正确答案进行对比，计算误差，根据误差更新模型参数，再次进行训练，直到误差最小为止。</p>
<ul>
<li><strong>损失函数</strong>: 从数值优化的角度来讲，迭代式机器学习算法都在优化(减小)一个损失函数。损失函数 J(w) 用来衡量模型在训练集上的错误程度，自变量是模型参数 $w$，因变量是一个标量，表示模型在训练集上的损失的大小。</li>
<li><strong>梯度下降</strong>: 给定样本，其特征向量 $x$ 只是常数，对 $J(w)$ 求导，得到一个梯度向量 $\Delta w$，它的反方向一定是当前位置损失函数减小速度最快的方向。如果参数点 $w$ 反方向移动就会使损失函数减小，叫梯度下降。</li>
<li><strong>学习率</strong>: 梯度下降的步长叫做学习率。</li>
<li><strong>随机梯度下降</strong>(SGD): 如果算法每次迭代随机选取部分样本计算损失函数的梯度，则称为随机梯度下降。</li>
</ul>
<p>假如数据本身线性不可分，感知机损失函数不会收敛，每次迭代分离超平面都会剧烈振荡。这时可以对感知机算法打补丁，使用投票感知机或平均感知机。</p>
<ol>
<li><p><strong>投票感知机</strong>：每次迭代的模型都保留，准确率也保留，预测时，每个模型都给出自己的结果，乘以它的准确率加权平均值作为最终结果。</p>
</li>
<li><p>投票感知机要求存储多个模型及加权，计算开销较大，更实际的做法是取多个模型的权重的平均，这就是<strong>平均感知机</strong>。</p>
</li>
</ol>
<h5 id="结构化预测问题"><a href="#结构化预测问题" class="headerlink" title="结构化预测问题"></a>结构化预测问题</h5><p>自然语言处理问题大致可分为两类，一种是分类问题，另一种就是结构化预测问题，序列标注只是结构化预测的一个特例，对感知机稍作拓展，分类器就能支持结构化预测。<br>信息的层次结构特点称作结构化。<strong>那么结构化预测</strong>(structhre，prediction)则是预测对象结构的一类监督学习问题。相应的模型训练过程称作<strong>结构化学习</strong>(stutured laming )。分类问题的预测结果是一个决策边界， 回归问题的预测结果是一个实数标量，而结构化预测的结果则是一个完整的结构。<br>自然语言处理中有许多任务是结构化预测，比如序列标注预测结构是一整个序列，句法分析预测结构是一棵句法树，机器翻译预测结构是一段完整的译文。这些结构由许多部分构成，最小的部分虽然也是分类问题(比如中文分词时每个字符分类为{B,M,E,S} ),但必须考虑结构整体的合理程度。</p>
<h6 id="结构化预测与学习流程"><a href="#结构化预测与学习流程" class="headerlink" title="结构化预测与学习流程"></a>结构化预测与学习流程</h6><p>结构化预测的过程就是给定一个模型 λ 及打分函数 score，利用打分函数给一些备选结构打分，选择分数最高的结构作为预测输出，公式如下:</p>
<script type="math/tex; mode=display">
\hat{y}=\arg \max _{y \in Y} \operatorname{score}({\lambda}(x, y))</script><p>其中，Y 是备选结构的集合。既然结构化预测就是搜索得分最高的结构 y，那么结构化学习的目标就是想方设法让正确答案 y 的得分最高。不同的模型有不同的算法，对于线性模型，训练算法为结构化感知机。</p>
<h5 id="结构化感知机算法"><a href="#结构化感知机算法" class="headerlink" title="结构化感知机算法"></a>结构化感知机算法</h5><p>要让线性模型支持结构化预测，必须先设计打分函数。打分函数的输入有两个缺一不可的参数: 特征 $x$ 和结构$y$。但之前的线性模型的“打分函数”只接受一个自变量 $x$。做法是定义新的特征函数$\phi (x,y)$，把结构 $y$ 也作为一种特征，输出新的“结构化特征向量”。新特征向量与权重向量做点积后，就得到一个标量，将其作为分数:</p>
<script type="math/tex; mode=display">
\operatorname{score}(x, y)=w \cdot \phi(x, y)</script><p>打分函数有了，取分值最大的结构作为预测结果，得到结构化预测函数:</p>
<script type="math/tex; mode=display">
\hat{y}=\arg \max _{y \in Y}(w \cdot \phi(x, y))</script><p>预测函数与线性分类器的决策函数很像，都是权重向量点积特征向量。那么感知机算法也可以拓展复用，得到线性模型的结构化学习算法:</p>
<ol>
<li>读入样本 $(x,y)$，进行结构化预测$\hat{y}=\arg \max _{y \in Y}(w \cdot \phi(x, y))$</li>
<li>与正确答案相比，若不相等，则更新参数: 奖励正确答案触发的特征函数的权重，否则进行惩罚:$w \leftarrow w+\phi\left(x^{(i)}, y\right)-\phi\left(x^{(i)}, \hat{y}\right)$</li>
<li>调整学习率:$\boldsymbol{w} \leftarrow \boldsymbol{w}+\alpha\left(\phi\left(\boldsymbol{x}^{(i)}, \boldsymbol{y}\right)-\phi\left(\boldsymbol{x}^{(i)}, \hat{\boldsymbol{y}}\right)\right)$</li>
</ol>
<h6 id="结构化感知机与感知机算法比较"><a href="#结构化感知机与感知机算法比较" class="headerlink" title="结构化感知机与感知机算法比较"></a>结构化感知机与感知机算法比较</h6><ul>
<li>结构化感知机修改了特征向量。</li>
<li>结构化感知机的参数更新赏罚分明。</li>
</ul>
<h6 id="结构化感知机与序列标注"><a href="#结构化感知机与序列标注" class="headerlink" title="结构化感知机与序列标注"></a>结构化感知机与序列标注</h6><p>序列标注最大的结构特点就是标签相互之间的依赖性，这种依赖性利用初始状态概率想俩狗和状态转移概率矩阵体系那，那么对于结构化感知机，就可以使用<strong>转移特征</strong>来表示:</p>
<script type="math/tex; mode=display">
\phi_{k}\left(y_{t-1}, y_{t}\right)=\left\{\begin{array}{ll}
1, & y_{t-1}=s_{i}, and , y_{t}=s_{j} \\
0
\end{array} \quad i=0, \cdots, N ; j=1, \cdots, N\right.</script><p>其中，$y_t$为序列第 t 个标签，$s_i$为标注集第 i 种标签，N 为标注集大小。</p>
<p><strong>状态特征</strong>，类似于隐马尔可夫模型的发射概率矩阵，状态特征只与当前的状态有关，与之前的状态无关:</p>
<script type="math/tex; mode=display">
\phi_{i}\left(x_{i}, y_{i}\right)=\left\{\begin{array}{l}
1 \\
0
\end{array}\right.</script><p>于是，结构化感知机的特征函数就是转移特征和状态特征的合集:</p>
<script type="math/tex; mode=display">
\phi=\left[\phi_{k} ; \phi_{l}\right] \quad k=1, \cdots, N^{2}+N ; l=N^{2}+N+1, \cdots</script><p>基于以上公式，统一用打分函数来表示:</p>
<script type="math/tex; mode=display">
\operatorname{score}(\boldsymbol{x}, \boldsymbol{y})=\sum_{t=1}^{T} \boldsymbol{w} \cdot \phi\left(y_{t-1}, y_{t}, \boldsymbol{x}_{t}\right)</script><p>有了打分公式，就可以利用维特比算法求解得分最高的序列。</p>
<h5 id="代码-6"><a href="#代码-6" class="headerlink" title="代码"></a><a href="https://github.com/jeffery0628/chinese_word_seg" target="_blank" rel="noopener">代码</a></h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CPTTrain</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, segment, train)</span>:</span></span><br><span class="line">        self.__char_type = &#123;&#125;</span><br><span class="line">        data_path = <span class="string">"data"</span></span><br><span class="line">        <span class="keyword">for</span> ind, name <span class="keyword">in</span> enumerate([<span class="string">"punc"</span>, <span class="string">"alph"</span>, <span class="string">"date"</span>, <span class="string">"num"</span>]):</span><br><span class="line">            fn = data_path + <span class="string">"/"</span> + name</span><br><span class="line">            <span class="keyword">if</span> os.path.isfile(fn):</span><br><span class="line">                <span class="keyword">for</span> line <span class="keyword">in</span> open(fn, <span class="string">"r"</span>):</span><br><span class="line">                    self.__char_type[line.strip()] = ind</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">"can't open"</span>, fn)</span><br><span class="line">                exit()</span><br><span class="line"></span><br><span class="line">        self.__train_insts = <span class="literal">None</span>  <span class="comment"># all instances for training.</span></span><br><span class="line">        self.__feats_weight = <span class="literal">None</span>  <span class="comment"># ["b", "m", "e", "s"][all the features] --&gt; weight.</span></span><br><span class="line">        self.__words_num = <span class="literal">None</span>  <span class="comment"># total words num in all the instances.</span></span><br><span class="line">        self.__insts_num = <span class="literal">None</span>  <span class="comment"># namley the sentences' num.</span></span><br><span class="line">        self.__cur_ite_ID = <span class="literal">None</span>  <span class="comment"># current iteration index.</span></span><br><span class="line">        self.__cur_inst_ID = <span class="literal">None</span>  <span class="comment"># current index_th instance.</span></span><br><span class="line">        self.__real_inst_ID = <span class="literal">None</span>  <span class="comment"># the accurate index in training instances after randimizing.</span></span><br><span class="line">        self.__last_update = <span class="literal">None</span>  <span class="comment"># ["b".."s"][feature] --&gt; [last_update_ite_ID, last_update_inst_ID]</span></span><br><span class="line">        self.__feats_weight_sum = <span class="literal">None</span>  <span class="comment"># sum of ["b".."s"][feature] from begin to end.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> segment <span class="keyword">and</span> train <span class="keyword">or</span> <span class="keyword">not</span> segment <span class="keyword">and</span> <span class="keyword">not</span> train:</span><br><span class="line">            print(<span class="string">"there is only a True and False in segment and train"</span>)</span><br><span class="line">            exit()</span><br><span class="line">        <span class="keyword">elif</span> train:</span><br><span class="line">            self.Train = self.__Train</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.__LoadModel()</span><br><span class="line">            self.Segment = self.__Segment</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__LoadModel</span><span class="params">(self)</span>:</span></span><br><span class="line">        model = <span class="string">"data/avgmodel"</span></span><br><span class="line">        print(<span class="string">"load"</span>, model, <span class="string">"..."</span>)</span><br><span class="line">        self.__feats_weight = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> os.path.isfile(model):</span><br><span class="line">            start = time.clock()</span><br><span class="line">            self.__feats_weight = pickle.load(open(model, <span class="string">"rb"</span>))</span><br><span class="line">            end = time.clock()</span><br><span class="line">            print(<span class="string">"It takes %d seconds"</span> % (end - start))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"can't open"</span>, model)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Train</span><span class="params">(self, corp_file_name, max_train_num, max_ite_num)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.__LoadCorp(corp_file_name, max_train_num):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        starttime = time.clock()</span><br><span class="line"></span><br><span class="line">        self.__feats_weight = &#123;&#125;</span><br><span class="line">        self.__last_update = &#123;&#125;</span><br><span class="line">        self.__feats_weight_sum = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> self.__cur_ite_ID <span class="keyword">in</span> range(max_ite_num):</span><br><span class="line">            <span class="keyword">if</span> self.__Iterate():</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        self.__SaveModel()</span><br><span class="line">        endtime = time.clock()</span><br><span class="line">        print(<span class="string">"total iteration times is %d seconds"</span> % (endtime - starttime))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__GenerateFeats</span><span class="params">(self, inst)</span>:</span></span><br><span class="line">        inst_feat = []</span><br><span class="line">        <span class="keyword">for</span> ind, [c, tag, t] <span class="keyword">in</span> enumerate(inst):</span><br><span class="line">            inst_feat.append([])</span><br><span class="line">            <span class="keyword">if</span> t == <span class="number">-1</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment"># Cn</span></span><br><span class="line">            <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">-2</span>, <span class="number">3</span>):</span><br><span class="line">                inst_feat[<span class="number">-1</span>].append(<span class="string">"C%d==%s"</span> % (n, inst[ind + n][<span class="number">0</span>]))</span><br><span class="line">            <span class="comment"># CnCn+1</span></span><br><span class="line">            <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">-2</span>, <span class="number">2</span>):</span><br><span class="line">                inst_feat[<span class="number">-1</span>].append(<span class="string">"C%dC%d==%s%s"</span> % (n, n + <span class="number">1</span>, inst[ind + n][<span class="number">0</span>], inst[ind + n + <span class="number">1</span>][<span class="number">0</span>]))</span><br><span class="line">            <span class="comment"># C-1C1</span></span><br><span class="line">            inst_feat[<span class="number">-1</span>].append(<span class="string">"C-1C1==%s%s"</span> % (inst[ind - <span class="number">1</span>][<span class="number">0</span>], inst[ind + <span class="number">1</span>][<span class="number">0</span>]))</span><br><span class="line">            <span class="comment"># Pu(C0)</span></span><br><span class="line">            inst_feat[<span class="number">-1</span>].append(<span class="string">"Pu(%s)==%d"</span> % (c, int(t == <span class="number">0</span>)))</span><br><span class="line">            <span class="comment"># T(C-2)T(C-1)T(C0)T(C1)T(C2)</span></span><br><span class="line">            inst_feat[<span class="number">-1</span>].append(<span class="string">"T-2...2=%d%d%d%d%d"</span> % (</span><br><span class="line">            inst[ind - <span class="number">2</span>][<span class="number">2</span>], inst[ind - <span class="number">1</span>][<span class="number">2</span>], inst[ind][<span class="number">2</span>], inst[ind + <span class="number">1</span>][<span class="number">2</span>], inst[ind + <span class="number">2</span>][<span class="number">2</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> inst_feat</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__SaveModel</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># the last time to sum all the features.</span></span><br><span class="line">        norm = float(self.__cur_ite_ID + <span class="number">1</span>) * self.__insts_num</span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> self.__feats_weight_sum:</span><br><span class="line">            last_ite_ID = self.__last_update[feat][<span class="number">0</span>]</span><br><span class="line">            last_inst_ID = self.__last_update[feat][<span class="number">1</span>]</span><br><span class="line">            c = (self.__cur_ite_ID - last_ite_ID) * self.__insts_num + self.__cur_inst_ID - last_inst_ID</span><br><span class="line">            self.__feats_weight_sum[feat] += self.__feats_weight[feat] * c</span><br><span class="line">            self.__feats_weight_sum[feat] = self.__feats_weight_sum[feat] / norm</span><br><span class="line"></span><br><span class="line">        pickle.dump(self.__feats_weight_sum, open(<span class="string">"data/avgmodel"</span>, <span class="string">"wb"</span>))</span><br><span class="line">        self.__train_insts = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__LoadCorp</span><span class="params">(self, corp_file_name, max_train_num)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(corp_file_name):</span><br><span class="line">            print(<span class="string">"can't open"</span>, corp_file_name)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        self.__train_insts = []</span><br><span class="line">        self.__words_num = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> ind, line <span class="keyword">in</span> enumerate(open(corp_file_name, <span class="string">"r"</span>)):</span><br><span class="line">            <span class="keyword">if</span> max_train_num &gt; <span class="number">0</span> <span class="keyword">and</span> ind &gt;= max_train_num:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            self.__train_insts.append(self.__PreProcess(line.strip()))</span><br><span class="line">            self.__words_num += len(self.__train_insts[<span class="number">-1</span>]) - <span class="number">4</span></span><br><span class="line">        self.__insts_num = len(self.__train_insts)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"number of total insts is"</span>, self.__insts_num)</span><br><span class="line">        print(<span class="string">"number of total characters is"</span>, self.__words_num)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__PreProcess</span><span class="params">(self, sent)</span>:</span></span><br><span class="line">        inst = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            inst.append([<span class="string">"&lt;s&gt;"</span>, <span class="string">"s"</span>, <span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> sent.split():</span><br><span class="line">            rt = word.rpartition(<span class="string">"/"</span>)</span><br><span class="line">            t = self.__char_type.get(rt[<span class="number">0</span>], <span class="number">4</span>)</span><br><span class="line">            inst.append([rt[<span class="number">0</span>], rt[<span class="number">2</span>], t])  <span class="comment"># [c, tag, t]</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            inst.append([<span class="string">"&lt;s&gt;"</span>, <span class="string">"s"</span>, <span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> inst</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Segment</span><span class="params">(self, src)</span>:</span></span><br><span class="line">        <span class="string">"""suppose there is one sentence once."""</span></span><br><span class="line">        inst = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            inst.append([<span class="string">"&lt;s&gt;"</span>, <span class="string">"s"</span>, <span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> src:</span><br><span class="line">            inst.append([c, <span class="string">""</span>, self.__char_type.get(c, <span class="number">4</span>)])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            inst.append([<span class="string">"&lt;s&gt;"</span>, <span class="string">"s"</span>, <span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">        feats = self.__GenerateFeats(inst)</span><br><span class="line">        tags = self.__DPSegment(inst, feats)</span><br><span class="line"></span><br><span class="line">        rst = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, len(tags) - <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">if</span> tags[i] <span class="keyword">in</span> [<span class="string">"s"</span>, <span class="string">"b"</span>]:</span><br><span class="line">                rst.append(inst[i][<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rst[<span class="number">-1</span>] += inst[i][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">" "</span>.join(rst)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Iterate</span><span class="params">(self)</span>:</span></span><br><span class="line">        start = time.clock()</span><br><span class="line">        print(<span class="string">"%d th iteration"</span> % self.__cur_ite_ID)</span><br><span class="line"></span><br><span class="line">        train_list = random.sample(range(self.__insts_num), self.__insts_num)</span><br><span class="line">        error_sents_num = <span class="number">0</span></span><br><span class="line">        error_words_num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> self.__cur_inst_ID, self.__real_inst_ID <span class="keyword">in</span> enumerate(train_list):</span><br><span class="line">            num = self.__TrainInstance()</span><br><span class="line">            error_sents_num += <span class="number">1</span> <span class="keyword">if</span> num &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            error_words_num += num</span><br><span class="line"></span><br><span class="line">        st = <span class="number">1</span> - float(error_sents_num) / self.__insts_num</span><br><span class="line">        wt = <span class="number">1</span> - float(error_words_num) / self.__words_num</span><br><span class="line"></span><br><span class="line">        end = time.clock()</span><br><span class="line">        print(<span class="string">"sents accuracy = %f%%, words accuracy = %f%%, it takes %d seconds"</span> % (st * <span class="number">100</span>, wt * <span class="number">100</span>, end - start))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> error_sents_num == <span class="number">0</span> <span class="keyword">and</span> error_words_num == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__TrainInstance</span><span class="params">(self)</span>:</span></span><br><span class="line">        cur_inst = self.__train_insts[self.__real_inst_ID]</span><br><span class="line">        feats = self.__GenerateFeats(cur_inst)</span><br><span class="line"></span><br><span class="line">        seg = self.__DPSegment(cur_inst, feats)</span><br><span class="line">        <span class="keyword">return</span> self.__Correct(seg, feats)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__DPSegment</span><span class="params">(self, inst, feats)</span>:</span></span><br><span class="line">        num = len(inst)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get all position's score.</span></span><br><span class="line">        value = [&#123;&#125; <span class="keyword">for</span> i <span class="keyword">in</span> range(num)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, num - <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> [<span class="string">"b"</span>, <span class="string">"m"</span>, <span class="string">"e"</span>, <span class="string">"s"</span>]:</span><br><span class="line">                value[i][t] = self.__GetScore(i, t, feats)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># find optimal path.</span></span><br><span class="line">        tags = [<span class="literal">None</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(num)]</span><br><span class="line">        best = [<span class="number">-1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(num)]  <span class="comment"># best[i]: [i, i + length(i)) is optimal segment.</span></span><br><span class="line">        length = [<span class="literal">None</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(num)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num - <span class="number">2</span> - <span class="number">1</span>, <span class="number">1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">for</span> dis <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">                <span class="keyword">if</span> i + dis &gt; num - <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                cur_score = best[i + dis]</span><br><span class="line">                self.__Tag(i, i + dis, tags)</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> range(i, i + dis):</span><br><span class="line">                    cur_score += value[k][tags[k]]</span><br><span class="line">                <span class="keyword">if</span> length[i] <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> cur_score &gt; best[i]:</span><br><span class="line">                    best[i] = cur_score</span><br><span class="line">                    length[i] = dis</span><br><span class="line"></span><br><span class="line">        i = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; num - <span class="number">2</span>:</span><br><span class="line">            self.__Tag(i, i + length[i], tags)</span><br><span class="line">            i += length[i]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tags</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__GetScore</span><span class="params">(self, pos, t, feats)</span>:</span></span><br><span class="line">        pos_feats = feats[pos]</span><br><span class="line">        score = <span class="number">0.0</span></span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> pos_feats:</span><br><span class="line">            score += self.__feats_weight.get(feat + <span class="string">"=&gt;"</span> + t, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Tag</span><span class="params">(self, f, t, tags)</span>:</span></span><br><span class="line">        <span class="string">"""tag the sequence tags in the xrange of [f, t)"""</span></span><br><span class="line">        <span class="keyword">if</span> t - f == <span class="number">1</span>:</span><br><span class="line">            tags[f] = <span class="string">"s"</span></span><br><span class="line">        <span class="keyword">elif</span> t - f &gt;= <span class="number">2</span>:</span><br><span class="line">            tags[f], tags[t - <span class="number">1</span>] = <span class="string">"b"</span>, <span class="string">"e"</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(f + <span class="number">1</span>, t - <span class="number">1</span>):</span><br><span class="line">                tags[i] = <span class="string">"m"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Correct</span><span class="params">(self, tags, feats)</span>:</span></span><br><span class="line">        updates = &#123;&#125;</span><br><span class="line">        cur_inst = self.__train_insts[self.__real_inst_ID]</span><br><span class="line">        error_words_num = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, len(cur_inst) - <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">if</span> tags[i] == cur_inst[i][<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            error_words_num += <span class="number">1</span></span><br><span class="line">            pos_feats = feats[i]</span><br><span class="line">            target = cur_inst[i][<span class="number">1</span>]</span><br><span class="line">            mine = tags[i]</span><br><span class="line">            <span class="keyword">for</span> feat <span class="keyword">in</span> pos_feats:</span><br><span class="line">                updates[feat + <span class="string">"=&gt;"</span> + target] = updates.get(feat + <span class="string">"=&gt;"</span> + target, <span class="number">0.0</span>) + <span class="number">1</span></span><br><span class="line">                updates[feat + <span class="string">"=&gt;"</span> + mine] = updates.get(feat + <span class="string">"=&gt;"</span> + mine, <span class="number">0.0</span>) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        self.__Update(updates)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> error_words_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Update</span><span class="params">(self, updates)</span>:</span></span><br><span class="line">        <span class="comment"># update the features weight.</span></span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> updates:</span><br><span class="line">            pair = self.__last_update.get(feat, [<span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">            last_ite_ID = pair[<span class="number">0</span>]</span><br><span class="line">            last_inst_ID = pair[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">            c = (self.__cur_ite_ID - last_ite_ID) * self.__insts_num + self.__cur_inst_ID - last_inst_ID</span><br><span class="line">            self.__feats_weight_sum[feat] = self.__feats_weight_sum.get(feat, <span class="number">0</span>) + c * self.__feats_weight.get(feat, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            self.__feats_weight[feat] = self.__feats_weight.get(feat, <span class="number">0</span>) + updates[feat]</span><br><span class="line">            self.__last_update[feat] = [self.__cur_ite_ID, self.__cur_inst_ID]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    train = CPTTrain(train=<span class="literal">True</span>, segment=<span class="literal">False</span>)</span><br><span class="line">    train.Train(<span class="string">"data/msr_train.txt"</span>, max_train_num=<span class="number">1000000</span>, max_ite_num=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">    srcs = [<span class="string">"夏天的清晨"</span>,</span><br><span class="line">            <span class="string">"“人们常说生活是一部教科书，而血与火的战争更是不可多得的教科书，她确实是名副其实的‘我的大学’。"</span>,</span><br><span class="line">            <span class="string">"夏天的清晨夏天看见猪八戒和嫦娥了。"</span>,</span><br><span class="line">            <span class="string">"海运业雄踞全球之首，按吨位计占世界总数的１７％。"</span>]</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"avg"</span>)</span><br><span class="line">    seg = CPTTrain(train=<span class="literal">False</span>, segment=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> src <span class="keyword">in</span> srcs:</span><br><span class="line">        print(seg.Segment(src))</span><br></pre></td></tr></table></figure>
<h4 id="基于深度学习的端到端的分词方法"><a href="#基于深度学习的端到端的分词方法" class="headerlink" title="基于深度学习的端到端的分词方法"></a>基于深度学习的端到端的分词方法</h4><p>在中文分词上，基于神经网络的方法，往往使用「字向量 + BiLSTM + CRF」模型，利用神经网络来学习特征，将传统 CRF 中的人工特征工程量降到最低</p>
<p>BiLSTM、BiLSTM+CRF、BiLSTM+CNN+CRF、BERT、BERT+CRF、BERT+BiLSTM、BERT+BiLSTM+CRF，由于以上模型均可对序列标注任务进行建模求解，所以均可拿来做中文分词。以比较典型的「字向量 + BiLSTM （+CNN）+ CRF」模型为例：</p>
<p>BiLSTM融合两组学习方向相反（一个按句子顺序，一个按句子逆序）的LSTM层，能够在理论上实现当前词即包含历史信息、又包含未来信息，更有利于对当前词进行标注。虽然依赖于神经网络强大的非线性拟合能力，理论上我们已经能够学习出不错的模型。但是，BiLSTM只考虑了标签上的上下文信息。对于序列标注任务来说，当前位置的标签$y_t$与前一个位置$y_{t-1}$、后一个位置$y_{t+1}$都有潜在的关系。例如，“东南大学欢迎您”被标注为“东/S 南/M 大/M 学/E 欢/B 迎/E 您/S”，由分词的标注规则可知，B标签后只能接M和E，BiLSTM没有利用这种标签之间的上下文信息。因此，就有人提出了在模型后接一层CRF层，用于在整个序列上学习最优的标签序列：</p>
<p><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/bilstm_crf.jpeg" alt="avatar"></p>
<p>BiLSTM+CNN+CRF：对于分词任务，当前词的标签基本上只与前几个和和几个词有关联。BiLSTM在学习较长句子时，可能因为模型容量问题丢弃一些重要信息，因此在模型中加了一个CNN层，用于提取当前词的局部特征。（不知效果怎样？？！！）</p>
<p><img src="/2020/04/28/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95/bilstm_cnn_crf.png" alt="avatar"></p>
<h5 id="模型比较"><a href="#模型比较" class="headerlink" title="模型比较"></a>模型比较</h5><p>Trained and tested with pku dataset</p>
<p>CRF</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Template</th>
<th style="text-align:center">Precision</th>
<th style="text-align:center">Recall</th>
<th style="text-align:center">F1-Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">crf_template</td>
<td style="text-align:center">0.938</td>
<td style="text-align:center">0.923</td>
<td style="text-align:center">0.931</td>
</tr>
</tbody>
</table>
</div>
<p>Bi-LSTM</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Structure</th>
<th style="text-align:center">Precision</th>
<th style="text-align:center">Recall</th>
<th style="text-align:center">F1-Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">emb256_hid256_l3</td>
<td style="text-align:center">0.9252</td>
<td style="text-align:center">0.9237</td>
<td style="text-align:center">0.9243</td>
</tr>
</tbody>
</table>
</div>
<p>Bi-LSTM + CRF</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Structure</th>
<th style="text-align:center">Precision</th>
<th style="text-align:center">Recall</th>
<th style="text-align:center">F1-Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">emb256_hid256_l3</td>
<td style="text-align:center">0.9343</td>
<td style="text-align:center">0.9336</td>
<td style="text-align:center">0.9339</td>
</tr>
</tbody>
</table>
</div>
<p>BERT + Bi-LSTM</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Structure</th>
<th style="text-align:center">Precision</th>
<th style="text-align:center">Recall</th>
<th style="text-align:center">F1-Score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">emb768_hid512_l2</td>
<td style="text-align:center">0.9698</td>
<td style="text-align:center">0.9650</td>
<td style="text-align:center">0.9646</td>
</tr>
</tbody>
</table>
</div>
<h5 id="代码-7"><a href="#代码-7" class="headerlink" title="代码"></a>代码</h5><p>以BERT+RNN+CRF为例，可根据需求进行改动。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> TorchCRF <span class="keyword">import</span> CRF </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertRNNCRF</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num_tags, rnn_type, bert_path, bert_train, seg_vocab_size,hidden_dim, n_layers, bidirectional, batch_first,</span></span></span><br><span class="line"><span class="function"><span class="params">                 dropout, restrain)</span>:</span></span><br><span class="line">        super(BertRNNCRF, self).__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line">        self.bert = BertModel.from_pretrained(bert_path)</span><br><span class="line">        <span class="comment"># 对bert进行训练</span></span><br><span class="line">        <span class="keyword">for</span> name, param <span class="keyword">in</span> self.bert.named_parameters():</span><br><span class="line">            param.requires_grad = bert_train</span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                               hidden_size=hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line">        self.crf = CRF(num_tags, batch_first=<span class="literal">True</span>, restrain_matrix=restrain, loss_side=<span class="number">2.5</span>)</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        <span class="keyword">if</span> self.bidirectional:</span><br><span class="line">            self.fc_tags = nn.Linear(hidden_dim*<span class="number">2</span>, num_tags)</span><br><span class="line">            <span class="comment"># self.fc_tags = nn.Linear(768, num_tags)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.fc_tags = nn.Linear(hidden_dim, num_tags)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, context, seq_len,max_seq_len, mask_bert)</span>:</span></span><br><span class="line">        <span class="comment"># context    输入的句子</span></span><br><span class="line">        <span class="comment"># mask_bert  对padding部分进行mask，和句子一个size，padding部分用0表示，如：[1, 1, 1, 1, 0, 0]</span></span><br><span class="line">        bert_sentence, bert_cls = self.bert(context, attention_mask=mask_bert)</span><br><span class="line">        <span class="comment"># sentence_len = bert_sentence.shape[1]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># bert_cls = bert_cls.unsqueeze(dim=1).repeat(1, sentence_len, 1)</span></span><br><span class="line">        <span class="comment"># bert_sentence = bert_sentence + bert_cls</span></span><br><span class="line">        encoder_out, sorted_seq_lengths, desorted_indices = self.prepare_pack_padded_sequence(bert_sentence, seq_len)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(encoder_out, sorted_seq_lengths,</span><br><span class="line">                                                            batch_first=self.batch_first)</span><br><span class="line">        <span class="comment"># self.rnn.flatten_parameters()</span></span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line">        <span class="comment"># unpack sequence</span></span><br><span class="line">        <span class="comment"># output = [ batch size,sent len, hidden_dim * bidirectional]</span></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first,total_length=max_seq_len)</span><br><span class="line">        output = output[desorted_indices]</span><br><span class="line">        out = self.fc_tags(self.dropout(output.contiguous()))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out[:, <span class="number">1</span>:, :]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepare_pack_padded_sequence</span><span class="params">(self, inputs_words, seq_lengths, descending=True)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param device:</span></span><br><span class="line"><span class="string">        :param inputs_words:</span></span><br><span class="line"><span class="string">        :param seq_lengths:</span></span><br><span class="line"><span class="string">        :param descending:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        sorted_seq_lengths, indices = torch.sort(seq_lengths, descending=descending)</span><br><span class="line">        _, desorted_indices = torch.sort(indices, descending=<span class="literal">False</span>)</span><br><span class="line">        sorted_inputs_words = inputs_words[indices]</span><br><span class="line">        <span class="keyword">return</span> sorted_inputs_words, sorted_seq_lengths, desorted_indices</span><br></pre></td></tr></table></figure>
<h3 id="分词中的难题"><a href="#分词中的难题" class="headerlink" title="分词中的难题"></a>分词中的难题</h3><p>中文是一种十分复杂的语言，让计算机理解中文语言更是困难。在中文分词过程中，有两大难题一直没有完全突破。</p>
<h4 id="1、歧义切分问题"><a href="#1、歧义切分问题" class="headerlink" title="1、歧义切分问题"></a>1、歧义切分问题</h4><p>歧义是指同样的一句话，可能有两种或者更多的切分方法。</p>
<ul>
<li>交集歧义：“结合成”，结合/成，结/合成</li>
<li>组合歧义：“起身”，他站起/身/来。 他明天/起身/去北京。</li>
<li>混合型歧义：同时具备交集歧义和组合歧义的特点。1，这篇文章写得太平淡了。2，这墙抹的太平了。3，即使太平时期也不应该放松警惕。“太平淡”是交集型，“太平”是组合型。 </li>
</ul>
<p>交集歧义相对组合歧义来说是还算比较容易处理，组合歧义需要根据整个句子来判断。（特征：上下文语义分析，韵律分析，语气，重音，停顿）</p>
<h4 id="2、未登录词"><a href="#2、未登录词" class="headerlink" title="2、未登录词"></a>2、未登录词</h4><p>未登录词（生词，新词）：1.已有的词表中没有收录的词。2.已有的训练语料中未曾出现的词（集外词OOV）。</p>
<p>类型：</p>
<ol>
<li>新出现的普通词汇：博客，超女，给力。</li>
<li>专有名词：人名、地名、组织名、时间、数字表达、</li>
<li>专业名词和研究领域名词：苏丹红，禽流感</li>
<li>其他专用名词：新出现的产品名，电影，书记。</li>
</ol>
<p>对于真实数据来说，未登录词对分词精度的影响远远超过了歧义切分。未登录词是很难处理的问题，而且这些又正好是人们经常使用的词，因此对于搜索引擎来说，分词系统中的未登录词识别十分重要。目前未登录词识别准确率已经成为评价一个分词系统好坏的重要标志之一。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol>
<li><p><a href="https://blog.csdn.net/selinda001/article/details/79345072" target="_blank" rel="noopener">中文分词引擎 java 实现 — 正向最大、逆向最大、双向最大匹配法</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/sxron/articles/6391926.html" target="_blank" rel="noopener">中文分词算法总结</a></p>
</li>
<li><p><a href="https://blog.csdn.net/Zh823275484/article/details/87878512" target="_blank" rel="noopener">基于n-gram模型的中文分词</a></p>
</li>
<li><p><a href="https://blog.csdn.net/qq_27825451/article/details/102457058" target="_blank" rel="noopener">详解语言模型NGram及困惑度Perplexity</a></p>
</li>
<li><p><a href="https://blog.csdn.net/wangliang_f/article/details/17532633" target="_blank" rel="noopener">分词学习(3)，基于ngram语言模型的n元分词</a></p>
</li>
<li><p><a href="https://zhuanlan.zhihu.com/p/33261835" target="_blank" rel="noopener">中文分词算法简介</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/715fa597c6bc" target="_blank" rel="noopener">NLP：分词算法综述</a></p>
</li>
<li><p><a href="https://github.com/NLP-LOVE/Introduction-NLP/blob/master/chapter/5.%E6%84%9F%E7%9F%A5%E6%9C%BA%E5%88%86%E7%B1%BB%E4%B8%8E%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8.md" target="_blank" rel="noopener">感知机分类与序列标注</a></p>
</li>
</ol>
]]></content>
      <categories>
        <category>自然语言处理基础</category>
      </categories>
      <tags>
        <tag>自然语言处理基础</tag>
        <tag>自然语言处理</tag>
        <tag>分词算法</tag>
      </tags>
  </entry>
  <entry>
    <title>文本纠错</title>
    <url>/2020/04/24/text_correction/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2020/04/24/text_correction/v2-cd4b3605ecff9b1018015673f2f03fb3_1200x500.jpg" alt></p>
<a id="more"></a>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><h2 id="常见错误类型"><a href="#常见错误类型" class="headerlink" title="常见错误类型"></a>常见错误类型</h2><ol>
<li>谐音字词，如 配副眼睛-配副眼镜</li>
<li>混淆音字词，如 流浪织女-牛郎织女</li>
<li>字词顺序颠倒，如 伍迪艾伦-艾伦伍迪</li>
<li>字词补全，如 爱有天意-假如爱有天意</li>
<li>形似字错误，如 高梁-高粱</li>
<li>中文拼音全拼，如 xingfu-幸福</li>
<li>中文拼音缩写，如 sz-深圳</li>
<li>语法错误，如 想象难以-难以想象</li>
</ol>
<p>针对不同业务场景，这些问题并不一定全部存在，比如输入法中需要处理前四种，搜索引擎需要处理所有类型，语音识别后文本纠错只需要处理前两种， 其中’形似字错误’主要针对五笔或者笔画手写输入等。</p>
<h2 id="纠错方法"><a href="#纠错方法" class="headerlink" title="纠错方法"></a>纠错方法</h2><p>纠错算法分为两个方向：基于规则、深度模型</p>
<h3 id="规则的解决思路"><a href="#规则的解决思路" class="headerlink" title="规则的解决思路"></a><strong>规则的解决思路</strong></h3><p>中文纠错分为两步走，第一步是错误检测，第二步是错误纠正；</p>
<p>错误检测部分先通过结巴中文分词器切词，由于句子中含有错别字，所以切词结果往往会有切分错误的情况，这样从字粒度和词粒度两方面检测错误， 整合这两种粒度的疑似错误结果，形成疑似错误位置候选集；</p>
<p>错误纠正部分，是遍历所有的疑似错误位置，并使用音似、形似词典替换错误位置的词，然后通过语言模型计算句子困惑度，对所有候选集结果比较并排序，得到最优纠正词。</p>
<h3 id="深度模型的解决思路"><a href="#深度模型的解决思路" class="headerlink" title="深度模型的解决思路"></a><strong>深度模型的解决思路</strong></h3><p>端到端的深度模型可以避免人工提取特征，减少人工工作量，RNN序列模型对文本任务拟合能力强，rnn_attention在英文文本纠错比赛中取得第一名成绩，证明应用效果不错；</p>
<p>CRF会计算全局最优输出节点的条件概率，对句子中特定错误类型的检测，会根据整句话判定该错误，阿里参赛2016中文语法纠错任务并取得第一名，证明应用效果不错；</p>
<p>seq2seq模型是使用encoder-decoder结构解决序列转换问题，目前在序列转换任务中（如机器翻译、对话生成、文本摘要、图像描述）使用最广泛、效果最好的模型之一。</p>
<h1 id="编辑距离"><a href="#编辑距离" class="headerlink" title="编辑距离"></a>编辑距离</h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><p>编辑距离的经典应用就是用于拼写检错，如果用户输入的词语不在词典中，自动从词典中找出编辑距离小于某个数n的单词，让用户选择正确的那一个，n通常取到2或者3。</p>
<p>字符串A到B的<strong>编辑距离</strong>是指，只用插入、删除和替换三种操作，最少需要多少步可以把A变成B。例如，从FAME到GATE需要两步（两次替换），从GAME到ACM则需要三步（删除G和E再添加C）。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minDistance_recursive</span><span class="params">(self, word1, word2)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        递归解法</span></span><br><span class="line"><span class="string">        :type word1: str</span></span><br><span class="line"><span class="string">        :type word2: str</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word1 <span class="keyword">or</span> <span class="keyword">not</span> word2:</span><br><span class="line">            <span class="comment"># 递归出口：其中一个字符串为空，返回非空字符串的长度</span></span><br><span class="line">            <span class="keyword">return</span> (len(word1) <span class="keyword">or</span> len(word2))</span><br><span class="line">        <span class="keyword">if</span> word1[<span class="number">-1</span>] == word2[<span class="number">-1</span>]:</span><br><span class="line">            <span class="comment"># 如果两个字符串最后一个字符相同</span></span><br><span class="line">            <span class="keyword">return</span> self.minDistance(word1[:<span class="number">-1</span>], word2[:<span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + min(self.minDistance(word1[:<span class="number">-1</span>], word2), self.minDistance(word1, word2[:<span class="number">-1</span>]),</span><br><span class="line">                       self.minDistance(word1[:<span class="number">-1</span>], word2[:<span class="number">-1</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minDistance_dp</span><span class="params">(self,word1,word2)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        动态规划解法</span></span><br><span class="line"><span class="string">        :param word1:</span></span><br><span class="line"><span class="string">        :param word2:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> word1 <span class="keyword">or</span> <span class="keyword">not</span> word2:</span><br><span class="line">            <span class="keyword">return</span> (len(word1) <span class="keyword">or</span> len(word2))</span><br><span class="line"></span><br><span class="line">        dp = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(len(word2)+<span class="number">1</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(len(word1)+<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># dp 初始化</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(word1)+<span class="number">1</span>):</span><br><span class="line">            dp[i][<span class="number">0</span>] = i</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(word2)+<span class="number">1</span>):</span><br><span class="line">            dp[<span class="number">0</span>][i] = i</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(word1)+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,len(word2)+<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> word1[i<span class="number">-1</span>] == word2[j<span class="number">-1</span>]:</span><br><span class="line">                    dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[i][j] = <span class="number">1</span> + min(dp[i<span class="number">-1</span>][j],dp[i][j<span class="number">-1</span>],dp[i<span class="number">-1</span>][j<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[len(word1)][len(word2)]</span><br></pre></td></tr></table></figure>
<p><a href="https://leetcode-cn.com/problems/edit-distance/solution/bian-ji-ju-chi-by-leetcode-solution/" target="_blank" rel="noopener">leetcode题解</a></p>
<h1 id="拼写自动纠错系统"><a href="#拼写自动纠错系统" class="headerlink" title="拼写自动纠错系统"></a>拼写自动纠错系统</h1><p>给定一待纠错词w,需要从一系列候选词中选出一最可能的词c。也就是：$argmax(p(c|w))$, c in 候选词表。根据贝叶斯原理，$p(c|w) = p(w|c) <em> p(c) / p(w)$. 又有对任意可能的c,p(w)一样，故也就是求使$argmax(p(w|c) </em> p(c))$成立的c.</p>
<h2 id="Candidate-Model"><a href="#Candidate-Model" class="headerlink" title="Candidate Model:"></a>Candidate Model:</h2><p>利用编辑距离小于1或者编辑距离小于2，来构造初步候选集，然后利用语料库，过滤初步候选集，得到符合规范的候选词。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edits1</span><span class="params">(word)</span>:</span></span><br><span class="line">    <span class="string">"All edits that are one edit away from `word`."</span></span><br><span class="line">    letters    = <span class="string">'abcdefghijklmnopqrstuvwxyz'</span></span><br><span class="line">    splits     = [(word[:i], word[i:])    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(word) + <span class="number">1</span>)]</span><br><span class="line">    deletes    = [L + R[<span class="number">1</span>:]               <span class="keyword">for</span> L, R <span class="keyword">in</span> splits <span class="keyword">if</span> R]</span><br><span class="line">    transposes = [L + R[<span class="number">1</span>] + R[<span class="number">0</span>] + R[<span class="number">2</span>:] <span class="keyword">for</span> L, R <span class="keyword">in</span> splits <span class="keyword">if</span> len(R)&gt;<span class="number">1</span>]</span><br><span class="line">    replaces   = [L + c + R[<span class="number">1</span>:]           <span class="keyword">for</span> L, R <span class="keyword">in</span> splits <span class="keyword">if</span> R <span class="keyword">for</span> c <span class="keyword">in</span> letters]</span><br><span class="line">    inserts    = [L + c + R               <span class="keyword">for</span> L, R <span class="keyword">in</span> splits <span class="keyword">for</span> c <span class="keyword">in</span> letters]</span><br><span class="line">    <span class="keyword">return</span> set(deletes + transposes + replaces + inserts)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edits2</span><span class="params">(word)</span>:</span> </span><br><span class="line">  <span class="string">"编辑距离小于2的候选词"</span></span><br><span class="line">  <span class="keyword">return</span> (e2 <span class="keyword">for</span> e1 <span class="keyword">in</span> edits1(word) <span class="keyword">for</span> e2 <span class="keyword">in</span> edits1(e1))</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">known</span><span class="params">(words)</span>:</span> </span><br><span class="line">  <span class="string">"在语料中过滤出复合拼写规范的（正确）的词"</span></span><br><span class="line">  <span class="keyword">return</span> set(w <span class="keyword">for</span> w <span class="keyword">in</span> words <span class="keyword">if</span> w <span class="keyword">in</span> corpus)</span><br></pre></td></tr></table></figure>
<h2 id="Language-Model"><a href="#Language-Model" class="headerlink" title="Language Model"></a>Language Model</h2><p>候选集合中的词再语料库中的出现概率。比如：the 在英文文本中出现的概率率为7%，则有：p(the)=0.07</p>
<p>,可以通过统计语料库中$p(c)$ = 词c出现的频次/所有词的出现次数之和。（unigram，bigram）</p>
<h2 id="Error-Model"><a href="#Error-Model" class="headerlink" title="Error Model"></a>Error Model</h2><p>当想要输入the却意外拼写成teh的概率:p(teh|the)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">candidates</span><span class="params">(word)</span>:</span> </span><br><span class="line">    <span class="keyword">return</span> known([word]) <span class="keyword">or</span> known(edits1(word)) <span class="keyword">or</span> known(edits2(word)) <span class="keyword">or</span> [word]</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">correction</span><span class="params">(word)</span>:</span> </span><br><span class="line">    <span class="keyword">return</span> max(candidates(word), key=P)</span><br></pre></td></tr></table></figure>
<h2 id="Selection-Mechanism"><a href="#Selection-Mechanism" class="headerlink" title="Selection Mechanism"></a>Selection Mechanism</h2><p>从正确的拼写候选集中选择最有可能的正确结果，argmax</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>利用编辑距离构造正确结果候选集</li>
<li>利用language model 和error model 来计算概率。</li>
<li>从正确结果候选集中选择概率最大的正确拼写。</li>
</ol>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol>
<li><p><a href="https://cloud.tencent.com/developer/article/1435917" target="_blank" rel="noopener">中文文本纠错算法走到多远了？</a></p>
</li>
<li><p><a href="https://github.com/shibing624/pycorrector" target="_blank" rel="noopener">pycorrect</a></p>
</li>
</ol>
]]></content>
      <categories>
        <category>技术/自然语言处理</category>
      </categories>
      <tags>
        <tag>nlp</tag>
        <tag>文本纠错</tag>
      </tags>
  </entry>
  <entry>
    <title>关键词抽取</title>
    <url>/2020/04/21/keyword_extraction/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2020/04/21/keyword_extraction/gjc01.png" alt></p>
<a id="more"></a>
<h1 id="TF-IDF-提取关键词"><a href="#TF-IDF-提取关键词" class="headerlink" title="TF-IDF 提取关键词"></a>TF-IDF 提取关键词</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>TF-IDF(Term Frequency-Inverse Document Frequency, 词频-逆文件频率).TF-IDF是一种统计方法，用以评估一字词对于一个文件集或一份文件在一个语料库中的重要程度。字词的重要性随着它在文件中出现的次数成正比增加，但同时会随着它在语料库中出现的频率成反比下降。换句话说就是：<strong>一个词语在一篇文章中出现次数越多, 同时在所有文档中出现次数越少, 越能够代表该文章。</strong></p>
<blockquote>
<p>TF-IDF 算法主要适用于英文，中文首先要分词，分词后要解决多词一义，以及一词多义问题，这两个问题通过简单的tf-idf方法不能很好的解决。于是就有了后来的词嵌入方法，用向量来表征一个词。</p>
</blockquote>
<h2 id="TF-IDF"><a href="#TF-IDF" class="headerlink" title="TF-IDF"></a>TF-IDF</h2><h3 id="TF"><a href="#TF" class="headerlink" title="TF"></a>TF</h3><p>表示词条（关键字）在文本中出现的次数（frequency）(一般不用)。TF 背后的隐含的假设是，查询关键字中的单词应该相对于其他单词更加重要，而文档的重要程度，也就是相关度，与单词在文档中出现的次数成正比。比如，“Car” 这个单词在文档 A 里出现了 5 次，而在文档 B 里出现了 20 次，那么 TF 计算就认为文档 B 可能更相关。</p>
<h4 id="变种一-通过对数函数避免-TF-线性增长"><a href="#变种一-通过对数函数避免-TF-线性增长" class="headerlink" title="变种一:通过对数函数避免 TF 线性增长"></a>变种一:通过对数函数避免 TF 线性增长</h4><p>理由：虽然我们一般认为一个文档包含查询关键词多次相对来说表达了某种相关度，但这样的关系很难说是线性的。以 “Car Insurance” 为例，文档 A 可能包含 “Car” 这个词 100 次，而文档 B 可能包含 200 次，是不是说文档 B 的相关度就是文档 A 的 2 倍呢？其实，当这种频次超过了某个阈值之后，这个 TF 也就没那么有区分度了。</p>
<p><strong>用 Log，也就是对数函数，对 TF 进行变换，就是一个不让 TF 线性增长的技巧</strong>。具体来说，人们常常用 1+Log(TF) 这个值来代替原来的 TF 取值。在这样新的计算下，假设 “Car” 出现一次，新的值是 1，出现 100 次，新的值是 $log 100=5.6$，而出现 200 次，新的值是$log 200 = 6.3$。很明显，这样的计算保持了一个平衡，既有区分度，但也不至于完全线性增长。</p>
<h4 id="变种二：标准化解决长文档、短文档问题"><a href="#变种二：标准化解决长文档、短文档问题" class="headerlink" title="变种二：标准化解决长文档、短文档问题"></a>变种二：标准化解决长文档、短文档问题</h4><p>经典的计算并没有考虑 “长文档” 和“短文档”的区别。一个文档 A 有 3,000 个单词，一个文档 B 有 250 个单词，很明显，即便 “Car” 在这两个文档中都同样出现过 20 次，也不能说这两个文档都同等相关。<strong>对 TF 进行 “标准化”（Normalization），特别是根据文档的最大 TF 值进行的标准化，成了另外一个比较常用的技巧</strong>。</p>
<script type="math/tex; mode=display">
tf_{ij} = \frac{n_{i,j}}{\sum_k n_{k,j}}</script><p>其中$n_{i,j}$是词$w_i$在文档$d_j$中出现的次数，分母是文档$d_j$中所有词汇出现的次数总和。</p>
<h3 id="IDF"><a href="#IDF" class="headerlink" title="IDF"></a>IDF</h3><p>仅有 TF 不能比较完整地描述文档的相关度。因为语言的因素，有一些单词可能会比较自然地在很多文档中反复出现，比如英语中的 “The”、“An”、“But” 等等。这些词大多起到了链接语句的作用，是保持语言连贯不可或缺的部分。然而，如果我们要搜索 “How to Build A Car” 这个关键词，其中的 “How”、“To” 以及 “A” 都极可能在绝大多数的文档中出现，这个时候 TF 就无法帮助我们区分文档的相关度了。</p>
<p>逆文档频率的思路很简单，就是我们需要去 “惩罚”（Penalize）那些出现在太多文档中的单词。</p>
<h4 id="变种三：对数函数处理-IDF"><a href="#变种三：对数函数处理-IDF" class="headerlink" title="变种三：对数函数处理 IDF"></a>变种三：对数函数处理 IDF</h4><p>某一特定词语的IDF，可以由总文件数目除以包含该词语的文件的数目，再将得到的商取对数得到。如果包含词条t的文档越少, IDF越大，则说明词条具有很好的类别区分能力。</p>
<script type="math/tex; mode=display">
idf_w = log{\frac{|D|}{|j:t_i \in d_j|}}</script><p>其中，$|D|$表示语料库中文档总数，分母为包含词w的文档数+1，分母加1是为了避免出现分母为零的情况。</p>
<p>样做的好处就是，第一，使用了文档总数来做标准化，很类似上面提到的标准化的思路；第二，利用对数来达到非线性增长的目的。</p>
<h4 id="变种四：查询词及文档向量标准化"><a href="#变种四：查询词及文档向量标准化" class="headerlink" title="变种四：查询词及文档向量标准化"></a>变种四：查询词及文档向量标准化</h4><p>对查询关键字向量，以及文档向量进行标准化，使得这些向量能够不受向量里有效元素多少的影响，也就是不同的文档可能有不同的长度。在线性代数里，可以把向量都标准化为一个单位向量的长度。这个时候再进行点积运算，就相当于在原来的向量上进行余弦相似度的运算。所以，另外一个角度利用这个规则就是直接在多数时候进行余弦相似度运算，以代替点积运算。</p>
<h3 id="TF-IDF-1"><a href="#TF-IDF-1" class="headerlink" title="TF-IDF"></a>TF-IDF</h3><p>某一特定文件内的高词语频率，以及该词语在整个文件集合中的低文件频率，可以产生出高权重的TF-IDF。因此，TF-IDF倾向于过滤掉常见的词语，保留重要的词语(关键词)。</p>
<script type="math/tex; mode=display">
TF-IDF = TF * IDF</script><h2 id="TF-IDF-的应用"><a href="#TF-IDF-的应用" class="headerlink" title="TF-IDF 的应用"></a>TF-IDF 的应用</h2><ol>
<li>搜索引擎</li>
<li>关键词提取</li>
<li>文本相似性</li>
<li>文本摘要</li>
</ol>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><figcaption><span>tf-idf</span><a href="https://github.com/jeffery0628/keyword_extraction" target="_blank" rel="noopener">github</a></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tf_idf</span><span class="params">(document, corpus)</span>:</span>  <span class="comment"># 计算TF-IDF,并返回字典</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param document: 计算document里面每个词的tfidf值，document为文本分词后的形式，</span></span><br><span class="line"><span class="string">    如:[6 月 19 日 2012 年度 中国 爱心 城市 公益活动 新闻 发布会 在京举行]</span></span><br><span class="line"><span class="string">    如果是对一篇文档进行关键词提取，则需要对文档进行分句，把每句话看成一个document，corpus则存放的是整篇文档分词后的所有句子（句子为分词后的结果）。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param corpus:  corpus为所有问当分词后的列表：[document1,document2,document3,...]</span></span><br><span class="line"><span class="string">    :return:dict类型，按照tfidf值从大到小排序： orderdict[word] = tfidf_value</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    word_tfidf = &#123;&#125;</span><br><span class="line">    <span class="comment"># 计算词频</span></span><br><span class="line">    freq_words = Counter(document)</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> freq_words:</span><br><span class="line">        <span class="comment"># 计算TF：某个词在文章中出现的次数/文章总词数</span></span><br><span class="line">        tf = freq_words[word] / len(document)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算IDF：log(语料库的文档总数/(包含该词的文档数+1))</span></span><br><span class="line">        idf = math.log(len(corpus) / (wordinfilecount(word, corpus) + <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算每个词的TFIDF值</span></span><br><span class="line">        tfidf = tf * idf  <span class="comment"># 计算TF-IDF</span></span><br><span class="line">        word_tfidf[word] = tfidf</span><br><span class="line"></span><br><span class="line">    orderdic = sorted(word_tfidf.items(), key=<span class="keyword">lambda</span> item: item[<span class="number">1</span>], reverse=<span class="literal">True</span>)  <span class="comment"># 给字典排序</span></span><br><span class="line">    <span class="keyword">return</span> orderdic</span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    stop_words_path = <span class="string">r'stop_words.txt'</span>  <span class="comment"># 停用词表路径</span></span><br><span class="line">    stop_words = get_stopwords(stop_words_path)  <span class="comment"># 获取停用词表列表</span></span><br><span class="line"></span><br><span class="line">    documents_dir = <span class="string">'data'</span></span><br><span class="line">    filelist = get_documents(documents_dir)  <span class="comment"># 获取文件列表</span></span><br><span class="line"></span><br><span class="line">    corpus = get_corpus(filelist, stop_words)  <span class="comment"># 建立语料库</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx,document <span class="keyword">in</span> enumerate(corpus):</span><br><span class="line">        word_tfidf = tf_idf(document, corpus)  <span class="comment"># 计算TF-IDF</span></span><br><span class="line">        <span class="comment"># 输出前十关键词</span></span><br><span class="line">        print(<span class="string">'document &#123;&#125;,top 10 key words&#123;&#125;'</span>.format(idx+<span class="number">1</span>,word_tfidf[:<span class="number">10</span>]))</span><br></pre></td></tr></table></figure>
<p>使用scikit-learn 计算tfidf<br><figure class="highlight python"><figcaption><span>tf-idf</span><a href="https://github.com/jeffery0628/keyword_extraction" target="_blank" rel="noopener">github</a></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfTransformer, TfidfVectorizer</span><br><span class="line"><span class="comment"># 对语料进行稍微处理</span></span><br><span class="line">corpus = [*map(<span class="keyword">lambda</span> x:<span class="string">" "</span>.join(x), corpus)]</span><br><span class="line">tfidf_model = TfidfVectorizer()</span><br><span class="line">tfidf_matrix = tfidf_model.fit_transform(corpus)  <span class="comment"># 计算每个词的tfidf值</span></span><br><span class="line">words = tfidf_model.get_feature_names()<span class="comment"># 所有词的集合</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(corpus)):</span><br><span class="line">  	word_tfidf = &#123;&#125;</span><br><span class="line">  	<span class="keyword">for</span> j <span class="keyword">in</span> range(len(words)):</span><br><span class="line">        word_tfidf[words[j]] = tfidf_matrix[i, j]</span><br><span class="line">        word_tfidf = sorted(word_tfidf.items(),key=<span class="keyword">lambda</span> item:item[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br><span class="line">        print(<span class="string">'document &#123;&#125;,top 10 key words&#123;&#125;'</span>.format(i+<span class="number">1</span>, word_tfidf[:<span class="number">10</span>]))</span><br></pre></td></tr></table></figure></p>
<h1 id="TextRank-提取关键词"><a href="#TextRank-提取关键词" class="headerlink" title="TextRank 提取关键词"></a>TextRank 提取关键词</h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><p>TF-IDF 算法对有多段文本的关键词提取非常有效，但是对于单篇或者文档分割较少的文本表现得不是特别好。如果需要提取关键词的语句只有一句话，那么基于TF-IDF可以知道，所有关键词的重要度都为0(因为IDF值为0)，这种情况下使用TextRank是比较好的选择。</p>
<p>TextRank是一种基于图排序的算法，基本思想是(来源于PageRank)：通过把文本分割成若干组成单元(单词、句子)并建立图模型，利用投票机制对文本中的重要成分进行排序，<strong>仅利用单篇文档本身的信息就可以实现关键词提取、文本摘要</strong>。和 LDA、HMM 等模型不同, TextRank不需要事先对多篇文档进行学习训练, 因其简洁有效而得到广泛应用。</p>
<h2 id="PageRank"><a href="#PageRank" class="headerlink" title="PageRank"></a>PageRank</h2><h3 id="PageRank-的简化模型"><a href="#PageRank-的简化模型" class="headerlink" title="PageRank 的简化模型"></a>PageRank 的简化模型</h3><p>假设一共有 4 个网页 A、B、C、D。它们之间的链接信息如图所示：</p>
<p><img src="/2020/04/21/keyword_extraction/pagerank.png" alt="avatar"></p>
<p>出链指的是链接出去的链接。入链指的是链接进来的链接。比如图中 A 有 2 个入链，3 个出链。简单来说，一个网页的影响力 = 所有入链集合的页面的加权影响力之和，用公式表示为：</p>
<script type="math/tex; mode=display">
P R(u)=\sum_{v \in B_{u}} \frac{P R(v)}{L(v)}</script><p>u 为待评估的页面， $B_{u}$ 为页面 $u$ 的入链集合。针对入链集合中的任意页面 $v$，它能给 $u$ 带来的影响力是其自身的影响力 $PR(v)$ 除以 $v$ 页面的出链数量，即页面 $v$ 把影响力 $PR(v)$ 平均分配给了它的出链，这样统计所有能给 $u$ 带来链接的页面 $v$，得到的总和就是网页 $u$ 的影响力，即为 $PR(u)$。所以出链会给被链接的页面赋予影响力，当我们统计了一个网页链出去的数量，也就是统计了这个网页的跳转概率。</p>
<p>在例子中，A 有三个出链分别链接到了 B、C、D 上。那么当用户访问 A 的时候，就有跳转到 B、C 或者 D 的可能性，跳转概率均为 1/3。B 有两个出链，链接到了 A 和 D 上，跳转概率为 1/2。这样，我们可以得到 A、B、C、D 这四个网页的转移矩阵 M：</p>
<script type="math/tex; mode=display">
M=\left[\begin{array}{cccc}
0 & 1 / 2 & 1 & 0 \\
1 / 3 & 0 & 0 & 1 / 2 \\
1 / 3 & 0 & 0 & 1 / 2 \\
1 / 3 & 1 / 2 & 0 & 0
\end{array}\right]</script><p>假设 A、B、C、D 四个页面的初始影响力都是相同的，即：</p>
<script type="math/tex; mode=display">
w_{0}=\left[\begin{array}{l}
1 / 4 \\
1 / 4 \\
1 / 4 \\
1 / 4
\end{array}\right]</script><p>当进行第一次转移之后，各页面的影响力 $w_{1}$ 变为：</p>
<script type="math/tex; mode=display">
w_1=Mw_0=\left[\begin{array}{cccc}
0 & 1 / 2 & 1 & 0 \\
1 / 3 & 0 & 0 & 1 / 2 \\
1 / 3 & 0 & 0 & 1 / 2 \\
1 / 3 & 1 / 2 & 0 & 0
\end{array}\right]\left[\begin{array}{c}
1 / 4 \\
1 / 4 \\
1 / 4 \\
1 / 4
\end{array}\right]=\left[\begin{array}{c}
9 / 24 \\
5 / 24 \\
5 / 24 \\
5 / 24
\end{array}\right]</script><p>然后再用转移矩阵乘以 $w_{1}$ 得到 $w_{2}$ 结果，直到第 $n$ 次迭代后 $w_{n}$ 影响力不再发生变化，可以收敛到 $(0.3333,0.2222,0.2222,0.2222$，也就是对应着 A、B、C、D 四个页面最终平衡状态下的影响力。能看出 A 页面相比于其他页面来说权重更大，也就是 PR 值更高。而 B、C、D 页面的 PR 值相等。</p>
<h3 id="等级泄露（Rank-Leak）"><a href="#等级泄露（Rank-Leak）" class="headerlink" title="等级泄露（Rank Leak）"></a>等级泄露（Rank Leak）</h3><p>如果一个网页没有出链，就像是一个黑洞一样，吸收了其他网页的影响力而不释放，最终会导致其他网页的 PR 值为 0。</p>
<p><img src="/2020/04/21/keyword_extraction/rank_leak.png" alt="avatar"></p>
<h3 id="等级沉没（Rank-Sink）"><a href="#等级沉没（Rank-Sink）" class="headerlink" title="等级沉没（Rank Sink）"></a>等级沉没（Rank Sink）</h3><p>如果一个网页只有出链，没有入链，计算的过程迭代下来，会导致<strong>这个网页</strong>的 PR 值为 0（也就是不存在公式中的 V）。</p>
<p><img src="/2020/04/21/keyword_extraction/rank_sink.png" alt="avatar"></p>
<h3 id="解决方案：随机浏览"><a href="#解决方案：随机浏览" class="headerlink" title="解决方案：随机浏览"></a>解决方案：随机浏览</h3><p>为了解决简化模型中存在的等级泄露和等级沉没的问题，拉里·佩奇提出了 PageRank 的随机浏览模型。他假设了这样一个场景：用户并不都是按照跳转链接的方式来上网，还有一种可能是不论当前处于哪个页面，都有概率访问到其他任意的页面，比如说用户就是要直接输入网址访问其他页面，虽然这个概率比较小。</p>
<p>所以他定义了阻尼因子 d，这个因子代表了用户按照跳转链接来上网的概率，通常可以取一个固定值 0.85，而 1-d=0.15 则代表了用户不是通过跳转链接的方式来访问网页的，比如直接输入网址。</p>
<script type="math/tex; mode=display">
P R(u)=\frac{1-d}{N}+d \sum_{v \in B_{u}} \frac{P R(v)}{L(v)}</script><p>其中 $N$ 为网页总数，这样我们又可以重新迭代网页的权重计算了，加入了阻尼因子 $d$，一定程度上解决了等级泄露和等级沉没的问题。通过数学定理也可以证明，最终 PageRank 随机浏览模型是可以收敛的，也就是可以得到一个稳定正常的 PR 值。</p>
<h2 id="TextRank"><a href="#TextRank" class="headerlink" title="TextRank"></a>TextRank</h2><p>TextRank通过词之间的相邻关系构建网络，然后用PageRank迭代计算每个节点的rank值，排序rank值即可得到关键词。PageRank迭代计算公式如下：</p>
<script type="math/tex; mode=display">
P R\left(V_{i}\right)=(1-d)+d * \sum_{j \in \operatorname{In}\left(V_{i}\right)} \frac{1}{\left|O u t\left(V_{j}\right)\right|} P R\left(V_{j}\right)</script><p>其中，d:表示阻尼系数，一般为0.85。$V_i$：表示图中任一节点。$In(V_i)$:表示指向顶点$V_i$的所有顶点的集合。$|Out(V_j)|$：表示由顶点$V_j$连接出去的所有顶点集合个数。$PR(V_i)$：表示顶点$V_i$的最终排序权重。(与pagerank公式基本一致。)</p>
<p>网页之间的链接关系可以用图表示，那么怎么把一个句子（可以看作词的序列）构建成图呢？TextRank将某一个词与其前面的N个词、以及后面的N个词均具有图相邻关系（类似于N-gram语法模型）。具体实现：设置一个长度为N的滑动窗口，所有在这个窗口之内的词都视作词结点的相邻结点；则TextRank构建的词图为无向图。下图给出了由一个文档构建的词图（去掉了停用词并按词性做了筛选）：</p>
<p><img src="/2020/04/21/keyword_extraction/textrank.png" alt="avatar"></p>
<p>考虑到不同词对可能有不同的共现（co-occurrence），TextRank将共现作为无向图边的权值。那么，TextRank的迭代计算公式如下：</p>
<script type="math/tex; mode=display">
W S\left(V_{i}\right)=(1-d)+d * \sum_{j \in \operatorname{In}\left(V_{i}\right)} \frac{w_{ij}}{\left|O u t\left(V_{j}\right)\right|} W S\left(V_{j}\right)</script><p>该公式仅仅比PageRank多了一个权重项$w_{ij}$，用来表示两个节点之间的边连接有不同的重要程度。</p>
<h3 id="TextRank-关键词-短语-提取算法"><a href="#TextRank-关键词-短语-提取算法" class="headerlink" title="TextRank 关键词(短语)提取算法"></a>TextRank 关键词(短语)提取算法</h3><ol>
<li>把给定的文本$T$按照完整句子进行分割，即$T = [S_1,S_2,\ldots,S_n]$.</li>
<li>文本$T$中每个句子$S_i$，进行分词和词性标注处理，并过滤掉停用词，只保留指定词性的单词，如名词、动词、形容词，即$S_i = [t_{i,1},t_{i,2},\ldots,t_{i,\pi}]$,其中$t_{ij}$是保留后的候选关键词。</li>
<li>构建候选关键词图$G = (V,E)$，其中$V$为节点集，由步骤2生成的候选关键词组成，然后采用共现关系（co-occurrence）构造任两点之间的边，两个节点之间存在边仅当它们对应的词汇在长度为K的窗口中共现，K表示窗口大小，即最多共现K个单词。</li>
<li>根据上面公式，迭代传播各节点的权重，直至收敛。</li>
<li>对节点权重进行倒序排序，从而得到最重要的T个单词，作为候选关键词。</li>
<li>由步骤5得到最重要的T个单词，在原始文本中进行标记，若形成相邻词组，则组合成多词关键词。</li>
</ol>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><figcaption><span>textrank</span><a href="https://github.com/jeffery0628/keyword_extraction" target="_blank" rel="noopener">github</a></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">import</span> jieba.posseg <span class="keyword">as</span> pseg</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">textrank_graph</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.graph = defaultdict(list) <span class="comment"># key:[(),(),(),...] 如：是 [('是', '全国', 1), ('是', '调查', 1), ('是', '失业率', 1), ('是', '城镇', 1)]</span></span><br><span class="line">        self.d = <span class="number">0.85</span>  <span class="comment"># d是阻尼系数，一般设置为0.85</span></span><br><span class="line">        self.min_diff = <span class="number">1e-5</span>  <span class="comment"># 设定收敛阈值</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加节点之间的边</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addEdge</span><span class="params">(self, start, end, weight)</span>:</span></span><br><span class="line">        self.graph[start].append((start, end, weight))</span><br><span class="line">        self.graph[end].append((end, start, weight))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 节点排序</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rank</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 一共有14个节点</span></span><br><span class="line">        print(len(self.graph))</span><br><span class="line">        <span class="comment"># 默认初始化权重</span></span><br><span class="line">        weight_deault = <span class="number">1.0</span> / (len(self.graph) <span class="keyword">or</span> <span class="number">1.0</span>)</span><br><span class="line">        <span class="comment"># nodeweight_dict, 存储节点的权重</span></span><br><span class="line">        nodeweight_dict = defaultdict(float)</span><br><span class="line">        <span class="comment"># outsum，存储节点的出度权重</span></span><br><span class="line">        outsum_node_dict = defaultdict(float)</span><br><span class="line">        <span class="comment"># 根据图中的边，更新节点权重</span></span><br><span class="line">        <span class="keyword">for</span> node, out_edge <span class="keyword">in</span> self.graph.items():</span><br><span class="line">            <span class="comment"># 是 [('是', '全国', 1), ('是', '调查', 1), ('是', '失业率', 1), ('是', '城镇', 1)]</span></span><br><span class="line">            nodeweight_dict[node] = weight_deault <span class="comment"># 初始化节点权重</span></span><br><span class="line">            outsum_node_dict[node] = sum((edge[<span class="number">2</span>] <span class="keyword">for</span> edge <span class="keyword">in</span> out_edge), <span class="number">0.0</span>) <span class="comment"># 统计node节点的出度</span></span><br><span class="line">        <span class="comment"># 初始状态下的textrank重要性权重</span></span><br><span class="line">        sorted_keys = sorted(self.graph.keys())</span><br><span class="line">        <span class="comment"># 设定迭代次数，</span></span><br><span class="line">        step_dict = [<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> step <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">            <span class="keyword">for</span> node <span class="keyword">in</span> sorted_keys:</span><br><span class="line">                s = <span class="number">0</span></span><br><span class="line">                <span class="comment"># 计算公式：(edge_weight/outsum_node_dict[edge_node])*node_weight[edge_node]</span></span><br><span class="line">                <span class="keyword">for</span> e <span class="keyword">in</span> self.graph[node]:</span><br><span class="line">                    s += e[<span class="number">2</span>] / outsum_node_dict[e[<span class="number">1</span>]] * nodeweight_dict[e[<span class="number">1</span>]]</span><br><span class="line">                <span class="comment"># 计算公式：(1-d) + d*s</span></span><br><span class="line">                nodeweight_dict[node] = (<span class="number">1</span> - self.d) + self.d * s</span><br><span class="line">            step_dict.append(sum(nodeweight_dict.values()))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> abs(step_dict[step] - step_dict[step - <span class="number">1</span>]) &lt;= self.min_diff:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 利用Z-score进行权重归一化，也称为离差标准化，是对原始数据的线性变换，使结果值映射到[0 - 1]之间。</span></span><br><span class="line">        <span class="comment"># 先设定最大值与最小值均为系统存储的最大值和最小值</span></span><br><span class="line">        (min_rank, max_rank) = (sys.float_info[<span class="number">0</span>], sys.float_info[<span class="number">3</span>])</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> nodeweight_dict.values():</span><br><span class="line">            <span class="keyword">if</span> w &lt; min_rank:</span><br><span class="line">                min_rank = w</span><br><span class="line">            <span class="keyword">if</span> w &gt; max_rank:</span><br><span class="line">                max_rank = w</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> n, w <span class="keyword">in</span> nodeweight_dict.items(): <span class="comment"># 归一化</span></span><br><span class="line">            nodeweight_dict[n] = (w - min_rank / <span class="number">10.0</span>) / (max_rank - min_rank / <span class="number">10.0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> nodeweight_dict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextRank</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.candi_pos = [<span class="string">'n'</span>, <span class="string">'v'</span>, <span class="string">'a'</span>] <span class="comment"># 关键词的词性：名词，动词，形容词</span></span><br><span class="line">        self.span = <span class="number">5</span> <span class="comment"># 窗口大小</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_keywords</span><span class="params">(self, text, num_keywords)</span>:</span></span><br><span class="line">        g = textrank_graph()</span><br><span class="line">        cm = defaultdict(int)</span><br><span class="line">        word_list = [[word.word, word.flag] <span class="keyword">for</span> word <span class="keyword">in</span> pseg.cut(text)] <span class="comment"># 使用jieba分词并且对词性进行标注</span></span><br><span class="line">        <span class="keyword">for</span> i, word <span class="keyword">in</span> enumerate(word_list): <span class="comment"># 该循环用于统计在窗口范围内，词的共现次数</span></span><br><span class="line">            <span class="keyword">if</span> word[<span class="number">1</span>][<span class="number">0</span>] <span class="keyword">in</span> self.candi_pos <span class="keyword">and</span> len(word[<span class="number">0</span>]) &gt; <span class="number">1</span>: <span class="comment">#</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(i + <span class="number">1</span>, i + self.span):</span><br><span class="line">                    <span class="keyword">if</span> j &gt;= len(word_list):<span class="comment"># 防止下标越界</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    <span class="keyword">if</span> word_list[j][<span class="number">1</span>][<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> self.candi_pos <span class="keyword">or</span> len(word_list[j][<span class="number">0</span>]) &lt; <span class="number">2</span>: <span class="comment"># 排除词性不在关键词词性列表中的词或者词长度小于2的词</span></span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    pair = tuple((word[<span class="number">0</span>], word_list[j][<span class="number">0</span>]))</span><br><span class="line">                    cm[(pair)] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> terms, w <span class="keyword">in</span> cm.items():</span><br><span class="line">            g.addEdge(terms[<span class="number">0</span>], terms[<span class="number">1</span>], w)</span><br><span class="line">        nodes_rank = g.rank()</span><br><span class="line">        nodes_rank = sorted(nodes_rank.items(), key=<span class="keyword">lambda</span> asd:asd[<span class="number">1</span>], reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> nodes_rank[:num_keywords]</span><br></pre></td></tr></table></figure>
<h1 id="LDA-Latent-Dirichlet-Allocation-提取关键词"><a href="#LDA-Latent-Dirichlet-Allocation-提取关键词" class="headerlink" title="LDA (Latent Dirichlet Allocation) 提取关键词"></a>LDA (Latent Dirichlet Allocation) 提取关键词</h1><h2 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h2><p>TF-IDF 和 TextRank 两种算法更多反映的是文本的统计信息，对于文本之间的语义关系考虑得比较少。LDA是一种能够体文本语义关系的关键词提取方法。</p>
<blockquote>
<p>二项分布（Binomial Distribution），即重复n次的伯努利试验（Bernoulli Experiment），用$\xi$表示随机试验的结果。如果事件发生的概率是P,则不发生的概率$q=1-p$，$N$次独立重复试验中发生K次的概率是$P(\xi=K)= C(n,k) <em> p^k </em> (1-p)^{n-k}$，其中$C(n, k) =\frac{n!}{(k!(n-k)!)}$. 期望：$E(ξ)=np$,方差：$D(ξ)=npq$其中$q=1-p$</p>
<p>多项分布（Multinomial Distribution）：多项式分布是二项式分布的推广。二项分布的典型例子是扔硬币，硬币正面朝上概率为p, 重复扔n次硬币，k次为正面的概率即为一个二项分布概率。把二项分布公式推广至多种状态，就得到了多项分布。<br>某随机实验如果有k个可能结局$A_1,A_2,\ldots,A_k$，分别将他们的出现次数记为随机变量$X_1,X_2,\ldots,X_k$，它们的概率分布分别是$p_1,p_2,\ldots,p_k$那么在$n$次采样的总结果中，$A_1$出现$n_1$次、$A_2$出现$n_2$次,$\dots$,$A_k$出现$n_k$次的这种事件的出现概率$P$有下面公式：</p>
<script type="math/tex; mode=display">
P\left(X_{1}=n_{1}, \cdots, X_{k}=n_{k}\right)=\left\{\begin{array}{ll}
\frac{n !}{n_{1} ! \cdots n_{k} !} p_{1}^{n_{1}} \cdots p_{k}^{n_{k}} & , \sum_{i=1}^{k} n_{i}=n \\
0 & , \text { otherwise }
\end{array}\right.</script><p>Beta分布与Dirichlet分布的定义域均为[0,1]，在实际使用中，通常将两者作为概率的分布，Beta分布描述的是单变量分布，Dirichlet分布描述的是多变量分布，因此，Beta分布可作为二项分布的先验概率，Dirichlet分布可作为多项分布的先验概率。</p>
</blockquote>
<p>在主题模型中，主题表示一个概念，表现为一系列相关的单词，是这些单词的条件概率。形象来说，主题就是一个桶，里面装了出现概率较高的单词，这些单词与这个主题有很强的相关性。</p>
<h2 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h2><p>怎样才能生成主题？对文章的主题应该怎么分析？这是主题模型要解决的问题。</p>
<p> 首先，可以用生成模型来看文档和主题这两件事。所谓生成模型，就是说，我们认为<strong>一篇文章的每个词都是通过“以一定概率选择了某个主题，并从这个主题中以一定概率选择某个词语”</strong>这样一个过程得到的。那么，如果我们要生成一篇文档，它里面的每个词语出现的概率为：</p>
<script type="math/tex; mode=display">
p(W|D) = \sum_T P(W|T)P(T|D)</script><p>其中，$W$表示词，$T$表示主题，$D$表示文档。</p>
<p><img src="/2020/04/21/keyword_extraction/lda.png" alt="avatar"></p>
<p>其中”文档-词语”矩阵表示每个单词在每个文档中的词频，即出现的概率；”主题-词语”矩阵表示每个主题中每个单词的出现概率；”文档-主题”矩阵表示每个主题在每个文档中出现的概率。</p>
<p>单词对于主题的概率和主题对于文档的概率，可以通过Gibbs采样法（？？？）来进行概率的计算。</p>
<p>主题$T_k$下各个词$W_i$的权重计算公式：</p>
<script type="math/tex; mode=display">
P(W_i|T_k) = \frac{C_{ik}+\beta}{\sum_{i=1}^N{C_{ik}+N*\beta}} = \phi_i^{t=k}</script><p>其中，$w_i$：表示单词集合中的任一单词。$T_k$:表示主题集合中任一主题。$P(w_i|T_k)$:表示在主题为$k$时，单词$i$出现的概率，其简记为$\phi_i^{t=k}$，$C_{ik}$:表示语料库中单词$i$被赋予主题$k$的次数。$N$:表示词汇表的大小。$\beta$：表示超参数。</p>
<p>文档$D_m$下各个词$T_k$的权重计算公式：</p>
<script type="math/tex; mode=display">
P(T_k|D_m) = \frac{C_{km}+\alpha}{\sum^K_{k=1}C_{km}+K*\alpha}=\theta^m_{t=k}</script><p>其中，$D_m$:表示文档集合中任一文档。$T_k$:表示主题集合中任一主题。$P(T_k|D_m)$:表示语料库中文档m中单词被赋予主题$k$的次数。$K$：表示主题的数量。$\alpha$表示超参数。</p>
<p>得到了指定文档下某主题出现的概率，以及指定主题下、某单词出现的概率。那么由联合概率分布可以知道，对于指定文档某单词出现的概率：</p>
<script type="math/tex; mode=display">
P(W_i|D_m) = \sum_{k=1}^K{\phi_i^{t=k}*\theta_{t=k}^m}</script><p>基于上述公式，可以计算出单词$i$对于文档$m$的主题重要性。</p>
<p>但是由于在LDA主题概率模型中，所有的词汇都会以一定的概率出现在每个主题，所以这样会导致最终计算的单词对于文档的主题重要性区分度受影响。为了避免这种情况，一般会将单词相对于主题概率小于一定阈值的概率置为0.</p>
<h2 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><figcaption><span>LDA</span><a href="https://github.com/jeffery0628/keyword_extraction" target="_blank" rel="noopener">github</a></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 主题模型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TopicModel</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># 三个传入参数：处理后的数据集，关键词数量，具体模型（LSI、LDA），主题数量</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, doc_list, keyword_num, model=<span class="string">'LDA'</span>, num_topics=<span class="number">4</span>)</span>:</span></span><br><span class="line">        <span class="comment"># 使用gensim的接口，将文本转为向量化表示</span></span><br><span class="line">        <span class="comment"># 先构建词空间</span></span><br><span class="line">        self.dictionary = corpora.Dictionary(doc_list)</span><br><span class="line">        <span class="comment"># 使用BOW模型向量化 (token_id,freq)</span></span><br><span class="line">        corpus = [self.dictionary.doc2bow(doc) <span class="keyword">for</span> doc <span class="keyword">in</span> doc_list]  <span class="comment"># (token_id,freq)</span></span><br><span class="line">        <span class="comment"># 对每个词，根据tf-idf进行加权，得到加权后的向量表示</span></span><br><span class="line">        self.tfidf_model = models.TfidfModel(corpus)</span><br><span class="line">        self.tfidf_corpus = self.tfidf_model[corpus]</span><br><span class="line"></span><br><span class="line">        self.keyword_num = keyword_num</span><br><span class="line">        self.num_topics = num_topics</span><br><span class="line">        <span class="comment"># 选择加载胡模型</span></span><br><span class="line">        <span class="keyword">if</span> model == <span class="string">'LSI'</span>:</span><br><span class="line">            self.model = self.train_lsi()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.model = self.train_lda()</span><br><span class="line">        <span class="comment"># 得到数据集的主题-词分布</span></span><br><span class="line">        word_dic = self.word_dictionary(doc_list)</span><br><span class="line">        self.wordtopic_dic = self.get_wordtopic(word_dic)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 向量化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">doc2bowvec</span><span class="params">(self, word_list)</span>:</span></span><br><span class="line">        vec_list = [<span class="number">1</span> <span class="keyword">if</span> word <span class="keyword">in</span> word_list <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> word <span class="keyword">in</span> self.dictionary]</span><br><span class="line">        print(<span class="string">"vec_list"</span>, vec_list)</span><br><span class="line">        <span class="keyword">return</span> vec_list</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 词空间构建方法和向量化方法，在没有gensim接口时的一般处理方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">word_dictionary</span><span class="params">(self, doc_list)</span>:</span></span><br><span class="line">        dictionary = []</span><br><span class="line">        <span class="comment"># 2及变1及结构</span></span><br><span class="line">        <span class="keyword">for</span> doc <span class="keyword">in</span> doc_list:</span><br><span class="line">            <span class="comment"># extend he append 方法有何异同 容易出错</span></span><br><span class="line">            dictionary.extend(doc)</span><br><span class="line"></span><br><span class="line">        dictionary = list(set(dictionary))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dictionary</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 得到数据集的主题 - 词分布</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_wordtopic</span><span class="params">(self, word_dic)</span>:</span></span><br><span class="line">        wordtopic_dic = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> word_dic:</span><br><span class="line">            singlist = [word]</span><br><span class="line">            <span class="comment"># 计算每个词胡加权向量</span></span><br><span class="line">            word_corpus = self.tfidf_model[self.dictionary.doc2bow(singlist)]</span><br><span class="line">            <span class="comment"># 计算每个词de主题向量</span></span><br><span class="line">            word_topic = self.model[word_corpus]</span><br><span class="line">            wordtopic_dic[word] = word_topic</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wordtopic_dic</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train_lsi</span><span class="params">(self)</span>:</span></span><br><span class="line">        lsi = models.LsiModel(self.tfidf_corpus, id2word=self.dictionary, num_topics=self.num_topics)</span><br><span class="line">        <span class="keyword">return</span> lsi</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train_lda</span><span class="params">(self)</span>:</span></span><br><span class="line">        lda = models.LdaModel(self.tfidf_corpus, id2word=self.dictionary, num_topics=self.num_topics)</span><br><span class="line">        <span class="keyword">return</span> lda</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算词的分布和文档的分布的相似度，取相似度最高的keyword_num个词作为关键词</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_simword</span><span class="params">(self, word_list)</span>:</span></span><br><span class="line">        <span class="comment"># 文档的加权向量</span></span><br><span class="line">        sentcorpus = self.tfidf_model[self.dictionary.doc2bow(word_list)]</span><br><span class="line">        <span class="comment"># 文档主题 向量</span></span><br><span class="line">        senttopic = self.model[sentcorpus]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># senttopic [(0, 0.03457821), (1, 0.034260772), (2, 0.8970413), (3, 0.034119748)]</span></span><br><span class="line">        <span class="comment"># 余弦相似度计算</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">calsim</span><span class="params">(l1, l2)</span>:</span></span><br><span class="line">            a, b, c = <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span></span><br><span class="line">            <span class="keyword">for</span> t1, t2 <span class="keyword">in</span> zip(l1, l2):</span><br><span class="line">                x1 = t1[<span class="number">1</span>]</span><br><span class="line">                x2 = t2[<span class="number">1</span>]</span><br><span class="line">                a += x1 * x1</span><br><span class="line">                b += x1 * x1</span><br><span class="line">                c += x2 * x2</span><br><span class="line">            sim = a / math.sqrt(b * c) <span class="keyword">if</span> <span class="keyword">not</span> (b * c) == <span class="number">0.0</span> <span class="keyword">else</span> <span class="number">0.0</span></span><br><span class="line">            <span class="keyword">return</span> sim</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算输入文本和每个词的主题分布相似度</span></span><br><span class="line">        sim_dic = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> self.wordtopic_dic.items():</span><br><span class="line">            <span class="comment"># 还是计算每个再本文档中的词  和文档的相识度</span></span><br><span class="line">            <span class="keyword">if</span> k <span class="keyword">not</span> <span class="keyword">in</span> word_list:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment">#</span></span><br><span class="line">            sim = calsim(v, senttopic)</span><br><span class="line">            sim_dic[k] = sim</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> sorted(sim_dic.items(), key=<span class="keyword">lambda</span> item:item[<span class="number">1</span>], reverse=<span class="literal">True</span>)[:self.keyword_num]:</span><br><span class="line">            print(k, v)</span><br><span class="line">        print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">topic_extract</span><span class="params">(word_list, model, pos=False, keyword_num=<span class="number">10</span>)</span>:</span></span><br><span class="line">    doc_list = load_data(pos)</span><br><span class="line">    topic_model = TopicModel(doc_list, keyword_num, model=model)</span><br><span class="line">    topic_model.get_simword(word_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">textrank_extract</span><span class="params">(text, pos=False, keyword_num=<span class="number">10</span>)</span>:</span></span><br><span class="line">    textrank = analyse.textrank</span><br><span class="line">    keywords = textrank(text, keyword_num)</span><br><span class="line">    <span class="comment"># 输出抽取出的关键词</span></span><br><span class="line">    <span class="keyword">for</span> keyword <span class="keyword">in</span> keywords:</span><br><span class="line">        print(keyword + <span class="string">"/ "</span>, end=<span class="string">''</span>)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    text = <span class="string">'6月19日,《2012年度“中国爱心城市”公益活动新闻发布会》在京举行。'</span> + \</span><br><span class="line">           <span class="string">'中华社会救助基金会理事长许嘉璐到会讲话。基金会高级顾问朱发忠,全国老龄'</span> + \</span><br><span class="line">           <span class="string">'办副主任朱勇,民政部社会救助司助理巡视员周萍,中华社会救助基金会副理事长耿志远,'</span> + \</span><br><span class="line">           <span class="string">'重庆市民政局巡视员谭明政。晋江市人大常委会主任陈健倩,以及10余个省、市、自治区民政局'</span> + \</span><br><span class="line">           <span class="string">'领导及四十多家媒体参加了发布会。中华社会救助基金会秘书长时正新介绍本年度“中国爱心城'</span> + \</span><br><span class="line">           <span class="string">'市”公益活动将以“爱心城市宣传、孤老关爱救助项目及第二届中国爱心城市大会”为主要内容,重庆市'</span> + \</span><br><span class="line">           <span class="string">'、呼和浩特市、长沙市、太原市、蚌埠市、南昌市、汕头市、沧州市、晋江市及遵化市将会积极参加'</span> + \</span><br><span class="line">           <span class="string">'这一公益活动。中国雅虎副总编张银生和凤凰网城市频道总监赵耀分别以各自媒体优势介绍了活动'</span> + \</span><br><span class="line">           <span class="string">'的宣传方案。会上,中华社会救助基金会与“第二届中国爱心城市大会”承办方晋江市签约,许嘉璐理'</span> + \</span><br><span class="line">           <span class="string">'事长接受晋江市参与“百万孤老关爱行动”向国家重点扶贫地区捐赠的价值400万元的款物。晋江市人大'</span> + \</span><br><span class="line">           <span class="string">'常委会主任陈健倩介绍了大会的筹备情况。'</span></span><br><span class="line"></span><br><span class="line">    pos = <span class="literal">False</span></span><br><span class="line">    seg_list = seg_to_list(text, pos)</span><br><span class="line">    filter_list = word_filter(seg_list, pos)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'LDA模型结果：'</span>)</span><br><span class="line">    topic_extract(filter_list, <span class="string">'LDA'</span>, pos)</span><br></pre></td></tr></table></figure>
<h3 id="LDA-步骤总结"><a href="#LDA-步骤总结" class="headerlink" title="LDA 步骤总结"></a>LDA 步骤总结</h3><p>数据集处理</p>
<ol>
<li>先构建词空间  Dictionary(4064 unique tokens: [‘上将’, ‘专门’, ‘乘客’, ‘仪式’, ‘体验’]…)</li>
<li>使用BOW模型向量化   corpus [[(0, 1), (1, 1), (2, 2), (3, 1),。。</li>
<li>对每个词，根据tf-idf进行加权，得到加权后的向量表示</li>
</ol>
<p>根据数据集获得模型</p>
<ol>
<li>得到数据集的主题-词分布  model (得到每个词的向量）（文档转列表 再转集合去重，再转列表）{‘白血病’: [(0, 0.1273009), (1, 0.6181468), (2, 0.12732704), (3, 0.12722531)], ‘婴儿’: [。。。</li>
<li>求文档的分布:词》向量》tf/idf加权》同第4步得到文档的分布向量 [(0, 0.033984687), (1, 0.033736005), (2, 0.8978361), (3, 0.03444325)]</li>
<li>计算余弦距离得到结果</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><p>为什么要用浅层语义分析？</p>
<p>我觉着一方面是考虑文本的语义信息。还有就是用词袋模型所表示的单词-文本矩阵一方面存在数据稀疏的问题，另一方面就是词本身一词多义和多词一义现象在进行文本相似度计算的时候未必能够准确的表达两个文本的语义相似度。</p>
</li>
<li><p>潜在语义分析算法</p>
<ol>
<li>矩阵奇异值分解算法</li>
<li>非负矩阵分解算法</li>
</ol>
</li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://www.cnblogs.com/jpcflyer/p/11180263.html" target="_blank" rel="noopener">机器学习经典算法之PageRank</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/41091116" target="_blank" rel="noopener">通俗易懂理解——TF-IDF与TextRank</a></li>
</ol>
]]></content>
      <categories>
        <category>技术/自然语言处理</category>
      </categories>
      <tags>
        <tag>nlp</tag>
        <tag>key word extraction</tag>
      </tags>
  </entry>
  <entry>
    <title>bert系列</title>
    <url>/2020/04/13/bert%E7%B3%BB%E5%88%97/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="BERT-及其后续模型"><a href="#BERT-及其后续模型" class="headerlink" title="BERT 及其后续模型"></a>BERT 及其后续模型</h2><p>了解这些后续的模型，方便在后续的研究和应用中来更好的选择模型。</p>
<h3 id="BERT"><a href="#BERT" class="headerlink" title="BERT"></a>BERT</h3><p>BERT模型的主要创新点都在pre-train方法上，即用了Masked LM和Next Sentence Prediction两种方法分别捕捉词语和句子级别的representation。</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert.jpg" alt="avatar"></p>
<p>对比OpenAI GPT(Generative pre-trained transformer)，BERT是双向的Transformer block连接；就像单向rnn和双向rnn的区别，直觉上来讲效果会好一些。</p>
<p>对比ELMo，虽然都是“双向”，但目标函数其实是不同的。ELMo是分别以 $P(w_i|w_1,\cdots,w_{i-1})$ 和$P(w_i|w_{i+1},\cdots,w_n)$作为目标函数，独立训练处两个representation然后拼接，而BERT则是以$P(w_i|w_1,\cdots,w_{i-1},w_{i+1}\cdots,w_n)$  作为目标函数训练LM。</p>
<a id="more"></a>
<h4 id="Task-1-MLM"><a href="#Task-1-MLM" class="headerlink" title="Task 1: MLM"></a>Task 1: MLM</h4><p>由于BERT需要通过上下文信息，来预测中心词的信息，同时又不希望模型提前看见中心词的信息，因此提出了一种 Masked Language Model 的预训练方式，即随机从输入预料上 mask 掉一些单词，然后通过的上下文预测该单词，类似于一个完形填空任务。</p>
<p>在预训练任务中，15%的 Word Piece 会被mask，这15%的 Word Piece 中，80%的时候会直接替换为 [Mask] ，10%的时候将其替换为其它任意单词，10%的时候会保留原始Token</p>
<ul>
<li>没有100%mask的原因<ul>
<li>如果句子中的某个Token100%都会被mask掉，那么在fine-tuning的时候模型就会有一些没有见过的单词</li>
</ul>
</li>
<li>加入10%随机token的原因<ul>
<li>Transformer要保持对每个输入token的分布式表征，否则模型就会记住这个[mask]是token ’hairy‘</li>
<li>另外编码器不知道哪些词需要预测的，哪些词是错误的，因此被迫需要学习每一个token的表示向量</li>
</ul>
</li>
<li>另外，每个batchsize只有15%的单词被mask的原因，是因为性能开销的问题，双向编码器比单项编码器训练要更慢</li>
</ul>
<h4 id="Task-2-NSP"><a href="#Task-2-NSP" class="headerlink" title="Task 2: NSP"></a>Task 2: NSP</h4><p>仅仅一个MLM任务是不足以让 BERT 解决阅读理解等句子关系判断任务的，因此添加了额外的一个预训练任务，即 Next Sequence Prediction。</p>
<p>具体任务即为一个句子关系判断任务，即判断句子B是否是句子A的下文，如果是的话输出’IsNext‘，否则输出’NotNext‘。</p>
<p>训练数据的生成方式是从平行语料中随机抽取的连续两句话，其中50%保留抽取的两句话，它们符合IsNext关系，另外50%的第二句话是随机从预料中提取的，它们的关系是NotNext的。这个关系保存在图4中的[CLS]符号中.</p>
<h4 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert_input.jpg" alt="avatar"></p>
<ul>
<li>Token Embeddings：即传统的词向量层，每个输入样本的首字符需要设置为[CLS]，可以用于之后的分类任务，若有两个不同的句子，需要用[SEP]分隔，且最后一个字符需要用[SEP]表示终止</li>
<li>Segment Embeddings：为[0,1]序列，用来在NSP任务中区别两个句子，便于做句子关系判断任务</li>
<li>Position Embeddings：与Transformer中的位置向量不同，BERT中的位置向量是直接训练出来的</li>
</ul>
<h4 id="Fine-tunninng"><a href="#Fine-tunninng" class="headerlink" title="Fine-tunninng"></a>Fine-tunninng</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert_finetune.jpg" alt="avatar"></p>
<p>对于不同的下游任务，我们仅需要对BERT不同位置的输出进行处理即可，或者直接将BERT不同位置的输出直接输入到下游模型当中。具体的如下所示：</p>
<ul>
<li>对于情感分析等单句分类任务，可以直接输入单个句子（不需要[SEP]分隔双句），将[CLS]的输出直接输入到分类器进行分类</li>
<li>对于句子对任务（句子关系判断任务），需要用[SEP]分隔两个句子输入到模型中，然后同样仅须将[CLS]的输出送到分类器进行分类</li>
<li>对于问答任务，将问题与答案拼接输入到BERT模型中，然后将答案位置的输出向量进行二分类并在句子方向上进行softmax（只需预测开始和结束位置即可）</li>
<li>对于命名实体识别任务，对每个位置的输出进行分类即可，如果将每个位置的输出作为特征输入到CRF将取得更好的效果。</li>
</ul>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li>考虑双向信息（上下文信息）</li>
<li>不用考虑很长的时序问题（梯度弥散，梯度爆炸）：long-term dependency</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>BERT的预训练任务MLM使得能够借助上下文对序列进行编码，但同时也使得其预训练过程与中的数据与微调的数据不匹配，难以适应生成式任务(训练数据缺乏mask)</li>
<li>缺乏生成能力</li>
<li>另外，BERT没有考虑预测[MASK]之间的相关性，是对语言模型联合概率的有偏估计。（朴素贝叶斯，naive）</li>
<li>由于最大输入长度的限制，适合句子和段落级别的任务，不适用于文档级别的任务（如长文本分类）</li>
<li>适合处理自然语义理解类任务(NLU)，而不适合自然语言生成类任务(NLG)</li>
</ul>
<h4 id="torch使用"><a href="#torch使用" class="headerlink" title="torch使用"></a>torch使用</h4><ol>
<li>导入相关库</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> transformers <span class="keyword">as</span> ppb <span class="comment"># pytorch transformers</span></span><br></pre></td></tr></table></figure>
<ol>
<li>导入预训练好的 DistilBERT 模型与分词器</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">model_class, tokenizer_class, pretrained_weights = (ppb.DistilBertModel, ppb.DistilBertTokenizer, <span class="string">'distilbert-base-uncased'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Want BERT instead of distilBERT? Uncomment the following line:</span></span><br><span class="line"><span class="comment">#model_class, tokenizer_class, pretrained_weights = (ppb.BertModel, ppb.BertTokenizer, 'bert-base-uncased')# </span></span><br><span class="line"></span><br><span class="line">Load pretrained model/tokenizertokenizer = tokenizer_class.from_pretrained(pretrained_weights)</span><br><span class="line">model = model_class.from_pretrained(pretrained_weights)</span><br></pre></td></tr></table></figure>
<ol>
<li>tokenize：分词+[cls]+[sep]<br><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert_tokenize.png" alt="avatar"></li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tokenizer.encode(<span class="string">'a visually stunning rumination on love'</span>, add_special_tokens=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>padding</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">max_len = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tokenized.values:</span><br><span class="line"> <span class="keyword">if</span> len(i) &gt; max_len:</span><br><span class="line">     max_len = len(i)</span><br><span class="line">padded = np.array([i + [<span class="number">0</span>]*(max_len-len(i)) <span class="keyword">for</span> i <span class="keyword">in</span> tokenized.values])</span><br></pre></td></tr></table></figure>
<ol>
<li>masking</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">attention_mask = np.where(padded != <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>使用bert进行编码</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    <span class="comment"># last_hidden_states = [batch_size, max_sentence_len, 768]</span></span><br><span class="line">    last_hidden_states = model(input_ids, attention_mask=attention_mask)</span><br></pre></td></tr></table></figure>
<p><a href="http://fancyerii.github.io/2019/03/09/bert-codes/#dataprocessor" target="_blank" rel="noopener">bert代码阅读</a></p>
<hr>
<p>谷歌对BERT进行了改版，下面将对改版后的bert进行学习，对比改版前后主要的相似点和不同点，以便可以选择在研究或应用中使用哪一种。提出的几种方法改进BERT的预测指标或计算速度，但是始终达不到两者兼顾。<strong>XLNet和RoBERTa改善了性能，而DistilBERT提高了推理速度</strong>。</p>
<h3 id="BERT-WWM"><a href="#BERT-WWM" class="headerlink" title="BERT-WWM"></a><strong>BERT-WWM</strong></h3><p><a href>论文</a></p>
<h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>wwm 即 Whole Word Masking（对全词进行Mask）。相比于bert的改进是用Mask标签替换一个完整的词而不是字，中文和英文不同，英文最小的token是一个单词，而中文中最小的token却是字，词是由一个或多个字组成，且每个词之间没有明显的分割，包含更多信息的是词，对全词mask就是对整个词都通过mask进行掩码。<br><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/bert_wwm_exam.png" alt="avatar"></p>
<h4 id="Bert-wwm-ext"><a href="#Bert-wwm-ext" class="headerlink" title="Bert-wwm-ext"></a><strong>Bert-wwm-ext</strong></h4><p>它是BERT-wwm的一个升级版，相比于BERT-wwm的改进是增加了训练数据集同时也增加了训练步数。<br>BERT-wwm-ext主要是有两点改进：<br>1）预训练数据集做了增加，达到5.4B；<br>2）训练步数增大，训练第一阶段1M步，训练第二阶段400K步。</p>
<p><a href="https://github.com/ymcui/Chinese-BERT-wwm" target="_blank" rel="noopener">模型下载</a></p>
<h3 id="XLNet"><a href="#XLNet" class="headerlink" title="XLNet"></a>XLNet</h3><p>XLNet作为bert的升级模型，主要在以下三个方面进行了优化:</p>
<ul>
<li>采用AR模型替代AE模型，解决mask带来的负面影响</li>
<li>双流注意力机制</li>
<li>引入transformer-xl</li>
</ul>
<h4 id="AR与AE语言模型"><a href="#AR与AE语言模型" class="headerlink" title="AR与AE语言模型"></a>AR与AE语言模型</h4><p>目前主流的nlp预训练模型包括两类 Auto Regressive (<strong>AR</strong>) Language Model 与Auto Encoding (AE) Language Model。</p>
<h5 id="AR模型"><a href="#AR模型" class="headerlink" title="AR模型"></a>AR模型</h5><p>AR模型的主要任务在于评估语料的概率分布，例如，给定一个序列 $X=(x_1, \cdots ,x_T)$ ，AR模型就是在计算其极大似然估计$p(X)=\prod_{t=1}^Tp(x_t∣x_{<t})$即已知$x_t$之前的序列，预测$x_t$ 的值，当然也可以反着来$p(x)="\prod_{t=1}^Tp(x_t∣x_{">t})$即已知$x_t$之后的序列，预测$x_t$的值。AR模型一个很明显的缺点就是：模型是单向的，我们更希望的是根据上下文来预测目标，而不单是上文或者下文，之前open AI提出的GPT就是采用的AR模式，包括GPT2.0也是该模式。</t})$即已知$x_t$之前的序列，预测$x_t$></p>
<p>优点：</p>
<ol>
<li>具备生成能力</li>
<li>考虑了相关性</li>
<li>无监督</li>
<li>严格的数学表达</li>
</ol>
<p>缺点：</p>
<ol>
<li>单向的</li>
<li>（难考虑 long term dependency）</li>
</ol>
<h5 id="AE模型"><a href="#AE模型" class="headerlink" title="AE模型"></a>AE模型</h5><p>AE模型采用的就是以上下文的方式，最典型的成功案例就是bert。简单回顾下bert的预训练阶段，预训练包括了两个任务，Masked Language Model与Next Sentence Prediction，Next Sentence Prediction即判断两个序列的推断关系，Masked Language Model采用了一个标志位[MASK]来随机替换一些词，再用[MASK]的上下文来预测[MASK]的真实值，bert的最大问题也是处在这个MASK的点，因为在微调阶段，没有MASK这就导致预训练和微调数据的不统一，从而引入了一些人为误差。</p>
<p>在xlnet中，采用了<strong>AR模型</strong>，但是怎么解决这个上下文的问题呢？</p>
<h4 id="排列语言模型-为了考虑上下文信息"><a href="#排列语言模型-为了考虑上下文信息" class="headerlink" title="排列语言模型(为了考虑上下文信息)"></a>排列语言模型(为了考虑上下文信息)</h4><p>为了解决上文提到的问题，作者提出了排列语言模型，该模型不再对传统的AR模型的序列的值按顺序进行建模，而是最大化所有可能的序列的因式分解顺序的期望对数似然，这句话可能有点不好理解，举个栗子，假如我们有一个序列$[1,2,3,4]$，如果我们的预测目标是3，对于传统的AR模型来说，结果是$p(3)=\prod^3_{t=1}p(3|x_{&lt;t})$，如果采用本文的方法，先对该序列进行因式分解，最终会有24种排列方式，下图是其中可能的四种情况，对于第一种情况因为3的左边没有其他的值，所以该情况无需做对应的计算，第二种情况3的左边还包括了2与4，所以得到的结果是$p(3)=p(3|2)p(3|2,4)$，后续的情况类似，这样处理过后不但保留了序列的上下文信息，也<strong>避免了采用mask标记位，巧妙的改进了bert与传统AR模型的缺点</strong>。<br><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/xlnet.png" alt="avatar"></p>
<h5 id="如何训练？"><a href="#如何训练？" class="headerlink" title="如何训练？"></a>如何训练？</h5><ol>
<li>假如句子长度为20，则会产生$20$!种排列，在这$20$!种排列中随机抽样，得到训练样本。</li>
<li>为获得丰富的上下文语义信息，对抽取的样本最后的几个单词进行预测。</li>
</ol>
<h4 id="基于目标感知表征的双流自注意力-为了解决位置信息"><a href="#基于目标感知表征的双流自注意力-为了解决位置信息" class="headerlink" title="基于目标感知表征的双流自注意力(为了解决位置信息)"></a>基于目标感知表征的<strong>双流自注意力</strong>(为了解决位置信息)</h4><p>虽然排列语言模型能满足目前的目标，但是对于普通的transformer结构来说是存在一定的问题的，为什么这么说呢，假设我们要求这样的一个对数似然，$p_\theta(X_{z_t}|x_{z_{&lt;t}})$，如果采用标准的softmax的话，那么</p>
<script type="math/tex; mode=display">
p_{\theta}\left(X_{z_t} | x_{z_{<t}}\right)=\frac{\exp \left(e(x)^{T} h_{\theta}\left(x_{z_{<t}}\right)\right)}{\sum_{x^{\prime}} \exp \left(e\left(x^{\prime}\right)^{T} h_{\theta}\left(x_{z_{<t}}\right)\right)}</script><p>其中$h_\theta (x_{z_{&lt;t}})$表示的是添加了mask后的transformer的输出值，可以发现$h_\theta (x_{z_{&lt;t}})$并不依赖于其要预测的内容的位置信息，因为无论预测目标的位置在哪里，因式分解后得到的所有情况都是一样的，并且transformer的权重对于不同的情况是一样的，因此无论目标位置怎么变都能得到相同的分布结果，如下图所示，假如我们的序列index表示为[1,2,3]，对于目标2与3来说，其因式分解后的结果是一样的，那么经过transformer之后得到的结果肯定也是一样的。<br><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/123.png" alt="avatar"></p>
<p>这就导致模型没法得到正确的表述，为了解决这个问题，论文中提出来新的分布计算方法，来实现目标位置感知</p>
<script type="math/tex; mode=display">
p_{\theta}\left(X_{zt}=x | x_{z<t}\right)=\frac{\exp \left(e(x)^{T} g_{\theta}\left(x_{z<t}, z_{t}\right)\right)}{\sum_{x^{\prime}} \exp \left(e\left(x^{\prime}\right)^{T} g_{\theta}\left(x_{z<t}, z_{t}\right)\right)}</script><p>其中$g_{\theta}\left(x_{z_{&lt;t}}, z_{t}\right)$是新的表示形式，并且把位置信息$z_t$作为了其输入。<br>这个新的表示形式，论文把该方法称为Two-Stream Self-Attention，双流自注意力，该机制需要解决了两个问题:</p>
<ul>
<li>如果目标是预测$x_{z_t}$，$g_\theta (x_{z&lt;t},z_t)$那么只能有其位置信息$z_t$ 而不能包含内容信息$x_{z_t}$</li>
<li>如果目标是预测其他tokens即$x_{z_j}$那么应该包含$x_{z_t}$的内容信息这样才有完整的上下文信息</li>
</ul>
<p>传统的transformer并不满足这样的需求，因此作者采用了两种表述来代替原来的表述，这也是为什么称为<strong>双流</strong>的原因:</p>
<ul>
<li><p>content representation内容表述，即$h_\theta (x_{z_{\leq t}})$下文用$h_{z_t}$表示，该表述和传统的transformer一样，同时编码了上下文和$x_{z_t}$自身</p>
<script type="math/tex; mode=display">
h_{z_{t}}^{(m)}=\text {Attention}\left(Q=h_{z_{t}}^{(m-1)}, K V=h_{z \leq t}^{(m-1)} ; \theta\right)</script><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/content_representation.png" alt="avatar"></p>
</li>
<li><p>query representation查询表述，即$g_\theta (x_{z_{&lt;t}})$，下文用$g_{z_t}$ 表示，该表述包含上下文的内容信息$x_{z_{&lt;t}}$ 和目标的位置信息$z_t$，但是不包括目标的内容信息$x_{z_{t}}$ ，从图中可以看到，K与V的计算并没有包括Q，自然也就无法获取到目标的内容信息，但是目标的位置信息在计算Q的时候保留了下来，</p>
<script type="math/tex; mode=display">
g_{z_{t}}^{(m)}=\text {Attention}\left(Q=g_{z_{t}}^{(m-1)}, K V=h_{z<t}^{(m-1)} ; \theta\right)</script></li>
</ul>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/query_representation.png" alt="avatar"></p>
<p>总的计算过程，首先，第一层的查询流是随机初始化了一个向量即$g_i^{0}=w$，内容流是采用的词向量即$h_i^{0}=e(x_i)$，self-attention的计算过程中两个流的网络权重是共享的，最后在微调阶段，只需要简单的把query stream移除，只采用content stream即可。</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/two_stream.png" alt="avatar"></p>
<h4 id="引入transformer-XL"><a href="#引入transformer-XL" class="headerlink" title="引入transformer XL"></a>引入transformer XL</h4><p>作者还将transformer-xl的两个最重要的技术点应用了进来，即片段循环机制与相对位置编码。</p>
<h5 id="片段循环机制"><a href="#片段循环机制" class="headerlink" title="片段循环机制"></a>片段循环机制</h5><p>ransformer-xl的提出主要是为了解决超长序列的依赖问题，对于普通的transformer由于有一个最长序列的超参数控制其长度（如果不对文本控制，则会极大消耗内存，因为在计算score矩阵的时候，会开辟$n^2$大小的矩阵，对于一篇文本，长度为$10^5$,则需要开辟$10^5 * 10^5 = 10^10$大小的score矩阵，极其消耗内存。），对于特别长的序列就会导致丢失一些信息，transformer-xl就能解决这个问题。我们看个例子，假设我们有一个长度为1000的序列，如果我们设置transformer的最大序列长度是100，那么这个1000长度的序列需要计算十次，并且每一次的计算都没法考虑到每一个段之间的关系，如果采用transformer-xl，首先取第一个段进行计算，然后把得到的结果的隐藏层的值进行缓存，第二个段计算的过程中，把缓存的值拼接起来再进行计算（RNN）。该机制不但能保留长依赖关系还能加快训练，因为每一个前置片段都保留了下来，不需要再重新计算，在transformer-xl的论文中，经过试验其速度比transformer快了1800倍。<br>在xlnet中引入片段循环机制其实也很简单，只需要在计算KV的时候做简单的修改，其中$\tilde{h}^{m-1}$表示的是缓存值。</p>
<script type="math/tex; mode=display">
h_{z_{t}}^{(m)}=\text {Attention}\left(Q=h_{z_{t}}^{(m-1)}, K V=\left[\tilde{h}^{(m-1)}, h_{z \leq t}^{(m-1)}\right] ; \theta\right)</script><h5 id="相对位置编码"><a href="#相对位置编码" class="headerlink" title="相对位置编码"></a>相对位置编码</h5><p>bert的position embedding采用的是绝对位置编码，但是绝对位置编码在transformer-xl中有一个致命的问题，因为没法区分到底是哪一个片段里的，这就导致了一些位置信息的损失，这里被替换为了transformer-xl中的相对位置编码。假设给定一对位置$i$与$j$，如果$i$与$j$是同一个片段里的那么我们令这个片段编码$s_{ij}=s_+$，如果不在一个片段里则令这个片段编码为$s_{ij}=s_-$，这个值是在训练的过程中得到的，也是用来计算attention weight时候用到的，在传统的transformer中$\text {attention weight}= softmax(\frac{Q⋅K}{d}V)$，在引入相对位置编码后，首先要计算出$a_{ij}=(q_i+b)^T_{s_{sj}}$，其中$b$也是一个需要训练得到的偏执量，最后把得到的$a_ij$与传统的transformer的weight相加从而得到最终的attention weight。</p>
<p><a href="https://github.com/huggingface/transformers/blob/master/src/transformers/modeling_xlnet.py" target="_blank" rel="noopener">源码</a></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>在实验中发现，xlnet更多还是在长文本的阅读理解类的任务上提升更明显一些，这也很符合上文中介绍的这些优化点，在实际工业场景中，机器翻译、本文摘要类的任务应该会有更好的效果，当然在其他的文本分类、自然语言推理等任务上xlnet也有一定的效果提升。nlp领域的模型目前已经完全采用了pretrain+fine tuning的模式，GPT2.0的单向模式在增大训练语料的情况下效果就已经超越了bert，可想而知该领域的研究还有很大的上升空间</p>
<h3 id="RoBERTa"><a href="#RoBERTa" class="headerlink" title="RoBERTa"></a>RoBERTa</h3><h4 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h4><p>在XLNet全面超越Bert后没多久，Facebook提出了RoBERTa（a Robustly Optimized BERT Pretraining Approach）。再度在多个任务上达到SOTA。</p>
<p>它在模型层面没有改变Google的Bert，<strong>改变的只是预训练的方法</strong>。</p>
<h4 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h4><p>Yinhan Liu等人[6]认为超参数的选择对最终结果有重大影响，为此他们提出了BERT预训练的重复研究，其中包括对超参数调整和训练集大小的影响的仔细评估。<strong>最终，他们发现了BERT的训练不足</strong>，并提出了一种改进的模型来训练BERT模型。</p>
<h4 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h4><h5 id="静态Masking-vs-动态Masking"><a href="#静态Masking-vs-动态Masking" class="headerlink" title="静态Masking vs 动态Masking"></a>静态Masking vs 动态Masking</h5><p>原来Bert对每一个序列随机选择15%的Tokens替换成[MASK]，为了消除与下游任务的不匹配，还对这15%的Tokens进行（1）80%的概率替换成[MASK]；（2）10%的概率不变；（3）10%的概率替换成其他词。但整个训练过程，这15%的Tokens一旦被选择就不再改变，也就是说从一开始随机选择了这15%的Tokens，之后的N个epoch里都不再改变了。这就叫做静态Masking。</p>
<p>而RoBERTa一开始把预训练的数据复制10份，每一份都随机选择15%的Tokens进行Masking，也就是说，同样的一句话有10种不同的mask方式。然后每份数据都训练N/10个epoch。这就相当于在这N个epoch的训练中，每个序列的被mask的tokens是会变化的。这就叫做动态Masking。作者在只将静态Masking改成动态Masking，其他参数不变的情况下做了实验，动态Masking确实能提高性能。</p>
<h5 id="with-NSP-vs-without-NSP"><a href="#with-NSP-vs-without-NSP" class="headerlink" title="with NSP vs without NSP"></a>with NSP vs without NSP</h5><p>原本的Bert为了捕捉句子之间的关系，使用了NSP任务进行预训练，就是输入一对句子A和B，判断这两个句子是否是连续的。在训练的数据中，50%的B是A的下一个句子，50%的B是随机抽取的。</p>
<p>而RoBERTa去除了NSP，而是每次输入连续的多个句子，直到最大长度512（可以跨文章）。这种训练方式叫做（FULL - SENTENCES），而原来的Bert每次只输入两个句子。实验表明在MNLI这种推断句子关系的任务上RoBERTa也能有更好性能。（？？？？）</p>
<h5 id="更大的mini-batch"><a href="#更大的mini-batch" class="headerlink" title="更大的mini-batch"></a>更大的mini-batch</h5><p>原本的BERTbase 的batch size是256，训练1M个steps。RoBERTa的batch size为8k。为什么要用更大的batch size呢？作者借鉴了在机器翻译中，用更大的batch size配合更大学习率能提升模型优化速率和模型性能的现象，并且也用实验证明了确实Bert还能用更大的batch size。</p>
<h5 id="更多的数据，更长的训练时间"><a href="#更多的数据，更长的训练时间" class="headerlink" title="更多的数据，更长的训练时间"></a>更多的数据，更长的训练时间</h5><p>借鉴XLNet用了比Bert多10倍的数据，RoBERTa也用了更多的数据。性能确实再次彪升。当然，也需要配合更长时间的训练。</p>
<h5 id="Byte-Pair-Encoding-BPE-字符编码"><a href="#Byte-Pair-Encoding-BPE-字符编码" class="headerlink" title="Byte-Pair Encoding (BPE)字符编码"></a>Byte-Pair Encoding (BPE)字符编码</h5><p>使用Sennrich[8]等人提出的Byte-Pair Encoding (BPE)字符编码，它是字符级和单词级表示之间的混合体，可以处理自然语言语料库中常见的大词汇，避免训练数据出现更多的“[UNK]”标志符号，从而影响预训练模型的性能。其中，“[UNK]”标记符表示当在BERT自带字典vocab.txt找不到某个字或者英文单词时，则用“[UNK]”表示。</p>
<h3 id="SpanBERT"><a href="#SpanBERT" class="headerlink" title="SpanBERT"></a>SpanBERT</h3><p><a href="https://arxiv.org/pdf/1907.10529.pdf" target="_blank" rel="noopener">论文</a></p>
<h4 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h4><p>在许多 NLP 任务中都涉及对多个文本分词间关系的推理。例如，在抽取式问答任务中，在回答问题“Which NFL team won Super Bown 50?”时，判断“Denver Broncos” 是否属于“NFL team”是非常重要的步骤。相比于在已知“Broncos”预测“Denver”的情况，直接预测“Denver Broncos”难度更大，这意味着这类分词对自监督任务提出了更多的挑战。</p>
<p>SpanBert对 BERT 模型进行了如下改进：</p>
<ol>
<li>没有segment embedding，只有一个长的句子，类似RoBERTa。</li>
<li><strong>Span Masking</strong>:对随机的邻接分词（span）而非随机的单个词语（token）添加mask；</li>
<li>MLM+SBO:通过使用分词边界的表示来预测被添加mask的分词的内容，不再依赖分词内单个 token 的表示。</li>
</ol>
<p>SpanBERT 能够对分词进行更好地表示和预测。该模型和 BERT 在mask机制和训练目标上存在差别。首先，SpanBERT 不再对随机的单个 token 添加mask，而是对随机对邻接分词添加mask。其次，SpanBert提出了一个新的训练目标 span-boundary objective (SBO) 进行模型训练。通过对分词添加mask，作者能够使模型依据其所在语境预测整个分词。另外，SBO 能使模型在边界词中存储其分词级别的信息，使得模型的调优更佳容易。</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/spanbert.png" alt="avatar"></p>
<p>模型使用边界词 was和 to来预测分词中的每个单词。</p>
<p>为了搭建 SpanBERT ，作者首先构建了一个 BERT 模型的并进行了微调，SpanBERT的表现优于原始 BERT 模型。在搭建baseline的时候，作者发现对单个部分进行预训练的效果，比使用 next sentence prediction (NSP) 目标对两个长度为一半的部分进行训练的效果更优，在下游任务中表现尤其明显。因此，作者在经过调优的 BERT 模型的顶端对模型进行了改进。</p>
<h4 id="Span-Masking"><a href="#Span-Masking" class="headerlink" title="Span Masking(????)"></a>Span Masking(????)</h4><p>对于每一个单词序列 $X = (x_1, \ldots , x_n )$，作者通过迭代地采样文本的分词选择单词，直到达到掩膜要求的大小（例如 X 的 15%），并形成 X 的子集 Y。在每次迭代中，作者首先从几何分布 $l \sim Geo(p)$中采样得到分词的长度，该几何分布是偏态分布，偏向于较短的分词。之后，作者随机（均匀地）选择分词的起点。</p>
<p>根据几何分布，先随机选择一段（span）的长度，之后再根据均匀分布随机选择这一段的起始位置，最后按照长度遮盖。作者设定几何分布取 p=0.2，并裁剪最大长度只能是 10（不应当是长度 10 以上修剪，而应当为丢弃），利用此方案获得平均采样长度分布。因此分词的平均长度为 3.8 。作者还测量了词语（word）中的分词程度，使得添加掩膜的分词更长。下图展示了分词掩膜长度的分布情况。</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/spanbert_fenci.png" alt="avatar"></p>
<p>和在 BERT 中一样，作者将 Y 的规模设定为 X 的15%，其中 80% 使用 [MASK] 进行替换，10% 使用随机单词替换，10%保持不变。与之不同的是，作者是在分词级别进行的这一替换，而非将每个单词单独替换。</p>
<h4 id="分词边界目标-SBO"><a href="#分词边界目标-SBO" class="headerlink" title="分词边界目标(SBO)???"></a>分词边界目标(SBO)???</h4><p>分词选择模型一般使用其边界词创建一个固定长度的分词表示。为了于该模型相适应，作者希望结尾分词的表示的总和与中间分词的内容尽量相同。为此，作者引入了 SBO ，其仅使用观测到的边界词来预测带掩膜的分词的内容。</p>
<p>具体做法是，在训练时取 Span 前后边界的两个词，值得指出，这两个词不在 Span 内，然后<strong>用这两个词向量加上 Span 中被遮盖掉词的位置向量，来预测原词</strong>。</p>
<script type="math/tex; mode=display">
\mathbf{y}_{i}=f\left(\mathbf{x}_{s-1}, \mathbf{x}_{e+1}, \mathbf{p}_{i}\right)</script><p>详细做法是将词向量和位置向量拼接起来，作者使用一个两层的前馈神经网络作为表示函数，该网络使用 GeLu 激活函数，并使用层正则化：</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathbf{h} &=\text { LayerNorm }\left(\operatorname{GeLU}\left(W_{1} \cdot\left[\mathbf{x}_{s-1} ; \mathbf{x}_{e+1} ; \mathbf{p}_{i}\right]\right)\right) \\
f(\cdot) &=\text { LayerNorm }\left(\operatorname{GeLU}\left(W_{2} \cdot \mathbf{h}\right)\right)
\end{aligned}</script><p>作者使用向量表示$y_i$来预测$x_i$，并和 MLM 一样使用交叉熵作为损失函数，就是 SBO 目标的损失，之后将这个损失和 BERT 的 <strong>Mased Language Model （MLM）</strong>的损失加起来，一起用于训练模型。</p>
<script type="math/tex; mode=display">
\mathcal{L}(\text { football })=\mathcal{L}_{\mathrm{MLM}}\left(\mathbf{x}_{7}\right)+\mathcal{L}_{\mathrm{SBO}}\left(\mathbf{x}_{4}, \mathbf{x}_{9}, \mathbf{p}_{7}\right)</script><h4 id="单序列训练"><a href="#单序列训练" class="headerlink" title="单序列训练"></a>单序列训练</h4><p>SpanBERT 没用 Next Sentence Prediction (NSP) 任务，而是直接用 Single-Sequence Training，也就是不加入 NSP 任务来判断是否两句是上下句，直接用一句来训练，片段长度最多为512个单词。</p>
<h4 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h4><ol>
<li>训练时用了 <strong>Dynamic Masking</strong> 而不是像 BERT 在预处理时做 静态Mask。</li>
<li><strong>取消 BERT 中随机采样短句的策略</strong></li>
<li>对Adam优化器中的一些参数做了改变。</li>
</ol>
<h5 id="mask机制"><a href="#mask机制" class="headerlink" title="mask机制"></a>mask机制</h5><p>作者在子单词、完整词语、命名实体、名词短语和随机分词方面进行了比较：发现使用随机分词掩膜机制效果更优。</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/spanbert_token.png" alt="avatar"></p>
<h5 id="辅助目标"><a href="#辅助目标" class="headerlink" title="辅助目标"></a>辅助目标</h5><p>使用 SBO 替换 NSP 并使用单序列进行预测的效果更优。</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/spanbert_a_o.png" alt="avatar"></p>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><p>SpanBERT是基于分词的预训练模型，在多个评测任务中的得分都超越了 BERT 且在分词选择类任务中的提升尤其明显。</p>
<h3 id="ERNIE"><a href="#ERNIE" class="headerlink" title="ERNIE"></a>ERNIE</h3><p><a href="https://arxiv.org/pdf/1905.07129" target="_blank" rel="noopener">论文</a></p>
<h4 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h4><p>无论是Elmo、GPT, 还是能力更强的 BERT 模型，其建模对象主要聚焦在原始语言信号上，较少利用语义知识单元建模。这个问题在中文方面尤为明显，例如，BERT 在处理中文语言时，通过预测汉字进行建模，模型很难学出更大语义单元的完整语义表示。例如，对于乒 [mask] 球，清明上 [mask] 图，[mask] 颜六色这些词，BERT 模型通过字的搭配，很容易推测出掩码的字信息，但没有显式地对语义概念单元 (如乒乓球、清明上河图) 以及其对应的语义关系进行建模。如果能够让模型学习到海量文本中蕴含的潜在知识，势必会进一步提升各个 NLP 任务效果。</p>
<p>ERNIE 模型通过建模海量数据中的实体概念等先验语义知识，学习真实世界的语义关系。具体来说，ERNIE 模型通过对词、实体等语义单元的掩码，使得模型学习完整概念的语义表示。相较于 BERT 学习原始语言信号，ERNIE 直接对先验语义知识单元进行建模，增强了模型语义表示能力。</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/ernie.png" alt="avatar"></p>
<p>在 BERT 模型中，通过『哈』与『滨』的局部共现，即可判断出『尔』字，模型没有学习与『哈尔滨』相关的知识。而 ERNIE 通过学习词与实体的表达，使模型能够建模出『哈尔滨』与『黑龙江』的关系，学到『哈尔滨』是『黑龙江』的省会以及『哈尔滨』是个冰雪城市。</p>
<h4 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/ernie_ar.png" alt="avatar"></p>
<p>模型上主要的改进是在bert的后段加入了实体向量和经过bert编码后的向量拼接，另外在输出时多加了实体自编码的任务，从而帮助模型注入实体知识信息。</p>
<h5 id="T-Encoder"><a href="#T-Encoder" class="headerlink" title="T-Encoder"></a>T-Encoder</h5><p>这部分就是纯粹的bert结构，在该部分模型中主要负责对输入句子（token embedding, segment embedding和positional embedding）进行编码.</p>
<h5 id="K-Encoder"><a href="#K-Encoder" class="headerlink" title="K-Encoder"></a>K-Encoder</h5><p>引入实体信息，使用了TransE训练实体向量，再通过多头Attention进行编码，然后通过实体对齐技术，将实体向量加入到对应实体的第一个token编码后的向量上。（例如姚明是一个实体，在输入时会被分割成姚、明，最后在这部分引入的姚明这个实体的向量会被加入到“姚”这个字经过bert之后的向量上去）</p>
<script type="math/tex; mode=display">
\begin{aligned}
\left\{\tilde{\boldsymbol{w}}_{1}^{(i)}, \ldots, \tilde{\boldsymbol{w}}_{n}^{(i)}\right\} &=\mathrm{MH}-\mathrm{ATT}\left(\left\{\boldsymbol{w}_{1}^{(i-1)}, \ldots, \boldsymbol{w}_{n}^{(i-1)}\right\}\right) \\
\left\{\tilde{\boldsymbol{e}}_{1}^{(i)}, \ldots, \tilde{\boldsymbol{e}}_{m}^{(i)}\right\} &=\mathrm{MH}-\mathrm{ATT}\left(\left\{\boldsymbol{e}_{1}^{(i-1)}, \ldots, \boldsymbol{e}_{m}^{(i-1)}\right\}\right)
\end{aligned}</script><p>由于直接拼接后向量维度会与其他未拼接的向量维度不同，所以加入information fusion layer，另外考虑到后面的实体自编码任务，所以这里在融合信息之后，有实体向量加入的部分需要另外多输出一个实体向量。</p>
<p>加入实体信息之后的融合输出过程：</p>
<script type="math/tex; mode=display">
\begin{aligned}
\boldsymbol{h}_{j} &=\sigma\left(\tilde{\boldsymbol{W}}_{t}^{(i)} \tilde{\boldsymbol{w}}_{j}^{(i)}+\tilde{\boldsymbol{W}}_{e}^{(i)} \tilde{\boldsymbol{e}}_{k}^{(i)}+\tilde{\boldsymbol{b}}^{(i)}\right) \\
\boldsymbol{w}_{j}^{(i)} &=\sigma\left(\boldsymbol{W}_{t}^{(i)} \boldsymbol{h}_{j}+\boldsymbol{b}_{t}^{(i)}\right) \\
\boldsymbol{e}_{k}^{(i)} &=\sigma\left(\boldsymbol{W}_{e}^{(i)} \boldsymbol{h}_{j}+\boldsymbol{b}_{e}^{(i)}\right)
\end{aligned}</script><p>未加入实体信息之后的融合输出过程：</p>
<script type="math/tex; mode=display">
\begin{aligned}
\boldsymbol{h}_{j} &=\sigma\left(\tilde{\boldsymbol{W}}_{t}^{(i)} \tilde{\boldsymbol{w}}_{j}^{(i)}+\tilde{\boldsymbol{b}}^{(i)}\right) \\
\boldsymbol{w}_{j}^{(i)} &=\sigma\left(\boldsymbol{W}_{t}^{(i)} \boldsymbol{h}_{j}+\boldsymbol{b}_{t}^{(i)}\right)
\end{aligned}</script><h5 id="实体自编码"><a href="#实体自编码" class="headerlink" title="实体自编码????"></a>实体自编码????</h5><p>为了更好地使用实体信息，作者在这里多加入了一个预训练任务 entity auto-encoder(dEA)。</p>
<script type="math/tex; mode=display">
p\left(e_{j} | w_{i}\right)=\frac{\exp \left(\operatorname{linear}\left(\boldsymbol{w}_{i}^{o}\right) \cdot \boldsymbol{e}_{j}\right)}{\sum_{k=1}^{m} \exp \left(\operatorname{linear}\left(\boldsymbol{w}_{i}^{o}\right) \cdot \boldsymbol{e}_{k}\right)}</script><p>该预训练任务和bert相似，按以下方式进行训练：</p>
<ol>
<li>15% 的情况下：用 [MASK] 替换被选择的单词，例如，my dog is hairy → my dog is [MASK]</li>
<li>5% 的情况下：用一个随机单词替换被选择的单词，例如，my dog is hairy → my dog is apple</li>
<li>80% 的情况下：保持被选择的单词不变，例如，my dog is hairy → my dog is hairy</li>
</ol>
<h5 id="Extra-task"><a href="#Extra-task" class="headerlink" title="Extra-task"></a>Extra-task</h5><p>除了正常的任务之外，ERNIE引入了两个新任务Entity Typing和Relation Classification</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/ernie_extra_task.png" alt="avatar"></p>
<h5 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h5><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/ernie_experiment.png" alt="avatar"></p>
<p>ERNIE在通用任务其实相比bert优势不大，尽管文章提到了ERNIE更鲁棒以及GLUE的评估对ERNIE不是很友好，在增加复杂度的同时，并没有取得期待的效果。ERNIE提供了一种很好的实体信息引入思路，并且其新提出的预训练方法也给希望将bert这一模型引入关系抽取领域提供了很好的例子。</p>
<h3 id="MT-DNN（预训练-多任务）"><a href="#MT-DNN（预训练-多任务）" class="headerlink" title="MT-DNN（预训练+多任务）"></a>MT-DNN（预训练+多任务）</h3><p><a href="https://arxiv.org/pdf/1901.11504.pdf" target="_blank" rel="noopener">论文</a>,<a href="https://github.com/namisan/mt-dnn" target="_blank" rel="noopener">源码</a></p>
<h4 id="简介-4"><a href="#简介-4" class="headerlink" title="简介"></a>简介</h4><p>学习文本的向量空间表示，是许多自然语言理解(NLU)任务的基础。两种流行的方法是<strong>多任务学习</strong>和<strong>语言模型的预训练</strong>。MT-DNN通过提出一种新的多任务深度神经网络（MT-DNN）来综合两种方法的优点。</p>
<p><strong>预训练</strong>，如BERT、GPT等，就不多说了。</p>
<p><strong>多任务</strong>学习( MTL )的灵感来自于人的学习活动。在人类的学习活动中，人们经常应用从以前的任务中学到的知识来帮助学习新的任务。例如，在学习滑冰这件事情上，一个知道如何滑雪的人比什么都不知道的人容易。同样，<strong>联合学习多个(相关)</strong>任务也很有用，这样在一个任务中学习到的知识有益于其他任务。对于MTL（Multi-task Learning，多任务学习）来说，其优点有两个：1）弥补了有些任务的数据不足问题；2）有正则的作用，防止模型过拟合。</p>
<p><strong>两者结合</strong>（强强联手！）：MT-DNN认为，MTL和pretrain有很好的互补作用，那么是不是可以结合一下，发挥两者的作用。更具体的就是，先用BERT进行pretrain，然后用MTL进行finetune，这就形成了MT-DNN。可见，与BERT的不同在于finetune的过程，这里用MTL作为目标。</p>
<h4 id="模型-1"><a href="#模型-1" class="headerlink" title="模型"></a>模型</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/mtdnn.png" alt="avatar"></p>
<p>表征学习 MT-DNN 模型的架构。下面的网络层在所有任务中都共享，上面的两层是针对特定任务。输入$X$(一句话或句子对)首先表征为一个序列的嵌入向量，在$l_1$  中每个词对应一个向量。然后 Transformer 编码器捕捉每个单词的语境信息并在$l_2$中生成共享的语境嵌入向量。最后，针对每个任务，特定任务层生成特定任务的表征，而后是分类、相似性打分、关联排序等必需的操作。</p>
<h5 id="多任务"><a href="#多任务" class="headerlink" title="多任务"></a>多任务</h5><p>MT-DNN是结合了4种类型的NLU任务：单句分类、句子对分类、文本相似度打分和相关度排序。</p>
<ul>
<li>单句分类：CoLA任务是预测英语句子是否合乎语法，SST-2任务预测电影评论是正向还是负向。</li>
<li>文本相似度：这是一个回归任务。对于给定的句子对，模型计算二者之间的相似度。在GLUE中只有STS-B这个任务是处理文本相似度。</li>
<li>成对文本分类（文本蕴含）：对于给定的句子对，推理两个句子之间的关系。RET和MNLI是语言推理任务，推理句子之间是否存在蕴含关系、矛盾的关系或者中立关系。QQP和MRPC是预测句子是否语义等价。</li>
<li>相关性排序：给定一个问题和一系列候选答案，模型根据问题对所有候选答案进行排序。QNLI是斯坦福问答数据集的一个版本，任务是预测候选答案中是否包含对问题的正确答案。尽管这是一个二分类任务，但我们依旧把它当作排序任务，因为模型重排了候选答案，将正确答案排在更前。</li>
</ul>
<h6 id="单句分类"><a href="#单句分类" class="headerlink" title="单句分类"></a>单句分类</h6><p>用[CLS]的表征作为特征，设为$x$，则对于单句的分类任务，直接在后面接入一个分类层即可.</p>
<script type="math/tex; mode=display">
P_{r}(c | X)=\operatorname{softmax}\left(W^{T} \cdot x\right)</script><p>loss是交叉熵损失：</p>
<script type="math/tex; mode=display">
-\sum_{c} I(X, c) \log \left(P_{r}(c | X)\right)</script><h6 id="句子相似度"><a href="#句子相似度" class="headerlink" title="句子相似度"></a>句子相似度</h6><p>将两句话pack后送进去，得到的[CLS]的表征，可拿出来计算分数：</p>
<script type="math/tex; mode=display">
\operatorname{sim}\left(X_{1}, X_{2}\right)=\operatorname{sigmoid}\left(w^{T} \cdot x\right)</script><p>loss是MSE：</p>
<script type="math/tex; mode=display">
\left(y-\operatorname{Sim}\left(X_{1}, X_{2}\right)\right)^{2}</script><h6 id="句子对分类"><a href="#句子对分类" class="headerlink" title="句子对分类"></a>句子对分类</h6><p>对这个任务不熟悉。。。</p>
<h6 id="相关性排序"><a href="#相关性排序" class="headerlink" title="相关性排序"></a>相关性排序</h6><p>先计算两个句子之间的相似度，输入两个句子pack，采用[CLS]的输出作为表征。</p>
<script type="math/tex; mode=display">
\operatorname{Rel}(Q, A)=g\left(w^{T} \cdot x\right)</script><p>loss采用排序损失：</p>
<script type="math/tex; mode=display">
\begin{aligned}
&-\sum_{Q, A^{+}} P_{r}\left(A^{+} | Q\right) \\
P_{r}\left(A^{+} | Q\right) &=\frac{\exp \left(\gamma \operatorname{Rel}\left(Q, A^{+}\right)\right)}{\sum_{A^{\prime} \in A} \exp \left(\gamma \operatorname{Rel}\left(Q, A^{\prime}\right)\right)}
\end{aligned}</script><h5 id="训练过程"><a href="#训练过程" class="headerlink" title="训练过程"></a>训练过程</h5><p>MT-DNN 的训练程序包含两个阶段：预训练和多任务微调。</p>
<ol>
<li>预训练阶段遵循 BERT 模型的方式。lexicon encoder和Transformer encoder参数的学习是通过两个无监督预测任务：掩码语言建模(masked language modeling)和下一句预测(next sentence pre-<br>diction)。</li>
<li>在多任务微调阶段，使用基于minibatch的随机梯度下降（SGD）来学习模型参数（也就是，所有共享层和任务特定层的参数），算法流程如下图所示。每个epoch，选择一个mini-batch $b_t$(在9个GLUE任务中)，再对特定任务$k$进行模型参数的更新。这近似地优化所有多任务的和。</li>
</ol>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/mtdnn_al.png" alt="avatar"></p>
<h3 id="DistilBERT"><a href="#DistilBERT" class="headerlink" title="DistilBERT"></a>DistilBERT</h3><p><a href="https://arxiv.org/pdf/1910.01108" target="_blank" rel="noopener">论文</a></p>
<h4 id="动机-1"><a href="#动机-1" class="headerlink" title="动机"></a>动机</h4><p>预训练的语言模型正变得日益庞大，这些庞大的模型尽管能够带来准确率的提升，但是在这些预训练模型投入使用的过程中，往往需要对模型进行微调，而这需要大量的资源，而且模型投入使用的时候，由于计算量巨大，模型处理数据的时延过长。一种比较好的解决方案是对模型进行压缩。</p>
<h4 id="模型压缩的方法"><a href="#模型压缩的方法" class="headerlink" title="模型压缩的方法"></a>模型压缩的方法</h4><ol>
<li><p>量化</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/quantization.jpg" alt="avatar"></p>
</li>
</ol>
<p>量化方法意味着降低模型权重的精度。比如K-means 量化方法：对模型权重矩阵W进行分组，分成n簇，然后把权重矩阵里的值转化成$1,\cdots,n$的正数。通过这种方式把矩阵中的32位的float型转化成只有8位（或者1位，binarizing matrix）的整数。</p>
<h5 id="裁剪（Pruning）"><a href="#裁剪（Pruning）" class="headerlink" title="裁剪（Pruning）"></a>裁剪（Pruning）</h5><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/Pruning.png" alt="avatar"></p>
<h6 id="weight-pruning"><a href="#weight-pruning" class="headerlink" title="weight pruning"></a>weight pruning</h6><p>   把权重矩阵中数值较大的值设置为0，从而构造稀疏矩阵。（理论上稀疏矩阵乘法速度快于normal(danse)矩阵乘法。）</p>
<h6 id="Removing-neurons"><a href="#Removing-neurons" class="headerlink" title="Removing neurons"></a>Removing neurons</h6><p>   直接删除权重矩阵中不重要的的某一行或某一列。（删除和fine-tune交替进行，这样剩下的神经元在一定程度上可以弥补被删除的神经元）</p>
<h6 id="Removing-weight-matrices"><a href="#Removing-weight-matrices" class="headerlink" title="Removing weight matrices"></a>Removing weight matrices</h6><p>   [10]从big transformers中直接删除对accuracy贡献不大的整个attention head。但是这种方式不能保证能够并行加速，因为相邻的权重矩阵的size变的不同了。</p>
<h5 id="知识蒸馏"><a href="#知识蒸馏" class="headerlink" title="知识蒸馏"></a>知识蒸馏</h5><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/Knowledge-distillation.jpg" alt="avatar"></p>
<p>DistilBert使用模型蒸馏技术：这是一种能够将大型模型（被称为「老师」）压缩为较小模型（即「学生」）的技术。</p>
<p><a href="https://blog.csdn.net/nature553863/article/details/80568658" target="_blank" rel="noopener">知识蒸馏方法</a></p>
<h6 id="知识蒸馏：迁移泛化能力"><a href="#知识蒸馏：迁移泛化能力" class="headerlink" title="知识蒸馏：迁移泛化能力"></a>知识蒸馏：迁移泛化能力</h6><p>知识蒸馏是一种压缩技术，要求对小型模型进行训练，以使其拥有类似于大型模型的行为特征。在监督学习领域，我们在训练分类模型时往往会利用对数似然信号实现概率最大化（logits 的 softmax），进而预测出正确类。在大多数情况下，性能良好的模型能够利用具有高概率的正确类预测输出分布，同时其它类的发生概率则接近于零。</p>
<p><strong>但是，某些“接近于零”的概率要比其它概率更大，这在一定程度上反映出模型的泛化能力</strong>。例如，把普通椅子误认为扶手椅虽然属于错误，但这种错误远比将其误认为蘑菇来得轻微。这种不确定性，有时被称为“暗知识”。也可以从另一个角度来理解蒸馏——用于防止模型对预测结果太过确定（类似于标签平滑）。</p>
<p>在语言建模当中，可以通过查看词汇表中的分布轻松观察到这种不确定性。下图为 BERT 对《卡萨布兰卡》电影当中经典台词下一句用词的猜测：</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/next_word.png" alt="avatar"></p>
<p>BERT 提出的 20 大高概率用词猜测结果。语言模型确定了两个可能性最高的选项（day 与 life），接下来的词汇相比之下概率要低得多。</p>
<h6 id="如何复制这些“暗知识”"><a href="#如何复制这些“暗知识”" class="headerlink" title="如何复制这些“暗知识”"></a>如何复制这些“暗知识”</h6><p>在训练当中，通过训练学生网络，来模拟老师网络的全部输出分布（也就是知识），也就是通过匹配输出分布的方式训练学生网络，从而实现与老师网络相同的泛化方式，即通过软目标（老师概率）将交叉熵从老师处传递给学生。</p>
<script type="math/tex; mode=display">
L=-\sum_{i} t_{i} * \log \left(s_{i}\right)</script><p>其中 $t_i$为来自老师的 $logit$，$s_i$ 为学生的 $logit$。以老师的行为$t_i$作为标签，让学生去学习老师的行为。<strong>这个损失函数属于更丰富的训练信号，因为单一示例要比单一硬目标拥有更高的强制约束效果。</strong>为了进一步揭示分类结果的质量，Hinton 等人提出了 softmax 温度的概念：</p>
<script type="math/tex; mode=display">
p_{i}=\frac{\exp \left(z_{i} / T\right)}{\sum_{j} \exp \left(z_{j} / T\right)}</script><p>T 为温度参数。当$T \rightarrow 0$时，分布变为 Kronecker（相当于独热目标矢量）；当 $T \rightarrow +\infty$时，则变为均匀分布。在训练过程中，将相同的温度参数应用于学生与老师网络，即可进一步为每个训练示例揭示更多信号。T 被设置为 1 即为标准 Softmax。</p>
<p>在蒸馏方面，使用 Kullback-Leibler 损失函数，因为其拥有相同的优化效果：</p>
<script type="math/tex; mode=display">
K L(p \| q)=\mathbb{E}_{p}\left(\log \left(\frac{p}{q}\right)\right)=\sum_{i} p_{i} * \log \left(p_{i}\right)-\sum_{i} p_{i} * \log \left(q_{i}\right)</script><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> torch.optim <span class="keyword">import</span> Optimizer</span><br><span class="line"></span><br><span class="line">KD_loss = nn.KLDivLoss(reduction=<span class="string">'batchmean'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kd_step</span><span class="params">(teacher: nn.Module,</span></span></span><br><span class="line"><span class="function"><span class="params">            student: nn.Module,</span></span></span><br><span class="line"><span class="function"><span class="params">            temperature: float,</span></span></span><br><span class="line"><span class="function"><span class="params">            inputs: torch.tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            optimizer: Optimizer)</span>:</span></span><br><span class="line">    teacher.eval()</span><br><span class="line">    student.train()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        logits_t = teacher(inputs=inputs) <span class="comment"># 老师的输出</span></span><br><span class="line">    logits_s = student(inputs=inputs) <span class="comment"># 学生的输出</span></span><br><span class="line">    <span class="comment"># 计算kd_loss</span></span><br><span class="line">    loss = KD_loss(input=F.log_softmax(logits_s/temperature, dim=<span class="number">-1</span>),</span><br><span class="line">                   target=F.softmax(logits_t/temperature, dim=<span class="number">-1</span>))</span><br><span class="line">    </span><br><span class="line">    loss.backward()</span><br><span class="line">    optimizer.step()</span><br><span class="line">    optimizer.zero_grad()</span><br></pre></td></tr></table></figure>
<p>利用老师信号，能够训练出一套较小的语言模型 DistilBERT，属于 BERT 的监督产物。</p>
<h4 id="模型结构"><a href="#模型结构" class="headerlink" title="模型结构"></a>模型结构</h4><p>DistilBERT想较于BERT删除了 token-type 嵌入与 pooler（用于下一句分类任务），但其余部分架构保持不变，而层数也减少至原本的二分之一。总体而言，蒸馏模型 DistilBERT 在总体参数数量上约为 BERT 的一半，但在 GLUE 语言理解基准测试中能够保留 95% 的 BERT 性能表现。</p>
<ol>
<li><strong>为什么不降低隐藏层的大小？</strong><br>将 768 减至 512 ，意味着总参数量约下降至原本的二分之一。在现代框架当中，大多数运算都经过高度优化，而且张量的最终维度（隐藏维度）的变化会对 Transformer 架构（线性分层与层规范化）中的大部分运算产生小幅影响。实验中发现，层数对于推理时间的影响要远高于隐藏层的大小。因此，更小并不代表着一定更快。</li>
</ol>
<p>训练子网络的核心不只是建立架构，还要求为子网络找到正确的初始化方式以实现收敛。 DistilBERT 使用bert的参数进行初始化，将层数削减一半，并采用相同的隐藏大小。DistilBERT还用到了最近 RoBERTa 论文当中提到的一些训练技巧，这也再次证明 BERT 模型的训练方式对其最终表现有着至关重要的影响。与 RoBERTa 类似，对 DIstilBERT 进行大批次训练，使用梯度累积（每批最多 4000 个例子）、配合动态遮挡并删除了下一句预测目标。</p>
<h4 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h4><p>DistilBERT 的表现：保留了BERT  95% 以上的性能，同时将参数减少了 40%。推理时间方面，DistilBERT 比 BERT 快 60%，体积比 BERT 小 60%。</p>
<h3 id="ALBERT"><a href="#ALBERT" class="headerlink" title="ALBERT"></a>ALBERT</h3><p><a href="[PDF](https://arxiv.org/pdf/1909.11942">论文</a>)</p>
<h4 id="简介-5"><a href="#简介-5" class="headerlink" title="简介"></a>简介</h4><p>自BERT的成功以来，预训练模型都采用了很大的参数量以取得更好的模型表现。但是模型参数量越来越大也带来了很多问题，比如对算力要求越来越高、模型需要更长的时间去训练、甚至有些情况下参数量更大的模型表现却更差。为了解决目前预训练模型参数量过大的问题，albert提出了两种能够大幅减少预训练模型参数量的方法，此外还提出用Sentence-order prediction（SOP）任务代替BERT中的Next-sentence prediction（NSP）任务。</p>
<h4 id="模型-2"><a href="#模型-2" class="headerlink" title="模型"></a>模型</h4><h5 id="嵌入向量因式分解（Factorized-embedding-parameterization）"><a href="#嵌入向量因式分解（Factorized-embedding-parameterization）" class="headerlink" title="嵌入向量因式分解（Factorized embedding parameterization）"></a>嵌入向量因式分解（Factorized embedding parameterization）</h5><p>在BERT、XLNet、RoBERTa等模型中，由于模型结构的限制，WordePiece embedding的大小$E$ 总是与隐层大小$H$相同，即 $E \equiv H$ 。从建模的角度考虑，词嵌入学习的是单词与上下文无关的表示，而隐层则是学习与上下文相关的表示。显然后者更加复杂，需要更多的参数，也就是说模型应当增大隐层大小$H$，或者说满足 $H \gg E$。但实际上词汇表的大小$V$通常非常大，如果$E=H$的话，增加隐层大小$H$后将会使embedding matrix的维度$V \times E$非常巨大。</p>
<p>因此ALBERT想要打破$E$与$H$ 之间的绑定关系，从而减小模型的参数量，同时提升模型表现。具体做法是将embedding matrix分解为两个大小分别为$V \times  E$ 和$E \times H$ 矩阵，也就是说先将单词投影到一个低维的embedding空间 $E$ ，再将其投影到高维的隐藏空间$H$  。这使得embedding matrix的维度从$O(V \times H)$  减小到$O(v \times E + E \times H)$ 。当 $H \gg E$时，参数量减少非常明显。在实现时，随机初始化$V\times E$和$E\times H$的矩阵，计算某个单词的表示需用一个单词的one-hot向量乘以$V\times E$维的矩阵（也就是lookup），再用得到的结果乘$E\times H$维的矩阵即可。两个矩阵的参数通过模型学习。</p>
<p>从下图实验结果可见，对于不共享参数的情况，$E$几乎是与大越好；而共享参数之后， $E$太大反而会使模型表现变差，$E=128$模型表现最好，因此ALBERT的默认参数设置中$E=128$.</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_embedding.png" alt="avatar"></p>
<p>考虑到ALBERT-base的 $h=768$，那么 $E=768$时，模型应该可以看作没有减少embedding参数量的情况。而不共享参数的实验结果表明此时模型表现更好，那么似乎说明了Factorized embedding在一定程度上降低了模型的表现。</p>
<h5 id="跨层参数共享（参数量减少主要共享）"><a href="#跨层参数共享（参数量减少主要共享）" class="headerlink" title="跨层参数共享（参数量减少主要共享）"></a>跨层参数共享（参数量减少主要共享）</h5><p>另一个减少参数量的方法就是层之间的参数共享，即多个层使用相同的参数。参数共享有三种方式：只共享feed-forward network的参数、只共享attention的参数、共享全部参数。ALBERT默认是共享全部参数的。实验表明加入参数共享之后，每一层的输入embedding和输出embedding的L2距离和余弦相似度都比BERT稳定了很多。这证明参数共享能够使模型参数更加稳定。</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/cross.png" alt="avatar"></p>
<p>如下图所示，可以看出参数共享几乎也是对模型结果有负面影响的。但是考虑到其能够大幅削减参数量，并且对结果影响不是特别大，因此权衡之下选择了参数共享。</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_crosslayer.png" alt="avatar"></p>
<h5 id="句间连贯性"><a href="#句间连贯性" class="headerlink" title="句间连贯性"></a>句间连贯性</h5><ul>
<li><strong>NSP</strong>：下一句预测， 正样本=上下相邻的2个句子，负样本=随机2个句子</li>
<li><strong>SOP</strong>：句子顺序预测，正样本=正常顺序的2个相邻句子，负样本=调换顺序的2个相邻句子</li>
</ul>
<p>NSP任务过于简单，只要模型发现两个句子的主题不一样就行了，所以SOP预测任务能够让模型学习到更多的信息。</p>
<p>除了减少模型参数外，还对BERT的预训练任务Next-sentence prediction (NSP)进行了改进。在BERT中，NSP任务的正例是文章中连续的两个句子，而负例则是从两篇文档中各选一个句子构造而成。在先前的研究中，已经证明NSP是并不是一个合适的预训练任务。作者推测其原因是模型在判断两个句子的关系时不仅考虑了两个句子之间的连贯性（coherence），还会考虑到两个句子的话题（topic）。而两篇文档的话题通常不同，模型会更多的通过话题去分析两个句子的关系，而不是句子间的连贯性，这使得NSP任务变成了一个相对简单的任务。</p>
<p>因此本文提出了Sentence-order prediction (SOP)来取代NSP。具体来说，其正例与NSP相同，但负例是通过选择一篇文档中的两个连续的句子并将它们的顺序交换构造的。这样两个句子就会有相同的话题，模型学习到的就更多是句子间的连贯性。</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_sop.png" alt="avatar"></p>
<p>如上实验结果所示，如果不使用NSP或SOP作为预训练任务的话，模型在NSP和SOP两个任务上表现都很差；如果使用NSP作为预训练任务的话，模型确实能很好的解决NSP问题，但是在SOP问题上表现却很差，几乎相当于随机猜，因此说明NSP任务确实很难学到句子间的连贯性；而如果用SOP作为预训练任务，则模型也可以较好的解决NSP问题，同时模型在下游任务上表现也更好。说明SOP确实是更好的预训练任务。</p>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><h5 id="额外的训练数据和dropout"><a href="#额外的训练数据和dropout" class="headerlink" title="额外的训练数据和dropout"></a>额外的训练数据和dropout</h5><p>ALBERT训练时还加入了XLNet和RoBERTa训练时用的额外数据，实验表明加入额外数据（W additional data）确实会提升模型表现。此外，作者还观察到模型似乎一直没有过拟合数据，因此去除了Dropout，从对比试验可以看出，去除Dropout（W/O Dropout）后模型表现确实更好。</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_dropout.png" alt="avatar"></p>
<h4 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/albert_bert.png" alt="avatar"></p>
<p>ALBERT的训练速度明显比BERT快，ALBERT-xxlarge的表现更是全方面超过了BERT。</p>
<p>本文有两个小细节可以学习，一个是在模型不会过拟合的情况下不使用dropout；另一个则是warm-start，即在训练深层网络（例如12层）时，可以先训练浅层网络（例如6层），再在其基础上做fine-tune，这样可以加快深层模型的收敛。</p>
<h3 id="TinyBERT"><a href="#TinyBERT" class="headerlink" title="TinyBERT"></a>TinyBERT</h3><p><a href="https://arxiv.org/abs/1909.10351" target="_blank" rel="noopener">论文</a></p>
<h4 id="简介-6"><a href="#简介-6" class="headerlink" title="简介"></a>简介</h4><p>在 NLP 领域，BERT 由于模型过于庞大，单个样本计算一次的开销动辄上百毫秒，很难应用到实际生产中。中科技大学、华为诺亚方舟实验室的研究者提出了 TinyBERT，这是一种为基于 transformer 的模型专门设计的知识蒸馏方法，模型大小为 BERT 的 13.3%，推理速度是 BERT 的 9.4 倍，而且性能没有出现明显下降。</p>
<p>目前主流的几种蒸馏方法大概分成 1. 利用 transformer 结构蒸馏, 2. 利用其它简单的结构比如 BiLSTM 等蒸馏。由于 BiLSTM 等结构简单，且一般是用 BERT 最后一层的输出结果进行蒸馏，不能学到 transformer 中间层的信息，对于复杂的语义匹配任务，效果有点不尽人意。</p>
<p>基于 transformer 结构的蒸馏方法目前比较出名的有微软的 BERT-PKD (Patient Knowledge Distillation for BERT)，huggingface 的 DistilBERT，以及华为的 TinyBERT。他们的基本思路都是减少 transformer encoding 的层数和 hidden size 大小，实现细节上各有不同，主要差异体现在 loss 的设计上。</p>
<h4 id="模型-3"><a href="#模型-3" class="headerlink" title="模型"></a>模型</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/tinyBert.jpg" alt="avatar"></p>
<p>整个 TinyBERT 的 loss 设计分为三部分：</p>
<h5 id="Embedding-layer-Distillation"><a href="#Embedding-layer-Distillation" class="headerlink" title="Embedding-layer Distillation"></a>Embedding-layer Distillation</h5><script type="math/tex; mode=display">
\mathcal{L}_{\mathrm{embd}}=\operatorname{MSE}\left(\boldsymbol{E}^{S} \boldsymbol{W}_{e}, \boldsymbol{E}^{T}\right)</script><p>其中，$E^s \in R^{l \times ds}$,$E^T \ in R^{l \times dt}$分别表示 student 网络的 embedding 和 teacher 网络的 embedding. 其中 l 代表 sequence length, ds 代表 student embedding 维度， dt 代表 teacher embedding 维度。由于 student 网络的 embedding 层通常较 teacher 会变小以获得更小的模型和加速，所以 $W_e$ 是一个 $d_s \times d_t$维的可训练的线性变换矩阵，把 student 的 embedding 投影到 teacher embedding 所在的空间。最后再算 MSE，得到 embedding loss.</p>
<h5 id="Transformer-layer-Distillation"><a href="#Transformer-layer-Distillation" class="headerlink" title="Transformer-layer Distillation"></a>Transformer-layer Distillation</h5><p>TinyBERT 的 transformer 蒸馏采用隔 k 层蒸馏的方式。举个例子，teacher BERT 一共有 12 层，若是设置 student BERT 为 4 层，就是每隔 3 层计算一个 transformer loss. 映射函数为 g(m) = 3 * m(???), m 为 student encoder 层数。具体对应为 student 第 1 层 transformer 对应 teacher 第 3 层，第 2 层对应第 6 层，第 3 层对应第 9 层，第 4 层对应第 12 层。每一层的 transformer loss 又分为两部分组成，attention based distillation 和 hidden states based distillation.</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/transormers_distillation.jpg" alt="avatar"></p>
<h6 id="Attention-based-loss"><a href="#Attention-based-loss" class="headerlink" title="Attention based loss"></a>Attention based loss</h6><script type="math/tex; mode=display">
\mathcal{L}_{\mathrm{attn}}=\frac{1}{h} \sum_{i=1}^{h} \operatorname{MSE}\left(\boldsymbol{A}_{i}^{S}, \boldsymbol{A}_{i}^{T}\right)</script><p>其中，$A_i \in R^{l \times l}$ $h$代表attention的头数，$l$代表输入长度，$A_i^S$代表student网络第i个attention头的attention score矩阵。$A_i^T$代表teacher网络的第i个attention头的attention score 矩阵。为什么要做这个损失？在What Does BERT Look At? An Analysis of BERT’s Attention [12]中研究了attention 权重到底学到了什么，实验发现与语义还有语法相关的词比如第一个动词宾语，第一个介词宾语，以及[CLS], [SEP], 逗号等 token，有很高的注意力权重。为了确保这部分信息能被 student 网络学到，TinyBERT 在 loss 设计中加上了 student 和 teacher 的 attention matrix 的 MSE。这样语言知识可以很好的从 teacher BERT 转移到 student BERT.</p>
<h6 id="hidden-states-based-distillation"><a href="#hidden-states-based-distillation" class="headerlink" title="hidden states based distillation"></a>hidden states based distillation</h6><script type="math/tex; mode=display">
\mathcal{L}_{\mathrm{hidn}}=\mathrm{MSE}\left(\boldsymbol{H}^{S} \boldsymbol{W}_{h}, \boldsymbol{H}^{T}\right)</script><p>其中，$H^S \in R^{l \times ds}$,$H^T \in R^{l \times dt}$分别是 student transformer 和 teacher transformer 的隐层输出。和 embedding loss 同理，$W_h$把$H^S$投影到$H^T$所在的空间。</p>
<h6 id="Prediction-Layer-Distillation"><a href="#Prediction-Layer-Distillation" class="headerlink" title="Prediction-Layer Distillation"></a>Prediction-Layer Distillation</h6><script type="math/tex; mode=display">
\mathcal{L}_{\text {pred }}=-\operatorname{softmax}\left(\boldsymbol{z}^{T}\right) \cdot \log \_ \left(\boldsymbol{z}^{S} / t\right)</script><p>其中 t 是 temperature value，暂时设为 1.除了模仿中间层的行为外，这一层用来模拟 teacher 网络在 predict 层的表现。具体来说，这一层计算了 teacher 输出的概率分布和 student 输出的概率分布的 softmax 交叉熵。这一层的实现和具体任务相关.</p>
<p> prediction loss 有很多变化。</p>
<ol>
<li>在 TinyBERT 中，这个 loss 是 teacher BERT 预测的概率和 student BERT 预测概率的 softmax 交叉熵.</li>
<li>在 BERT-PKD 模型中，这个 loss 是 teacher BERT 和 student BERT 的交叉熵和 student BERT 和 hard target( one-hot)的交叉熵的加权平均。</li>
</ol>
<p>直接用 hard target loss，效果比使用 teacher student softmax 交叉熵下降 5-6 个点。因为 softmax 比 one-hot 编码了更多概率分布的信息。并且softmax cross-entropy loss 容易发生不收敛的情况，把 softmax 交叉熵改成 MSE, 收敛效果变好，但泛化效果变差。这是因为使用 softmax cross-entropy 需要学到整个概率分布，更难收敛，因为拟合了 teacher BERT 的概率分布，有更强的泛化性。MSE 对极值敏感，收敛的更快，但泛化效果不如前者。</p>
<p>所以总的loss：</p>
<script type="math/tex; mode=display">
\mathcal{L}_{\text {model }}=\sum_{m=0}^{M+1} \lambda_{m} \mathcal{L}_{\text {layer }}\left(S_{m}, T_{g(m)}\right)</script><p>其中</p>
<script type="math/tex; mode=display">
\mathcal{L}_{\text {layer }}\left(S_{m}, T_{g(m)}\right)=\left\{\begin{array}{ll}
\mathcal{L}_{\text {embd }}\left(S_{0}, T_{0}\right), & m=0 \\
\mathcal{L}_{\text {hidn }}\left(S_{m}, T_{g(m)}\right)+\mathcal{L}_{\text {attn }}\left(S_{m}, T_{g(m)}\right), & M \geq m>0 \\
\mathcal{L}_{\text {pred }}\left(S_{M+1}, T_{N+1}\right), & m=M+1
\end{array}\right.</script><h4 id="两阶段学习框架"><a href="#两阶段学习框架" class="headerlink" title="两阶段学习框架"></a>两阶段学习框架</h4><p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/two_step.jpg" alt="avatar"></p>
<p>类似于原生的 BERT 先 pre-train, 根据具体任务再 fine-tine。TinyBERT 先在 general domain 数据集上用未经微调的 BERT 充当教师蒸馏出一个 base 模型，在此基础上，具体任务通过数据增强，利用微调后的 BERT 再进行重新执行蒸馏。这种两阶段的方法给 TinyBERT 提供了像 BERT 一样的泛化能力。 </p>
<h4 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h4><p> TinyBERT 作为一种蒸馏方法，能有效的提取 BERT transformer 结构中丰富的语意信息，在不牺牲性能的情况下，速度能获得 8 到 9 倍的提升。</p>
<h3 id="FastBert"><a href="#FastBert" class="headerlink" title="FastBert"></a>FastBert</h3><h4 id="简介-7"><a href="#简介-7" class="headerlink" title="简介"></a>简介</h4><p>FastBERT的创新点很容易理解，就是在每层Transformer后都去预测样本标签，如果某样本预测结果的置信度很高，就不用继续计算了。论文把这个逻辑称为样本自适应机制（Sample-wise adaptive mechanism），就是自适应调整每个样本的计算量，容易的样本通过一两层就可以预测出来，较难的样本则需要走完全程。</p>
<p>举个例子，比如 text_a = ‘北京鲜花快递’ text_b = ‘北京鲜花速递’ 这种case可能浅层的bert就已经能够很好的算出其相关性打分，所以算完两层bert的打分和12层的结果基本一致，而text_a = ‘北京鲜花快递’ text_b = ‘有没有哪个地方卖花卉，而且包送，位置北京’ 这种case可能需要深层的bert去抽取两边的语义特征，并计算其是否匹配，所以在inference阶段就需要算完12层。</p>
<p><img src="/2020/04/13/bert%E7%B3%BB%E5%88%97/fastbert.jpg" alt="avatar"></p>
<p>作者将原BERT模型称为主干（Backbone），每个分类器称为分支（Branch）。这里的分支Classifier都是最后一层的分类器蒸馏来的，作者将这称为自蒸馏（Self-distillation）。就是在预训练和精调阶段都只更新主干参数，精调完后<strong>freeze主干参数，用分支分类器（图中的student）蒸馏主干分类器（图中的teacher）的概率分布</strong>。之所以叫自蒸馏，是因为之前的蒸馏都是用两个模型去做，一个模型学习另一个模型的知识，而FastBERT是自己（分支）蒸馏自己（主干）的知识。值得注意的是，蒸馏时需要freeze主干部分，保证pretrain和finetune阶段学习的知识不被影响，仅用brach 来尽可能的拟合teacher的分布。同时，使用自蒸馏还有一点重要的好处，就是<strong>不再依赖于标注数据</strong>。蒸馏的效果可以通过源源不断的无标签数据来提升。</p>
<h4 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h4><p>FastBERT通过提前输出简单样本的预测结果，减少模型的计算负担，从而提高推理速度。虽然每层都多了一个分类器，但分类器的计算量也比Transformer小了两个数量级，对速度影响较小。后续的分支自蒸馏也设计的比较巧妙，可以利用无监督数据不断提升分支分类器的效果。</p>
<h3 id="总结-7"><a href="#总结-7" class="headerlink" title="总结"></a>总结</h3><p>性能：</p>
<ol>
<li>BERT-WWM</li>
<li>XLNet（长文本表现更好一些）</li>
<li>RoBERTa（动态mask、without NSP、更大batch，更多数据，更长训练时间）</li>
<li>SpanBERT(基于分词的预训练模型)</li>
<li>MT-DNN(预训练+多任务)</li>
<li>ERNIR（引入实体信息）</li>
</ol>
<p>效率：</p>
<ol>
<li>DistilBert（知识蒸馏）</li>
<li>ALBert（因式分解、跨层权重共享）</li>
<li>TinyBert（知识蒸馏）</li>
</ol>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol>
<li><a href="https://zhuanlan.zhihu.com/p/46652512" target="_blank" rel="noopener">【NLP】Google BERT详解</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/81157740" target="_blank" rel="noopener">带你读论文丨8篇论文梳理BERT相关模型进展与反思</a></li>
<li><a href="https://blog.csdn.net/u012526436/article/details/93196139" target="_blank" rel="noopener">最通俗易懂的XLNET详解</a></li>
<li><a href="https://www.jianshu.com/p/eddf04ba8545" target="_blank" rel="noopener">改进版的RoBERTa到底改进了什么？</a></li>
<li><a href="https://www.bilibili.com/video/av73657563/" target="_blank" rel="noopener">【AI模型】最通俗易懂的XLNet详解</a></li>
<li>Liu Y, Ott M, Goyal N, et al. Roberta: A robustly optimized bert pretraining approach[J]. arXiv preprint arXiv:1907.11692, 2019</li>
<li>Sennrich R, Haddow B, Birch A. Neural machine translation of rare words with subword units[J]. arXiv preprint arXiv:1508.07909, 2015.</li>
<li><a href="http://fancyerii.github.io/2019/03/09/bert-codes/#dataprocessor" target="_blank" rel="noopener">bert代码阅读</a></li>
<li><a href="https://www.infoq.cn/article/STabowUeFupgc4gRqRQj" target="_blank" rel="noopener">更小、更快、更便宜、更轻量：开源 DistilBERT，BERT 的精简版本</a></li>
<li>Michel, P., Levy, O., &amp; Neubig, G. (2019). Are Sixteen Heads Really Better than One? Retrieved from <a href="https://arxiv.org/abs/1905.10650" target="_blank" rel="noopener">https://arxiv.org/abs/1905.10650</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/94359189" target="_blank" rel="noopener">比 Bert 体积更小速度更快的 TinyBERT</a></li>
<li><a href="https://arxiv.org/abs/1906.04341" target="_blank" rel="noopener">https://arxiv.org/abs/1906.04341</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/87562926" target="_blank" rel="noopener">【论文阅读】ALBERT</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/59436589" target="_blank" rel="noopener">中文任务全面超越BERT：百度正式发布NLP预训练模型ERNIE</a></li>
<li><a href="https://www.jianshu.com/p/5e12e6edbd59" target="_blank" rel="noopener">BERT泛读系列（三）—— ERNIE: Enhanced Language Representation with Informative Entities论文笔记</a></li>
<li><a href="https://blog.csdn.net/ljp1919/article/details/90269059" target="_blank" rel="noopener">文献阅读：MT-DNN模型</a></li>
<li><a href="https://blog.csdn.net/Magical_Bubble/article/details/89517709" target="_blank" rel="noopener">MT-DNN解读(论文 + PyTorch源码)</a></li>
</ol>
]]></content>
      <categories>
        <category>深度学习</category>
      </categories>
      <tags>
        <tag>BERT</tag>
        <tag>BERT-WWM</tag>
        <tag>XLNet</tag>
        <tag>RoBERTa</tag>
        <tag>SpanBERT</tag>
        <tag>ernie</tag>
        <tag>MT-DNN</tag>
        <tag>DistillBERT</tag>
        <tag>ALBERT</tag>
        <tag>TinyBERT</tag>
      </tags>
  </entry>
  <entry>
    <title>文本多标签分类</title>
    <url>/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>对于事件抽取中单句多事件的问题，打算用文本多标签分类来进行解决。</p>
<h3 id="难点"><a href="#难点" class="headerlink" title="难点"></a>难点</h3><ol>
<li>类标数量不确定，有些样本可能只有一个类标，有些样本的类标可能高达几十甚至上百个。 </li>
<li>类标之间相互依赖，例如包含蓝天类标的样本很大概率上包含白云，如何解决类标之间的依赖性问题也是一大难点。</li>
<li>多标签的训练集比较难以获取。</li>
</ol>
<a id="more"></a>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>前有很多关于多标签的学习算法，依据解决问题的角度，这些算法可以分为两大类:一是基于问题转化的方法，二是基于算法适用的方法。基于问题转化的方法是转化问题数据，使之使用现有算法；基于算法适用的方法是指针对某一特定的算法进行扩展，从而能够处理多标记数据，改进算法，适用数据。</p>
<h4 id="基于问题转化的方法"><a href="#基于问题转化的方法" class="headerlink" title="基于问题转化的方法"></a><strong>基于问题转化的方法</strong></h4><p>基于问题转化的方法中有的考虑标签之间的关联性，有的不考虑标签的关联性。最简单的不考虑关联性的算法将多标签中的每一个标签当成是单标签，对每一个标签实施常见的分类算法。具体而言，在传统机器学习的模型中对每一类标签做二分类，可以使用SVM、DT、Naïve Bayes、DT、Xgboost等算法；在深度学习中，对每一类训练一个文本分类模型(如：textCNN、textRNN等)。考虑多标签的相关性时候可以将上一个输出的标签当成是下一个标签分类器的输入。在传统机器学习模型中可以使用<strong>分类器链</strong>，在这种情况下，第一个分类器只在输入数据上进行训练，然后每个分类器都在输入空间和链上的所有之前的分类器上进行训练。让我们试着通过一个例子来理解这个问题。在下面给出的数据集里，我们将X作为输入空间，而Y作为标签。在分类器链中，这个问题将被转换成4个不同的标签问题，就像下面所示。黄色部分是输入空间，白色部分代表目标变量。</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/1.png" alt="avatar"></p>
<p>在深度学习中，于输出层加上一个时序模型，将每一时刻输入的数据序列中加入上一时刻输出的结果值。在获得文章的整体语义(Text feature vector)后，将Text feature vector输入到一个RNN的序列中作为初始值，每一时刻输入是上一时刻的输出。从某种程度上来说，下图所示的模型将多标签任务当成了序列生成任务来处理。</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/cnn_rnn.png" alt="avatar"></p>
<p>除了将标签分开看之外，还有将标签统一来看(Label Powerset)。在这方面，我们将问题转化为一个多类问题，一个多类分类器在训练数据中发现的所有唯一的标签组合上被训练。让我们通过一个例子来理解它。</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/multi_one.png" alt="avatar"></p>
<p>在这一点上，我们发现x1和x4有相同的标签。同样的，x3和x6有相同的标签。因此，标签powerset将这个问题转换为一个单一的多类问题，如下所示。</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/multi_two.png" alt="avatar"></p>
<p>因此，标签powerset给训练集中的每一个可能的标签组合提供了一个独特的类。转化为单标签后就可以使用SVM、textCNN、textRNN等分类算法训练模型了。</p>
<p>感觉Label Powerset只适合标签数少的数据，一旦标签数目太多(假设有n个)，使用Label Powerset后可能的数据集将分布在[0,$2^{n-1}$]空间内，数据会很稀疏。</p>
<h4 id="基于算法适用的方法"><a href="#基于算法适用的方法" class="headerlink" title="基于算法适用的方法"></a><strong>基于算法适用的方法</strong></h4><p>改变算法来直接执行多标签分类，而不是将问题转化为不同的问题子集。在传统机器学习模型中适用于的多标签分类模型有:kNN多标签版本MLkNN，SVM的多标签版本Rank-SVM等。在深度学习中常常是修改多分类模型的输出层，使其适用于多标签的分类，如：在输出层对每一个标签的输出值使用sigmod函数进行2分类(标签之间无关联信息)。或者使用一般的CNN提取句子的语义信息，但考虑到句子表示的不同部分在句子分类的过程中会起不同的作用，故在进行分类时候使用了Attention机制(见图)，使得在预测每一类时候句子的不同部分的表示起不同的作用。</p>
<p><img src="/2020/04/11/%E6%96%87%E6%9C%AC%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB/3.png" alt="avatar"></p>
<h3 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h3><ol>
<li><a href="https://ai.baidu.com/tech/nlp/doctagger" target="_blank" rel="noopener">百度AI开放平台(文章标签)</a></li>
<li><a href="https://github.com/inspirehep/magpie" target="_blank" rel="noopener">Magpie(多标签分类工具)</a></li>
<li><a href="https://biendata.com/competition/zhihu/" target="_blank" rel="noopener">2017知乎“看山杯”比赛</a></li>
<li>[英文新闻多 标签分类数据集](<a href="https://drive.google.com/file/d/18-JOCIj9v5bZCrn9CIsk23W4wyhroCp_/view?usp=sharing" target="_blank" rel="noopener">https://drive.google.com/file/d/18-JOCIj9v5bZCrn9CIsk23W4wyhroCp_/view?usp=sharing</a></li>
<li>[网上可采集的、质量较高的多标签分类数据集(<a href="https://movie.douban.com/" target="_blank" rel="noopener">豆瓣电影评论</a>)</li>
<li>GitHub上比较完善的<a href="https://github.com/brightmart/text_classification" target="_blank" rel="noopener">文本多标签分类项目</a></li>
<li>NLPCC2018，task6和tesk8均可以当成是多标签的分类任务；</li>
</ol>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol>
<li><a href="https://www.cnblogs.com/cxf-zzj/p/10049613.html" target="_blank" rel="noopener">多标签分类(multi-label classification)综述</a></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>python数据科学速查</title>
    <url>/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="速查表"><a href="#速查表" class="headerlink" title="速查表"></a>速查表</h2><h3 id="python-基础"><a href="#python-基础" class="headerlink" title="python 基础"></a>python 基础</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/python.png" alt="avatar"></p>
<a id="more"></a>
<h3 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/import_data.png" alt="avatar"></p>
<h3 id="jupyter-notebook"><a href="#jupyter-notebook" class="headerlink" title="jupyter notebook"></a>jupyter notebook</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/jupyter_notebook.png" alt="avatar"></p>
<h3 id="numpy"><a href="#numpy" class="headerlink" title="numpy"></a>numpy</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/numpy.png" alt="avatar"></p>
<h3 id="pandas"><a href="#pandas" class="headerlink" title="pandas"></a>pandas</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/pandas_1.png" alt="avatar"></p>
<p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/pandas_2.png" alt="avatar"></p>
<h3 id="matplotlib"><a href="#matplotlib" class="headerlink" title="matplotlib"></a>matplotlib</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/matplotlib.png" alt="avatar"></p>
<h3 id="Seaborn"><a href="#Seaborn" class="headerlink" title="Seaborn"></a>Seaborn</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/seaborn.png" alt="avatar"></p>
<h3 id="SciPy"><a href="#SciPy" class="headerlink" title="SciPy"></a>SciPy</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/scipy.png" alt="avatar"></p>
<h3 id="scikit-learn"><a href="#scikit-learn" class="headerlink" title="scikit-learn"></a>scikit-learn</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/scikit_learn.png" alt="avatar"></p>
<h3 id="keras"><a href="#keras" class="headerlink" title="keras"></a>keras</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/kearas.png" alt="avatar"></p>
<h3 id="bokeh"><a href="#bokeh" class="headerlink" title="bokeh"></a>bokeh</h3><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/bokeh.png" alt="avatar"></p>
<h3 id="PySpark"><a href="#PySpark" class="headerlink" title="PySpark"></a>PySpark</h3><h4 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h4><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/spark_sql.png" alt="avatar"></p>
<h4 id="RDD"><a href="#RDD" class="headerlink" title="RDD"></a>RDD</h4><p><img src="/2020/04/11/python%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E9%80%9F%E6%9F%A5/spark_rdd.png" alt="avatar"></p>
<h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><h3 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:     <span class="comment"># Runs main() if file wasn't imported.</span></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = &lt;list&gt;[from_inclusive : to_exclusive : ±step_size]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt;.append(&lt;el&gt;)            <span class="comment"># Or: &lt;list&gt; += [&lt;el&gt;]</span></span><br><span class="line">&lt;list&gt;.extend(&lt;collection&gt;)    <span class="comment"># Or: &lt;list&gt; += &lt;collection&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt;.sort()</span><br><span class="line">&lt;list&gt;.reverse()</span><br><span class="line">&lt;list&gt; = sorted(&lt;collection&gt;)</span><br><span class="line">&lt;iter&gt; = reversed(&lt;list&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sum_of_elements  = sum(&lt;collection&gt;)</span><br><span class="line">elementwise_sum  = [sum(pair) <span class="keyword">for</span> pair <span class="keyword">in</span> zip(list_a, list_b)]</span><br><span class="line">sorted_by_second = sorted(&lt;collection&gt;, key=<span class="keyword">lambda</span> el: el[<span class="number">1</span>])</span><br><span class="line">sorted_by_both   = sorted(&lt;collection&gt;, key=<span class="keyword">lambda</span> el: (el[<span class="number">1</span>], el[<span class="number">0</span>]))</span><br><span class="line">flatter_list     = list(itertools.chain.from_iterable(&lt;list&gt;))</span><br><span class="line">product_of_elems = functools.reduce(<span class="keyword">lambda</span> out, x: out * x, &lt;collection&gt;)</span><br><span class="line">list_of_chars    = list(&lt;str&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">index = &lt;list&gt;.index(&lt;el&gt;)     <span class="comment"># Returns index of first occurrence or raises ValueError.</span></span><br><span class="line">&lt;list&gt;.insert(index, &lt;el&gt;)     <span class="comment"># Inserts item at index and moves the rest to the right.</span></span><br><span class="line">&lt;el&gt; = &lt;list&gt;.pop([index])     <span class="comment"># Removes and returns item at index or from the end.</span></span><br><span class="line">&lt;list&gt;.remove(&lt;el&gt;)            <span class="comment"># Removes first occurrence of item or raises ValueError.</span></span><br><span class="line">&lt;list&gt;.clear()                 <span class="comment"># Removes all items. Also works on dict and set.</span></span><br></pre></td></tr></table></figure>
<h3 id="Dictionary"><a href="#Dictionary" class="headerlink" title="Dictionary"></a>Dictionary</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;view&gt; = &lt;dict&gt;.keys()                          <span class="comment"># Coll. of keys that reflects changes.</span></span><br><span class="line">&lt;view&gt; = &lt;dict&gt;.values()                        <span class="comment"># Coll. of values that reflects changes.</span></span><br><span class="line">&lt;view&gt; = &lt;dict&gt;.items()                         <span class="comment"># Coll. of key-value tuples.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">value  = &lt;dict&gt;.get(key, default=<span class="literal">None</span>)          <span class="comment"># Returns default if key does not exist.</span></span><br><span class="line">value  = &lt;dict&gt;.setdefault(key, default=<span class="literal">None</span>)   <span class="comment"># Same, but also adds default to dict.</span></span><br><span class="line">&lt;dict&gt; = collections.defaultdict(&lt;type&gt;)        <span class="comment"># Creates a dict with default value of type.</span></span><br><span class="line">&lt;dict&gt; = collections.defaultdict(<span class="keyword">lambda</span>: <span class="number">1</span>)     <span class="comment"># Creates a dict with default value 1.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;dict&gt;.update(&lt;dict&gt;)</span><br><span class="line">&lt;dict&gt; = dict(&lt;collection&gt;)                     <span class="comment"># Creates a dict from coll. of key-value pairs.</span></span><br><span class="line">&lt;dict&gt; = dict(zip(keys, values))                <span class="comment"># Creates a dict from two collections.</span></span><br><span class="line">&lt;dict&gt; = dict.fromkeys(keys [, value])          <span class="comment"># Creates a dict from collection of keys.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">value = &lt;dict&gt;.pop(key)                         <span class="comment"># Removes item from dictionary.</span></span><br><span class="line">&#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> &lt;dict&gt;.items() <span class="keyword">if</span> k <span class="keyword">in</span> keys&#125;  <span class="comment"># Filters dictionary by keys.</span></span><br></pre></td></tr></table></figure>
<h3 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>colors = [<span class="string">'red'</span>, <span class="string">'blue'</span>, <span class="string">'yellow'</span>, <span class="string">'blue'</span>, <span class="string">'red'</span>, <span class="string">'blue'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = Counter(colors)</span><br><span class="line">Counter(&#123;<span class="string">'blue'</span>: <span class="number">3</span>, <span class="string">'red'</span>: <span class="number">2</span>, <span class="string">'yellow'</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter.most_common()[<span class="number">0</span>]</span><br><span class="line">(<span class="string">'blue'</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;set&gt; = set()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;set&gt;.add(&lt;el&gt;)                               <span class="comment"># Or: &lt;set&gt; |= &#123;&lt;el&gt;&#125;</span></span><br><span class="line">&lt;set&gt;.update(&lt;collection&gt;)                    <span class="comment"># Or: &lt;set&gt; |= &lt;set&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;set&gt;  = &lt;set&gt;.union(&lt;coll.&gt;)                 <span class="comment"># Or: &lt;set&gt; | &lt;set&gt;</span></span><br><span class="line">&lt;set&gt;  = &lt;set&gt;.intersection(&lt;coll.&gt;)          <span class="comment"># Or: &lt;set&gt; &amp; &lt;set&gt;</span></span><br><span class="line">&lt;set&gt;  = &lt;set&gt;.difference(&lt;coll.&gt;)            <span class="comment"># Or: &lt;set&gt; - &lt;set&gt;</span></span><br><span class="line">&lt;set&gt;  = &lt;set&gt;.symmetric_difference(&lt;coll.&gt;)  <span class="comment"># Or: &lt;set&gt; ^ &lt;set&gt;</span></span><br><span class="line">&lt;bool&gt; = &lt;set&gt;.issubset(&lt;coll.&gt;)              <span class="comment"># Or: &lt;set&gt; &lt;= &lt;set&gt;</span></span><br><span class="line">&lt;bool&gt; = &lt;set&gt;.issuperset(&lt;coll.&gt;)            <span class="comment"># Or: &lt;set&gt; &gt;= &lt;set&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;set&gt;.remove(&lt;el&gt;)                            <span class="comment"># Raises KeyError.</span></span><br><span class="line">&lt;set&gt;.discard(&lt;el&gt;)                           <span class="comment"># Doesn't raise an error.</span></span><br></pre></td></tr></table></figure>
<h4 id="Frozen-Set"><a href="#Frozen-Set" class="headerlink" title="Frozen Set"></a>Frozen Set</h4><ul>
<li><strong>Is immutable and hashable.</strong></li>
<li><strong>That means it can be used as a key in a dictionary or as an element in a set.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;frozenset&gt; = frozenset(&lt;collection&gt;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Tuple"><a href="#Tuple" class="headerlink" title="Tuple"></a>Tuple</h3><hr>
<p><strong>Tuple is an immutable and hashable list.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;tuple&gt; = ()</span><br><span class="line">&lt;tuple&gt; = (&lt;el&gt;, )</span><br><span class="line">&lt;tuple&gt; = (&lt;el_1&gt;, &lt;el_2&gt;, ...)</span><br></pre></td></tr></table></figure></p>
<h4 id="Named-Tuple"><a href="#Named-Tuple" class="headerlink" title="Named Tuple"></a>Named Tuple</h4><p><strong>Tuple’s subclass with named elements.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Point = namedtuple(<span class="string">'Point'</span>, <span class="string">'x y'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Point(<span class="number">1</span>, y=<span class="number">2</span>)</span><br><span class="line">Point(x=<span class="number">1</span>, y=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p[<span class="number">0</span>]</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.x</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(p, <span class="string">'y'</span>)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p._fields  <span class="comment"># Or: Point._fields</span></span><br><span class="line">(<span class="string">'x'</span>, <span class="string">'y'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Range"><a href="#Range" class="headerlink" title="Range"></a>Range</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;range&gt; = range(to_exclusive)</span><br><span class="line">&lt;range&gt; = range(from_inclusive, to_exclusive)</span><br><span class="line">&lt;range&gt; = range(from_inclusive, to_exclusive, ±step_size)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">from_inclusive = &lt;range&gt;.start</span><br><span class="line">to_exclusive   = &lt;range&gt;.stop</span><br></pre></td></tr></table></figure>
<h3 id="Enumerate"><a href="#Enumerate" class="headerlink" title="Enumerate"></a>Enumerate</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i, el <span class="keyword">in</span> enumerate(&lt;collection&gt; [, i_start]):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h3 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = iter(&lt;collection&gt;)                 <span class="comment"># Calling `iter(&lt;iter&gt;)` returns unmodified iterator.</span></span><br><span class="line">&lt;iter&gt; = iter(&lt;function&gt;, to_exclusive)     <span class="comment"># Sequence of return values until 'to_exclusive'.</span></span><br><span class="line">&lt;el&gt;   = next(&lt;iter&gt; [, default])           <span class="comment"># Raises StopIteration or returns 'default' on end.</span></span><br></pre></td></tr></table></figure>
<h4 id="Itertools"><a href="#Itertools" class="headerlink" title="Itertools"></a>Itertools</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count, repeat, cycle, chain, islice</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = count(start=<span class="number">0</span>, step=<span class="number">1</span>)             <span class="comment"># Returns incremented value endlessly.</span></span><br><span class="line">&lt;iter&gt; = repeat(&lt;el&gt; [, times])             <span class="comment"># Returns element endlessly or 'times' times.</span></span><br><span class="line">&lt;iter&gt; = cycle(&lt;collection&gt;)                <span class="comment"># Repeats the sequence indefinitely.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = chain(&lt;coll.&gt;, &lt;coll.&gt; [, ...])    <span class="comment"># Empties collections in order.</span></span><br><span class="line">&lt;iter&gt; = chain.from_iterable(&lt;collection&gt;)  <span class="comment"># Empties collections inside a collection in order.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = islice(&lt;collection&gt;, to_exclusive)</span><br><span class="line">&lt;iter&gt; = islice(&lt;collection&gt;, from_inclusive, to_exclusive)</span><br><span class="line">&lt;iter&gt; = islice(&lt;collection&gt;, from_inclusive, to_exclusive, +step_size)</span><br></pre></td></tr></table></figure>
<h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><hr>
<ul>
<li><strong>Convenient way to implement the iterator protocol.</strong></li>
<li><strong>Any function that contains a yield statement returns a generator object.</strong></li>
<li><strong>Generators and iterators are interchangeable.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(start, step)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> start</span><br><span class="line">        start += step</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = count(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(counter), next(counter), next(counter)</span><br><span class="line">(<span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h3><hr>
<ul>
<li><strong>Everything is an object.</strong></li>
<li><strong>Every object has a type.</strong></li>
<li><strong>Type and class are synonymous.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;type&gt; = type(&lt;el&gt;)                <span class="comment"># Or: &lt;el&gt;.__class__</span></span><br><span class="line">&lt;bool&gt; = isinstance(&lt;el&gt;, &lt;type&gt;)  <span class="comment"># Or: issubclass(type(&lt;el&gt;), &lt;type&gt;)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(<span class="string">'a'</span>), <span class="string">'a'</span>.__class__, str</span><br><span class="line">(&lt;class 'str'&gt;, &lt;class 'str'&gt;, &lt;class 'str'&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Some-types-do-not-have-builtin-names-so-they-must-be-imported"><a href="#Some-types-do-not-have-builtin-names-so-they-must-be-imported" class="headerlink" title="Some types do not have builtin names, so they must be imported:"></a>Some types do not have builtin names, so they must be imported:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> FunctionType, MethodType, LambdaType, GeneratorType</span><br></pre></td></tr></table></figure>
<h4 id="ABC"><a href="#ABC" class="headerlink" title="ABC"></a>ABC</h4><p><strong>An abstract base class introduces virtual subclasses, that don’t inherit from it but are still recognized by isinstance() and issubclass().</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Sequence, Collection, Iterable</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], Iterable)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+------------------+----------+------------+----------+</span><br><span class="line">|                  | Sequence | Collection | Iterable |</span><br><span class="line">+------------------+----------+------------+----------+</span><br><span class="line">| list, range, str |   yes    |    yes     |   yes    |</span><br><span class="line">| dict, set        |          |    yes     |   yes    |</span><br><span class="line">| iter             |          |            |   yes    |</span><br><span class="line">+------------------+----------+------------+----------+</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> numbers <span class="keyword">import</span> Integral, Rational, Real, Complex, Number</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(<span class="number">123</span>, Number)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+--------------------+----------+----------+------+---------+--------+</span><br><span class="line">|                    | Integral | Rational | Real | Complex | Number |</span><br><span class="line">+--------------------+----------+----------+------+---------+--------+</span><br><span class="line">| int                |   yes    |   yes    | yes  |   yes   |  yes   |</span><br><span class="line">| fractions.Fraction |          |   yes    | yes  |   yes   |  yes   |</span><br><span class="line">| float              |          |          | yes  |   yes   |  yes   |</span><br><span class="line">| complex            |          |          |      |   yes   |  yes   |</span><br><span class="line">+--------------------+----------+----------+------+---------+--------+</span><br></pre></td></tr></table></figure>
<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = &lt;str&gt;.strip()                       <span class="comment"># Strips all whitespace characters from both ends.</span></span><br><span class="line">&lt;str&gt;  = &lt;str&gt;.strip(<span class="string">'&lt;chars&gt;'</span>)              <span class="comment"># Strips all passed characters from both ends.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = &lt;str&gt;.split()                       <span class="comment"># Splits on one or more whitespace characters.</span></span><br><span class="line">&lt;list&gt; = &lt;str&gt;.split(sep=<span class="literal">None</span>, maxsplit=<span class="number">-1</span>)  <span class="comment"># Splits on 'sep' str at most 'maxsplit' times.</span></span><br><span class="line">&lt;list&gt; = &lt;str&gt;.splitlines(keepends=<span class="literal">False</span>)    <span class="comment"># Splits on line breaks. Keeps them if 'keepends'.</span></span><br><span class="line">&lt;str&gt;  = &lt;str&gt;.join(&lt;coll_of_strings&gt;)       <span class="comment"># Joins elements using string as separator.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = &lt;sub_str&gt; <span class="keyword">in</span> &lt;str&gt;                  <span class="comment"># Checks if string contains a substring.</span></span><br><span class="line">&lt;bool&gt; = &lt;str&gt;.startswith(&lt;sub_str&gt;)         <span class="comment"># Pass tuple of strings for multiple options.</span></span><br><span class="line">&lt;bool&gt; = &lt;str&gt;.endswith(&lt;sub_str&gt;)           <span class="comment"># Pass tuple of strings for multiple options.</span></span><br><span class="line">&lt;int&gt;  = &lt;str&gt;.find(&lt;sub_str&gt;)               <span class="comment"># Returns start index of first match or -1.</span></span><br><span class="line">&lt;int&gt;  = &lt;str&gt;.index(&lt;sub_str&gt;)              <span class="comment"># Same but raises ValueError.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = &lt;str&gt;.replace(old, new [, count])   <span class="comment"># Replaces 'old' with 'new' at most 'count' times.</span></span><br><span class="line">&lt;bool&gt; = &lt;str&gt;.isnumeric()                   <span class="comment"># True if str contains only numeric characters.</span></span><br><span class="line">&lt;list&gt; = textwrap.wrap(&lt;str&gt;, width)         <span class="comment"># Nicely breaks string into lines.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Also: <code>&#39;lstrip()&#39;</code>, <code>&#39;rstrip()&#39;</code>.</strong></li>
<li><strong>Also: <code>&#39;lower()&#39;</code>, <code>&#39;upper()&#39;</code>, <code>&#39;capitalize()&#39;</code> and <code>&#39;title()&#39;</code>.</strong></li>
</ul>
<h4 id="Char"><a href="#Char" class="headerlink" title="Char"></a>Char</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt; = chr(&lt;int&gt;)  <span class="comment"># Converts int to unicode char.</span></span><br><span class="line">&lt;int&gt; = ord(&lt;str&gt;)  <span class="comment"># Converts unicode char to int.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ord(<span class="string">'0'</span>), ord(<span class="string">'9'</span>)</span><br><span class="line">(<span class="number">48</span>, <span class="number">57</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ord(<span class="string">'A'</span>), ord(<span class="string">'Z'</span>)</span><br><span class="line">(<span class="number">65</span>, <span class="number">90</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ord(<span class="string">'a'</span>), ord(<span class="string">'z'</span>)</span><br><span class="line">(<span class="number">97</span>, <span class="number">122</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Regex"><a href="#Regex" class="headerlink" title="Regex"></a>Regex</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">&lt;str&gt;   = re.sub(&lt;regex&gt;, new, text, count=<span class="number">0</span>)  <span class="comment"># Substitutes all occurrences.</span></span><br><span class="line">&lt;list&gt;  = re.findall(&lt;regex&gt;, text)            <span class="comment"># Returns all occurrences.</span></span><br><span class="line">&lt;list&gt;  = re.split(&lt;regex&gt;, text, maxsplit=<span class="number">0</span>)  <span class="comment"># Use brackets in regex to keep the matches.</span></span><br><span class="line">&lt;Match&gt; = re.search(&lt;regex&gt;, text)             <span class="comment"># Searches for first occurrence of pattern.</span></span><br><span class="line">&lt;Match&gt; = re.match(&lt;regex&gt;, text)              <span class="comment"># Searches only at the beginning of the text.</span></span><br><span class="line">&lt;iter&gt;  = re.finditer(&lt;regex&gt;, text)           <span class="comment"># Returns all occurrences as match objects.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Argument <code>&#39;flags=re.IGNORECASE&#39;</code> can be used with all functions.</strong></li>
<li><strong>Argument <code>&#39;flags=re.MULTILINE&#39;</code> makes <code>&#39;^&#39;</code> and <code>&#39;$&#39;</code> match the start/end of each line.</strong></li>
<li><strong>Argument <code>&#39;flags=re.DOTALL&#39;</code> makes dot also accept newline.</strong></li>
<li><strong>Use <code>r&#39;\1&#39;</code> or <code>&#39;\\1&#39;</code> for backreference.</strong></li>
<li><strong>Use <code>&#39;?&#39;</code> to make an operator non-greedy.</strong></li>
</ul>
<h4 id="Match-Object"><a href="#Match-Object" class="headerlink" title="Match Object"></a>Match Object</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;   = &lt;Match&gt;.group()   <span class="comment"># Whole match. Also group(0).</span></span><br><span class="line">&lt;str&gt;   = &lt;Match&gt;.group(<span class="number">1</span>)  <span class="comment"># Part in first bracket.</span></span><br><span class="line">&lt;tuple&gt; = &lt;Match&gt;.groups()  <span class="comment"># All bracketed parts.</span></span><br><span class="line">&lt;int&gt;   = &lt;Match&gt;.start()   <span class="comment"># Start index of a match.</span></span><br><span class="line">&lt;int&gt;   = &lt;Match&gt;.end()     <span class="comment"># Exclusive end index of a match.</span></span><br></pre></td></tr></table></figure>
<h4 id="Special-Sequences"><a href="#Special-Sequences" class="headerlink" title="Special Sequences"></a>Special Sequences</h4><ul>
<li><strong>By default digits, whitespaces and alphanumerics from all alphabets are matched, unless <code>&#39;flags=re.ASCII&#39;</code> argument is used.</strong></li>
<li><strong>Use capital letters for negation.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'\d'</span> == <span class="string">'[0-9]'</span>             <span class="comment"># Digit</span></span><br><span class="line"><span class="string">'\s'</span> == <span class="string">'[ \t\n\r\f\v]'</span>     <span class="comment"># Whitespace</span></span><br><span class="line"><span class="string">'\w'</span> == <span class="string">'[a-zA-Z0-9_]'</span>      <span class="comment"># Alphanumeric</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Format"><a href="#Format" class="headerlink" title="Format"></a>Format</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt; = <span class="string">f'<span class="subst">&#123;&lt;el_1&gt;&#125;</span>, <span class="subst">&#123;&lt;el_2&gt;&#125;</span>'</span></span><br><span class="line">&lt;str&gt; = <span class="string">'&#123;&#125;, &#123;&#125;'</span>.format(&lt;el_1&gt;, &lt;el_2&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Person = namedtuple(<span class="string">'Person'</span>, <span class="string">'name height'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person = Person(<span class="string">'Jean-Luc'</span>, <span class="number">187</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f'<span class="subst">&#123;person.height&#125;</span>'</span></span><br><span class="line"><span class="string">'187'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'&#123;p.height&#125;'</span>.format(p=person)</span><br><span class="line"><span class="string">'187'</span></span><br></pre></td></tr></table></figure>
<h4 id="General-Options"><a href="#General-Options" class="headerlink" title="General Options"></a>General Options</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&lt;el&gt;:&lt;<span class="number">10</span>&#125;       <span class="comment"># '&lt;el&gt;      '</span></span><br><span class="line">&#123;&lt;el&gt;:^<span class="number">10</span>&#125;       <span class="comment"># '   &lt;el&gt;   '</span></span><br><span class="line">&#123;&lt;el&gt;:&gt;<span class="number">10</span>&#125;       <span class="comment"># '      &lt;el&gt;'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&lt;el&gt;:.&lt;<span class="number">10</span>&#125;      <span class="comment"># '&lt;el&gt;......'</span></span><br><span class="line">&#123;&lt;el&gt;:&gt;<span class="number">0</span>&#125;        <span class="comment"># '&lt;el&gt;'</span></span><br></pre></td></tr></table></figure>
<h4 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h4><p><strong><code>&#39;!r&#39;</code> calls object’s repr() method, instead of str(), to get a string.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">'abcde'</span>!r:&lt;<span class="number">10</span>&#125;  <span class="comment"># "'abcde'   "</span></span><br><span class="line">&#123;<span class="string">'abcde'</span>:<span class="number">.3</span>&#125;     <span class="comment"># 'abc'</span></span><br><span class="line">&#123;<span class="string">'abcde'</span>:<span class="number">10.3</span>&#125;   <span class="comment"># 'abc       '</span></span><br></pre></td></tr></table></figure></p>
<h4 id="Numbers"><a href="#Numbers" class="headerlink" title="Numbers"></a>Numbers</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123; <span class="number">123456</span>:<span class="number">10</span>,&#125;    <span class="comment"># '   123,456'</span></span><br><span class="line">&#123; <span class="number">123456</span>:<span class="number">10</span>_&#125;    <span class="comment"># '   123_456'</span></span><br><span class="line">&#123; <span class="number">123456</span>:+<span class="number">10</span>&#125;    <span class="comment"># '   +123456'</span></span><br><span class="line">&#123;<span class="number">-123456</span>:=<span class="number">10</span>&#125;    <span class="comment"># '-   123456'</span></span><br><span class="line">&#123; <span class="number">123456</span>: &#125;      <span class="comment"># ' 123456'</span></span><br><span class="line">&#123;<span class="number">-123456</span>: &#125;      <span class="comment"># '-123456'</span></span><br></pre></td></tr></table></figure>
<h4 id="Floats"><a href="#Floats" class="headerlink" title="Floats"></a>Floats</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>&#125;   <span class="comment"># '      1.23'</span></span><br><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>f&#125;  <span class="comment"># '     1.235'</span></span><br><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>e&#125;  <span class="comment"># ' 1.235e+00'</span></span><br><span class="line">&#123;<span class="number">1.23456</span>:<span class="number">10.3</span>%&#125;  <span class="comment"># '  123.456%'</span></span><br></pre></td></tr></table></figure>
<h4 id="Comparison-of-float-presentation-types"><a href="#Comparison-of-float-presentation-types" class="headerlink" title="Comparison of float presentation types:"></a>Comparison of float presentation types:</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|                |    &#123;&lt;float&gt;&#125;   |  &#123;&lt;float&gt;:f&#125;  |   &#123;&lt;float&gt;:e&#125;  |   &#123;&lt;float&gt;:%&#125;   |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|    0.000056789 |   &#39;5.6789e-05&#39; |    &#39;0.000057&#39; | &#39;5.678900e-05&#39; |     &#39;0.005679%&#39; |</span><br><span class="line">|    0.00056789  |   &#39;0.00056789&#39; |    &#39;0.000568&#39; | &#39;5.678900e-04&#39; |     &#39;0.056789%&#39; |</span><br><span class="line">|    0.0056789   |   &#39;0.0056789&#39;  |    &#39;0.005679&#39; | &#39;5.678900e-03&#39; |     &#39;0.567890%&#39; |</span><br><span class="line">|    0.056789    |   &#39;0.056789&#39;   |    &#39;0.056789&#39; | &#39;5.678900e-02&#39; |     &#39;5.678900%&#39; |</span><br><span class="line">|    0.56789     |   &#39;0.56789&#39;    |    &#39;0.567890&#39; | &#39;5.678900e-01&#39; |    &#39;56.789000%&#39; |</span><br><span class="line">|    5.6789      |   &#39;5.6789&#39;     |    &#39;5.678900&#39; | &#39;5.678900e+00&#39; |   &#39;567.890000%&#39; |</span><br><span class="line">|   56.789       |  &#39;56.789&#39;      |   &#39;56.789000&#39; | &#39;5.678900e+01&#39; |  &#39;5678.900000%&#39; |</span><br><span class="line">|  567.89        | &#39;567.89&#39;       |  &#39;567.890000&#39; | &#39;5.678900e+02&#39; | &#39;56789.000000%&#39; |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|                |  &#123;&lt;float&gt;:.2&#125;  | &#123;&lt;float&gt;:.2f&#125; |  &#123;&lt;float&gt;:.2e&#125; |  &#123;&lt;float&gt;:.2%&#125;  |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br><span class="line">|    0.000056789 |   &#39;5.7e-05&#39;    |      &#39;0.00&#39;   |   &#39;5.68e-05&#39;   |       &#39;0.01%&#39;   |</span><br><span class="line">|    0.00056789  |   &#39;0.00057&#39;    |      &#39;0.00&#39;   |   &#39;5.68e-04&#39;   |       &#39;0.06%&#39;   |</span><br><span class="line">|    0.0056789   |   &#39;0.0057&#39;     |      &#39;0.01&#39;   |   &#39;5.68e-03&#39;   |       &#39;0.57%&#39;   |</span><br><span class="line">|    0.056789    |   &#39;0.057&#39;      |      &#39;0.06&#39;   |   &#39;5.68e-02&#39;   |       &#39;5.68%&#39;   |</span><br><span class="line">|    0.56789     |   &#39;0.57&#39;       |      &#39;0.57&#39;   |   &#39;5.68e-01&#39;   |      &#39;56.79%&#39;   |</span><br><span class="line">|    5.6789      |   &#39;5.7&#39;        |      &#39;5.68&#39;   |   &#39;5.68e+00&#39;   |     &#39;567.89%&#39;   |</span><br><span class="line">|   56.789       |   &#39;5.7e+01&#39;    |     &#39;56.79&#39;   |   &#39;5.68e+01&#39;   |    &#39;5678.90%&#39;   |</span><br><span class="line">|  567.89        |   &#39;5.7e+02&#39;    |    &#39;567.89&#39;   |   &#39;5.68e+02&#39;   |   &#39;56789.00%&#39;   |</span><br><span class="line">+----------------+----------------+---------------+----------------+-----------------+</span><br></pre></td></tr></table></figure>
<h4 id="Ints"><a href="#Ints" class="headerlink" title="Ints"></a>Ints</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="number">90</span>:c&#125;           <span class="comment"># 'Z'</span></span><br><span class="line">&#123;<span class="number">90</span>:X&#125;           <span class="comment"># '5A'</span></span><br><span class="line">&#123;<span class="number">90</span>:b&#125;           <span class="comment"># '1011010'</span></span><br></pre></td></tr></table></figure>
<h3 id="Numbers-1"><a href="#Numbers-1" class="headerlink" title="Numbers"></a>Numbers</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;int&gt;      = int(&lt;float/str/bool&gt;)    <span class="comment"># Or: math.floor(&lt;float&gt;)</span></span><br><span class="line">&lt;float&gt;    = float(&lt;int/str/bool&gt;)</span><br><span class="line">&lt;complex&gt;  = complex(real=<span class="number">0</span>, imag=<span class="number">0</span>)  <span class="comment"># Or: &lt;real&gt; + &lt;real&gt;j</span></span><br><span class="line">&lt;Fraction&gt; = fractions.Fraction(numerator=<span class="number">0</span>, denominator=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>&#39;int(&lt;str&gt;)&#39;</code> and <code>&#39;float(&lt;str&gt;)&#39;</code> raise ‘ValueError’ on malformed strings.</strong></li>
</ul>
<h4 id="Basic-Functions"><a href="#Basic-Functions" class="headerlink" title="Basic Functions"></a>Basic Functions</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;num&gt;  = pow(&lt;num&gt;, &lt;num&gt;)            <span class="comment"># Or: &lt;num&gt; ** &lt;num&gt;</span></span><br><span class="line">&lt;real&gt; = abs(&lt;num&gt;)</span><br><span class="line">&lt;int&gt;  = round(&lt;real&gt;)</span><br><span class="line">&lt;real&gt; = round(&lt;real&gt;, ±ndigits)      <span class="comment"># `round(126, -1) == 130`</span></span><br></pre></td></tr></table></figure>
<h4 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> e, pi, inf, nan</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> cos, acos, sin, asin, tan, atan, degrees, radians</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> log, log10, log2</span><br></pre></td></tr></table></figure>
<h4 id="Statistics"><a href="#Statistics" class="headerlink" title="Statistics"></a>Statistics</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> statistics <span class="keyword">import</span> mean, median, variance, pvariance, pstdev</span><br></pre></td></tr></table></figure>
<h4 id="Random"><a href="#Random" class="headerlink" title="Random"></a>Random</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> random, randint, choice, shuffle</span><br><span class="line">&lt;float&gt; = random()</span><br><span class="line">&lt;int&gt;   = randint(from_inclusive, to_inclusive)</span><br><span class="line">&lt;el&gt;    = choice(&lt;list&gt;)</span><br><span class="line">shuffle(&lt;list&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Bin-Hex"><a href="#Bin-Hex" class="headerlink" title="Bin, Hex"></a>Bin, Hex</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;int&gt;     = <span class="number">0</span>b&lt;bin&gt;            <span class="comment"># Or: 0x&lt;hex&gt;</span></span><br><span class="line">&lt;int&gt;     = int(<span class="string">'0b&lt;bin&gt;'</span>, <span class="number">0</span>)  <span class="comment"># Or: int('0x&lt;hex&gt;', 0)</span></span><br><span class="line">&lt;int&gt;     = int(<span class="string">'&lt;bin&gt;'</span>, <span class="number">2</span>)    <span class="comment"># Or: int('&lt;hex&gt;', 16)</span></span><br><span class="line"><span class="string">'0b&lt;bin&gt;'</span> = bin(&lt;int&gt;)         <span class="comment"># Or: '0x&lt;hex&gt;' = hex(&lt;int&gt;)</span></span><br></pre></td></tr></table></figure>
<h4 id="Bitwise-Operators"><a href="#Bitwise-Operators" class="headerlink" title="Bitwise Operators"></a>Bitwise Operators</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;int&gt;     = &lt;int&gt; &amp; &lt;int&gt;      <span class="comment"># And</span></span><br><span class="line">&lt;int&gt;     = &lt;int&gt; | &lt;int&gt;      <span class="comment"># Or</span></span><br><span class="line">&lt;int&gt;     = &lt;int&gt; ^ &lt;int&gt;      <span class="comment"># Xor (0 if both bits equal)</span></span><br><span class="line">&lt;int&gt;     = &lt;int&gt; &lt;&lt; n_bits    <span class="comment"># Shift left</span></span><br><span class="line">&lt;int&gt;     = &lt;int&gt; &gt;&gt; n_bits    <span class="comment"># Shift right</span></span><br><span class="line">&lt;int&gt;     = ~&lt;int&gt;             <span class="comment"># Compliment (flips bits)</span></span><br></pre></td></tr></table></figure>
<h3 id="Combinatorics"><a href="#Combinatorics" class="headerlink" title="Combinatorics"></a>Combinatorics</h3><hr>
<ul>
<li><strong>Every function returns an iterator.</strong></li>
<li><strong>If you want to print the iterator, you need to pass it to the list() function!</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product, combinations, combinations_with_replacement, permutations</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>product([<span class="number">0</span>, <span class="number">1</span>], repeat=<span class="number">3</span>)</span><br><span class="line">[(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line"> (<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>product(<span class="string">'ab'</span>, <span class="string">'12'</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'1'</span>), (<span class="string">'a'</span>, <span class="string">'2'</span>),</span><br><span class="line"> (<span class="string">'b'</span>, <span class="string">'1'</span>), (<span class="string">'b'</span>, <span class="string">'2'</span>)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>combinations(<span class="string">'abc'</span>, <span class="number">2</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'b'</span>), (<span class="string">'a'</span>, <span class="string">'c'</span>), (<span class="string">'b'</span>, <span class="string">'c'</span>)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>combinations_with_replacement(<span class="string">'abc'</span>, <span class="number">2</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'a'</span>), (<span class="string">'a'</span>, <span class="string">'b'</span>), (<span class="string">'a'</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="string">'b'</span>, <span class="string">'b'</span>), (<span class="string">'b'</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="string">'c'</span>, <span class="string">'c'</span>)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>permutations(<span class="string">'abc'</span>, <span class="number">2</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'b'</span>), (<span class="string">'a'</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="string">'b'</span>, <span class="string">'a'</span>), (<span class="string">'b'</span>, <span class="string">'c'</span>),</span><br><span class="line"> (<span class="string">'c'</span>, <span class="string">'a'</span>), (<span class="string">'c'</span>, <span class="string">'b'</span>)]</span><br></pre></td></tr></table></figure>
<h3 id="Datetime"><a href="#Datetime" class="headerlink" title="Datetime"></a>Datetime</h3><hr>
<ul>
<li><strong>Module ‘datetime’ provides ‘date’ <code>&lt;D&gt;</code>, ‘time’ <code>&lt;T&gt;</code>, ‘datetime’ <code>&lt;DT&gt;</code> and ‘timedelta’ <code>&lt;TD&gt;</code> classes. All are immutable and hashable.</strong></li>
<li><strong>Time and datetime can be ‘aware’ <code>&lt;a&gt;</code>, meaning they have defined timezone, or ‘naive’ <code>&lt;n&gt;</code>, meaning they don’t.</strong></li>
<li><strong>If object is naive it is presumed to be in system’s timezone.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date, time, datetime, timedelta</span><br><span class="line"><span class="keyword">from</span> dateutil.tz <span class="keyword">import</span> UTC, tzlocal, gettz</span><br></pre></td></tr></table></figure>
<h4 id="Constructors"><a href="#Constructors" class="headerlink" title="Constructors"></a>Constructors</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;D&gt;  = date(year, month, day)</span><br><span class="line">&lt;T&gt;  = time(hour=<span class="number">0</span>, minute=<span class="number">0</span>, second=<span class="number">0</span>, microsecond=<span class="number">0</span>, tzinfo=<span class="literal">None</span>, fold=<span class="number">0</span>)</span><br><span class="line">&lt;DT&gt; = datetime(year, month, day, hour=<span class="number">0</span>, minute=<span class="number">0</span>, second=<span class="number">0</span>, ...)</span><br><span class="line">&lt;TD&gt; = timedelta(days=<span class="number">0</span>, seconds=<span class="number">0</span>, microseconds=<span class="number">0</span>, milliseconds=<span class="number">0</span>,</span><br><span class="line">                 minutes=<span class="number">0</span>, hours=<span class="number">0</span>, weeks=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Use <code>&#39;&lt;D/DT&gt;.weekday()&#39;</code> to get the day of the week (Mon == 0).</strong></li>
<li><strong><code>&#39;fold=1&#39;</code> means second pass in case of time jumping back for one hour.</strong></li>
</ul>
<h4 id="Now"><a href="#Now" class="headerlink" title="Now"></a>Now</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;D/DTn&gt;  = D/DT.today()                     <span class="comment"># Current local date or naive datetime.</span></span><br><span class="line">&lt;DTn&gt;    = DT.utcnow()                      <span class="comment"># Naive datetime from current UTC time.</span></span><br><span class="line">&lt;DTa&gt;    = DT.now(&lt;tzinfo&gt;)                 <span class="comment"># Aware datetime from current tz time.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>To extract time use <code>&#39;&lt;DTn&gt;.time()&#39;</code>, <code>&#39;&lt;DTa&gt;.time()&#39;</code> or <code>&#39;&lt;DTa&gt;.timetz()&#39;</code>.</strong></li>
</ul>
<h4 id="Timezone"><a href="#Timezone" class="headerlink" title="Timezone"></a>Timezone</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;tzinfo&gt; = UTC                              <span class="comment"># UTC timezone. London without DST.</span></span><br><span class="line">&lt;tzinfo&gt; = tzlocal()                        <span class="comment"># Local timezone. Also gettz().</span></span><br><span class="line">&lt;tzinfo&gt; = gettz(<span class="string">'&lt;Cont.&gt;/&lt;City&gt;'</span>)          <span class="comment"># Timezone from 'Continent/City_Name' str.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;DTa&gt;    = &lt;DT&gt;.astimezone(&lt;tzinfo&gt;)        <span class="comment"># Datetime, converted to passed timezone.</span></span><br><span class="line">&lt;Ta/DTa&gt; = &lt;T/DT&gt;.replace(tzinfo=&lt;tzinfo&gt;)  <span class="comment"># Unconverted object with new timezone.</span></span><br></pre></td></tr></table></figure>
<h4 id="Encode"><a href="#Encode" class="headerlink" title="Encode"></a>Encode</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;D/T/DT&gt; = D/T/DT.fromisoformat(<span class="string">'&lt;iso&gt;'</span>)    <span class="comment"># Object from ISO string.</span></span><br><span class="line">&lt;DT&gt;     = DT.strptime(&lt;str&gt;, <span class="string">'&lt;format&gt;'</span>)   <span class="comment"># Datetime from str, according to format.</span></span><br><span class="line">&lt;D/DTn&gt;  = D/DT.fromordinal(&lt;int&gt;)          <span class="comment"># D/DTn from days since Christ, at midnight.</span></span><br><span class="line">&lt;DTn&gt;    = DT.fromtimestamp(&lt;real&gt;)         <span class="comment"># Local time DTn from seconds since Epoch.</span></span><br><span class="line">&lt;DTa&gt;    = DT.fromtimestamp(&lt;real&gt;, &lt;tz.&gt;)  <span class="comment"># Aware datetime from seconds since Epoch.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ISO strings come in following forms: <code>&#39;YYYY-MM-DD&#39;</code>, <code>&#39;HH:MM:SS.ffffff[±&lt;offset&gt;]&#39;</code>, or both separated by <code>&#39;T&#39;</code>. Offset is formatted as: <code>&#39;HH:MM&#39;</code>.</strong></li>
<li><strong>On Unix systems Epoch is <code>&#39;1970-01-01 00:00 UTC&#39;</code>, <code>&#39;1970-01-01 01:00 CET&#39;</code>, …</strong></li>
</ul>
<h4 id="Decode"><a href="#Decode" class="headerlink" title="Decode"></a>Decode</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;    = &lt;D/T/DT&gt;.isoformat()             <span class="comment"># ISO string representation.</span></span><br><span class="line">&lt;str&gt;    = &lt;D/T/DT&gt;.strftime(<span class="string">'&lt;format&gt;'</span>)    <span class="comment"># Custom string representation.</span></span><br><span class="line">&lt;int&gt;    = &lt;D/DT&gt;.toordinal()               <span class="comment"># Days since Christ, ignoring time and tz.</span></span><br><span class="line">&lt;float&gt;  = &lt;DTn&gt;.timestamp()                <span class="comment"># Seconds since Epoch from DTn in local time.</span></span><br><span class="line">&lt;float&gt;  = &lt;DTa&gt;.timestamp()                <span class="comment"># Seconds since Epoch from DTa.</span></span><br></pre></td></tr></table></figure>
<h4 id="Format-1"><a href="#Format-1" class="headerlink" title="Format"></a>Format</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt = datetime.strptime(<span class="string">'2015-05-14 23:39:00.00 +0200'</span>, <span class="string">'%Y-%m-%d %H:%M:%S.%f %z'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dt.strftime(<span class="string">"%A, %dth of %B '%y, %I:%M%p %Z"</span>)</span><br><span class="line"><span class="string">"Thursday, 14th of May '15, 11:39PM UTC+02:00"</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>For abbreviated weekday and month use <code>&#39;%a&#39;</code> and <code>&#39;%b&#39;</code>.</strong></li>
<li><strong>When parsing, <code>&#39;%z&#39;</code> also accepts <code>&#39;±HH:MM&#39;</code>.</strong></li>
</ul>
<h4 id="Arithmetics"><a href="#Arithmetics" class="headerlink" title="Arithmetics"></a>Arithmetics</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;D/DT&gt;   = &lt;D/DT&gt; ±  &lt;TD&gt;</span><br><span class="line">&lt;TD&gt;     = &lt;TD&gt;   ±  &lt;TD&gt;</span><br><span class="line">&lt;TD&gt;     = &lt;TD&gt;   */ &lt;real&gt;</span><br><span class="line">&lt;float&gt;  = &lt;TD&gt;   /  &lt;TD&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Arguments"><a href="#Arguments" class="headerlink" title="Arguments"></a>Arguments</h3><hr>
<h4 id="Inside-Function-Call"><a href="#Inside-Function-Call" class="headerlink" title="Inside Function Call"></a>Inside Function Call</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;function&gt;(&lt;positional_args&gt;)                  <span class="comment"># f(0, 0)</span></span><br><span class="line">&lt;function&gt;(&lt;keyword_args&gt;)                     <span class="comment"># f(x=0, y=0)</span></span><br><span class="line">&lt;function&gt;(&lt;positional_args&gt;, &lt;keyword_args&gt;)  <span class="comment"># f(0, y=0)</span></span><br></pre></td></tr></table></figure>
<h4 id="Inside-Function-Definition"><a href="#Inside-Function-Definition" class="headerlink" title="Inside Function Definition"></a>Inside Function Definition</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(&lt;nondefault_args&gt;)</span>:</span>                      <span class="comment"># def f(x, y):</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(&lt;default_args&gt;)</span>:</span>                         <span class="comment"># def f(x=0, y=0):</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(&lt;nondefault_args&gt;, &lt;default_args&gt;)</span>:</span>      <span class="comment"># def f(x, y=0):</span></span><br></pre></td></tr></table></figure>
<h3 id="Splat-Operator"><a href="#Splat-Operator" class="headerlink" title="Splat Operator"></a>Splat Operator</h3><hr>
<h4 id="Inside-Function-Call-1"><a href="#Inside-Function-Call-1" class="headerlink" title="Inside Function Call"></a>Inside Function Call</h4><p><strong>Splat expands a collection into positional arguments, while splatty-splat expands a dictionary into keyword arguments.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">args   = (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">kwargs = &#123;<span class="string">'x'</span>: <span class="number">3</span>, <span class="string">'y'</span>: <span class="number">4</span>, <span class="string">'z'</span>: <span class="number">5</span>&#125;</span><br><span class="line">func(*args, **kwargs)</span><br></pre></td></tr></table></figure></p>
<h5 id="Is-the-same-as"><a href="#Is-the-same-as" class="headerlink" title="Is the same as:"></a>Is the same as:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, x=<span class="number">3</span>, y=<span class="number">4</span>, z=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Inside-Function-Definition-1"><a href="#Inside-Function-Definition-1" class="headerlink" title="Inside Function Definition"></a>Inside Function Definition</h4><p><strong>Splat combines zero or more positional arguments into a tuple, while splatty-splat combines zero or more keyword arguments into a dictionary.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(*a)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> sum(a)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>
<h5 id="Legal-argument-combinations"><a href="#Legal-argument-combinations" class="headerlink" title="Legal argument combinations:"></a>Legal argument combinations:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, y, z)</span>:</span>                <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3) | f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*, x, y, z)</span>:</span>             <span class="comment"># f(x=1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *, y, z)</span>:</span>             <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, y, *, z)</span>:</span>             <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*args)</span>:</span>                  <span class="comment"># f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *args)</span>:</span>               <span class="comment"># f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*args, z)</span>:</span>               <span class="comment"># f(1, 2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *args, z)</span>:</span>            <span class="comment"># f(1, 2, z=3)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(**kwargs)</span>:</span>               <span class="comment"># f(x=1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, **kwargs)</span>:</span>            <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*, x, **kwargs)</span>:</span>         <span class="comment"># f(x=1, y=2, z=3)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*args, **kwargs)</span>:</span>        <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3) | f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *args, **kwargs)</span>:</span>     <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3) | f(1, 2, 3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*args, y, **kwargs)</span>:</span>     <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, *args, z, **kwargs)</span>:</span>  <span class="comment"># f(x=1, y=2, z=3) | f(1, y=2, z=3) | f(1, 2, z=3)</span></span><br></pre></td></tr></table></figure>
<h4 id="Other-Uses"><a href="#Other-Uses" class="headerlink" title="Other Uses"></a>Other Uses</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt;  = [*&lt;collection&gt; [, ...]]</span><br><span class="line">&lt;set&gt;   = &#123;*&lt;collection&gt; [, ...]&#125;</span><br><span class="line">&lt;tuple&gt; = (*&lt;collection&gt;, [...])</span><br><span class="line">&lt;dict&gt;  = &#123;**&lt;dict&gt; [, ...]&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">head, *body, tail = &lt;collection&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Inline"><a href="#Inline" class="headerlink" title="Inline"></a>Inline</h3><hr>
<h4 id="Lambda"><a href="#Lambda" class="headerlink" title="Lambda"></a>Lambda</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;function&gt; = <span class="keyword">lambda</span>: &lt;return_value&gt;</span><br><span class="line">&lt;function&gt; = <span class="keyword">lambda</span> &lt;argument_1&gt;, &lt;argument_2&gt;: &lt;return_value&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Comprehension"><a href="#Comprehension" class="headerlink" title="Comprehension"></a>Comprehension</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = [i+<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]                   <span class="comment"># [1, 2, ..., 10]</span></span><br><span class="line">&lt;set&gt;  = &#123;i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> i &gt; <span class="number">5</span>&#125;            <span class="comment"># &#123;6, 7, 8, 9&#125;</span></span><br><span class="line">&lt;iter&gt; = (i+<span class="number">5</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>))                   <span class="comment"># (5, 6, ..., 14)</span></span><br><span class="line">&lt;dict&gt; = &#123;i: i*<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)&#125;                <span class="comment"># &#123;0: 0, 1: 2, ..., 9: 18&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">out = [i+j <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br></pre></td></tr></table></figure>
<h4 id="Is-the-same-as-1"><a href="#Is-the-same-as-1" class="headerlink" title="Is the same as:"></a>Is the same as:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">out = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        out.append(i+j)</span><br></pre></td></tr></table></figure>
<h3 id="Map-Filter-Reduce"><a href="#Map-Filter-Reduce" class="headerlink" title="Map, Filter, Reduce"></a>Map, Filter, Reduce</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line">&lt;iter&gt; = map(<span class="keyword">lambda</span> x: x + <span class="number">1</span>, range(<span class="number">10</span>))            <span class="comment"># (1, 2, ..., 10)</span></span><br><span class="line">&lt;iter&gt; = filter(<span class="keyword">lambda</span> x: x &gt; <span class="number">5</span>, range(<span class="number">10</span>))         <span class="comment"># (6, 7, 8, 9)</span></span><br><span class="line">&lt;int&gt;  = reduce(<span class="keyword">lambda</span> out, x: out + x, range(<span class="number">10</span>))  <span class="comment"># 45</span></span><br></pre></td></tr></table></figure>
<h4 id="Any-All"><a href="#Any-All" class="headerlink" title="Any, All"></a>Any, All</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = any(&lt;collection&gt;)                          <span class="comment"># False if empty.</span></span><br><span class="line">&lt;bool&gt; = all(el[<span class="number">1</span>] <span class="keyword">for</span> el <span class="keyword">in</span> &lt;collection&gt;)          <span class="comment"># True if empty.</span></span><br></pre></td></tr></table></figure>
<h4 id="If-Else"><a href="#If-Else" class="headerlink" title="If - Else"></a>If - Else</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;expression_if_true&gt; <span class="keyword">if</span> &lt;condition&gt; <span class="keyword">else</span> &lt;expression_if_false&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[a <span class="keyword">if</span> a <span class="keyword">else</span> <span class="string">'zero'</span> <span class="keyword">for</span> a <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>)]</span><br><span class="line">[<span class="string">'zero'</span>, <span class="number">1</span>, <span class="string">'zero'</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<h4 id="Namedtuple-Enum-Dataclass"><a href="#Namedtuple-Enum-Dataclass" class="headerlink" title="Namedtuple, Enum, Dataclass"></a>Namedtuple, Enum, Dataclass</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">Point     = namedtuple(<span class="string">'Point'</span>, <span class="string">'x y'</span>)</span><br><span class="line">point     = Point(<span class="number">0</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line">Direction = Enum(<span class="string">'Direction'</span>, <span class="string">'n e s w'</span>)</span><br><span class="line">direction = Direction.n</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> make_dataclass</span><br><span class="line">Creature  = make_dataclass(<span class="string">'Creature'</span>, [<span class="string">'location'</span>, <span class="string">'direction'</span>])</span><br><span class="line">creature  = Creature(Point(<span class="number">0</span>, <span class="number">0</span>), Direction.n)</span><br></pre></td></tr></table></figure>
<h3 id="Closure"><a href="#Closure" class="headerlink" title="Closure"></a>Closure</h3><hr>
<p><strong>We have a closure in Python when:</strong></p>
<ul>
<li><strong>A nested function references a value of its enclosing function and then</strong></li>
<li><strong>the enclosing function returns the nested function.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_multiplier</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(b)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> a * b</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3 = get_multiplier(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If multiple nested functions within enclosing function reference the same value, that value gets shared.</strong></li>
<li><strong>To dynamically access function’s first free variable use <code>&#39;&lt;function&gt;.__closure__[0].cell_contents&#39;</code>.</strong></li>
</ul>
<h4 id="Partial"><a href="#Partial" class="headerlink" title="Partial"></a>Partial</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line">&lt;function&gt; = partial(&lt;function&gt; [, &lt;arg_1&gt;, &lt;arg_2&gt;, ...])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> operator <span class="keyword">as</span> op</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3 = partial(op.mul, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>multiply_by_3(<span class="number">10</span>)</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Partial is also useful in cases when a function needs to be passed as an argument, because it enables us to set its arguments beforehand.</strong></li>
<li><strong>A few examples being <code>&#39;defaultdict(&lt;function&gt;)&#39;</code>, <code>&#39;iter(&lt;function&gt;, to_exclusive)&#39;</code> and dataclass’s <code>&#39;field(default_factory=&lt;function&gt;)&#39;</code>.</strong></li>
</ul>
<h4 id="Nonlocal"><a href="#Nonlocal" class="headerlink" title="Nonlocal"></a>Nonlocal</h4><p><strong>If variable is being assigned to anywhere in the scope, it is regarded as a local variable, unless it is declared as a ‘global’ or a ‘nonlocal’.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_counter</span><span class="params">()</span>:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = get_counter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter(), counter(), counter()</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Decorator"><a href="#Decorator" class="headerlink" title="Decorator"></a>Decorator</h3><hr>
<p><strong>A decorator takes a function, adds some functionality and returns it.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@decorator_name</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function_that_gets_passed_to_decorator</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h4 id="Debugger-Example"><a href="#Debugger-Example" class="headerlink" title="Debugger Example"></a>Debugger Example</h4><p><strong>Decorator that prints function’s name every time it gets called.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(func.__name__)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="meta">@debug</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Wraps is a helper decorator that copies metadata of function add() to function out().</strong></li>
<li><strong>Without it <code>&#39;add.__name__&#39;</code> would return <code>&#39;out&#39;</code>.</strong></li>
</ul>
<h4 id="LRU-Cache"><a href="#LRU-Cache" class="headerlink" title="LRU Cache"></a>LRU Cache</h4><p><strong>Decorator that caches function’s return values. All function’s arguments must be hashable.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"></span><br><span class="line"><span class="meta">@lru_cache(maxsize=None)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> n <span class="keyword">if</span> n &lt; <span class="number">2</span> <span class="keyword">else</span> fib(n<span class="number">-2</span>) + fib(n<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Recursion depth is limited to 1000 by default. To increase it use <code>&#39;sys.setrecursionlimit(&lt;depth&gt;)&#39;</code>.</strong></li>
</ul>
<h4 id="Parametrized-Decorator"><a href="#Parametrized-Decorator" class="headerlink" title="Parametrized Decorator"></a>Parametrized Decorator</h4><p><strong>A decorator that accepts arguments and returns a normal decorator that accepts a function.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">(print_result=False)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">        @wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            result = func(*args, **kwargs)</span><br><span class="line">            print(func.__name__, result <span class="keyword">if</span> print_result <span class="keyword">else</span> <span class="string">''</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@debug(print_result=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure></p>
<h3 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">name</span>&gt;:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        class_name = self.__class__.__name__</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'<span class="subst">&#123;class_name&#125;</span>(<span class="subst">&#123;self.a!r&#125;</span>)'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self.a)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_class_name</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.__name__</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Return value of repr() should be unambiguous and of str() readable.</strong></li>
<li><strong>If only repr() is defined, it will be also used for str().</strong></li>
</ul>
<h4 id="Str-use-cases"><a href="#Str-use-cases" class="headerlink" title="Str() use cases:"></a>Str() use cases:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(&lt;el&gt;)</span><br><span class="line">print(<span class="string">f'<span class="subst">&#123;&lt;el&gt;&#125;</span>'</span>)</span><br><span class="line"><span class="keyword">raise</span> Exception(&lt;el&gt;)</span><br><span class="line">logging.debug(&lt;el&gt;)</span><br><span class="line">csv.writer(&lt;file&gt;).writerow([&lt;el&gt;])</span><br></pre></td></tr></table></figure>
<h4 id="Repr-use-cases"><a href="#Repr-use-cases" class="headerlink" title="Repr() use cases:"></a>Repr() use cases:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print([&lt;el&gt;])</span><br><span class="line">print(<span class="string">f'<span class="subst">&#123;&lt;el&gt;!r&#125;</span>'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&lt;el&gt;</span><br><span class="line">loguru.logger.exception()</span><br><span class="line">Z = dataclasses.make_dataclass(<span class="string">'Z'</span>, [<span class="string">'a'</span>]); print(Z(&lt;el&gt;))</span><br></pre></td></tr></table></figure>
<h4 id="Constructor-Overloading"><a href="#Constructor-Overloading" class="headerlink" title="Constructor Overloading"></a>Constructor Overloading</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">name</span>&gt;:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a=None)</span>:</span></span><br><span class="line">        self.a = a</span><br></pre></td></tr></table></figure>
<h4 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age  = age</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span><span class="params">(Person)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, staff_num)</span>:</span></span><br><span class="line">        super().__init__(name, age)</span><br><span class="line">        self.staff_num = staff_num</span><br></pre></td></tr></table></figure>
<h4 id="Multiple-Inheritance"><a href="#Multiple-Inheritance" class="headerlink" title="Multiple Inheritance"></a>Multiple Inheritance</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span> <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span> <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A, B)</span>:</span> <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><strong>MRO determines the order in which parent classes are traversed when searching for a method:</strong><br><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>C.mro()</span><br><span class="line">[&lt;class 'C'&gt;, &lt;class 'A'&gt;, &lt;class 'B'&gt;, &lt;class 'object'&gt;]</span><br></pre></td></tr></table></figure></p>
<h4 id="Property"><a href="#Property" class="headerlink" title="Property"></a>Property</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._a</span><br><span class="line"></span><br><span class="line"><span class="meta">    @a.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self._a = value</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>el = MyClass()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>el.a = <span class="number">123</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>el.a</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure>
<h4 id="Dataclass"><a href="#Dataclass" class="headerlink" title="Dataclass"></a>Dataclass</h4><p><strong>Decorator that automatically generates init(), repr() and eq() special methods.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, field</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass(order=False, frozen=False)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">class_name</span>&gt;:</span></span><br><span class="line">    &lt;attr_name_1&gt;: &lt;type&gt;</span><br><span class="line">    &lt;attr_name_2&gt;: &lt;type&gt; = &lt;default_value&gt;</span><br><span class="line">    &lt;attr_name_3&gt;: list/dict/set = field(default_factory=list/dict/set)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>An object can be made sortable with <code>&#39;order=True&#39;</code> or immutable with <code>&#39;frozen=True&#39;</code>.</strong></li>
<li><strong>Function field() is needed because <code>&#39;&lt;attr_name&gt;: list = []&#39;</code> would make a list that is shared among all instances.</strong></li>
<li><strong>Default_factory can be any callable.</strong></li>
</ul>
<h4 id="Slots"><a href="#Slots" class="headerlink" title="Slots"></a>Slots</h4><p><strong>Mechanism that restricts objects to attributes listed in ‘slots’ and significantly reduces their memory footprint.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClassWithSlots</span>:</span></span><br><span class="line">    __slots__ = [<span class="string">'a'</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.a = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="Copy"><a href="#Copy" class="headerlink" title="Copy"></a>Copy</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> copy, deepcopy</span><br><span class="line">&lt;object&gt; = copy(&lt;object&gt;)</span><br><span class="line">&lt;object&gt; = deepcopy(&lt;object&gt;)</span><br></pre></td></tr></table></figure>
<h3 id="Duck-Types"><a href="#Duck-Types" class="headerlink" title="Duck Types"></a>Duck Types</h3><hr>
<p><strong>A duck type is an implicit type that prescribes a set of special methods. Any object that has those methods defined is considered a member of that duck type.</strong></p>
<h4 id="Comparable"><a href="#Comparable" class="headerlink" title="Comparable"></a>Comparable</h4><ul>
<li><strong>If eq() method is not overridden, it returns <code>&#39;id(self) == id(other)&#39;</code>, which is the same as <code>&#39;self is other&#39;</code>.</strong></li>
<li><strong>That means all objects compare not equal by default.</strong></li>
<li><strong>Only left side object has eq() method called, unless it returns ‘NotImplemented’, in which case the right object is consulted.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComparable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(other, type(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a == other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br></pre></td></tr></table></figure>
<h4 id="Hashable"><a href="#Hashable" class="headerlink" title="Hashable"></a>Hashable</h4><ul>
<li><strong>Hashable object needs both hash() and eq() methods and its hash value should never change.</strong></li>
<li><strong>Hashable objects that compare equal must have the same hash value, meaning default hash() that returns <code>&#39;id(self)&#39;</code> will not do.</strong></li>
<li><strong>That is why Python automatically makes classes unhashable if you only implement eq().</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHashable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self._a = copy.deepcopy(a)</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(other, type(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a == other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> hash(self.a)</span><br></pre></td></tr></table></figure>
<h4 id="Sortable"><a href="#Sortable" class="headerlink" title="Sortable"></a>Sortable</h4><ul>
<li><strong>With ‘total_ordering’ decorator you only need to provide eq() and one of lt(), gt(), le() or ge() special methods.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> total_ordering</span><br><span class="line"></span><br><span class="line"><span class="meta">@total_ordering</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySortable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(other, type(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a == other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(other, type(self)):</span><br><span class="line">            <span class="keyword">return</span> self.a &lt; other.a</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Iterator-1"><a href="#Iterator-1" class="headerlink" title="Iterator"></a>Iterator</h4><ul>
<li><strong>Next() should return next item or raise ‘StopIteration’.</strong></li>
<li><strong>Iter() should return ‘self’.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.i = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.i</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = Counter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(counter), next(counter), next(counter)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.i = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.i</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter = Counter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counter(), counter(), counter()</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Context-Manager"><a href="#Context-Manager" class="headerlink" title="Context Manager"></a>Context Manager</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOpen</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">        self.filename = filename</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.file = open(self.filename)</span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, *args)</span>:</span></span><br><span class="line">        self.file.close()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> open(<span class="string">'test.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> file:</span><br><span class="line"><span class="meta">... </span>    file.write(<span class="string">'Hello World!'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> MyOpen(<span class="string">'test.txt'</span>) <span class="keyword">as</span> file:</span><br><span class="line"><span class="meta">... </span>    print(file.read())</span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure>
<h4 id="List-of-existing-context-managers"><a href="#List-of-existing-context-managers" class="headerlink" title="List of existing context managers:"></a>List of existing context managers:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'&lt;path&gt;'</span>, ...) <span class="keyword">as</span> file: ...</span><br><span class="line"><span class="keyword">with</span> wave.open(<span class="string">'&lt;path&gt;'</span>, ...) <span class="keyword">as</span> wave_file: ...</span><br><span class="line"><span class="keyword">with</span> memoryview(&lt;bytes/bytearray/array&gt;) <span class="keyword">as</span> view: ...</span><br><span class="line">db = sqlite3.connect(<span class="string">'&lt;path&gt;'</span>); <span class="keyword">with</span> db: db.execute(<span class="string">'&lt;insert_query&gt;'</span>)</span><br><span class="line">lock = threading.RLock(); <span class="keyword">with</span> lock: ...</span><br></pre></td></tr></table></figure>
<h3 id="Iterable-Duck-Types"><a href="#Iterable-Duck-Types" class="headerlink" title="Iterable Duck Types"></a>Iterable Duck Types</h3><hr>
<h4 id="Iterable"><a href="#Iterable" class="headerlink" title="Iterable"></a>Iterable</h4><ul>
<li><strong>Only required method is iter(). It should return an iterator of object’s items.</strong></li>
<li><strong>Contains() automatically works on any object that has iter() defined.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyIterable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> el <span class="keyword">in</span> self.a:</span><br><span class="line">            <span class="keyword">yield</span> el</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = MyIterable([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iter(a)</span><br><span class="line">&lt;generator object MyIterable.__iter__ at <span class="number">0x1026c18b8</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> <span class="keyword">in</span> a</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h4 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h4><ul>
<li><strong>Only required methods are iter() and len().</strong></li>
<li><strong>This cheatsheet actually means <code>&#39;&lt;iterable&gt;&#39;</code> when it uses <code>&#39;&lt;collection&gt;&#39;</code>.</strong></li>
<li><strong>I chose not to use the name ‘iterable’ because it sounds scarier and more vague than ‘collection’.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCollection</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> el <span class="keyword">in</span> self.a:</span><br><span class="line">            <span class="keyword">yield</span> el</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, el)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> el <span class="keyword">in</span> self.a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.a)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Sequence"><a href="#Sequence" class="headerlink" title="Sequence"></a>Sequence</h4><ul>
<li><strong>Only required methods are len() and getitem(), that should return an item at index or raise ‘IndexError’.</strong></li>
<li><strong>Iter() and contains() automatically work on any object that has getitem() defined.</strong></li>
<li><strong>Reversed() automatically works on any object that has getitem() and len() defined.</strong><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySequence</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> el <span class="keyword">in</span> self.a:</span><br><span class="line">            <span class="keyword">yield</span> el</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, el)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> el <span class="keyword">in</span> self.a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.a)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.a[i]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reversed__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> reversed(self.a)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Collections-abc-Sequence"><a href="#Collections-abc-Sequence" class="headerlink" title="Collections.abc.Sequence"></a>Collections.abc.Sequence</h4><ul>
<li><strong>It’s a richer interface than the basic sequence.</strong></li>
<li><strong>Extending it generates iter(), contains(), reversed(), index(), and count().</strong></li>
<li><strong>Unlike <code>&#39;abc.Iterable&#39;</code> and <code>&#39;abc.Collection&#39;</code>, it is not a duck type. That is why <code>&#39;issubclass(MySequence, collections.abc.Sequence)&#39;</code> would return ‘False’ even if it had all the methods defined.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyAbcSequence</span><span class="params">(collections.abc.Sequence)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        self.a = a</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.a)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.a[i]</span><br></pre></td></tr></table></figure>
<h4 id="Table-of-required-and-available-special-methods"><a href="#Table-of-required-and-available-special-methods" class="headerlink" title="Table of required and available special methods:"></a>Table of required and available special methods:</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+------------+----------+------------+----------+--------------+</span><br><span class="line">|            | Iterable | Collection | Sequence | abc.Sequence |</span><br><span class="line">+------------+----------+------------+----------+--------------+</span><br><span class="line">| iter()     |   REQ    |    REQ     |   yes    |     yes      |</span><br><span class="line">| contains() |   yes    |    yes     |   yes    |     yes      |</span><br><span class="line">| len()      |          |    REQ     |   REQ    |     REQ      |</span><br><span class="line">| getitem()  |          |            |   REQ    |     REQ      |</span><br><span class="line">| reversed() |          |            |   yes    |     yes      |</span><br><span class="line">| index()    |          |            |          |     yes      |</span><br><span class="line">| count()    |          |            |          |     yes      |</span><br><span class="line">+------------+----------+------------+----------+--------------+</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Other useful ABCs that automatically generate missing methods are: MutableSequence, Set, MutableSet, Mapping and MutableMapping.</strong></li>
</ul>
<h3 id="Enum"><a href="#Enum" class="headerlink" title="Enum"></a>Enum</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum, auto</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">enum_name</span>&gt;<span class="params">(Enum)</span>:</span></span><br><span class="line">    &lt;member_name_1&gt; = &lt;value_1&gt;</span><br><span class="line">    &lt;member_name_2&gt; = &lt;value_2_a&gt;, &lt;value_2_b&gt;</span><br><span class="line">    &lt;member_name_3&gt; = auto()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_member_names</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> [a.name <span class="keyword">for</span> a <span class="keyword">in</span> cls.__members__.values()]</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If there are no numeric values before auto(), it returns 1.</strong></li>
<li><strong>Otherwise it returns an increment of last numeric value.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;member&gt; = &lt;enum&gt;.&lt;member_name&gt;</span><br><span class="line">&lt;member&gt; = &lt;enum&gt;[<span class="string">'&lt;member_name&gt;'</span>]</span><br><span class="line">&lt;member&gt; = &lt;enum&gt;(&lt;value&gt;)</span><br><span class="line">name     = &lt;member&gt;.name</span><br><span class="line">value    = &lt;member&gt;.value</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">list_of_members = list(&lt;enum&gt;)</span><br><span class="line">member_names    = [a.name <span class="keyword">for</span> a <span class="keyword">in</span> &lt;enum&gt;]</span><br><span class="line">member_values   = [a.value <span class="keyword">for</span> a <span class="keyword">in</span> &lt;enum&gt;]</span><br><span class="line">random_member   = random.choice(list(&lt;enum&gt;))</span><br></pre></td></tr></table></figure>
<h3 id="Inline-1"><a href="#Inline-1" class="headerlink" title="Inline"></a>Inline</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Cutlery = Enum(<span class="string">'Cutlery'</span>, [<span class="string">'fork'</span>, <span class="string">'knife'</span>, <span class="string">'spoon'</span>])</span><br><span class="line">Cutlery = Enum(<span class="string">'Cutlery'</span>, <span class="string">'fork knife spoon'</span>)</span><br><span class="line">Cutlery = Enum(<span class="string">'Cutlery'</span>, &#123;<span class="string">'fork'</span>: <span class="number">1</span>, <span class="string">'knife'</span>: <span class="number">2</span>, <span class="string">'spoon'</span>: <span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="Functions-can-not-be-values-so-they-must-be-wrapped"><a href="#Functions-can-not-be-values-so-they-must-be-wrapped" class="headerlink" title="Functions can not be values, so they must be wrapped:"></a>Functions can not be values, so they must be wrapped:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line">LogicOp = Enum(<span class="string">'LogicOp'</span>, &#123;<span class="string">'AND'</span>: partial(<span class="keyword">lambda</span> l, r: l <span class="keyword">and</span> r),</span><br><span class="line">                           <span class="string">'OR'</span> : partial(<span class="keyword">lambda</span> l, r: l <span class="keyword">or</span> r)&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Another solution in this particular case, is to use <code>&#39;and_&#39;</code> and <code>&#39;or_&#39;</code> functions from module <a href="#operator">Operator</a>.</strong></li>
</ul>
<h3 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h3><hr>
<h4 id="Basic-Example"><a href="#Basic-Example" class="headerlink" title="Basic Example"></a>Basic Example</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    &lt;code&gt;</span><br><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line">    &lt;code&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Complex-Example"><a href="#Complex-Example" class="headerlink" title="Complex Example"></a>Complex Example</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    &lt;code_1&gt;</span><br><span class="line"><span class="keyword">except</span> &lt;exception_a&gt;:</span><br><span class="line">    &lt;code_2_a&gt;</span><br><span class="line"><span class="keyword">except</span> &lt;exception_b&gt;:</span><br><span class="line">    &lt;code_2_b&gt;</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    &lt;code_2_c&gt;</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    &lt;code_3&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Catching-Exceptions"><a href="#Catching-Exceptions" class="headerlink" title="Catching Exceptions"></a>Catching Exceptions</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line"><span class="keyword">except</span> &lt;exception&gt; <span class="keyword">as</span> &lt;name&gt;:</span><br><span class="line"><span class="keyword">except</span> (&lt;exception_1&gt;, &lt;exception_2&gt;, ...):</span><br><span class="line"><span class="keyword">except</span> (&lt;exception_1&gt;, &lt;exception_2&gt;, ...) <span class="keyword">as</span> &lt;name&gt;:</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Also catches subclasses of the exception.</strong></li>
</ul>
<h4 id="Raising-Exceptions"><a href="#Raising-Exceptions" class="headerlink" title="Raising Exceptions"></a>Raising Exceptions</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">raise</span> &lt;exception&gt;</span><br><span class="line"><span class="keyword">raise</span> &lt;exception&gt;()</span><br><span class="line"><span class="keyword">raise</span> &lt;exception&gt;(&lt;el&gt;)</span><br><span class="line"><span class="keyword">raise</span> &lt;exception&gt;(&lt;el_1&gt;, &lt;el_2&gt;, ...)</span><br></pre></td></tr></table></figure>
<h4 id="Useful-built-in-exceptions"><a href="#Useful-built-in-exceptions" class="headerlink" title="Useful built-in exceptions:"></a>Useful built-in exceptions:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">raise</span> ValueError(<span class="string">'Argument is of right type but inappropriate value!'</span>)</span><br><span class="line"><span class="keyword">raise</span> TypeError(<span class="string">'Argument is of wrong type!'</span>)</span><br><span class="line"><span class="keyword">raise</span> RuntimeError(<span class="string">'None of above!'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Re-raising-caught-exception"><a href="#Re-raising-caught-exception" class="headerlink" title="Re-raising caught exception:"></a>Re-raising caught exception:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line">    &lt;code&gt;</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>
<h4 id="Common-Built-in-Exceptions"><a href="#Common-Built-in-Exceptions" class="headerlink" title="Common Built-in Exceptions"></a>Common Built-in Exceptions</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">BaseException</span><br><span class="line"> +-- SystemExit                   # Raised by the sys.exit() function.</span><br><span class="line"> +-- KeyboardInterrupt            # Raised when the user hits the interrupt key.</span><br><span class="line"> +-- Exception                    # User-defined exceptions should be derived from this class.</span><br><span class="line">      +-- StopIteration           # Raised by next() when run on an empty iterator.</span><br><span class="line">      +-- ArithmeticError         # Base class for arithmetic errors.</span><br><span class="line">      |    +-- ZeroDivisionError  # Raised when dividing by zero.</span><br><span class="line">      +-- AttributeError          # Raised when an attribute is missing.</span><br><span class="line">      +-- EOFError                # Raised by input() when it hits end-of-file condition.</span><br><span class="line">      +-- LookupError             # Raised when a look-up on sequence or dict fails.</span><br><span class="line">      |    +-- IndexError         # Raised when a sequence index is out of range.</span><br><span class="line">      |    +-- KeyError           # Raised when a dictionary key is not found.</span><br><span class="line">      +-- NameError               # Raised when a variable name is not found.</span><br><span class="line">      +-- OSError                 # Failures such as “file not found” or “disk full”.</span><br><span class="line">      |    +-- FileNotFoundError  # When a file or directory is requested but doesn&#39;t exist.</span><br><span class="line">      +-- RuntimeError            # Raised by errors that don&#39;t fall in other categories.</span><br><span class="line">      |    +-- RecursionError     # Raised when the the maximum recursion depth is exceeded.</span><br><span class="line">      +-- TypeError               # Raised when an argument is of wrong type.</span><br><span class="line">      +-- ValueError              # When an argument is of right type but inappropriate value.</span><br><span class="line">           +-- UnicodeError       # Raised when encoding&#x2F;decoding strings from&#x2F;to bytes fails.</span><br></pre></td></tr></table></figure>
<h4 id="User-defined-Exceptions"><a href="#User-defined-Exceptions" class="headerlink" title="User-defined Exceptions"></a>User-defined Exceptions</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyError</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInputError</span><span class="params">(MyError)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="Print"><a href="#Print" class="headerlink" title="Print"></a>Print</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(&lt;el_1&gt;, ..., sep=<span class="string">' '</span>, end=<span class="string">'\n'</span>, file=sys.stdout, flush=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Use <code>&#39;file=sys.stderr&#39;</code> for errors.</strong></li>
<li><strong>Use <code>&#39;flush=True&#39;</code> to forcibly flush the stream.</strong></li>
</ul>
<h4 id="Pretty-Print"><a href="#Pretty-Print" class="headerlink" title="Pretty Print"></a>Pretty Print</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pprint(dir())</span><br><span class="line">[<span class="string">'__annotations__'</span>,</span><br><span class="line"> <span class="string">'__builtins__'</span>,</span><br><span class="line"> <span class="string">'__doc__'</span>, ...]</span><br></pre></td></tr></table></figure>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><hr>
<ul>
<li><strong>Reads a line from user input or pipe if present.</strong></li>
<li><strong>Trailing newline gets stripped.</strong></li>
<li><strong>Prompt string is printed to the standard output before reading input.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt; = input(prompt=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Prints-lines-until-EOF"><a href="#Prints-lines-until-EOF" class="headerlink" title="Prints lines until EOF:"></a>Prints lines until EOF:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(input())</span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h3 id="Command-Line-Arguments"><a href="#Command-Line-Arguments" class="headerlink" title="Command Line Arguments"></a>Command Line Arguments</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">script_name = sys.argv[<span class="number">0</span>]</span><br><span class="line">arguments   = sys.argv[<span class="number">1</span>:]</span><br></pre></td></tr></table></figure>
<h4 id="Argparse"><a href="#Argparse" class="headerlink" title="Argparse"></a>Argparse</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> argparse <span class="keyword">import</span> ArgumentParser, FileType</span><br><span class="line">p = ArgumentParser(description=&lt;str&gt;)</span><br><span class="line">p.add_argument(<span class="string">'-&lt;short_name&gt;'</span>, <span class="string">'--&lt;name&gt;'</span>, action=<span class="string">'store_true'</span>)  <span class="comment"># Flag</span></span><br><span class="line">p.add_argument(<span class="string">'-&lt;short_name&gt;'</span>, <span class="string">'--&lt;name&gt;'</span>, type=&lt;type&gt;)          <span class="comment"># Option</span></span><br><span class="line">p.add_argument(<span class="string">'&lt;name&gt;'</span>, type=&lt;type&gt;, nargs=<span class="number">1</span>)                    <span class="comment"># Argument</span></span><br><span class="line">p.add_argument(<span class="string">'&lt;name&gt;'</span>, type=&lt;type&gt;, nargs=<span class="string">'+'</span>)                  <span class="comment"># Arguments</span></span><br><span class="line">args  = p.parse_args()</span><br><span class="line">value = args.&lt;name&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Use <code>&#39;help=&lt;str&gt;&#39;</code> for argument description.</strong></li>
<li><strong>Use <code>&#39;type=FileType(&lt;mode&gt;)&#39;</code> for files.</strong></li>
</ul>
<h3 id="Open"><a href="#Open" class="headerlink" title="Open"></a>Open</h3><hr>
<p><strong>Opens a file and returns a corresponding file object.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;file&gt; = open(<span class="string">'&lt;path&gt;'</span>, mode=<span class="string">'r'</span>, encoding=<span class="literal">None</span>, newline=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>&#39;encoding=None&#39;</code> means default encoding is used, which is platform dependent. Best practice is to use <code>&#39;encoding=&quot;utf-8&quot;&#39;</code> whenever possible.</strong></li>
<li><strong><code>&#39;newline=None&#39;</code> means all different end of line combinations are converted to ‘\n’ on read, while on write all ‘\n’ characters are converted to system’s default line separator.</strong></li>
<li><strong><code>&#39;newline=&quot;&quot;&#39;</code> means no conversions take place, but lines are still broken by readline() on either ‘\n’, ‘\r’ or ‘\r\n’.</strong></li>
</ul>
<h4 id="Modes"><a href="#Modes" class="headerlink" title="Modes"></a>Modes</h4><ul>
<li><strong><code>&#39;r&#39;</code>  - Read (default).</strong></li>
<li><strong><code>&#39;w&#39;</code>  - Write (truncate).</strong></li>
<li><strong><code>&#39;x&#39;</code>  - Write or fail if the file already exists.</strong></li>
<li><strong><code>&#39;a&#39;</code>  - Append.</strong></li>
<li><strong><code>&#39;w+&#39;</code> - Read and write (truncate).</strong></li>
<li><strong><code>&#39;r+&#39;</code> - Read and write from the start.</strong></li>
<li><strong><code>&#39;a+&#39;</code> - Read and write from the end.</strong></li>
<li><strong><code>&#39;t&#39;</code>  - Text mode (default).</strong></li>
<li><strong><code>&#39;b&#39;</code>  - Binary mode.</strong></li>
</ul>
<h4 id="Exceptions-1"><a href="#Exceptions-1" class="headerlink" title="Exceptions"></a>Exceptions</h4><ul>
<li><strong><code>&#39;FileNotFoundError&#39;</code> can be risen when reading with <code>&#39;r&#39;</code> or <code>&#39;r+&#39;</code>.</strong>  </li>
<li><strong><code>&#39;FileExistsError&#39;</code> can be risen when writing with <code>&#39;x&#39;</code>.</strong></li>
<li><strong><code>&#39;IsADirectoryError&#39;</code> and <code>&#39;PermissionError&#39;</code> can be risen by any.</strong></li>
<li><strong><code>&#39;OSError&#39;</code> is the parent class of all listed exceptions.</strong></li>
</ul>
<h4 id="File"><a href="#File" class="headerlink" title="File"></a>File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;file&gt;.seek(<span class="number">0</span>)                      <span class="comment"># Moves to the start of the file.</span></span><br><span class="line">&lt;file&gt;.seek(offset)                 <span class="comment"># Moves 'offset' chars/bytes from the start.</span></span><br><span class="line">&lt;file&gt;.seek(<span class="number">0</span>, <span class="number">2</span>)                   <span class="comment"># Moves to the end of the file.</span></span><br><span class="line">&lt;bin_file&gt;.seek(±offset, &lt;anchor&gt;)  <span class="comment"># Anchor: 0 start, 1 current pos., 2 end.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str/bytes&gt; = &lt;file&gt;.read(size=<span class="number">-1</span>)  <span class="comment"># Reads 'size' chars/bytes or until EOF.</span></span><br><span class="line">&lt;str/bytes&gt; = &lt;file&gt;.readline()     <span class="comment"># Returns a line or empty string on EOF.</span></span><br><span class="line">&lt;list&gt;      = &lt;file&gt;.readlines()    <span class="comment"># Returns a list of lines or empty list.</span></span><br><span class="line">&lt;str/bytes&gt; = next(&lt;file&gt;)          <span class="comment"># Returns a line using buffer. Do not mix.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;file&gt;.write(&lt;str/bytes&gt;)           <span class="comment"># Writes a string or bytes object.</span></span><br><span class="line">&lt;file&gt;.writelines(&lt;coll.&gt;)          <span class="comment"># Writes a coll. of strings or bytes objects.</span></span><br><span class="line">&lt;file&gt;.flush()                      <span class="comment"># Flushes write buffer.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Methods do not add or strip trailing newlines, even writelines().</strong></li>
</ul>
<h4 id="Read-Text-from-File"><a href="#Read-Text-from-File" class="headerlink" title="Read Text from File"></a>Read Text from File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> file.readlines()</span><br></pre></td></tr></table></figure>
<h4 id="Write-Text-to-File"><a href="#Write-Text-to-File" class="headerlink" title="Write Text to File"></a>Write Text to File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_file</span><span class="params">(filename, text)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(text)</span><br></pre></td></tr></table></figure>
<h3 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path, listdir</span><br><span class="line"><span class="keyword">from</span> glob <span class="keyword">import</span> glob</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = path.exists(<span class="string">'&lt;path&gt;'</span>)</span><br><span class="line">&lt;bool&gt; = path.isfile(<span class="string">'&lt;path&gt;'</span>)</span><br><span class="line">&lt;bool&gt; = path.isdir(<span class="string">'&lt;path&gt;'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = listdir(<span class="string">'&lt;path&gt;'</span>)         <span class="comment"># List of filenames located at 'path'. </span></span><br><span class="line">&lt;list&gt; = glob(<span class="string">'&lt;pattern&gt;'</span>)         <span class="comment"># Filenames matching the wildcard pattern.</span></span><br></pre></td></tr></table></figure>
<h4 id="Pathlib"><a href="#Pathlib" class="headerlink" title="Pathlib"></a>Pathlib</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cwd    = Path()</span><br><span class="line">&lt;Path&gt; = Path(<span class="string">'&lt;path&gt;'</span> [, <span class="string">'&lt;path&gt;'</span>, &lt;Path&gt;, ...])</span><br><span class="line">&lt;Path&gt; = &lt;Path&gt; / <span class="string">'&lt;dir&gt;'</span> / <span class="string">'&lt;file&gt;'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = &lt;Path&gt;.exists()</span><br><span class="line">&lt;bool&gt; = &lt;Path&gt;.is_file()</span><br><span class="line">&lt;bool&gt; = &lt;Path&gt;.is_dir()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;iter&gt; = &lt;Path&gt;.iterdir()          <span class="comment"># Iterator of filenames located at path.</span></span><br><span class="line">&lt;iter&gt; = &lt;Path&gt;.glob(<span class="string">'&lt;pattern&gt;'</span>)  <span class="comment"># Filenames matching the wildcard pattern.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = str(&lt;Path&gt;)               <span class="comment"># Returns path as a string.</span></span><br><span class="line">&lt;tup.&gt; = &lt;Path&gt;.parts              <span class="comment"># Returns all components as strings.</span></span><br><span class="line">&lt;Path&gt; = &lt;Path&gt;.resolve()          <span class="comment"># Returns absolute Path without symlinks.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = &lt;Path&gt;.name               <span class="comment"># Final component.</span></span><br><span class="line">&lt;str&gt;  = &lt;Path&gt;.stem               <span class="comment"># Final component without extension.</span></span><br><span class="line">&lt;str&gt;  = &lt;Path&gt;.suffix             <span class="comment"># Final component's extension.</span></span><br><span class="line">&lt;Path&gt; = &lt;Path&gt;.parent             <span class="comment"># Path without final component.</span></span><br></pre></td></tr></table></figure>
<h3 id="Command-Execution"><a href="#Command-Execution" class="headerlink" title="Command Execution"></a>Command Execution</h3><hr>
<h4 id="Files-and-Directories-Commands"><a href="#Files-and-Directories-Commands" class="headerlink" title="Files and Directories Commands"></a>Files and Directories Commands</h4><ul>
<li><strong>Paths can be either strings or Path objects.</strong></li>
<li><strong>All exceptions are either ‘OSError’ or its subclasses.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.chdir(&lt;path&gt;)                  <span class="comment"># Changes the current working directory.</span></span><br><span class="line">&lt;str&gt; = os.getcwd()               <span class="comment"># Returns current working directory.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.remove(&lt;path&gt;)                 <span class="comment"># Deletes the file.</span></span><br><span class="line">os.rmdir(&lt;path&gt;)                  <span class="comment"># Deletes empty directory.</span></span><br><span class="line">shutil.rmtree(&lt;path&gt;)             <span class="comment"># Deletes an entire directory tree.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.rename(<span class="keyword">from</span>, to)               <span class="comment"># Renames the file or directory.</span></span><br><span class="line">os.replace(<span class="keyword">from</span>, to)              <span class="comment"># Same, but overwrites 'to' if it exists.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.mkdir(&lt;path&gt;, mode=<span class="number">0o777</span>)      <span class="comment"># Creates a directory.</span></span><br><span class="line">&lt;iter&gt; = os.scandir(path=<span class="string">'.'</span>)     <span class="comment"># Returns os.DirEntry objects located at path.</span></span><br></pre></td></tr></table></figure>
<h4 id="DirEntry"><a href="#DirEntry" class="headerlink" title="DirEntry:"></a>DirEntry:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;  = &lt;DirEntry&gt;.name          <span class="comment"># Final component of the path.</span></span><br><span class="line">&lt;str&gt;  = &lt;DirEntry&gt;.path          <span class="comment"># Path with final component.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bool&gt; = &lt;DirEntry&gt;.is_file()</span><br><span class="line">&lt;bool&gt; = &lt;DirEntry&gt;.is_dir()</span><br><span class="line">&lt;bool&gt; = &lt;DirEntry&gt;.is_symlink()</span><br><span class="line">&lt;Path&gt; = Path(&lt;DirEntry&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Shell-Commands"><a href="#Shell-Commands" class="headerlink" title="Shell Commands"></a>Shell Commands</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">&lt;str&gt; = os.popen(<span class="string">'&lt;shell_command&gt;'</span>).read()</span><br></pre></td></tr></table></figure>
<h4 id="Using-subprocess"><a href="#Using-subprocess" class="headerlink" title="Using subprocess:"></a>Using subprocess:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> subprocess, shlex</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = subprocess.run(shlex.split(<span class="string">'ls -a'</span>), stdout=subprocess.PIPE)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.stdout</span><br><span class="line"><span class="string">b'.\n..\nfile1.txt\nfile2.txt\n'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.returncode</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>
<h3 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line">&lt;reader&gt; = csv.reader(&lt;file&gt;, dialect=<span class="string">'excel'</span>, delimiter=<span class="string">','</span>)</span><br><span class="line">&lt;list&gt;   = next(&lt;reader&gt;)  <span class="comment"># Returns a row as list of strings.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;writer&gt; = csv.writer(&lt;file&gt;, dialect=<span class="string">'excel'</span>, delimiter=<span class="string">','</span>)</span><br><span class="line">&lt;writer&gt;.writerow(&lt;collection&gt;)</span><br><span class="line">&lt;writer&gt;.writerows(&lt;coll_of_coll&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h4><ul>
<li><strong><code>&#39;dialect&#39;</code> - Master parameter that sets the default values.</strong></li>
<li><strong><code>&#39;delimiter&#39;</code> - A one-character string used to separate fields.</strong></li>
<li><strong><code>&#39;quotechar&#39;</code> - Character for quoting fields that contain special characters.</strong></li>
<li><strong><code>&#39;doublequote&#39;</code> - Whether quotechars inside fields get doubled or escaped.</strong></li>
<li><strong><code>&#39;skipinitialspace&#39;</code> - Whether whitespace after delimiter gets stripped.</strong></li>
<li><strong><code>&#39;lineterminator&#39;</code> - How does writer terminate lines.</strong></li>
<li><strong><code>&#39;quoting&#39;</code> - Controls the amount of quoting: 0 - as necessary, 1 - all.</strong></li>
<li><strong><code>&#39;escapechar&#39;</code> - Character for escaping quotechar if doublequote is false.</strong></li>
</ul>
<h4 id="Dialects"><a href="#Dialects" class="headerlink" title="Dialects"></a>Dialects</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+------------------+-----------+-----------+--------------+</span><br><span class="line">|                  |   excel   | excel_tab | unix_dialect |</span><br><span class="line">+------------------+-----------+-----------+--------------+</span><br><span class="line">| delimiter        |      &#39;,&#39;  |     &#39;\t&#39;  |       &#39;,&#39;    |</span><br><span class="line">| quotechar        |      &#39;&quot;&#39;  |      &#39;&quot;&#39;  |       &#39;&quot;&#39;    |</span><br><span class="line">| doublequote      |     True  |     True  |      True    |</span><br><span class="line">| skipinitialspace |    False  |    False  |     False    |</span><br><span class="line">| lineterminator   |   &#39;\r\n&#39;  |   &#39;\r\n&#39;  |      &#39;\n&#39;    |</span><br><span class="line">| quoting          |        0  |        0  |         1    |</span><br><span class="line">| escapechar       |     None  |     None  |      None    |</span><br><span class="line">+------------------+-----------+-----------+--------------+</span><br></pre></td></tr></table></figure>
<h4 id="Read-Rows-from-CSV-File"><a href="#Read-Rows-from-CSV-File" class="headerlink" title="Read Rows from CSV File"></a>Read Rows from CSV File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_csv_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, encoding=<span class="string">'utf-8'</span>, newline=<span class="string">''</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> csv.reader(file)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If <code>&#39;newline=&quot;&quot;&#39;</code> is not specified, then newlines embedded inside quoted fields will not be interpreted correctly.</strong></li>
</ul>
<h4 id="Write-Rows-to-CSV-File"><a href="#Write-Rows-to-CSV-File" class="headerlink" title="Write Rows to CSV File"></a>Write Rows to CSV File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_csv_file</span><span class="params">(filename, rows)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>, newline=<span class="string">''</span>) <span class="keyword">as</span> file:</span><br><span class="line">        writer = csv.writer(file)</span><br><span class="line">        writer.writerows(rows)</span><br></pre></td></tr></table></figure>
<h3 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">&lt;str&gt;    = json.dumps(&lt;object&gt;, ensure_ascii=<span class="literal">True</span>, indent=<span class="literal">None</span>)</span><br><span class="line">&lt;object&gt; = json.loads(&lt;str&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Read-Object-from-JSON-File"><a href="#Read-Object-from-JSON-File" class="headerlink" title="Read Object from JSON File"></a>Read Object from JSON File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_json_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> json.load(file)</span><br></pre></td></tr></table></figure>
<h4 id="Write-Object-to-JSON-File"><a href="#Write-Object-to-JSON-File" class="headerlink" title="Write Object to JSON File"></a>Write Object to JSON File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_json_file</span><span class="params">(filename, an_object)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        json.dump(an_object, file, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Pickle"><a href="#Pickle" class="headerlink" title="Pickle"></a>Pickle</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line">&lt;bytes&gt;  = pickle.dumps(&lt;object&gt;)</span><br><span class="line">&lt;object&gt; = pickle.loads(&lt;bytes&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Read-Object-from-File"><a href="#Read-Object-from-File" class="headerlink" title="Read Object from File"></a>Read Object from File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_pickle_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> pickle.load(file)</span><br></pre></td></tr></table></figure>
<h4 id="Write-Object-to-File"><a href="#Write-Object-to-File" class="headerlink" title="Write Object to File"></a>Write Object to File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_pickle_file</span><span class="params">(filename, an_object)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        pickle.dump(an_object, file)</span><br></pre></td></tr></table></figure>
<h3 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h3><hr>
<p><strong>Server-less database engine that stores each database into separate file.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line">db = sqlite3.connect(<span class="string">'&lt;path&gt;'</span>)                <span class="comment"># Also ':memory:'.</span></span><br><span class="line">...</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>New database will be created if path doesn’t exist.</strong></li>
</ul>
<h4 id="Read"><a href="#Read" class="headerlink" title="Read"></a>Read</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cursor = db.execute(<span class="string">'&lt;query&gt;'</span>)</span><br><span class="line"><span class="keyword">if</span> cursor:</span><br><span class="line">    &lt;tuple&gt; = cursor.fetchone()               <span class="comment"># First row.</span></span><br><span class="line">    &lt;list&gt;  = cursor.fetchall()               <span class="comment"># Remaining rows.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Returned values can be of type str, int, float, bytes or None.</strong></li>
</ul>
<h4 id="Write"><a href="#Write" class="headerlink" title="Write"></a>Write</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">db.execute(<span class="string">'&lt;query&gt;'</span>)</span><br><span class="line">db.commit()</span><br></pre></td></tr></table></figure>
<h4 id="Placeholders"><a href="#Placeholders" class="headerlink" title="Placeholders"></a>Placeholders</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">db.execute(<span class="string">'&lt;query&gt;'</span>, &lt;list/tuple&gt;)           <span class="comment"># Replaces '?'s in query with values.</span></span><br><span class="line">db.execute(<span class="string">'&lt;query&gt;'</span>, &lt;dict/namedtuple&gt;)      <span class="comment"># Replaces ':&lt;key&gt;'s with values.</span></span><br><span class="line">db.executemany(<span class="string">'&lt;query&gt;'</span>, &lt;coll_of_above&gt;)    <span class="comment"># Runs execute() many times.</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Passed values can be of type str, int, float, bytes, None, bool, datetime.date or datetime.datetme.</strong></li>
</ul>
<h4 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h4><p><strong>Has a very similar interface, with differences listed below.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install mysql-connector</span></span><br><span class="line"><span class="keyword">from</span> mysql <span class="keyword">import</span> connector</span><br><span class="line">db = connector.connect(host=&lt;str&gt;, user=&lt;str&gt;, password=&lt;str&gt;, database=&lt;str&gt;)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">cursor.execute(<span class="string">'&lt;query&gt;'</span>)                     <span class="comment"># Connector doesn't have execute method.</span></span><br><span class="line">cursor.execute(<span class="string">'&lt;query&gt;'</span>, &lt;list/tuple&gt;)       <span class="comment"># Replaces '%s's in query with values.</span></span><br><span class="line">cursor.execute(<span class="string">'&lt;query&gt;'</span>, &lt;dict/namedtuple&gt;)  <span class="comment"># Replaces '%(&lt;key&gt;)s's with values.</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Bytes"><a href="#Bytes" class="headerlink" title="Bytes"></a>Bytes</h3><hr>
<p><strong>Bytes object is an immutable sequence of single bytes. Mutable version is called ‘bytearray’.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bytes&gt; = <span class="string">b'&lt;str&gt;'</span>                       <span class="comment"># Only accepts ASCII characters and \x00 - \xff.</span></span><br><span class="line">&lt;int&gt;   = &lt;bytes&gt;[&lt;index&gt;]               <span class="comment"># Returns int in range from 0 to 255.</span></span><br><span class="line">&lt;bytes&gt; = &lt;bytes&gt;[&lt;slice&gt;]               <span class="comment"># Returns bytes even if it has only one element.</span></span><br><span class="line">&lt;bytes&gt; = &lt;bytes&gt;.join(&lt;coll_of_bytes&gt;)  <span class="comment"># Joins elements using bytes object as separator.</span></span><br></pre></td></tr></table></figure>
<h4 id="Encode-1"><a href="#Encode-1" class="headerlink" title="Encode"></a>Encode</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;bytes&gt; = &lt;str&gt;.encode(<span class="string">'utf-8'</span>)          <span class="comment"># Or: bytes(&lt;str&gt;, 'utf-8')</span></span><br><span class="line">&lt;bytes&gt; = bytes(&lt;coll_of_ints&gt;)          <span class="comment"># Ints must be in range from 0 to 255.</span></span><br><span class="line">&lt;bytes&gt; = &lt;int&gt;.to_bytes(&lt;length&gt;, byteorder=<span class="string">'big|little'</span>, signed=<span class="literal">False</span>)</span><br><span class="line">&lt;bytes&gt; = bytes.fromhex(<span class="string">'&lt;hex&gt;'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Decode-1"><a href="#Decode-1" class="headerlink" title="Decode"></a>Decode</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;str&gt;   = &lt;bytes&gt;.decode(<span class="string">'utf-8'</span>)        <span class="comment"># Or: str(&lt;bytes&gt;, 'utf-8')</span></span><br><span class="line">&lt;list&gt;  = list(&lt;bytes&gt;)                  <span class="comment"># Returns ints in range from 0 to 255.</span></span><br><span class="line">&lt;int&gt;   = int.from_bytes(&lt;bytes&gt;, byteorder=<span class="string">'big|little'</span>, signed=<span class="literal">False</span>)</span><br><span class="line"><span class="string">'&lt;hex&gt;'</span> = &lt;bytes&gt;.hex()</span><br></pre></td></tr></table></figure>
<h4 id="Read-Bytes-from-File"><a href="#Read-Bytes-from-File" class="headerlink" title="Read Bytes from File"></a>Read Bytes from File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_bytes</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> file.read()</span><br></pre></td></tr></table></figure>
<h4 id="Write-Bytes-to-File"><a href="#Write-Bytes-to-File" class="headerlink" title="Write Bytes to File"></a>Write Bytes to File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_bytes</span><span class="params">(filename, bytes_obj)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(bytes_obj)</span><br></pre></td></tr></table></figure>
<h3 id="Struct"><a href="#Struct" class="headerlink" title="Struct"></a>Struct</h3><hr>
<ul>
<li><strong>Module that performs conversions between a sequence of numbers and a C struct, represented as a Python bytes object.</strong></li>
<li><strong>Machine’s native type sizes and byte order are used by default.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack, unpack, iter_unpack, calcsize</span><br><span class="line">&lt;bytes&gt;  = pack(<span class="string">'&lt;format&gt;'</span>, &lt;num_1&gt; [, &lt;num_2&gt;, ...])</span><br><span class="line">&lt;tuple&gt;  = unpack(<span class="string">'&lt;format&gt;'</span>, &lt;bytes&gt;)</span><br><span class="line">&lt;tuples&gt; = iter_unpack(<span class="string">'&lt;format&gt;'</span>, &lt;bytes&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pack(<span class="string">'&gt;hhl'</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="string">b'\x00\x01\x00\x02\x00\x00\x00\x03'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>unpack(<span class="string">'&gt;hhl'</span>, <span class="string">b'\x00\x01\x00\x02\x00\x00\x00\x03'</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calcsize(<span class="string">'&gt;hhl'</span>)</span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure>
<h4 id="Format-2"><a href="#Format-2" class="headerlink" title="Format"></a>Format</h4><h5 id="For-standard-sizes-start-format-string-with"><a href="#For-standard-sizes-start-format-string-with" class="headerlink" title="For standard sizes start format string with:"></a>For standard sizes start format string with:</h5><ul>
<li><strong><code>&#39;=&#39;</code> - native byte order</strong></li>
<li><strong><code>&#39;&lt;&#39;</code> - little-endian</strong></li>
<li><strong><code>&#39;&gt;&#39;</code> - big-endian</strong></li>
</ul>
<h5 id="Integer-types-Use-capital-letter-for-unsigned-type-Standard-sizes-are-in-brackets"><a href="#Integer-types-Use-capital-letter-for-unsigned-type-Standard-sizes-are-in-brackets" class="headerlink" title="Integer types. Use capital letter for unsigned type. Standard sizes are in brackets:"></a>Integer types. Use capital letter for unsigned type. Standard sizes are in brackets:</h5><ul>
<li><strong><code>&#39;x&#39;</code> - pad byte</strong></li>
<li><strong><code>&#39;b&#39;</code> - char (1)</strong></li>
<li><strong><code>&#39;h&#39;</code> - short (2)</strong></li>
<li><strong><code>&#39;i&#39;</code> - int (4)</strong></li>
<li><strong><code>&#39;l&#39;</code> - long (4)</strong></li>
<li><strong><code>&#39;q&#39;</code> - long long (8)</strong></li>
</ul>
<h5 id="Floating-point-types"><a href="#Floating-point-types" class="headerlink" title="Floating point types:"></a>Floating point types:</h5><ul>
<li><strong><code>&#39;f&#39;</code> - float (4)</strong></li>
<li><strong><code>&#39;d&#39;</code> - double (8)</strong></li>
</ul>
<h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><hr>
<p><strong>List that can only hold numbers of predefined type. Available types and their sizes in bytes are listed above.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line">&lt;array&gt; = array(<span class="string">'&lt;typecode&gt;'</span> [, &lt;collection&gt;])</span><br></pre></td></tr></table></figure>
<h3 id="Memory-View"><a href="#Memory-View" class="headerlink" title="Memory View"></a>Memory View</h3><hr>
<p><strong>Used for accessing the internal data of an object that supports the buffer protocol.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;memoryview&gt; = memoryview(&lt;bytes&gt; / &lt;bytearray&gt; / &lt;array&gt;)</span><br><span class="line">&lt;memoryview&gt;.release()</span><br></pre></td></tr></table></figure>
<h3 id="Deque"><a href="#Deque" class="headerlink" title="Deque"></a>Deque</h3><hr>
<p><strong>A thread-safe list with efficient appends and pops from either side. Pronounced “deck”.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line">&lt;deque&gt; = deque(&lt;collection&gt;, maxlen=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;deque&gt;.appendleft(&lt;el&gt;)</span><br><span class="line">&lt;el&gt; = &lt;deque&gt;.popleft()</span><br><span class="line">&lt;deque&gt;.extendleft(&lt;collection&gt;)            <span class="comment"># Collection gets reversed.</span></span><br><span class="line">&lt;deque&gt;.rotate(n=<span class="number">1</span>)                         <span class="comment"># Rotates elements to the right.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = deque([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], maxlen=<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.append(<span class="number">4</span>)</span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.appendleft(<span class="number">5</span>)</span><br><span class="line">[<span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.insert(<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line">IndexError: deque already at its maximum size</span><br></pre></td></tr></table></figure>
<h3 id="Threading"><a href="#Threading" class="headerlink" title="Threading"></a>Threading</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, RLock</span><br></pre></td></tr></table></figure>
<h4 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a>Thread</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">thread = Thread(target=&lt;function&gt;, args=(&lt;first_arg&gt;, ))</span><br><span class="line">thread.start()</span><br><span class="line">...</span><br><span class="line">thread.join()</span><br></pre></td></tr></table></figure>
<h4 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lock = RLock()</span><br><span class="line">lock.acquire()</span><br><span class="line">...</span><br><span class="line">lock.release()</span><br></pre></td></tr></table></figure>
<h5 id="Or"><a href="#Or" class="headerlink" title="Or:"></a>Or:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lock = RLock()</span><br><span class="line"><span class="keyword">with</span> lock:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h3 id="Introspection"><a href="#Introspection" class="headerlink" title="Introspection"></a>Introspection</h3><hr>
<p><strong>Inspecting code at runtime.</strong></p>
<h4 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;list&gt; = dir()      <span class="comment"># Names of variables in current scope.</span></span><br><span class="line">&lt;dict&gt; = locals()   <span class="comment"># Dict of local variables. Also vars().</span></span><br><span class="line">&lt;dict&gt; = globals()  <span class="comment"># Dict of global variables.</span></span><br></pre></td></tr></table></figure>
<h4 id="Attributes-1"><a href="#Attributes-1" class="headerlink" title="Attributes"></a>Attributes</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;dict&gt; = vars(&lt;object&gt;)</span><br><span class="line">&lt;bool&gt; = hasattr(&lt;object&gt;, <span class="string">'&lt;attr_name&gt;'</span>)</span><br><span class="line">value  = getattr(&lt;object&gt;, <span class="string">'&lt;attr_name&gt;'</span>)</span><br><span class="line">setattr(&lt;object&gt;, <span class="string">'&lt;attr_name&gt;'</span>, value)</span><br></pre></td></tr></table></figure>
<h4 id="Parameters-1"><a href="#Parameters-1" class="headerlink" title="Parameters"></a>Parameters</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> inspect <span class="keyword">import</span> signature</span><br><span class="line">&lt;sig&gt;        = signature(&lt;function&gt;)</span><br><span class="line">no_of_params = len(&lt;sig&gt;.parameters)</span><br><span class="line">param_names  = list(&lt;sig&gt;.parameters.keys())</span><br></pre></td></tr></table></figure>
<h3 id="Metaprograming"><a href="#Metaprograming" class="headerlink" title="Metaprograming"></a>Metaprograming</h3><hr>
<p><strong>Code that generates code.</strong></p>
<h4 id="Type-1"><a href="#Type-1" class="headerlink" title="Type"></a>Type</h4><p><strong>Type is the root class. If only passed an object it returns its type (class). Otherwise it creates a new class.</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;class&gt; = type(&lt;class_name&gt;, &lt;parents_tuple&gt;, &lt;attributes_dict&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Z = type(<span class="string">'Z'</span>, (), &#123;<span class="string">'a'</span>: <span class="string">'abcde'</span>, <span class="string">'b'</span>: <span class="number">12345</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>z = Z()</span><br></pre></td></tr></table></figure>
<h4 id="Meta-Class"><a href="#Meta-Class" class="headerlink" title="Meta Class"></a>Meta Class</h4><p><strong>Class that creates class.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_meta_class</span><span class="params">(name, parents, attrs)</span>:</span></span><br><span class="line">    attrs[<span class="string">'a'</span>] = <span class="string">'abcde'</span></span><br><span class="line">    <span class="keyword">return</span> type(name, parents, attrs)</span><br></pre></td></tr></table></figure>
<h5 id="Or-1"><a href="#Or-1" class="headerlink" title="Or:"></a>Or:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyMetaClass</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, name, parents, attrs)</span>:</span></span><br><span class="line">        attrs[<span class="string">'a'</span>] = <span class="string">'abcde'</span></span><br><span class="line">        <span class="keyword">return</span> type.__new__(cls, name, parents, attrs)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>New() is a class method that gets called before init(). If it returns an instance of its class, then that instance gets passed to init() as a ‘self’ argument.</strong></li>
<li><strong>It receives the same arguments as init(), except for the first one that specifies the desired class of returned instance (</strong><code>&#39;MyMetaClass&#39;</code> <strong>in our case).</strong></li>
<li><strong>New() can also be called directly, usually from a new() method of a child class (</strong><code>def __new__(cls): return super().__new__(cls)</code><strong>), in which case init() is not called.</strong></li>
</ul>
<h4 id="Metaclass-Attribute"><a href="#Metaclass-Attribute" class="headerlink" title="Metaclass Attribute"></a>Metaclass Attribute</h4><p><strong>Right before a class is created it checks if it has metaclass defined. If not, it recursively checks if any of his parents has it defined and eventually comes to type().</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(metaclass=MyMetaClass)</span>:</span></span><br><span class="line">    b = <span class="number">12345</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>MyClass.a, MyClass.b</span><br><span class="line">(<span class="string">'abcde'</span>, <span class="number">12345</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Type-Diagram"><a href="#Type-Diagram" class="headerlink" title="Type Diagram"></a>Type Diagram</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">type(MyClass)     == MyMetaClass  <span class="comment"># MyClass is an instance of MyMetaClass.</span></span><br><span class="line">type(MyMetaClass) == type         <span class="comment"># MyMetaClass is an instance of type.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+---------+-------------+</span><br><span class="line">| Classes | Metaclasses |</span><br><span class="line">+---------+-------------|</span><br><span class="line">| MyClass &gt; MyMetaClass |</span><br><span class="line">|         |     v       |</span><br><span class="line">|  object ---&gt; type &lt;+  |</span><br><span class="line">|         |    ^ +---+  |</span><br><span class="line">|   str -------+        |</span><br><span class="line">+---------+-------------+</span><br></pre></td></tr></table></figure>
<h4 id="Inheritance-Diagram"><a href="#Inheritance-Diagram" class="headerlink" title="Inheritance Diagram"></a>Inheritance Diagram</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MyClass.__base__     == object    <span class="comment"># MyClass is a subclass of object.</span></span><br><span class="line">MyMetaClass.__base__ == type      <span class="comment"># MyMetaClass is a subclass of type.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+---------+-------------+</span><br><span class="line">| Classes | Metaclasses |</span><br><span class="line">+---------+-------------|</span><br><span class="line">| MyClass | MyMetaClass |</span><br><span class="line">|    v    |     v       |</span><br><span class="line">|  object &lt;--- type     |</span><br><span class="line">|    ^    |             |</span><br><span class="line">|   str   |             |</span><br><span class="line">+---------+-------------+</span><br></pre></td></tr></table></figure>
<h3 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> add, sub, mul, truediv, floordiv, mod, pow, neg, abs</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> eq, ne, lt, le, gt, ge</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> and_, or_, not_</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter, attrgetter, methodcaller</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> operator <span class="keyword">as</span> op</span><br><span class="line">sorted_by_second = sorted(&lt;collection&gt;, key=op.itemgetter(<span class="number">1</span>))</span><br><span class="line">sorted_by_both   = sorted(&lt;collection&gt;, key=op.itemgetter(<span class="number">1</span>, <span class="number">0</span>))</span><br><span class="line">product_of_elems = functools.reduce(op.mul, &lt;collection&gt;)</span><br><span class="line">LogicOp          = enum.Enum(<span class="string">'LogicOp'</span>, &#123;<span class="string">'AND'</span>: op.and_, <span class="string">'OR'</span> : op.or_&#125;)</span><br><span class="line">last_el          = op.methodcaller(<span class="string">'pop'</span>)(&lt;list&gt;)</span><br></pre></td></tr></table></figure>
<h3 id="Eval"><a href="#Eval" class="headerlink" title="Eval"></a>Eval</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> ast <span class="keyword">import</span> literal_eval</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>literal_eval(<span class="string">'1 + 2'</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>literal_eval(<span class="string">'[1, 2, 3]'</span>)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>literal_eval(<span class="string">'abs(1)'</span>)</span><br><span class="line">ValueError: malformed node <span class="keyword">or</span> string</span><br></pre></td></tr></table></figure>
<h3 id="Coroutine"><a href="#Coroutine" class="headerlink" title="Coroutine"></a>Coroutine</h3><hr>
<ul>
<li><strong>Similar to generator, but generator pulls data through the pipe with iteration, while coroutine pushes data into the pipeline with send().</strong></li>
<li><strong>Coroutines provide more powerful data routing possibilities than iterators.</strong></li>
<li><strong>If you build a collection of simple data processing components, you can glue them together into complex arrangements of pipes, branches, merging, etc.</strong></li>
</ul>
<h4 id="Helper-Decorator"><a href="#Helper-Decorator" class="headerlink" title="Helper Decorator"></a>Helper Decorator</h4><ul>
<li><strong>All coroutines must be “primed” by first calling next().</strong></li>
<li><strong>Remembering to call next() is easy to forget.</strong></li>
<li><strong>Solved by wrapping coroutines with a decorator:</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">coroutine</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        cr = func(*args, **kwargs)</span><br><span class="line">        next(cr)</span><br><span class="line">        <span class="keyword">return</span> cr</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h4 id="Pipeline-Example"><a href="#Pipeline-Example" class="headerlink" title="Pipeline Example"></a>Pipeline Example</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reader</span><span class="params">(target)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        target.send(i)</span><br><span class="line">    target.close()</span><br><span class="line"></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adder</span><span class="params">(target)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        value = (<span class="keyword">yield</span>)</span><br><span class="line">        target.send(value + <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printer</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        value = (<span class="keyword">yield</span>)</span><br><span class="line">        print(value)</span><br><span class="line"></span><br><span class="line">reader(adder(printer()))  <span class="comment"># 100, 101, ..., 109</span></span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h2 id="Libraries"><a href="#Libraries" class="headerlink" title="Libraries"></a>Libraries</h2><h3 id="Progress-Bar"><a href="#Progress-Bar" class="headerlink" title="Progress Bar"></a>Progress Bar</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install tqdm</span></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]):</span><br><span class="line">    sleep(<span class="number">0.2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">100</span>)):</span><br><span class="line">    sleep(<span class="number">0.02</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Plot"><a href="#Plot" class="headerlink" title="Plot"></a>Plot</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install matplotlib</span></span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot</span><br><span class="line">pyplot.plot(&lt;data_1&gt; [, &lt;data_2&gt;, ...])  <span class="comment"># Or: hist(&lt;data&gt;).</span></span><br><span class="line">pyplot.savefig(&lt;filename&gt;)</span><br><span class="line">pyplot.show()</span><br><span class="line">pyplot.clf()                             <span class="comment"># Clears figure.</span></span><br></pre></td></tr></table></figure>
<h3 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h3><hr>
<h4 id="Prints-a-CSV-file-as-an-ASCII-table"><a href="#Prints-a-CSV-file-as-an-ASCII-table" class="headerlink" title="Prints a CSV file as an ASCII table:"></a>Prints a CSV file as an ASCII table:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install tabulate</span></span><br><span class="line"><span class="keyword">from</span> tabulate <span class="keyword">import</span> tabulate</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(&lt;filename&gt;, encoding=<span class="string">'utf-8'</span>, newline=<span class="string">''</span>) <span class="keyword">as</span> file:</span><br><span class="line">    lines   = csv.reader(file)</span><br><span class="line">    headers = [header.title() <span class="keyword">for</span> header <span class="keyword">in</span> next(lines)]</span><br><span class="line">    table   = tabulate(lines, headers)</span><br><span class="line">    print(table)</span><br></pre></td></tr></table></figure>
<h3 id="Curses"><a href="#Curses" class="headerlink" title="Curses"></a>Curses</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> curses <span class="keyword">import</span> wrapper, ascii</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    wrapper(draw)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw</span><span class="params">(screen)</span>:</span></span><br><span class="line">    screen.clear()</span><br><span class="line">    screen.addstr(<span class="number">0</span>, <span class="number">0</span>, <span class="string">'Press ESC to quit.'</span>)</span><br><span class="line">    <span class="keyword">while</span> screen.getch() != ascii.ESC:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_border</span><span class="params">(screen)</span>:</span></span><br><span class="line">    <span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">    P = namedtuple(<span class="string">'P'</span>, <span class="string">'y x'</span>)</span><br><span class="line">    height, width = screen.getmaxyx()</span><br><span class="line">    <span class="keyword">return</span> P(height<span class="number">-1</span>, width<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h3 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install loguru</span></span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">logger.add(<span class="string">'debug_&#123;time&#125;.log'</span>, colorize=<span class="literal">True</span>)  <span class="comment"># Connects a log file.</span></span><br><span class="line">logger.add(<span class="string">'error_&#123;time&#125;.log'</span>, level=<span class="string">'ERROR'</span>)  <span class="comment"># Another file for errors or higher.</span></span><br><span class="line">logger.&lt;level&gt;(<span class="string">'A logging message.'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Levels: <code>&#39;debug&#39;</code>, <code>&#39;info&#39;</code>, <code>&#39;success&#39;</code>, <code>&#39;warning&#39;</code>, <code>&#39;error&#39;</code>, <code>&#39;critical&#39;</code>.</strong></li>
</ul>
<h4 id="Exceptions-2"><a href="#Exceptions-2" class="headerlink" title="Exceptions"></a>Exceptions</h4><p><strong>Error description, stack trace and values of variables are appended automatically.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">except</span> &lt;exception&gt;:</span><br><span class="line">    logger.exception(<span class="string">'An error happened.'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Rotation"><a href="#Rotation" class="headerlink" title="Rotation"></a>Rotation</h4><p><strong>Argument that sets a condition when a new log file is created.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rotation=&lt;int&gt;|&lt;datetime.timedelta&gt;|&lt;datetime.time&gt;|&lt;str&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong><code>&#39;&lt;int&gt;&#39;</code> - Max file size in bytes.</strong></li>
<li><strong><code>&#39;&lt;timedelta&gt;&#39;</code> - Max age of a file.</strong></li>
<li><strong><code>&#39;&lt;time&gt;&#39;</code> - Time of day.</strong></li>
<li><strong><code>&#39;&lt;str&gt;&#39;</code> - Any of above as a string: <code>&#39;100 MB&#39;</code>, <code>&#39;1 month&#39;</code>, <code>&#39;monday at 12:00&#39;</code>, …</strong></li>
</ul>
<h4 id="Retention"><a href="#Retention" class="headerlink" title="Retention"></a>Retention</h4><p><strong>Sets a condition which old log files are deleted.</strong><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">retention=&lt;int&gt;|&lt;datetime.timedelta&gt;|&lt;str&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong><code>&#39;&lt;int&gt;&#39;</code> - Max number of files.</strong></li>
<li><strong><code>&#39;&lt;timedelta&gt;&#39;</code> - Max age of a file.</strong></li>
<li><strong><code>&#39;&lt;str&gt;&#39;</code> - Max age as a string: <code>&#39;1 week, 3 days&#39;</code>, <code>&#39;2 months&#39;</code>, …</strong></li>
</ul>
<h3 id="Scraping"><a href="#Scraping" class="headerlink" title="Scraping"></a>Scraping</h3><hr>
<h4 id="Scrapes-and-prints-Python’s-URL-and-version-number-from-Wikipedia"><a href="#Scrapes-and-prints-Python’s-URL-and-version-number-from-Wikipedia" class="headerlink" title="Scrapes and prints Python’s URL and version number from Wikipedia:"></a>Scrapes and prints Python’s URL and version number from Wikipedia:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install requests beautifulsoup4</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">url   = <span class="string">'https://en.wikipedia.org/wiki/Python_(programming_language)'</span></span><br><span class="line">page  = requests.get(url)</span><br><span class="line">doc   = BeautifulSoup(page.text, <span class="string">'html.parser'</span>)</span><br><span class="line">table = doc.find(<span class="string">'table'</span>, class_=<span class="string">'infobox vevent'</span>)</span><br><span class="line">rows  = table.find_all(<span class="string">'tr'</span>)</span><br><span class="line">link  = rows[<span class="number">11</span>].find(<span class="string">'a'</span>)[<span class="string">'href'</span>]</span><br><span class="line">ver   = rows[<span class="number">6</span>].find(<span class="string">'div'</span>).text.split()[<span class="number">0</span>]</span><br><span class="line">print(link, ver)</span><br></pre></td></tr></table></figure>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install bottle</span></span><br><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> run, route, post, template, request, response</span><br><span class="line"><span class="keyword">import</span> json</span><br></pre></td></tr></table></figure>
<h4 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">run(host=<span class="string">'localhost'</span>, port=<span class="number">8080</span>)</span><br><span class="line">run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">80</span>, server=<span class="string">'cherrypy'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Static-Request"><a href="#Static-Request" class="headerlink" title="Static Request"></a>Static Request</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@route('/img/&lt;image&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_image</span><span class="params">(image)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> static_file(image, <span class="string">'images/'</span>, mimetype=<span class="string">'image/png'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Dynamic-Request"><a href="#Dynamic-Request" class="headerlink" title="Dynamic Request"></a>Dynamic Request</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@route('/&lt;sport&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_page</span><span class="params">(sport)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> template(<span class="string">'&lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;'</span>, title=sport)</span><br></pre></td></tr></table></figure>
<h4 id="REST-Request"><a href="#REST-Request" class="headerlink" title="REST Request"></a>REST Request</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@post('/odds/&lt;sport&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">odds_handler</span><span class="params">(sport)</span>:</span></span><br><span class="line">    team = request.forms.get(<span class="string">'team'</span>)</span><br><span class="line">    home_odds, away_odds = <span class="number">2.44</span>, <span class="number">3.29</span></span><br><span class="line">    response.headers[<span class="string">'Content-Type'</span>] = <span class="string">'application/json'</span></span><br><span class="line">    response.headers[<span class="string">'Cache-Control'</span>] = <span class="string">'no-cache'</span></span><br><span class="line">    <span class="keyword">return</span> json.dumps([team, home_odds, away_odds])</span><br></pre></td></tr></table></figure>
<h4 id="Test"><a href="#Test" class="headerlink" title="Test:"></a>Test:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install requests</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> requests</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>url  = <span class="string">'http://localhost:8080/odds/football'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = &#123;<span class="string">'team'</span>: <span class="string">'arsenal f.c.'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = requests.post(url, data=data)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.json()</span><br><span class="line">[<span class="string">'arsenal f.c.'</span>, <span class="number">2.44</span>, <span class="number">3.29</span>]</span><br></pre></td></tr></table></figure>
<h3 id="Profile"><a href="#Profile" class="headerlink" title="Profile"></a>Profile</h3><hr>
<h3 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line">start_time = time()                  <span class="comment"># Seconds since Epoch.</span></span><br><span class="line">...</span><br><span class="line">duration = time() - start_time</span><br></pre></td></tr></table></figure>
<h4 id="High-Performance"><a href="#High-Performance" class="headerlink" title="High Performance"></a>High Performance</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> perf_counter <span class="keyword">as</span> pc</span><br><span class="line">start_time = pc()                    <span class="comment"># Seconds since restart.</span></span><br><span class="line">...</span><br><span class="line">duration = pc() - start_time</span><br></pre></td></tr></table></figure>
<h4 id="Timing-a-Snippet"><a href="#Timing-a-Snippet" class="headerlink" title="Timing a Snippet"></a>Timing a Snippet</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> timeit <span class="keyword">import</span> timeit</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(<span class="string">'"-".join(str(a) for a in range(100))'</span>,</span><br><span class="line"><span class="meta">... </span>       number=<span class="number">10000</span>, globals=globals(), setup=<span class="string">'pass'</span>)</span><br><span class="line"><span class="number">0.34986</span></span><br></pre></td></tr></table></figure>
<h4 id="Line-Profiler"><a href="#Line-Profiler" class="headerlink" title="Line Profiler"></a>Line Profiler</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install line_profiler</span></span><br><span class="line"><span class="meta">@profile</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    a = [*range(<span class="number">10000</span>)]</span><br><span class="line">    b = &#123;*range(<span class="number">10000</span>)&#125;</span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<h4 id="Usage"><a href="#Usage" class="headerlink" title="Usage:"></a>Usage:</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ kernprof -lv test.py</span><br><span class="line">Line #      Hits         Time  Per Hit   % Time  Line Contents</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">     1                                           @profile</span><br><span class="line">     2                                           def main():</span><br><span class="line">     3         1       1128.0   1128.0     27.4      a &#x3D; [*range(10000)]</span><br><span class="line">     4         1       2994.0   2994.0     72.6      b &#x3D; &#123;*range(10000)&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Call-Graph"><a href="#Call-Graph" class="headerlink" title="Call Graph"></a>Call Graph</h4><h5 id="Generates-a-PNG-image-of-a-call-graph-with-highlighted-bottlenecks"><a href="#Generates-a-PNG-image-of-a-call-graph-with-highlighted-bottlenecks" class="headerlink" title="Generates a PNG image of a call graph with highlighted bottlenecks:"></a>Generates a PNG image of a call graph with highlighted bottlenecks:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install pycallgraph</span></span><br><span class="line"><span class="keyword">from</span> pycallgraph <span class="keyword">import</span> output, PyCallGraph</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">time_str = datetime.now().strftime(<span class="string">'%Y%m%d%H%M%S'</span>)</span><br><span class="line">filename = <span class="string">f'profile-<span class="subst">&#123;time_str&#125;</span>.png'</span></span><br><span class="line">drawer = output.GraphvizOutput(output_file=filename)</span><br><span class="line"><span class="keyword">with</span> PyCallGraph(drawer):</span><br><span class="line">    &lt;code_to_be_profiled&gt;</span><br></pre></td></tr></table></figure>
<h3 id="NumPy"><a href="#NumPy" class="headerlink" title="NumPy"></a>NumPy</h3><hr>
<p><strong>Array manipulation mini language. Can run up to one hundred times faster than equivalent Python code.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install numpy</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;array&gt; = np.array(&lt;list&gt;)</span><br><span class="line">&lt;array&gt; = np.arange(from_inclusive, to_exclusive, ±step_size)</span><br><span class="line">&lt;array&gt; = np.ones(&lt;shape&gt;)</span><br><span class="line">&lt;array&gt; = np.random.randint(from_inclusive, to_exclusive, &lt;shape&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;array&gt;.shape = &lt;shape&gt;</span><br><span class="line">&lt;view&gt;  = &lt;array&gt;.reshape(&lt;shape&gt;)</span><br><span class="line">&lt;view&gt;  = np.broadcast_to(&lt;array&gt;, &lt;shape&gt;)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;array&gt; = &lt;array&gt;.sum(axis)</span><br><span class="line">indexes = &lt;array&gt;.argmin(axis)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Shape is a tuple of dimension sizes.</strong></li>
<li><strong>Axis is an index of dimension that gets collapsed. Leftmost dimension has index 0.</strong></li>
</ul>
<h4 id="Indexing"><a href="#Indexing" class="headerlink" title="Indexing"></a>Indexing</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;el&gt;       = &lt;2d_array&gt;[0, 0]        <span class="comment"># First element.</span></span><br><span class="line">&lt;1d_view&gt;  = &lt;2d_array&gt;[0]           <span class="comment"># First row.</span></span><br><span class="line">&lt;1d_view&gt;  = &lt;2d_array&gt;[:, 0]        <span class="comment"># First column. Also [..., 0].</span></span><br><span class="line">&lt;3d_view&gt;  = &lt;2d_array&gt;[None, :, :]  <span class="comment"># Expanded by dimension of size 1.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;1d_array&gt; = &lt;2d_array&gt;[&lt;1d_row_indexes&gt;, &lt;1d_column_indexes&gt;]</span><br><span class="line">&lt;2d_array&gt; = &lt;2d_array&gt;[&lt;2d_row_indexes&gt;, &lt;2d_column_indexes&gt;]</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;2d_bools&gt; = &lt;2d_array&gt; &gt; 0</span><br><span class="line">&lt;1d_array&gt; = &lt;2d_array&gt;[&lt;2d_bools&gt;]</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>If row and column indexes differ in shape, they are combined with broadcasting.</strong></li>
</ul>
<h4 id="Broadcasting"><a href="#Broadcasting" class="headerlink" title="Broadcasting"></a>Broadcasting</h4><p><strong>Broadcasting is a set of rules by which NumPy functions operate on arrays of different sizes and/or dimensions.</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">left  = [[<span class="number">0.1</span>], [<span class="number">0.6</span>], [<span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 1)</span></span><br><span class="line">right = [ <span class="number">0.1</span> ,  <span class="number">0.6</span> ,  <span class="number">0.8</span> ]  <span class="comment"># Shape: (3)</span></span><br></pre></td></tr></table></figure>
<h5 id="1-If-array-shapes-differ-in-length-left-pad-the-shorter-shape-with-ones"><a href="#1-If-array-shapes-differ-in-length-left-pad-the-shorter-shape-with-ones" class="headerlink" title="1. If array shapes differ in length, left-pad the shorter shape with ones:"></a>1. If array shapes differ in length, left-pad the shorter shape with ones:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">left  = [[<span class="number">0.1</span>], [<span class="number">0.6</span>], [<span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 1)</span></span><br><span class="line">right = [[<span class="number">0.1</span> ,  <span class="number">0.6</span> ,  <span class="number">0.8</span>]]  <span class="comment"># Shape: (1, 3) &lt;- !</span></span><br></pre></td></tr></table></figure>
<h5 id="2-If-any-dimensions-differ-in-size-expand-the-ones-that-have-size-1-by-duplicating-their-elements"><a href="#2-If-any-dimensions-differ-in-size-expand-the-ones-that-have-size-1-by-duplicating-their-elements" class="headerlink" title="2. If any dimensions differ in size, expand the ones that have size 1 by duplicating their elements:"></a>2. If any dimensions differ in size, expand the ones that have size 1 by duplicating their elements:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">left  = [[<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.1</span>], [<span class="number">0.6</span>, <span class="number">0.6</span>, <span class="number">0.6</span>], [<span class="number">0.8</span>, <span class="number">0.8</span>, <span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 3) &lt;- !</span></span><br><span class="line">right = [[<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>], [<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>], [<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>]]  <span class="comment"># Shape: (3, 3) &lt;- !</span></span><br></pre></td></tr></table></figure>
<h5 id="3-If-neither-non-matching-dimension-has-size-1-rise-an-error"><a href="#3-If-neither-non-matching-dimension-has-size-1-rise-an-error" class="headerlink" title="3. If neither non-matching dimension has size 1, rise an error."></a>3. If neither non-matching dimension has size 1, rise an error.</h5><h4 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h4><h5 id="For-each-point-returns-index-of-its-nearest-point-0-1-0-6-0-8-gt-1-2-1"><a href="#For-each-point-returns-index-of-its-nearest-point-0-1-0-6-0-8-gt-1-2-1" class="headerlink" title="For each point returns index of its nearest point ([0.1, 0.6, 0.8] =&gt; [1, 2, 1]):"></a>For each point returns index of its nearest point (<code>[0.1, 0.6, 0.8] =&gt; [1, 2, 1]</code>):</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>points = np.array([<span class="number">0.1</span>, <span class="number">0.6</span>, <span class="number">0.8</span>])</span><br><span class="line">[ <span class="number">0.1</span>,  <span class="number">0.6</span>,  <span class="number">0.8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>wrapped_points = points.reshape(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">[[ <span class="number">0.1</span>],</span><br><span class="line"> [ <span class="number">0.6</span>],</span><br><span class="line"> [ <span class="number">0.8</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances = wrapped_points - points</span><br><span class="line">[[ <span class="number">0.</span> , <span class="number">-0.5</span>, <span class="number">-0.7</span>],</span><br><span class="line"> [ <span class="number">0.5</span>,  <span class="number">0.</span> , <span class="number">-0.2</span>],</span><br><span class="line"> [ <span class="number">0.7</span>,  <span class="number">0.2</span>,  <span class="number">0.</span> ]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances = np.abs(distances)</span><br><span class="line">[[ <span class="number">0.</span> ,  <span class="number">0.5</span>,  <span class="number">0.7</span>],</span><br><span class="line"> [ <span class="number">0.5</span>,  <span class="number">0.</span> ,  <span class="number">0.2</span>],</span><br><span class="line"> [ <span class="number">0.7</span>,  <span class="number">0.2</span>,  <span class="number">0.</span> ]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>i = np.arange(<span class="number">3</span>)</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances[i, i] = np.inf</span><br><span class="line">[[ inf,  <span class="number">0.5</span>,  <span class="number">0.7</span>],</span><br><span class="line"> [ <span class="number">0.5</span>,  inf,  <span class="number">0.2</span>],</span><br><span class="line"> [ <span class="number">0.7</span>,  <span class="number">0.2</span>,  inf]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances.argmin(<span class="number">1</span>)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<h3 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install pillow</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br></pre></td></tr></table></figure>
<h4 id="Creates-a-PNG-image-of-a-rainbow-gradient"><a href="#Creates-a-PNG-image-of-a-rainbow-gradient" class="headerlink" title="Creates a PNG image of a rainbow gradient:"></a>Creates a PNG image of a rainbow gradient:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">width  = <span class="number">100</span></span><br><span class="line">height = <span class="number">100</span></span><br><span class="line">size   = width * height</span><br><span class="line">pixels = [<span class="number">255</span> * i/size <span class="keyword">for</span> i <span class="keyword">in</span> range(size)]</span><br><span class="line"></span><br><span class="line">img = Image.new(<span class="string">'HSV'</span>, (width, height))</span><br><span class="line">img.putdata([(int(a), <span class="number">255</span>, <span class="number">255</span>) <span class="keyword">for</span> a <span class="keyword">in</span> pixels])</span><br><span class="line">img.convert(mode=<span class="string">'RGB'</span>).save(<span class="string">'test.png'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Adds-noise-to-a-PNG-image"><a href="#Adds-noise-to-a-PNG-image" class="headerlink" title="Adds noise to a PNG image:"></a>Adds noise to a PNG image:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">add_noise = <span class="keyword">lambda</span> value: max(<span class="number">0</span>, min(<span class="number">255</span>, value + randint(<span class="number">-20</span>, <span class="number">20</span>)))</span><br><span class="line">img = Image.open(<span class="string">'test.png'</span>).convert(mode=<span class="string">'HSV'</span>)</span><br><span class="line">img.putdata([(add_noise(h), s, v) <span class="keyword">for</span> h, s, v <span class="keyword">in</span> img.getdata()])</span><br><span class="line">img.convert(mode=<span class="string">'RGB'</span>).save(<span class="string">'test.png'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Modes-1"><a href="#Modes-1" class="headerlink" title="Modes"></a>Modes</h4><ul>
<li><strong><code>&#39;1&#39;</code> - 1-bit pixels, black and white, stored with one pixel per byte.</strong></li>
<li><strong><code>&#39;L&#39;</code> - 8-bit pixels, greyscale.</strong></li>
<li><strong><code>&#39;RGB&#39;</code> - 3x8-bit pixels, true color.</strong></li>
<li><strong><code>&#39;RGBA&#39;</code> - 4x8-bit pixels, true color with transparency mask.</strong></li>
<li><strong><code>&#39;HSV&#39;</code> - 3x8-bit pixels, Hue, Saturation, Value color space.</strong></li>
</ul>
<h3 id="Audio"><a href="#Audio" class="headerlink" title="Audio"></a>Audio</h3><hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> wave</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack, iter_unpack</span><br></pre></td></tr></table></figure>
<h4 id="Read-Frames-from-WAV-File"><a href="#Read-Frames-from-WAV-File" class="headerlink" title="Read Frames from WAV File"></a>Read Frames from WAV File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_wav_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> wave.open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> wf:</span><br><span class="line">        frames = wf.readframes(wf.getnframes())</span><br><span class="line">        <span class="keyword">return</span> [a[<span class="number">0</span>] <span class="keyword">for</span> a <span class="keyword">in</span> iter_unpack(<span class="string">'&lt;h'</span>, frames)]</span><br></pre></td></tr></table></figure>
<h4 id="Write-Frames-to-WAV-File"><a href="#Write-Frames-to-WAV-File" class="headerlink" title="Write Frames to WAV File"></a>Write Frames to WAV File</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_wav_file</span><span class="params">(filename, frames_int, mono=True)</span>:</span></span><br><span class="line">    frames_short = (pack(<span class="string">'&lt;h'</span>, a) <span class="keyword">for</span> a <span class="keyword">in</span> frames_int)</span><br><span class="line">    <span class="keyword">with</span> wave.open(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> wf:</span><br><span class="line">        wf.setnchannels(<span class="number">1</span> <span class="keyword">if</span> mono <span class="keyword">else</span> <span class="number">2</span>)</span><br><span class="line">        wf.setsampwidth(<span class="number">2</span>)</span><br><span class="line">        wf.setframerate(<span class="number">44100</span>)</span><br><span class="line">        wf.writeframes(<span class="string">b''</span>.join(frames_short))</span><br></pre></td></tr></table></figure>
<h4 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><h5 id="Saves-a-sine-wave-to-a-mono-WAV-file"><a href="#Saves-a-sine-wave-to-a-mono-WAV-file" class="headerlink" title="Saves a sine wave to a mono WAV file:"></a>Saves a sine wave to a mono WAV file:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> pi, sin</span><br><span class="line">frames_f = (sin(i * <span class="number">2</span> * pi * <span class="number">440</span> / <span class="number">44100</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100000</span>))</span><br><span class="line">frames_i = (int(a * <span class="number">30000</span>) <span class="keyword">for</span> a <span class="keyword">in</span> frames_f)</span><br><span class="line">write_to_wav_file(<span class="string">'test.wav'</span>, frames_i)</span><br></pre></td></tr></table></figure>
<h5 id="Adds-noise-to-a-mono-WAV-file"><a href="#Adds-noise-to-a-mono-WAV-file" class="headerlink" title="Adds noise to a mono WAV file:"></a>Adds noise to a mono WAV file:</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">add_noise = <span class="keyword">lambda</span> value: max(<span class="number">-32768</span>, min(<span class="number">32767</span>, value + randint(<span class="number">-500</span>, <span class="number">500</span>)))</span><br><span class="line">frames_i  = (add_noise(a) <span class="keyword">for</span> a <span class="keyword">in</span> read_wav_file(<span class="string">'test.wav'</span>))</span><br><span class="line">write_to_wav_file(<span class="string">'test.wav'</span>, frames_i)</span><br></pre></td></tr></table></figure>
<h4 id="Synthesizer"><a href="#Synthesizer" class="headerlink" title="Synthesizer"></a>Synthesizer</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $ pip3 install simpleaudio</span></span><br><span class="line"><span class="keyword">import</span> simpleaudio, math, struct</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain, repeat</span><br><span class="line">F  = <span class="number">44100</span></span><br><span class="line">P1 = <span class="string">'71♪,69,,71♪,66,,62♪,66,,59♪,,,'</span></span><br><span class="line">P2 = <span class="string">'71♪,73,,74♪,73,,74,,71,,73♪,71,,73,,69,,71♪,69,,71,,67,,71♪,,,'</span></span><br><span class="line">get_pause  = <span class="keyword">lambda</span> seconds: repeat(<span class="number">0</span>, int(seconds * F))</span><br><span class="line">sin_f      = <span class="keyword">lambda</span> i, hz: math.sin(i * <span class="number">2</span> * math.pi * hz / F)</span><br><span class="line">get_wave   = <span class="keyword">lambda</span> hz, seconds: (sin_f(i, hz) <span class="keyword">for</span> i <span class="keyword">in</span> range(int(seconds * F)))</span><br><span class="line">get_hz     = <span class="keyword">lambda</span> key: <span class="number">8.176</span> * <span class="number">2</span> ** (int(key) / <span class="number">12</span>)</span><br><span class="line">parse_note = <span class="keyword">lambda</span> note: (get_hz(note[:<span class="number">2</span>]), <span class="number">0.25</span> <span class="keyword">if</span> <span class="string">'♪'</span> <span class="keyword">in</span> note <span class="keyword">else</span> <span class="number">0.125</span>)</span><br><span class="line">get_frames = <span class="keyword">lambda</span> note: get_wave(*parse_note(note)) <span class="keyword">if</span> note <span class="keyword">else</span> get_pause(<span class="number">0.125</span>)</span><br><span class="line">frames_f   = chain.from_iterable(get_frames(n) <span class="keyword">for</span> n <span class="keyword">in</span> <span class="string">f'<span class="subst">&#123;P1&#125;</span><span class="subst">&#123;P1&#125;</span><span class="subst">&#123;P2&#125;</span>'</span>.split(<span class="string">','</span>))</span><br><span class="line">frames_b   = <span class="string">b''</span>.join(struct.pack(<span class="string">'&lt;h'</span>, int(f * <span class="number">30000</span>)) <span class="keyword">for</span> f <span class="keyword">in</span> frames_f)</span><br><span class="line">simpleaudio.play_buffer(frames_b, <span class="number">1</span>, <span class="number">2</span>, F)</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>序列标注</title>
    <url>/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>后面需要补充序列标注在分词、词性标注、命名实体识别等相关任务的代码实践(走过的坑。。)及相关理论知识。</p>
<h3 id="条件随机场-CRF"><a href="#条件随机场-CRF" class="headerlink" title="条件随机场(CRF)"></a>条件随机场(CRF)</h3><h4 id="crf-用于序列标注问题"><a href="#crf-用于序列标注问题" class="headerlink" title="crf 用于序列标注问题"></a>crf 用于序列标注问题</h4><p>在 CRF 的序列标注问题中，要计算的是条件概率：</p>
<script type="math/tex; mode=display">
P\left(y_{1}, \ldots, y_{n} | x_{1}, \ldots, x_{n}\right)=P\left(y_{1}, \ldots, y_{n} | \boldsymbol{x}\right), \quad \boldsymbol{x}=\left(x_{1}, \ldots, x_{n}\right) \tag{1}</script><a id="more"></a>
<p>为了得到这个概率的估计，CRF 做了两个假设：</p>
<h5 id="假设一：该分布是指数族分布。"><a href="#假设一：该分布是指数族分布。" class="headerlink" title="假设一：该分布是指数族分布。"></a><strong>假设一：该分布是指数族分布。</strong></h5><p>这个假设意味着存在函数 $f(y_1,…,y_n;x)$，使得：</p>
<script type="math/tex; mode=display">
P\left(y_{1}, \ldots, y_{n} | \boldsymbol{x}\right)=\frac{1}{Z(\boldsymbol{x})} \exp \left(f\left(y_{1}, \ldots, y_{n} ; \boldsymbol{x}\right)\right) \tag{2}</script><p>其中 Z(x) 是归一化因子，因为这个是条件分布，所以归一化因子跟 x 有关。这个 f 函数可以视为一个打分函数，打分函数取指数并归一化后就得到概率分布。 </p>
<h5 id="假设二：输出之间的关联仅发生在相邻位置，并且关联是指数加性的。"><a href="#假设二：输出之间的关联仅发生在相邻位置，并且关联是指数加性的。" class="headerlink" title="假设二：输出之间的关联仅发生在相邻位置，并且关联是指数加性的。"></a><strong>假设二：输出之间的关联仅发生在相邻位置，并且关联是指数加性的。</strong></h5><p>这个假设意味着 f(y1,…,yn;x) 可以更进一步简化为：</p>
<script type="math/tex; mode=display">
\begin{aligned}
f\left(y_{1}, \ldots, y_{n} ; \boldsymbol{x}\right)=h\left(y_{1} ; \boldsymbol{x}\right) &+g\left(y_{1}, y_{2} ; \boldsymbol{x}\right)+h\left(y_{2} ; \boldsymbol{x}\right)+\ldots \\
&+g\left(y_{n-1}, y_{n} ; \boldsymbol{x}\right)+h\left(y_{n} ; \boldsymbol{x}\right)
\end{aligned} \tag{3}</script><p>这也就是说，现在我们只需要对每一个标签和每一个相邻标签对分别打分，然后将所有打分结果求和得到总分。</p>
<h5 id="线性链crf"><a href="#线性链crf" class="headerlink" title="线性链crf"></a>线性链crf</h5><p>尽管已经做了大量简化，但一般来说，(3)式所表示的概率模型还是过于复杂，难以求解。<strong>于是考虑到当前深度学习模型中，RNN 或者层叠 CNN 等模型已经能够比较充分捕捉各个 y 与输出 x 的联系</strong>，因此，不妨考虑函数 g 跟 x 无关，那么：</p>
<script type="math/tex; mode=display">
\begin{aligned}
f\left(y_{1}, \ldots, y_{n} ; \boldsymbol{x}\right)=h\left(y_{1} ; \boldsymbol{x}\right) &+g\left(y_{1}, y_{2}\right)+h\left(y_{2} ; \boldsymbol{x}\right)+\ldots \\
&+g\left(y_{n-1}, y_{n}\right)+h\left(y_{n} ; \boldsymbol{x}\right)
\end{aligned}</script><p>这时候 g 实际上就是一个有限的、待训练的参数矩阵而已，而单标签的打分函数 $h(y_i;x$) 可以通过 RNN 或者 CNN 来建模。因此，该模型是可以建立的，其中概率分布变为：</p>
<script type="math/tex; mode=display">
P\left(y_{1}, \ldots, y_{n} | x\right)=\frac{1}{Z(x)} \exp \left(h\left(y_{1} ; x\right)+\sum_{k=1}^{n-1} g\left(y_{k}, y_{k+1}\right)+h\left(y_{k+1} ; x\right)\right)</script><h5 id="归一化因子"><a href="#归一化因子" class="headerlink" title="归一化因子"></a>归一化因子</h5><p>为了训练 CRF 模型，用最大似然方法，也就是用：$-\log P\left(y_{1}, \ldots, y_{n} | x\right)$，作为损失函数，可以算出它等于：</p>
<script type="math/tex; mode=display">
-\left(h\left(y_{1} ; \boldsymbol{x}\right)+\sum_{k=1}^{n-1} g\left(y_{k}, y_{k+1}\right)+h\left(y_{k+1} ; \boldsymbol{x}\right)\right)+\log Z(\boldsymbol{x})</script><p>其中第一项是原来概率式的<strong>分子</strong>的对数，它是对目标的序列的打分，虽然它看上去挺迂回的，但是并不难计算。真正的难度在于<strong>分母</strong>的对数 $logZ(x)$ 这一项。</p>
<p>归一化因子，在物理上也叫配分函数，在这里它需要我们对所有可能的路径的打分进行指数求和，而我们前面已经说到，这样的路径数是指数量级的（k^n），因此直接来算几乎是不可能的。</p>
<p>事实上，<strong>归一化因子难算，几乎是所有概率图模型的公共难题</strong>。幸运的是，在 CRF 模型中，由于我们只考虑了临近标签的联系（马尔可夫假设），因此我们可以递归地算出归一化因子，这使得原来是指数级的计算量降低为线性级别。</p>
<p>具体来说，我们将计算到时刻 $t$ 的归一化因子记为$Z_t$，并将它分为 $k$ 个部分：</p>
<script type="math/tex; mode=display">
Z_{t}=Z_{t}^{(1)}+Z_{t}^{(2)}+\cdots+Z_{t}^{(k)}</script><p>分别是截止到当前时刻 $t$ 中、以标签 $1,…,k$ 为终点的所有路径的得分指数和。那么，我们可以递归地计算：</p>
<script type="math/tex; mode=display">
\begin{aligned}
Z_{t+1}^{(1)} &=\left(Z_{t}^{(1)} G_{11}+Z_{t}^{(2)} G_{21}+\cdots+Z_{t}^{(k)} G_{k 1}\right) h_{t+1}(1 | x) \\
Z_{t+1}^{(2)} &=\left(Z_{t}^{(1)} G_{12}+Z_{t}^{(2)} G_{22}+\cdots+Z_{t}^{(k)} G_{k 2}\right) h_{t+1}(2 | x) \\
& \vdots \\
Z_{t+1}^{(k)} &=\left(Z_{t}^{(1)} G_{1 k}+Z_{t}^{(2)} G_{2 k}+\cdots+Z_{t}^{(k)} G_{k k}\right) h_{t+1}(k | x)
\end{aligned}</script><p>它可以简单写为矩阵形式：</p>
<script type="math/tex; mode=display">
\mathbf{Z}_{t+1}=\mathbf{Z}_{t} \boldsymbol{G} \otimes H\left(y_{t+1} | \boldsymbol{x}\right)</script><p>其中,$Z_{t}=\left[Z_{t}^{(1)}, \ldots, Z_{t}^{(k)}\right]$,而 G 是对 g(yi,yj) (状态转移)各个元素取指数后的矩阵，即$G=e^{g(y i, y j)}$,而$H(y_{t+1}|x)$,是编码模型$h(y_{t+1}|x)$,（RNN、CNN等）对位置 t+1 的各个标签的打分的指数，即$H\left(y_{t+1} | x\right)=e^{h\left(y_{t+1} | x\right)}$，也是一个向量。$Z_tG$ 这一步是矩阵乘法，得到一个向量，而 $⊗$ 是两个向量的逐位对应相乘。</p>
<p><img src="/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/decode-crf.png" alt="avatar"></p>
<p>从t到t+1时刻的计算，包括转移概率和j+1节点本身的概率</p>
<h5 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h5><p>写出损失函数 $-logP(y_1,…,y_n|x)$ 后，就可以完成模型的训练了，因为目前的深度学习框架都已经带有自动求导的功能，只要我们能写出可导的 loss，就可以帮我们完成优化过程了。 </p>
<p>那么剩下的最后一步，就是模型训练完成后，如何根据输入找出最优路径来。跟前面一样，这也是一个从 $k^n$ 条路径中选最优的问题，而同样地，因为马尔可夫假设的存在，它可以转化为一个动态规划问题，用 viterbi 算法解决，计算量正比于 n。 </p>
<p>动态规划在本博客已经出现了多次了，<strong>它的递归思想就是：一条最优路径切成两段，那么每一段都是一条（局部）最优路径</strong>。</p>
<h5 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List, Optional</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRF</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="string">"""Conditional random field.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This module implements a conditional random field [LMP01]_. The forward computation</span></span><br><span class="line"><span class="string">    of this class computes the log likelihood of the given sequence of tags and</span></span><br><span class="line"><span class="string">    emission score tensor. This class also has `~CRF.decode` method which finds</span></span><br><span class="line"><span class="string">    the best tag sequence given an emission score tensor using `Viterbi algorithm`_.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        num_tags: Number of tags.</span></span><br><span class="line"><span class="string">        batch_first: Whether the first dimension corresponds to the size of a minibatch.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Attributes:</span></span><br><span class="line"><span class="string">        start_transitions (`~torch.nn.Parameter`): Start transition score tensor of size</span></span><br><span class="line"><span class="string">            ``(num_tags,)``.</span></span><br><span class="line"><span class="string">        end_transitions (`~torch.nn.Parameter`): End transition score tensor of size</span></span><br><span class="line"><span class="string">            ``(num_tags,)``.</span></span><br><span class="line"><span class="string">        transitions (`~torch.nn.Parameter`): Transition score tensor of size</span></span><br><span class="line"><span class="string">            ``(num_tags, num_tags)``.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. [LMP01] Lafferty, J., McCallum, A., Pereira, F. (2001).</span></span><br><span class="line"><span class="string">       "Conditional random fields: Probabilistic models for segmenting and</span></span><br><span class="line"><span class="string">       labeling sequence data". *Proc. 18th International Conf. on Machine</span></span><br><span class="line"><span class="string">       Learning*. Morgan Kaufmann. pp. 282–289.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. _Viterbi algorithm: https://en.wikipedia.org/wiki/Viterbi_algorithm</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num_tags: int, batch_first: bool = False)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> num_tags &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f'invalid number of tags: <span class="subst">&#123;num_tags&#125;</span>'</span>)</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.num_tags = num_tags</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line">        self.start_transitions = nn.Parameter(torch.empty(num_tags))</span><br><span class="line">        self.end_transitions = nn.Parameter(torch.empty(num_tags))</span><br><span class="line">        self.transitions = nn.Parameter(torch.empty(num_tags, num_tags))</span><br><span class="line"></span><br><span class="line">        self.reset_parameters()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset_parameters</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">"""Initialize the transition parameters.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        The parameters will be initialized randomly from a uniform distribution</span></span><br><span class="line"><span class="string">        between -0.1 and 0.1.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        nn.init.uniform_(self.start_transitions, <span class="number">-0.1</span>, <span class="number">0.1</span>)</span><br><span class="line">        nn.init.uniform_(self.end_transitions, <span class="number">-0.1</span>, <span class="number">0.1</span>)</span><br><span class="line">        nn.init.uniform_(self.transitions, <span class="number">-0.1</span>, <span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span> -&gt; str:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'<span class="subst">&#123;self.__class__.__name__&#125;</span>(num_tags=<span class="subst">&#123;self.num_tags&#125;</span>)'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            self,</span></span></span><br><span class="line"><span class="function"><span class="params">            emissions: torch.Tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            tags: torch.LongTensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            mask: Optional[torch.ByteTensor] = None,</span></span></span><br><span class="line"><span class="function"><span class="params">            reduction: str = <span class="string">'sum'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span> -&gt; torch.Tensor:</span></span><br><span class="line">        <span class="string">"""Compute the conditional log likelihood of a sequence of tags given emission scores.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            emissions (`~torch.Tensor`): Emission score tensor of size</span></span><br><span class="line"><span class="string">                ``(seq_length, batch_size, num_tags)`` if ``batch_first`` is ``False``,</span></span><br><span class="line"><span class="string">                ``(batch_size, seq_length, num_tags)`` otherwise.</span></span><br><span class="line"><span class="string">            tags (`~torch.LongTensor`): Sequence of tags tensor of size</span></span><br><span class="line"><span class="string">                ``(seq_length, batch_size)`` if ``batch_first`` is ``False``,</span></span><br><span class="line"><span class="string">                ``(batch_size, seq_length)`` otherwise.</span></span><br><span class="line"><span class="string">            mask (`~torch.ByteTensor`): Mask tensor of size ``(seq_length, batch_size)``</span></span><br><span class="line"><span class="string">                if ``batch_first`` is ``False``, ``(batch_size, seq_length)`` otherwise.</span></span><br><span class="line"><span class="string">            reduction: Specifies  the reduction to apply to the output:</span></span><br><span class="line"><span class="string">                ``none|sum|mean|token_mean``. ``none``: no reduction will be applied.</span></span><br><span class="line"><span class="string">                ``sum``: the output will be summed over batches. ``mean``: the output will be</span></span><br><span class="line"><span class="string">                averaged over batches. ``token_mean``: the output will be averaged over tokens.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            `~torch.Tensor`: The log likelihood. This will have size ``(batch_size,)`` if</span></span><br><span class="line"><span class="string">            reduction is ``none``, ``()`` otherwise.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self._validate(emissions, tags=tags, mask=mask)</span><br><span class="line">        <span class="keyword">if</span> reduction <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">'none'</span>, <span class="string">'sum'</span>, <span class="string">'mean'</span>, <span class="string">'token_mean'</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f'invalid reduction: <span class="subst">&#123;reduction&#125;</span>'</span>)</span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            mask = torch.ones_like(tags, dtype=torch.uint8)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.batch_first:</span><br><span class="line">            emissions = emissions.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            tags = tags.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            mask = mask.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        numerator = self._compute_score(emissions, tags, mask)</span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        denominator = self._compute_normalizer(emissions, mask)</span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        llh = numerator - denominator</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> reduction == <span class="string">'none'</span>:</span><br><span class="line">            <span class="keyword">return</span> llh</span><br><span class="line">        <span class="keyword">if</span> reduction == <span class="string">'sum'</span>:</span><br><span class="line">            <span class="keyword">return</span> llh.sum()</span><br><span class="line">        <span class="keyword">if</span> reduction == <span class="string">'mean'</span>:</span><br><span class="line">            <span class="keyword">return</span> llh.mean()</span><br><span class="line">        <span class="keyword">assert</span> reduction == <span class="string">'token_mean'</span></span><br><span class="line">        <span class="keyword">return</span> llh.sum() / mask.type_as(emissions).sum()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(self, emissions: torch.Tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">               mask: Optional[torch.ByteTensor] = None)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        <span class="string">"""Find the most likely tag sequence using Viterbi algorithm.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            emissions (`~torch.Tensor`): Emission score tensor of size</span></span><br><span class="line"><span class="string">                ``(seq_length, batch_size, num_tags)`` if ``batch_first`` is ``False``,</span></span><br><span class="line"><span class="string">                ``(batch_size, seq_length, num_tags)`` otherwise.</span></span><br><span class="line"><span class="string">            mask (`~torch.ByteTensor`): Mask tensor of size ``(seq_length, batch_size)``</span></span><br><span class="line"><span class="string">                if ``batch_first`` is ``False``, ``(batch_size, seq_length)`` otherwise.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            List of list containing the best tag sequence for each batch.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self._validate(emissions, mask=mask)</span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            mask = emissions.new_ones(emissions.shape[:<span class="number">2</span>], dtype=torch.uint8)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.batch_first:</span><br><span class="line">            emissions = emissions.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            mask = mask.transpose(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self._viterbi_decode(emissions, mask)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_validate</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            self,</span></span></span><br><span class="line"><span class="function"><span class="params">            emissions: torch.Tensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            tags: Optional[torch.LongTensor] = None,</span></span></span><br><span class="line"><span class="function"><span class="params">            mask: Optional[torch.ByteTensor] = None)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> emissions.dim() != <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f'emissions must have dimension of 3, got <span class="subst">&#123;emissions.dim()&#125;</span>'</span>)</span><br><span class="line">        <span class="keyword">if</span> emissions.size(<span class="number">2</span>) != self.num_tags:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(</span><br><span class="line">                <span class="string">f'expected last dimension of emissions is <span class="subst">&#123;self.num_tags&#125;</span>, '</span></span><br><span class="line">                <span class="string">f'got <span class="subst">&#123;emissions.size(<span class="number">2</span>)&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> tags <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> emissions.shape[:<span class="number">2</span>] != tags.shape:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(</span><br><span class="line">                    <span class="string">'the first two dimensions of emissions and tags must match, '</span></span><br><span class="line">                    <span class="string">f'got <span class="subst">&#123;tuple(emissions.shape[:<span class="number">2</span>])&#125;</span> and <span class="subst">&#123;tuple(tags.shape)&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> emissions.shape[:<span class="number">2</span>] != mask.shape:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(</span><br><span class="line">                    <span class="string">'the first two dimensions of emissions and mask must match, '</span></span><br><span class="line">                    <span class="string">f'got <span class="subst">&#123;tuple(emissions.shape[:<span class="number">2</span>])&#125;</span> and <span class="subst">&#123;tuple(mask.shape)&#125;</span>'</span>)</span><br><span class="line">            no_empty_seq = <span class="keyword">not</span> self.batch_first <span class="keyword">and</span> mask[<span class="number">0</span>].all()</span><br><span class="line">            no_empty_seq_bf = self.batch_first <span class="keyword">and</span> mask[:, <span class="number">0</span>].all()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> no_empty_seq <span class="keyword">and</span> <span class="keyword">not</span> no_empty_seq_bf:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">'mask of the first timestep must all be on'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_compute_score</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            self, emissions: torch.Tensor, tags: torch.LongTensor,</span></span></span><br><span class="line"><span class="function"><span class="params">            mask: torch.ByteTensor)</span> -&gt; torch.Tensor:</span></span><br><span class="line">        <span class="comment"># emissions: (seq_length, batch_size, num_tags)</span></span><br><span class="line">        <span class="comment"># tags: (seq_length, batch_size)</span></span><br><span class="line">        <span class="comment"># mask: (seq_length, batch_size)</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.dim() == <span class="number">3</span> <span class="keyword">and</span> tags.dim() == <span class="number">2</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.shape[:<span class="number">2</span>] == tags.shape</span><br><span class="line">        <span class="keyword">assert</span> emissions.size(<span class="number">2</span>) == self.num_tags</span><br><span class="line">        <span class="keyword">assert</span> mask.shape == tags.shape</span><br><span class="line">        <span class="keyword">assert</span> mask[<span class="number">0</span>].all()</span><br><span class="line"></span><br><span class="line">        seq_length, batch_size = tags.shape</span><br><span class="line">        mask = mask.type_as(emissions)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Start transition score and first emission</span></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        score = self.start_transitions[tags[<span class="number">0</span>]]</span><br><span class="line">        score += emissions[<span class="number">0</span>, torch.arange(batch_size), tags[<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, seq_length):</span><br><span class="line">            <span class="comment"># Transition score to next tag, only added if next timestep is valid (mask == 1)</span></span><br><span class="line">            <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">            score += self.transitions[tags[i - <span class="number">1</span>], tags[i]] * mask[i]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Emission score for next tag, only added if next timestep is valid (mask == 1)</span></span><br><span class="line">            <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">            score += emissions[i, torch.arange(batch_size), tags[i]] * mask[i]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># End transition score</span></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        seq_ends = mask.long().sum(dim=<span class="number">0</span>) - <span class="number">1</span></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        last_tags = tags[seq_ends, torch.arange(batch_size)]</span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        score += self.end_transitions[last_tags]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_compute_normalizer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            self, emissions: torch.Tensor, mask: torch.ByteTensor)</span> -&gt; torch.Tensor:</span></span><br><span class="line">        <span class="comment"># emissions: (seq_length, batch_size, num_tags)</span></span><br><span class="line">        <span class="comment"># mask: (seq_length, batch_size)</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.dim() == <span class="number">3</span> <span class="keyword">and</span> mask.dim() == <span class="number">2</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.shape[:<span class="number">2</span>] == mask.shape</span><br><span class="line">        <span class="keyword">assert</span> emissions.size(<span class="number">2</span>) == self.num_tags</span><br><span class="line">        <span class="keyword">assert</span> mask[<span class="number">0</span>].all()</span><br><span class="line"></span><br><span class="line">        seq_length = emissions.size(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Start transition score and first emission; score has size of</span></span><br><span class="line">        <span class="comment"># (batch_size, num_tags) where for each batch, the j-th column stores</span></span><br><span class="line">        <span class="comment"># the score that the first timestep has tag j</span></span><br><span class="line">        <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">        score = self.start_transitions + emissions[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, seq_length):</span><br><span class="line">            <span class="comment"># Broadcast score for every possible next tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags, 1)</span></span><br><span class="line">            broadcast_score = score.unsqueeze(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Broadcast emission score for every possible current tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, 1, num_tags)</span></span><br><span class="line">            broadcast_emissions = emissions[i].unsqueeze(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Compute the score tensor of size (batch_size, num_tags, num_tags) where</span></span><br><span class="line">            <span class="comment"># for each sample, entry at row i and column j stores the sum of scores of all</span></span><br><span class="line">            <span class="comment"># possible tag sequences so far that end with transitioning from tag i to tag j</span></span><br><span class="line">            <span class="comment"># and emitting</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags, num_tags)</span></span><br><span class="line">            next_score = broadcast_score + self.transitions + broadcast_emissions</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Sum over all possible current tags, but we're in score space, so a sum</span></span><br><span class="line">            <span class="comment"># becomes a log-sum-exp: for each sample, entry i stores the sum of scores of</span></span><br><span class="line">            <span class="comment"># all possible tag sequences so far, that end in tag i</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">            next_score = torch.logsumexp(next_score, dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Set score to the next score if this timestep is valid (mask == 1)</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">            score = torch.where(mask[i].unsqueeze(<span class="number">1</span>), next_score, score)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># End transition score</span></span><br><span class="line">        <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">        score += self.end_transitions</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Sum (log-sum-exp) over all possible tags</span></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        <span class="keyword">return</span> torch.logsumexp(score, dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_viterbi_decode</span><span class="params">(self, emissions: torch.FloatTensor,</span></span></span><br><span class="line"><span class="function"><span class="params">                        mask: torch.ByteTensor)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        <span class="comment"># emissions: (seq_length, batch_size, num_tags)</span></span><br><span class="line">        <span class="comment"># mask: (seq_length, batch_size)</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.dim() == <span class="number">3</span> <span class="keyword">and</span> mask.dim() == <span class="number">2</span></span><br><span class="line">        <span class="keyword">assert</span> emissions.shape[:<span class="number">2</span>] == mask.shape</span><br><span class="line">        <span class="keyword">assert</span> emissions.size(<span class="number">2</span>) == self.num_tags</span><br><span class="line">        <span class="keyword">assert</span> mask[<span class="number">0</span>].all()</span><br><span class="line"></span><br><span class="line">        seq_length, batch_size = mask.shape</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Start transition and first emission</span></span><br><span class="line">        <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">        score = self.start_transitions + emissions[<span class="number">0</span>]</span><br><span class="line">        history = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># score is a tensor of size (batch_size, num_tags) where for every batch,</span></span><br><span class="line">        <span class="comment"># value at column j stores the score of the best tag sequence so far that ends</span></span><br><span class="line">        <span class="comment"># with tag j</span></span><br><span class="line">        <span class="comment"># history saves where the best tags candidate transitioned from; this is used</span></span><br><span class="line">        <span class="comment"># when we trace back the best tag sequence</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Viterbi algorithm recursive case: we compute the score of the best tag sequence</span></span><br><span class="line">        <span class="comment"># for every possible next tag</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, seq_length):</span><br><span class="line">            <span class="comment"># Broadcast viterbi score for every possible next tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags, 1)</span></span><br><span class="line">            broadcast_score = score.unsqueeze(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Broadcast emission score for every possible current tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, 1, num_tags)</span></span><br><span class="line">            broadcast_emission = emissions[i].unsqueeze(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Compute the score tensor of size (batch_size, num_tags, num_tags) where</span></span><br><span class="line">            <span class="comment"># for each sample, entry at row i and column j stores the score of the best</span></span><br><span class="line">            <span class="comment"># tag sequence so far that ends with transitioning from tag i to tag j and emitting</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags, num_tags)</span></span><br><span class="line">            next_score = broadcast_score + self.transitions + broadcast_emission</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Find the maximum score over all possible current tag</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">            next_score, indices = next_score.max(dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Set score to the next score if this timestep is valid (mask == 1)</span></span><br><span class="line">            <span class="comment"># and save the index that produces the next score</span></span><br><span class="line">            <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">            score = torch.where(mask[i].unsqueeze(<span class="number">1</span>), next_score, score)</span><br><span class="line">            history.append(indices)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># End transition score</span></span><br><span class="line">        <span class="comment"># shape: (batch_size, num_tags)</span></span><br><span class="line">        score += self.end_transitions</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Now, compute the best path for each sample</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># shape: (batch_size,)</span></span><br><span class="line">        seq_ends = mask.long().sum(dim=<span class="number">0</span>) - <span class="number">1</span></span><br><span class="line">        best_tags_list = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> idx <span class="keyword">in</span> range(batch_size):</span><br><span class="line">            <span class="comment"># Find the tag which maximizes the score at the last timestep; this is our best tag</span></span><br><span class="line">            <span class="comment"># for the last timestep</span></span><br><span class="line">            _, best_last_tag = score[idx].max(dim=<span class="number">0</span>)</span><br><span class="line">            best_tags = [best_last_tag.item()]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># We trace back where the best last tag comes from, append that to our best tag</span></span><br><span class="line">            <span class="comment"># sequence, and trace it back again, and so on</span></span><br><span class="line">            <span class="keyword">for</span> hist <span class="keyword">in</span> reversed(history[:seq_ends[idx]]):</span><br><span class="line">                best_last_tag = hist[idx][best_tags[<span class="number">-1</span>]]</span><br><span class="line">                best_tags.append(best_last_tag.item())</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Reverse the order because we start from the last timestep</span></span><br><span class="line">            best_tags.reverse()</span><br><span class="line">            best_tags_list.append(best_tags)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> best_tags_list</span><br></pre></td></tr></table></figure>
<h4 id="逐帧-softmax-和-CRF-的异同"><a href="#逐帧-softmax-和-CRF-的异同" class="headerlink" title="逐帧 softmax 和 CRF 的异同?"></a>逐帧 softmax 和 CRF 的异同?</h4><p><strong>逐帧softmax</strong></p>
<p>CRF 主要用于序列标注问题，可以简单理解为是<strong>给序列中的每一帧都进行分类</strong>，既然是分类，很自然想到将这个序列用 CNN 或者 RNN 进行编码后，接一个全连接层用 softmax 激活，如下图所示：</p>
<p><img src="/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/encoder.png" alt="avatar"></p>
<p>然而，<strong>逐帧softmax并没有直接考虑输出的上下文关联</strong>。比如：当我们设计标签时，比如用 s、b、m、e 的 4 个标签来做字标注法的分词，目标输出序列本身会带有一些上下文关联，如 s 后面就不能接 m 和 e，等等。逐标签 softmax 并没有考虑这种输出层面的上下文关联，所以它意味着把这些关联放到了编码层面，希望模型能自己学到这些内容，但有时候会“强模型所难”。 </p>
<p>而 CRF 则更直接一点，它<strong>将输出层面的关联分离了出来</strong>，这使得模型在学习上更为“从容”,CRF在输出端显式地考虑了上下文关联.</p>
<p><img src="/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/encoder-crf.png" alt="avatar"></p>
<p>如果仅仅是引入输出的关联，还不仅仅是 CRF 的全部，CRF 的真正精巧的地方，是它以路径为单位，考虑的是路径的概率。 </p>
<p>假如一个输入有 n 帧，每一帧的标签有 k 中可能性，那么理论上就有$k^n$中不同的输入。我们将它用如下的网络图进行简单的可视化。在下图中，每个点代表一个标签的可能性，点之间的连线表示标签之间的关联，而每一种标注结果，都对应着图上的一条完整的路径。</p>
<p><img src="/2020/04/09/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8/crf-v.png" alt="avatar"></p>
<p>而在序列标注任务中，我们的正确答案是一般是唯一的。比如“今天天气不错”，如果对应的分词结果是“今天/天气/不/错”，那么目标输出序列就是 bebess，除此之外别的路径都不符合要求。</p>
<p>换言之，在序列标注任务中，我们的研究的基本单位应该是路径，我们要做的事情，是从 $k^n$ 条路径选出正确的一条，那就意味着，如果将它视为一个分类问题，那么将是 $k^n$ 类中选一类的分类问题。</p>
<p>这就是逐帧 softmax 和 CRF 的根本不同了：<strong>前者将序列标注看成是 n 个 k 分类问题，后者将序列标注看成是 1 个$ k^n$ 分类问题</strong>。</p>
<h4 id="CRF"><a href="#CRF" class="headerlink" title="CRF++"></a>CRF++</h4><h5 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h5><p>CRF++ 是C++ 实现的CRF 工具。</p>
<p><a href="https://taku910.github.io/crfpp/" target="_blank" rel="noopener">文档</a></p>
<h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/taku910/crfpp.git</span><br><span class="line">cd crfpp</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>如果make的时候发生找不到winmain.h的错误: 可以下面这种方式修复：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">'/#include "winmain.h"/d'</span> crf_test.cpp</span><br><span class="line">sed -i <span class="string">'/#include "winmain.h"/d'</span> crf_learn.cpp</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>后面需要用到Python 使用训练好的模型所以也一起安装CRFPP, cd python 目录下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cd python</span><br><span class="line">python setup.py build</span><br><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure>
<p>然后在Python 或者Ipython 里输入 <code>import CRFPP</code> 如果发生如下错误</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ImportError: libcrfpp.so<span class="number">.0</span>: cannot open shared object file: No such file <span class="keyword">or</span> directory</span><br></pre></td></tr></table></figure>
<p>可用下面的方法解决</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/ld.so.conf</span><br><span class="line"><span class="comment"># 添加</span></span><br><span class="line">include /usr/local/lib</span><br><span class="line"><span class="comment"># 保存后加载一下</span></span><br><span class="line">sudo /sbin/ldconfig -v</span><br></pre></td></tr></table></figure>
<h5 id="训练数据格式"><a href="#训练数据格式" class="headerlink" title="训练数据格式"></a>训练数据格式</h5><p>对于训练数据，首先需要多列，但不能不一致，既在一个文件里有的行是两列，有的行是三列（这种格式是错误的）；其次第一列代表的是需要标注的<strong>字或词</strong>，最后一列是输出位标记tag，\如果有额外的特征，例如词性什么的，可以加到中间列里，所以训练集或者测试集的文件最少要有两列。以分词举例，标签为BMES</p>
<p>东    N    B<br>南    N    M<br>大    N    M<br>学    N    E<br>欢    V    B<br>迎    V    E<br>您    N    S</p>
<p>其中第3列是标签，也是测试文件中需要预测的结果，有BMES 4种状态。第二列是词性，不是必须的。</p>
<h5 id="特征模板"><a href="#特征模板" class="headerlink" title="特征模板"></a>特征模板</h5><p>每一行模板生成一组状态特征函数，数量是$L<em>N$ 个，$L$是标签状态数是4个。$N$是此行模板在训练集上展开后的唯一样本数，在这个例子中，第一列的唯一字数是7个，所以有$L</em>N = 4*7=28$。例如：U01:%x[0,0]，生成如下28个函数：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">func1 = <span class="keyword">if</span> (output = B and feature=U01:<span class="string">"东"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func2 = <span class="keyword">if</span> (output = M and feature=U01:<span class="string">"东"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func3 = <span class="keyword">if</span> (output = E and feature=U01:<span class="string">"东"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func4 = <span class="keyword">if</span> (output = S and feature=U01:<span class="string">"东"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func5 = <span class="keyword">if</span> (output = B and feature=U01:<span class="string">"南"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">...</span><br><span class="line">func25 = <span class="keyword">if</span> (output = B and feature=U01:<span class="string">"你"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func26 = <span class="keyword">if</span> (output = M and feature=U01:<span class="string">"你"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func27 = <span class="keyword">if</span> (output = E and feature=U01:<span class="string">"你"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">func28 = <span class="keyword">if</span> (output = S and feature=U01:<span class="string">"你"</span>) <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>这些函数经过训练后，其权值表示函数内文字对应该标签的概率（形象说法，概率和可大于1）。</p>
<h6 id="unigram"><a href="#unigram" class="headerlink" title="unigram"></a>unigram</h6><p>U00:%x[-2,0]<br>U01:%x[-1,0]<br>U02:%x[0,0]<br>U03:%x[1,0]<br>U04:%x[2,0]<br>U05:%x[-2,0]/%x[-1,0]/%x[0,0]<br>U06:%x[-1,0]/%x[0,0]/%x[1,0]<br>U07:%x[0,0]/%x[1,0]/%x[2,0]<br>U08:%x[-1,0]/%x[0,0]<br>U09:%x[0,0]/%x[1,0] </p>
<p>这是CRF++例子中给出的模板，一共有９个模板，先看第一个模板，表示当前词和前面的第二个词组成的特征，以‘小明今天穿了一件红色上衣’为例，符合CRF++处理格式的这句话应该变成如下形式：<br>小　Ｂ<br>明　Ｉ<br>今　Ｂ   &lt;— current word<br>天　Ｉ<br>穿　Ｓ<br>了　Ｓ<br>一　Ｂ<br>件　Ｉ<br>红　Ｂ<br>色　Ｉ<br>上　Ｂ<br>衣　Ｉ<br>假设我们有三个标记tag，Ｂ（表示一个词的开头那个字），Ｉ（表示一个词的结尾那个字），Ｓ（表示单个字的词），先看第一个模板Ｕ00:%x[-2,0],第一个模板产生的特征如下： 如果当前词是‘今’，那-2位置对应的字就是‘小’， 每个特征对应的字如下： </p>
<div class="table-container">
<table>
<thead>
<tr>
<th>特征模板</th>
<th>意义</th>
<th>代表特征</th>
</tr>
</thead>
<tbody>
<tr>
<td>U00:%x[-2,0]</td>
<td>-2行，0列</td>
<td>小</td>
</tr>
<tr>
<td>U01:%x[-1,0]</td>
<td>-1行，0列</td>
<td>明</td>
</tr>
<tr>
<td>U02:%x[0,0]</td>
<td>0行，0列</td>
<td>今</td>
</tr>
<tr>
<td>U03:%x[1,0]</td>
<td>1行，0列</td>
<td>天</td>
</tr>
<tr>
<td>U04:%x[2,0]</td>
<td>2行，0列</td>
<td>穿</td>
</tr>
<tr>
<td>U05:%x[-2,0]/%x[-1,0]/%x[0,0]</td>
<td>-2行0列、-1行0列与0行0列的组合</td>
<td>小/明/今</td>
</tr>
<tr>
<td>U06:%x[-1,0]/%x[0,0]/%x[1,0]</td>
<td>-1行0列、0行0列与1行0列的组合</td>
<td>明/今/天</td>
</tr>
<tr>
<td>U07:%x[0,0]/%x[1,0]/%x[2,0]</td>
<td>0行0列、1行0列与2行0列的组合</td>
<td>今/天/穿</td>
</tr>
<tr>
<td>U08:%x[-1,0]/%x[0,0]</td>
<td>-1行0列与0行0列的组合</td>
<td>明/今</td>
</tr>
<tr>
<td>U09:%x[0,0]/%x[1,0]</td>
<td>0行0列与1行0列的组合</td>
<td>今/天</td>
</tr>
</tbody>
</table>
</div>
<p>根据第一个模板U00:%x[-2,0]能得到的转移特征函数如下：<br><code>func1=if(output=B and feature=&#39;U00:小&#39; )　return 1 else return 0</code><br>其中output=B 指的是当前词（字）的预测标记，也就是’今‘的预测标记，每个模板会把所有可能的标记输出都列一遍，然后通过训练确定每种标记的权重，合理的标记在训练样本中出现的次数多，对应的权重就高，不合理的标记在训练样本中出现的少，对应的权重就少，但是在利用模板生成转移特征函数是会把所有可能的特征函数都列出来，由模型通过训练决定每个特征的重要程度。<br><code>func2=if(output=M and feature=’U00:小’) return 1 else return 0</code><br><code>func3=if(output=E and feature=’U00:小’) return 1 else return 0</code><br><code>func4=if(output=S and feature=’U00:小) return 1 else return 0</code><br>得到4个特征函数之后当前这个字’今‘的特征函数利用第一个模板就得到全部了，然后扫描下一个字‘天‘，以’天‘字作为当前字预测这个字的标记tag,同样会得到4个特征函数：<br><code>func5=if(output=B and feature=’U00:明’) return 1 else return 0</code><br><code>func6=if(output=M and feature=’U00:明’) return 1 else return 0</code><br><code>func7=if(output=E and feature=’U00:明’) return 1 else return 0</code><br><code>func7=if(output=S and feature=’U00:明’) return 1 else return 0</code><br>特征函数中的feature指的是当前词的-2位置对应的词或对应的词的特征，因为在这里没有其他特征了，所以用字本身做特征，有的会有词性，那feature就会是’明‘这个字对应的词性而不是字本身了。 这个feature的作用就是确定模板所确定的当前词和临近词</p>
<h6 id="bigram"><a href="#bigram" class="headerlink" title="bigram"></a>bigram</h6><p>与Unigram不同的是，Bigram类型模板生成的函数会多一个参数：上个节点的标签 $y_{i-1}$。生成函B01:%x[0,0] (当前词为“东南大学欢迎您” 的“您”)：<code>func1 = if (prev_output = E and output = S and feature=B01:&quot;您&quot;) return 1 else return 0</code></p>
<p>这样，每行模板则会生成 $L<em>L</em>N$ 个特征函数。经过训练后，这些函数的权值反映了上一个节点的标签对当前节点的影响。(L表示隐状态的个数，如BMES为四个隐状态，N表示训练语料的大小。)</p>
<p>trigam理论上也是可行的，考虑前$y_{i-2},y_{i-1}$对$y_i$的影响，不过crf++并没有实现，这实际和二阶HMM模型类似的，有论文详细描述过其求解，比较复杂，但是其效果提升并未多大，所以一般不使用。</p>
<h6 id="产生特征函数"><a href="#产生特征函数" class="headerlink" title="产生特征函数"></a>产生特征函数</h6><p>训练阶段将遍历数据逐一产生特征函数，写成伪码过程为：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">m：样本个数</span><br><span class="line">k：模板个数</span><br><span class="line">templates：一组特征模板</span><br><span class="line">genFeatureFunc：根据模板和序列x，y和位置i产生特征函数</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; k; j++)&#123;</span><br><span class="line">        genFeatureFunc(templates[j],x,y,i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="特征函数"><a href="#特征函数" class="headerlink" title="特征函数"></a>特征函数</h6><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> B</span><br><span class="line"><span class="number">16</span> U00:-</span><br><span class="line"><span class="number">20</span> U00:<span class="number">0</span></span><br><span class="line"><span class="number">24</span> U00:<span class="number">1</span></span><br><span class="line"><span class="number">28</span> U00:<span class="number">2</span></span><br><span class="line"><span class="number">32</span> U00:<span class="number">3</span></span><br><span class="line"><span class="number">36</span> U00:<span class="number">4</span></span><br><span class="line"><span class="number">40</span> U00:<span class="number">5</span></span><br><span class="line"><span class="number">44</span> U00:<span class="number">6</span></span><br><span class="line"><span class="number">48</span> U00:<span class="number">7</span></span><br><span class="line"><span class="number">52</span> U00:<span class="number">8</span></span><br><span class="line"><span class="number">56</span> U00:<span class="number">9</span></span><br><span class="line"><span class="number">60</span> U00:_B<span class="number">-1</span></span><br><span class="line"><span class="number">64</span> U00:_B<span class="number">-2</span></span><br><span class="line">……</span><br><span class="line"><span class="number">17404</span> U01:厨</span><br><span class="line"><span class="number">17408</span> U01:去</span><br><span class="line"><span class="number">17412</span> U01:县</span><br><span class="line"><span class="number">17416</span> U01:参</span><br><span class="line"><span class="number">17420</span> U01:又</span><br><span class="line"><span class="number">17424</span> U01:叉</span><br><span class="line"><span class="number">17428</span> U01:及</span><br><span class="line"><span class="number">17432</span> U01:友</span><br><span class="line"><span class="number">17436</span> U01:双</span><br><span class="line"><span class="number">17440</span> U01:反</span><br><span class="line"><span class="number">17444</span> U01:发</span><br><span class="line"><span class="number">17448</span> U01:叔</span><br><span class="line"><span class="number">17452</span> U01:取</span><br><span class="line"><span class="number">17456</span> U01:受</span><br><span class="line">……</span><br><span class="line"><span class="number">77800</span> U05:_B<span class="number">-1</span>/一/个</span><br><span class="line"><span class="number">107540</span> U05:一/方/面</span><br><span class="line"><span class="number">107544</span> U05:一/无/所</span><br><span class="line"><span class="number">107548</span> U05:一/日/三</span><br><span class="line"><span class="number">107552</span> U05:一/日/为</span><br><span class="line"><span class="number">107556</span> U05:一/日/之</span><br><span class="line">……</span><br><span class="line"><span class="number">566536</span> U06:万/吨/_B+<span class="number">1</span></span><br><span class="line">……</span><br><span class="line"><span class="number">2159864</span> U09:ｖ/ｅ</span><br></pre></td></tr></table></figure>
<p>按照[id] [参数o]的格式排列，注意到id不是连续的，而是隔了四个（状态s隐藏起来了），这表示这四个标签（BMES）和公共的参数o组合成了四个特征函数。特别的，0-15为BEMS转移到BEMS的转移函数，也就是f(s’, s, o=null)。_B-1表示句子第一个单词前面的一个单词，_B+1表示末尾后面的一个单词.</p>
<h6 id="特征函数权值"><a href="#特征函数权值" class="headerlink" title="特征函数权值"></a>特征函数权值</h6><p>后面的小数依id顺序对应每个特征函数的权值。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">9.0491453814148901</span></span><br><span class="line"><span class="number">7.0388286231971700</span></span><br><span class="line"><span class="number">-7.2545558164093009</span></span><br><span class="line"><span class="number">5.2799470769112835</span></span><br><span class="line"><span class="number">-8.5333633546653758</span></span><br><span class="line"><span class="number">-5.3549190735606933</span></span><br><span class="line"><span class="number">5.2575182675282477</span></span><br><span class="line"><span class="number">-5.4259109736696054</span></span><br></pre></td></tr></table></figure>
<p>比如说有一个句子“商品和服务”，对于每个字都按照上述模板生成一系列U特征函数的参数代入，得到一些类似010101的函数返回值，乘上这些函数的权值求和，就得到了各个标签的分数，由大到小代表输出这些标签的可能性。至于B特征函数（这里特指简单的f(s’, s)），在Viterbi后向解码的时候，前一个标签确定了后就可以代入当前的B特征函数，计算出每个输出标签的分数，再次求和排序即可。</p>
<h5 id="训练及预测"><a href="#训练及预测" class="headerlink" title="训练及预测"></a>训练及预测</h5><p>CRF++的训练命令一般格式如下：<br><code>crf_learn  -f 3 -c 4.0 template train.data model -t</code><br>其中，template为模板文件，train.data为训练语料，-t表示可以得到一个model文件和一个model.txt文件，其他可选参数说明如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">-f, –freq=INT使用属性的出现次数不少于INT(默认为<span class="number">1</span>)</span><br><span class="line">-m, –maxiter=INT设置INT为LBFGS的最大迭代次数 (默认<span class="number">10</span>k)</span><br><span class="line">-c, –cost=FLOAT    设置FLOAT为代价参数，过大会过度拟合 (默认<span class="number">1.0</span>)</span><br><span class="line">-e, –eta=FLOAT设置终止标准FLOAT(默认<span class="number">0.0001</span>)</span><br><span class="line">-C, –convert将文本模式转为二进制模式</span><br><span class="line">-t, –textmodel为调试建立文本模型文件</span><br><span class="line">-a, –algorithm=(CRF|MIRA)    选择训练算法，默认为CRF-L2</span><br><span class="line">-p, –thread=INT线程数(默认<span class="number">1</span>)，利用多个CPU减少训练时间</span><br><span class="line">-H, –shrinking-size=INT    设置INT为最适宜的跌代变量次数 (默认<span class="number">20</span>)</span><br><span class="line">-v, –version显示版本号并退出</span><br><span class="line">-h, –help显示帮助并退出</span><br></pre></td></tr></table></figure>
<p>在训练过程中，会输出一些信息，其意义如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">iter：迭代次数。当迭代次数达到maxiter时，迭代终止</span><br><span class="line">terr：标记错误率</span><br><span class="line">serr：句子错误率</span><br><span class="line">obj：当前对象的值。当这个值收敛到一个确定值的时候，训练完成</span><br><span class="line">diff：与上一个对象值之间的相对差。当此值低于eta时，训练完成</span><br></pre></td></tr></table></figure>
<p>在训练完模型后，我们可以使用训练好的模型对新数据进行预测，预测命令格式如下：<br><code>crf_test -m model seg_word_predict.data &gt; predict.txt</code></p>
<p><code>-m model</code>表示使用我们刚刚训练好的model模型，预测的数据文件为seg_word_predict.data, <code>&gt; predict.txt</code>表示将预测后的数据写入到predict.txt中。</p>
<h6 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h6><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> CRFPP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRFModel</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, model=<span class="string">'model_name'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        函数说明: 类初始化</span></span><br><span class="line"><span class="string">        :param model: 模型名称</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.model = model</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_tagger</span><span class="params">(self, tag_data)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        函数说明: 添加语料</span></span><br><span class="line"><span class="string">        :param tag_data: 数据</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        word_str = tag_data.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.model):</span><br><span class="line">            print(<span class="string">'模型不存在,请确认模型路径是否正确!'</span>)</span><br><span class="line">            exit()</span><br><span class="line">        tagger = CRFPP.Tagger(<span class="string">"-m &#123;&#125; -v 3 -n2"</span>.format(self.model))</span><br><span class="line">        tagger.clear()</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> word_str:</span><br><span class="line">            tagger.add(word)</span><br><span class="line">        tagger.parse()</span><br><span class="line">        <span class="keyword">return</span> tagger</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">text_mark</span><span class="params">(self, tag_data, begin=<span class="string">'B'</span>, middle=<span class="string">'I'</span>, end=<span class="string">'E'</span>, single=<span class="string">'S'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        文本标记</span></span><br><span class="line"><span class="string">        :param tag_data: 数据</span></span><br><span class="line"><span class="string">        :param begin: 开始标记</span></span><br><span class="line"><span class="string">        :param middle: 中间标记</span></span><br><span class="line"><span class="string">        :param end: 结束标记</span></span><br><span class="line"><span class="string">        :param single: 单字结束标记</span></span><br><span class="line"><span class="string">        :return result: 标记列表</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        tagger = self.add_tagger(tag_data)</span><br><span class="line">        size = tagger.size()</span><br><span class="line">        tag_text = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, size):</span><br><span class="line">            word, tag = tagger.x(i, <span class="number">0</span>), tagger.y2(i)</span><br><span class="line">            <span class="keyword">if</span> tag <span class="keyword">in</span> [begin, middle]:</span><br><span class="line">                tag_text += word</span><br><span class="line">            <span class="keyword">elif</span> tag <span class="keyword">in</span> [end, single]:</span><br><span class="line">                tag_text += word + <span class="string">"*&amp;*"</span></span><br><span class="line">        result = tag_text.split(<span class="string">'*&amp;*'</span>)</span><br><span class="line">        result.pop()</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crf_test</span><span class="params">(self, tag_data, separator=<span class="string">'/'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        函数说明: crf测试</span></span><br><span class="line"><span class="string">        :param tag_data:</span></span><br><span class="line"><span class="string">        :param separator:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        result = self.text_mark(tag_data)</span><br><span class="line">        data = separator.join(result)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crf_learn</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        函数说明: 训练模型</span></span><br><span class="line"><span class="string">        :param filename: 已标注数据源</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        crf_bash = <span class="string">"crf_learn -f 3 -c 4.0 api/template.txt &#123;&#125; &#123;&#125;"</span>.format(filename, self.model)</span><br><span class="line">        process = subprocess.Popen(crf_bash.split(), stdout=subprocess.PIPE)</span><br><span class="line">        output = process.communicate()[<span class="number">0</span>]</span><br><span class="line">        print(output.decode(encoding=<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol>
<li><p><a href="https://zhuanlan.zhihu.com/p/37163081" target="_blank" rel="noopener">简明条件随机场CRF介绍 | 附带纯Keras实现</a></p>
</li>
<li><p><a href="https://blog.csdn.net/qq_37667364/article/details/82919560" target="_blank" rel="noopener">CRF++/CRF/条件随机场的特征函数模板</a></p>
</li>
<li><p><a href="https://www.hankcs.com/nlp/the-crf-model-format-description.html" target="_blank" rel="noopener">CRF++模型格式说明</a></p>
</li>
</ol>
]]></content>
      <categories>
        <category>深度学习</category>
      </categories>
      <tags>
        <tag>深度学习</tag>
        <tag>序列标注</tag>
        <tag>条件随机场</tag>
      </tags>
  </entry>
  <entry>
    <title>文本分类</title>
    <url>/2020/03/29/text_classification/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2020/03/29/text_classification/QQ截图20180116105758_副本.png" alt></p>
<a id="more"></a>
<h1 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h1><ol>
<li><p>项目使用深度学习模型进行文本分类，所使用的模型主要包括：FastText，TextCNN，DPCNN，RNN系列(RNN，LSTM，GRU)，RNN-Attention，TextRCNN，HAN，Bert，BertCNN，BertRNN，BertRCNN,XLNet。</p>
</li>
<li><p>方法部分对每个模型及其结构给出简要介绍，并附上pytorch代码实现。</p>
</li>
<li><p>实验部分所采用的的数据集：weibo_senti_100k情感分类(二分类)，cnews新闻十分类，____文本多标签分类。</p>
</li>
</ol>
<p><strong>数据下载</strong>：微博情感分类数据在<a href="https://github.com/jeffery0628/text_classification" target="_blank" rel="noopener">github仓库</a>中给出, <a href="https://pan.baidu.com/s/1OOTK374IZ1DHnz5COUcfbw" target="_blank" rel="noopener">cnews新闻数据</a>  密码:hf6o, <a href>____文本多标签数据</a></p>
<p><strong>词向量下载</strong>：<a href="https://github.com/Embedding/Chinese-Word-Vectors" target="_blank" rel="noopener">词向量</a></p>
<p><strong>预训练模型下载</strong>：<a href="https://github.com/ymcui/Chinese-BERT-wwm" target="_blank" rel="noopener">中文预训练bert模型下载</a>,<a href="https://github.com/ymcui/Chinese-XLNet" target="_blank" rel="noopener">中文预训练XLNet下载</a></p>
<p><strong>项目仓库地址</strong>：<a href="https://github.com/jeffery0628/text_classification" target="_blank" rel="noopener">中文文本分类</a></p>
<p>如出现数学公式乱码以及图片问题，请移步<a href="https://jeffery0628.github.io/">github.io</a>来获得更好的阅读体验。</p>
<p>最后，欢迎star！</p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>文本分类在文本处理中是很重要的一个模块，它的应用也非常广泛，比如：新闻分类、简历分类、邮件分类、办公文档分类、区域分类等诸多方面，还能够实现文本过滤，从大量文本中快速识别和过滤出符合特殊要求的信息。。它和其他的分类没有本质的区别，核心方法为首先提取分类数据的特征，然后选择最优的匹配，从而分类。但是文本也有自己的特点，根据文本的特点，文本分类的一般流程为：1.预处理；2.文本表示及特征选择；3.构造分类器；4.分类。</p>
<p>通常来讲，文本分类任务是指在给定的分类体系中，将文本指定分到某个或某几个类别中。被分类的对象有短文本，例如句子、标题、商品评论等等，长文本，如文章等。分类体系一般人工划分，例如：1）政治、体育、军事 2）正能量、负能量 3）好评、中性、差评。此外，还有文本多标签分类，比如一篇博客的标签可以同时是：自然语言处理，文本分类等。因此，对应的分类模式可以分为：二分类、多分类以及多标签分类问题。</p>
<p><img src="/2020/03/29/text_classification/595c46f937d92.png" alt></p>
<ol>
<li>对文本分类的研究可以追溯到二十世纪五十年代，当时主要依据特定的人工规则进行文本分类。</li>
<li>到二十世纪九十年代，统计机器学习 (Statistical machine learning) 成为主流，一些统计机器学习方法，比如支持向量机和朴素贝叶斯等分类方法在文本分类中取得了非常高的分类准确率。然而，统计机器学习方法首先需要进行特征工程工作，该工作需要深入理解业务需求，并且非常耗时耗力。</li>
<li>随着大数据量和图形处理单元强计算力的支持，深度学习近年来发展迅速，与统计机器学习方法相比，深度学习方法可以自动提取特征，使得人们将注意力更多地集中在数据和模型上。</li>
</ol>
<h1 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h1><p>这里我们根据是否使用深度学习方法将文本分类主要分为一下两个大类：</p>
<ul>
<li>基于机器学习的文本分类（不涉及实现以及实验结果的比较）。</li>
<li>基于深度学习的文本分类。</li>
</ul>
<h2 id="基于机器学习的文本分类"><a href="#基于机器学习的文本分类" class="headerlink" title="基于机器学习的文本分类"></a>基于机器学习的文本分类</h2><p>90年代后互联网在线文本数量增长和机器学习学科的兴起，逐渐形成了一套解决大规模文本分类问题的经典玩法，这个阶段的主要套路是人工特征工程+浅层分类模型。整个文本分类问题就拆分成了<strong>特征工程</strong>和<strong>分类器</strong>两部分。</p>
<h3 id="特征工程"><a href="#特征工程" class="headerlink" title="特征工程"></a>特征工程</h3><p>特征工程也就是将文本表示为计算机可以识别的、能够代表该文档特征的特征矩阵的过程。在基于传统机器学习的文本分类中，通常将特征工程分为<strong>文本预处理、特征提取、文本表示</strong>等三个部分。</p>
<h4 id="文本预处理"><a href="#文本预处理" class="headerlink" title="文本预处理"></a>文本预处理</h4><p>文本预处理过程是提取文本中的关键词来表示文本的过程。中文文本预处理主要包括文本分词和去停用词两个阶段。文本分词，是因为很多研究表明特征粒度为词粒度远好于字粒度（因为大部分分类算法不考虑词序信息，基于字粒度显然损失了过多<code>n-gram</code>信息）。具体到中文分词，不同于英文有天然的空格间隔，需要设计复杂的分词算法。传统分词算法主要有基于字符串匹配的正向/逆向/双向最大匹配；基于理解的句法和语义分析消歧；基于统计的互信息/CRF方法(<code>WordEmbedding+Bi-LSTM+CRF</code>方法逐渐成为主流)。 而停用词是文本中一些高频的代词、连词、介词等对文本分类无意义的词，通常维护一个停用词表，特征提取过程中删除停用表中出现的词，本质上属于特征选择的一部分。</p>
<h4 id="特征提取"><a href="#特征提取" class="headerlink" title="特征提取"></a>特征提取</h4><p>特征提取包括<strong>特征选择</strong>和<strong>特征权重计算</strong>两部分。 特征选择的基本思路是根据某个评价指标独立的对原始特征项（词项）进行评分排序，从中选择得分最高的一些特征项，过滤掉其余的特征项。常用的评价有：文档频率、互信息、信息增益、χ²统计量等。特征权重计算主要是经典的TF-IDF方法及其扩展方法。</p>
<h4 id="文本表示"><a href="#文本表示" class="headerlink" title="文本表示"></a>文本表示</h4><p>文本表示的目的是把文本预处理后的转换成计算机可理解的方式，是决定文本分类质量最重要的部分。</p>
<p><img src="/2020/03/29/text_classification/image-20200520093625468.png" alt></p>
<h5 id="词袋法"><a href="#词袋法" class="headerlink" title="词袋法"></a>词袋法</h5><p>忽略其词序和语法，句法，将文本仅仅看做是一个词集合。若词集合共有NN个词，每个文本表示为一个<code>N</code>维向量，元素为<code>0/1</code>，表示该文本是否包含对应的词。<code>( 0, 0, 0, 0, .... , 1, ... 0, 0, 0, 0)</code>。一般来说词库量至少都是百万级别，因此词袋模型有个两个最大的问题：高纬度、高稀疏性。</p>
<h5 id="n-gram-词袋模型"><a href="#n-gram-词袋模型" class="headerlink" title="n-gram 词袋模型"></a>n-gram 词袋模型</h5><p>与词袋模型类似，考虑了局部的顺序信息，但是向量的维度过大，基本不采用。如果词集合大小为<code>N</code>，则bi-gram的单词总数为$n^2$向量空间模型。</p>
<h5 id="向量空间模型"><a href="#向量空间模型" class="headerlink" title="向量空间模型"></a>向量空间模型</h5><p>以词袋模型为基础，向量空间模型通过特征选择降低维度，通过特征权重计算增加稠密性。</p>
<h3 id="分类器"><a href="#分类器" class="headerlink" title="分类器"></a>分类器</h3><p>大部分机器学习方法都在文本分类领域有所应用，比如朴素贝叶斯分类算法、KNN、SVM、最大熵、GBDT/XGBoost等等。</p>
<h2 id="基于深度学习的文本分类"><a href="#基于深度学习的文本分类" class="headerlink" title="基于深度学习的文本分类"></a>基于深度学习的文本分类</h2><h3 id="FastText"><a href="#FastText" class="headerlink" title="FastText"></a>FastText</h3><h4 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h4><p>fastText是Facebook于2016年开源的一个词向量计算和文本分类工具,<a href="https://arxiv.org/pdf/1607.01759.pdf" target="_blank" rel="noopener">论文地址</a>,其<strong>特点</strong>就是<strong>fast</strong>。在文本分类任务中，fastText（浅层网络）往往能取得和深度网络相媲美的精度，却在训练时间上比深度网络快许多数量级。在标准的多核CPU上， 在10分钟之内能够训练10亿词级别语料库的词向量，在1分钟之内能够分类有着30万多类别的50多万句子。</p>
<p>fastText是一个快速文本分类算法，与基于神经网络的分类算法相比有两大优点：</p>
<ol>
<li>fastText在保持高精度的情况下加快了训练速度和测试速度</li>
<li>fastText不需要预训练好的词向量，fastText会自己训练词向量</li>
<li>fastText两个重要的优化：Hierarchical Softmax、N-gram</li>
</ol>
<h4 id="fastText模型架构"><a href="#fastText模型架构" class="headerlink" title="fastText模型架构"></a>fastText模型架构</h4><p>fastText模型架构和word2vec中的CBOW很相似， 不同之处是fastText预测标签而CBOW预测的是中间词，即模型架构类似但是模型的任务不同：</p>
<p><img src="/2020/03/29/text_classification/image-20200520093324964.png" alt></p>
<p>word2vec将上下文关系转化为多分类任务，进而训练逻辑回归模型。通常的文本数据中，词库少则数万，多则百万，在训练中直接训练多分类逻辑回归并不现实。word2vec中提供了两种针对大规模多分类问题的优化手段， negative sampling 和hierarchical softmax。在优化中，negative sampling 只更新少量负面类，从而减轻了计算量。hierarchical softmax 将词库表示成前缀树，从树根到叶子的路径可以表示为一系列二分类器，一次多分类计算的复杂度从|V|降低到了树的高度。<br>fastText模型架构:其中$x_1,x_2,\ldots,x_{N−1},x_N$表示一个文本中的n-gram向量，每个特征是词向量的平均值。</p>
<p><img src="/2020/03/29/text_classification/image-20200520093359191.png" alt></p>
<h4 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h4><blockquote>
<p>我不喜欢这类电影，但是喜欢这一个。</p>
<p>我喜欢这类电影，但是不喜欢这一个。</p>
</blockquote>
<p><strong>这样的两句句子经过词向量平均以后已经送入单层神经网络的时候已经完全一模一样了，分类器不可能分辨出这两句话的区别</strong>，只有添加n-gram特征以后才可能有区别。因此，在实际应用的时候需要对数据有足够的了解,然后在选择模型。</p>
<h4 id="模型代码"><a href="#模型代码" class="headerlink" title="模型代码"></a>模型代码</h4><p><img src="/2020/03/29/text_classification/FastText_network_structure.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FastText</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, output_dim, word_embedding, freeze)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.embedding_size = word_embedding.vectors.shape[<span class="number">1</span>]</span><br><span class="line">        self.embedding = nn.Embedding.from_pretrained(torch.from_numpy(word_embedding.vectors), freeze=freeze)</span><br><span class="line"></span><br><span class="line">        self.fc = nn.Linear(self.embedding_size, output_dim)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text,_, text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text = [batch size,sent len]</span></span><br><span class="line">        embedded = self.embedding(text)</span><br><span class="line">        <span class="comment"># embedded = [batch size, sent len, emb dim]</span></span><br><span class="line">        pooled = F.avg_pool2d(embedded, (embedded.shape[<span class="number">1</span>], <span class="number">1</span>)).squeeze(<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># pooled = [batch size, embedding_dim]</span></span><br><span class="line">        <span class="keyword">return</span> self.fc(pooled)</span><br></pre></td></tr></table></figure>
<h3 id="TextCNN"><a href="#TextCNN" class="headerlink" title="TextCNN"></a>TextCNN</h3><h4 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h4><p><strong>Yoon Kim</strong>在论文<a href="https://arxiv.org/abs/1408.5882" target="_blank" rel="noopener">(2014 EMNLP) Convolutional Neural Networks for Sentence Classification</a>提出TextCNN。将卷积神经网络CNN应用到文本分类任务，利用多个不同size的kernel来提取句子中的关键信息，从而能够更好地捕捉局部相关性。</p>
<h4 id="网络结构"><a href="#网络结构" class="headerlink" title="网络结构"></a>网络结构</h4><p><img src="/2020/03/29/text_classification/textcnn.png" alt></p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>TextCNN的详细过程原理图如下：</p>
<p><img src="/2020/03/29/text_classification/textcnndetail.png" alt></p>
<p>TextCNN详细过程：</p>
<ul>
<li>Embedding：第一层是图中最左边的7乘5的句子矩阵，每行是词向量，维度=5，这个可以类比为图像中的原始像素点。</li>
<li>Convolution：然后经过 <code>kernel_sizes=(2,3,4)</code>的一维卷积层，每个kernel_size 有两个输出 channel。</li>
<li>MaxPolling：第三层是一个<code>1-max pooling</code>层，这样不同长度句子经过pooling层之后都能变成定长的表示。</li>
<li>FullConnection and Softmax：最后接一层全连接的 softmax 层，输出每个类别的概率。</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><p>TextCNN模型最大的问题也是这个全局的max pooling丢失了结构信息，因此很难去发现文本中的转折关系等复杂模式。针对这个问题，可以尝试k-max pooling做一些优化，k-max pooling针对每个卷积核都不只保留最大的值，他保留前k个最大值，并且保留这些值出现的顺序，也即按照文本中的位置顺序来排列这k个最大值。在某些比较复杂的文本上相对于1-max pooling会有提升。</p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><p><img src="/2020/03/29/text_classification/TextCNN_network_structure.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextCNN</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n_filters, filter_sizes, output_dim, dropout, word_embedding, freeze)</span>:</span></span><br><span class="line">        <span class="comment"># n_filter 每个卷积核的个数</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.embedding_size = word_embedding.vectors.shape[<span class="number">1</span>]</span><br><span class="line">        self.embedding = nn.Embedding.from_pretrained(torch.from_numpy(word_embedding.vectors), freeze=freeze)</span><br><span class="line">        self.convs = nn.ModuleList(</span><br><span class="line">            [nn.Conv2d(in_channels=<span class="number">1</span>, out_channels=n_filters, kernel_size=(fs, self.embedding_size)) <span class="keyword">for</span> fs <span class="keyword">in</span></span><br><span class="line">             filter_sizes])</span><br><span class="line">        self.fc = nn.Linear(len(filter_sizes) * n_filters, output_dim)</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text, _, text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text = [batch size, sent len]</span></span><br><span class="line">        embedded = self.embedding(text)</span><br><span class="line">        <span class="comment"># embedded = [batch size, sent len, emb dim]</span></span><br><span class="line">        embedded = embedded.unsqueeze(<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># embedded = [batch size, 1, sent len, emb dim]</span></span><br><span class="line">        conved = [F.relu(conv(embedded)).squeeze(<span class="number">3</span>) <span class="keyword">for</span> conv <span class="keyword">in</span> self.convs]</span><br><span class="line">        <span class="comment"># conved_n = [batch size, n_filters, sent len - filter_sizes[n] + 1]</span></span><br><span class="line">        pooled = [F.max_pool1d(conv, conv.shape[<span class="number">2</span>]).squeeze(<span class="number">2</span>) <span class="keyword">for</span> conv <span class="keyword">in</span> conved]</span><br><span class="line">        <span class="comment"># pooled_n = [batch size, n_filters]</span></span><br><span class="line">        cat = self.dropout(torch.cat(pooled, dim=<span class="number">1</span>))</span><br><span class="line">        <span class="comment"># cat = [batch size, n_filters * len(filter_sizes)]</span></span><br><span class="line">        <span class="keyword">return</span> self.fc(cat)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextCNN1d</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n_filters, filter_sizes, output_dim, dropout, word_embedding, freeze)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.embedding_size = word_embedding.vectors.shape[<span class="number">1</span>]</span><br><span class="line">        self.embedding = nn.Embedding.from_pretrained(torch.from_numpy(word_embedding.vectors), freeze=freeze)</span><br><span class="line">        self.convs = nn.ModuleList(</span><br><span class="line">            [nn.Conv1d(in_channels=self.embedding_size, out_channels=n_filters, kernel_size=fs) <span class="keyword">for</span> fs <span class="keyword">in</span> filter_sizes])</span><br><span class="line"></span><br><span class="line">        self.fc = nn.Linear(len(filter_sizes) * n_filters, output_dim)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text, _, text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text = [batch size, sent len]</span></span><br><span class="line">        embedded = self.embedding(text)</span><br><span class="line">        <span class="comment"># embedded = [batch size, sent len, emb dim]</span></span><br><span class="line">        embedded = embedded.permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># embedded = [batch size, emb dim, sent len]</span></span><br><span class="line">        conved = [F.relu(conv(embedded)) <span class="keyword">for</span> conv <span class="keyword">in</span> self.convs]</span><br><span class="line">        <span class="comment"># conved_n = [batch size, n_filters, sent len - filter_sizes[n] + 1]</span></span><br><span class="line">        pooled = [F.max_pool1d(conv, conv.shape[<span class="number">2</span>]).squeeze(<span class="number">2</span>) <span class="keyword">for</span> conv <span class="keyword">in</span> conved]</span><br><span class="line">        <span class="comment"># pooled_n = [batch size, n_filters]</span></span><br><span class="line">        cat = self.dropout(torch.cat(pooled, dim=<span class="number">1</span>))</span><br><span class="line">        <span class="comment"># cat = [batch size, n_filters * len(filter_sizes)]</span></span><br><span class="line">        <span class="keyword">return</span> self.fc(cat)</span><br></pre></td></tr></table></figure>
<h3 id="DPCNN"><a href="#DPCNN" class="headerlink" title="DPCNN"></a>DPCNN</h3><h4 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h4><p>ACL2017年中，腾讯AI-lab提出了Deep Pyramid Convolutional Neural Networks for Text Categorization(<a href="https://ai.tencent.com/ailab/media/publications/ACL3-Brady.pdf" target="_blank" rel="noopener">DPCNN</a>)。论文中提出了一种基于word-level级别的网络-DPCNN，由于TextCNN 不能通过卷积获得文本的长距离依赖关系，而论文中DPCNN通过不断加深网络，可以抽取长距离的文本依赖关系。实验证明在不增加太多计算成本的情况下，增加网络深度就可以获得最佳的准确率。‍</p>
<h4 id="网络结构-1"><a href="#网络结构-1" class="headerlink" title="网络结构"></a>网络结构</h4><p><img src="/2020/03/29/text_classification/DPCNN.jpg" alt></p>
<h5 id="Region-embedding"><a href="#Region-embedding" class="headerlink" title="Region embedding"></a>Region embedding</h5><p>作者将TextCNN的包含多尺寸卷积滤波器的卷积层的卷积结果称之为<code>Region embedding</code>，意思就是对一个文本区域/片段（比如<code>3-gram</code>）进行一组卷积操作后生成的embedding。<br>卷积操作有两种选择：</p>
<ol>
<li>保留词序：也就是设置一组<code>size=3*D</code>的二维卷积核对<code>3-gram</code>进行卷积（其中D是word embedding维度）</li>
<li>不保留词序（即使用词袋模型），即首先对<code>3-gram</code>中的3个词的embedding取均值得到一个size=D的向量，然后设置一组size=D的一维卷积核对该<code>3-gram</code>进行卷积。</li>
</ol>
<p>TextCNN里使用的是保留词序的做法，而DPCNN使用的是词袋模型的做法，DPCNN作者认为前者做法更容易造成过拟合，后者的性能却跟前者差不多。</p>
<h4 id="卷积和全连接的权衡"><a href="#卷积和全连接的权衡" class="headerlink" title="卷积和全连接的权衡"></a>卷积和全连接的权衡</h4><p>产生<code>region embedding</code>后，按照经典的TextCNN的做法的话，就是从每个特征图中挑选出最有代表性的特征，也就是直接应用全局最大池化层，这样就生成了这段文本的特征向量,假如卷积滤波器的size有3，4，5这三种，每种size包含100个卷积核，那么当然就会产生3<em>100幅特征图，然后将max-over-time-pooling操作应用到每个特征图上，于是文本的特征向量即3</em>100=300维。<br>TextCNN这样做的意义本质上与<code>词袋模型(n-gram)+weighting+NB/MaxEnt/SVM</code>的经典文本分类模型没本质区别，只不过one-hot表示到word embedding表示的转变避免了词袋模型遭遇的数据稀疏问题。TextCNN本质上收益于词向量的引入带来的近义词有相近向量表示的bonus，同时TextCNN可以较好的利用词向量中近义关系。<strong>经典模型里难以学习的远距离信息在TextCNN中依然难以学习</strong>。</p>
<h5 id="等长卷积"><a href="#等长卷积" class="headerlink" title="等长卷积"></a>等长卷积</h5><p>假设输入的序列长度为$n$，卷积核大小为$m$，步长为$s$,输入序列两端各填补$p$个零,那么该卷积层的输出序列为$\frac{(n-m+2p)}{s}+1$。</p>
<ol>
<li>窄卷积:步长$s=1$,两端不补零，即$p=0$，卷积后输出长度为$n-m+1$。</li>
<li>宽卷积:步长$s=1$,两端补零$p=m-1$，卷积后输出长度$n+m-1$。</li>
<li>等长卷积: 步长$s=1$,两端补零$p=(m-1)/2$，卷积后输出长度为$n$。</li>
</ol>
<p>将输入输出序列的第n个embedding称为第n个词位，那么这时size为n的卷积核产生的等长卷积的意义就是将输入序列的每个词位及其左右$\frac{n-1}{2}$个词的上下文信息压缩为该词位的embedding，产生了每个词位的被上下文信息修饰过的更高level更加准确的语义。想要克服TextCNN的缺点，捕获长距离模式，显然就要用到深层CNN。</p>
<p>直接等长卷积堆等长卷积会让每个词位包含进去越来越多，越来越长的上下文信息，这种方式会让网络层数变得非常非常非常深，但是这种方式太笨重。不过，既然等长卷积堆等长卷积会让每个词位的embedding描述语义描述的更加丰富准确，可以适当的堆两层来提高词位embedding的表示的丰富性。<br><img src="/2020/03/29/text_classification/equal_cnn.png" alt></p>
<h5 id="固定feature-map的数量"><a href="#固定feature-map的数量" class="headerlink" title="固定feature map的数量"></a>固定feature map的数量</h5><p>在表示好每个词位的语义后，很多邻接词或者邻接<code>ngram</code>的词义是可以合并，例如“小明 人 不要 太好”中的“不要”和“太好”虽然语义本来离得很远，但是作为邻接词“不要太好”出现时其语义基本等价为“很好”，完全可以把“不要”和“太好”的语义进行合并。同时，合并的过程完全可以在原始的embedding space中进行的，原文中直接把“不要太好”合并为“很好”是很可以的，完全没有必要动整个语义空间。<br>实际上，相比图像中这种从“点、线、弧”这种low-level特征到“眼睛、鼻子、嘴”这种high-level特征的明显层次性的特征区分，文本中的特征进阶明显要扁平的多，即从单词（1gram）到短语再到3gram、4gram的升级，其实很大程度上均满足“语义取代”的特性。而图像中就很难发生这种“语义取代”现象。因此，DPCNN与ResNet很大一个不同就是，<strong>在DPCNN中固定死了feature map的数量</strong>，也就是固定住了embedding space的维度（为了方便理解，以下简称语义空间），使得网络有可能让整个邻接词（邻接ngram）的合并操作在原始空间或者与原始空间相似的空间中进行（当然，网络在实际中会不会这样做是不一定的，只是提供了这么一种条件）。也就是说，整个网络虽然形状上来看是深层的，但是从语义空间上来看完全可以是扁平的。而ResNet则是不断的改变语义空间，使得图像的语义随着网络层的加深也不断的跳向更高level的语义空间。</p>
<h5 id="池化"><a href="#池化" class="headerlink" title="池化"></a><strong>池化</strong></h5><p>每经过一个$size=3,stride=2$的池化层(简称$1/2$池化层)，序列的长度就被压缩成了原来的一半。这样同样是$size=3$的卷积核，每经过一个$1/2$池化层后，其能感知到的文本片段就比之前长了一倍。例如之前是只能感知3个词位长度的信息，经过1/2池化层后就能感知6个词位长度的信息，这时把1/2池化层和size=3的卷积层组合起来如图：<br><img src="/2020/03/29/text_classification/dpcnn_pooling.png" alt></p>
<h5 id="残差连接"><a href="#残差连接" class="headerlink" title="残差连接"></a>残差连接</h5><p>在初始化深度CNN时，往往各层权重都是初始化为一个很小的值，这就导致最开始的网络中，后续几乎每层的输入都是接近0，这时网络的输出自然是没意义的，而这些小权重同时也阻碍了梯度的传播，使得网络的初始训练阶段往往要迭代好久才能启动。同时，就算网络启动完成，由于深度网络中仿射矩阵近似连乘，训练过程中网络也非常容易发生梯度爆炸或弥散问题（虽然由于非共享权重，深度CNN网络比RNN网络要好点）。<br>针对深度CNN网络的梯度弥散问题ResNet中提出的<code>shortcut-connection/skip-connection/residual-connection</code>（残差连接）就是一种非常简单、合理、有效的解决方案。<br><img src="/2020/03/29/text_classification/dpcnn_resnet.png" alt><br>既然每个block的输入在初始阶段容易是0而无法激活，那么直接用一条线把region embedding层连接到每个block的输入乃至最终的池化层/输出层。有了shortcut后，梯度就可以忽略卷积层权重的削弱，从shortcut一路无损的传递到各个block，直至网络前端，从而极大的缓解了梯度消失问题。</p>
<h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DPCNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,num_filters, num_classes,word_embedding, freeze)</span>:</span></span><br><span class="line">        super(DPCNN, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.embedding_size = word_embedding.vectors.shape[<span class="number">1</span>]</span><br><span class="line">        self.embedding = nn.Embedding.from_pretrained(torch.from_numpy(word_embedding.vectors), freeze=freeze)</span><br><span class="line"></span><br><span class="line">        self.conv_region = nn.Conv2d(<span class="number">1</span>, num_filters, (<span class="number">3</span>, self.embedding_size), stride=<span class="number">1</span>)</span><br><span class="line">        self.conv = nn.Conv2d(num_filters, num_filters, (<span class="number">3</span>, <span class="number">1</span>), stride=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        self.max_pool = nn.MaxPool2d(kernel_size=(<span class="number">3</span>, <span class="number">1</span>), stride=<span class="number">2</span>)</span><br><span class="line">        self.padding1 = nn.ZeroPad2d((<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>))  <span class="comment"># top bottom</span></span><br><span class="line">        self.padding2 = nn.ZeroPad2d((<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>))  <span class="comment"># bottom</span></span><br><span class="line"></span><br><span class="line">        self.relu = nn.ReLU()</span><br><span class="line">        self.fc = nn.Linear(num_filters, num_classes)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text,_, text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># text [batch_size,seq_len]</span></span><br><span class="line">        x = self.embedding(text)  <span class="comment"># x=[batch_size,seq_len,embedding_dim]</span></span><br><span class="line">        x = x.unsqueeze(<span class="number">1</span>)  <span class="comment"># [batch_size, 1, seq_len, embedding_dim]</span></span><br><span class="line">        x = self.conv_region(x)  <span class="comment"># x = [batch_size, num_filters, seq_len-3+1, 1]</span></span><br><span class="line"></span><br><span class="line">        x = self.padding1(x)  <span class="comment"># [batch_size, num_filters, seq_len, 1]</span></span><br><span class="line">        x = self.relu(x)</span><br><span class="line">        x = self.conv(x)  <span class="comment"># [batch_size, num_filters, seq_len-3+1, 1]</span></span><br><span class="line">        x = self.padding1(x)  <span class="comment"># [batch_size, num_filters, seq_len, 1]</span></span><br><span class="line">        x = self.relu(x)</span><br><span class="line">        x = self.conv(x)  <span class="comment"># [batch_size, num_filters, seq_len-3+1, 1]</span></span><br><span class="line">        <span class="keyword">while</span> x.size()[<span class="number">2</span>] &gt;= <span class="number">2</span>:</span><br><span class="line">            x = self._block(x)  <span class="comment"># [batch_size, num_filters,1,1]</span></span><br><span class="line">        x = x.squeeze()  <span class="comment"># [batch_size, num_filters]</span></span><br><span class="line">        x = self.fc(x)  <span class="comment"># [batch_size, 1]</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_block</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x = self.padding2(x)</span><br><span class="line">        px = self.max_pool(x)</span><br><span class="line"></span><br><span class="line">        x = self.padding1(px)</span><br><span class="line">        x = F.relu(x)</span><br><span class="line">        x = self.conv(x)</span><br><span class="line"></span><br><span class="line">        x = self.padding1(x)</span><br><span class="line">        x = F.relu(x)</span><br><span class="line">        x = self.conv(x)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Short Cut</span></span><br><span class="line">        x = x + px</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure>
<h3 id="RNN系列"><a href="#RNN系列" class="headerlink" title="RNN系列"></a>RNN系列</h3><h4 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h4><p>通过将前一时刻的运算结果添加到当前的运算中，从而实现了“考虑上文信息”的功能。</p>
<p><img src="/2020/03/29/text_classification/rnn.png" alt></p>
<p>RNN可以考虑上文的信息，那么如何将下文的信息也添加进去呢？这就是BiRNN要做的事情。</p>
<p><img src="/2020/03/29/text_classification/birnn.png" alt></p>
<h4 id="LSTM"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h4><p>因为RNN存在梯度弥散和梯度爆炸的问题，所以RNN很难完美地处理具有长期依赖的信息。既然仅仅依靠一条线连接后面的神经元不足以解决问题，那么就再加一条线(这条线实现的功能是把rnn中的累乘变成了累加)，这就是LSTM。</p>
<p>LSTM的关键在于细胞的状态和穿过细胞的线，细胞状态类似于传送带。直接在整个链上运行，只有一些少量的线性交互。信息在上面流动保持不变会变得容易。</p>
<p><img src="/2020/03/29/text_classification/lstm_c.png" alt></p>
<p>在LSTM中，门可以实现选择性的让信息通过，主要通过一个sigmoid的神经层和一个逐点相乘的操作来实现。LSTM通过三个这样的门结构来实现信息的保护和控制，分别是遗忘门（forget gate）、输入门（input gate）与输出门（output gate）。</p>
<h5 id="遗忘门"><a href="#遗忘门" class="headerlink" title="遗忘门"></a><strong>遗忘门</strong></h5><p>在LSTM中的第一步是决定从细胞状态中丢弃什么信息。这个决定通过一个称为遗忘门的结构来完成。遗忘门会读取$h_{t-1}$和$x_t$，输出一个0到1之间的数值给细胞的状态$c_{t-1}$中的数字。1表示完全保留，0表示完全舍弃。</p>
<p><img src="/2020/03/29/text_classification/lstm_forget_gate.png" alt></p>
<h5 id="输入门"><a href="#输入门" class="headerlink" title="输入门"></a><strong>输入门</strong></h5><p>遗忘门决定让多少新的信息加入到cell的状态中来。实现这个需要两个步骤：</p>
<ol>
<li><p>首先一个叫“input gate layer”的sigmoid层决定哪些信息需要更新；一个tanh层生成一个向量，用来更新状态C。</p>
<p><img src="/2020/03/29/text_classification/input_gate.png" alt></p>
</li>
<li><p>把 1 中的两部分联合起来，对cell的状态进行更新，我们把旧的状态与$f_t$相乘，丢弃掉我们确定需要丢弃的信息，接着加上$i_t * \tilde{C}_{t}$</p>
</li>
</ol>
<h5 id="输出门"><a href="#输出门" class="headerlink" title="输出门"></a>输出门</h5><p>最终，我们需要确定输出什么值，这个输出将会基于我们的细胞的状态，但是也是一个过滤后的版本。首先，我们通过一个sigmoid层来确定细胞状态的哪些部分将输出出去。接着，我们把细胞状态通过tanh进行处理（得到一个-1到1之间的值）并将它和sigmoid门的输出相乘，最终我们仅仅会输出我们确定输出的部分。</p>
<p><img src="/2020/03/29/text_classification/output_gate.png" alt></p>
<h5 id="公式"><a href="#公式" class="headerlink" title="公式"></a>公式</h5><p><img src="/2020/03/29/text_classification/lstm_all.png" alt></p>
<h4 id="GRU"><a href="#GRU" class="headerlink" title="GRU"></a>GRU</h4><p>在LSTM中引入了三个门函数：输入门、遗忘门和输出门来控制输入值、记忆值和输出值。而在GRU模型中只有两个门：分别是更新门和重置门。</p>
<p><img src="/2020/03/29/text_classification/GRU.png" alt></p>
<p>图中的$z_t$和$r_t$分别表示更新门和重置门。更新门用于控制前一时刻的状态信息被带入到当前状态中的程度，更新门的值越大说明前一时刻的状态信息带入越多。重置门控制前一状态有多少信息被写入到当前的候选集 $\tilde{h}_{t}$上，重置门越小，前一状态的信息被写入的越少。</p>
<p>LSTM和CRU都是通过各种门函数来将重要特征保留下来，这样就保证了在long-term传播的时候也不会丢失。此外GRU相对于LSTM少了一个门函数，因此在参数的数量上也是要少于LSTM的，所以整体上GRU的训练速度要快于LSTM的。</p>
<h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><p><img src="/2020/03/29/text_classification/TextBiRNN_network_structure.png" alt="TextBiRNN_network_structure"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RnnModel</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, rnn_type, hidden_dim, output_dim, n_layers,bidirectional, dropout,word_embedding, freeze,batch_first=True)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.embedding_size = word_embedding.vectors.shape[<span class="number">1</span>]</span><br><span class="line">        self.embedding = nn.Embedding.from_pretrained(torch.from_numpy(word_embedding.vectors), freeze=freeze)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(self.embedding_size,</span><br><span class="line">                               hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(self.embedding_size,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(self.embedding_size,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line">        self.fc = nn.Linear(hidden_dim * n_layers, output_dim)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text,_, text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># 按照句子长度从大到小排序</span></span><br><span class="line">        text, sorted_seq_lengths, desorted_indices = prepare_pack_padded_sequence(text, text_lengths)</span><br><span class="line">        <span class="comment"># text = [batch size,sent len]</span></span><br><span class="line">        embedded = self.dropout(self.embedding(text))</span><br><span class="line">        <span class="comment"># embedded = [batch size, sent len, emb dim]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(embedded, sorted_seq_lengths, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># output (seq_len, batch, num_directions * hidden_size)</span></span><br><span class="line">            <span class="comment"># hidden (num_layers * num_directions, batch, hidden_size)</span></span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># unpack sequence</span></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first)</span><br><span class="line">        <span class="comment"># 把句子序列再调整成输入时的顺序</span></span><br><span class="line">        output = output[desorted_indices]</span><br><span class="line">        <span class="comment"># output = [batch_size,seq_len,hidden_dim * num_directionns ]</span></span><br><span class="line">        batch_size, max_seq_len,hidden_dim = output.shape</span><br><span class="line">        hidden = torch.mean(torch.reshape(hidden,[batch_size,<span class="number">-1</span>,hidden_dim]),dim=<span class="number">1</span>)</span><br><span class="line">        output = torch.sum(output,dim=<span class="number">1</span>)</span><br><span class="line">        fc_input = self.dropout(output + hidden)</span><br><span class="line">        out = self.fc(fc_input)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h4 id="Self-Attention"><a href="#Self-Attention" class="headerlink" title="Self-Attention"></a>Self-Attention</h4><p><img src="/2020/03/29/text_classification/self-attention.png" alt></p>
<ol>
<li>Encode所有输入序列,得到对应的$h_1,h_2, \cdots ,h_T$(T为输入序列长度)</li>
<li>Decode输出目标$y_t$之前，会将上一步输出的隐藏状态$S_{t-1}$与之前encode好的$h_1,h_2,\cdots,h_T$进行比对，计算相似度（$e_{t,j}=a(s_{t-1},h_j)$）,$h_j$为之前第j个输入encode得到的隐藏向量，a为任意一种计算相似度的方式</li>
<li>然后通过softmax，即$a_{t,j}=\frac{exp(e_{t,j})}{\sum^{T_x}_{k=1}exp(e_{t,k})}$将之前得到的各个部分的相关系数进行归一化，得到$a_{t,1},a_{t,2},\cdots,a_{t,T}$</li>
<li>在对输入序列的隐藏层进行相关性加权求和得到此时decode需要的context vector ：</li>
</ol>
<h4 id="Rnn-Attenton"><a href="#Rnn-Attenton" class="headerlink" title="Rnn-Attenton"></a>Rnn-Attenton</h4><p><img src="/2020/03/29/text_classification/TextAttBiRNN_network_structure.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RnnAttentionModel</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, rnn_type, hidden_dim, output_dim, n_layers,bidirectional, dropout,word_embedding, freeze, batch_first=True)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line">        self.embedding_size = word_embedding.vectors.shape[<span class="number">1</span>]</span><br><span class="line">        self.embedding = nn.Embedding.from_pretrained(torch.from_numpy(word_embedding.vectors), freeze=freeze)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(self.embedding_size,</span><br><span class="line">                               hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(self.embedding_size,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(self.embedding_size,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line">        self.tanh1 = nn.Tanh()</span><br><span class="line">        self.tanh2 = nn.Tanh()</span><br><span class="line">        <span class="comment"># self.u = nn.Parameter(torch.Tensor(self.hidden_dim * 2,self.hidden_dim*2))</span></span><br><span class="line">        self.w = nn.Parameter(torch.randn(hidden_dim), requires_grad=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        <span class="keyword">if</span> bidirectional:</span><br><span class="line">            self.w = nn.Parameter(torch.randn(hidden_dim * <span class="number">2</span>), requires_grad=<span class="literal">True</span>)</span><br><span class="line">            self.fc = nn.Linear(hidden_dim * <span class="number">2</span>, output_dim)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.w = nn.Parameter(torch.randn(hidden_dim), requires_grad=<span class="literal">True</span>)</span><br><span class="line">            self.fc = nn.Linear(hidden_dim, output_dim)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text,_, text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># 按照句子长度从大到小排序</span></span><br><span class="line">        text, sorted_seq_lengths, desorted_indices = prepare_pack_padded_sequence(text, text_lengths)</span><br><span class="line">        <span class="comment"># text = [batch size,sent len]</span></span><br><span class="line">        embedded = self.dropout(self.embedding(text))</span><br><span class="line">        <span class="comment"># embedded = [batch size,sent len,  emb dim]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(embedded, sorted_seq_lengths, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># unpack sequence</span></span><br><span class="line">        <span class="comment"># output = [sent len, batch size, hidden dim * num_direction]</span></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first)</span><br><span class="line">        <span class="comment"># 把句子序列再调整成输入时的顺序</span></span><br><span class="line">        output = output[desorted_indices]</span><br><span class="line">        <span class="comment"># attention</span></span><br><span class="line">        <span class="comment"># M = [sent len, batch size, hidden dim * num_direction]</span></span><br><span class="line">        <span class="comment"># M = self.tanh1(output)</span></span><br><span class="line">        alpha = F.softmax(torch.matmul(self.tanh1(output), self.w), dim=<span class="number">0</span>).unsqueeze(<span class="number">-1</span>)  <span class="comment"># dim=0表示针对文本中的每个词的输出softmax</span></span><br><span class="line">        output_attention = output * alpha</span><br><span class="line"></span><br><span class="line">        batch_size, max_seq_len,hidden_dim = output.shape</span><br><span class="line">        hidden = torch.mean(torch.reshape(hidden,[batch_size,<span class="number">-1</span>,hidden_dim]),dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        output_attention = torch.sum(output_attention, dim=<span class="number">1</span>)</span><br><span class="line">        output = torch.sum(output, dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        fc_input = self.dropout(output + output_attention + hidden)</span><br><span class="line">        <span class="comment"># fc_input = self.dropout(output_attention)</span></span><br><span class="line">        out = self.fc(fc_input)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h3 id="TextRCNN"><a href="#TextRCNN" class="headerlink" title="TextRCNN"></a>TextRCNN</h3><h4 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h4><p>RNN和CNN作为文本分类问题的主要模型架构，都存在各自的优点及局限性。RNN擅长处理序列结构，能够考虑到句子的上下文信息，但RNN属于“biased model”，一个句子中越往后的词重要性越高，这有可能影响最后的分类结果，因为对句子分类影响最大的词可能处在句子任何位置。CNN属于无偏模型，能够通过最大池化获得最重要的特征，但是CNN的滑动窗口大小不容易确定，选的过小容易造成重要信息丢失，选的过大会造成巨大参数空间。为了解决二者的局限性，<a href="http://www.aaai.org/ocs/index.php/AAAI/AAAI15/paper/download/9745/9552" target="_blank" rel="noopener">RCNN</a>这篇文章提出了一种新的网络架构，用双向循环结构获取上下文信息，这比传统的基于窗口的神经网络更能减少噪声，而且在学习文本表达时可以大范围的保留词序。其次使用最大池化层获取文本的重要部分，自动判断哪个特征在文本分类过程中起更重要的作用。</p>
<h4 id="模型结构"><a href="#模型结构" class="headerlink" title="模型结构"></a>模型结构</h4><p><img src="/2020/03/29/text_classification/rcnn.png" alt></p>
<h4 id="Word-Representation-Learning"><a href="#Word-Representation-Learning" class="headerlink" title="Word Representation Learning"></a>Word Representation Learning</h4><p>作者提出将单词的左上下文、右上下文、单词本身结合起来作为单词表示。作者使用了双向RNN来分别提取句子的上下文信息。公式如下:</p>
<script type="math/tex; mode=display">
\begin{array}{l}
c_{l}\left(w_{i}\right)=f\left(W^{(l)} c_{l}\left(w_{i-1}\right)+W^{(s l)} e\left(w_{i-1}\right)\right)  \\
c_{r}\left(w_{i}\right)=f\left(W^{(r)} c_{r}\left(w_{i+1}\right)+W^{(s r)} e\left(w_{i+1}\right)\right)
\end{array}</script><p>其中，$c_l(w_i)$代表单词$w_i$的左上下文，$c_l(w_i)$由上一个单词的左上下文$c_l$和$c_l(w_{i-1})$上一个单词的词嵌入向量 $e(w_{i-1})$计算得到，如公式（1）所示，所有句子第一个单词的左侧上下文使用相同的共享参数$c_l(w_1)$。 $W^{(l)},W^{(sl)}$用于将上一个单词的左上下文语义和上一个单词的语义结合到单词 $w_i$的左上下文表示中。右上下文的处理与左上下文完全相同，同样所有句子最后一个单词的右侧上下文使用相同的共享参数$c_r(w_n)$。 得到句子中每个单词的左上下文表示和右上下文表示后，就可以定义单词  $w_i$的表示如下</p>
<script type="math/tex; mode=display">
\boldsymbol{x}_{i}=\left[\boldsymbol{c}_{l}\left(w_{i}\right) ; \boldsymbol{e}\left(w_{i}\right) ; \boldsymbol{c}_{r}\left(w_{i}\right)\right]</script><p>实际就是单词$w_i$，单词的词嵌入表示向量 $e(w_i)$以及单词的右上下文向量$c_e(w_i)$ 的拼接后的结果。得到$w_i$的表示$x_i$后，就可以输入激活函数得到$w_i$的潜在语义向量 $y_i^{(2)}$ 。</p>
<script type="math/tex; mode=display">
\boldsymbol{y}_{i}^{(2)}=\tanh \left(W^{(2)} \boldsymbol{x}_{i}+\boldsymbol{b}^{(2)}\right)</script><h4 id="Text-Representation-Learning"><a href="#Text-Representation-Learning" class="headerlink" title="Text Representation Learning"></a>Text Representation Learning</h4><p>经过卷积层后，获得了所有词的表示，首先对其进行最大池化操作，最大池化可以帮助找到句子中最重要的潜在语义信息。</p>
<script type="math/tex; mode=display">
\boldsymbol{y}^{(3)}=\max _{i=1}^{n} \boldsymbol{y}_{i}^{(2)}</script><p>然后经过全连接层得到文本的表示，最后通过softmax层进行分类。</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\boldsymbol{y}^{(4)}=W^{(4)} \boldsymbol{y}^{(3)}+\boldsymbol{b}^{(4)}\\
&p_{i}=\frac{\exp \left(\boldsymbol{y}_{i}^{(4)}\right)}{\sum_{k=1}^{n} \exp \left(\boldsymbol{y}_{k}^{(4)}\right)}
\end{aligned}</script><h4 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h4><p><img src="/2020/03/29/text_classification/RCNN_network_structure.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RCNNModel</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, rnn_type, hidden_dim, output_dim, n_layers,bidirectional, dropout,word_embedding, freeze, batch_first=True)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.embedding_size = word_embedding.vectors.shape[<span class="number">1</span>]</span><br><span class="line">        self.embedding = nn.Embedding.from_pretrained(torch.from_numpy(word_embedding.vectors), freeze=freeze)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(self.embedding_size ,</span><br><span class="line">                               hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(self.embedding_size ,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(self.embedding_size ,</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        self.fc_cat = nn.Linear(hidden_dim * n_layers + self.embedding_size,self.embedding_size)</span><br><span class="line">        self.fc = nn.Linear(self.embedding_size, output_dim)</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text,_, text_lengths)</span>:</span></span><br><span class="line">        <span class="comment"># 按照句子长度从大到小排序</span></span><br><span class="line">        text, sorted_seq_lengths, desorted_indices = prepare_pack_padded_sequence(text, text_lengths)</span><br><span class="line">        <span class="comment"># text = [batch size,sent len]</span></span><br><span class="line">        embedded = self.dropout(self.embedding(text))</span><br><span class="line">        <span class="comment"># embedded = [batch size, sent len, emb dim]</span></span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(embedded, sorted_seq_lengths, batch_first=self.batch_first)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># packed_output</span></span><br><span class="line">        <span class="comment"># hidden [n_layers * bi_direction,batch_size,hidden_dim]</span></span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># unpack sequence</span></span><br><span class="line">        <span class="comment"># output [sent len, batch_size * n_layers * bi_direction]</span></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first)</span><br><span class="line">        <span class="comment"># 把句子序列再调整成输入时的顺序</span></span><br><span class="line">        output = output[desorted_indices]</span><br><span class="line">        <span class="comment"># output = [batch_size,seq_len,hidden_dim * num_directionns ]</span></span><br><span class="line">        batch_size, max_seq_len,hidden_dim = output.shape</span><br><span class="line">        <span class="comment"># 拼接左右上下文信息</span></span><br><span class="line">        output = torch.tanh(self.fc_cat(torch.cat((output, embedded), dim=<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">        output = torch.transpose(output,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">        output = F.max_pool1d(output,max_seq_len).squeeze().contiguous()</span><br><span class="line">        output = self.fc(output)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>
<h3 id="HAN"><a href="#HAN" class="headerlink" title="HAN"></a>HAN</h3><p><img src="/2020/03/29/text_classification/HAN.png" alt></p>
<p>整个网络结构包括五个部分：</p>
<ol>
<li>词序列编码器</li>
<li>基于词级的注意力层</li>
<li>句子编码器</li>
<li>基于句子级的注意力层</li>
<li>分类</li>
</ol>
<p>整个网络结构由双向GRU网络和注意力机制组合而成。</p>
<h4 id="词序列编码器"><a href="#词序列编码器" class="headerlink" title="词序列编码器"></a>词序列编码器</h4><p>给定一个句子中的单词$w_{it}$，其中 $i$ 表示第$i$ 个句子，$t$ 表示第 $t$ 个词。通过一个词嵌入矩阵 $W_e$ 将单词转换成向量表示，具体如下所示：</p>
<script type="math/tex; mode=display">
x_{it}=W_e w_{it}</script><p>利用双向GRU实现的整个编码流程：</p>
<script type="math/tex; mode=display">
\begin{aligned}
x_{i t} &=W_{e} w_{i t}, t \in[1, T] \\
\overrightarrow{h}_{i t} &=\overrightarrow{\operatorname{GRU}}\left(x_{i t}\right), t \in[1, T] \\
\overleftarrow{h}_{i t} &=\overleftarrow{\operatorname{GRU}}\left(x_{i t}\right), t \in[T, 1] \\
{h}_{i t} &= [\overrightarrow{h}_{i t},\overleftarrow{h}_{i t} ]
\end{aligned}</script><h4 id="词级的注意力层"><a href="#词级的注意力层" class="headerlink" title="词级的注意力层"></a>词级的注意力层</h4><p>但是对于一句话中的单词，并不是每一个单词对分类任务都是有用的，比如在做文本的情绪分类时，可能我们就会比较关注“很好”、“伤感”这些词。为了能使循环神经网络也能自动将“注意力”放在这些词汇上，作者设计了基于单词的注意力层的具体流程如下：</p>
<script type="math/tex; mode=display">
\begin{aligned}
u_{i t} &=\tanh \left(W_{w} h_{i t}+b_{w}\right) \\
\alpha_{i t} &=\frac{\exp \left(u_{i t}^{\top} u_{w}\right)}{\sum_{t} \exp \left(u_{i t}^{\top} u_{w}\right)} \\
s_{i} &=\sum_{t} \alpha_{i t} h_{i t}
\end{aligned}</script><p>上面式子中，$u_{it}$ 是 $h_{it}$ 的隐层表示，$a_{it}$ 是经 softmax 函数处理后的归一化权重系数，$u_w$是一个随机初始化的向量，之后会作为模型的参数一起被训练，$s_i$ 就是我们得到的第 i 个句子的向量表示。</p>
<h4 id="句子编码器"><a href="#句子编码器" class="headerlink" title="句子编码器"></a>句子编码器</h4><p>句子编码器也是基于双向GRU实现编码的，</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\overrightarrow{h}_{i}=\overrightarrow{\operatorname{GRU}}\left(s_{i}\right), i \in[1, L]\\
&\overleftarrow{h}_{i}=\overleftarrow{\operatorname{GRU}}\left(s_{i}\right), t \in[L, 1]
\end{aligned}</script><p>公式和词编码类似，最后的 $h_i$ 也是通过拼接得到的.</p>
<h4 id="句子级注意力层"><a href="#句子级注意力层" class="headerlink" title="句子级注意力层"></a>句子级注意力层</h4><p>注意力层的流程如下，和词级的一致:</p>
<script type="math/tex; mode=display">
\begin{aligned}
u_{i} &=\tanh \left(W_{s} h_{i}+b_{s}\right) \\
\alpha_{i} &=\frac{\exp \left(u_{i}^{\top} u_{s}\right)}{\sum_{i} \exp \left(u_{i}^{\top} u_{s}\right)} \\
v &=\sum_{i} \alpha_{i} h_{i}
\end{aligned}</script><p>最后得到的向量$v$ 就是文档的向量表示，这是文档的高层表示。接下来就可以用可以用这个向量表示作为文档的特征。</p>
<h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><p>使用最常用的softmax分类器对整个文本进行分类了</p>
<script type="math/tex; mode=display">
p=\operatorname{softmax}\left(W_{c} v+b_{c}\right)</script><p>损失函数</p>
<script type="math/tex; mode=display">
L=-\sum_{d} \log p_{d j}</script><h4 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h4><p><img src="/2020/03/29/text_classification/HAN_network_structure.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HierAttNet</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,rnn_type, word_hidden_size, sent_hidden_size, num_classes, word_embedding,n_layers,bidirectional,batch_first,freeze,dropout)</span>:</span></span><br><span class="line">        super(HierAttNet, self).__init__()</span><br><span class="line">        self.word_embedding = word_embedding</span><br><span class="line">        self.word_hidden_size = word_hidden_size</span><br><span class="line">        self.sent_hidden_size = sent_hidden_size</span><br><span class="line">        self.word_att_net = WordAttNet(rnn_type,word_embedding, word_hidden_size,n_layers,bidirectional,batch_first,dropout,freeze)</span><br><span class="line">        self.sent_att_net = SentAttNet(rnn_type,sent_hidden_size, word_hidden_size,n_layers,bidirectional,batch_first,dropout, num_classes)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, batch_doc, _, text_lengths)</span>:</span></span><br><span class="line">        output_list = []</span><br><span class="line">        <span class="comment"># ############################ 词级 #########################################</span></span><br><span class="line">        <span class="keyword">for</span> idx,doc <span class="keyword">in</span> enumerate(batch_doc):</span><br><span class="line">            <span class="comment"># 把一篇文档拆成多个句子</span></span><br><span class="line">            doc = doc[:text_lengths[idx]]</span><br><span class="line">            doc_list = doc.cpu().numpy().tolist()</span><br><span class="line">            sep_index = [i <span class="keyword">for</span> i, num <span class="keyword">in</span> enumerate(doc_list) <span class="keyword">if</span> num == self.word_embedding.stoi[<span class="string">'[SEP]'</span>]]</span><br><span class="line">            sentence_list = []</span><br><span class="line">            <span class="keyword">if</span> sep_index:</span><br><span class="line">                pre = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> cur <span class="keyword">in</span> sep_index:</span><br><span class="line">                    sentence_list.append(doc_list[pre:cur])</span><br><span class="line">                    pre = cur</span><br><span class="line"></span><br><span class="line">                sentence_list.append(doc_list[cur:])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                sentence_list.append(doc_list)</span><br><span class="line">            max_sentence_len = len(max(sentence_list,key=<span class="keyword">lambda</span> x:len(x)))</span><br><span class="line">            seq_lens = []</span><br><span class="line">            input_token_ids = []</span><br><span class="line">            <span class="keyword">for</span> sent <span class="keyword">in</span> sentence_list:</span><br><span class="line">                cur_sent_len = len(sent)</span><br><span class="line">                seq_lens.append(cur_sent_len)</span><br><span class="line">                input_token_ids.append(sent+[self.word_embedding.stoi[<span class="string">'PAD'</span>]]*(max_sentence_len-cur_sent_len))</span><br><span class="line">            input_token_ids = torch.LongTensor(np.array(input_token_ids)).to(batch_doc.device)</span><br><span class="line">            seq_lens = torch.LongTensor(np.array(seq_lens)).to(batch_doc.device)</span><br><span class="line">            word_output, hidden = self.word_att_net(input_token_ids,seq_lens)</span><br><span class="line">            <span class="comment"># word_output = [bs,hidden_size]</span></span><br><span class="line">            output_list.append(word_output)</span><br><span class="line"></span><br><span class="line">        max_doc_sent_num = len(max(output_list,key=<span class="keyword">lambda</span> x: len(x)))</span><br><span class="line">        batch_sent_lens = []</span><br><span class="line">        batch_sent_inputs = []</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ############################ 句子级 #########################################</span></span><br><span class="line">        <span class="keyword">for</span> doc <span class="keyword">in</span> output_list:</span><br><span class="line">            cur_doc_sent_len = len(doc)</span><br><span class="line">            batch_sent_lens.append(cur_doc_sent_len)</span><br><span class="line">            expand_doc = torch.cat([doc,torch.zeros(size=((max_doc_sent_num-cur_doc_sent_len),len(doc[<span class="number">0</span>]))).to(doc.device)],dim=<span class="number">0</span>)</span><br><span class="line">            batch_sent_inputs.append(expand_doc.unsqueeze(dim=<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">        batch_sent_inputs = torch.cat(batch_sent_inputs, <span class="number">0</span>)</span><br><span class="line">        batch_sent_lens = torch.LongTensor(np.array(batch_sent_lens)).to(doc.device)</span><br><span class="line">        output = self.sent_att_net(batch_sent_inputs,batch_sent_lens)</span><br><span class="line">        <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>
<h3 id="Bert"><a href="#Bert" class="headerlink" title="Bert"></a>Bert</h3><h4 id="BERT"><a href="#BERT" class="headerlink" title="BERT"></a>BERT</h4><p><img src="/2020/03/29/text_classification/bert_gpt_elmo.png" alt></p>
<h5 id="Task-1-MLM"><a href="#Task-1-MLM" class="headerlink" title="Task 1: MLM"></a>Task 1: MLM</h5><p>由于BERT需要通过上下文信息，来预测中心词的信息，同时又不希望模型提前看见中心词的信息，因此提出了一种 Masked Language Model 的预训练方式，即随机从输入预料上 mask 掉一些单词，然后通过的上下文预测该单词，类似于一个完形填空任务。</p>
<p>在预训练任务中，15%的 Word Piece 会被mask，这15%的 Word Piece 中，80%的时候会直接替换为 [Mask] ，10%的时候将其替换为其它任意单词，10%的时候会保留原始Token</p>
<ul>
<li>没有100%mask的原因<ul>
<li>如果句子中的某个Token100%都会被mask掉，那么在fine-tuning的时候模型就会有一些没有见过的单词</li>
</ul>
</li>
<li>加入10%随机token的原因<ul>
<li>Transformer要保持对每个输入token的分布式表征，否则模型就会记住这个[mask]是token ’hairy‘</li>
<li>另外编码器不知道哪些词需要预测的，哪些词是错误的，因此被迫需要学习每一个token的表示向量</li>
</ul>
</li>
<li>另外，每个batchsize只有15%的单词被mask的原因，是因为性能开销的问题，双向编码器比单项编码器训练要更慢</li>
</ul>
<h5 id="Task-2-NSP"><a href="#Task-2-NSP" class="headerlink" title="Task 2: NSP"></a>Task 2: NSP</h5><p>仅仅一个MLM任务是不足以让 BERT 解决阅读理解等句子关系判断任务的，因此添加了额外的一个预训练任务，即 Next Sequence Prediction。</p>
<p>具体任务即为一个句子关系判断任务，即判断句子B是否是句子A的下文，如果是的话输出’IsNext‘，否则输出’NotNext‘。</p>
<p>训练数据的生成方式是从平行语料中随机抽取的连续两句话，其中50%保留抽取的两句话，它们符合IsNext关系，另外50%的第二句话是随机从预料中提取的，它们的关系是NotNext的。这个关系保存在图4中的[CLS]符号中</p>
<h5 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h5><ul>
<li>Token Embeddings：即传统的词向量层，每个输入样本的首字符需要设置为[CLS]，可以用于之后的分类任务，若有两个不同的句子，需要用[SEP]分隔，且最后一个字符需要用[SEP]表示终止</li>
<li>Segment Embeddings：为[0,1][0,1]序列，用来在NSP任务中区别两个句子，便于做句子关系判断任务</li>
<li>Position Embeddings：与Transformer中的位置向量不同，BERT中的位置向量是直接训练出来的</li>
</ul>
<h5 id="Fine-tunninng"><a href="#Fine-tunninng" class="headerlink" title="Fine-tunninng"></a>Fine-tunninng</h5><p>对于不同的下游任务，我们仅需要对BERT不同位置的输出进行处理即可，或者直接将BERT不同位置的输出直接输入到下游模型当中。具体的如下所示：</p>
<ul>
<li>对于情感分析等单句分类任务，可以直接输入单个句子（不需要[SEP]分隔双句），将[CLS]的输出直接输入到分类器进行分类</li>
<li>对于句子对任务（句子关系判断任务），需要用[SEP]分隔两个句子输入到模型中，然后同样仅须将[CLS]的输出送到分类器进行分类</li>
<li>对于问答任务，将问题与答案拼接输入到BERT模型中，然后将答案位置的输出向量进行二分类并在句子方向上进行softmax（只需预测开始和结束位置即可）</li>
<li>对于命名实体识别任务，对每个位置的输出进行分类即可，如果将每个位置的输出作为特征输入到CRF将取得更好的效果。</li>
</ul>
<h5 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h5><ul>
<li>BERT的预训练任务MLM使得能够借助上下文对序列进行编码，但同时也使得其预训练过程与中的数据与微调的数据不匹配，难以适应生成式任务</li>
<li>另外，BERT没有考虑预测[MASK]之间的相关性，是对语言模型联合概率的有偏估计</li>
<li>由于最大输入长度的限制，适合句子和段落级别的任务，不适用于文档级别的任务（如长文本分类）</li>
<li>适合处理自然语义理解类任务(NLU)，而不适合自然语言生成类任务(NLG)</li>
</ul>
<h5 id="代码-5"><a href="#代码-5" class="headerlink" title="代码"></a>代码</h5><h6 id="Bert-1"><a href="#Bert-1" class="headerlink" title="Bert"></a>Bert</h6><figure class="highlight python"><figcaption><span>bert</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bert</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, bert_path, num_classes, word_embedding, trained=True)</span>:</span></span><br><span class="line">        super(Bert, self).__init__()</span><br><span class="line">        self.bert = BertModel.from_pretrained(bert_path)</span><br><span class="line">        <span class="comment"># 不对bert进行训练</span></span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> self.bert.parameters():</span><br><span class="line">            param.requires_grad = trained</span><br><span class="line"></span><br><span class="line">        self.fc = nn.Linear(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>], num_classes)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, context, bert_masks, seq_lens)</span>:</span></span><br><span class="line">        <span class="comment"># context  输入的句子序列</span></span><br><span class="line">        <span class="comment"># seq_len  句子长度</span></span><br><span class="line">        <span class="comment"># mask     对padding部分进行mask，和句子一个size，padding部分用0表示，如：[1, 1, 1, 1, 0, 0]</span></span><br><span class="line">        <span class="comment"># cls [batch_size, 768]</span></span><br><span class="line">        <span class="comment"># sentence [batch size,sen len,  768]</span></span><br><span class="line">        sentence, cls = self.bert(context, attention_mask=bert_masks)</span><br><span class="line">        sentence = torch.sum(sentence,dim=<span class="number">1</span>)</span><br><span class="line">        out = self.fc(sentence)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h6 id="BertCNN"><a href="#BertCNN" class="headerlink" title="BertCNN"></a>BertCNN</h6><figure class="highlight python"><figcaption><span>BertCNN</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertCNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, bert_path, num_filters, hidden_size, filter_sizes, dropout, num_classes, word_embedding,</span></span></span><br><span class="line"><span class="function"><span class="params">                 trained=True)</span>:</span></span><br><span class="line">        super(BertCNN, self).__init__()</span><br><span class="line">        self.bert = BertModel.from_pretrained(bert_path)</span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> self.bert.parameters():</span><br><span class="line">            param.requires_grad = trained</span><br><span class="line">        self.convs = nn.ModuleList(</span><br><span class="line">            [nn.Conv2d(<span class="number">1</span>, num_filters, (k, hidden_size)) <span class="keyword">for</span> k <span class="keyword">in</span> filter_sizes])</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">        self.fc_cnn = nn.Linear(num_filters * len(filter_sizes), num_classes)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">conv_and_pool</span><span class="params">(self, x, conv)</span>:</span></span><br><span class="line">        x = F.relu(conv(x)).squeeze(<span class="number">3</span>)</span><br><span class="line">        x = F.max_pool1d(x, x.size(<span class="number">2</span>)).squeeze(<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, context, bert_masks, seq_len)</span>:</span></span><br><span class="line">        <span class="comment"># context    输入的句子</span></span><br><span class="line">        <span class="comment"># mask  对padding部分进行mask，和句子一个size，padding部分用0表示，如：[1, 1, 1, 1, 0, 0]</span></span><br><span class="line">        encoder_out, text_cls = self.bert(context, attention_mask=bert_masks)</span><br><span class="line">        out = encoder_out.unsqueeze(<span class="number">1</span>)</span><br><span class="line">        out = torch.cat([self.conv_and_pool(out, conv) <span class="keyword">for</span> conv <span class="keyword">in</span> self.convs], <span class="number">1</span>)</span><br><span class="line">        out = self.dropout(out)</span><br><span class="line">        out = self.fc_cnn(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h6 id="BertRNN"><a href="#BertRNN" class="headerlink" title="BertRNN"></a>BertRNN</h6><figure class="highlight python"><figcaption><span>BertRNN</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertRNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, rnn_type, bert_path, hidden_dim, n_layers, bidirectional, batch_first, word_embedding,</span></span></span><br><span class="line"><span class="function"><span class="params">                 dropout, num_classes, trained)</span>:</span></span><br><span class="line">        super(BertRNN, self).__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line">        self.bert = BertModel.from_pretrained(bert_path)</span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> self.bert.parameters():</span><br><span class="line">            param.requires_grad = trained</span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                               hidden_size=hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        self.fc_rnn = nn.Linear(hidden_dim * <span class="number">2</span>, num_classes)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text, bert_masks, seq_lens)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># text = [batch size,sent len]</span></span><br><span class="line">        <span class="comment"># context    输入的句子</span></span><br><span class="line">        <span class="comment"># mask  对padding部分进行mask，和句子一个size，padding部分用0表示，如：[1, 1, 1, 1, 0, 0]</span></span><br><span class="line">        bert_sentence, bert_cls = self.bert(text, attention_mask=bert_masks)</span><br><span class="line">        sentence_len = bert_sentence.shape[<span class="number">1</span>]</span><br><span class="line">        bert_cls = bert_cls.unsqueeze(dim=<span class="number">1</span>).repeat(<span class="number">1</span>, sentence_len, <span class="number">1</span>)</span><br><span class="line">        bert_sentence = bert_sentence + bert_cls</span><br><span class="line">        <span class="comment"># 按照句子长度从大到小排序</span></span><br><span class="line">        bert_sentence, sorted_seq_lengths, desorted_indices = prepare_pack_padded_sequence(bert_sentence, seq_lens)</span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(bert_sentence, sorted_seq_lengths,</span><br><span class="line">                                                            batch_first=self.batch_first)</span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># output = [ batch size,sent len, hidden_dim * bidirectional]</span></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first)</span><br><span class="line">        output = output[desorted_indices]</span><br><span class="line">        batch_size, max_seq_len, hidden_dim = output.shape</span><br><span class="line">        hidden = torch.mean(torch.reshape(hidden, [batch_size, <span class="number">-1</span>, hidden_dim]), dim=<span class="number">1</span>)</span><br><span class="line">        output = torch.sum(output, dim=<span class="number">1</span>)</span><br><span class="line">        fc_input = self.dropout(output + hidden)</span><br><span class="line">        out = self.fc_rnn(fc_input)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h6 id="BertRCNN"><a href="#BertRCNN" class="headerlink" title="BertRCNN"></a>BertRCNN</h6><figure class="highlight python"><figcaption><span>BertRCNN</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BertRCNN</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, rnn_type, bert_path, hidden_dim, n_layers, bidirectional, dropout, num_classes, word_embedding,</span></span></span><br><span class="line"><span class="function"><span class="params">                 trained, batch_first=True)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.rnn_type = rnn_type.lower()</span><br><span class="line">        self.bidirectional = bidirectional</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.n_layers = n_layers</span><br><span class="line">        self.bert = BertModel.from_pretrained(bert_path)</span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> self.bert.parameters():</span><br><span class="line">            param.requires_grad = trained</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> rnn_type == <span class="string">'lstm'</span>:</span><br><span class="line">            self.rnn = nn.LSTM(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                               hidden_dim,</span><br><span class="line">                               num_layers=n_layers,</span><br><span class="line">                               bidirectional=bidirectional,</span><br><span class="line">                               batch_first=batch_first,</span><br><span class="line">                               dropout=dropout)</span><br><span class="line">        <span class="keyword">elif</span> rnn_type == <span class="string">'gru'</span>:</span><br><span class="line">            self.rnn = nn.GRU(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rnn = nn.RNN(self.bert.config.to_dict()[<span class="string">'hidden_size'</span>],</span><br><span class="line">                              hidden_size=hidden_dim,</span><br><span class="line">                              num_layers=n_layers,</span><br><span class="line">                              bidirectional=bidirectional,</span><br><span class="line">                              batch_first=batch_first,</span><br><span class="line">                              dropout=dropout)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># self.maxpool = nn.MaxPool1d()</span></span><br><span class="line">        self.fc = nn.Linear(hidden_dim * n_layers, num_classes)</span><br><span class="line"></span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        self.batch_first = batch_first</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, text, bert_masks, seq_lens)</span>:</span></span><br><span class="line">        <span class="comment"># text = [batch size,sent len]</span></span><br><span class="line">        <span class="comment"># context    输入的句子</span></span><br><span class="line">        <span class="comment"># mask  对padding部分进行mask，和句子一个size，padding部分用0表示，如：[1, 1, 1, 1, 0, 0]</span></span><br><span class="line">        bert_sentence, bert_cls = self.bert(text, attention_mask=bert_masks)</span><br><span class="line">        sentence_len = bert_sentence.shape[<span class="number">1</span>]</span><br><span class="line">        bert_cls = bert_cls.unsqueeze(dim=<span class="number">1</span>).repeat(<span class="number">1</span>, sentence_len, <span class="number">1</span>)</span><br><span class="line">        bert_sentence = bert_sentence + bert_cls</span><br><span class="line">        <span class="comment"># 按照句子长度从大到小排序</span></span><br><span class="line">        bert_sentence, sorted_seq_lengths, desorted_indices = prepare_pack_padded_sequence(bert_sentence, seq_lens)</span><br><span class="line">        <span class="comment"># pack sequence</span></span><br><span class="line">        packed_embedded = nn.utils.rnn.pack_padded_sequence(bert_sentence, sorted_seq_lengths,</span><br><span class="line">                                                            batch_first=self.batch_first)</span><br><span class="line">        <span class="keyword">if</span> self.rnn_type <span class="keyword">in</span> [<span class="string">'rnn'</span>, <span class="string">'gru'</span>]:</span><br><span class="line">            packed_output, hidden = self.rnn(packed_embedded)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            packed_output, (hidden, cell) = self.rnn(packed_embedded)</span><br><span class="line"></span><br><span class="line">        output, output_lengths = nn.utils.rnn.pad_packed_sequence(packed_output, batch_first=self.batch_first)</span><br><span class="line">        output = output[desorted_indices]</span><br><span class="line">        batch_size, max_seq_len, hidden_dim = output.shape</span><br><span class="line">        out = torch.transpose(output.relu(), <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        out = F.max_pool1d(out, max_seq_len).squeeze()</span><br><span class="line">        out = self.fc(out)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h6 id="xlnet"><a href="#xlnet" class="headerlink" title="xlnet"></a>xlnet</h6><figure class="highlight python"><figcaption><span>xlnet</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XLNet</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, xlnet_path, num_classes, word_embedding, trained=True)</span>:</span></span><br><span class="line">        super(XLNet, self).__init__()</span><br><span class="line">        self.xlnet = XLNetModel.from_pretrained(xlnet_path)</span><br><span class="line">        <span class="comment"># 不对bert进行训练</span></span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> self.xlnet.parameters():</span><br><span class="line">            param.requires_grad = trained</span><br><span class="line"></span><br><span class="line">        self.fc = nn.Linear(self.xlnet.d_model, num_classes)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, context, xlnet_masks, seq_lens)</span>:</span></span><br><span class="line">        <span class="comment"># context  输入的句子序列</span></span><br><span class="line">        <span class="comment"># seq_len  句子长度</span></span><br><span class="line">        <span class="comment"># mask     对padding部分进行mask，和句子一个size，padding部分用0表示，如：[1, 1, 1, 1, 0, 0]</span></span><br><span class="line">        <span class="comment"># cls [batch_size, 768]</span></span><br><span class="line">        <span class="comment"># sentence [batch size,sen len,  768]</span></span><br><span class="line">        sentence_encoder = self.xlnet(context, attention_mask=xlnet_masks)</span><br><span class="line">        sentence_encoder = torch.sum(sentence_encoder[<span class="number">0</span>], dim=<span class="number">1</span>)</span><br><span class="line">        out = self.fc(sentence_encoder)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h4 id="bert-config-json"><a href="#bert-config-json" class="headerlink" title="bert_config.json"></a>bert_config.json</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "attention_probs_dropout_prob": 0.1, #乘法attention时，softmax后dropout概率 </span><br><span class="line">  "directionality": "bidi", </span><br><span class="line">  "hidden_act": "gelu",   #激活函数 </span><br><span class="line">  "hidden_dropout_prob": 0.1, #隐藏层dropout概率 </span><br><span class="line">  "hidden_size": 768, #隐藏单元数 </span><br><span class="line">  "initializer_range": 0.02, #初始化范围 </span><br><span class="line">  "intermediate_size": 3072, #升维维度</span><br><span class="line">  "max_position_embeddings": 512, #一个大于seq_length的参数，用于生成position_embedding</span><br><span class="line">  "num_attention_heads": 12,#每个隐藏层中的attention head数 </span><br><span class="line">  "num_hidden_layers": 2, #隐藏层数 </span><br><span class="line">  "pooler_fc_size": 768, </span><br><span class="line">  "pooler_num_attention_heads": 12, </span><br><span class="line">  "pooler_num_fc_layers": 3, </span><br><span class="line">  "pooler_size_per_head": 128, </span><br><span class="line">  "pooler_type": "first_token_transform", </span><br><span class="line">  "type_vocab_size": 2, #segment_ids类别 [0,1] </span><br><span class="line">  "vocab_size": 21128#词典中词数</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h1><h2 id="微博情感分类"><a href="#微博情感分类" class="headerlink" title="微博情感分类"></a>微博情感分类</h2><h3 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h3><p>weibo_senti_100k：共119988条数据，正例：59993,负例59995   </p>
<p>句子最大长度：260，最小长度：3，平均长度：66.04</p>
<p>部分样例:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>label</th>
<th>review</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>更博了，爆照了，帅的呀，就是越来越爱你！生快傻缺[爱你][爱你][爱你]</td>
</tr>
<tr>
<td>1</td>
<td>@张晓鹏jonathan 土耳其的事要认真对待[哈哈]，否则直接开除。@丁丁看世界 很是细心，酒店都全部OK啦。</td>
</tr>
<tr>
<td>1</td>
<td>姑娘都羡慕你呢…还有招财猫高兴……//@爱在蔓延-JC:[哈哈]小学徒一枚，等着明天见您呢//@李欣芸SharonLee:大佬范儿[书呆子]</td>
</tr>
<tr>
<td>1</td>
<td>美<del>~</del>[爱你]</td>
</tr>
<tr>
<td>1</td>
<td>梦想有多大，舞台就有多大![鼓掌]</td>
</tr>
<tr>
<td>0</td>
<td>今天真冷啊，难道又要穿棉袄了[晕]？今年的春天真的是百变莫测啊[抓狂]</td>
</tr>
<tr>
<td>0</td>
<td>[衰][衰][衰]像给剥了皮的蛇</td>
</tr>
<tr>
<td>0</td>
<td>酒驾的危害，这回是潜水艇。//@上海译文丁丽洁:[泪]</td>
</tr>
<tr>
<td>0</td>
<td>积压了这么多的枕边书，没一本看完了的，现在我读书的最佳地点尽然是公交车[晕]</td>
</tr>
<tr>
<td>0</td>
<td>[泪]错过了……</td>
</tr>
</tbody>
</table>
</div>
<p><a href="https://github.com/Embedding/Chinese-Word-Vectors" target="_blank" rel="noopener">词向量下载</a></p>
<p><a href="https://github.com/ymcui/Chinese-BERT-wwm" target="_blank" rel="noopener">中文预训练bert模型下载</a></p>
<h3 id="分析及比较"><a href="#分析及比较" class="headerlink" title="分析及比较"></a>分析及比较</h3><p>分成三类进行比较：</p>
<ol>
<li>FastText，TextCNN，DPCNN，RNN，RNN-Attention，TextRCNN(词向量/字向量)</li>
<li>RNN，LSTM，GRU，RNN-Attention</li>
<li>Bert，BertCNN，BertRNN，BertRCNN</li>
</ol>
<h4 id="FastText，TextCNN，DPCNN，RNN，RNN-Attention，TextRCNN"><a href="#FastText，TextCNN，DPCNN，RNN，RNN-Attention，TextRCNN" class="headerlink" title="FastText，TextCNN，DPCNN，RNN，RNN-Attention，TextRCNN"></a>FastText，TextCNN，DPCNN，RNN，RNN-Attention，TextRCNN</h4><p>训练集上（词向量）的表现：</p>
<p><img src="/2020/03/29/text_classification/image-20200520140510805.png" alt></p>
<p>训练集上的速度：</p>
<p><img src="/2020/03/29/text_classification/image-20200520140848340.png" alt></p>
<p>验证集上的表现：</p>
<p><img src="/2020/03/29/text_classification/image-20200520135717244.png" alt></p>
<p>验证集上的速度</p>
<p><img src="/2020/03/29/text_classification/image-20200520140931559.png" alt="image-20200520140931559"></p>
<ol>
<li>从验证集上的表现来看，rcnn的表现比较稳定，0.985，但是其训练以及预测速度却是最慢的一个。FastText是速度最快的一个，在验证集上也能取得0.961的表现。可以根据任务的需求进行取舍。</li>
<li>对于FastText 来说，embedding的训练一定要打开。</li>
<li>对于过拟合现象，可以通过freeze word embedding 来缓解。</li>
<li>是使用字向量还是词向量？<ul>
<li>对于FastText来说，使用词向量会比使用字向量精确度高出1%左右。原因就向上面FastText的缺点所述部分，使用词向量的时候会添加额外的<code>n-gram</code>信息。</li>
<li>对于TextCNN来说，网络自身就能够提取<code>n-gram</code>特征，如果再使用词向量，对于短文本来说，句子信息被压缩，容易出现过拟合现象（DPCNN同样出现过拟合）。在短文本的数据集上，TextCNN还是使用字向量比较好。</li>
<li>对于rnn来说，本身就存在梯度弥散和梯度爆炸的问题，所以使用词向量，使得句子序列会变长，会加剧这个问题。对于lstm来说也是同样的。</li>
<li>对于rcnn来说，使用词向量还是字向量基本没有任何区别。</li>
<li>对于加attention的rnn，每个时间步会attention到整个序列的word embedding，所以词向量或者字向量带来的影响并不明显。</li>
</ul>
</li>
</ol>
<h4 id="RNN，LSTM，GRU"><a href="#RNN，LSTM，GRU" class="headerlink" title="RNN，LSTM，GRU"></a>RNN，LSTM，GRU</h4><p>训练集和验证集上的表现：</p>
<p><img src="/2020/03/29/text_classification/image-20200520144027325.png" alt></p>
<p>速度比较：</p>
<p><img src="/2020/03/29/text_classification/image-20200520144139492.png" alt></p>
<ol>
<li>速度上相差无几，能用lstm就用lstm把。</li>
<li>不要仅仅使用rnn最后输出的hidden来做分类。（如果只使用hidden来做分类，准确度50%.）</li>
<li>是使用sum求和来获取整句话的语义还是使用mean来获取整句话的语义其实影响不大。</li>
<li>在rnn上使用attention 精度上会略有提升，但是相比于速度的下降，感觉有些得不偿失，如果追求精度可以加上attention。</li>
</ol>
<h4 id="Bert，BertCNN，BertRNN，BertRCNN"><a href="#Bert，BertCNN，BertRNN，BertRCNN" class="headerlink" title="Bert，BertCNN，BertRNN，BertRCNN"></a>Bert，BertCNN，BertRNN，BertRCNN</h4><p><img src="/2020/03/29/text_classification/image-20200521150254593.png" alt></p>
<ol>
<li>通常来说bert的模型的train不用打开，如果打开，在bert后面接的层的学习率应大于bert学习率一两个数量级，使得后面的层得到充分的训练。</li>
<li>bert模型本身就可以达到98.3%左右的精确度，在后面添加其他模型看不出效果。</li>
</ol>
<h2 id="Cnews新闻十分类结果比较"><a href="#Cnews新闻十分类结果比较" class="headerlink" title="Cnews新闻十分类结果比较"></a>Cnews新闻十分类结果比较</h2><h3 id="数据-1"><a href="#数据-1" class="headerlink" title="数据"></a>数据</h3><p>类别：’体育’ ‘娱乐’ ‘家居’ ‘房产’ ‘教育’ ‘时尚’ ‘时政’ ‘游戏’ ‘科技’ ‘财经’<br>训练集：50000 条数据，最大长度：27467，最小长度：8，类别个数：10,平均长度：913.31<br>验证集：5000 条数据，最大长度：10919，最小长度：15，类别个数：10<br>测试集：10000 条数据，最大长度：14720，最小长度：13，类别个数：10</p>
<p>使用数据集<a href="https://pan.baidu.com/s/1OOTK374IZ1DHnz5COUcfbw" target="_blank" rel="noopener">cnews</a>  密码:hf6o</p>
<p>训练集部分样例及每个类别的统计：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>label</th>
<th>text</th>
<th>数量</th>
</tr>
</thead>
<tbody>
<tr>
<td>体育</td>
<td>黄蜂vs湖人首发：科比带伤战保罗 加索尔救赎之战 新浪体育讯北京时间4月27日，NBA季后赛首轮洛杉矶湖人主场迎战新奥尔良黄蜂，此前的比赛中，双方战成2-2平，因此本场比赛对于两支球队来说都非常重要，赛前双方也公布了首发阵容：湖人队：费舍尔、科比、阿泰斯特、加索尔、拜纳姆黄蜂队：保罗、贝里内利、阿里扎、兰德里、奥卡福[新浪NBA官方微博][新浪NBA湖人新闻动态微博][新浪NBA专题]<a href="新浪体育">黄蜂vs湖人图文直播室</a></td>
<td>5000</td>
</tr>
<tr>
<td>娱乐</td>
<td>皮克斯首部3D动画《飞屋历险记》预告发布(图)视频：动画片《飞屋历险记》先行版43秒预告新浪娱乐讯 迪士尼、皮克斯2009暑期3D动画力作《飞屋历险记》(Up)发布预告片，虽然这款预告片仅有43秒，并且只出现了被汽球吊起来的房屋，但门前老爷爷卡尔的一声“下午好”着实让人忍俊不禁。该片由《怪兽电力公司》导演彼特·道格特(Pete Docter)执导，曾在《海底总动员》、《料理鼠王》担任编剧的皮克斯老班底鲍勃-派特森(Bob Peterson)亦将在本片担任共同导演，献出自己的导演处女作。《飞屋历险记》同时会是皮克斯有史以来第一部以3-D电影呈现的里程碑作品，之后皮克斯的所有影片都将制作成立体电影。《飞屋历险记》讲述了一老一少的冒险旅程。78岁的老翁卡尔·弗雷德里克森(Carl Fredricksen)一生中都梦想着能环游世界、出没于异境险地体验，却平淡地渡过了一生。在他生活的最后阶段，卡而仿佛在命运的安排下，带着8岁的亚裔小鬼头Russell一同踏上了冒险的旅程。这对一老一小的奇特组合肩并肩闯荡江湖，共同经历了荒野跋涉、丛林野兽与反派坏蛋的狙击。田野/文</td>
<td>5000</td>
</tr>
<tr>
<td>家居</td>
<td>橱柜价格关键在计价方式 教你如何挑选买过橱柜的人都知道，橱柜的计价很复杂，商家的报价方式也不尽相同，那么哪种计价方式对消费者更有利？在计价过程中应该注意哪些问题？消费者在购买橱柜之前一定要了解清楚。 橱柜的主要计价方式——延米计价和单元柜体计价 现在市场上橱柜主要有两种计价方式——延米计价和单元柜体计价。 延米计价是指地柜和吊柜各一米的总价(有些还包含台面)。在此基础上，如果有局部区域只要地柜不要吊柜，就会按就会按“2/8”或“4/6”的比例折算。如某橱柜材料的延米价为2000元/延米，某顾客做2米的吊柜、4米的地柜，则吊柜价=2000X0.4X2=1600元，地柜价=2000X0.6X4=4800元(此吊柜、地柜价按4/6的比例计算)，再加上所选台面、配件、电器等附加费用即为整套橱柜的价格。 延米报价有许多不合理之处，水槽、燃气灶、嵌入式电器等部分所需门板很少，但仍按延米来算价，对消费者来说很不划算。例如一款1000元/延米的橱柜，一个水槽约0.8米长，但消费者还是要按1000元的单价乘以0.8米付费，这个实际上只是几块材料简单组合的水槽柜需要消费者花800元，而同样材质、同样大小的水槽柜仅需400元左右，二者价格相差数百元。 按延米计价，所有的配件费用都是在原有的基础上增加，虽然有些厂家宣称抽屉、拉篮不加钱，但其实那是最基本的配置，一旦顾客要求调整方案，就会要多加钱，此外不足一米的部分要按一米计价，因此对顾客来说，如此计价会多花不少冤枉钱。 “单元柜体计价”是国际惯例的橱柜计价方式，是按每一个组成厨柜的单元柜价格进行计算，然后加出总价。具体为：某吊柜单价×个数+某地柜单价×个数……。利用单元柜体计价，更为合理。举个例子说，外观相同的柜体，抽屉数量、五金件、托架数量如果不同，在以延米计价时，商家往往只给消费者最简单、最省成本的产品。而按单元柜体计价，一款尺寸相同的抽屉柜可按不同配置报出不同价格：同样是一款30cm宽、66cm高的单体柜，如果门改成弧型，是多少钱；如果抽屉里加上可拆装的金属篮，是多少钱；如果抽屉的侧板是木质的多少钱……把橱柜的每个细节都分解开来，消费者可以在预算之内把可有可无的配置省掉，把钱花在自己更需要的功能上。 两全其美报价方式——延米计价和单元柜体计价相结合 现在中国橱柜市场上仍普遍采用延米计价，但进口品牌及国内一些大品牌橱柜都采用单元柜体计价方式，如德宝·西克曼、海尔等品牌即是采用单元柜体计价方式。不过德宝·西克曼厨柜的工作人员介绍到，如果一开始就用单元柜体计价来进行报价，不够直观，同时为了便于顾客进行比较，他们会用延米计价给顾客所选定的材料进行一个初始报价，让顾客对自己的厨房装修要花多少钱心里大概有个底。在对厨房进行量尺后，设计师会按照顾客的需求，设计出厨房效果图。这时，销售人员会按单元柜体计价给顾客进行一个报价。对于每一种标准柜体都有相应的报价，顾客实际用到几组柜子，将这些柜子价格累加，再加上台面及其他相关费用，便是整个橱柜的价格。</td>
<td>5000</td>
</tr>
<tr>
<td>房产</td>
<td>冯仑：继续增持高GDP城市商业地产确立商业地产投资战略不久的万通地产(企业专区,旗下楼盘)(600246)，今年上半年遭遇了业绩下滑。公司昨日公布的半年报显示，其商业物业在报告期内实现的营业收入同比下降33.71%，营业利润率比上年同期下降47.29个百分点。不过，公司董事长冯仑日前表示，依然看好人均GDP8000美元以上城市的商业地产，万通将继续增加高GDP城市的商业地产；计划用5-10年，商业物业收入占比达到30%-50%。逆向运作地产投资冯仑指出，根据历史经验，GDP的增长、城市化的增长，和房地产物业形态有一定关系，即人均GDP在8000美元以下时，住宅是市场的核心，主流产品都将围绕住宅展开。目前，在中国的城市中，人均GDP8000美元的城市大约有十个，大部分省会城市依然在3000美元至5000美元之间，因此，未来5-10年，中国房地产市场的产品结构仍然是以住宅为主。 冯仑认为，万通地产从现在开始扩大商业地产的比重，在目前的市场中，是一种逆向运作的思维，但符合长期趋势。他指出，在人均GDP达到8000美元的经济实体中，商用不动产会成为地产业的主角。以美国为例，商业地产的市场规模大约是住宅的两倍。中国商业地产未来的市场空间很大。根据万通地产的发展战略，除了在环渤海区域内发展住宅以外，还会重点发展商业不动产。未来，公司业务结构将逐步调整，商用地产的收入会逐年增加；今后，公司商业物业收入将占到整体营业收入的一半左右。对于目前商业地产面临的不景气局面，万通地产董事会秘书程晓?指出，公司战略不会因市场的短期波动而改变，公司将继续加大商用物业项目的投资力度，以营运带动开发，以财务安排的多样化实施商用物业投资。改变商业模式冯仑表示，就房地产开发模式而言，过去两百年主要经历了三次变化，即从“地主加工头”到“厂长加资本家”，再到“导演加制片”。目前，国内多数地产商的开发模式属于“地主加工头”和“厂长加资本家”的阶段；而商业地产的开发模式，不能停留在这两个阶段。所谓“导演加制片”模式，即由专业的房地产投资和资产管理公司负责运营商业地产项目，实现收入的多元化。而这种模式需要相应的金融创新产品支持。业内人士指出，房地产金融领域内的REITS、抵押贷款等金融产品体系的完善，将支持商用地产在一个多元化的不动产经营环境中快速的成长。而商业模式的改变需要较长一段时间。数据显示，香港主流房地产企业在人均GDP10000美元的时候开始逐步发展商业地产，先后经过13-15年确立起新的商业模式。其中，长江实业经过13年的发展，商业地产在业务机构的比重占到30%，新鸿基则经过15年的调整，商业地产比重占到50%。SOHO中国(企业专区,旗下楼盘)董事长潘石屹也指出，现在的市场虽然在调整，不过也给从事商业地产开发的企业提供了良好机会和平台，应及时在地域、开发物业的品种、品牌的建设、销售和持有物业的比重四个方面做出调整。 我要评论</td>
<td>5000</td>
</tr>
<tr>
<td>教育</td>
<td>2010年6月英语六级考试考后难度调查2010年6月大学英语六级考试将于19日下午举行，欢迎各位考生在考试后参加难度调查，发表你对这次考试的看法。点击进入论坛，参与考后大讨论</td>
<td>5000</td>
</tr>
<tr>
<td>时尚</td>
<td>组图：萝莉潮人示范春季复古实穿导语：萝莉潮人示范春季复古实穿，在乍暖还寒的初春，有的甜美、有的优雅、有的性感，但无论是哪种风格都给人强烈的视觉冲击力，在这个缤纷的春季更加脱俗动人。</td>
<td>5000</td>
</tr>
<tr>
<td>时政</td>
<td>香港特区行政长官曾荫权将离港休假中新社香港八月七日电 香港特区行政长官曾荫权将于八月九日至十五日离港休假。特区政府发言人七日透露，曾荫权离港期间，八月九日由特区财政司司长曾俊华署理行政长官职务；八月十日至十五日由政务司司长唐英年署理行政长官职务。(完)</td>
<td>5000</td>
</tr>
<tr>
<td>游戏</td>
<td>全国人大常委会将对59件法律相关条文作出修改新华社快讯：全国人大常委会27日表决通过了关于修改部分法律的决定，对59件法律的相关条文作出修改。</td>
<td>5000</td>
</tr>
<tr>
<td>科技</td>
<td>入门级时尚卡片机 尼康S220套装仅1150尼康S220延续了S系列纤巧超薄的机身设计，采用铝合金材质打造，表面质地细腻，不易沾染指纹。S220拥有紫色、深蓝、洋红、水晶绿和柔银五款靓丽颜色可供选择。</td>
<td>5000</td>
</tr>
</tbody>
</table>
</div>
<h3 id="分析比较"><a href="#分析比较" class="headerlink" title="分析比较"></a>分析比较</h3><p> 训练集上的表现（字向量）（序列长度：2000）：</p>
<p><img src="/2020/03/29/text_classification/image-20200526204848210.png" alt="各种模型"></p>
<p><img src="/2020/03/29/text_classification/image-20200526205351509.png" alt="rnn/cnn-attention/fast_text"></p>
<p><img src="/2020/03/29/text_classification/image-20200526205849399.png" alt="speed"></p>
<p><img src="/2020/03/29/text_classification/image-20200526210508245.png" alt="蓝色为字向量/绿色为词向量"></p>
<ol>
<li>rnn在面对长文本时直接崩溃了（感觉自己说了一个废话）。再给rnn加上attention之后，rnn得到了救赎，但是效果和FastText基本持平。由此推断lstm+attention 能够获得一个相对较好的结果（如果不考虑速度的话）。</li>
<li>从speed图来看，最快的当然是FastText，可以并行的CNN处于第二梯队，最后的是RNN系列的模型。</li>
<li>词向量还是字向量：<ol>
<li>对于FastText来说，在长文本上，词向量的表现要远远好于字向量。</li>
<li>可能是文本长度过长了吧，实验结果表明：在长文本数据上，词向量的表现要好于字向量，对于长文本分类来说，整句话的语义要高于某些特定的词吧。</li>
<li>对于rnn系列来说，毫无疑问，词向量的表现远好于字向量，因为句子序列长度变短了。</li>
<li>rcnn模型一般来说不会比rnn，或者cnn表现差。</li>
</ol>
</li>
<li>xlnet由于显存的原因，序列长度只取到1500（只要你显存够，在一定意义上来说是解决了bert的长度限制的问题）。但是在11g单卡上，batch_size=2，跑完一步，FastText可以跑一个epoch。不知道知识蒸馏效果会怎样。</li>
</ol>
<h2 id="文本多标签分类"><a href="#文本多标签分类" class="headerlink" title="文本多标签分类"></a>文本多标签分类</h2><p>（先挖一个坑）</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><h4 id="长短文本分类的比较"><a href="#长短文本分类的比较" class="headerlink" title="长短文本分类的比较"></a>长短文本分类的比较</h4><p>对于词嵌入技术的文本表示，短文本和长文本表示上没有差别，此时分类效果的优劣主要在分类模型和训练数据上。</p>
<p>对于数据而言：随着文本越长，语义的重要性就越高，在文本很短的情况下，语义的重要性就很小，比如：“今天 天气 怎么样”，“今天 怎么样 天气”，“怎么样 天气 今天”。你甚至不必要考虑句子是否通顺，基本上可以当一句话处理，没有第二个意思。但是随着文本越来越长，比如512个字符，颠倒一下可能就要归为两类了。</p>
<p>对于模型而言：对于短文本，CNN配合Max-pooling池化(如TextCNN模型)速度快，而且效果也很好。因为短文本上的关键词比较容易找到，而且Max-pooling会直接过滤掉模型认为不重要特征。具体工作机制是：卷积窗口沿着长度为n的文本一个个滑动，类似于n-gram机制对文本切词，然后和文本中的每个词进行相似度计算，因为后面接了个Max-pooling，因此只会保留和卷积核最相近的词。微博数据集属于情感分类，为了判断句子的情感极性，只需要让分类器能识别出“不开心”这类词是个负极性的词，“高兴”、“开心”等这类词是正极性的词，其他词是偏中性词就可以了。因此，当把该句子中的各个词条输入给模型去分类时，并不需要去“瞻前顾后”，因此使用一个关注局部的前馈神经网络往往表现更佳。虽然Attention也突出了重点特征，但是难以过滤掉所有低分特征。但是对于长文本直接用CNN就不行了，TextCNN会比HAN模型泛化能力差很多。<strong>如果在TextCNN前加一层LSTM，这样效果可以提升很大</strong>。</p>
<h4 id="为什么长文本分类的实验中，cnn-和-rnn-没有拉开差距？"><a href="#为什么长文本分类的实验中，cnn-和-rnn-没有拉开差距？" class="headerlink" title="为什么长文本分类的实验中，cnn 和 rnn 没有拉开差距？"></a>为什么长文本分类的实验中，cnn 和 rnn 没有拉开差距？</h4><p>cnn和rnn的精度都很高，分析主要还是分类的文章规则性比较强，且属于特定领域，词量不多，类别差异可能比较明显。</p>
<h1 id="文本分类tricks"><a href="#文本分类tricks" class="headerlink" title="文本分类tricks"></a>文本分类tricks</h1><h2 id="分词器"><a href="#分词器" class="headerlink" title="分词器"></a>分词器</h2><p><strong>分词器所分出的词与词向量表中的token粒度match是更重要的事情</strong></p>
<h2 id="已知预训练词向量的分词器"><a href="#已知预训练词向量的分词器" class="headerlink" title="已知预训练词向量的分词器"></a>已知预训练词向量的分词器</h2><p>像word2vec、glove、fasttext这些官方release的预训练词向量都会公布相应训练语料的信息，包括预处理策略如分词，这种情况下直接使用官方的训练该词向量所使用的分词器，此分词器在下游任务的表现十之八九会比其他花里胡哨的分词器好用。</p>
<h2 id="不知道预训练词向量的分词器"><a href="#不知道预训练词向量的分词器" class="headerlink" title="不知道预训练词向量的分词器"></a>不知道预训练词向量的分词器</h2><p>这时就需要去“猜”一下分词器。怎么猜呢？<br>首先，拿到预训练词向量表后，去里面search一些特定词汇比如一些网站、邮箱、成语、人名等，英文里还有n’t等，看看训练词向量使用的分词器是把它们分成什么粒度。<br>然后跑几个分词器，看看哪个分词器的粒度跟他最接近就用哪个，如果不放心，就放到下游任务里跑跑看。</p>
<p>最理想的情况是：先确定最适合当前任务数据集的分词器，再使用同分词器产出的预训练词向量。如果无法满足理想情况，则需要自己在下游任务训练集或者大量同分布无监督语料上训练的词向量更有利于进一步压榨模型的性能。</p>
<h2 id="关于中文字向量"><a href="#关于中文字向量" class="headerlink" title="关于中文字向量"></a>关于中文字向量</h2><p>预训练中文字向量的时候，把窗口开大一些，不要直接使用word-level的窗口大小，效果会比随机初始化的字向量明显的好。</p>
<h2 id="数据集噪声很严重"><a href="#数据集噪声很严重" class="headerlink" title="数据集噪声很严重"></a>数据集噪声很严重</h2><p>里噪声严重有两种情况。对于数据集D(X, Y)，一种是X内部噪声很大（比如文本为口语化表述或由互联网用户生成），一种是Y的噪声很大（一些样本被明显的错误标注，一些样本人也很难定义是属于哪一类，甚至具备类别二义性）。</p>
<h2 id="X内部噪声很大"><a href="#X内部噪声很大" class="headerlink" title="X内部噪声很大"></a>X内部噪声很大</h2><p>法一：直接将模型的输入变成char-level（中文中就是字的粒度），然后train from scratch（不使用预训练词向量）去跟word-level的对比一下，如果char-level的明显的效果好，那么短时间之内就直接基于char-level去做模型。</p>
<p>法二：使用特殊超参的FastText去训练一份词向量：<br>一般来说fasttext在英文中的char ngram的窗口大小一般取值3～6，但是在处理中文时，如果我们的目的是为了去除输入中的噪声，那么我们可以把这个窗口限制为1～2，这种小窗口有利于模型去捕获错别字（比如，我们打一个错误词的时候，一般都是将其中的一个字达成同音异形的另一个字），比如word2vec学出来的“似乎”的最近词可能是“好像”，然而小ngram窗口fasttext学出来的“似乎”最近词则很有可能是“是乎”等内部包含错别字的词，这样就一下子让不太过分的错别字构成的词们又重新回到了一起，甚至可以一定程度上对抗分词器产生的噪声（把一个词切分成多个字）。</p>
<h2 id="Y的噪声很大"><a href="#Y的噪声很大" class="headerlink" title="Y的噪声很大"></a>Y的噪声很大</h2><p>首先忽略这个噪声，强行的把模型尽可能好的训出来。然后让训练好的模型去跑训练集和开发集，取出训练集中的错误样本和开发集中那些以很高的置信度做出错误决策的样本（比如以99%的把握把一个标签为0的样本预测为1），然后去做这些bad cases的分析，如果发现错误标注有很强的规律性，则直接撸一个脚本批量纠正一下（只要确保纠正后的标注正确率比纠正前明显高就行）。<br>如果没有什么规律，但是发现模型高置信度做错的这些样本大部分都是标注错误的话，就直接把这些样本都删掉，常常也可以换来性能的小幅提升，毕竟测试集都是人工标注的，困难样本和错标样本不会太多。</p>
<h2 id="baseline选用CNN还是RNN？"><a href="#baseline选用CNN还是RNN？" class="headerlink" title="baseline选用CNN还是RNN？"></a>baseline选用CNN还是RNN？</h2><p>看数据集，如果感觉数据集里很多很强的ngram可以直接帮助生成正确决策，那就CNN。<br>如果感觉很多case都是那种需要把一个句子看完甚至看两三遍才容易得出正确tag，那就RNN。<br>还可以CNN、RNN的模型都跑出来简单集成一下。</p>
<h2 id="Dropout加在哪里"><a href="#Dropout加在哪里" class="headerlink" title="Dropout加在哪里"></a>Dropout加在哪里</h2><p>word embedding层后、pooling层后、FC层（全联接层）后。</p>
<h2 id="二分类"><a href="#二分类" class="headerlink" title="二分类"></a>二分类</h2><p>二分类问题不一定要用sigmoid作为输出层的激活函数，尝试一下包含俩类别的softmax。可能多一条分支就多一点信息，实践中常常带来零点几个点的提升。</p>
<h2 id="样本类别不均衡问题"><a href="#样本类别不均衡问题" class="headerlink" title="样本类别不均衡问题"></a>样本类别不均衡问题</h2><p>如果正负样本比小于9:1的话，继续做深度模型调超参，决策阈值也完全不用手调。但是，如果经常一个batch中完全就是同一个类别的样本，或者一些类别的样本经过好多batch都难遇到一个的话，均衡就非常非常有必要了。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><ol>
<li>别太纠结文本截断长度使用120还是150</li>
<li>别太纠结对性能不敏感的超参数带来的开发集性能的微小提升</li>
<li>别太纠结未登陆词的embedding是初始化成全0还是随机初始化，别跟PAD共享embedding就行</li>
<li>别太纠结优化器用Adam还是MomentumSGD，如果跟SGD的感情还不深，无脑Adam，最后再用MomentumSGD跑几遍</li>
<li>还是不会用tricks但是就是想跑出个好结果，bert大力出奇迹。</li>
</ol>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>复杂的模型未必会有很好的结果，简单模型效果未必不理想，没必要一味追求深度学习、复杂模型什么的。选什么样的模型还是要根据数据来的。同一类问题，不同的数据效果差异很大，不要小看任何一类问题，例如分类，我们通常觉得它很简单，但有些数据并非你所想。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://blog.csdn.net/feilong_csdn/article/details/88655927" target="_blank" rel="noopener">fastText原理和文本分类实战，看这一篇就够了</a></li>
<li><a href="https://blog.csdn.net/asialee_bird/article/details/88813385#一、论文笔记" target="_blank" rel="noopener">TextCNN文本分类（keras实现）</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/55263066" target="_blank" rel="noopener">浅谈基于深度学习的文本分类问题</a></li>
<li><a href="https://www.jiqizhixin.com/articles/2018-06-22-4" target="_blank" rel="noopener">从DPCNN出发，撩一下深层word-level文本分类模型</a></li>
<li><a href="https://www.jiqizhixin.com/articles/2019-01-24-5" target="_blank" rel="noopener">文本分类有哪些论文中很少提及却对性能有重要影响的tricks？</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwNzc2NTk0NQ==&amp;mid=2247484682&amp;idx=1&amp;sn=51520138eed826ec891ac8154ee550f9&amp;chksm=970c2ddca07ba4ca33ee14542cff0457601bb16236f8edc1ff0e617051d1f063354dda0f8893&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">从前馈到反馈：解析循环神经网络（RNN）及其tricks</a></li>
<li><a href="http://www.52nlp.cn/tag/长文本分类" target="_blank" rel="noopener"><a href="http://www.52nlp.cn/如何用深度学习做好长文本分类与法律文书智能化" target="_blank" rel="noopener">达观数据曾彦能：如何用深度学习做好长文本分类与法律文书智能化处理</a></a></li>
<li><a href="https://www.zhihu.com/question/326770917/answer/698646465" target="_blank" rel="noopener">短文本分类和长文本分类的模型如何进行选择？</a></li>
<li><a href="https://www.pianshen.com/article/4319299677/" target="_blank" rel="noopener">NLP实践九：HAN原理与文本分类实践</a></li>
<li><a href="https://www.jianshu.com/p/56061b8f463a" target="_blank" rel="noopener">NLP之文本分类</a></li>
</ol>
]]></content>
      <categories>
        <category>技术/自然语言处理</category>
      </categories>
      <tags>
        <tag>自然语言处理</tag>
        <tag>FastText</tag>
      </tags>
  </entry>
  <entry>
    <title>BatchNormalization</title>
    <url>/2020/03/28/BatchNormalization/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>机器学习领域有个很重要的假设：<strong>IID独立同分布假设</strong>，就是假设训练数据和测试数据是满足相同分布的，这是通过训练数据获得的模型能够在测试集获得好的效果的一个基本保障。</p>
<p>那BatchNorm的作用是什么呢？<strong>BatchNorm就是在深度神经网络训练过程中使得每一层神经网络的输入保持相同分布的。</strong></p>
<a id="more"></a>
<h3 id="Internal-Covariate-Shift-问题"><a href="#Internal-Covariate-Shift-问题" class="headerlink" title="Internal Covariate Shift 问题"></a>Internal Covariate Shift 问题</h3><p><strong>如果ML系统实例集合中的输入值X的分布老是变，这不符合IID假设</strong>，网络模型很难<strong>稳定的学规律</strong>,对于深度学习这种包含很多隐层的网络结构，在训练过程中，因为各层参数不停在变化，所以每个隐层都会面临covariate shift的问题，也就是<strong>在训练过程中，隐层的输入分布老是变来变去，这就是所谓的“Internal Covariate Shift”，Internal指的是深层网络的隐层，是发生在网络内部的事情，而不是covariate shift问题只发生在输入层</strong>。</p>
<p>然后提出了BatchNorm的基本思想：能不能<strong>让每个隐层节点的激活输入分布固定下来呢</strong>？这样就避免了“Internal Covariate Shift”问题了。</p>
<p>BN不是凭空拍脑袋拍出来的好点子，它是有启发来源的：之前的研究表明如果在图像处理中对输入图像进行白化（Whiten）操作的话——所谓<strong>白化</strong>，<strong>就是对输入数据分布变换到0均值，单位方差的正态分布</strong>——那么神经网络会较快收敛，那么BN作者就开始推论了：图像是深度神经网络的输入层，做白化能加快收敛，那么其实对于深度网络来说，其中某个隐层的神经元是下一层的输入，意思是其实深度神经网络的每一个隐层都是输入层，不过是相对下一层来说而已，那么能不能对每个隐层都做白化呢？这就是启发BN产生的原初想法，而BN也确实就是这么做的，<strong>可以理解为对深层神经网络每个隐层神经元的激活值做简化版本的白化操作。</strong></p>
<h3 id="BatchNorm的本质思想"><a href="#BatchNorm的本质思想" class="headerlink" title="BatchNorm的本质思想"></a>BatchNorm的本质思想</h3><p>BN的基本思想其实相当直观：因为深层神经网络在做非线性变换前的<strong>激活输入值</strong>（就是那个x=WU+B，U是输入）<strong>随着网络深度加深或者在训练过程中，其分布逐渐发生偏移或者变动，之所以训练收敛慢，一般是整体分布逐渐往非线性函数的取值区间的上下限两端靠近</strong>（对于Sigmoid函数来说，意味着激活输入值WU+B是大的负值或正值），所以这<strong>导致反向传播时低层神经网络的梯度消失</strong>，这是训练深层神经网络收敛越来越慢的<strong>本质原因</strong>，<strong>而BN就是通过一定的规范化手段，把每层神经网络任意神经元这个输入值的分布强行拉回到均值为0方差为1的标准正态分布</strong>，其实就是把越来越偏的分布强制拉回比较标准的分布，这样使得激活输入值落在非线性函数对输入比较敏感的区域，这样输入的小变化就会导致损失函数较大的变化，意思是<strong>这样让梯度变大，避免梯度消失问题产生，而且梯度变大意味着学习收敛速度快，能大大加快训练速度。</strong></p>
<p><strong>对于每个隐层神经元，把逐渐向非线性函数映射后向取值区间极限饱和区靠拢的输入分布强制拉回到均值为0方差为1的比较标准的正态分布，使得非线性变换函数的输入值落入对输入比较敏感的区域，以此避免梯度消失问题</strong>。因为梯度一直都能保持比较大的状态，所以很明显对神经网络的参数调整效率比较高，就是变动大，就是说向损失函数最优值迈动的步子大，也就是说收敛地快。BN说到底就是这么个机制，方法很简单，道理很深刻。</p>
<h3 id="训练阶段如何做BatchNorm"><a href="#训练阶段如何做BatchNorm" class="headerlink" title="训练阶段如何做BatchNorm"></a>训练阶段如何做BatchNorm</h3><p>假设对于一个深层神经网络来说，其中两层结构如下：</p>
<p><img src="/2020/03/28/BatchNormalization/bn1.png" alt="avatar"></p>
<p>要对每个隐层神经元的激活值做BN，可以想象成每个隐层又加上了一层BN操作层，它位于X=WU+B激活值获得之后，非线性函数变换之前，其图示如下：</p>
<p><img src="/2020/03/28/BatchNormalization/bn2.png" alt="avatar"></p>
<p>对于Mini-Batch SGD来说，一次训练过程里面包含m个训练实例，其具体BN操作就是对于隐层内每个神经元的激活值来说，进行如下变换：</p>
<script type="math/tex; mode=display">
\hat{x}^{(k)}=\frac{x^{(k)}-E\left[x^{(k)}\right]}{\sqrt{\operatorname{Var}\left[x^{(k)}\right]}}</script><p>某个神经元对应的原始的激活x通过减去mini-Batch内m个实例获得的m个激活x求得的均值E(x)并除以求得的方差Var(x)来进行转换。</p>
<p>经过这个<strong>变换后某个神经元的激活x形成了均值为0，方差为1的正态分布，目的是把值往后续要进行的非线性变换的线性区拉动，增大导数值，增强反向传播信息流动性，加快训练收敛速度。 但是这样会导致网络表达能力下降，为了防止这一点，每个神经元增加两个调节参数（scale和shift），这两个参数是通过训练来学习到的，用来对变换后的激活反变换，使得网络表达能力增强，即对变换后的激活进行如下的scale和shift操作，这其实是变换的反操作：</strong></p>
<script type="math/tex; mode=display">
y^{(k)}=\gamma^{(k)} \hat{x}^{(k)}+\beta^{(k)}</script><p>算法描述：</p>
<p><img src="/2020/03/28/BatchNormalization/bn3.png" alt="avatar"></p>
<h3 id="推理阶段如何做BatchNorm"><a href="#推理阶段如何做BatchNorm" class="headerlink" title="推理阶段如何做BatchNorm"></a>推理阶段如何做BatchNorm</h3><p>BN在训练的时候可以根据Mini-Batch里的若干训练实例进行激活数值调整，但是在推理（inference）的过程中，很明显输入就只有一个实例，看不到Mini-Batch其它实例，那么这时候怎么对输入做BN呢？因为很明显一个实例是没法算实例集合求出的均值和方差的。这可如何是好？</p>
<p>既然没有从Mini-Batch数据里可以得到的统计量，那就想其它办法来获得这个统计量，就是均值和方差。可以用从所有训练实例中获得的统计量来代替Mini-Batch里面m个训练实例获得的均值和方差统计量，因为本来就打算用全局的统计量，只是因为计算量等太大所以才会用Mini-Batch这种简化方式的，那么在推理的时候直接用全局统计量即可。</p>
<p>决定了获得统计量的数据范围，那么接下来的问题是如何获得均值和方差的问题。很简单，因为每次做Mini-Batch训练时，都会有那个Mini-Batch里m个训练实例获得的均值和方差，现在要全局统计量，只要把每个Mini-Batch的均值和方差统计量记住，然后对这些均值和方差求其对应的数学期望即可得出全局统计量</p>
<script type="math/tex; mode=display">
\begin{aligned}
&E[x] \leftarrow E_{\mathrm{B}}\left[\mu_{\mathrm{B}}\right] \\
&\operatorname{Var}[x] \leftarrow \frac{m}{m-1} E_{\mathrm{B}}\left[\sigma_{\mathrm{B}}^{2}\right]
\end{aligned}</script><p>有了均值和方差，每个隐层神经元也已经有对应训练好的Scaling参数和Shift参数，就可以在推导的时候对每个神经元的激活数据计算NB进行变换了，在推理过程中进行BN采取如下方式：</p>
<script type="math/tex; mode=display">
y=\frac{\gamma}{\sqrt{\operatorname{Var}[x]+\varepsilon}} \cdot x+\left(\beta-\frac{\gamma \cdot E[x]}{\sqrt{\operatorname{Var}[x]+\varepsilon})}\right)</script><p>这个公式其实和训练时</p>
<script type="math/tex; mode=display">
y^{(k)}=\gamma^{(k)} \hat{x}^{(k)}+\beta^{(k)}</script><p>是等价的，通过简单的合并计算推导就可以得出这个结论。那么为啥要写成这个变换形式呢？作者这么写的意思是：在实际运行的时候，按照这种变体形式可以减少计算量，为啥呢？因为对于每个隐层节点来说：</p>
<script type="math/tex; mode=display">
\frac{\gamma}{\sqrt{\operatorname{Var}[x]+\varepsilon}} \frac{\gamma \cdot E[x]}{\sqrt{\operatorname{Var}[x]+\varepsilon}}</script><p>都是固定值，这样这两个值可以事先算好存起来，在推理的时候直接用就行了，这样比原始的公式每一步骤都现算少了除法的运算过程，乍一看也没少多少计算量，但是如果隐层节点个数多的话节省的计算量就比较多了。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol>
<li><strong>不仅仅极大提升了训练速度，收敛过程大大加快</strong></li>
<li><strong>还能增加分类效果，一种解释是这是类似于Dropout的一种防止过拟合的正则化表达方式，所以不用Dropout也能达到相当的效果</strong></li>
<li>另外调参过程也简单多了，对于初始化要求没那么高，而且可以使用大的学习率等。总而言之，经过这么简单的变换，带来的好处多得很，这也是为何现在BN这么快流行起来的原因。</li>
</ol>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol>
<li><a href="https://cloud.tencent.com/developer/article/1157136" target="_blank" rel="noopener">深度学习】深入理解Batch Normalization批标准化</a></li>
</ol>
]]></content>
      <categories>
        <category>深度学习</category>
      </categories>
      <tags>
        <tag>深度学习</tag>
        <tag>batch normalization</tag>
      </tags>
  </entry>
  <entry>
    <title>深度学习总结</title>
    <url>/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><h4 id="神经元-感知器"><a href="#神经元-感知器" class="headerlink" title="神经元(感知器)"></a>神经元(感知器)</h4><ol>
<li>感知器是一种人工<strong>神经元</strong>.它接受几个<strong>二进制输出</strong>并产生一个<strong>二进制输入</strong>.如果引入<strong>权重</strong>和<strong>阈值</strong>,那么感知器的参数可以表示为:$f(x)=sign(wx+b)$</li>
<li>感知器是<strong>单输出</strong>的,但这个单输出可以被用于<strong>多个</strong>其它感知器的输入.</li>
<li>感知器可以很容易地计算基本的<strong>逻辑功能</strong>,如<strong>与</strong>,<strong>或</strong>,<strong>与非</strong>.所以感知器网络可以计算任何逻辑功能</li>
<li>使感知器能够自动调整权重和偏置的<strong>学习算法</strong>是神经网络有别于传统逻辑门的关键.</li>
</ol>
<h4 id="S型神经元"><a href="#S型神经元" class="headerlink" title="S型神经元"></a>S型神经元</h4><ol>
<li>网络中单个感知器上权重或偏置的<strong>微小改动</strong>可能会引起<strong>输出翻转</strong>,从而导致其余网络的行为改变.所以<strong>逐步修改</strong>权重和偏置来让输出接近期望很困难,所以引入了<strong>S型神经元(逻辑神经元)</strong></li>
<li>S型神经元和感知器类似,但是权重和偏置的微小改动只引起输出的<strong>微小变化</strong>.S型神经元的输入可以是<strong>0和1中的任意值</strong>,输出是$σ(wx+b)$,其中$σ$被称为s型函数(逻辑函数).</li>
<li>σ函数是阶跃函数的<strong>平滑</strong>版本.这意味着权重和偏置的微小变化会产生一个微小的输出变化,$\Delta output \approx \sum_{j} \frac{\partial \text { output }}{\partial w_{j}} \Delta w_{j}+\frac{\partial \text { output }}{\partial b} \Delta b$,这意味着输出的变化是权重和偏置的变化的<strong>线性函数</strong>.</li>
</ol>
<a id="more"></a>
<h4 id="梯度下降算法"><a href="#梯度下降算法" class="headerlink" title="梯度下降算法"></a>梯度下降算法</h4><ol>
<li><p>神经网络中经常需要<strong>大量</strong>变量,因此采用<strong>梯度下降法</strong>来计算代价函数最小值:重复计算梯度,然后沿着<strong>相反</strong>的方向移动$v \rightarrow v^{\prime}=v-\eta \nabla C$</p>
</li>
<li><p>假如需要计算每个训练输入的梯度值,训练速度会相当缓慢.因此引入了<strong>随机梯度下降</strong>,只计算小批量数据(mini-batch)的梯度值来求平均值</p>
<script type="math/tex; mode=display">
\begin{aligned}
w_{k} \rightarrow w_{k}^{\prime} &=w_{k}-\frac{\eta}{m} \sum_{j} \frac{\partial C_{X_{j}}}{\partial w_{k}} \\
b_{l} \rightarrow b_{l}^{\prime} &=b_{l}-\frac{\eta}{m} \sum_{j} \frac{\partial C_{X_{j}}}{\partial b_{l}}
\end{aligned}</script></li>
<li><p>随机机梯度下降不断地选定小批量数据来进行训练,直到用完了所有的训练输入,就称为完成了一个<strong>迭代期(epoch)</strong>,然后会开始一个新的迭代期.</p>
</li>
</ol>
<h4 id="反向传播-BP-算法"><a href="#反向传播-BP-算法" class="headerlink" title="反向传播(BP)算法"></a>反向传播(BP)算法</h4><h5 id="神经网络中使用矩阵快速计算输出的方法"><a href="#神经网络中使用矩阵快速计算输出的方法" class="headerlink" title="神经网络中使用矩阵快速计算输出的方法"></a>神经网络中使用矩阵快速计算输出的方法</h5><ol>
<li>$w^l_{jk}$表示从第$(l-1)$层的第$k$个神经元到第$l$层的第$j$个神经元的链接上的<strong>权重</strong>,$b^l_j$表示在第l层第j个神经元的<strong>偏置</strong>.$a^l_j$表示第l层第j个神经元的<strong>激活值</strong>.由此得到了激活值之间的关系$a_{j}^{l}=\sigma\left(\sum_{k} w_{j k}^{l} a_{k}^{l-1}+b_{j}^{l}\right)$</li>
<li>对每一层l定义<strong>权重矩阵</strong>(其中第j行第k列的元素是$w^l_{jk}$,<strong>偏置向量</strong>(每个元素是$b^l_j$)和<strong>激活向量</strong>(每个元素是$a^l_j$).所以上式可以改写为$a^{l}=\sigma\left(w^{l} a^{l-1}+b^{l}\right)$,其中σ是<strong>向量化函数</strong>(作用σ到向量中的每个元素).中间量$z^{l} \equiv w^{l} a^{l-1}+b^{l}$称为<strong>带权输</strong>入(每个元素是第l层第j个神经元的激活函数的带权输入<strong>)</strong>.</li>
</ol>
<h5 id="关于代价函数的两个假设"><a href="#关于代价函数的两个假设" class="headerlink" title="关于代价函数的两个假设"></a>关于代价函数的两个假设</h5><p><strong>反向传播</strong>的目标是计算代价函数关于w和b的<strong>偏导数</strong>.为了让反向传播可行,需要作出两个主要假设</p>
<ol>
<li>代价函数可以被写成一个在每个训练样本x上的代价函数的<strong>均值</strong>$C=\frac{1}{n} \sum_{x} C_{x}$</li>
<li>代价可以写成神经网络输出的函数,以二次代价函数为例$C=\frac{1}{2}\left|y-a^{L}\right|^{2}=\frac{1}{2} \sum_{j}\left(y_{j}-a_{j}^{L}\right)^{2}$</li>
</ol>
<h5 id="Hadamard乘积-s⊙t"><a href="#Hadamard乘积-s⊙t" class="headerlink" title="Hadamard乘积,s⊙t"></a>Hadamard乘积,s⊙t</h5><p>假设s和t是两个同样维度的向量,那么s⊙t表示<strong>按元素的乘积</strong>,称为<strong>Hadamard乘积</strong></p>
<h5 id="反向传播的四个基本方程"><a href="#反向传播的四个基本方程" class="headerlink" title="反向传播的四个基本方程"></a>反向传播的四个基本方程</h5><p>在第l层第j个神经元上的<strong>误差</strong>,被定义为$\delta_{j}^{l} \equiv \frac{\partial C}{\partial z_{j}^{l}}$</p>
<p><strong>四个基本方程</strong></p>
<ol>
<li><p>输出层误差的方程: $\delta_{j}^{L} = \frac{\partial C}{\partial a^L_j}\frac{\partial a^L_j}{\partial z^l_j} = \frac{\partial C}{\partial a_{j}^{L}} \sigma^{\prime}\left(z_{j}^{L}\right)$ </p>
<p> 右式第⼀个项 $\frac{\partial C}{\partial a^L_j}$ 表⽰代价随着 $j^{th}$输出激活值的变化⽽ 变化的速度。假如 $C$ 不太依赖⼀个特定的输出神经元 $j$，那么$\delta^L_j$就会很⼩，这也是我们想要的效果。右式第⼆项 $\sigma^\prime(Z^L_j)$刻画了在$z^L_j$ 处激活函数 $\sigma$ 变化的速度。</p>
</li>
<li><p>使用下一层的误差来表示当前层的误差:$\delta^{l}=\left(\left(w^{l+1}\right)^{T} \delta^{l+1}\right) \odot \sigma^{\prime}\left(z^{l}\right)$</p>
<p> 由递推公式</p>
<script type="math/tex; mode=display">
\begin{aligned}
\frac{\partial  C}{\partial  z^l_j} &=\delta^l_j \\
& = \sum_i{\frac{\partial  C}{\partial  z^{l+1}_i}\frac{\partial  z^{l+1}_i}{\partial  z^l_j}} \\ 
&=\sum_i{\delta ^{l+1}_i \frac{\partial  z^{l+1}_i}{\partial  a^l_j}\frac{\partial  a^l_j}{\partial  z^l_j}} \\ 
&=\sum_i{\delta^{l+1}_i w^{l+1}_{ji} \sigma \prime (z^l_j)} \\
&=(w^{l+1}_j)^T\delta^{l+1}\sigma \prime(z^l_j) \\
&=(w^{l+1})^T \sigma^{l+1}\bigodot \sigma \prime (z^l)
\end{aligned}</script></li>
<li><p>代价函数关于网络中任意偏置的改变率:$\frac{\partial C}{\partial b_{j}^{l}}=\delta_{j}^{l}$</p>
</li>
<li><p>代价函数关于任何一个权重的改变率:$\frac{\partial C}{\partial w_{j k}^{l}}=a_{k}^{l-1} \delta_{j}^{l}$（因为$z^l = w^la^{l-1}+b^l$）</p>
</li>
</ol>
<h5 id="算法描述"><a href="#算法描述" class="headerlink" title="算法描述"></a>算法描述</h5><p>反向传播方程给出了一种计算代价函数梯度的方法:</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/bp.png" alt="avatar"></p>
<ol>
<li><strong>输入x</strong>:为输入层设置对应的激活值$a1$</li>
<li><strong>前向传播</strong>:对从前往后对每层计算相应的$z=wa+b$和$a=σ(z)$</li>
<li><strong>输出层误差</strong>:根据BP1计算误差向量</li>
<li><strong>反向误差传播</strong>:对后往前根据BP2对每层计算误差向量</li>
<li><strong>输出</strong>:根据BP3和BP4计算代价函数的梯度.</li>
</ol>
<h5 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Network</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">backprop</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">    <span class="string">"""Return a tuple "(nabla_b, nabla_w)" representing the</span></span><br><span class="line"><span class="string">    gradient for the cost function C_x.</span></span><br><span class="line"><span class="string">    "nabla_b" and "nabla_w" are layer-by-layer lists of numpy arrays, similar</span></span><br><span class="line"><span class="string">    to "self.biases" and "self.weights"."""</span></span><br><span class="line"></span><br><span class="line">    nabla_b = [np.zeros(b.shape) <span class="keyword">for</span> b <span class="keyword">in</span> self.biases]</span><br><span class="line">    nabla_w = [np.zeros(w.shape) <span class="keyword">for</span> w <span class="keyword">in</span> self.weights]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># feedforward</span></span><br><span class="line">    activation = x</span><br><span class="line">    activations = [x] <span class="comment"># list to store all the activations, layer by layer</span></span><br><span class="line">    zs = [] <span class="comment"># list to store all the z vectors, layer by layer</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> b, w <span class="keyword">in</span> zip(self.biases, self.weights):</span><br><span class="line">      z = np.dot(w, activation)+b</span><br><span class="line">      zs.append(z)</span><br><span class="line">      activation = sigmoid(z)</span><br><span class="line">      activations.append(activation)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># backward pass</span></span><br><span class="line">    delta = self.cost_derivative(activations[<span class="number">-1</span>], y) * sigmoid_prime(zs[<span class="number">-1</span>])</span><br><span class="line">    nabla_b[<span class="number">-1</span>] = delta</span><br><span class="line">    nabla_w[<span class="number">-1</span>] = np.dot(delta, activations[<span class="number">-2</span>].transpose())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Note that the variable l in the loop below is used a little</span></span><br><span class="line"><span class="comment"># differently to the notation in Chapter 2 of the book.</span></span><br><span class="line"><span class="comment"># Here,l = 1 means the last layer of neurons, l = 2 is the</span></span><br><span class="line"><span class="comment"># second-last layer, and so on.It's a renumbering of the</span></span><br><span class="line"><span class="comment"># scheme in the book, used here to take advantage of the fact</span></span><br><span class="line"><span class="comment"># that Python can use negative indices in lists.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> xrange(<span class="number">2</span>, self.num_layers):</span><br><span class="line">    	z = zs[-l]</span><br><span class="line">      sp = sigmoid_prime(z)</span><br><span class="line">    	delta = np.dot(self.weights[-l+<span class="number">1</span>].transpose(), delta) * sp</span><br><span class="line">    	nabla_b[-l] = delta</span><br><span class="line">    	nabla_w[-l] = np.dot(delta, activations[-l<span class="number">-1</span>].transpose())</span><br><span class="line">    <span class="keyword">return</span> (nabla_b, nabla_w)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cost_derivative</span><span class="params">(self, output_activations, y)</span>:</span></span><br><span class="line">  <span class="string">"""Return the vector of partial derivatives \partial C_x /</span></span><br><span class="line"><span class="string">  \partial a for the output activations."""</span></span><br><span class="line">  	<span class="keyword">return</span> (output_activations-y)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid</span><span class="params">(z)</span>:</span></span><br><span class="line"><span class="string">"""The sigmoid function."""</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">1.0</span>/(<span class="number">1.0</span>+np.exp(-z))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid_prime</span><span class="params">(z)</span>:</span></span><br><span class="line"><span class="string">"""Derivative of the sigmoid function."""</span></span><br><span class="line">  <span class="keyword">return</span> sigmoid(z)*(<span class="number">1</span>-sigmoid(z))</span><br></pre></td></tr></table></figure>
<h4 id="交叉熵代价函数"><a href="#交叉熵代价函数" class="headerlink" title="交叉熵代价函数"></a>交叉熵代价函数</h4><p>人类通常在<strong>犯错比较明显</strong>的时候学习的<strong>速度最快</strong>.而神经元在这种<strong>饱和</strong>情况下学习很有<strong>难度</strong>(也就是偏导数很小),这是因为<strong>二次代价函数</strong>关于权重和偏置的<strong>偏导数</strong>是$\frac{\partial C}{\partial w}=(a-y) \sigma^{\prime}(z) x=a \sigma^{\prime}(z)$和$\frac{\partial C}{\partial b}=(a-y) \sigma^{\prime}(z)=a \sigma^{\prime}(z)$而σ函数的<strong>导数</strong>在接近0和1时都很小。</p>
<p>解决上述问题的方法是引入<strong>交叉熵代价函数</strong>:$C=-\frac{1}{n} \sum_{x}[y \ln a+(1-y) \ln (1-a)]$</p>
<ol>
<li>它是<strong>非负</strong>的,并且当实际输出接近目标值时它<strong>接近0</strong>,因此可以作为代价函数.</li>
<li>它关于权重的<strong>偏导数</strong>是$\frac{\partial C}{\partial w_{j}}=\frac{1}{n} \sum_{x} x_{j}(\sigma(z)-y)$,也就是误差越大,学习速度越快.</li>
<li>如果输出层是<strong>线性神经元</strong>,那么<strong>二次代价函数</strong>不再会导致学习速度下降的问题,可以选用.如果输出神经元是<strong>S型神经元</strong>,<strong>交叉熵</strong>一般都是更好的选择. </li>
<li>对于多分类交叉熵代价函数为：$C=-\sum_{j=1}^{T} y_{j} \log {p_j}$,</li>
</ol>
<h4 id="过拟合"><a href="#过拟合" class="headerlink" title="过拟合"></a>过拟合</h4><ol>
<li>最好的降低过拟合的方式就是<strong>增加训练样本量</strong>,但训练数据其实是很<strong>难得</strong>的资源.</li>
<li><strong>规范化</strong>也是一种缓解过拟合的技术.效果是让网络倾向于学习<strong>小一点的权重</strong>,它是寻找小的权重和最小化原始代价函数之间的折中,相对重要性由λ控制.<ol>
<li><strong>L2规范化(权重衰减)</strong>的想法是增加一个额外的<strong>规范化项</strong>：$\frac{\lambda}{2 n} \sum_{w} w^{2}$到代价函数上.其中λ是<strong>规范化参数</strong>,注意规范化项里<strong>不包含偏置</strong>.</li>
<li><strong>L1规范化</strong>的规范化项为：$\frac{\lambda}{n} \sum_{w}|w|$在L1规范化中,权重通过一个常量<strong>向0</strong>进行缩小,在L2规范化中,权重通过一个和w成<strong>比例</strong>的量进行缩小.所以L1规范化倾向于<strong>聚集</strong>网络的权重在<strong>相对少量</strong>的高重要度连接上.</li>
</ol>
</li>
<li><strong>dropout</strong></li>
<li><strong>人为扩展训练数据</strong></li>
</ol>
<h4 id="调参"><a href="#调参" class="headerlink" title="调参"></a>调参</h4><ol>
<li><strong>学习速率η</strong></li>
<li><strong>早停</strong></li>
<li><strong>规范化参数λ</strong></li>
<li><strong>小批量数据大小</strong></li>
<li><strong>网格搜索(grid search)</strong></li>
</ol>
<h3 id="循环神经网络"><a href="#循环神经网络" class="headerlink" title="循环神经网络"></a>循环神经网络</h3><h4 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h4><p>对于前馈神经网络来说其公式：</p>
<script type="math/tex; mode=display">
O=f(W*X+b)</script><p>其中$W$和$b$是模型的参数，$X$是当前的输入，$f(·)$是激活函数，$*$是矩阵乘法，$O$是当前的输出。即输出等于输入经过线性与非线性映射后的结果。</p>
<p>而RNN通过将前一时刻的运算结果添加到当前的运算中，从而实现了“考虑上文信息”的功能。</p>
<script type="math/tex; mode=display">
\mathrm{O}_{\mathrm{t}}=\mathrm{f}\left(\mathrm{X} * \mathrm{W}+\mathrm{O}_{\mathrm{t}-1} * \mathrm{V}+\mathrm{b}\right)</script><p>其中$W,V,b$是模型的参数，下标$t$代表当前的序列位置／时间点，$t-1$代表上个位置/上个时间点，$X$是当前的输入，$f(·)$是激活函数，$*$是矩阵乘法，$O$是模型输出。</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/rnn.png" alt="avatar"></p>
<p>BiRnn:RNN可以考虑上文的信息，那么如何将下文的信息也添加进去呢？这就是BiRNN要做的事情。</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/birnn.png" alt="avatar"></p>
<h5 id="RNN存在的问题"><a href="#RNN存在的问题" class="headerlink" title="RNN存在的问题"></a>RNN存在的问题</h5><p>首先，从RNN的前向过程来看，可以认为它只有一层权重矩阵W（先不管V）。由此可见从深层的角度去看RNN的前向过程，就可以认为RNN是<strong>各个层的权重矩阵相同</strong>的深层网络。忽略V和激活函数，就可以近似的认为网络一共有T层（T等于序列的长度），那么第t层的输出就是连乘t次W，也就是$W^t$！,由于<strong>矩阵可以用它的特征值矩阵和特征向量矩阵去近似</strong>，即</p>
<script type="math/tex; mode=display">
W = V diag(\lambda) V^{-1}  \\
W^t = (V diag(\lambda) V^{-1})(V diag(\lambda) V^{-1})\cdots(V diag(\lambda) V^{-1})=V{ diag(\lambda)}^t V^{-1}</script><p>也就是说，<strong>特征值矩阵中的每个特征值都会随着t的增大发生指数级变化！</strong>所以某个特征值大于1时，就容易导致这个维度的值爆炸性增长；当特征值小于1时，会就会导致这个维度的值指数级速度衰减为0！</p>
<p>前向过程如此，误差反向传播的过程也必然近似为输出层的误差会乘以$W^t$来得到倒数第t层的梯度，然而由于刚各个维度不是指数级衰减就是指数级爆炸，很容易看出当更新RNN的靠前的层的时候（即离着输出层较远的那些层，或者说与序列末端离得远的位置），计算出的梯度要么大的吓人，要么小的忽略。小的忽略的值不会对W的更新有任何指导作用，大的吓人的值一下子就把W中的某些值弄的大的吓人了，害得前面的优化都白做了。</p>
<p>一个很简单的想法是进行<strong>梯度截断</strong>，在优化RNN的参数的时候，给梯度值设置一个上限。但是这样显然就会导致模型难以再顾及很靠前的历史信息了，因此理论上RNN可以保存任意长的历史信息来辅助当前时间点的决策，然而由于在优化时（训练RNN时），梯度无法准确合理的传到很靠前的时间点，因此RNN实际上只能记住并不长的序列信息（在NLP中，经验上认为序列大于30的时候，RNN基本记不住多于30的部分，而从多于10的位置开始就变得记性很差了），因此RNN相比前馈网络，可以记住的历史信息要长一些，但是无法记住长距离的信息（比如段落级的序列甚至篇章级的序列，用RNN就鸡肋了）。</p>
<h4 id="LSTM"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h4><p>因为RNN存在梯度弥散和梯度爆炸的问题，所以RNN很难完美地处理具有长期依赖的信息。既然仅仅依靠一条线连接后面的神经元不足以解决问题，那么就再加一条线好了，这就是LSTM。</p>
<p>LSTM的关键在于细胞的状态和穿过细胞的线，细胞状态类似于传送带。直接在整个链上运行，只有一些少量的线性交互。信息在上面流动保持不变会变得容易。</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/lstm_c.png" alt="avatar"></p>
<p>在LSTM中，门可以实现选择性的让信息通过，主要通过一个sigmoid的神经层和一个逐点相乘的操作来实现。LSTM通过三个这样的门结构来实现信息的保护和控制，分别是遗忘门（forget gate）、输入门（input gate）与输出门（output gate）。</p>
<h5 id="遗忘门"><a href="#遗忘门" class="headerlink" title="遗忘门"></a><strong>遗忘门</strong></h5><p>在LSTM中的第一步是决定从细胞状态中丢弃什么信息。这个决定通过一个称为遗忘门的结构来完成。遗忘门会读取$h_{t-1}$和$x_t$，输出一个0到1之间的数值给细胞的状态$c_{t-1}$中的数字。1表示完全保留，0表示完全舍弃。</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/lstm_forget_gate.png" alt="avatar"></p>
<h5 id="输入门"><a href="#输入门" class="headerlink" title="输入门"></a><strong>输入门</strong></h5><p>遗忘门决定让多少新的信息加入到cell的状态中来。实现这个需要两个步骤：</p>
<ol>
<li><p>首先一个叫“input gate layer”的sigmoid层决定哪些信息需要更新；一个tanh层生成一个向量，用来更新状态C。</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/input_gate.png" alt="avatar"></p>
</li>
<li><p>把 1 中的两部分联合起来，对cell的状态进行更新，我们把旧的状态与$f_t$相乘，丢弃掉我们确定需要丢弃的信息，接着加上$i_t * \tilde{C}_{t}$</p>
</li>
</ol>
<h5 id="输出门"><a href="#输出门" class="headerlink" title="输出门"></a>输出门</h5><p>最终，我们需要确定输出什么值，这个输出将会基于我们的细胞的状态，但是也是一个过滤后的版本。首先，我们通过一个sigmoid层来确定细胞状态的哪些部分将输出出去。接着，我们把细胞状态通过tanh进行处理（得到一个-1到1之间的值）并将它和sigmoid门的输出相乘，最终我们仅仅会输出我们确定输出的部分。</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/output_gate.png" alt="avatar"></p>
<h5 id="公式"><a href="#公式" class="headerlink" title="公式"></a>公式</h5><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/lstm_all.png" alt="avatar"></p>
<h4 id="GRU"><a href="#GRU" class="headerlink" title="GRU"></a>GRU</h4><p>在LSTM中引入了三个门函数：输入门、遗忘门和输出门来控制输入值、记忆值和输出值。而在GRU模型中只有两个门：分别是更新门和重置门。</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/GRU.png" alt="avatar"></p>
<p>图中的$z_t$和$r_t$分别表示更新门和重置门。更新门用于控制前一时刻的状态信息被带入到当前状态中的程度，更新门的值越大说明前一时刻的状态信息带入越多。重置门控制前一状态有多少信息被写入到当前的候选集 $\tilde{h}_{t}$上，重置门越小，前一状态的信息被写入的越少。</p>
<p>LSTM和GRU都是通过各种门函数来将重要特征保留下来，这样就保证了在long-term传播的时候也不会丢失。此外GRU相对于LSTM少了一个门函数，因此在参数的数量上也是要少于LSTM的，所以整体上GRU的训练速度要快于LSTM的。</p>
<h3 id="Self-Attention"><a href="#Self-Attention" class="headerlink" title="Self-Attention"></a>Self-Attention</h3><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention.png" alt="avatar"></p>
<p><strong>核心思想</strong>：在decoding阶段对input中的信息赋予不同权重。</p>
<ol>
<li>Encode所有输入序列,得到对应的$h_1,h_2, \cdots ,h_T$(T为输入序列长度)</li>
<li>Decode输出目标$y_t$之前，会将上一步输出的隐藏状态$S_{t-1}$与之前encode好的$h_1,h_2,\cdots,h_T$进行比对，计算相似度（$e_{t,j}=a(s_{t-1},h_j)$）,$h_j$为之前第j个输入encode得到的隐藏向量，a为任意一种计算相似度的方式</li>
<li>然后通过softmax，即$a_{t,j}=\frac{exp(e_{t,j})}{\sum^{T_x}_{k=1}exp(e_{t,k})}$将之前得到的各个部分的相关系数进行归一化，得到$a_{t,1},a_{t,2},\cdots,a_{t,T}$</li>
<li>在对输入序列的隐藏层进行相关性加权求和得到此时decode需要的context vector ：$c_j=\sum^{T_x}_{j=1}a_{i,j}h_j$</li>
</ol>
<h3 id="词向量模型"><a href="#词向量模型" class="headerlink" title="词向量模型"></a>词向量模型</h3><p>onehot编码方式的缺点：</p>
<ol>
<li>它是一个词袋模型，不考虑词与词之间的顺序（文本中词的顺序信息也是很重要的）</li>
<li>它假设词与词相互独立（在大多数情况下，词与词是相互影响的）</li>
<li>它得到的特征是离散稀疏的，实际应用中，面临着巨大的维度灾难问题</li>
</ol>
<p>将高维词向量嵌入到一个低维空间。word2vec是词嵌入方式的一种。</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/word_embedding.png" alt="avatar"></p>
<p>主要解决两个问题：</p>
<ol>
<li>一个是统计语言模型里关注的条件概率$𝑝(𝑤𝑡|𝑐𝑜𝑛𝑡𝑒𝑥𝑡)$的计算</li>
<li>一个是向量空间模型里关注的词向量的表达</li>
</ol>
<h4 id="word2vec"><a href="#word2vec" class="headerlink" title="word2vec"></a>word2vec</h4><h5 id="CBoW模型"><a href="#CBoW模型" class="headerlink" title="CBoW模型"></a><strong>CBoW模型</strong></h5><p>CBOW是已知上下文，估算当前词语的语言模型。其学习目标是最大化对数似然函数：</p>
<script type="math/tex; mode=display">
\mathcal{L}=\sum_{w \in \mathcal{C}} \log p(w | \text {Context}(w))</script><p>其中，w表示语料库C中任意一个词。</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/CBOW.png" alt="avatar"></p>
<ol>
<li><strong>输入层</strong>是上下文的词语的词向量（在训练CBOW模型，词向量只是个副产品，确切来说，是CBOW模型的一个参数。训练开始的时候，词向量是个随机值，随着训练的进行不断被更新）。</li>
<li><strong>投影层</strong>对其求和，所谓求和，就是简单的向量加法。</li>
<li><strong>输出层</strong>输出最可能的w。由于语料库中词汇量是固定的|C|个，所以上述过程其实可以看做一个多分类问题。给定特征，从|C|个分类中挑一个。</li>
</ol>
<p>对于神经网络模型多分类，最朴素的做法是softmax回归：</p>
<script type="math/tex; mode=display">
h_{\theta}\left(x^{(i)}\right)=\left[\begin{array}{c}
p\left(y^{(i)}=1 | x^{(i)} ; \theta\right) \\
p\left(y^{(i)}=2 | x^{(i)} ; \theta\right) \\
\vdots \\
p\left(y^{(i)}=k | x^{(i)} ; \theta\right)
\end{array}\right]=\frac{1}{\sum_{j=1}^{k} e^{\theta_{j}^{T} x^{(i)}}}\left[\begin{array}{c}
e^{\theta_{1}^{T} x^{(i)}} \\
e^{\theta_{2}^{T} x^{(i)}} \\
\vdots \\
e^{\theta_{k}^{T} x^{(i)}}
\end{array}\right]</script><h5 id="skip-gram模型"><a href="#skip-gram模型" class="headerlink" title="skip-gram模型"></a>skip-gram模型</h5><p><strong>target word对context的预测中学习word vector</strong></p>
<script type="math/tex; mode=display">
p(\text {Context}(w) | w)=\prod_{u \in \text {Context}(w)} p(u | w)</script><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/skipgram.png" alt="avatar"></p>
<p>如何将Skip-gram模型的前向计算过程写成数学形式，我们得到：</p>
<script type="math/tex; mode=display">
p\left(w_{o} | w_{i}\right)=\frac{e^{U_{o} \cdot V_{i}}}{\sum_{j} e^{U_{j} V_{i}}}</script><p>其中，其中，$V_i$是Embedding层矩阵里的列向量，也被称为$w_i$的input vector。$U_j$是softmax层矩阵里的行向量，也被称为$w_i$的output vector。因此，Skip-gram模型的本质是<strong>计算输入word的input vector与目标word的output vector之间的余弦相似度，并进行softmax归一化</strong>。我们要学习的模型参数正是这两类词向量。</p>
<p>然而，直接对词典里的V个词计算相似度并归一化，显然是一件极其耗时的impossible mission。引入了两种优化算法：<strong>层次Softmax（Hierarchical Softmax）</strong>和<strong>负采样（Negative Sampling）</strong>。</p>
<h5 id="Hierarchical-Softmax"><a href="#Hierarchical-Softmax" class="headerlink" title="Hierarchical Softmax"></a>Hierarchical Softmax</h5><p>softmax回归需要对语料库中每个词语（类）都计算一遍输出概率并进行归一化，在几十万词汇量的语料上无疑是令人头疼的。在SVM中的多分类，其多分类是由二分类组合而来的：</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/svm_hierarchical.gif" alt="avatar"></p>
<p>这是一种二叉树结构，应用到word2vec中被作者称为Hierarchical Softmax：</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/cbow_hierarchical.jpg" alt="avatar"></p>
<p>上图输出层的树形结构即为Hierarchical Softmax。非叶子节点相当于一个神经元（感知机，逻辑斯谛回归就是感知机的输出代入$f(x)=\frac{1}{1+e^x}$，二分类决策输出1或0，分别代表向下左转或向下右转；每个叶子节点代表语料库中的一个词语，于是每个词语都可以被01唯一地编码，并且其编码序列对应一个事件序列，于是我们可以计算条件概率$p(w|Context(x))$。</p>
<p>在开始计算之前，还是得引入一些符号：</p>
<ol>
<li>$p^w$从根结点出发到达w对应叶子结点的路径.</li>
<li>$l^w$路径中包含结点的个数</li>
<li>$p^w_1,p^w_2,\cdots,p^w_{l^w}$路径$p^w$中的各个节点</li>
<li>$d^w_2,d^w_3,\cdots,d^w_{l^w} \in {0,1}$词w的编码，$d^w_j$表示路径$p^w$第j个节点对应的编码（根节点无编码）</li>
<li>$\theta^w_1,\theta^w_2,\cdots,\theta^w_{l^w-1} \in R^m$路径$p^w$中非叶节点对应的参数向量</li>
</ol>
<p>于是可以给出$w$的条件概率：</p>
<script type="math/tex; mode=display">
p(w | \text { Context }(w))=\prod_{j=2}^{l^{w}} p\left(d_{j}^{w} | \mathbf{x}_{w}, \theta_{j-1}^{w}\right)</script><p>这是个简单明了的式子，从根节点到叶节点经过了$l^w-1$个节点，编码从下标2开始（根节点无编码），对应的参数向量下标从1开始（根节点为1）。其中，每一项是一个逻辑斯谛回归：</p>
<script type="math/tex; mode=display">
p\left(d_{j}^{w} | \mathbf{x}_{w}, \theta_{j-1}^{w}\right)=\left\{\begin{array}{ll}
\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right), & d_{j}^{w}=0 \\
1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right), & d_{j}^{w}=1
\end{array}\right.</script><p>考虑到d只有0和1两种取值，我们可以用指数形式方便地将其写到一起：</p>
<script type="math/tex; mode=display">
p\left(d_{j}^{w} | \mathbf{x}_{w}, \theta_{j-1}^{w}\right)=\left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]^{1-d^w_{j}} \cdot\left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]^{d^w_{j}}</script><p>我们的目标函数取对数似然：</p>
<script type="math/tex; mode=display">
\mathcal{L}=\sum_{w \in \mathcal{C}} \log p(w | \text { Context }(w))</script><p>将$p(w|Context(w))$代入上式，有</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathcal{L} &=\sum_{w \in \mathcal{C}} \log \prod_{j=2}^{l^{w}}\left\{\left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]^{1-d_{j}^{v}} \cdot\left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]^{d_{j}}\right\} \\
&=\sum_{w \in \mathcal{C}} \sum_{j=2}^{l^{w}}\left\{\left(1-d_{j}^{w}\right) \cdot \log \left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]+d_{j}^{w} \cdot \log \left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]\right\}
\end{aligned}</script><p>这也很直白，连乘的对数换成求和。不过还是有点长，我们把每一项简记为：</p>
<script type="math/tex; mode=display">
\mathcal{L}(w, j)=\left(1-d_{j}^{w}\right) \cdot \log \left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]+d_{j}^{w} \cdot \log \left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]</script><p>怎么最大化对数似然函数呢？分别最大化每一项即可（这应该是一种近似，最大化某一项不一定使整体增大，具体收敛的证明还不清楚）。怎么最大化每一项呢？先求函数对每个变量的偏导数，对每一个样本，代入偏导数表达式得到函数在该维度的增长梯度，然后让对应参数加上这个梯度，函数在这个维度上就增长了。</p>
<p>每一项有两个参数，一个是每个节点的参数向量$\theta^w_{j-1}$，另一个是输出层的输入$X_w$，我们分别对其求偏导数：</p>
<script type="math/tex; mode=display">
\frac{\partial \mathcal{L}(w, j)}{\partial \theta_{j-1}^{w}}=\frac{\partial}{\partial \theta_{j-1}^{w}}\left\{\left(1-d_{j}^{w}\right) \cdot \log \left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]+d_{j}^{w} \cdot \log \left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]\right\}</script><p>因为sigmoid函数的导数有个很棒的形式：</p>
<script type="math/tex; mode=display">
\sigma^{\prime}(x)=\sigma(x)[1-\sigma(x)]</script><p>于是代入上上式得到：</p>
<script type="math/tex; mode=display">
\left(1-d_{j}^{w}\right)\left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right] \mathbf{x}_{w}-d_{j}^{w} \sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right) \mathbf{x}_{w}</script><p>合并同类项得到：</p>
<script type="math/tex; mode=display">
\left[1-d_{j}^{w}-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right] \mathbf{x}_{w}</script><p>于是$\theta^w_{j-1}$的更新表达式就得到了：</p>
<script type="math/tex; mode=display">
\theta_{j-1}^{w}:=\theta_{j-1}^{w}+\eta\left[1-d_{j}^{w}-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right] \mathbf{x}_{w}</script><p>再来$X_w$的偏导数，注意到$\mathcal{L}(w, j)=\left(1-d_{j}^{w}\right) \cdot \log \left[\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]+d_{j}^{w} \cdot \log \left[1-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right]$中$X_w$和$\theta^w_{j-1}$是对称的，所有直接将$\theta^w_{j-1}$的偏导数中的$\theta^w_{j-1}$替换为$X_w$，得到关于$X_w$的偏导数：</p>
<script type="math/tex; mode=display">
\frac{\partial \mathcal{L}(w, j)}{\partial \mathbf{x}_{w}}=\left[1-d_{j}^{w}-\sigma\left(\mathbf{x}_{w}^{\top} \theta_{j-1}^{w}\right)\right] \theta_{j-1}^{w}</script><p>不过$X_w$是上下文的词向量的和，不是上下文单个词的词向量。怎么把这个更新量应用到单个词的词向量上去呢？word2vec采取的是直接将$X_w$的更新量整个应用到每个单词的词向量上去：</p>
<script type="math/tex; mode=display">
\mathbf{v}(\tilde{w}):=\mathbf{v}(\tilde{w})+\eta \sum_{j=2}^{l^{w}} \frac{\partial \mathcal{L}(w, j)}{\partial \mathbf{x}_{w}}, \quad \tilde{w} \in \text { Context }(w)</script><p>其中，$V(\tilde w)$代表上下文中某一个单词的词向量。</p>
<h4 id="glove"><a href="#glove" class="headerlink" title="glove"></a>glove</h4><p>CBOW和skip-gram虽然可以很好地进行词汇类比，但是因为这两种方法是基于一个个局部的上下文窗口方法，因此，没有有效地利用全局的词汇共现统计信息。为了克服全局矩阵分解和局部上下文窗口的缺陷，GloVe方法基于全局词汇共现的统计信息来学习词向量，从而将统计信息与局部上下文窗口方法的优点都结合起来，并发现其效果确实得到了提升。</p>
<h5 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h5><p>假设i=ice,j=steam并对k取不同的词汇，如“solid”，“gas”，“water”，“fashion”，根据上面的定义，我们分别计算他们的概率$P(k∣ice)$、$P(k∣steam)$，并计算两者的比率$P(k∣ice)/P(k∣steam)$，可以发现，对于“solid”，其出现在“ice”上下文的概率应该比较大，出现在“steam”上下文的概率应该比较小，因此，他们的比值应该是一个比较大的数，在下表中是8.9，而对于“gas”，出现在“ice”上下文的概率应该比较小，而出现在“steam”上下文的概率应该比较大，因此，两者的比值应该是一个比较小的数，在下表中是$8.5×10^{-2}$ ，而对于“water、fashion”这两个词汇，他们与“ice”和steam“的相关性应该比较小，因此，他们的比值应该都是接近1。因此，这样来看可以发现，比值$P(k∣ice)/P(k∣steam)$在一定程度上可以反映词汇之间的相关性，当相关性比较低时，其值应该在1附近，当相关性比较高时，比值应该偏离1比较远。<br><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/glove.png" alt="avatar"></p>
<h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>基于这样的思想，作者提出了这样一种猜想，能不能通过训练词向量，使得词向量经过某种函数计算之后可以得到上面的比值，具体如下：</p>
<script type="math/tex; mode=display">
F\left(w_{i}, w_{j}, \tilde{w}_{k}\right)=\frac{P_{i k}}{P_{j k}}</script><p>其中，$w_i$,$w_j$,$\tilde{w}_{k}$ 为词汇i,j,k对应的词向量，其维度都为d，而$P_{ik}$，$P_{jk}$ 则可以直接通过语料计算得到，这里F为一个未知的函数。由于词向量都是在一个线性向量空间，因此，可以对$w_i$,$w_j$进行差分，将上式转变为如下：</p>
<script type="math/tex; mode=display">
F\left(w_{i}-w_{j}, \tilde{w}_{k}\right)=\frac{P_{i k}}{P_{j k}}</script><p>由于上式中左侧括号中是两个维度为d的词向量，而右侧是一个标量，因此，很容易会想到向量的内积，因此，上式可以进一步改变为:</p>
<script type="math/tex; mode=display">
F\left(\left(w_{i}-w_{j}\right)^{T} \tilde{w}_{k}\right)=F\left(w_{i}^{T} w_{k}-w_{j}^{T} w_{k}\right)=\frac{P_{i k}}{P_{j k}}</script><p>由于上式中左侧是一种减法，而右侧是一种除法，很容易联想到指数计算，因此，可以把F限定为指数函数，此时有：</p>
<script type="math/tex; mode=display">
\exp \left(w_{i}^{T} w_{k}-w_{j}^{T} w_{k}\right)=\frac{\exp \left(w_{i}^{T} w_{k}\right)}{\exp \left(w_{j}^{T} w_{k}\right)}=\frac{P_{i k}}{P_{j k}}</script><p>因此，此时只要确保等式两边分子分母相等即可，即：</p>
<script type="math/tex; mode=display">
\exp \left(w_{i}^{T} w_{k}\right)=P_{i k}, \exp \left(w_{j}^{T} w_{k}\right)=P_{j k}</script><p>进一步的，可以转化为对语料中的所有词汇，考察$exp(w^T_iw_k)$=$P_{ik}$=$\frac{X_{ik}}{X_i}$ ，即：</p>
<script type="math/tex; mode=display">
w_{i}^{T} w_{k}=\log \left(\frac{X_{i k}}{X_{i}}\right)=\log X_{i k}-\log X_{i}</script><p>由于上式左侧$w^T_iw_k$中，调换i和k的值不会改变其结果，即具有对称性，因此，为了确保等式右侧也具备对称性，引入了两个偏置项，即</p>
<script type="math/tex; mode=display">
w_{i}^{T} w_{k}=\log X_{i k}-b_{i}-b_{k}</script><p>此时，$logX_i$已经包含在$bi$当中。因此，此时模型的目标就转化为通过学习词向量的表示，使得上式两边尽量接近，因此，可以通过计算两者之间的平方差来作为目标函数，即：</p>
<script type="math/tex; mode=display">
J=\sum_{i, k=1}^{V}\left(w_{i}^{T} \tilde{w}_{k}+b_{i}+b_{k}-\log X_{i k}\right)^{2}</script><p>但是这样的目标函数有一个缺点，就是对所有的共现词汇都是采用同样的权重，因此，作者对目标函数进行了进一步的修正，通过语料中的词汇共现统计信息来改变他们在目标函数中的权重，具体如下：</p>
<script type="math/tex; mode=display">
J=\sum_{i, k=1}^{V} f\left(X_{i k}\right)\left(w_{i}^{T} \tilde{w}_{k}+b_{i}+b_{k}-\log X_{i k}\right)^{2}</script><p>这里$V$表示词汇的数量，并且权重函数$f$必须具备以下的特性</p>
<ul>
<li>$f(0)=0$，当词汇共现的次数为0时，此时对应的权重应该为0。</li>
<li>f(x)必须是一个非减函数，这样才能保证当词汇共现的次数越大时，其权重不会出现下降的情况。</li>
<li>对于那些太频繁的词，$f(x)$应该能给予他们一个相对小的数值，这样才不会出现过度加权。</li>
</ul>
<p>综合以上三点特性，作者提出了下面的权重函数：</p>
<script type="math/tex; mode=display">
f(x)=\left\{\begin{array}{cc}
\left(x / x_{\max }\right)^{\alpha} & \text { if } x<x_{\max } \\
1 & \text { otherwise }
\end{array}\right.</script><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><ol>
<li>Glove综合了全局词汇共现的统计信息和局部窗口上下文方法的优点，可以说是两个主流方法的一种综合，但是相比于全局矩阵分解方法，由于GloVe不需要计算那些共现次数为0的词汇，因此，可以极大的减少计算量和数据的存储空间。</li>
<li>但是GloVe把语料中的词频共现次数作为词向量学习逼近的目标，当语料比较少时，有些词汇共现的次数可能比较少，笔者觉得可能会出现一种误导词向量训练方向的现象。</li>
</ol>
<h4 id="ELMO"><a href="#ELMO" class="headerlink" title="ELMO"></a>ELMO</h4><h5 id="针对的问题"><a href="#针对的问题" class="headerlink" title="针对的问题"></a>针对的问题</h5><p>word2vec中，只有apple一个词向量，无法对一词多义进行建模。</p>
<h5 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h5><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/EMLO.png" alt="avatar"></p>
<p>ELMo的主要做法是先训练一个完整的语言模型，再用这个语言模型去处理需要训练的文本，生成相应的词向量，所以在文中一直强调ELMo的模型对同一个字在不同句子中能生成不同的词向量。</p>
<p>在进行有监督的NLP任务时，可以将ELMo直接当做特征拼接到具体任务模型的词向量输入或者是模型的最高层表示上。不像传统的词向量，每一个词只对应一个词向量，ELMo利用预训练好的双向语言模型，然后根据具体输入从该语言模型中可以得到上下文依赖的当前词表示（<strong>对于不同上下文的同一个词的表示是不一样的</strong>），再当成特征加入到具体的NLP有监督模型里。</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/emlo_embedding.png" alt="avatar"></p>
<p>EMLO使用的是一个<strong>双向的LSTM语言模型</strong>，由一个前向和一个后向语言模型构成，目标函数就是取这两个方向语言模型的最大似然。</p>
<p>前向LSTM结构：</p>
<script type="math/tex; mode=display">
p\left(t_{1}, t_{2}, \ldots, t_{N}\right)=\prod_{k=1}^{N} p\left(t_{k} | t_{1}, t_{2}, \ldots, t_{k-1}\right)</script><p>反向LSTM结构：</p>
<script type="math/tex; mode=display">
p\left(t_{1}, t_{2}, \ldots, t_{N}\right)=\prod_{k=1}^{N} p\left(t_{k} | t_{k+1}, t_{k+2}, \ldots, t_{N}\right)</script><p>最大似然函数：</p>
<script type="math/tex; mode=display">
\sum_{k=1}^{N}\left(\log p\left(t_{k} | t_{1}, t_{2}, \ldots, t_{k-1}\right)+\log p\left(t_{k} | t_{k+1}, t_{k+2}, \ldots, t_{N}\right)\right)</script><h5 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h5><ol>
<li>ELMo的假设前提一个词的词向量不应该是固定的，所以在一词多意方面ELMo的效果一定比word2vec要好。</li>
<li>word2vec的学习词向量的过程是通过中心词的上下窗口去学习，学习的范围太小了，而ELMo在学习语言模型的时候是从整个语料库去学习的，而后再通过语言模型生成的词向量就相当于基于整个语料库学习的词向量，更加准确代表一个词的意思。</li>
</ol>
<h4 id="GPT"><a href="#GPT" class="headerlink" title="GPT"></a>GPT</h4><p>用Transformer网络代替了LSTM作为语言模型来更好的捕获长距离语言结构。</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/gpt_1.png" alt="avatar"></p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/gpt_2.png" alt="avatar"></p>
<h5 id="Masked-Attention"><a href="#Masked-Attention" class="headerlink" title="Masked Attention"></a>Masked Attention</h5><p>在transformer中，Encoder因为要编码整个句子，所以每个词都需要考虑上下文的关系。所以每个词在计算的过程中都是可以看到句子中所有的词的。但是Decoder与Seq2Seq中的解码器类似，每个词都只能看到前面词的状态，所以是一个单向的Self-Attention结构。Masked Attention的实现也非常简单，只要在普通的Self Attention的Softmax步骤之前，与按位乘上一个下三角矩阵M就好了</p>
<p>attention：</p>
<script type="math/tex; mode=display">
\begin{aligned}
Q &=X W_{Q} \\
K &=X W_{K} \\
V &=X W_{V} \\
\text {Attention}(Q, K, V) &=\operatorname{Softmax}\left(\frac{Q K^{T}}{\sqrt{d_{k}}}\right) V
\end{aligned}</script><p>masked-attention</p>
<script type="math/tex; mode=display">
\text { Attention }(Q, K, V)=\operatorname{Softmax}\left(\frac{Q K^{T} \Theta M}{\sqrt{d_{k}}}\right) V</script><h4 id="BERT"><a href="#BERT" class="headerlink" title="BERT"></a>BERT</h4><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/bert_gpt_elmo.png" alt="avatar"></p>
<h5 id="Task-1-MLM"><a href="#Task-1-MLM" class="headerlink" title="Task 1: MLM"></a>Task 1: MLM</h5><p>由于BERT需要通过上下文信息，来预测中心词的信息，同时又不希望模型提前看见中心词的信息，因此提出了一种 Masked Language Model 的预训练方式，即随机从输入预料上 mask 掉一些单词，然后通过的上下文预测该单词，类似于一个完形填空任务。</p>
<p>在预训练任务中，15%的 Word Piece 会被mask，这15%的 Word Piece 中，80%的时候会直接替换为 [Mask] ，10%的时候将其替换为其它任意单词，10%的时候会保留原始Token</p>
<ul>
<li>没有100%mask的原因<ul>
<li>如果句子中的某个Token100%都会被mask掉，那么在fine-tuning的时候模型就会有一些没有见过的单词</li>
</ul>
</li>
<li>加入10%随机token的原因<ul>
<li>Transformer要保持对每个输入token的分布式表征，否则模型就会记住这个[mask]是token ’hairy‘</li>
<li>另外编码器不知道哪些词需要预测的，哪些词是错误的，因此被迫需要学习每一个token的表示向量</li>
</ul>
</li>
<li>另外，每个batchsize只有15%的单词被mask的原因，是因为性能开销的问题，双向编码器比单项编码器训练要更慢</li>
</ul>
<h5 id="Task-2-NSP"><a href="#Task-2-NSP" class="headerlink" title="Task 2: NSP"></a>Task 2: NSP</h5><p>仅仅一个MLM任务是不足以让 BERT 解决阅读理解等句子关系判断任务的，因此添加了额外的一个预训练任务，即 Next Sequence Prediction。</p>
<p>具体任务即为一个句子关系判断任务，即判断句子B是否是句子A的下文，如果是的话输出’IsNext‘，否则输出’NotNext‘。</p>
<p>训练数据的生成方式是从平行语料中随机抽取的连续两句话，其中50%保留抽取的两句话，它们符合IsNext关系，另外50%的第二句话是随机从预料中提取的，它们的关系是NotNext的。这个关系保存在图4中的[CLS]符号中</p>
<h5 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h5><ul>
<li>Token Embeddings：即传统的词向量层，每个输入样本的首字符需要设置为[CLS]，可以用于之后的分类任务，若有两个不同的句子，需要用[SEP]分隔，且最后一个字符需要用[SEP]表示终止</li>
<li>Segment Embeddings：为[0,1]序列，用来在NSP任务中区别两个句子，便于做句子关系判断任务</li>
<li>Position Embeddings：与Transformer中的位置向量不同，BERT中的位置向量是直接训练出来的</li>
</ul>
<h5 id="Fine-tunninng"><a href="#Fine-tunninng" class="headerlink" title="Fine-tunninng"></a>Fine-tunninng</h5><p>对于不同的下游任务，我们仅需要对BERT不同位置的输出进行处理即可，或者直接将BERT不同位置的输出直接输入到下游模型当中。具体的如下所示：</p>
<ul>
<li>对于情感分析等单句分类任务，可以直接输入单个句子（不需要[SEP]分隔双句），将[CLS]的输出直接输入到分类器进行分类</li>
<li>对于句子对任务（句子关系判断任务），需要用[SEP]分隔两个句子输入到模型中，然后同样仅须将[CLS]的输出送到分类器进行分类</li>
<li>对于问答任务，将问题与答案拼接输入到BERT模型中，然后将答案位置的输出向量进行二分类并在句子方向上进行softmax（只需预测开始和结束位置即可）</li>
<li>对于命名实体识别任务，对每个位置的输出进行分类即可，如果将每个位置的输出作为特征输入到CRF将取得更好的效果。</li>
</ul>
<h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><ul>
<li>BERT的预训练任务MLM使得能够借助上下文对序列进行编码，但同时也使得其预训练过程与中的数据与微调的数据不匹配，难以适应生成式任务</li>
<li>另外，BERT没有考虑预测[MASK]之间的相关性，是对语言模型联合概率的有偏估计</li>
<li>由于最大输入长度的限制，适合句子和段落级别的任务，不适用于文档级别的任务（如长文本分类）</li>
<li>适合处理自然语义理解类任务(NLU)，而不适合自然语言生成类任务(NLG)</li>
</ul>
<h5 id="torch使用"><a href="#torch使用" class="headerlink" title="torch使用"></a>torch使用</h5><ol>
<li>导入相关库</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> transformers <span class="keyword">as</span> ppb <span class="comment"># pytorch transformers</span></span><br></pre></td></tr></table></figure>
<ol>
<li>导入预训练好的 DistilBERT 模型与分词器</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">model_class, tokenizer_class, pretrained_weights = (ppb.DistilBertModel, ppb.DistilBertTokenizer, <span class="string">'distilbert-base-uncased'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Want BERT instead of distilBERT? Uncomment the following line:</span></span><br><span class="line"><span class="comment">#model_class, tokenizer_class, pretrained_weights = (ppb.BertModel, ppb.BertTokenizer, 'bert-base-uncased')# </span></span><br><span class="line"></span><br><span class="line">Load pretrained model/tokenizertokenizer = tokenizer_class.from_pretrained(pretrained_weights)</span><br><span class="line">model = model_class.from_pretrained(pretrained_weights)</span><br></pre></td></tr></table></figure>
<ol>
<li>tokenize：分词+[cls]+[sep]<br><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/bert_tokenize.png" alt="avatar"></li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tokenizer.encode(<span class="string">"a visually stunning rumination on love"</span>, add_special_tokens=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>padding</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">   max_len = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tokenized.values:</span><br><span class="line">    <span class="keyword">if</span> len(i) &gt; max_len:</span><br><span class="line">        max_len = len(i)</span><br><span class="line">padded = np.array([i + [<span class="number">0</span>]*(max_len-len(i)) <span class="keyword">for</span> i <span class="keyword">in</span> tokenized.values])</span><br></pre></td></tr></table></figure>
<ol>
<li>masking</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">attention_mask = np.where(padded != <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>使用bert进行编码</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    <span class="comment"># last_hidden_states = [batch_size, max_sentence_len, 768]</span></span><br><span class="line">    last_hidden_states = model(input_ids, attention_mask=attention_mask)</span><br></pre></td></tr></table></figure>
<h3 id="transformer"><a href="#transformer" class="headerlink" title="transformer"></a>transformer</h3><p>无论是RNN还是CNN，在处理NLP任务时都有缺陷。CNN是其先天的卷积操作不很适合序列化的文本，RNN是其没有并行化，很容易超出内存限制（比如50tokens长度的句子就会占据很大的内存）。</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/transformer.png" alt="avatar"></p>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><ol>
<li>如何实现并行计算同时缩短依赖距离？采用自注意机制</li>
<li>如何向CNN一样考虑多通道信息？采用多头注意力</li>
<li>自注意力机制损失了位置信息，如何补偿? 位置嵌入</li>
<li>后面的层中位置信息消散？ 残差连接</li>
</ol>
<h4 id="self-attention"><a href="#self-attention" class="headerlink" title="self-attention"></a>self-attention</h4><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention-1.png" alt="avatar"></p>
<h5 id="并行化"><a href="#并行化" class="headerlink" title="并行化"></a>并行化</h5><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention-2.png" alt="avatar" style="zoom:67%;"></p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention-3.png" alt="avatar" style="zoom: 67%;"></p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/self-attention-4.png" alt="avatar" style="zoom: 67%;"></p>
<h5 id="multi-head-self-attention"><a href="#multi-head-self-attention" class="headerlink" title="multi-head self-attention"></a>multi-head self-attention</h5><p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/multi-head.png" alt="avatar" style="zoom:67%;"></p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/multi-head-1.png" alt="avatar"></p>
<h4 id="encoder"><a href="#encoder" class="headerlink" title="encoder"></a>encoder</h4><p>Encoder由N=6个相同的layer组成，layer指的就是上图左侧的单元，最左边有个“Nx”，这里是x6个。每个Layer由两个sub-layer组成，分别是multi-head self-attention mechanism和fully connected feed-forward network。其中每个sub-layer都加了residual connection和normalisation，因此可以将sub-layer的输出表示为：</p>
<script type="math/tex; mode=display">
sub_layer_output=LayerNorm(x+(\text {SubLayer}(x)))</script><h5 id="Multi-head-self-attention"><a href="#Multi-head-self-attention" class="headerlink" title="Multi-head self-attention"></a>Multi-head self-attention</h5><p>由于attention：</p>
<script type="math/tex; mode=display">
attention_output=Attention(Q, K, V)</script><p>multi-head attention则是通过h个不同的<strong>线性变换</strong>对Q，K，V进行投影，最后将不同的attention结果拼接起来：</p>
<script type="math/tex; mode=display">
\begin{array}{l}\text { MultiHead(Q,K,V)}= Concat(head_1,\ldots,head_h)W^{O}  \\ head_i = Attention(QW_i\left.^{Q}, K W_{i}^{K}, V W_{i}^{V}\right) \\ \text { Attention }(Q, K, V)=\operatorname{softmax}\left(\frac{Q K^{T}}{\sqrt{d_{k}}}\right) V\end{array}</script><p>多个head带来的优势是：不同的head，所attention的内容不同，比如：$head_1$ attention 全局的内容，$head_2$ attention local的内容。</p>
<h5 id="Position-wise-feed-forward-networks"><a href="#Position-wise-feed-forward-networks" class="headerlink" title="Position-wise feed-forward networks"></a>Position-wise feed-forward networks</h5><p>这层主要是提供非线性变换。Attention输出的维度是[bsz<em>seq_len, num_heads</em>head_size]，第二个sub-layer是个全连接层，之所以是position-wise是因为过线性层时每个位置i的变换参数是一样的.</p>
<h4 id="Decoder"><a href="#Decoder" class="headerlink" title="Decoder"></a><strong>Decoder</strong></h4><p>Decoder和Encoder的结构差不多，但是多了一个attention的sub-layer,decoder的输入输出和解码过程:</p>
<ul>
<li>输出：对应i位置的输出词的概率分布</li>
<li>输入：encoder的输出 &amp; 对应i-1位置decoder的输出。所以中间的attention不是self-attention，它的K，V来自encoder，Q来自上一位置decoder的输出</li>
<li>解码：<strong>编码可以并行计算，一次性全部encoding出来，但解码不是一次把所有序列解出来的，而是像rnn一样一个一个解出来的</strong>，因为要用上一个位置的输入当作attention的query</li>
</ul>
<h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><ol>
<li><p>不能一次对很长文本进行建模（假如文本长度为$10^5$,在一个forward的模块中需要$10^5 * 10^5 = 10^{10}$大小的矩阵来保存score，很容易导致 out of memory 问题）。解决方法：divide long sequence into smaller sequence. 但是这样导致smaller sequence 之间是没有联系的。（使用rnn的方式来建立smaller sequence 之间的联系—&gt; transformer XL）</p>
<p><img src="/2020/03/10/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/transformer-xl.png" alt="avatar"></p>
<p>在引入rnn的时候，遇到了absolute position的问题，用relative position进行了解决。</p>
</li>
</ol>
<h5 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h5><p>引入Self Attention后会更容易捕获句子中长距离的相互依赖的特征，因为如果是RNN或者LSTM，需要依次序序列计算，对于远距离的相互依赖的特征，要经过若干时间步步骤的信息累积才能将两者联系起来，而距离越远，有效捕获的可能性越小。</p>
<p>但是Self Attention在计算过程中会直接将句子中任意两个单词的联系通过一个计算步骤直接联系起来，所以远距离依赖特征之间的距离被极大缩短，有利于有效地利用这些特征。除此外，Self Attention对于增加计算的并行性也有直接帮助作用。这是为何Self Attention逐渐被广泛使用的主要原因。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwNzc2NTk0NQ==&amp;mid=2247484682&amp;idx=1&amp;sn=51520138eed826ec891ac8154ee550f9&amp;chksm=970c2ddca07ba4ca33ee14542cff0457601bb16236f8edc1ff0e617051d1f063354dda0f8893&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">从前馈到反馈：解析循环神经网络（RNN）及其tricks</a></li>
<li><a href="https://www.jiqizhixin.com/articles/2018-07-06-7" target="_blank" rel="noopener">Step-by-step to LSTM: 解析LSTM神经网络设计原理</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/43493999" target="_blank" rel="noopener">Attention原理和源码解析</a></li>
<li><a href="https://www.jiqizhixin.com/articles/2019-12-28?from=synced&amp;keyword=bert" target="_blank" rel="noopener">BERT模型超酷炫，上手又太难？请查收这份BERT快速入门指南！</a></li>
</ol>
]]></content>
      <categories>
        <category>深度学习</category>
      </categories>
      <tags>
        <tag>深度学习</tag>
        <tag>自然语言处理</tag>
      </tags>
  </entry>
  <entry>
    <title>机器学习大总结</title>
    <url>/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="机器学习大总结"><a href="#机器学习大总结" class="headerlink" title="机器学习大总结"></a>机器学习大总结</h2><h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><h4 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a><strong>进程和线程</strong></h4><p>进程和线程都是一个时间段的描述，是CPU工作时间段的描述，不过是颗粒大小不同.进程就是包换上下文切换的程序执行时间总和 = CPU加载上下文+CPU执行+CPU保存上下文.线程是共享了进程的上下文环境的更为细小的CPU时间段。</p>
<h4 id="判别式模型和生成式模型"><a href="#判别式模型和生成式模型" class="headerlink" title="判别式模型和生成式模型:"></a><strong>判别式模型和生成式模型</strong>:</h4><ol>
<li>判别式模型直接学习决策函数$f(X)$或条件概率分布$P(Y|X)$作为预测的模型.往往准确率更高,并且可以简化学习问题.<ol>
<li>k近邻法、感知机、决策树、最大熵模型、Logistic回归、线性判别分析(LDA)、支持向量机(SVM)、Boosting、CRF、线性回归、神经网络</li>
</ol>
</li>
<li>生成式模型由数据学习<strong>联合概率分布P(X,Y)</strong>,然后由P(Y|X)=P(X,Y)/P(X)求出条件概率分布作为预测的模型,即生成模型.当存在隐变量时只能用生成方法学习.<ol>
<li>混合高斯模型和其他混合模型、隐马尔可夫模型(HMM)、朴素贝叶斯、依赖贝叶斯(AODE)、LDA文档主题生成模型</li>
</ol>
</li>
</ol>
<a id="more"></a>
<h4 id="概率质量函数-概率密度函数-累积分布函数"><a href="#概率质量函数-概率密度函数-累积分布函数" class="headerlink" title="概率质量函数,概率密度函数,累积分布函数:"></a><strong>概率质量函数,概率密度函数,累积分布函数</strong>:</h4><ol>
<li>概率质量函数 (probability mass function，PMF)是离散随机变量在各特定取值上的概率。</li>
<li>概率密度函数（probability density function，PDF)是对 连续随机变量 定义的，本身不是概率，只有对连续随机变量的取值进行积分后才是概率。</li>
<li><p>累积分布函数（cumulative distribution function，CDF)能完整描述一个实数随机变量X的概率分布，是概率密度函数的积分。对於所有实数x ，与pdf相对。</p>
<h4 id="极大似然估计"><a href="#极大似然估计" class="headerlink" title="极大似然估计"></a><strong>极大似然估计</strong></h4></li>
</ol>
<p>已知某个参数能使这个样本出现的概率最大，我们当然不会再去选择其他小概率的样本，所以干脆就把这个参数作为估计的真实值。</p>
<h4 id="最小二乘法"><a href="#最小二乘法" class="headerlink" title="最小二乘法"></a>最小二乘法</h4><p>二乘的英文是least square,找一个（组）估计值,使得实际值与估计值之差的平方加总之后的值最小$Q=\min \sum_{i}^{n}\left(y_{i e}-y_{i}\right)^{2}$.求解方式是对参数求偏导,令偏导为0即可.样本量小时速度快.</p>
<h4 id="梯度下降法"><a href="#梯度下降法" class="headerlink" title="梯度下降法"></a><strong>梯度下降法</strong></h4><p>负梯度方向是函数值下降最快的方向,每次更新值都等于原值加学习率(<strong>步长</strong>)乘损失函数的<strong>梯度</strong>.每次都试一个步长看会不会下降一定的程度,如果没有的话就按比例减小步长.不断应用参数更新公式直到收敛,可以得到局部最小值.初始值的不同组合可以得到不同局部最小值.在最优点时会有震荡.</p>
<ol>
<li><p><strong>批量梯度下降(BGD)</strong>:每次都使用所有的m个样本来更新,容易找到全局最优解,但是m较大时速度较慢。$\theta_{j}^{\prime}=\theta_{j}+\frac{1}{m} \sum_{i=1}^{m}\left(y^{i}-h_{\theta}\left(x^{i}\right)\right) x_{j}^{i}$</p>
</li>
<li><p><strong>随机梯度下降(SGD)</strong>：每次只使用一个样本来更新,训练速度快,但是噪音较多,不容易找到全局最优解,以损失很小的一部分精确度和增加一定数量的迭代次数为代价,换取了总体的优化效率的提升.注意控制步长缩小,减少震荡.</p>
</li>
</ol>
<script type="math/tex; mode=display">
\theta_{j}=\theta_{j}+\left(y^{i}-h_{\theta}\left(x^{i}\right)\right) x_{j}^{i}</script><ol>
<li><strong>小批量梯度下降(MBGD)</strong>:每次使用一部分样本来更新.</li>
</ol>
<h4 id="牛顿法"><a href="#牛顿法" class="headerlink" title="牛顿法"></a><strong>牛顿法</strong></h4><p>牛顿法是<strong>二次收敛</strong>,因此收敛速度快.从几何上看是每次用一个二次曲面来拟合当前所处位置的局部曲面,而梯度下降法是用一个平面来拟合.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/newton.png" alt="avatar"></p>
<ol>
<li><strong>黑塞矩阵</strong>是由目标函数f(x)在点X处的二阶偏导数组成的n*n阶对称矩阵。</li>
<li><strong>牛顿法</strong>:将f(x)在x(k)附近进行<strong>二阶泰勒展开</strong>:$f(x)=f\left(x^{(k)}\right)+g_{k}^{\top}\left(x-x^{(k)}\right)+\frac{1}{2}\left(x-x^{(k)}\right)^{\mathrm{T}} H\left(x^{(k)}\right)\left(x-x^{(k)}\right)$。其中$g_k$是$f(x)$的梯度向量在$x^{(k)}$的值,$H(x^{(k)})$是$f(x)$的黑塞矩阵在点$x^k$的值.牛顿法利用极小点的必要条件$f(x)$处的梯度为0,每次迭代中从点$x^{(k)}$开始,假设$\nabla f\left(x^{(k+1)}\right)=0$，对二阶泰勒展开求偏导有 $\nabla f(x)=g_{k}+H_{k}\left(x-x^{(k)}\right)$，代入得到$g_{k}+H_{k}\left(x^{(k+1)}-x^{(k)}\right)=0$,即$\quad x^{(k+1)}=x^{(k)}-H_{k}^{-1} g_{k}$,以此为迭代公式就是牛顿法.</li>
</ol>
<h4 id="拟牛顿法"><a href="#拟牛顿法" class="headerlink" title="拟牛顿法"></a>拟牛顿法</h4><p>用一个<strong>n阶正定矩阵Gk</strong>=G(x(k))来<strong>近似代替</strong>黑塞矩阵的<strong>逆矩阵</strong>就是拟牛顿法的基本思想.在牛顿法中黑塞矩阵满足的条件如下:$g_{k+1}-g_{k}=H_{k}\left(x^{(k+1)}-x^{(k)}\right)$,令$ {y_{k}}=g_{k+1}-g_{k}, \quad \delta_{k}=x^{(k+1)}-x^{(k)}$，则有  $ H_{k}^{-1} y_{k}=\delta_{k}$,称为拟牛顿条件.</p>
<ol>
<li><strong>DFP算法</strong>:假设每一步$G_{k+1}=G_{k}+P_{k}+Q_{k}$，为使$G_{k+1}$满足拟牛顿条件,可使$P_k$和$Q_k$满足$P_{k} y_{k}=\delta_{k}, Q_{k} y_{k}=-G_{k} y_{k}$,例如取$P_{k}=\frac{\delta_{k} \delta_{k}^{\tau}}{\delta_{k}^{\top} y_{k}} \quad Q_{k}=-\frac{G_{k} y_{k} y_{k}^{\top} G_{k}}{y_{k}^{\top} G_{k} y_{k}}$，就得到迭代公式$G_{k+1}=G_{k}+\frac{\delta_{k} \delta_{k}^{\top}}{\delta_{k}^{\tau} y_{k}}-\frac{G_{k} y_{k} y_{k}^{\top} G_{k}}{y_{k}^{T} G_{k} y_{k}}$</li>
<li><strong>BFGS算法</strong>: 最流行的拟牛顿算法.它用$B_k$逼近黑塞矩阵,此时相应的拟牛顿条件是$B_{k+1} \delta_{k}=y_{k}$,假设每一步$B_{k+1}=B_{k}+P_{k}+Q_{k}$，则 $P_k$ 和 $Q_k$ 满足$P_{k} \delta_{k}=y_{k}, \quad Q_{k} \delta_{k}=-B_{k} \delta_{k}$，类似得到迭代公式$B_{k+1}=B_{k}+\frac{y_{k} y_{k}^{\top}}{y_{k}^{\top} \delta_{k}}-\frac{B_{k} \delta_{k} \delta_{k}^{\mathrm{T}} B_{k}}{\delta_{k}^{\top} B_{k} \delta_{k}}$</li>
</ol>
<h4 id="先验概率和后验概率"><a href="#先验概率和后验概率" class="headerlink" title="先验概率和后验概率"></a><strong>先验概率和后验概率</strong></h4><ol>
<li>先验概率就是事情发生前的预测概率.</li>
<li>后验概率是一种条件概率，它限定了事件为隐变量取值，而条件为观测结果。一般的条件概率，条件和事件可以是任意的.</li>
<li>贝叶斯公式$P(y|x) = ( P(x|y) * P(y) ) / P(x)$中,$P(y|x)$是后验概率,$P(x|y)$是条件概率,$P(y)$是先验概率.</li>
</ol>
<h4 id="偏差-方差-噪声"><a href="#偏差-方差-噪声" class="headerlink" title="偏差,方差,噪声"></a><strong>偏差,方差,噪声</strong></h4><ol>
<li>偏差:度量了学习算法的期望预测和真实结果偏离程度</li>
<li>方差:度量了同样大小的训练集的变动所导致的学习性能的变化，即刻画了数据扰动所造成的影响</li>
<li>噪声:可以认为是数据自身的波动性，表达了目前任何学习算法所能达到泛化误差的下限</li>
<li><p><strong>泛化误差</strong>可以分解为偏差、方差与噪声之和</p>
<h4 id="对偶原理"><a href="#对偶原理" class="headerlink" title="对偶原理"></a><strong>对偶原理</strong></h4></li>
</ol>
<p>一个优化问题可以从主问题和对偶问题两个方面考虑.在推导对偶问题时,通过将拉格朗日函数对$x$求导并使导数为0来获得对偶函数.对偶函数给出了主问题最优解的下界,因此对偶问题一般是凸问题,那么只需求解对偶函数的最优解就可以了.</p>
<h4 id="KKT条件"><a href="#KKT条件" class="headerlink" title="KKT条件"></a><strong>KKT条件</strong></h4><p>通常我们要求解的最优化条件有如下三种:</p>
<ol>
<li>无约束优化问题:通常使用求导,使导数为零,求解候选最优值</li>
<li>有等式约束的优化问题:通常使用拉格朗日乘子法,即把等式约束用拉格朗日乘子和优化问题合并为一个式子,通过对各个变量求导使其为零,求解候选最优值.拉格朗日乘数法其实是KKT条件在等式约束优化问题的简化版.</li>
<li>有不等式约束的优化问题:通常使用KKT条件.即把不等式约束,等式约束和优化问题合并为一个式子.假设有多个等式约束$h(x)$和不等式约束$g(x)$,$L(\boldsymbol{x}, \boldsymbol{\lambda}, \boldsymbol{\mu})=f(\boldsymbol{x})+\sum_{i=1}^{m} \lambda_{i} h_{i}(\boldsymbol{x})+\sum_{i=1}^{n} \mu_{j} g_{j}(\boldsymbol{x})$,则不等式约束引入的KKT条件如下:<br>$\left\{\begin{array}{l}g_{j}(\boldsymbol{x}) \leqslant 0 \\ mu_{j} \geqslant 0  \\mu_{j} g_{j}(\boldsymbol{x})=0\end{array}\right.$ ,实质是最优解在$g(x)&lt;0$区域内时,约束条件不起作用,等价于对$μ$置零然后对原函数的偏导数置零;当$g(x)=0$时与情况2相近.结合两种情况,那么只需要使$L$对$x$求导为零,使$h(x)$为零,使$μg(x)$为零三式即可求解候选最优值.</li>
</ol>
<h4 id="降维方法"><a href="#降维方法" class="headerlink" title="降维方法"></a><strong>降维方法</strong></h4><ol>
<li>主成分分析(PCA):降维,不断选择与已有坐标轴正交且方差最大的坐标轴.</li>
<li>奇异值分解(SVD):矩阵分解,降维,推荐系统. </li>
<li>线性判别分析(LDA)</li>
</ol>
<h4 id="集成方法"><a href="#集成方法" class="headerlink" title="集成方法"></a>集成方法</h4><h5 id="bagging"><a href="#bagging" class="headerlink" title="bagging"></a>bagging</h5><p>装袋法的核心思想是构建多个相互独立的评估器，然后对其预测进行平均或多数表决原则来决定集成评估器的结果。</p>
<ol>
<li>评估器：相互独立，同时运行</li>
<li>抽样：有放回抽样</li>
<li>如何决定集成的结果：平均或者少数服从多数</li>
<li>目标：降低方差</li>
<li>基学习器过拟合：能够一定程度上解决基学习器过拟合的问题</li>
<li>基学习器学习能力弱：不是很有帮助</li>
<li>代表算法：随机森林<h5 id="boosting"><a href="#boosting" class="headerlink" title="boosting"></a>boosting</h5>提升方法中，基评估器是相关的，是按顺序一一构建的。其核心思想是结合弱评估器的力量一次次对难以评估的样本进行预测，从而构成一个强评估器。提升法的代表模型有Adaboost和梯度提升树。</li>
<li>评估器：相互关联，按顺序依次构建，后建的模型在先建模型预测失败的样本上有更多的权重</li>
<li>抽样：有放回的采样，但会确认数据的权重，每次抽样都会给预测失败的样本更多的权重</li>
<li>如何决定集成的结果：加权平均，在训练集上表现好的模型会有更大的权重</li>
<li>目标：降低偏差，提高模型整体的精确度</li>
<li>基学习器过拟合：加剧过拟合问题</li>
<li>基学习器学习能力弱：提升模型表现</li>
<li>代表算法：GBDT,Adaboost<h5 id="stacking"><a href="#stacking" class="headerlink" title="stacking"></a>stacking</h5>Stacking模型是指将多种分类器组合在一起来取得更好表现的一种集成学习模型。一般情况下，Stacking模型分为两层。第一层中我们训练多个不同的模型，然后再以第一层训练的各个模型的输出作为输入来训练第二层的模型，以得到一个最终的输出。</li>
</ol>
<h4 id="性能度量"><a href="#性能度量" class="headerlink" title="性能度量"></a><strong>性能度量</strong></h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center">预测值</th>
<th style="text-align:center">预测值</th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">真实值</td>
<td style="text-align:center">1</td>
<td style="text-align:center">11</td>
<td style="text-align:center">10</td>
<td style="text-align:center">Recall = $\frac{11}{11+10}$</td>
</tr>
<tr>
<td style="text-align:center">真实值</td>
<td style="text-align:center">0</td>
<td style="text-align:center">01</td>
<td style="text-align:center">00</td>
<td style="text-align:center">FPR = $\frac{01}{01+00}$</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">Precision=$\frac{11}{11+01}$</td>
<td style="text-align:center"></td>
<td style="text-align:center">Acc = $\frac{11+00}{11+10+01+00}$</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li><strong>准确度</strong>,最常用,但在数据集不平衡的情况下不好</li>
<li><strong>Precision(精确度/查准率)</strong>:$P=TP/(TP+FP)$</li>
<li><strong>Recall(召回率/查全率)</strong>:$R=TP/(TP+FN)$</li>
<li><strong>Fβ度量</strong>:$F_{\beta}=\frac{\left(1+\beta^{2}\right) r p}{\beta^{2} * p+r}$,当β=1时退化为F1度量,是精确率和召回率的调和均值.</li>
<li><strong>TPR(真正例率)</strong>:$TPR=TP/(TP+FN)$</li>
<li><strong>FPR(假正例率)</strong>:$FPR=FP/(TN+FP)$</li>
<li><strong>PR曲线</strong>:纵轴为Precision,横轴为Recall,一般使用平衡点(BEP,即Precsion=Recall的点)作为衡量标准.</li>
<li><strong>ROC(接受者操作特征)曲线</strong>:（<strong>每判断正确一个少数类，就有多少个多数类会被判断错误。</strong>）纵轴为TRP,横轴为FPR,在绘图时将分类阈值依次设为每个样例的预测值,再连接各点.ROC曲线围住的面积称为AOC,AOC越大则学习器性能越好.</li>
</ol>
<h4 id="损失函数和风险函数"><a href="#损失函数和风险函数" class="headerlink" title="损失函数和风险函数"></a><strong>损失函数和风险函数</strong></h4><ol>
<li>损失函数度量模型一次预测的好坏.常用的损失函数有:0-1损失函数,平方损失函数,绝对损失函数,对数似然损失函数.</li>
<li>损失函数的期望是理论上模型关于联合分布P(X,Y)的平均意义下的损失,称为风险函数,也叫<strong>期望风险</strong>.但是联合分布是未知的,期望风险不能直接计算.</li>
<li>当样本容量N趋于无穷时经验风险趋于期望风险,但现实中训练样本数目有限.</li>
</ol>
<h4 id="经验风险最小化和结构风险最小化"><a href="#经验风险最小化和结构风险最小化" class="headerlink" title="经验风险最小化和结构风险最小化"></a><strong>经验风险最小化和结构风险最小化</strong></h4><ol>
<li>模型关于训练数据集的平均损失称为经验风险.经验风险最小化的策略就是最小化经验风险.当样本数量足够大时学习效果较好.比如当模型是条件概率分布,损失函数是对数损失函数时,经验风险最小化就等价于极大似然估计.但是当样本容量很小时会出现过拟合.</li>
<li>结构风险最小化等于正则化.结构风险在经验风险上加上表示模型复杂度的正则化项.比如当模型是条件概率分布,损失函数是对数损失函数,模型复杂度由模型的先验概率表示时,结构风险最小化就等价于最大后验概率估计.</li>
</ol>
<h4 id="过拟合"><a href="#过拟合" class="headerlink" title="过拟合"></a><strong>过拟合</strong></h4><p>指学习时选择的模型所包含的参数过多,以致于对已知数据预测得很好,但对未知数据预测很差的现象.模型选择旨在避免过拟合并提高模型的预测能力.</p>
<h4 id="正则化"><a href="#正则化" class="headerlink" title="正则化"></a><strong>正则化</strong></h4><p>模型选择的典型方法.正则化项一般是模型复杂度的单调递增函数,比如模型参数向量的范数.</p>
<h4 id="交叉验证"><a href="#交叉验证" class="headerlink" title="交叉验证"></a><strong>交叉验证</strong></h4><p>是另一常用的模型选择方法,可分为简单交叉验证,K折交叉验证,留一交叉验证等.</p>
<h4 id="sklearn"><a href="#sklearn" class="headerlink" title="sklearn"></a>sklearn</h4><p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/sklearn.png" alt="avatar"></p>
<h3 id="感知机"><a href="#感知机" class="headerlink" title="感知机"></a>感知机</h3><p>感知机是<strong>二类分类</strong>的线性模型,属于判别模型.感知机学习旨在求出将训练数据进行线性划分的分离超平面.是神经网络和支持向量机的基础.</p>
<h4 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h4><p>$f(x)=sign(wx + b)$,$w$叫作权值向量,$b$叫做偏置,$sign$是符号函数.</p>
<h4 id="感知机的几何解释"><a href="#感知机的几何解释" class="headerlink" title="感知机的几何解释"></a><strong>感知机的几何解释</strong></h4><p>$wx+b$对应于特征空间中的一个分离超平面S,其中$w$是$S$的法向量,$b$是$S$的截距.$S$将特征空间划分为两个部分,位于两个部分的点分别被分为正负两类.</p>
<h4 id="策略"><a href="#策略" class="headerlink" title="策略"></a>策略</h4><p>假设训练数据集是线性可分的,感知机的损失函数是误分类点到超平面$S$的总距离.因为误分类点到超平面$S$的距离是$\frac{1}{|w|}\left|w \cdot x_{0}+b\right|$,且对于误分类的数据来说,总有$-y_i(wx_i+b)&gt;0$成立,因此不考虑$\frac{1}{|w|}$,就得到感知机的损失函数:</p>
<p>$L(w, b)=-\sum_{x \in M} y_{i}\left(w \cdot x_{i}+b\right)$,其中M是误分类点的集合.感知机学习的策略就是选取使损失函数最小的模型参数.</p>
<h4 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h4><p>感知机的最优化方法采用<strong>随机梯度下降法</strong>.首先任意选取一个超平面$w_0,b_0$,然后不断地极小化目标函数.在极小化过程中一次随机选取一个误分类点更新$w,b$,直到损失函数为0.$w \leftarrow w+\eta y_{i} x_{i}$ ， $b \leftarrow b+\eta y_{i}$，其中$η$表示步长.该算法的直观解释是:当一个点被误分类,就调整$w,b$使分离超平面向该误分类点接近.感知机的解可以不同.</p>
<h4 id="对偶形式"><a href="#对偶形式" class="headerlink" title="对偶形式"></a><strong>对偶形式</strong></h4><p>假设原始形式中的$w_0$和$b_0$均为0,设逐步修改$w$和$b$共n次,令$a=nη$,最后学习到的$w,b$可以表示为$w =\sum_{i=1}^{N} \alpha_{i} y_{i} x_{i}$,$b =\sum_{i=1}^{N}{\alpha_{i} y_{i}}$ ,那么对偶算法就变为设初始$a$和$b$均为0,每次选取数据更新$a$和$b$直至没有误分类点为止.对偶形式的意义在于可以将训练集中实例间的内积计算出来,存在Gram矩阵中,可以大大加快训练速度.</p>
<h3 id="k近邻法"><a href="#k近邻法" class="headerlink" title="k近邻法"></a>k近邻法</h3><p>k近邻法根据其<strong>k个最近邻</strong>的训练实例的类别,通过多数表决等方式进行预测.当k=1时称为最近邻算法.</p>
<h4 id="三个基本要素"><a href="#三个基本要素" class="headerlink" title="三个基本要素:"></a>三个基本要素:</h4><ol>
<li>k值的选择</li>
<li>距离度量</li>
<li>分类决策规则</li>
</ol>
<h4 id="模型-1"><a href="#模型-1" class="headerlink" title="模型"></a>模型</h4><p>当训练集,距离度量,k值以及分类决策规则确定后,特征空间已经根据这些要素被划分为一些子空间,且子空间里每个点所属的类也已被确定.</p>
<h4 id="策略-1"><a href="#策略-1" class="headerlink" title="策略"></a><strong>策略</strong></h4><ol>
<li><strong>距离</strong>:特征空间中两个实例点的距离是相似程度的反映,k近邻算法一般使用欧氏距离,也可以使用更一般的Lp距离或Minkowski距离.</li>
<li><strong>k值</strong>:k值较小时,整体模型变得复杂,容易发生过拟合.k值较大时,整体模型变得简单.在应用中k一般取较小的值,通过交叉验证法选取最优的k.</li>
<li><p><strong>分类决策规则</strong>:k近邻中的分类决策规则往往是多数表决,多数表决规则等价于经验风险最小化.</p>
<h4 id="算法-1"><a href="#算法-1" class="headerlink" title="算法"></a>算法</h4></li>
</ol>
<p>根据给定的距离度量,在训练集中找出与x最邻近的k个点,根据分类规则决定x的类别y.</p>
<p><strong>kd树</strong></p>
<ol>
<li><p>kd树就是一种对k维空间中的实例点进行存储以便对其进行快速检索的树形数据结构.kd树更适用于<strong>训练实例数远大于空间维数</strong>时的k近邻搜索.</p>
</li>
<li><p><strong>构造</strong>:可以通过如下<strong>递归</strong>实现:在超矩形区域上选择一个<strong>坐标轴</strong>和此坐标轴上的一个<strong>切分点</strong>,确定一个超平面,该超平面将当前超矩形区域切分为两个子区域.在子区域上重复切分直到子区域内没有实例时终止.通常依次选择坐标轴和选定坐标轴上的<strong>中位数点</strong>为切分点,这样可以得到平衡kd树.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/kd_tree.png" alt="avatar"></p>
</li>
</ol>
<h4 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a><strong>搜索</strong></h4><p>从根节点出发,若目标点x当前维的坐标小于切分点的坐标则移动到左子结点,否则移动到右子结点,直到子结点为叶结点为止.以此叶结点为”当前最近点”,<strong>递归</strong>地向上回退,在每个结点:(a)如果该结点比当前最近点距离目标点更近,则以该结点为”当前最近点”(b)”当前最近点”一定存在于该结点一个子结点对应的区域,检查该结点的另一子结点对应的区域是否与以目标点为球心,以目标点与”当前最近点”间的距离为半径的超球体相交.如果相交,移动到另一个子结点,如果不相交,向上回退.持续这个过程直到回退到根结点,最后的”当前最近点”即为最近邻点.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/search_kd.png" alt="avatar"></p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/search_kd_2.png" alt="avatar"></p>
<h3 id="朴素贝叶斯"><a href="#朴素贝叶斯" class="headerlink" title="朴素贝叶斯"></a>朴素贝叶斯</h3><p>朴素贝叶斯是基于<strong>贝叶斯定理</strong>和<strong>特征条件独立假设</strong>的分类方法.首先学习输入/输出的联合概率分布,然后基于此模型,对给定的输入x,利用贝叶斯定理求出后验概率最大的输出y.属于生成模型.</p>
<h4 id="模型-2"><a href="#模型-2" class="headerlink" title="模型"></a><strong>模型</strong></h4><ol>
<li>首先学习先验概率分布$p(c_k),k=1,2,3,4,…,k$</li>
<li>然后学习条件概率分布,$P\left(X=x | Y=c_{k}\right)=P\left(X^{(1)}=x^{(1)}, \cdots, X^{(n)}=x^{(n)} | Y=c_{k}\right)$.如果估计实际,需要指数级的计算,所以朴素贝叶斯法对条件概率分布作了条件独立性的假设,上式变成$\prod_{j=1}^{n} P\left(X^{(n)}=x^{(n)} | Y=c_{k}\right)$</li>
<li>在分类时,通过学习到的模型计算后验概率分布,由贝叶斯定理得到$P\left(Y=c_{k} | X=x\right)=\frac{P\left(X=x | Y=c_{k}\right) P\left(Y=c_{k}\right)}{\sum_{k} P\left(X=x | Y=c_{k}\right) P\left(Y=c_{k}\right)}$</li>
<li>将条件独立性假设得到的等式代入,并且注意到分母都是相同的,所以得到朴素贝叶斯分类器:$y=\arg \max _{a_{k}} P\left(Y=c_{k}\right) \prod_{j} P\left(X^{(l)}=x^{(l)} | Y=c_{k}\right)$</li>
</ol>
<p>朴素贝叶斯将实例分到后验概率最大的类中,这等价于期望风险最小化.</p>
<h4 id="算法-2"><a href="#算法-2" class="headerlink" title="算法"></a><strong>算法</strong></h4><ol>
<li>使用<strong>极大似然估计法</strong>估计相应的先验概率:$P\left(Y=c_{k}\right)=\frac{\sum_{i=1}^{N} I\left(y_{i}=c_{k}\right)}{N}, \quad k=1,2, \cdots, K$和条件概率$P\left(X^{(j)}=a_{n} | Y=c_{k}\right)=\frac{\sum_{i=1}^{N} I\left(x_{i}^{(n)}=a_{j i} y_{i}=c_{k}\right)}{\sum_{i=1}^{N} I\left(y_{i}=c_{k}\right)}$</li>
<li>计算条件独立性假设下的实例各个取值的可能性,$P\left(Y=c_{k}\right) \prod_{j=1}^{n} P\left(X^{(j)}=x^{(j)} | Y=c_{k}\right), \quad k=1,2, \cdots, K$</li>
<li>选取其中的最大值作为输出.</li>
</ol>
<h4 id="特殊情况"><a href="#特殊情况" class="headerlink" title="特殊情况"></a>特殊情况</h4><ol>
<li>用极大似然估计可能会出现所要估计的概率值为0的情况,在累乘后会影响后验概率的计算结果,使分类产生偏差.可以采用<strong>贝叶斯估计</strong>,在随机变量各个取值的频数上赋予一个正数.$P_{\lambda}\left(X^{(1)}=a_{j q} | Y=c_{k}\right)=\frac{\sum_{i=1}^{N} I\left(x_{i}^{(l)}=a_{\beta}, y_{i}=c_{k}\right)+\lambda}{\sum_{i=1}^{N} I\left(y_{i}=c_{k}\right)+S_{j} \lambda}$，$S_j$为j属性可能取值数量,当$λ=0$时就是极大似然估计.常取$λ=1$,称为<strong>拉普拉斯平滑</strong>.</li>
<li>如果是连续值的情况,可以假设连续变量服从高斯分布,然后用训练数据估计参数.$P\left(X_{i}=x_{i} | Y=y_{i}\right)=\frac{1}{\sqrt{2 \pi} \sigma_{i j}^{2}} e^{\frac{\left(x_{i}-\mu_{j}\right)^{2}}{2 \sigma_{i}^{2}}}$</li>
</ol>
<h3 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h3><p>决策树是一种基本的分类与回归方法.它可以认为是<strong>if-then规则</strong>的集合,也可以认为是定义在特征空间与类空间上的<strong>条件概率分布</strong>.主要优点是模型具有可读性,分类速度快.其主要围绕着两个问题：</p>
<ol>
<li>如何从数据表中找出最佳节点和最佳分枝？</li>
<li>如何让决策树停止生长，防止过拟合？</li>
</ol>
<h4 id="模型-3"><a href="#模型-3" class="headerlink" title="模型"></a>模型</h4><p>分类决策树由<strong>结点</strong>和<strong>有向边</strong>组成.结点分为<strong>内部结点</strong>(表示一个特征或属性)和<strong>叶结点</strong>(表示一个类).决策树的路径具有<strong>互斥且完备</strong>的性质.</p>
<h4 id="策略-2"><a href="#策略-2" class="headerlink" title="策略"></a>策略</h4><p>决策树学习本质上是从训练数据集中归纳出一组分类规则.我们需要的是一个与训练数据<strong>矛盾较小</strong>,同时具有很好的<strong>泛化能力</strong>的决策树.从所有可能的决策树中选取最优决策树是NP完全问题,所以现实中常采用<strong>启发式方法</strong>近似求解.</p>
<h4 id="算法-3"><a href="#算法-3" class="headerlink" title="算法"></a>算法</h4><p>决策树学习算法包含<strong>特征选择</strong>,<strong>决策树的生成</strong>与<strong>决策树的剪枝过程</strong>.生成只考虑局部最优,剪枝则考虑全局最优。</p>
<h4 id="特征选择"><a href="#特征选择" class="headerlink" title="特征选择"></a>特征选择</h4><p>如果利用一个特征进行分类的结果与随机分类的结果没有很大差别,则称这个特征是<strong>没有分类能力</strong>的.扔掉这样的特征对决策树学习的精度影响不大.</p>
<ol>
<li><strong>信息熵</strong>：熵是衡量<strong>随机变量不确定性</strong>的度量.熵越大,随机变量的不确定性就越大.信息熵是信息量的期望，$\left.H(X)=-\sum_{x \in X} P(x) \log P(x)\right)$</li>
<li><strong>条件熵</strong>：条件熵表示在已知随机变量X的条件下随机变量Y的不确定性.$H(Y | X)=\sum_{i=1}^{n} p_{i} H\left(Y | X=x_{i}\right)$</li>
<li><strong>信息增益</strong>：表示得知特征X的信息而使得类Y的信息的<strong>不确定性减少</strong>的程度.定义为集合D的经验熵与特征A在给定条件下D的经验条件熵之差$g(D,A)=H(D)-H(D|A)$,也就是训练数据集中类与特征的<strong>互信息</strong>.</li>
<li><strong>信息增益算法</strong>:计算数据集D的经验熵$H(D)=-\sum_{k=1}^{K} \frac{\left|C_{k}\right|_{\mathrm{log}_{2}}\left|C_{k}\right|}{|D|}$,计算特征A对数据集D的经验条件熵$H(D | A)=\sum_{i=1}^{n} \frac{\left|D_{i}\right|}{|D|} H\left(D_{i}\right)=-\sum_{i=1}^{n} \frac{\left|D_{i}\right|}{|D|} \sum_{k=1}^{K} \frac{\left|D_{\mu}\right|}{\left|D_{i}\right|} \log _{2} \frac{\left|D_{k}\right|}{\left|D_{i}\right|}$,计算信息增益,选取信息增益最大的特征.</li>
<li><strong>信息增益比</strong>:信息增益值的大小是相对于训练数据集而言的,并无绝对意义.使用信息增益比,$g_{R}(D, A)=\frac{g(D, A)}{H(D)}$可以对这一问题进行校正.</li>
</ol>
<h4 id="决策树的生成"><a href="#决策树的生成" class="headerlink" title="决策树的生成"></a><strong>决策树的生成</strong></h4><ol>
<li><strong>ID3算法</strong>:核心是在决策树各个结点上应用<strong>信息增益准则</strong>选择信息增益最大且大于阈值的特征,递归地构建决策树.ID3相当于用极大似然法进行概率模型的选择.由于算法只有树的生成,所以容易产生过拟合.</li>
<li><strong>C4.5算法</strong>:C4.5算法与ID3算法相似,改用<strong>信息增益比</strong>来选择特征.</li>
</ol>
<h4 id="决策树的剪枝"><a href="#决策树的剪枝" class="headerlink" title="决策树的剪枝"></a><strong>决策树的剪枝</strong></h4><ol>
<li>在学习时过多考虑如何提高对训练数据的正确分类,从而构建出过于复杂的决策树,产生<strong>过拟合</strong>现象.解决方法是对已生成的决策树进行简化,称为剪枝.</li>
<li>设树的叶结点个数为$|T|$,每个叶结点有$N_t$个样本点,其中$k$类样本点有$N_{tk}$个,剪枝往往通过极小化决策树整体的损失函数$C_{\alpha}(T)=\sum_{i=1}^{\pi} N_{i} H_{i}(T)+\alpha|T|$来实现,其中经验熵$H_{t}(T)=-\sum_{k} \frac{N_{a}}{N_{t}} \log \frac{N_{u}}{N_{t}}$.剪枝通过加入$a|T|$项来考虑模型复杂度,实际上就是用正则化的极大似然估计进行模型选择.</li>
<li><strong>剪枝算法</strong>:剪去某一子结点,如果生成的新的整体树的<strong>损失函数值</strong>小于原树,则进行剪枝,直到不能继续为止.具体可以由动态规划实现.</li>
</ol>
<h4 id="CART算法"><a href="#CART算法" class="headerlink" title="CART算法"></a><strong>CART算法</strong></h4><ol>
<li><p>CART既可以用于<strong>分类也</strong>可以用于<strong>回归</strong>.它假设决策树是<strong>二叉树</strong>,内部结点特征的取值为”是”和”否”.递归地构建二叉树,对回归树用<strong>平方误差</strong>最小化准则,对分类数用<strong>基尼指数</strong>最小化准则.</p>
</li>
<li><p><strong>回归树的生成</strong>:在训练数据集所在的输入空间中,递归地将每个区域划分为两个子区域.选择第j个变量和它取的值s作为切分变量和切分点,并定义两个区域$R_{1}(j, s)=\left\{x | x^{(j)} \leqslant s\right\} \quad$和$\quad R_{2}(j, s)=\left\{x | x^{(l)}&gt;s\right\}$,遍历变量j,对固定的j扫描切分点s,求解$\min _{j, z}\left[\min _{c_1} \sum_{x \in R_{1}(j, x)}\left(y_{i}-c_{1}\right)^{2}+\min _{c_{2}} \sum_{x \in R_{2}(j, x)}\left(y_{i}-c_{2}\right)^{2}\right]$.用选定的对(j,s)划分区域并决定相应的输出值$\hat{c}_{m}=\frac{1}{N_{m}} \sum_{x_{i} \in R_{m}(j, x)} y_{i}, x \in R_{m}, \quad m=1,2$,直到满足停止条件.</p>
</li>
<li><p><strong>基尼指数</strong>:假设有K个类,样本属于第k类的概率为$p_k$,则概率分布的基尼指数为:$\operatorname{Gini}(p)=\sum_{k=1}^{K} p_{k}\left(1-p_{k}\right)=1-\sum_{k=1}^{K} p_{k}^{2}$,表示不确定性.在特征A的条件下集合D的基尼指数定义为$\operatorname{Gini}(D, A)=\frac{\left|D_{1}\right|}{|D|} \operatorname{Gini}\left(D_{1}\right)+\frac{\left|D_{2}\right|}{|D|} \operatorname{Gini}\left(D_{2}\right)$,表示分割后集合D的不确定性.基尼指数越大,样本集合的<strong>不确定性</strong>也就越大.</p>
</li>
<li><p><strong>分类树的生成</strong></p>
<ol>
<li>从根结点开始,设结点的训练数据集为D,对每个特征A和其可能取的每个值a,计算A=a时的基尼指数,</li>
<li>选择<strong>基尼指数最小</strong>的特征及其对应的切分点作为<strong>最优特征</strong>与<strong>最优切分点</strong>,生成两个子结点</li>
<li>递归进行以上操作,直至满足<strong>停止条件</strong>.停止条件一般是结点中的样本个数小于阈值,或样本集的基尼指数小于阈值,或没有更多特征.</li>
</ol>
</li>
<li><p><strong>CART剪枝</strong></p>
<p>$T_t$表示以t为根结点的子树,$|T_t|$是$T_t$的叶结点个数.可以证明当$\alpha=\frac{C(t)-C\left(T_{t}\right)}{\left|T_{t}\right|-1}$时,$T_t$与$t$有相同的损失函数值,且$t$的结点少,因此$t$比$T_t$更可取,对$T_t$进行剪枝.<strong>自下而上</strong>地对各内部结点t计算$g(t)=\frac{C(t)-C\left(T_{t}\right)}{\left|T_{t}\right|-1}$,并令$a=min(g(t))$,<strong>自上而下</strong>地访问内部节点t,如果有$g(t)=a$,进行剪枝,并对t以<strong>多数表决法</strong>决定其类,得到子树T,如此循环地生成一串<strong>子树序列</strong>,直到新生成的T是由根结点单独构成的树为止.利用<strong>交叉验证法</strong>在子树序列中选取最优子树.</p>
<p>如果是<strong>连续值</strong>的情况,一般用<strong>二分法</strong>作为结点来划分.</p>
</li>
</ol>
<h3 id="logistic回归和最大熵模型"><a href="#logistic回归和最大熵模型" class="headerlink" title="logistic回归和最大熵模型"></a>logistic回归和最大熵模型</h3><h4 id="逻辑斯谛分布"><a href="#逻辑斯谛分布" class="headerlink" title="逻辑斯谛分布"></a><strong>逻辑斯谛分布</strong></h4><p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/logistic.png" alt="avatar"></p>
<p>分布函数$f(x)$以点$(μ,1/2)$为中心对称,$γ$的值越小,曲线在中心附近增长得越快.</p>
<h4 id="逻辑斯谛回归模型"><a href="#逻辑斯谛回归模型" class="headerlink" title="逻辑斯谛回归模型"></a><strong>逻辑斯谛回归模型</strong></h4><p>对于给定的输入x,根据$P(Y=1 | x)=\frac{\exp (w \cdot x+b)}{1+\exp (w \cdot x+b)}$ 和 $P(Y=0 | x)=\frac{1}{1+\exp (w \cdot x+b)}$计算出两个条件概率值的大小,将x分到概率值较大的那一类.将偏置b加入到权值向量w中,并在x的最后添加常数项1,得到$P(Y=1 | x)=\frac{\exp (w \cdot x)}{1+\exp (w \cdot x)}$ 和 $P(Y=0 | x)=\frac{1}{1+\exp (w \cdot x)}$。</p>
<h4 id="对数几率"><a href="#对数几率" class="headerlink" title="对数几率"></a>对数几率</h4><p>如果某事件发生的概率是p,则该事件发生的<strong>几率</strong>(此处几率指该事件发生概率与不发生概率之比)是$\frac{p}{1-p}$,<strong>对数几率</strong>是$log(\frac{p}{1-p})$,那么$\log \frac{P(Y=1 | x)}{1-P(Y=1 | x)}=w \cdot x$，也就是说在逻辑斯谛回归模型中,输出Y=1的对数几率是输入x的<strong>线性函数</strong>,线性函数值越接近正无穷,概率值就越接近1,反之则越接近0.</p>
<h4 id="似然估计"><a href="#似然估计" class="headerlink" title="似然估计"></a><strong>似然估计</strong></h4><p>给定x的情况下参数θ是真实参数的可能性.</p>
<h4 id="模型参数估计"><a href="#模型参数估计" class="headerlink" title="模型参数估计"></a><strong>模型参数估计</strong></h4><p>对于给定的二分类训练数据集,对数似然函数为</p>
<script type="math/tex; mode=display">
\begin{aligned} L(w) &=\sum_{i=1}^{N}\left[y_{i} \log \pi\left(x_{i}\right)+\left(1-y_{i}\right)\log\left(1-\pi\left(x_{i}\right)\right)\right]\\ &=\sum_{i=1}^{N}\left[y_{i} \log \frac{\pi\left(x_{i}\right)}{1-\pi\left(x_{i}\right)}+\log \left(1-\pi\left(x_{i}\right)\right)\right]\\&=\sum_{i=1}^{N}\left[y_{i}\left(w \cdot x_{i}\right)-\log \left(1+\exp \left(w \cdot x_{i}\right)\right]\right.\end{aligned}</script><p>也就是<strong>损失函数</strong>.其中$P(Y=1|x)=π(x)$,对$L(w)$求极大值,就可以得到$w$的估计值.问题变成了以对数似然函数为目标函数的最优化问题.</p>
<h4 id="多项逻辑斯谛回归"><a href="#多项逻辑斯谛回归" class="headerlink" title="多项逻辑斯谛回归"></a><strong>多项逻辑斯谛回归</strong></h4><p>当问题是多分类问题时,可以作如下推广:设Y有K类可能取值,$P(Y=k | x)=\frac{\exp \left(w_{k} \cdot x\right)}{1+\sum_{k=1}^{K-1} \exp \left(w_{k} \cdot x\right)}, \quad k=1,2, \cdots, K-1 \quad P(Y=K | x)=\frac{1}{1+\sum_{k=1}^{K-1} \exp \left(w_{k} \cdot x\right)}$,实际上就是<strong>one-vs-all</strong>的思想,将其他所有类当作一个类,问题转换为二分类问题.</p>
<p>使用最大似然法衡量模型输出的概率与真实概率的差别，假设样本一共有N个，那么这组样本发生的总概率可以表示为：</p>
<script type="math/tex; mode=display">
P(\boldsymbol{W})=\prod_{n=1}^{N}\left(\frac{e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}}{\sum_{k^{\prime}}^{C} e^{\boldsymbol{w}_{k^{\prime}}^{T} \boldsymbol{x}_{n}}}\right)</script><p>对函数取对数再乘以-1，推导得到：</p>
<script type="math/tex; mode=display">
\begin{aligned}
F(\boldsymbol{W})=-\ln (P(\boldsymbol{W})) &=\sum_{n=1}^{N} \ln \left(\frac{\sum_{k^{\prime}}^{C} e^{\boldsymbol{w}_{k^{\prime}}^{T} \boldsymbol{x}_{n}}}{e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}}\right) \\
&=\sum_{n=1}^{N} \ln \left(\frac{e^{\boldsymbol{w}_{1}^{T} \boldsymbol{x}}+e^{\boldsymbol{w}_{2}^{T} \boldsymbol{x}}+\ldots+e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}+\ldots+e^{\boldsymbol{w}_{c}^{T} \boldsymbol{x}}}{e^{\boldsymbol{w}_{y_{n}}^{T} \boldsymbol{x}_{n}}}\right) \\
&=\sum_{n=1}^{N} \ln \left(1+\sum_{k \neq y_{n}} e^{\boldsymbol{w}_{k} \boldsymbol{x}_{n}-\boldsymbol{w}_{y_{n}} \boldsymbol{x}_{n}}\right)
\end{aligned}</script><h4 id="最大熵原理"><a href="#最大熵原理" class="headerlink" title="最大熵原理"></a><strong>最大熵原理</strong></h4><p>学习概率模型时,在所有可能的概率模型中,<strong>熵最大</strong>的模型是最好的模型.直观地,最大熵原理认为模型首先要满足已有的事实,即<strong>约束条件</strong>.在没有更多信息的情况下,那些不确定的部分都是”<strong>等可能的</strong>“.</p>
<h4 id="最大熵模型"><a href="#最大熵模型" class="headerlink" title="最大熵模型"></a><strong>最大熵模型</strong></h4><p>给定训练数据集,可以确定联合分布P(X,Y)的经验分布$\tilde{P}(X=x, Y=y)=\frac{v(X=x, Y=y)}{N}$和边缘分布P(X)的经验分布$\tilde{P}(X=x)=\frac{v(X=x)}{N}$,其中v表示频数,N表示样本容量.用<strong>特征函数$f(x,y)$</strong>=1描述x与y满足某一事实,可以得到特征函数关于P(X,Y)的经验分布的期望值和关于模型P(Y|X)与P(X)的经验分布的期望值,假设两者相等,就得到了<strong>约束条件</strong>$\sum_{x, y} \tilde{P}(x) P(y | x) f(x, y)=\sum_{x, y} \tilde{P}(x, y) f(x, y)$.定义在条件概率分布P(Y|X)上的条件熵为$H(P)=-\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)$,则<strong>条件熵最大</strong>的模型称为最大熵模型.</p>
<h4 id="最大熵模型的学习"><a href="#最大熵模型的学习" class="headerlink" title="最大熵模型的学习"></a><strong>最大熵模型的学习</strong></h4><p>就是求解最大熵模型的过程.等价于<strong>约束最优化问题</strong></p>
<script type="math/tex; mode=display">
\begin{aligned}
&\max _{P_{e c}} H(P)=-\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)\\
&\text { s.t. } \quad E_{p}\left(f_{i}\right)=E_{p}\left(f_{i}\right), \quad i=1,2, \cdots, n\\
     &\sum_{y} P(y | x)=1
\end{aligned}</script><p>,将求最大值问题改为等价的求最小值问题</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\min _{R \in C}-H(P)=\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)\\
&\text { s.t. } \quad E_{P}\left(f_{i}\right)-E_{\beta}\left(f_{i}\right)=0, \quad i=1,2, \cdots, n\\
&\sum_{y} P(y | x)=1
\end{aligned}</script><p>引入<strong>拉格朗日乘子</strong></p>
<script type="math/tex; mode=display">
\begin{aligned}
L(P, w) & \equiv-H(P)+w_{0}\left(1-\sum_{y} P(y | x)\right)+\sum_{i=1}^{n} w_{i}\left(E_{p}\left(f_{i}\right)-E_{P}\left(f_{i}\right)\right) \\
&=\sum_{x, y} \tilde{P}(x) P(y | x) \log P(y | x)+w_{0}\left(1-\sum_{y} P(y | x)\right) \\
&+\sum_{i=1}^{n} w_{i}\left(\sum_{x, y} \tilde{P}(x, y) f_{i}(x, y)-\sum_{x, y} \tilde{P}(x) P(y | x) f_{i}(x, y)\right)
\end{aligned}</script><p>将原始问题$\min _{p \in C} \max _{w} L(P, w)$转换为无约束最优化的<strong>对偶问题</strong>$\max _{w} \min _{P \in \mathbf{C}} L(P, w)$.首先求解内部的<strong>极小化问题</strong>,即求$L(P,W)$对$P(y|x)$的偏导数.</p>
<script type="math/tex; mode=display">
\begin{aligned}
\frac{\partial L(P, w)}{\partial P(y | x)} &=\sum_{x, y} \tilde{P}(x)(\log P(y | x)+1)-\sum_{y} w_{0}-\sum_{x, y}\left(\tilde{P}(x) \sum_{i=1}^{n} w_{i} f_{i}(x, y)\right) \\
&=\sum_{x, y} \tilde{P}(x)\left(\log P(y | x)+1-w_{0}-\sum_{i=1}^{n} w_{i} f_{i}(x, y)\right)
\end{aligned}</script><p>,并令偏导数等于0,解得$Z_{w}(x)=\sum_{y} \exp \left(\sum_{i=1}^{n} w_{i} f_{i}(x, y)\right)$.可以证明对偶函数等价于对数似然函数,那么对偶函数极大化等价于最大熵模型的<strong>极大似然估计</strong>$L(w)=\sum_{x, y} \tilde{P}(x, y) \sum_{i=1}^{n} w_{i} f_{i}(x, y)-\sum_{x} \tilde{P}(x) \log Z_{w}(x)$.之后可以用最优化算法求解得到w.</p>
<h4 id="逻辑回归与最大熵模型的共同点"><a href="#逻辑回归与最大熵模型的共同点" class="headerlink" title="逻辑回归与最大熵模型的共同点"></a>逻辑回归与最大熵模型的共同点</h4><p>最大熵模型与逻辑斯谛回归模型有类似的形式,它们又称为<strong>对数线性模型</strong>.模型学习就是在给定的训练数据条件下对模型进行极大似然估计或正则化的极大似然估计.</p>
<h4 id="优化算法"><a href="#优化算法" class="headerlink" title="优化算法"></a>优化算法</h4><p>似然函数是<strong>光滑的凸函数</strong>,因此多种最优化方法都适用.</p>
<ol>
<li><strong>改进的迭代尺度法(IIS)</strong>:假设当前的参数向量是w,如果能找到一种方法<strong>w-&gt;w+δ</strong>使对数似然函数值变大,就可以<strong>重复</strong>使用这一方法,直到找到最大值.</li>
<li>逻辑斯谛回归常应用梯度下降法,牛顿法或拟牛顿法.</li>
</ol>
<h3 id="支持向量机"><a href="#支持向量机" class="headerlink" title="支持向量机"></a>支持向量机</h3><h4 id="模型-4"><a href="#模型-4" class="headerlink" title="模型"></a>模型</h4><p>支持向量机(SVM)是一种<strong>二类分类模型</strong>.它的基本模型是定义在特征空间上的<strong>间隔最大</strong>的线性分类器.支持向量机还包括<strong>核技巧</strong>,使它成为实质上的非线性分类器.<strong>分离超平面</strong>$w^\star x+b^\star =0$,<strong>分类决策函数</strong>$f(s)=sign(w^\star x + b^\star)$.</p>
<h4 id="策略-3"><a href="#策略-3" class="headerlink" title="策略"></a>策略</h4><p><strong>间隔最大化</strong>,可形式化为一个求解<strong>凸二次规划</strong>的问题,也等价于正则化的<strong>合页损失函数</strong>的最小化问题.</p>
<h4 id="数据可分、近似可分、不可分"><a href="#数据可分、近似可分、不可分" class="headerlink" title="数据可分、近似可分、不可分"></a>数据可分、近似可分、不可分</h4><p>当训练数据<strong>线性可分</strong>时,通过硬间隔最大化,学习出<strong>线性可分支持向量机</strong>.当训练数据<strong>近似线性可分</strong>时,通过软间隔最大化,学习出<strong>线性支持向量机</strong>.当训练数据<strong>线性不可分</strong>时,通过使用核技巧及软间隔最大化,学习<strong>非线性支持向量机</strong>.</p>
<h4 id="核技巧"><a href="#核技巧" class="headerlink" title="核技巧"></a>核技巧</h4><p>当输入空间为欧式空间或离散集合,特征空间为希尔伯特空间时,核函数表示将输入从输入空间<strong>映射</strong>到特征空间得到的特征向量之间的<strong>内积</strong>.通过核函数学习非线性支持向量机等价于在高维的特征空间中学习线性支持向量机.这样的方法称为核技巧.</p>
<h4 id="输入空间和特征空间"><a href="#输入空间和特征空间" class="headerlink" title="输入空间和特征空间"></a>输入空间和特征空间</h4><p>考虑一个二类分类问题,假设输入空间与特征空间为两个不同的空间,输入空间为<strong>欧氏空间或离散集合</strong>,特征空间为<strong>欧氏空间或希尔伯特空间</strong>.支持向量机都将输入映射为特征向量,所以支持向量机的学习是在<strong>特征空间</strong>进行的.</p>
<h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><p>支持向量机的最优化问题一般通过对偶问题化为<strong>凸二次规划问题</strong>求解,具体步骤是将等式约束条件代入优化目标,通过求偏导求得优化目标在不等式约束条件下的极值.</p>
<h4 id="线性可分支持向量机"><a href="#线性可分支持向量机" class="headerlink" title="线性可分支持向量机"></a><strong>线性可分支持向量机</strong></h4><p>当训练数据集线性可分时,存在无穷个分离超平面可将两类数据正确分开.利用<strong>间隔最大化</strong>得到<strong>唯一</strong>最优分离超平面$w^\star x +b = 0$和相应的分类决策函数$f(s)=sign(w^\star x + b^\star)$.称为线性可分支持向量机.</p>
<h5 id="函数间隔"><a href="#函数间隔" class="headerlink" title="函数间隔"></a>函数间隔</h5><p>一般来说,一个点距离分离超平面的<strong>远近</strong>可以表示分类预测的<strong>确信程度</strong>.在超平面$w^\star x +b = 0$确定的情况下,$|wx+b|$能够相对地表示点x距离超平面的远近,而$wx+b$与$y$的符号是否一致能够表示分类是否正确.所以可用$\hat{\gamma}_{i}=y_{i}\left(w \cdot x_{i}+b\right)$来表示分类的正确性及确信度,这就是<strong>函数间隔</strong>.注意到即使超平面不变,函数间隔仍会受w和b的绝对大小影响.</p>
<h5 id="几何间隔"><a href="#几何间隔" class="headerlink" title="几何间隔"></a><strong>几何间隔</strong></h5><p>一般地,当样本点被超平面正确分类时,点x与超平面的距离是$\gamma_{i}=y_{i}\left(\frac{w}{|w|} \cdot x_{i}+\frac{b}{|w|}\right)$其中$||w||$是$w$的$l2$范数.这就是<strong>几何间隔</strong>的定义.定义超平面关于训练数据集T的几何间隔为超平面关于T中所有样本点的几何间隔之<strong>最小值</strong>$\gamma=\min _{i,…,N} \gamma_{1}$.可知$\gamma=\frac{\hat{\gamma}}{|\boldsymbol{w}|}$当$||w||=1$时几何间隔和函数间隔<strong>相等</strong>.</p>
<h5 id="硬间隔最大化"><a href="#硬间隔最大化" class="headerlink" title="硬间隔最大化"></a><strong>硬间隔最大化</strong></h5><p>对线性可分的训练集而言,这里的间隔最大化又称为<strong>硬间隔最大化</strong>.直观解释是对训练集找到几何间隔最大的超平面意味着以<strong>充分大的确信度</strong>对训练数据进行分类.求最大间隔分离超平面即约束最优化问题:</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\max _{w, b} \quad \gamma\\
&\text { s.t. } \quad y_{i}\left(\frac{w}{\|w\|} \cdot x_{i}+\frac{b}{\|w\|}\right) \geqslant \gamma, \quad i=1,2, \cdots, N
\end{aligned}</script><p>,将几何间隔用函数间隔表示:</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\max _{w, b} \frac{\hat{\gamma}}{\|w\|}\\
&\text { s.t. } \quad y_{i}\left(w \cdot x_{i}+b\right) \geqslant \hat{p}, \quad i=1,2, \cdots, N
\end{aligned}</script><p>,并且注意到函数间隔的取值并不影响最优化问题的解,不妨令函数间隔=1,并让最大化$\frac{1}{||w||}$等价为最小化$\frac{||w||^2}{2}$,问题变为<strong>凸二次规划问题</strong></p>
<script type="math/tex; mode=display">
\min _{w, b} \frac{1}{2}\|w\|^{2} \\
s.t. \quad y_{i}\left(w \cdot x_{i}+b\right)-1 \geqslant 0, \quad i=1,2, \cdots, N</script><h5 id="支持向量和间隔边界"><a href="#支持向量和间隔边界" class="headerlink" title="支持向量和间隔边界"></a><strong>支持向量和间隔边界</strong></h5><p>与分离超平面距离<strong>最近的样本点</strong>的实例称为<strong>支持向量</strong>.支持向量是使最优化问题中的约束条件等号成立的点.因此对$y=+1$的正例点和$y=-1$的负例点,支持向量分别在超平面H1:$wx+b=+1$和H2:$wx+b=-1$.H1和H2平行,两者之间形成一条长带,长带的宽度!称$\frac{2}{||w||}$为<strong>间隔</strong>,H1和H2称为<strong>间隔边界</strong>.在决定分离超平面时只有支持向量起作用,所以支持向量机是由很少的”重要的”训练样本确定的.由对偶问题同样可以得到支持向量一定在间隔边界上.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/support_vector.png" alt="avatar"></p>
<h5 id="对偶算法"><a href="#对偶算法" class="headerlink" title="对偶算法"></a><strong>对偶算法</strong></h5><p>引进拉格朗日乘子,定义拉格朗日函数$L(w, b, \alpha)=\frac{1}{2}|w|^{2}-\sum_{i=1}^{N} \alpha_{i} y_{i}\left(w \cdot x_{i}+b\right)+\sum_{i=1}^{N} \alpha_{i}$,根据拉格朗日对偶性,原始问题的对偶问题是极大极小问题:$\max _{\alpha} \min _{w, b} L(w, b, \alpha)$.先求对w,b的<strong>极小值</strong>.将$L(w,b,a)$分别对w,b求偏导数并令其等于0,得</p>
<script type="math/tex; mode=display">
\begin{array}{l}
w=\sum_{i=1}^{N} \alpha_{i} y_{i} x_{i} \\
\sum_{i=1}^{N} \alpha_{i} y_{i}=0
\end{array}</script><p>,代入拉格朗日函数得</p>
<script type="math/tex; mode=display">
\begin{aligned}
L(w, b, \alpha) &=\frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)-\sum_{i=1}^{N} \alpha_{i} y_{i}\left(\left(\sum_{j=1}^{N} \alpha_{j} y_{j} x_{j}\right) \cdot x_{i}+b\right)+\sum_{i=1}^{N} \alpha_{i} \\
&=-\frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)+\sum_{i=1}^{N} \alpha_{i}
\end{aligned}</script><p>这就是极小值.接下来对极小值求对a的极大,即是<strong>对偶问题</strong></p>
<script type="math/tex; mode=display">
\begin{array}{l}
\max _{a}-\frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)+\sum_{i=1}^{N} \alpha_{i} \\
\text { s.t. } \sum_{i=1}^{N} \alpha_{i} y_{i}=0 \\
\quad \alpha_{i} \geqslant 0, \quad i=1,2, \cdots, N
\end{array}</script><p>.将求极大转换为求极小</p>
<script type="math/tex; mode=display">
\begin{array}{cl}
\min _{\alpha} & \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)-\sum_{i=1}^{N} \alpha_{i} \\
\text { s.t. } & \sum_{i=1}^{N} \alpha_{i} y_{i}=0 \\
& \alpha_{i} \geqslant 0, \quad i=1,2, \cdots, N
\end{array}</script><p>.由<strong>KKT条件</strong>成立得到</p>
<script type="math/tex; mode=display">
\begin{aligned}
&w^{*}=\sum_{i=1}^{N} \alpha_{i}^{*} y_{i} x_{i}\\
&b^{*}=y_{j}-\sum_{i=1}^{N} \alpha_{i}^{*} y_{i}\left(x_{i} \cdot x_{j}\right)
\end{aligned}</script><p>,其中$j$为使$a_j^<em>&gt;0$的下标之一.所以问题就变为求对偶问题的解$a^</em>$,再求得原始问题的解$w^<em>,b^</em>$,从而得分离超平面及分类决策函数可以看出$w^<em>$和$b^</em>$都只依赖训练数据中$a_i^<em>&gt;0$的样本点Z$(x_i,y_i)$,这些实例点$x_i$被称为<em>*支持向量</em></em>.</p>
<h4 id="线性支持向量机"><a href="#线性支持向量机" class="headerlink" title="线性支持向量机"></a><strong>线性支持向量机</strong></h4><p>如果训练数据是<strong>线性不可分</strong>的(近似线性可分),那么上述方法中的不等式约束并不能都成立,需要修改硬间隔最大化,使其成为<strong>软间隔最大化</strong>.</p>
<h5 id="松弛变量"><a href="#松弛变量" class="headerlink" title="松弛变量"></a>松弛变量</h5><p>线性不可分意味着某些<strong>特异点</strong>不能满足函数间隔大于等于1的约束条件,可以对每个样本点引进一个<strong>松弛变量</strong>,使函数间隔加上松弛变量大于等于1,约束条件变为$y_{i}\left(w \cdot x_{i}+b\right) \geqslant 1-\xi_{i}$,同时对每个松弛变量,支付一个代价,目标函数变为$\frac{1}{2}|w|^{2}+C \sum_{i=1}^{N} \xi_{i}$,其中$C&gt;0$称为<strong>惩罚参数</strong>,C值越大对误分类的惩罚也越大.新目标函数包含了两层含义:使<strong>间隔尽量大</strong>,同时使误分类点的<strong>个数尽量小</strong>.</p>
<h5 id="软间隔最大化"><a href="#软间隔最大化" class="headerlink" title="软间隔最大化"></a>软间隔最大化</h5><p>学习问题变成如下<strong>凸二次规划</strong>问题:</p>
<script type="math/tex; mode=display">
\min _{w, b, k} \frac{1}{2}\|w\|^{2}+C \sum_{i=1}^{N} \xi_{i} \\
s.t. \quad y_{i}\left(w \cdot x_{i}+b\right) \geqslant 1-\xi_{i}, \quad i=1,2, \cdots, N \\
\xi_{i} \geqslant 0, \quad i=1,2, \cdots, N</script><p>,可以证明w的解是唯一的,但b的解存在一个<strong>区间</strong>.线性支持向量机包含线性可分支持向量机,因此<strong>适用性更广</strong>.</p>
<h5 id="对偶算法-1"><a href="#对偶算法-1" class="headerlink" title="对偶算法"></a>对偶算法</h5><p>原始问题的对偶问题是,构造<strong>拉格朗日函数</strong> $L(w, b, \xi, \alpha, \mu) \equiv \frac{1}{2}|w|^{2}+C \sum_{i=1}^{N} \xi_{i}-\sum_{i=1}^{N} \alpha_{i}\left(y_{i}\left(w \cdot x_{i}+b\right)-1+\xi_{i}\right)-\sum_{i=1}^{N} \mu_{i} \xi_{i}$ ，先求对w,b,ξ的<strong>极小值</strong>,分别求偏导并令导数为0,得</p>
<script type="math/tex; mode=display">
\begin{aligned}
&w=\sum_{i=1} \alpha_{i} y_{i} x_{i}\\
&\sum_{i=1}^{N} \alpha_{i} y_{i}=0\\
&C-\alpha_{i}-\mu_{i}=0
\end{aligned}</script><p>,代入原函数,再对极小值求a的<strong>极大值</strong>,得到</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\max _{a}-\frac{1}{2} \sum_{i=1}^{N} \sum_{i=1}^{N} \alpha_{i} \alpha, y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)+\sum_{i=1}^{N} \alpha_{i}\\
&\text { s.t. } \quad \sum_{i=1}^{N} \alpha_{i} y_{i}=0\\
&\begin{array}{l}
C-\alpha_{i}-\mu_{i}=0 \\
\alpha_{i} \geqslant 0 \\
\mu_{i} \geqslant 0, \quad i=1,2, \cdots, N
\end{array}
\end{aligned}</script><p>,利用后三条约束<strong>消去μ</strong>,再将求极大转换为<strong>求极小</strong>,得到<strong>对偶问题</strong></p>
<script type="math/tex; mode=display">
\begin{aligned}
&\min _{\alpha} \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)-\sum_{i=1}^{N} \alpha_{i}\\
&\text { s.t. } \quad \sum_{i=1}^{N} \alpha_{i} y_{i}=0\\
&0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2, \cdots, N
\end{aligned}</script><p>由<strong>KKT条件</strong>成立可以得到</p>
<script type="math/tex; mode=display">
\begin{array}{c}
w^{*}=\sum_{i=1}^{N} \alpha_{i}^{*} y_{i} x_{i} \\
b^{*}=y_{j}-\sum_{i=1}^{N} y_{i} \alpha_{i}^{*}\left(x_{i} \cdot x_{j}\right)
\end{array}</script><p>$j$是满足$0&lt;\alpha_j^<em><C$的下标之一.问题就变为选择惩罚参数$C>0$,求得对偶问题(<strong>凸二次规划问题</strong>)的**最优解$\alpha^</C$的下标之一.问题就变为选择惩罚参数$C></em>$<strong>,代入计算$w^<em>$和$b^</em>$,求得分离超平面和分类决策函数.因为$b$的解并不唯一,所以实际计算$b^*$时可以取所有样本点上的</strong>平均值**.</p>
<h5 id="支持向量"><a href="#支持向量" class="headerlink" title="支持向量"></a>支持向量</h5><p>在<strong>线性不可分</strong>的情况下,将对应与$\alpha_i^<em>&gt;0$的样本点$(x_i,y_i)$的实例点$x_i$称为<em>*支持向量</em></em>.软间隔的支持向量或者在间隔边界上,或者在间隔边界与分类超平面之间,或者再分离超平面误分一侧.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/support_soft.png" alt="avatar"></p>
<h5 id="合页损失"><a href="#合页损失" class="headerlink" title="合页损失"></a>合页损失</h5><p>可以认为是0-1损失函数的上界,而线性支持向量机可以认为是优化合页损失函数构成的目标函数.</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/0_1loss.png" alt="avatar"></p>
<h4 id="非线性支持向量机"><a href="#非线性支持向量机" class="headerlink" title="非线性支持向量机"></a><strong>非线性支持向量机</strong></h4><p>如果分类问题是<strong>非线性</strong>的,就要使用<strong>非线性支持向量机</strong>.主要特点是使用<strong>核技巧</strong>.</p>
<h5 id="非线性分类问题"><a href="#非线性分类问题" class="headerlink" title="非线性分类问题"></a><strong>非线性分类问题</strong></h5><p>用线性分类方法求解非线性分类问题分为两步:首先使用一个变换将原空间的数据映射到新空间,然后在新空间里用线性分类学习方法从训练数据中学习分类模型.</p>
<h5 id="核函数"><a href="#核函数" class="headerlink" title="核函数"></a><strong>核函数</strong></h5><p>设X是<strong>输入空间</strong>(欧式空间的子集或离散集合),H为<strong>特征空间</strong>(希尔伯特空间),一般是<strong>高维</strong>甚至无穷维的.如果存在一个从X到H的映射$\phi(x): \mathcal{X} \rightarrow \mathcal{H}$使得对所有x,z属于X,函数K(x,z)满足条件$K(x, z)=\phi(x) \cdot \phi(z)$,点乘代表<strong>内积</strong>,则称K(x,z)为<strong>核函数</strong>.</p>
<h5 id="核技巧-1"><a href="#核技巧-1" class="headerlink" title="核技巧"></a><strong>核技巧</strong></h5><p>基本思想是通过一个<strong>非线性变换</strong>将输入空间对应于一个<strong>特征空间</strong>,使得在输入空间中的<strong>超曲面模型</strong>对应于特征空间中的<strong>超平面模型</strong>(支持向量机).在学习和预测中只定义核函数$K(x,z)$,而<strong>不显式</strong>地定义映射函数.对于给定的核$K(x,z)$,特征空间和映射函数的取法并<strong>不唯一</strong>.注意到在线性支持向量机的对偶问题中,目标函数和决策函数都只涉及输入实例与实例之间的<strong>内积</strong>,$x_i,x_j$可以用核函数$K(x_i,x_j)=\phi (x_i)\phi (x_j)$来<strong>代替</strong>.当映射函数是非线性函数时,学习到的含有核函数的支持向量机是非线性分类模型.在实际应用中,往往依赖领域知识<strong>直接选择</strong>核函数.</p>
<h5 id="正定核"><a href="#正定核" class="headerlink" title="正定核"></a><strong>正定核</strong></h5><p>通常所说的核函数是指<strong>正定核函数</strong>.只要满足正定核的充要条件,那么给定的函数K(x,z)就是正定核函数.设K是定义在X<em>X上的<strong>对称函数</strong>,如果任意xi属于X,K(x,z)对应的<strong>Gram矩阵</strong>$K=\left[K\left(x_{i}, x_{j}\right)\right]_{mxm}$是<em>*半正定矩阵</em></em>,则称$K(x,z)$是正定核.这一定义在构造核函数时很有用,但要验证一个具体函数是否为正定核函数并不容易,所以在实际问题中往往应用已有的核函数.</p>
<h5 id="算法-4"><a href="#算法-4" class="headerlink" title="算法"></a><strong>算法</strong></h5><p>选取适当的核函数K(x,z)和适当的参数C,将线性支持向量机对偶形式中的内积换成核函数,构造并求解最优化问题</p>
<script type="math/tex; mode=display">
\min _{a} \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j} K\left(x_{i}, x_{j}\right)-\sum_{i=1}^{N} \alpha_{i} \\
s.t. \quad \sum_{i=1}^{N} \alpha_{i} y_{i}=0 \\
0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2, \cdots, N</script><p>,选择最优解$a^<em>$的一个正分量$0&lt;a_j^</em>&lt;C$计算$b^{<em>}=y_{j}-\sum_{i=1}^{N} \alpha_{i}^{</em>} y_{i} K\left(x_{i} \cdot x_{j}\right)$,构造决策函数$f(x)=\operatorname{sign}\left(\sum_{i=1}^{N} \alpha_{i}^{<em>} y_{i} K\left(x \cdot x_{i}\right)+b^{</em>}\right)$</p>
<h5 id="常用核函数"><a href="#常用核函数" class="headerlink" title="常用核函数"></a><strong>常用核函数</strong></h5><ol>
<li><strong>多项式核函数(polynomial kernel function)</strong> :$K(x, z)=(x \cdot z+1)^{p}$,对应的支持向量机是一个p次多项式分类器,分类决策函数为:$f(x)=\operatorname{sign}\left(\sum_{i=1}^{N_{i}} a_{i}^{<em>} y_{i}\left(x_{i} \cdot x+1\right)^{p}+b^{</em>}\right)$</li>
<li><strong>高斯核函数(Gaussian krenel function)</strong> :$K(x, z)=\exp \left(-\frac{|x-z|^{2}}{2 \sigma^{2}}\right)$ ,对应的支持向量机是高斯径向基函数(RBF)分类器.分类决策函数为$f(x)=\operatorname{sign}\left(\sum_{i=1}^{N_{t}} a_{i}^{<em>} y_{i} \exp \left(-\frac{|x-z|^{2}}{2 \sigma^{2}}\right)+b^{</em>}\right)$</li>
<li><strong>字符串核函数(string kernel function)</strong>: 核函数不仅可以定义在欧氏空间上,还可以定义在<strong>离散数据的集合</strong>上.字符串核函数给出了字符串中长度等于n的所有子串组成的特征向量的余弦相似度.</li>
</ol>
<h5 id="序列最小最优化-SMO-算法"><a href="#序列最小最优化-SMO-算法" class="headerlink" title="序列最小最优化(SMO)算法"></a><strong>序列最小最优化(SMO)算法</strong></h5><p>SMO是一种<em>快速求解凸二次规划问题</em></p>
<script type="math/tex; mode=display">
\begin{aligned}
&\min _{\alpha} \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j} K\left(x_{i}, x_{j}\right)-\sum_{i=1}^{N} \alpha_{i}\\
&\text { s.t. } \quad \sum_{i=1}^{N} \alpha_{i} y_{i}=0\\
&0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2, \cdots, N
\end{aligned}</script><p>的算法.基本思路是:如果所有变量都满足此优化问题的KKT条件,那么解就得到了.否则,选择<strong>两个变量</strong>,固定其他变量,针对这两个变量构建一个二次规划问题.不断地将原问题分解为<strong>子问题</strong>并对子问题求解,就可以求解原问题.注意子问题两个变量中只有一个是<strong>自由变量</strong>,另一个由<strong>等式约束</strong>确定.</p>
<h5 id="两个变量二次规划的求解方法"><a href="#两个变量二次规划的求解方法" class="headerlink" title="两个变量二次规划的求解方法"></a><strong>两个变量二次规划的求解方法</strong></h5><p>假设选择的两个变量是a1,a2,其他变量是固定的,于是得到子问题</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\begin{aligned}
\min _{\alpha, \alpha_{i}} W\left(\alpha_{1}, \alpha_{2}\right)=& \frac{1}{2} K_{11} \alpha_{1}^{2}+\frac{1}{2} K_{22} \alpha_{2}^{2}+y_{1} y_{2} K_{12} \alpha_{1} \alpha_{2} \\
&-\left(\alpha_{1}+\alpha_{2}\right)+y_{1} \alpha_{1} \sum_{i=1}^{N} y_{i} \alpha_{i} K_{n}+y_{2} \alpha_{2} \sum_{i=1}^{N} y_{i} \alpha_{i} K_{i}
\end{aligned}\\
&\text { s.t. } \quad \alpha_{1} y_{1}+\alpha_{2} y_{2}=-\sum_{i=3}^{N} y_{i} \alpha_{i}=\zeta\\
&0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2
\end{aligned}</script><p>,$\epsilon$是常数,目标函数式省略了不含$a_1,a_2$的常数项.考虑不等式约束和等式约束,要求的是目标函数在一条平行于对角线的线段上的最优值</p>
<p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/1.png" alt="avatar"></p>
<p>问题变为<strong>单变量</strong>的最优化问题.假设初始可行解为aold,最优解为anew,考虑沿着约束方向未经剪辑的最优解anew,unc(即未考虑不等式约束).对该问题求偏导数,并令导数为0,代入原式,令$E_{i}=g\left(x_{i}\right)-y_{i}=\left(\sum_{j=1}^{N} \alpha, y_{j} K\left(x_{j}, x_{i}\right)+b\right)-y_{i}, \quad i=1,2$,得到$\alpha_{2}^{\text {new, } \text { unc }}=\alpha_{2}^{\text {old }}+\frac{y_{2}\left(E_{1}-E_{2}\right)}{\eta}$,经剪辑后a2的解是</p>
<script type="math/tex; mode=display">
\alpha_{2}^{\text {new }}=\left\{\begin{array}{ll}H, & \alpha_{2}^{\text {new }, \text { unc }}>H \\ \alpha_{2}^{\text {new }, \text { unc }}, & L \leqslant \alpha_{2}^{\text {new}, \text { unc}} \leqslant H \\ L, & \alpha_{2}^{\text {new }, \text { unc }}<L\end{array}\right.</script><p>L与H是$a_2^{new}$所在的对角线段端点的界.并解得$\alpha_{1}^{\mathrm{new}}=\alpha_{1}^{\mathrm{old}}+y_{1} y_{2}\left(\alpha_{2}^{\mathrm{old}}-\alpha_{2}^{\mathrm{new}}\right)$</p>
<h5 id="变量的选择方法"><a href="#变量的选择方法" class="headerlink" title="变量的选择方法"></a><strong>变量的选择方法</strong></h5><p>在每个子问题中选择两个变量优化,其中至少一个变量是违反KKT条件的.第一个变量的选取标准是<strong>违反KKT条件最严重</strong>的样本点,第二个变量的选取标准是希望能使该变量有<strong>足够大的变化</strong>,一般可以选取使对应的$|E1-E2|$最大的点.在每次选取完点后,<strong>更新</strong>阈值$b$和差值$Ei$.</p>
<h3 id="提升方法"><a href="#提升方法" class="headerlink" title="提升方法"></a>提升方法</h3><h4 id="提升方法-1"><a href="#提升方法-1" class="headerlink" title="提升方法"></a>提升方法</h4><p>boosting是<strong>一种常用的统计学习方法,是集成学习的一种.它通过改变训练样本的权重(概率分布),学习</strong>多个<strong>弱分类器(基本分类器),并将这些分类器</strong>线性组合**来构成一个强分类器提高分类的性能.</p>
<h4 id="加法模型和前向分步算法"><a href="#加法模型和前向分步算法" class="headerlink" title="加法模型和前向分步算法"></a>加法模型和前向分步算法</h4><p>加法模型$f(x)= \sum_{m=1}^M{\beta_mb(x;\gamma_m)}$,其中，$b(x;\gamma_m)$为基函数，$\gamma_m$为基函数参数，$\beta_m$为基函数的系数。在给定训练数据及损失函数$L(y,f(x))$的条件下，学习加法模型$f(x)$成为经验风险极小化即损失函数极小化问题：</p>
<script type="math/tex; mode=display">
min_{\beta_m,\gamma_m}\sum_{m=1}^{M}{\beta_m b(x_i;\gamma_m)}</script><p>通常这是一个复杂的优化问题。</p>
<p>前向分步算法求解这一优化问题的想法是：因为学习的是加法模型，如果能够从前向后，每一步只学习一个基函数及其系数：$\left(\beta_{m}, \gamma_{m}\right)=\arg \min _{\beta, y} \sum_{i=1}^{N} L\left(y_{i}, f_{m-1}\left(x_{i}\right)+\beta b\left(x_{i} ; \gamma\right)\right)$，得到参数βm和γm,更新$f_{m}(x)=f_{m-1}(x)+\beta_{m} b\left(x ; \gamma_{m}\right)$,逐步逼近优化目标函数式，那么就可以简化优化的复杂度，最终得到加法模型。</p>
<h4 id="AdaBoost"><a href="#AdaBoost" class="headerlink" title="AdaBoost"></a><strong>AdaBoost</strong></h4><h5 id="思想："><a href="#思想：" class="headerlink" title="思想："></a>思想：</h5><p>AdaBoost提高那些被前一轮弱分类器错误分类样本的权值,而降低那些被正确分类样本的权值.然后采取<strong>加权多数表决</strong>的方法组合弱分类器.</p>
<h5 id="算法-5"><a href="#算法-5" class="headerlink" title="算法"></a><strong>算法</strong></h5><p>首先假设训练数据集具有均匀的权值分布D1,使用具有<strong>权值分布</strong>Dm的训练数据集学习得到<strong>基本分类器</strong>Gm(x),计算<strong>分类误差率</strong>$e_{m}=P\left(G_{m}\left(x_{i}\right) \neq y_{i}\right)=\sum_{i=1}^{N} w_{m i} I\left(G_{m}\left(x_{i}\right) \neq y_{i}\right)$和Gm(x)的<strong>系数</strong>$\alpha_{m}=\frac{1}{2} \log \frac{1-e_{m}}{e_{m}}$,更新训练数据集的权值分布$D_{m+1}=\left(w_{m+1,1}, \cdots, w_{m+1, i}, \cdots, w_{m+1, N}\right)$，其中</p>
<script type="math/tex; mode=display">
w_{m+1, i}=\left\{\begin{array}{ll}
\frac{w_{mi}}{Z_{m}} \mathrm{e}^{-\alpha_{m}}, & G_{m}\left(x_{i}\right)=y_{i} \\
\frac{w_{m i}}{Z_{m}} \mathrm{e}^{\alpha_{m}}, & G_{m}\left(x_{i}\right) \neq y_{i}
\end{array}\right.</script><p>$Z_m$是使Dm+1成为概率分布的<strong>规范化因子</strong>$Z_{m}=\sum_{i=1}^{N} w_{m i} \exp \left(-\alpha_{m} y_{i} G_{m}\left(x_{i}\right)\right)$.重复上述操作M次后得到M个弱分类器,构建线性组合得到<strong>最终分类器</strong>$G(x)=\operatorname{sign}(f(x))=\operatorname{sign}\left(\sum_{m=1}^{M} \alpha_{m} G_{m}(x)\right)$</p>
<h4 id="提升树"><a href="#提升树" class="headerlink" title="提升树"></a><strong>提升树</strong></h4><p>提升树是模型为加法模型,算法为前向分布算法,基函数为<strong>决策树</strong>的提升方法.第m步的模型是$f_{m}(x)=f_{m-1}(x)+T\left(x ; \Theta_{m}\right)$,通过经验风险极小化确定下一棵决策树的参数$\hat{\Theta}_{m}=\arg \min _{\theta_{m}} \sum_{i=1}^{N} L\left(y_{i}, f_{m-1}\left(x_{i}\right)+T\left(x_{i} ; \Theta_{m}\right)\right)$.不同问题的提升树学习算法主要区别在于使用的<strong>损失函数</strong>不同.</p>
<h5 id="二类分类问题"><a href="#二类分类问题" class="headerlink" title="二类分类问题"></a><strong>二类分类问题</strong></h5><p>只需将AdaBoost算法中的基本分类器限制为二类分类数即可.</p>
<h5 id="回归问题"><a href="#回归问题" class="headerlink" title="回归问题"></a><strong>回归问题</strong></h5><p>如果将输入空间划分为J个互不相交的区域,并且在每个区域上确定输出的常量$C_j$,那么树可表示为$T(x ; \Theta)=\sum_{j=1}^{J} c_{j} I\left(x \in R_{j}\right)$,其中$\Theta=\left\{\left(R_{1}, c_{1}\right),\left(R_{2}, c_{2}\right), \cdots,\left(R_{J}, c_{J}\right)\right\}$提升树采用<strong>前向分步算法</strong>:</p>
<script type="math/tex; mode=display">
\begin{aligned}
&f_{0}(x)=0\\
&\begin{array}{l}
f_{m}(x)=f_{m-1}(x)+T\left(x ; \Theta_{m}\right), m=1,2, \cdots, M \\
f_{M}(x)=\sum_{m=1}^{M} T\left(x ; \Theta_{m}\right)
\end{array}
\end{aligned}</script><p>.当采用平方误差损失函数时,损失变为</p>
<script type="math/tex; mode=display">
\begin{array}{l}
L\left(y, f_{m-1}(x)+T\left(x ; \Theta_{m}\right)\right) \\
\quad=\left[y-f_{m-1}(x)-T\left(x ; \Theta_{m}\right)\right]^{2} \\
\quad=\left[r-T\left(x ; \Theta_{m}\right)\right]^{2}
\end{array}</script><p>,其中r是当前模型拟合数据的<strong>残差</strong>.每一步都只需<strong>拟合残差</strong>学习一个回归树即可.</p>
<h5 id="存在的缺点"><a href="#存在的缺点" class="headerlink" title="存在的缺点"></a>存在的缺点</h5><p>当损失函数式平方误差损失函数或者交叉熵损失函数的时候，残差即为对应的梯度，这个时候损失函数沿着梯度的方向下降最快。当损失函数式其他损失函数的时候，残差和损失函数的导数并不相等，函数收敛的速度就会没有沿着梯度的方向收敛的快。</p>
<h4 id="梯度提升树-GBDT"><a href="#梯度提升树-GBDT" class="headerlink" title="梯度提升树(GBDT)"></a>梯度提升树(GBDT)</h4><p>利用最速下降法的近似方法来实现每一步的优化,关键在于用损失函数的<strong>负梯度</strong>在当前模型的值$-\left[\frac{\partial L\left(y, f\left(x_{i}\right)\right)}{\partial f\left(x_{i}\right)}\right]_{f(x)=f_{-1}(x)}$作为回归问题中提升树算法中的残差的<strong>近似值</strong>,每一步以此来估计回归树叶结点区域以拟合残差的近似值,并利用线性搜索估计叶结点区域的值使损失函数最小化,然后更新回归树即可.</p>
<h4 id="Xgboost"><a href="#Xgboost" class="headerlink" title="Xgboost"></a>Xgboost</h4><p>相比传统GBDT有以下优点:</p>
<ol>
<li>在优化时用到了二阶导数信息.</li>
<li>在代价函数里加入了正则项.</li>
<li>每次迭代后都将叶子结点的权重乘上一个系数,削弱每棵树的影响.</li>
<li>列抽样.</li>
<li>在训练前对数据进行排序,保存为block结构,并行地对各个特征进行增益计算.</li>
</ol>
<h3 id="EM算法"><a href="#EM算法" class="headerlink" title="EM算法"></a>EM算法</h3><p>EM算法是一种<strong>迭代</strong>算法,用于含有<strong>隐变量</strong>的概率模型参数的极大似然估计.每次迭代由两步组成:E步,求<strong>期望</strong>(expectation),M步,求<strong>极大值</strong>(maximization),直至收敛为止.</p>
<h4 id="隐变量"><a href="#隐变量" class="headerlink" title="隐变量"></a><strong>隐变量</strong></h4><p>不能被直接观察到，但是对系统的状态和能观察到的输出存在影响的一种东西.</p>
<h4 id="算法-6"><a href="#算法-6" class="headerlink" title="算法"></a><strong>算法</strong></h4><ol>
<li>选择参数的初始值θ(0),开始迭代.注意EM算法对初值是<strong>敏感</strong>的.</li>
<li><strong>E步</strong>:θ(i)为第i次迭代参数θ的估计值,在第i+1次迭代的E步,计算$\begin{aligned} Q\left(\theta, \theta^{(i)}\right) &amp;=E_{z}\left[\log P(Y, Z | \theta) | Y, \theta^{(i)}\right] =\sum_{z} \log P(Y, Z | \theta) P\left(Z | Y, \theta^{(i)}\right) \end{aligned}$ ,$P(Z|Y,θ(i))$是在给定<strong>观测数据</strong>Y和当前参数估计θ(i)下<strong>隐变量数据</strong>Z的条件概率分布.</li>
<li><strong>M步</strong>:求使Q(θ,θ(i))极大化的θ,确定第i+1次迭代的参数的估计值$\theta^{(i+1)}=\arg \max _{\theta} Q\left(\theta, \theta^{(i)}\right)$</li>
<li>重复2和3直到<strong>收敛</strong>,一般是对较小的正数$\varepsilon1$和$\varepsilon2$满足$\left|\theta^{(i+1)}-\theta^{(i)}\right|&lt;\varepsilon_{1} \quad$ 或$\quad\left|Q\left(\theta^{(i+1)}, \theta^{(i)}\right)-Q\left(\theta^{(i)}, \theta^{(i)}\right)\right|&lt;\varepsilon_{2}$则停止迭代.</li>
</ol>
<h4 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h4><p>EM算法是通过不断求解<strong>下界</strong>的极大化逼近求解对数似然函数极大化的算法.可以用于生成模型的<strong>非监督学习</strong>.生成模型由联合概率分布P(X,Y)表示.X为观测数据,Y为未观测数据.</p>
<h3 id="隐马尔科夫模型-HMM"><a href="#隐马尔科夫模型-HMM" class="headerlink" title="隐马尔科夫模型(HMM)"></a>隐马尔科夫模型(HMM)</h3><p>隐马尔可夫模型是关于<strong>时序</strong>的概率模型,描述由一个隐藏的马尔可夫链随机生成不可观测的<strong>状态序列</strong>,再由各个状态生成一个观测而产生<strong>观测随机序列</strong>的过程.HMM是一种生成式模型，它的理论基础是朴素贝叶斯，本质上就类似于我们将朴素贝叶斯在单样本分类问题上的应用推广到序列样本分类问题上。</p>
<h4 id="模型表示"><a href="#模型表示" class="headerlink" title="模型表示"></a>模型表示</h4><p>设Q是所有可能的状态的集合$Q=\left\{q_{1}, q_{2}, \cdots, q_{N}\right\}$,V是所有可能的观测的集合$V=\left\{v_{1}, v_{2}, \cdots, v_{M}\right\}$,I是长度为T的状态序列$I=\left(i_{1}, i_{2}, \cdots, i_{T}\right)$, O是对应的观测序列$O=\left(o_{1}, o_{2}, \cdots, o_{T}\right)$,</p>
<ol>
<li>A是<strong>状态转移概率矩阵</strong>$A=\left[a_{i j}\right]_{N \times N}$,$a_{ij}$表示在时刻t处于状态$q_i$的条件下在时刻t+1转移到状态$q_j$的概率.</li>
<li>.B是<strong>观测概率矩阵</strong> $B=\left[b_{j}(k)\right]_{N \times M}$,$b_{ij}$是在时刻t处于状态$q_j$的条件下生成观测$v_k$的概率.</li>
<li>$\pi$是<strong>初始状态概率向量</strong>$\pi=\pi(x)$,$\pi_i$表示时刻t=1处于状态qi的概率.</li>
</ol>
<p>隐马尔可夫模型由初始状态概率向量$pi$,状态转移概率矩阵A以及观测概率矩阵B确定.$\pi$和A决定即隐藏的<strong>马尔可夫链</strong>,生成不可观测的<strong>状态序列</strong>.B决定如何从状态生成观测,与状态序列综合确定了<strong>观测序列</strong>.因此,隐马尔可夫模型可以用<strong>三元符号</strong>表示$\lambda = (A,B,\pi)$</p>
<h4 id="两个基本假设"><a href="#两个基本假设" class="headerlink" title="两个基本假设"></a>两个基本假设</h4><ol>
<li><strong>齐次马尔可夫性假设</strong>:假设隐藏的马尔可夫链在任意时刻t的状态只依赖于其前一时刻的状态.</li>
<li><strong>观测独立性假设</strong>:假设任意时刻的观测只依赖于该时刻的马尔可夫链的状态.</li>
</ol>
<h4 id="三个基本问题"><a href="#三个基本问题" class="headerlink" title="三个基本问题"></a>三个基本问题</h4><h5 id="1-概率计算问题"><a href="#1-概率计算问题" class="headerlink" title="1. 概率计算问题"></a><strong>1. 概率计算问题</strong></h5><p>给定模型$\lambda = (A,B,\pi)$和观测序列,$O=\left(o_{1}, o_{2}, \cdots, o_{T}\right)$计算在模型$\lambda$下观测序列O出现的概率$P(O|λ)$.</p>
<ol>
<li>直接计算：列举所有可能长度为T的状态序列,求各个状态序列I与观测序列O的联合概率,但计算量太大,实际操作不可行.</li>
<li><strong>前向算法</strong>：定义到时刻t部分观测序列为$o_1$~$o_t$且状态为$q_i$的概率为<strong>前向概率</strong>,记作$\alpha_{t}(i)=P\left(o_{1}, o_{2}, \cdots, o_{t}, i_{t}=q_{i} | \lambda\right)$.初始化前向概率$\alpha_{1}(i)=\pi_{i} b_{i}\left(o_{1}\right), \quad i=1,2, \cdots, N$，递推，对$t=1$ ~ $T-1$,$\alpha_{t+1}(i)=\left[\sum_{j=1}^{N} \alpha_{t}(j) a_{j i}\right] b_{i}\left(o_{t+1}\right), \quad i=1,2, \cdots, N$,得到$P(O | \lambda)=\sum_{i=1}^{N} \alpha_{T}(i)$减少计算量的原因在于每一次计算直接引用前一个时刻的计算结果,避免重复计算.</li>
<li><strong>后向算法</strong>:定义在时刻t状态为$q_i$的条件下,从t+1到T的部分观测序列为$o_{i+1}$~$o_T$的概率为<strong>后向概率</strong>,记作$\beta_{t}(i)=P\left(o_{t+1}, o_{t+2}, \cdots, o_{r} | i_{t}=q_{i}, \lambda\right)$.初始化后向概率$\beta_{r}(i)=1, \quad i=1,2, \cdots, N$,递推,对$t=T-1$~$1$$\beta_{t}(i)=\sum_{j=1}^{N} a_{i j} b_{j}\left(o_{i+1}\right) \beta_{i+1}(j), \quad i=1,2, \cdots, N$,得到$P(O | \lambda)=\sum_{i=1}^{N} \pi_{i} b_{i}\left(o_{1}\right) \beta_{1}(i)$</li>
</ol>
<h5 id="2-学习算法"><a href="#2-学习算法" class="headerlink" title="2. 学习算法"></a><strong>2. 学习算法</strong></h5><p>已知观测序列$O=(o_1,o_2, \cdots,o_r)$,估计模型$\lambda = (A,B,\pi)$,的参数,使得在该模型下观测序列概率$p(O|\lambda)$最大.根据训练数据是否包括观察序列对应的状态序列分别由监督学习与非监督学习实现.</p>
<ol>
<li><p>监督学习：估计转移概率$\hat{a}_{i j}=\frac{A_{i j}}{\sum_{j=1}^{N} A_{i j}}, \quad i=1,2, \cdots, N ; \quad j=1,2, \cdots, N$ 和观测概率$\hat{b}_{j}(k)=\frac{B_{j k}}{\sum_{k=1}^{M} B_{j k}}, \quad j=1,2, \cdots, N, k=1,2, \cdots, M$.初始状态概率$\pi_i$的估计为S个样本中初始状态为$q_i$的频率.</p>
</li>
<li><p><strong>非监督学习(Baum-Welch算法)</strong>:将观测序列数据看作观测数据O,状态序列数据看作不可观测的<strong>隐数据</strong>I.首先确定完全数据的对数似然函数$log p(O,I|\lambda)$,求Q函数</p>
<script type="math/tex; mode=display">
\begin{aligned}
Q(\lambda, \bar{\lambda})=& \sum_{t} \log \pi_{i_1} P(O, I | \bar{\lambda}) \\
&+\sum_{I}\left(\sum_{i=1}^{I-1} \log a_{i_t,i_{t+1}}\right) P(O, I | \bar{\lambda}) \\
&+\sum_{I}\left(\sum_{i=1}^{T} \log b_{i_t}\left(o_{t}\right)\right) P(O, I | \bar{\lambda})
\end{aligned}</script><p>,用拉格朗日乘子法极大化Q函数求模型参数$\pi_{i}=\frac{P\left(O, i_{1}=i | \bar{\lambda}\right)}{P(O | \bar{\lambda})}$,$a_{i j}=\frac{\sum_{i=1}^{T-1} P\left(O, i_{t}=i, i_{t+1}=j | \bar{\lambda}\right)}{\sum_{t=1}^{T-1} P\left(O, i_{t}=i | \bar{\lambda}\right)}$,$b_{j}(k)=\frac{\sum_{i=1}^{T} P\left(O, i_{t}=j | \bar{\lambda}\right) I\left(o_{i}=v_{k}\right)}{\sum_{i=1}^{T} P\left(O, i_{t}=j | \bar{\lambda}\right)}$,</p>
</li>
</ol>
<h5 id="3-预测问题"><a href="#3-预测问题" class="headerlink" title="3. 预测问题"></a><strong>3. 预测问题</strong></h5><p>也称为解码问题.已知模型$\lambda = (A,B,\pi)$和观测序列$O=(O_1,O_2,\cdots,O_T)$,求对给定观测序列条件概率$P(I|O)$最大的状态序列$I=(i_1,i_2,\cdots,i_T)$</p>
<ol>
<li><p><strong>近似算法</strong>: 在每个时刻t选择在该时刻最有可能出现的状态$i_t^<em>$,从而得到一个状态序列作为预测的结果.优点是<em>*计算简单</em></em>,缺点是不能保证状态序列整体是最有可能的状态序列</p>
</li>
<li><p><strong>维特比算法</strong>:用<strong>动态规划</strong>求概率最大路径,这一条路径对应着一个状态序列.从t=1开始,递推地计算在时刻t状态为i的各条部分路径的最大概率,直至得到时刻t=T状态为i的各条路径的最大概率.时刻t=T的最大概率即为<strong>最优路径</strong>的概率$P^\star$,最优路径的<strong>终结点</strong>$i_t^\star$也同时得到,之后从终结点开始由后向前逐步求得<strong>结点</strong>,得到最优路径.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">viterbi</span><span class="params">(obs, states, Pi, A, B)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param obs:观测序列</span></span><br><span class="line"><span class="string">    :param states:隐状态</span></span><br><span class="line"><span class="string">    :param Pi:初始概率（隐状态）</span></span><br><span class="line"><span class="string">    :param A:转移概率（隐状态）</span></span><br><span class="line"><span class="string">    :param B: 发射概率 （隐状态表现为显状态的概率）</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 路径概率表 V[时间][隐状态] = 概率</span></span><br><span class="line">    V = [&#123;&#125;]</span><br><span class="line">    <span class="comment"># 一个中间变量，代表当前状态是哪个隐状态</span></span><br><span class="line">    path = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化初始状态 (t == 0)</span></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">        V[<span class="number">0</span>][y] = Pi[y] * B[y][obs[<span class="number">0</span>]]</span><br><span class="line">        path[y] = [y]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对 t &gt; 0 跑一遍维特比算法</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">1</span>, len(obs)):</span><br><span class="line">        V.append(&#123;&#125;)</span><br><span class="line">        newpath = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> states:</span><br><span class="line">            <span class="comment"># 概率 隐状态 =    前状态是y0的概率 * y0转移到y的概率 * y表现为当前状态的概率</span></span><br><span class="line">            (prob, state) = max([(V[t - <span class="number">1</span>][y0] * A[y0][y] * B[y][obs[t]], y0) <span class="keyword">for</span> y0 <span class="keyword">in</span> states])</span><br><span class="line">            <span class="comment"># 记录最大概率</span></span><br><span class="line">            V[t][y] = prob</span><br><span class="line">            <span class="comment"># 记录路径</span></span><br><span class="line">            newpath[y] = path[state] + [y]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 不需要保留旧路径</span></span><br><span class="line">        path = newpath</span><br><span class="line"></span><br><span class="line">    print_dptable(V)</span><br><span class="line">    (prob, state) = max([(V[len(obs) - <span class="number">1</span>][y], y) <span class="keyword">for</span> y <span class="keyword">in</span> states])</span><br><span class="line">    <span class="keyword">return</span> (prob, path[state])</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 打印路径概率表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_dptable</span><span class="params">(V)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"    "</span>,</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(V)): <span class="keyword">print</span> <span class="string">"%7d"</span> % i,</span><br><span class="line">    <span class="keyword">print</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> V[<span class="number">0</span>].keys():</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"%.5s: "</span> % y,</span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> range(len(V)):</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"%.7s"</span> % (<span class="string">"%f"</span> % V[t][y]),</span><br><span class="line">        <span class="keyword">print</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="最大熵马尔科夫模型-MEMM"><a href="#最大熵马尔科夫模型-MEMM" class="headerlink" title="最大熵马尔科夫模型(MEMM)"></a>最大熵马尔科夫模型(MEMM)</h3><p>最大熵马尔科夫模型利用判别式模型的特点，直接对每一个时刻的状态建立一个分类器，然后将所有的分类器的概率值连乘起来$P\left(y_{1}^{n} | x_{1}^{n}\right)=\prod_{t=1}^{n} P\left(y_{t} | y_{t-1}, x_{t}\right)$。为了实现是对整个序列进行的分类，在每个时刻t时，它的特征不仅来自当前观测值$x_t$，而且还来自前一状态值$y_{t-1}$,通过最大熵分类器建模$P\left(y_{t}=y^{<em>} | y_{t-1}=y^{\prime}, x_{t}\right)=\frac{1}{Z\left(x_{t}, y^{\prime}\right)} \exp \left(\sum_{a} \lambda_{a} f_{a}\left(x_{t}, y^{\prime}, y^{</em>}\right)\right)$,其中，$Z\left(x_{t}, y \prime\right)=\sum_{y} \exp \left(\sum_{a} \lambda_{a} f_{a}\left(x_{t}, y \prime, y\right)\right)$，</p>
<h4 id="标注偏置问题"><a href="#标注偏置问题" class="headerlink" title="标注偏置问题"></a>标注偏置问题</h4><p>使用维特比算法进行解码时，$v_{t}(j)=\max _{i} v_{t-1}(i) * P\left(y_{j} | y_{i}, x_{t}\right) 1 \leq j \leq n, 1&lt;t&lt;T$。最大熵模型在每一个时刻，针对不同的前一状态y′进行归一化操作，这是一种局部的归一化操作，会存在标签偏置问题。</p>
<h5 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h5><p><img src="/2020/01/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E6%80%BB%E7%BB%93/label_bias.png" alt="avatar"></p>
<p>状态转换(1→2),(2→3),(4→5),(5→3)的概率值都是1，而无论观测值是什么，换言之有$P(2|1,i)=P(2|1,o)=1$</p>
<p>你可能会很惊讶$P(2∣1,i)=1,P(2∣1,o)=1$怎么可能会成立呢？你可以套用上面的公式试一试，由于状态”1”的只能转换为”2”，所以计算归一化项时， 其实只有一个枚举值，就是状态”2”，所以无论你分子为多少，分母都和它一样，所以概率值就是1。在这种情况下，其实观测值并没有任何作用，这就是标签偏置。</p>
<h5 id="后果："><a href="#后果：" class="headerlink" title="后果："></a><strong>后果：</strong></h5><p>它会造成什么后果呢？<br>他会导致模型进行预测时只依赖数据统计出来的概率值，没有利用到样本的特征。<br>假设训练集现在有3个rib和1个rob，当我们在测试阶段，遇到词rob，它会被解码成什么状态序列呢？答案是(0→1→2→3)！你可以套公式试一试，因为$P(1∣0,r)&gt;P(4∣0,r)$,$P(2∣1,o)=P(5∣4,0)=1,P(3∣2,b)&gt;P(3∣5,b)$。</p>
<h5 id="原因"><a href="#原因" class="headerlink" title="原因"></a><strong>原因</strong></h5><p>那么问题出在哪里呢？因为MEMM中在每一时刻t，都在前一时刻某状态y′下做了局部的归一化操作，如何解决这种标签偏置问题呢？<br>在CRF中并不是对每个时刻都进行一次分类，而是直接对整个序列进行分类，做一个全局的归一化操作。</p>
<h3 id="条件随机场CRF"><a href="#条件随机场CRF" class="headerlink" title="条件随机场CRF"></a>条件随机场CRF</h3><h4 id="概率图模型"><a href="#概率图模型" class="headerlink" title="概率图模型"></a>概率图模型</h4><p>结点表示随机变量，边表示随机变量之间的概率依赖关系。</p>
<h5 id="马尔科夫性"><a href="#马尔科夫性" class="headerlink" title="马尔科夫性"></a>马尔科夫性</h5><ol>
<li>成对马尔可夫性</li>
<li>局部马尔科夫性</li>
<li>全局马尔科夫性</li>
</ol>
<h5 id="概率无向图模型的因式分解"><a href="#概率无向图模型的因式分解" class="headerlink" title="概率无向图模型的因式分解"></a>概率无向图模型的因式分解</h5><h6 id="团与最大团"><a href="#团与最大团" class="headerlink" title="团与最大团"></a>团与最大团</h6><p>无向图G中任何两个结点均有边连接的结点子集称为<strong>团</strong>。若C是无向图G的一个团，并且不能再加进任何一个G的结点使其成为一个更大的团，称此C为<strong>最大团</strong>。</p>
<p>给定概率无向图模型，设其无向图为G，C为G上的最大团，$Y_C$表示C对应的随机变量。那么概率无向图模型的联合概率分布$P(Y)$可写作图中所有最大团C上的函数$\phi_C(Y_C)$的乘积的形式。</p>
<p><strong>Hammersley-Clifford定理</strong><br>概率无向图模型的联合概率分布$P(Y)$可以表示为如下形式：</p>
<script type="math/tex; mode=display">
P(Y)=\frac{1}{Z}\prod_C{\phi_C(Y_C)}\\
Z=\sum_Y\prod_C{\phi_C(Y_C)}</script><h5 id="条件随机场CRF-1"><a href="#条件随机场CRF-1" class="headerlink" title="条件随机场CRF"></a>条件随机场CRF</h5><p>条件随机场基于概率无向图模型，利用最大团理论，对随机变量的联合分布$P(Y)$进行建模。</p>
<p>在序列标注任务中的条件随机场，往往是指<strong>线性链条件随机场</strong></p>
<h6 id="条件随机场的参数化形式"><a href="#条件随机场的参数化形式" class="headerlink" title="条件随机场的参数化形式"></a>条件随机场的参数化形式</h6><script type="math/tex; mode=display">
P(y|x)=\frac{1}{Z(x)} \exp \left(\sum_{i, k} \lambda_{k} t_{k}\left(y_{i-1}, y_{i}, x, i\right)+\sum_{i, j} \mu_{l} s_{l}\left(y_{i}, x, i\right)\right) 
\\
Z(x)=\sum_{y} \exp \left(\sum_{i, k} \lambda_{k} t_{k}\left(y_{i-1}, y_{i}, x, i\right)+\sum_{i, j} \mu_{l} s_{l}\left(y_{i}, x, i\right)\right)</script><h6 id="条件随机场的简化形式"><a href="#条件随机场的简化形式" class="headerlink" title="条件随机场的简化形式"></a>条件随机场的简化形式</h6><script type="math/tex; mode=display">
\begin{aligned}
P(y | x) &=\frac{1}{Z(x)} \exp \sum_{k=1}^{K} w_{k} f_{k}(y, x) \\
Z(x) &=\sum_{y} \exp \sum_{k=1}^{K} w_{k} f_{k}(y, x)
\end{aligned}</script><h6 id="条件随机场的矩阵形式"><a href="#条件随机场的矩阵形式" class="headerlink" title="条件随机场的矩阵形式"></a>条件随机场的矩阵形式</h6><script type="math/tex; mode=display">
P_{w}(y | x)=\frac{1}{Z_{w}(x)} \prod_{i=1}^{n+1} M_{i}\left(y_{i-1}, y_{i} | x\right)\\
Z_{w}(x)=\left(M_{1}(x) M_{2}(x) \cdots M_{n+1}(x)\right)_{\text {start, stop }}</script><h3 id="K-Means"><a href="#K-Means" class="headerlink" title="K-Means"></a>K-Means</h3><p>K-Means是<strong>无监督</strong>的<strong>聚类</strong>算法.思想是对于给定的样本集,按照样本之间的距离大小将样本集划分为K个簇,让簇内的点尽量紧密地连在一起,而让簇间的距离尽量的大.</p>
<h4 id="传统算法"><a href="#传统算法" class="headerlink" title="传统算法"></a>传统算法</h4><ol>
<li>用先验知识或交叉验证选择一个合适的<strong>k</strong>值.</li>
<li>随机选择k个样本作为初始的<strong>质心</strong>.注意初始化质心的选择对最后的聚类结果和运行时间都有很大的影响.</li>
<li>计算每个样本点和各个质心的距离,将样本点标记为<strong>距离最小</strong>的质心所对应的簇.</li>
<li>重新计算每个<strong>簇</strong>的质心,取该簇中每个点位置的平均值.</li>
<li>重复2,3,4步直到k个质心都没有发生变化为止.</li>
</ol>
<h4 id="K-Means-1"><a href="#K-Means-1" class="headerlink" title="K-Means++"></a>K-Means++</h4><p>用于优化随机初始化质心的方法</p>
<ol>
<li>从输入样本点中随机选择一个点作为第一个质心.</li>
<li>计算每一个样本点到已选择的质心中<strong>最近质心</strong>的距离D(x).</li>
<li>选择一个新的样本点作为新的质心,选择原则是D(x)越大的点被选中的概率越大.</li>
<li>重复2和3直到选出k个质心.</li>
</ol>
<h4 id="Elkan-K-Means"><a href="#Elkan-K-Means" class="headerlink" title="Elkan K-Means"></a><strong>Elkan K-Means</strong></h4><p>利用两边之和大于第三边以及两边之差小于第三边来减少距离的计算.不适用于特征稀疏的情况.</p>
<h4 id="Mini-Batch-K-Means"><a href="#Mini-Batch-K-Means" class="headerlink" title="Mini Batch K-Means"></a><strong>Mini Batch K-Means</strong></h4><p>样本量很大时,只用其中的一部分来做传统的K-Means.一般多用几次该算法,从不同的随即采样中选择最优的聚类簇.</p>
<h3 id="Apriori"><a href="#Apriori" class="headerlink" title="Apriori"></a>Apriori</h3><p>Apriori是常用的挖掘出<strong>数据关联规则</strong>的算法,用于找出数据值中<strong>频繁</strong>出现的数据集合.一般使用支持度或者支持度与置信度的组合作为<strong>评估标准</strong>.</p>
<ol>
<li>支持度：几个关联的数据在数据集中出现的次数占总数据集的比重Support$(X, Y)=P(X Y)=\frac{\text {number}(X Y)}{\text {num}(\text {AllSamples})}$</li>
<li><strong>置信度</strong>：一个数据出现后.另一个数据出现的概率Confidence$(X \Leftarrow Y)=P(X | Y)=P(X Y) / P(Y)$</li>
</ol>
<p>Apriori算法的目标是找到最大的<strong>K项频繁集</strong>.假设使用支持度来作为评估标准,首先搜索出<strong>候选1项集</strong>及对应的支持度,<strong>剪枝</strong>去掉低于支持度的1项集,得到<strong>频繁1项集</strong>.然后对剩下的频繁1项集进行<strong>连接</strong>,得到候选的频繁2项集……以此类推,不断迭代,直到无法找到频繁k+1项集为止,对应的频繁k项集的集合即为输出结果.</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol>
<li><a href="https://blog.csdn.net/qq_20989105/article/details/81218696" target="_blank" rel="noopener">HMM隐马尔可夫模型与viterbi维特比算法</a></li>
</ol>
]]></content>
      <categories>
        <category>统计学习方法</category>
      </categories>
      <tags>
        <tag>机器学习</tag>
        <tag>统计学习方法</tag>
      </tags>
  </entry>
  <entry>
    <title>scrapy</title>
    <url>/2019/08/31/scrapy/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id><a href="#" class="headerlink" title=" "></a> </h3><p><img src="/2019/08/31/scrapy/scrapy_framework.png" alt="avatar"></p>
<a id="more"></a>
<p><a href="https://scrapy-chs.readthedocs.io/zh_CN/1.0/" target="_blank" rel="noopener">scrapy中文文档</a></p>
<h3 id="1-编写scrapy爬虫步骤"><a href="#1-编写scrapy爬虫步骤" class="headerlink" title="1. 编写scrapy爬虫步骤"></a>1. 编写scrapy爬虫步骤</h3><ol>
<li><p>新建项目：（scrapy startproject projectname）:新建爬虫项目</p>
</li>
<li><p>创建爬虫：scrapy genspider spidername “<a href="http://www.xxx.cn/" target="_blank" rel="noopener">http://www.xxx.cn/</a>“</p>
</li>
<li><p>明确目标：（编写items.py）：明确想要抓取的目标</p>
</li>
<li><p>制作爬虫：（spiders/xxspider.py）:制作爬虫开始爬取的网页</p>
</li>
<li><p>编写pipeline.py，处理spider返回的item数据。写Pipeline函数</p>
</li>
<li><p>编写settings.py,启动管道组件ITEM_PIPELINES={}，以及其他相关设置USER_AGENT,DEFAULT_REQUEST_HEADERS</p>
</li>
<li><p>执行爬虫</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> cmdline</span><br><span class="line">cmdline.execute([<span class="string">'scrapy'</span>,<span class="string">'crawl'</span>,<span class="string">'cib'</span>])</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="2-创建爬虫"><a href="#2-创建爬虫" class="headerlink" title="2. 创建爬虫"></a>2. 创建爬虫</h3><ol>
<li>scrapy genspider spidername “<a href="http://www.xxx.cn/" target="_blank" rel="noopener">http://www.xxx.cn/</a>“<ul>
<li>genspider:表示生成一个爬虫（默认是scrapy.Spider类）</li>
<li>spidername：表示爬虫名（对应爬虫代码里的name参数）</li>
<li>“<a href="http://www.xxx.cn/" target="_blank" rel="noopener">http://www.xxx.cn/</a>“ ：表示允许爬虫爬取的域范围</li>
</ul>
</li>
<li>spidername.py<ul>
<li>name= ‘’:爬虫的识别名称，唯一</li>
<li>allow_domains=[] ：搜索的域名范围，爬虫的约束区域，规定爬虫只爬取这个域名下的网页，不存在的url会被忽略</li>
<li>start_urls=():爬取的url列表。爬虫从这里开始抓取数据，所以，第一次下载的数据将会从这些urls开始。其他子URL将会从这些起始URL中继承性生成</li>
<li>parse(self,response):解析的方法，每个初始URL完成下载后将被调用，调用的时候传入每一个URL传回的Response对象来作为唯一参数，主要作用如下：</li>
<li>负责解析返回的网页数据（response.body），提取结构化数据（生成item）</li>
<li>生成需要下一页的URL请求</li>
<li>start_requests(self):这个方法必须返回一个可迭代对象。该对象包含spider用于爬取（默认实现是使用start_urls的url）的第一个Request。当spider启动爬取并且为指定start_urls时，调用该方法</li>
<li>log（self,message[,level,component]）:使用scrapy.log.msg()方法记录（log）message</li>
</ul>
</li>
</ol>
<h3 id="3-执行爬虫"><a href="#3-执行爬虫" class="headerlink" title="3. 执行爬虫"></a>3. 执行爬虫</h3><ol>
<li>scrapy crawl spidername -o save_filename<ul>
<li>crawl：表示启动一个scrapy爬虫</li>
<li>spidername：表示需要启动的爬虫名（对应爬虫代码里的name参数）</li>
<li>-0 :表示输出到文件</li>
<li>save_filename:表示保存文件的名称,，默认4种输出文件格式：json，jsonl，csv，xml</li>
</ul>
</li>
</ol>
<h3 id="4-查看当前项目下的爬虫"><a href="#4-查看当前项目下的爬虫" class="headerlink" title="4. 查看当前项目下的爬虫"></a>4. 查看当前项目下的爬虫</h3><ol>
<li>scrapy list</li>
</ol>
<h3 id="5-pipeline-的一些典型应用"><a href="#5-pipeline-的一些典型应用" class="headerlink" title="5. pipeline 的一些典型应用"></a>5. pipeline 的一些典型应用</h3><ol>
<li>验证爬取的数据（检查item包含某些字段，比如说name）</li>
<li>数据查重（并丢弃）</li>
<li>将爬取结果保存到文件或者数据库中</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomethingPiple</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="comment"># 可选实现，做参数初始化，比如打开文件操作f.open('xxx','w',edcoding='utf-8')</span></span><br><span class="line">            <span class="comment"># doing something</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self,spider)</span>:</span></span><br><span class="line">            <span class="comment"># spider(Spider 对象) - 被关闭的spider</span></span><br><span class="line">            <span class="comment"># 可选实现，当spider被开启时，这个方法被调用。</span></span><br><span class="line">            <span class="comment"># 该方法和__init__方法功能基本相同。</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self,item,spider)</span>:</span></span><br><span class="line">            <span class="comment"># item(Item对象) - 被爬取的item</span></span><br><span class="line">            <span class="comment"># spider （Spider对象） - 爬取该item的spider</span></span><br><span class="line">            <span class="comment"># 这个方法必须实现，每个item pipeline 组件都需要调用该方法</span></span><br><span class="line">            <span class="comment"># 这个方法必须返回一个Item对象，被丢弃的item将不会被之后的pipeline组件处理</span></span><br><span class="line">            <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self,spider)</span>:</span></span><br><span class="line">            <span class="comment"># spider(Spider 对象) - 被关闭的spider</span></span><br><span class="line">            <span class="comment"># 可选实现，当spider被关闭时，这个方法被调用。</span></span><br><span class="line">            <span class="comment"># 比如关闭初始化打开的文件f.close()</span></span><br></pre></td></tr></table></figure>
<h3 id="6-启动Scrapy-Shell"><a href="#6-启动Scrapy-Shell" class="headerlink" title="6. 启动Scrapy Shell"></a>6. 启动Scrapy Shell</h3><p>命令：scrapy shell “www.baidu.com”</p>
<h3 id="7-selector-选择器"><a href="#7-selector-选择器" class="headerlink" title="7. selector 选择器"></a>7. selector 选择器</h3><ol>
<li><p>Selector有四个基本方法，最常用的是xpath：</p>
<ol>
<li><p>xpath（）：传入xpath表达式，返回该表达式所对应的所有节点的selector list列表</p>
<p>XPath表达式的例子及对应含义：</p>
<ul>
<li>/html/head/title:选择<html>文档中<head>标签内的<title>元素</title></head></html></li>
<li>/html/head/title/text():选择<html>文档中<head>标签内的<title>元素的文字</title></head></html></li>
<li>//td：选择所有的<td>元素</td></li>
<li>//div[@class=”mine”]:选择所有具有class=”mine”属性的div元素</li>
</ul>
</li>
<li><p>extract（）：序列化该结点为Unicode字符串，并返回list</p>
</li>
<li><p>css()：传入css表达式，返回该表达式所对应的所有节点的selector list列表，语法同BeautifulSoup4</p>
</li>
<li><p>re()：根据传入的正则表达式对数据进行提取，返回Unicode字符串list列表</p>
</li>
</ol>
</li>
<li><p>注意</p>
<ol>
<li><p>xpath 返回的是一个列表</p>
</li>
<li><p>xpath.extract():将xpath对象转换成Unicode字符串</p>
</li>
<li><p>settings设置</p>
<ul>
<li><p>HTTPERROR_ALLOWED_CODES = [403, 500, 404]</p>
</li>
<li><p>ROBOTSTXT_OBEY = False</p>
</li>
<li><p>下载中间件：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DOWNLOAD_DELAY = <span class="number">2</span></span><br><span class="line">        RANDOMIZE_DOWNLOAD_DELAY = <span class="literal">True</span></span><br><span class="line">        COOKIES_ENABLED = <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">        <span class="string">'bank_info.middlewares.MyUserAgentMiddleware'</span>: <span class="number">300</span>,</span><br><span class="line">        <span class="string">'bank_info.middlewares.BankInfoDownloaderMiddleware'</span>: <span class="number">543</span>, <span class="comment"># 值越小优先级越高</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        ITEM_PIPELINES = &#123;</span><br><span class="line">        <span class="string">'bank_info.pipelines.BankInfoPipeline'</span>: <span class="number">300</span>, <span class="comment"># 值越小优先级越高</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="8-scrapy高级"><a href="#8-scrapy高级" class="headerlink" title="8. scrapy高级"></a>8. scrapy高级</h3><ol>
<li><p>翻页功能：scrapy.follow(next_page,callback=self.parse)   会自动拼接url和next_page</p>
</li>
<li><p>抽取response中满足xpath规则的链接：LinkExtractor(restrict_xpath=’xxxx’), links = link.extract_links(response)</p>
</li>
<li><p>要防止scrapy被ban，主要有以下几个策略：</p>
<ul>
<li><p>动态设置user agent（ 在middleware.py中随机选取user-agent,并把它赋值给request）</p>
<ol>
<li><p>在settings开启UAMiddleware这个中间件：DOWNLOADER_MIDDLEWARES</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UAMiddleware</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># 定义一个User-Agent的List</span></span><br><span class="line">    ua_list = [</span><br><span class="line">    <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 '</span>,</span><br><span class="line">    <span class="string">'(KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36'</span>,</span><br><span class="line">    <span class="string">'Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)'</span>,</span><br><span class="line">    <span class="string">'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)'</span>,</span><br><span class="line">    <span class="string">'Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)'</span>,</span><br><span class="line">    <span class="string">'Mozilla/5.0 (compatible; bingbot/2.0; +http://www.bing.com/bingbot.htm)'</span>,</span><br><span class="line">    ]</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request, spider)</span>:</span> <span class="comment"># 对request进行拦截</span></span><br><span class="line">        ua = random.choices(self.ua_list) <span class="comment"># 使用random模块，随机在ua_list中选取User-Agent</span></span><br><span class="line">        request.headers[<span class="string">'User-Agent'</span>] = ua <span class="comment"># 把选取出来的User-Agent赋给request</span></span><br><span class="line">        print(request.url) <span class="comment"># 打印出request的url</span></span><br><span class="line">        print(request.headers[<span class="string">'User-Agent'</span>]) <span class="comment"># 打印出request的headers</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response, spider)</span>:</span> <span class="comment"># 对response进行拦截</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(self, request, exception, spider)</span>:</span> <span class="comment"># 对process_request方法传出来的异常进行处理</span></span><br><span class="line">       <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>禁用cookies ： COOKIES_ENABLED=False</p>
</li>
<li><p>设置延迟下载 ： DOWNLOAD_DELAY=2</p>
</li>
<li><p>使用Google cache</p>
</li>
<li><p>使用IP地址池（Tor project、VPN和代理IP）</p>
</li>
<li><p>使用Crawlera</p>
</li>
</ul>
</li>
<li><p>scrapy中间件的分类：</p>
<ul>
<li>scrapy的中间件理论上有三种(Schduler Middleware,Spider Middleware,Downloader Middleware),在应用上一般有以下两种：<ol>
<li>爬虫中间件Spider Middleware：可以添加代码来处理发送给 Spiders 的response及spider产生的item和request.<ul>
<li>当蜘蛛传递请求和items给引擎的过程中，蜘蛛中间件可以对其进行处理（过滤出 URL 长度比 URLLENGTH_LIMIT 的 request。）</li>
<li>当引擎传递响应给蜘蛛的过程中，蜘蛛中间件可以对响应进行过滤（例如过滤出所有失败(错误)的 HTTP response）</li>
</ul>
</li>
<li>下载器中间件Downloader Middleware：主要功能在请求到网页后,页面被下载时进行一些处理.（反爬策略都是部署在下载中间件的）<ul>
<li>当引擎传递请求给下载器的过程中，下载中间件可以对请求进行处理 （例如增加http header信息，增加proxy信息等）</li>
<li>在下载器完成http请求，传递响应给引擎的过程中， 下载中间件可以对响应进行处理（例如进行gzip的解压等）</li>
<li>下载中间件三大函数：<ol>
<li>process_request(request, spider)——主要函数<ul>
<li>process_request() 必须返回其中之一: 返回 None 、返回一个 Response 对象、返回一个 Request 对象或raise IgnoreRequest</li>
<li>如果其返回 None： Scrapy将继续处理该request，执行其他的中间件的相应方法，直到合适的下载器处理函数(download handler)被调用， 该request被执行(其response被下载)</li>
<li>如果其返回Response 对象： Scrapy将不会调用任何其他的process_request()或 process_exception()方法，或相应的下载函数。其将返回该response，已安装的中间件的 process_response() 方法则会在每个response返回时被调用</li>
<li>如果其返回 Request对象 ： Scrapy则会停止调用 process_request方法并重新调度返回的request，也就是把request重新返回，进入调度器重新入队列</li>
<li>如果其返回raise IgnoreRequest异常 ： 则安装的下载中间件的 process_exception()方法 会被调用。如果没有任何一个方法处理该异常， 则request的errback(Request.errback)方法会被调用。如果没有代码处理抛出的异常， 则该异常被忽略且不记录(不同于其他异常那样)</li>
</ul>
</li>
<li>process_response(request, response, spider)——主要函数<ul>
<li>process_response() 必须返回以下之一：返回一个Response 对象、 返回一个Request 对象或raise IgnoreRequest 异常</li>
<li>如果其返回一个 Response对象： (可以与传入的response相同，也可以是全新的对象)， 该response会被在链中的其他中间件的 process_response() 方法处理</li>
<li>如果其返回一个 Request对象： 则中间件链停止， 返回的request会被重新调度下载。处理类似于 process_request() 返回request所做的那样</li>
<li>如果其抛出一个IgnoreRequest异常 ：则调用request的errback(Request.errback)。</li>
<li>如果没有代码处理抛出的异常，则该异常被忽略且不记录(不同于其他异常那样)</li>
</ul>
</li>
<li>process_exception(request, exception, spider)<ul>
<li>如果其返回 None ： Scrapy将会继续处理该异常，接着调用已安装的其他中间件的 process_exception()方法，直到所有中间件都被调用完毕，则调用默认的异常处理</li>
<li>如果其返回一个 Response 对象： 相当于异常被纠正了，则已安装的中间件链的 process_response()方法被调用。Scrapy将不会调用任何其他中间件的 process_exception()方法</li>
<li>如果其返回一个 Request 对象： 则返回的request将会被重新调用下载。这将停止中间件的 process_exception() 方法执行，就如返回一个response的那样</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li><p>其他内置downloader middleware</p>
<p>| item | value |<br>| —- | —- |<br>| DefaultHeadersMiddleware | 将所有request的头设置为默认模式 |<br>| DownloadTimeoutMiddleware | 设置request的timeout |<br>| HttpAuthMiddleware | 对来自特定spider的request授权 |<br>| HttpCacheMiddleware | 给request&amp;response设置缓存策略 |<br>| HttpProxyMiddleware | 给所有request设置http代理 |<br>| RedirectMiddleware | 处理request的重定向 |<br>| MetaRefreshMiddleware | 根据meta-refresh html tag处理重定向 |<br>| RetryMiddleware | 失败重试策略 |<br>| RobotsTxtMiddleware | robots封禁处理 |<br>| UserAgentMiddleware | 支持user agent重写 |</p>
</li>
<li><p>把数据保存到json文件</p>
<p>下面这个例子将会把所有爬虫所爬取到的数据保存到 items.jl 文件中，.jl既是表示 JSON Lines 格式，既是每一行存储一个 item；</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JsonWriterPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.file = open(<span class="string">'items.jl'</span>, <span class="string">'w'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.file.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        line = json.dumps(dict(item)) + <span class="string">"\n"</span></span><br><span class="line">        self.file.write(line)</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>
</li>
<li><p>把数据写到MongoDB</p>
<p>MongoDB address 以及 database name 是通过 Scrapy settings 配置的；下面这个用例主要用来展示如何使用 from_crawler 的用法以及如何正确的清理掉这些相关的 resources</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MongoPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    collection_name = <span class="string">'scrapy_items'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, mongo_uri, mongo_db)</span>:</span></span><br><span class="line">        self.mongo_uri = mongo_uri</span><br><span class="line">        self.mongo_db = mongo_db</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_crawler</span><span class="params">(cls, crawler)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls(</span><br><span class="line">            mongo_uri=crawler.settings.get(<span class="string">'MONGO_URI'</span>),</span><br><span class="line">            mongo_db=crawler.settings.get(<span class="string">'MONGO_DATABASE'</span>, <span class="string">'items'</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.client = pymongo.MongoClient(self.mongo_uri)</span><br><span class="line">        self.db = self.client[self.mongo_db]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.client.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        self.db[self.collection_name].insert_one(dict(item))</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="9-爬取动态页面"><a href="#9-爬取动态页面" class="headerlink" title="9. 爬取动态页面"></a>9. 爬取动态页面</h3><p>在scrapy中使用splash</p>
<ol>
<li><p>安装docker ：</p>
</li>
<li><p>安装splash：docker pull scrapinghub/splash</p>
</li>
<li><p>开启端口:docker run -p 5023:5023 -p 8050:8050 -p 8051:8051 scrapinghub/splash</p>
</li>
<li><p>安装 scrapy-splash: pip install scrapy-splash</p>
</li>
<li><p>修改setting.py文件对scrapy-splash进行配置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Splash服务器地址</span></span><br><span class="line"><span class="string">SPLASH_URL</span> <span class="string">=</span> <span class="string">'http://localhost:8050'</span></span><br><span class="line"><span class="comment">#开启Splash的两个下载中间件并调整HttpCompressionMiddleware的次序</span></span><br><span class="line"> <span class="string">DOWNLOADER_MIDDLEWARES</span> <span class="string">=</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">'scrapy_splash.SplashCookiesMiddleware':</span> <span class="number">723</span><span class="string">,</span></span><br><span class="line">    <span class="attr">'scrapy_splash.SplashMiddleware':</span> <span class="number">725</span><span class="string">,</span></span><br><span class="line">    <span class="attr">'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware':</span> <span class="number">810</span><span class="string">,</span></span><br><span class="line"> <span class="string">&#125;</span></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line"> <span class="comment">#设置去重过滤器</span></span><br><span class="line"> <span class="string">DUPEFILTER_CLASS</span> <span class="string">=</span> <span class="string">'scrapy_splash.SplashAwareDupeFilter'</span></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line"> <span class="comment">#用来支持cache_args（可选）</span></span><br><span class="line"> <span class="string">SPIDER_MIDDLEWARES</span> <span class="string">=</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">'scrapy_splash.SplashDeduplicateArgsMiddleware':</span> <span class="number">100</span><span class="string">,</span></span><br><span class="line"> <span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>爬虫</category>
      </categories>
      <tags>
        <tag>专业技能</tag>
      </tags>
  </entry>
  <entry>
    <title>selenium</title>
    <url>/2019/08/09/selenium/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2019/08/09/selenium/1_hdbXQfve5Yfuo0qEnS8K9Q.jpg" alt></p>
<a id="more"></a>
<h1 id="安装：pip-install-selenium"><a href="#安装：pip-install-selenium" class="headerlink" title="安装：pip install selenium"></a>安装：pip install selenium</h1><p>因为selenium是配合浏览器一起使用，所以需要下载浏览器的驱动(webdriver)，以chrome为例：chrome的webdriver： <a href="http://chromedriver.storage.googleapis.com/index.html" target="_blank" rel="noopener">chromedriver</a> 不同的Chrome的版本对应的chromedriver.exe 版本也不一样。如果是最新的Chrome, 下载最新的chromedriver.exe 就可以。把chromedriver的路径也加到<strong>环境变量</strong>里</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver      <span class="comment"># 引入webdriver api</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()     <span class="comment"># 使用chrome浏览器声明一个webdriver对象</span></span><br><span class="line"><span class="comment"># driver = webdriver.Chrome('/your path /webdriver')</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  driver.get(<span class="string">'http://www.baidu.com/'</span>) <span class="comment"># 表示使用chrome以get的方式请求百度的url</span></span><br><span class="line">  driver.find_element_by_id(<span class="string">"kw"</span>).send_keys(<span class="string">"selenium"</span>)   <span class="comment"># 检索到百度的输入框，输入selenium</span></span><br><span class="line">  driver.find_element_by_id(<span class="string">"su"</span>).click() <span class="comment"># 检索到百度的搜索按钮并点击</span></span><br><span class="line">  wait = WebDriverWait(driever,<span class="number">10</span>) <span class="comment"># 等待加载</span></span><br><span class="line">  wait.until(EC.presence_of_element_located((By.ID,<span class="string">'content_left'</span>)))</span><br><span class="line">  print(driver.current_url)  <span class="comment"># 输出当前页面url</span></span><br><span class="line">  print(driver.get_cookies) <span class="comment"># 输出cookies</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">  driver.close()</span><br></pre></td></tr></table></figure>
<h1 id="元素选取"><a href="#元素选取" class="headerlink" title="元素选取"></a>元素选取</h1><h2 id="单元素选取"><a href="#单元素选取" class="headerlink" title="单元素选取"></a>单元素选取</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">find_element_by_id      <span class="comment"># 通过元素id</span></span><br><span class="line">find_element_by_name    <span class="comment"># 通过name属性</span></span><br><span class="line">find_element_by_xpath   <span class="comment"># 通过xpath</span></span><br><span class="line">find_element_by_link_text   <span class="comment"># 通过链接文本</span></span><br><span class="line">find_element_by_partial_link_text</span><br><span class="line">find_element_by_tag_name    <span class="comment"># 通过标签名</span></span><br><span class="line">find_element_by_class_name      <span class="comment"># 通过class名称定位</span></span><br><span class="line">find_element_by_css_selector    <span class="comment"># 通过css选择器定位</span></span><br></pre></td></tr></table></figure>
<h2 id="多元素选取"><a href="#多元素选取" class="headerlink" title="多元素选取"></a>多元素选取</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">find_elements_by_name</span><br><span class="line">find_elements_by_xpath</span><br><span class="line">find_elements_by_link_text</span><br><span class="line">find_elements_by_partial_link_text</span><br><span class="line">find_elements_by_tag_name</span><br><span class="line">find_elements_by_class_name</span><br><span class="line">find_elements_by_css_selector</span><br></pre></td></tr></table></figure>
<h2 id="元素操作"><a href="#元素操作" class="headerlink" title="元素操作"></a>元素操作</h2><ul>
<li>clear 清除元素的内容：clear(self)</li>
<li>send_keys 模拟按键输入：send_keys(self, *value)</li>
<li>click 点击元素：click(self)</li>
<li>submit 提交表单：submit(self)</li>
<li>获取元素属性：get_attribute(self, name)</li>
<li>获取元素文本：text</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">driver.find_element_by_id(<span class="string">"kw"</span>).clear()</span><br></pre></td></tr></table></figure>
<h1 id="页面操作方法"><a href="#页面操作方法" class="headerlink" title="页面操作方法"></a>页面操作方法</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 打开浏览器</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"><span class="comment"># 请求一个url</span></span><br><span class="line">driver.get(<span class="string">"www.baidu.com"</span>)</span><br><span class="line"><span class="comment"># 返回当前页面的title</span></span><br><span class="line">title = driver.title</span><br><span class="line"><span class="comment"># 返回当前页面的url</span></span><br><span class="line">url = driver.current_url</span><br><span class="line"><span class="comment"># 返回当前页面的源码</span></span><br><span class="line">source = driver.page_source</span><br><span class="line"><span class="comment"># 关闭当前页面</span></span><br><span class="line">driver.close()</span><br><span class="line"><span class="comment"># 注销并关闭浏览器</span></span><br><span class="line">driver.quit()</span><br><span class="line"><span class="comment"># 浏览器前进</span></span><br><span class="line">driver.forward()</span><br><span class="line"><span class="comment"># 浏览器后退</span></span><br><span class="line">driver.back()</span><br><span class="line"><span class="comment"># 刷新当前页面</span></span><br><span class="line">driver.refresh()</span><br><span class="line"><span class="comment"># 获取当前session中的全部cookie</span></span><br><span class="line">get_cookies(self)</span><br><span class="line"><span class="comment"># 获取当前会中中的指定cookie</span></span><br><span class="line">get_cookie(self, name)</span><br><span class="line"><span class="comment"># 在当前会话中添加cookie</span></span><br><span class="line">add_cookie(self, cookie_dict)</span><br><span class="line"><span class="comment"># 添加浏览器User-Agent：</span></span><br><span class="line">options.add_argument(<span class="string">'User-Agent=Mozilla/5.0 (Linux; U; Android 4.0.2; en-us; Galaxy Nexus Build/ICL53F) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30'</span>)</span><br><span class="line"><span class="comment"># 添加设置项Chrome Options：</span></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'xxxx'</span>)</span><br><span class="line">driver = webdriver.Chrome(chrome_options=options)</span><br></pre></td></tr></table></figure>
<h2 id="页面等待"><a href="#页面等待" class="headerlink" title="页面等待"></a>页面等待</h2><h3 id="隐式等待：简单的设置等待时间，单位为：秒"><a href="#隐式等待：简单的设置等待时间，单位为：秒" class="headerlink" title="隐式等待：简单的设置等待时间，单位为：秒"></a>隐式等待：简单的设置等待时间，单位为：秒</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>) <span class="comment"># seconds</span></span><br><span class="line">driver.get(<span class="string">"http://somedomain/url_that_delays_loading"</span>)</span><br><span class="line">myDynamicElement = driver.find_element_by_id(<span class="string">"myDynamicElement"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="显式等待：指定某个条件，然后设置最长等待时间。如果在这个时间还没有找到元素，便会抛出异常。"><a href="#显式等待：指定某个条件，然后设置最长等待时间。如果在这个时间还没有找到元素，便会抛出异常。" class="headerlink" title="显式等待：指定某个条件，然后设置最长等待时间。如果在这个时间还没有找到元素，便会抛出异常。"></a>显式等待：指定某个条件，然后设置最长等待时间。如果在这个时间还没有找到元素，便会抛出异常。</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(<span class="string">"http://somedomain/url_that_delays_loading"</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"> 	<span class="comment"># 这里需要特别注意的是until或until_not中的可执行方法method参数，很多人传入了WebElement对象</span></span><br><span class="line">  <span class="comment"># WebDriverWait(driver, 10).until(driver.find_element_by_id('kw'))  错误</span></span><br><span class="line">  element = WebDriverWait(driver, <span class="number">10</span>).until(</span><br><span class="line">            EC.presence_of_element_located((By.ID, <span class="string">"myDynamicElement"</span>))</span><br><span class="line">            )</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<h3 id="expected-conditions-17个条件-：expected-conditions是selenium的一个模块，其中包含一系列可用于判断的条件"><a href="#expected-conditions-17个条件-：expected-conditions是selenium的一个模块，其中包含一系列可用于判断的条件" class="headerlink" title="expected_conditions(17个条件)：expected_conditions是selenium的一个模块，其中包含一系列可用于判断的条件"></a>expected_conditions(17个条件)：expected_conditions是selenium的一个模块，其中包含一系列可用于判断的条件</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">selenium.webdriver.support.expected_conditions</span><br><span class="line"></span><br><span class="line">这两个条件类验证title，验证传入的参数title是否等于或包含于driver.title</span><br><span class="line">title_is</span><br><span class="line">title_contains</span><br><span class="line"></span><br><span class="line">一个只要一个符合条件的元素加载出来就通过；另一个必须所有符合条件的元素都加载出来才行</span><br><span class="line">presence_of_element_located</span><br><span class="line">presence_of_all_elements_located</span><br><span class="line"></span><br><span class="line">这三个条件验证元素是否可见，前两个传入参数是元组类型的locator，第三个传入WebElement</span><br><span class="line">第一个和第三个其实质是一样的</span><br><span class="line">visibility_of_element_located</span><br><span class="line">invisibility_of_element_located</span><br><span class="line">visibility_of</span><br><span class="line"></span><br><span class="line">这两个人条件判断某段文本是否出现在某元素中，一个判断元素的text，一个判断元素的value</span><br><span class="line">text_to_be_present_in_element</span><br><span class="line">text_to_be_present_in_element_value</span><br><span class="line"></span><br><span class="line">这个条件判断frame是否可切入，可传入locator元组或者直接传入定位方式：id、name、index或WebElement</span><br><span class="line">frame_to_be_available_and_switch_to_it</span><br><span class="line"></span><br><span class="line">这个条件判断是否有alert出现</span><br><span class="line">alert_is_present</span><br><span class="line"></span><br><span class="line">这个条件判断元素是否可点击，传入locator</span><br><span class="line">element_to_be_clickable</span><br><span class="line"></span><br><span class="line">这四个条件判断元素是否被选中，第一个条件传入WebElement对象，第二个传入locator元组</span><br><span class="line">第三个传入WebElement对象以及状态，相等返回<span class="literal">True</span>，否则返回<span class="literal">False</span></span><br><span class="line">第四个传入locator以及状态，相等返回<span class="literal">True</span>，否则返回<span class="literal">False</span></span><br><span class="line">element_to_be_selected</span><br><span class="line">element_located_to_be_selected</span><br><span class="line">element_selection_state_to_be</span><br><span class="line">element_located_selection_state_to_be</span><br><span class="line"></span><br><span class="line">最后一个条件判断一个元素是否仍在DOM中，传入WebElement对象，可以判断页面是否刷新了</span><br><span class="line">staleness_of</span><br></pre></td></tr></table></figure>
<h2 id="鼠标操作"><a href="#鼠标操作" class="headerlink" title="鼠标操作"></a>鼠标操作</h2><ul>
<li>context_click(elem) 右击鼠标点击元素elem，另存为等行为</li>
<li>double_click(elem) 双击鼠标点击元素elem，地图web可实现放大功能</li>
<li>drag_and_drop(source,target) 拖动鼠标，源元素按下左键移动至目标元素释放</li>
<li>move_to_element(elem) 鼠标移动到一个元素上</li>
<li>click_and_hold(elem) 按下鼠标左键在一个元素上</li>
<li>perform() 在通过调用该函数执行ActionChains中存储行为</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 获取通过鼠标右键另存为百度图片logo的例子</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains</span><br><span class="line"> </span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line">driver.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#鼠标移动至图片上 右键保存图片</span></span><br><span class="line">elem_pic = driver.find_element_by_xpath(<span class="string">"//div[@id='lg']/img"</span>)</span><br><span class="line"><span class="keyword">print</span> elem_pic.get_attribute(<span class="string">"src"</span>)</span><br><span class="line">action = ActionChains(driver).move_to_element(elem_pic)</span><br><span class="line">action.context_click(elem_pic)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#重点:当右键鼠标点击键盘光标向下则移动至右键菜单第一个选项</span></span><br><span class="line">action.send_keys(Keys.ARROW_DOWN)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">action.send_keys(<span class="string">'v'</span>) <span class="comment">#另存为</span></span><br><span class="line">action.perform()</span><br><span class="line"> </span><br><span class="line"><span class="comment">#获取另存为对话框(失败)</span></span><br><span class="line">alert.switch_to_alert()</span><br><span class="line">alert.accept()</span><br><span class="line"><span class="comment"># driver.switch_to_alert().accept()  # 点击弹出里面的确定按钮</span></span><br><span class="line"><span class="comment"># driver.switch_to_alert().dismiss() # 点击弹出上面的X按钮</span></span><br></pre></td></tr></table></figure>
<h2 id="键盘操作"><a href="#键盘操作" class="headerlink" title="键盘操作"></a>键盘操作</h2><ul>
<li>send_keys(Keys.ENTER) 按下回车键</li>
<li>send_keys(Keys.TAB) 按下Tab制表键</li>
<li>send_keys(Keys.SPACE) 按下空格键space</li>
<li>send_keys(Kyes.ESCAPE) 按下回退键Esc</li>
<li>send_keys(Keys.BACK_SPACE) 按下删除键BackSpace</li>
<li>send_keys(Keys.SHIFT) 按下shift键</li>
<li>send_keys(Keys.CONTROL) 按下Ctrl键</li>
<li>send_keys(Keys.ARROW_DOWN) 按下鼠标光标向下按键</li>
<li>send_keys(Keys.CONTROL,’a’) 组合键全选Ctrl+A</li>
<li>send_keys(Keys.CONTROL,’c’) 组合键复制Ctrl+C</li>
<li>send_keys(Keys.CONTROL,’x’) 组合键剪切Ctrl+X</li>
<li>send_keys(Keys.CONTROL,’v’) 组合键粘贴Ctrl+V</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"> </span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line">driver.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#输入框输入内容</span></span><br><span class="line">elem = driver.find_element_by_id(<span class="string">"kw"</span>)</span><br><span class="line">elem.send_keys(<span class="string">"Eastmount CSDN"</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#删除一个字符CSDN 回退键</span></span><br><span class="line">elem.send_keys(Keys.BACK_SPACE)</span><br><span class="line">elem.send_keys(Keys.BACK_SPACE)</span><br><span class="line">elem.send_keys(Keys.BACK_SPACE)</span><br><span class="line">elem.send_keys(Keys.BACK_SPACE)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#输入空格+"博客"</span></span><br><span class="line">elem.send_keys(Keys.SPACE)</span><br><span class="line">elem.send_keys(<span class="string">u"博客"</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#ctrl+a 全选输入框内容</span></span><br><span class="line">elem.send_keys(Keys.CONTROL,<span class="string">'a'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#ctrl+x 剪切输入框内容</span></span><br><span class="line">elem.send_keys(Keys.CONTROL,<span class="string">'x'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#输入框重新输入搜索</span></span><br><span class="line">elem.send_keys(Keys.CONTROL,<span class="string">'v'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#通过回车键替代点击操作</span></span><br><span class="line">driver.find_element_by_id(<span class="string">"su"</span>).send_keys(Keys.ENTER)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<h2 id="截图保存"><a href="#截图保存" class="headerlink" title="截图保存"></a>截图保存</h2><p>当爬虫出错时可以截图保存当时页面，以便复现bug，进行分析。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">driver.maximize_window()</span><br><span class="line">driver.get_screenshot_as_file(<span class="string">"screen shot saved path/pic_&#123;&#125;.png"</span>.format(xx))</span><br></pre></td></tr></table></figure>
<h3 id="对selenium二次封装"><a href="#对selenium二次封装" class="headerlink" title="对selenium二次封装"></a>对selenium二次封装</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasePage</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    主要是把常用的几个Selenium方法封装到BasePage这个类，我们这里演示以下几个方法</span></span><br><span class="line"><span class="string">    back()</span></span><br><span class="line"><span class="string">    forward()</span></span><br><span class="line"><span class="string">    get()</span></span><br><span class="line"><span class="string">    quit()</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, driver)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        写一个构造函数，有一个参数driver</span></span><br><span class="line"><span class="string">        :param driver:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver = driver</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">back</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        浏览器后退按钮</span></span><br><span class="line"><span class="string">        :param none:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver.back()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        浏览器前进按钮</span></span><br><span class="line"><span class="string">        :param none:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver.forward()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_url</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        打开url站点</span></span><br><span class="line"><span class="string">        :param url:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver.get(url)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">quit_browser</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        关闭并停止浏览器服务</span></span><br><span class="line"><span class="string">        :param none:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.driver.quit()</span><br><span class="line">       </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BrowserEngine</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    定义一个浏览器引擎类，根据browser_type的值去，控制启动不同的浏览器，这里主要是IE，Firefox, Chrome</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, driver)</span>:</span></span><br><span class="line">        self.driver = driver</span><br><span class="line"> </span><br><span class="line">    browser_type = <span class="string">"IE"</span>   <span class="comment"># maybe Firefox, Chrome, IE</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_browser</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        通过if语句，来控制初始化不同浏览器的启动，默认是启动Chrome</span></span><br><span class="line"><span class="string">        :return: driver</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> self.browser_type == <span class="string">'Firefox'</span>:</span><br><span class="line">            driver = webdriver.Firefox()</span><br><span class="line">        <span class="keyword">elif</span> self.browser_type == <span class="string">'Chrome'</span>:</span><br><span class="line">            driver = webdriver.Chrome()</span><br><span class="line">        <span class="keyword">elif</span> self.browser_type == <span class="string">'IE'</span>:</span><br><span class="line">            driver = webdriver.Ie()</span><br><span class="line">        <span class="keyword">else</span>: driver = webdriver.Chrome()</span><br><span class="line"> </span><br><span class="line">        driver.maximize_window()</span><br><span class="line">        driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> driver</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>爬虫</category>
      </categories>
      <tags>
        <tag>专业技能</tag>
      </tags>
  </entry>
  <entry>
    <title>requests</title>
    <url>/2019/07/19/requests/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><ol>
<li>爬虫的基本流程<ul>
<li><strong>发起请求</strong><br>通过HTTP库向目标站点发起请求，也就是发送一个Request，请求可以包含额外的header等信息，等待服务器响应</li>
<li><strong>获取响应内容</strong><br>如果服务器能正常响应，会得到一个Response，Response的内容便是所要获取的页面内容，类型可能是HTML,Json字符串，二进制数据（图片或者视频）等类型</li>
<li><strong>解析内容</strong><br>得到的内容可能是HTML,可以用正则表达式，页面解析库进行解析，可能是Json,可以直接转换为Json对象解析，可能是二进制数据，可以做保存或者进一步的处理</li>
<li><strong>保存数据</strong><br>保存形式多样，可以存为文本，也可以保存到数据库，或者保存特定格式的文件</li>
</ul>
</li>
</ol>
<a id="more"></a>
<ol>
<li><p><strong>Request中包含什么？</strong></p>
<ul>
<li><p><strong>请求方式</strong></p>
<p>主要有：GET/POST两种类型常用，另外还有HEAD/PUT/DELETE/OPTIONS</p>
<ol>
<li><p>GET和POST的区别就是：请求的数据GET是在url中，POST则是存放在头部</p>
<p>GET:向指定的资源发出“显示”请求。使用GET方法应该只用在读取数据，而不应当被用于产生“副作用”的操作中，例如在Web Application中。其中一个原因是GET可能会被网络蜘蛛等随意访问</p>
<p>POST:向指定资源提交数据，请求服务器进行处理（例如提交表单或者上传文件）。数据被包含在请求本文中。这个请求可能会创建新的资源或修改现有资源，或二者皆有。</p>
</li>
<li><p>HEAD：与GET方法一样，都是向服务器发出指定资源的请求。只不过服务器将不传回资源的本文部分。它的好处在于，使用这个方法可以在不必传输全部内容的情况下，就可以获取其中“关于该资源的信息”（元信息或称元数据）。</p>
</li>
<li><p>PUT：向指定资源位置上传其最新内容。</p>
</li>
<li><p>OPTIONS：这个方法可使服务器传回该资源所支持的所有HTTP请求方法。用’*’来代替资源名称，向Web服务器发送OPTIONS请求，可以测试服务器功能是否正常运作。</p>
</li>
<li><p>DELETE：请求服务器删除Request-URI所标识的资源。</p>
</li>
</ol>
</li>
</ul>
</li>
<li><p><strong>请求URL</strong></p>
<p>URL，即统一资源定位符，也就是我们说的网址，统一资源定位符是对可以从互联网上得到的资源的位置和访问方法的一种简洁的表示，是互联网上标准资源的地址。互联网上的每个文件都有一个唯一的URL，它包含的信息指出文件的位置以及浏览器应该怎么处理它。</p>
<p>URL的格式由三个部分组成：</p>
<ul>
<li>第一部分是协议(或称为服务方式)。</li>
<li>第二部分是存有该资源的主机IP地址(有时也包括端口号)。</li>
<li>第三部分是主机资源的具体地址，如目录和文件名等。</li>
</ul>
<p>爬虫爬取数据时必须要有一个目标的URL才可以获取数据，因此，它是爬虫获取数据的基本依据。</p>
</li>
<li><p><strong>请求头</strong></p>
<p>包含请求时的头部信息，如User-Agent,Host,Cookies等信息.</p>
</li>
<li><p><strong>请求体</strong></p>
<p>请求是携带的数据，如提交表单数据时候的表单数据（POST）</p>
</li>
<li><p>能爬取什么样的数据？</p>
<ul>
<li>网页文本：如HTML文档，Json格式化文本等</li>
<li>图片：获取到的是二进制文件，保存为图片格式</li>
<li>视频：同样是二进制文件</li>
<li>其他：只要请求到的，都可以获取</li>
</ul>
</li>
<li><p><strong>如何解析数据？</strong></p>
<ol>
<li>直接处理</li>
<li>Json解析</li>
<li>正则表达式处理</li>
<li>BeautifulSoup解析处理</li>
<li>PyQuery解析处理</li>
<li>XPath解析处理</li>
</ol>
</li>
<li><p><strong>关于抓取的页面数据和浏览器里看到的不一样的问题？</strong></p>
<p>出现这种情况是因为，很多网站中的数据都是通过js，ajax动态加载的，所以直接通过get请求获取的页面和浏览器显示的不同。</p>
</li>
<li><p><strong>如何解决js渲染的问题？</strong></p>
<ul>
<li>分析ajax</li>
<li>Selenium/webdriver</li>
<li>Splash</li>
</ul>
</li>
<li><p><strong>怎样保存数据？</strong></p>
<ul>
<li>文本：纯文本，Json,Xml等</li>
<li>关系型数据库：如mysql,oracle,sql server等结构化数据库</li>
<li>非关系型数据库：MongoDB,Redis等key-value形式存储</li>
</ul>
</li>
<li><p><strong>request的应用</strong></p>
<ol>
<li><p>Requests是用python语言基于urllib编写的，采用的是Apache2 Licensed开源协议的HTTP库。一句话，requests是python实现的最简单易用的HTTP库，建议爬虫使用requests库。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response  = requests.get(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">print(type(response))</span><br><span class="line">print(response.status_code)</span><br><span class="line">print(response.text) </span><br><span class="line">print(response.cookies)</span><br><span class="line">print(response.content) <span class="comment">#这样获取的数据是二进制数据</span></span><br><span class="line">print(response.content.decode(<span class="string">"utf-8"</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>很多情况下的网站如果直接response.text会出现乱码的问题，所以这个使用response.content这样返回的数据格式其实是二进制格式，然后通过decode()转换为utf-8，这样就解决了通过response.text直接返回显示乱码的问题.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response =requests.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">response.encoding=<span class="string">"utf-8"</span></span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<p>不管是通过response.content.decode(“utf-8)的方式还是通过response.encoding=”utf-8”的方式都可以避免乱码的问题发生</p>
</li>
<li><p><strong>requests包中的请求方式</strong></p>
<p>requests里提供个各种请求方式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">requests.post(<span class="string">"http://httpbin.org/post"</span>)</span><br><span class="line">requests.put(<span class="string">"http://httpbin.org/put"</span>)</span><br><span class="line">requests.delete(<span class="string">"http://httpbin.org/delete"</span>)</span><br><span class="line">requests.head(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line">requests.options(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基本GET请求</span></span><br><span class="line">requests.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line"><span class="comment"># 带参数的GET请求</span></span><br><span class="line">requests.get(<span class="string">"http://httpbin.org/get?name=zhaofan&amp;age=23"</span>)</span><br><span class="line"><span class="comment"># 或者 使用params关键字传递参数，如果字典中的参数为None则不会添加到url上</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"name"</span>:<span class="string">"zhaofan"</span>,</span><br><span class="line">    <span class="string">"age"</span>:<span class="number">22</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">"http://httpbin.org/get"</span>,params=data)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>response的主要属性</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = requests.get(<span class="string">'http://www.jianshu.com'</span>)</span><br><span class="line">print(type(response.status_code), response.status_code)</span><br><span class="line">print(type(response.headers), response.headers)</span><br><span class="line">print(type(response.cookies), response.cookies)</span><br><span class="line">print(type(response.url), response.url)</span><br><span class="line">print(type(response.history), response.history)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>解析json</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = requests.get(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line"><span class="comment"># requests里面集成的json其实就是执行了json.loads()方法，两者的结果是一样的</span></span><br><span class="line">print(response.json())</span><br><span class="line">print(json.loads(response.text))</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>添加headers</strong></p>
<p>可以定制headers的信息，如当我们直接通过requests请求知乎网站的时候，默认是无法访问的,因为访问知乎需要头部信息，这个时候我们在谷歌浏览器里输入chrome://version,就可以看到用户代理，将用户代理添加到头部信息.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36"</span></span><br><span class="line">&#125;</span><br><span class="line">response =requests.get(<span class="string">"https://www.zhihu.com"</span>,headers=headers)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>基本POST请求</strong></p>
<p>通过在发送post请求时添加一个data参数，这个data参数可以通过字典构造成，这样对于发送post请求就非常方便.同样的在发送post请求的时候也可以和发送get请求一样通过headers参数传递一个字典类型的数据</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"name"</span>:<span class="string">"zhaofan"</span>,</span><br><span class="line">    <span class="string">"age"</span>:<span class="number">23</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(<span class="string">"http://httpbin.org/post"</span>,data=data)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>关于请求状态</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response= requests.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"><span class="keyword">if</span> response.status_code == requests.codes.ok:</span><br><span class="line">    print(<span class="string">"访问成功"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>文件上传</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">files= &#123;<span class="string">"files"</span>:open(<span class="string">"git.jpeg"</span>,<span class="string">"rb"</span>)&#125;</span><br><span class="line">response = requests.post(<span class="string">"http://httpbin.org/post"</span>,files=files)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取cookie</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = requests.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">print(response.cookies)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key,value <span class="keyword">in</span> response.cookies.items():</span><br><span class="line">    print(key+<span class="string">"="</span>+value)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>会话维持</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = requests.Session()</span><br><span class="line">s.get(<span class="string">"http://httpbin.org/cookies/set/number/123456"</span>)</span><br><span class="line">response = s.get(<span class="string">"http://httpbin.org/cookies"</span>)</span><br><span class="line">print(response.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面是错误示范</span></span><br><span class="line">requests.get(<span class="string">"http://httpbin.org/cookies/set/number/123456"</span>)</span><br><span class="line">response = requests.get(<span class="string">"http://httpbin.org/cookies"</span>)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>证书验证</strong></p>
<p>现在很多网站都需要证书的验证，没有证书会出现“你访问的不是一个私密链接”之类的错误。对于Https协议，直首先会检查证书是否合法，如果证书不合法，则会抛出：SSLError。针对这一点有两种措施：<br>下面这种方法：在访问的时候，设置不进行证书的验证，此时返回状态码200，但是依旧会有警告。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.packages <span class="keyword">import</span> urllib3</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line">response = requests.get(<span class="string">'https://www.12306.cn'</span>, verify=<span class="literal">False</span>)</span><br><span class="line">print(response.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动指定证书</span></span><br><span class="line">response = requests.get(<span class="string">'https://www.12306.cn'</span>, cert=(<span class="string">'/path/server.crt'</span>, <span class="string">'/path/key'</span>))</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>代理的设置</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">proxies = &#123;</span><br><span class="line">  <span class="string">"http"</span>: <span class="string">"http://127.0.0.1:9743"</span>,</span><br><span class="line">  <span class="string">"https"</span>: <span class="string">"https://127.0.0.1:9743"</span>,</span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</span><br><span class="line">print(response.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于需要用户名和密码的代理</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">"http"</span>: <span class="string">"http://user:password@127.0.0.1:9743/"</span>,<span class="comment">#指定好用户名和密码</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</span><br><span class="line">print(response.status_code)</span><br><span class="line"><span class="comment"># socks代理：先安装该模块   pip3 install 'requests[socks]'</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'socks5://127.0.0.1:9742'</span>,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'socks5://127.0.0.1:9742'</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>超时设置</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> ReadTimeout</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">"http://httpbin.org/get"</span>, timeout = <span class="number">0.5</span>)</span><br><span class="line">    print(response.status_code)</span><br><span class="line"><span class="keyword">except</span> ReadTimeout:</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>需要登录认证才能访问的网站</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://120.27.34.24:9001'</span>, auth=HTTPBasicAuth(<span class="string">'user'</span>, <span class="string">'123'</span>))</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">r = requests.get(<span class="string">'http://120.27.34.24:9001'</span>, auth=(<span class="string">'user'</span>, <span class="string">'123'</span>))</span><br><span class="line">print(r.status_code)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>异常处理</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> ReadTimeout, ConnectionError, RequestException</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">"http://httpbin.org/get"</span>, timeout = <span class="number">0.5</span>)</span><br><span class="line">    print(response.status_code)</span><br><span class="line"><span class="keyword">except</span> ReadTimeout:</span><br><span class="line">    print(<span class="string">'Timeout'</span>)</span><br><span class="line"><span class="keyword">except</span> ConnectionError:</span><br><span class="line">    print(<span class="string">'Connection error'</span>)</span><br><span class="line"><span class="keyword">except</span> RequestException:</span><br><span class="line">    print(<span class="string">'Error'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>爬虫</category>
      </categories>
      <tags>
        <tag>专业技能</tag>
      </tags>
  </entry>
  <entry>
    <title>激活函数</title>
    <url>/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="sigmoid"><a href="#sigmoid" class="headerlink" title="sigmoid"></a>sigmoid</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>sigmoid函数也叫Logistic函数，用于隐层神经元输出，取值范围为(0,1)，它可以将一个实数映射到(0,1)的区间，可以用来做二分类。</p>
<p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/sigmoid.png" alt="avatat"></p>
<a id="more"></a>
<p>Sigmoid函数公式：</p>
<script type="math/tex; mode=display">
S(x)=\frac{1}{1+e^{-x}}</script><p>其对x的导数可以用自身表示:</p>
<script type="math/tex; mode=display">
S^{\prime}(x)=\frac{e^{-x}}{\left(1+e^{-x}\right)^{2}}=S(x)(1-S(x))</script><h4 id="梯度消失"><a href="#梯度消失" class="headerlink" title="梯度消失"></a>梯度消失</h4><p>优化神经网络的方法是Back Propagation，即导数的后向传递：先计算输出层对应的loss，然后将loss以导数的形式不断向上一层网络传递，修正相应的参数，达到降低loss的目的。 Sigmoid函数在深度网络中常常会导致导数逐渐变为0，使得参数无法被更新，神经网络无法被优化。原因在于两点：</p>
<ol>
<li>在上图中容易看出，当$\sigma(x)$中$x$较大或较小时，导数接近0，而后向传递的数学依据是微积分求导的链式法则，当前层的导数需要之前各层导数的乘积，几个小数的相乘，结果会很接近0 .</li>
<li>Sigmoid导数的最大值是0.25，这意味着导数在每一层至少会被压缩为原来的1/4，通过两层后被变为1/16，…，通过10层后为$\frac{1}{4^10}$。请注意这里是“至少”，导数达到最大值这种情况还是很少见的。</li>
</ol>
<p>优点：平滑、易于求导。<br>缺点：激活函数计算量大，反向传播求误差梯度时，求导涉及除法；反向传播时，很容易就会出现梯度消失的情况，从而无法完成深层网络的训练。<strong>幂运算相对耗时</strong></p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1.0</span>/(<span class="number">1</span>+np.exp(-x))</span><br></pre></td></tr></table></figure>
<h3 id="tanh"><a href="#tanh" class="headerlink" title="tanh"></a>tanh</h3><p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/tanh.png" alt="avatar"></p>
<p>tanh公式</p>
<script type="math/tex; mode=display">
\tanh x=\frac{e^{x}-e^{-x}}{e^{x}+e^{-x}}</script><h3 id="ReLU"><a href="#ReLU" class="headerlink" title="ReLU"></a>ReLU</h3><p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/relu.png" alt="avatar"></p>
<script type="math/tex; mode=display">
ReLU = max(0,x)</script><p>优点：</p>
<ul>
<li>解决了gradient vanishing问题 (在正区间)</li>
<li>计算速度非常快，只需要判断输入是否大于0</li>
<li>收敛速度远快于sigmoid和tanh</li>
</ul>
<p>存在的问题：</p>
<ol>
<li>ReLU的输出不是zero-centered</li>
<li>Dead ReLU Problem，指的是某些神经元可能永远不会被激活，导致相应的参数永远不能被更新。有两个主要原因可能导致这种情况产生: <ol>
<li>非常不幸的参数初始化，这种情况比较少见 </li>
<li>learning rate太高导致在训练过程中参数更新太大，不幸使网络进入这种状态。解决方法是可以采用Xavier初始化方法，以及避免将learning rate设置太大或使用adagrad等自动调节learning rate的算法。</li>
</ol>
</li>
</ol>
<h3 id="Leaky-ReLU"><a href="#Leaky-ReLU" class="headerlink" title="Leaky ReLU"></a>Leaky ReLU</h3><p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/leakrelu.png" alt="avatar"></p>
<script type="math/tex; mode=display">
f(x)=max(\alpha x,x)</script><p>人们为了解决Dead ReLU Problem，提出了将ReLU的前半段设为$0.01x$而非0。另外一种直观的想法是基于参数的方法，即Parametric ReLU:$f(x)=max(\alpha x,x)$，其中$\alpha$可由back propagation学出来。理论上来讲，Leaky ReLU有ReLU的所有优点，外加不会有Dead ReLU问题，但是在实际操作当中，并没有完全证明Leaky ReLU总是好于ReLU。</p>
<h3 id="ELU-Exponential-Linear-Units"><a href="#ELU-Exponential-Linear-Units" class="headerlink" title="ELU (Exponential Linear Units)"></a><strong>ELU (Exponential Linear Units)</strong></h3><p><img src="/2018/07/31/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/ELU.png" alt="avata"></p>
<script type="math/tex; mode=display">
f(x)=\left\{\begin{array}{ll}
x, & \text { if } x>0 \\
\alpha\left(e^{x}-1\right), & \text { otherwise }
\end{array}\right.</script><p>ELU也是为解决ReLU存在的问题而提出，显然，ELU有ReLU的基本所有优点，以及：</p>
<ul>
<li>不会有Dead ReLU问题</li>
<li>输出的均值接近0，zero-centered</li>
</ul>
<p>它的一个小问题在于计算量稍大。类似于Leaky ReLU，理论上虽然好于ReLU，但在实际使用中目前并没有好的证据ELU总是优于ReLU。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol>
<li><a href="https://baike.baidu.com/item/Sigmoid函数/7981407?fr=aladdin" target="_blank" rel="noopener">Sigmoid函数</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwNzc2NTk0NQ==&amp;mid=2247484448&amp;idx=1&amp;sn=80479bf682d7ade4184fde809ea0cc3e&amp;chksm=970c2cf6a07ba5e0e046e4d5b8169e8fb58c9e858878840b571d43060e30986152a534830bc6&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">神经网络激活函数=生物转换器？</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/25110450" target="_blank" rel="noopener">聊一聊深度学习的activation function</a></li>
</ol>
]]></content>
      <categories>
        <category>深度学习</category>
      </categories>
      <tags>
        <tag>激活函数</tag>
      </tags>
  </entry>
  <entry>
    <title>优化算法</title>
    <url>/2018/07/11/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="梯度下降算法"><a href="#梯度下降算法" class="headerlink" title="梯度下降算法"></a>梯度下降算法</h2><p>梯度下降法(Gradient descent)或最速下降法(steepest descent)是求解无约束最优化问题的一种常用的、实现简单的方法。<br>假设$f(x)$是$R^n$上具有一阶连续偏导数的函数。求解</p>
<script type="math/tex; mode=display">
   min_{x \in R^n}f(x)</script><p>无约束最优化问题。 $f^\ast$表示目标函数$f(x)$的极小点。<br>梯度下降法是一种迭代算法，选取适当的初值$x^0$,不断迭代，更新x的值，进行目标函数的极小化，直到收敛。由于负梯度的方向是使函数下降最快的方向，在迭代的每一步，以负梯度方向更新x的值，从而达到减少函数值的目的。<br>第k+1次迭代值：</p>
<script type="math/tex; mode=display">
x^{(k+1)} \leftarrow x^{(k)}+\lambda_{k} p_{k}</script><p>其中，$p_k$是搜索方向，取负梯度方向$p_k = - \nabla f(x^k)$,$\lambda_k$使得</p>
<script type="math/tex; mode=display">
f\left(x^{(k)}+\lambda_{k} p_{k}\right)=\min _{\lambda \geq 0} f\left(x^{(k)}+\lambda p_{k}\right)</script><a id="more"></a>
<h3 id="算法描述："><a href="#算法描述：" class="headerlink" title="算法描述："></a>算法描述：</h3><p>输入:目标函数$f(x)$，梯度函数$g(x^k)=\nabla f(x^k)$,计算$\epsilon$.<br>输出：$f(x)$的极小值点$x^\star$</p>
<ol>
<li>取初值$x^0 \in R^n$,置k=0</li>
<li>计算$f(x^k)$</li>
<li>计算梯度$g_k = g(x^k)$,当$\left|g_{k}\right|&lt;\varepsilon$时，停止迭代，令$p_k = -g(x^k)$求$\lambda_k$,使<script type="math/tex; mode=display">
f\left(x^{(k)}+\lambda_{k} p_{k}\right)=\min _{\lambda \geq 0} f\left(x^{(k)}+\lambda p_{k}\right)</script></li>
<li>置$x^{k+1}=x^k+\lambda_k p_k$,计算$f(x^{k+1})$当$<br>\left|f\left(x^{(k+1)}\right)-f\left(x^{(k)}\right)\right|&lt;\varepsilon<br>$或$\left|x^{(k+1)}-x^{(k)}\right|&lt;\varepsilon$停止迭代。令$x^\star = x^{k+1}$</li>
<li>否则，置$k=k+1$,转3.</li>
</ol>
<h3 id="梯度下降调优"><a href="#梯度下降调优" class="headerlink" title="梯度下降调优"></a>梯度下降调优</h3><ol>
<li><strong>算法的步长选择</strong>。步长取值取决于数据样本，可以多取一些值，从大到小，分别运行算法，看看迭代效果，如果损失函数在变小，说明取值有效，否则要增大步长。步长太大，会导致迭代过快，甚至有可能错过最优解。步长太小，迭代速度太慢，很长时间算法都不能结束。所以算法的步长需要多次运行后才能得到一个较为优的值。</li>
<li><strong>算法参数的初始值选择</strong>。初始值不同，获得的最小值也有可能不同，因此梯度下降求得的只是局部最小值；当然如果损失函数是凸函数则一定是最优解。由于有局部最优解的风险，需要多次用不同初始值运行算法，关键损失函数的最小值，选择损失函数最小化的初值。</li>
<li><strong>归一化</strong>。由于样本不同特征的取值范围不一样，可能导致迭代很慢，为了减少特征取值的影响，可以对特征数据归一化。</li>
</ol>
<h3 id="梯度下降法大家族（BGD，SGD，MBGD）"><a href="#梯度下降法大家族（BGD，SGD，MBGD）" class="headerlink" title="梯度下降法大家族（BGD，SGD，MBGD）"></a>梯度下降法大家族（BGD，SGD，MBGD）</h3><ol>
<li><strong>批量梯度下降法（Batch Gradient Descent）</strong> 批量梯度下降法，是梯度下降法最常用的形式，具体做法也就是在更新参数时使用所有的样本来进行更新。</li>
<li><strong>随机梯度下降法（Stochastic Gradient Descent）</strong> 其实和批量梯度下降法原理类似，区别在与求梯度时没有用所有的样本的数据，而是仅仅选取一个样本来求梯度。随机梯度下降法，和批量梯度下降法是两个极端，一个采用所有数据来梯度下降，一个用一个样本来梯度下降。自然各自的优缺点都非常突出。对于训练速度来说，随机梯度下降法由于每次仅仅采用一个样本来迭代，训练速度很快，而批量梯度下降法在样本量很大的时候，训练速度不能让人满意。对于准确度来说，随机梯度下降法用于仅仅用一个样本决定梯度方向，导致解很有可能不是最优。对于收敛速度来说，由于随机梯度下降法一次迭代一个样本，导致迭代方向变化很大，不能很快的收敛到局部最优解。</li>
<li><strong>小批量梯度下降法（Mini-batch Gradient Descent）</strong> 小批量梯度下降法是批量梯度下降法和随机梯度下降法的折衷，也就是对于$m$个样本，我们采用$x$个样本来迭代，$1&lt;x&lt;m$。一般可以取$x=16,32,64…$，当然根据样本的数据，可以调整这个$x$ 的值。</li>
</ol>
<p>上述三种方法得到局部最优解的过程：<br><img src="/2018/07/11/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/C80A2811-1678-4371-BCCD-8AA51A777820.jpg" alt="avatar"></p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(X, y, W, B, alpha, max_iters)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    使用了所有的样本进行梯度下降</span></span><br><span class="line"><span class="string">    X: 训练集,</span></span><br><span class="line"><span class="string">    y: 标签,</span></span><br><span class="line"><span class="string">    W: 权重向量,</span></span><br><span class="line"><span class="string">    B: bias,</span></span><br><span class="line"><span class="string">    alpha: 学习率,</span></span><br><span class="line"><span class="string">    max_iters: 最大迭代次数.</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    dW = <span class="number">0</span> <span class="comment"># 权重梯度收集器</span></span><br><span class="line">    dB = <span class="number">0</span> <span class="comment"># Bias梯度的收集器</span></span><br><span class="line">    m = X.shape[<span class="number">0</span>] <span class="comment"># 样本数</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(max_iters):</span><br><span class="line">        dW = <span class="number">0</span> <span class="comment"># 每次迭代重置</span></span><br><span class="line">        dB = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">            <span class="comment"># 1. 迭代所有的样本</span></span><br><span class="line">            <span class="comment"># 2. 计算权重和bias的梯度保存在w_grad和b_grad,</span></span><br><span class="line">            <span class="comment"># 3. 通过增加w_grad和b_grad来更新dW和dB</span></span><br><span class="line">            W = W - alpha * (dW / m) <span class="comment"># 更新权重</span></span><br><span class="line">            B = B - alpha * (dB / m) <span class="comment"># 更新bias</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> W, B</span><br></pre></td></tr></table></figure>
<h3 id="梯度下降和最小二乘法"><a href="#梯度下降和最小二乘法" class="headerlink" title="梯度下降和最小二乘法"></a>梯度下降和最小二乘法</h3><p>梯度下降法和最小二乘法相比，梯度下降法需要选择步长，而最小二乘法不需要。梯度下降法是迭代求解，最小二乘法是计算解析解。如果样本量不算很大，且存在解析解，最小二乘法比起梯度下降法要有优势，计算速度很快。但是如果样本量很大，用最小二乘法由于需要求一个超级大的逆矩阵，这时就很难或者很慢才能求解解析解了，使用迭代的梯度下降法比较有优势。</p>
<h2 id="牛顿法"><a href="#牛顿法" class="headerlink" title="牛顿法"></a>牛顿法</h2><p>一般来说，牛顿法主要应用在两个方面，1：求方程的根；2：最优化。</p>
<h3 id="求解过程"><a href="#求解过程" class="headerlink" title="求解过程"></a>求解过程</h3><p>并不是所有的方程都有求根公式，或者求根公式很复杂，导致求解困难。利用牛顿法，可以迭代求解。</p>
<p>原理是利用泰勒公式，在 $x_0$处展开，且展开到一阶, 即 $f(x)=f(x_0)+f^\prime{x_0}(x-x_0)$ 。求解方程$f(x)=0$，等价于$f(x_0)+f^\prime(x_0)(x-x_0)=0$，求解 $x=x_1=x_0-\frac{f(x_0)}{f^\prime(x_0)}$。因为这是利用泰勒公式的一阶展开,$f(x)=f(x_0)+f^\prime(x_0)(x-x_0)$ 处并不是完全相等，而是近似相等，这里求得的的$x_1$并不能让 $f(x)=0$，只能说 $f(x_1)$ 的值比$f(x_9)$的值更接近于0，于是迭代的想法就很自然了，可以进而推出 $x_{n+1}=x_n-\frac{f(x_n)}{f\prime(x_n)}$，通过迭代，这个式子必然在 $f(x^\star)=0$ 的时候收敛。整个过程如下：<br><img src="/2018/07/11/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/B03C2A8B-AF9F-4871-94F6-0E7F6D6EC890.png" alt="avatar"></p>
<h3 id="最优化"><a href="#最优化" class="headerlink" title="最优化"></a>最优化</h3><p>无约束最优化问题</p>
<script type="math/tex; mode=display">
min_{x \in R^N}f(x)</script><p>其中$s^\star$为目标函数的极小点</p>
<p>设$f(x)$具有二阶连续偏导，若第$k$次迭代值为$x^k$,则可将$f(x)$在$x^k$附近进行二阶泰勒展开：</p>
<script type="math/tex; mode=display">
f(x)=f\left(x^{(k)}\right)+g_{k}^{T}\left(x-x^{(k)}\right)+\frac{1}{2}\left(x-x^{(k)}\right)^{T} H\left(x^{(k)}\right)\left(x-x^{(x)}\right)</script><p>其中，$g_k=g(x^k)=\nabla f(x^k)$是$f(x)$的梯度向量在点$x^k$的值，$H(x^k)$是$f(x)$的海塞矩阵</p>
<script type="math/tex; mode=display">
H(x)=\left[\frac{\partial^{2} f}{\partial x_{i} \partial x_{j}}\right]_{n \times n}</script><p>在点$x^k$的值。</p>
<p>函数$f(x)$有极值的必要条件是在极值点处一阶导数为0，即梯度向量为0。特别的当$H(x^k)$是正定矩阵时，函数$f(x)$的极值为最小值。</p>
<p>为了的得到一阶导数为0的点，可以用到<strong>求解方程</strong>部分的方法。根据二阶泰勒展开，对$\nabla f(x)$在$x^k$进行展开得（也可以对泰勒公式再进行求导）：</p>
<script type="math/tex; mode=display">
\nabla f(x)=g_{k}+H_{k}\left(x-x^{(k)}\right)</script><p>其中，$H_k=H(x^k)$则：</p>
<script type="math/tex; mode=display">
\begin{aligned}&g_{k}+H_{k}\left(x^{(k+1)}-x^{(k)}\right)=0\\&x^{(k+1)}=x^{(k)}-H_{k}^{-1} g_{k}\end{aligned}</script><p>令</p>
<script type="math/tex; mode=display">
H_kp_k = -g_k</script><p>得到迭代公式：</p>
<script type="math/tex; mode=display">
x^{k+1} = x^k+p_k</script><p>最终在$\nabla f(x^\star)=0$收敛</p>
<h3 id="算法描述"><a href="#算法描述" class="headerlink" title="算法描述"></a>算法描述</h3><p>输入：目标函数$f(x)$，梯度$g(x) = \nabla f(x)$,海塞矩阵$H(x)$,精度(阈值)$\epsilon$</p>
<p>输出：$f(x)$的极小值点$x^\star$</p>
<ol>
<li><p>取初始点$x^0$,置k=0</p>
</li>
<li><p>计算$g_k = g(x^k)$</p>
</li>
<li><p>若$\left|g_k \right| &lt; \epsilon$，则停止计算，求得近似解:$x^\star = x^k$</p>
</li>
<li><p>计算$H_k = H(x^k)$,并求$p_k$。</p>
<script type="math/tex; mode=display">
H_kp_k = -g_k</script></li>
<li><p>置 $x(k+1) = x^k + p_k$</p>
</li>
<li>置 k=k+1, 转2.</li>
</ol>
<h3 id="牛顿法和梯度下降"><a href="#牛顿法和梯度下降" class="headerlink" title="牛顿法和梯度下降"></a>牛顿法和梯度下降</h3><p>梯度下降法和牛顿法相比，两者都是迭代求解，不过梯度下降法是梯度求解，而牛顿法是用二阶的海森矩阵的逆矩阵求解。相对而言，使用牛顿法收敛更快（迭代更少次数）。但是每次迭代的时间比梯度下降法长。</p>
<p>梯度下降法： </p>
<script type="math/tex; mode=display">
x^{k+1} = x^k - \lambda \nabla f(x^k)</script><p>牛顿法：</p>
<script type="math/tex; mode=display">
x^{k+1} = x^k-\lambda(H^k)^{-1}\nabla f(x^k)</script><p>至于为什么牛顿法收敛更快，通俗来说梯度下降法每次只从你当前所处位置选一个坡度最大的方向走一步，牛顿法在选择方向时，不仅会考虑坡度是否够大，还会考虑你走了一步之后，坡度是否会变得更大。所以，可以说牛顿法比梯度下降法看得更远一点，能更快地走到最底部。从几何上说，牛顿法就是用一个二次曲面去拟合你当前所处位置的局部曲面，而梯度下降法是用一个平面去拟合当前的局部曲面，通常情况下，二次曲面的拟合会比平面更好，所以牛顿法选择的下降路径会更符合真实的最优下降路径。<br><img src="/2018/07/11/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/84835FEB-0EA4-41E5-B07D-41BBEB49AE9B.jpg" alt="9c6e73f0200cbe504e0370a18ca3a95a"><br>红色的牛顿法的迭代路径，绿色的是梯度下降法的迭代路径。<br>牛顿法是梯度下降法的进一步发展，梯度法利用了目标函数的一阶偏导信息、一负梯度方向作为搜索方向，只考虑目标函数在迭代点的局部性质；而牛顿法不仅使用目标函数的一阶偏导数，还进一步利用了目标函数的二阶偏导数，这样就考虑了梯度变化的趋势，因而能更全面地确定合适的搜索方向以加快收敛，它具有二阶收敛速度，但是牛顿法也存在两个<strong>缺点</strong> ：</p>
<ul>
<li>对目标函数有较严格的要求，函数必须具有连续的一、二阶偏导，海塞矩阵必须正定。</li>
<li>计算相当复杂，除了需要计算梯度外，还需计算二阶偏导矩阵和它的逆矩阵。计算量、存储量都很大。且均以维数N的平方比增加，当N很大时，这个问题就更加突出。</li>
</ul>
<h2 id="拟牛顿法"><a href="#拟牛顿法" class="headerlink" title="拟牛顿法"></a>拟牛顿法</h2><p>在牛顿法的迭代计算中，需要计算海塞矩阵的逆矩阵$H^-1$，这一计算比较复杂，考虑用一个n阶矩阵$G_k=G(x^k)$来近似替代$H^{-1}_{k}=H^{-1}(x^k)$。这就是拟牛顿的基本想法。</p>
<p>要找到近似的替代矩阵，必定要和$H_k$有类似的性质。先看下牛顿法迭代中海塞矩阵$H_k$满足的条件。首先，$H_k$满足以下关系：</p>
<p>取$x=x^{k-1}$，由</p>
<script type="math/tex; mode=display">
\nabla f(x)=g_k+H_k(x-x^k)</script><p>得：</p>
<script type="math/tex; mode=display">
g_{k-1}-g_k = H_k(x^{k-1}-x^k)</script><p>记$y_k=g_k-g_{k-1},\delta_k = x^k-x^{k-1}$,则：</p>
<script type="math/tex; mode=display">
y_{k-1}=H_k\delta_{k-1}H^{-1}_ky_{k-1}=\delta_{k-1}</script><p>称为拟牛顿条件。</p>
<p>其次，如果$H_k$是正定的（$H_k^{-1}$也是正定的），那么保证牛顿法的搜索方向$p_k$是下降方向。这是因为搜索方向是$p_k = -H_k^{-1}g_k$,</p>
<p>由</p>
<script type="math/tex; mode=display">
x^{k+1} = x^k -H^{-1}_kg_k</script><p>有</p>
<script type="math/tex; mode=display">
x = x^k - \lambda H_k^{-1}g_k = x^k+\lambda p_k</script><p>则$f(x)$在$x^k$的泰勒展开可近似为：</p>
<script type="math/tex; mode=display">
f(x) = f(x^k) - \lambda g^T_kH_k^{-1}g_k</script><p>由于$H_k^{-1}$正定，故$g_k^TH_k^{-1}g_k&gt;0$。当$\lambda$为一个充分小的正数时，有$f(x)&lt;f(x^k)$,即搜索方向$p_k$是下降方向。</p>
<p>因此拟牛顿法将$G_k$作为$H^{-1}_k$近似。要求$G_k$满足同样的条件。首先，每次迭代矩阵$G_k$是正定的。同时，$G_k满足下面的拟牛顿条件</p>
<script type="math/tex; mode=display">
G_{k+1}y_k = \delta_k</script><p>按照拟牛顿条件，在每次迭代中可以选择更新矩阵$G_{k+1}$:</p>
<script type="math/tex; mode=display">
G_{k+1} = G_k + \nabla G_k</script><h3 id="DFP"><a href="#DFP" class="headerlink" title="DFP"></a>DFP</h3><h3 id="BFGS"><a href="#BFGS" class="headerlink" title="BFGS"></a>BFGS</h3><h3 id="Broyden"><a href="#Broyden" class="headerlink" title="Broyden"></a>Broyden</h3>]]></content>
      <categories>
        <category>机器学习</category>
      </categories>
      <tags>
        <tag>优化算法</tag>
      </tags>
  </entry>
  <entry>
    <title>linux命令速查</title>
    <url>/2018/06/25/linux_quickcheck/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2018/06/25/linux_quickcheck/terminal_command.jpg" alt></p>
<a id="more"></a>
<h1 id="Linux-命令"><a href="#Linux-命令" class="headerlink" title="Linux 命令"></a><a href="https://linux.gaomeluo.com/" target="_blank" rel="noopener">Linux 命令</a></h1><p>linux命令是对Linux系统进行管理的命令。对于Linux系统来说，无论是中央处理器、内存、磁盘驱动器、键盘、鼠标，还是用户等都是文件，Linux系统管理的命令是它正常运行的核心，与之前的DOS命令类似。linux命令在系统中有两种类型：内置Shell命令和Linux命令。</p>
<h2 id="linux的文件系统"><a href="#linux的文件系统" class="headerlink" title="linux的文件系统"></a>linux的文件系统</h2><ol>
<li>/boot:系统启动相关的文件，如内核、initrd、以及grub（bootloader）</li>
<li>/dev:设备文件：<ol>
<li>块设备：随机访问，数据块</li>
<li>字符设备：线性访问，按字符为单位</li>
<li>设备号：主设备号（major）和次设备号（minor）</li>
</ol>
</li>
<li>/etc：配置文件</li>
<li>/home：用户的家目录，每一个用户的家目录通常默认为/home/username</li>
<li>/root：管理员的家目录；</li>
<li>/lib:库文件<ol>
<li>静态库：.a</li>
<li>动态库：.dll, .so(shared object)</li>
<li>/lib/moudules:内核模块文件</li>
</ol>
</li>
<li>/lib64</li>
<li>/media:挂载点目录，移动设备</li>
<li>/mnt:挂载点目录，额外的临时文件系统</li>
<li>/opt:可选目录，第三方程序的安装目录</li>
<li>/proc：伪文件系统，内核映射文件</li>
<li>/sys：伪文件系统，跟硬件设备相关的属性映射文件</li>
<li>/tmp:临时文件，/var/tmp</li>
<li>/var:可变化的文件</li>
<li>/bin:可执行文件，用户命令</li>
<li>/sbin：管理命令</li>
</ol>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h3><ol>
<li>tar  <ol>
<li>解包：tar zxvf filename.tar  </li>
<li>打包：tar czvf filename.tar dirname</li>
</ol>
</li>
<li>gz命令  <ol>
<li>解压1：gunzip filename.gz  </li>
<li>解压2：gzip -d filename.gz  </li>
<li>压缩：gzip filename<ol>
<li>.tar.gz 和  .tgz      </li>
<li>解压：tar zxvf filename.tar.gz      </li>
<li>压缩：tar zcvf filename.tar.gz dirname      </li>
<li>压缩多个文件：tar zcvf filename.tar.gz dirname1 dirname2 dirname3…..</li>
</ol>
</li>
</ol>
</li>
<li>bz2命令  <ol>
<li>解压1：bzip2 -d filename.bz2  </li>
<li>解压2：bunzip2 filename.bz2  </li>
<li>压缩：bzip2 -z filename       </li>
<li>.tar.bz2       <ol>
<li>解压：tar jxvf filename.tar.bz2       </li>
<li>压缩：tar jcvf filename.tar.bz2 dirname</li>
</ol>
</li>
</ol>
</li>
<li>bz命令    <ol>
<li>解压1：bzip2 -d filename.bz    </li>
<li>解压2：bunzip2 filename.bz         </li>
<li>.tar.bz       <ol>
<li>解压：tar jxvf filename.tar.bz</li>
</ol>
</li>
<li>z命令    <ol>
<li>解压：uncompress filename.z    </li>
<li>压缩：compress filename       </li>
<li>.tar.z          <ol>
<li>解压：tar zxvf filename.tar.z          </li>
<li>压缩：tar zcvf filename.tar.z dirname</li>
</ol>
</li>
</ol>
</li>
<li>zip命令        <ol>
<li>解压：unzip filename.zip    </li>
<li>压缩：zip filename.zip dirname</li>
</ol>
</li>
</ol>
</li>
<li><p>总结：z 以gzip格式压缩，c表示create，v显示压缩的详细情况 f file</p>
<ol>
<li>压缩<ol>
<li>tar –cvf jpg.tar *.jpg //将目录里所有jpg文件打包成tar.jpg </li>
<li>tar –czf jpg.tar.gz *.jpg //将目录里所有jpg文件打包成jpg.tar后，并且将其用gzip压缩，生成一个gzip压缩过的包，命名为jpg.tar.gz </li>
<li>tar –cjf jpg.tar.bz2 *.jpg //将目录里所有jpg文件打包成jpg.tar后，并且将其用bzip2压缩，生成一个bzip2压缩过的包，命名为jpg.tar.bz2 </li>
<li>tar –cZf jpg.tar.Z *.jpg //将目录里所有jpg文件打包成jpg.tar后，并且将其用compress压缩，生成一个umcompress压缩过的包，命名为jpg.tar.Z </li>
<li>rar a jpg.rar *.jpg //rar格式的压缩，需要先下载rar for linux </li>
<li>zip jpg.zip *.jpg //zip格式的压缩，需要先下载zip for linux </li>
<li>解压</li>
<li>tar –xvf file.tar //解压 tar包 </li>
<li>tar -xzvf file.tar.gz //解压tar.gz </li>
<li>tar -xjvf file.tar.bz2 //解压 </li>
<li>tar.bz2 tar –xZvf file.tar.Z //解压tar.Z </li>
<li>unrar e file.rar //解压rar </li>
<li>unzip file.zip //解压zip </li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h3><ol>
<li>新建一个叫session_name的session：screen -S session_name</li>
<li>列出当前所有的session：screen -ls</li>
<li>回到session_name这个session：screen -r session_name</li>
<li>远程detach某个session：screen -d session_name</li>
<li>结束当前session并回到session_name这个session：screen -d -r session_name       </li>
<li>利用exit退出并kill掉session</li>
</ol>
<h3 id="查看显卡和内存使用情况"><a href="#查看显卡和内存使用情况" class="headerlink" title="查看显卡和内存使用情况"></a>查看显卡和内存使用情况</h3><ol>
<li>查看显卡使用情况：watch -n 5 nvidia-smi</li>
<li>查看磁盘使用：df -h</li>
</ol>
<h3 id="移动重命名"><a href="#移动重命名" class="headerlink" title="移动重命名"></a>移动重命名</h3><ol>
<li>将/usr/udt中的所有文件移到当前目录(用”.”表示)中：$ mv /usr/udt/* .</li>
<li>将文件test.txt重命名为wbk.txt：$ mv test.txt wbk.txt</li>
</ol>
<h3 id="目录管理"><a href="#目录管理" class="headerlink" title="目录管理"></a>目录管理</h3><ol>
<li>ls</li>
<li>cd</li>
<li>pwd</li>
<li>mkdir</li>
<li>rmdir</li>
<li>tree</li>
</ol>
<h3 id="文件管理"><a href="#文件管理" class="headerlink" title="文件管理"></a>文件管理</h3><ol>
<li>touch</li>
<li>stat</li>
<li>file</li>
<li>rm<ol>
<li>-i: 若指定目录已有同名文件，则先询问是否覆盖旧文件;</li>
<li>-f: 在mv操作要覆盖某已有的目标文件时不给任何指示;</li>
</ol>
</li>
<li>cp [options] source dest<ol>
<li>-a:此选项通常在复制目录时使用，它保留链接、文件属性，并复制目录下的所有内容。其作用等于dpr参数组合。</li>
<li>-d：复制时保留链接。这里所说的链接相当于Windows系统中的快捷方式。</li>
<li>-f：覆盖已经存在的目标文件而不给出提示。</li>
<li>-i：与-f选项相反，在覆盖目标文件之前给出提示，要求用户确认是否覆盖，回答”y”时目标文件将被覆盖。</li>
<li>-p：除复制文件的内容外，还把修改时间和访问权限也复制到新文件中。</li>
<li>-r：若给出的源文件是一个目录文件，此时将复制该目录下所有的子目录和文件。</li>
<li>-l：不复制文件，只是生成链接文件。</li>
</ol>
</li>
<li>mv</li>
<li>nano</li>
<li>vi</li>
<li>vim</li>
</ol>
<h3 id="日期时间"><a href="#日期时间" class="headerlink" title="日期时间"></a>日期时间</h3><ol>
<li>data</li>
<li>clock</li>
<li>hwclock</li>
<li>cal</li>
<li>ntpdate</li>
</ol>
<h3 id="查看文本"><a href="#查看文本" class="headerlink" title="查看文本"></a>查看文本</h3><ol>
<li>cat</li>
<li>tac</li>
<li>more</li>
<li>less</li>
<li>head</li>
<li>tail</li>
</ol>
<h3 id="文件查找-find"><a href="#文件查找-find" class="headerlink" title="文件查找:find"></a>文件查找:find</h3><h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><p><strong>find命令</strong> 用来在指定目录下查找文件。任何位于参数之前的字符串都将被视为欲查找的目录名。如果使用该命令时，不设置任何参数，则find命令将在当前目录下查找子目录与文件。并且将查找到的子目录和文件全部进行显示。</p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find(选项)(参数)</span><br></pre></td></tr></table></figure>
<h4 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-amin&lt;分钟&gt;：查找在指定时间曾被存取过的文件或目录，单位以分钟计算；</span><br><span class="line">-anewer&lt;参考文件或目录&gt;：查找其存取时间较指定文件或目录的存取时间更接近现在的文件或目录；</span><br><span class="line">-atime&lt;24小时数&gt;：查找在指定时间曾被存取过的文件或目录，单位以24小时计算；</span><br><span class="line">-cmin&lt;分钟&gt;：查找在指定时间之时被更改过的文件或目录；</span><br><span class="line">-cnewer&lt;参考文件或目录&gt;查找其更改时间较指定文件或目录的更改时间更接近现在的文件或目录；</span><br><span class="line">-ctime&lt;24小时数&gt;：查找在指定时间之时被更改的文件或目录，单位以24小时计算；</span><br><span class="line">-daystart：从本日开始计算时间；</span><br><span class="line">-depth：从指定目录下最深层的子目录开始查找；</span><br><span class="line">-expty：寻找文件大小为0 Byte的文件，或目录下没有任何子目录或文件的空目录；</span><br><span class="line">-exec&lt;执行指令&gt;：假设find指令的回传值为True，就执行该指令；</span><br><span class="line">-false：将find指令的回传值皆设为False；</span><br><span class="line">-fls&lt;列表文件&gt;：此参数的效果和指定“-ls”参数类似，但会把结果保存为指定的列表文件；</span><br><span class="line">-follow：排除符号连接；</span><br><span class="line">-fprint&lt;列表文件&gt;：此参数的效果和指定“-print”参数类似，但会把结果保存成指定的列表文件；</span><br><span class="line">-fprint0&lt;列表文件&gt;：此参数的效果和指定“-print0”参数类似，但会把结果保存成指定的列表文件；</span><br><span class="line">-fprintf&lt;列表文件&gt;&lt;输出格式&gt;：此参数的效果和指定“-printf”参数类似，但会把结果保存成指定的列表文件；</span><br><span class="line">-fstype&lt;文件系统类型&gt;：只寻找该文件系统类型下的文件或目录；</span><br><span class="line">-gid&lt;群组识别码&gt;：查找符合指定之群组识别码的文件或目录；</span><br><span class="line">-group&lt;群组名称&gt;：查找符合指定之群组名称的文件或目录；</span><br><span class="line">-help或——help：在线帮助；</span><br><span class="line">-ilname&lt;范本样式&gt;：此参数的效果和指定“-lname”参数类似，但忽略字符大小写的差别；</span><br><span class="line">-iname&lt;范本样式&gt;：此参数的效果和指定“-name”参数类似，但忽略字符大小写的差别；</span><br><span class="line">-inum&lt;inode编号&gt;：查找符合指定的inode编号的文件或目录；</span><br><span class="line">-ipath&lt;范本样式&gt;：此参数的效果和指定“-path”参数类似，但忽略字符大小写的差别；</span><br><span class="line">-iregex&lt;范本样式&gt;：此参数的效果和指定“-regexe”参数类似，但忽略字符大小写的差别；</span><br><span class="line">-links&lt;连接数目&gt;：查找符合指定的硬连接数目的文件或目录；</span><br><span class="line">-iname&lt;范本样式&gt;：指定字符串作为寻找符号连接的范本样式；</span><br><span class="line">-ls：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出；</span><br><span class="line">-maxdepth&lt;目录层级&gt;：设置最大目录层级；</span><br><span class="line">-mindepth&lt;目录层级&gt;：设置最小目录层级；</span><br><span class="line">-mmin&lt;分钟&gt;：查找在指定时间曾被更改过的文件或目录，单位以分钟计算；</span><br><span class="line">-mount：此参数的效果和指定“-xdev”相同；</span><br><span class="line">-mtime&lt;24小时数&gt;：查找在指定时间曾被更改过的文件或目录，单位以24小时计算；</span><br><span class="line">-name&lt;范本样式&gt;：指定字符串作为寻找文件或目录的范本样式；</span><br><span class="line">-newer&lt;参考文件或目录&gt;：查找其更改时间较指定文件或目录的更改时间更接近现在的文件或目录；</span><br><span class="line">-nogroup：找出不属于本地主机群组识别码的文件或目录；</span><br><span class="line">-noleaf：不去考虑目录至少需拥有两个硬连接存在；</span><br><span class="line">-nouser：找出不属于本地主机用户识别码的文件或目录；</span><br><span class="line">-ok&lt;执行指令&gt;：此参数的效果和指定“-exec”类似，但在执行指令之前会先询问用户，若回答“y”或“Y”，则放弃执行命令；</span><br><span class="line">-path&lt;范本样式&gt;：指定字符串作为寻找目录的范本样式；</span><br><span class="line">-perm&lt;权限数值&gt;：查找符合指定的权限数值的文件或目录；</span><br><span class="line">-print：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出。格式为每列一个名称，每个名称前皆有“.&#x2F;”字符串；</span><br><span class="line">-print0：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出。格式为全部的名称皆在同一行；</span><br><span class="line">-printf&lt;输出格式&gt;：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出。格式可以自行指定；</span><br><span class="line">-prune：不寻找字符串作为寻找文件或目录的范本样式;</span><br><span class="line">-regex&lt;范本样式&gt;：指定字符串作为寻找文件或目录的范本样式；</span><br><span class="line">-size&lt;文件大小&gt;：查找符合指定的文件大小的文件；</span><br><span class="line">-true：将find指令的回传值皆设为True；</span><br><span class="line">-type&lt;文件类型&gt;：只寻找符合指定的文件类型的文件；</span><br><span class="line">-uid&lt;用户识别码&gt;：查找符合指定的用户识别码的文件或目录；</span><br><span class="line">-used&lt;日数&gt;：查找文件或目录被更改之后在指定时间曾被存取过的文件或目录，单位以日计算；</span><br><span class="line">-user&lt;拥有者名称&gt;：查找符和指定的拥有者名称的文件或目录；</span><br><span class="line">-version或——version：显示版本信息；</span><br><span class="line">-xdev：将范围局限在先行的文件系统中；</span><br><span class="line">-xtype&lt;文件类型&gt;：此参数的效果和指定“-type”参数类似，差别在于它针对符号连接检查。</span><br></pre></td></tr></table></figure>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><p>起始目录：查找文件的起始目录。</p>
<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 当前目录搜索所有文件，文件内容 包含 “140.206.111.111” 的内容</span><br><span class="line">find . -type f -name &quot;*&quot; | xargs grep &quot;140.206.111.111&quot;</span><br><span class="line"></span><br><span class="line"># 列出当前目录及子目录下所有文件和文件夹</span><br><span class="line">find .</span><br><span class="line"></span><br><span class="line"># 在&#x2F;home目录下查找以.txt结尾的文件名</span><br><span class="line">find &#x2F;home -name &quot;*.txt&quot;</span><br><span class="line"></span><br><span class="line"># 在&#x2F;home目录下查找以.txt结尾的文件名 忽略大小写</span><br><span class="line">find &#x2F;home -iname &quot;*.txt&quot;</span><br><span class="line"></span><br><span class="line"># 当前目录及子目录下查找所有以.txt和.pdf结尾的文件</span><br><span class="line">find . \( -nam &quot;*.txt&quot; -o -name &quot;*.pdf&quot;\)  或 find . -name &quot;*.txt&quot; -o -name &quot;*.pdf&quot;</span><br><span class="line"></span><br><span class="line"># 匹配文件路径或者文件</span><br><span class="line">find &#x2F;usr&#x2F; -path &quot;*local*&quot;</span><br><span class="line"></span><br><span class="line"># 基于正则表达式匹配文件路径</span><br><span class="line">find . -regex &quot;.*\(\.txt\|\.pdf\)$&quot;</span><br><span class="line"></span><br><span class="line"># 基于正则表达式匹配文件路径(同上，但是忽略大小写)</span><br><span class="line">find . -iregex &quot;.*\(\.txt\|\.pdf\)$&quot;</span><br><span class="line"></span><br><span class="line"># 要列出所有长度为零的文件</span><br><span class="line">find . -empty</span><br><span class="line"></span><br><span class="line"># 如果你有一些以 jpg 结尾的目录呢？ 所以要给搜索加上文件类型</span><br><span class="line">find ~ \( -iname &#39;*jpeg&#39; -o -iname &#39;*jpg&#39; \) -type f </span><br><span class="line"></span><br><span class="line"># 在 log 目录下找到所有巨大的（定义为“大于 1GB”）文件：</span><br><span class="line">find &#x2F;var&#x2F;log -size +1G</span><br><span class="line"></span><br><span class="line"># 在主目录中找到对所有人可读的文件</span><br><span class="line">find ~ -perm -o&#x3D;r</span><br><span class="line"></span><br><span class="line"># 删除 mac 下自动生成的文件</span><br><span class="line">find .&#x2F; -name &#39;__MACOSX&#39; -depth -exec rm -rf &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"># 统计代码行数</span><br><span class="line">find . -name &quot;*.java&quot;|xargs cat|grep -v ^$|wc -l # 代码行数统计, 排除空行</span><br></pre></td></tr></table></figure>
<h5 id="否定参数"><a href="#否定参数" class="headerlink" title="否定参数"></a>否定参数</h5><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"># 找出/<span class="built_in">home</span>下不是以.txt结尾的文件</span><br><span class="line"><span class="built_in">find</span> /<span class="built_in">home</span> ! -name <span class="string">"*.txt"</span></span><br></pre></td></tr></table></figure>
<h5 id="根据文件类型进行搜索"><a href="#根据文件类型进行搜索" class="headerlink" title="根据文件类型进行搜索"></a>根据文件类型进行搜索</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find . -type 类型参数</span><br><span class="line"></span><br><span class="line">类型参数列表：</span><br><span class="line">    f 普通文件</span><br><span class="line">    l 符号连接</span><br><span class="line">    d 目录</span><br><span class="line">    c 字符设备</span><br><span class="line">    b 块设备</span><br><span class="line">    s 套接字</span><br><span class="line">    p Fifo</span><br></pre></td></tr></table></figure>
<h5 id="基于目录深度搜索"><a href="#基于目录深度搜索" class="headerlink" title="基于目录深度搜索"></a>基于目录深度搜索</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 向下最大深度限制为3</span><br><span class="line">find . -maxdepth 3 -type f</span><br><span class="line"></span><br><span class="line"># 搜索出深度距离当前目录至少2个子目录的所有文件</span><br><span class="line">find . -mindepth 2 -type f</span><br></pre></td></tr></table></figure>
<h5 id="根据文件时间戳进行搜索"><a href="#根据文件时间戳进行搜索" class="headerlink" title="根据文件时间戳进行搜索"></a>根据文件时间戳进行搜索</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find . -type f 时间戳</span><br><span class="line"></span><br><span class="line">UNIX&#x2F;Linux文件系统每个文件都有三种时间戳：</span><br><span class="line">    访问时间 （-atime&#x2F;天，-amin&#x2F;分钟）：用户最近一次访问时间。</span><br><span class="line">    修改时间 （-mtime&#x2F;天，-mmin&#x2F;分钟）：文件最后一次修改时间。</span><br><span class="line">    变化时间 （-ctime&#x2F;天，-cmin&#x2F;分钟）：文件数据元（例如权限等）最后一次修改时间。</span><br><span class="line">    </span><br><span class="line"># 搜索最近七天内被访问过的所有文件</span><br><span class="line">find . -type f -atime -7</span><br><span class="line"></span><br><span class="line"># 搜索恰好在七天前被访问过的所有文件</span><br><span class="line">find . -type f -atime 7</span><br><span class="line"></span><br><span class="line"># 搜索超过七天内被访问过的所有文件</span><br><span class="line">find . -type f -atime +7</span><br><span class="line"></span><br><span class="line"># 搜索访问时间超过10分钟的所有文件</span><br><span class="line">find . -type f -amin +10</span><br><span class="line"></span><br><span class="line"># 找出比file.log修改时间更长的所有文件</span><br><span class="line">find . -type f -newer file.log</span><br></pre></td></tr></table></figure>
<h5 id="根据文件大小进行匹配"><a href="#根据文件大小进行匹配" class="headerlink" title="根据文件大小进行匹配"></a>根据文件大小进行匹配</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find . -type f -size 文件大小单元</span><br><span class="line"></span><br><span class="line">文件大小单元：</span><br><span class="line">    b —— 块（512字节）</span><br><span class="line">    c —— 字节</span><br><span class="line">    w —— 字（2字节）</span><br><span class="line">    k —— 千字节</span><br><span class="line">    M —— 兆字节</span><br><span class="line">    G —— 吉字节</span><br><span class="line"></span><br><span class="line"># 搜索大于10KB的文件</span><br><span class="line">find . -type f -size +10k</span><br><span class="line"></span><br><span class="line"># 搜索小于10KB的文件</span><br><span class="line">find . -type f -size -10k</span><br><span class="line"></span><br><span class="line"># 搜索等于10KB的文件</span><br><span class="line">find . -type f -size 10k</span><br></pre></td></tr></table></figure>
<h5 id="删除匹配文件"><a href="#删除匹配文件" class="headerlink" title="删除匹配文件"></a>删除匹配文件</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 删除当前目录下所有.txt文件</span><br><span class="line">find . -type f -name &quot;*.txt&quot; -delete</span><br></pre></td></tr></table></figure>
<h5 id="根据文件权限-所有权进行匹配"><a href="#根据文件权限-所有权进行匹配" class="headerlink" title="根据文件权限/所有权进行匹配"></a>根据文件权限/所有权进行匹配</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 当前目录下搜索出权限为777的文件</span><br><span class="line">find . -type f -perm 777</span><br><span class="line"></span><br><span class="line"># 找出当前目录下权限不是644的php文件</span><br><span class="line">find . -type f -name &quot;*.php&quot; ! -perm 644</span><br><span class="line"></span><br><span class="line"># 找出当前目录用户tom拥有的所有文件</span><br><span class="line">find . -type f -user tom</span><br><span class="line"></span><br><span class="line"># 找出当前目录用户组sunk拥有的所有文件</span><br><span class="line">find . -type f -group sunk</span><br></pre></td></tr></table></figure>
<h5 id="借助-exec选项与其他命令结合使用"><a href="#借助-exec选项与其他命令结合使用" class="headerlink" title="借助-exec选项与其他命令结合使用"></a>借助<code>-exec</code>选项与其他命令结合使用</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 找出当前目录下所有root的文件，并把所有权更改为用户tom，&#123;&#125; 用于与 -exec 选项结合使用来匹配所有文件，然后会被替换为相应的文件名。</span><br><span class="line">find .-type f -user root -exec chown tom &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"># 找出自己home目录下所有的.txt文件并删除， -ok 和 -exec 行为一样，不过它会给出提示，是否执行相应的操作。</span><br><span class="line">find $HOME&#x2F;. -name &quot;*.txt&quot; -ok rm &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"># 查找当前目录下所有.txt文件并把他们拼接起来写入到all.txt文件中</span><br><span class="line">find . -type f -name &quot;*.txt&quot; -exec cat &#123;&#125; \;&gt; &#x2F;all.txt</span><br><span class="line"></span><br><span class="line"># 将30天前的.log文件移动到old目录中</span><br><span class="line">find . -type f -mtime +30 -name &quot;*.log&quot; -exec cp &#123;&#125; old \;</span><br><span class="line"></span><br><span class="line"># 找出当前目录下所有.txt文件并以“File:文件名”的形式打印出来</span><br><span class="line">find . -type f -name &quot;*.txt&quot; -exec printf &quot;File: %s\n&quot; &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"># 因为单行命令中-exec参数中无法使用多个命令，以下方法可以实现在-exec之后接受多条命令</span><br><span class="line">-exec .&#x2F;text.sh &#123;&#125; \;</span><br></pre></td></tr></table></figure>
<h5 id="搜索但是跳过指定目录"><a href="#搜索但是跳过指定目录" class="headerlink" title="搜索但是跳过指定目录"></a>搜索但是跳过指定目录</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 查找当前目录或者子目录下所有.txt文件，但是跳过子目录sk</span><br><span class="line">find . -path &quot;.&#x2F;sk&quot; -prune -o -name &quot;*.txt&quot; -print</span><br></pre></td></tr></table></figure>
<h3 id="文本内容搜索-grep"><a href="#文本内容搜索-grep" class="headerlink" title="文本内容搜索:grep"></a>文本内容搜索:grep</h3><h4 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h4><p><strong>grep</strong> （global search regular expression(RE) and print out the line，全面搜索正则表达式并把行打印出来）是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来。用于过滤/搜索的特定字符。可使用正则表达式能多种命令配合使用。</p>
<h4 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h4><p>在文件中搜索一个单词，命令会返回一个包含 <strong>“match_pattern”</strong> 的文本行：</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grep</span> match_pattern file_name</span><br><span class="line"><span class="keyword">grep</span> <span class="string">"match_pattern"</span> file_name</span><br></pre></td></tr></table></figure>
<h4 id="选项-1"><a href="#选项-1" class="headerlink" title="选项"></a>选项</h4><figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">-<span class="ruby">a --text  <span class="comment"># 不要忽略二进制数据。</span></span></span><br><span class="line"><span class="ruby">-A &lt;显示行数&gt;   --after-context=&lt;显示行数&gt;   <span class="comment"># 除了显示符合范本样式的那一行之外，并显示该行之后的内容。</span></span></span><br><span class="line"><span class="ruby">-b --byte-offset                           <span class="comment"># 在显示符合范本样式的那一行之外，并显示该行之前的内容。</span></span></span><br><span class="line"><span class="ruby">-B&lt;显示行数&gt;   --before-context=&lt;显示行数&gt;   <span class="comment"># 除了显示符合样式的那一行之外，并显示该行之前的内容。</span></span></span><br><span class="line"><span class="ruby">-c --count    <span class="comment"># 计算符合范本样式的列数。</span></span></span><br><span class="line"><span class="ruby">-C&lt;显示行数&gt; --context=&lt;显示行数&gt;或-&lt;显示行数&gt; <span class="comment"># 除了显示符合范本样式的那一列之外，并显示该列之前后的内容。</span></span></span><br><span class="line"><span class="ruby">-d&lt;进行动作&gt; --directories=&lt;动作&gt;  <span class="comment"># 当指定要查找的是目录而非文件时，必须使用这项参数，否则grep命令将回报信息并停止动作。</span></span></span><br><span class="line"><span class="ruby">-e&lt;范本样式&gt; --regexp=&lt;范本样式&gt;   <span class="comment"># 指定字符串作为查找文件内容的范本样式。</span></span></span><br><span class="line"><span class="ruby">-E --extended-regexp             <span class="comment"># 将范本样式为延伸的普通表示法来使用，意味着使用能使用扩展正则表达式。</span></span></span><br><span class="line"><span class="ruby">-f&lt;范本文件&gt; --file=&lt;规则文件&gt;     <span class="comment"># 指定范本文件，其内容有一个或多个范本样式，让grep查找符合范本条件的文件内容，格式为每一列的范本样式。</span></span></span><br><span class="line"><span class="ruby">-F --fixed-regexp   <span class="comment"># 将范本样式视为固定字符串的列表。</span></span></span><br><span class="line"><span class="ruby">-G --basic-regexp   <span class="comment"># 将范本样式视为普通的表示法来使用。</span></span></span><br><span class="line"><span class="ruby">-h --no-filename    <span class="comment"># 在显示符合范本样式的那一列之前，不标示该列所属的文件名称。</span></span></span><br><span class="line"><span class="ruby">-H --with-filename  <span class="comment"># 在显示符合范本样式的那一列之前，标示该列的文件名称。</span></span></span><br><span class="line"><span class="ruby">-i --ignore-<span class="keyword">case</span>    <span class="comment"># 忽略字符大小写的差别。</span></span></span><br><span class="line"><span class="ruby">-l --file-with-matches   <span class="comment"># 列出文件内容符合指定的范本样式的文件名称。</span></span></span><br><span class="line"><span class="ruby">-L --files-without-match <span class="comment"># 列出文件内容不符合指定的范本样式的文件名称。</span></span></span><br><span class="line"><span class="ruby">-n --line-number         <span class="comment"># 在显示符合范本样式的那一列之前，标示出该列的编号。</span></span></span><br><span class="line"><span class="ruby">-P --perl-regexp         <span class="comment"># PATTERN 是一个 Perl 正则表达式</span></span></span><br><span class="line"><span class="ruby">-q --quiet或--silent     <span class="comment"># 不显示任何信息。</span></span></span><br><span class="line"><span class="ruby">-R/-r  --recursive       <span class="comment"># 此参数的效果和指定“-d recurse”参数相同。</span></span></span><br><span class="line"><span class="ruby">-s --no-messages  <span class="comment"># 不显示错误信息。</span></span></span><br><span class="line"><span class="ruby">-v --revert-match <span class="comment"># 反转查找。</span></span></span><br><span class="line"><span class="ruby">-V --version      <span class="comment"># 显示版本信息。   </span></span></span><br><span class="line"><span class="ruby">-w --word-regexp  <span class="comment"># 只显示全字符合的列。</span></span></span><br><span class="line"><span class="ruby">-x --line-regexp  <span class="comment"># 只显示全列符合的列。</span></span></span><br><span class="line"><span class="ruby">-y <span class="comment"># 此参数效果跟“-i”相同。</span></span></span><br><span class="line"><span class="ruby">-o <span class="comment"># 只输出文件中匹配到的部分。</span></span></span><br><span class="line"><span class="ruby">-m &lt;num&gt; --max-count=&lt;num&gt; <span class="comment"># 找到num行结果后停止查找，用来限制匹配行数</span></span></span><br></pre></td></tr></table></figure>
<h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h4><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">^    <span class="meta"># 锚定行的开始 如：<span class="string">'^grep'</span>匹配所有以grep开头的行。    </span></span><br><span class="line">$    <span class="meta"># 锚定行的结束 如：<span class="string">'grep$'</span> 匹配所有以grep结尾的行。</span></span><br><span class="line">.    <span class="meta"># 匹配一个非换行符的字符 如：<span class="string">'gr.p'</span>匹配gr后接一个任意字符，然后是p。    </span></span><br><span class="line">*    <span class="meta"># 匹配零个或多个先前字符 如：<span class="string">'*grep'</span>匹配所有一个或多个空格后紧跟grep的行。    </span></span><br><span class="line">.*   <span class="meta"># 一起用代表任意字符。   </span></span><br><span class="line">[]   <span class="meta"># 匹配一个指定范围内的字符，如<span class="string">'[Gg]rep'</span>匹配Grep和grep。    </span></span><br><span class="line">[^]  <span class="meta"># 匹配一个不在指定范围内的字符，如：<span class="string">'[^A-FH-Z]rep'</span>匹配不包含A-R和T-Z的一个字母开头，紧跟rep的行。    </span></span><br><span class="line">\(..\)  <span class="meta"># 标记匹配字符，如<span class="string">'\(love\)'</span>，love被标记为1。    </span></span><br><span class="line">\&lt;      <span class="meta"># 锚定单词的开始，如:<span class="string">'\&lt;grep'</span>匹配包含以grep开头的单词的行。    </span></span><br><span class="line">\&gt;      <span class="meta"># 锚定单词的结束，如<span class="string">'grep\&gt;'</span>匹配包含以grep结尾的单词的行。    </span></span><br><span class="line">x\&#123;m\&#125;  <span class="meta"># 重复字符x，m次，如：<span class="string">'0\&#123;5\&#125;'</span>匹配包含5个o的行。    </span></span><br><span class="line">x\&#123;m,\&#125;   <span class="meta"># 重复字符x,至少m次，如：<span class="string">'o\&#123;5,\&#125;'</span>匹配至少有5个o的行。    </span></span><br><span class="line">x\&#123;m,n\&#125;  <span class="meta"># 重复字符x，至少m次，不多于n次，如：<span class="string">'o\&#123;5,10\&#125;'</span>匹配5--10个o的行。   </span></span><br><span class="line">\w    <span class="meta"># 匹配文字和数字字符，也就是[A-Za-z0-9]，如：<span class="string">'G\w*p'</span>匹配以G后跟零个或多个文字或数字字符，然后是p。   </span></span><br><span class="line">\W    <span class="meta"># \w的反置形式，匹配一个或多个非单词字符，如点号句号等。   </span></span><br><span class="line">\b    <span class="meta"># 单词锁定符，如: <span class="string">'\bgrep\b'</span>只匹配grep。</span></span><br></pre></td></tr></table></figure>
<h4 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h4><figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># 在多个文件中查找：</span></span><br><span class="line">grep <span class="string">"match_pattern"</span> file_1 file_2 file_3 ...</span><br><span class="line"></span><br><span class="line"><span class="meta">#  -v 选项：输出除match_pattern之外的所有行</span></span><br><span class="line">grep -v <span class="string">"match_pattern"</span> file_name</span><br><span class="line"></span><br><span class="line"><span class="meta"># 标记匹配颜色 --color=auto 选项：</span></span><br><span class="line">grep <span class="string">"match_pattern"</span> file_name --color=auto</span><br><span class="line"></span><br><span class="line"><span class="meta"># 使用正则表达式 -E 选项：</span></span><br><span class="line">grep -E <span class="string">"[1-9]+"</span>  or  egrep <span class="string">"[1-9]+"</span></span><br><span class="line">echo <span class="keyword">this</span> is a test line. | grep -o -E <span class="string">"[a-z]+\."</span> 输出：line.</span><br><span class="line">echo <span class="keyword">this</span> is a test line. | egrep -o <span class="string">"[a-z]+\."</span> 输出：line.</span><br><span class="line"></span><br><span class="line"><span class="meta"># 使用正则表达式 -P 选项：</span></span><br><span class="line">grep -P <span class="string">"(\d&#123;3&#125;\-)&#123;2&#125;\d&#123;4&#125;"</span> file_name</span><br><span class="line"></span><br><span class="line"><span class="meta"># -c 选项：统计文件或者文本中包含匹配字符串的行数 </span></span><br><span class="line">grep -c <span class="string">"text"</span> file_name</span><br><span class="line"></span><br><span class="line"><span class="meta"># -n 选项：输出包含匹配字符串的行数 </span></span><br><span class="line">grep <span class="string">"text"</span> -n file_name   or  cat file_name | grep <span class="string">"text"</span> -n</span><br><span class="line"><span class="meta"># 多个文件</span></span><br><span class="line">grep <span class="string">"text"</span> -n file_1 file_2</span><br><span class="line"></span><br><span class="line"><span class="meta"># 打印样式匹配所位于的字符或字节偏移：</span></span><br><span class="line">echo gun is not unix | grep -b -o <span class="string">"not"</span>  输出：<span class="number">7</span>:not</span><br><span class="line"><span class="meta"># 一行中字符串的字符偏移是从该行的第一个字符开始计算，起始值为0。选项  -b -o  一般总是配合使用。</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 搜索多个文件并查找匹配文本在哪些文件中：</span></span><br><span class="line">grep -l <span class="string">"text"</span> file1 file2 file3...</span><br></pre></td></tr></table></figure>
<h4 id="递归搜索"><a href="#递归搜索" class="headerlink" title="递归搜索"></a>递归搜索</h4><figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在多级目录中对文本进行递归搜索, .表示当前目录。</span></span><br><span class="line"><span class="keyword">grep</span> <span class="string">"text"</span> . -r -n</span><br></pre></td></tr></table></figure>
<h4 id="忽略大小写"><a href="#忽略大小写" class="headerlink" title="忽略大小写"></a>忽略大小写</h4><figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="meta"># 忽略匹配样式中的字符大小写：</span></span><br><span class="line">echo <span class="string">"hello world"</span> <span class="string">| grep -i "</span>HELLO<span class="string">"   输出:hello</span></span><br></pre></td></tr></table></figure>
<h4 id="多个匹配样式"><a href="#多个匹配样式" class="headerlink" title="多个匹配样式"></a>多个匹配样式</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -e:自动多个匹配样式</span></span><br><span class="line">echo this is a text line | grep -e <span class="string">"is"</span> -e <span class="string">"line"</span> -o  输出:is line</span><br><span class="line"></span><br><span class="line"><span class="comment"># -f:自动匹配多个样式</span></span><br><span class="line">cat patfile</span><br><span class="line">aaa</span><br><span class="line">bbb</span><br><span class="line"></span><br><span class="line">echo<span class="built_in"> aaa </span>bbb ccc ddd eee | grep -f patfile -o</span><br></pre></td></tr></table></figure>
<h4 id="在grep搜索结果中包括或者排除指定文件"><a href="#在grep搜索结果中包括或者排除指定文件" class="headerlink" title="在grep搜索结果中包括或者排除指定文件"></a>在grep搜索结果中包括或者排除指定文件</h4><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"># 只在目录中所有的.php和.html文件中递归搜索字符<span class="string">"main()"</span></span><br><span class="line"><span class="keyword">grep</span> <span class="string">"main()"</span> . -r --<span class="keyword">include</span> *.&#123;php,html&#125;</span><br><span class="line"></span><br><span class="line"># 在搜索结果中排除所有README文件</span><br><span class="line"><span class="keyword">grep</span> <span class="string">"main()"</span> . -r --<span class="keyword">exclude</span> <span class="string">"README"</span></span><br><span class="line"></span><br><span class="line"># 在搜索结果中排除filelist文件列表里的文件</span><br><span class="line"><span class="keyword">grep</span> <span class="string">"main()"</span> . -r --<span class="keyword">exclude</span>-<span class="keyword">from</span> filelist</span><br></pre></td></tr></table></figure>
<h4 id="使用0值字节后缀"><a href="#使用0值字节后缀" class="headerlink" title="使用0值字节后缀"></a>使用0值字节后缀</h4><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"># 测试文件：</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"aaa"</span> &gt; file1</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"bbb"</span> &gt; file2</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"aaa"</span> &gt; file3</span><br><span class="line"></span><br><span class="line"><span class="keyword">grep</span> <span class="string">"aaa"</span> <span class="keyword">file</span>* -lZ | xargs -<span class="number">0</span> rm</span><br><span class="line"></span><br><span class="line"># 执行后会删除file1和file3，<span class="keyword">grep</span>输出用-Z选项来指定以<span class="number">0</span>值字节作为终结符文件名（\<span class="number">0</span>），xargs -<span class="number">0</span> 读取输入并用<span class="number">0</span>值字节终结符分隔文件名，然后删除匹配文件，-Z通常和-<span class="keyword">l</span>结合使用。</span><br></pre></td></tr></table></figure>
<h4 id="静默输出"><a href="#静默输出" class="headerlink" title="静默输出"></a>静默输出</h4><figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line"># 不会输出任何信息，如果命令运行成功返回<span class="number">0</span>，失败则返回非<span class="number">0</span>值。一般用于条件测试。</span><br><span class="line">grep -q <span class="string">"test"</span> filename</span><br></pre></td></tr></table></figure>
<h4 id="打印出匹配文本之前或者之后的行"><a href="#打印出匹配文本之前或者之后的行" class="headerlink" title="打印出匹配文本之前或者之后的行"></a>打印出匹配文本之前或者之后的行</h4><figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line"># 显示匹配某个结果之后的<span class="number">3</span>行，使用 -A 选项：</span><br><span class="line">seq <span class="number">10</span> | grep <span class="string">"5"</span> -A <span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"></span><br><span class="line"># 显示匹配某个结果之前的<span class="number">3</span>行，使用 -B 选项：</span><br><span class="line">seq <span class="number">10</span> | grep <span class="string">"5"</span> -B <span class="number">3</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"></span><br><span class="line"># 显示匹配某个结果的前三行和后三行，使用 -C 选项：</span><br><span class="line">seq <span class="number">10</span> | grep <span class="string">"5"</span> -C <span class="number">3</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"></span><br><span class="line"># 如果匹配结果有多个，会用“--”作为各匹配结果之间的分隔符：</span><br><span class="line">echo -e <span class="string">"a<span class="subst">\n</span>b<span class="subst">\n</span>c<span class="subst">\n</span>a<span class="subst">\n</span>b<span class="subst">\n</span>c"</span> | grep a -A <span class="number">1</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">--</span><br><span class="line">a</span><br><span class="line">b</span><br></pre></td></tr></table></figure>
<h3 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h3><ol>
<li>| 表示管道，表示管道左边命令的结果传给管道右边。eg: ls -l | more、 ps aux | grep xxx</li>
<li>命令1 | 命令2 | 命令3</li>
</ol>
<h3 id="文本处理"><a href="#文本处理" class="headerlink" title="文本处理"></a>文本处理</h3><ol>
<li>cut<ol>
<li>-d：指定字段分割符，默认是空格<ol>
<li>-d”,”</li>
</ol>
</li>
<li>-f： 指定要显示的字段<ol>
<li>-f 1,3</li>
<li>-f 1-3</li>
</ol>
</li>
</ol>
</li>
<li>sort：文本排序<ol>
<li>-n：数值排序</li>
<li>-r：降序</li>
<li>-t：字段分隔符</li>
<li>-k：以哪个字段为关键字进行排序</li>
<li>-u：排序后相同的行只显示一次</li>
<li>-f：排序时忽略字符大小写</li>
</ol>
</li>
<li>join</li>
<li>sed</li>
<li>awk</li>
</ol>
<h2 id="系统管理命令"><a href="#系统管理命令" class="headerlink" title="系统管理命令"></a>系统管理命令</h2><ol>
<li>ps 命令可以查看进程的详细状况<ol>
<li>-a 显示终端上所有进程，包括其他用户的进程</li>
<li>-u 显示进程的详细状态</li>
<li>-x 显示没有控制终端的进程</li>
<li>-w 显示加宽，以便显示更多的信息</li>
<li>-r 只显示正在运行的进程</li>
</ol>
</li>
<li>top 命令用来动态显示运行中的进程，可以在使用top命令时加上-d来指定显示信息更新的时间间隔。在top命令下，通过按下下列字母，来对显示结果进行排序<ol>
<li>m 根据内存使用量来排序</li>
<li>p  根据cpu占有率来排序</li>
<li>t   根据进程运行时间的长短来排序</li>
<li>u  可以根据后面输入的用户名来筛选进程</li>
<li>k  可以根据后面输入的pid来杀死进程</li>
<li>q  退出</li>
<li>h  获得帮助</li>
</ol>
</li>
<li>kill ，killall<ol>
<li>kill -9 pid</li>
<li>killall 进程名</li>
</ol>
</li>
</ol>
<h2 id="磁盘空间命令"><a href="#磁盘空间命令" class="headerlink" title="磁盘空间命令"></a>磁盘空间命令</h2><ol>
<li>df 命令用于检测文件系统的磁盘空间占用和剩余情况，可以显示所有文件系统对节点和磁盘块的使用情况<ol>
<li>a 显示所有文件系统的磁盘使用情况</li>
<li>m 以1024字节为单位显示</li>
<li>t 显示各指定文件系统的磁盘空间使用情况</li>
<li>T 显示文件系统</li>
</ol>
</li>
<li>du 命令用于统计目录或文件所占磁盘空间的大小，该命令的执行结果与df类似，du更侧重于磁盘的使用情况。 格式： du [选项] 目录或文件名<ol>
<li>a 递归显示指定目录中各文件和子目录中文件占用的数据块</li>
<li>s 显示指定文件或目录占用的数据块</li>
<li>b 以字节为单位显示磁盘占用情况</li>
<li>l 计算所有文件大小，对硬链接文件计算多次</li>
</ol>
</li>
</ol>
<h2 id="网络命令"><a href="#网络命令" class="headerlink" title="网络命令"></a>网络命令</h2><h3 id="查看或配置网卡信息：ifconfig"><a href="#查看或配置网卡信息：ifconfig" class="headerlink" title="查看或配置网卡信息：ifconfig"></a>查看或配置网卡信息：ifconfig</h3><h3 id="测试远程主机连通性：ping"><a href="#测试远程主机连通性：ping" class="headerlink" title="测试远程主机连通性：ping"></a>测试远程主机连通性：ping</h3><ol>
<li>ping -c4 www.baidu.com<h3 id="查看网络情况：-netstat-ntpl"><a href="#查看网络情况：-netstat-ntpl" class="headerlink" title="查看网络情况： netstat -ntpl"></a>查看网络情况： netstat -ntpl</h3></li>
</ol>
<h1 id="软件安装和管理"><a href="#软件安装和管理" class="headerlink" title="软件安装和管理"></a>软件安装和管理</h1><h2 id="软件包"><a href="#软件包" class="headerlink" title="软件包"></a>软件包</h2><ol>
<li>bin文件（适合所有Linux发行版），是可执行的文件</li>
<li>rpm包，yum（redhat系列）<ol>
<li>rpm命令：安装过程中不需要指定安装路径，rpm文件在制作的时候已经确定了安装路径</li>
<li>查询软件安装路径：rpm -ql xxx</li>
</ol>
</li>
<li>源码压缩包（适合所有的Linux发行版）</li>
<li>官方已经编译好的，下载软件包直接可以使用</li>
<li>安装步骤：<ol>
<li>检查是否已经安装：rpm -qa | grep jdk</li>
<li>下载软件包</li>
<li>安装依赖<h2 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h2></li>
</ol>
</li>
<li>解决rpm下载问题</li>
<li>解决rpm文件的查询问题</li>
<li>解决rpm安装问题</li>
<li>解决rpm的依赖问题</li>
</ol>
]]></content>
      <categories>
        <category>技术/linux</category>
      </categories>
      <tags>
        <tag>速查</tag>
        <tag>linux命令</tag>
      </tags>
  </entry>
  <entry>
    <title>python高级</title>
    <url>/2018/06/05/python%E9%AB%98%E7%BA%A7/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="range-start-stop-step"><a href="#range-start-stop-step" class="headerlink" title="range(start, stop[, step])"></a>range(start, stop[, step])</h3><ul>
<li>start: 计数从 start 开始。默认是从 0 开始。</li>
<li>stop: 计数到 stop 结束，</li>
<li>step：步长，默认为1。</li>
</ul>
<a id="more"></a>
<h3 id="lambda-map-filter-reduce-yield函数的应用"><a href="#lambda-map-filter-reduce-yield函数的应用" class="headerlink" title="lambda,map,filter,reduce,yield函数的应用"></a>lambda,map,filter,reduce,yield函数的应用</h3><h4 id="匿名函数lambda"><a href="#匿名函数lambda" class="headerlink" title="匿名函数lambda"></a><strong>匿名函数lambda</strong></h4><p>冒号左边放原函数的参数，可以有多个参数，用逗号(,)隔开，冒号右边是返回值。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">lambda</span> x,y:x+y</span><br></pre></td></tr></table></figure>
<h4 id="遍历函数-map"><a href="#遍历函数-map" class="headerlink" title="遍历函数:map"></a><strong>遍历函数</strong>:map</h4><p>map函数用于遍历序列</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">li = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">lo = [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line">list(map(<span class="keyword">lambda</span> x, y: x**<span class="number">2</span> + y**<span class="number">2</span>, li, lo))</span><br><span class="line"><span class="comment"># [26, 40, 58, 80]</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (x*x)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (x+x)</span><br><span class="line"></span><br><span class="line">funcs = [multiply, add]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    value = map(<span class="keyword">lambda</span> x: x(i), funcs)</span><br><span class="line">print(list(value))</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="comment"># [0, 0]</span></span><br><span class="line"><span class="comment"># [1, 2]</span></span><br><span class="line"><span class="comment"># [4, 4]</span></span><br><span class="line"><span class="comment"># [9, 6]</span></span><br></pre></td></tr></table></figure>
<h4 id="筛选函数-filter"><a href="#筛选函数-filter" class="headerlink" title="筛选函数:filter"></a><strong>筛选函数</strong>:filter</h4><p>筛选函数用于对序列中的元素进行筛选，最终获取符合条件的序列。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">li = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line">list(filter(<span class="keyword">lambda</span> x: x&gt;<span class="number">5</span>, li))</span><br><span class="line"><span class="comment">#Output</span></span><br><span class="line"><span class="comment"># [6, 7, 8, 9]</span></span><br></pre></td></tr></table></figure>
<h4 id="累计函数-reduce"><a href="#累计函数-reduce" class="headerlink" title="累计函数:reduce"></a><strong>累计函数</strong>:reduce</h4><p>对序列中的所有函数进行累积操作</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">li = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">reduce(<span class="keyword">lambda</span> a, b: a+b, li) <span class="comment"># 结果为15</span></span><br><span class="line">reduce(<span class="keyword">lambda</span> a, b: a+b, li, <span class="number">100</span>)<span class="comment">#结果为115，第三个参数为初始值，在此值之进行累计</span></span><br></pre></td></tr></table></figure>
<h4 id="关键字-yield"><a href="#关键字-yield" class="headerlink" title="关键字: yield"></a><strong>关键字</strong>: yield</h4><p>yield可以将函数执行的中间结果返回但是不结束程序。把一个函数变成一个生成器.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(x)</span>:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i&lt;x:</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        i+=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="args-和-kwargs"><a href="#args-和-kwargs" class="headerlink" title="args 和 *kwargs"></a>args 和 *kwargs</h3><h4 id="args：预先并不知道-函数使用者会传递多少个参数"><a href="#args：预先并不知道-函数使用者会传递多少个参数" class="headerlink" title="args：预先并不知道, 函数使用者会传递多少个参数"></a>args：预先并不知道, 函数使用者会传递多少个参数</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_var_args</span><span class="params">(f_arg, *argv)</span>:</span></span><br><span class="line">print(<span class="string">"first normal arg:"</span>, f_arg)</span><br><span class="line"><span class="keyword">for</span> arg <span class="keyword">in</span> argv:</span><br><span class="line">    print(<span class="string">"another arg through *argv:"</span>, arg)</span><br><span class="line"></span><br><span class="line">test_var_args(<span class="string">'yasoob'</span>, <span class="string">'python'</span>, <span class="string">'eggs'</span>, <span class="string">'test'</span>)</span><br><span class="line"></span><br><span class="line">first normal arg: yasoob</span><br><span class="line">another arg through *argv: python</span><br><span class="line">another arg through *argv: eggs</span><br><span class="line">another arg through *argv: test</span><br></pre></td></tr></table></figure>
<h4 id="args：将不定长度的键值对-作为参数传递给一个函数。"><a href="#args：将不定长度的键值对-作为参数传递给一个函数。" class="headerlink" title="**args：将不定长度的键值对, 作为参数传递给一个函数。"></a>**args：将不定长度的键值对, 作为参数传递给一个函数。</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greet_me</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> kwargs.items():</span><br><span class="line">    print(<span class="string">"&#123;0&#125; == &#123;1&#125;"</span>.format(key, value))</span><br><span class="line"></span><br><span class="line">greet_me(name=<span class="string">"yasoob"</span>)</span><br><span class="line">name == yasoob</span><br></pre></td></tr></table></figure>
<h3 id="生成器-Generators"><a href="#生成器-Generators" class="headerlink" title="生成器 Generators"></a>生成器 Generators</h3><p>生成器并不把所有的值存在内存中，而是在运行时生成值。通过遍历来使用，要么用一个“for”循环，要么将它传递给任意可以进行迭代的函数和结构。大多数时候生成器是以函数来实现的。然而，它们并不返回一个值，而是yield(暂且译作“生出”)一个值。</p>
<h4 id="可迭代对象-Iterable"><a href="#可迭代对象-Iterable" class="headerlink" title="可迭代对象(Iterable)"></a>可迭代对象(Iterable)</h4><p> Python中任意的对象，只要它定义了可以返回一个迭代器的<strong>iter</strong>方法，或者定义了可以支持下标索引的<strong>getitem</strong>方法，那么它就是一个可迭代对象。</p>
<h4 id="迭代器-Iterator"><a href="#迭代器-Iterator" class="headerlink" title="迭代器(Iterator)"></a>迭代器(Iterator)</h4><p>任意对象，只要定义了next(Python2) 或者<strong>next</strong>方法，它就是一个迭代器。对于python中的字符串如：p_s = ‘python’来说，p_s是一个可迭代对象，但不是一个迭代器，不可以使用next(p_s),但可以使用iter()函数，使得一个可迭代对象变成一个迭代器：iter(p_s)</p>
<h4 id="迭代-Iteration"><a href="#迭代-Iteration" class="headerlink" title="迭代(Iteration)"></a>迭代(Iteration)</h4><p>用一个循环来遍历某个东西时，这个过程本身就叫迭代。</p>
   <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Python</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generator_function</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> generator_function():</span><br><span class="line">  print(item)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output: 0</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line"><span class="comment"># 7</span></span><br><span class="line"><span class="comment"># 8</span></span><br><span class="line"><span class="comment"># 9</span></span><br></pre></td></tr></table></figure>
<h3 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h3><p>装饰器是：是修改其他函数的功能的函数</p>
<h4 id="在函数中定义函数"><a href="#在函数中定义函数" class="headerlink" title="在函数中定义函数"></a><strong>在函数中定义函数</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hi</span><span class="params">(name=<span class="string">"yasoob"</span>)</span>:</span></span><br><span class="line">     print(<span class="string">"now you are inside the hi() function"</span>)</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">greet</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"now you are in the greet() function"</span></span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">welcome</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"now you are in the welcome() function"</span></span><br><span class="line"> </span><br><span class="line"> print(greet())</span><br><span class="line"> print(welcome())</span><br><span class="line"> print(<span class="string">"now you are back in the hi() function"</span>)</span><br><span class="line"> </span><br><span class="line"> hi()</span><br><span class="line"> <span class="comment">#output:now you are inside the hi() function</span></span><br><span class="line"> <span class="comment">#       now you are in the greet() function</span></span><br><span class="line"> <span class="comment">#       now you are in the welcome() function</span></span><br><span class="line"> <span class="comment">#       now you are back in the hi() function</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 上面展示了无论何时你调用hi(), greet()和welcome()将会同时被调用。</span></span><br><span class="line"> <span class="comment"># 然后greet()和welcome()函数在hi()函数之外是不能访问的，比如：</span></span><br><span class="line"> </span><br><span class="line"> greet()</span><br><span class="line"> <span class="comment">#outputs: NameError: name 'greet' is not defined</span></span><br></pre></td></tr></table></figure>
<h4 id="从函数中返回函数"><a href="#从函数中返回函数" class="headerlink" title="从函数中返回函数"></a><strong>从函数中返回函数</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hi</span><span class="params">(name=<span class="string">"yasoob"</span>)</span>:</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">greet</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"now you are in the greet() function"</span></span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">welcome</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"now you are in the welcome() function"</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">if</span> name == <span class="string">"yasoob"</span>:</span><br><span class="line">     <span class="keyword">return</span> greet</span><br><span class="line"> <span class="keyword">else</span>:</span><br><span class="line">     <span class="keyword">return</span> welcome</span><br><span class="line"> </span><br><span class="line"> a = hi()</span><br><span class="line"> print(a)</span><br><span class="line"> <span class="comment">#outputs: &lt;function greet at 0x7f2143c01500&gt;</span></span><br><span class="line"> <span class="comment">#上面清晰地展示了`a`现在指向到hi()函数中的greet()函数</span></span><br><span class="line"> <span class="comment">#现在试试这个</span></span><br><span class="line"> print(a())</span><br><span class="line"> <span class="comment">#outputs: now you are in the greet() function</span></span><br></pre></td></tr></table></figure>
<h4 id="将函数作为参数传给另一个函数"><a href="#将函数作为参数传给另一个函数" class="headerlink" title="将函数作为参数传给另一个函数"></a><strong>将函数作为参数传给另一个函数</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hi</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">"hi yasoob!"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doSomethingBeforeHi</span><span class="params">(func)</span>:</span></span><br><span class="line">print(<span class="string">"I am doing some boring work before executing hi()"</span>)</span><br><span class="line">print(func())</span><br><span class="line">doSomethingBeforeHi(hi)</span><br><span class="line"><span class="comment">#outputs:I am doing some boring work before executing hi()</span></span><br><span class="line"><span class="comment">#        hi yasoob!</span></span><br></pre></td></tr></table></figure>
<h4 id="装饰器-1"><a href="#装饰器-1" class="headerlink" title="装饰器"></a><strong>装饰器</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_new_decorator</span><span class="params">(a_func)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapTheFunction</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"I am doing some boring work before executing a_func()"</span>)</span><br><span class="line"></span><br><span class="line">        a_func()</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"I am doing some boring work after executing a_func()"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapTheFunction</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_function_requiring_decoration</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"I am the function which needs some decoration to remove my foul smell"</span>)</span><br><span class="line"></span><br><span class="line">a_function_requiring_decoration()</span><br><span class="line"><span class="comment">#outputs: "I am the function which needs some decoration to remove my foul smell"</span></span><br><span class="line"></span><br><span class="line">a_function_requiring_decoration = a_new_decorator(a_function_requiring_decoration)</span><br><span class="line"><span class="comment">#now a_function_requiring_decoration is wrapped by wrapTheFunction()</span></span><br><span class="line"></span><br><span class="line">a_function_requiring_decoration()</span><br><span class="line"><span class="comment">#outputs:I am doing some boring work before executing a_func()</span></span><br><span class="line"><span class="comment">#        I am the function which needs some decoration to remove my foul smell</span></span><br><span class="line"><span class="comment">#        I am doing some boring work after executing a_func()</span></span><br></pre></td></tr></table></figure>
<h4 id="语法糖"><a href="#语法糖" class="headerlink" title="@语法糖"></a><strong>@语法糖</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@a_new_decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_function_requiring_decoration</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""Hey you! Decorate me!"""</span></span><br><span class="line">    print(<span class="string">"I am the function which needs some decoration to "</span></span><br><span class="line">        <span class="string">"remove my foul smell"</span>)</span><br><span class="line"></span><br><span class="line">a_function_requiring_decoration()</span><br><span class="line"><span class="comment">#outputs: I am doing some boring work before executing a_func()</span></span><br><span class="line"><span class="comment">#         I am the function which needs some decoration to remove my foul smell</span></span><br><span class="line"><span class="comment">#         I am doing some boring work after executing a_func()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#the @a_new_decorator is just a short way of saying:</span></span><br><span class="line">a_function_requiring_decoration = a_new_decorator(a_function_requiring_decoration)</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>functools.wraps</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(a_function_requiring_decoration.__name__)</span><br><span class="line"><span class="comment"># Output: wrapTheFunction</span></span><br></pre></td></tr></table></figure>
<p>我们期待的输出应该是“a_function_requiring_decoration”，这里的函数被warpTheFunction替代了。Python提供一个简单的函数来解决这个问题：functools.wrap。</p>
<p>@wraps接受一个函数来进行装饰，并加入了复制函数名称、注释文档、参数列表等等的功能。这可以让我们在装饰器里面访问在装饰之前的函数的属性。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_new_decorator</span><span class="params">(a_func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(a_func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapTheFunction</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"I am doing some boring work before executing a_func()"</span>)</span><br><span class="line">        a_func()</span><br><span class="line">        print(<span class="string">"I am doing some boring work after executing a_func()"</span>)</span><br><span class="line">    <span class="keyword">return</span> wrapTheFunction</span><br><span class="line"></span><br><span class="line"><span class="meta">@a_new_decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_function_requiring_decoration</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""Hey yo! Decorate me!"""</span></span><br><span class="line">    print(<span class="string">"I am the function which needs some decoration to "</span></span><br><span class="line">        <span class="string">"remove my foul smell"</span>)</span><br><span class="line"></span><br><span class="line">print(a_function_requiring_decoration.__name__)</span><br><span class="line"><span class="comment"># Output: a_function_requiring_decoration</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="应用1-日志"><a href="#应用1-日志" class="headerlink" title="应用1:日志"></a>应用1:日志</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">logit</span><span class="params">(logfile=<span class="string">'out.log'</span>)</span>:</span></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">logging_decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">         @wraps(func)</span></span><br><span class="line">         <span class="function"><span class="keyword">def</span> <span class="title">wrapped_function</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">             log_string = func.__name__ + <span class="string">" was called"</span></span><br><span class="line">             print(log_string)</span><br><span class="line">             <span class="comment"># 打开logfile，并写入内容</span></span><br><span class="line">             <span class="keyword">with</span> open(logfile, <span class="string">'a'</span>) <span class="keyword">as</span> opened_file:</span><br><span class="line">                 <span class="comment"># 现在将日志打到指定的logfile</span></span><br><span class="line">                 opened_file.write(log_string + <span class="string">'\n'</span>)</span><br><span class="line">             <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">         <span class="keyword">return</span> wrapped_function</span><br><span class="line">     <span class="keyword">return</span> logging_decorator</span><br><span class="line"> </span><br><span class="line"><span class="meta"> @logit()</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">myfunc1</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"> myfunc1()</span><br><span class="line"> <span class="comment"># Output: myfunc1 was called</span></span><br><span class="line"> <span class="comment"># 现在一个叫做 out.log 的文件出现了，里面的内容就是上面的字符串</span></span><br><span class="line"> </span><br><span class="line"><span class="meta"> @logit(logfile='func2.log')</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">myfunc2</span><span class="params">()</span>:</span></span><br><span class="line">     <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"> myfunc2()</span><br><span class="line"> <span class="comment"># Output: myfunc2 was called</span></span><br><span class="line"> <span class="comment"># 现在一个叫做 func2.log 的文件出现了，里面的内容就是上面的字符串</span></span><br></pre></td></tr></table></figure>
<h5 id="应用2：计算函数运行时间"><a href="#应用2：计算函数运行时间" class="headerlink" title="应用2：计算函数运行时间"></a>应用2：计算函数运行时间</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timethis</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="string">"""Decorator that reports the execution time."""</span></span><br><span class="line"><span class="meta">@wraps(func)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    result = func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        print(func.__name__, end - start, <span class="string">'s'</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    eturn wrapper</span><br></pre></td></tr></table></figure>
<h4 id="装饰器类"><a href="#装饰器类" class="headerlink" title="装饰器类"></a>装饰器类</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">logit</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, logfile=<span class="string">'out.log'</span>)</span>:</span></span><br><span class="line">        self.logfile = logfile</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, func)</span>:</span></span><br><span class="line"><span class="meta">        @wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapped_function</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            log_string = func.__name__ + <span class="string">" was called"</span></span><br><span class="line">            print(log_string)</span><br><span class="line">            <span class="comment"># 打开logfile并写入</span></span><br><span class="line">            <span class="keyword">with</span> open(self.logfile, <span class="string">'a'</span>) <span class="keyword">as</span> opened_file:</span><br><span class="line">                <span class="comment"># 现在将日志打到指定的文件</span></span><br><span class="line">                opened_file.write(log_string + <span class="string">'\n'</span>)</span><br><span class="line">            <span class="comment"># 现在，发送一个通知</span></span><br><span class="line">            self.notify()</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> wrapped_function</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">notify</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># logit只打日志，不做别的</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="对象自省"><a href="#对象自省" class="headerlink" title="对象自省"></a>对象自省</h3><h4 id="dir"><a href="#dir" class="headerlink" title="dir"></a>dir</h4><p>用于自省的最重要的函数之一。它返回一个列表，列出了一个对象所拥有的属性和方法。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">my_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">dir(my_list)</span><br><span class="line"><span class="comment"># Output: ['__add__', '__class__', '__contains__', '__delattr__', '__delitem__',</span></span><br><span class="line"><span class="comment"># '__delslice__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__',</span></span><br><span class="line"><span class="comment"># '__getitem__', '__getslice__', '__gt__', '__hash__', '__iadd__', '__imul__',</span></span><br><span class="line"><span class="comment"># '__init__', '__iter__', '__le__', '__len__', '__lt__', '__mul__', '__ne__',</span></span><br><span class="line"><span class="comment"># '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__reversed__', '__rmul__',</span></span><br><span class="line"><span class="comment"># '__setattr__', '__setitem__', '__setslice__', '__sizeof__', '__str__',</span></span><br><span class="line"><span class="comment"># '__subclasshook__', 'append', 'count', 'extend', 'index', 'insert', 'pop',</span></span><br><span class="line"><span class="comment"># 'remove', 'reverse', 'sort']</span></span><br></pre></td></tr></table></figure>
<h4 id="type-和-id"><a href="#type-和-id" class="headerlink" title="type  和 id"></a>type  和 id</h4><h4 id="inspect"><a href="#inspect" class="headerlink" title="inspect"></a>inspect</h4><p>inspect模块可以查看一个对象的成员</p>
<h3 id="推导式"><a href="#推导式" class="headerlink" title="推导式"></a>推导式</h3><h4 id="列表推导式"><a href="#列表推导式" class="headerlink" title="列表推导式"></a>列表推导式</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">variable = [out_exp <span class="keyword">for</span> out_exp <span class="keyword">in</span> input_list <span class="keyword">if</span> out_exp == <span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<h4 id="字典推导式"><a href="#字典推导式" class="headerlink" title="字典推导式"></a>字典推导式</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;v: k <span class="keyword">for</span> k, v <span class="keyword">in</span> some_dict.items()&#125;</span><br></pre></td></tr></table></figure>
<h3 id="For-else"><a href="#For-else" class="headerlink" title="For - else"></a>For - else</h3><p>   for循环还有一个else从句,这个else从句会在循环正常结束时执行。</p>
   <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">10</span>):</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">2</span>, n):</span><br><span class="line">    <span class="keyword">if</span> n % x == <span class="number">0</span>:</span><br><span class="line">        print(n, <span class="string">'equals'</span>, x, <span class="string">'*'</span>, n / x)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># loop fell through without finding a factor</span></span><br><span class="line">    print(n, <span class="string">'is a prime number'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="函数缓存"><a href="#函数缓存" class="headerlink" title="函数缓存"></a>函数缓存</h3><p>函数缓存允许我们将一个函数对于给定参数的返回值缓存起来。当一个I/O密集的函数被频繁使用相同的参数调用的时候，函数缓存可以节约时间。</p>
<p>Python3.2+</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="meta">@lru_cache(maxsize=32)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print([fib(n) <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">10</span>)])</span><br><span class="line"><span class="comment"># Output: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对返回值清空缓存</span></span><br><span class="line">fib.cache_clear()</span><br></pre></td></tr></table></figure>
<p>python2</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">memoize</span><span class="params">(function)</span>:</span></span><br><span class="line">    memo = &#123;&#125;</span><br><span class="line"><span class="meta">    @wraps(function)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> args <span class="keyword">in</span> memo:</span><br><span class="line">            <span class="keyword">return</span> memo[args]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rv = function(*args)</span><br><span class="line">            memo[args] = rv</span><br><span class="line">            <span class="keyword">return</span> rv</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@memoize</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>: <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> fibonacci(n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">fibonacci(<span class="number">25</span>)</span><br></pre></td></tr></table></figure>
<h3 id="With-上下文管理器"><a href="#With-上下文管理器" class="headerlink" title="With 上下文管理器"></a>With 上下文管理器</h3><p>可以用来管理数据库连接关闭，文件打开关闭一个上下文管理器的类，起码要定义<strong>enter</strong>和<strong>exit</strong>方法。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, file_name, method)</span>:</span></span><br><span class="line">        self.file_obj = open(file_name, method)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.file_obj</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果发生异常，Python会将异常的type,value和traceback传递给__exit__方法。</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, type, value, traceback)</span>:</span></span><br><span class="line">        print(<span class="string">"Exception has been handled"</span>)</span><br><span class="line">        self.file_obj.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> File(<span class="string">'demo.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> opened_file:</span><br><span class="line">    opened_file.undefined_function()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output: Exception has been handled</span></span><br></pre></td></tr></table></figure>
<h3 id="Collections"><a href="#Collections" class="headerlink" title="Collections"></a>Collections</h3><h4 id="Defaultdict"><a href="#Defaultdict" class="headerlink" title="Defaultdict"></a>Defaultdict</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">dict_list = defaultdict(list)</span><br><span class="line">dict_int = defaultdict(int) <span class="comment">#0</span></span><br></pre></td></tr></table></figure>
<h4 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h4><p>Counter是一个计数器，它可以针对某项数据进行计数。</p>
<h4 id="Deque"><a href="#Deque" class="headerlink" title="Deque"></a>Deque</h4><p>deque提供了一个双端队列，可以从头/尾两端添加或删除元素。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d = deque(range(<span class="number">5</span>))</span><br><span class="line">print(len(d))</span><br><span class="line"><span class="comment">## 输出: 5</span></span><br><span class="line">d.popleft()</span><br><span class="line"><span class="comment">## 输出: 0</span></span><br><span class="line">d.pop()</span><br><span class="line"><span class="comment">## 输出: 4</span></span><br><span class="line">print(d)</span><br><span class="line"><span class="comment">## 输出: deque([1, 2, 3])</span></span><br></pre></td></tr></table></figure>
<h4 id="Namedtuple"><a href="#Namedtuple" class="headerlink" title="Namedtuple"></a>Namedtuple</h4><p>可以像字典(dict)一样访问namedtuples，但namedtuples是不可变的。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">Animal = namedtuple(<span class="string">'Animal'</span>, <span class="string">'name age type'</span>)</span><br><span class="line">perry = Animal(name=<span class="string">"perry"</span>, age=<span class="number">31</span>, type=<span class="string">"cat"</span>)</span><br><span class="line"></span><br><span class="line">print(perry)</span><br><span class="line"><span class="comment">## 输出: Animal(name='perry', age=31, type='cat')</span></span><br><span class="line"></span><br><span class="line">print(perry.name)</span><br><span class="line"><span class="comment">## 输出: 'perry'</span></span><br></pre></td></tr></table></figure>
<h4 id="enum-Enum"><a href="#enum-Enum" class="headerlink" title="enum.Enum"></a>enum.Enum</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Species</span><span class="params">(Enum)</span>:</span></span><br><span class="line">    cat = <span class="number">1</span></span><br><span class="line">    dog = <span class="number">2</span></span><br><span class="line">    horse = <span class="number">3</span></span><br><span class="line">    aardvark = <span class="number">4</span></span><br><span class="line">    butterfly = <span class="number">5</span></span><br><span class="line">    owl = <span class="number">6</span></span><br><span class="line">    platypus = <span class="number">7</span></span><br><span class="line">    dragon = <span class="number">8</span></span><br><span class="line">    unicorn = <span class="number">9</span></span><br><span class="line">    <span class="comment"># 依次类推</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 但我们并不想关心同一物种的年龄，所以我们可以使用一个别名</span></span><br><span class="line">    kitten = <span class="number">1</span>  <span class="comment"># (译者注：幼小的猫咪)</span></span><br><span class="line">    puppy = <span class="number">2</span>   <span class="comment"># (译者注：幼小的狗狗)</span></span><br><span class="line"></span><br><span class="line">Animal = namedtuple(<span class="string">'Animal'</span>, <span class="string">'name age type'</span>)</span><br><span class="line">perry = Animal(name=<span class="string">"Perry"</span>, age=<span class="number">31</span>, type=Species.cat)</span><br><span class="line">drogon = Animal(name=<span class="string">"Drogon"</span>, age=<span class="number">4</span>, type=Species.dragon)</span><br><span class="line">tom = Animal(name=<span class="string">"Tom"</span>, age=<span class="number">75</span>, type=Species.cat)</span><br><span class="line">charlie = Animal(name=<span class="string">"Charlie"</span>, age=<span class="number">2</span>, type=Species.kitten)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>charlie.type == tom.type</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>charlie.type</span><br><span class="line">&lt;Species.cat: <span class="number">1</span>&gt;</span><br></pre></td></tr></table></figure>
<h3 id="itertools"><a href="#itertools" class="headerlink" title="itertools"></a>itertools</h3><p>itertools提供的工具相当高效且节省内存。使用这些工具，你将能够创建自己定制的迭代器用于高效率的循环。itertools主要来分为三类函数，分别为无限迭代器、输入序列迭代器、组合生成器</p>
<h4 id="无限迭代器"><a href="#无限迭代器" class="headerlink" title="无限迭代器"></a>无限迭代器</h4><h5 id="Itertools-count-start-0-step-1"><a href="#Itertools-count-start-0-step-1" class="headerlink" title="Itertools.count(start=0, step=1)"></a><strong>Itertools.count(start=0, step=1)</strong></h5><p>创建一个迭代对象，生成从start开始的连续整数，步长为step。如果省略了start则默认从0开始，步长默认为1。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.count():</span><br><span class="line">  <span class="keyword">print</span> i</span><br></pre></td></tr></table></figure>
<h5 id="Itertools-cycle-iterable"><a href="#Itertools-cycle-iterable" class="headerlink" title="Itertools.cycle(iterable)"></a><strong>Itertools.cycle(iterable)</strong></h5><p>创建一个迭代对象，对于输入的iterable的元素反复执行循环操作，内部生成iterable中的元素的一个副本，这个副本用来返回循环中的重复项。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> itertools.cycle([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]):</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">print</span> (i, item)</span><br></pre></td></tr></table></figure>
<h5 id="Itertools-repeat-object-times"><a href="#Itertools-repeat-object-times" class="headerlink" title="Itertools.repeat(object[, times])"></a><strong>Itertools.repeat(object[, times])</strong></h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.repeat(<span class="string">'kivinsae'</span>, <span class="number">5</span>):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br><span class="line"><span class="comment"># kivinsae</span></span><br></pre></td></tr></table></figure>
<h4 id="输入序列迭代器"><a href="#输入序列迭代器" class="headerlink" title="输入序列迭代器"></a>输入序列迭代器</h4><h5 id="itertools-accumulate-iterables"><a href="#itertools-accumulate-iterables" class="headerlink" title="itertools.accumulate(*iterables)"></a>itertools.accumulate(*iterables)</h5><p>这个函数简单来说就是一个累加器，不停对列表或者迭代器进行累加操作（这里指每项累加）。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = itertools.accumulate(range(<span class="number">10</span>))</span><br><span class="line">print(list(x))</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># [0, 1, 3, 6, 10, 15, 21, 28, 36, 45]</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-chain-iterables"><a href="#itertools-chain-iterables" class="headerlink" title="itertools.chain(*iterables)"></a><strong>itertools.chain(*iterables)</strong></h5><p>把多个迭代器作为参数，但是只会返回单个迭代器。产生所有参数迭代器的内容，却好似来自于一个单一的序列。简单了讲就是连接多个 列表 或者 迭代器。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.chain([<span class="string">'p'</span>,<span class="string">'x'</span>,<span class="string">'e'</span>], [<span class="string">'scp'</span>, <span class="string">'nmb'</span>, <span class="string">'balenciaga'</span>]):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># p</span></span><br><span class="line"><span class="comment"># x</span></span><br><span class="line"><span class="comment"># e</span></span><br><span class="line"><span class="comment"># scp</span></span><br><span class="line"><span class="comment"># nmb</span></span><br><span class="line"><span class="comment"># balenciaga</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-compress-data-selectors"><a href="#itertools-compress-data-selectors" class="headerlink" title="itertools.compress(data,selectors)"></a><strong>itertools.compress(data,selectors)</strong></h5><p>compress提供了一个对于原始数据的筛选功能，具体条件可以设置的非常复杂，下面列出相关的定义代码来解释。简单来理解，就是按照真值表进行元素筛选。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  例：</span></span><br><span class="line">list(itertools.compress(<span class="string">'ABCDEF'</span>, [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]))</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># ['A', 'B', 'D', 'F']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体实现：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress</span><span class="params">(data, selectors)</span>:</span></span><br><span class="line">    <span class="comment"># compress('ABCDEF', [1,0,1,0,1,1]) --&gt; A C E F</span></span><br><span class="line">    <span class="keyword">return</span> (d <span class="keyword">for</span> d, s <span class="keyword">in</span> izip(data, selectors) <span class="keyword">if</span> s)</span><br></pre></td></tr></table></figure>
<h5 id="itertools-dropwhile-predicate-iterable"><a href="#itertools-dropwhile-predicate-iterable" class="headerlink" title="itertools.dropwhile(predicate,iterable)"></a><strong>itertools.dropwhile(predicate,iterable)</strong></h5><p>dropwhile作用是创建一个迭代器，只要是函数predicate(item)为True，则丢掉iterable中的项，但是如果predicate返回的是False，则生成iterable中的项和所有的后续项。<br>具体来说就是，在条件为False之后的第一次，就返回迭代器中剩余的所有项。在这个函数表达式里面iterable的值会按索引一个个作为predicate的参数进行计算。简单来说，就是按照真值函数丢弃掉列表和迭代器前面的元素。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">should_drop</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="keyword">return</span> (x &lt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.dropwhile(should_drop, [<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">-2</span>]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># Testing: -1</span></span><br><span class="line"><span class="comment"># Testing: 0</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Yielding: 2</span></span><br><span class="line"><span class="comment"># Yielding: 3</span></span><br><span class="line"><span class="comment"># Yielding: 4</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Yielding: -2</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-groupby-iterable-key"><a href="#itertools-groupby-iterable-key" class="headerlink" title="itertools.groupby(iterable[,key])"></a><strong>itertools.groupby(iterable[,key])</strong></h5><p>返回一个集合的迭代器，集合内是按照key进行分组后的值。<br>如果iterable在多次连续的迭代中生成了同一项，则会定义一个组，如果对这个函数应用一个分类列表，那么分组会定义这个列表中所有的唯一项，key是一个函数并应用于每一项。如果这个函数有返回值，则这个值会用于后续的项，而不是和该项本身进行比较。这个函数返回的迭代器生成元素(key,group)，key是分组的键值，group是迭代器，从而生成组成这个组的所有项目。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="string">'aa'</span>, <span class="string">'ab'</span>, <span class="string">'abc'</span>, <span class="string">'bcd'</span>, <span class="string">'abcde'</span>]</span><br><span class="line"><span class="keyword">for</span> i, k <span class="keyword">in</span> itertools.groupby(a, len):</span><br><span class="line">    <span class="keyword">print</span> i, list(k)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># 2 ['aa', 'ab']</span></span><br><span class="line"><span class="comment"># 3 ['abc', 'bcd']</span></span><br><span class="line"><span class="comment"># 5 ['abcde']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">groupby</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="comment"># [k for k, g in groupby('AAAABBBCCDAABBB')] --&gt; A B C D A B</span></span><br><span class="line">        <span class="comment"># [list(g) for k, g in groupby('AAAABBBCCD')] --&gt; AAAA BBB CC D</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, iterable, key=None)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> key <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                key = <span class="keyword">lambda</span> x: x</span><br><span class="line">            self.keyfunc = key</span><br><span class="line">            self.it = iter(iterable)</span><br><span class="line">            self.tgtkey = self.currkey = self.currvalue = object()</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">next</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">while</span> self.currkey == self.tgtkey:</span><br><span class="line">                self.currvalue = next(self.it)    <span class="comment"># Exit on StopIteration</span></span><br><span class="line">                self.currkey = self.keyfunc(self.currvalue)</span><br><span class="line">            self.tgtkey = self.currkey</span><br><span class="line">            <span class="keyword">return</span> (self.currkey, self._grouper(self.tgtkey))</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">_grouper</span><span class="params">(self, tgtkey)</span>:</span></span><br><span class="line">            <span class="keyword">while</span> self.currkey == tgtkey:</span><br><span class="line">                <span class="keyword">yield</span> self.currvalue</span><br><span class="line">                self.currvalue = next(self.it)    <span class="comment"># Exit on StopIteration</span></span><br><span class="line">                self.currkey = self.keyfunc(self.currvalue)</span><br></pre></td></tr></table></figure>
<h5 id="itertools-ifilter-predicate-iterable"><a href="#itertools-ifilter-predicate-iterable" class="headerlink" title="itertools.ifilter(predicate,iterable)"></a><strong>itertools.ifilter(predicate,iterable)</strong></h5><p>函数返回一个迭代器，类似于针对于列表的函数filter()，但是只包括测试函数返回True时候的值。和dropwhile()作用不同。<br>函数创建一个迭代器，只生成predicate(iterable)为True的项，简单来说就是返回iterable中所有计算后为True的项。如果是非True则进行之后的其他操作。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_item</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="keyword">return</span> (x&lt;<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.ifilter(check_item, [ <span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">-2</span> ]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># Testing: -1</span></span><br><span class="line"><span class="comment"># Yielding: -1</span></span><br><span class="line"><span class="comment"># Testing: 0</span></span><br><span class="line"><span class="comment"># Yielding: 0</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Testing: 2</span></span><br><span class="line"><span class="comment"># Testing: 3</span></span><br><span class="line"><span class="comment"># Testing: 4</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Testing: -2</span></span><br><span class="line"><span class="comment"># Yielding: -2</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-ifilterfalse-predicate-iterable"><a href="#itertools-ifilterfalse-predicate-iterable" class="headerlink" title="itertools.ifilterfalse(predicate,iterable)"></a><strong>itertools.ifilterfalse(predicate,iterable)</strong></h5><p>本函数和上面的ifilter一样，唯一的区别是只有当predicate(iterable)为False时候才进行predicate的输出。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_item</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="keyword">return</span> (x &lt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.ifilterfalse(check_item, [<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">-2</span>]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># Testing: -1</span></span><br><span class="line"><span class="comment"># Testing: 0</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Testing: 2</span></span><br><span class="line"><span class="comment"># Yielding: 2</span></span><br><span class="line"><span class="comment"># Testing: 3</span></span><br><span class="line"><span class="comment"># Yielding: 3</span></span><br><span class="line"><span class="comment"># Testing: 4</span></span><br><span class="line"><span class="comment"># Yielding: 4</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Testing: -2</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-islice-iterable-stop"><a href="#itertools-islice-iterable-stop" class="headerlink" title="itertools.islice(iterable,stop)"></a><strong>itertools.islice(iterable,stop)</strong></h5><p>简单来说这个函数，就是对于一个迭代对象iterable，设定一个特定的切片/选取/截取规则，然后最后输出一个特定的新的迭代对象的过程。这个stop实际上代表一个三元数组，也就是start，stop，step。如果start省略，默认从索引0开始；如果step被省略，则默认步长为1；stop不能被省略。本质就是一个切片工具。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Stop at 5:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.islice(itertools.count(), <span class="number">5</span>):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Start at 5, Stop at 10:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.islice(itertools.count(), <span class="number">5</span>, <span class="number">10</span>):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="keyword">print</span> <span class="string">'By tens to 100:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.islice(itertools.count(), <span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># Stop</span></span><br><span class="line"><span class="comment"># at</span></span><br><span class="line"><span class="comment"># 5:</span></span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># Start</span></span><br><span class="line"><span class="comment"># at</span></span><br><span class="line"><span class="comment"># 5, Stop</span></span><br><span class="line"><span class="comment"># at</span></span><br><span class="line"><span class="comment"># 10:</span></span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line"><span class="comment"># 7</span></span><br><span class="line"><span class="comment"># 8</span></span><br><span class="line"><span class="comment"># 9</span></span><br><span class="line"><span class="comment"># By</span></span><br><span class="line"><span class="comment"># tens</span></span><br><span class="line"><span class="comment"># to</span></span><br><span class="line"><span class="comment"># 100:</span></span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"><span class="comment"># 20</span></span><br><span class="line"><span class="comment"># 30</span></span><br><span class="line"><span class="comment"># 40</span></span><br><span class="line"><span class="comment"># 50</span></span><br><span class="line"><span class="comment"># 60</span></span><br><span class="line"><span class="comment"># 70</span></span><br><span class="line"><span class="comment"># 80</span></span><br><span class="line"><span class="comment"># 90</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-imap-function-iterable"><a href="#itertools-imap-function-iterable" class="headerlink" title="itertools.imap(function,*iterable)"></a><strong>itertools.imap(function,*iterable)</strong></h5><p>本函数创建一个迭代器，作用函数为function1，function2，function3…，对应的变量来自迭代器iterable1，iterable2，iterable3…。然后返回一个(f1,f2,f3…)形式的元组。只要其中一个迭代器不再生成值，这个函数就会停止。所以要处理好None的情况，用一下替代输出之类的方法。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="string">'Doubles:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.imap(<span class="keyword">lambda</span> x:<span class="number">2</span>*x, xrange(<span class="number">5</span>)):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Multiples:'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.imap(<span class="keyword">lambda</span> x,y:(x, y, x*y), xrange(<span class="number">5</span>), xrange(<span class="number">5</span>,<span class="number">10</span>)):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'%d * %d = %d'</span> % i</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># Doubles:</span></span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line"><span class="comment"># 8</span></span><br><span class="line"><span class="comment"># Multiples:</span></span><br><span class="line"><span class="comment"># 0 * 5 = 0</span></span><br><span class="line"><span class="comment"># 1 * 6 = 6</span></span><br><span class="line"><span class="comment"># 2 * 7 = 14</span></span><br><span class="line"><span class="comment"># 3 * 8 = 24</span></span><br><span class="line"><span class="comment"># 4 * 9 = 36</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-starmap-function-iterable"><a href="#itertools-starmap-function-iterable" class="headerlink" title="itertools.starmap(function,iterable)"></a><strong>itertools.starmap(function,iterable)</strong></h5><p>函数创建一个函数，其中内调用的function(*item)，item来自于iterable。只有当迭代对象iterable生成的项适合这个函数的调用形式的时候，starmap才会有效。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.starmap(<span class="keyword">lambda</span> x,y:(x, y, x*y), [(<span class="number">0</span>, <span class="number">5</span>), (<span class="number">1</span>, <span class="number">6</span>), (<span class="number">2</span>, <span class="number">7</span>), (<span class="number">3</span>, <span class="number">8</span>), (<span class="number">4</span>, <span class="number">9</span>)]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'%d * %d = %d'</span> % i</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># 0 * 5 = 0</span></span><br><span class="line"><span class="comment"># 1 * 6 = 6</span></span><br><span class="line"><span class="comment"># 2 * 7 = 14</span></span><br><span class="line"><span class="comment"># 3 * 8 = 24</span></span><br><span class="line"><span class="comment"># 4 * 9 = 36</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-tee-iterable-n-2"><a href="#itertools-tee-iterable-n-2" class="headerlink" title="itertools.tee(iterable[,n=2])"></a><strong>itertools.tee(iterable[,n=2])</strong></h5><p>函数会返回若干个基于某个原始输入的独立迭代器。类似于Linux系统上的tee指令。如果不特地制定n的话，函数会默认是2。tee括号里面最好使用标准输入，而不是原始迭代器。不然会在某些缓存过程中出现异常。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">r = itertools.islice(itertools.count(), <span class="number">5</span>)</span><br><span class="line">i1, i2 = itertools.tee(r)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> i1:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'i1:'</span>, i</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> i2:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'i2:'</span>, i</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># i1: 0</span></span><br><span class="line"><span class="comment"># i1: 1</span></span><br><span class="line"><span class="comment"># i1: 2</span></span><br><span class="line"><span class="comment"># i1: 3</span></span><br><span class="line"><span class="comment"># i1: 4</span></span><br><span class="line"><span class="comment"># i2: 0</span></span><br><span class="line"><span class="comment"># i2: 1</span></span><br><span class="line"><span class="comment"># i2: 2</span></span><br><span class="line"><span class="comment"># i2: 3</span></span><br><span class="line"><span class="comment"># i2: 4</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-takewhile-predicate-iterable"><a href="#itertools-takewhile-predicate-iterable" class="headerlink" title="itertools.takewhile(predicate,iterable)"></a><strong>itertools.takewhile(predicate,iterable)</strong></h5><p>函数和dropwhile刚好相反，只要predicate计算后为False，迭代过程立刻停止。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">should_take</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Testing:'</span>, x</span><br><span class="line">    <span class="keyword">return</span> (x&lt;<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.takewhile(should_take, [ <span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">-2</span> ]):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Yielding:'</span>, i</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># Testing: -1</span></span><br><span class="line"><span class="comment"># Yielding: -1</span></span><br><span class="line"><span class="comment"># Testing: 0</span></span><br><span class="line"><span class="comment"># Yielding: 0</span></span><br><span class="line"><span class="comment"># Testing: 1</span></span><br><span class="line"><span class="comment"># Yielding: 1</span></span><br><span class="line"><span class="comment"># Testing: 2</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-izip-iterables"><a href="#itertools-izip-iterables" class="headerlink" title="itertools.izip( *iterables)"></a><strong>itertools.izip( *iterables)</strong></h5><p>这个函数返回一个合并多个迭代器，成为一个元组的迭代对象。类似于内置函数zip，但返回的是迭代对象而非列表。<br>创建一个迭代对象，生成元组(i1,i2,i3…)分别来自于i1,i2,i3…，只要提供的某个迭代器不在生成值，函数就会立刻停止。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.izip([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># (1, 'a')</span></span><br><span class="line"><span class="comment"># (2, 'b')</span></span><br><span class="line"><span class="comment"># (3, 'c')</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-izip-longest-iterable-fillvalue"><a href="#itertools-izip-longest-iterable-fillvalue" class="headerlink" title="itertools.izip_longest(*iterable[,fillvalue])"></a><strong>itertools.izip_longest(*iterable[,fillvalue])</strong></h5><p>函数和izip雷同，但是区别在于不会停止，会把所有输入的迭代对象全部耗尽为止，对于参数不匹配的项，会用None代替。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.izip_longest([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="string">'a'</span>, <span class="string">'b'</span>]):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># (1, 'a')</span></span><br><span class="line"><span class="comment"># (2, 'b')</span></span><br><span class="line"><span class="comment"># (3, None)</span></span><br></pre></td></tr></table></figure>
<h4 id="组合生成器"><a href="#组合生成器" class="headerlink" title="组合生成器"></a>组合生成器</h4><h5 id="itertools-product-iterable-repeat"><a href="#itertools-product-iterable-repeat" class="headerlink" title="itertools.product(*iterable[,repeat])"></a><strong>itertools.product(*iterable[,repeat])</strong></h5><p>这个工具就是产生多个列表或者迭代器的n维积。如果没有特别指定repeat默认为列表和迭代器的数量。（笛卡尔积）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">b = (<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>)</span><br><span class="line">c = itertools.product(a,b)</span><br><span class="line"><span class="keyword">for</span> elem <span class="keyword">in</span> c:</span><br><span class="line">    <span class="keyword">print</span> elem</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># (1, 'A')</span></span><br><span class="line"><span class="comment"># (1, 'B')</span></span><br><span class="line"><span class="comment"># (1, 'C')</span></span><br><span class="line"><span class="comment"># (2, 'A')</span></span><br><span class="line"><span class="comment"># (2, 'B')</span></span><br><span class="line"><span class="comment"># (2, 'C')</span></span><br><span class="line"><span class="comment"># (3, 'A')</span></span><br><span class="line"><span class="comment"># (3, 'B')</span></span><br><span class="line"><span class="comment"># (3, 'C')</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-permutations-iterable-r"><a href="#itertools-permutations-iterable-r" class="headerlink" title="itertools.permutations(iterable[,r])"></a><strong>itertools.permutations(iterable[,r])</strong></h5><p>函数作用其实就是产生指定数目repeat的元素的所有排列，且顺序有关，但是遇到原列表或者迭代器有重复元素的现象的时候，也会对应的产生重复项。这个时候最好用groupby或者其他filter去一下重，如果有需要的话。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = itertools.permutations(range(<span class="number">4</span>), <span class="number">3</span>)</span><br><span class="line">print(list(x))</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># [(0, 1, 2), </span></span><br><span class="line"><span class="comment"># (0, 1, 3), </span></span><br><span class="line"><span class="comment"># (0, 2, 1), </span></span><br><span class="line"><span class="comment"># (0, 2, 3), </span></span><br><span class="line"><span class="comment"># (0, 3, 1), </span></span><br><span class="line"><span class="comment"># (0, 3, 2), </span></span><br><span class="line"><span class="comment"># (1, 0, 2), </span></span><br><span class="line"><span class="comment"># (1, 0, 3), </span></span><br><span class="line"><span class="comment"># (1, 2, 0), </span></span><br><span class="line"><span class="comment"># (1, 2, 3), </span></span><br><span class="line"><span class="comment"># (1, 3, 0), </span></span><br><span class="line"><span class="comment"># (1, 3, 2), </span></span><br><span class="line"><span class="comment"># (2, 0, 1), </span></span><br><span class="line"><span class="comment"># (2, 0, 3), </span></span><br><span class="line"><span class="comment"># (2, 1, 0), </span></span><br><span class="line"><span class="comment"># (2, 1, 3), </span></span><br><span class="line"><span class="comment"># (2, 3, 0), </span></span><br><span class="line"><span class="comment"># (2, 3, 1), </span></span><br><span class="line"><span class="comment"># (3, 0, 1),</span></span><br><span class="line"><span class="comment"># (3, 0, 2), </span></span><br><span class="line"><span class="comment"># (3, 1, 0), </span></span><br><span class="line"><span class="comment"># (3, 1, 2), </span></span><br><span class="line"><span class="comment"># (3, 2, 0), </span></span><br><span class="line"><span class="comment"># (3, 2, 1)</span></span><br><span class="line"><span class="comment"># ]</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-combinations-iterable-r"><a href="#itertools-combinations-iterable-r" class="headerlink" title="itertools.combinations(iterable,r)"></a><strong>itertools.combinations(iterable,r)</strong></h5><p>这个函数用来生成指定数目r的元素不重复的所有组合。注意和permutation的区分，以及这个组合是无序的，只考虑元素本身的unique性。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = itertools.combinations(range(<span class="number">4</span>), <span class="number">3</span>)</span><br><span class="line">print(list(x))</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># [(0, 1, 2), (0, 1, 3), (0, 2, 3), (1, 2, 3)]</span></span><br></pre></td></tr></table></figure>
<h5 id="itertools-combinations-with-replacement-iterable-r"><a href="#itertools-combinations-with-replacement-iterable-r" class="headerlink" title="itertools.combinations_with_replacement(iterable,r)"></a><strong>itertools.combinations_with_replacement(iterable,r)</strong></h5><p>这个函数用来生成指定数目r的元素可重复的所有组合。然而这个函数依然要保证元素组合的unique性。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = itertools.combinations_with_replacement(<span class="string">'ABC'</span>, <span class="number">2</span>)</span><br><span class="line">print(list(x))</span><br><span class="line"><span class="comment"># 输出为：</span></span><br><span class="line"><span class="comment"># [('A', 'A'), </span></span><br><span class="line"><span class="comment"># ('A', 'B'), </span></span><br><span class="line"><span class="comment"># ('A', 'C'), </span></span><br><span class="line"><span class="comment"># ('B', 'B'), </span></span><br><span class="line"><span class="comment"># ('B', 'C'), </span></span><br><span class="line"><span class="comment"># ('C', 'C’)</span></span><br><span class="line"><span class="comment"># ]</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>python</category>
      </categories>
  </entry>
  <entry>
    <title>Vim速查</title>
    <url>/2018/05/29/Vim%E9%80%9F%E6%9F%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="vim（Visual-Interface）"><a href="#vim（Visual-Interface）" class="headerlink" title="vim（Visual Interface）"></a>vim（Visual Interface）</h2><p><img src="/2018/05/29/Vim%E9%80%9F%E6%9F%A5/NSFileHandle.png" alt="avatar"></p>
<a id="more"></a>
<h3 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h3><ol>
<li>h：左移</li>
<li>j：下移</li>
<li>k：上移</li>
<li>l(L)：右移</li>
<li><code>^</code> 或 <code>0</code>：光标移动到当前行的行首。</li>
<li><code>1$</code>：光标移动到当前行的行末，<code>2$</code>:光标移动到下一行的行末,…。</li>
<li>M：光标移动到中间行</li>
<li>L：光标移动到屏幕最后一行行首</li>
<li>G：移动到指定行，行号 -G，只有G的话，到文件最末尾</li>
<li>gg：文件第一个字符</li>
<li>w:向后一次移动一个字</li>
<li>b：向前一次移动一个字</li>
<li>{：按段移动，上移</li>
<li>}：按段下移，下移</li>
<li>ctrl+d：向下翻半屏</li>
<li>ctrl+u：向上翻半屏</li>
<li>ctrl+f：向下翻一屏</li>
<li>ctrl+b：向上翻一屏</li>
</ol>
<h4 id="可视模式"><a href="#可视模式" class="headerlink" title="可视模式"></a>可视模式</h4><ol>
<li>v:按字符移动，结合h,j,k,l选中文本内容。</li>
<li>V：按行移动，选中文本可视模式，可以配合d，y，&gt;&gt;,&lt;&lt;实现对文本块的删除，复制，左右移动。</li>
</ol>
<h4 id="删除命令"><a href="#删除命令" class="headerlink" title="删除命令"></a>删除命令</h4><ol>
<li>x：删除光标后一个字符，n x 删除光标后的n个字符</li>
<li>X：删除光标前一个字符，相当于Backspace</li>
<li>dd：删除光标所在行，n dd删除指定的n行</li>
<li>D：删除光标后本行所有内容，包含光标所在字符</li>
<li>d0：删除光标前本行所有内容，不包含光标所在字符</li>
<li>dw：删除光标开始位置的字，包含光标所在字符</li>
</ol>
<h4 id="撤销命令"><a href="#撤销命令" class="headerlink" title="撤销命令"></a>撤销命令</h4><ol>
<li>u：一步一步撤销</li>
<li>ctrl+r：反撤销</li>
</ol>
<h4 id="重复命令"><a href="#重复命令" class="headerlink" title="重复命令"></a>重复命令</h4><ol>
<li>. ：重复上一次操作的命令</li>
</ol>
<h4 id="文本移动"><a href="#文本移动" class="headerlink" title="文本移动"></a>文本移动</h4><ol>
<li>>&gt;:文本行右移</li>
<li>\&lt;&lt;:文本行左移</li>
</ol>
<h4 id="复制粘贴"><a href="#复制粘贴" class="headerlink" title="复制粘贴"></a>复制粘贴</h4><ol>
<li>yy：复制当前行，n yy复制n行</li>
<li>在末行模式，输入：a,by 复制从第a行开始，到第b行结束的内容</li>
<li>p：在光标坐在位置向下新开辟一行，粘贴</li>
<li>d：剪切选中内容</li>
</ol>
<h4 id="查找命令"><a href="#查找命令" class="headerlink" title="查找命令"></a>查找命令</h4><ol>
<li>/str : 查找str，从光标所在行往下查找</li>
<li>？str：查找str，从光标所在行往上查找</li>
<li>n：查找下一个</li>
<li>N：查找上一个 </li>
</ol>
<h4 id="替换操作"><a href="#替换操作" class="headerlink" title="替换操作"></a>替换操作</h4><ol>
<li>r：替换当前字符</li>
<li>R替换当前行光标后的字符</li>
</ol>
<h4 id="替换命令"><a href="#替换命令" class="headerlink" title="替换命令"></a>替换命令</h4><ol>
<li>末行模式下，将光标所在行的abc替换成123，：s/abc/123/g</li>
<li>末行模式下，将第一行到第10行之间的abc替换成123，:1,10s/abc/123/g</li>
<li>末行模式下，把文件中的abc全部替换成123，:%s/abc/123</li>
</ol>
<h3 id="输入模式"><a href="#输入模式" class="headerlink" title="输入模式"></a>输入模式</h3><ol>
<li>i：插入光标前一个字符</li>
<li>I：插入行首</li>
<li>a：插入光标后一个字符</li>
<li>A: 插入行末</li>
<li>o：向下新开一行，插入行首</li>
<li><p>O：向上新开一行，插入行首</p>
<h3 id="末行模式"><a href="#末行模式" class="headerlink" title="末行模式"></a>末行模式</h3></li>
<li><p>：set nu 显示行号</p>
</li>
<li>! shell命令</li>
<li>wq：保存退出</li>
<li>ZZ： 保存退出</li>
<li>q！：不保存退出</li>
</ol>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>修改用户目录下的vimrc（~/.vimrc）文件，修改vim配置</p>
<ol>
<li>set nu :设置每次vim 打开文件显示行号。</li>
<li>set ts=4:设置tab键每次4个空格</li>
</ol>
]]></content>
      <categories>
        <category>soft skill</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Vim</tag>
        <tag>速查</tag>
      </tags>
  </entry>
  <entry>
    <title>latex公式速查</title>
    <url>/2018/05/10/latex%E5%85%AC%E5%BC%8F%E9%80%9F%E6%9F%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="上下标"><a href="#上下标" class="headerlink" title="上下标"></a>上下标</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>x_{2}</td>
<td>$x_{2}$</td>
</tr>
<tr>
<td>x^2</td>
<td>$x^{2}$</td>
</tr>
</tbody>
</table>
</div>
<a id="more"></a>
<h3 id="公式序号"><a href="#公式序号" class="headerlink" title="公式序号"></a>公式序号</h3><script type="math/tex; mode=display">
y = wx+b \tag{1.1}</script><h3 id="括号"><a href="#括号" class="headerlink" title="括号"></a>括号</h3><ol>
<li><p>() [] 直接写就行，而 {} 则需要转义</p>
<ol>
<li>y \in \{3, 4, 5\} : $y \in \{3, 4, 5\}$</li>
</ol>
</li>
<li><p>有时候括号需要大号的，此时需要使用\left和\right加大括号的大小。</p>
<ol>
<li>\left(\frac {x} {y} \right)^2 : $\left(\frac {x} {y} \right)^2$</li>
</ol>
</li>
<li><p>\left 和 \right必须成对出现，对于不显示的一边可以使用 . 代替</p>
</li>
<li><p>\left. \frac{du}{dx} \right| _{x=0} : $\left. \frac{du}{dx} \right| _{x=0}$</p>
</li>
<li><p>双括号$\left|g_{k}\right|$</p>
</li>
<li><p>左大括号：</p>
<p> <code>\left\{\begin{array}{ll}
 x=\frac{3 \pi}{2}(1+2 t) \cos \left(\frac{3 \pi}{2}(1+2 t)\right) &amp; \\
 y=s, &amp; 0 \leq s \leq L,|t| \leq 1 \\
 z=\frac{3 \pi}{2}(1+2 t) \sin \left(\frac{3 \pi}{2}(1+2 t)\right)
 \end{array}\right.</code></p>
<script type="math/tex; mode=display">
 \left\{\begin{array}{ll}
 x=\frac{3 \pi}{2}(1+2 t) \cos \left(\frac{3 \pi}{2}(1+2 t)\right) & \\
 y=s, & 0 \leq s \leq L,|t| \leq 1 \\
 z=\frac{3 \pi}{2}(1+2 t) \sin \left(\frac{3 \pi}{2}(1+2 t)\right)
 \end{array}\right.</script></li>
</ol>
<h3 id="分数"><a href="#分数" class="headerlink" title="分数"></a>分数</h3><p>两种写法：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">显示</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">\frac{1}{2x+1}</td>
<td style="text-align:center">$\frac{1}{2x+1}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="开方"><a href="#开方" class="headerlink" title="开方"></a>开方</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\sqrt[n]{a}</td>
<td>$\sqrt[n]{a}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="对数"><a href="#对数" class="headerlink" title="对数"></a>对数</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\log</td>
<td>$\log$</td>
</tr>
<tr>
<td>\lg</td>
<td>$\lg$</td>
</tr>
<tr>
<td>\ln</td>
<td>$\ln$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="向量"><a href="#向量" class="headerlink" title="向量"></a>向量</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\vec{a}</td>
<td>$\vec{a}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="三角运算"><a href="#三角运算" class="headerlink" title="三角运算"></a>三角运算</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
<th></th>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\bot</td>
<td>$\bot$</td>
<td></td>
<td>\angle</td>
<td>$\angle$</td>
</tr>
<tr>
<td>\sin</td>
<td>$\sin$</td>
<td></td>
<td>\cos</td>
<td>$\cos$</td>
</tr>
<tr>
<td>\tan</td>
<td>$\tan$</td>
<td></td>
<td>\cot</td>
<td>$\cot$</td>
</tr>
<tr>
<td>\sec</td>
<td>$\sec$</td>
<td></td>
<td>\csc</td>
<td>$\csc$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="省略号"><a href="#省略号" class="headerlink" title="省略号"></a>省略号</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\ldots</td>
<td>$\ldots$</td>
</tr>
<tr>
<td>\cdots</td>
<td>$\cdots$</td>
</tr>
<tr>
<td>\cdot</td>
<td>$\cdot$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="需要转义的字符"><a href="#需要转义的字符" class="headerlink" title="需要转义的字符"></a>需要转义的字符</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
<th></th>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\#</td>
<td>$#$</td>
<td></td>
<td>\_</td>
<td>$_$</td>
</tr>
<tr>
<td>\$</td>
<td>$$$</td>
<td></td>
<td>\\%</td>
<td>$\%$</td>
</tr>
<tr>
<td>\\&amp;</td>
<td>$\&amp;$</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>\\{</td>
<td>$\{$</td>
<td></td>
<td>\\}</td>
<td>$\}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="普通符号"><a href="#普通符号" class="headerlink" title="普通符号"></a>普通符号</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
<th></th>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\pm</td>
<td>$\pm$</td>
<td></td>
<td>\times</td>
<td>$\times$</td>
</tr>
<tr>
<td>\div</td>
<td>$\div$</td>
<td></td>
<td>\mid</td>
<td>$\mid$</td>
</tr>
<tr>
<td>\cdot</td>
<td>$\cdot$</td>
<td></td>
<td>\circ</td>
<td>$\circ$</td>
</tr>
<tr>
<td>\ast</td>
<td>$\ast$</td>
<td></td>
<td>\bigodot</td>
<td>$\bigodot$</td>
</tr>
<tr>
<td>\bigotimes</td>
<td>$\bigotimes$</td>
<td></td>
<td>\equiv</td>
<td>$\equiv$</td>
</tr>
<tr>
<td>\leq or \le</td>
<td>$\leq$</td>
<td></td>
<td>\geq or \ge</td>
<td>$\geq$</td>
</tr>
<tr>
<td>\ll</td>
<td>$\ll$</td>
<td></td>
<td>\gg</td>
<td>$\gg$</td>
</tr>
<tr>
<td>\neq or  \ne</td>
<td>$\neq$</td>
<td></td>
<td>\approx</td>
<td>$\approx$</td>
</tr>
<tr>
<td>\succeq</td>
<td>$\succeq$</td>
<td></td>
<td>\preceq</td>
<td>$\preceq$</td>
</tr>
<tr>
<td>\doteq</td>
<td>$\doteq$</td>
<td></td>
<td>\cong</td>
<td>$\cong$</td>
</tr>
<tr>
<td>\sim</td>
<td>$\sim$</td>
<td></td>
<td>\simeq</td>
<td>$\simeq$</td>
</tr>
<tr>
<td>\vdash</td>
<td>$\vdash$</td>
<td></td>
<td>\dashv</td>
<td>$\dashv$</td>
</tr>
<tr>
<td>\models</td>
<td>$\models$</td>
<td></td>
<td>\perp</td>
<td>$\perp$</td>
</tr>
<tr>
<td>\smile</td>
<td>$\smile$</td>
<td></td>
<td>\frown</td>
<td>$\frown$</td>
</tr>
<tr>
<td>\saymp</td>
<td>$\asymp$</td>
<td></td>
<td>\:</td>
<td>$\:$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="希腊字母"><a href="#希腊字母" class="headerlink" title="希腊字母"></a>希腊字母</h3><p>大写：开头字母大写<br>斜体：命令前面加var</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
<th>大写</th>
<th>斜体</th>
<th></th>
<th>命令</th>
<th>显示</th>
<th>大写</th>
<th>斜体</th>
</tr>
</thead>
<tbody>
<tr>
<td>\alpha</td>
<td>$\alpha$</td>
<td>A</td>
<td></td>
<td></td>
<td>\beta</td>
<td>$\beta$</td>
<td>B</td>
<td></td>
</tr>
<tr>
<td>\gamma</td>
<td>$\gamma$</td>
<td>$\Gamma$</td>
<td>$\varGamma$</td>
<td></td>
<td>\delta</td>
<td>$\delta$</td>
<td>$\Delta$</td>
<td>$\varDelta$</td>
</tr>
<tr>
<td>\epsilon</td>
<td>$\epsilon$</td>
<td>E</td>
<td>$\varepsilon$</td>
<td></td>
<td>\zeta</td>
<td>$\zeta$</td>
<td>Z</td>
<td></td>
</tr>
<tr>
<td>\eta</td>
<td>$\eta$</td>
<td>H</td>
<td></td>
<td></td>
<td>\theta</td>
<td>$\theta$</td>
<td>$\Theta$</td>
<td>$\varTheta$</td>
</tr>
<tr>
<td>\iota</td>
<td>$\iota$</td>
<td>I</td>
<td></td>
<td></td>
<td>\kappa</td>
<td>$\kappa$</td>
<td>K</td>
<td></td>
</tr>
<tr>
<td>\lambda</td>
<td>$\lambda$</td>
<td>$\Lambda$</td>
<td>$\varLambda$</td>
<td></td>
<td>\mu</td>
<td>$\mu$</td>
<td>M</td>
<td></td>
</tr>
<tr>
<td>\xi</td>
<td>$\xi$</td>
<td>$\Xi$</td>
<td>$\varXi$</td>
<td></td>
<td>\nu</td>
<td>$\nu$</td>
<td>N</td>
<td></td>
</tr>
<tr>
<td>\pi</td>
<td>$\pi$</td>
<td>$\Pi$</td>
<td>$\varPi$</td>
<td></td>
<td>\rho</td>
<td>$\rho$</td>
<td>P</td>
<td>$\varrho$</td>
</tr>
<tr>
<td>\sigma</td>
<td>$\sigma$</td>
<td>$\Sigma$</td>
<td>$\varSigma$</td>
<td></td>
<td>\tau</td>
<td>$\tau$</td>
<td>T</td>
<td></td>
</tr>
<tr>
<td>\upsilon</td>
<td>$\upsilon$</td>
<td>$\Upsilon$</td>
<td>$\varUpsilon$</td>
<td></td>
<td>\phi</td>
<td>$\phi$</td>
<td>$\Phi$</td>
<td>$\varPhi$</td>
</tr>
<tr>
<td>\chi</td>
<td>$\chi$</td>
<td>X</td>
<td></td>
<td></td>
<td>\psi</td>
<td>$\psi$</td>
<td>$\Psi$</td>
<td>$\varPsi$</td>
</tr>
<tr>
<td>\omega</td>
<td>$\omega$</td>
<td>$\Omega$</td>
<td>$\varOmega$</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p><img src="/2018/05/10/latex%E5%85%AC%E5%BC%8F%E9%80%9F%E6%9F%A5/NSFileHandle.png" alt="5f979c551b937e468a1ed99ff62134d4"></p>
<h3 id="集合运算"><a href="#集合运算" class="headerlink" title="集合运算"></a>集合运算</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
<th></th>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\emptyset</td>
<td>$\emptyset$</td>
<td></td>
<td>\propto</td>
<td>$\propto$</td>
</tr>
<tr>
<td>\notin</td>
<td>$\notin$</td>
<td></td>
<td>\Join or \bowtie</td>
<td>$\Join$</td>
</tr>
<tr>
<td>\supset</td>
<td>$\supset$</td>
<td></td>
<td>\subseteq</td>
<td>$\subseteq$</td>
</tr>
<tr>
<td>\subset</td>
<td>$\subset$</td>
<td></td>
<td>\supseteq</td>
<td>$\supseteq$</td>
</tr>
<tr>
<td>\sqsubset</td>
<td>$\sqsubset$</td>
<td></td>
<td>\sqsupseteq</td>
<td>$\sqsupseteq$</td>
</tr>
<tr>
<td>\bigcap</td>
<td>$\bigcap$</td>
<td></td>
<td>\bigcup</td>
<td>$\bigcup$</td>
</tr>
<tr>
<td>\bigvee</td>
<td>$\bigvee$</td>
<td></td>
<td>\bigwedge</td>
<td>$\bigwedge$</td>
</tr>
<tr>
<td>\biguplus</td>
<td>$\biguplus$</td>
<td></td>
<td>\bigsqcup</td>
<td>$\bigsqcup$</td>
</tr>
<tr>
<td>\in</td>
<td>$\in$</td>
<td></td>
<td>\ni or \owns</td>
<td>$\owns$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
<th></th>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\because</td>
<td>$\because$</td>
<td></td>
<td>\therefore</td>
<td>$\therefore$</td>
</tr>
<tr>
<td>\forall</td>
<td>$\forall$</td>
<td></td>
<td>\exists</td>
<td>$\exists$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="微分"><a href="#微分" class="headerlink" title="微分"></a>微分</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
<th></th>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>y{\prime}x</td>
<td>$y{\prime}x$</td>
<td></td>
<td>\int</td>
<td>$\int$</td>
</tr>
<tr>
<td>\iint</td>
<td>$\iint$</td>
<td></td>
<td>\iiint</td>
<td>$\iiint$</td>
</tr>
<tr>
<td>\oint</td>
<td>$oint$</td>
<td></td>
<td>\lim</td>
<td>$lim$</td>
</tr>
<tr>
<td>\infty</td>
<td>$\infty$</td>
<td></td>
<td>\nabla</td>
<td>$\nabla$</td>
</tr>
<tr>
<td>\partial</td>
<td>$\partial$</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h3 id="箭头"><a href="#箭头" class="headerlink" title="箭头"></a>箭头</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
<th></th>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\uparrow</td>
<td>$\uparrow$</td>
<td></td>
<td>\downarrow</td>
<td>$\downarrow$</td>
</tr>
<tr>
<td>\Uparrow</td>
<td>$\Uparrow$</td>
<td></td>
<td>\Downarrow</td>
<td>$\Downarrow$</td>
</tr>
<tr>
<td>\leftarrow</td>
<td>$\leftarrow$</td>
<td></td>
<td>\rightarrow</td>
<td>$\rightarrow$</td>
</tr>
<tr>
<td>\Leftarrow</td>
<td>$\Leftarrow$</td>
<td></td>
<td>\Rightarrow</td>
<td>$\Rightarrow$</td>
</tr>
<tr>
<td>\longleftarrow</td>
<td>$\longleftarrow$</td>
<td></td>
<td>\longrightarrow</td>
<td>$\longrightarrow$</td>
</tr>
<tr>
<td>\Longrightarrow</td>
<td>$\Longrightarrow$</td>
<td></td>
<td>\Longrightarrow</td>
<td>$\Longrightarrow$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="求和、连乘和积分号"><a href="#求和、连乘和积分号" class="headerlink" title="求和、连乘和积分号"></a>求和、连乘和积分号</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
<th>使用</th>
<th>例子</th>
</tr>
</thead>
<tbody>
<tr>
<td>\sum</td>
<td>$\sum$</td>
<td>\sum_{i=1}^{N}</td>
<td>$\sum_{i=1}^{N}$</td>
</tr>
<tr>
<td>\prod</td>
<td>$\prod$</td>
<td>\prod_{i=1}^{N}</td>
<td>$\prod_{i=1}^{N}$</td>
</tr>
<tr>
<td>\coprod</td>
<td>$\coprod$</td>
<td>\coprod_{i=1}^{N}</td>
<td>$\coprod_{i=1}^{N}$</td>
</tr>
<tr>
<td>\int</td>
<td>$\int$</td>
<td>\int_{a}^{b}</td>
<td>$\int_{a}^{b}$</td>
</tr>
<tr>
<td>\iint</td>
<td>$\iint$</td>
<td>\iint_{a}^{b}</td>
<td>$\iint_{a}^{b}$</td>
</tr>
<tr>
<td>\bigcup</td>
<td>$\bigcup$</td>
<td>\bigcup_{i=1}^{N}</td>
<td>$\bigcup_{i=1}^{N}$</td>
</tr>
<tr>
<td>\bigcap</td>
<td>$\bigcap$</td>
<td>\bigcap_{i=1}^{N}</td>
<td>$\bigcap_{i=1}^{N}$</td>
</tr>
<tr>
<td>\lim_{n\rightarrow+\infty}</td>
<td>$lim_{n\rightarrow+\infty}$</td>
<td>\lim_{n\rightarrow+\infty}\frac{1}{n(n+1)}</td>
<td>$\lim_{n\rightarrow+\infty}\frac{1}{n(n+1)}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="数字模式重音符"><a href="#数字模式重音符" class="headerlink" title="数字模式重音符"></a>数字模式重音符</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
<th></th>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\hat{a}</td>
<td>$\hat{a}$</td>
<td></td>
<td>\dot{a}</td>
<td>$\dot{a}$</td>
</tr>
<tr>
<td>\grave{a}</td>
<td>$\grave{a}$</td>
<td></td>
<td>\acute{a}</td>
<td>$\acute{a}$</td>
</tr>
<tr>
<td>\bar{a}</td>
<td>$\bar{a}$</td>
<td></td>
<td>\tilde{a}</td>
<td>$\tilde{a}$</td>
</tr>
<tr>
<td>\check{a}</td>
<td>$\check{a}$</td>
<td></td>
<td>\ddot{a}</td>
<td>$\ddot{a}$</td>
</tr>
<tr>
<td>\widehat{A}</td>
<td>$\widehat{A}$</td>
<td></td>
<td>\widetilde{A}</td>
<td>$\widetilde{A}$</td>
</tr>
<tr>
<td>\vec{a}</td>
<td>$\vec{a}$</td>
<td></td>
<td>\breve{a}</td>
<td>$\breve{a}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="连线符号"><a href="#连线符号" class="headerlink" title="连线符号"></a>连线符号</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\overline{a+b+c+d}</td>
<td>$\overline{a+b+c+d}$</td>
</tr>
<tr>
<td>\underline{a+b+c+d}</td>
<td>$\underline{a+b+c+d}$</td>
</tr>
<tr>
<td>\overbrace{a+\underbrace{b+c}_{1.0}+d}^{2.0}</td>
<td>$\overbrace{a+\underbrace{b+c}_{1.0}+d}^{2.0}$</td>
</tr>
</tbody>
</table>
</div>
<h3 id="矩阵"><a href="#矩阵" class="headerlink" title="矩阵"></a>矩阵</h3><p>命令</p>
<p>\left|\begin{array}{cccc}<br>     1 &amp; 6 &amp; 9 \\\<br>     7 &amp; 9 &amp; 0 \\\<br>     9 &amp; 5 &amp; 0<br>\end{array}\right|</p>
<p>显示：</p>
<script type="math/tex; mode=display">
\left|\begin{array}{cccc}
     1 & 6 & 9 \\ 
     7 & 9 & 0 \\
     9 & 5 & 0
\end{array}\right|</script><h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><p><a href="https://mathpix.com/" target="_blank" rel="noopener">https://mathpix.com/</a></p>
<p><a href="https://houmin.cc/posts/fedfc052/" target="_blank" rel="noopener">https://houmin.cc/posts/fedfc052/</a></p>
]]></content>
      <categories>
        <category>soft skill</category>
      </categories>
      <tags>
        <tag>速查</tag>
        <tag>latex</tag>
      </tags>
  </entry>
  <entry>
    <title>图论</title>
    <url>/2018/03/21/%E5%9B%BE%E8%AE%BA/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="无向图"><a href="#无向图" class="headerlink" title="无向图"></a>无向图</h3><h4 id="定义无向图数据结构"><a href="#定义无向图数据结构" class="headerlink" title="定义无向图数据结构"></a>定义无向图数据结构</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Graph</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        self.n = n</span><br><span class="line">        self.e = <span class="number">0</span></span><br><span class="line">        self.adj = [[] <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_edge</span><span class="params">(self, v, w)</span>:</span></span><br><span class="line">        self.adj[v].append(w)</span><br><span class="line">        self.adj[w].append(v)</span><br><span class="line">        self.e += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="无向图判环"><a href="#无向图判环" class="headerlink" title="无向图判环"></a>无向图判环</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cycle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, G)</span>:</span></span><br><span class="line">        self.vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.has_cycle = <span class="literal">False</span></span><br><span class="line">        self.G = G</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> range(G.n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[s]:</span><br><span class="line">                self.dfs(s, s)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(self, v, parent)</span>:</span></span><br><span class="line">        self.vis[v] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> self.G.adj[v]:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[w]:</span><br><span class="line">                self.dfs(w, v)</span><br><span class="line">            <span class="comment"># 相邻节点已被访问过，同时还不是parent节点，则存在环</span></span><br><span class="line">            <span class="keyword">elif</span> w != parent:</span><br><span class="line">                self.has_cycle = <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h4 id="无向图是否为二分图"><a href="#无向图是否为二分图" class="headerlink" title="无向图是否为二分图"></a>无向图是否为二分图</h4><p>二分图又叫二部图，是图论中的一种特殊模型。设G=(V,E)是一个无向图，如果顶点V可分割为两个互不相交的子集<code>(A,B)</code>，并且图中的每条边<code>（i，j）</code>所关联的两个顶点i和j分别属于这两个不同的顶点集<code>(i in A,j in B)</code>，则称图G为一个二分图。</p>
<p><img src="/2018/03/21/%E5%9B%BE%E8%AE%BA/二分图.png" alt="avatar"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TwoColor</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, G)</span>:</span></span><br><span class="line">        self.vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.color = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.G = G</span><br><span class="line">        self.is_two_colorable = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> range(G.n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[s]:</span><br><span class="line">                self.dfs(s)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(self, v)</span>:</span></span><br><span class="line">        self.vis[v] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> self.G.adj[v]:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[w]:</span><br><span class="line">                self.color[w] = <span class="keyword">not</span> self.color[v]</span><br><span class="line">                self.dfs(w)</span><br><span class="line">            <span class="keyword">elif</span> self.color[w] == self.color[v]:</span><br><span class="line">                self.is_two_colorable = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h3 id="最小生成树"><a href="#最小生成树" class="headerlink" title="最小生成树"></a>最小生成树</h3><h4 id="prime-算法"><a href="#prime-算法" class="headerlink" title="prime 算法"></a>prime 算法</h4><p><img src="/2018/03/21/%E5%9B%BE%E8%AE%BA/prime.gif" alt="avatar"></p>
<p>每次向最小生成树中加入权重最小的横切边，横切边是连接树与非树顶点的边。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prim</span><span class="params">(adj_matrix)</span>:</span></span><br><span class="line">    <span class="string">"""给定邻接矩阵，返回MST权值，返回-1表示图不连通"""</span></span><br><span class="line">    n = len(adj_matrix)  <span class="comment"># 顶点0~n-1</span></span><br><span class="line">    vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">    low_cut = [float(<span class="string">'inf'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]  <span class="comment"># 横切边的权重</span></span><br><span class="line"></span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line">    vis[<span class="number">0</span>] = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">        low_cut[i] = adj_matrix[<span class="number">0</span>][i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">        min_cut = float(<span class="string">'inf'</span>)</span><br><span class="line">        p = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> vis[j] <span class="keyword">and</span> min_cut &gt; low_cut[j]:</span><br><span class="line">                min_cut = low_cut[j]</span><br><span class="line">                p = j</span><br><span class="line">        <span class="keyword">if</span> min_cut == float(<span class="string">'inf'</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>  <span class="comment"># 原图不连通</span></span><br><span class="line">        ans += min_cut</span><br><span class="line">        vis[p] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="comment"># 横切边更新为更小的权重</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> vis[j] <span class="keyword">and</span> low_cut[j] &gt; adj_matrix[p][j]:</span><br><span class="line">                low_cut[j] = adj_matrix[p][j]</span><br><span class="line">    <span class="keyword">return</span> ans</span><br></pre></td></tr></table></figure>
<h4 id="Kuskal-算法"><a href="#Kuskal-算法" class="headerlink" title="Kuskal 算法"></a>Kuskal 算法</h4><p><img src="/2018/03/21/%E5%9B%BE%E8%AE%BA/Kuskal.png" alt="avatar"></p>
<p>将图中所有边按照从小到大的顺序加入最小生成树，加入的边不会与已加入的边构成换。(利用并查集UF判断连通性)，直到树中含有n-1条边为止。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kruskal</span><span class="params">(edges, n)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    求最小生成树权值</span></span><br><span class="line"><span class="string">    :param edges: [(u, v, w), ...]，三元组含义(顶点u，顶点v，边权重w)</span></span><br><span class="line"><span class="string">    :param n: 顶点数，顶点范围0~n-1</span></span><br><span class="line"><span class="string">    :return: 最小生成树权值（图不连通，返回-1）</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    uf = UnionFind(n)  <span class="comment"># 并查集</span></span><br><span class="line">    edges.sort(key=<span class="keyword">lambda</span> item: item[<span class="number">2</span>])</span><br><span class="line">    edge_cnt = <span class="number">0</span></span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(edges)):</span><br><span class="line">        u, v, w = edges[i]</span><br><span class="line">        root_u, root_v = uf.find(u), uf.find(v)</span><br><span class="line">        <span class="keyword">if</span> root_u != root_v:</span><br><span class="line">            ans += w</span><br><span class="line">            uf.union(u, v)</span><br><span class="line">            edge_cnt += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> edge_cnt == n<span class="number">-1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> edge_cnt &lt; n<span class="number">-1</span>:  <span class="comment"># 不连通</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnionFind</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""并查集类"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        <span class="string">"""长度为n的并查集"""</span></span><br><span class="line">        self.uf = [<span class="number">-1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n + <span class="number">1</span>)]    <span class="comment"># 列表0位置空出</span></span><br><span class="line">        self.sets_count = n                     <span class="comment"># 判断并查集里共有几个集合, 初始化默认互相独立</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># def find(self, p):</span></span><br><span class="line">    <span class="comment">#     """查找p的根结点(祖先)"""</span></span><br><span class="line">    <span class="comment">#     r = p                                   # 初始p</span></span><br><span class="line">    <span class="comment">#     while self.uf[p] &gt; 0:</span></span><br><span class="line">    <span class="comment">#         p = self.uf[p]</span></span><br><span class="line">    <span class="comment">#     while r != p:                           # 路径压缩, 把搜索下来的结点祖先全指向根结点</span></span><br><span class="line">    <span class="comment">#         self.uf[r], r = p, self.uf[r]</span></span><br><span class="line">    <span class="comment">#     return p</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># def find(self, p):</span></span><br><span class="line">    <span class="comment">#     while self.uf[p] &gt;= 0:</span></span><br><span class="line">    <span class="comment">#         p = self.uf[p]</span></span><br><span class="line">    <span class="comment">#     return p</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(self, p)</span>:</span></span><br><span class="line">        <span class="string">"""尾递归"""</span></span><br><span class="line">        <span class="keyword">if</span> self.uf[p] &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line">        self.uf[p] = self.find(self.uf[p])</span><br><span class="line">        <span class="keyword">return</span> self.uf[p]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">union</span><span class="params">(self, p, q)</span>:</span></span><br><span class="line">        <span class="string">"""连通p,q 让q指向p"""</span></span><br><span class="line">        proot = self.find(p)</span><br><span class="line">        qroot = self.find(q)</span><br><span class="line">        <span class="keyword">if</span> proot == qroot:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">elif</span> self.uf[proot] &gt; self.uf[qroot]:   <span class="comment"># 负数比较, 左边规模更小</span></span><br><span class="line">            self.uf[qroot] += self.uf[proot]</span><br><span class="line">            self.uf[proot] = qroot</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.uf[proot] += self.uf[qroot]  <span class="comment"># 规模相加</span></span><br><span class="line">            self.uf[qroot] = proot</span><br><span class="line">        self.sets_count -= <span class="number">1</span>                    <span class="comment"># 连通后集合总数减一</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_connected</span><span class="params">(self, p, q)</span>:</span></span><br><span class="line">        <span class="string">"""判断pq是否已经连通"""</span></span><br><span class="line">        <span class="keyword">return</span> self.find(p) == self.find(q)     <span class="comment"># 即判断两个结点是否是属于同一个祖先</span></span><br></pre></td></tr></table></figure>
<h3 id="有向图"><a href="#有向图" class="headerlink" title="有向图"></a>有向图</h3><h4 id="定义无向图的数据结构"><a href="#定义无向图的数据结构" class="headerlink" title="定义无向图的数据结构"></a>定义无向图的数据结构</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DiGraph</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        self.n = n</span><br><span class="line">        self.e = <span class="number">0</span></span><br><span class="line">        self.adj = [[] <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_edge</span><span class="params">(self, v, w)</span>:</span></span><br><span class="line">        self.adj[v].append(w)</span><br><span class="line">        self.e += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="有向图判环"><a href="#有向图判环" class="headerlink" title="有向图判环"></a>有向图判环</h4><p>对有向图使用dfs搜索，系统调用栈表示了当前遍历了的有向路径</p>
<p>若递归过程访问到出现在栈中的节点，则图中存在了环。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DirectedCycle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, G)</span>:</span></span><br><span class="line">        self.on_stack = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(G.n)]</span><br><span class="line">        self.has_cycle = <span class="literal">False</span></span><br><span class="line">        self.G = G</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> range(G.n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.vis[s]:</span><br><span class="line">                self.dfs(s)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(self, v)</span>:</span></span><br><span class="line">        self.on_stack[v] = <span class="literal">True</span></span><br><span class="line">        self.vis[v] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> self.G.adj[v]:</span><br><span class="line">            <span class="keyword">if</span> self.has_cycle:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="keyword">not</span> self.vis[w]:</span><br><span class="line">                self.dfs(w)</span><br><span class="line">            <span class="keyword">elif</span> self.on_stack[w]:</span><br><span class="line">                self.has_cycle = <span class="literal">True</span></span><br><span class="line">        self.on_stack[v] = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>一个有向五环图的拓扑排序即为所有顶点dfs的逆后序排列</p>
<p>强连通性：有向图任意两点互相可达，则为强连通图。</p>
<p><strong>Kosaraju 算法</strong>：</p>
<ol>
<li>有向图G翻转得到$G^R$</li>
<li>dfs得到$G^R$中顶点的逆后序排列</li>
<li>按照这个你后序排列在G中执行标准dfs，每次递归调用所标记的顶点在同一强连通分量重</li>
</ol>
<p><strong>最短路径比较、总结</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>算法</th>
<th>条件</th>
<th>平均</th>
<th>最坏</th>
<th>空间复杂度</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Dijkstra</td>
<td>边权为正</td>
<td>$ElogV$</td>
<td>$ElogV$</td>
<td>$V$</td>
<td></td>
</tr>
<tr>
<td>拓扑排序</td>
<td>无环</td>
<td>$E$</td>
<td>$E+V$</td>
<td>$V$</td>
<td>无环图最优算法</td>
</tr>
<tr>
<td>Bellman-Ford（基于队列）</td>
<td>无负权重</td>
<td>$E+V$</td>
<td>$VE$</td>
<td>$V$</td>
</tr>
</tbody>
</table>
</div>
<p>Dijkstra 算法：每次添加离起点最近的非树节点</p>
<p>prim：每次添加离树最近的非树节点</p>
<h4 id="单源最短路径，邻接矩阵形式"><a href="#单源最短路径，邻接矩阵形式" class="headerlink" title="单源最短路径，邻接矩阵形式"></a>单源最短路径，邻接矩阵形式</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dijkstra</span><span class="params">(adj_matrix, s)</span>:</span></span><br><span class="line">    <span class="string">"""给定邻接矩阵和起点s，返回s到所有点的最短路径"""</span></span><br><span class="line">    n = len(adj_matrix)  <span class="comment"># 顶点0~n-1</span></span><br><span class="line">    vis = [<span class="literal">False</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">    edge_to = [<span class="number">-1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]  <span class="comment"># 路径父节点</span></span><br><span class="line">    dist = [float(<span class="string">'inf'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]  <span class="comment"># 最短路径</span></span><br><span class="line"></span><br><span class="line">    dist[s] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        min_dist = float(<span class="string">'inf'</span>)</span><br><span class="line">        p = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> vis[j] <span class="keyword">and</span> dist[j] &lt; min_dist:</span><br><span class="line">                min_dist = dist[j]</span><br><span class="line">                p = j</span><br><span class="line">        <span class="keyword">if</span> p == <span class="number">-1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        vis[p] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> vis[j] <span class="keyword">and</span> dist[p] + adj_matrix[p][j] &lt; dist[j]:</span><br><span class="line">                dist[j] = dist[p] + adj_matrix[p][j]</span><br><span class="line">                edge_to[j] = p</span><br><span class="line">    <span class="keyword">return</span> dist, edge_to</span><br></pre></td></tr></table></figure>
<p>单元最短路径，邻接表形式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dijkstra</span><span class="params">(adj, s)</span>:</span></span><br><span class="line">    n = len(adj)</span><br><span class="line">    dist = [float(<span class="string">'inf'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line"></span><br><span class="line">    dist[s] = <span class="number">0</span></span><br><span class="line">    pq = [(<span class="number">0</span>, s)]</span><br><span class="line">    <span class="keyword">while</span> pq:</span><br><span class="line">        <span class="comment"># u, v是顶点，d是距离，w是边权重</span></span><br><span class="line">        d, u = heappop(pq)</span><br><span class="line">        <span class="keyword">if</span> d &gt; dist[u]:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> v, w <span class="keyword">in</span> adj[u]:</span><br><span class="line">            <span class="keyword">if</span> d + w &lt; dist[v]:</span><br><span class="line">                dist[v] = d + w</span><br><span class="line">                heappush(pq, (dist[v], v))</span><br><span class="line">    <span class="keyword">return</span> dist</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>数据结构与算法</category>
      </categories>
      <tags>
        <tag>图论</tag>
      </tags>
  </entry>
  <entry>
    <title>字符串匹配问题</title>
    <url>/2018/03/14/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="字符串匹配问题"><a href="#字符串匹配问题" class="headerlink" title="字符串匹配问题"></a>字符串匹配问题</h2><p>给定两个字符串<code>S,P</code>,其中<code>S</code>串长度为<code>n</code>，<code>P</code>串长度为<code>m</code>, <code>(m&lt;=n)</code>，判断字符串<code>P</code>是否是<code>S</code>的子串</p>
<h4 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h4><p>容易计算复杂度：<code>O(m*n)</code></p>
<h3 id="Brute-Force-简单匹配"><a href="#Brute-Force-简单匹配" class="headerlink" title="Brute-Force(简单匹配)"></a>Brute-Force(简单匹配)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">naive_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    m, n = len(s), len(p)</span><br><span class="line">    <span class="keyword">if</span> m-n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m-n+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> s[i:i+n] == p:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="Rabin-Karp算法"><a href="#Rabin-Karp算法" class="headerlink" title="Rabin-Karp算法"></a>Rabin-Karp算法</h3><h4 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h4><p>基本思想和暴力破解算法是一样的。也需要一个大小为<strong>m</strong>的窗口，但是不一样的是，不是直接比较两个长度为<strong>m</strong>的字符串，而是比较他们的哈希值。</p>
<h4 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h4><p>一共会有(<strong>n-m+1</strong>)个窗口滑动，这一步的复杂度是<strong>O(n)</strong>。</p>
<p>计算哈希值:</p>
<p>假设现在窗口的起点在<strong>j</strong>这个位置，此时窗口内的字符串哈希值为，</p>
<script type="math/tex; mode=display">
H(S, j)=\sum_{i=0}^{m-1} \alpha^{m-(i+1)} \times \operatorname{char}\left(s_{i}\right)</script><p>那么，当计算下一个窗口的哈希值时，也就是当窗口的起点为<strong>j+1</strong>时，哈希函数值可由如下方法计算：</p>
<script type="math/tex; mode=display">
H(S, j+1)=\alpha\left(H(S, j)-\alpha^{m-1} \operatorname{char}\left(s_{j}\right)\right)+\operatorname{char}\left(s_{j+m}\right)</script><p>这样看来，在计算出第一个窗口的函数值之后，后面的每一个窗口哈希值都可以根据上述公式计算，只需要做一次减法，一次乘法，一次加法。之后的每一次哈希值计算都是<strong>O(1)</strong>的复杂度。所以计算第一个窗口的复杂度，<strong>O(m)</strong>，此后计算每一个窗口的复杂度<strong>O(1)</strong>，总的时间复杂度：<code>O(n+m)</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rabin_karp_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    n = len(s)</span><br><span class="line">    m = len(p)</span><br><span class="line">    h1 = hash(p)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, n-m+<span class="number">1</span>):</span><br><span class="line">        h2 = hash(s[i:i+m])</span><br><span class="line">        <span class="keyword">if</span> h1 != h2:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> s[i:i+m] == p:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<h3 id="KMP算法"><a href="#KMP算法" class="headerlink" title="KMP算法"></a>KMP算法</h3><p>有点复杂，有时间再写上。</p>
<h4 id="思想-1"><a href="#思想-1" class="headerlink" title="思想"></a>思想</h4><h4 id="复杂度分析-1"><a href="#复杂度分析-1" class="headerlink" title="复杂度分析"></a>复杂度分析</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># KMP算法：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kmp_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    m, n = len(s), len(p)</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span> <span class="keyword">or</span> m - n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    table = partial_table(p)</span><br><span class="line">    i, cur = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> i &lt; m-n+<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> p[cur] == s[i+cur]:</span><br><span class="line">            cur += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> cur == <span class="number">0</span>:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                i += cur - table[cur<span class="number">-1</span>]  <span class="comment"># 移动位数=已匹配的字符数-对应的部分匹配值</span></span><br><span class="line">                cur = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> cur == n:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">partial_table</span><span class="params">(p)</span>:</span></span><br><span class="line">    m = len(p)</span><br><span class="line">    table = [<span class="number">0</span>] * m</span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> q <span class="keyword">in</span> range(<span class="number">1</span>, m):</span><br><span class="line">        <span class="keyword">if</span> p[k] == p[q]:</span><br><span class="line">            k = k + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            k = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> p[k] == p[q]:</span><br><span class="line">                k = k + <span class="number">1</span></span><br><span class="line">        table[q] = k</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> table</span><br></pre></td></tr></table></figure>
<h3 id="Horspool算法"><a href="#Horspool算法" class="headerlink" title="Horspool算法"></a>Horspool算法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shift_table</span><span class="params">(p)</span>:</span></span><br><span class="line">    <span class="comment"># 生成 Horspool 算法的移动表</span></span><br><span class="line">    <span class="comment"># 当前检测字符为c，模式长度为m</span></span><br><span class="line">    <span class="comment"># 如果当前c不包含在模式的前m-1个字符中，移动模式的长度m</span></span><br><span class="line">    <span class="comment"># 其他情况下移动最右边的的c到模式最后一个字符的距离</span></span><br><span class="line">    <span class="comment"># from collections import defaultdict</span></span><br><span class="line">    <span class="comment"># table = defaultdict(lambda: len(p))</span></span><br><span class="line">    table = dict()</span><br><span class="line">    <span class="comment"># print table</span></span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> range(<span class="number">0</span>, len(p) - <span class="number">1</span>):</span><br><span class="line">        table[p[index]] = len(p) - <span class="number">1</span> - index</span><br><span class="line">    <span class="comment"># print table</span></span><br><span class="line">    <span class="keyword">return</span> table</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">horspool_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    m, n = len(s), len(p)</span><br><span class="line">    table = shift_table(p)</span><br><span class="line">    index = len(p) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> index &lt;= m - <span class="number">1</span>:</span><br><span class="line">        <span class="comment"># print("start matching at", index)</span></span><br><span class="line">        match_count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> match_count &lt; n <span class="keyword">and</span> p[n - <span class="number">1</span> - match_count] == s[index - match_count]:</span><br><span class="line">            match_count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> match_count == len(p):</span><br><span class="line">            <span class="keyword">return</span> index - match_count + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># print s[index], table.get(s[index])</span></span><br><span class="line">            <span class="keyword">if</span> table.get(s[index]) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                table[s[index]] = n</span><br><span class="line">            index += table[s[index]]</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<h3 id="Sunday-算法"><a href="#Sunday-算法" class="headerlink" title="Sunday 算法"></a>Sunday 算法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sunday_match</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    char_pos = dict()</span><br><span class="line">    <span class="keyword">for</span> i, ch <span class="keyword">in</span> enumerate(p):</span><br><span class="line">        char_pos[ch] = i</span><br><span class="line">    <span class="comment"># print "char_pos:", char_pos</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    m, n = len(s), len(p)</span><br><span class="line">    <span class="keyword">while</span> i &lt;= m - n:</span><br><span class="line">        found = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j, ch <span class="keyword">in</span> enumerate(p):</span><br><span class="line">            <span class="keyword">if</span> s[i + j] != ch:</span><br><span class="line">                found = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">if</span> (i + n) &lt; m:</span><br><span class="line">                    <span class="keyword">if</span> s[i + n] <span class="keyword">not</span> <span class="keyword">in</span> char_pos:</span><br><span class="line">                        i += (n + <span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        i += (n - char_pos[s[i + n]])</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<h3 id="Boyer-Moore算法"><a href="#Boyer-Moore算法" class="headerlink" title="Boyer_Moore算法"></a>Boyer_Moore算法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">boyer_moore_search</span><span class="params">(string, des)</span>:</span></span><br><span class="line">    l = len(des) - <span class="number">1</span></span><br><span class="line">    strlen = len(string) - <span class="number">1</span></span><br><span class="line">    start, end = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> strlen &gt;= <span class="number">0</span>:</span><br><span class="line">        end = start + len(des)</span><br><span class="line">        <span class="comment"># print string[start:end]</span></span><br><span class="line">        cr = compare(string[start:end], des)</span><br><span class="line">        <span class="keyword">if</span> cr[<span class="number">0</span>] == <span class="number">-2</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'not found'</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> cr[<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># return end - l</span></span><br><span class="line">            <span class="keyword">return</span> start</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pos = is_character_in(des, cr[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> cr[<span class="number">0</span>] == (len(des) - <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> pos != <span class="number">-1</span>:</span><br><span class="line">                    start += len(des) - <span class="number">1</span> - pos</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    start += len(des)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> pos == <span class="number">-1</span>:</span><br><span class="line">                    <span class="comment">#  have good  string</span></span><br><span class="line">                    goodPos = is_character_in(des, des[l])</span><br><span class="line">                    <span class="keyword">if</span> goodPos == l:</span><br><span class="line">                        start += l + <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        start += l - goodPos</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_character_in</span><span class="params">(s, c)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> pos <span class="keyword">in</span> range(len(s)):</span><br><span class="line">        <span class="keyword">if</span> s[pos] == c:</span><br><span class="line">            <span class="keyword">return</span> pos</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare</span><span class="params">(str1, str2)</span>:</span></span><br><span class="line">    l1 = len(str1) - <span class="number">1</span></span><br><span class="line">    l2 = len(str2) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> l1 != l2:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> l1 &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> str1[l1] != str2[l1]:</span><br><span class="line">            <span class="keyword">return</span> l1, str1[l1]</span><br><span class="line">        l1 -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<h3 id="BMHBNFS算法（快速匹配算法）"><a href="#BMHBNFS算法（快速匹配算法）" class="headerlink" title="BMHBNFS算法（快速匹配算法）"></a>BMHBNFS算法（快速匹配算法）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_skip</span><span class="params">(p)</span>:</span></span><br><span class="line">    m = len(p)</span><br><span class="line">    a = p[m<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m<span class="number">-2</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        <span class="keyword">if</span> p[i] == a:</span><br><span class="line">            <span class="keyword">return</span> m<span class="number">-2</span>-i</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bmhbnfs_find</span><span class="params">(s, p)</span>:</span></span><br><span class="line">    <span class="comment"># find first occurrence of p in s</span></span><br><span class="line">    m = len(s)</span><br><span class="line">    n = len(p)</span><br><span class="line">    <span class="comment"># skip是把离p[m-1]最近且字符相同的字符移到m-1位需要跳过的步数-1</span></span><br><span class="line">    <span class="comment"># skip = delta1(p)[p[m - 1]]</span></span><br><span class="line">    skip = compute_skip(p)</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt;= m - n:</span><br><span class="line">        <span class="keyword">if</span> s[i + n - <span class="number">1</span>] == p[n - <span class="number">1</span>]:  <span class="comment"># (boyer-moore)</span></span><br><span class="line">            <span class="comment"># potential match</span></span><br><span class="line">            <span class="keyword">if</span> s[i:i + n - <span class="number">1</span>] == p[:n - <span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">            <span class="keyword">if</span> s[i + n] <span class="keyword">not</span> <span class="keyword">in</span> p:</span><br><span class="line">                i = i + n + <span class="number">1</span>  <span class="comment"># (sunday)</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                i = i + skip  <span class="comment"># (horspool)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># skip</span></span><br><span class="line">            <span class="keyword">if</span> s[i + n] <span class="keyword">not</span> <span class="keyword">in</span> p:</span><br><span class="line">                i = i + n + <span class="number">1</span>  <span class="comment"># (sunday)</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                i = i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>  <span class="comment"># not found</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>数据结构与算法</category>
      </categories>
      <tags>
        <tag>字符串匹配</tag>
      </tags>
  </entry>
  <entry>
    <title>动态规划</title>
    <url>/2018/03/09/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="/2018/03/09/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/dynamic_programming.png" alt="avatar"></p>
<a id="more"></a>
<h2 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h2><h3 id="思考状态"><a href="#思考状态" class="headerlink" title="思考状态"></a>思考状态</h3><p>状态先尝试“题目问什么，就把什么设置为状态”。然后考虑“状态如何转移”，如果“状态转移方程”不容易得到，尝试修改定义，目的仍然是为了方便得到“状态转移方程”。</p>
<h3 id="思考状态转移方程（核心、难点）"><a href="#思考状态转移方程（核心、难点）" class="headerlink" title="思考状态转移方程（核心、难点）"></a>思考状态转移方程（核心、难点）</h3><p>状态转移方程是非常重要的，是动态规划的核心，也是难点，起到承上启下的作用。</p>
<blockquote>
<p>技巧是分类讨论。对状态空间进行分类，思考最优子结构到底是什么。即大问题的最优解如何由小问题的最优解得到。</p>
</blockquote>
<p>归纳“状态转移方程”是一个很灵活的事情，得具体问题具体分析，除了掌握经典的动态规划问题以外，还需要多做题。如果是针对面试，请自行把握难度，我个人觉得掌握常见问题的动态规划解法，明白动态规划的本质就是打表格，从一个小规模问题出发，逐步得到大问题的解，并记录过程。动态规划依然是“空间换时间”思想的体现。</p>
<h3 id="思考初始化"><a href="#思考初始化" class="headerlink" title="思考初始化"></a>思考初始化</h3><p>初始化是非常重要的，一步错，步步错，初始化状态一定要设置对，才可能得到正确的结果。</p>
<p>角度 1：直接从状态的语义出发；</p>
<p>角度 2：如果状态的语义不好思考，就考虑“状态转移方程”的边界需要什么样初始化的条件；</p>
<p>角度 3：从“状态转移方程”方程的下标看是否需要多设置一行、一列表示“哨兵”，这样可以避免一些边界的讨论，使得代码变得比较短。</p>
<h3 id="思考输出"><a href="#思考输出" class="headerlink" title="思考输出"></a>思考输出</h3><p>有些时候是最后一个状态，有些时候可能会综合所有计算过的状态。</p>
<h3 id="思考状态压缩"><a href="#思考状态压缩" class="headerlink" title="思考状态压缩"></a>思考状态压缩</h3><p>  “状态压缩”会使得代码难于理解，初学的时候可以不一步到位。先把代码写正确，然后再思考状态压缩。</p>
<p>  状态压缩在有一种情况下是很有必要的，那就是状态空间非常庞大的时候（处理海量数据），此时空间不够用，就必须状态压缩。</p>
<hr>
<h2 id="题目（LeetCode）"><a href="#题目（LeetCode）" class="headerlink" title="题目（LeetCode）"></a>题目（LeetCode）</h2><h3 id="5-最长回文子串"><a href="#5-最长回文子串" class="headerlink" title="5. 最长回文子串"></a>5. <a href="https://leetcode-cn.com/problems/longest-palindromic-substring/" target="_blank" rel="noopener">最长回文子串</a></h3><p>描述：给定一个字符串 s，找到 s 中最长的回文子串。你可以假设 s 的最大长度为 1000。</p>
<p>示例 1：</p>
<p>输入: “babad”</p>
<p>输出: “bab”</p>
<p>注意: “aba” 也是一个有效答案。</p>
<p>示例 2：</p>
<p>输入: “cbbd”</p>
<p>输出: “bb”</p>
<p>“动态规划”最关键的步骤是想清楚“状态如何转移”，事实上，“回文”是天然具有“状态转移”性质的：</p>
<blockquote>
<p>一个回文去掉两头以后，剩下的部分依然是回文（这里暂不讨论边界）。</p>
</blockquote>
<p>依然从回文串的定义展开讨论：</p>
<ol>
<li><p>如果一个字符串的头尾两个字符都不相等，那么这个字符串一定不是回文串；</p>
</li>
<li><p>如果一个字符串的头尾两个字符相等，才有必要继续判断下去。</p>
</li>
<li><p>如果里面的子串是回文，整体就是回文串；</p>
</li>
<li><p>如果里面的子串不是回文串，整体就不是回文串。</p>
</li>
</ol>
<p>即在头尾字符相等的情况下，里面子串的回文性质据定了整个子串的回文性质，这就是状态转移。因此可以把“状态”定义为原字符串的一个子串是否为回文子串。</p>
<h4 id="第-1-步：定义状态"><a href="#第-1-步：定义状态" class="headerlink" title="第 1 步：定义状态"></a>第 1 步：定义状态</h4><p><code>dp[i][j]</code> 表示子串 <code>s[i,j]</code> 是否为回文子串。</p>
<h4 id="第-2-步：思考状态转移方程"><a href="#第-2-步：思考状态转移方程" class="headerlink" title="第 2 步：思考状态转移方程"></a>第 2 步：思考状态转移方程</h4><p>这一步在做分类讨论（根据头尾字符是否相等），根据上面的分析得到：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">dp[<span class="string">i</span>][<span class="symbol">j</span>] = (s[<span class="string">i</span>] == s[<span class="string">j</span>]) and dp[<span class="string">i + 1</span>][<span class="symbol">j - 1</span>]</span><br></pre></td></tr></table></figure>
<p>分析：</p>
<ol>
<li><p><code>i</code> 和 <code>j</code> 的关系是 <code>i &lt;= j</code>，因此，只需要填这张表的上半部分；</p>
</li>
<li><p>看到 <code>dp[i + 1][j - 1]</code> 就得考虑边界情况。边界条件是：表达式 <code>[i + 1, j - 1]</code>不构成区间，即长度严格小于 2，即<code>j - 1 - (i + 1) + 1 &lt; 2</code> ，整理得 <code>j - i &lt; 3</code>。</p>
</li>
</ol>
<p>这个结论很显然：当子串 <code>s[i, j]</code> 的长度等于 2 或者等于 3 的时候，我其实只需要判断一下头尾两个字符是否相等就可以直接下结论了。</p>
<ul>
<li><p>如果子串 <code>s[i + 1, j - 1]</code> 只有 1 个字符，即去掉两头，剩下中间部分只有 1 个字符，当然是回文；</p>
</li>
<li><p>如果子串 <code>s[i + 1, j - 1]</code> 为空串，那么子串 <code>s[i, j]</code> 一定是回文子串。</p>
</li>
</ul>
<p>因此，在 <code>s[i] == s[j]</code> 成立和 <code>j - i &lt; 3</code> 的前提下，直接可以下结论，<code>dp[i][j] = true</code>，否则才执行状态转移。</p>
<h4 id="第-3-步-考虑初始化"><a href="#第-3-步-考虑初始化" class="headerlink" title="第 3 步:考虑初始化"></a>第 3 步:考虑初始化</h4><p>初始化的时候，单个字符一定是回文串，因此把对角线先初始化为 1，即 <code>dp[i][i] = 1</code>。</p>
<h4 id="第-4-步-考虑输出"><a href="#第-4-步-考虑输出" class="headerlink" title="第 4 步:考虑输出"></a>第 4 步:考虑输出</h4><p>只要一得到 <code>dp[i][j] = true</code>，就记录子串的长度和起始位置，没有必要截取，因为截取字符串也要消耗性能，记录此时的回文子串的“起始位置”和“回文长度”即可。</p>
<h4 id="第-5-步-考虑状态是否可以压缩"><a href="#第-5-步-考虑状态是否可以压缩" class="headerlink" title="第 5 步:考虑状态是否可以压缩"></a>第 5 步:考虑状态是否可以压缩</h4><p>在填表的过程中，只参考了左下方的数值。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">longestPalindrome</span><span class="params">(self,s)</span>:</span></span><br><span class="line"></span><br><span class="line">size = len(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> size &lt; <span class="number">2</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化</span></span><br><span class="line"></span><br><span class="line">dp = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(size)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(size)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(size):</span><br><span class="line"></span><br><span class="line">dp[_][_] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">start_idx = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">max_len = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,size):</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(j):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s[i] == s[j]:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> j - i &lt; <span class="number">3</span>: <span class="comment"># i,j 之间只有一个字符或者没有字符</span></span><br><span class="line"></span><br><span class="line">dp[i][j] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">dp[i][j] = dp[i+<span class="number">1</span>][j<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dp[i][j] == <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">cur_len = j - i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> cur_len &gt; max_len:</span><br><span class="line"></span><br><span class="line">max_len = cur_len</span><br><span class="line"></span><br><span class="line">start_idx = i</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> s[start_idx:start_idx+max_len]</span><br></pre></td></tr></table></figure>
<h3 id="1143-最长公共子序列"><a href="#1143-最长公共子序列" class="headerlink" title="1143. 最长公共子序列"></a>1143. <a href="https://leetcode-cn.com/problems/longest-common-subsequence/" target="_blank" rel="noopener">最长公共子序列</a></h3><p>描述：给定两个字符串 text1 和 text2，返回这两个字符串的最长公共子序列。一个字符串的 子序列是指这样一个新的字符串：它是由原字符串在不改变字符的相对顺序的情况下删除某些字符（也可以不删除任何字符）后组成的新字符串。</p>
<p>例如，”ace” 是 “abcde” 的子序列，但 “aec” 不是 “abcde” 的子序列。两个字符串的「公共子序列」是这两个字符串所共同拥有的子序列。若这两个字符串没有公共子序列，则返回 0。</p>
<p>示例 1:</p>
<p>输入：text1 = “abcde”, text2 = “ace”</p>
<p>输出：3</p>
<p>解释：最长公共子序列是 “ace”，它的长度为 3。</p>
<p>示例 2:</p>
<p>输入：text1 = “abc”, text2 = “abc”</p>
<p>输出：3</p>
<p>解释：最长公共子序列是 “abc”，它的长度为 3。</p>
<p>示例 3:</p>
<p>输入：text1 = “abc”, text2 = “def”</p>
<p>输出：0</p>
<p>解释：两个字符串没有公共子序列，返回 0。</p>
<p>提示:</p>
<p>1 &lt;= text1.length &lt;= 1000</p>
<p>1 &lt;= text2.length &lt;= 1000</p>
<p>输入的字符串只含有小写英文字符。</p>
<h4 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h4><ol>
<li><p>状态：问题要求最长公共子序列，那就让dp表存储长度。</p>
</li>
<li><p>状态转移：</p>
</li>
<li><p>当 <code>S1i==S2j</code> 时，那么就能在 <code>S1</code> 的前 <code>i-1</code> 个字符与 <code>S2</code> 的前 <code>j-1</code> 个字符最长公共子序列的基础上再加上 <code>S1i</code> 这个值，最长公共子序列长度加 <code>1</code>，即 <code>dp[i][j] = dp[i-1][j-1] + 1</code>。</p>
</li>
<li><p>当 <code>S1i != S2j</code> 时，此时最长公共子序列为 <code>S1</code> 的前 <code>i-1</code> 个字符和 <code>S2</code> 的前 <code>j</code> 个字符最长公共子序列，或者 <code>S1</code> 的前 i 个字符和 <code>S2</code> 的前 <code>j-1</code> 个字符最长公共子序列，取它们的最大者，即 <code>dp[i][j] = max{ dp[i-1][j], dp[i][j-1] }</code>。</p>
</li>
</ol>
<p>综上，状态转移方程：</p>
<p><img src="/2018/03/09/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/dp_1.png" alt="avatar"></p>
<ol>
<li>解的形式：解在dp表的右下角</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">longestCommonSubsequence</span><span class="params">(self, text1, text2)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type text1: str</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type text2: str</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:rtype: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> text1 <span class="keyword">or</span> <span class="keyword">not</span> text2:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">size_1 = len(text1)</span><br><span class="line"></span><br><span class="line">size_2 = len(text2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化表格</span></span><br><span class="line"></span><br><span class="line">dp = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(size_2+<span class="number">1</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(size_1+<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(size_1):</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(size_2):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> text1[i] == text2[j]:</span><br><span class="line"></span><br><span class="line">dp[i+<span class="number">1</span>][j+<span class="number">1</span>] = dp[i][j] + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">dp[i+<span class="number">1</span>][j+<span class="number">1</span>] = max(dp[i][j+<span class="number">1</span>],dp[i+<span class="number">1</span>][j])</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> dp[size_1][size_2]</span><br></pre></td></tr></table></figure>
<h3 id="53-最大序列和"><a href="#53-最大序列和" class="headerlink" title="53. 最大序列和"></a>53. <a href="https://leetcode-cn.com/problems/maximum-subarray/" target="_blank" rel="noopener">最大序列和</a></h3><p>给定一个整数数组 nums ，找到一个具有最大和的连续子数组（子数组最少包含一个元素），返回其最大和。</p>
<p>示例:</p>
<p>输入: [-2,1,-3,4,-1,2,1,-5,4],</p>
<p>输出: 6</p>
<p>解释: 连续子数组 [4,-1,2,1] 的和最大，为 6。</p>
<p>进阶:</p>
<p>如果你已经实现复杂度为 O(n) 的解法，尝试使用更为精妙的分治法求解。</p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>法一：暴力动态规划：超时</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maxSubArray</span><span class="params">(self, nums)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type nums: List[int]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:rtype: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">size = len(nums)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> size == <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> nums[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">dp = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(size)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(size)]</span><br><span class="line"></span><br><span class="line">start = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">end = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">max_val = float(<span class="string">'-inf'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(size):</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(j):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> j - i == <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">dp[i][j] = nums[i] + nums[j]</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">dp[i][j] = dp[i][j<span class="number">-1</span>] + nums[j]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> max_val &lt; dp[i][j]:</span><br><span class="line"></span><br><span class="line">start = i</span><br><span class="line"></span><br><span class="line">end = j</span><br><span class="line"></span><br><span class="line">max_val = dp[i][j]</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> max(max_val, max(nums))</span><br></pre></td></tr></table></figure>
<p>法二：DP法，用了些灵巧的思路</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maxSubArray</span><span class="params">(self, nums)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type nums: List[int]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:rtype: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">max_, sum_ = nums[<span class="number">0</span>],nums[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums[<span class="number">1</span>:]:</span><br><span class="line"></span><br><span class="line">sum_ = sum_ + num <span class="keyword">if</span> sum_ &gt; <span class="number">0</span> <span class="keyword">else</span> num</span><br><span class="line"></span><br><span class="line">max_ = max_ <span class="keyword">if</span> max_ &gt; sum_ <span class="keyword">else</span> sum_</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> max_</span><br></pre></td></tr></table></figure>
<h3 id="300-最长上升子序列"><a href="#300-最长上升子序列" class="headerlink" title="300. 最长上升子序列"></a>300. <a href="https://leetcode-cn.com/problems/longest-increasing-subsequence/" target="_blank" rel="noopener">最长上升子序列</a></h3><p>给定一个无序的整数数组，找到其中最长上升子序列的长度。</p>
<p>示例:</p>
<p>输入: [10,9,2,5,3,7,101,18]</p>
<p>输出: 4</p>
<p>解释: 最长的上升子序列是 [2,3,7,101]，它的长度是 4。</p>
<p>说明:可能会有多种最长上升子序列的组合，你只需要输出对应的长度即可。你算法的时间复杂度应该为 $O(n^2)$ 。</p>
<p>进阶: 你能将算法的时间复杂度降低到 <code>O(n log n)</code> 吗?</p>
<h4 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h4><p>状态：定义 dp[i]为考虑前 i个元素，以第 i 个数字结尾的最长上升子序列的长度，注意 nums[i]必须被选取。</p>
<p>状态转移：从小到大计算 dp[] 数组的值，在计算 dp[i] 之前，我们已经计算出 dp[0…i−1] 的值，则状态转移方程为：</p>
<p><img src="/2018/03/09/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/dp_2.png" alt="avatar"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lengthOfLIS</span><span class="params">(self, nums)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:type nums: List[int]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:rtype: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">dp = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line"></span><br><span class="line">dp.append(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(i):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> nums[i] &gt; nums[j]:</span><br><span class="line"></span><br><span class="line">dp[i] = max(dp[i], dp[j] + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> max(dp)</span><br></pre></td></tr></table></figure>
<h3 id="10-正则表达式匹配"><a href="#10-正则表达式匹配" class="headerlink" title="10. 正则表达式匹配"></a><a href="https://leetcode-cn.com/problems/regular-expression-matching/" target="_blank" rel="noopener">10. 正则表达式匹配</a></h3><p><strong>状态</strong>：问题要求解的是正则串是否可以匹配，则把状态设为是否可匹配。<code>dp[i][j]</code> 表示 <code>s</code> 的前 <code>i</code>个是否能被 <code>p</code> 的前 <code>j</code> 个匹配</p>
<p><strong>转移方程</strong> ： </p>
<ol>
<li><p><code>p[j] == s[i] or p[j] == &quot;.&quot; : dp[i][j] = dp[i-1][j-1]</code> </p>
</li>
<li><p><code>p[j] ==&quot; * &quot;</code>:     # 比较难想</p>
<ol>
<li><code>p[j-1] != s[i]: dp[i][j] = dp[i][j-2]</code> # <code>*</code> 前的字符和原字符串不匹配,相当于该字符匹配0次。</li>
<li><code>p[j-1] == s[i] or p[j-1] == &quot;.&quot;：</code> # 匹配<ol>
<li><code>dp[i][j] = dp[i-1][j]</code> # * 匹配多次</li>
<li><code>dp[i][j] = dp[i][j-1]</code> # * 匹配一次</li>
<li><code>dp[i][j] = dp[i][j-2]</code> # * 匹配0次</li>
</ol>
</li>
</ol>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isMatch</span><span class="params">(self, s, p)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> p:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">not</span> s</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s <span class="keyword">and</span> len(p) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        nrow = len(s) + <span class="number">1</span></span><br><span class="line">        ncol = len(p) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        dp = [[<span class="literal">False</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(ncol)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(nrow)]</span><br><span class="line"></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">True</span></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">1</span>] = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">2</span>, ncol):</span><br><span class="line">            j = c - <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> p[j] == <span class="string">'*'</span>:</span><br><span class="line">                dp[<span class="number">0</span>][c] = dp[<span class="number">0</span>][c - <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> range(<span class="number">1</span>, nrow): <span class="comment"># r 原始串</span></span><br><span class="line">            i = r - <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">1</span>, ncol): <span class="comment"># c 正则串</span></span><br><span class="line">                j = c - <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> s[i] == p[j] <span class="keyword">or</span> p[j] == <span class="string">'.'</span>:</span><br><span class="line">                    dp[r][c] = dp[r - <span class="number">1</span>][c - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">elif</span> p[j] == <span class="string">'*'</span>:</span><br><span class="line">                    <span class="keyword">if</span> p[j - <span class="number">1</span>] == s[i] <span class="keyword">or</span> p[j - <span class="number">1</span>] == <span class="string">'.'</span>:</span><br><span class="line">                        dp[r][c] = dp[r - <span class="number">1</span>][c] <span class="keyword">or</span> dp[r][c - <span class="number">2</span>]</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        dp[r][c] = dp[r][c - <span class="number">2</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[r][c] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[nrow - <span class="number">1</span>][ncol - <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>数据结构与算法</category>
      </categories>
      <tags>
        <tag>专业技能</tag>
        <tag>动态规划</tag>
      </tags>
  </entry>
  <entry>
    <title>背包问题</title>
    <url>/2018/03/01/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>有N件物品和一个容量为<code>v</code>的背包，放入第i件物品耗费空间<code>c[i]</code>得到价值为<code>W[i]</code>,求哪些物品装入背包可使得总价值最大？</p>
<h4 id="动态规划求解："><a href="#动态规划求解：" class="headerlink" title="动态规划求解："></a>动态规划求解：</h4><p>状态：问题所求最大价值，设状态即为背包中物品的价值</p>
<p>状态转移方程：</p>
<p><code>dp[i][j]</code>表示前i件物品放入一个容量为V的背包获得的最大价值状态转移方程为</p>
<script type="math/tex; mode=display">
\mathrm{dp}[\mathrm{i}][\mathrm{v}]=\max \left\{\begin{array}{l}
dp[i-1][v](\text {not select}) \\
dp[i-1][v-C[i]]+W[i](\text {select})
\end{array}\right.</script><p>其中<code>dp[i-1][v-C[i]]</code>表示前<code>i-1</code>件物品放入容量为<code>v-C[i]</code>的背包中。</p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># F[0, 0...V] = 0</span></span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>):</span><br><span class="line">    dp[<span class="number">0</span>][v] = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="comment"># 容量装不下当前物品时，保留原值</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(<span class="number">0</span>, C[i]):</span><br><span class="line">        dp[i][v] = dp[i<span class="number">-1</span>][v]</span><br><span class="line">    <span class="comment"># 状态转移</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(C[i], V+<span class="number">1</span>):</span><br><span class="line">        dp[i][v] = max(dp[i<span class="number">-1</span>][v], dp[i<span class="number">-1</span>][v-C[i]] + W[i])</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><ol>
<li><p>时间复杂度：<code>O(VN)</code></p>
</li>
<li><p>空间复杂度：<code>O(VN)</code>可优化成<code>O(N)</code></p>
<p><code>dp[i][v]</code>由<code>dp[i-1][v-C[i]]</code>和<code>dp[i-1][v]</code>两个子问题递推得到，所以第<code>i</code>次迭代时，<code>v</code>按照<code>V-&gt;0</code>的逆序计算<code>dp[v]</code>可以保证<code>dp[v]=max(dp[v],dp[v-C[i]]+W[i])</code>，这样在赋值之前，访问到的均为<code>i-1</code>次迭代保留的值。</p>
<p>空间为<code>c[i]</code>的物品不会受到状态<code>dp[0...C[i]]</code>的影响，即不影响装不下该物品的背包能装入的最大价值，所以<code>v</code>中<code>V</code>递减到<code>C[i]</code>就可以了。</p>
</li>
<li><p>代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(V, C[i]<span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        dp[v] = max(dp[v], dp[v-C[i]] + W[i])</span><br></pre></td></tr></table></figure>
<p>对处理0-1背包的物品进行抽象：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">zero_one_pack</span><span class="params">(F, c, w)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(V, c<span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        dp[v] = max(dp[v], dp[v-c] + w)</span><br><span class="line"></span><br><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    zero_one_pack(dp, C[i], W[i])</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="初始化细节"><a href="#初始化细节" class="headerlink" title="初始化细节"></a>初始化细节</h4><p>初始化dp的过程，实际上就是在没有任何物品可以装入背包时的合法状态（必要但不充分条件）</p>
<ol>
<li><p>恰好装满背包时，求最优解：<code>dp[0]=0,dp[1...V]=</code>$-\infty$</p>
<ul>
<li><p>容量为0时，什么也装不下，价值为0，所以<code>dp[0]=0</code></p>
</li>
<li><p>容量不为0的时候，状态未定义，状态设为$-\infty$</p>
</li>
</ul>
<p>按此进行初始化，迭代过程中，只有能够恰好装入的物品才会更新出合理值（正值），基于<code>dp[0]=0</code></p>
</li>
<li><p>没要求把背包装满：<code>dp[0...V]=0</code></p>
<p>任何容量都有一个合法的“什么都不装”，所以设<code>dp[0...V]=0</code></p>
</li>
</ol>
<h3 id="完全背包"><a href="#完全背包" class="headerlink" title="完全背包"></a>完全背包</h3><p><img src="/Users/lizhen/Library/Application Support/typora-user-images/image-20200321181733468.png" alt="image-20200321181733468"></p>
<h4 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h4><p>有N种物品和1个容量为V的背包，每种物品可以有任意多个，放入第i种物品的耗费空间<code>C[i]</code>，价值为<code>W[i]</code>,求背包能够装入的最大价值？</p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>每种物品可以放入0件，1件，…，<code>int(V/C[i])</code>件，令<code>dp[i][v]</code>表示前i种物品放入容量v的背包获取的最大价值，则<code>dp[i][v]=max(dp[i-1][v-k*C[i]]+k*W[i]),0&lt;=k*C[i]&lt;=v</code></p>
<h4 id="优化-1"><a href="#优化-1" class="headerlink" title="优化"></a>优化</h4><p>时间复杂度：<code>O(nv</code>$\sum \frac{V}{C[i]}$)</p>
<p>简单优化：一个简单有效的优化思路是：单位价值更便宜的应该直接跳过</p>
<p>若两件物品<code>i,j</code>有<code>C[i]&lt;=C[j] and W[i]&gt;=W[j]</code>;则<code>j</code>可以直接跳过，不必考虑，对于随机数据，这会大大减少物品数量，加快速度。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sieve = &#123;C[i]: <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>)&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="comment"># 跳过装不下的</span></span><br><span class="line">    <span class="keyword">if</span> C[i] &gt; V:</span><br><span class="line">        sieve[C[i]] = <span class="number">-1</span></span><br><span class="line">    <span class="comment"># 跳过 C[i] == C[j] and W[i] &gt; W[j]的j物品</span></span><br><span class="line">    <span class="keyword">elif</span> sieve[C[i]] &lt; W[i]:</span><br><span class="line">        sieve[C[i]] = W[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> sieve[C[i]] &lt; <span class="number">0</span> <span class="keyword">or</span> W[i] &lt; sieve[C[i]]:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(C[i], V+<span class="number">1</span>):</span><br><span class="line">        max_k = V // C[i]</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">1</span>, max_k+<span class="number">1</span>):</span><br><span class="line">            dp[i][v] = max(dp[i<span class="number">-1</span>][v], dp[i<span class="number">-1</span>][v-k*C[i]] + k*W[i])</span><br></pre></td></tr></table></figure>
<p>最终优化方案：</p>
<p>按照正序容量更新当前总价值，<code>dp[v-C[i]]</code>中可能是<code>i-1</code>次迭代中保留的值，也可能是本次迭代中产生了变化的值。（如果加选第i件物品）</p>
<p>时间复杂度：<code>O(NV)</code></p>
<p>空间复杂度:<code>O(V)</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(C[i], V+<span class="number">1</span>):</span><br><span class="line">        dp[v] = max(dp[v], dp[v-C[i]] + W[i])</span><br></pre></td></tr></table></figure>
<p>对处理一种完全背包的物品过程进行抽象</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complete_pack</span><span class="params">(F, c, w)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(c, V+<span class="number">1</span>):</span><br><span class="line">        F[v] = max(F[v], F[v-c] + w)</span><br><span class="line"></span><br><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    complete_pack(dp, C[i], W[i])</span><br></pre></td></tr></table></figure>
<h4 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h4><p>0-1 背包：倒序容量，当前新物品之多影响一次当前总价值</p>
<p>完全背包：正序容量，随着容量增加，当前新物品可以多次影响当前总价值</p>
<h3 id="多重背包"><a href="#多重背包" class="headerlink" title="多重背包"></a>多重背包</h3><p>有<code>N</code>种物品和1个容量为<code>V</code>的背包，第i种物品有<code>M[i]</code>件，每件耗费空间<code>C[i]</code>,价值<code>W[i]</code>,求能装入背包的最大价值。</p>
<h4 id="思路1"><a href="#思路1" class="headerlink" title="思路1"></a>思路1</h4><p>和完全背包类似，对i种物品有<code>M[i]+1</code>种策略，取<code>0</code>件，取<code>1</code>件，…，取<code>M[i]</code>,令<code>dp[i][v]</code>表示前i中物品放入容量v中获得的最大价值，则<code>dp[i][v]=max(dp[i-1][v-k*C[i]]+k*W[i]),0&lt;=k&lt;=M[i]</code></p>
<p>时间复杂度：`O(V<script type="math/tex">\sum M_i</script></p>
<h4 id="思路2"><a href="#思路2" class="headerlink" title="思路2"></a>思路2</h4><p>转化为0-1背包问题，把第i种物品换成<code>M[i]</code>件<code>0-1</code>背包中的物品，得到物品数为$\sum M_i$的<code>0-1</code>背包问题，时间复杂度仍为$O(V\sum M_i)$。使用二进制的思想，可以把时间复杂度下降为$O(V\sum{log{M_i}})$,即按照如下的方式进行拆分：</p>
<p>$2^0,2^1,2^2,…,2^{k-1},M_i-2^k+1$</p>
<p>这样拼成的新物品总量等于原来物品的数量，第i件物品拆分成了$O(log{m_i})$</p>
<h5 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiple_pack</span><span class="params">(F, c, w, m)</span>:</span></span><br><span class="line">    <span class="comment"># 如果物品足够多，就变成了完全背包</span></span><br><span class="line">    <span class="keyword">if</span> c * m &gt;= V:</span><br><span class="line">        complete_pack(F, c, w)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># 多重背包按照2次幂进行划分成0-1背包</span></span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> k &lt; m:</span><br><span class="line">        zero_one_pack(F, k*c, k*w)</span><br><span class="line">        m = m - k</span><br><span class="line">        k = <span class="number">2</span> * k</span><br><span class="line">    <span class="comment"># 把剩余的物品当作1件物品</span></span><br><span class="line">    zero_one_pack(F, c * m, w * m)</span><br><span class="line"></span><br><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    multiple_pack(dp, C[i], W[i], M[i])</span><br></pre></td></tr></table></figure>
<h3 id="二维费用背包"><a href="#二维费用背包" class="headerlink" title="二维费用背包"></a>二维费用背包</h3><p>对于每件物品有两种不同的cost，每种cost有一个最大容纳值（背包容量），怎样选择物品使得背包容纳最大价值？第i种物品两种费用分别为<code>C[i]</code>和<code>D[i]</code>，两种cost最大容纳值为V,U，物品的价值为<code>W[i]</code>(题目场景样例：打矩形中放小矩形，求最大容量)</p>
<h4 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h4><p>费用加1维，状态加1维；令<code>dp[i][v][u]</code>表示前i件物品付出两种费用分别为v，u时可获得的最大价值。则<code>dp[i][v][u]=max(dp[i-1][v][u],dp[i-1][v-C[i]][u-D[i]]+W[i])</code></p>
<h4 id="优化-2"><a href="#优化-2" class="headerlink" title="优化"></a>优化</h4><p>类似于一维背包空间优化方法，二维背包与之类似：</p>
<ol>
<li>二维0-1背包：v和u采用逆序循环</li>
<li>二维完全背包：v和u采用顺序循环</li>
<li>二维多重背包：拆分物品</li>
</ol>
<h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">two_dim_zero_one_pack</span><span class="params">(F, c, d, w)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(V, c<span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> range(U, d<span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            F[v][u] = max(F[v][u], F[v-c][u-d] + w)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">two_dim_complete_pack</span><span class="params">(F, c, d, w)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(c, V+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> range(d, U+<span class="number">1</span>):</span><br><span class="line">            F[v][u] = max(F[v][u], F[v-c][u-d] + w)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">two_dim_multiple_pack</span><span class="params">(F, c, d, w, m)</span>:</span></span><br><span class="line">    <span class="comment"># 两种cost数量都充足，可直接按照完全背包处理</span></span><br><span class="line">    <span class="keyword">if</span> c * m &gt;= V <span class="keyword">and</span> d * m &gt;= U:</span><br><span class="line">        two_dim_complete_pack(F, c, d, w)</span><br><span class="line">    <span class="comment"># 多重背包按照2次幂进行划分成0-1背包</span></span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> k &lt; m:</span><br><span class="line">        two_dim_complete_pack(F, k * c, k * d, k * w)</span><br><span class="line">        m = m - k</span><br><span class="line">        k = <span class="number">2</span> * k</span><br><span class="line">    <span class="comment"># 把剩余的物品当作1件物品</span></span><br><span class="line">    two_dim_zero_one_pack(F, m * c, m * d, m * w)</span><br><span class="line"></span><br><span class="line">F = [[<span class="number">0</span> <span class="keyword">for</span> v <span class="keyword">in</span> range(V+<span class="number">1</span>)] <span class="keyword">for</span> u <span class="keyword">in</span> range(U+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    two_dim_zero_one_pack(F, C[i], D[i], W[i])</span><br><span class="line">    <span class="comment"># two_dim_complete_pack(F, C[i], D[i], W[i])</span></span><br><span class="line">    <span class="comment"># two_dim_multiple_pack(F, C[i], D[i], W[i], M[i])</span></span><br></pre></td></tr></table></figure>
<h4 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h4><p>二维费用题目的一种隐含表述方式：最多取U件</p>
<p>对于有这种限制的题目，可以将’件数’看作一种费用，每件物品件数费用为1，可以达到的最大件数费用非U，<code>dp[v][u]</code>表示cost为v，最多选择u件物品时所达到的最大价值（再根据物品的特性（0-1,完全，多重）采用不同的方式进行循环，得出答案）</p>
]]></content>
      <categories>
        <category>数据结构与算法</category>
      </categories>
      <tags>
        <tag>背包问题</tag>
      </tags>
  </entry>
  <entry>
    <title>排序算法</title>
    <url>/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="排序算法"><a href="#排序算法" class="headerlink" title="排序算法"></a>排序算法</h2><p><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/排序.png" alt="avatar"></p>
<a id="more"></a>
<h3 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h3><h4 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h4><p>是一种简单的排序算法。它重复地走访过要排序的数列，一次比较两个元素，如果它们的顺序错误就把它们交换过来。走访数列的工作是重复地进行直到没有再需要交换，也就是说该数列已经排序完成。这个算法的名字由来是因为越小的元素会经由交换慢慢“浮”到数列的顶端。</p>
<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li>比较相邻的元素。如果第一个比第二个大，就交换它们两个；</li>
<li>对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对，这样在最后的元素应该会是最大的数；</li>
<li>针对所有的元素重复以上的步骤，除了最后一个；</li>
<li><p>重复步骤1~3，直到排序完成。</p>
<h4 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h4></li>
<li><p>时间复杂度：<code>O(1)</code></p>
</li>
<li>空间复杂度：$O(n^2)$<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bubble_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="comment"># 外层循环: 走访数据的次数</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums) - <span class="number">1</span>):</span><br><span class="line">        <span class="comment"># 设置是否交换标志位</span></span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="comment"># 内层循环: 每次走访数据时, 相邻对比次数</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(nums) - i - <span class="number">1</span>):</span><br><span class="line">            <span class="comment"># 要求从低到高</span></span><br><span class="line">            <span class="comment"># 如次序有误就交换</span></span><br><span class="line">            <span class="keyword">if</span> nums[j] &gt; nums[j + <span class="number">1</span>]:</span><br><span class="line">                nums[j], nums[j + <span class="number">1</span>] = nums[j + <span class="number">1</span>], nums[j]</span><br><span class="line">                <span class="comment"># 发生了数据交换</span></span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">        <span class="comment"># 如果未发生交换数据, 则说明后续数据均有序</span></span><br><span class="line">        <span class="keyword">if</span> flag == <span class="literal">False</span>:</span><br><span class="line">            <span class="keyword">break</span>  <span class="comment"># 跳出数据走访</span></span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<h3 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h3><h4 id="思想-1"><a href="#思想-1" class="headerlink" title="思想"></a>思想</h4>它的工作原理：首先在未排序序列中找到最小元素，存放到排序序列的起始位置，然后，再从剩余未排序元素中继续寻找最小元素，然后放到已排序序列的末尾。以此类推，直到所有元素均排序完毕。<h4 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤"></a>步骤</h4>n个记录的直接选择排序可经过n-1趟直接选择排序得到有序结果。</li>
<li>初始状态：无序区为<code>R[1…n]</code>，有序区为空；</li>
<li>第i趟排序<code>(i=1,2,3…n-1)</code>开始时，当前有序区和无序区分别为<code>R[1…i-1]和R(i…n）</code>。该趟排序从当前无序区中-选出关键字最小的记录 <code>R[k]</code>，将它与无序区的第1个记录R交换，使<code>R[1…i]</code>和<code>R[i+1…n)</code>分别变为记录个数增加1个的新有序区和记录个数减少1个的新无序区；</li>
<li>n-1趟结束，数组有序化了。<h4 id="复杂度-1"><a href="#复杂度-1" class="headerlink" title="复杂度"></a>复杂度</h4></li>
<li>时间复杂度：$O(n^2)$</li>
<li>空间复杂度：O(1)<h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">selection_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line">    size = len(nums)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(size):</span><br><span class="line">        min_idx = i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i+<span class="number">1</span>,size):</span><br><span class="line">            <span class="keyword">if</span> nums[j] &lt; nums[min_idx]:</span><br><span class="line">                min_idx = j</span><br><span class="line">        temp = nums[min_idx]</span><br><span class="line">        nums[min_idx] = nums[i]</span><br><span class="line">        nums[i] = temp</span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<h3 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h3><h4 id="思想-2"><a href="#思想-2" class="headerlink" title="思想"></a>思想</h4>和选择排序一样，归并排序的性能不受输入数据的影响，但表现比选择排序好的多，因为始终都是O(n log n）的时间复杂度。代价是需要额外的内存空间。</li>
</ol>
<h4 id="步骤-2"><a href="#步骤-2" class="headerlink" title="步骤"></a>步骤</h4><p><strong>归并排序</strong>是建立在归并操作上的一种有效的排序算法。该算法是采用分治法（Divide and Conquer）的一个非常典型的应用。归并排序是一种稳定的排序方法。将已有序的子序列合并，得到完全有序的序列；即先使每个子序列有序，再使子序列段间有序。若将两个有序表合并成一个有序表，称为2-路归并。</p>
<ol>
<li>把长度为n的输入序列分成两个长度为n/2的子序列；</li>
<li>对这两个子序列分别采用归并排序；</li>
<li>将两个排序好的子序列合并成一个最终的排序序列。</li>
</ol>
<h4 id="复杂度-2"><a href="#复杂度-2" class="headerlink" title="复杂度"></a>复杂度</h4><ol>
<li>时间复杂度$O(nlog_2 n)$</li>
</ol>
<h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(nums) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line"></span><br><span class="line">    mid_idx = len(nums) / <span class="number">2</span></span><br><span class="line">    left_array = nums[<span class="number">0</span>:mid_idx]</span><br><span class="line">    right_array = nums[mid_idx:len(nums)]</span><br><span class="line">    <span class="keyword">return</span> merge(merge_sort(left_array),merge_sort(right_array))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(left_array,right_array)</span>:</span></span><br><span class="line">    <span class="comment"># 合并两个有序数组</span></span><br><span class="line">    res = []</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; len(left_array) <span class="keyword">and</span> j &lt; len(right_array):</span><br><span class="line">        <span class="keyword">if</span> left_array[i] &lt; right_array[j]:</span><br><span class="line">            res.append(left_array[i])</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res.append(right_array[j])</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> i &lt; len(left_array):</span><br><span class="line">        res.extend(left_array[i:])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res.extend(right_array[j:])</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<h3 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h3><h4 id="思想-3"><a href="#思想-3" class="headerlink" title="思想"></a>思想</h4><p>通过构建有序序列，对于未排序数据，在已排序序列中从后向前扫描，找到相应位置并插入。插入排序在实现上，通常采用in-place排序（即只需用到O(1)的额外空间的排序），因而在从后向前扫描过程中，需要反复把已排序元素逐步向后挪位，为最新元素提供插入空间。</p>
<h4 id="步骤-3"><a href="#步骤-3" class="headerlink" title="步骤"></a>步骤</h4><p>一般来说，插入排序都采用in-place在数组上实现。具体算法描述如下：</p>
<ol>
<li>从第一个元素开始，该元素可以认为已经被排序；</li>
<li>取出下一个元素，在已经排序的元素序列中从后向前扫描；</li>
<li>如果该元素（已排序）大于新元素，将该元素移到下一位置；</li>
<li>重复步骤3，直到找到已排序的元素小于或者等于新元素的位置；</li>
<li>将新元素插入到该位置后；</li>
<li><p>重复步骤2~5。</p>
<h4 id="复杂度-3"><a href="#复杂度-3" class="headerlink" title="复杂度"></a>复杂度</h4></li>
<li><p>时间复杂度：<code>O(1)</code></p>
</li>
<li>空间复杂度：$O(n^2)$</li>
</ol>
<h4 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(nums)):</span><br><span class="line">        temp = nums[i]</span><br><span class="line">        pos = i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> temp &lt; nums[j]:</span><br><span class="line">                nums[j + <span class="number">1</span>] = nums[j]</span><br><span class="line">                pos = j</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pos = j + <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        nums[pos] = temp</span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<h3 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h3><p>希尔排序是希尔（Donald Shell） 于1959年提出的一种排序算法。希尔排序也是一种插入排序，它是简单插入排序经过改进之后的一个更高效的版本，也称为缩小增量排序，同时该算法是冲破O(n2）的第一批算法之一。它与插入排序的不同之处在于，它会优先比较距离较远的元素。希尔排序又叫缩小增量排序。</p>
<h4 id="思想-4"><a href="#思想-4" class="headerlink" title="思想"></a>思想</h4><p>希尔排序是把记录按下表的一定增量分组，对每组使用直接插入排序算法排序；随着增量逐渐减少，每组包含的关键词越来越多，当增量减至1时，整个文件恰被分成一组，算法便终止。</p>
<h4 id="步骤-4"><a href="#步骤-4" class="headerlink" title="步骤:"></a>步骤:</h4><p>先将整个待排序的记录序列分割成为若干子序列分别进行直接插入排序,具体步骤如下：</p>
<ol>
<li>选择一个增量序列<code>t1，t2，…，tk</code>，其中<code>ti&gt;tj，tk=1</code>；</li>
<li>按增量序列个数k，对序列进行 k 趟排序；</li>
<li>每趟排序，根据对应的增量ti，将待排序列分割成若干长度为 m 的子序列，分别对各子表进行直接插入排序。仅增量因子为1 时，整个序列作为一个表来处理，表长度即为整个序列的长度。<br><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/aHR0cHM6Ly9pbWFnZXMyMDE4LmNuYmxvZ3MuY29tL2Jsb2cvMTE5MjY5OS8yMDE4MDMvMTE5MjY5OS0yMDE4MDMxOTA5NDExNjA0MC0xNjM4NzY2MjcxLnBuZw.png" alt="avat"><h4 id="复杂度-4"><a href="#复杂度-4" class="headerlink" title="复杂度"></a>复杂度</h4></li>
<li>时间复杂度$O(nlog_2 n)$<h4 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    size = len(nums)</span><br><span class="line">    gap = size / <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> gap:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(gap, size):</span><br><span class="line">            temp = nums[i]</span><br><span class="line">            pre_index = i - gap</span><br><span class="line">            <span class="comment"># 对于划分到一组内的数进行排序</span></span><br><span class="line">            <span class="keyword">while</span> pre_index &gt;= <span class="number">0</span> <span class="keyword">and</span> nums[pre_index] &gt; temp:</span><br><span class="line">                nums[pre_index + gap] = nums[pre_index]</span><br><span class="line">                pre_index -= gap</span><br><span class="line">            <span class="comment"># 插入</span></span><br><span class="line">            nums[pre_index+gap] = temp</span><br><span class="line">        </span><br><span class="line">        gap /= <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
<h3 id="快排"><a href="#快排" class="headerlink" title="快排"></a>快排</h3><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/1450319-20190525163106857-545290968.png" alt="avatar"><h4 id="步骤-5"><a href="#步骤-5" class="headerlink" title="步骤"></a>步骤</h4>快速排序使用分治法来把一个串（list）分为两个子串（sub-lists）。</li>
<li>从数列中挑出一个元素，称为 “基准”（pivot ）</li>
<li>重新排序数列，所有元素比基准值小的摆放在基准前面，所有元素比基准值大的摆在基准的后面（相同的数可以到任一边）。在这个分区退出之后，该基准就处于数列的中间位置。这个称为分区（partition）操作</li>
<li><p>递归地（recursive）把小于基准值元素的子数列和大于基准值元素的子数列排序。<br>复杂度:</p>
</li>
<li><p>时间复杂度：$O(nlogn)$</p>
</li>
<li>空间复杂度：$O(logn)$</li>
<li>稳定性：不稳定<h4 id="代码-5"><a href="#代码-5" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quick_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="comment"># 递归退出条件</span></span><br><span class="line">    <span class="comment"># 仅剩一个元素无需继续分组</span></span><br><span class="line">    <span class="keyword">if</span> len(nums) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line">        <span class="comment"># 设置关键数据</span></span><br><span class="line">    a = nums[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># 找出所有比 a 大的数据</span></span><br><span class="line">    big = [x <span class="keyword">for</span> x <span class="keyword">in</span> nums <span class="keyword">if</span> x &gt; a]</span><br><span class="line">    <span class="comment"># 找出所有比 a 小的数据</span></span><br><span class="line">    small = [x <span class="keyword">for</span> x <span class="keyword">in</span> nums <span class="keyword">if</span> x &lt; a]</span><br><span class="line">    <span class="comment"># 找出所有与 a 相等的数据</span></span><br><span class="line">    same = [x <span class="keyword">for</span> x <span class="keyword">in</span> nums <span class="keyword">if</span> x == a]</span><br><span class="line">    <span class="comment"># 拼接数据排序的结果</span></span><br><span class="line">    <span class="keyword">return</span> quick_sort(small) + same + quick_sort(big)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h3><p>堆排序（Heapsort） 是指利用堆这种数据结构所设计的一种排序算法。堆积是一个近似完全二叉树的结构，并同时满足堆积的性质：即子结点的键值或索引总是小于（或者大于）它的父节点。</p>
<h4 id="步骤-6"><a href="#步骤-6" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li>将初始待排序关键字序列(R1,R2….Rn)构建成大顶堆，此堆为初始的无序区；</li>
<li>将堆顶元素R[1]与最后一个元素R[n]交换，此时得到新的无序区<code>(R1,R2,……Rn-1)</code>和新的有序区(Rn),且满足<code>R[1,2…n-1]&lt;=R[n]</code>；</li>
<li>由于交换后新的堆顶R[1]可能违反堆的性质，因此需要对当前无序区<code>(R1,R2,……Rn-1)</code>调整为新堆，然后再次将R[1]与无序区最后一个元素交换，得到新的无序区<code>(R1,R2….Rn-2)</code>和新的有序区<code>(Rn-1,Rn)</code>。不断重复此过程直到有序区的元素个数为n-1，则整个排序过程完成。</li>
</ol>
<p><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/CA6B626B-98BA-4AA5-BC01-FDAFE554BB87.gif" alt="avatar"></p>
<h4 id="复杂度-5"><a href="#复杂度-5" class="headerlink" title="复杂度"></a>复杂度</h4><ol>
<li>时间复杂度：O(nlogn)<h4 id="代码-6"><a href="#代码-6" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">heap_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    size = len(nums)</span><br><span class="line">    <span class="keyword">if</span> size &lt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line">    <span class="comment"># 构建一个最大堆</span></span><br><span class="line">    build_max_heap(nums)</span><br><span class="line">    <span class="comment"># 循环将根和最后一个元素交换，然后重新调整最大堆。</span></span><br><span class="line">    <span class="keyword">while</span> size &gt; <span class="number">0</span>:</span><br><span class="line">        temp = nums[<span class="number">0</span>]</span><br><span class="line">        nums[<span class="number">0</span>] = nums[size - <span class="number">1</span>]</span><br><span class="line">        nums[size - <span class="number">1</span>] = temp</span><br><span class="line"></span><br><span class="line">        size -= <span class="number">1</span></span><br><span class="line">        adjust_heap(nums, <span class="number">0</span>,size)</span><br><span class="line">    <span class="keyword">return</span> nums</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_max_heap</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="comment"># 从最后一个非叶子节点开始向上构造最大堆</span></span><br><span class="line">    <span class="comment"># i 的左子树和右子树分别为2i+1 和 2(i+1)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums) / <span class="number">2</span><span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        adjust_heap(nums, i,len(nums))</span><br><span class="line">    <span class="comment"># return nums</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adjust_heap</span><span class="params">(nums, i,size)</span>:</span></span><br><span class="line">    max_index = i</span><br><span class="line">    <span class="comment"># 如果有左子树，且左子树大于父节点，则将最大指针指向左子树</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">2</span> * i + <span class="number">1</span> &lt; size <span class="keyword">and</span> nums[<span class="number">2</span> * i + <span class="number">1</span>] &gt; nums[max_index]:</span><br><span class="line">        max_index = <span class="number">2</span> * i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">2</span> * (i + <span class="number">1</span>) &lt; size <span class="keyword">and</span> nums[<span class="number">2</span> * (i + <span class="number">1</span>)] &gt; nums[max_index]:</span><br><span class="line">        max_index = <span class="number">2</span> * (i + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> max_index == i:</span><br><span class="line">        temp = nums[max_index]</span><br><span class="line">        nums[max_index] = nums[i]</span><br><span class="line">        nums[i] = temp</span><br><span class="line">        adjust_heap(nums, max_index,size)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="计数排序"><a href="#计数排序" class="headerlink" title="计数排序"></a>计数排序</h3><p><strong>计数排序</strong>的核心在于将输入的数据值转化为键存储在额外开辟的数组空间中。 作为一种线性时间复杂度的排序，计数排序要求输入的数据必须是有确定范围的整数。</p>
<h4 id="基本思想"><a href="#基本思想" class="headerlink" title="基本思想"></a>基本思想</h4><p>计数排序(Counting sort) 是一种稳定的排序算法。计数排序使用一个额外的数组C，其中第i个元素是待排序数组A中值等于i的元素的个数。然后根据数组C来将A中的元素排到正确的位置。它<strong>只能对整数进行排序</strong>。<br><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/E4559E2C-6389-4EAB-976A-95289A079EB8.gif" alt="avatar"></p>
<h4 id="算法步骤"><a href="#算法步骤" class="headerlink" title="算法步骤"></a>算法步骤</h4><ol>
<li>找出待排序的数组中最大和最小的元素</li>
<li>统计数组中每个值为i的元素出现的次数，存入数组C的第i项</li>
<li>对所有的计数累加（从C中的第一个元素开始，每一项和前一项相加）</li>
<li>反向填充目标数组：将每个元素i放在新数组的第C(i)项，每放一个元素就将C(i)减去1。<h4 id="复杂度-6"><a href="#复杂度-6" class="headerlink" title="复杂度"></a>复杂度</h4></li>
<li>时间复杂度：O(n+k)<h4 id="代码-7"><a href="#代码-7" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_sort</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="comment"># 获取arr中的最大值和最小值</span></span><br><span class="line">    max_num = max(arr)</span><br><span class="line">    min_num = min(arr)</span><br><span class="line">    <span class="comment"># 以最大值和最小值的差作为中间数组的长度,并构建中间数组，初始化为0</span></span><br><span class="line">    length = max_num - min_num + <span class="number">1</span></span><br><span class="line">    temp_arr = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(length)]</span><br><span class="line">    <span class="comment"># 创建结果List，存放排序完成的结果</span></span><br><span class="line">    res_arr = list(range(len(arr)))</span><br><span class="line">    <span class="comment"># 第一次循环遍历</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> arr:</span><br><span class="line">        temp_arr[num - min_num] += <span class="number">1</span></span><br><span class="line">    <span class="comment"># 第二次循环遍历</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, length):</span><br><span class="line">        temp_arr[i] = temp_arr[i] + temp_arr[i - <span class="number">1</span>]</span><br><span class="line">    <span class="comment"># 第三次循环遍历</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(arr) - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        res_arr[temp_arr[arr[i] - min_num] - <span class="number">1</span>] = arr[i]</span><br><span class="line">        temp_arr[arr[i] - min_num] -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res_arr</span><br></pre></td></tr></table></figure>
<h3 id="桶排序"><a href="#桶排序" class="headerlink" title="桶排序"></a>桶排序</h3>桶排序 是计数排序的升级版。它利用了函数的映射关系，高效与否的关键就在于这个映射函数的确定。</li>
</ol>
<h4 id="基本思想-1"><a href="#基本思想-1" class="headerlink" title="基本思想"></a>基本思想</h4><p>假设输入数据服从均匀分布，将数据分到有限数量的桶里，每个桶再分别排序（有可能再使用别的排序算法或是以递归方式继续使用桶排序进行排</p>
<p><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/D7FA465B-93A5-493B-BE2B-15375A28FAE2.gif" alt="avatar"></p>
<h4 id="算法步骤-1"><a href="#算法步骤-1" class="headerlink" title="算法步骤"></a>算法步骤</h4><ol>
<li>根据数据分桶</li>
<li>遍历数组，把数据一个一个放到对应的桶中。</li>
<li>对每个不是空的桶进行排序，可以使用其他排序方法，也可以递归使用桶排序。</li>
<li>从不是空的桶里把排好序的数据拼接起来。<h4 id="复杂度-7"><a href="#复杂度-7" class="headerlink" title="复杂度"></a>复杂度</h4></li>
<li>时间复杂度：最好情况下使用线性时间O(n)，桶排序的时间复杂度，取决与对各个桶之间数据进行排序的时间复杂度，因为其它部分的时间复杂度都为O(n)。很显然，桶划分的越小，各个桶之间的数据越少，排序所用的时间也会越少。<h4 id="代码-8"><a href="#代码-8" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, k)</span>:</span></span><br><span class="line">        self.key = k;</span><br><span class="line">        self.next = <span class="literal">None</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bucket_sort</span><span class="params">(arr,bucket_num)</span>:</span></span><br><span class="line">    h = [];</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, bucket_num):</span><br><span class="line">        h.append(node(<span class="number">0</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(arr)):</span><br><span class="line">        tmp = node(arr[i])</span><br><span class="line">        map = arr[i] / bucket_num</span><br><span class="line">        p = h[map]</span><br><span class="line">        <span class="keyword">if</span> p.key <span class="keyword">is</span> <span class="number">0</span>:</span><br><span class="line">            h[map].next = tmp</span><br><span class="line">            h[map].key = h[map].key + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">while</span> (p.next != <span class="literal">None</span> <span class="keyword">and</span> p.next.key &lt;= tmp.key):</span><br><span class="line">                p = p.next</span><br><span class="line">            tmp.next = p.next</span><br><span class="line">            p.next = tmp</span><br><span class="line">            h[map].key = h[map].key + <span class="number">1</span></span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">        q = h[i].next</span><br><span class="line">        <span class="keyword">while</span> (q != <span class="literal">None</span>):</span><br><span class="line">            arr[k] = q.key</span><br><span class="line">            k = k + <span class="number">1</span></span><br><span class="line">            q = q.next</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="基数排序"><a href="#基数排序" class="headerlink" title="基数排序"></a>基数排序</h3><p>基数排序也是非比较的排序算法，对每一位进行排序，从最低位开始排序，复杂度为O(kn),为数组长度，k为数组中的数的最大的位数；</p>
<h4 id="基本思想-2"><a href="#基本思想-2" class="headerlink" title="基本思想"></a>基本思想</h4><p>基数排序是按照低位先排序，然后收集；再按照高位排序，然后再收集；依次类推，直到最高位。有时候有些属性是有优先级顺序的，先按低优先级排序，再按高优先级排序。最后的次序就是高优先级高的在前，高优先级相同的低优先级高的在前。基数排序基于分别排序，分别收集，所以是稳定的。<br><img src="/2018/02/25/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/2BA80F27-FCDC-4BEA-BD0B-2AAB59242752.gif" alt="avatar"></p>
<h4 id="算法步骤-2"><a href="#算法步骤-2" class="headerlink" title="算法步骤"></a>算法步骤</h4><ol>
<li>取得数组中的最大数，并取得位数；</li>
<li>arr为原始数组，从最低位开始取每个位组成radix数组；</li>
<li>对radix进行计数排序（利用计数排序适用于小范围数的特点）；</li>
</ol>
<h4 id="复杂度-8"><a href="#复杂度-8" class="headerlink" title="复杂度"></a>复杂度</h4><ol>
<li>时间复杂度：O（kn）</li>
</ol>
<h4 id="代码-9"><a href="#代码-9" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">radix_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    k = len(str(max(nums)))  <span class="comment"># 最大的数的位数</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">        tong = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">            tong[int(num / (<span class="number">10</span> ** i)) % <span class="number">10</span>].append(num)  <span class="comment"># 获取当前排序位数上的数字</span></span><br><span class="line">        <span class="comment">#print(tong)</span></span><br><span class="line">        nums = []</span><br><span class="line">        <span class="keyword">for</span> zitong <span class="keyword">in</span> tong:</span><br><span class="line">            nums = nums + zitong</span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>数据结构与算法</category>
      </categories>
      <tags>
        <tag>专业技能</tag>
        <tag>排序</tag>
      </tags>
  </entry>
  <entry>
    <title>查找算法</title>
    <url>/2018/02/10/%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="简单搜索查找"><a href="#简单搜索查找" class="headerlink" title="简单搜索查找"></a>简单搜索查找</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">brute_force_search</span><span class="params">(nums,key)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">        <span class="keyword">if</span> num == key:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h3><p>前提：数组有序</p>
<h4 id="迭代版本"><a href="#迭代版本" class="headerlink" title="迭代版本"></a>迭代版本</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search</span><span class="params">(nums, key)</span>:</span></span><br><span class="line">    low = <span class="number">0</span></span><br><span class="line">    high = len(nums) - <span class="number">1</span></span><br><span class="line">    time = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> low &lt; high:</span><br><span class="line">        time += <span class="number">1</span></span><br><span class="line">        mid = int((low + high) / <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> key &lt; nums[mid]:</span><br><span class="line">            high = mid - <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> key &gt; nums[mid]:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 打印折半的次数</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"success! times: %s"</span> % time</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"fail! times: %s"</span> % time</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h4 id="递归版本"><a href="#递归版本" class="headerlink" title="递归版本"></a>递归版本</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search_recursive</span><span class="params">(nums, item)</span>:</span></span><br><span class="line">    mid = len(nums) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> nums[mid] == item:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> mid == <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># mid等于0就是找到最后一个元素了。</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> item &gt; nums[mid]:  <span class="comment"># 找后半部分</span></span><br><span class="line">            <span class="comment"># print(lst[mid:])</span></span><br><span class="line">            <span class="keyword">return</span> binary_search_recursive(nums[mid:], item)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> binary_search_recursive(nums[:mid], item)  <span class="comment"># 找前半部分</span></span><br></pre></td></tr></table></figure>
<h3 id="Hash-查找"><a href="#Hash-查找" class="headerlink" title="Hash 查找"></a>Hash 查找</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashTable</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size)</span>:</span></span><br><span class="line">        self.elem = [<span class="literal">None</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(size)]  <span class="comment"># 使用list数据结构作为哈希表元素保存方法</span></span><br><span class="line">        self.count = size  <span class="comment"># 最大表长</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hash</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> key % self.count  <span class="comment"># 散列函数采用除留余数法</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert_hash</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""插入关键字到哈希表内"""</span></span><br><span class="line">        address = self.hash(key)  <span class="comment"># 求散列地址</span></span><br><span class="line">        <span class="keyword">while</span> self.elem[address]:  <span class="comment"># 当前位置已经有数据了，发生冲突。</span></span><br><span class="line">            address = (address+<span class="number">1</span>) % self.count  <span class="comment"># 线性探测下一地址是否可用</span></span><br><span class="line">        self.elem[address] = key  <span class="comment"># 没有冲突则直接保存。</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search_hash</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""查找关键字，返回布尔值"""</span></span><br><span class="line">        star = address = self.hash(key)</span><br><span class="line">        <span class="keyword">while</span> self.elem[address] != key:</span><br><span class="line">            address = (address + <span class="number">1</span>) % self.count</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.elem[address] <span class="keyword">or</span> address == star:  <span class="comment"># 说明没找到或者循环到了开始的位置</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">      </span><br><span class="line">     </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># hash查找</span></span><br><span class="line">    list_a = [<span class="number">12</span>, <span class="number">67</span>, <span class="number">56</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">37</span>, <span class="number">22</span>, <span class="number">29</span>, <span class="number">15</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">34</span>]</span><br><span class="line">    hash_table = HashTable(len(list_a))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> list_a:</span><br><span class="line">        hash_table.insert_hash(i)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> hash_table.elem:</span><br><span class="line">        <span class="keyword">if</span> i:</span><br><span class="line">            print(i, hash_table.elem.index(i))</span><br><span class="line"></span><br><span class="line">    print(hash_table.search_hash(<span class="number">15</span>))</span><br><span class="line">    print(hash_table.search_hash(<span class="number">33</span>))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>数据结构与算法</category>
      </categories>
      <tags>
        <tag>查找算法</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo-advanced-settings</title>
    <url>/2018/02/10/hexo-advanced-settings/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">请输入密码以阅读这篇私密文章。</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="57b6897c6a985e8661c947d7203465d9ef28ebd4506994f526ce1dafd43ebdeb">04b96cf03f1b5d00286d72390b6bf2e0817acbfddb7147d2fcc01912c7f5c0f9713c9c317ba53b9347fde83c930f8c77af411014f8ec84eef7465f6027f6e563b20763efbf9fac1db105face649d36b82b8e5a28894e0322accb07eba0f38491487fddc38b18732e21e4d5a09a208486db90f1b471e152ae582639c98996b3d9545b516ad74403d379a378e897878b9754f5f3c9a9c1cbf034ea3b155b6217c7c2a8ce65fc5458e94d70325ea68e520fea1f3d22f56b6349aee20af7ed199e2c05d5058ef826f483bf40a5fd1d5f8069d68a582ee349a763d92aeb6977cdf8388e1aa0fc069179b55234aadf144d9f27c28b866be6bdb862479174ac2f0f756343cdd3c90f9775d0a437ae6b12ca1af625e01d61f057e68914d84f1bf501ffb929acd2da9b7371e13158ae9117498fff63f12f7f4e7422c9c2ce82745f88b8d4bf4aff5259be24e719f9de125b467efdb35a152a570a5b7258c1bb94ef2b497385c0fdfbdb477d9c442cb052b3460e411e3919ca5e68b774d962b2f179dc6f96d0c5d4f3e61ba5cc067127e59a27c81179170f95c4abfaa8821b560c626bfc45384cb7968e789444269fa004014eec0fc0ef48e879845f5849de40ac89ffce0d204a82464fb22a67c3677ff755b7069baf4834b6ceff16f1143240bef83fd505cc254927c509902013fa076bba417069cecd59c3705114b5b24dc14949da2d9716c6e8b23f08845af240e870a481d13b654585af6b8c1bcc03f087e92a5b202acae298a8e11b5c4e626ed12abedba5ec5c5c6109c9f24caefe90e5ae73a8879adb4752fcc26af1dc270af92bd1d4cdb929a24439403f9de5c72bd40d23d1d70d0f96cdf396f2e74a215324e8ecda1bbc5a040efc5786078ae92a822bf394876b809ad169731fddfe078b4033527a205b735b0840f2547a882448c00ccd09d77fd37098fd1a625892a20500d77e9fa7c561332f9ac7375569dcb5d4c04e0e744d95bb0e448045c49c5433dfdb915c9262ce91b1110d6260c71258acd9b7f270bc7a33675c2fd2747b47d12e67f9e55f33bd5038b358f21f4604b81665296e61c519cdbf057bbe7b1705b91f4bbc5810abedf67546dc810a9e4aad1e12c46b8bfc1183f8439430bd8661d00b5ddf525613c23e804eada04150f95fa8f087238466b300e880a77650ba05b7aa877f83ad17b256d616e13684183faa8cea178050220edfc7a0385c2375d7fe4e49db9bb9cbec30e61e48acb2f3838a84005d9b78025f85ab54ca86694b19cf4586d2876c3ddf53a83d787aa8b8400b5389b32d84cc16954d346c5bc53a4095b9c79fd1cf48faffcdefc8b93c1756163dc8ab6bc0cc89c61823d5fb2ff1a03087499706e18569a6fd606e7773b1a46660dd1e70fcc5533976bf6c4db1c4e4679030bc066e69c8e2e192d05e6d516b0e558d14a7423e9a8e3bf4c3200463181c00025f4fc2e56b1d350303e75c6e4514f8122d7d5d8de536687fe4cecde342422ca96777db265e89c0b5f0991530612b3e745cc2e6164e9b94263bcbb78f98ba2e6918ecc1b2678e71ea5ad385b6088ce4b0f46e6968983fdccfa2ed49b8d9edf0e6aeccbaddeee317f76a41585309de95a274592ab036f8006b818646b8b624382ac690e03038d2212e27171e9db65d9e9a347e00ca9bcb87801cd0b8461523e7694caf99439469ffd0c84b6be27f49aa2d5f490d90a44da421dcb8895250ab71e9941a8152f584473db3fc34c9fce8eecc8af89cad35031ea8982a2c0db0a11be6c3d874aa0cadcd8a727119039ec55adc00a293f23f4e04f5fa548c43988179072d7b2db4c7da4e5042a10cd8d6712e57286d072346e36a1df9c0017a032833df23d286d8489af8967e911c165dd053d8b76ac8e55094dffc315d3dcc0dbb03128d73268d97f1953ddbdc23d748ac7daf73dcd3563064bbbd3082971faa6e84b1c94fbb31c44cbb6d7aea79596e2683b3d161ab066e9dd40d8bc1dde72d26a6c759a059587624b4ece451daccd35b1ed4206455bee60ffbe3709ef2311abf99b7cc577fb89c00dfb4b3814775fb08d307c43251e1a7faef466d3a307026e614969bde761fc7af128abb4025c1005341055ef7bba39713e17131a254e856c12bf2fb228be24d20ca80711f8e8eeffa716b33dbaad58b431c632b7843b6c2b4222bb476867ae9f93624d308f01f576c1aee21c9f9f533c761c9757ec9cc33f7b0d2b8af6c061686fea473ebae62867abb0bb7f3e28c7d0aa1eb31a450cf27f4ecdd0a93caf30bbf81169654e599cfbf5db736b3bf34b957abf9e5f51f97188c370768c4eaf58d8b6e6761cf77ae257b674cf194ca304d8eed0bdfc24ffe366cdf70878641f92721c0c0083c4c76bf68920f1de33aa73b49093815de1501ad027922d0e3e181b3f18e424dc34c4b52ca021a1b41b2d2e36e5cfd141b9721c9ee2cdf407fd04dce803c236a2d9ce13f834a0f3b7e0dcb07c58db5ec7a2b5731c6adef39642eae50f7269eeaebe1776d1ac63ec53acdcf380f0eba40bf821c0f190bfa58a89a22c8014428fca626c652f6e3d7e7c8f1bea53034031acec1edfcdad3e85f3fe907265d1ee80bb205bd9e52e08da9931a9bd58c8857f1a13a8ab983d347e2f9f3e7b6a5ce67b537e68618f7c8d998034b8e09e1b7df984de33c313ae4b5aa7bcabfbcd62ebade3119481d920b2e2256f99dabfedb7f9bd380949b162ec64cf8ec54668894291e8cb62575927390f17c3df4384442d8e088a48da3e1b7e61d430bebf0382231f985d266e1809364b14914d2da2ad5155430a27611f9f2849f4f9597012a74fdbb01318d3f1b8eb98cb83464b5a91ba7febf1dad365acff257767d1f595ea1c4bdd9f14a7affad98b643c1def9acc5a64363181639f75e4c4795cd8229bf2b6214028921a10c06fb2a3318efe12f3d038e7065667ceea499c72a60a804e6d27a2e7db339488345e4e5240bf5816c67e279dccff827ab038e597505d839af6a66537e0e5cd04d0eb0827f93a884d76f2471239e918bb103e512b9a453cc4fd37e534e235683bda8214f2325d0b89d92c0f097a0f60cac30617409996ed64f26d2caf0e84fe27eed100ee5ab4ef9da549fce10e4ed2f1223ead226e8123dd252dfd9a5aa1ac16c9cd5bf4d221202b1536e9847b144ed89381cca82b65d574321ec8850c294d5e844a6152a79ba028ff07e395f9dc2ba00711e49f52311c2cad82d1790b95b959c5fd093a43597e219abbca6461ed229d9918fc17863b5c019d69966ff0d6f8e1be5ca2b6934848949a360ee65e501a98950dab8fd081f4b27982e6c633c94a744d7f3518e90e15854dccda6a6a0a5f7865c3ce9d252c73b4e159a0c41d58f466e1b0df7d1bf07d0f0dd8253ec791f9edb96b144378bb4e96501a5834d5343e263aa8fd4d00bbe1dd621b87cc3cdd43b7fb4cae20c183c67ff3ab1f0b81dcfbc8a4b014494bb0cb6d4257d66fae704da659c07367faeae30c55111df9c8e8e1cbcbfe2e2457a27fbf13846f1e82aeb0179988a5759034e0c461da37d1aef971e895198dc94578ac0b2178787719a8515292032e252b86bce8e93148837150008e2af3029e0c8c30dbe3b1f7f2529cf849b5613f036b846f1e65a41c255275062b35cdffb843416c518f6a4646a3be8505115840688988fffdcea39d1c4c53c5ab21aa58af1d8a9ebc7cc95f667bbeed3368487966da75535b57f9cdc027d6905777dd634df2fda7154315d9a8a0e64ddc73e9e99d26d2794b262ca436881aa0f5449f7b14480754c94f44b5385485818bf2cc63d4daffb6be9fbb5db61d901d0d931749cba1bcec46d5e7059db43de33259e091c39f06e4a85bc604457adea8c1fdd89b1a3ea79f7bd8f3699eb6d68f94567339ec836ab757874b9875aba33e92fa6300df882b78dfa45c1a1250af9dcd4ac5c105889f112cb048640964adaa71a5259d4862b0ba2865d57cd94c426c4d75f2c3c683f2ba5b1eaaf6efe40bca30d624e8dece006c268c40ba951b9003a3fee1f0810f8e010ba7ee0c9f66131f38e7e2124a43ad6f9151f24e52bafe413dcb926f087d06f5012978ae2065d0e1e2eaf977c81adad633eb20c0c81bc587f394ab10e5b05a57f28a48dd889b9c0b6bd74b54e15efec6faa01f65bd47723e7399bd5a981d5b272713018a69d39953826d92cccfe60fd9b50c7bf80c24dc1d7078cf982c0d8c7293c404e74cbecb016346cea03164c7272841e8af5987b6f227d94e2ecff255b34fedde7bb8ab838bf14d98185354e64ada3d14ab1781843c076ccc173a97ff0dbed982b12868e74a832f2bf95fddd90c4d4b072b2d545360a72caa5cfb078f8876d8626d96c532ae0c222383d9e892d570449d691fa991192bb1c938e9408cc7f7b82602b14128bd50a1d3f5e8741f6a8e98b614a5074fd48d14cd9d084d651c0bed5ac7f2686a21ae4e8c5743c42303281326a8ecca9025ec99ebd920a4806369a1cfdc9ea9c80b68c95d5be7c89355f4b5df7e2ffd66ea71e5eac13ead6f9cb96ef93e7b89ddd5eb78ef853ed20073489163a3f01ace36d6a4fa7a9bb586bb74c89597b847903c9042c185aff84a3a3fb3a39808a881d62168250e1f625fcd51bddf29f4de54e576dce6010b19d24f64fc7faa5eaf75f4b1d886b63fc3200d4f68086a75372a77564a977768a825ff8c476dfe82b1e34c6864bc73d86a791d4124438a91c8e5a9419b25f16007c5c2e88e8cfc9eae071dc7227fe792e1d81ffbd0de0c907f02de1f348bad4199dd6220210a6e4c3c5096d5ee2fb62f3098617fde2c4ba8938bd99f7b44055a34241994aa69f9fc0fe6eec370cf82d19ea607b5a06ae0b5f45b15d70baa1b98f03d79de1de60a17e4ef6aa9886e74865750e1321adf3d425404e5b8d2abe601e92960985fb0fc0aba9c2897c91abebbd96a462500b365437bf66a544e516293ef17bfd26ac14e0303b112f667a42a98cabfc83530f1f90ead0b2b038c91371c3bdfdcba2e5a6016a4c8921553af75fbd844a725ff686d637a3a6a2c103a100c0961960cd726125b600da245d38e88a47afc4c2d5071125c3cfbf16b78f569bed22fb4da9d723042c16dee88b04487c7814ed45049dc5967679b8d4790c9d586a8accbaa19a721a871af775190be934f68c65d1d949762c77b935967fa5ab2b6f05199e858c23179b90d7d7f6ed7de0c68f1738bae8fac335a35d3ad077f8741e337e337f17093552403ca7fb9a46098cd57fb377c0db3d1aeb36ff81bbfa53fc93f561dbff5515f8de73c5ec5845a71636a52a89b81282341d77672b95b91817b7cd64af2a00e5b0242cf7cb85331e23298c608b8228176a2fb7d583ea1a8eb1b9e7b6e1cc8ee827cec6ca1d1f9e721a62e39959e335afbcd5f9ef25f44ced8136c2f4c15073401b8543ec4957ac1e7e46aacd16e99424cd6d057eab9a75b81c98c9d728fe2c5db3288542a20f291a460e61cbf67e1d7535bdfaab86a2b4de4fbc4b2bf69eee96a55736cc7f4cc9c3a27ed9159fad90b465e4b9547002f5dca05ba39e4a62c35a30d172f9df9ef4343e59d67073d39edc9834e4be9ec588dcaf9b1a1529b95ae4a38e45d8c9d7f3f1987014079d117cabf331d089f96263bd64be4244c4b9cee482e46fed9002fe0dc8e5d0140c3c81bfe315a45878bc96f57312e9d7886af0ea0779d60064d9e0ef899f454236f90705730cc39db4f2eb76ada6e9700c9a639363b4a46dc6d9d7fd848ea5dd57d16c3862218ffbe261dc72767d8157fb541bc777849d91d127fa2288e83f2edc0dd5c8feed4e6777bee8b6facbc4b4d9e6fbaf5203e34b286c1f77c7380f8d64d8f7987060c6256482f3ff5297181419a805b951403e5a6dbd4d974db42f8592ea5c33ef1e25f1b0c594f3c2ef852f911abf4c136b6a95af566e0524c39814080806e2e20d0e3a6f5e8706e32e1938a811a6411d0bc98b1e7a50b61b3151abac70bbc8f72f34d03e13c5619cc26dba8b192e4e80e5f339575d10aebecf8d3ba0da8dc2143ff187a24fddde076896fda8c97d680620b4168b8764360480999b43dca2a9259f61a7d641173188c8e1e0e6beb6552854f789a1fe999325f0e3844892909fd5ab08d41b7a602f6f4d60f2d8e5adcea51d60f89be9821562036eb62ddd782def8c031017feadbb3c1635e3443875c8f258f08ce0ce0ca43b6a7cb5a99ebe56ad00e522af4c3cc94a6111b40f378d5bb99f3bdb13d6151aa2c8054264437681734ef035a472ede80b9cd3ca8516acf9154ebe50205d549ca862140925866cac412461a0ae2176ff48b65eddee54d6e1c00bcb439189f06e94997f52bbfa4eb49b1a385b9e9428d5b634e596ffb56b608c0bb9b9df00d0014124761d45db3d4128f41dae9f5bdadc08c1510a463d2fbd9377455ebb87a011259a2e087459f332d256a6cfe186ea86f241d9b97b528a29505c9accb815c7ab8843ef250aa69ac1d967d3c448d1a2b39420006edf51b45b71cc1c2f40ec46740ff45b49fed8dc15e5eba4ea6f218dd31a6ed39f360e42f23578f155757e643b43b32084a2e3ad7f922b1f024bc10c59d5eae12c2fa45dcd26475960dda2d01ac4d1c8d76c106b2edf7b0ca29bbdda071eba3ffccc5833c1835b060f92960899724cfd230ca6c5cd5f44bbf354b1c772f2fdc4bdc387e0e27723a9c58f8371876ea0b166f806330b0b6bfda5a527a4ff24ff2ceb62dee53be9da3c1d87a435b6c2e1612e3091ce4bd20d630a3aaed033b1f77d70a90334f12c00f60875a5bf2bca7c4735d8c423372573c61dcaa1868b790cc5d1103ce296b4c471897546f33fcab5e5736e468a7efb38678293444974549ba83a1d311af3b30ab176084c13abe818b04b91d10c0cc0639c5c13751c7abf9c3bdfb5fe195b18a6c53037d951d775695766ad7cd41279e3caed4c994d22f372518977c87559c43988bf87d984ee2fd64b4ffcadedbd66aaa477b9d67e9ef823d11cfcb4faf3557a9555637942068f2a1773713836efeb91bf839f26aa4ebc7d4a1096b78c86f11ac989153bde58e7a74752778f78d502f1f12903ab875597ed189e05518175e7b5a7972d7d762402b33a445fc49f8c83db1b445881c60c47bf9cbd010e027f70a4ad9aeaf16ca1e9a6e0adef95cc99a784adaed7695ac98a963b9a8845088408ccc75ad459f303aa1afd6b115db7592de29f27f744eacae4e962973368a9bf89f2ad40140b7de527393c62808a1cc8b50f25b4e1cd117b7395a1a390eaef18be74d7f569d167f97487d8ad88aa72254732e1b222d160eac08e292a7fcae9388eaa8faf281113f239d28c8a1cb026935165c32c6957c700b5b22071772cb476caa62fa17e08193f2d71f9ee2ae2ba7be29f357d2935c912003c874896c8ecb9b9a8c77ea493f19331ad0dfa04d90fc4c15149efa8195f2fc52acb04b45d62b6e926d435a71762757bc330fc3a40f52b65d81a7719655fac8d63fa6b8b64a31e424ce80a1990da7a7106d4b94a85c93eb33c017cacfabd4f3f7b9f1e5b2fbc2ab152ef9dee356de53e4c77985837b1b7fd728fadc637347b3c7d9827883052813fb716f80a16000f24e2b55b361ce6c71f0017d411898936f18262c8fd91b355d7ace60b9214489f9c20f4afc64acd4e38cdad44c507f15723edad10ccf40253fc3f2fb7e9ad57de61a27dc330de185312308206d2d19d7e34ee52be6202cb448454b902d6c663b1ec4451ec16efb798a28c7155d30ad4ac65f56e489f5644a80ec81c78db4cf56012b95febc09a906fcb63c29fd349f3245c38181eff05b9efb7b2cb91d979264d83b1834585458725299557824adae972544afd854feef93e7ace201b9f2f370ae7331b026f9f90bfe4e0d4d133dc020e264e13bf9cacabf78326f7201e35a439b5faa1adb24dd06ac02a02c62d59abb1873c15e925f0383766d001faef043053790512fb5278da98b9b1927668e346f3ad3f364b9725bbfee4038b45e691f90b6123a7ca4941788c46325833bb38821d18ccc783781a86eb25e4b29494dc07255ab5d21e6053659c91615f649758d9fd3a15e5cfdc9c86601a611f2c556d9208c7ca7f459cc086e1897f0de0154c0a670f1f9f6237936593bd545f492682b17f1a859daa6d648d9ec491e841792d82c38c9cbd4b277fadff1fdcc2feafa5f0256ee02d9c02090dec3d2456ca5ba0d8df43d72aae1b893eb84c24160e597bc7831cd857550ea66c47a4a59a8b5e6866b2f09bf15a47a4590a5339e9c1f6d03afcf2a6273b7f9d2e2b53d53e9218e2a1ee567e0c62e2b770751b407963c4c428656e9f559b1f43cdbae32444860c0ddad84949f04a14e019cd60a48be58f53e605d504e73c4869ef1ed1a0d7a56e5af601df6215099b2497a287b915d901f2fee76eff6b595aa2ca1c904ad0dd4bc4884d91856c1532e24fc626fc22c46415dd09e99c6fc3c6ab87e3db255ef4800eff353a18afc8f349642e73774d00e82e5b300150e875868a6853e0940c8b5cdb989b3955357778b5e8800cbafd0ca336b66bdd9a1ab21178df7b5ad5854d4e727e67fdd7feaa05c7aabc110c5d80a5c2d134509c865fbbd0840d00091e9dfdea3e1a14fbdb227a43b87e8d61bf2ae66148711b9e29c6f92f282eb1b7c6f97ac16847e88f18e33dd95da60c5a98158f14de718cd9f4d3eae3240164708bd2f7dcec9217ad0b89403534999f8beca652a1f76a9b681d682c72cc115a5adfe3522be1cc04846b0edbe3842ae64e63ede12447690f221e556e0680024f41a2778d9d53aa490c9daca378bc946e18bdad71cd4df4f8bf9b2b80759f3057c260e7f5d0c7509c4fbd0dfab276d182f724c47a28fa546cefc2c46c46c5ac029118522c0c4e50eba1fa2f5c671bb605ac0e5a390984e548ed25491e4ea467e61b3bd967be6e1bcbdc956a6afd2d6f184c0d759052735a9f50b9de1c8b1c9bdeb10ef79c81402262924aac9e487d530073b6e848568420642697837451aaea581a9da9d459eeb3b4aada8aca070bf8f4692f57c4af5bd16175aad1469a7bb0db48c3669c3d05f5a494c6a3d3bace70208dfecb38fbd08eaa186f5feb0d820dccc48aed142c06af148548cc022abc97ab084a155a57536e43b7fed210d9541b2eccfee9349bb1cd9dc1e9ded413a00c0fb5714b4dc720069983c8590f01ade00f630750109efb1171fd48572c1a99c7faba4697832be2b0b3efa1c20a637cacad25fae64d02e471b26e3d99174f5b3e128e50dab3a645c64e1d9ac9c9f570cde7cb7adfe2569da3a557bb3093976d83246137b6c725d4bb7efa87475527ffac727ba12239805f1127cd11dc80d2daaa43f41ea324afc6bd0e241f343935ee88323dfffe21ff975cc434d81fd58ba3112f9e6ef8fe27a3f706199db842da1857c2a62cf729e105b57a29e8e20bdbf6b4f4f7f3fbb9a27d541f233af061222fc006bb0b515b24a4c6f0b234e29a6242d2f159c8e677bfea96e87388e35f2de11e9e800093fc35b65cd7167c105a6c89be932702af787dac8c22a2ae63def69defde123f7fa82cb164859305cbcc9c3eb4d4de2ef1a80df67d6ef65a6a242fc29f5ab3e91c9de38bb9eb7ce42724889878a07a9c493004fed07bdd260ce2c986d66417c140edf12e47fd1351357cd97ff5c46713d821637db6c8b6ca050876913ce09e91297a8e50384b9b94c9e022488a1ba06d3068a2a61e53b538bec5fc244ee090e86823f62cd2947f7cbfce942cea3d02afc82847521b7cca5855794f461951ab8da2d0cd33788a7faa37cceb3dbe4259a2f2782643e6be20fc7aed7d954a2e7c3a3b32a36dcb64815adb2e7ac3c00e463b93bfdc39552a54e1a818abe9c7416f9bd43ce44cc4bae4fecbbb6ed8cc812d4fe8f9b97c7c99cc4e68a633ea22a78c709a420e2440145c3b81007987da481393bc404d018db243fec95be22824098dfb266a50f2a54d7a9143339eccbe84ce95ed934c358412495859066180f79575316ad49a7e0812a0c527a195034d898ec3e9f52e45da652e0708c4de4fd30c955573b81a0a84ff163888d91f943d3b69c7cd4acf7c2c5c577ba5bc369fc2769aca4e821e01f4a95becdb98df8ce6e48fc6ae36e8b5b538129ff7bb9654b8ddf91624a717ce00d84dcb22a7065ea61c354d996ab16653a6e16455a6e797cb31c0ab27edeafeef8817cee45f7bfbedb417c4f4ad7cf3a1a89fd4cc18f0cb64de1c7fc93d8982c824f4132528b1f8bc83229a159b729f40bc346878cc66414a2ac95b53750461ec36e538e59dcdd783925fb401613722ecac1b5cb148004915350274dcdbf7f620e7dedc25e5117af98a073880d513f0a49dd38f3d492670b1cf496c4561162870b0534f0f4499c05fc6d77a9d1bc07a4e2fd6b324647df549686ee2e4b5d4c2962cc4276fb18da46f9949fc9e56d4c179de1475bff9d149ca8231c4d8e4d682e4515af5f428372357dfbc94866e2f2b6c7fd64861fa8f00f4574723fbce3498588f8717fc6c9ac4c4849604319447073e442567a79a1e81a06e3aaa215f69db4441c7341569685ff2b0158fd650d0e53a65b814548b483bc027651ef7021f0ded12359a993e14dc311f5f578c85c2b54ef59e1d8b18ad3444e565cdfc8086e43731d3439f8ab616051013051d01274bbcc6bf85bc49572377856d10c0e7c127c81eb9e5b05c5815f904eb50fd0b25843aa9d781ec58fb89ae0d2cf013606a6e99ee0d616a8258dc026bbbcf6925969edc8717488acb45b42d2e116ac5465930ea5dc737e9ef9ab5db5ff0a591855296265350bba661a892757366e72a5d577ca523326c734a02e10831ee0a0ff5f320c8dc02af713376e967d299c83734547c9e215e243c653e6eae799364a1bf0ce917b324aaf981740d4c9fd92f485ef18d9e4c92ca6c71c7bcb21f0db1617e1779f7864a5a317a740d6f1d67b0e466efbc32f880eaf008842e229027f4fbaa7d636cdb155e38307f1f1ece9e63fce31ea2e32a6614e1edc984e06ff5034953d2e1febfcb8c27e996b7584aa474eb362803908d86b4621e9ef043380566543e0284c728743e05f0848869ecf214407a08c0dc0c9399902a368e2c359de5e24a6f37dc58fdba274702fa76cf329c7b44c552a340f804e4b45ef0bc49d5ae69ff39682e52345f8d7a7c1a33e3a4217c551789929ab2eb22d1c067b92e2cdc1cd088aa789cebc86b8f944d59c5fedaefdf7b009d0c5237627b190f84590472abe2dd6796d0025d1cdbaf713e1cab2c0a6f0c5599017bf3d008097109fba351ecbb5ad2b616f5222b29cc161d2cee4ab89bbe003c13604fa6b42116d78b561214994fec5fdf1369056bf10873f1c3a14f42286c23bc81bf6220ef95f348f46c9ca7d6c0496bef02f0881d53cdf3d38beb2095aab9d5bbe684814c0c817597b40e6adb2924db5c98674cd755b44fa2e71655bd773826c8a969c8535c86984fdd2d7f09e62fdae609b046c09a5fc5bdd57b612ac83ed96edb0f8960393e5fecdef2f9ef59d32213f347052d015fa1e63a46d5ac5a7ee9c59c999999a40f419abc77ed085979cc2fdbce579b0cd536e680f5da4cf6d255df32e104b5d6db7bbe137bac6ea566dbd54b7be509344b8c9f1a8a273fdd38e5b274ce4951e8b57a84701dcfd5a7c36a8c55b155a293088e8c928a79d5527f19857ec81f0897dc452fea847f191f7d42eb88b5fc08c7eb81668d5f0f1de8676e1024fe96b01f2e5f3e37bbefe00065f9986cf39af6b55e5ff9bedad17b9e305589bc8fe734735b87ec2e335a6e2c00bfa3b5bd8f5b29740253c816c58276741a0c12995c019e918e5abe2415bf3c3036897f698644c3545e42d021c3a07fc950a82178707234502c7f085082d97f27bf4fc49c1a67b65961cbaa461419aa006081f897720ad73963fcfa9bcfe6d4f6dfe2f45d77ed5a40059e8dfe3a8a4aaa64ba9c3b5d2214518dd3f6656a9834ca53c17fb3ac21e65f831eb2f1ab4fa9f442213b838f79ba7f14b5201d7d560abbb8f3dd83184b52a3fcddc16b1aea39cdca794f0106d3f7f7d1497ce2f91f190dd1609bd80aac4079d6c3f404efeee54614dc1a5388db66f48598d49d1ddf77cde6a079c5994b3799214e27aa8c2773046433dd0a9aa9fed4e13c20e78dbc13250c3364874e690e17d29788369d9532818336f6f3f9d3bb976718e4160b6034236d447dcf534e419e540b6a9f1adb8ba6fc2394309eada7174953706aaaecf4a7bbf138d73987e6688a373700e4613419ce0d29ac309c136de0b77ce59ea134e3be7ab478ddefacc2423de9e41f5b9bd256aebdbce3d0617039b2c0585abb68fe8d5696c96e38abc55b7d0f2d5bfa5740230ff012483fff14c80350afe9f9d8a93b763d0b4f38bd6011e0c52aaec027b1fcbc8d93cd87962d2658d8925e578aaa70dc942cec3179ab94c41f1ce342cfdef7821dc942917119d76a0f2f62c6f4600602992c1a42262b0031533dc45f7562a77d89ab319b2b205c80ea0039f61df0de95168ae49f8a4f13834202be5dbc723db0810558e7d33a4b0d4441635a046809fa46f5b88b8590eb099474c942933db3a3df9b688a71773ff1eff680e48088f9f491cb645b09c9c2546c01ecb7fe20f9609b5a83e0e23dde74b8cc8599ccc3fb6d2216a80e3014c8a488a0d160895d28984ba0304abaae8775f82b7408d0dd43f94dcd9463bc8fc21f8481149b33c8b45a5e6566c0def8ccbf97f4611a7f529057d4f64c0df2d4042072038ee15c2bbae6a8d63f789a2e2c5bf003aea2240cd32543e35b2dbc2ce76a9e9c5621550b48bf9c1596f00c59aa4a7d286cb46ce5d6a1135ad6ad80b6889fd67090e762f99f8c586b0eb2292b4fe994361698c9a4fe05b980e9d7565aa740e4102cc845a01aab599b24ed341d134b63d59e3e269927af8a13982a96178fa90d1309ff8e81b8f1301e0a6a76d70bd7549ff426f25cd6e78c13da63ce2862149a9425c0cb9016171f9b245586b04b6374021af672d6ac6d36559aacfc6e01f455355bb1471358de221539d762dfcab7b5caeae681dc8ae87b28cbcf5741cf39928a4e16c94f3c64fd0d5b1fc1c696290fe058dbe9d0a9566692734b278afdd03aa54ed18a6af7890a72983c126d2a1f643777fe5cdef1a3c65ab4ea0a987f7988afd8ce189c6f698656da5f34e9cf830c91cd4d79d58640c5fd0a8c4872b9944e2732f468690b740e61cd1eb42038b78e57c826d7ca39ac5db2cfe9e58f891c5401b2f51c3326118ef26c2e3421fe497525d0cc0a1dca9d8f4e86d47369840ea4e41b3e1884230a5d814e40511c7bde1d2e2b4ed91852913c3b98f69b4329663f00bf8ced8e158ad6f7db7126e2875c639b15359bb4bfb8025edfb7c73dd21f8cd2645e8eef5bf2500e86bc0ae9b606c1fb4da9c4f7146305678a31240c44ba76553726b8210a46f18e8c13a2b1dfaaf8beb758db50e8fbc2b52b7f63d51bfb95231b3de89cb0aa2899f7f7faf645d5f61ea2ce2609409e743e3525c9f7623c333b178d4b140070195bd4da8d07a14c8513f73556be9f6c3b84f0c8abb3fcb21451a82a4fc82c82e6a4e078367eed3d027e2a16f97e4cfb260dd9e49bb336cb856023334ba4ec27220b6e45fd95a8c54d1d4bed35bbe5b94972dc115a3025765d28e101af4879234fb646bf69a6587c48bbcce31ac7f28c5be42c7f530dfe51e2c1a7b61fe62a41dd6b43f3f02b48d9ddc1c53e00467efaf040f72056ed23c0bbba2085aa0f9ba01aabf9c00f04e2ff554da8f22385d4d43ab81eeb316712b97ef1700798059f31c2efaca7bc716784d2cffe49adf316c1ab48518160506556d0d01feb102afc032d6bf56cdcf5819817d02d92c50f031b0662da546dd3735ec7d4e0e1102ddfee7edd59e2094d4d318ab34eedfc6076c8d9f84b8b90151ee3bb0578df342280ad3adc0348f82427652efa3141384d07751d7e9a409f3f730a7587b3863deec50db1a6d035fabcd5836d2f86e8ff86848f9aeca61f901224420a2e650139359b0a837c047ce130a96e665954b34e70c3a9b2bd9139d37c02fe3f2a4c9f5978e9a0ac84e3df3572efb63fc626b7d8766bc28a0805b5b45e0c635dc3f950885facafa4963c277c4704798a568caf0af2a53c650a5bf1cc7234ea237e24a415e9b268f0a3af434ba83dae1b2962e0920950589c234ca2106350414280d5a128a083cbff0e0f84c174b58c58c48413ea1a29f27d0a15d571cbeab64d87679e195532883d8af90dc490f657b40a1cf3fb9991f0d60dcd6af31688240dd73ebbed6f6a0e4c02273194e8bfd7e17da93cde2880c5d88fd9782c47092c951289b7ed3e27877349a532e1abd9c5354b7a52c3b0d47709a1131b61f8827ca7e174ef826bab95aa357729a49ce99716438456f46c4c1bd15c5355b817e28c5c667f413cfc80ac298260e5120e741d801d25f62061913851db197b4fdd14a2486502cd00b000bdbb242627f85f61dc06b1e6b65880c651dea016bb2054d75c0234bdb0870cb0fcc4df8a13a56252bf9aa05e777a1d94808cc046b41ef8932b46a26bf994badafd2868950032fc471b23cd1156f9f5ece2494322ffc6c172b6a9c93de3cf89e09a347eccb5b864a262970554f87c4a32ed9c2261c611a2c5ca6c27e10bc1be6a52fe6373b6e106e2f97b8b8da17cccf9e8adca07b8f1e1f5825494c1b3a6586a458475fa88994ed65d917478e9980c41907d4c1df656c9b39ab2843aa1910069f03de03f7c3b7cec4da0f2cc20c09d741bf72a2a735cf6d293ae43185fab5987a583b0fabeb2cf40d0fc992db35ba608c0cd58bc53739f810dd63f572dc9c09362000937b7519d0d1ad44996cd3579e9b412d31bdefcd2d9a24d34c37f3c77736ae8776f8331d556a35b57e0b20d327c7c585ae02d321a51183b6ef25fb14649a2fe82e69910719d1f10c8d04bc61638cf37b94807dd77f41d3a24f737f402a5811f57fb8efc35fb6869e1e90d80443023bdd73e099aa536c55bae0e4577d41ccf3c8b19e55f5766412f79209ab331eb6cd1c3908288fe242fd0323774b1a997b3487ebcc2cfdf7c6b37cf57a5071855b3986e7f71b80b05de0e55e77c325c1e7bfb7e3d365dace145d70dd606937da94da115aaaa1fa38fb2326e27d642acc40b5459732096315568de7671bc42ad6e5f6c47b353a1419ad64813155f8c6fe71ee2276f2b16085cb9a9d4a8fb5c0e05030a6883beec6e86e7f312975bfefa51b73a3b80acd0b05dba45c8710f0fefcfda375ad6af4c0186b2ef6f55fa03f55531680bb5ce070f013fb7449385007766665c608dbac1953c04ca962bb9a8631d153b2fb4297177ef8ed7021f5e27e9e1b8b413644e3926d073094494e285372cc93e1fcedd2788c71fa6b7e875f2fb0738d4534412483b4712c35eaedebfe246fa19695eec9e647e463d08ae418a0fea3c231605e1b8b95b4b610231b7c3209fd3f776cfb2c978af8f0d8ff5e5ea026a00a6f8af90c9aeeb335742a49147623c1863a54f289aa7b7d33be7969ff2cd081162e4eaf7bd2fd8e330e8469f6a570cc1271666b0e4a2c82732122104849fe12a2421e47d47048efb64290d9a6b4253fc87686bf9af87abf01a58c04059fb85125a7d71ece53451c83cb4d2f4217cb9adbbfa77961b568aff5f044b72a483825f53c394990bc64cc476ecc3c62988297621bd4a220a3b341f702bce6aa1a02078e5303ffb995be1908610c31d2a0028c699dda19e45fd0fbb0e24c0b2d5bbff902200df3af68c875093c8d92b58c402344dfa12bf82d2a26a8a8d1274e52f0954c1f70c4e48f400301c53592969164d9cacce31ed80333dad8a723b179d3808d60c2ed8cbf60bea2883bbd08e1e74c56de586f60b41a0b426fe9a787eb5a7ae9ea9be3ded3eadc5a2a34dca35537d91651e239bc993249f37836f0d3d02e8129bd5fb2cdeb81e92b0bfc3bcea0070d318ca8d307fc07ee5dab701e3672babb1b5a0d7c2ed919388dea734afc668bb9e2468412baa0405b798942b9e243f04ab292192146ade2017d9c3f8084ef406933378c715ffb753338c85571245377cc5237c4acca7c60c83d20f970541ff58c4427d2d2079aee42b537816d931f80225efcc84dfa0a58816adf4f762a76e712ada0acc5f8785683fc16098b5b6ed7f544b85a47751c1a197b638bf55f98462f098b77ebf0cd86bbe212cccad253ac612dfd4011f0b578b1b8fe1834a2390b3be12914edc0d190e5f6f3a4a4d25e2eb9106f27e46518d988c6812af68f2ac7077132871fc9f0df66d810bcd996de06b07a469c09ef3f23aa343bd022bfd48f1826dbc2955ccf07ed213578edae14576664c1fb38bf9750647ca44f0f3276ff0d9e4146237c6f44342576d6b703ccd8f4c39c2be93ab688b37ee4dfb502bf3dd889ef0c9106af0909ed781a9e0bd65dbdfae4b964db0bd6eca745ec72e75ca1714a75f1c4f5fe99e67309dedbfade698e136d6874d236b65c68bb64fa75d74ad37b8599c4ba916cef5636e01dc5278e5ef4dda947ebe34d61fe081522f87b3d307889f4bbb9db1971143859a81950961a9845f6d900be04d2b67d3fd6142574a9fa41bb5d9ec77a31434204fadb2aadb6b5ef2553da49870ae87ea1815591169e8abb7b61010de62b2887dbc9516cf2450f48a2bc7a0866454049aca9eb8c150c72c4cd9cc54b6de4f1041e0586643e1dc8198520ddb83e8d72ae23e5ba5ea887e7ad8fb2ef31820cd2eb4cc09ffbe8411f254b05bd4dfbfb256477c8d1a2d28a5b10327f0d314ca7a04a091a0a300e9433cfa57dc99b4f9d73ad2da5e78f88254357b9663425a1ef5eab68ec625c5f4cdfc62a85fd0a5363da9b4c933a73210d0c9085c9dd8da7585eee82bb59176dcd28582863849912c41fc2f7bc23c77c028be2d008240f16dca03cb9af170411846910111ec61994238115353bcebea456423657925fc87f27449194bfd6fd48e85a0673598d85238c4470e6d7369badd7c5ccc1b9a340f5fd9ef1380ba6648665ddefc7af1b0d5c22117a7cb815453df1e534bf3eb613bed70f5526385714d09cfe4beabd256a37872a4703e23c8cf7c51b055d8b74d95a714292aa012dc26e5fc40aaf785b88ba45b7067c6e2915a7019bb882edc50c95b2ab812f077052b5b34485294a96f4b14f9784ab46cf2a1b1eb21c46de2c97994a254bb6474b6aa927d5f5ee734e91813ed2065eb324cd79962e8d487c424c80b64b11666435aea2e626f1d875e03264c150682adbacb3aaac8eed7d62356223d19bf559ceb05d0b04c8c7bcf3d0fbd98a70e1279dcd8e63b30feecff2c297bd6ffd0920de2d81ebc0dd6ae6f41b3530e373af8fef3edac8533ff6e728d80003a7718de3fcae386ce9b506314f1d7d6ba02e69caec727307dffb26aa0ba4f0b34fa2cd1fa6d10f9e8a0a1f68fde503c3ce92bd502ce72a60968b938f553076e91944860d1430237a1c2b75ede60fa8cb0b651fcbcf9961874b1c845a30e63a2957146840c76e2637fc9c224bf18a1f3449b6d0474af2d8095113c741426ebaa1a0852aed54641a7c679d25e22f9feeae8be3ad283b1247ba8fa1afa86351c8606806237d2d9d0a7d4e9720a1d0bd498c0a695fd1baf0148061ac9273fcdc0091ed4831c559d4aef15c9edc909d4e25be0422fbb7e337c8a7b4a1f452cfab5e7a43bcdeac698e5add77179fd1d3a06ff481192f821f039cbfaf1dff4cc28f4169ba60e81f949fa6e1581de6da040cfc096745250c8ef198157e70e5fcab900dcc5aa355f6dd8b21093a71851ed06d5808eb88b6d6ec3cf2a34e5e1e7a8b69c53c6590bc7a4504ed125304e5ba643452566160f209d7631c701d3ef24a03732f5014f3c2eaebab1f9a552c803b347bae95555031489fbd451267a5facd80d36ed79eaa54f4037120d3a19d7d741c7132f6834cdb64da7e1bb82896ba7c855ba77dbcf641515a6b93143e84f999790fc6e198c20a9289be6ac1ca5bbdcbd96d883f54a30799bd1af70d96c2ea026a52dd46e7ed233e7a5dfda7a0f74d4e7686a0610e667f1fd45051426f459fe79261e0431811426e54dc66aa56bc6d27ef42db293e12510a1998c1bf1b7fef42cc0e9a9eddf0d6c40e1d7bcc03739149737170aae67b291f5be18222e958f998ee5b13085ad7dc3060e9e480f17ca837172b6da41b50a734596d4efa3a917ae4de355231b0dd854ff0b784cf06a45d1d54ca16fa7c1915c04e4d3507a79ac77e6bd61193c5d714c95ce2e6f2630694f78af136a46abe15be82636a014f62078762ede70a81bb5f81112059e78b18f28dc375df1ded9aa7d856e5b319d8a34fef03dd199250a941e68792322eab0404760655d41ed7612de4855060f2cb86574253fcee49efe1d81b41448bb1b4ecaa260f8e171e176fd69c047b7b8e60a6988402b76db0a1e10a5e8de6740bd2074fb5c3b9b24a69012c77bf8b1d79a76da8990df1073f1b58d9e1cbe533aa2619d6d7187b641fb55a93f782b6afed9ee9e6580ba67767ceff1b066d7e98bf9f686f8e9ffa148dd436ec1330c8eb43689868ffa2a953b5f71bb01c395512a37f70c074948b8b3c0e4a3c919c93cd97874d04fc59db3d37c23eba6ba5a8a9524fb1466a0090630abda15ff92a33e69e49a1c41744435a1a47e468e407883eb43c5f276b3a5cb9b902d4ed1d577ea9f5d57749fc790d5338ff840dd95b389605dc0074c33832dc6c0360fa6d43778c01ebc78ac2ef63d7b9736699af5880ce943ad3be8b692a4fd3c9836291f975228055a400ad0b763a4df929b601e657f81db4f9ec0bfdbaa04afd23d47fb2ee4d611577de0e1042c27fa41fb7afe7f6940b426b9860b96697d3e0570e13babcd4ddae4ef8771bd1989025dd87431e54b978bc680c90eaff7276c54ab2f0158e6c935b3061398d602d8c10a5ca81c0442fdc4ffa28b01de8fd3e04d21b7c08faf5869a98d0df35f4f1044a6d627eede3cd7502be45d9067adbaaba8430d57a91c847ce24d34ef31dee5836507d2980a34a5f3cec2191bf5f90ea7254fe54297c4f3614bfedd2a26f37ec21d60a5fc4bc0db363aedf07da9be40c9e921409da450621b1e218e57657d062b2b52abc4b1288ddf4894a77b259dac062ef34e348ceaaab96643f7db5ee09b2cfe65bf9461807d60b48ec85946d9d12b354ad37ab4e3efcd42337e5733cb3a1c43199e777df8a042a441498b3080080466ca08c79c2fe15d3ca92e4a4c6f7e382b0cfb65efd88307169b19ce3aacdd3920b29d26c2c41f54bca60883454287d4761a8bb24015851e82adaa714055f921a8455ceadeef926efcbf6bb1083d9461ab77b2ef2cf36f3c3e3f456b8d4b1736b4c0ce49495dbea222be70798449fc2156c549e13ad57e71185cc82490ec8fa01b1fda9176e750eae8616cc44e991a0c9733a8fc015d3d17d8f465e3a68f1d82ffc12ef5c75ac0eccd818377a0e483dafccdd0df31d58795b01e810d96688abcfcf328f458740f0bb8482d62ca2b2ef1567430adad4c625c64824c6c44c2c59bb856665b780f6e583f699b333e676cc7882e19bf4d7eebf3f83a55be50970b422ed8e0c75d0439e7d7d0104e3e1bce25d29c959e7f7fbdd4165a7c64b62c40688ed6d8e270dce977ab57e11119863dfaf4c94c662c3f8d0a67075363159caaf8b26aebbf6e9039c469925349beca84c425cecf24b168c481d203293cb63f147f4a3d41ee18c8bf517f6137daa8a9703a3561d1f28c03e06a03e8621307a825d9e0cc7786f8c49473a2240eda20710bc71a1348df62c81b2305b08b5c4205c63f071c29300217aff165db4e063137d29207379ef592343e935c32467a036ce19736952c5e867ec172f2724b0af84239049e276135fea624418b13bfcfbf3d376c764a1d27f8cf0df1e7f2afd6277e2fb5c3c48c83da26507df32e1c4453ba5b2416dce82bcffea173435b6656bcf3550d5e645ee1f4a980104d9b5f0a42675864e4aa5dc1f4d659dc512520b371f57041765773f00204b6ddccf0b8c705cd036b26d8bd7d53fd17355e8b0e62eb76ebad44ff8c9c36583f9725b953ff14db0516b2cae9bc1c6ceccb2e14607a7e90e855ec3d43a8c4bd4770d16e9c860e45d63ed3fa7c3ee571c117a43c2314f056b3447feb7ac123c4b6a0cf45606333885dfb473281b5c1e867dbd34cf1e6aa4bdc7976c91bec0f6209c9fa6ad46b0770d381a71c3d73766338e70a0a2bb958b67da18d56c5ade24b511b55b0529cc45dbcc7735bf3d7b9b20a7bde03df59de5716dff8711049be074fdd574f47a624de34b87a05fabe078ed46cfbcaf0242068d8ac351c5623a74b400dcc0e6924baba3d4d6abd8cc0960bb04b953e3852a1c05fcff2881f66e51eb263433d27925fe29b4ea0ff96d00eaeaaedd0d624b96cf0def00fc5497914cd8ff1f4232a39bf138318a8288023085f1fec9767cee1648c3b68befe50831901422d9e94e2a72c7ead5ccfbc762a96217d8f6bf75eb82821ac952968255b3083c9b0b99ed366a02809c980eca84b3ea32461c74885cc3b5823701e4b00df68334b8dfc14e4c78bb597d83d290575ed4d8d50c9ce583c9f20fad01e77b7c6d2b00eaaa455935bf57054c0c3e6b6d85be51867915d38c7472ef2ffdadaa08408c81e672a7c05cc1d21e00c0ca91cceb1d5715f8db26ccad8130d769d94f7baaf5f91c0ea3faead170b8a2fd03907188240716fc9692ac5aa7ecf3bb4cd7c44e0d2f52dc9943dd4f9c39db996d46553606b2210bd10e8fdfa11df4e12f786f69640ebc010dcefb43b57039937ee1934855b3b3ac2e01c0a87ee21e1b22f8f153290181806015ae4bf80e438fd6728b53dc7e2c39153fc65ae94cb1495caa81d438a660a8781035c9d5b7dcaeb45507455091888fab8582644df0a41fd76b48a53329b9fe6f4409d12dccda0959e62c6bb36a40f8daa19e99d2b506ed6557bb05672b755d2538266c67db5b2086eea559dae422be096c454cf4b8fef51f8c2ccf1b3c1d690efe72517fd58041abda1b9042ca65b6fdbf14e9dbd68f5b638088e94bd0efafe528b80c9e719f0dc867fb535b3ac7657e6e66c52fd47d20becf53e3db4457ead2ca56fd184682f2f9d15d96dc170575b222de7bb3548d2798b16820b4273ad42322ec107dea15d02e2da124278aa760c82874c015ae29edcf1b418a30b55a26559906e20ccce731a37bb6dcb20aa586d8d930c2f7c08a026373b0bbf5f93083a7c393ff63d756a29288372df0eabffcdd736ea6a0c62845ebf478a2a05937a0ccaed6694f728335e2c9b330b0fed04242c6c1c79e637339032884f8cf32fd8fc91ca1e2f0044b469af10e23e035c3a7aa8f72a5fb1f9d0e6efe6fb4add0eb71e5b5938a842bcf39c764ac12061cf447b3c11a890129a48f77c43b1f967787283b62a482961af3fddd467494c95c23b4a912d83c22e494e6d9f90daa05d5b5066da10b1da21b37cdd804f0ac5602a1b912fedc6260061ea06675948b3c23d2ed6f72f6137a727bb2dfe1cd410f229d2a626d4249203fbbf3f7c089d943bac8cfb0bbd579232a1107aa10bd4777e7012d18e6dcff6a80fc861a6addcba8af7c99d9513ac883fc9a9b872ccdb3df2aa55df4bde168c3b97aeda788f5b6dad9b7bd7dbd7c48237974ea5250717f7219b2ef8913e4743a55959bb6cb745b46a1697595c3a3afffe8fa475e70d9843b3994e7807f40d560bcaebb803a0144d516b35c9706ede70a4802964fb47976acece5049721d7e8d226261e6572dab2fd01ab13585e2a40ed1f3648f51c13fb0a51540eafa618815ee06006da2ca686b379f34d4db0d8de3506fca686b2bf957c6de50b00d1f95cbc3c47bb0dbc392209727f85098ca236027550e4873ab8f0c53c2ab79649a9b0239389ee8a14dd895136f9b4ab561412258d8e5c8f68a77f55e45c2c373134fc99783cdb469c8c176857eb51deb55212eaa29615117a40b428d5b013ee3019ae4c9af2d1af39ae3c9b063576ca037c36888473b0ec946665d3fd0fca6ca6ec0c3a06b648e926eac443f52c12e0d0a5c1a640e3dfda8c97d13daa52f3c6acdd3109ee81a6102e0560bb88f8dd15fb09d5ba9d1bdc02f377cdff62097d2e5bfc959b767483ec3ef59e1f41570a60de79c925f76b844fe710df683aceba1902e72826e67ea1fbb18a37b06d5822bfc3fdbb8e0d7789e53eca674c9fea48fa61e1ece77b35999dbb780fd3d156a6eb67b566350285630b54aaa0d4dfead7c1a49b37b92345034a9f5d17276bae22b9bf22a419c4956b79d3b691f15dffde6b6b1b8875ed13b7026eb46f4e79fe7c89bdc6499a84e11ba1ca8e7970186505082fd4120a62cb7e3024729397a3f61ac545cf99dc76598627a9f70abc0be9a847714a667e58789873ff3756cc606427a42bca6838d5e2feefba897c3232d783999b0267b38adbe5f710a505559320c4dc308ae8afe3adc8492e2667891e6b282b616182396eeb4cad2b76310f60932888fbc198c9e6c95fedb7bb741d3f477f155ff2b4c087503f8ea7646c64d764e0d87b635b0474581dea0dbc30ba369ff3b7ce46708218f580ff0d87c398f062fdd4cae782594c8e64b19fc7e0cee62e03afe7173bc72eab26a7dce58141cc2cedb22f1c728296b491aeafb518acb4e9b1b5547952518c846dc3b3e0a314e36f5f80a93f3a22f5696b8dc81127b0ecb13ac3fc0a21d1872f5496046cb49a2fc1ca8613c3e9c902c7d35105c2b5a8591aeb0ebdd2929c1d0fda7f4a137e4ae55284fd4816abce2d60b19b2468768aff706751cd709f7c3e26eea2980770e950c5e074d7b4485d131307658bb616777abeb5d09a517a0e7ae8efa86904d1cb928a7f1c9390bc2580ccfe95435238c220071deecbe954aa9e2d5e917ac458dbed49cb7902ec4cac242a0cc49d28bd370bbab41b72b0292e32c55d65c4beeaa98a365c12d22a73606e1c7d8bbf492932a479b67329a68953321fc02b9293b9bd6e3ec11d9f05ee0cb6a1854d4bc279e929f0cdd8e526acb84a8b09a71cd7cf64f4f93b336e8464a983b4ba1eb375d9f4767167bcbcc28940bf211c1d1e580b9149d345780ba5cd6b6f535433ff87ed0deabe1c98594d365d66906c2d99d025456a7a223b54501a9f9726a13f4729f4493427051a0314231644625b1905cc2bd5c86e590ab1bc83ca6fd02fdae44bb37b6e1aac9767c40947b0dd27db1657cb34c857ce5d89161eaf029264a2cd786de014dae7cbee27a7e04b0d35747baaf08287b8fcf17e0a544f5551a1ea1716a50b8f780a139542485c7331cd62ef69a150256380d5e78367c8e86aa58bcdddc3b1f44d1aed9e607c98e5f2a06898f9ee62ef7bf4c98efc12e40cbc168acaf489c0d59766b5e7ed742a49e1f49e2ab42ac891393f1a8f7e9b92237201333c0329027e7944113ecacd30e3550071e7ebaa39a161ef66ebfa567788075c64034e439cea62bfd0b4604509358ba3e9db985909b4b9144b44812952689859cf37a0b7a0a95092c81f122807b11501bcb37f54ddb3e50d5fc6a87c6bf909f1d6632cb188f0900e65c5e6969c240394037ac000d9b6a54e419ebdf813478f27ef7b6a5a85d534352bdd7756e022b47837e2450e7f739029ca903b8c0727e3b2cbc7155d2ba9bd38edc62e5b5e57faf1fbc7da9a6792201aa8cb8e57daa3aa4bf594ed64e00b63aff1280b3784769b2299957b5759f9bcc3d22e9fd767aba6bf320360356f07a3a5d6b1ce577c7df74fa93067d563550635577d84c30a7aaed99386d12d301971cc27ff373d269deb5960caa7715465155735ff0925a967a5ee6d68a9f069d6dc38f99d1cd2f383e72f60f43ed5720704e6fc541a341952416f5ab32a162c44cf42e6be6ff810bf69dafae2ecb47a992967b5c079e0e4d983a666bea30c4e2ec39ba94ebc06c0c07c78138abfffdfc8fe1c70b4464750a34d0e88a3298f93459a34a22296a57b14fc1b69af3a0915fa8e230c4ca71fa83faef2654cfa38c3168cf915ea00f0bcfe72aa49d1066258a7366fd2c3d17b2454a21da6adbd471518275bb613c3b15066a49804c166be0dfd8235b86c8071a45fddd7bb69c4230039a55d39293300996ab3ae7f9940b432304267a5ef9c38016cc5c95c279479470f1612fddae7efb1a60c84a9eb013334520df2a0254f0eb4e391bdb7186e9cce9427d63cf76c12d68ffa7f437d4c18324d828dc1dc9f1e564d39cc431605ce1b8ec552b71a78e9ae2c3e9f2ef79b4f4256afe623e29c68653b0f27e4429b906b50b19cc6510f0f0606b410ba5c4dc62c78db05261403d33db6424046b886dafa7f6a19c0f18791354fdcb33605d89fbd645beb97de4fb75a47889ae5985ee6df7c7d428e30627eb9df80462a2c30e0099affda822f3c8752868b04e043f378a741899be44d3f315387a2b3308a9f9aa16943d512676066e79045af54e6e9f4e55f842f75bb72b409838a9fe21a422116ca6274e1ac357523a30759e3b5c73cf4007f84ac030ff13cd4bdeb77920d32bfbd8a4191082afeb8d6fb3038035f7e9d89d8232992416900a6fa9ff277be00bffc38be2c950062c47839fb5b1b764e25073e6aa123b15bad466da00e3dee9eecacf78883340831446eaeb56cdb838e2797f2a1de0541e35f517546551f817e301eee5aa00360d96690dcbed898cade1919c7f16897c18a9fd1611acdf0e37066a97d010bec98e42e345f44ad74f132d2f865d00058331eedce2c2ea5ddf414bf1c228388d6dcf80a4ffd56f2be3b8c673217078ba813bf8ca2e7687601f1e619e168d57ba8891648f97d88f973e75a421abce7e4c42c6f604d48b0d66d19c4d9a2e756c0e62e51dd1d89e47b6fbb0c76757b2463c60a1676cc490d4090ee8c0f3732f75b4917dd065ebed9d6d21e9dfcd61c7c17d5e22d8e4d88436285b2f083ba79f4dfb29b11106357d146181a889ba20c6ed0e5b695ed1680df17fdaa8ee98cc09e58a539e7965f7b9f9bcfe75026bf310e0a470b578a5e58af9683d47fbc83574750209805117fa73965a0d99f788530ef0ac4ca7dd82791fc268d854904f42870e23d1657036ebb56ff05dcbc883e2b50a4812b5727d4da4ac40c7d443f028aae9e3d73ec7a46c44375c97bcb8876e0c8af8a03c038e175e6cf0ded9f66b75e799567160cd4cca6b5c834ea5792623b630735220ae8d787cac24dd58fe63b1cff307870604330cd48f336cfb32c4b9670f9a61734eb2e175fd4db587a3f56bdd0d606deeb14d41f52ff4cc4c41cf61020eab6c758aad5a89810bb31ce71c4e9141746b514fde3d27e0188b316373fcff40f7d2790f3126f5f4ed3268c8bd741e5a2e07ace9a79a3f8cd696d2aab6b11fcb17e021e1bdbdadbbd0928d8db55d331e605c066bee96265721369aa9746a24150b473a56ce757a5b442daed724d0d20b4e0339492d676c2fdc20c1236746348d1e461ccadccb68c61323d503875ad14a32c586fb412c0acfe660ae68655b1bde2caa0d0775382cf850f9367e37735629ed06249c27e832397471b7b52ea9bc7393b5331f18f6806656df2a7886a2d114e599759be155ed893123d12f043ca295c4e6efd56ac4513df7c5d484fd8fe6ba63f72e18e4504a64a714eb33fe8b52234c95e49ead62f622c39b92ca43acad2c808e304a4ca73b52c99f4ed3b96bbd70c08072895224e0240c27ea6800c87604c1f786dc24b38c4f26eca2f5c0f409eb2e73fa0e162eb10cada36249e138ec1e48fd1f5d322c2d5b0d42ff65be97374173bf121f3e4f37f86305f7f76a58eaf70b31cd9dbcb6cec734a2c6aa1b6be0fb07b347d5ac20565d30b8a32127857d021a3b1f6db448fdecb27974ec8d1d6ae788fdaf129a507c3157580e4452f6e043cfe82223bb4620bd352760abe58feeb8fa681bef5fdd2ad86a2c4aa7b14e1e2608b18b82bcae44acdda254b96f730831906b4c15b1a63fa36d1839167e183a3f27ed218a083350dcc8b6876bbc807e91cf57737fe82e8d55a4b0ab645f072f3e778a7c0095ae0dd7533075dc7836d5a501cd1e86d2a5f4c8637f98cd4d1bc844f077ff6da6eaf192e8e06a330bcd3de5abbae050584cc29073c5408bbdc2bc9431f077a7eb266c4e42ec18b4e4bc81457069d08c27c33c0e2afb49b80c92b87e751682300a26fda92ee4f57baedc945c74df6ae57adb48b6e0a19800c7db69a505688bf48ad656c53fa06627f3bc4838d6c4848634f6e0127a66f4fb83e6648bf248f5befb58da95883ebad8aa32ce682d437db3651a6e064d1fcf051fb3295a0c31c321b11c4dbc5f9ce37d1ba98ba8c9e2f77657641cc90e7fb613ac323b10ee97402f7c0b8cd83967f8b89f24ee884617a0eb71dafb6b0c16077be42fca7272c3af54dda0803fa44c5c3bbf37d676022d23514056897bce73cf7a9b638d754ae3a481da7fa87ed92ab5b85abfbf6905480a806f00fa3d5e6aee075f4cca35395aba86339fbaeb714b4a6bb605c3e20b1ff66720cf98911a288a2e032c1459c21612b1271097d2fc63c36e7d6a0688f2eab15d79b01ed45c074842b6e9ebd3771b0881b472acce0d42b5974e174362984be19745bbb0fc9e2b8deb6e56566bfb8e95db1dbe86e40e94840cd8c2246f19c8d3de8a829ee9d76010dcf6a3e77249bb6a5c2e7a7fab8b4cb5305e5d80724210661bb013dbb64e23993056aed72d2463dc272751b236d29100b89ee61d621a92c6d66253b10d06da200a6642e53bcb00b58ae307879d351acd26688a090090e8e8a60329105469e992fdaecd3f7a654f1f8a1019b0eefbc2e3185effe92cee2d38b1a51976edaa74e5918f01add41e1745740df905ef518daee6c7679c2599c885c7f49acaf2f382c55674c30ca3157fc1e8ec86ad5f4877cafa17faff1716c40491e328ccddaa6076c1509b6197d7f26543ad846bfd0756b6a6b8f5b735f54e9b4826ccee48e3da23006e36e1e40dbc1b888224a1478f1b2818cfc33cf27d1e25aec3814cbcd393ed70031622aa175346ff507308b983d776b103a4750557457901ae3d2ef30b11a0aed2a498053e6374b6d41559a5d887751ba8d8a14acd829ab67e3b99e986e84527b6b84f1cf138714becb4896a7ccac8763f3b4e8d2d0d3b82a546174d925c49c88a9e68be4f0120653878f00732576ab18e1000973a9b96485efb8369c7636f492c367c2369cb37bab1025c0d79ba239defad7adcafba90a0c1aa06270375bed6564c444baba487eb8432fe2970a77871a63a0b6c9c654be7b993bbc5a6ea701795c2b62fa431fe525bd5e7ed117958a01c70826a209968f7a1582f82b322cee9caf1246adef3ea4a31515eaf2641d31812657fe3ffed170e7064e9a9cf5c6435de69b35aacf984fc33fea1056ec8bddbf9e0114647ab11f8f309a8b02ef82e566beb690e007324627e0779ab6d122a5aa851a52abf3acae4ede30d18bacc0cee1debae08510e7845499f1bbe7d2ca55caf9abf233c82ecfde13a1eb31542006c701f34e35d62edb862d2ea632633ab76cec2941de3594fef6dfdf0d1cc80f5dddccfa7708ab146f32034d40d660cfad3763c4b15f7ad3de25ad4f882a27a0d477224094ed234db81c6fecadf8f6a3fdc51fa9fbb54f198edc12c3c25e5ce599fee7bf9f5a8f02e18de6aee26ea7ddaaf9eae5c21b2c2fc21508eeb0776541f057e05b52965deb86040071cb0c50ba96aba2ece6cc7af0e7c63f3e2bf0b18407e017b0ef894c271f81f2410dbb1a7bfd1df67b2d921ed6e28fb7082142820832c72cbf95117d593fcde57da32dede08e603e191808936cc4fa2253ebf0ca6fe084b10450925e612e2e19c0afbfc86d3f825efb644a35bd22f87ef3a770b8be40f6bdae442026edbeda5791f3038fd232e22661313ca910774e62ff4e1f318e4a70c20243081dce5dae5457f5b01a0e51c35446cfe27c3138012871f61af2133e7484e27ea2807f9e35f904315167e4b2c670c59c13b36ef4310ce7fd7fef820d01bb112f67cda1669e7ca7c762ec08577fa409f0e2f2046efd2545e685f7125eaecf89cbd5af512b618ccec9fa13b537972d00f54ce73252cd84d39eaeedaff6d7cac19a784581219fa39caed3cff4a8a96f6a8e0965714cac95131943b67ebfd7f9cb47e1ef6664e45588a108213038c28837003e9f91cb90b68240da1d23a68dde28de567866c497b89997a4d35a2f18c44cde4a5c9b91a42f1c40113728a1eaa7fe6dcd6bf16594b1a17858b6a4f7359e287b87111186ba30d91c84dbf6b1a059ead1f69bfe703b522ce2b2c8728a15e198c7cf860a4eb46502e2ea501b7a1cda776c6fb6a0a241fbd05f5972a579e1a541c21c67edbe0e2bfd0a177f0f5b276b7258681b99b68030bec13e9645372be225a18a3b815f581e9535a9bde069532732ab5daeef9bb16bf28f3d752b85bd5fa2abd42beb6a6803cf0885e8717441ff1d38e2f9311214566e5ff62c804a6155c45a2b94546c377cd4e7f7b380ad3554163e1f16bab6f4f6520a6e7a5b7cbc84df0d41fe4fa13319bc3f7131b268551fbf75544496b46469155a9436c5eef6038eb0718e905d6dc381e1d86d8cbad77429e77ba0c1592a9e47d5be78670e3cc20612119a9f019d126442af4f747a0ae345dc44dbca27b0bba47881269ab31ec6802fab4cc445475a3ddb957fda7f8a96497d3d567f8a5c2983f22df9de68fb34e41d3d7a97890fa4128f324e6fa75021ad554cb192e3569690183ac4ca46dc7d3d0ddb794636898b7107306b699c62667df0bec002c5c5a467319e0e7123b06c35cb9490ea7c37c90712c0bb39483099c37cc4aff1153f48d35a02441f4217ed7bd8b3e5047b5a2c35901f6ae51fa6ce9bf189f86fa0c8112075b5fde50e28403cd171839bddf780658d1e78fa5d9e350a7cc968b2e3970350e4825b810309359b171a7700850c976fa023b5cbc37be09fc1d9f9b53f272f1df18c9644d8ff50ec319550b7ab647e995db846cbe7729c8b94b70dbedd031e884f29a596eef5ee62851024154db52133c3c2c1ff1a5334ed986ed4aac90a4f4f2ac378fccff0a8e19a3a9bfd7ed885317c6a18b2e0ca98ead0ebb3cff9caef3c6c99a9209704048acc0a5f89dc5bfa7f160102ac922e7d82ffc2ecd3bb8de3c08fab5c7d7de822331946401994f49f59683467adc194a48475b68c977cc9545f2f8952c8807e6ad708cc9529a8c91cd7f5fb2056d3d2f25ed569f676bf9ae75d49554e346ad3767282d658fa483a2bdc5ae9be4c6081cd9b3ed556555b31ab2a3ce6ef21bde5e9f5946ad477eed61735e1f15b620adc976151798aef9fc3f5ab3c35cec9bb15acd33dfb3c68f7254d87ad4dcdde976b0cef10228c3162b77402892bc0cc2d0db3264dbb17652357ccc486dd30684af09c17818a3f1510e076e9a3abb604143d9846436ed44759f002e1786178074a527fc33d12005fc31592e382a416ddc8f7fdc7726bee8b2a05406fb74f347d7d63b34494893abd45bb434162f31c80ef8215b7215359ab8b7562ec222f3091bf158c0c7814f8bdfc5f118a880066c2a9feb2b5ca0d6e3a5c9db9ce9b25868f53853365385b8454c9cfb878574949488e26c47a0f2dd08f81b6ae7867647b61453a3d525408e4c69992e85dac086d4821d2469be0c72c27a45768d16bf90f1e3b26cb70bc655ff52af4c832cf758137ba3fc3fe7bae888cf8e04889770fda41dd234d709fc036fb0b703f7c0e37b28a1ae5cd672e30cb5eeaafe39d8f8baaadb123ba24dc59a96cc4d6d7e9fe939b07fed1b1ae48f56335c0b5983688e3b19e42e82065f8c848838f6d021f5eda1d99a9c7541a9fb60cd630866ca659d96d35702040eccfc6e7320754ee6819a680cba9518a9437e439e6b3185b799c073dab68b34bb292bc505f9019a110f9b5b4ab55c7f12b738e17e50042297f2c518f10da98aee7fb0126f43578539de9f70f428592d08ee7f587ce41a4157a06015120fb5b53a4b154daba1013af19e15ea61b4ea8ae2a752864eb0b8cfcd02d478226973e2e0ed1cd2de8b297f5ead8159d224bfbfaa66f9b2bed4b70acb3862f0f7f8d296e928e85457a952021a830b20ecf0831d8d40d6d79fde7c115f574d99aefd2241eb8930abec0b76b884330e507b20897f5bfbc62f32cf2f830bea9b015e91140cbecff1efbec7b75787e18aac8c17f33f871c4990b6a61f4128a0fff6472d883db59a94291b2a67019ca157c1fb0ccc7c1ee6fe161c13ee5f95ca3977bf7a70084b92667dec039c910aef17e056d7b1aa4b32ec8197e1ee533d02d1c9c266b95f2e2ea8bc195bd094737ae0dce9512a6cad0c9bd86e82225e6efa244ab2e79f31d49fb06b34d13605f0d212a0cb850fc8a822d218bb3bbf4d45a8882af0c5aa5d1dbb248c3359d7f31c1bbbcb195b361a18b688a353bb6878062da6094ad2bdaafc6059ec46ac2601904561effd6644b828ce891def4cb679cc9f52a94893b03dc5e681700fa437d09cdc66bb854650d22b70d76962460a682e4023b4f48a8a7ad8c7ff02c15dc3c2ca424cd2894f2ca39f61ca7f34f9e77f5363eee40d0e62bb650b4825f4c24f7cba83be4a185ffdd6940318e53168f4ec1d0288f4eb17bc624a619c7a42a7d6f0fb3c391f15a09020d7d5da31baf0bd09f0aa07120d0e092ab1fbb1f8dd1bcd1a3cb7fa49c9f4428d290e0935fa6f7d32eb18ba803c1e072ff3cc9f79ae8e0dac69cff2b310953de62edb4783436246cf907014bd19f2e95de8d1c6427af31ca34f16feb1bda6096c522003e00ae8b39d32bd0fb1df75a5a7f4b565eea73409cbfb123ab2f270816cae6922cb082271d0a22c21370ac90d106cda631c0e61057e447104b3ab19f4ced2376cec81996ec4647e6aaffeb1c444ced6db50d39fe5eaf277cdb3320b676905233a08f7daafb08505c72365cc515d7f0c5feef6b18811ac5744b586e4b3ca03db160880e6b4bfe1a51fa953c13ecb583b007104b637a1a0e14ec763060b377b85331c8487f3e953b449c7fec1ce569f006898300123b2a17f2a873a6cbb8964980e92c9eafa418af14703df0e8324dfb9997901eab352aa534bad387fbe9dfa165968c6d78ea35ed9390d971794cbc9cd0cbbb2b394e9d550b3ba9427c0d6ad2c1c02e5ac1e028c0093ef8ebe966f1be03a6157bb1fc11582b04d551024627fafeef0fb786e4a055d5fa5f6b0a3979a4ce07302007c3659db900c165922eb2649a4c9df2ab87a9830b607da662b7bce12847f89a5a035926d3b3ee05b3e1f4aa6fc421f134d0783589d79a6c4b8f4706d49099fa16a0d791bab109484f76ae53e3b8b09afe43ed1c57597c1659d97d692c93526521c8af844a49d99ca741fad611bdb0c557d4607d5a5eba7d5e7e6c0ec0ee45b32693432b3464c92da4d81e0f8e2ea398037c380356791a3dfec2fcfe813228213104e44551bfe9a043fe5ca4ac4715fa123dd82238fefaa35294d488dc2598476dcb234c66e7f5391dc87f224213ed713789063269115322cee9dbe3ab4697d5fd42e6d625e28466dda9bb30be46d2d6250f38d2dba0dd3dc7cf6ee79867928f20cbaec0279642013cd1a7528d8d05d90d91262b809324affc8835690afc5007310ad327a73be3bdb70f3ab54aa3a970a326c4b17dc485a41b04eea276c982c18d20362a6fcb2381ff9145325b1c2eb547aef85b6ae4632ba644bf9de95b80ce4aae54fc5f9d1e33e3b0cbf425c51f3122e84b17b217047b85b34562dd4b8b428dac6084c3d1aa26e79bb21f06b9d834f543c9ed7a4ac06bdd122d8cde9d55f44f54f969b3c7360742fb10a659a51b7081248b8c8d3c8656485232befb4a1b66cad55b12c57eb654147ad57f7e61307fcf884c1b213295eb7b2283baa34ee9ff8e7d6a3664805ee0af55b1d7317fd1c3d7001873b8e11645797a5d270956b360afcb420cd5f5eba87224b2fcd340c765cfd126bff07249f6b87ccab80bc1a54a94dd57c3aa885d66a11fdbbbd5209b7140d38d314b4093a967c33bb75a64cbc2a758456479ba7d2625bcec1fc1773655327d5ca8039c28606472ac56f756bc2e16df705efc3e81e9c0f503e82a3456bb488025354e49de8428c192197b5fac439a3d15d7a6f431009a1f9729fe84f30a9130256bc2fa1ba2ea19402a8249a99947daea89205deccaf8c56f3f70089d0f39fff3fb14f3c4682513f01a81ba6c5064df1889635670c9da965c675c9333fdb3142952ad1bedd2f15d79da5f24702386fe27793745eb41650c942c10c0ff7e727567b09791617dcd8cc57a9a4d51bf739483e4435483999f23b905dbe325ca087e669edeb2b417c18b86b730c2d32b954f9b5baca9141dec3476f8bfdcff1242f17b4b58cfa2e87b070e5644e8af4dea036dd9bd87558cfacd95b339321c80591978d5da3d8c6208f1a87929d2414bf79da4ebc0361621465ae0d373f03c8473dd13e0629ae18fc9d49879cfdbe13493d136d49737e405383c4e85239dc9dcb8925e1a79e445df5f9eedaa58d973a16b2e9cc658de11189bb64891f39ba2e64c759769630c8607d4c598d75e6723431bea541151043b00c56da3f54d66b8a2b775adb7a7e18a755d7950fbd5bdebcd070be16b925d4be0d3d0f8a974fc1bb31e15b8a40cbfc1250448816c357e8e29879d27df80cc7cf5db4f8228314f6937664122020b0b7702bdfa4893ac298e62e25f3e0aa4ab67ac32a5b0e0d54e3e9c56a72a762f29f193d98f8fdd433fc1c7b857662629acf2eab6bf363351d17389bce8ecd8328cde7000fdc5d160a5e06c82103221d3f3e7438d3d5afed666e0fc4d50bd96cd8f631e512718a6a47f177e368fa2704a637b83190a76cad2e11311e352dabd8e6c9c9cece1381627fb7f74d450eeea87fb07edb3e664bf2e2564f7b0aff0133184c09d3e4df98aa31f067337a2d8e8a402a2e7653c290b119acdcf1e98c17007d5d580c569f4083b74ccf1054ed0c2c8bb6b9b6a11bffe395799ddfdb41f953b546ddb6f7d7505c2f124af7c77e6b8bd11fc9f9197ab81a66a01d18db8ea4aa741a4e516c2185020b5c6580331a5351fc4acd8dd1fc935820320ab06be0e52478cd95c9ef0bf515aef995df2f442e6d84be6d15ad55954507e489f4675b46e9d708f58bbb03a85207c4caf4343c567747f61b3603e650cb8286d78e8f236be836c20f022a2e36f5eb2100bd3bdb1a7b692e121d71a4599726618eb487adceb8215d13d5c73e111af6737e579d0191336cc905689df5607f109723f3551087c3f80d4497909745a4588d0f789c085d9d1b32234c5ab4f8cbbc01cc0f9647d71144e9f10d4281c4da71a41c80e01a7adaf79301c417f897f7db05d16e3d3ad53be0b2ca6d055a6e4762b4768cd49118636bb293bbe9457ebebc57a36a0e6542343330a06499f3eb60376c6745d3a707f97fd70f0d46a258c8e6cb70f44d7d8dd10295017f94d5b80ebc1ff421a66c350c174a4d586f0c6614a873b87606100cfdba83318c1a942340ed59091ca1767fee752814c907157cee9ac3c0ce118d6680a30b4c2152f4ac9d9c4ed94f4868ea287748b8dec1c2535ca63a86c4947d62dbe2be7174acec0338e462e0a0c72bf0cc3f064fa33fe9ea695f473fd81781e2c71ed348fcaf85c64d1210080e99dc99b744463daf2ede245df12b522da8bf9cababf79cca24a75f72ffd11690fdc4e474fdb9b8bf23a7ea0e56a5b29f145f9289c44e5e846526b1b74eb0d91673e8881c9c37b347b8c018b93ae5e4693f658d1e9114fd5f2a943b05e6d56d2f7df4964875569157e8648b693b54c67d1b9b2b8ffd42eab497ac489f194bbd4ae1683f2d7d06a39b8177a8fff9ac50290eea9e138fd9e3f260b364bcd35455d0c691b1886e41e559d240cf98069592d00ae88080c151e96cc6db067170fd3ee3e35a53174a5fc41f6bdb9e72491be536f6968ff3ad26f5d67926e0bb0cfb8afab6476a1a8d56401bb0461ba361eeea1b0c63c43814860b7ff85671035a3dcb2adb51d18b6b5281da3e345ee78a41b74d78d20362de44039debc8feaf3257353cc39bd251eabe264bb471a210e49bba925f6bea9823c0b539594e6539a25f231405562ca12851c9d77cd1b8cdd61fcb6eeff7a344272e1c8348e867178d163b7e408c1875c88379b3bbee2c145dda0ab3474f0f83fbb63bf7103f02bf8a106ff57f074928a39984ed48aab0fa6fc54460fa347fa3287223e86aee86c3bd73e6bd85f91c42fadbd421e31a59a4f9636bdd8ba8435cc1e2651aa75c95ce5293b5b2e7c3f616c1632c9931aa6d80a3c6f9ad315605d3eb8e49de4c7502dc4173852b64fd72777c0ef50c4b6de59c3e85bd5b4a5136e158fee8a54b1d5a4f60498fe8be6619197048e7cbee23b4546725159f780f4cea7fa7adc10d0181bc8ec367c95cc65b064df1c6cb44aaeedddd299c0803d6fe318c8c0b441f336c76e145ce52748bbabf167066660b4830d8b36ce852c7277e03e149ddcbdc148d6a9fea9a4f72154906a8f039a966fc35e4ce299536c4c17c2296d0edf5259a9e2e2784de44e61254eacc1e34d3b10b4ad918572ff0bf730c7e760d0617f0210d6650e013d7ef6589ea0c1a3588d223f826072303c3fd0db4e7a025311388cbff1aadeb4271df24388126070b7b5abbb73192a0b91fd9af2316d43707037ebcadb2df007c7cb59968a2f35e5f05034550bbbcd50d21f829c95b3208e2a60e1d66427a0e827550a6d4104059905ad5f98762a239fd449af944d562bb3bed625d57627235b1b64acce66d0bfcbc4156f58aeeaa82d94ec1b29d7644028c3a53123ebc69a1b63bb1024c291fa1de68049c6364a41b54e545622a97b89a9366c631e5166b5fe19fa186d26e54b9a04694c6a332c048d7f5d7a539f2104b2735314ae499c081e98076cfe248b8f3f8fa2e0db09864533641dcbde8a20c5bc0576b6568aa0a0a62c55595c3dc17a0d6f6d0e0eda89b321ea561017a19074ae6133a1218660a1ebe9d971783feebac7c4d0d5110502bfb7972fc1a49ffe6f550b9ca215249666a17c45904009fac1940805281ac37b65df8ace0322bd8e533c3848606f2ec8abd2fb0fe7a01a9b012c892b71a18b1648133b031720398f1ab010e00916a497f585d6699a414562d9be82bb03106f342bdfabf7fb90353d06c3f3c82525062ac6fa5437c6f1d5cdcfa07067bccb636a0ba33927ae1f149fd3a6da0559348dfdd3ad73fdd1ba91d8dbc55ab9fa393733b531253ca371eead453e84d243f0459fa5c4c6cbd941c09f628bc6f9ca10b343a0f190278470c716e9c7d59b1a489bdd7a47f56056f9d3833e53a1d954a49dc3c99d351dddc580d1c5c688f8f21ae271e856ce03c7e84273c04e6bbd16ddd77edc316e06bb9b60a0b49aa3d807f73ae83c0dd7e7a34323e4b4ebf321ebc6d69b9562158c72cf40f3cc9acff8076f911d57e93ff419eb745ae7dd6c8a6f1ae084ccf5e2d6c5c8fd75491e2ba5d80b7ac313d232149eb596d63bc093ae6abc137b884feb10adf0801da3666098be40cd47ca8dd44b511c006145f124fc16c084204c53ec6389cd4d68dd113edba95acb3f957132a5f6b63fb3c7fe412f59baf9e6d8656120ca1c4073e39568344ed3fb3803e91b48cc507ec15211e3a5124433ec92366f47ed903c0f114e5f0e3348a0204b162c2e46c8c53b6d8f9ba0bcdc735768e49f5f392e5efc881d520862f8ed54543f43ba97036f2e4052fdd852d75f803a0d75a5827e042348bade2d024525258d985b42683dd0122daa8d25d364aa97f08e88726bd9a2cd3478d115e27b28fd2d8c422af64c660002cce46f2b38baf749700567d550fbc3032bfbfcfd4d2c3bfa279a455f7201b7f87b78fabf29ad97469a0a8e357dc7b10c0bc342ecb6c0c5a2e4b4d1737f4a0d07e3cb70edffda6c9129522c92c7bb259bc476fc89d3db8c500fab1b1928f657147338e05261857cf47903f0704af22186894df5ca8f2b5b883a86a73bc53581d045dfa1e8cf5ce879cad7431813d19f755ba4aff40911317f98353ae5931664cdee0a1a3dca5f9a26b391d76185d7677a04b0a62630e0b1f6c5a68ab75d75318bffb14bb975e014920b13e7ea606f2a9fc08b6f7c8d244acb8af1604cafb2c57919baf1cc0ccf3ed3f2c92f3ca5c1619b8257089678c393710a5198e135018297686811bcc52aede447726370c81bfc39841557b4fc62d828340fa20f9c3ea3a6024a440a33139ea97710e752c9b3c4515ce38059ddba53c2bf59de22f4f94d58890dd4726b494388013eef7df1c894fe959ce69eaa90f28719a61ecc2c44f2d5ba306349f3162c3cd1ae0a87957861afb109b1ed5cc2e6a2ba68b4d06e79d6aa698d72fa9a16f70a46faf0fc8f76ba0c426baf60a64e806b9df04fc8ecc1e1ea473b2ec5103445f0e3b54254c5d8e2dadd54f2c64af21f2da593b2cf51eea15daf5d1cd55919f65d78fed2f8147628d5efd9d006f3424233a0937a0bc65a265dcb8a46d82e805e9323f9a49fc0105d49590ac0a506beb19bf77806b27ebedf44496cbcf55f001ad0c7fe3c89eb1bacb22a7ed1f9a8f8fef7a84f4280289a405f65cb748abd31af9f5323238b2b75707478b54a0d43a030e579ec4736b0adf804d676e5a2af6fa310c76867c630524e97c8dfc128cd5d3479ec5a19e15971bc58ce0ea1c853cb3daacc7f93438dd4bdf3bbd14205b80b1cb27b0d1eeb6f042aeae9b5e3ccd715cc34fb55a522c247beb7e0b0d33fe86ac86dee2b7c3167f5b5427a077081bfb4aad4268c035157b106595dbf9527dd06556b286448b43c6758f2b150fb6240abb408b4b4c6359a71257a3f5feb5047aa1af93f1e1ee36a57696cde1350ad66bca94e0509bd70c65395c5d6ba96191a2f9413e9783f4a1a842a0e1270a5eb87cc03db251ac26f8a539ee04f78ebd589739fa82a47e8e9ef0df1151c8c3bcc3553432881c6ceb656babd951e41e7d076ea07697f19c2e76e45f7943d2d5ca0a1a3cc34e44b2dd6aee905466d7184dd71a4206c9771a2a74f79afcef62aaa74308bb28b25703d0dc25129caea4370685deb30e9757f7488c0c1a3efb6b5b819752fc6274d2ddc3ea8d9f0e7f57cc27e011ac1b92e5d2b8bfdf5fbcb73b7914886f968af1af7b86c27cc2491c2dcc865d072ce9b791cd7323ee3490ff8dfe81a4931e7021627fb87b07816d13be3aa26bbd2eb8d8d3aef615333e061c3c75097e76476a1eab5318a4a270206095844028e6a991adc3428e687c47b8969cbb3e2fc7dc958606470bf6ea9fdab70a0ec51129d70dcc4b56372ebc1b80da9809b4245f0adc0c9645755e6f3c036bda0ec5ac8bbf3cc523d09bfa0aa9339e0839833732bb303f16974c1ab1b76f46ee35a1fa1f1415760a7a9c3fc2a995ee3648320842e6ab28ce6780ef1e193d789bd027dbdc391fbb3c93c2accb0e22abe52a1f1cbee1998c51801e4cffd5c9814736429fc2353d0a635550827e942f745ce78eb889b6f11a1e097aa7cf84cfae99b5d811c914526e15365f073683f0b912230edcad1f18ed7283a3f2a348593d02e61239c02f633cdbf407670b59aa32fe9343f651a735b3088fb083d6e525ca5d352513d5fcb086d20482d7694c4de130f29b088ce32d915a677937e42bd62052ade55cf3f14b6fce3bebb8ab5378ad59b24758dd0542683d06d00ef34f36c0f906b8e3a0c4cb7498cd54dd8b492e3f09f4b846192c69404a7bff106eb1128397db92533f2805dcc6c2b1d85b9e58c0d9b6122d66040b9888ed344c911afe42e89548599defecec7a802229948d4c10c45cae1058fd001d92873905b1fefa554c39a1fc6094b7232f455b76a27dc57ad5ab984d5e3ddc05db2f630adcfcf149b7d3a063167dd901308397f6d0406d95319b2692a5cf05b8355633ba43872c1d42fc81a673f38225876302e3dfbd6934b9fe350743d024ea11b95eff05b04cb97da55c0b6e26ca2656d9d29057bbf2f078494ed151f6ee0e38a745e59132436c6a15f0b6b0f6a911291b009984bf7ed5d5db206d1a7f7e8b89143b85fd550d55b46cc4453446b51a48c194509fd2de29ee87f9c20cca3ad83dbf1e4f9d754b51af146f180b593f910d450b90e84b88d07f5810643b7957e998fc8ec15725220415330bd31c7e334a681eef89711a550519bb856ee83592ca9b57f6ae25b76dfc0ef58ace67b248f59ab12ca447a65521f21b123fab292d2d5c34a5f2633b7496015d7451b6c65092c16bfb01311022895a9664dc2dc78a7c0af9e3633920918dc13ef563dd71be257b4cad5e19219677d7e9f3d5cbf60c2993e5a33d39366d140e37416cf25d6292186ae0e3a431e86d2dccf5a523e57c4c047fb407d33ba68ea2a6c8e5a17608b99f69103cbeca6ec787f27e6433cdd1e669bd7f80e0d07986f764248b010ac519c6acb4f9f777fcbedcad080868e28edca3a0408a9ac918c2918afaf6c9d384aad283d6a85f8533a2ae8aaba13a9b6a6e26e9ad3322196377c6252525d53e1ae9b9f266aa14b8a7a0e67d26a980d709809f1cdeb368787bace3ea54c7fd27453066ba19668261399d715a8297b24a0f84d2b0989fbfdbed948543b7d48d181ad77de59accc643ec75581138743263c6f15672469f5fdd679b721b086e7da13b4004f25641421c3657f1683a1ac4e7bbfb90abffa7b6d3a5f6492732ab122abae2ed4061463be1d4c50e29e1c07ecfc4840c99416cebb678c72a1c1347adb8787b8873d811a0e78e9c464392511e8fc7b283ee02de65834567da7a14014edd0499035b3263b757f5781b37e8d98ac20744a5983cdc681f548030895e6b7928692882cbc9676d54bc76be00977594a8528dad8606ffdd364014cc620fcef7c9bc6470bd0f8d625eff7d77ed327483ce9147870efcf328f4ba177ff2629ee8a4b135c7767c18f617ef30cd4e34eeae459d2340e3766e8b9bbf3a8d2faf08922f20f15170e5b92a63bc24bdfb3b5efceb3b0bc995eac10d786ec85d121978101486cce6cdaa22af14affe4ed35b56713b0968595f7129958f033d862ff9be3806269c193d9e98228c09476d2cc1874809e60d46f5483dedfe60852f7cd1933c8c7b6539d04b87a98f759f428926c4183f5f9b158d46a2598dff033a52f419d59d59ba00efe77b0060c577f36db89aec0d7a60844f21b7bb03ea62304a7a82762633eafba184f05566341571ef4a7a9803615a43659c8c6e9f24e38d7d9344e36e9c0fb183ab513d0f5956f48ebce2c5054e1a701e834497180da6870bba30123305d1f12bcaff99599e54541a6bafa73dd3c4263d44c6c480773070edcc3bdec7805cc632d30e1dd8477d4e52abaddd64929a3b2715042f69bf04e6d17628919e13213b85649240e177842f65b2300750cc4dfdec54d8ed9c3792710029d889d5e1b31a02e580d5544f64457c7d417dbfb43273da0f51e16f6583b8b8205281f42c887bf48eef6dfc777903db58b2e19f96490d26aa61173f5cf7292053293f8344ed917ef8897af714263714d5de2a3e182b726944c93b85affae3d5c9de694f3143692e5b624591de0fde7d43ef0462c282127d1171c85e995f3f095e31b3447841bfe5be32376fa6568f86a741c8655f67eb199e9efe2db9787849a8a86edfba76d49fbccc085dd4aa585a7fdd5891777c4be1f21b0bf23c953825d37dfc3973bcca97355bc71163c3e56ea06cf831e95f760b8143415e9aaf966600396f1dc91aa679b9204244510912c2e1889bc663c784f459b1c014881e7bd8f964af61e85e87b785c20e815e0b6210fda655ea85bce2b476abde15d1100a27b326940b83d98cd3b60e194048522881ed4210d619b12e7193197df0ed64067d0f950a10809ddd305bb348fd47e7ec84e7e327a8ce2044adc932fde4f8b78fc9a2183ac5dd0adfbe602ee8a00ec6d4b0b292748e07afb6114bdac639a7c20e50997286fa538415b3f2f0c158274b98756c34e8fe56919ca5bb00763a404d51087831cd47fc80d21b4c1282870851b3b9804ac1b69949f071efdcdb0533a602735e70e2044feb3c2cb58c5398cd78503afbf1e9b09f9f78536826a770a8c830c5db4a646264a295e4e0abded9f1169e41859693c14b23ce636b6f4e49c98730e409e913e1d8b5a3abc6e48766c48e7f919dd241871b24f8a07a6cd9b398f143ac6c102c37b6f6dc64aa4c3941f8eb2a850d7129b3979600bd1509af388ab26900c7088cc58d4c53c547f7e2fab3ac2d505c76cb481b67aa1c58c7400bc63bcd53182e7943bbfdfded7943b19262b69c6f5d88172761a22afe01fd5dc0f277e397bfce659dfd9849017b5b44668af2f9973b66e7ec66a56ff26c05c75a640b0edb33821af337c573fda1170a0c881a070722f8f47a58259a1174438f6ad5f136249d7ce57ec3c0ae20a82a40e971d15f17ae91300013ef7b38dbf7c889b09a71ea741051ecfec3d7e57bacc24c77af033bf3253bd86e6421dcf9c003e6c65224d9c9d0f7d6441f556d04a9380da02f3471a4218a18073ee934bfdda6852a9c31c5946ab961bc3c5abf36944803e78f4a0add6223b4eced2b124291afddca2dc9556487a5edde416786880365a0d727754082da73671a4dd7c038e90182c0880c663d33e9646554f57e6fbe38fe6213647c2f7ce9ea3c92fc10f2b79a72d57cb58761ba6c57275b4bab2f406494b4b79832880b659dc7dfeeccc3450daa880507dabe005eb753b75f450074cdeba085522cde10b89388f932a20525ecd5fceb870bf2a766e635869ed18af6111c1e1ca2c6b188b29c1df7609505cf2c712e2b7f8720d419c1b467a5ed360d6f52b8fcddc012e73316d6a171165e8923b55bc9595412011466dbc5944734457bc5d6ad3963cae66c060f5f6a0997c8b005b5b566346dd1ce7f4595d50a88e9e581c4f3b05a066a15dab640677184f1dbfaee2c49e534a25ed7e22c23f12bd443246c6f4df235b1697a469e37b98752ee421e635497e34729cbfa216982b7913e67bd5c91719c6578c07a5e2b140afcc75e24c254d1704a37111d141dedba714c39286b8f9606383e9988af4133be0e82dc324a9bad578d8ceb707043c2902f254c0beed9b153e428736926f5b6297c668331ef9b327414e6486f05c11cccdaa0041f80b613f0bccf2e287e06e5ce2297ce5e04f91e75474040c17043ec1c300595b2c66b160d7aeba9d222c9d7802d81988435d80ef5dfba970680bc9fe4dedaa15660e2adc5f45292addc11d0da06cb6bbdcbce2a0ed908c271ae787891f3a93c61057b3ee15c80f0f0a541b84d808d1a1df88fcb15242dc687e700fd6fe88610b19899a63846036a672acd7d44ce81f9026bd6905542299c277de2edc392b61496d70fefcd01aa54d86d99019214a41757a6c77b92bd810dd217ec407ac70e51563deaa22d39aa4008652751896609c13a602f63721d80bd1f96897e8e1cccac6fe84d054114a2e2c61fff4082270016451b8b25ca896314291d5b96d3224ffd28e5f12253a6129fa5dc49757516b22c1d686533ee9a28721d75d6fd8f0d554aade7e54ef34f00b0c45155da6fad6e8407012170fe9029206bb977c8be87d43039cfd62aae2682a89a90d16977994c53e9fc26a9422ac784e0929300364acc23c520e888cdaf366c1d139152e6ba4ada1df68b504778e787600e21bb165fa779bd7223861d2442bd70a4f7320c5305eb4569250a268a85678d1c3204998f8a04854b70561fdbf23a12f2eacc29ccfc188470c2e971fc46dfe41939e58ecf0ff4115f14c5ea3627096fb6e8e9db3561f9b5281604afefe010a1eb1feaacf65803b285c650a07b254aee137f3c862357df7fd2a8bcdb677c83becfdaf18e91608710a56059e33b9c1efbb92408697ddac9033be637e3101996b5eee8382e29d5edcdbbf2a9383859855fe5a5041f3d8a50cf3cd31e1cc5bf16d68756a83e20098012cfc89703d1037a8717e6abb7fe7bf6245bc44982879f6f5dfdc7f4140881887ada27f4c235c18dbe4b024b25bd68d7f4759661fce7ae42827c0b3d83e2271d68d0c855b0d9b3a9866c59b12eef6e6a90d7a9d8a748a1103bca0ecc395121bb6dda2256ff3b1bb676d882781684a5d6c34676c17a4c12b841cdbfc25734cee9034d26093dc6111a82bc56a68b40f6af2f1021d2e95680562f7c43a2bec5c4bd7190b67881d8685db51e746d4a51b452e8e82d864103029f0fbb7ef37b44fb8f9ade0aa8b3d93c4450ddbdea8c9a1debc4227eb8f4abca9432660f330e6e5b1db21da30616c81917a3bec603efbfaf44ee33837ab92bb7cf7d55ad61214c65ac0837cd75562aae4dd8c919eaaed7e438e560587445984f12618ec764e94ca795633cbdd584f503034115cef06c6de6efa373659ac62fca8089442ecb11fba7c16d951232a068ed3f161d6f73bff8806a3b7d17bf83e2dad042903165bbb1cb0ddcd76b63869634945b74c5c101b8f3edafc9bb5a2899850a820776d740ab3c080389afab0ceaf333ba4434221e484d5611972b74b4b44d4376c8ecf18e24434fec506a3b3a27a98fc4c7b90cc8ff890986775f4ed157ac4a2d9fbdad77ce49ff213564048d28a02716adf72dc0ac49ac49f0e614f74a21803530a52a678dca6e3b2828c9e15d5cd78dca9a07d25e4c4dd21158e776bc3690f2406521f6ae9959cd40cdcab8223cb5ade8ed5178a4748d2aefb703fdec30a2bddc40a4c829553d4bccbd6a32214070a8754ef630db4feb548b1a4ccc3e788c8d73e462c024c94fbd33830b0eab8c11bf1c2cfab9c562faa25d9cd3087210d3f30331deb62c880a1512bfe224e8cca2911ad8c99372ab338487a7b7e06be6df8ec85d46758f7625d9ab898fc3127e757ee8fb6d05f53402b25c2af88d229bb0a2bfd9fce75aa841969260e4456f397eab078314575560668c99e1f0b586497d8a33d0ada18b54b00a4bef5e29d36110cb9c7ab2cf86d63e8d14a5b22c0123298a2f3e635d35bf848ca42e60aa757a2c77ff93a3fb6c1d94eebb51653f7153b5cfc1d95903e92da06adb51bac902a6fd03ed4fc455e07fc8f3af42f513df74f0c86399cced603bce1819828fcfff2ebd0dc05d2256667c47d8f4a0d9065bc00cae3ddb08fe276615ce7ac2d99a0b2e3d911c39574161f3dfb3f4eef3b4df720e57d9c3daa3e1cbac8e9bb15bc9920f6e9d12189d826d7d9e44cf9d6a751a7119c4716306e41cebee540033d47db78dbd78c3579efdb148853b7de27bfad625434ec918d0e51f6b2ef9f1230a1988d86d2eca98716a33d07f9c9b60a074f10785dc91c38cc2fd800f9712f773d42a65ccbcaafe83eaee7349ed2345b4457e71c8734d8e47de08e7168d936206437870a0b722cc75378e08c1ff950772c4fffded81494427642faeccb3987131cedf96e2aa99376ce9a1a3b2ad9d77efc4917e4bc9c25d64f3119d576e1d74e7b4d03cf944ea57001de8c57bff68062a58a52decaefb11783f92baf98450536652ba50a6d9e74d7d48c754638bef4416ff9adfe3666c6484d9557c0c001959ff54e38c4a9666cf598db59c355d0de4be41dcbe2d81c4bcdb97d37a1a6bcd87e3ef7f96d6f6497e86fc418d185585e49bc1dc7e903041e34be5fd9a7bde7efac9462d39093577a6823ecb50ba3e9d43f7e21764947e0d251b32e543362a68007c366285c00660933149545702285e2fed79e44a0d5070950254a1784b0e370396915b7f1af4cd1dad70efcef34f6a67006920b219fecb3ceb005045f5d9fa276539896a2c442a86af253442a492af400824b62af9426009aaff5bfe4490c7d65cae90b3587a30de621325fe85447bc74f0934a7b114b40e2431a80a01fae8389636ed9fc93670ec3d1076c9998026f733f1ddc8fb989ba653219aee6f45a9c45460d23d7f2fd4bb8fec63cbb39319fd41dc9df8b7892f0b2abe4d30d3c890652a16532cdf380b4e4ba199bcedb2b6f9e6fc3af55b3dc5b2308e63fae945ff030656d66052d328d519ce02c9edf37caa62948728404dccb871fade3745c0b9945f8bc171bceef235e736ebc214359a302bcb57d76ae87a3ac04a5a22caa61162219bacc14b4e77a642734660e82360df1cfeaf1486330d8bf2f56ba9ef89513ec7aa8039df78fa3c75f327242dfb8959080571f22adc5092e7ad85ec04fd6b1bb077544ef4904c9f3f1a131f2349011eca509f8d3207b7c4a558d0eeff05708a1240ae80d4958376e109e2ba661f0f804be8cf928b7960a758e113701cf83d77fddff35102bc3638fdeab7584c403ca80231a72facd4f42b396d14a729e519bf232dabca4f06a5c61d76e53544492e9183802a6604f367c9392067b2c9c12d5246e135d231c869edec6feb9ef6838e646367557e0bbc8760cc132ad7fc7243c8b91338d47abd268badf3c0180ed26089e9d0953cde06b9086827c62f2720f0aa8071a560fa7584ea4ba9f8e32b0b5b65f2dde9386f1b32c48275e098e8ddf88194c915fbcedf58429aa2432e965a4f08473d31ab0b0bdb8d30d9e0cca9eabd7df3cfb36f74c2e2973b49c2f93bc6228ddf193f9290638c02f0e1bd221af41a9b01b12658119792e78f2df3e81e102379d1c0a854afab27ca54bbfdc40c4b9cbaeba706e9989cf93b9e146a20f0b70dbbcedbc3394e1cc285299031bda4e24b301857be71d9ce0b6a667d93b07057f7c9d21104e04bd94c92f107aafa10e295b03e40be9e53d03cda384e68b1b1b9a3b0b27d45f53d691eedc55618c6721e819dcb9670c93bd00e03a45c387e21f8fa1a1c5880de04d2b18339fa0ea5f263af540b9d864edf155a33684f4610cffc524e7c32f51066ee0b9f285ace36cfd67e6b672aef4b452ebf5fe83f2289fde01af44cdd9f8b8bf4c1f4499763c2046d24ba6599fedf3969e798b160e0a3d484a41e302cef46d3cc6b4b2f5366346a941fa3793f5f745c522aa8787712dad0d96a554b2aeb48fb0e6ea80f158a5a4d5fc4e9811a11f343db7141e3e86039a5aaa65aeb24df545ce6ca2a7c2a085a2ee834cfec56a224e0e56f2b9246105be300959330386d3eaab5f5451a9185dbc17c63ddfde8d8665f56042f1214f991bdb8b65ee1fa789aa8409ffcd56fd0b9790108875399387297c359a0d14905ed8aa19573064dc5b462b56c54bab332ad8c1486874ded524ca13c79a0cb29e6aa25c9a23fe7ba3551ea01bb6d5bf0a60cb18d1ea1ba0a585400d8e8d14c0e381c1dcf67dca7dfbfcebbe7e69f837c846eb071128b2a4d39a56f5358a879902837bc9566aeb8efeb462e54b215e72e3e8236d1e9a21398171194cae8ec468b302f7cfa7f25de8009ac8c0f420750334bbdf19d81908370948dab6afa319ffbb0d952bfd1bcebbf4a445935b3356a93e8930be053d1d9db76d1be988cc5f7d4456f7c28cb5abd10dd310b5660c64be982ddd182da5b415aa2349d387c848519a781a3da87d83e87d787ca1dd3a19c2e7aeef60f6c2baa1f1d160b543b1846592f4a6d65726d7c4511e7755376bf80a9ece6fa382179563d626f1dd18c8e1bf9325234f4b557ded6162cc07385e35bd6234557bfad8b2dc958f4628c873110d9f0fc01de8588aa7a49dbd0037c23e9a31ee660950a7d11447b6506fe1cfae2cdaa2c2391afd99c7018cfc73e1afab33c6bd12c4e015403048628e51bc83038399d6a97ebf04b7e1807b4672717b861e2dd4b850041c61d6bbf5853721b467b9a496c50deee1df41f370651949e8c38937f9310e6fd026699ed45c208df84b445ae4a86d4a6d810cfbe5d8bd6a52eeeb7a763c223c3c0bff5cca504127d54f046658fb8669f709ccd9e014b263478498b39aa0b8b353f2cf548b5d713e824af8b12b4d399fe46cecdd15f377011d4739ed60b28a2a893a47fd7defca87dc4fa2ad392b9ec519d8e13e1adb899edd6636316b36bdd75778f61bf1bb24c025208d2500355db33e51312fe94da0d15ecf28925533578a1440e08a4a054602a23b77870e26afd0174ea42b30ae5403057d4de7d2899985f32886ba1c6a7e641d7d3d8375177f73264b518b0aefe03a34943adc35ce9302a21f5c5bb59bf6f2f13e7bef0ce225a9e81d298d0759ac18c3dcd3fd058658fc6bcb8ea3947540662b8edbd3e95a64a47e93a5f17d5577f6953c0f9285befe4694fcf17fe5ca4aa239b2712f1a03e6533d33506d220e02a355066479399a9e8c83db16deddc67f0f79d857885a0d8b4d756059766b1fc09dcb8d975361d2115d468a2f6ece5cbb348a057c84e3b004a7859877cd304d8b57be9268f448b63961fd830365685a0065483b4e9858bc6f6aed16e61489cf6eecc0c0c3618a16857f6a02e886a2e55a3218ee0c4d7562df8519292ca908ecf9b9b55cb9d1f0fe273fc1c3517915a95ce3d58fa132a0d957d276b737659b87bd01ffaae67d166ef1e85e0027cfe9f26dbabc2af0cce24fcd77e9155376add685b1766a4bf0ff1c768ad37f6527a9b3c164faabe18d53ede766874bd27ec89f1c0b83741cecff176f7f2fd3267a7d2ef4c4584766ab9a1e57770999820bc38955187f4a6fde85bc3ccf5f52c5d5c3fbd18e23fb8f6f29c186869baeaa04a5446148599342798dc3560243b7afa3aec540a0ef421bc73b07d95ec55241b0eec2f4e1e7bc260dea315ebf34965920a696e76d501a0f67b88b980ff98f0fabbdb539a709dfb75a9d3e1c5899d4b9ed1257de378b65c79ccc98259db5d4bc3de3b69fd41a28ef42648f780eed578061e4450eeaaaa3bd85b46066e50f74ae3d8a857f3d3e7b97ec46317212b70bf30741b6c7d6e3567d58fef80c24c572d485546cbd32fab86c5cbb29667d08f5313b6cc3e10f3e878bc0b9fc5be01da691d505a3e98850cd03ff0b8db59db34eaf52f055990982532a1277f910158c79eb381f59a6f7e8cfd51685074dcd13bd83d18d344103a3227e8e259dc6e0be87b0b4debaae75ef4940a6c7f3770c93bbeeee7dc545d1dff49a7d65331108d9bfd40aca4d546ba5659205a479e7d8a20542769b58172cb2a90d08c28d14cbd2eef0564f596caae4c47efbe4ab444e99659a4299265d6c29fcf8a9e30884dbd35a200453ca321d74b35b7c9766b83a5ec311554a9524177480a2fd7b7e67342a9fec9b802b508eb2efff67e81b53e32a0a18bf16056408ef5cfaa7b44cb32b054d8e0eea58a057fe98b4a0720e7bc23927dab7d023dbd1651fb3a2e6ad1cf4c09ac9f63aaa6094dad2d7b226efec3dca69cc3b17ed25a49cdf724468e2400b3c9d8e652e46d9b6463ed518723bb91e6742dfac7a00034f8e9c38506a22bf903d1c9de4650e212ccacbb14f79cb83ad523ee7d9a4fee889550ea43f52a87f421ddd3f31daf2bdae34b06552e5d4f283c7a92183c47f0ab6bfe1eeb862bed58bcc6f962e705080ffef8b529693440b3d374b23fdf36f6cbf6fb36b4c0b9a7ea6c365b841982c89a5aaa7fd1dc13274513cd8ca99e484871873eedefc52dc7f693c3ccc2e0ae4937a03199f36f1529647c14741d8b533720a2b067e2079e3a6655db7c1050fb740f9a1bea62ee1c05019fed94f2c8703976524b2ed36069fe7ccb4c071ef38051e85eb9cb9780bf0b5186a4943aa4420323ebea9dd3edf5cfb027ff2326448d068badcb90425e549ba57e26ff07d268b3267c9a2f97957dac2020165798fe5d9af10d71cea4254ecfefc381ddfa95b38814e3128c9d3fbaf8fd6134cacead439f2c4f1e312f6663cb5ae3b78b79371ef7d0a38f26a1ab3b847e260c50b0b758e0a3f05415f9db678d285f8a2b670dede838d58d71a6c39452129400d2b73caf0e180feb84e64df46c35ca405f55d5f82bb317fcb8db4734adb585517313c130dacb8302d12b62d2ffa1cf363654dd2cbb791a71a18ea11f543522a6c410ee80d53ea61cf64df2c90ec9fdfdd4c1fc36b4a08ef56e76e1fd234e9c88ad6f06e2c8916f7ecfa5a34516a0f56ca00e446f2bbf99ea63872e91dcbb9be4a131b10b4fb0ce27834d47917648efd24edfce6eb0355ebb68ff2e314774ffcba75fdf3256960a56442a2a434b74d17659852db40c58a91640c4bfdd916e151e8e7330ed4020407b68e696bd0ec977cd28763033534b4c0a5462d1f937d9a3e3365c9884fff6440d9a4507cda87e5da0a70776ac379439912b62419683343eed8961d2c49893e71137f6fde14dd1b7d03cbd6b0071ae3bce9079529295ba0018355305a17729363f66d48885d77a31f5e2c1dbfdb69f15110433bd943d8d92eac485e7d1fafeeefb5f7e3797d59d865885ab75c9cbc9fbcfddd886834b831a4257b41a040452de47f5dca7897ffdad10e10a93ae19c20b7043e9ffc87b22838327f741198d4428a09af31f8e8a611c8f346ff6f37aa6859fb29814fa1eee2e0fb1ac3fde708786718114b4d49dd14dae1b7b94e68bbfa71dfd884f4ff22a0029b65d3079f3eccc9f4f47d3f52bb23c439ec66ff375072d63e6aa7e97bcf263d173598dfd724f79a3a20484a21fc4ab696a1ceea95ebbe660e08e287a73cbf812b736c93f566b6456dcfc3c0c1a8117ee83e6cbbfa9eea4228546653bcfc7f89deece89597ca10f6178aa14a8fbdf56c2dc7e1ed641d24c03cdfe9c805f4ba5d09c635e6d6ce4775628849b87b863fc023d885810797925518b519839cfa9b57117fecfdd3542ac671b5c872a8a77091c453e34750ee727f4e02a21b6522f992bdf70917bc762f1c0d0898fc6b1fae44e44a2fd4a7b4394f212ed2e260fc58ca2ff330ec1007680c94714451e5404d7ff76108f1bc9a2fb5bbb34e96fcef51895a61450559a01821c1de00b832e809f1d796841ce9f9690fe60065d0e80df90b0c7c0ffd2c0e210e255456ba172095e5b1a2d396bffa0c9a9543b71ed91b85e5710bebf80a63a6f27e14f5c2af61820bbe27352687327501a6084af71b8a531ddeb353d0f461959c1b5b10c10ce5586c8998309cc5070e929fcad10cc54bfb17a815d798c192e45c170b1491b2951a6bc1221693d388b0c5051f110f4bca76716dca249900be22f0075f9df9546c063c9728e842d981da63629cd9b30b52caa12f033f43aeced4fc44482426e5cafba70fcb667c0229e47996027560a44f208c2f9402bae30496d222e76555aaa1360a58154f584e783a00130172c40dc97fdf54887b957a11457123c0a7f009ba65240d3262a37ec167e7773dd93d352a3202dd7e6df7a3187a719c2ebbcb22aa7a01439253efdc24b8b0ec70dbc9b151d437ed614d553d4d00d0e98f460d2a6fd22d7d1cf276c130a18f4dfbfa024d8aa9970947b68445463d298e8da2554312d916f8d37f485985d113e9320ce56f80dbb31c81d8f7b345aabce141426e90b5061772f85cd8bfcc897e8bb89aede11a6373f54ef647a44c1adc8312e371da7d2589c6811a42af7d9b6bea96d7f13c36b3644b67b008041e975125c7267bacc5d9460a1e037b75de0cc52b68249224962dc43f56c8cf10552f329ec9865862e1125c7fd25d997cbda1221ce769725daafecca24bb151dcfa3eefb6d75ae04cbfaaf0b258b9c8a18ec8c748037155786fd4ceb068deaf914a21a1210dfe47405fa2d9bc19f5c1e5ba07a95c1a8cfda7eee5128577ab5b9246bdd9d5eec0f2deb56e829a30801687c05e3ffdf4dff26ae3afc0dfc73405e15050c674f17b9a2e4e25e3df64c10151855b789550962874f18521d482a3eb4dad90af712dc014d6f9e4a8d2e7099dd2d25327a24c068e58a8f358048a7e55e252331ece0218f7ada2939c6f8be00230333983602b3855139ad9e5a6640711ea8ecd5f9d1abe0eccd1dd708cdaafddb59aaa2849440cb46a7b92d77e4699fcc790d74cc70a281a33a794af0f01c1abcb1a14b0ed82bb7182382ff8a6750d9d625d68a4a6ad734c35e66e51ffe7ec0e4707f26dbfe6d34b886df78a12bfe6ede54788409c0c10f8419ec3f03dd497bd92aa59c2fc47edc01551d8a44654c8fe72586e32fba125ba6fdc05a57630a6af485ca9f5fc69901acc1969f51b7e32fc5c21cedfba1d77ea6d6b749fb9353d04f2f99a5e69ca47c58cc6eb677490de6f3f64bf7ced66d7d3152112b5f4dd3bf9e9a96a6623d2d7f875a8197f9d957094cfe0e61cbb36ff73614cccd26387d0bc4697c05b2563dc4e6f3cf6038a9d48539f183d30e96a050182b77d04cc52d68303d0746f694dead969f3e039140be4d90daac2f289107b344348355b6c6a95d5403c1612afb86aa359e9b9c787c761b78fdf586e3bd7cfa4eee9c9e0fbf781ddb0bc40cf9164525c99903fddce3da2136fd5fc383f434da680510bcc42f3e6f72c70165e60be623ea756ea908bcb87202779927b0ddd1b0da3855ef5be832de50954cd6fe82b3d21f0b45d3668a2f4b779fd9d662b7d175ed5d6cb2b4d9aa609d4e846246bd4c8731e95ebf86ec752d51b2d09943faf4c6e9b7e13b7b73cc203b5201fe643802be535792f4cb639a8d9bbf4cf77a241d08d05c964378d31f2a54a179987bcdd98d5f7903546e6c2644e95c5148e884834be19ce3efa69b305e8c92708f83e7ccf9cec6d4d2ac7146d11cee2faf14e1edf5406035a730def565855523983b3c489ccf34d2305b3c78447b499cca198bb1cab58596601e94d0991cf63499e9fbd803dad961d5750bf9f8b4c90a8b30430fc5011bf92a83913b630814d41776d4149940510283e7b5cf83c58646894b2ba48bbb6f04a8f738651a7c5763ffc3a152a93d22444f23e2af4805fb4ec6c527d11a027839e6b9b4b87a50db2dfb3556b64f7145247458003a9e9d329b034931976e8e7477c04185e6c97e3a49f60c07b50bd88e97d09c62a1da3a1e365422a9ed0221873edda2aa90ec03c12a935be2897be5c403ae357042ed3554f84b1a0edd0934feed7298715348d77eb49a8ebd0cf02a478f74a6795bdf4719d07b7b6d22f745fbda935e4b66b8c01f39a3ec1dc89dff8a2a8894350b68675e9c9f7a2b9a92281408e72ffaa26941f72663fc9629797f879c44d577c5bd095fa9b26311bc143cdafcf205fbefc91ec0150bab5bf6c7916e21151a74b258f27759a67793ced5a1c74cf526b8f332bf4c3aa4f5ea4f8cc62659ab59c60436e36b1090589a41b8bc3fb9799cb5bd890dd20159acc2784d37a0bdde736a5d160987f31d6cc9e1f5b2aa5811a3a64eac18e136fb670687b1f3f52dd4bf6f4ba8228f01cfbeb38cb9cda7c685a4a198739323a8d44b6b13dbd60c980e761f3b0e58150e1cc6760db3e9aa1310276eb7877bab545fa0d40121c7b62fd99da0e3294a1ecf950e21e2aee601f15e1b3b0be18fadd2df0c66eaf3ec059cb5c5b561e802ba67d24a0d034326852615d7d8fc592b535d40ba4c0a5f38b27ba0a31fa3d0405628650f735ad0ccdbb9c0ee91167e38be9b596719ae5242860ec2d3acc831e8347c205a64361aa121a1f37a17c95446f4ad57526774085b6ff6813ee6e94e82be2686d6625fdb47b6a392df2ffeae6aedbb99598347978d9626b5f441b614c33783d70529e18fe8ee8aff0a75214b30ee48d214f84aeef8e79970eb2481bf58a03fd387e67fe620d34ebef5d06b3c028c9cbab8e9c780a7fd4656549b1bffeac6dc73d0044331a2b2f87a27989ba00fba10fe5cf0e53e0c690bbfff76d42b351e15732391740bb2431ae547e6bb6ec45dd46e970b678c88b609a5779861907c7259d0cf670589b3733c4692e6b1b4c2a4271b823ab39cfcae94b2122e14440e46d7544a231e16efb85cb32e69532c13b8db1c9f86d92cf203e5c88766be92c5635723f6ca80a933270028065a6fdcac62623834c11a62ffe8f94337c9f3f9cfef0eca88021a41d7316ad3ee28c1c15febd6d096185415aa4433ee1e13b9675332cb5302afa1ea301cdfba624f5e33fdec78379d83a761b7e6f48da7e2f04b9acc40645c0bc34a12c9836bf4457637c007666fa4429e2a3b870b29b0670f1f31c98482f049a1e0006dc70aa1d61c1a03a6cbb3151dca80c4cf032509dacb9e8b57e39c50909a62df7eec636cb5ab6841ecce6b1f3f3e7083854f71e05046192c33009834d93469d67edaf70d12b1a0d891acf4d7cb1eb2bc6013019c0d88bcb27d5db6e44f8680f530e542e371ded774a992a987e4f62d5daa6c476ffc5f55c84c00ccaf33495f0368fbeb53e266ab7c91159dc8902bd962d126e378b46d0a0952cbcbcd6798d84e83cc2d1322af97691a6c880c49ca5803f825addbe318dd6a9d34fa15e56f0f8158002dc6044bd3a9fc71a0a949190b47ee2d125e29ce6af9f71c393f652ce9fa43bce6081dd92551078e83b9b4c7405552ff5b073b200c1a91a07d5b5ecfa5eec8a332dea6291d5eba067a823000f74b9078749093257e1c6262cb9fb763c184d117dd20b2ce077bcf9df8b2576f38da335a7c4fd13a854d153eb9625c0df27548abd3fae897d876015a726ae43f566918ed5d9b6befb4022dc90810a5ca74586864f1228d772461ebcb4f2aacd6b622735cea211e475d9b4ce4863f16a9e0c2143595ef7cfe77cb8b1209c963844703cd0d53d3c7ae05edefe368e69ebd961ed0b37f2ac1993f3b8d84f3b03bc4c7c8f565c1eea3b830284f64cd91df3e440abf266a5c4af19c595b20a0ab0006813ffb51d8441dd6fecb4a407d54839d96642878a47f8bf7a5eb31fa17deb0041d7b3a29acd0ad6eeb04ef3ca6f789ab15da2c6b743c146169586da9214f2246423811b851093da64fdc5c3e5424769bf06189500250d2cbcd5db743bcbd576f92ef8d344aa7c85d0454ce8e324b0116dd7ccbc96e09e8588999f2a9c9510aeab5914e81dca44a87108102b3da15d4956da8b7f54d925395712f0e19a80894f5989fc43c3efaedbf2d76c522b6bd7a404d530169691f224c9aebc637de5d67650d5f360e7edbd22b91dce8a16c052f48b6ff66c85cd65e7783ea36f363a3c564f95e6abaf6569dbc0faeb0703adc1085bcf6c482a3f1e83936b7d5208dd50d112d675d882241c58491a38cfb6785c49e6f59c0383c2baba03c6bb044b6420b653718415bd8203b577b2eccd3117ba15757e92f7b736a1252389726e2987d07768e8ae62c459c81930c0f42ffb787b6fd034bebc2de8244844f851b2c6cf1f28f3e847ec3421a90f6e69a41876aec25bfa4e23e8665e42c9129c371cfb248144e2f3d897598a97901f5ffb5671560a5c3a8344d6258213bf3bd3e4bf393194943f5ee5f6b8a328d27436082af97d5711f21dc6c2edc223f2621720a96f698879494b783fdf8b5b4d3e845983bc3144cffacc947857d7b4de2297bfa70c1a314889f40180a82e76eb4eea1699faaac3a94eacd3a9fdbf6ca0f70107f516362aeafa7efe5f361364389d3f1a5e8004bcf42a1df4f358419c2d44748189c0fc09b320e56b6624e3e87772285f6b83a7b1e86db951be5407de207ee9e485c2bd9762acf03da4bd9359a2412ea68215812150ba97ecb66ea43fa0f640a57900faaaa5b8d14ca49f40109d5c541799341febf172f6604fe3cc063e59a554b0bdc3848e6b0a55226f091f56c8f3789c86bce9829cddd00a6c242a69bc6d872cdb4ced159cba003b8713ba0def563a5890cb32a7429abf541d01d183a86b0cfc50068e3464a3147b5abd1f5c018145bf09b283a50df2a544c1e8db24bcbf4e9a1da632a6889f36d26b2a3d8df107d786905b3c2ca27cb9adaa35895eb9272dee8ef2572a1cbb21c678a9053701fbe16716d4af75b68cdb978bf14b78d8f73151fe61d558d8b86364f600e1bd5a918144597fc10eaaf620c6113f7bf5eeceb329850fdb2b2ddfe3578f5fc4b5fb6f4cb07da2705c12bcb1dbb24b9e700247e1d8a0a97dc5c981ee4127a14ffa3a498bc34b8bc9e4f0e0aaa34c676010f1f859bf597480c1f20d1845caae0df37b8d6e8a905bec1987617d085b730a25f71aa9f5f3d9429640232bf893771dced21e60921eefc672d6ed634136c77b3df1970333baa8184ef874cc85baa0fc65a9313295bfe4c967d7ee3d546e8df452d0c82b355cc57471d45dad15ac342e6d89de4d4ef1b756fe43bb279ca8dd77e673ef3deb35221652cb8fd1af65a326614963862857265e2937a7d85471fcfa78f24f97db61f26d8a2f4c49080638860bc90f81111847c6b2702bd0dacc2c28134db5212bc5bf4c64f32cababee048264528431f34201c2e3cfaa67ee482c96febeb7cf8d2ad7ea938a40d6102fbc8054972a5e55ddfb2f9cc4ad3e98b8fa95fca06719dbbb28dd6a25f4e847a17b5bc1f2a0f3b631bc3a29be69cd676c92372acf9b9556054574b065a3821a75203b3c0a0be81bb5fe149dbff6384f02fa6f4008206d6b47f09c798a7f06badea72450373914b8b2cf69a6b597935e7fdab1963e7bb493a1069bf2805c0a79d85b07f818bfdd9bd6da51f0fe22d463e5cb7aeb229ccca1c918ceb6aaac35c80e8f4ccc4146acec3ec7bd2721f4ad15668a9699bc765d43735b41c11a04a5ab9fa606ca083bac46b504eacd552d94ef0b9ccea80c2b8302e352f38e3f7cc9a29cb55fafe71863ac7728419a85adcd0772a11cadb08971ecc7e3241b082a0e878ccaf30f5158ec77e76b0f28b8f90138a15e769a23d0eb8a3d81206edb79ea6a2f7bc32c87a63fc0253c4dc3d634359cd3a3cfafcce78d1005fe7fdfcea4c3a26b7aa5afa39525995dec3b65c1530a94b6d7e6ac214a68dacee10fae99a38fd78f4df1486e9409d7a97980a461369c011b554e4cff4ec10a417dace700e5c661e7a652b1db4ff9a4c25bef66aa3fd0aecc7a2b9c3d34a3b2c6ea78b96895ac37e910ead5bc11aea9e8d090143d18eac95c8b82bc6f7f989665b56915a6bc991177cda286cd92db82aceea999cdc65b800a6aa687d3dd21160aa4e9d110d6e8b0e8938b7c6fb16c9d108dcbc9620882af9d6700bda0fba9402b23d1cc15583d0a5c4ce806449326b20f6c6013585a409224f1945555c7365bd349ab5f7353807f4fc4efc4bef2d98034444fe7a6c08b72618df6435ca425b83e2fbc4be5db484bfee1380e90dea02171752e40fa78a7f083604b6281f33d762abb4062b5efdfa14fed05566730fe9ea344a3ad567e5fe63c4c9cc3ffa7df2b75d8bec4198dabf1a6b5fafe01e19afc488b7acc12fa34f6845c772f07ecf82cd38ddd75cb4e16ba5a3653151f2450ac7fda150ae6e590b71848d62c84b42d6dbe822115df459b9f0da5e713661b3368752b8f1f7b9e29fbcc4cf373e885accd8507b7813d8d2588c2d5a0d3f345fde7a2178bafafcf6add4b5656e88b48fde4637e06d60a044c8f41851ccf95843c7954569c41268a6fb664783ee73b0a09cfe043d53ede0ab8bd057b1ec329e46c576f48e6f88fa513363654c3bd657562dae42cc021867350228e5ec7fe8c357a5285ca2d48c9944333b796e9a90e0ca7e864b5bbdf9c556d89ffbfa4b5e708eceb2f08194aa06fbbe057c548116ad8367ab65ecbc73311886f38c5cc94de2d576b4982460aeb45e56db0b0bdd9261d843d0706c67517e273e28d8d31cb60fb0e5d052085da83048a019ee3e28c5fc90ea09f6386f082c5d1f78ce691d83df66a6de42600938ddfab6699f9eae21829d0fba9f4313f3f9ec6a6db1639312b52cb0ce70ec52b438de8e703252c57da6b0bfd430640c7b43e5678c36e4714287b651c071d3c8862c40e5e9bc5c7fb1af33c51ad7485ee7f6ce7165be23c83642c6dda992210aa016ba11e71926d69f1cb1a8e3e3d1a2cb7ed140856cdf5cf95abd9609460cff835c470a8b35e2e01dc54652a7a7b4003dba1cdc01076285aec50c8a6acc7222e85460118ead72d04a21161077eb9003d08127eba96c4370c78ca8e968334415436989e4cbcd8c4cc7af28b655b979fb97b1473bb0b1592e3f229bed7ab070e1a46e1518ff313d609ee161d7d23cd91558f0e5051bf6dbb62b2159f0743c50030f97c1b72c9e7b83a0e0788ff7c2e48a33dab82cd7fd2a9bc580ba1ce312e11ca9a87e90edde20b15dca4d3e895f7b63ad8429fd9d7a2c76cb8eb0ada6b09023fab18b4ce68e57542da86baff2d6abd7d6a5f8beb4ad1b6e5dd89ad6f3efaa44f1aa8d6a678766772fb2792ac5e675263659d9f330335d94ee4bc483e69aa909ed608b8d142656445daedd5e8a4e777d3a5875bef8640334503ee366e4c2d41286bb8f6a49dd34c7c466aa667a238bdbbe2b4f26d6506938dce9c7213ab53edd50e4ca2ec072ad5b45d1f9fdfed49cb84c156ed7d5cab408d1dd5d2b61d0fe004b3104f916a5aa81d90d402508c4a2f9f57003d3e706f8c5c132217880e91d16afdc89f3aa68e1395c5a68364aa53aff5a65af77803c59e0499dcc46f78dba5b98c0fb601774b14e451888265598b29d77f74ff8a64583da4a3477b74523f36047878887de5dd4423995a6903feccf2a387ee484d24a7e42891f8864f741c6a173edf25ff4e04e32b62685d2a5258af9c9069dba52e139bfd9f9f6bcd723023324da59936777fc4c00891846f0bb51c82b8c30db0f90244d8b6a21b1cd36c4ec00967669db8c8254b4452ba5b013a85cb010b5e2988c304e061d27e9f85b9535060660adda81abd86801ab3b9ae72d91e5c6b022e000fa7239f61ee8927de100db8cd7458dafefcd0b6b295eb198681b35712f37ddae3b06580c6058b4d6f089a9d0f92a1dca943c27b22160b6c8260399e4dab9c55ddc3f52faac1a092fef18b550f5cab8d09ec8c84d28e670ca1f3b05b0ea2fc68d290dd3c83161925844eb40cf9daf45ebfec80c16501a435b8042d1a07e5ed9ad08de429f532d3660396211409c58fbe5d0aa67eedc921e381f08a4288502cde796fb5e742f66406a8fc5c833f84677b0bea0494cb60bd5652155216bab3b70890d6c7c181cb37445a5315c4befdb4cb797e64cb5e98826603be454cc192d933543ea1cc80a71e51b849f213d268478fd811147200dc6cd41c8bd8f4ba9cc4f8defce76b0fd718dd1481a5164075555246e445dcc2734703c94c39387947f147f0cc401c23bb2c5f2c9654ea86b1cfe331f0c04d0d08a8032aed0326fe3f9d6b3db819c1f42d1212f1aeb5d439a68f33b69ee4dfce5025d0fc68e522171eadb7a854d50ae483db9a6ab485a053a833e8cac85fac7b5e5d165b59c3f051d7d69d289fac711499ab10764dadcef59b2ef4251e7bd0b76fcbddcc076715dc22a17da170a74ef25d23ebb1d1da50c71d14c65fa33bab781b46fc1898465a9d478f6713842e75721a55d31e7046f6d95377e41c6e05747eb627d1ed0a73ad77cc38133e27e33449d979a540f704207d30c9c33e1a5584eece734d85597e3f3b066cc381567db5155fda0b88bf26c9485f04a1ef57335dc557e2196cc015b4233763b464159ac32b270591aad9de5e9b8c4332bf84893f81ac119100d769c3ba0cfd6a604e9bd164e684396a6b290bd7c7202bf52db00c8890a1750624fb1780b5065d56c428bfc0994e9df13aa22addcf415b9a69d5287d7eddc2a16878ebaa7e05e116be845e6d5acd741371e694b40489659cc0149f451e90ebdbee17ae95a0bd31782aee4b733598898c19fa382e98caffd315cee2fb21d115b184e169552a84422b66dc268d64c648838331b8f6d0ea8d62ff7cf69fde3d15ab5ba6789cda36cb232f3a6fb1a8f124283171aba318c3977bc44709735f3e7c016a8708959bb11b2abf16d1b792e9b73ac6f530c5aea03eb9618d6cdeb06a98ff26f2a6a8cceea0d0fb38028b965f2a13776ff6768b2c59f4aaf9db324ada27ed3e7462da3746ca1a1b9d1a9fef8e805fae8dfe30541f711786bf1579abed6bc7e8c3a67b5ecfe010a21969a06f81b0ef772b9abddf18971a9a9a0c719b2d5aa5d854f6239a328985a7755451e56c4ce4d4724c1ab143398d005118c15a7c9d1d8a0736fe955b9af4a01b6bf6a9f3dbd9e016bafc938982d1b9ae1d1dd8fc9ca0ad37ef31d1b98ff27c8971cdebeb6402b368236d7073a021345e942e569a29b01f2a978eacf6d43decad0773cd9403f16a77501acf779d57f9b932b4bc4402b54d69fbb048275af097cae6e15cdd5b5643ee63b1ea716b7764e45cc5d98fc3bd458cbfba27585e9ae0486e6695d38695b7eab30401052646814a596d3603ecca3e1f29eb0f7c7f8f6380c2a210b76e9fafebaeb6e34b0e716b3e9ecc2a1505fc95154e7604102d8198afd936bbbae39a8a9293a7cae5f76df6c110fd0f149f289beb17b69016d43e5516c1e6e7b3d6c5a358b2b826b1771c84a8405085fae07b2b1a2ef0da25cbf9367d75952e86ef6a7c65ac8e77af2117667bf1276fe31f4778c0198c35157148390b10c89f73d2a6041b94e1d1f6679503a477b26f0e5b6b8d2b87d8d5f7a02991f22318a3d816d43ddd9919407a15bd8337c1bf0615b35247061e4f89bc0dd1d154010e7b6705fca7a8da65196449af5980c4ba36f2f390f5152cb76ea6d7c972088d0d13394ce5b90d4368e23eb9f64f85976d48c9b7ec11365d4d85a9aa14ecad034eb881bc2946c984b9fc69bd18e6828687cca6defdb81c0e636f7aef4cdb4c289361ddd09184ce84ba0ccb4bd32dea322431895f381c977949bcfadd742270a87a425951f7b567edff7c2aeef82f8dd57a104624eab2ad3afa69078528866fcfebccc31303445fec4536c4e8488846b42fa1c4a1bc677c358a0127881966c39580df248cc9d5b5a956e0f5c83fa9a9b5daf5c5090f450c1bb3cc4c5f18a1aa4e85f2f070dce670674411d293965eb69f33313058edfe45111dd37b86ef7445d2d20c20c5ed4c6d927b4c92d3713a51c258596cae70aba2525540b5e6fb41fbdf88f4a2791187d5b52a92ce8d1a5497650d9d2e5611fe3e809aa9ee94c52e4889c62a2e469207b1317975bf0bab9ef0ff806b14063caff593a99f4152f648f66ad26bae47c89c13131fe913ade24f8831fb583d8be530a01ac38f5020c2b239bacdef3a6e84e04462c060bccf8ba946de4accceb97f7128c9fd06a860a88376d9f22663ed65e1c6437603d4057ce873f3d1a0f6ab957861a06eb2e7b2ff9754484b59f776a9291d5a78385fa9138c496f41ff891997411a356857ccc712a0afb3081598f90edb67f2bf978e64ae8922b9243b2266eb9bee98cc896ecb8708d4c5b1a40a66ca049fc8204d069b3b885e4d795b50ff4e6112e49e1c2f3e542ef18890eea87495a8f33be78237366fda43e2115583e7188c61c3f12f39b7fd361a734d51d7e5d252fe2adf464c7d903b087aa3d74d7c271621b4ad0f417f1190596a7e7156e7f474ce9d5a301185e45e7dbe76ce00f4aca3fc9265c5f871242bd1b7e2fd90fc079ff36e373d00ad4ffbbc35552eb86dcefab45c025c89cecc05dcf1dda3691e2e0e87de9b2c52c12e0bc6e248f9d944a2f2e9eae8e00a66b979a8da97341335634b2c1127fe6c246f7986390e25c32ac94a5002aacfbd2c7d0583079b1679b07052b19bb665e73e7cb7f441ca26fab5cb12222efc78bf245f30518c3b5a614c0e694d6e392e9342e296aafa72e54f3f2aae23fdb619802241d904d6af775262e984ae064db7615908448ed963331de197061e091060a2509f2b8e6c8ace632df9ecf31459a980547026b03d657fcb25dc9afdbf36e6e88fb194ca7cb0b25470a2c9d247cde76dc9e5b4dba85d132f4240f77f6f2830b27f977963f3ec9fbd342989119f08449647d0149fad5f2155c0cde9aab295ffb138e0c1a1a556a41d1a7a915b6afb4aaa197c66683bf72ea0effa7dffd955b7a4d1658a779e39f43d5c89387cc5b9d81afa1696b24c8986ece24267be267cbb3e374455a6c7c8c277d8735b599dd578552430d7a8c1611d7a430dac1175896b28723b484f73f2416a1ad3282336892215cdae8388f6053594c6ae9b1f85d1a6397a9d6c770124969b58793ae6254e7d03208412f630eb49ed8f3c06986c273c47d94dd1ae92204770e8d6a8769661cf851fc96459d65bcbd8757f557b27544646001e4c79e587b69553dfa80f4a686395178522eb13f20c847b91199e1e8720fe4b38f641b1f5dcbba11831d0f40873ce783c2f64cefd85a8ef308ce65f1bc13ea4c82b99c251aec6a194dcf6f1cff9f36dc6f4bc76060cfe9353bd14af166b68a4fbd9746b51ee2d45dd32154bf7045c944250df379f14e9d469ded84a5ea7337227d12d296899728149c1b32c38c07642cb098d372ab3c6fd074de16204e5a2ad2b3c239681c53640a200b9171f8d1d6627b75efc2c307a163d3511903219f7470dbd4c702968d341075f630fb6516ae19f072dc8fc53c2432f14aec89fc239fb6036183766a91c5f4f0ff3f52cc2b0e3b2e290b40d663b66d6daf59de0d87c6067ddea78b8efaa8487af36f9e6dc81d3d22817b062a975dafca206b579487658f6c87f256ce0b04dde016890c13fd4f4dcfdcabb912fbcb6466d9270b2c8ed4e2d7fc83eaf388ec79609367971914c202011ff8a3e20117205c64eeeb9964366b966421727998456a65bb82d0f0e7b3db61db5307475b5531991d5a5e5bcc4253255b0309716a41c353e1d6cb4b21164de176fa3a7763eed19b548278d53d158c3a1f870709e446db66b501c1d07a22997f356ef78fae411b53b7ea787f342c54f6c3cd7c701f3b098509007e33ee6c6c4e57fbf46a6d8a6f0a15a95fd29c1526d31391e1054f248f985926ff6a1a285df92731370eef6c48347f72906be030a0436e9726895e2c791d1b43f09e810d810bab913020aee29b9403c546bc536520bc7adfea83979b6e694fd370284eddc5505d6f198f14652b82e3d5c7538bfb542b246b6eeb915a831507f6978dd3a73938a0d0ab5d8e5c570df51ef1e069bacc5be03b4ab70725f0fd9fc831140620c23f7d7c625a9d8bc901f7c741a032fe96cfee4b9445151d2a3895f6836ce86236d5cd41cca100ee29579c5ac64d4825d1e2c872176169daf557295a4a579c81ca3b70ba676df23f5c419242689d9a02a39a1204e2de4323f99c699627c0da957cec1834842dfd8e5527bb22678d9d12ecb7641b81735ff016893c87e4371d6afebd83cf137ed5b76adc6d83ed336ba92b2607dd499569b501bab91827f41e61c76ad1a4f57b4a564de3bc3caa197f27a6a57b4787feb7a3c2e5e4d823c4c323abd8491c500487c36b98cf64e8099bc656310d65ef8917b4173a2805373c1c4c3ebcd64538024dad0cfceddc79f60489f2e0ec5df2ba6a72898844fd6057d1b693aea68cdec26fcfe2d3979e8079ec7a767d7ec7e7dbb140324d69b62c5e60bea016e979462c349b32d18ebc5c71697f4a22430cd4a8bc39733f6d4a81dae09d79db0771e5a3e49434083d64dc2f497f53e047ea787a4dffb625172cc1378bdc28b93481e7344cc6932e90fba88f955dfb1e987587d5627d23f79037d5473069a91f94fa8f1f2acb5afb8645259aa1761e9f92a6a199e2ad23f37e858c1087808ac0af9baef106779066f7c58b5c19ecbd64d284400b28f199c4c44efbf9fcdd58191ea26c09965b813cde5f3918921c3946b85516baba16f5dd559a97e98a18ed954e414a1713583c13883174b83b362e791c247934e323e571846e7db71b4819caf42a09bd37d0a95365201c92abc18e3e6dd558e66c2449411e015dc164c940835247e3a77706d7cd767d0df1d4e1ff2e72183094f01c4afafc2bb29f565af8fa902f675eba8989dca985d9e6340c1d0e6f6eb363b8eb0b0fa4504f6584d7637bc3ecf45e39ace47a336c2785e5f274ec79f0921105547b5e8718ce4e9e966bd742926133bddbb2bb8ad90967f8fbbd2c684496f72a3399c891f2d7627777cd01227c81a17834df1221fe50e65875e57bdeff97f2e3782dc172ad4c3d5b554a0aa68268b42b9cdbb43a52c5fefd36f4a672b821b38acb6bc83719f563bede2cd52221fdf055434cd37d2eb50e54765a2523af8b009a1c5ac0a0788fe7a83f8416babb207e4e422ec1e4191558ef7598d06323126c05c627d946a987ca9c776538b2254ba8ccb3a32daaf00720d4c4dc5b7c7c999edf4c7adca78fdc16dbed7e1a4604fe1e66f5dd0d7470dd9b7c5562ea70b331708f50f9997158fd874d7c4c971e322c39eb1d971ced8b933d5503debe27137197fe90e158c571d21866ecb08dd9409695ef750ca1d457c6393810088f53d98eea6159dbe5b9a0d7e2e7055f5d5005e511c4c79047b88e848758598035bea58c0ba3e84914fe4396fb5859cf070c6f58c4482fd24d856340746e02629318673b92d573171425c83a580af0f6573774a3a9f0110f389a9f17e6cf6636ffafebf1c0340af34916d9ce95f8099aeda01fb29a8cc7cf8ddd5ebcd945f3f34c4f79cadd3f8f8fbad0ad85829f84d455a9832925cc19b69ca2ed86e7c176333db5aa1583de92d3f862937de26f8469b05404904edcfb5c62b9ccbf0a48a0d48d278988e81b524e39fccadd4dc473499952edfa96ac1dac0b5c1fa5df6f5bc2d1dc8768a9240a5456fd2b7d0a4c2f517bf3147d1a3489585fc3285be358dfc466343b84a88333e7b3495a61cd69f38db2342e6e6a3f446175611fa3cbfe244df2631e1a9e3cc3540d49772683219fcfacfc99830ad71ae113db9c30a281a795ac57063223494e49102a0b3772131304ecd1a97c8187c48efb7e3f686b6d159f308078108e513b05b3377b1c1b863e83978d53dbdd47244bef225d9515f2440686f4a06fc5546d1480139995f4764da9d597ff71cb0635f4e361a9ee7aad9506c192ff97d15a161be6e3c3c240cb696195bcd760e7fe4766e58229ed891ffa5d248027bc475f43ad71ef4fcbf9f63781d20385936ca6ebefc098fe46bbac1d19987cbca54d552ee9e30df0730724e4ca405580d7833ca21b8f0d67cf1c347c0154cf5376822131a275e8d6123412e82dd4a836b00255599469465e790c594eaacdce51f16393f95d95a483aca5dd588e30fdb63cf01ea22a713aef152893f353a390c8fdce61a265616b1d115d333493d0da4408806f6ffce42c24f4b97c4a6e5b9bc40829f60390324ad730c1f13a9d0eeadc7eb7d96403d08283085d37ef1af669fe3e552b50c96fea85cba0969af9092985562a353b7e534e32fe7965c7789a67ba75a4099c9b9637d30285715f223fd6827551a2cf89087752c3b7d3eddecf13a5249b8c378cefa8b5d1292609f74c37603040e3c6819727dce769937158fbc7ce16d205a382a90803d13ca68a5256cf83a3691e6b30d69135b15bd835627afab5652306a6b1d89bf40206030c549cd582b45e18a16db71d28ba54ceae2776b39fbdd742dc338e8ce3e466a780437e955fd1e3b2aa03f6757529c588800ad515b556ed27c3942b722413d8222b774697dc3451be9bdca624c1865fb0102534511687f97899924e9a77502b7d90c092285780bebd4182165b0281b45d4e69b8ee3ac15d173d8cfeb3dc8f53bcb6688d75f9b90fcef49b05b314430ff1297905acf9cc822b8c6f6510dc0ee7ba082b83be391bb2cd9830a62fe5dac9477ec752e42bd2ac0e2ae335b02dc2f9835c804e4e7f4c4838d30cfa615e2beadd2ca5565240e032f37307dcbe74444799e3210e89544c6ff458a5d39d039013f08db2e98647108b4f3444ec7e4d7d98a7fade36abcdad048aab0b69458cbc68a6e047649ea0d0e2020456d7f8e39825c1d9b9889aee21634fb2eaf9905ac260b0c97229d5633dc0e5de5d3ce669304df0817503df6a4cd6ba643597a651de20bde3604e9a93bff6fde5fc9b5a2f607b4d876875a5aab4061aeeaa388b493961c78af02e90845ecfcaf4086ced90aa3d29774d33ab9137d71056dee8136da78f52c38e69c398a39de834f6ee66097d36ea67bf905410a8301b41705fad22dc0c7811dc2f4f27199c3bfbb9bb9fa8cd93f9a5a39126475b50f7b6f0e031844d2f69a42df5ab4da4ecb793e617539e42eebdccb316575aedc0dd36f3a786431feace8d703eff8eba9d3ac0ddb156f8fc39ea266a8acfd71500854f2f7e0113042c3945c9fadd5fa6e6e132d375cc85bcc577960a2095aca08eae0a5d4b9d60b18e02f9f601dfd219a61cdf27eaa7141867ae0d14dcf562701c86568df5826255f564eb8b33a399a27e62896cbf19550b842af158a1c7f01b9f7562121015f114ed52922a4bf0529e1ea4e0737b49743f94b63a11bdb1b87079a166f2aa67fcf621ef74ab63f5d276beb4c859a1ffcb9cad221bc6ebe257b823c60b1619746bdd4e6b18025cac273b19d420903c80b40fe652ec481a89bcdb1cd814fcae146d210c1914f616418859ef20df3c3d61c910a1a95d0d4c8348db8df9b51e4e31273c58ae9fd5e122e64c6f00fb420e9f5a8a4fd47c5af79edf4ce8dbc78e7402921477e5b840078a5d6dee630a6d9e0726f21376892643734b819f95d5a2d0080b20618a5ff936fcaa6d77e66977dc8e52b04a2979530c4f9d0538f2fdd16418034e7269e2501a5d2ac113481622070881737ae64cf01a583e44cc9f2ad4c6401ac8e872fceef042b1761d329337b9812a3f94a099536966978fc3dad335b441329029dc3dfd1b7d156762a02133bd60f1f9657a679a3a90786f69e9c79330f8bfb59d27a0ff210384950d50438d8196bb2ee41245ed28f474c9a22d323bb58a6aa32602e979878d3902aa1c98a2bf3b2d88779fd94413b2f8e408115d2edca148e5af211fc84ac8519a7fd787dd03015449735fc8e8dbc2f3d605ed0d996136a487d2632af86fe850088f043a716aceb6234ca267769a41c2110b64da50e3035e079301eeb736ba946417165f6cd8af213a69fe07c31164b3cf21f49cd3b6c361f39aa7ec50fd65929d523861e30e488b259590898e39f7181ae9d57f987b8bc5d09cbf0dfcc05139d5d2b07d06ab3f76908be48990c2d3060c6f9ac693481a7dcd370e7b7119caacf9c15fada8b38ae341e84522c4a2bd80f490bd9e507f7ae2e6526ee2072f5e9db6796c3adc4ba4684dab82fee8b22b260ae5fd617d9cfdbdc60c9f975df662f494f4173fad342f337e7572ba9ae25be1fa1a4500b61616a1cb8a9e4c4869312926fa166db1dfe806793f0f91597f27d7dd3ef74b69fc838ff59163782b1eff39bd35b63e8fcb472652c50e11cc5b91bb9e53be02e283be1a0a48b9a04aae2ce4fb170bf5a438f4f6bda35be56b34c3ead341bea8ddc3fd119d9b643c07a5377241953a960067462580ad2369ee4e06d6a4f820fb918fb1ca8e4e3e2a60de2c3af7b4118d9f10a96ced1c9c651bc6420d92a590556886d3cab7b3625b12b69f9549bd559f4112582ed3ba6223317f1495c3abcc5ce4cdc5720ee600a11357cecc92ed9ec426b06e359140b8554b6864511293464222647dfeafc81db7cc85ca4f98cfc181e32e3165f06d0a935797b73fb8744a118404664b680853e7c261d8ac6d2a232ed26af3dec92f839fccf69b97f418efe01539105c1e237a0d2b78e9ab9008f7f7576c86a330a3649e285509fae2b6f09217536bf712ac40fb9142360b778b0a5b56c0c499b277d4e88060ba22608971603046825026e06dc1dca1ce1c9ee40f462cadcc676ea99460dec7bf6497bb0100038c66db30485d405cb0e937fa015259081e1124d343c0cf684975d5cf93702bfd034c7f1344339a85508e0e5b67dfeb82d40766622e05901da6aa7d10eeed9a33f3a24c60dac545276fa8f067b44c4a31fdaa3c381456ede298df32c8862c68f719dcb5cfab86d318befc7f25f0994c52d10544125dfea24fd4d696114bd87bc32d71428085ca7ebf55a2da50e206fab7d88aa7aada942ddf57046881236e617d94e0c6a73be9d4f5d93bc4a5a1140f764f6be93a0287969d837ff8365a498b88d6d2817bf2f2890cf7b372df82a9aac40a9a1c6e04def791ff32e8dc7908f37910e63dcb4fdf4f53ca92e56eb0678d790377d0eeccba57708806782e1b098bb14addceb80153c7e3decce5239acaae35eab6f71cf25adb35edb3ad4dd1343e5d5c5de491b42419bb15dae1ce93b1c60a393cf5e6d364ba74d8db6329532a378e81d3c6b4f06a614b5a15d12c09247b95c11608b66dd14ce94339c49a4163de46d95cfe3a6b3637506877061be46eb00b99543ea9ed2e7b4651eca28a7ba28b09350ef36e7c843d3e1db8c2fdaee2fb860a6fbf9ec1561528dd6dffae1366f0f16fcd51a9e4c2a8871590aef4ea873c15e457324734a4c255d80692e2c5d7e0d1fcd2a3a40ab8fb8ef8f218b3a0177db2c9b73b95f63ac7b61479972dddaa2293fae7fa796bf3484f187135bea46ea8d65bc203d33e2ef0120d25cf389f2173622b731232ac52fc7b67cf6ee7469f038fe221f7d5be2cb48b48aaf59822baf1457c585479e81d40e5700790007424ce5bbbe4d0afa334bd5500b4a75f23cb301211d25620e3516275f4652786c012803e6cdc0dadcacac09b5d1f823011a9fb91d886f0c50d0feec59636440735e85779b65e9da762ec6d56c8e214dd12501222fdb8a0f9f3ff46e6d318c55413cafa1b599951ed4a440cb6c6947057a08c249baf985626e933a5fc2d7693c0bd3249243dc4d2c2c6126bf8410d36b4f0a26336c5b96da25f4c8b9024e4a46f8c52f46aa7f88ebea83124022b22f4b2e188172c3f334311a444121f2d67c503c9aa04b8c0ba5e0562f00e1950c5d05ab2d625f5d7506043e75c8ce07fccdb00e57e9cb48b7e9b2321f4e2792016508376e4131370c1b8658f6dc7f5911e0e66d623a27df8a0ac9dc7ff17903e906d516304f783c72faaf69f83c739b27ba644180f77f64b909703ed1449aea0032a4c31ce45b0faa0a7a5a88a370c808388da8c9515c4adc0b3cbaffb76e3fe5310787b90ef284acca76a25cca683c332c0e1b2b7eb2183fe98a6c9ace85647690e56eb54dfa5b12d47cacd93a7065f2bc7293a25c3cfcd5ba0a24589347cb743f9b2b92204215423c8a4dc10747628d6f128f5be0a8fb885f7cc6dda2511eccb57137959d41dc3d4eaa29bfab9b01871d17b6e3047e456e4e76649c0e7e26b858b69e0651d6b43b318b871358c26a5210b93c24d4711d69c63f0e6be9ff6c36ea164c76476287bab5cd88678f4aee6ad054f640c59f660c04ef6c206bdb2a25f5207fc464cb923cdb114c71ed5dc0ce3398601bfc0e0b6e97b84ce9df5f0e7dc3f5d3ca1be39830de4097d0f865cf71344553cbca14a9c62ed4ba29b431d27519753ace4f6e960af4bc0aed4f8c075112cf7c506e13b5fb6358765bd06f7b8c565750ad91e431573356bec009c1a91cd32afed7b9c524ee735bbeeb2bf4b78fd5a7ad6763e6dbdfdefdf10e1b3b4da3787ef23dc7f9095079b88f11c2ac20e9a9c6e802032419a90a134301b1946f58fd62997c83e1c8a6161b7636ddc84df5ef8e91147a6aac1b56eef0162145fef832d36b5c274cf00021fb10a9cf56e9584a004a6f2510a0a3e5257efd755b7571b3413a983fdf6ae59ba8dad0f63aaeed0bdeb543abb58413a7f52d6bc19e05c41700fc98c0bdd6223108ed88a9fead8f6e76b5f323b85d406eb2daa683718ab6c8502cf430c4114b6ca5471b0519ecd995b9bae979f2b53fddb3e4ebc34d56c304aaed8d107a74dbe658fa95a4e24ed194feef470ca907295a140c4b930970da65175edfe50e249abe18b3d086afde1c61b11c6f783ab01b348edbd8504a8deb2a9a903e197377e565bc908327a681d7542238ed2a8179554d9d8d00b82a33222053eddd8d0a169107cb5af279769c0feee1133663ceba2d305251242ee8786f4e8eb41a4b157474bb7e2a43be4246a7026348be6c46097516d791e3a5620c0e31bcacb8572333055c80eb651c966060868584fca2b95bbad4438664847dab9517165da54dc02cb986473a9ba83b1d776ebe23417642ebd4ef1c497adffef35fdff2759e677e4f3f5816c55194d49b1ca430a67f9bdd9b70e5de10999bbdec79464118d5d13de1cd1d19945bcf797743431216d8c7fbf72a4227820dc2a86a1341f64732d4f28c1fb80f3c8349ab74b7033422fd7afe754678d1e5fc93f6ce3691c4ec81517e9f30cea47c2b9b6941ff5dfb35a49c51a292efecb5c706c790904ca2e34b992f4aad41737d1f7f0e07d85a4faeb7f8b07e111ce5b6d5939c20b015620b25663b298b9d0b27f35b51a50b6bfb48aa82d3e0e4f28edd2822c66f3cfb7e05d39c2bee14eff503781df19f56d95abc5af7d66f795e4ef471d3a1648071ebc3477033fe77840ff09ffff4f61806dfb8046d76fe10ef9a48d01bfdcb9e73a7b5dffff83e8408a166c44b2d7d89b88061d744f71b513085cd4f871fc629297dac3b8e1a205b523675d45f49aedd94d0fbd26dc9cb904f23368330f9c22164253328c484068b86d116505caaad49eaac574641d95ba3121b7b42381e19c63e42c51d7463c25d69f944616350983082bdfff8db4f2557a153c7937786b6186bbe8c7dfd386e6272dc2034721bf2f65a12662c171af00707301d3b47464f518eda046e3d29d027b8fd7a7335075307beac943f936e0e3cd3132ff488a87ad635d55bd92bd7e27e1d1363277243a6e6456e14bf1a7b92a2ea2231b4cc43e56d427eadc1d2db6d206a6f536091d36e0c381f2fca2868dce5dd02f7d241a4b28834356f6aef24d81908dcb7822b615091aa33075f8a9eb799f8437552131b64d63f8ace5e4c14cb449c22fb2f8384160458050d6585dc32850812fea2760cf6eda23dd67896c28beb17ebb6298f247230b8767e3af248d9a3b4d957936d1dfd47665e0b0010a6503e416602880ddf8432704586b7048fdf8fad1803a427ff43a6560885ec19f688d1ee6d8d294ede65eb0b419e1968f7875d2cfc26d2acee2b94fda28761618bcf7708bbcc3edd59dc300139ae0ca13fab5d19d688a6a845cf140636a7d23ae08e3b7b175b8473e5387096b5645cc5ae6f28a36f96bd45b44a7028a6ef9dc0bf5b4b204b6296b32eff47a2c42c1b8f7a25430f73c3b969866a3e60f8014b8aad89d36b61a66348e2bd57074de4e1ac04f9e1d6255094ff75358e807af8f7e9183eee3b01373ede7bcdfbb71f2c6506c93496692e2e216c4cb1899cdb39988a82b7f8496fb51a7c0368465fadf2810f54acbff73221ab92fde886bd5edbf4c36d6bf4cb8cd73586d9edd2ba26955207a5385608f8fba8502abbc2a4d4f8fa99b150ba5663634ceb357338762e19f9ff8a81da32c2f27d459814d8fc53d3855e3b0b98d370660509112f000df2d688ea65e252dfe5be83b6a8eece760dd9a00cb934a2996d68a421e51313e37941ecae7aad4bde333dc2801dc4c050e8b7b303986c53548039d0309f67c6a0dff9be051f6aff6b482fbef60f4f477d63a4d6fb89efd0313a0038ea4680b8864123a08f10d60d40c9529ac3913d1188438063d0c7a52915cb0615ebb72d22938c7660aea8f107f8feb318176e30d5c4c96c6bf91738f9c7f5dd883f75623a9d4095ad7776a4ea02ed574182b6976f132f152ddce4055eb271eb24447aedddc31e65450b849689afbb7e045a34479771491b377dded7fedee858863de530c3b04d405d194c516a198d34602feadf03585519d76de92149a0fd61e52481f50a23619f10086ff23aab25b72d5ed3d268ab54a56d24c74823ff34b07eda87dfeda9cf644e6eb8cf38414328c0e98cced037450057800a428bfa1a471f5d0cd5647581745b393678589cfc6a9c998dc47bbb8890b42f5902d7d26cb4813fea716fd4b031f234182f47cd5eecb34584b36319c799b6b03e067fd3220a784793d0de4fc9438e6e65df79d253d9263e6ccac9af814d7d7a8c440a30bceb49ead26d790ade5f0317df2909c4b0bd547c99c244fd997892e873272091317e23aa882be5e1983a3007afde42b935c0e33383e00acfd3e0e27f78c876038a269905a728bd83b13d5ce06d9a2ef9a2721ee2593a42d2ab3ddf07852edacdb5ccbc62aeb7012573c3e89a978f57a71de09d8cb94b7a2c82ed1df64c73ee75516a356953676484bc59bb0b61f283038344a4d4664be8ab768eebd19f0b735cf0a28dcc09eea44a56d6d440fc2c69eb22b39ffbb8ea15db34efb7bee951a187cdb303ab350d29b7406eaa5526c2920fd857516ca5213ede04eafa024108f72a5c4bf0972a2a00467c85cb2ea24f5e27fa4001626d497aa020367bf94b3eaeab9a32e205ac5779eab96ff5358ce736495bbfb9a5ddb427760c632536cd11b3ac5922ceed90fdf997c1e50cdded1328b39f46fec9d0107dc2efeaad4d137206abe52d4d87b23ecc75fe77fd745978028b692fd8c21e9547daeefaa1cf8bf77ffb667d84dd1ebd0cbf4198ea9c1394856bd8ba6fa6ccac82b9de7794c2926b10bdd30fde2a1798850f7fa8957c0636864f78b2994d1dde112e72ddf0f74b20a0cde1a4c576286ab983e36cfe0639b7a89812ada15548a341903fc5d82414d7dd9915707f079f34d4a1253fb9343285d47a0655754663b604a805c8c435f7673d88254d0997965ce5718f50cdbb618fadb0875377f7745e72a6763e5acbf276ac129302b2db23eca401b1a39c882cfd47c8c7f9da8fd100c780a6409c4b4ae7bd51b929b50277a5335bb92353fedbd4caec1e276dcdf00afc591981ad37cba3b7bef00dd7af2a2b444583c61a79a4afead7d350cae36e82d90d22f91c2dceec1f2fb1774fb550a0d19889f0def957698beb05290d22810300de6310d7264bc57f6d9aa68ec15eed2669020b8b947a82d224a9cf4448acc330638e7d9b9a9eb7864d81331a2fb791dacc6b6ddd780f239b9100dece3d4f8e2cd8b3799ade6524363d7276f39090882638370af11526a4013b7a2e631cc35881ef918f593d89b03535572a79a2295aaa05a9775c6204cc0284282f79af0d077b2726f06e4ba69a23fc0b087bf11374019c83c9dfb6dfac858fd9a0d8c775643be4ab5c839e3b21bb61279aec0cc2452a607b551f4ffaa6a89bec37f2911d1b4783f1cd2ebebf6088b2da1442a7b7c1077013cb1f7a6e936c10033a34d754070295c863e6f3e1bf8f38731fb66b84779de0e36edd733be4e9d368a8d62a2b1595285e2fdbb548ba705a9d2df95031eff67ad28b5e0c8f0ea60ec95c013c3dd5c6aff7d79e63ac4d159fb556f686f780638b78b4e4c7a9531a12d745a092551cd2b8da56117128e03da2055a8357c1d99af7d93df8717078ba4fd92b7b9fd19ff21afd7f2ff6122c5bb8d9fed25e532f8eb81055b7b2a4b2908ae796666213198afbe9f3965cc6e36f80ad1cb00dc52e846f102d486ca1d6b3cf817d7aeb17ada7eb40a3061efa396121079d079c9452cc06e4d2cdce9910d861849d4f28b2a085f4e0f4a84749cccb34b327bdee08cc1859c3731538538386b2e7cbc73b0ccd0e6236bd7763fd878c05cc04f6f5a408da359fc1f94f002aa28e10637ee0506509c4893c0adabaac1d0227d46fe093f807b8e9297e4049fcbcf89f89aadb63189577ca457f859cbfe723750bb2de354f5230d827fe7dd6340b8ef472383a951c41525ed85eb4726e4fcaa75f96cac6d8e4fc39c47f3d34b491e58571cabf2f406692e35fa6569460befd4b23119f77dd36553dd4acea8b4ebb4b00ff64510961c7d73c63b8da7ade407ef445d3d28effc2ef0e88edd653becacce17d37dd1c874c5ed40f9a6d4d5e310937633f5a5bcc2785e916114823a2e1babaa26e5e35fc82cba6148776c47b430df07d4f3867c6bdffd59898c6657dc5ec78ad38f95a1e6126cb9b8d105bca3aa1cad2793c006c090d9632758460b43002d6e781a57b1711bb0da2315e22afa6ef1a0c7b294f27841cd1ac4fbf0bf036c9d0880cac04168a24c267b01bb03d6e582851c0fe5c01bb3081d8978091f525817d88c6fed701efe9624b1a88b57f4ff5a5125d35568b1d07347de8b291a5004fcbd5e60606ce154f438cea9f7f76a2c17879da89b4f65d2347a144eb88fdc529e91a09cc6c496de013b2315adcf83e3ca607a8def81bb62cfab6adeb26a58558e9c89e1f7d96a393b46c203d671a5f2f479660988c5a0e3691ad5050fb69ccd9f4da86f1b21821fa66d152e9f27a428c979b03e545de3e36729ff0e5676c080723fd1a0e85d3f2d019b5b1780bd52f02ed238754a4cfc565cd9047bc4068a175c938937c85d127222df738c1ebb1cda7063d72da2cb5247ad0476b22ac4fe543d180fa0a1a56939ede565331769b0f29244cc6ff4bf9fa1b9a24e1b5ab795700b15afc8be115681f92d16cb1ac0f6c9271fb994494bc171a40c424a44299600259d055b6dbe1efdb0fb1ded24d819cd667e6ee74033b9ca50a6ff61ec50a2e8b872eeee18d470bf8c0fc9df869039260d32c86cfb8b670fd6e2435561a46dcc95fde0cc1fb22ff3c44c9382c71b02c402e357e1b83cb651488934c500795559246cd92d2a641ec99d92106f8ee680abb3aece0f1973738b8dcc212e87f136bba6b67731f698f4f324a02904f88245581cd4a19cffe4d322cbab075109abfed5b1beef8f88c73bed565dc32da4e40052c76783096817f6ffabe1e9ff19a9c5c7f542f7be1a4d46854629839e0181a8e9d226ddd47360ceac73f19c0cc5f89277ab4fb02234b493e22cc29ce906fddc8917b2b4e7dafd2507430ea9c472fcbea87778cc5eca4fa6e9e6268002f8733603bd3984e1c47a344a512a29092ef37934885d79114964a07950fb69a54b1f1a49e44e0e28fa7d08a4a81bf409cd5de6146a0954e7239447485b97a28c4d3a81dac3955a724f6f06414afff2861fc8548d164b57dbfa2be952a715fc58f768b67006dfd846d6deddaacc3abd847fdbed0513a7d5fd405353ef38990b2ab2cd6b454e78432c944a46c33f12bf56c9d444aa5a9c67a7093882220bbdb3414236cf28a9481061b039821039f8e70caefb146165f8dcca029ef19d47d0f12fa8e1a4949aca7d9cf2343b5949bc060839c81293121ddf4434e2644d2d1993f2de254c9219fe509b7e48f2be38990d6e316c14694406b8bdc6a1559ab2ef57eae2c4fb7fc917806f437e2681fd6ae1daaabb7915c0c1a6d0f9b0509028ecfdbdc413fe0ae4e1ea7ee653855a4c2ee4186b6df572e2b53e8235dc15b58dc27e018acdacdef34d33a7a662ca59caa103ea9f69a6f8a4831f7225213c9e9c602037866a3a81321ee95e480bc57dd5d9bad870be2b010b1529c931dff38e7151ad16e431a3102742681c2fd63d418929eb41083308ca0d35d3e61a3b4a94cb317d99c81fb77a25566e7b72c521ca457a6be7e69263e0c08f044fa80722de489d6a844d40cd7c20185086867e6b201669173fc32638f7ff8b38babd13e0e0ca7d9ed4f3144c3b159aab0158db9d1d5ece31e267b13f25a0f5e2c54d030b325a7b09b7577b1cd85d2bf9b24d0e9ba0e74458504dee9662a5cc434619163d2a8eb4928b7fa15ea4a0b9059de224bafb3130b2b50c609149ef1d417428b3f0e9eeaa80fe2c8e5fce954be33be58501d725b03ca558704000364cf84f3fc6367fdaa9462d4e3a97127741e9a47d75763c83c7dd55f7bc854dfa52e487d97a307ffd0181846a3375940a5231a7a128481ea8ae949364ea868a7a5ed4267a61a441d69aa5bb1bef96ba713a234105e787b47e3c746a3e00ad85ef2dfd96f7e83d2033551850e512a62476aa750840b0411c3ae1b26c7159cd14af22cf9a9bef20da0f8563785b617c306a2f4e29d39c70e1d2f4b8bd8b4e92f071f0100907cccf7a1de8199ec74148a029ed52bf7e13d834fec796b9c841bbb2a5070fc49800aebbed0858d061a46045520d21915a94654ff1f69ffc8a5ab07a34dd686648ff71d71fdeb6c6c8ee4e2d42a735bfcaa7cff861361801070bc0f76d75578e59dadde033ea102b9cf1cc4e6a916c004741f267e27d486bbd1bbcf905855603e4f1c48b22c18033faacba97cb48341b38c017acd57022848c9161435123a26470b4b978cfb7aae59e91ee82d36b7e5508dc0d05c812953e36dec456ac2c0a939b82ecebab0ce9d60b088f89152f922ec5a11a23d40e49df719ef22cff81c21b0bec9c5524b27795fdad221fbcd80d410fedb426bdb976861e420abcdd2d68234ad16f69d3854a247e89e1721f03816550e9db6f4b6eb03dbc1aa726a555db9d7b52d958cc2479802f09a4d6e66b68ce334e11917d92ae5b5379efb9c74dbd38f75ef6d0fd4efee042e52cd23486dd576505193394561fa819496573961d22e51437f3eb8261aa0fffec2add49d3cb56f07c68438a1eddac975625060403b6a017543ba57c0f207aedbafeb48aa8074fba333186fc567a2156d783e53eff014e70863dd5049e7fdc1b16d5fd1512c2a0153084e38b5e74f7d7b6f6d9057b0fccb73354d1a8223fb92ee2efa60a7e891b80e9e3f3342331714b3592a0c4a6268bad796180a8c897ea0e422b8e8ea59fd058604abe897288cae86497cf3fb95792c0c0dc5d065c7767d6c9cf747f6d08797baf8187b2d798378783d1836a95e87eea7c4b48e30d7820c54ccffb1d577b33a3a4c771c2f2b7caed1d374db661132232d04308299a6857bcd17848fa482df6d15f3f74b226341f296dc68a6650dd1abbd7503da26b55be7e83e355d4157df54ab184c509122ef4578b03b6ed6fa421e09479f0e4b79e15789891336abac512bf09fdbb160e6f13beb050c6c3a2559587566787da2bf6b8f4a900f74139bdbdde0cdafe79b27df62685bee7a6ec1bc87aa7a2bdde08f25447b01a22deb7e2177d580554dc467f0fd08ebee46cc4f2f6b5b14e5eccd7f7ca8157d46230d881ae5c17a9943eda5552a72086fb9c47ef7682e6bd5151fa884a68374917bc94b9cd1b76db1e82ff9070b9053680240bb542b778b4a3a3603a83b3c5789fc13934f897c84647315a2917aae972c0b26cf6aff2c8a26585587ddfc80789df4c4ae819bfbe25172f9952fb5c5b0adb2bedc75d720d971551c5b909bc29cd3e6af730a49ec264e911f41f14172e6bd2b6e34e9e655005a4bd2e7e0c9801a63d6f5014bc21bda6dc4651e5e8ed710c8f54a81607db2689819aa646f1ccbcb70ef36106dafefe7471dd18a9ad8e8b165a117680593a78660f6e7e5041aa68b03cee3582be379baf115427099cca540a5b0f9d87dd0aa86e6859aa566e89500d8cb3c50e5aef4af86e177a7ac951dce8027c259f29a062982dcf79d91d4aed34ac7d27585219b5c6ae48790bdb98c26b29e2d6efdd3e2f52593660cafb5504bc4de5e83404afb803066096be8435dd3a708f508366908e233bd168a1b766cdd7338b7b29db251554d0c6f6ef77c8fd3f6500330f0a331577c3e219025e07dae7ee7a4376da730b31688128b0793b9b84e50233f26cccf6b4803c270e5afe15822c2de70868053ebd1027fe75f691459d72b26fd73eb0372f1a6eb660bc78356d37703c5b1443871a6713d13b1709ba6115da8cb4b358e9a1d28a6cf3eda43c029a0e50678aa1a588f2f7c2f5f9803d8f92759accee0b731797ab8957cf3f73ad06bd98d236360eee2faaf6a84fa12d2ca74e2a76c577703eb09b4889645f3e4f106e5c0bee5b53bfb75bf02113f6e71b80c8f3136d7b04422ae957b1c87c12e6c3b695f0bc01a0cd8da86f4dffbee17d7942d819a5617c942620a5b8cd77fe1b50ab9d981c234bd70c4cf5ffe7e14567bd0d61750a1060c281343f99766046713ec0de434dfd34f13a54edc085baed50815fda3a081b000003d3950d720d4ce5e90c35221c6b031cf05b5dd6ee42eae05c149bf086ef2bbeda8274e806ccfa3c0614667e43c338637f46b529153b494a52562b35457e90a3de3bc06343930bff5c57dccdf613bcdb49fa5f74528221ad6cc0e8358f86943ee39343decd27975c3b642fe1cc8b535a8d442f3a84eddaeb08a9f5a3542f55066383ec86d13478a3d085253f0e8df6b1c217e90c669d2b4d66f2ed111d068e2389027865b2ee4344b33289ec5e6ec0dfb4709402cc3b28a5389e4628c93b6e20b2923f3100257a553d45e67aa64be3c57bfc1cc2e401fef0ffc70382743bc982c1020bc7202065ee497ee903bf88846d6d24c58c72ce34630d05c2d55c3507d615b373bd5e992d1bdf9d0ca12cc916d4af407ed10dda87b4010ef15955c7a7ea0c7e842baa7b58845e097b4d501932532c56a1dfb0388d97c7fbbe380538bfa489edb43d11f001f333a9e2f0d8b11c2730bc5b3834f1f29f26b792e77bde19e183e2c7b8485d1dddb8185c11217df9ec56c00b10fb8b716422c1a24ad32b3e5103e7debe75977e1b404407e394c5fba01fdfdf9b573cfc8ae4757e02d6ae0520e4f8be5397087f23385e8ee06a6ddf0a7c7cc4ca6f76d32ebab3f02d0a3814381b11504ede34100398e13ae974b43a85621b541055704f15893a6dcf6910abea4de2d15ecb52b93f7982f1499af1700a35b2bfc8e890c57994a0aef8594fbeb5f02b7593404a5397836098ccb801fd0aa7053077d1c44bee3e01e7e27c8109e00a2bbaaeac0a02bf1d7c1764d04dec2aef2a20eb1ff9618daf9c0005b40140a31551ea13b2a4d1dcf6064e44c5d39018dcb26749f719febc610786f3cbfa8f8f73b38cbaca45304d4e0c3bb392444bb16619667c54d502697f6c6c2f9ba99d5130c6f4cdcbc2984abe89a4a7b4683703847da9c2df704d36ef85171523d58356ca9cd2acf12906049dc66b249f1d00fdefe03b717e6165968fdae7596e198aa2d9cbf2d3c769907cd8692fda9ee48b3343427b1fed9acddf6d791b1c0fc5d5fd204271322dce88debf8ec45514abeaac2a89ba6467a96f5d041245615c318cd6490fa142a31fe1bb9bcbd8e2ecc1f040bb60f12b011e6ff1f6f1cabed6e6444fdd5676a3e9ff503bf7474e4a04ef84a890538430f5ddd3a6c5f69652e8cf00bb02391c99b358aec1950c3deb2e697efff8e825a9131b3fc80715eee8059a1088aa2b8d6abbc6d4c247e65930f83ba73260a6d9e1a983b5cc4f24060486a685ba6be530220e54f1018b49afae3f5a892b506029d7f1407ce597767525d0a346656c45466a8c7a6fe0852130ea34874197e46198b7855393784f2386b0526a8f291cf6b417a30ede0f81ed7ffc3b479a22f9b37aa8c50ddbf9ad5f1ad445d539b9752ae4e2527acf1010ba81a9f243be6a260c09ec4b702b09437602b13c444bd3707ca70316ef9f1b1ca62c940d9c43d4fa672ec85ff25418932164fb3c9bc228a2a8a0f7fb650965f2c9bbfb8455e1c80e0b90bf98fbf53878719974e20faa4fe07e3501f2df140a4a5216cd7f6b6bf1e91ce85129d6315cf4c09312f52c03661acfb238aa5f5fcdd5c0bc4f4b152f06b2a2bbee47fd44dd7513eb54ab81b87a530cb6af48d8cf1beefd71d86d881989a99452b146aa0ece53a7aca9ae2f6262dd9f4a2f6cd4b5096b4f7095475e17cbacecbc799e70091cf91aaf49b62f9028254c4da1370c9d2c2be94b0a56282623ac823d437a3842272367433735353d650f66a37a485da952c8b0c7c643cd60c39923d92353efd521d51134de57671dbc68d1e2b0a8bea647a3e2d62a4f9654ebb2d5b83cf7cbc1fc71b590a12c51cfcf4e0157a1996e80f0f0226ee9bd8fe58fe36043f6ba8b7790f78a64e632c49d56fcebbf1d9318ae0873601ebe62be096265644c0a216f4dc1f9a6e32a123978903f9607a806ea932ecbbf622c1ad13f923657846a01f6a95e457e1bd334c08e49daf307239dab35b9e995081177a891d097dcdd2ddfafa065ae01e4021c9d1c544d8292084b88e3c4aa51ab28b55875b025ee7b40cd589b43fac40b848ad64a27da04db715192f31d4e32e21a3880d64b9b0e547bd693ec9569f1af7ab4661e44a0b578d3ebce589ec8159b175d245955878e03e0918c2fdbfb6620b2b5097b3c74a13429e4f81e131ad217dca2791570db19edeb24003c80aa8dc6aa14d6e0b2001e0c0f3298194834da174464b9aab01b202ba29e0222ec59bc40927f396dd977357315101e7ebaf2d5735e96a0f3adcfafd363ca216b217e6bd54f781ec40580f6437b6bff1ddf112aff237aa0ce09f15ff06e58e6c840524e4672d4ff43698108e9c1c5460bcc933d836afda015cd70036281f9291cfdaa6079e40c55d91b05207de3af44ee2920cc10ad45b6739a48784161f116edee4f7acf1227f2e753d398429207c105ce6aca621d9059a115239f596f69f6b9cee76336224233c7754580bc68f45f0b4eadcf9bd74f44f7567f50dac5f84f5c5742f8f713396e670399a5605ccd6b6ebde604ab6acb9a42a49ca097cd07f990e2cb6d1ad64bf03e7902a35f68c8e1a8ed2269777820aa925fffee32a9aaaea64bcbc5d5dc648ad8cc724ec03c52a5da1c1de417c725e270d4e4571303b843046b1a28b859abfe3df8d0d932c075c5f316c54a0a3a8bc80e405ff44e3797674775642d9e75c26f1554903ffb988b7f7a8151c365da18a0a1358fa912820c484e9a3c6529b7ece4704873e2b245993938a40beda956aab6326ac12a141056fa13c6e7a853759f7fe26cbd8856c010bce7ec9fc00ab5ad6b1d3565aed0a0b1a4a586fcac2b6b579b956676cf0d9f595b00a738491b1ae584633da9ff0b9976da5455d70eac3b09b3e406d3f3f4fcca6f16c0b732f20c5ef8974a1a877520d51e82f6a36bbaf577ce47d34e9f3333454d74f90e342e014dc3537142fd768adb64698544358b562a6402abf0eaab8a4b1231f0bf7cde2270abc0d82e01007433de85bd13a857108474a86b6ef63a5b9af8665307d47101146e7804f5018d5ec0f2f12183f13a7cfc9f58c4b2a5396d56ab5cd2176e864b650ae698a2ddda61b5c542e8b380330a6105cee6b650b4c6e3ef49adfc3a8efbd9b372668def816c6c11b29e3ec7a344b8f9b788cff89e4a76b3112d127a0db85cf101bc73e35f2e5a21544e4cd72aa59ddb629153b783dddb204e1cfd787930b6a6fddf4e965fa472bec67f5ab7de6ae65a6131e163fdb1332258a1b9dbb45c7fc2b92d8624bef5da003cc4df135d89e6c5302c03e96484048374968e9199d57c402f8b886b4978214c3904fc33eb204005a40bc504675ce4dd21b38c394747195cc5ff1a108661e0e7187c3d610f07290c376e97801bb802a47edaafbcec5ec92825f872efa20283f60a2b90dd98aeb40b8ae6c4178cbce1266514ab8ca6dad378f289fd3795a086cfd679f5b1a52a1c5e56e08ffdfa78320d0296ab6fda85612671dc1197394d93a409fa18091852703ebcd7b6b0c8e2837073793794a974688b632378c9fe3701313f42ff5b720dec98f85796368f706284c44bfd86eebedb521c46c55897f0da7d99da4c44d715f4356062f1276c9ef859e1de738fc3842a24fc42fd9d74e905edfdd4b0c8ca955919aa2803c35c0b8df9c3fb812beac5a8b14f586c5e00bc1c594ee7b2f755db369dce8711ad313cf490a98580a021b14dd2a428138c2da8316ed61fe7dadc1acbdef74521a811cc3897df2debf6dbfabc6e656dc975875528f0aa8770ffa1ee5cdc373275850f0201c69500d147fa6a19dae9bb2eaaa54aa6b9ab28cdce6dbb584d5cdb29e3c23b70e73c52a68f4dc27d9952c66698d6f9e040280f0e7fd4b5cdac77a0a96a7b842e916b5a82e99b79160e7b543c1f9e40a2a794e03afec3171cb84bae614cd8790ca1c533e05e8d4a32f7c80f5d23ae3dd905d15e89e2a1f22d1ba0cc19aeb5733bc9065b8cde59506a3da7b727d386a42585f072d970525c5b20c8332b7f939690ee03b22cc443b76fcf650b94f1492de876391e92224b074dfc55bf36c3a62bd2c9d6ac6195ec97685f8245ab3027247b91f1e3cf4804127e899000e964a15cd6fcffcc3d35314313e1207141fee87db16d7b0f8bc68889a4d700a4007a3d65a232ecffe817e630c526425287776804acc4c6de88dbf90f850867b45810bef30c20a9810e5293bbecf62eab254191743ec616c54959b2973ed7eb833cf6b9766e484de6e40dd00213e27b2937aafe989f11b38b107bcab1943eee404f76a2846d77a152c8f9909a3e150c7061ed47fab37e10bad61d2ba0a6e7490a523a2294cebb255effdfa760dca469e94e0cea97782b6a48aa049b9fff20ca39c5f2a0ea30f037657f458c3953a18506d99d33a6e299ae1d40f136a70ba357a0d74a5026b339f9233fbf8d06b9ecf2eb93a50c5b39f93bcb42636e054bd5517ca7ceaec5fcd02aaaa49c4ee0b33db3c11bff86ca981a2698a87d65745a67899e9f451aad9c27d144d3e9852b76542295f0753128305289a35545d2c7497270aa3e56be962107ea63090e372d7c61b7fcefcebecde6d1b89e737fb2060735fcbab53de97e11ed98e83157acca3a0a46a3c5ff05fc76166e70d1bd7d42dbf0e7b10970fbac852629afef942a217fb4d56c3c73caeea92f7fbe6145d00e8dabc6ff4fee6d54f519008c9509fa782e8c76c44e9211ea37fbbbfca0dccc19a2b773c0eac7d6538820850fa496bc6da55c8a28ada77924379ba435d82d9e9168207811d42d4f947273294675fb676f47befd0f0b1799e2d6e298e604ce36a271bdfdac359f98a4d2c42ed90384c748cd00e582f29bd252e9f18f04b781cc2ae350ef0402f200c3431a50fc0fec8898d7b8c88bd6c41c8d1c5b2f57a6ac58cd45502a9bd93e426eb7ee4c48c1ed6d70e7464966da55f848980cf0e69485cd10eef4ccdb83574f47e9a6ea5b22da38af0c0fe28fc4877fdf816751ed12a2db5a7b2491cdecc2908df8dfde25a1d739131ce846ed47e2dcff8de4faffc81a601a204c7c4ddf7e8f676308b6789551dbfc0ddd513a5369ce54dff999a858dba71123d7d1852abc7c8ec0a85893aed8b9ca7e33d83837f10306f982216af0c1f96a8bf59a5a7514d7f012c10a946179c58f0467c9de653341ec1890a198ff193775795d748d7b790f47af9b278c6f40803521d3a6302481308ddc8152ed02c20fcdf0753430b6002241159f939f53feafec72cb269614c58f328652f3e9cb2149ed6c3330084083d071895754406707e2153b8440ff17f5fb047e856ccaac5b8ee1e81feff153192fef8a2cc0e0d1cd6574b92106ed89d63991a4792e97d3090866877ea0c2c978bc9ba752727f513f8c7480ab7aa1bcd1783d4af9876acfe5bda86fc8b7235565c82ec2742f65d392e06f7fd8631836164f56fbe18639a289a7c5f254e50a66fef9040d35423aebea5f8c39fc691c6a6e681e9a77e75bd9ece903a5e5825c18f2e78ca99557ca848a3d96d06da736df1da644f3846d34e6e5428ee11eb30651aa1db76c98de7a3c02fb544e54ed74547932d1b92dfb69b29a19641d1131a42db9cd3b1fc1d5bd73c708887c8189a5c0e0daeab2bc7cdc3674657978dc49ec755be805d40a26c575739334502878fe3ed973045b22c5b9d05c33b134ed43d78fd27a5635abb058879ffd0e5703a949f32b55d89331139febc83020f7da5166802eed2aeecc000c45095353393ed1fab379cc122d9ced3c5601aa429823ce0fefba92fab4a951a067a3176de196ca67574cafda51200a2914769a2f4c4f155c9afd460cacd444c6b74f637e282f187e6cbf7f60f61bd516c505ea31290f9891163c83a3fc99c01c1b9a0a07b791616b1520da508e52811442f872c38edf50a81ef3a879fc5c178708c2177727f58ad80a69a5ec9a6b6a8fa21c0d3c926032753da9179dfebc4d01c3fb596b809796273f9248eed1731bf602e679e2d83999eb39f03f902384bddee9507ea8ca2e506192e412381ab713026ea27f19c542dba6d4bdbb190fdb3743c487aa1b73a9b7f563bfec41f02bf6de33239bfd1cd2c3cb23d19f9a54de6caac92a92c28a4564985fc2a08f76abd8db20f7ad163f7abce774da5bfa0b9c09c81e2c1aaf41d3496119967916273d65c02f24b93e730bb5821b95c94851bb5241394cae53a03b426a1adb94e6ffd2fb7f55dbff25087d58bea8ce3449118bafdc38b6eb06e01320a639a884ed39b4b22547fa6885d01664f0c09f6e9ad9c401e08d060d84714eacb7df6c877e549410550974c66a05c0a33e7bb9f3ced5295433fee28d4cd8d2fa164d989a09f392068a348157f9a65dbebc179a6da2b2f966ec904d0d5e1b27453820e47dc51102b1f7aff4e85486d2700d833ae39bc9abd24b7b5bca698be805a46e9b07863817640c822972d7783e6725dca9c41bd5dbc5d00bcbdfa0c67f8a4a95186a3cf3f4b8fbd2621ade831bcc79386172da176d95a0febe07c4067bee3bcafb3c05afda3e8b482020df81ac70d314ebce7db8032309dd06192450b19b8b04b5d20d174b6e8e8065074174cef8dbc3712cec5d59f1c7d3304f899091dc30b36d1a6d2c2a4ee3f6e9bfe3c8edd3d66c63efe7f5f022e80d31129db3bb0561cad6a33e1253bcfe6873f4c46a10749c1f1179267a79848febb5cc0ab1ad4df364bf0a5b731fcd7023f011de8b0ca76aca3e244733ebda8a4c4ae45414c5180eda628f452dabcf95f281bab6c6a0b46ca25154c1fdce32e7928a4208d6dac917311a72b12880898c54a751f46811f49628ee00dc88c03047f0ab45ea08907ea59671e30a543e7c8dbd2d271abf58042a5f9a4708c84682ead8b108c0a5e80788c3b281c5857723d54f16d16019a2637ec8344cddd664f8b5b7d3b1f459027b9663f7aab91ebca8ac83e867b78d48bcd35f306b2baee1e532404675147037c581771463fe2579f3e776fd2810c22966c5c5e164c3867e47a4b93de748741dbcf6d42e359858bee6387f684cf74161f606f1741c545d45ed73234ca3a4978fe233d910446c1e6fc3a97e4ca9a565c15503b4feed94f0f9ac56171b2472834a9264c3abe66e0b702a45608c0b535577f358c4428472c3431654ccf6bde2f6eb9ae9b0cb2d33c56f72324f5b026d85cd10533d71553d39637e6a2964a4eb09e52de53dc901a560e64905aa70157646595b41005afb7deed1a2ce8ad94cff013e725c32432a93818c439a7e6130081ddbd480cf947e095958ed13c06fa66e257e1960a6c106ba745f5af27e5ca274cd4b191f02955fdd4b02d9651856540a0c4e39621b43c71796fab1354afd0635b6448e662bf46d8d43b080347cf009271f855e020e66b41dfb80bd176289d2f1f1050ee17a7d42a2a2fe8c581b487a8680c2d17fd817a532ffd795976b9483741de87b8473b719db7bcac12132304481374abe6656b276b3911d6de1e61afff5351e52b75e485363ed75b1885c50ab4ed8f3b78f35bd627770a0027579acb0fe921ed222baebf3293f46ee8cb94ef313144f5383d8017e7c87cd9f53abeb6e52f310d6469aa350c316fa8490d729893db3269430ada110aeea63f97e273d5b2b312ff18957c46d51667a94620a48f97febdb2e1a926760c822a3da40163448223107bc9a408fbab53b8d74bd4546f37c5438925a622f8bc7699bcb14cd6911cb18b26d42b82e5dc0dc6bfe3cd4fbabdb0b6c592563310939ba676d917892dcaf21e917f68f3ad00d4108bd5e060d4e2f30163f6c0ce6ce4547cf327148ad0c4be9d02eb799f805c428f0bd495eac9e10bb774d659bdfb2953b04ab830130ab614bbf0a67305284527fac96971d8a2769a06972b1efe07a018bbabad91acfa71da1af13c6ccd6495a8e4649f8657829ece3e656d95687f95d823dac46552aa6b3a7c58943946d5a68bf7f93093fb5fa37f9e3183c9da708c997f0d04003d4740a4b1f49d4460a1fbf1ca462843465738c8a82d07197290849ffe385c431578b4e883597f9a12d5c818beaa9deef60bcbfa3aecef614c7233f644bf398a546dac504a9b71d561cda5283b4a336191c2d48f91c694e271459b7054e385245738cceba0895ddf7a641550add1f37bf1d03250fc537f614f2abe6c6fb2c22f0b0ea05a590610cac3403a77ec6ab56c2744e2e59fcce981aa0b31994218d22eee44a4aaeb85306c999c74dc11f47084c20b47b6c7d37f7cc6372820a21a2bc14cfb8c44007fcca74b9be3b7bd703e75f12cff0fa6d57e08c34f484c00f925714b0f64c41f99e75908f79f5fb0cf8d4826d81c6c94ec886564ad64bdfeeb2d495a591008f02d57441c3a84e3fce37232780c6f4ae9080939f5a8542f2025e3cb19d368fcbe6a4536ffeaf0c738d3e1b6dfe90efd53f34308d50ce30d8b170f9d2929cedc89f4a97661b5a3d6c72c4a7e41cc13760c3825f23363b6d483112df8f20adf18964f7a170842a7192267b7c20da2e113c285dea685c366769632d6abd7ec5ed3c3bc90c89003331b1672e3c67d52a60b806b7ec33011e3ec9d5e9f3940b3aa0536d799606c9a82745939ffc16e4238fd0ef54bec79979048f47232e79cb49fdb90fb244db01f85097df48cee8051280fcf04695b02cbb9f441637e8efbb0b524aabb9f9e278e3b7f52f73ca3eb6a4a20222086bbc53cc839e5bb0550bce7eebd55f3fe9ad8b81f3b2baed84d49b47ba1a923b89bf0114bf734687f3f679d776ae2a1f5cdf3e0f7b730a73f613847adb1e04bedacdbb1849d0d6ccafcd2b605fabeaef6b5abbce7b34e85b359102a8f0f69da7da51bf498b450519108df5476407d634ff637a4818695fb0a88dba5c7135324ecf6b8e2e3dde48e55ff6cc2b108b77c0894aa25f224ef964f94b9cbc7f5337033cd2fb8c33e41c7045f78e66e9ec0c7abe0a9b2d06c90623057f05c96c63eafa45a8fc8b2e50470e02993f79a13aa7284725edd51b37e163a7a566e675990dfa610c77a1501e282b6be99f00ef9581447793a33cc38a9ead808365f3716a585eb4f1f4f6c82adf334dd64ec258ca42005e241fc00b1d937d4567e773883a88caadb8952bd11d00514a04dcdede1e531e62d31c0e5fbd4a51a745b34911cb07d591fbf473278af9f29e650495834206037e5d4a5449e4ef9019efcd27f5c9d7484f443436f557f8442dea3f4cbd2b3f4666816ae4d023847770d91a29977a7dd867a43f291143ae4021bbf786d126794b9189804f5fc5cc641fc35e2ed0999cc593300c1979d1a1566f21b721c281395e6f5b088477fc7d862764f1d01be89ae136638b06f1c9fefa046c03dabe830b872ed7cd38ab87a93b297a81feb5cc030b5f42ec751d19de7bd7ecb64ecc28908c8c94ab3d76fdbc99d3d0a49e70952deff32bcf45107d42725d92f5b6ec15c70d3a551c660cbf1bde8df5560fdf556b6a329dfa1ab7000d7cd09030d4a5ae20934e0bc16872305193eaf74154675ece46790702af74cb3c8a38d6c8a12ba4e924378293dbe1b3c8cce672e773e28d4a8e817c0bb0bae3f74be6a3745ca34fae9097ab5e6cb29b0757a59335ef12053903c46aa07fffc9cf6f920c741690ca96bd54daab2b43ed966265211f450fa64f27e163d1cffd083baf722a5a95c50c3e793c08ee098cae7577bcd75168c78c10c5947ad6c055d55cceb0c0a325014275699d5fc4d2bc55b588a129f944d288cb05db7f939677b464a0cf5c2341bfdd95c05e601739a05dc709d257b594413455b920e5ed9a70b7da9e57872b4c090190ca9e36a486dae99a7b66a2c4ab0a9364a3c829d36564cc339290988c0dd5d7db4aee82b815b8ff69ce814ffc09d3adc47f243c07920a5cd1970249b3d2c5cb30c3f6f417dedd68ed8465217ad13d16e86f9743a45124cbb4144c2951aaa8348d38e2c458bf338494a60102a2ff25a666e36eb96aa2279772e5362b16830c836658b87eb47f71fc9cf36ebe0e55c9fb4b382c4ef92472163e8b102c760233a61e4ba559bd0611ff86e67432a34c1197b899e8615557e15d4361e58f98219220b62f79824c475516f23c9b8e832a2a3c0fd089f2cedfe21a04954e763a4415cd09da2089874165af281b77d3e74822d03c291f952f4250fb824d776c9064377257e5ba2cd5d9f585cebe79231b921f68ecc3607dd2be48c889ce845dce42fb77b53aad81f942d2e192ef94a2bfdbcfffb8d547c0ba064350a384f7571c7d0364f2ebc9262c2a644a9b0fba8247e814f4965f4fd5fc2063b600d64aa3f56ceb4fa51adf6101ab70731b59bce0f33d8ed22c955857d7bb763dd26c36c6d54af59d3ff9a6e65958baa4a24bd43e4cef2b2801bfdc034a52e3d9c51ee004a833049f8466c6c75fc95014777571c0942afeccb7f5fbafe86857cd06cc42b84c5e2c44e68223c1e26750dae07b9455a73455fb510df999a37bded83ee99b7fa466e2563b4b3bc62cae4028146546290f46a5346efac7ae01993dd794e63dbae36edd4ad1a1bd032198716ba3eacd60f617a0bc61717a186b89a57d1e26231ae9c28f3cd30a103150720c3f0678654c20c8403f3170c6d636bcf040c2833cac4e80c07bfda283650dea4e7cac577c53a5227de6776e657ab96958fa652fcedda252ea7f967e36b729b8f8ae724171b6dd11c0025a113995b20aa991ce3e99d0e13ef466e672abe5f59a02be86e15bc793c8258e051474c01c6720f820d42f704c14f12bd13a07342311119409faff68c5e31d2adfbee54861547037a01d5a1488d812c3a2ef58ed16cbe9ce380999d3ed952216228f26c12221741d5b8ee028edbf3a6c43514a7e1989a107bb6912902a40818b30e8a211924c4334ffa0814ddfaef9307909b9bd7dbcbcbfe019a6602a0e4c81b9aba3a193bce8dab162751cf318d8100e6b2ca5d1e101e799e0c0975b3bf84e059c1ac1f48bc026634a22b0aea8d0a5481be371c8b8ca0606319f02176821b4dc41b914070b6a0f8bd6a1538f1e02e565952c3bb981b5617dd2382f25515a49a20baad0d3a032fd5447cc7b2976cd9ac74a0a3927679ba2612ea63dfe68a2c162d8a660f9d4c763c918bf9131c5bd250c352abbe73a15cd68a7c62189863536a9ed7f21dd7e4abd8a79ed515e8d9c48cca27295d09187990250cdc93a6e17acf22453f1e7ba7d76b7cbe4cd022e7e36fa669181048fa0f49692fd3d16212dad5627e4e28ba5a8a60dcc8d61c69c7ef3d0d7637a39e666567ca5102bb2869802637eb0a5e61981596959b7be86e205551b8e2c135f59cae39e90e6e31bccbd875fcda49e6dbf44efbe4d290e1229c600f92f0668ba1045b1b234182bbc461124cfd347e0a2cf045f235e9cf0edd1123dd1df510fedcdc341b91328d089ab07ee424581d586dfce86857304319be3e4a8055afea2cd62aeeb4e5abc84842528f24a6be8bfbc65677c3fe86d9ed8a90d52bcb8ea8fb7a90e39f223d0fbbced4db481c0d6e35e1e75a6465378a32bf39d5aa0fddccad01f4e34a80763fe3906ad9891d9a2e718f5ef786b731dab4dbf0996fde880aefd72d34192ffc54ad999b60d3d6dc4b727a7fe87149dea4d96e78b785c553690f3b11f8df1e68d264d25a58d33799b7d7e3b09e1fe4581809efebccabf9befcb931db5bebc7f2e364af24ddb450ae057f4c74a7960e57d0fdcf689254e2c317cfda8cba9adad7143b7a2070f4ab35188a20ac91a94c5bc5ea51cb119eef35e01dcc54447ef216640407f6608c07aab91fffc6efea37d3fd29dfa47cf78b5b8d97c0bfb8d0c3a0df976c7c0b127d230455b2be770670770c0f55ccb8a9dd7333fe12cbb203c77ecd01de39250fde6ecc12e942987977424fdfa11bc216e71513a0ccdd143e374bffe2775c982be780b39d4d4e445d504a38447d8710fef14527140d92a5e863666ad2cf88291f39d23ae8ed109a8863b558323937c8831f863b20a75e6f85120c1acb2bfcc40904cefe6910736067547eb5398f30f8fb7220018d4186f415d0a5cf8c2da2e76cec8f922bb1f56fceea7a5327794c04846d5b7d3455dc9047efbc6a3daa61260c696b7eec0f86e6448646ee17ff3fa6846b8ade915a99ce2923b113a6e0399b3a5c5130749ea4164508b9aaf68a4de80d950b762ead661415dcfa1dc1ca5bb4346ff6011880dbc0ce771b43378c9fd4d1feaa8463e0c20ff1d5b86e295a98ddd8b97e49006b6dafbca29429f7969d5a6cc2d21794d7deeba0c6f2ac192e68463bce83f315f8463b90941b15161f208467694b73e9b75fea26feca4a3c6701b2f04f54c87310fbb8044ee46b596f7f8ef1ecd6383eb81c524ac7704c1ef7974ac880b066a1f2ff25635d1dd6ba31242124425d0ec31e77897643a77d58a32fa9c9a4eab8f263a82e5e38804fb1ac934f309c13d98ceee34631e3216c2cc08ce7ad4ae9219c4ef3637a04d94e0432a449580803af1bc047c0601754dea0f4c4ef810d218f99049226f3bc79f37c7ae7eb17934743082d016b1ff69a0f80812b61c741d675f9f399c49ea0889b2b9a372eff2230a3905dc6d52e1683bd97d61a4690a5e85e25e03558502da6783debdf742236f5dce7faab4969c72ececa00aea028e2608710a3991386d2e86b36264b0be45836833bbc73119cbe3a46ed32ff6702d1c2a4cbe577763bec0195ec731e53662182baa03599171315dddf1a7bb4ee4e0f6a7e2af1955f208bd63114d5a444b5f3e0e735b8604ca92460bf2696dbdd5e33dfcdee6676d79b8d63537a71eced7bedbf7d63d028df5a09f150d6f521efbb698f85d0c08c99b0cb094086bddb0268971c1a4eb5589f43a8a03c5cd1cbf5a95738258580b5118af0666638d3eff9d7ff2c77d15155f63f80b911a350d7b44640dc81691166c4b59f229773f161b2859e8775909cd13badd2e1dc911b635be769284e3844e460833f861171632a17e29cb937e44c20540e20f3ce2c591f8dcf7c06bfb0ad56caa570a5f2cedb8f510f3edf4a19ff8dd81c5ba053e7c9a060493ed1340e151d8ce2da7b1ce3767ccce429440184b6690a1687634876c9da098b7a4559f7498dd88351cdf6b8566c46c823c377f34d7f778e9ab81b15d6ac764819e06f745166b7a323ad6a503c067a9a21d9e4299c48f53806a94d32f96e440eaecf13e0405501686e3d6f2caa24faebb0e14c5d87fc85943a0e611368696d692cdf38f7a6c037f11d46e488bd3e2f0c3d69cd6e1e934a55c64d981601ce6c2d22f1840a8150306935a1fe6e5e2b4755e439087df942f73e6f13ea3b360f8c6082daee0e485c4e2808107f414002007558ab842fde3b81113c8082398563f6fdba226bc528ff5d8573efcb779db6d8c687f4fba489ff0549ad3288028a55965fe81c7ad33d54c4f9820b50c80ee5f1f0be4cd135e716d13207398a40d449e130ffcd79252a69a8afaee2512afc27f2bca4718e0f338355c981080e94785fbfb9749e7d9e57d5ba2cc8d50a0dd5af254277905d414b389f1c5658de2b551424b2336c01a8b4ae51ab1d870719defa3adfe26f14c9725a872538a80c0e241e0a6f10b46719c3543074093d4f173eea68706fd561f396ba97a553f0e80368d203ecd81a09907830f488bd4052360ed3dbeb6ce609ec9c6c3e54c479974b341e78bb63abac1b65a8acaa650ac5437a3a7282ef688e30f1340aca488f45e3b8cc4eb42bdbf100a33501cee9ae6c734f90f24b649d96a5c7bc98690621a6fe1b995a6b2dcc587a30c45bbbde5c56bcbbbe55f81971daf690163ac49f0563f27ffdc88a4e785251ce909274502dfc8ea7bc4e8fb6a3bebb079b22e27648dfbb06dfefad8b3562e8614353613fb57555b0402c82920ed89cfe6eb66c8058e93502300d48c0e1e3c3acfb9529da97d6b4a95e4ced7400b3f1f10a75a75a630c2476e3c9efe8dc04b389461c6f6205276f035059bcf9119a3051dbc56c68344cff2ca0b887357e751ce8a869cde7dce544f6ce391ed81f4d00a40e056e7fcc3566e929c6229e8d9120ef31b30c5ad284c954364f97c07508f396ab64755308424ec9ed31e56112f17e717b7716fb69496ec0b2feeda5015fae7a5af5abc0e7b09862585c96b936ff382eeff7fee69f755988cf975ce14bfb7d7ea99ead0ea1d2c369b81a7f405d65ebfa6d86a3edcba60694cc1819bd27d9e95c1af542b1272361b732333d366d28d11810a81306cf32011df5cdab6e1b515c5763b5cf945f56bd6ef9c009ea059313f6f82505a685853536c0f88643a12b392e3eb9ccb7e1d01a102f402819e1a04547266bfb071e1e4d51d673ff41e49e8ac918cc1902089d92f6b3f14d76f7cfa2fc80f060a6728b60e62dbcd98f418eae31cc45c7263e4be5e9f3f8bb66ae648cc844e4daf3f2496db70fe2c8d1c10b655ef7c7662fc938a0917e84955868c2fab59cb25259e22fb854ce83e700a7a13b3e1e1c9c09dcf34e3a8747634a3fe6e5e8456c1119f4884ed0d741fa0774d510a9187d28eeecbaef1a90d5ebcaff2e7112717b2360ba86de5b6d64c144fc6f8ff1d0db6990f23b44b3dea70abb8da51a60b6f91f07bef3bed52a3e09febfd167799ecc99bbd96ce9d45bc0dc24ff60baf1a4d6b4ce56efcb80ae3cd15e4d0762973ee8fa04ae04ac322b142dc495bf28b9251eee366c89e5d1c5e95cedc26a44a1c9282fe7c5cdc372633bfd6289b2e081d30bf3bbbfb1700220991c932e09c23938d03b48de923b67e19110f4b18f5d68d20794846cb83aebd4116a8615d589f080af8762a608c6f0f0f6c9f1b513e4c55bea4e98b9a54aef358deb18572ed0c5fa11717a552fb02289e64ca5e71bc2f5e303d070b156c122fe9668e61caac547abea2ef92d8fe8fc5d6b0bf85922f250f193eb1079e8df72ac7676fa602f780979a79485437a48050604b09af69edca8d162141b85a11c78717a232212e90105fb5cea889507f2c79c052b5a0a377a651640c8cf45d23c7f19a3f589c2781ea059d4812ac1d48136463116cd4da5487736165397783f21b9adb2e969f76aec3f725ccabf1d01ada50ce66b9d38a15fa2fc5df2c673fcf51053b977866345e84d16739df93632c7f69765ed44c3f6c5b4b00538d78ed65d94d545f4f0526df5515cb647246bc898419025f56f62312e71eed1de7203bb33704a8ea5ae899e8fc2304d071f0d4b176f9bde60ba317ff6e601accd619b82550d952ae180a4d5b8cf33439ebc57beb701e6fba35e8be8962c26af004c53276f735a970b9dd2adac9a5aae8580adb8f1ffe7469e5cb70e02a8545267113f5e65e00f5b3676d201b69d98110bd3f4c0051227fa9ae50ae3b6ff6b567522c354725a4a5d598964136b183912a733b48b3ed7e98f7e7d733ea66ba121646cb69f0aae22970bb7171573d32a9b1199cee2b91c0b5e06e87f00fa9fee61900c4984b4da1a932ef6fc1ad08de920504a872221a6b420883a343e71c18ec0fc551059d6f29b9d8fd55853316592e78bf5eb7ee696ec666dea43e31d9e27d6a1cdb8b0d8089ee64e0ea98bf66eacb3b9192cf62790d2f3e3f3c559adab2a5b4373e115c41ba4758d623e56e159b27ef270b67398e2ab850c4eaaf17df0e794f15e93849e590da3a5f78c77507d078191c8b3af58b5bdfcfd13070d7f8b755a9e475e76fae7cfeb1190a5b6c59e32ec984555e4b92585b166e213dd8d7ca5d0f29450b9928fdd7e907eec2e71bdd30a0c7ef0a7558ee2ad3eed3fd584849a6eb8369399278a4a961d897e32b2420b58a41a6e4f6ae786c5bf32f3e79d904a49a7442ff9f4030f3473e57b72786986c85a2ff1b8e56feb61744b0cf3d3cb6b68494b5f6dcddf83ea460796ce544648722b9b2841e4809741fa1a9fe8c961a3c1605ced46882168049c0a9b0b5e1bd925efe9575a8dccca1efe0527889ab204847c68d37557a199b0e7c098612d80116671f712c0aa5072e50e0ff9dcd3fed3dd0003827f6aa2823757eac190db9620e239bc96148f26ef11cdecb8934254567e6ed8a06a8a658ff9115df5de0841f97f3d4157a58fa3abe76cdbd629bd04329b4dfc97f517eb888643f396056eba15c233fc8d3794e25af6022c335009b0d49625010c4256d93c4250c8a5555087014983aa1d5ee6065392435fda3a2b9901198ecb152b0c792ac1074d14c8b07fd717c22391e932f02d748d0e1fcb21e74ff2c1760e542018ab549f8396ba9ad7856ec87ac5687c1350b8cd459c5f23945545f5b12aa8046657f2bae212c73cfe893d41abd2445d4b8edf2dbf2321c7aa815d52335bf2a56484203b2f3f9eb15613de4b1015ebac93cf94f64d2db2f41baa9d439e141faefa4efebb41f4da79856b2db1b5142865894d9297f27f96a16246ba0dd01d54b99f4aad081185a59d8cd13f441386e97379bb87f0b102ba0583b04aadb9206646989ab39e3bed29a754bcaa304b027c369c8d5a66991160b033a53cecf669cab3a8355e08028b1c8c62da127dcc2c6a3db55de02680e09c0326edc5587327696e30c3f4d4f28fe73d47df50ffb9d58ac8a714f856274d259b704e20cbaeb797428da905466e8e7f43d84adcd79d750446958f5e3a4be50da58edc5f814946e52ac1f76855751cfb816f9f16ce75f203e58e8475c8de48e1ea6e3dbc7471353b5c945f167c7bf4aeb06025310124ab550b0601ef9f13a96c88cb3a3a224b05b2a13321d05bea88374911d814373677c94a386f2962ef8bd88ba940de0cd289ca7a05a94dd6cb9ff6657ba72be57e03d5e35d0eac0a01387b4c33088f038e86409c30a57bee2322b5d25f24a9deb69c0f9d12fb684b0bddbaeb5910acebc9e38fd96009c26c722db30f1a6886ec9a600a6ad0469f5d1fa8fd127d844d29d4d3b8bca15610faaf6ac13775de30f7ce1f34a8f94b81779c29335de3fba82c7e7e438f819a2deb6f91ae8ecc22354b1142cc64b066c81e7ab14c0603c7fec68d0547de566a62d6e89b485b9a90cd2f0f96749b9ff267e2b91dae80b132803147a03e8ebd72444e461924d10492c90e4430aed91ac63a68cdbed13123960470baf2efdd645c07d02e305e45ebfa660314f42fd664963e2d6f1059917795b4aa118cdef936bda1efb5e6e69625ed25c54b545b1733451b67b971efc24dcc67221b8eb99860ab79d33f68b84567bbb50416c05a0a9d3124d4af2d8e33d673f1db2f3f232e7c807a244119d8959019176509c8b9ac78545eb08f6f26bb508594c69a29086ad1abb4a3e3c0c648adf8678415bead95161325475df69bd14ce5d9f9892339e3b3c73ea796b4f2c4c7e66398fd3e6c19436d53b61985dc0c1c340abcdb702db56e02d735dfaf0e5c7897a9070eedf996bb9943c7d3e0a4c49478b08f48e205c9b5b08b21d91a355c5ed3fba775609a14c75af332fd2dbec3948d82c7620ee3ec515c5b29f91c2c77520b0a5ae1300135be67c08fc9f22993ee45eeeadb22be9c4d6c0d3541a99e189ba587c9a94c83adcb8e9be400b050814a71b6c19f487466edb561d4ac58ec8dd7c385d8f31d016f5bd233f22955348a4d83b44c337daf229d47056f6f265945ff9d929d422376c0e5a988be7b8176962c5a55687a1e076028628590bd827b1e0aab57c09228944e5271a618b5df583844800167c257eddd645c28fe8801e4a2fec3cbc5167e870991fe265d2979c52eb3f9bb94fa5f858cef3010b4ba931ef87133035dcc06d22d4945f75a8ad275516ec2bb5abca12bc3a4ce28c325d0ed95b190f78cd68aa2cd90268f1d2441ca9db879be63158ff18a385f944afd7b0d649ce972f027da00e06c9b2bd4f1b27ca12cdec1cd3d6026088bbff450812bca72cf9c738209175a4120bd595af0188e7c9bbc1a2d2b158e587facb2cbbbc694d50e64225682c61a29bbd019d443450f0369843cf2de174a5e9d67988894ccb11bb5e56095194c70a146d048b4014a190b796b38a5de189b647b184c159098d8709cffec24312aa9d6860b08ace9955301306493463c11a7d08db325f734220b3cadf56d0c2f221a07eb651eb133f1bcf00a2fa84a544cceb3cff142bcad34200bbbee5a17170d3a6782251ee16b52c521e60b46e156692f99d04e64e88296522fc0eb33011f184514039e8c797304f8b3dc2b81afecb5765256eff9acd89831a215213083da9a6a0f37d7a6429ffb7dc005655d98f11924f253155f18c4b174afea249ee88cc1a4bf1aca976129565512dbc74e8c9073858eeb796c0a193bdb09f7efdecdc93cbd6c469d4861eec434f0210b5d7ba9061e621786445ddbf27c660c056ac0f68736bcaa06f6719a1600f4a7d336f932605143f3a9294c7bb7c94fcc8367c43ebc8964317b6e8d25be29e447357c9d48c201d54288e9157886c9a0b2d87a1121eb8e174d2dd2949b72cf7584913aad854cb8738c1ce880cbbb75308f3df5372f319222238b7a34ba7b065d524e5c20f61ae64a7b9e50c2938ea80a0b738ddbe356841d52ef569b96216a8ce98d5da30b8d36f99cdd7a9b279cbffd4a3325488225622b965d645b815e8bdefe16c9ed70f05c86fdcea1fe30eda895d100bc038accefc98526c8ccf3425fe5ed8f139a54ab55d8803bc23094f6f219550b81427da5bddbae5833a7ed645016f65a8cedbb27acb301dbf3a5ad905b899dd2843b35cdb4b3ce0b5630480f33509d9a4935a2f1e55110e20a69410f4066cb19ec2754ad1af7aadc4bd0eeed9b09b166d552fd1495104752f5e553537e8ef404938d927fe6186882c698d6612fd89f82aaf053353db38d00f18b4ef5d24bdfd056c7d16bd69f733e8d936d0f36eba27f204156a1f1c06d60f20f941374d7cf06ec3624c48b3d0f1b826b9982312a941566ddebddf7eb3e157d8c7329a5a1577fb79d7b90633fa6a3dfe24fc419d795fcea5c01a6759d340ea5d8bef7345337c64bf5a2f0073e9e94591102681cf25573b4a928b55b2e5bed4f8004f6557bbb897fc3558c06609a4142ab7aac3a95e346406e48174e14b7a81a6b914a30a504859e4ec9d18a5e1211d075a04b5deab9cfae1febe65e44c62db9a8f417e069ea512ac19c2a3c70b9f4373213bb7f9eedfdb8ee28dc9a9b456a7e141669aeb27a1fbdd180dcc50ae2c4443c5e9b96108491d473a93cfc95e245e6bc81d3b77152665958dc084d49d8fe911d6225cce19d46dae6bae2bf487f66f99f00737067b3e5e25f77c3383a9c63f65559ad1a44c3d8bc17820196072cf5ea03d38f3358e4bf5406b1cda62b8effae8bee26e62f81b0f96ef000ffb885a016e251fee6a2a35f88ae006a3bf17ee922a5c1cb59de6630cd4b135b30738bd84352785422f6a933ace884d05a9ec54c8c57191855b06af7d54873d46ece2d79f5f74e442e80c5ac7f7c778402cc1f6e2139f4f20ccf8f5080e828d07b8413385313d0aa14ed878ad55767b9ca708f5ce197aa281cae3b0e2172358603aaada1a1adea3415096def35671336311ac26fcaf12e90e97de348f69c2a50ff6e471157116106204b13074bc6977c9eb2aa7179245cab9c5615fb985d62b60e1c8640c7b95fd52f4da1e5a066d014438afa4a673eb4a0fde4dc2d9fadca3447ac627e0ae0539c562425dbf913092f145c9c9528393378cd3a9fa751740678330f26d6094526a53e9933f27d44a4391d477a05ff556d4a0eb537d4cd57bd96177d6be7a90e38da48db07c3d3f4291db3f47ee9d193b53e573b02f0896e672c8bab1020cf1b4e8354ed80028ee0d73486e04ff7ff92dffeca6196f6b33d87e209ac1d16dfa9660f07da53d4e23374c6332b771b11588c7dd8ec0971609414f55a9eb10b61f631a43ecd1ff9f29200f3e3fde40f83d88dade21adbddc1711e8f8fdbb46e43d063e57116fdfaa9959b69ab4480f2d6e50fdd51efd50f06c8def156cac0c6217c2002ef6e8401f67799af93c3ee707cfbaead7a86130cba4693d4b250d0cb008db4b347edffb3d34172c29f6a9c3bfcebef0da831ea57bee2827ac4db8b9b9a168a289f6c023d5cccae1bd576f3bfe849e4fc9cc24aa4c6a1c107c01160dc19cb56e852dddb1b35a0ecb6d1386f87cf30de855b4d6f56dcdc03bd20b415ed6f7f8134e527d81c11a4ee3e9da5adcc1d4c3193b52f71967c19b7577cdddb7b7e82b4fc5611d4f2ca26406aa4cdd4b6a0ea7af74efdc48b52e11009744144851cbbd20072a59d7c8c18e87141b44dc1b416d1185c94dd2ffaf22c0fd77b5843f314796131cd16e8273e5bb19a073eca2e162cca7795f1fcff514575430e765763e208f8ba86d6c32f7d491ddb604e4c2115ea773d99c06f09984a01c73ef3ad7b1dcfbf84fca07f0abef3bc5b0b5dce139eefb43d1d3457e6de9b01f0de1d5bcdbc8631bdb1865434ff0a27170c907bd0143aed3c82f9b1d41e3dd664242ff158eea0d0c6b11b6c763e64bc5c226bd49c32ac842dff83872aebd07c570140892f037c4153600e8277400bee8b7643422b2654293a74fe5f41b9a9e00808e731962e02312dd3fe48e27323c621914a3de002367dc95af40299eb7bb4c169f5fd2306343c666bcc51347f603cce4c3ca009a6b814f53239b8e33d893d6872713f10c789ea515aa4e79e587a2129550f4f75bbef8ec7913e9f15e1f50d07f97989ada247b933ef52bd117b3a423ed763988800917e074323bb74beee351fca60deb6f11adefbf4cdcb694d4296b536ff498752ebb8b87004075b8c652f48f8c5ba9fa6e1c41460074ecf41d42e8f769eeb9e90f78229b4d283ca1f986241114ad028bbb4cafa06214c10f84a212d08fe567e9db182ed535582b2cf925d1fa742aeb27a57fa6fa6e65977a53770309473b6f3d37d508fc3ff53f6c14d87023df8aae9dc84abbbfa25208247d4711d23118b5a348e8856cad8b500b19644c5f90177abdad0b2ea6682faac2b55a7fd2069813ab6d0f7bd84345aee98c8ae3a70e6b9664877d4046d3e1ed0d0c14a6aa81b7a3290ae0054aabe373889b6847475771998951f627cfb342ba7e988c33d17887b9150d7d4b85e61d4b7710b26671247fbe4bea7674d5d1c1e1d1b862ceaa38230cad018f98d20c5ebffc5b547f2b6b3f11d1ccace0d72da65d531cd55afea697738d65deac2f9b2a05e089de37894749983124a98e1a53d2807de92f1e801675455ea431676333e26d12b276fd4b52b2573c8f9c2799fe96b6d911409253d5b267ac402420e2071edb0a01167836002e88f32657976579b29150baadba6afbd6ea5c30ad3c1dd3f2e404274973c96691c2be2accf9a2d232e3edac4ed4fb074c78153a91eb4607638f7ef59bfa8e539f0919fbd35f5ef95690d286537477337df741a74583eb78ee25d723b1ac11166fe9818efd181233ae603a3ca28f19b1fee35f8766342b0fb49157e3a459076755831ace23029eab9e33af39a44201f39c24afdd05137e70417bda986b0b3065b279b013854052b27877e392552210a85179f0a93846b01b54b99a08a0beb0c16e52249ebf9b55467e6821cde0eba8e3a336c440d2dffe9074576824e2c5e4d349285e330c3eb9cfb44b9f406b60179d60cb4548e08b6b4f4a76f3c49f1c74879e471e70f4a7b594e5b6cdd9f49e95a4ba23dc7d3064b8606e348420ee8951fdc730e29db1fb2a8f8fa4a289642523b7066a5aea54d39ada913ad70a2e0bbf142ce713bcbd1d612f2a88fd497f4d1b3959fa6307c1174e8fc5e34da5a6f0026ff040bce45ac977280b974d0b811e061dc4e40c178a6966d0fc1ecd29e04ecb0193d7a879de7b1cf0d8ebef9ecb7b875d0b2ecd553b9f4ea9d48ded946af25de885a58776fd9bd9af9375e4a75cade8de9f7dc1aed1dde50e0b7c734ed7bba37e58f436740184efafefde6943fcfd60f98353e537dd8c09852f600a9d1efffd85dae76dcd839eb6f30853320adc06a7a5f78c232f094bf59930f03435f15fabdd9084e947e7b1af7309d96e956b41a73463513a853c6c5fff2944dbb5f5bfc0d47035b910c5446a4219873006d5ee3bd27446240d09e2065531be7ae72c757de0ad3921215e1a025d9d1c1c6b102f066ebbc8529e57d54bfcf6ac3f0e5c86d9bbf297f40e1ca1bfdbe9718ef5b4386bb86dadd37573563894a8664de81662809b430e99c315aff13bd724512219c6337a6d76ca5814e8c103f83701dc9e9c44fba864765cc9a437b8efd66396513927f8faf0efbe6969d49dca8401dda1c37c33caf928de49c9712e34d3328cbfb2ca839c144cb915e0ff2517a8695c08f7a6b198e774a35147511df02a20f547315480107d9dec1b3ecdb3b7cef54074207d83e976e7b720a6f1a4335bed7fdd9a3a6d9d44ddb045463d1b8bcd002c79e2935615a889f96541c8bb2c1c30228d3845b7e066023f6b44456190a15efa670ad9c3d6699b33c1706cd7b15c35bb14d4c0b32698d1c5b97f0e40e0ad1eb46866ea00b1e5caa673fd4757feb3e68f9af72074e687c36b234fb28a54074b643b1c8554ddff5a13e9cb7a2690627736db80f96919aa12856a21e008498d81ba9186e77d553f40ad07041bef7b3dc2d246be4f70fc14578dc523946250ffeebaf0cc81555ff8e538219a11d48f3c028abfa5941525cfa53b632f1293d177defd3b6c220e9e1d992a6729e78e31f402f9da0d6e62187f53ebb711da11a4cf3d98c1c83878940029893cd81782f448ae541c4f72079d5edef8220998db13ec829c184d031834e043165b35f6e5ef7401b2c7e28de08515c3943c56a638746e187c11f4ff60f348f6069f344c2bf7d79f0d2a78f65f0cb53f06cc3ad97a54163e77d2fb56724d3b817cefc044e4f103d83e6f2e8b681759de69d03b8151651c0046a4b37cea04ee0d96a5e7c8a9a9b57dc93cef0d4a0aa91f551c29373de7ad192034e7f1deacc7a9cf56d45720633dff075f4fc951d24554a495760364bd11bc9537784e617c4044f8cf19d8626ef211a19088851078b8fff45060cab38833b1b00d316ca1826d55932e2456128e1ba9c2097cca80981b66b8012250aa41e52ec3483fa0a780f6780b320aadda70d92f91dceaafd5de78391ff64685fa740cf7a65f626dea137cfc44723cc71dd43921fd0d3d7708718006b6b13ddce4caa7ddf65a3ecf4ad2681e3214fbe56134f2d8f824ec9c39fd4064759e2b40d7ae492d89c8d7489fee7c29b53d23db845e6abbf00d825c384b54e96ecd6ca77cd6632b9addbdc9e3bcfcf552be20d0acbb97c68cab8f2949b24e34659ef71a8dd5eab294f1d6389d2ea880eb1ca1665ec111ba00a079df2ff55310a8e0d4f0fa0956625638977a73091ef4aab0e6547311efc6fde4afae00b376cfc2e52653adeb6885e91afb0984b802414b57389ee75bcbcc26874c6b21cf430c8ef328026b5ad0be629d9c96b99dbf95706b267b185e590be05d200984b87cff2efcd6b4491d5b9f9d01e637fdde10c94d09ca7b9eb56502bf261d0be887ae8b9f817eef8d68a66831f20dbe492ecff83d8341de96dd4ad00956e1bd7f1f6b7a04b79c9b886337977b7200aa8b0e98fd436837ec7dfb3f4297351b1022bf67d7b6b7fcaac9a4b6ac95aaed427dcaee28642c783a397b2c6b873ec67c930cda0054054bfca62a32cef4d030f711014eb54060aa121aea887d5555fd147b26b02cbd612f57dd099f895a8857ff66aac854bf0c43905fee172367a69b84b32c225de78712cdca16506cae58a4c108723a3d303e9408b69dde9e3538c7bf479c13d2af759cfc8686793caa9e9abad5e244f9d5809da3fa58e4b9b8b9be3cacac81981796af76b7d26dad1dd5c70aeb2e344ed021447d47a63b68a1e8a1fbdaee04ee0f104af1d0328194682a46db88c1092d9f4a6506718c546c1f55691d61857f504eefca2ecd5d696098b2ae96ccf81f71e2f7da04af3c99a6b522aaefdb96f75f192c2a40b483d5d73415813288afef6a9c7bcded92de750d8a244c5b342adb3fbde5a6d364502067d033bba6122011c8ad070c278af5ba9acff95051c83e161ea34764a6764a42a736a0b47222364427c6a9b047b4cddfc5bde2cea410b9c459221e5eeec3b527429c22bf8de78fbb604c7b53c191265014508193e9614d79d5f04a1e9bbb62bb068250f9fda1d2678d3b84afaf0009358158210a61c3be4393a9ed6fe24eb427d94def2476347ccf4725f8ea4c04f9e0e93b54c6a2dcfbda68d31752a4be640936e8cee373025997948fac08178dc391a5f4e139a989f8eb7051729276490b1161c975c4ab2ff761f8b65da778e03560c27c7ea287653821fb5bd9c39b7b9b302b34edfd5924bafc8c3d29be2d95671cf12920a5e0b9c6d4d012782b1cd80c680718e991d47a4a033b22b8fa914dcedcafb708fc83ce62b10723646f5c749fccd71eeec21149150a5c61d584daa4f5b79ca5d465a36fee264f77fe47b4c1926ba1bd2c8697386e901e6d62643579eabcc64493ee02ffb4dc53161153f87ce374b7ee166cd13eae589d36a583e30f54691f5a8c706d81323f729d2ed6f469da4fc11e9c8aa80c823bcba431fe5427cc350078e5a7815e1f46512805a2a6a85685e51a707215230f0f02dec5fdf4f081cf39af137221c77766ede0b36e1dd0083fa9539a0677ee10039bc101a88bd775689a1ec43d8ffa36db3ea6a8bb63d28baf3abac4d271bbd420ca3056053352216815b586a9249421f9f0aba311924c0415adf27dd39f06635cc973d08eb8ea24758a9737523ff7e1e2eea1aefd6018f8336ee8222cda51b3d98446eb2227f4211ed7247da226d701dc5e77c11fa3349bf1ef2885038189c86c46c9576e7699320be995d7b8990da359abd7d447c458656b314a0f8eae7734945aa7cd35c9267c8e1fc2e8e538c8a15925caecc7b20c53c3ee6560a88e4ebf591b570ee5249878c12c40512878919d96f1806a4c112a17b1c58e45111e29b64818d1d96f520525b1d8073011e7119d8e44e17870ea58dece3f7e8e6a92e3f63715f66b184d24ef9feb4a363d662ad5806272dce72536c173b5225ce97ca4b182be5ec74418ca8304fe147bd5981f0882f81de74ce3df9310f2584ff9a469880bc15b5c7ecb743387aa482b312078493c700dad4eb02d71045ce725ef1c369ba059c409e1cdcddb38651e324f3aa42734d14a2cc44a30716dccb69bc16bd10728acb1379a8c426365a214b8428562af82c7f23dee5ac913f3e7ccbcb9f862aba2fd759c0c2debf4048459ee55c09860d930617c3d5e2ac01baa13a118de9d2138bdd5fe9b6ac8b342161c9e607392e46726b8d24eae28286add1c596ba38363eba891a75411a677b04232f9f29cfbc210d3998a42e95200262aa960ee0e42856006065713e029eac36f0d67ad1b37bfb76acccdbb52da158244873e4313171ff15626e175c0c37dfe49983a65456c2fe625f9dfddc58de5872a46f24e1452c47f73c415c2f1fcc82c185215bffb1e482c04577eb6577db443f445ba1cc91ff01a43ae7ee8c7c62f79704d7ddad05d52206f59b494d1bffb172796088d674bfc629261b7b6bfcfbac6a8b512fe1371ec2397d24878ef4f0bcb0dcddcb644c06d65d66727470c0378391b2ea5d85fb8c1c4e381a9bcb5cb2d3e527faa2901a99dedf628ca90c0a03552fa36ee6c4e78c3e1dfcc295ddc05709b3108b65f7f4f6ece5d164950839abb125c2eced4a42ef4f493bc9b5313a20c075fcca5a5d0d879187cc6be03895613020bc4abead8a8d9dbf813953a6195a39858f2a4b51e7891ba975a3b3119d9528a5da976cdf8d248cadba86cdb8e1dbdd01b1fa87a8c79dd0825d61373518d93f9042c0d866ab81749987aa9fff3f920e18a113ce060b9e848fce08367b5adf74255406aa39fd200165bd2358ac65eccebc782f397b23342cfac64fce0865be7c295c93340076faabc676ee10c0729c9f6ea8539426e74a0eb7539b8796c11f7f0d24a676ce7184755efff14f84ae99a48e62b0b54e57af99a00f46a4ab17e15cac2bc2783fab83726037dd9457a66d8879d5dd05b9b0dc8683ee2562d6e2bff30a41bb9581af9117a6e19b5f2aba62a9861af6270bf2697fc34b556a59efefb672242015f340d6211e8a6690f9f6cc9652fe109359c0ffe1d7f3fd6cbb22eb92f0d47ff0ca6a53928407edbdfcb85f823a1fa78118fa9272405510f71d731d55733575be0d4befefc1452180f50a2eff6b31a0cfa6e69e8921031b44a08ca5cd09fb678034b56a090d5a3dca4f8570e261cc00045f20c26e78a0d04b55a9c059ad65428e2b4037f69b7ebecbd092e5f2395f5fbf36216d67bd2fd40c6cf64abfecf851af2b8bab099df23ff1efc8a17448d080890a71951f93b3a71c0d4e616429f7c2281b8daf6d53116f461718bb4c6aa355ee5bac61f58bcf8f1a0e248f519d93911efc8ba95b5b3b127724ed9263d99a846caaf7f69a9c8ebfd619b0116b283e544fc50713764938289dc2f364019928e93703fcb5c20ae4c8ae3119ae3d4a13819c1ce98d00418b2432ffa7c9a5ff3cb4ef7b54537caa2a9b6a1e4c04bacec9d9fa2b05f0b7fddb428eecb212bccdc204a28d299ab45021a519bddb0a20a1f9df72b245b451fda3c1564cf589202cbdb913af6315f824ec55b9688f7ad59883a43871ef115659cb58ebf7c8a2efad6f809ffb61bc5b4fb3360bc3a5f9dd1bdf0029d4ebc7bfb458f3b8a6d47f671068272a22ac3399f5ba6ff07f8e41de410f031b37366c6e26460fff2805014502422fd8276b80b93b8a463566d81d010a5760f8b35c1b7e189a81ad07b68673a4fe49da0eb4a3002edd7d7d66e4a5a4da35e956229a0ddeb97ab922d9b79c9fe83112c8082189282026a3c12f38ecc0d882c343d6ec259412b13593238e3336a56e1599634bc400938b3f9aef58a9dbcb17dacc3f5c6809b899fa786d150781ab059ea46f9d601210f221522b113312ba4057bff53b65da25b82d4786e67256d5830cc105a3a39d22996037555e4df7312e98e1a507b41ae2b7bce09b57088a7d9d693907fb6659e30d26cd9c9faf64d7a920b7c0412b088935cfe344ac3c4fd413d8e4c2af7d8f4315adf0704eb5b83549cd1c595fcfc696dfb0eafcd0e485e6e4b9981ec9c99ac232979af09bc402ab790cc7426e955540b045a4dfdb8b0fbb5514a6d50366d2e00958da4129bf3f292acf9afc896b35a7de8bef3f91488d3b46b949d200a69010c8d82f3193fe525463da47d7c8ffcc2b790b23ba757807d6899fe0ce1bee15d80d1a68d6c6b8148d68b340bb2f3cba029a6f02a7584f8daa24f699a62d86efbeeef5154d2f269198e54e3ff3c051a554b48c5178d38e0a3df638438ce965cb74d230b19a86826566ac59fcfb4e06638650db5c33e72d24ba66246e475905db8d70fc83182c809787bac92ea6abfaed48debc64cc7cbbd1a50b79f1c7ae37abd638efb5900270a709aa76c7221e114cfeb022726e7264a751e92b58a4b8b173879f61de0a4f3423e195d88f01dc319e8545a7ef3c4b716f355813dda92ae35e83be8229e4b67b854a2d476ee1c741b63b764856d2bdf4aa637df81d0c829be27474eb8e28311053f1df67620010a367386e60e1ef245d886d0d23e7889e502481b9ffe854e2c2e6d353889383e6ff9c08f1951d0cf4ec7912d5878f101314d3978c9df167df22be5a574a896ce333fa8de0a6b730177aed86ff87f50a39ae67a291d8c0abe62c3995eec8226d784997469bb591a7d7b997fb609620cdbf948ab4d2668ecf279518020485016356190eda5005dda0e00bfc2fba9855941b96a9e12067400e6b69c77140368e8a03e08bf4e69227e138ccd46698f6addf4716eb6baf344b47ff1d01ea16ec91aa9e057b4e422e43d9d1ec26733c181c516fd40cf095ffee70dd8aeffba8d33c6fa1f1807599e2ac84656508a9d208d97dbbf520b82f144041b1d57db2c4349810dd782f70301dd9a76273810c650e4e38ee076c301baa49d3e69c27bca5202b41b0d2780e436051a0559d289743938889362b29e77b902d4a557ace28e22578a080904528efa48cb8630089cb1eb5e960baa1f413f32e3a3fcdde1dfdb5d4327de93a8d43471ff7ff921cf6dbf912d88ce226060976287cf5d830292cdcdc447ebfd2aa392059f2726b73635ade3e176ed2a5ec92b822a7962f4f91823116673e4b8aa4b27e5c5dae8202f9e64fd32fc578f2ccd794cf6ad5851c219793e2a84603a5f2034d992d964262d73d2b4ca488f9c3960a5c67e7a223136d94d2f1cc5c6458bca3c898a4721c63cb7cdbeb69bb2cb4677f2c9fc6a9198634737cd005acdb181b7729a21568216b32cef4dfea5b35eadf41736c09c957c43eed6672f8e0a38c62a6c35eb5560939d5f73e4a3feda6203d866a3bfa96e3f815017e77aef2fbc6aebd14fc02bf18b5d1495b92dc603d9c0747a8a6d8c78f4fa53520ee4294d6a00b72a06b584e38ac864309c03f24d9c0b2727a8152217e0bbdd34d3205407a3b59a48ffdd8cfe07ab4be4c5271d1a8fc59e2b680a8507d3f9c8c9f9966941d4f8367e4ec7c7ba5c6218f2a4d99190dc569a5095761b0bbe2f80a6427ef700c22a61ece791f91a989655ebf51d000df1b30041fa3ac1d67ee086664849444155abdca379a0c4e4ce4be7038d9b4619fca3e94bfce25ea38b827d4d6e635e8b97dc73012ec7041d5478c9f6bd9e08b9750c46be7adee9eff0c7640ad9d5df2c72ab942f02dd763221418afe800596882b1cf1c9967e23d939804a8e3346648efffdf31818484bd52f6145c2f81a110284abe0bd7b7d03b2306dcb12e8c627251b958a952840853909b715f404ef0e3afef44ce7717d403d0a08fb9db0c259323d17fee6561b5cae03a77bd3a7a5f373781153386adf644d96ba19d1c8edd3616e292504de15b1524402d1b64b4aed2118de96a9646a80c7479ae4fe01876aa5aca50967c925265562b090907b3eff80c9050cef99461c650b134cb64dede2cbfaad6d973536a72bf49bb08a759b7ef60b60cf8507279230b846c7322dd5ba5642ba1f782067a83c0ab66c7f174ace48003eb3103bfa01636c855fc652bd0fdac01702b193158c4aa76da657fd5b2ad5a25ac68a406e42a7b7db55f2e687ff5d678359e0ed3141d4544efb2d0aea0de1d981a6534a62d997230ed0cf88371e03dfa99f5eceab55ec5a9b09c7cca715272e966db430fad8f818abef5c68c1cc06438a8486f05aa88321eea0be2195a0eed7efabf3eb24fba5bb9392bc7f37a52f4b5f89f72947abd4cc418620609c1c007a83df7dece390316599a850f9a9a97325c7007399f2948ff4c9fe8ba96a0d11af02503ef4cb1442bfedb51e233cd5be07fb74cdb2b348c7fd3ab78cdf7debbb8af6f2ea052ecce4df9f44083091afec5303465237581c907d88c0aaca7672be92ba6efa40c2d9988943c7bb7b4ab85bd2bd1f5e8d5afd0713da779c0a795851eed2b1d946f9d19ce531c5b847b6d893e9862db7b33aa123cf345336723dff39790aaebaaada83761153e894d1770eee007437abb0bcbfe86d65f7263f2afecfe36cfa82beb6744c5533611ebea19c3a8615e4acc9179be5d12c764e645d6ea2cb330b59bd3845b6285e1ffab2250c4aee339ec810849ace66d2250fd4b16e42e4098c71a679aa0ffed5345caf79aa5d0f3b0609b9363146fe00691d241c9c4c242739f7b7d8589d29ccf8f91cded55e0ca859a8c581976989068f71839cf24cb02df404458cd44a6284c6aba8844237dc48b0acaf4b2d3280ad4099217bfa3735c628768132d884efebeb8712cb2d7f3e5d2a5d614da356cfdc9faf81c15a3badf818c7652e37d8ade73e42e8cae371437c88fabfa82840cfddd8f62147c52890925fb9fe85adbfaa9a83b2a9744de5ab8d85c2df2eae399893ddf57f0529950ea5773fc09ad93efda23ba12b98d63c1ffe9e6ac74e0169c7c6beadce2550c6cd286cff7118b61a52b73edc7847f973c7e4315160acc57299dac0ec0aa618dd55716ce0d94714edc7e0e18f02b7b3384a98521ecdfb72f350bc3dcc41970279ba373d236db76231c20fb340780c7769c6b112bb56ac972a284b60df8ca57a843714a578bddaada4f93da0f7417b43cb64b14dea4db073e5897d0894ca92ccb2979344608cc8ff3460e3523f5c7c183bec671de0c9e8a3c0f7b4ec0fc56917a3f740285a4e460e7ca384de000a278aecd8da09887495ba34c76890965ab8c3500a8d3d4a46caa6ce63d063a90e6d5aa3f9c941d6efad80cf5d3d84ef1952b4afcc7ea32492de25e2750ea1597a89cf8d0651905937d12035f1e1b25011363543932903737a5d2406d3aa64aafff8459794d3158b73113b9d7b2988217047bdfc4d71dceb6a8131aa9db9b47bdd715167f785443b8bedf02d3c32d08529bb97677e1c7965c6b357d2f98d01a61a41b5b52abf47b276a8b7f6f1c27be78fc822e3f7094a2885647e881061272742c4747cb0e18304809adaf78a416ade19c559e84c74933248fdbcc7ad244eba7a8c519d0a6e35e640822d7a01f362146cb5672a555e8b434d412e5812a367223e2bccfb6e7b6b07850f9d855db495700a87c68bbe5755f72d74b03a8695b716501f7a57e8e21438d0d707e576cea0e757028d1f1b1873523b02cf4b541e8167fd715fa717503bcc86e63f865b077de384d090579fe65c29752f1ef6301e00ae4d94ff14733df2c9865718dabda3209b4683d921a1ac711c0e25828bb9a8551ddf35eb0fcccf8ea77c5621870dbcaf32147b895d99c6c46dcfdb08ef18a8e0884f404120389e16fd2a3715850f89da1bb14f25da9a777a5e70a15b52333cd27449cc64b9d2e8446e4b81cfe29de1d07be404aa85aa66b00752525dc209062f175c15cd5c07db7e51ce35600b3ea27b7a17795f7c64c7dfc4a2ccbdcc240c186ee8c1263317d9f2be7dc064d72820ec8c9644c431ab005d12a618cf6336431d2d9774552e554a659e9611d806ff6db5d9b05aba3e747b3dd77797723fc24c63b1934bb0a8161f490905cc47fa7f4c2d6de335e1d19e65ee8ab6baf01ebaa7e17f244f91839581897208633cd861954e91120c56917b2ac46109674255cd9e0451865fdfbcc163fca8792548e930a82c4b322e483fadd9fdc2818c2023cdc88d25f2e979013c7c2d6892050f294bb3dff635d708980180b64e215a7ed20428947e1e5bebc1fc18d97d25c8c9ddb37336cf87dc9daaa617ed6bd9a327de375402a5aa89e3be20e0d9f73d4617bc9c20ee04446e1f0300d6150077d24a25808b2ce5bc766a4a3eee41f6a3a3f677bf5ea3007c974f008a8500f35b08bdd0e1221b7b9f691cc770aeeeb35a9ac534834b11d5c9b177522632356e7407dbaaee41c643a512e5a4ed2c8097f3b7960464c894b7481b66c71d0a3ec07cb93419f307f83312d24f025c778d2cd8569334050ad30df8517a0968b4bf91c750ee45aefed679007fd6019c95f5a10ab9bd9170b8f91c5cb02a0ae7b8e588f2b056eaaefe0c3095750a1a047b884fca4ff6d0ad6a56deb72b59efff3f197046d0d9763da5820e7612709188d5be86c10050f39d2df3d7ace988a82315710def414a69d71cdb536734d213096c64c96886099eb7a9a029e16cc55b660c399381a8d3e8151b4984375ba50c2e447f88c7c57c6df6fbe6fdb1fdb36967ce0af92f77007ab61e55a1f5888e6e44dea96f7e10261c11682a0cfed117a2c9c54218d34d6587f2c5ab6aba5ef021bde348f4062a75cdfc2315de74776d093ef1b13052dd92f56102de03854432d6ca182100c204368a6f76bebae3fb8bc72a6294a90ad1d900041476aa4c4ef5ba99f67f1fbf69480f39ae7d1e6b1463158c71f7f28975c7dd45a38054254dcc46f94e56ce71702f4696278eebda8c34b917dc274e4544565df79f470d25723a513892b5802974913a300846923eb2e1de47bf4cda990ab7ba9437555f1412b370607e36703c38017ac53fdfa56654fd5725f4af9c7aec793032f70b895f6d7c54c11f0a18ec03652cb44c8df466e379f90ed4e84297d9e711898187c0f5d5967c727135c69c4973ad0950952619a56bef95647c5ab7ac779b34b501715ed67f03b1eb9dea60b1d1b9003299b5d876a3314c1e518057dce1e4011172e8a07a7c53f12061b0e19e7e188e38f8c5b4d35c496060486305172455f69f50c45f59d81e53a61a215b416625f81d8d39e854126c0630465c3d8d815105415a88aacbc4e814fc14d2367f1ba52408d1f0724e926a53d02c849ad4ead0d75825348809439310fe380c2c7c08fbdf7d77c70dc0fba5d67416266ad7f388a34ccf8d07a98861a2379f73852927ce8c5846b47c69eba8da9cdfaa8cf1fdd718ec42c71741c485d813a5da0d8a3222607e2f0e9d0ea07cc4c1a480d5f1dd67c764d173765a8c69151e6597b3a771778363750cb80e42b816de6b6b88a4dc50ca9a84337cf0a8a1ddb128f0ff57b5eb6640d3cdc65768e477f649f66f1633e3537974501b851a6d1c2ac72ce52f07843e088d2aebda2684ff5262df768dd0d691e4350c0d7d025894225584c7321e51c0930797b28b369e62e091ddaedeb7a2bf270e247be72df314974eae97ac453c698fedcbff49c13414f76b294998f2c06bb6af4191af06ee087aa256255afdd6d70b536805487616c2cf60ccae0f849e25bb60aba47ed4fe9485989083c80c11c338afafdf1c53bcee654b8adf121365aa2f2a0462c7db014bb1d1622c1075c9036806bee24fe269b27c62a7a1499df67c0ad386db20637ac19498b0eeb3fab420e59c59eda2dc96e8c9a2c3e7c48fcebbc7309391a5fbb1b539c98f79a9185183d0fd9ab07d9bd4babc3bd4093ad9d7c216db02e2bbfc6b483eacb103ed3aac5736e6568ef45d8ef2af16c276bf20a93bb5a2dbdf0e49f7870b9500c96381f0e8736ecc8ae1d343e390ca8ac21e579c21a39a354661c22b11e8fcff1b9656189d413c320bd6ce9b2585570f9b5e88747c170a7ab7469a319ba401c07efd9779ac36cd5726696e8260c502ed2124419886081d581b98c8561d84278785271b01956a0ec4f467ee9b8fd8f8301a3ae1e64d9bb89fabc2acc87226fab0270cdc4b0e3696b93fa122fb3eeb134869d48a2e6c90d4565facf87d817a963678766143242d7ed5c7fab3fea0f1c2b7e58e6be035a84555078a912c4322e4487a9573e1de971429d139b83c3138ddf3386818d73ef23c6f4946081d26326fa65b9e71cfff69c7edb4c1578bb067507efb78e03005c4a8491775e3a85f2e4d029f4920f28ecbaf7b4c8d54fc98326647ffefc5946d0abd76cad3dcce6ab0129cc50ee2541b982427e718de096466ad0beae9a9361c8d5ac31d17b910012b6c6a7a8b40af277107252bea76c87d9715a52d7d2d1e91ba10723145127967ffcdd250477d4f4bb3872f33e37d275e0ea32e86c128cf6d433180a20a2b74b24a16bd57aadbe210b186013d9b4ddd67ccb83cc5a117d168fdfcf671a3050cf42179f10b0a71d9f8a9b04c8659ebc29fd107e8f8ccd6a5936f906ebe05053eea7504b1b96f7a96a8ba871e094a653258af5da9a7a05f1c429b8c222854a717a18ead85d366eb3a310e38aa4a578d2a11b28dc05172fd6e8c5593f5cad70f127ce7f9aab5e1c051cf5a541d792c7c143035ea9a38b76b030d948380e29de16600b0b78faa29464477ec11345f17de29c3c91e84a12c30ef0a6af6176511ee6bf6f2e1e030bf8fb945cc948e79a75e157085875068a6653497746bcb5f09e7c0b5bf1008fbd749495412769a93e05eb29fd3de3fde68cd6271acf8cc10aa2698836653fc46b4507aceb4ed27cff3cf1bdf018e86942af1caa9f7774f3e6624d6e14b6b595a1d21f48ba4bad5ba1d6bfb13561c28cd3d30af5fac2bd3f35479939856252aa0abe8c051b7ea474c000756a842671a13c6b03b6abd482e02b8fa4836602cabbedf239acb68f1cb8f9c3c302913608e95e85ccbe8f19c9ae9980a26f8f9393cdf29a30dcabcaad52f382eb3f1a42ed4f9bb2989fae5eb0cad94c793c3c2ee534b9016538764d530e676e5bbd7cb1a0af1adec05e0a22f695fcd666fd4124df75a293bdce1cd72b7703c9f544b0e779408321d37e96d30832f479232e3bf8049b13499bfa1e54cd305804de425a612167a92de95b95540c1eedd052971620682841ea9cc5f3faa1daa0f4e5c78abafa1647d360166386ce3b30adafd938d75b44dc1dea317d3f461cdb173dc1a546cb40f37368ccf8182c22cef43b4381c170b1224e9ffc7a331c5a358650634eb15f666cc208c96cc4184983588aa0dc336ab35604a1bceabc5c9cff55eb5250e27aee383cb1ae2dde5ff8e530eeb55b748818740d46793796be09a28ab8d68df5a867a666d837286f1e2c2320192236c57ff1e4a8ef5f7640162643913361db897312694f516d6033cd8fb7e29ab994c2f28d76304595726c6aad84006cac81b04074f426a480865bf8530557e12dec99eb7d47afd5ea6d47941cde88962825f9bb59fde856e514c489a869c972058af7e84fb184f963ca99dbc61eb20be6437aface4d58345322c5de551011347af4809120a66cbecdfb765cb95d984cb253cdfbcc6da7403bac0a80d33890d727c7db813b2fb955caaf4c697b4d3f336260aeda39cf8fa71f729600fbc499dcfb3fc642715798772aa709bdc414812bd7b68ee10aaf84d9cfeb0344c12c15b8dc4414f2faad6210625417707daacb40c66446656a0bd9802d4d05de759843613e3e330e160fd2eb39648256f02d61ec63cfcaf38c5a63a57c78c92ba2f8cb80330ac378996e49735c4b0308aa10b576ef05c05ec9d7f630718adc63e27c0884be6573167625e23cc6e7a054fe4e34374797b9f073291796baa83caf715008f467e4f30c5199719082319c80249e0a1e7e2a478d7615ae96ff57c822fae84987ba9fee7610401febaedf8ada3b6ba23f6066c24e7139aee0a9e6a6b87c83411f63d431728b9bd6981467ce0803893d9c7eb0338827d14d7b9782e879000251d69febfad4c268ed4296745319c324e547f9fcee49f2df12a526f6b8d4c0f8ad88ad543c86b79c793d68a1a85145dfac26af3940fcf24b0ec3253f43e2af7caecad56d04190463ebf1469f755de3527818eee11d53f9e41a4da34b9d8ceef295683ff2bc97c11d1664e3ea4887adfe56435e3b8364d9fc99387f8f522957d2409ede328b427dacc3b6836b3d39875a3e56817de640a3d90882c66adee8e720e3030be6cb4f2317d584df53117e7dfa2490f59e66b0eaade74d1627cfc1b943fc7e47db7790f6b96b29976e697be77400ca3253a3225aead7d2b9e226d9152bd143c91bd1789ff2e0d148f4df7be7a391be3269d37f907285987d6cb6f6ca4b18a0fc6bb81f98d65044cc656906d7796a61e2148479b30552727d9412883e2f2cf04b4880edd5e8ecfc64bf1770880579f449d8eca8211f17844b9de7bb0e0ddd0e1ba0a91247a74b134cacd0aba06b6fe67678c7366648a5f0c9105c8eb08d2a36508d38fff693bb76a182681dbfd2ba889e029375af129f5149d617555cc2830f640bb47aa5823d2b01599f03c10bb627dc906cf34a04ae73da1d2fa5c43272d4413b707686a33786df203a466ebbaa1d862675f0242bf52e4eb199b1a1ce88063e208d71e35f8bbd5639a91ac45923b9030e33ce95ba9e7e8828aa560870a0625ac0b0d8c9f15b2207ba23fa65d7a9c5c4edf1d2ddb66bddfe64c576425770e481bd9b6a14de699f2be820135a834d232befb61cfde39864acd1bc42028d2c6fd8518b835fabf772307600de656aeb2e0285cb9bb58cdad0ea6043bc5dcaa2ed5395269f5fb000f2c17175d9478347c70b5cb9ca2e900bdeff8addc4f01f95f17ebcef470dbdb100fcd2e33e1c92089dd1f70bdcea02627aeae278294a5ecd9595f3f076ea3e3cedb4d7775b2a8ede0d8bf839f938b012ca522f18fccc00fa4d736c30d24bf87334ab99d17081809335bf95c9488ac6952be132d1f2c3e3dab2a42edbe4fc534901f694bccd8365155e03662951f02ca80dfcc7665f1de00c8700730a6286e2e065aae9bb5ca0917492a8b56312c3cc49814e1e7b101d883e56dc69074b2cd541cb0b282667879be199e78461229ba44311e3d94cce29fd3f5d377c6efe9aa17dd2d0393b194722a6fefea50786f22afa4b8edcb21620ae08162c52ce2f22166e892485d5ca2c3cf98cde65bf149c5976de1e2bef31d958fe17ad961c5f5558ea65f385637aaa6ad0ded07cd284e81eb6a6e26fbc250ba66ffe600debab57be42808438da503178771fe7accd3cb916fb1914cb4b2d1a5a5a95f22e8e312fe2f3d2f219eaa1e82f2d5e0d119377619d105c2a13e6b931fadbd1f1999de6839381ffade3f441735bea6d403a27846c0e80cda9bd85471890202fd41c458f5a203f18c274da63059047a46c6a1a3c51aa906ca7a7def399693d5f6cab3fa13cbb9e5805d07ab9aa1077f9b1915c592f5e097a52831153b7e5de362d9357464e6a00697ad4f6853308c4aca5486545ccb4a36bc38ff5f1841010b1132a4e65af635e2c3e83897d40394acc9d42c1f759274cddb08f3601ccef29c4b6cc550785d1fec79cfb43032c221673eda2e773216e4e1cd110eb4f813edd3b5112fdf9baae67b35734cffb218efb236d4c505238a133fa168a4d43c98e20ba234fafb76dd8fb67b32574d417d285f4e08bef458b5987f71c2346212542157957f21061aacfe2c5a71ff88b00ce22ce24322653654244aeddf312a8261f9b197dec78e0b65144e76e10c44b3ae97061ce633c9382b3f6f5f89bbb2d6a496c5ac8b33b2dd9c125e2294c9c02c6563bce044dc963b9099f6a5607698c49ef34cbd2b0c6b8e6d6431d0ce00545a2e1e69039fd676cf42b130c47546811922aab473dd65ce3b1224e206ff4e45a0acbedd3a2085764db1b5e5aefeee3f68b477ebaa31aaae7673b2bb8527673e0b9def79dcfdcdd41557dbf65fbcad31bfa5fa7a2a0339af3415ee933fb7ad391bfdee25a0deef9be3ca16a4f488dbea5ca5ba4e94eb6797139fd545fc2b6156f9e0f6d9948dfdb104afa9b54b837675218dbafb91c7b880d3d104eb2566f7f0863cdcd8a66c8214207576ee06ac50ffd28999cdc945e9ed3d4f5511a8b95e198ab0a88d5dc1efed71b90400db0c0e21976d30cf2dc3655dbfdc0e56c026a67bb0878fc7dee42e52095f0de1817060431435c341a97174ae46e4ed9d3a5a55f38c1bf2b74fba49f23a4faaf94411a985cd4e2e60e5353bde1b6ecd5baeca97623a473219afb051db9ab41bdc17846d5fc488163340997ddf09f5d5d5f91a12821bc6a6c1cc5ee5e349a0b14d175eb44749134609c3976a22aede3f2aa05ea4ff17c4d826695cd1e85ccd13e4c98525c86bd5af1c3dc56cbf8d8050b0755a4c71ffc0f4dbbfb9fa0f483c000cb842860bf09e944ec7fff5f72f989a5428d3bf878b0463c978d98e34d3b796fd9ef991f5e0618728464a9e991683b9f72bf2be9c74a5e01945a45aac8c5d87c1c74c64cb97ab4bb18c6f16396eb71af883bda0f8d82c4ca6a37ac514f97fa2cbccb2d4384e7cb2723e802bb642509225995b0f8367b730966dbe00141f12d9d4716a114e865182dd0a945ac600daad60efe7449074cf3243d590ede5c00163c22098561c2a091f1510007286e95014c018e1162f854a7385b04906af0bc35d667a9e7584845576c0995bc4ff53c02c20a6e20b2f1c01e795478147b02ee04bcdee4cf7a3320eb287c1c54701cdc44563e294776d98b7dad0045d8d210457347d08487d40a8800a0a3e9e6135bc89f74840a9fcda800f2fd5968df734cdaf5052d75f5c5515f04eaa3478c9979d80406ad3552ab63bd857b9d095e1e0cf18cfb09ac6ffb2b540a6ca56d70e722f9a4ac2823d8bcc873b9bd0d4f7d1fa773501dc1935eebcd52e79441ed1070fa9804c3335d114dffab11b1b75dbd0605b40aa1e04a9ebc955f45235c61dd110baf815c3ae5c87439de7ce1fb3b31e054ea0816044ad311cb7336bcc30a2a4fcf88c2daaca172179f598c6b7ca30fa869ffae69b65e2d6a61f8ede1264df66a9e8252cf9f08026ebd52e7d41554594fa1e0a4660af27f95470c6034253997a847663b8086f5fa8dee9cea6a97d8f60e5a51d3d1593954fd4b5fcf07d715a73483a4fbe0d9512f130d1d569ef1a7cb0759531dfe73e35bc157d469c29e2e02b22dcafefc1b77cb702f4806ccae12955b62d4cc44f62bab272c7b2a73c9c8371e880c6032bc352b21437cda388272066fcacd19670931bbcfffa11ae570a1ba940db74d7a6025c043012c76742c0ecb54e752f8aa1b1a778822cc1f3fb1dd3a628e36651b7c7de64aefa2884d3b5a5aff0caf86b434d9ef5a4bff500385719cad062c664316d9dca2daed63ae053ba0913a5763a530a568d8aa839bafa4c66d964606f4aa7c5607df0195f63d9dc02d945a556ec0607fffed80b976b6c4483a36466207876362798ce36da9b7e2d7f7207c899e65a8d69a5a35c28ae9c2b883fb7a983e09cd0ba532459f34a1ac1c8ea7be406044c14dafe522868e7054ae16e5a46ab2bc780fea9a667e757cfb0607b61f719fec44ca6e14b53f6a53397871a1e68931e45695fff5ff170aaec75cb01c16e56d9ae111101ee919fcf06166da1ddcd5af7d692cb4162c0b3908eb7e5ed864c895e4e71ee99fb3ceba4ed02b5d9d345277838fb5b2348d2c71b31f2bd23363b28f45d52558519ae6f685d36efb3fd65805f441ac1fd8f81ad58921dd80a6d07b2ef43bd58e515eb7f6bb59110965764e11455de1ce67b283863d3dbb7ea6d84a1e8915a2d8b2950a20546efd6e1b7f3e3272eaacc0d6b3cb306afbe8d9122609a08835f0cf379ea8f9ed4954204f69f638e978a21d16168b495989d55a2b0cb4137088e4b1e737a04333cb0d8bd7271055cad85fbdf33c6b2e6556cda5d1303e2b60480c7ef98f77cae4f81123ba13394caeca9b09370b707903679c14081b3397ab06af6ce85c6ab4d2919bceed560398b519aec7103cdb49fbf9c8f2c41245ba6c945289010ebcb77e1a8a74d1e838902b3c00b84e05c2c98f03cc1bbfd724541cacf53debbf5384abf4031b016cd79332618e48d23ae517c442bd5dbd947f924e9584d55c31229a23225e0428753e3ed2e1ec156f5f1de7b67af243273c681052bc5e60cc9a627c2cb46e9506267ff1c131ab492a0c57b8fe1ca3e7dee9214270758d32dde1aad13a87768222b6f79806c62fd9656ff9808c4a47e75d496fb46f1688d392cde338c3476bfb914aa912b3a9870f98012a1bf0dac740039844c4af64bafe3bea026a26a6a5485fc74cc5991a284ce89d538c8e5357adbbaec6585cc601a3b3c479788e6e4a92e09b13342189daeb125bf26e5b53213a2230f4b1edae4b69c97d576da99c8ac1e2701321860375c519aa0f6a195119ab1a4c89643359e8bb33b76d3a08f35cd8800c6c96a20865eef02eec5e2eafd389581c1d051ee5f31dc8d6183881da928b912e4256e627f2880b4b339c0ea8687037cd78ded74dafe2719b19242139617b2bd770742fbeaeaae457602c414181c299d0f249192471833a5ea4a8c621d293f274f2eb966450b87260390bfd1c746c50277d6240210171e526a1fe66e4b522e324f3bd9f0e3e1c13cbb9251eaa0cab9854c950ffa31c64eaa4d565d75b899e0a736c3c4a5a2e817dba0c137cf454256160bebf106904243d980f128e027a7f5420bab259f1848d94df67463814d378fb8cb25122dbd3474891c66b59e4545370df96980ba1315d6e9d0531b1b546fb51ace804ba62ca17a0efdcb4d999df684539847ced0158859be386180644122cbca055fb8f3c604319c75ed1f3c6abd5eff0226fc581362016e3710692975524b406230a7aa0dc67c73281a3da9740d3a6ac785df54805b4ae1c72a4f7afa75e7527e128706e2004a69754878b047b018315118ae796198ab536e6850bfb835ac8c1df861d738cd06a09d82a3f5df2a7bb76cb04f4711b4fbd431cf5f4e06dacc2c4c053d87cb9f4b9dc06e3ce28d99fd3eb4f2c66ea634d28f3108e2ae729a3fd3c6df2f06593aa6b41a1c43b31dfa33de309262e64ca43c1432920c365b46a3519f107a8802862c52b755194706078470c69081e2a875ab9a5b5f4deadb573661ff5c1d83909d90031604182a3e8d003260ecd6aab8d5c7b7f950c66d01667c6c37270ee100646bc1443ac3605daf6cbef51a79e287181c07695f3e6d67e40837f7075f4cf9cbab1242380a1afc9c33c02f1f63a48f6cdc45f0c3a24489303a599634b75fc3f54c06909949568514d8f2d6ab07a40aa49b473646eb82dea35c04183f9d629243c989297b98e9d8c29f81306939816b6a57222652c7b4f31fa0e068752607c031648ce8ad32ac9a9f23f4658b4b371b69d0274db4d73f3259620da33749bd8d4bcf1fc279e4cad47d28e762de2d050a09ceabd562fffe9749af14d6e4db893bd9b73628724bacaf01018415ee4ab046e14dd0a41060791f45abda2b613806545e984e94b8fe292a2447ed0053999afe9cee912b50198911902641d79bbcc545564e6b9a1674bd3ab67e321a38c2765957dbdece4c695cad2f58d46eaf27bfb6519bcb689b39fa883b2e6e4ec256c8e23abfe672c63713469666bd11eb740889da771ffa6a8efe43eba3d40fb9fe550b01c61b9f49ef4c54d66f012f09757b45cc3af7b312df40680b8cd5d564330d071e849601d2d6af4ccfad129659d73cac862171e1ce97ea08b2ffa71c7ce110e34ac94786893641e36b538ae6af40b8dd5216ba6f160a470d90c63622e53d4fa3fd590f17cdd1711477c0256abdf08c8419137d108524826e2166a0f09842acbaf62003391b3c852a9b9c7f5ed21b527945dcd5b3855f11354701384d494961ad2ea3c7c17349020abf0bc7fc858beec9ae43f544da7b9cd3c19fc80c854ba32c9d1cf43d6ea8cd5b5597212270c1bab08f973eeaa7b6acaba542722f7650b9a6b86a14827d437d05a8061533de8bbbb6145b4cc1f175c74dcd52eae60be3aefe90370f439085841d00c0ef301bc94c047bb0e20ce453c15a33337719b59b1101348b1433f73142cb4d5c2445b571cb97508b2e1caccb956b2285ff49acae67de7b410154140bea4d8472b0a07f638f55443e75cb4904ed91f9e5e6f00f8c7625d8c5d60390e25cca5b10fc9d617d105195ca3964e5bba8763b09e7a0132a212ae9dfa362c54b04ec5c37818d0050246c0daf54400190a8606fd95a14249ce81b065626995997168a71477a5cddb8682eb420a74c8002a081af497472b0a42c02b2cb64c41add7309dea0161936d384f9460f0d1b0ab77a282034a847177388ba2e8f6f8672ad9b8c28a3f9b7c83a6034ddae5b6544a2661216c01d4591e66d819e3daa6e821d3a45526b7e73f690580508df8e7b3db1e12d65f64c8b0726ac0a046479dfc3d93608cf1b2ee3863d96a845b14142d5f45962edc80b8457531e4bd1047cc98d997d2d68decd7a43cac0634d4d51605ce075722ffdf5ee918a4568aef2a1b8d582181e59c54fda20b376e1b99d066e72e2e0b7d18e101242b61115fc5f7b426b1e0d18fa791537fe749040d85b1cca1863c8494c355893e7907f2a8a5a5825859e9b449419ce14963ea8326b0db46176e1c5cafc086005371de1dd0ff7966b98cbfa475edf3e07ebd5efb6e35f4528dba1dd38de83db5f27148fb4894e6a574ed123612bb3a87f7e493227b36db0a55e86b4929759c125b420004c8aeb8cf6811f49ad1ed11e70d16a8566064769d766e883339f4e57ca796e03cca9328e45e5baa6f08a04d9a24e33793a15e93f2a8e2562cf5ad28606ed6ac9b830393d86f058ed4452bc97a06f99621f8a17b366e7a34df43451fe961a4c5610ea30e1bc0c5f083c9822875f44b1b62c066437deadfa57c655b6bede87f4245746d8ab0250d46c6c6e894862460e02247e30277e1682c25dd78628e8487b6c74a4f6e2d36d679857b7535c5dda679c38790e3c14286848629a979bf5a3faaca6d6426e9aa3e592970b08d68b730e615f3db36d57256ac09bf68aeaecf178ed4ce15a1a2575ca4d0dac7851fd6ea6dc11a541ecdc32c83d155892a901a1ad67c3cc1ed13e999b2934725630db307bdc5947bc08d53114877023a1494d3275d67c6c230af6c61537c6087eadd032ead67d3c217da26970d1e5213dd59e304df6b1bbffcf2059f55fb2db411d527dcb2080c37150f059cc9799b1b1eadc984e88f7fa87e6f8d750ab22671ff36a4acc6ed44dc171cbe33ce146f4db3e82fffe81de6fb5d36cb3e2a4d92f8205cbabcbb8c6c622e70a8ae0611cee72aeb2b9f3dd6ffdec38aadeecfb9142df7a5dd52b72e46f5e2a745d69a41257ff2fd1a317549b8c0f61df86d8559456c6d17214c82de01941a4ca8562055c898d05990272236c61fb53ddf79ab86bc37a890b9a264cf090f443cea2d628d95cba452ca2be742168db2cda6f63b441613b3f20e69ab92a09df5678da35291b77fb2f84bf41cff41b58c8e08e23f1096468974d2a61acbf6d548d36c1dc5587a170e2a3b0e8d36516d98a3cb94e463c198af0f17ea0a62fcc0c0033632e6515c982ddbc92b8a3c26250dabf715fb130603234acdd7613db5100b54127efbd2442f60e8f5c9abb8269217c5cda212518c6ae7bf591c69812acc24c74a66e8ef3c41881304c3a34235882bba42ac766015c4b435f27af6ff0fd127a497827f1e43027bffa8571e99dacb9151aa808ae73014f23aea3345843240328c47c42b644ff4756d87d15ecc1cfd7ebe32ff2c2495e3bdb136de5ae0227a19dfbac6374d84c4a6184dbed22d9d1aff3f282f837b6159e41c126b4a564057c292ba572765f279b70914cc722934d5f0f7d3fad61d64e8c2597b1b0aa4ad5f74534b30769b4dd805d8d372084e0a72a88ff261c8b7c2bd58ad34930dcd9b4d2ee56803c01ea2f4659c08707421ff4df0a132b314d5f8f15348cb89a090c3a59586bc25f41a2ed2cd80a1ef15eaf4abc13b1525a0509c055c1b53b8d053ebfcaa7c238378e1834405ee654f95a1623b4cffe2f0b7884b8931d4eff87d2247645b4321a8bfa904477ef1bf67da4f32eb1c9b243793337dc331fb1fd2d3997e966c242d95a45076fe7796e732dc08fdf63fa5da12efad4ac27b9614dedd9cea0f96514b687c5717ce4b92bdaaf19b5987320ba31a96eb4923c61152c5a13ce1094e93e78518f808ba63eceab32d9a93d168bac37d315040b53e14c205b14109bcb777d8c8faf38c475115f097e3215034a6244bc6a79a5978e1004417046f1c1dfbb18d0eb8ae55158071c9ccbe80038c5339a911dadf4b8b93814381ccccee9aacfa61eb29d626ef64728e5bca1e90e95e466acc38e90c600caffe9ee74e287bf2ce330c593e6b4e0c8a112f8c783daaf41bc3eb50d72d7808846cde7c63369ca0ae450399e801e88b9bd36578b19e0680508e4087b0c88e76d502f2cfb6bf1027795cf9d4777c5755ed79ee712533d7484b596ee33796efa0e46f86eaef150086dcf7a505c3b9f016b0efe02a4eba20280074cbe31a0d63a24d5b1f15adbb50669a575df7ce6baef87cc1c3d611ddb2ddb2749e7ff0d6295da831a1b02d420ed63fd802afaa25db8e03a08b4bbc43a29bf957b936934293a58be2372fd460072d0140c8be863236f78a4e7a1c38bfcc23e8f283e4864993c693202cf2bc4753af228125d1b1b842012e50b0e5ca330ebf50fa1770bd08871374a6e0c7c42b828f93709e674d980f783684df3ebf5cf311d640713e8efa32663b76891434f704c5362a915d67e920a2310421b94122a85fb85d3f436fcb351f847a895d703f2d906b09c175de83f60eafb2e74826a7c78b0a299b8c18e666fb284881f30e607b86f0f34edc97f53e3182303234f6c918a51b38cea9c6ca4d690a97ef8682ac7fc312ddbad1a6fda0aacb423445943afda44331a95cd6bdf6a7f1b0c7f2ca02097fd39037455c9bf10b57c6764c165e81f7a55b51814d8a31140e745bab5828d380d0e8b569e322f6f1d7ec9a9e9f171730a5d1088359436272b2e903a21d294e643406f58e4905e49faefc5a280f1539a59afcf65c45ce6d90e0104f4bc721431b4b6dc75549571b4fe273af77f276db69ed1ef20fe82781147b88bfcfa8d6e1a0aaed4edad7786cedb2addda21f2ac6077246c77963ae11960d59857cfa18d5e6a241e59887ee4f7d51630264d3f1d51ab87226b712553de694161a2aeff713677b9c7270b4d6c9a7babfe0daf16614fc81ae25394a5382a808facc70980f47647d78435f722ef38baddfe20011c62dfb4974770cf0981a303754e1b9e2ecd8ac2a27d78132646d322b6a5c44ca2196aae8faa77289dc06cd3a87fc3fa0aa42397d5c5d528e828a70e0d7ef119b1db09ed6dededc492fe370f708da3dde35a6f1d44d21fef2fcb5b78708d6f24ddea62235945bfc14581c00ff1866ee73db23b05c2766ccbd1dc48905fadeca44496115a76e880b9f1c3598a19ff804c6253678e26ce71abe12f7fbc8a649a64c8208870be047e355630eb8f77fa276c75a04061beaecdc204aadea4acc1d2edfccd4ffc11387c644e63bcfe54fd706b3d2b133d396959c144813e2763964eba3022b7024a151ff75761b9d25ec8503da91d312dcdf294ad3d8e177c5d509b725bb08c3c50b14ec8091ce10549623bcc69ec79adb22b51d4f990f447f71ba2dd44230fee0c530012e2c85dea3cc02748c69adbc55669cd93e8eb860a842f2567f89933abafb0cf186287958344975a3131b1acb86301b7dc5ffd17560c3835d5f4014d0f854db9f4a4d19d030d2021ccbd19c342c3c00eb51d9449362026ac3c0531b0d873c578ad0623466ecdf923b6872376fec831e0f6699d384ee9416a4429bc36c8a8aef50b44d8f060ee2e97f6ddc55749648edd1f66a44093fa7d70f6f7bcf286875ef8408f546d26f12ab6dfa387dacd5c38629226e9cba6d5bad53ce5eca1a7c0b240c100839478984eba0eee829f3b1ffe4dcdf32c26a6917bf90bd10b536d0bfed0ee343bcb20b79ff509e6bd1a2c05cbc7f6c03c7cd9df36b8cff65d8664356b9f9745dabf3fbc3d08a4ff9ab4c5cefc5a9e6da933df89dd4babe8cb53e41a51b9a76576787fef8ba0c9818eba0fb53ba1c2f39c67c132a6474a74ed6c7ccb1492dde447f4445d631007792634a3f68a6d8f026fdbfa3f266b136df3df7b1475a4e6633b9ac41ceef4eacbf543ea6854f40e47e4e106c9f2b6cb511835cdca728b2e424001c8a5fe250968d3e42ad53b6b2efa7fe055b3526a8b30662c92a1095ea7c15188d17b17bf0b2d843cccceb40568573b46084f2039891339b37f0c3d37bb1546b970503c941e29f7fbbe4da2be88f090c262bf2959f799fe9d8a0a071d6d830a4c1197cb3c6047c400c686273727a653701e1f7d0462eb7ed388a6ccef8c83cfdea98f270443f32e72179e2faa624b94825625b842603f9a1f338045d8600c8b5deef6c4e6e16cf7ebe5b158cc3494d078e4b13e18284060c3fb8fb1a6de2314b202bc75d7f48334babcf50fd106e77069f97f9f684d4f1767105f387a5c31f4a4d7ac0b1cf4ddfbc8f4c80d9b4ae4cd4400f2f187587c9705ad9a4d90b31cbf0571ff834b4428c22ccf46e695d72b4a3aed94627254ee485ffb252fbc993bc5b0058cc83224b1b7a50771fc5f5fd26cab293952fe9a03b74d0eef5f17a277bcc19a8b6bfa5dcff79402411451ffd35ab148201cefa40d79c2a11314ed6aa25766ec42b111e85c772b4a28411f22040c8e31de0a3c16b25a777c3f9a9459493705cd23f0cd282b70aded87d1c5e6c26dc1c9089b80a49bc3dcdb11d6e5ab0aa7062225990d7e9c53edde046e4105322a003ef40cc46217885e0cbaa827c078da80835c5ec8b9124a34942ea7d8ad455f700a4c142f9adbfdaeac9bda1bffb4f141150a3a443a79c6e8f12a28d31b667852a5d7b78464705d926db953d82144386c5975aa80d1758718c648c5f47a85276877a0d467a17350428f57d6608bde965237071e9c4e04c08bf953ac16ab1ba0eeece72bbbffb7aab0c6af40a72ac022a391ff830d231e623f83a5b28c77b13f2682e6922a232e9438a87989b92681111fd95150c55350598c85f6c92fae4f8e0742f9d1e189cc724be42eb3d610b59f90c317edffa831b536e94c0292adece398eb23f00aff5fce7d696db5fec6598026e314219ee9788ad0708fc5601627ad5224d9a2ef45d24f9b8b701283c68848e42c4986e8175dcfbbd1b8695ea91ba2529a97ab997a36b5eb5171e5e307039a8e0c30ec29120dc35a77df4ee07b5471a7d8b8e90b634fb388643e568a813cc4f12ebc48978657840245281c42abf93187febfee690ad903a8f26ac76f3ff9a237d042f33bd4d9ded254d476203169e771805a71959fc7e982393121ba58aa657c0d007d142298ed3e861344f46c416f7ffe40ad6d23660e51b7765c7b586f85bd6c4c34a8ca8cb4b72d8d33430b997ba2c7cbbaa9c74f2b8f49621607f6aa502536595a37e8a6662ddb74c867aa45c8d951d6e7e6159f27b2971e43fca9a86f9a98b8ff8b76b000140b6434edff56147161dcf14acf030a20be54bb7fbf8dd31a32abb4416abbe21f31137f5e52c7382a4cfaa668a63db079736b44d6a5925f74e1574d3d4a5af0221dee03d139a9691ff751f9e67c8a0117edcf76e2e5e7cd68296bb1aec2aac9c7f682ef1997f55e3e9bcd240a7c7e84552b5dde45e2fb03bbfc1da22ff94a7a8f923ffb1e4567cfeeae1f45c8d544ff61ecede9b77c0575bee25c389bb4c61a4827f9c896a2b7af6b2f284b55d83180e426137f23a136fd7f703a79372859a613cb84e5fea3145a5e21c628ec1938c61256b454860ccb4ea8d1b498d8ddc7bc0a7d25331a78e6836d038f5873efc621c583199f55f2abe4705743f8c1778b30b2d08a53083ee72afabf354e7da51ba9a7686ea7a90188354d8947f217e42bcaa3bd43bf8011cebb69c18c38c3080ddfde193d87c7c3adea288dad3d0f181d9ebe703e3118727cc1bdc560dde14e0c3e7f79e36b46cda0209bc0d4a1ced49fdae0b394fdd6aa4ee7e0618c2b875f9d42e7a248e18e827ca74f931815c632f972a1ece0a0809898f521036161fcffed881c79cd9f26800fa7f9099bcd617846cc82b94f8d69db434c8e6f9930cc722f26c60cc1804f0fb22e16f30a65f7aad9bd8d48d4800f90eb05169e965fe7206aac25aaae19f0e1ab2e7708eca5d32468c437ac8554270070b9c2259feddcffa9c92a81697866b378c22b238fd07801576acdfa428daa5cff352549b236b03ea34bf467b0db0a881616a8c841440c5bb4e5fd4784c7d47edfbead97cfb6ff136c1df7adf85876ff1c689f57a2ff1a54b49a5b1b1ac88093fc26e2f1cd0a8169a7a6e1e947b7dd49806180aa30c4fd713352a7713db1a85c805d8b00ebd23cffe268ec49685ddbb614d8d32bc8a9fd34073abea0c42b00b3772304d97982beb6e2b72379796ab02dce849340bc3dea9937a55c6644b17f9bd78a59c75e72c5195cabc38f8db3fc22a320c61d1cb066bb1c846ee4ef608a91356e33d73ff5ff0b9761d3b0864f07132c61ee9982cd3ab122ea3c11721dcfc6959447d2a3f19391cae4762ef47b18cb78ff07464f256f5a435e2dc242c250a8a8f281648e9e2bb8d61a38102851018de2ecfcc7e75904d06d71da06d75d84da86501dbf1620373b414ae4e7d79426c522cd9f599b37282563fd22e56fdc7f38b2c718e52912c464f9d99d106181d9dd6ce2e99f62fc36e129d504e1f530cdeb488466b8a84bf433deabd5d8bbc205b3cb7a4048b743c0734e634e565515d7af42ef0d9070a34eecd1064f61ca9c2a9ff6dd2c0df3ab050b3c5ba9d5d5549ac3d13872006a481d55c37cbd5ad10f37684137494b25d62dbfc87135b80595cdd8314a77f9739fc4fe7b0cb61772009b1f4d4e4348a38e81ca63d5ac9600fdfe022a14cf452a89d367f33836282b64ecfe6a63c9f881c62a32a9f98016dd4cdf4357255216e0c384da2f3a13d9ca70b50214455a459f8f2b38f362b9ffb0c1e76bef273b3c07c852cbc95ad765c4e910bed378250ad74bb1734113978a0a46341d7fb4f3ff138aa2e8b75f918420533bc3c37d164c62489ec1865bea72fd9ce73e2dde7ec9b1047a32af60b1dc55908dce4714c5c8d6fe469cd9b75351c8147cad7c6cedb5467e4b2a328d66adaf79b11093fea7aa2f897d7ebe483e6dd68486686a0c8e1fc36d943b83ef6496e17c963c44a14424d813d9830d749c77fbf961e19ab7c8be2f010aeb31e7b6540db0df35506cee3b911e90d44cb228b966ad02f1176637a9d5d58549216a6d044272c4cb9d6238b4cd2524e8d6052f92845eedab1c5c98ce3a1c24430b0d40ab28a366bbb838eff2160f89fce1f6c1a04d23e2128f1a3fe4e69bb36ee1eb235d46c42c2163912db18c91a769a8e9acdd6cdc552fe98506d12ce99775a75173366e7984a874d96264acb72042435e8b17687a3e891cf0f8d6347d1b03686a848429292e871e310e0d881f51125a5f5a51356aa8f9c42c3215d33f7680c47cadc6397f15fbfabefc4441ca991b9ff69453a60c690b31bbeef5d73a65e058caef1e811cf7d31f67ddf9b4931462db2f8d98d970baa0e6a4e15c536a9a6b8a31de12f1d8255db0d1355c001c79c302ec32c91448ccc6ae476ec8d591a4582a367e7c8eb68df61a4f2726ac5c3e2d21a80a32da51e6e0e1370bc31eb9d7b0d3f703a1cac484424f4a7f272d8dfc8be621ab486d4b116cc44b80d5f63579685879e8f4e4f21060e45dfaf453cedff8cb47f07a52ab5361b9151b30cc2409d42080a74a1db93b1c02e255bc00a374054ace2c1407f3056b96d5d83f4183e1e6a886ba005ca9f01587a802424f87de2720848906063fc47d353e679be5e2e368a40bea2af128062073a1a4e89dc086c9c18a2021a9f04fb32c8a9c49df3d3aee6b495a059e8ae20b6d1b708d0c520adcfd6941d68af8e009eca0fdb87d9c5eb57056243d3350ef4981f8d547370b3b45fbf21b24979d6464f050ea8d325eb53240ed1658e868210c249f13c5ff8ac48db883e44ff3d897b8adb67bd12dd261e257cf2df4adbd12bc1a5f1a217e1edf901120f4df88f88a292250bab7da5d34f5de3c57d73f0d0e4e87d82f37c59d94411bff9107a1ecafd7745b093d2cf4d31fe25d4ed4219a6c7f26a6fad74eb108f84a71c8915c292947aa892a6f3a9c93054aa0dcfcb2cf2a639e90a08a85558f0f3c422500a15817740d018917ab329de8b616c573c409e49a3522373c9a9a1cf9b3b5a1011e04fbf65d0ab95a8a6c43438f3bfb303f9f9d2345fac3a351838faf288703222fa3377bc1a651bea5eff90d8645f48bd7f04b943d8508d7a4c6155977808940a55e68963720a2de147eede8cff75d09f070372fc954d7886a18c4c31bcb68c1a74c3a8483646149b0db76969ac23d21917de0cfa8ec8f3eff954bda34ba52d1c53cd9097a00c36ab469812b53b05df9bdf32b2382dfe72dc12389f98d60d302d9cfaf769da39488783671f78d8f30a07e6f930224f9f5f7f4338db4d5e88d8b307c2e5ccf37695607362457a9c215385f767248a0543a7be947b4865cb47eca360734ba00b3ff5378cca39e093c047428b3b932cc8c09faa69f2f744cd8973b41d854f02cc8320e8a101261184f2a5d2c3f6148609b453ac9444776ab1df24a7cc957047dd17a8b3d8f69a262674690ac0ea18ca1aee71f90b94c6424699367f9e800162efc79aef2c01667d604461c4b196eec393af20a95cff4f76f13e507d7df25d57be6513cc8b88904a7c228b65a3791422f9274d3503b8eaa8efeb3b833c51bb8a0e191486465e9253999e2d862f839c433778da665feab480c5d57ed1b752afc766d6a5e28436db026e70c7d15ca2905ef900d83c5d525824ebed12a40cafb3b20c8391a2b0ba6610fea4529f947f7c873a7cfd283f518bf33724a11f278d72f41bb6ac5ffc4d91f416007facb2c6be4a0fd1d87c6ec24789253ae1c7fc6f7947cbec3a03a2e2ef358f83ab222163e5ba8e7ce63fd692a666749c0fe43c24be352869010200e05c8fe5028f357c724f3302d4458ac2fd06185cc3ca6691db423a8d1f6501c71445fa6eaf728697a13d6ad3bff6b69419f775d6dbe2bdf27b6195b9f8f329a61bf1038b655cd4bdbf3756057c6f4dbafe25f88b5699c612023437ded04eb25c9b9dddf75a8524478bb292780f9e6ccd67d5f1f45481d9a6cb8dd8afd386c9110a61bc9e7be1db9d5c89cb408f26e3dc045e4a0cc2d3fb95ae6c12c4bda2b31a7cb4756c23899a0a174493cd5de7f8f69ffc4ac2b1094ab5412fe02d69ebe02c432332420e846036f92ef8291086d036b2839ee3ff1ef157f5a1071a7f5406a2cfcd512b74dbaba06ede45b9305dece24585eed6271746ab765a7201e390938e3caf98e8b3ada38c891fcf10f98a4e046564c43d686d990f0c8bd7748c0c45ecff62e2ddd5a47a880688ab4197dd8ac8fc2e0568874ea0dbc25fef28f1e0134251e01c9d983f8991273ece16d7eba36775a97df8bafa67c05353fbc374eb3723ad784a67909d6e104aa5ccdf880938f4cee36853c754e98679bf945cf7a014aadbf63c92430383f71e83ec0d33eb213c32c3890ce705ec42b51e7568ea0e95a68f85d483b2eece59482dfcd839e74cd59d9c0435440e8b871be192f7b8e5b8b4fb33fb90411d9c33bc72a7389cc0c4475817d5aa21584c9f229e9cb0d1f680c5e0e0b2a576b5b588d088264291ffe016239cbae2fb4adc2add08e1d02507357ac2136ce33eb360dc102727d50d0690f348049378564442173f7171fc5a6be7bba948ebe9f2a7f073d44e855893b363095040a5a95f3a2d6d14059f305a95c4f057eb03eb8218b47fef9233ad7c557c4741bfceee03f44d40ff890bfa10e31099144472cdd3d24548840e31d392d45a4d1e87bb3145b271b69bf6b16c7e8998426871e51c370b9c1980882fca81878410ec9b5f0e4ccacc91913c3be8f907758bbe699261e39308743e1ee194423db16ef36b40372b72583c1e098dcd7532da9ead70d56c4c31de267c409a4f6182b31e964bceb7a9a967020330abf69ab451b1adb4494523d07110c42e231b4dae378098d0d438185219c9e0841db3bd28701fbf201a87d2fdabad58e4539d03ad5d89e93cd2666d0800d42065134c42305d5d778e9d73ef2e7426b1375fe6d203ab8ada4b8b65e83b635f17a5a480511bfdf113fe47bbec302f7196694a4f23cc8caca1eec7e822392c4baf5bec6e33269322dbfe7c55e56c6658c94cf269efeb237621787bbfbc331b6d59194439af71e31dc78285c4f0b70fece28abc0e8e96f8831424eae949b6d4f9707d8b98f1511c3b7982a97403a775d725c091b8e0f667efdb127c9bd0a65524073fc2628138e045142c871c9b648c129373aad33ee7a658186ce56a7e5ce2be71f9545022d87f09c708f536f6ff2d00465cfc15107edaa8611f3fce0ed4d27933683012ef78d00c511cb3d45139ce046ecd78cf09eaa55dac1bc4c5a07319850aac47aafa85d60d106a33dd57ac5a60d74e1218b5c45a933478e6134251b91df10c5a77146b74d71cec4a8c1a24506e19022e12dff86aefd155d6dd50bb65e640a0390dd216bedeb464e8489a241bd65365135f6345e67773df6d6cf8cc6eab0981b6cdcdbefb9250cca6a9228b07293929180fddae2d9c71bffa93df883f5467d399f3184097d7358f5d7e52f522d95751e16ba4548deb49b075ae999cb443cf2c0e654bd58fcf060cfc6ce426d7fb599f31fccab27f0b8b28c5b94ba2c2fa1ee7e61e757024dc998c659d5430fc95ef37045cd0b44035c6e8fe058fb7524f400e5b46e579ce1c59fa34b3aa9c5f7204eb6f5aa2f41112d2aa339022db5f37e9f2b16661758f9156a31bb8efaf7e2c585fa9cce907ce2ef741910460a8e73f0a7bfb60ac9ef48b0eba953855415b578e67c3949c0eadc030b57f2f2195eb55e07ac91e573d5d7139a6492fe042b23cd3f8059db338ad8bbf19ea2055db3281bf3836e755c90dfd0c8ec74a97d34af32305b7544fc91f07b7de78a504e9e549b038cfc8facb5a847ecde4299af399018a668a5fc638dbe809c3ba09d3616bfbc40e63b9a95cd1c35cb723ce7ab8e54388021771a87bd4d20bae9e3eb40133c1612ecbfac2b0d64e6c0320773f03acd1fbe2033449e9962b822e0c967ae6c6b1ba6a8508c82bc95d97dbf6a7c0dbba0db822e5cd2d06f3113e5d4e879478fed2a2311f1147426e9841f491dc94e86d94ab0c79279cc1e5dfe424e87b6bb9ad4928b41088fecc13a23e9de954394b075fa5be6ac95efa8452517ce9938061727e7910febe61339f841130c008c3c5b87dbf11fd5f6e30ad17161191b60759188e33b1f8736ecc4f50be90bc33527a974e072b3cd94ea5732aebe85c3e999298ca6afab8fda79b29f0598bef678ffda06dd0dc327dd3ad2b91a7627a8aada79db29addd5f7be787201718a04737fd4a937ba28cc7958e85c343fcb7fd9876ac305478a5964a7fdb594fe502b0698994c32f08928f7739483f8f970e76e206a520ded73e7f4b8c6676381bba5cbefac57d52de30e475ccd340f476cbb20e66039044633b14b1781079ddc270b4ca28e01a496bd6c0dc48854e5b9f78f1ee520a615361a62a83d2006de8002f1efd0d957b62a53ff5a9bd2e7b42fb8930c2f580e3b4ee583a6c05f65700ab9904425975d1e70522c9800f8acf4eb77fe8b1ab70868d292eec6b7a7a59d9f44059eb3ec58725dc1bbc62b5aff9418072e3c50851c4f1f85caa6b3bee16e68aac5c52303573339d64d7832eeda7b5eb998882df116efb681ecf994b01d0bc827bdf0e2f3e2f8b7560778a0508bf5c9923c604c28991dd77d7d55a29eef0d206b4339b2ec7c759e3ca2f7c6472e005c72d35e5caad410217cd6159062d39bbe5037e0956cb8410410c9d046c6ab5af83657429dbbeaf4fe698fcfd7beb913b2a80544c0c1023bb6574bd60709e5616f3c76fa9b010cab310090838c74e470a99fa43f8fa942f2a4a00931b05bf68492371ee9552e156482d91b1a62d58c280fdb4a6745922277fe67598acc2d02ef63280ed36165893d4a3a7fbf623abb75fbdb53c467d41556c804aa52d598fc556d8905c13950d06811dcd032c0f68d254d2c58ee1a00a36c5694d955941a1c1d3d94840a0172d3e53e8e78f35557f0a09849b24badd05331f022a0389d33afff8be7d2ef009bcf9e4ea502a8db83d05d5f6bfa0ec0f4c3f8e9c6bf6986277fdeebe6bc21c8712c7b9bc69d1d36574318ca1e089934e2f0b28d61668eee93a49a0e9ffe60f17d559b8f47180eadcc453b2ab668caa70f5ae591e4396941936bf39e35af84d028895024f30c4174c672ea62d0466131dc281974484929ee5aab513e34237e2f0a9aaea58867d1db7581ef1986b3a2fa790e81f9af994a845003b182b4f2a6b072622ed0547e938bf40fe6e94bfa213eca6b404e4156346238adc1a530df7c9168e0fb101923731a431ca69924d2d31cc9c04fa974f24fe7f7157787b02152206d58e95efe55bb498039add3459889beff25f977619d02a44fbe1ab888b7c4a74b5ec9b2e785ad1e89ae46a8acbf2424d7a60028a019be5b9fcc0bd14c56ea132b2f4686ae141738deed4d5b1aa7f8c82d3ea35ccea76dad7a6d11eff5ba3a58f6f6bf6329afa12e7bcacec30cc64e2fba1a5220ddf37e4cdd47669fbff7328cc8c1829acdccf683fe0a20887e7b9d81d9ee57389896a6f8b80bcd9a117323a94b0684611e7891ca5191c07a902a4fb40f6af68a41a0e3961293b0fd2d93287ca5196995ecdf59bc4c14f2315aab8756aca2244308dd8f1fe1b1306477646578c35045f822fe64c117ce1b7babd29dc3d613d2a481396558ba400f05d4572fff74c57c67fff1f96c0d8bcf5d2b339183142fd703f8145d4032333e4432d74f063e31792d663ad6d632e82fb2e6f2b9df9ca2b917217546aa63025a847e2614038d8e84ff37589e867f793077c266d73c10eed223431f30dc1c6e900bcc177a8571aa4301639b9e6f1cd5c7deeb3029c6fca7309bd70c3db6d586399c24c7d0ce728e9b48b8d60f7b28f86fc213c0cc36d7c18895f945efa40774230767d277bb356aa5b4d371b3eaae1594ec6a78af3c1cb317066ad4df9ddba791a7c139b104cefeab9f28f109997f60ef46dfa197f776383f615eb36d4e88f8a4829d77a72f3ba9767d80d8420d48eb25d2ab9a3986ee86b2124995cfc53277927c62b9b735f308a195291b394f56cb41b1bb366c3ba6dad1a46f1282f576151abafeaa63e18b0ea3014888f107f05b43314b8395d53efb0ceab02bad0bd6e2936d2106e7af7db7bdd627d3e5cb8dcfa6cf1ae9d6839317b5931f060e38e3765cbf43cfdbecfa800beb7176f4bc88b88fb2879319e60883661a107bc816db9797c03d06974b7f43b54ccf312df95f063d707271425173c3a7aa1dad785dd6e5b8ecc063fe7d36b7ec7463b7ae0c301428964c8ab6a235cb48ffae305e6435c070dfae0ba6790c2d153c5eee562dc84f2d831b13419174159c9981a25660eedec6c808e6b8929e4487ec48913cd6d104749504351552a1a8a7411ac640cec60b50d2a709d71c8646b85480c194505a27aae4946306f050fe77bf73fb6ab477cb72d7e4064a48794738d7460a095a6579455bf79f6f96d2c541613de39a8fe419cd44bf0cc36d5d30a45e35fb2826b5528c87dbe7f0eb60820967b3359b3a8785d1634df4588a2f99126a21121ad4e1c5ee4555f9f2136d11003adf044ad99229a116c1f723c31df156975b08a975164d016ad18aeb8c0bc99158acb62c065fb8082c30f08ae0220d2bd7a74be730574ba395a399fc21e20a6891e051f7f947be4d29082a61de987334bb2c33e3744a9a8145f01bcb7ec202ba9c7f61e4d577c09685cd84796bd78f370c28f3a853c99083e6291f01ad01e09f64042f88173826f5301db11e901fe7e92b174969fc14f00be9a7d95e205ddb6f29adb2fabab9f9410b28c004744cb58cef47d2246fbc1d96d142b6ae54478bdd78034190c32f30a9180c9c64904ff0c59c3b1a5e0bd8b82689c7f320241237bcf0da2bbe68987331cc3154b8417bfc22061c1b0d3ac502c88901171c998b238d620d071dc7750d07cb2b2a12d70a69b6108e5c6de28a2df8ece864d8bc8c36ba9fad86be20d6bc387201b5485518d5774895ad556a476eb8977006fa8f4405c1c2914181f85d532ea2c249c96defe318cef6a3baf7a091dc4fdde80ccc597d9e30493cf41b059f2ebc047ed664cb55505a68bb1aea636af89a55e7b79a47a769d1f58b77ad2a90b16449ad3b367fdf84f7cbd5f17a675c8f80d6cf33d0c374ed38cc2baa328f392e058402e79ebc3d26ac3398d366756d691c613aa640bb77c7055040372d1231f87fa23e7d9e259cfd4752d8fd7b82ff6c7196de05ecb9da49cba60750dfc4429741af32f0db2cc305dd1d1f187f4a7165b876fd00b4f55d65deee07cb86667c01665221495735cad8190c5273c10ce6c7e48fbe7615685437bb85a5bcf5ffd58c7348bb4845be5bb000f251f81b90890d486ec11033cd8a2ae3cd46bd9f7228d01992b2ee73ef7a5260eb4166666342dae2471efe1ad189b6d16f110fdf000906f82378a917b6da2e6da5227f45228ff80a4c8a904125228889d8f7d5f74ca04990e1d1440aee9c8be39a0a49b5be74f455211fcd840b3d20b8f388ccbc2e616e4525597aadf3f9d789d3e5d75a5f9fd69c85b30c36f6da16ab135f4e7e3c21b07b2e72504b2c12b15279259ac12272480b1c63502db1288338ed18d1ac282af3dc2936b63deef9389be0d74a3d2b992623c5e0f6f0a1ed0ff17dad8ccf58b145655d53995767548382f3c31ef754d28e076b9af60158c671df59b3e7904250ee6c3e746de21a9031bc1872b6d1b2d449500acefa040aa2b8b22307de17d0f04df6fe86f18b1f51dc197bd78f191fc374e664e9dfb9a89a1630a867eba690e1be116f84b9a4d8ecfb18b7c756ccfcd085c99334c21ac18e5c592197569a65c4b450dd2a142571c2f411d03c4162c61f9758846d1f2260f63919447200094616c501a9e30caa6fd2ff17f61edd3715f87022361dcb3d6d41e6adbd0bdcceea56672bf8b297eff26371f9c6644422f99576dae79fdf2391d9fc4a847a631e1cd5e26ba1366697738f945e0c7f51f6298347b26bdb1604502204375514115951efe905c2ceba681ce034ccc11e37bfd10eeeaed6bb281bc1c7f0e4a279563d0427caab5e5f79143480645a79fc0a23c68fc9abf65c1465a64ac5f5d563d71be4e0ac7547a062a67cce31a467591be99aa1a67f3f8fac839c7af6231a98103342f7f4d64641778bdadaa25cdf18f38be643f3d25e4aedebd8868d1ecec1a00a8b530e8f08a822260df7a73ba180fc9fe5e20f4d546fd9b312a54772c1db00ccf7a364607393ae502dd0b64e4efc1bf91a2f8289aadeb5d43cd18ce9c1d74413742ce380d9f608a8db3d01b222c5eaac31ceaa9ac88909e347a55253e9c49026e685b492935f1a8d9593e7edc79c5bc92e5ee3829bb2a032ab7a29178df34d47df03baccd5f574980ed029b3705420849c75e5f5a67ac81248376460a9c53d811e0e4fb6af454fb6a16a7af2a821b0b470f6c56cb943dcfcb97ee18caadaed65d0f534e897f71d799353d47992910412cfdd3ee043fee973f0fd1f0696213c3388b36fb4edb856ed5e9db718553ee12f9be9d198d7365f9ddf0ebf7cb4b4b50d98a1490b0ef10825c49da691bf826ccdc3c17f8e6e25b9e0bafe712ad5e7e4cb345f2241d58cde9f09c8e096fcca6bbee190df3530084cec72d4326177154a89615b42f11cc424f624a0ddc770ff7e4c7becbeb34147aac76eaed60e73e10c0216196e08e606832a070725a94596cef559435843fe3ce8bce8d222350f6ab9a256605ff0b9f53111d071e8a9a60853782ad64be32902ae29186b4e8cba40523bf8c85212556e302524a5e00b38528b1ab11dbedb826308e283103e5b261b04977859cd914ec4ab0df33ef0aa5a8a7ca316b79aef3a71b9d9e5c785e624c7c38e10a0953cb0816ea2fc370620857f596c3ed636d455d9b38ce8bc4fb550ebbf5d52a45506534c90033af9af90623091de52742b6a8347f122818370a86da74e2f5b22170f3395380f30c53680a86faa15b9fbadc84aa9278ef02121334692e4e58a2617372562c3e089a2782e354e5e9ce4dc1c5144359cfdc4ef8fb98e903c32dd9104c6ba3f0487062402fef0143a848f8c133ab68698ce751e9720d3e1d35dffac47a729b146e2b01a77a767799c4b097046f82a26ecf54b68cef2058d395f4617423c05f60c5b8b7ff18095a5fe9809b2494a93acb0ad381ff9fe79ce6123caa1c7d9529a55d4b25d522af88eb86f753004c634bc4ce86cf82becf545df6cfd1f7e93ccf108f282e46dba9d8355905364e270862b8c316a18706680a9c3490c0e494a776f31caea746695c9ab6e446396fa4cc4450d1d0baad39da20eec5f65b3e02ecdfb9fd3ea6fa78e94754d8573b60d03ef47093fa2a411461f5e341a956e93ffeb9c582ecaaff8d86cf0799ea67b02fb7470bef46aadd4124475778edc1140c6a182a97769b226f64f9f0719a5c4e6ca1a7c6c38d11720e33852887383b8eab25ee6cde6174c3806ff87dddb37a34df34baca5334ab605db6e6cec3b6e34c159187c070a9b135065a4a9e84123556ee2d3ce3a1c111cd5c972dabad2999d0f206c8863486ddb5d857054097608d3e272c92845ee28c2f785d06d9e283b269a8829817c012dc8127e92ecc45fd7d1ff75777cbb85fe9d15d6039d335406d5a224815184568eb33506252e06b3ff6a6fd826d864d75f8e899567270acc6dba16c81f3aa8940aac20c4a1b5ecac374180968bf13250fee184f6b4813f720153e7262007329bf1871237e5a4b430ebd75612ed6f45a0272e44836eec38618b8d5369e8e7b4af44891ef0f7a0ebe100eda6baa378d6e807348958dc76f5ed52a3d757194419806c5f2de7c195104f901461ad769b71f22c1bbe6455d609dd295a74db39beb30147ccc9e6edd8e3520b71b91ec6b3e458d38530b639f2f9aea90d1ef14d6c270e4736c5a9da50f22d1992c5fd9cd8512dd5f61cfacb1d95603a3ea72e8d8502b3c1af295e55de4315819ac394aacf0abbeb02402aad8efe8c5965473f70679fa4e1461d4b6db49d567207cb9a554c16c63efafcb4979f8c5c3bbb911858d47a763d73ea195a8368637025bca75baa5c179914b9f4d51d77dee8a771e4689d7eb60f559e4fe716a7d693f5a72d6f9477e35a3c437c1a68859db5fd628facce74f973673b578be748b4d8f86aa7e04b84419f18abd4c76d02e169d1d7516b85dfc49a390d86ed893519f579f41ef0a6a13040f9e0334993bc86883b4b4e9545fdee6a3ad1f271877f97c2b64f34c7326f894cb79f081862c83ec34be9b0d3264c9f49870b1bde5c40ddbb9a23af39e61f7df4c1329fcb779b8d4dad9c803822630635790e03579511ee0963b11cc33534d0d36b6aef13a1a6a1f227728705c790cc1ee259b8f9ef5465bba4ad4c726d335cd27cee8f691c9072c448c5bf56a42792c59e7f513458d2e56ecadcd17d63ed9ee18a0b08d1dc66dd4e985bd2b2b4835dff25d38b8fcbfa304b6c5b51181c6785be991105a40824a243e6c57745352578b1bf79d557e8b5cfce7c1d8a99989c41698391e08d3347f3fdb46d4e18f2431127e130f2831d530a0ab2816ecdfa189b3cde45bdb9b5d36053575cc6b7aae47b9b15ef5faad829c1420e9cc6eeee4eaa80b21e6baf7203b012d7c4037b626bdd8d344dfa895ada2ac2c73d68b5839e669051d5a698d5e513ab0bb9040e7bb993071bf3b9246e287585eb111af870bc4e0a7c5b81f37ecacff0dad1b952e2240f63e8322094b6cce18c1381ab8d440aa6695b372c946ba36c6bb3190ad60578400f24670a490fc4cdf79de0d50f360c7e887fa70b19cef7ea9ff366c409b1b067a743cb95fdba32eb3eb50d2567b204998363a46c974faed88814dbfa3ac03ba071d3c9472c1a8dd6dcadddcb11131da67d081d4e916e6a5c3c1c3808f2dc954e4b78fc5d4533724b663930ba1a653aad7800e4c05c09e81c73b5cde28e7e0a0e3fe5e39d9939349419fb1084f1232de75b5b972e4a56b23580abbb6746cdb301ce2e7882f36b6ede662403a746dbf66155f2382e741e32271e10155f69b4b256008ca7818bbaa492d9e5e7ae2ad9b2aa74afb74578ecad2015bc5b2ad9a97cabaa2159a0123d159273bd74ddfaa46f2e97e20cddb6d31f09772a8caf20ec4b94d8f09b2cc8d7f0a58fa4923086dec7b716b94753c552a49ece5e6082cdc0b2a3ae87a5233ce2047ccb6d97f62654a9d4db611b5266fec134dd3ae0a76e30ac719d5740cea933469996e886806bbf6439dbe05234520a57b8dbf06aecae4dfebcdc9e8baaeff438f489940dad2cbb7995a9e3579ff82a939e3e1d17fc223794a4abbdc90cdc846ef149784f4d67316c994b28497dbc190a02e555ddb6cc9445983e68c04532223522087025922a1cb3dd8c7694fedb2e258cbaea62141709d72be57cdda64e29fb43516dd80a2407581312cc0491abc84cbd6daf5cc1644161b949eeb35a6d9c8e3d0b1e4cb8e86edd02661938ed1b50760a888bf2ed25993ca59b939851aba0650705e21cdf6c46bb8ab425e35b66ffb98312673af7f6b1aa1e0a9329590b1dca3881f79972b28ec68fae3350472aef33e826b59a6c721258ce0862ea08cd27005f42ebbe9a063ba22c5f04cc2636b202049a9433d48817dfe5e2c1d83e0cf16968223ab2bf98a6a9cc67d403d8e74e4c85169dcb5fa2528f41b8dd6b322a2735560188001fa43ee930c2ce7902668d2cc4c6a2fa3734b0b6dcc565e47764dc20822cc02826894ea94886c1c498bd0c9217d474b28d44f583af4bce61a1250821a6541c3eba1031607d42308bb169c29ab57d949d441e2c8b32d694ed6356ddaf2439b9794cf6e518f6414e9c764526480a1609eb9c66933404489cea5adfcd7af094c890951ecc580e577cba15940c726681e2b3f517b9061918f504377bf88797d965e2e1932838d2c82425c92c115f0bbeeed72c7668ffe85b63c44c1bd0bfba4bc914c5ebe90f20da702a6c12d77cbb53e0a909e553c70a178349ca687eeee8f4e3db519d0be14f9a1561c31de00601891d15f708e6aa2d478445b85ad2246861c994671565eedcb7c60e9ccc6ee8a615f11bddf9b8ec0ea8e24fa4313bb6d9a6d759acf66a40e4e04bf3cee1298bfaea6b0882ab1f050aa041e8911c6c4967f98097f3f75352b3a99fd805a2db8d025559fdc42047b97862bb72a617993fe48cd200fff7f265498a223f2727cb0128f6409e7c6f15d6888101e415f859c5bb9058898565131c61cd23430ce5569ee202d97fbf2efcecf5422934fadbf9d1693ccc62acefc536d2864400b840658560b5e7ed360fd1ffde540f94113306e91551d3176b68e6ce24c24ce4bcbedf402c1fe38d08f508a4a064658a788062f2cf07ce6716ee6bbe411e41df5694682c76fe108d36e90630d7fd56e0c6f843d5e55b40674977a0a44b749be640220926470751bfef30a3f4a354806abfb62954b0f2c5c98fea6e296d62745e73d34a2d416ac8c9703ee38852ebe22a4ec475ecef925a29e99f6aebb0ea23be97c65ad3b5b564d035870428bfaae81e4b780d316317175e146a7e294ec5ca9803b3f36d1f88290aba84f34f0030077d9748521ac0bab0abf0a499d2bf5ea06d0f7aebcf79be86a19baa5309e2cc141cfc761b6aa38ed20627ffc7f7446800ef2a9b5d545845a06aa0dac0c17dead5dd995f42060b5bff8b87d2a91921f968dfd20db2dae89c91223736662cbafed4917b006499309af8c4176168c63b8fd6caa8278f2e68e3d97cfeac7f50425fa33bb4d850ef74c11867428e4ec6b3f7303183dd8161bbc54a55b7bd6e02e1c4fcad7dd4b6afd02e3bc1dd31a2c22a36ff979222bd7ac79ff96be1a86f81f06844f207d7175bc1d93972c8aa5949b243a65ac3416c483588f5b665318805eef62eb5d9505307e4b7c2e1fa8d7f18b9bfdc8319410150587cf26df3c2e4cf3cfe9ca9fc8b63e3ed44e296b84d16a0480815caac518da1d2ff45ad72032fa77828ffe5e288ac43c4be4105d0df24da5ad2d222e35b6453a1249f71927a7e6f920ef23a376162c5ba5f8f65b5b3141b73ae3110364e9ceffbd5f3cc37b938315a81ac164aa7f0003c57a30cfc27a1c1f64bedc013e51bb2fd4a8ff173b0c651317d6b7914a4ab02648d14c8fde8644207552804fb4228f67ca9fe076f53eeaa8c329e2596b5b2cd0708b10c69ead56470cb1a7a69da451cbfc77b00e51ae6bddf7aefe12804b30aac761b6762afafcdd1d0d30d9d438fb6d2c34ca15641d40b68a8d75bb00fe562a692af0be6d43c29c43730df4130a62083ae5a58433c2ee09a48908ac3b05a295df32447c31f09422671a7e104c0647d48a40827fb6cd2b4ccff954cca2b6143579ef8cc673ed7927384e7049524ff051df03c828decf899fcf5152f9b64bb2cb9c155cf690b0212066575d0289bb298c98bdc83366005ceba0850b905a898e59353e355e0a5029658714fa71d02808c14518b1faf1c20352824428441969f85366662a41bdc4f64dadec98eff50cac366531193aa00ba751116b4f9a06afd9fbc7658b1022e64616ecf829592d66331ccc20f07eede5ff79b0bf71e0f8f89dc37492ecf3de2e212a0e388c17a868ff19c67ccd59e2f9eafe4f9454ccadacd5926361a00d965aa8cce50a2de26c4f171d3029eb153129cd4c7ba7d09608a012587efe00c3f6ee85200f0325bcf1dc74ce6ab3d7585ad65d001c097810904bca17c8a666e281b898d0cd600ec143f655de4185fa8a09d8a41794d3d2bc5fc2f9e2bc66db85d5057dd8c7ce20d4bd75d648f841daff1ef24a76a987790cb399d7079b91d92084332db48bd23022bfc8d4b477980b99284d1a0aeec36f51111a013e6ae5cbd8d3dfda1418a54ec213cff67b7251dbf9ec7ca32c3f1b0eab239d28b7e1e5b1d645426abced2b9c3a22eccb38c27e53991784ca888f4a885f55d48ece00da9fe640ed1a46ad93970dec8befb8655e28b5380b5627b0221be23deb30b8cdc09f3d380bd9f4735cec63d52eb33f3536cca28df0d4ac9c6ca16702f1b485b9efc68f532274c74944a1fed80b3ba0ffcc3dd07ea7907dc6a8acf58e38331140864ba01241ceb5af0922e92ef75286b38fc4fc886043ab927968a661dedc519aa1fefe9a3bb05f1242e919039bec41030cbbd1fd6dd92cae3108a461b5040f201ad8a009384c5f64e15c1ab2d4ab015aed4dd9981d98c0b531dd9195fd67c7843bf30413c631bfb23ed9d40a98113e4aad7c3bd0c4146cb3444dfc5ee0f90afa0f1e28e40ac20f62bde253b64dc712e1957f0fa93c30f70d7e782a5b08db209c352ac15572da9294e876c27ea2cf84be155d29245be66501f249cc28f8efbcf18bcda2b03013e1d1bf530f7b59f276a0468246dd923faa441bede2c2903c1d359602cb8abef91a060b3403d06c8f7cc103f34cd1872c10d851e0c208a708261035aace2820ea507187bc35eb36e597e60d9ae768c2987206115585a23090ee947bb26310c6b96cdb748707b71c91871ac5f4da5457ae30281d8a65e25c6ee205c70010cca1b407ce327a25e9124f42947f2e0f3ef3de54f09e13f64c9de7beea1957fa0029650dc258b776db7a9db3c644dbb2ba0c9f1b0ea221cb324c5b4af2392ca953d9473cae998996976614b17058d5186e819f9f18f0b1fc5a1588d87de7d370cd1ef3afd0026fe0e4f0dda6c730c8f8dde13007a560c07d9d1a11e4a4e4aef7eef8f5b758589104e1a04818b9c45eff9b368ecd584948714c3b483d375acce074b9703d90d0a4795c4b98442183979c7591882806258e24937d775e3dee7e37d4b3398b625e8bc98a182a1a06975d6ffe0b1a6f5ef15861aa9841a110ef1b0e807b33c2cac6ee3404ec1018c467c6d777b3f0ddb8f0fa16ae4d14f01d275bf1f28b45e1d598af681feade8b9863fc9321890fb109084b6318d96a7338388820ea1d72723fcd62e6548c0bc126a23335774101c57ecb64f6e5907701d0f9364dea40feda333cca6782c3dfb93e7571f70ddc76a71c3f032dae76b6b26727da945f31adb829e92629db351ca60abe07ba26cdd0116adaed3d1eb627553240cbaca35e16df68d884658a9694d3d22dab34c8cf8b722c13a7ddf34d667712af625ed3c55fa55e6124175cd3259d58257fdeb52b8f77de0ae1587db176738bc1bb4fa8ea86188f763addf81186b7215ee2f85fae7930c5f45554e309268ae8d266c9ae2bc49a64cd4b7e731b722fcbcd1eea4ae549da2cd19f65d8682ac68e790c950806f41c9ee1f02b5d4bf050ff5c307ac3df0777e29a74c7127a558b3eb4145c63bdbc22df7cc9c6c8474cecbb106fb310ec963eda1f9335167852be0ef074088f0752ca43e7178ddf9c8f2901d9da26edf8db340c0e446d7fef7ab22cccfd148e5cdb5cece659db8cfd6fcc4185f0d9b183d5c303f4d072abb7008674b9326d372f80265ecb386d400110ed77c84d2e91881af8118af0e0c6bc8fe20ae1e84bd9c05ebda29322b2d25fc2bae36ca29790a76548514befd10bcf4cb31e8d0d3ac415e2f57461e59ce5893d4450719e979e2710dce9c7e95e52a88fb1782fc3e087d21857c1577521f1bcae8fc862340bdae1d10bc3c1946a60ce75596d926b226dc8bf577195fa51ff15e0c554573760808b04134eab1072309fe31cd055e447140080e8e710a97f4bede22e99ff672aa0331dda3e534d4c724d0aadc1de8b6794bfc7818346e32b960058b896aaa7b17f0b7c569f8b67f2a86b6d218ae19c8ae6c2b2d5698e06763ff702e16f3f5fe052e50f7c1d3f329f9a36eba164992d78e1bae48cefacbf1a0407ce85da950c0a7d404f19b32911b65afdd49203a25fa2840a9ca7ae51b4fea90af130a06e0b17912666d332ba463bc5f533f772d2b27071f798f52e5fdabdf9e55f884ab2c4c6a695398714020ce01a8371416fea0ece9224942fea281b2ef7a51f66e1d041d238c81722e91e8ba23239dce22ce04ac2b7288c6688a0a94a4ab082e62a7f36b4caa71c873fb041f91fff620dd9278417abd1fbd93859605fdecf27bde4a7932de6f524a0397e0501465943b85c24b1ac17c7976b10450298a2c1c42dbef8195ab2864cbb57991ff0111a9da102e81b24d7cbc9400aed9603ba4375e5a766f54355664eaf120e859e561bd34317c1cba65535f51e2c36cc2b1989c9dac5e47e2bf36e578a5252e10ab2dce2f7f331c919ca0402cdc485aa79c2ba1e57cda0c77a80da843a2bbf7e211350e82b9a4bc9b308484988bdd39a379fc102dc56fc0b4745e70fad46dfe4af9de24cb2f6aac0f604ab0fd561aedcf5dd247b539c0780a0c6aedffe484101d804dc88bedf1f18accc0ecefdc489e7b23f265cd9b9f3cc4fe906fbb5ebc6008b393da2ba5cc44b0983b27710e9936aed0de47d876cd34f366601a1487e330ffb75b8ef0781c87f62f1628694cb966f67e628f34784663f5d513a8a211360f46f3c6e0d7444cb0340b48fc0d9ff8ee7b7004c2a10c54707736287c4633b989935ea22f79e5b511d8498431c9db6e57464e5f70ebc2da46878187681bac0bede256ac81bbcdc684cceb2943664ae6986bd2170c60f0082f2412d6dbc5370725ece40debbc0cd417f056b0f43273daf71898348eee32827971da1008467f8889e171dce43e5c0f7489b5ce5e5137f89115b0ccf71131df17977041aac4927636be40a3f39694815ef014ee5926f0db19017f599f6d9d24a698220ab82f4d7cdfc767b076c643842b36d80bc04e18aba8ad768f07732b1c6b2735030533cc7dff392eb416c13bd9649941991dcb51232d6010707adb823372f8c7bac4a570b71f11b11c8046eb416d540c81bc45203950142ed4f6943653f85ebb79118a76c805ac6097d0601a13e3845805f430db5d240f0a31fe31881b4504c62f83afac1cbc2cac6c90ff57dc264ed66d05d73d3f02cdef461f9727474ecbd6ff7ecdcec78995a184c7be246ff104c0c0729e33b29e23ccd7639951c3257b1892e38b806175b87c3a5d0b36324ab1573ae9e1d4d6927f3f60e67bf387ce5985ff50dcfb8981a6e3b6790b689e90a94776007a86ffbb28800dee39641c817262228133dae81f9c2fb79f1a2c1220c7ffae19e17be834ab8b3c8232ace2c40e80e1b7c6f98c298c9244094457a34ffadf80d7fab38da1d607cb395a1ab99617a626dbe4f543528358cd74702af37fe9db4f4c69bd4d35f04ba81fd4e5a672d20763a32f39a72a3b5b03a4244a869da7327fb11c50288d515780a881aaf150814e0d12dd856744f082052ae8ff9904744e5b832508cc20384915d0f2e153ed0a49917b8e9733ee37885027db9116da16ef38f015aa2441d2fcd8ff37b40f5faa0c8650e8fdffbd4dd0a0597b36d7ce9070bb766163c205f46481db4233fd1abd530a176fdfdc74547971b720859e0e01904a069bd87f0fab33163e125b4c5b9de4245b112aa2825a261fb4b6944a4c75e06186ae864f3b69f6c7810bf5b5c01baf13d7798ca2604656a7c191369f58feed03adea38a6fec4cfa3712d5da9d10f844c1a03a40a4944b54a8a3a421a492cdd057f9d6905a11437b453e75dc50fb28839cae4c35d79895f0941f6d041eddb98476b3969cc4669db1ab80df2a4cb9d240ad2edfd8f0bc58eaa4d18669bfc8b8b3891ac07f096405357131a68517662a07f79f156043574653747e510591b804c1cd7f383d753e13fc02daa329e3c8f2331f445fdb915dc49db8ed0acabd680a75a90fc92da2267fa5f352c345dd131013d17a66a5c4dcf10cc3fb91b390893dd6c89acf7c90ef2f1da568915405af18f255404eba4c28a9f2aee6a48861b423591284ae299afab10a92a6d8f592fcfd96a662728a3027d9026f5c060dbbfc7cf3a7c257ad825397bd437e78581ccd364c3b82194158972e9c8e77cb79c11d2d2ee40327da089101f76c6c939b4253e016143b0bebe79c1542d5dc4c823cbabc477e58cb62a5cfca72b669cb18cab8819b6a9d131a764b6b0f30cf4fe53b71e5bc5e3ca470aa6d3823d858018806b18ca56d6005d112fce99b08fab9f53630da6a81cc76f9da15a67251dcc3d1c0401701ee2ba00457477f5450d624884fc5b2af13658f7b54da0df0664e705dd46ec017fd85e3455e2681fbd3fa1efd2fb3aeedae1eab4059f39b63f2038ade9b8bce56fcbe7054f07ebba0d2da55aa6119644088da907088bc29950ab8e7802424db7daf1bee6ea91af5efde8990ee20651c30ca8ba55e5c4157e6eb7cabbdda3ce25519675b1115941c60735b09fd597610339a6693bc662f253450f9268f43c5c427ca1366093b5456821969105d2076d88f66a3d615219ca4aee64ac58e461d92e436524e36f51e24224023a3811b72d50faa1efd06f6eb45d04d9d787d31a6f47a0ab649ef9d1d1199b224424d786bdef922e411222d1ca3c91fa77324c6ae7d2bf83b2cb9e33166b9e195506773179ea501fbf1ccd3df02db20d57d654a67a47393f4fc304bb1ed60da4af9a87a11eda0f0f27e493dada2988fdd87ff2188c102aabd0b464aecc7b1732747476c90a5977b793e0d9038b96cb3b4c2f1214deab85ff2f618cb729ce6e5c67bda7ef4ea676a429bee0a539d7c31501174130ddf521e9427cf8464ed7096619691a93bdc12b2fbb46dac9641c530958515cf1c20356beb44ed7dad67a5aab13d215012104d491df9bbe65c8a013529d40ea2158a7c27ddfa44d7a3784f4676ba399e60e61f4a5c51a678d38e079c350b2bb9f334dcfb74b9505c6655d2611dcaef0c24ab2c9ccd408d5b6e1ce0ff6c7755c9ac038a0b572d6f9f50633de9dc1a66ee9a951c8267a061a6004562bd5496984afc526b7e22e19cfc758d1d844ddcf5f62398605fe18d52fb6ac9cf928a48918372c1b76b8b68a8520abb2f996165d58a1c32cca2660f673b29859c2c6a5a89c64ed127eabeda78b700570112b7ce1d9bf441e77c2358e29f8b4f313ee9fcf9f9bad9ad5a875bbb419f0f2fc00c9768e2534c403dc928e5d3c6f033ec34707eab4e667d695a185a848741c97c2045e648a357cb466b4dbb87df9e7c8def64e6f84fd025b89e9d9b41d562e73115a97f31da07ea35e5ad6a5cfa708b1e6abe39468664be18f7594e91c47a6ca45cdfdd5b05cc1f89f2d513a87352b73cf269c3e1324661d54a287a0920bbe6d83b2b57784569263a36c9037e8cc0844a9103ceab4a25e4dbd578a1e9ef3f1d869c966efe490102438c78d14af192138b1b726e1909e5e3251bb1bdc7e4553292bd3a5813f90588d131c25419fff5651af5b671d4fc15f6fb4512d6479580913b8b82bb63be6741cafb1a5adf8d3b3818505b7bd0b09227679432108780d44e7929592a96bc3287bb7dfff0a88ffdd126c00042513ae8f401f24cdb244341d575a458134921e7861001ddd3bf002830e3cb32d6f7a95451db2327f2fe3ecfc7294854ae69b50799d3a1e9023a2eb63e7d170b7ed266d93b82f9999f1972df9426717754af0b8598506ab497d830efaf36be2030436615c98915b2310bebd2b6f2469fa8476a17b2af5df3afffc760828afb383ed29dce88aad3df3e3111c88093ccdec134c8ba6334ac6f5721f71a78e6b0de74000b6a21d158e9f1a05c78eda4fbe6edb80b8f5fa28e4af7d404f7f7f565791bb0d972b3a4ba8741c3488b789187860b886566b4167cd9716867aaaf94fdb95fe996a4412db9c6dc0bfc95cbbb8a1924b19c21c784f8cfe7dd60c24e48a2fd51e30cadd5e7398370ef6e9e744d0a870e613a8ae9814d917cff64a9409abe59b4666e28f321666c0a1b55230c96927aff6ef37d3693e8b69825ed735e65314166b1bb2dc6dfbc01e64f7352f7e7f0fc0f8aaa2083c412c73dbd863531399f38526e572104ccd19adfd2d847f6500d6673bee3b80fb8f1bb56461c437349f22d7489086bb24b17c4feb0de1f6dac0dddce12c170a17fb8bc1477458df9e745f96d2ebabcc2d15b5d5bf519c3e9577668cf40f403504f1aab2235c2f733cec1f84a4f7f28a5b38d6cf7da3495b44c6f18d62ba005994680c6ef78b8d20fb2196c7e2a6d3405ba36e12800942c58b33c0832b1c025c654ff9e779723e1450949f3ffab5b864ebd421c613ab517445ee061ae939096ff9d1693b6746756ddf5f8ea02e0c776ddd1445cc70a03eab0724389c396452fe2dd7466cb3fa42fc3c5d78d9b7e91d83017702d0f73b53626bbcd082bd08247090c3986f5a95354b5a0fd455e805af14f970b479a78d7d80e087e0a040885b852614cad3fb497deada72bf11c3b029180b0a37291786d3ff2b71abde63f018d29c396a0a8532c4e13ff4b2c82c47e30785d68625e961e444bccf9bf0e676b49a2dac1a08486a1f56c6ad0454dd0e4ba8a49c518a8fde41a64f1576f10231e8303ea804b266bcb11e9db3e6a598984f96313f70e9c73369ce77f5d7efeadbdb89abc34e3478261bf7ff26032040e044eccd52b728611078d7f17cf1938d6a2271ecc18d8ab33ca14331a9245c41321ab804e2702e99607d634a28196a05f21e62b66d8c30a60b7f8f0780bce68f05048de973ffe39125de3d88234d11efa9fdc0b50610ba7156d142cb9f60b4bcdfbb6e8a6710a8d47f29d303de5f95702ddea347ff002ce90e8f5309582dd34e70f792319477d4f26055ef4559bf961355172e4b4b0a6c252a824909249f1fc34dfbe407942a5c52ef2e9757413bbcb945a6feddd33c7c3004217a7fd2b58374191afdb44b03a20ab64465f2709d4221e25a92cd82fa91d88967e62bb6ef0b41e944efdfe4f177218416904efb99db30636c2a9d31ee51270acc46a6a0abb39c57dc898bafc578525dd3cd85c94f39d829540589cf44434673e9da2813b2cc0afce46d8193f82cb734c96e31a96f0be0fc8de35e15752b81b27cff0a4facbc6e520db95dc8b69fd7a36f2d464ca1dd195605903135537a90991f23fd267497a23a05824bf989d270d568ab55c392dc3e5cc11470019c3f9c9098823406cd40b39808bc5c5ad07345c24c0c428c297c1440d4c598564cd58828ff378046fdb6706462aef4011f6cf8021da0603d9836e54613dd5997ba3b4223beb1384f5be5892a3ff5819910654a0754ff8b45e01fb1b674df74ef83fd09718e69206e8a8397b5e3d84c3ee49b40542defa20c5dbc2b0e2ccc50d2651b32b10c521778189458e375c4c1bb9e880fb1edc93e4c040667a23cdeab9f2f53eeb9a3cd6ccfdc164495c6c61dd43026cb99daf9f1d92e54bc85b858477e053930a3b46383f784c1c88ca8eb6b45e5547be7708d201727878984aa0df84ff799bec80986e7fef46dd9f3834db3539d5d91c969fe060be521a4bef93556653d73bdfc17f495db7d8784d04c2974d546df4d78d9340b9910d475e62d7bfb9a3b1c251ec84434183853fa706f6aab14c9be962e72a5a2e87b068a05a8b69ee42e28b3b1cdb0284c129474ddb6ec672c31e54a947d9b2ea36bc12f19980db13f2ab72c7f4e4ef2232b7b95cd9dcea6b0a5ec74797b392f959bae01306ab8f5475cb738c666bb19ca54158015bd3839c61fd73508ff63b3686520422e42366a28c59c88569d39271b399f9d291c40f2d0633d8d3b9ca3ae7887db9c91649455f40111616c935115252024d093358222de228d83834e0adc9e321394d3ec432bd43c24a90dcaa28b08df5b475b4ec91a01b0edfee46eeca8ed02e88e1c5a283e10e65c5362bcbcd100a4601e68a7f2f37ff38eb41d6d06d2222e4e1a5c98d5fb8f1112ba9c7d7610950d695908c7e3e66561fead4b4e3975a4bf9d56ea08812365e5e8368859b021674e55fd75e096d0c952b2ddc2822a826ec2a24157b6a488fc76a46e1cbbf14d7054add7da762f4700cd4519b86318abb550e0b1c75695a7ca7b22e28f959bf425a2517e318f0dd40a7b6b0c36c87c0134e61ec2ed84819cbafafb42b91432521b03edb8575d51d38571ef8e1245fa95e290b4323a9698c7e31b3d711061390cc063eef2e996ee0afc08f4463f118defc6cfe376c4fa4dd76b1848ba63f0263eb0cd7e81829796a4dc9a31d1e17721758e58006f25deaf4dcd09345c9c55ac66d6ac3813e4629d3cc8b5b365d3d40dcf478b5d5d6ece792fd02822aae5c1f7f27cf8162c7caa7c0c944cde1d3442fc368c7b051f59aaa97bafdb4070bf33ffceeb45e2f550078d2b3fa1db6b924c4139490c0c6960293289b4031bb20eee63944a8d484eb79dc56d8f2025a053944bdd8b016d4b480dc1bd2987a9125b6bb88d58b783370a4b1da46728b4595ee4df4826056f2883aa3c8d6f33c2d6430d4061a2fe82508b32b6406dec3ac7b89f9790d56c3886041d45a4458f56ed43bd8c7314c8087c482a3e4eb9bc1b358e3aa27aa3682cc2579a77c0d9bac2485c116eb8e2019c468bf2dafdd397a82b7aa91b0dc8202569c242dcf99f997531e4b6dcf84a4bd69776800624375ab8f975c5b5c1b34473efae7eaaf3d56d1f9eab8a243561f8a66895da2f29d1a7d4b11a81baab6d5b4936a3345bfc8d3efdcca9bbe3b92f88b1951606438580942085377f4ffa8487da398e8d1a6850e7da608b86be2e9bb255b11f6caadafbde720590d7d2795ea4b1f7ec33dd95d812d3d7287c97929849c07955a9d30a88a6609f710d23f7619c714aa980959bf6265c68cbb7e5bef1c206c8316fb8f8d27592575b50d8cc43a229c2ce2042f9ecaba5c5987b2f666b1c900f9015349c5ab435ca464eaa2764cb093aa0437ef3df00f2eab88514a4cc8c96e0ac74b80feb75397b416945b87660d7714e6326c3b8625ea778dc673f41c986fe5ca7106a8a326002de9a6fe986674eb60f7cd50a7e6b2d4c23e4a3dd591297c3ddfe0933a05d433a6034a166cc0b12ac56f133767604dc7f5da0a4a1ab0804bc673ca679751f38fe1c9c0c800b363d57c07f591cb9a0ed5c59110292b0451c38489856354c2b482fc33c6f0a84e06a7b620293bb31edfdefea057e96e23a2f4777e749cc6766c5925455079b952774050a22831c9be819098ba79e79e751378e76c11e654cfa78203e8bcef86c7e225208c7a46033fd045ef286241b3341400fa13edb7f782d65aff28b40aeff2c1a2cfe00e49cf56cd02db3b44e65e7c6e77f39e011f8eee3acd07392762b7472ac29e59971d3225cec78c9d2df9a6e015a0415627b48d62dac5538c91c275cff78ac0f460bde2bf0690908c88b44f52398df0f04f27e1aaf9532a22bbbe073ff17278f774a234b8a2c7ca23b73475a924dcf47d16805d2fc0b144074e1cea4cddf6d9936f9ce5460157ce4e85438665575981ee0124ce4a6d964e72d273cec70dad5a1c7d27302f495a40af5d2235d017b704c57f4f46eebb90c0fb5b84636f76aa92cfb0046fd218039988cc1bb3d5eaddc07b5d8ca00a1ea29dfe88e8ee9a5e79648a8c1766652a1749a222a3de79458344d070aefb8bf03eea3166705ee07aef6b7671c0905d81c1d6659a83f23b5f70164a72151cea138b3ac89ecb20a5be9d7742c79894cfcd7ffb6e405c01734e7b02531c71ae2a6102f604b9c3b68237c32cfc81a3df12e6776facb71d1045a1dbb40b71f30ea3ef6386c51d83084492f5dba7acaffa4d9b8501675130a3e1c77763ec69211e4e495a11dc66d03435b346b0d8faa194a4120552350ea74ebdf37dedc0c15907167d2d242e232851be7b60067f58114b6e82dfb522d915d88791a63f0976b4edd1cea0d8344baf14e8b4a7d781be51c3f13c434de85ff71eb2fb25616a37917815441b917386cd7a398e74b499b4930cfc094a5fa27b699307626a3b88c785f9efce9f0e940fe9a6a6d4801c3cd1fc63ce9a52fe00ec381d5892b20186baf7ac87ec7d05e943308e003ace447ea99fa5ccfb6d4886265e4e7cacbc84c2d1ddfaca840968101e65273f0c9460fcef9a9f822d340b0ff4f6bc439d876b871f64171e2933d62889038213b8832ffcf1f6a0a150953c7117456081d06b374e47971d5203934d82c013852a4e190522cb674ff8e8128b3f6497fe75b7d57a03e6bd0a14e586143cbb23752aa01a9bccd4f6688a4085e4ddc357aa393c7de0f7fe53fc9e0d1bbef6fb39c7b0d7557c35c348c25738bc89033e99256f4c87b0366b378883b13471b2c7edc1cdae7bdc1240ec5b3e8438e05a928a46a6599b5c2565b7dd0f49a923e25965c7015562c362cb53e2a2fa0910713235527e2830e1cd32a47a93c1f5b84c25ebf9755a9de8002164a6ad3b8defdbbe33d67b38209ce0605702e03a790b0bf926445aacbc9c86305db0911762c484801fe0e09cb324f6fb7d879f437272698311a4ff1c9d5fe2e5e62d9a98bc443cc7fc190855eacac54d6ad9135d8230673fd48df47ae903b59cbefa3f9c4a217e88fb5d9fa9519a415b373d59067b286dc8e330630375b0d2f4751c4869bb4e0a182b607ccd6f7ebccebeb64a5de1cab1788ef8bd4edb8a83c66db0086b50676979fdde1f561da7a7458ae130ded99c4bbf0e7eaa3c457e7407b67ee5d45a2d7684970b610678ddf9cae5cc52cc4549a6437adaec548633e0fdceecbe7cd20b74de1ddbe0ba9f9df1699b90fb23328769035a84f0c2e2570c3d4508f9b86d621d836290d650b5d052f64504c6f39d2e7512298809195c43da3ca22de3ce61423aed25fa9987fd3f94f1259e02587b1a840e42089a286bdfee6598840d9ce6de789531cdd1e077cdf5844dddae1fc22e9766dde302f35a3477dd395862c4dce2062ca53d93f39e7995943ac151f0253dd86aea1c61645b7c0c164f64a1716518f6be14b318918d53309a8804059a88e63a6cd4737c1a1264e8434b3906855c41b2c4bad9970e9e72cfc5e20767aec6edae6199ab34bbe19f1b68e5dc97e67acb5bdd792c590e379f8a6fd3c3244f579a943d51d0</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>技术/博客</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo主题美化</title>
    <url>/2018/02/10/hexo-theme-beautify/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">请输入密码以阅读这篇私密文章。</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="037804be98b95793d91f316a1a83dc39e97719fb76e7cd1465150770e0a3b6f9">04b96cf03f1b5d00286d72390b6bf2e0817acbfddb7147d2fcc01912c7f5c0f9713c9c317ba53b9347fde83c930f8c77af411014f8ec84eef7465f6027f6e563b20763efbf9fac1db105face649d36b82b8e5a28894e0322accb07eba0f38491487fddc38b18732e21e4d5a09a208486db90f1b471e152ae582639c98996b3d9545b516ad74403d379a378e897878b9754f5f3c9a9c1cbf034ea3b155b6217c7c2a8ce65fc5458e94d70325ea68e520fea1f3d22f56b6349aee20af7ed199e2c05d5058ef826f483bf40a5fd1d5f80690d788883293d70813fa6a6fdec2877c1b8eaeaa88908d0316654e37a6abd33ddc7ff852720c5c38ac3c9be4b9abf4de15de8159d689448d06f2c8d82adb5d4add2950ccbf4fd305bd611f5a485d2d042e908bc52396715a591e5f311b1e60e5e99358af2ab9c933f45c09d42e9556a48b8009f3a5bd02cfa54f0f990cff4ec5287d60d6479afab40ffc1d4266f0c238b9afbbd9be752ece23b7795da38d2abf6c460e99746186de68f72dfe5957cc579d5ffec3564560bfa91418db4f56c7ceb272663bd480aed47f9b747d9a856b43b2e928a4dc98b5737736ab4ebf4833e3dad91e45ab791d3740f27cf23c3b92b8494bea8030819979e9d4a511887dee2acab590f1cdae980c65f4a993666545bee1e455e15b6c37dbbbe08f3b96862b024a69356c18c3cdcdb2808d9c10b728460f4ecf2599c002db2c18754d9d354c4fe939f685df75c8fcc60a10361b3dc091a3e908848c1e54d3ebb293fcd697ba82cd84025509d0baa65692a39165ab8e019a3ec9208836740e241a3c99529845203237d382338588aa1fa56eda70692065570731d18819ee116ded3f7bad1a88a7c4dece3a35a7e8ccd343e0016633f15d3f7fd7b4ae87bd9a5e0ba3b57454e47a0d5ca685a2b0722f15cfd020bb8e244ca4bee3ff4fadf8a414d50e0bb4545fb6117704d0ab4b13187c5b95fa162ad92790bf6883c23801c420dd99d6310a09e0cc98e2d85eb2e6424dd36ad10d65a14ce99b4fd9a5340083131869dbf8d859468a98327b6144785c6c62d60fdfb53f65e705702bc26b94d75fb96e5fcde714cdc981ae7a012873d3e76f4bfd0a0ff1495b4e5b5252105e44a55996d71c074110a937cb0bad75e5d18690ee25f89abeff57872d154d8eacabf410c1c47913f69d1d107c0db3caae0a43bf479b8e628760ed989337cb6a78cfd1f528f48abac50615a7328ab8722fa841168de1134c9b71024c68cf6b03bb66feda94fad6bcc4bd29f903f6368432f6952b6c8b813a89a80111a825ddfc8acd588d56a3e6e302acf898fa601a3169bdf3f84ba0ef80b2b152bcf4b0232c51e63ac99bb7ce3c834e90fd9d7a195ec1c65a7d36703d7d9d92c40929a11480bb60cc49eefff1c3cb53940e14d08f62ca1dc8bd00be6de202f0cd546800b391d602f7be988efa1b39a125c085ceba09b0627e56c11d5f492d66bce125ac2461ee38b9a7dbf363703f9fcf42cd4514da3d40548fb9080f3624520e841ae8455de6ac20a92458ec86b64ddf790275e8aee71d0a996861ff52761a4c020dedab55938e24a929790fcdbd24d7a49763ef7f32bc553b3e950a30383a3726ca447fa0f6b285390b3651503edbfa835ea34c7e1c926abbbe06969094368f5609f7bd235e39a614f654d2c13f4433c6a510523bbe322fa3fd0a63b31c004279ebbaa7b3cbcc68d894d18c175f9a732edcc03d6ce53197d16aef923c82a5a2f877e29f3ff186f7be44297890dc0cb6b7b8bf23e470904f181b3390d852ac4ffc41a6a4e2b3ed41c96784fe5fb7ec67e1ea7be9e4c6cb6adf8ea53f3c8ae51ab0ba9d88c0e9876647e9469ffa0bb3b9359933021d951a54351ac5b05b0c57f652009d6e71815b7a0652d24a3e3247288994077682de0c1eb285d76e54b82bf9f512da93c69fb221ceffac7f1cc014c7ee2541b3926f10363ff7eff0453925014ca628feec41490343f6aebf5c8e161003ed1bcebb33d1772f2979fd11aa2ee19c026ec244f4de9270289dad5138af25943aad62a5d565ed690d40fd0368a3e83e7c8464d4e5030b9263751daf3b9fa76fc3ad9cb8d183d111660d2b1c384c04b833245e6c49a8b42726705c1c7fa4f38806fc8bcb5702cd30159f26ac11f4205b60498c4e1f151dcf403cbcf9bdd218f4b90567b03b8899dce705db736c986d27a8075b074e268dde49a9cc6bbd8acde54c0df44b523f852b772add10645d4c765946712197ee383958ecfaa8a4a0f8a2639387f65730870e9fd01423718a11148186748726af27ba15eddd6213db767209adab258cd352c033d5eb9355668988a44120b515ac0c5f4bb5d78e702d4578aa5376871b2828217d98bf17ee5606f6ab1f79f9428ffc054f5901466e037063cb6001e4ea5ce62f3e6a89e3ab88fa06979c5a46b04bb5e6b9c4f9cfc6496ba61189b6d8bcc4b9950fe4fb416cc174078fdb94fb58ed8d6a8e8306d847f213ab71a587a46e56ffcc88caa21ae476e0e32f85fc183fe3dde632f379223e6eff7ee09cc7d714e7878a936ffe296707a3cdd52eb27564bf4167ea720e23d46a15f98d0768ca083489ce19023b6f7f6d67c3adf37a07479dc6eb8c7ed401067b2690a43a80046bc325865a57c13544a80fbedd4e9fdc89b6b52bde143ba3533eb887008aa94f4641827e9263c2b26e01ddbbe579ff3ea5413ac45397dfb14f70fe4207bffab800f0e7de1c7be898d6f3e6d07f45369c8924f1461c38b21814217c78defada8fc50a1135369c002f0072dfb00e9ff5593b771fd4f9c09a3cf4493fad1c7357f8a41ebb73bfface8581e0b052819cf1d252925ae70980354662b0fd4a13565667bcc675bbc9c4201848e7893fd060114a0e76b34246b4327816a621d31dcb788d1f71b1f63a464a6fe9baec9e0c495906e2d88acf48b13b2350ee404e6b3ca8a5c990d3b45ebf7c36cb499898080f69aeff147b9be4175750acbafd4ff360b7ec1d621e735f9bffdda1fcd489dcb5539e98c7a9ebcd74ba364fcb7083f7bf6348ca264697c8ad0702a00d7650599886c9d2126b011007d6cc157d1488f70245ef1295f8ca322c99e7a76eb66a4cdd44fdd7e776b9f645f3000c94ac5e6233389a9982efeb1ea9051d182b77fca2d8f30dda27d1453eea219be7443f7b71682387bf3322a207237fefbf90fe7541c36be3a4bf99bed6646bbc6140fe4ad92deae58ccbd27ca14747ff7c70564af42afc81543ef2f00b73658cad3d4968bf592959b1b4c620384b2ce1ae571c101f4abd48bd0fcb154e48765dd6f7ee38ae829aaa9cf6f904b1826bbcddb28c92aa4f3d4b0e24554ca2e955a2fc86db5e76c4790f23802c1dfe1851029968a52722e04227df3fe4736f8e487e5bf600a01f6878bdacf91b9a9b7a503d5775d0925b545e8d2b4864d0fd1258b71e83e28f40de9b11b2084b0224daed949c07dd61e449e29f933fc9dc3393a569aa1db20a107c93bff4e07e975cdf8e28d24f2c7f023b594c9f054610fc5d5ae91376dda3e4724d6b3d4a9ec88d0045dbcee3c77ea0200e7d7927692a4ae2a1fde6efabd7b4990332ea472d6d04676ebdb90fc8c9ee6ea2ca5c7f4b3591e270f540fcecd0b99be505dba8975ea6d083c25a9986d71ae7efff6c7f8d304ee5d05f45228a529dc98d523b834ae817bb57bdd2cc6cd2258d33f5d9495d49eeeb9bc6c44b9b289908fd506f61ea6e7250e4f4fc3f9150a1cd560489a284bc922260f45101fc3a725eccab91f120c50a1b65b985879365b8f11fd201d4e0b3392fca8abb3e88ac94e01962b958588c3ef7f259be8428817301b668c87e6832a35d98a11faca469aceef7cea44e438b9b32fc1d2d9d95d56d03dfb44e5ffdaa317610e83e25b856e13fc20c9da37300a4d2b277503b696df1b14d2cabee2c6e0e57b7dc10c8eaf17752c1cdc7782a605bb23f5840429bfa0b6ca804821fbb58397f91bd0b0544f45efd4c30117373ff2181cdff510326934c86bd55697d79ea70c46c3c73c1822e52a64b978425375077eaed777469467211c80152b0ca4902c1e61d11d995db374331433d2746e4f8d58b99b99895ae18ef6f80a9c08440436c9a0ebc0ab08716af09c964378c7ded3affcfb45bda7d720c86bec8c5154b9352036f1f65827fb1b5bf55eaef01bb86b91e819a90bd728e8777186e38c71496508ce16efa712ab6d931bc8bc7dd1d96dceb068774c2169ddba468e12eb72f9fa34df66904ab1271485c5bb60ba49a1b5829a23673d4228e79677d0c95ee8ba6d554fd620aa75dd15000c7b697b7e821e0abd2c4de26d12b5cb3c0adae33ad8a5d65b9d3b2ba4e202bfe6d86585d1f66d229caba958cba7c6d19613e745a728b0bbd82ea41015bf71587ccbe807313695a0f3376d437a6f6ba0f4d3d285f3f69aabfe8379f8a0811c89bb11ed9b979a90e43fb4b43dd6e95721ec408da29ee84effa3ef9ef1fc7b5ea8dd6fe2dfb4b73aa46aeae42175c5006706ca714b4280982748b7860e2ab6874c34e2f0e14d47b3907e4898ae9a1b543ecc008da8c666ac9f7ad8b651788af2a027b46f24fbc626b577ad6762b83685b835a0e2c41b123b98a8fd691c679db39a739d100f96409d46853e922f2373b213530eb54f1efbbd36fb96a390ad9534e8e0bda0b60b9a67e77ed452668f2f04367625ef66306092c094b1e05af24d57ab6a3ed7773c7dce3a54db3508256655f3b1394dc986f94a08901a8ee74ad45916e809efc994eb8fae97b89c58be7c16ed39c9d81562f7c86413527b0f7b71a1b94814948190a001be21bf96ef7645c2f385bd0a277617b6e9fb68d7f41094d06a789a592404d301d6931b3699ec8d9a33714ef4c741ee7c36a7f7c716c1723772bbd36ac1e160adb9dd5664d6c7c353c7cef5abd34e84997257e636b50ae24bd7e95229668b970c26b8aa4ce5a1e5152431724724cf13b7e603149470e4714c4625ed0f55921f1774808a676bf135069750958c1d46e363f947f08cefe389d3fc24ca0a2afb32e981a6dbe13ea463a0894f172f149e4c93aa9ca8a18f0e495ff4c16a9ee1a3b1ce967ce356096b4fa1f61d6e5ac7a705e37596441b7ed439d0c2675c83994ce4223f504ff9c4bfc9a0e6f9f4ed06e9241d034fedebb1ee44c5512e6e9e96eb12e45eb7aa6b97bf2cf4a3b2accfbb953a7b66c67cfbf99b1b6f234f351320614784c121840b66fd7638d6c0b8780a02811a933e283b68863e299b1a46f1d155f3a8be96a23db80231862e1444afd268d15da32b661279720af23e5679eec40ac8aa2362df254b6b84f523b65548a04a8d0ad947d6297ee2411b3c7797b0fd3eec102d42d7e836ff7738a67496ceeb7934f54ef56ee5dabc5d573f0ccde62696b8597431fd2cffdf2493d1d96cc975810f71c41013d8451bdeffd3d4fdb45de0de7f05c2802aba22482401fba81f43106feeb017ddc720ec17b88608d21907755dddac5720ceb809c6782221f336e686869c1bd4ae82a75f7829f766663a1d6436448c1e94dba9f78cc0dc9b2bf6526f245b3230e1a8f1312ebc98dd8a0f54bc674a1425c836ea4856a85d728844cc1ef96341569f5ee63815d34b992f35d6dd87187054677bcadc3a31506bd977600b07c40aeb8269c41a9a96bf703d2de3b6a6c0b8bd26aef76b51d3df3c8a2b3dfcde35f0e99087eb609acddd6b7029b27eb35eff68a3dbc54841e199b47ab0a4f3dc27eaea1a42c9669fad540550baff0884b95a727c88a3cb0add17db35e711d8ceb4e737c6857a5f2f3abcea1ca7a3bb7fc12ca5a9b8c28eb3371b8ccd2903d5fb641400a6c0d82fe3271c22176f1ab76334fec16057684d7f6fe4df0e325caa13d909f5ce50f51e0d1ba94f822e19252e696d007f43d6c34b81b4f48098af672e21381bf5ba61e8720608e6660fc24898422507ad430d758d521a402ae872e97dd53ea31ceb66111961cf56cbf6b0bd62952e5758e17819b16ffb3af82e607bc9a00bf76af4dadd5c795b62007fb4e8172d2510687306ae4a24837648f1ad3527a16cc331620a8a9da0c3b03c2273a709b34fc88632ad982480aa751a18de656999f1c8b5a3e85b9b3972ee395be1570667049b2481c105fd51a6a421f675435c7ccd1af1900fd35c2af317f0eb515d74d268ae4fd8e825ba976c088c24062b0017dfd03f5be10c8c1bf2aec9eef2f638f77011f0c512c5ffecab73a7d6982bd1f87ee8f14b672d0f9b0bfd311083efddc45a18ada46c5bda7a8c33bd0cd89321e89923bfe2ddbc421bf7b95213785e53f896587a050deca917946cc457287c08e7827c2797cbea2f51fe0a658e794739aa6c532825134d15cc119c320573d97968f64869763bfe5103a1ba3305000b74277c14fda8546fe51707d1d1ff417e6482dd3ecd2b2121346bdb190051ee5faedb9c868ae4ec6b990c6e759ab05070e6e66ff6d2ffd47070cb8a819d3700da5e2e27915f98099692649248636d14d17b297fa99a2a6dd4005e6a505e2c00972658c6f965f2638afcd1d03843b131f021b5606d1bdb776635ba772bafe1327fe93bddfd88a3932a86232c6d53e0f5be92e2cbcb3d1dfa020114db6c6ddd1de8b256c8b3f89f88e98ec0f863ec6e905765678f46276f66f3c5b7d56fe38004d37217cca96804a1e7453adcc79083acea897c1ed40c1021e3b4f1c2dd6d77901ed116752981eb4f7d3108ffd81bbb31212cc3d5ab4fe3aca27d61006d7859c101645595cc77cc1c0a10ed7d6c7960b2080821eddb5c52c4c8344028a10355aa448756eba1f062148d9971dfeca64f110c178fc35dec6afe05a8251066b8a8e86766bf4afb785e35ddfa1c63783cf20dc62703c435752c3001e580eed512a5285c6a12cd449d85d06794469878a75772dbb7569ca0ba1e590c573073a675162fbc0294f332f1a6b689b600524bac96eec7cdf47b1fc2e241800652ca5680f4f5b6bcc852b4a6f4eca00629d5d8c0a4bfd0fc4c5907613b2a288a2aa4c6d05a610a5555cfad6ae19da163437c9345c810e67add6fbf975b17417252c6c4426986d5b9bc6746a62158ddf09bfa5b507b87f3a61acde5cd01f3631809f7e280c60e0458b1b2d1793905b92d5dd7fd972c27bb7b04f2d54fad753b06e1ad27e6d50e1619a5692dde5d041a6ae4de482304177a986a8dfa38fdd75b2a21d2c4f4cd331acfa033fed40092e12e12fe7fe031d6b51a7ce0a82c0d2813b08d2be7b3173d5ca0d0479bfacf2ddad687ab3f79dfb93540472b0254beff92a71dd509d2088cc9c57089edbde81cc466ea969cb448ccd8a293ccb2bd8a23f859593a30e56fa2eb05cc092b0fb29e249b6a211a96ae61691440b0178ce11c61acfec8d005d8f7d899bf7912c029a0cf3cf11c55025315ae33d255c635312b46173a75ee9e430f51dc85454c6667a6286df5c9b6b087d22d93ada45f1508c72d73b2335be68ba376a2a54b78d7b235f9d92b7cb268f08781fb275d29cea7554bcd176c4d5d7f77843478a55cd630010290a41fcdd249c76e2f33cfbbcaf2eb963ac06827d2bdceb20b1aa1489a8ce25401452879b87d47bde624f0343c48ba921a65b008e942949e4956d58f996683a4f5486fe9c64405886b9573be090da672cf43f6b5d11d23500ca7249af28041bb757de2f712151ab3bd6b5b00e49a4d6d1112b6c90c2884df48a976f8d214fa5e72ccf75f18db6bdfa9012736d51619109c5b080d76d3ce669e872b3783bdb4459953a1083b3a989f3dd55df700efea38dc4bff6434309292f3d7e7a045b5dca8d23048e82d17dfb9b6c18b8faa7fdb168c385e3cbb27d8d84c3bfcb72f5254517bfb190fffd1cae8e77171fd1f0db31abe7ba70510094c828898896baa0a503dd4708679cc76b24ee133a7fd4c297717d9b4da8a0cdfd6df298e121da56be434b5b32e13d95117cf17e394758677881a51522b3d6a1f7d4a38aa71748fa5490fff7f9193c2741b4032d84a28c3db8854332255e342954f114fdbbf17d1eaa170e4e39973ac05006ae47c0a3dc1fcbebe94582f28b918b6e5a32f2f18265acb5d9880e8ded7ad317435e8532022c1ff5caa31b23ec234a193162f503dfb5b88d06f6365653f1a3b865d57540c2913625f4aafb8e00afd487c0fc2dc6d2c1be16a8ed096b294a544b2b1c05d1b35dd8dad219b14be12f3f1856bd490ccaf541144fa84768abefdb6dbf0739aa0e9433135cf9196c399425c08349e676bd0c6651a23d4bc80bd979b67e77ca9a31a14325389a8fad6b2d3769d4c3f32f1e9e6ba3da901d2accfebbc033b0053fb358d79d0d21cf58e1dfcb8354723a1e692acce5af5c49c982d629b402464501cb8cb19e53d048e43e27ddc4627666497cbc3a2a7f4f1f911dc63b6813451c97ac810fef9292c4d819874b26d54ae2bb9182dad4a97a8ff87a7aca7bb90c955bec0c4783f71bf91216ba5b971cdaa93e25360791592b23a90a9c8af339da52c60fb04f2945b81d23629a1f81825b2aac9f0d853175b6a563adb57b19aa7ba93bae5b5a2d600459fbfb1c1fd575345d4a9c44be32e593c726aa064618731b6021985fe447432d7e1ef1b0acda23ed49fdb5dcc8198c5ef454e63986ecb7f8f55575ff04036bd534e8e1aa115d9b4407422a5eec5d3d3b204e2de202b877194385188e3c2148377cac145a2dc8124e52f8b62d96936b2272e7e72bd225849e9b48df46d889b5a931a32d92b289c4ce5285df6abe204efe02403e6d412d4f660538cfc41f0d3b9fde705d1efe81b4319089fd2992b841162e98664877f8875970c37c38ea20bebc7a64ecfbd8ef5b226798650051fafae4c39f21eb8372c5992ed1508f2432973f39223f7639d37aa42956dc6a4d357df959d0b56f19d3a141d5d0b19b5d3c3c93d201d0623c88848b07f554525448c789113cea9572d3a9d08c3de11cf64a863a294272089abfa946a15e733bab8c377ecd72d89f08e38b59368efff60a01e982554b187b7a55979f917d2916ba3d35d5306c96d59cfbfa0d3c33ef2a9b9b7c4df23098923ed8018107deb5914ad7e20174b188e8a26b971f5db73a5349ecdf5bf4ff0f54ff885c72676f7a6c743b0390e38c53958d7a8badf35611651b432acb101a5e15ea17421536593af4a0ba61aead51c92deb3d466d0736c1f880a5701a98e19bc3b61a5613fa166bbfbebb7d297fbab5a71aaf4f74c70a249eda189d53f19d9e78fbe5d636269822bbd0b6d5d06ec840476e8137499593e6c369f2beafeba1e48a8885f535305f12831229472aafa857bf3df0e7753855c0658b58a3e52d459b6915984ecbf6e57f773dfe080040005be6db433bf55b6bd7b69ef2e071552cbab772123980110245269f749b2f40fcd490a6b7680a3c0e8445de72042374b55710821cf2739686db20d043be98ffd6950985c98b0bd768661dcc1c4954e61435719289a46525ff107b010cc8274cafd06c8b402eea7993ecfd035eb6910426461177331033f2a15d92498dec2507e276ff32ad711bc60794aa8fb9c4cb92fcdabd58b8d84f663755d44667e0ead4370c7af332fbbe84df218d21a38b18151b36f709bde01d5ab6f646dc19dcf3503aeb7f8c5e7305e01d8f8619847490bcad06cbab51d228af06f75b3b56f334818b6304d0f4e20967b4a888312d8e57874a832b16c41013d46cbfa6adbcfcbec7e8b637bcd7a3ab31a88d205e3fc13a61ff5a9605db9b9ac393c31b66352c1098e2bdcfe9d2d651963e9efbd690e47d6b6b3e0cf264bb0f2a0035af76eaed4a813853f6c0e4ce7da9ee0c6737a079d2a69a40f1d2c368b904e03b5ef8d0c8487bb868ceadb78b4ee51e560bc95efb29a637b90b57f1d91d1a19e7473f4f712809fe3e430350c511bc629fe81b09dd9a45c644ce946d016108896eca3e9a34ea9470caa063533b95a4bb24a98a766d9ca5525df969e910afdf35b3c329676d2b3d44b431dd0a2a53a0fdc8aa612367a4fc96981839bb8731913c3a41b09accfe22c53a72b5f09f4397b99b695c44b55eefe440dfa6f3840c8020b044217770ce6c86875e1269abf282d5a3c0a9c25a56f24c15793da33da42ae4d7a5f442fc6f2da906d80a19526064b17d17e3589945003b228c9bf67f707c6b00dfe9f1325cecd97aed3bc0f31dc5a7f5205d61bc7703794d1a22adce8bd9d0ae8f6e2625357aa6e38aa83eb4b8fea164726a644338294eeb895e1438d875310be8a8dfd4e286083f0c32a118e45d3ab5445edae31d983e03444c0e838daee527589d5d02066f7fb74b90da7e31d865e7ec2607f669917d1fe84d30c21140eab40d709c1053d45c6986ed54fda0a5748a77659782e5cf20194867fef71ed18c728fecb36828db1cddab65d877996b5a2825a7dbe4175cc877b380854d7159a4c229bb16b3b57d3c1db10c2845841ed66cd262a9c80cbcf1bb41bc8018a8851634366417e785be7fa65a180eb538707f92b75acf94626ff3fb3b84bc22a57153530443bc33d722ac0bd07ba6da76b8b1856b44536fc8f36cca44893843e5ff07ed287dfd7b9356cab036099323283d3ba587e6e2d36a3b4ba58365b9de9fcd271a49a55e437b0f4c9402b75bd2f80c9deb96b8786c1276039d6ba46f9478043850ddc01344db4c5fdd6fa7cf0b038761232e048a59639ef99b017ba78daa9e46e02f32d25ff44315e2b159f1d3742f26f8dc3537cb34bd1f91f7be86a62f0a6f44d9da6374f56eb2263fa64e614ea49d1ff33f5c9c53b08556b72931f13ab2ade0ec92a2e6fb74ccbdc986c8b45b55ca36188fdf4574f67454e8146dcdd71e5a3d344af7c9ba4d35d617014436ef74521c56156cdec2608c5f68abd508ad1e36e9f16ca8aa5ec675cf4a9378ea5c2f1b8b5ab89b90e3bd28a4d8e7bace47ac7625b46a5ff0075e3309e4ff2f1cda14086b68b0878147f692f52690b38be22362101b99b3311ec795f990ff19d62baf6817c012b16b61341d3a70c56293230b2c43ef9c726d24912b7704be891f165c3a5c713c2f1670378df3c006797cfdb904b4e8d33f205b8c36818a589b388f6c4577e54fefbc936dd4dddadde8aae28a007cc6f4cb9912ca69c30e0b4c8aa656325a8930ad4658632364337d746b88f65c8a340dfb076037d5655d9d7d4898d1713eae018bce0669f5236a0efc63ae2e1f51f720fee9e966ff451c143c352d86cccf67c28de70067a86c96497105f68b6c17c625789cbecefc87a3911d4188be865b1eab1aca110b6cc0d060695e3edaca340f96802d94ace44761c3a778a3c2d1fc8bb150b5fdd5f1ee8241d80596218e890e7b65e0b0bc819022835a4822ab35f74cd975e6d1c0c72dd5117570e0e553a5420fa5d6bd2df5f004cea9540ab936c73aeaaf52a0f73b07ee037b5c0f2d7f03acf5c768bb4b1efb0e824cb8f2be66219aab18445824400626c0cf0f243fbca5bc1af78ddb0818f821404afb8da34b3e218c4ffbe0ffbe9004c4ccc6ad8065cd157e64fd7f1d7dc53bdd125e0579bb9277df98283a89c4a42425225d3e1dc8e2d683f19376080d2dbb1a13d726ae13e94233750fbc948cdec461b8ea2f5824439ecd79bbe0cc77ba24ff5e209bf70d12bac2ac73b0511c86bd7ccbf83478c759edc4d8809889046522e10b89506cf0c03c426645e6454ac1f4e6e789f356818d9314bee9683919e3ac38a6a93aa1f0cbdb686ee9034694ac2aba7d45603b2db8bfd741f2ed4531b363c7f09b9925818defae0e707fa13a35342658c2eea18c3219fb50299fbec506dc00d4edee452416d83778fd13c72a299562d7a86cedb30953e27c5475d088065951b2719a70245d13b95cb11e7f56223ea647c49ce4813fb5b596ccb0709b041f0709a6c9b3985a559d4afa5dd59346c9e4a1262eaf2a14044c246d158c44b78a8bf26ec4e6c3c968e00a9cab8c55c296c14cf976ca0d7e2b8cef7a0e43a57357075743831bdcc73bb5be301d75ff88f471fad018ec3bd51fecd162a0857d5fa697e7e78faa495df852bb12fdea346994b7cd54d278253016313d0d560134e85c2c6c28858a8d04bc661621097ce67c4e2d78d259c2f62bf2adbad390f15a54805c0f817e919a82e11010c53c9bea82ffc2f735e448f162e1a05ed4c53bcadb8a237d6e2938c6829050acecfe7ebb651eea2b34f1519066574c22738b51c715881e276ed2840770378b0b63c0bfe3cbbe3e41c4915f29fa59027c66d13231887d731e5d631dd6a41b6a511717d1211a2016e60c3d03dce4c0fff6ba9c381cd05babd0af006e6ee7c9c82996004166f17883c22c924769c197e825a70306c4fc8798368a47f95306cee113c074e222fe3dbd6ed244f61c53f0a4fd6bd23fbe4027c86a8acfaa60ec1d33d4b768c43b3bbabecb7dbe679b4cfc7359ba5baf8ed82784d55b5c588c6a6a4fd6bbbcb962d31b8706bddedbdfbe01defaf053019d307541a82dbb2b84465fc7b7826475413e22889a6398fd049715106050a55513e19c8f39b75f329c203a9ebdccdb63b6b87ffcc4e615a016e3d7102e8886cc8fe5846dca8c4fbade783aeeff281f4f6caa126153bf73b678794296a8bd0512d25792c58ea23d57268ec42700277a0c4459d0f3d3b448a91091c99de05248edd52c27f69863995f21dc7881ad3303eac1a936a4f54113336d8c8b66566558f6d15aa558a13fe83cc6aaf2be5b2978c4194affcdaeca1b1904fa57916f02838aee26ecdff2461931a74e6d7503ce3549ffe2514327c549f026546be88cfef12d5b3e5e4b4a7955f43eaa4518de6797de180c32549059b8ebfa856591f97604bd5bb264622651811e9593a6960928f172567946667c0a5ba0bb801ddb064807992f39b735964acce35bd6c5478d9f5aa041ca4d7a1e775e5354bf40cf223ce0092da6cb5d9a26ddb45813878039ee1b91a58ff47d290592ace2e2936301fc165b7c1541167d263496559b1aa9de5e403d18b36509cbf9fdbd63edc86858d1442b8ca33bc4e0af6e90dae7ca602b0da42443d6d66a46ccd9578bb94640b25a753e8e63e545fedb38ef4dc5f81e96e6b18363302da39a26779769dbc448918a3e105c78ccc6b6bbb5b71c31042f39dc13eeb1ea9b51d20816d0eaad51d9e7853fcb2d8407b6e5265c5388c1dcfaf1aa95837dd0e609544118b5c610383719d991f7198ea5a0640ad5edd9108956fc56c1754423314020c84269b004c46d23b7b9e783212bfdaaa0f53c03af1760fcb8e8d7bbf416b1bad7dcfe52aaf22c93c632829ff9a0894e448411de65d1714b5090d7c5a8c0647f619d713a65cd70add24d2ad960a297faf6e82aa2ee3891e50c1548cc820707774446ab4807ef905816feac2e1099cfa99d01a665330ef4fe3acb64bf9ff0baafe68d86a9adac0e97a4abf68f1e9862331377f2254901b351d6a5ba3b3aab05318e68f53234c783182988b0811748701ac12208f7d90fc287c74b4dcfc5641701bf3442ce71149f348d5abc0a41c1701ebdfc70512faf91b798da34cf5df40912bf16ce7c6c6a8ae707fe257e93bf3e8b1aa63dcb8f0c33e8f5a056361dd7320c8eb8b35b08d558dc1d3f342bc34ee17dc14b02adeb9217c40b080ae4f715aaa919907653de348e41cad407e02c1c230a43c0a6732c312988ea2a53eca36297ebfa5bef054614a78b4882a9795b019b535f6eb82b4bcf6aeb5d3d7579fe309f7c5ff773e65137bc7bafd06b72381ae5c49bd12b6d96420eee665ae257cbe2d2ba0173ab0ecac9194779773430103ab4624061c8484ed342394c7823a85d8197f3aad39f8ebbe7768a58bc9e12116daf082d8190128c818d28e6d0f1eb11ffdd6c26ba0b5693d63e3573b014f69b09881f10fdba3f8cd981e7caf677c2d3423dd2fd6657cc8fe5a43a06a1fe4cb490254de0474505760e88faf6cc4e6b899ffa85431fffab16dbd5a64dcee472f0d1916bc3daf0ccc88e3587cd0914f4625b62e87abf326850b72303707cbf7b05f527a09c29357b756c371d77895ca84503ab9179764ac17bae1c53cc935d948e19d7ae69f7bf479525986eb945f221b251177b67977b37424c9d2ce82ff965b05351310e273bba0b07a84970d32fbdeabd7b91c6e192b4c4b2fdf8af23198321a24be740460779de244a949ac1ecad70a9fde39923e7c30c3f9dfc2007cb2a7e031c5bc788a43fef185588fb84f6e5168a4a2b2235da9cf41926aae63775b927c6bb88c1da1b07b79404cc580d439aef0176fdeb7124553ccecb0f5512d558c889f9c3f96593656a2777ce8715e553507ac7a5d15bd684bd211fb4df12f89bc5632fa323baf2f4304688d5546e8369c0b0bc9cce88b09375726ea7e55a1d03a446cb0eeae374c793274250c02c383a3b1cc40290200034c83d7dcb0111fb60c7d2fbe4fe0f834262a3f01e4b63469afdc52d5fec58b52cc10c4a74ee086b8d978ee0e533d146c4d24123f751da99743a477fd3ffcad8c4c6d73a69122273760b232c37e99447067c4d9a2387a06552ebd77372435f85c3ac0c874e75d8f75ec3578deb1ef7713963ad70d234c85c17fed26e69132d4d6aff43ff45e3f3f581170e55769cc27531df8063f37b3686057d8d505c0c99f268c2a0c7930ced733e5dea94ca9ea572203e0e14aa7015c6b14d5290f71c347394464a547959fb7a0e7179908f12f12ae081e159aa58aa16fd1f85a1b3573d70ca3e1c778119770f24471d79f35b6231d7a81767a1207a06ee20b6748b5576e0cfbba29cea1f3a71e0b7a79a6369a3e15bf81dd1a4278f7f9bcc7e0873ef899207f81255befb3e43d0e2c716a39f9d7d6f2fca138e2469c64b07fc22096f9fbfeafa9ada9e0420d0419e9ac934456c5fbf6c5e49a76225c806c225968bf85fd78dcd8fb43c0597d4f954d9207b81faa515df30e7e3d5ad37cfe6d200ada12c37c8c0c440ccca3b3d4880652589130cabc89335db3298508685c38a885d08c7581bc27993c676136fdf51b1b3298bf1e47ed9107abebbc23befa00f8792bf2234de82fb3a5b58f96de3daa881918511b73b5dd66b21e80a5c68c01a460ec22a5da61b06183d14ccb13871bbd99051968b7aa0f86db11d7ffddbcd3a033e5cfbe7d89c2d7ac0fb294f25a0393fa62a37282c03a8373725b7cf1cbc660b74e971344ff6793e7d9f0de3ea9d54a9eb6993b78093291987cc32b11b94a2ecd75bd4acebd236387b755066c819f077a1ebdc7c6b31360b4fed33ecc5ff9bf535a2f8f57b5a89e15e28bc13edfe56fde93157e36ac643987b87e3dc78b36228301d5ede4ee31f271ad7eb45dd2e13855653ec9d046ab9eeab4c2454837682f04771065a864cb27c6d6407a9eca2b6b16f550d6e5ab1becf9dbaba7763bc6c1bc121c97f3868227c533c5972115ff7b0bd210e1040f9946d95fcfee71a9e9bcc137b4b89fe70d3bce22b5c9c5faff93edace3db4b5b3b5ba2c6f790d669760119f6474dedfe5ff5d1b5f554b4b720b7fb87e658a87a4088633617706f05f7f30a93de7ce9b9d3530f4ff3393914cd13bae9ed05c77c406339be718b0b6c2c84351a3ddcfaa764bf03e66f4e9051bbdc101b66698ef53c3c3495a91f67edab4c6c7386ca5ed5615725cf51ac53a2fc600277fd76de04315ec45d04d0fa25e52cd623e28565165149501de324a5224a62086d9581ff384ee19018c7645c3f2eac3bf16d40daccb189aa1bf0fbf933cff04eedfd863622530039dea786bfe86d5903dc6ce162ac346ff0de34dd92038b0ad30e9ee141f165586bf256a9afa285cfc9680f7f54a912b34957e3dc1c18147163535ef6a3c1c3af5f5c990a995ddc81f1b66d55f00850785693a7fe5cf6a971b36b278cddef2ad6c19b224e173e367861de328a532f5d5cba9de37aabac81b349dbe414177505566d1dffc944d9cb4635bedead455b53ade4037259c8bd2b3d7d2982c76b9f055d676139f07e6a59344788af26c764ded8cb9609fdc8e2d34989735be3dae5a9914cd365d1096b29b396afe9a5124e22be7951904e6d7c07b4ee508e751c1dc6ce56472081580baaf4a9fce4d46b965952e0f0c88d0d92995fccffbc6d10a449dd5c47805b9d936f3f91c8faf27340a64871ec7ebd772639b59711c7194443d722c1fa0b3be3409bdfc384be2f745e852986a59632e68651d79b78ae8fbe52bfc54086e2ff27bd00e5bc1689f44335907f2e233a74299e640fec787ecadb3276be228ee8caf74c12b0b56c9051bba4533aac6a5055c71ddab0e0d6a7247ccb9d632012a396bbb059ac21a01a3709019658cf3d8e64d44d5aa98bbfb2909077155a8a86613b45ad2aed6d76928263508b5ba7e7b64e82bdfa52401c0c98792c0e0322d46f5ede8af28309c2f3e09660414c44839cd052aa8d7a378e2c8f8aa021b6aa5e5a377ea1bfd9d81811fba7f6f19e552a81e9e47d973238b8c0ffdb2163071fc4b308d149ebdda19978921b92cd04e4e2ef5e684269f5dfa305b2d68e61703b6be3dcf9346ee5a4b853293efd30611ab43fb8c7d1c16ef9b994bb07f98f863af7cb3814aeef61c991de5326e1cf8c05bee84e8b13e98450b60f73fe0c0ee77a4c5eb1d7a4c5ea578fcab3901fa11bf066cbf2abaa6bc690c5e11dd9bd29215771b14f3c0ebcb27a9cbcc0c30aaf44f664580d67d9207c5eda438585cdb9ba03d6f2ed0dd33c8b52223c24813c437335c15256ef56b8f637b364fb9e48c982abe927d5ec7518d71e5fe19f0f4b585de9c473c712cc3a73280f4acc0f216b1eae5b8dfc8eb3f5033a2e6fa759c24f17cbbcebd8b352b647000f2d245da64075588b245c1330397208d30a0a9af2b19d8780ab21717f4e0a82b891d3e2cc9abb7758507e83905c70d13722e334bc0d9925f2dbf5a9184c6f14a1cfc8296812fd1d380d64636df718222ebd611e395d6097e2286be02fedc5d6432bb8fce83e3f7cf16430c24a71065be34f0f1a09ec637bac289d86f900ec65665b7b3e262972e566d07df50ff1b0cde6c9b344395db015511b83d9a152c3619caf35ce7602897187cb956b614599e14313a41113f63285810134364fb26189c347dfd9b5642ca81a096c87318934b6eede72d213b21476c84bbe37246e17d1a2f868a9cfec0c9b886853ea38908b54acceaf211318456337a2dd50b582312a2bafd1e9f21280e0b30684abd66074bf751744d31e18b6c7a3c528f351a8a33f4d268d7a1466498aeaed3cf21ed50d28a6188d8093da45d81df491fe4a415f761d8ec2ad2665539d0ceec7665a9515518ad38b66a59e8f425833f25e4cefe6006e31f933575ccc1027f2bbb082cb3c1a3642d855dee6895a1d5e6f5d0b53d38967b689cefb12ea46ca185c3791207f595b4a74c4f3d048de0437ee767f711cb8c237830e777447719bbd1ea0e11b9485a16e07cbbf8f8da66a47eaedcfe21dd07d725df5eb6aecc8377c7e6b7d67de4c91a158f5e08e889e8ebaee39d21055c1042a712981c0f71d1a9d3e4453d4b518aae588ffba8d21af4f5a2ede86a641263d2ca13fd28353a7737940c1ea6434f5838a1551d05bfa384da5eaaa70a3429d4c782004f2c0255be0d7f1ab38c1f925e38fcec1f8cc0826351d2f52c77cefc6552c48e1178f050ca16d5fa8ac8029f444f3671d0e6713db62bf7488eaabe76dab739da330fdc840e2c5b62b169ad78a258a2427603d24d1a661f9b76b5961354914322fc8124aebbebd7f6de61b9cb26e66f40aaad5478f66816257659cc63b7f74c714777ecece015e67c4b4032f8302b8202fe2ea57d70686be09e0e4c18715543bf8de429316b7dec25180c012a521bfe81cbc3fdeb934846bf58e4acd55f8e0ef78e37eb7a2857d441844aa66e565685535f0b215a469ce12534619d0af22fd1766264b7db31a4d175a96aba0afb9568a6ea14a66f9bc6e9edf80f716dc39e6b8d515baabd45f89a404ffe859ed92eb608c0e5b19020754bf247a5ebef6f81afebf075790e96fbf6fed4bd9f01be8b4e743834604153967b9c5bebdd99a294d30498011dd6474b572745fce531f4bfb893d469cff9fea1c9686afd6ef8e4c7a82bb8b707e75f7eefc6bf38246693556fee248d5e1fe56a9dd2d484fe56742a1c0e5b3912075d5ec897dba2db6c19a5f817d04eb0fcf4f8c9efc771a8ec867e69261778ee0a7b440cf98bd4bccb079c8ce0491c9cc86f3107901d75b4489c811d8cbfd9837b8565f1ad0c012e6439881ce57ce13f24937fe62fa0dfe713aa778aa77ebd683e9a1036d6e6bd678c6ac80543479a1832fe5b527f9a125f296e72098d04e40e7ebabacf3ed54708e53ad232973d827fcf71020aaed438ad8013c1158739a6cc53046cc46bfe2e9e145121547432fd7aefad39c63bd5ba8458f940f7cba411c8a02ae9cde7c06b79518696d6b79e210925c7df22d16ecd4645657b3dc1dd64d3c697347560e6488b05f2af004a35bc31bd6e9d3d3985fddf515f117196dc94f7708486dba57a60a8ce91de505295b115ac3c29171ea2d2ef18ed6f19088d8a7b261b6c760035a4d480a7daeabf4cf0306212bcc6780ecc422a54bc7db564d0b58b6b92b01f118516bb850bd9967746bc33c574f5f331c9740f120e81f2e922d147cfa065ce134de2dd165627369ab876f676c93e0c835c2e247b1bc75b878532e94a7792f88d118984385caf394d73fecc9df1f0bafbd0065f9d7b57c11179eb9118a5e88715502c5e214f4c875fe0ee4e23b99a277a19905425f89701ad83debf5f17183bb0c3acf9083017044bf519266f8ee9302d9171965a794a41423881773d3ae4aea8bf5cd8c718b472d3dc2774722a46854df2bf08b52c90ae7c7af180a30b3eb8b6023fab9cbd72d756ed40ad90680ce9724c48663d2962a5a0fcbfdc5231a546c8cd32d1cd67170bcafefe8efbb2e8eae7aa81c556ac4139835f0729afcdc5fa8d8e1266131a7b6f7f306dd01a6e3ecf505c5fde829c3f137ede5f2eff274226843d7c79d01549e3d65618bcd3a5410809a545617fdee3a2a6f197d85d8ce4144079768a2eb8daf48b7712ce18b7ee905ea1bf8b9a3e4a51b025d5265ea5e6aff300dbee94f7cd924b449bc416ba14e1e9ea22cad9bbef3286002de897ba203408e2cdb7ae3b77dcf89adfcbd6e0de52b25a0f47a948e332cb152a4b7771b1c9a8cd0c6ad161c6cd70b827cb90f9498dea6868fd8f3ea04342be3ca980d35135e34c534cefc0645541964e98475e24b9a56ab66ccc062f2a14cc0d12ba259c946c3701a9591ad3a8f90d086bb07bf7e38ff507627353e0906932289dcd7ec644f73bea900b7afbd92bdb6d475ab9e5b2b3d123945076b458fd9275a3f4e346dad66ecdcc4496c557fb287f0005a241f5f21f80fce14967f0858d355e34f93126412065f58978ef010fd46a30113c322bcb3bca84265b666f3544817317132ce3f2b409a20568fa0e0fd3d7a23c4c194a649330637833069e6a0af2b9e17fb8549ef8a2795b4771fd90e6c706f61b5646acd7704827a83cf5f40a4207f1884a4067888a64b1280b7cc875ca00802e117f9bf7113be950b612b96c0f584da3ea926be284090e89a1b9ffd18f6ea539c2f6283be38b961cad1aec6e1c7446a89b9e1f9cda42ce127dfcc0a3679a467eac1e97c9a83d8b5ba60f151588775f676471ce8516e9e428b68ee21a01bcca42d34ae200b2a3ee7971c7dabe6d939b40c0b5d7dd99f102a2dbf6cf61d4187a952d3c1c2d47358d3f4e2733b713c20cc8370948803bb1608ea2483f1894687e97673d7bc107b426d02dd5c684be7b714d9055d29d1aebb5ccd4816dcc28cc0385b83124153f5d58e413281324ff001f1761acac7e8f067c13417b732a4c79a88112cd577b4820cca6d9a9b48be42f73bf2bf9d767dc7fba04a6686d083a54c502140303fc4d35c21a90531e340bf3c904aefbedec3fd59fdff0e0f47c451c197dd1a63ec9c1997085df0452e7f4797ab2a63e7dc91edf435c565afecafb3d69116578be7c6d3fdcc4ee086665581a2285eef3f958ffcedad5d70457896959284dba2aaca5f4a86d3b6a772852e24a5ded2780bb40792cfe46151cd6681e1f007e7edef7110d24312fd914f6aa65f22cf6a53acdbee691a5c14c5c9e7ce61ed7ef2da7edfa7aeb3b96ade99457a883ede84874e0e094de0e7648a5f49f51dfff46752050c8d1ec6141ff20927651a0fed4394fe5cb7de63673b92ba3db4460e3a94022fff304047b48cdff40e4a1f5927bfb9ed566d7ff0aff8501079cde061556eb5b2ada8bb784822bdb19415023279b112b88494d11d4a131671a10c7f529a5d0519107742c201a4b0f7dffedb360f6b2a961386007bcb64a256a206e55be0cc9893f741825670625a07be3127f771d10d5c61806ccffb4daa6495d366f31114fc72dffff448ca6ca214ce3636c610f97003e8dbb6e93c648de754d520b311390a325507010d5befb2b7f16d3254f562f8a5568750a50d18600a3a2675ebce4d4ce5efcce09bfa91c23af2509d34a5b6121a59260e13f3b7f5154b8934dee335350655c37ee823ec17814883cbbff6775d8a080c73262925e47caa550c9d781d390c84685006de42f9c5f48c0d41438b2eef12e15ad28b14853f8a9ed78177aa63d167fd5cdc21ce4019def7d874699270817cdbea2e23c11f7a349383571466fb4877ae89d06599f86ddc62885353fcd2cf63e5bc598d3a27b7c1fe88d380d07ac24ce5a119aba9361db35ae744db53b88fb788098c86b2a7d8d8ed82cda1c4b65f27d5befedf6469e3fcb3edcf076492ba78ac953bdcf85795c8f36ec1c7364655ff7c1ea78a569b0ab7e968458b0479d8f9e692ce61ced596c3b6f4394b3a1b2bdebf0b15c38981697e1b7f5cdb04fd2553a1068771ddef06dbeecb876563f9d8971fd739fc7ed73ef85b3771d4451bb51bce1f1e8692d4ab3129c614162a701a53ee17424632d1f48a2d528dc68c0c5d6d062045cd6e759d9e4992957ba6ef13a089f09323c78bcadd5a7a4e1a49cb4ea0a22d204253b07caf832ea3ba00ebf5bd8c2caa33d41f2e960e6791b2a2c5c79c4d1d3e42e56fdd2ee2563f19652599a5c84a9bc5935d066f5e4b93206302fa3678a94be46b6dbf640a84a43b8e6b1dc481e0e462a858c1f09da31c6667f137c3a54dd73828185b8d09dbee30731fa3619e5c48d71837f945e9f85ae1787ed33f803e67aa04cf8534e58c9e2da270858e24a820678203551eadadb99a85097e34d5cc1bcca900ab1231488afe206c8ff385e897e485929659fea2fa4a4b07a2a499042a7afa8fb2cbc3fef7fa33b47831904d28760e1e551d66506b79cee53d2f22d3a14de5183191bc08ca2880b07da51a08c3cbdc2ecd8e9c2382e80727e563701a2e460a1c91cf85537eb70c8afa8f23917e12278859b6701e0a68317943d13a58d4fdbf9dfd0a268bf7de69c55c631b8d466bb1fe891df8c1c6c12cac8c96e6e24dc3c41f6bcda348ddccf55d4735322a079351f0883abc351cfd82831b46c1b50b08ec0ed390178679a9f278debf2e0604d24d5dd4b3c5987df277731cff6f528694e0257cc4e9326ac29a706c731002f485e752df57423e86d76efc0dfe22c29d143e109bfbe6fa6502008694b50e209490556a99d0f3b12a7b0a7c0e89e97ced9ebf21f55e1ac148d5e742aec882f97d4533e758816d32c95ce3d6f5374aef0c7880fb49da62a366e2fafefa69ea28529785c49dee2386217bf7ed3fbf6279a4517db347781b30e438df29621014a24774f045541c5c74e3ce95f68f509858fd0e542e8240104d8cf0d4496b9b6b04e21a34ae652fde8c757e01376ad8f6e4c856cb6d031e4b1aa9644960df37abe3df8b693dae682f323196910e4e4931761323556bf4f0dd6f64067d0a678c23d979a2db13413848bdbd1475594531823ff3601bf52e6d2cf017e2497effa3fc4257c2462d1fa19e0fbe8e47501c0aa7d46220bbd14d00484a6697631d2e8c29f97105778f4b30bfc8aaa7533d18dcae888916a16b94d159075b5c9b7619d9f3ecbaf64b337adcdc0bcf5b46399fe05d4dd2f1fdd72a9cea4e483e272251dfa2fa5aefad77a4a7ad0db9057e7f33e048a6edbad4fec332123ef37038b523c2d6e782459858a77cf0ab1976e22f44bc3391a61b508252dc5b6fa57f279a4fc2d51a59a2ecab560c84feb0f70e53b3afeb7a2521e10f6140b2106d4e449c17a21cbd89ddeb0bad30effcef1cea65e62f25b196e0a0225795dd9c3bb4d74ead5b9b244cffa4f30d41c3b3f475e9045e266bfb9e6b22cebbbfe10e1559d8ceec34a6d2e87bbf7143938b18341f5103060ee872c9e07863f83cb19f2191c00b7cac948896d5af37dee12a274825d03d20742f688de677c43900e374785ebd7bbda3d71d3b2a8cab58633a355ed7bee0afdff8b5cddfb17e315451a1778b39cefe1f1518c7f7f78d17c4efc73ac54d9f6fca748b3f264001ea466e61e3e599a8bf26043e90c51e338c6d17f04cae44bf613ab5c6fc4e05ad6871ae4e3957834fc5f6fa4383335e27fb3c8bcae4ecd406777a212415bd64acb546692387bc79cbd792f32b2a2922328503e65de4a58fb5c69dbc801d7833a7b22efb8c6a387da1a5c1680b836016e0e6d0ac6619db58babe30e0380a784052e4d8e7cd623d43e212331a1ba3724ed26ff6729877c6532cc95318d2811496157b9a1b5be79e38250216aa244b6181a5c60b377cbcfd36efc27caa243ae285c7a9766e1291fc93053f245834a7bea69769c6f5af307a859df9cdb65e5fa056286914847d03a238084bcb964045d53f5c0711a324e6b03bed4944381533bc8f7e54008fc9a00cff56ba568a934a6b9fcac0813afca899677e286cfa4c312d6f8ddfb8e7dc9d4a67d6c9110f2b15d7b99730210d8968b5b062be4ccfc6ed10e53e98664344a63f3273175cfce8d5465f0868b990d98bbaa975aaff8b504990eae6edf4960c6f4d10fbe4f8e716de4374b22bcc627e812b839c6d7b70a01bb8acfedbe0488a4c230a3a1a9e99d161c16e3391705e65ae9a2339473a21c03fe17f6bf00dc2d265c0a3294f2d5284ee5d0b9249ebf92c69d5799e8bcb05d86d79582a2b270c4ba618ea04fa6dcfcbc5d8070cd26a3567284a9e41da02b6531d28f7632a937a9d3847910ab6901a358bae44505c2c25cee579b8f371195ad739fa4d4f64876a9a73e8d10611a0cb139185db1338520ddd5656edfbfd11bde0257339000dd8ab6fe7c22a3fc2ee05c5d9e29019536af99476d6eb2adee82661409a3224bfa2b8d70f83dc77c28eff83eaa61a601bcdd57b5eb19e1672e4de3047f52977d81f5cd4dfbf46a2555e46f48a9537bf5628a7a10b1095903a2894d86a7a70e5c2d6b0b469def7cecf89f661cab925f4e1d55365f4b64930c95ef6770656e0a170e35afd277c190ff765fc614e5cbe710c2495d870bd987736b715ad7bed24875d4584c8eeb08b0083e69c7380061cbce51770a87700c9b56b94fb3e944068fd793103cdca3a80f386dcc028e26b0f3ac418285a4abeb3d40d907036b41073995e619a0ccf3e1337308edf228335bc600e82f6e210f95738a679e86b03324b9a7b1a51f7123bdebda24014a3dfd3282055bfd9d4d1734b61d7bf938e67d62f5a1696448fa256d7d7b13f4ba653d3f66f88a53713f222c4672d92d7723d1045a706ce1bb5ad2295e7ba1571a109a0cc0e11fd0db210f6c831ab8a4162d048b5bb1f7852afab507ced878506e53cffd02a37ae6fe98776bbeec131174a7b5794df6e31740ec056fb3368cd491c30015bd73a43c58017a14aad567144fba8bd106d04411c13bd058abeb012e0389274e36a0969f9768e68bc6c005fa7ac685f7a01f4a24e210ff18ba51904841cb2060c0c69efca3715525ff06ced5afe81ee1432f3cd0552c9124d3984094cffc19a400f9c15a5ab569afab9e1840cb87455c8e121d0dbc69feaab380cbd344906663d7d3ab680ee9c6cdc05354503dec0f29a16585e14f5772188e37b57d5ee6adae3c75d0668e0620569afdba3d078284948f32a52ad49ef6e2583fb729c894ec2ef395d56daef411f289dcd94e3c4f43e1d8a9a48018caffbe3abd8eca3a90e1b85d2ae83f30e5eaf9538decf454446d2213c355b731fa059a5dbe31c968a2cc50ab8a2da2cc7edba1975730a28e3620bee9bb8df11c61028d72e9ee69421840fad25a58f5588d9cb54c2f98e9c2000326d792e194d5987377d5c69faa06045dbbc54ef12ca25d6183787f970e3f7259be0bb8a3b86f09ad41f77cc9596bcf7092c9bc61a15bedbdd4b458d9994d9e82d7599095d2f2cebceaa95e8dce440283517ecb5ed87a1f5b4c9c3f2d6a4ab2acd8bd999481c990beceed8bf5fc4bbd69bc8294db295881fa88f5b4c18f655d25b009af7432c57b80322f02d1b35e446c88ea1565f63d00a718b1db7b28a0c4a1e8d01642d8a32d5eee85863ada7f56b69c5afa0c3eca8594607e9a8f908c59a39c2c5fc7f6e947b6c4ff3b4d63563262740b53f245b1b4acf39b2102dea851aa2f508f55997220eccbd33e8cd0716edcf2282aba146d74f4ec2c694e11e66658e4977f4bda6a57aa8164fcd2b610b8a1f5c070e19cccfd3bf17b37868946bd68e18b8bbc2df82f4e786a26f59caa527f2a7cbff86d112d66554300d71e9acc9a4d41d10d8f9bc9a23e55e63c294f92e5c4e9b1803ded31b366af0d37fd39db25108d12902f8629cb9c805076a0b92476e45f1c0faf51f7d58650d894ca57abf5987e2eb8b0d8de98881d73eb77991a0f1be3c14ded061e635e6eedc43d08180731f2f532e296633920d7f4d637dfc694ed163982172f9ae2ac48cd4eff51c7467dd8f7a5250bdd4dc5338b08437d939bca046cb56da538215d6003cb9feb29f83753cfd14ae1c356e2a2f53ba6767c949225f6c584f10513b316d2db15501ac071651e79dd19e0035a7b63ef035968b98192af143c00ae854daa2c373e4ee31325b2d298bcd8288a2334a418ffd836fdd71b19b6476cd7527df2ea61c48c80c9e380e03f79b66f92c273808820cef1f6e91e3515ba5eb5a7aa6f23705e4c1a5b603d6ee67ef2122ccb7903e23ea935050740dc8421e29e97629dfce234ab58ddebbf6034035c93129496002341173ba0c6e849801e376570b5cff1db52f18a01db4b07ea27de54a0ed2053d9039bf597338ec5a5bf5850063a625ddb29a53c3cdb6fe56e2ff8df65ea5619ece248339977a55aeefdc165f8cc1800455b6cb9b8caed418d693baaf43801e81a91b84415a20fccb499a234d39f5b838dc3793d984e0bf703af2c47b340424c0dc6c7650b520ff1dc6e09df67f434439e3f49758f96047850b369dc98cc722dc9b0e40ebbba86ce56ffa7410c9feb910c03ab69e7457c4bd54cede5304a45d110d990461889ec4b115bac66f08971fdf3028bf087f48a52f8cccfb704477dc50bdf1b682373021245aabcfd7b2d839d613e5eb1e8229619b2375787487fda7a4cdfbde833df9297e42ffb143845ca716c4deda061f1ca30009ddb8f44272cf78c8171d0236bd1e2acd8acae7abc6a5fb554a311ed4b23e8d8209ba4fbec90812224568cd6c3716f92b23d79cb6b6bfb4a343a02579b12d7b544eb20c2b7c5b2168b9510fd8c8c41caf17aaff634b1c63d77e78a85fc1d750c28bc7e2bd13eb7b9f8a6273ede5d6a7e513a6bd43187afabddf6997b7b7eacd90e45e9a201524878d4981b30fed5322103bda98857343417e0b0c2ebd2a31151158496ac92fb59198bcf69f7e05461b5a5f7578775d1c243d0dbd1388f93b851b055a1b3841975083f9649414e9b841f69246d8877fd578c207a0685914164a6a56fa788837205ad762445f73144efa13eed589d5121797ef5f96796c8cc8118695ddf974c4706e6023115be49f7afa30c64e0806e59a417492a93794b04c550c5c8292e707b05593066b12b63a3c278681b547ec8fefe15987d5604830908781d3e28596b727f3f64f855f38f674a0364fa5c08ae4eb9d1ff0b7dde11f18f7e593b8e8e17492f3d996cc6697f858c6b0d7a6e626e067c972d12ac828d0b72412298bbb56adea8fc356d8d0afc697e0e6c20227f5a09af85faeb9616f9f81f4444c273e6f7df8470f5fa696e0246f0622ac384e40868ab95c43e7d8578fd3c1d0befad9e79da1fc89a13d34553e9a2e09fe2d3c69d4381fc5d515de1a3f0fb543adbcb0d45b9a78417a40f956ae81aa010eeea1e2bbd2346171b5c2612089454793992ed9a615d0b1f582988babb839fc71672ddcbecae5f20ea10deba87bb92073133d2bd06bc6cee236248fa7e4ba25e0db6732bdd96d9673d627e44440861eabd109c18db1ecef7c4828c10d7cbb6e472508de981f4520a92e95452df517dc72e8b0dc617745738b9065eca2ad8d17e7fbb2ff6a683ab06afabc6c8c22e378f169ffd282eafb7653f3a35e4e9a202e1f4db9b37f97516cd9487989d86cbc23b276bf0213915dea2bfa9012f8549d04b2442dca1f8a9135e7d1aad3216c1d0626e08aab489418813df50a5654b0cf60830e92861494d4f7cfa44c5d0c65a2931e013794882fcee7993072b66a8a237115e57c948bb1996a9c1a8c9d81c2ee845829392f7c37b08bf3fb0d8911d3cc925c29f61c862848df4b31b7405c296c057f0e8ce0f1be28b1192de900c5774aeb73863f7a095c7f3184b8aac76c15eae4e7c8e26718b9102f701d2c5f5816796eaee5e11fc7defd6bccda5c05b617cfffcd6d153645aec39dccf765ce64383596ca6d7397e1379c3201588d8e071a5bd1886e4319863f9b0493ea68ac6fb00a7b839bd8e89b9b25271d35d0ba1ddeff4bbb052a1306da6c88f48d085e908264f5d59478b032ce4fad8386326f4c2cc23c79e7f3ce25f11327f76cb83ecf5b0eb04eb9581cea8c8d620cad4f19e4ee3300a6b00de6c3502f305e9d7628be2cf67f97a9836b9491026f53b82c218af27da82bb68ebb56b55a33b84629ebecf0f5b72dad28132a2d096929f6fc5721186b6beef0127395045eb21628d0159a59685c49deec26876c4027671340c797555bd2e6a50cacd005a932273d2a2b57ec3328867d800bf4c21525a3e8014a411869d5a26e8b1bf371ade82be9c1ea4472e46ef19c504311e53f8b2f22be93678f64c5cc7d333d46a8f4fe6ae8ebf04b7c00ea4adb974ed89eba99f57854edf031d42becc8eba693110c662c77bbfdba77a1d9134cdcc11ef9000491ce67f838004d2dce96d9b81602e697035716c1feb046b5463113e0edb53c44db383e537d3937c016ac2cca25b31c74f945e64339bb899a5ae37ba22d56f0edcba990ac8b337fa11a8c9ca73934fdfa306259558c40d1275a4d7d2ed82d5a65a545ef85bed4218a6c7e9c232f53737408507fb355e155bd16ca9d290a8fa2c0234b9180e5366a656173806a76d0052fdbb24ae1f2c0045c34237fb7047c36f8fb0453f616dfdfb5c7effcbd8641ae5a3539ff57b007291cec39c95c993dd351bd2f2452a80a70043b03cfc35ad26acdb92af3c7f97f985ae0fc522512658ae7b4e2196631e4369d7fb4cd875fc0cf2ae062887eea8c042542b7499313c9ba25c594ce4c1f88fa9bf825001d4ff08c4c9a6f6a2848dabe60e154c949fb1272fd29586e9fd5a511c0e76dcef9488e25a482df370d691b601d8aa956874e2cb9fd7cfc27868f38d76395ab023d0b330aa89fcb2a1dada651effa38e6d946c07e90292bc13b8d549a3f1a2d98d4a7f0d75521f83789453327f22cec819aabb69432b66db1f624abbe22d2d50bb363898a9067bd48eda026f2888c19961694cf14b48e981d455fb6af8ba45f1d150c6a9ebe39a711ec742a752bc4d13e0e922c7b3bd5c2d4d76d7f96cd50c98c840d8f821a3c02536d75a66b299c7ab744fdecbfc0e76f9e477461f3ebd1683f47908baef4b2e7d5ffca1e548b8161aefdbda44414ea03a2845e7619c27a201becf757d24715aa3d40f605fd8356dd64c25627c7dad577dd6699c7922b557539f44293a2991a26790e7a00830e97adfb596279916f71c100c70870880a947fe8d039feee5227bef772397cc8124273bad5023d730e843e30ae917ddd69dd17a173915d42e70953164af158b959c33bad5a328a46892622b0d2750430223a7dd79ddf1cb7471830c0d8390aea290c0417f57af851d0395fa8b2bc18fd51e4002aef758711cb6a13e5553a6ae2d232abd4fa2827130ab1839538c64bdd0f05b4e18ccaa4b3c3988d59736116d892ded56ea80d9bbaba735edf7cbd2b63486e39f87bed2833a2039f99b466d8db826de8595b111f6b7fa7bb54472ef250bb6836864a2d172c88f82467d8aad9888ced870201b177bc1040900c99f05f33719f43e92e09904c9dfcac44d23f420105a87e1e15a3fd5ef3c45ba54304dc13ac6a750e13ac9ff9dfbaa864ac6e9d66c5ffdcde415be5501d0199c0f8b4dfd7ee7d1bb8b83fccddedc5987a9c16d6d0e93bbb826d4ed97372e4831428a8d1c1e461f72d277117ac02ac6ad340f7e440295e6dba5b46eb7624d4adfcb10659159a0f9fa34df3b066ddcfaaaf4d58a87dabbd24156d250f1a9d25eb5ed5d55b1f6db634570235023893744912276e9bb6410286428c5ef46d5e441b0cb6245522ec3eb58da4d362416c64dcad618c4946fa2e5d918c0ec17cb43d12913b44b8fa8f7b145f6757791c39c9daf5d3600000f577f4ef614f6f74d2d7e32495aad0963ec06f64a210e97e270a11c39f6359df2b338b3f7562f8e172068313bc1b401a059e5c571496318cad4052ed28cf447fc647e28facc00a75a4b290e4f5de85dbe45d5f5b69db80213da1ce09599ce5decd4c7165c3834b894a1b14896955e28238b953caad32c1eee7ebcf737de332c1131869ca22fb803382113a3a293d6461f0522977337be352c6e1755f458c60095a5d5e25116fefb8011abc3c2a54438d6f06a426ce047bfaf68ff5c94aaf7de9d7822e9309d880cc2d51fe232c5a0208819cceec6f337624ef318fc1b4a9bb8ea1c71f4d0f763dcfdb5696c505fa0b485ab6d04349ba8eec899c33ea563481851c2e43c2685f82ca06beb36bee6c45ccba9d6a73307f03a9e70a11e124ed7b2a5b33d7ec1389684e7b0b19acca249a6e7a22c4838e9e7ab82bcd8049d69abee0e4e01971b5c397ad15ea03f5e8db25594fba0884827bf218b7cdabcffc1bf3fa336a844aeb5a40c01997263b37b99bdc766057b06683c9ca8cb119fcff6d3dc51f6fbf741573a626b916db5064772b07f9129d624733a6485b6a9303dad8721c991a183aba6237b7bc933b821300aac65226206273159f322d93231c0286279b29b271a5b95f42483d12d1e3c2663f47a2aeac93d1f49d60e7c5e0de9313ede87a1ee1018da9f90084a9a167cc05ea277d6dbde9f847743a6b7f116a9b19c896b34b37d32c5b287342b20ef9413ec9f672f42cf65b8efab68e71e416ab70b2b36b5555e5ab21af5cb3dbe6b35053ea1d85cf3aae2884e87bd360954017527fbff33c1c55273a07c55921faffb97b113fa034f724489eb8ea45c2a64ec637a0e338bdfb31ad35f60cb12ddfdd8e505bba4c732858757255738517d6874a4857e64b3e9e038e10e3a67d6c5e4db63310d02135a6fc49bebc9c94af48f95da1f57351b5685aff61e8a1090d566da701934cb747b6baf566d495cf8fc52421d24b7d76306a9db7329bc1bd3cd888ceba33531d9d8a371ae2a800e686bff51365d6ba58be9024319fd491081dd75a541acc18b3a05b54d331ac372b7a0dff82886db6cc1ef0a596f043a1ccbf9676731fde69959d50c05a6c0fbd90911bd85100c5ce9f39bc775cabbbb3e6e56c51f8b222d69155121da537965c5560c59af539c90fa6a84da40526ab764604dca5f7588b5c0542340a3959852f727e858d61d4844ce43848595ff143641ba387a1e0206ff1d52717d6346af8e608f239c2b653b01162245cb0adbc80d45384cfd96d881f8f6c40c68d6607dae57c8221e752f4bba7c54bdc267846c39a283da3de0a2b5df5b1b91a9e7416121afe068b777cd53cd7d4728ec0e076d59cf4aa10ff4e9299405067e50b929cdc24e4f74adfbef637747ea039773476e7e59ce666c69ba6d2bde8b0bbf6f9b3246d8e97419ebe844012a8cf8369081fbfb0fb2ce5f5867c792112a032ef59eabc50391aa3fa0aed205c8c8534a3efa1ca2eeff810b57b6565b245f60c7627cd87c87ec880515241c14b70e85c85cbb04c8dc630b70b331fa199eb826637c0efc0b8bb0bd1050abdbac1317d806eac331e03846cda991c7142df2e5aca0af93d71d70b526686f5f33da3230b58afd8304f3ecd9f0af28ba0e6df8c723c41d5ccc0d96f0c5acd6909603160bdc99b93b91c363d5c71cd56b012234349d03b97acdf11b8f84f8a24a026667b9adea711488fb16e0c529e3ed5d31aed763300da9f3c8d0d116b688fe2cd235bcfa3f4b8dca1e76eaba19e27e1d82350376ff3393352b05e9310884f5f49ff1875490e0e56846a575a0aa412ae75d23561a822a21ddb0c8a93632fc5eca077568d9e5d4bf5aa1089ef9b2b76d3696923e9ce9976dc5a1422ab4b398b38b5444efac3bf2ed2008e1237ec102581d816d2d420d85729f59fd5459642ebf315469049999dcd58541cdd48827e7c28de07aa41e19125424441f1800a88f9f8e58d56ab1c7b92892e52cf4c7ed6c14e8e4183d6145c59e92fc270bdec10faeea697b1c2aef308d0e82e2752074cb38467f834ca7b212783d64a103de60392d333fee4f53fd2095b0c6b20661cd6d6b3b098cc1ff913473b15d48599040407906e4319f49fab558ab31531b47aa0f086a9159d7d88e46d2b22dbbf0aed2b440e1c4c6905a2f7cd0369ea99913f8241970eb048cbf70153b4828044b5442265d43e2d27b2960579d7a665ad7a7dd0de8caa04303999909ffbd3d0c467588c561d1c869114f303e52b7e347199de32ccb4a1cce1e878651e5fc7aa680d3914fc7ec03c93775ff674c49dffce621081b05b0d39a7c3abae90739fabf1f97a675576bfc39d7affab8aca4bfe120939cdb5a461567375712c9712ab7d5b15c4db08122df6493f04ebab874781848cdbb11e5fe59b74998a11ebc6ec985d582af0c92f9573ec08382fea3058b498efa2c791ab2c234d019971c9692d2c2cfe9aa38ba0ba663fed61407a42f1b82089de9ef47d24c06bb17019805ffb506dc26277dff37aabb5760b8398aadc9e096390131de52cb93c72d806f8bb2e598545c4ef3a364b9b012d7578b39f9335b98fa74a641399ce188dc13dfb35b628628b20a1b46f4bf91125d6649cb9454a1d4ce6c7f98db85f20ace0a43902bc3f3ae2c76ca740dbf9e1f452cc978149728a7378118b4750c49a2553d1181d073083612ee3210e13301cf7a160a8881a0eb748b1a3e6c0813de578a2a9a9564eb48b0e2d477f88856ebd531a890506f0f797036eec417410b67a98bc8a381651a7b3c33b0d4401782a77563420e7a70f567e884b1b0260384c86e336c84f2fcbe7f9037bf4327c62a0fa5eeeacb8dd58cf9bac7bf5aad5aa18b8019f98c1471a4b9f220b679d7825383afdd5a57d19979f7cedda93dc7353c195841cca6006d2d4cfb2060c888eb5aaf32b8b136bb0b95e40019f9fe53711900439c9f49b0b681a59acd3801191a3984a5b8991d149a72a377e0b8ebdb9667fd709b9aee785e111c59e0f8876c024ccb3d718c24b7e89da1d4a600a3aedd61b978e0ba54863d9ee48776d08dec67d6f8833da73d9df16bf763c5001dc51d139d667668846f0112929efed1f58c60052fe29c8557c04b74ac6f8d6b3f3ec8bd8243968be6f170daae58f8467f719c95882f33a12104ebd4a0ed31bab8c0d4a05516a8718f522bf28d7ab745819a28bb4ff5dd9d5775dba1946b1e45a90c88f4f2508d21dc46c8c5dca831c6ba056014a976b2bb0d7ba36e165eba15406b6ce3d8d0dc1eb338ff76a425d6ddb3ebc18c744dd3f1b8de4d76f6b130627620b4f8b684210ee08cc04b5ba08ac4be56db70de8f746ff5403adaa7275269119ec4e8e4b32fdeac5c2e5c866539bdc12d7dfeb0b64d6da6214b5709b22c640a9e25914dacc33494fc86b867ded335bf9d69c150a015cbfe82573098d1c79c6fd602ab1b81248b07cb8948baeb86dfb6488435424ecd10c446a23ee6c6070c476fe74c60d2edeacdcdbee657dc42337d8c3f081b3b72ced0eb9a62cb2dbb2b9b057d64af3778c13aaa463def446575cd0911237cdcd12399749a2f2f9f8d839685231a1afd96c92e2c62c889b88ec2089f96a2a1f137c95c34afdd62637940f1f58a9b46efa5384d640fecde5fb5127e6fbfe0ff2bf2d0b91b1bade302a25ef8f5880f9ade6ad12aca2971d0d77a2d217b1d37042cc0a520a1ebb3670500939637186c43b82cf1bca2f902d19e928c2000402de2b8e84af15a6f6994de980197b2f3a6800350cb8d070800f29e8124ab3bd09d6f4755610c918bae5808a26aa8c5fd899c6e921e4f676e16072e96cc0aba33461b583e5e3394cae458f9da473b64b7966b73870c62c73549a630bf5ad95487e60fd588d1be0c13f03b0abdbc914e5f3f3d071cede38d3caddff11ae708cb7f3bdcdb4e16bbb8853a9a7b6e03e14a55d79920b14d85f81607f1dac58157fc1d312cf5c3896a22c7abc859eab6b611068e873df4c60be652bc7c05d0fd6559c2829d45dcd187ad9d77ebd33bb5d7b15757e1c1662a1a47aa12e0d691c8cf47c5934807d33522fe46b75692e2d1d21b263d0ccf5d9ad0c7149f714c71589beef16cd847f5121c4eefdeb4708a75c8145e29ebc465ccca6104ca3b7a9df389e931026158d69c588848db70d0565aac9d8c4254212584a222f9842e6e3f248c050dd0a12e8af9abff90dc7404956ba7f6ef39ec2fde0850cda345b98c6400bc333441ceba129c5b658ee80d60cb3622cbc119b1e9bae447bb678b63a8023e6974d3c8bf4003da3cffba2e1d21ca50968916a814ea27bc100668e7afb8c40a82ffe6075599c55415d6fbfa8f59c29612329ddb46f1ea28c025e596e1d8c0a6421baec8b1f8d0e425725739a3db269d04a6dd1f962c2d0e6327ff88a8bb38371e2ea0f826e1ed21f4a1159d83e5d3485833297faa28f76e8f78736aac6f74317714aad5da8ac764b1289ed46b0da9cca9e08a118c7b47c6f2b6eec92b816e3d97ce3db489976af8b5bbcff513315c9ec817c1842dbcb37f6c6b440f4fe5ce80bb3057616049ac9780787251b8d33d125d31ff1464b7a6e01f66f6fe7ca781da4bc407e70486e8a581f2f41d0bf8c5e5231d0c92f20327503795a7c2786292fb477fe14cab6ab9bcfb08420af92e1df1bacb8125ef9870f89f05c45afa5d00f27f058d619bed552b013b7140716f94762279dcc7f3191aba56ffe4e0d344972750a6e3194a3d295cdedd3ea3fa0524d2e9ce7463120f2a62d589b4719bf58a8c82499df350c0f4908af100b9851cd415a48d18a0e09608fde8c7eb0354df77e38709b4659c22e8416bb08b6fa46c762ef1a876200e42f422599040157ae094a5d11272572ffc91edef4f856fb04ab6f96ad106aab07edea1ba3cf2f3e87bb8a39898654b1591777b3dc194299b297a957a9c5136bdfdf03cabaf2e459572ca03f163efe756722625e2862f70f492a495210159ac523a348a858599f8f9ce2fe900c1fc7b3d3faadf6f90825f3ab0b2910c47203aae41675198914506f0e7772532c73fdd45738846a98045b8d956fdfe2802dbd407a739825de86dc41f1471dad79b6b197406b10040cea20edc93ba4c979584ea360f457f11ca136a681275c7b9d1efd01e762ab486d3d1380dc3810762894223147a976d5c2d7391783697b45f39defd78573b5b307da8128d0a65942bc75ae8c9bede67c3715879f3c541ed00a912b80d8631b7875ab7ed591a7318b393a8415c9aed75d6f9e99e83e42ee06be865fd15c2f73524e9da14bec060d920bcf6b8c37a9b777082a7b43895bf177213b742b09efa7d9e51d5ab4969279b5c1c5b4b80663c199fecdbf92dd93fafa5f0785569346e13086fd7f79f9d219cb6bcd68fcc67bc12141611a5056b39b93b48c031517d58a9d530768005aa7afa8a3fabca2d5ef9f36c60853adfce6e0f70ad84bd60943d2e40448becf702e932febd64887cf814909793bd52e7223e0574accedfb74462cadb58cb64ef16961ebaccbe93b779fbc3211678c0bebdf7aea0ef15732155756bfa2935dfb8bcbb2048eab06e734608f46c4a9405a14b9b0e0fa70947c93682bef4041a8718959a77794f475118e5c38a767c3a63e17c68cdab05b323f86aac19d42bf9795cd2c40a923896d532a650eb4ae266145e2ec3fd885ca7ce4ca5ca4830a77262efecef4edca2ab36234976be5c27d108b528a4bb082af8b62f3862f6e556985034ab28be98706551aac358efb0df0c643cb5e276ce3c3bacb7869ac1ede070ae21a9205ac2300adef229a214c84f0e7633bc271a4ff4dea54a2af5d055de84ac2d0d21b7e01fffa965b0f393c69f95939276cdfe5bd02448ccb7d824df326feb1117f32f4ea1eb49837aa940cd3277006296b2decec5e0d61fd420728fec613e4b797f83295771c2cb09a672b09cdde2320b65e8e21014b9bb01bad4e3be2be30b9915164617af4d60e919c305cd3a002dffc058071a380eec2afa1402983260847c95d615c2a2c2d2c2fce911fd90c02065cccde476bef089abfa124d7a0335905a0218c7bc30d3a5de533ef19942413933774edb811289cbea7b6fe4b4f366edbcae6a89e1ad5b618e2547f264a1e9ba88d448f22906fa1d8da50cf3032274f79ad2043cd662960525f026bc1ab4ab37bb986be0f3b2fd471ad36a16ce7294f2f556bfe79f29687f7120edb9cf5ef95f7d662b3b062410341976b9448c9e90d442a00d67ba76a7b7d76657a8b2f891f7a993d220b015df179e7098acd9f5580ca209a2736f80fb0d488426b1f9d356d56c24e3b8ec33abe5e2afc0f608ab7ac5db1bc0732163b9403169d0fdefc904f430c88b864bc6e96a0e625e797e382a959877d0350918206047a615eeea4bb008158bb8400aea8031ed1218479c20fa7db38eda4a31644dbcec8c006eb7922664b6be630859c181f09733363ee10543473e1aa7f51709e567981e49725a0dfa5b1675f2376fbbcaab38dd268e2371f18d57529c2a3cf3622555a360a75874f18ad9631e8ed77e9066e533b72c485822bff7f1187a8fc45d5b813bde238a210aefa9929620068370608f4aa1bee5a6b4c46ae072efbf6d5fcd79436a0c6e962deb895c8370fc66cc47fda9118bbf60e7d9c7bcc7dedae274340addd1bd96830986fe3f17e6159d47a1da3cfef9397231b0d891a3f1cb76b9f1aa57f4416a6744c2aecb1da9148a05e7da4ac969875ed29fa6000cf1dd4c6493b2e3fe8507034fcc5dcdcace1331bcc3f6cc62013b57ac88cfbd53438899ad7a9c1ab11a1b494f831b235a627cc1eed092a5f08ae7e4258f779cc015e3aa0ad5fb1d2eb9577537d478dac7ea2c6d5b82a1cba7dd8af6dbd305f38a8069413a5eed6ca07a59e98f172d1252c8b09f16d1831fdf5c5f9f8cbe1e742247285eb02a36f9b56b918eec76c7082ccb32629132c37a86d7191455349c425218e065ed1014b3f5d7f1fb18b36f678dfe347831d6b518f83e55b591043f63915a90abbaeeab781b6a11b7eaca89f1e61e7962f4441ed37d51bb211d9d482280e5bc984fe34479fea34b5b272afce0ea401ba4bc0b356b7946c91e7e22f63c14463e5eac48ff1bbee0cf4c28afaad3d90f88948d423dcb5777bda384748328c6466ea3923d616fd4a9af8e23f5ce5ac6837e6800ff16c3f5e562b05d299ad463cec867430b9871ef9fe2b1104738f09e6ac4bc1731540351e8902d69b0b78a8568b358731976cec8f7d20a2ce5f3f47cdcfb9b0c43e5c0d845bd18ee2e3ddc021e6903519b2f1e06291294aa97e765006176c1a171ea62d69d7ed4a2f40454f32b0724bbc1a628798240ebf699b333935599e42ef3ebcc95ab793e2074d52fa567f2cb30e8e2c5247c2aefc47c6eeb98759c6b4d5e300aaaed50cf77fe656b2ace84fb7457e6d1c3cf13ca4818e5716df8403074cd7bf07557ccce1ff8ea214caa9f97f91336dc93ec51f40ce88dae02dd15b5b99c6d372ae10f4e3822d2e60bc6cf130ccbe4353dd5a1a2039d6df017709b76f1dc0f2a9afffa985c9a3678e830dcdbc753e2494fa8cd6d463c9726050c0d638d35e848c402d7633928f17791b791c4221eda566497702b22f9ff988c9f70efc3f8cc848d42245c2c0ab19ca40ae1013bfe8a58d1369c59f773a8e1f7786f567c6b78ce5004f988a6bf47710f425288715b3143f2ff57597f0476167efc62e77d5719d584412fee6550ad62c624b31719d0176a23f8e1d813a3d6b530d2b1f8dcd2286d0fe4d257beaf9851fdd80df06957979abcd849abe1d800854d1c204aa4c96b280265a2e58287bdf516a5dfe3222e64a2b7f0c4cd6ddad6a9339e54092c793fbd8b101a97c0b942b8cc548dc1a383784fd5566ba1aa280ca34f520136d1fc2f2e304c5c63f965e931fd57a633fd58d63ea1841c647b29f884207e7c6eba52b8bb96ad6fb62c8b399edd4a80d5a74dac51bc2c13477595ae6a71a159185959b0aa6cb9457309ee9e1461f83861a956f96c4cba2b51953c9e603d03a890069e279ccd8ad57dc6b42f355473a814d43444d8a73cf2dccb86a7cf0fb4ca3255b1a1ee6fbce69c8742eb08e30ab5ee7eade4d8e40f970aba4344d2fee517e16e6ff67f2e102ad28c896c789ab4d11479123fafe2e4366f6eacd3435414583bf0c08a5a0bbb8a99e92237212eff5bcc7a96f51363c469b90180bdaa16738f3f4388197e038487b986c18b5825743e9f891e7d101a751078415761fc61c475890de7154c8283d31cb3b0d90e4503d0dfbde3c9e47ffd6bcd50e1089a440960f3c7ef01d6f6da8e59913d13fd76ae204db24203d681ebe1e80cff5bfcc3089b46b47c82be4f6b3825707e5d0cd76062c221f5cf784ceea3024f6ed6826b181aecb41630cc76188e2d6182b813fafdf295bbd65c94be169993c906f93ea5428bc5bc7f90faa934023d26c055e32cf85f353d4999242d6536725d76832096039e8501082d382abca635ec71035a803025889eef25ce88094917de75fc4cd9900dbb4e3adbdf18d2634383162a8f353e3c5b41019253c39a44de802302cc6ddb71e11e61f9e9dcb972ba2f6141e66fdd9530bafb57f1dd72b46f882eadfb99c6ce6c28f09cf37e1853c56736eff78c4af1c9388b3de9814b201c09f2373c0848d661052a7c409105fd55fa896bde75222fdd15f63411f3170486998e8965da442f2e662b800aaa311e16b5fe059fe85466e7c8fd61f034e567096338617c3ff808492f7b64f82a7cf3e73e1ed16c7160f4419e9e6298571f332a435ca2196d3d02de25677a25c695792e7d4d26bff93282f1751df363ad6b70403a214b6148e1fb95c95dbea0ed243a441c67e4f21896ea38868b6eee2c8fa49a5c822d51deb93c98adc8a69093f9371c6c6e655e0662889ef8aa2383913423d36824e61a16f3b05a29d59fdec05861e414914d878451b562d8b98cc0b82faf2aa284905ecd0ed5f6a62007a76c35f09385644ae6220aa8dd4524a6b2d287c502d1a2f27b9f5fb4d59ad7304c44f70e005f73794fd5c69ab8927ce8c515352a3de600d1759bdab6737236d91a821b6bd254d1e0784926963e318d3c7b2b8e439baeedd8e73f35b76db4f78ff68f7581c702c00d2291505bfa841f2a13ab74e4b31fe29d59ebbd7f0c1f50c7d86c57eeef5f2cb484600da3cf4b04d47416a8fc72ee6ca96a65fa0e30865fb3e1ef854f9dde3252c4c594e6e1cf7dd09db4e0d45b797b4bd3b4765ce4ea6124ca7d46c964e9674bc7cd73ea8ab6b1e894eb7c05977b592f51ce9d6fe2c06231f72e4beb3a7d04746fb058ce4cd5779ef08665b1987558470c903bac7ba635787956d42733619d8a3304cc094c143ac4440ae4145b4e4366ba6a1215aecdccd7f85ec3a0e7de8737cb275ad08da4b58fb6984054794bfc1281dc374d047dc5c127362c38538145794faecf9afcd01c9794f60c4ff58f6a600118e937160c2c410ffd1d97bec1a53aa8f76a40bad64aead7445101866c10d32c517befca916e52551f4273680b706ad37dd9c5147fd39e78b02a260b9c608ba986b78da481465d530dce63243dfab7c273929fcc9769f5bc49180e655f3f4f554d9b04b8af830d303d8fbc8ae40573a08599e21ac7271176af025e0835313743b48066205d41da80bfea81986b8976d68a4d51219a377158276876d98e0fb9cc79e3657ff1399dfaff026845bf7323ce27610a61f5719281345a938b64e8dff4d53f7e141bddff6b6544c1e8a60436b0c3a37a6dab2c661715aaf6d4a99fd8e0854b699576666ab40b55ad3e35fbb119dee06d29b6454aa300ecbf646fbf47f57cab0723aed0a71bd0444843ce8624efc3ec9490813f3e59cb6925102af8ae239b4b611a3c8e7035b28865b052678066a852092ac1070d79222bbb5d36ceec8fb2d61cfd622e1bb3ca90fe9ec64869539e8ddc2afc728bc43e9a5cf49b731ef612fa49939c902cd27aa7af62ffec6af34b9039041a082f2febb172c331baf435e5dee3b27303728aaca596e90335422fc84ca43dc29c3c8e96c4596d5db3f04128f7889fd5a1e9c859659d79f9b2cd64644f4684442fa3f68c8993df9d78d624a6fda7b8290cab2596ba59c2cabcd566aaf44f50874b546da5a64e3038919ee276555b1dac57056f11a5cf1055e98fb9ed35b4243a7688a6296ad7108a36df6ea71a229edfa0d0676e8f8e97fef0277c300729f5d0b9d3c8776e0ee2c5f2a2122396e2e868c5aa3ae5b86b962339e9212409ec057961a62fcca67f06dd5ba8fa61b246401fb35acca280e187937adc09ecffe64a67a52142953be4200ed6eeccc7bc3a875242452afd6fbd6661205738612185212319e3539310c22bf2bcc5478c5e5b9f02cbb1760255c7de498fdeb8088f5ce6cda4e64258f58ddee7ec819315b5fc8bae18639b22444da467c160e80b0dc56954180be6c27f67db27bc4aa2b8728f70bc44b83742b72f739df011e661ecada4db16127f4971d31dceedc656e49f5bcba73bad3a1cf75a8cffe23ce8059e926cffc038533c0204dd04c6e76c85ffbc909e564b4b6b190be824f0fa9536511a1c075032863df7284363afab08690bbc36d7e54b308cbbe6102af6f6e00a6a1d9cbe3c098818c9f4c92d7952b6513756b9d369130b94de6702f465426328784cb407b2608b2cd660b50faaf4be3dcc4d958878e6b5969ad305e2b52ba0fc872067c1a2237ce2d4102251b63429b718ec419837155b42471c8dc3463b5f0456258a05f64419b90c57d27209d73f9ad6b1b3ed316032aa9fa3252931f33cff71353354ac1dcf580ba4ce49497a575681cfcd1174f8355dc5e25feba7a59c97647aed1f2498e3e4ffcc9a296aebfbf818fbea2b219d92c2d0a25c9ee80128188223a207c7d5b4d642db84f47866ac91fe145668da0f3d412f50f6b60d69a31a22af29350638c96d1faf186257bf058513c4beb54eb2bd73a526b3c035b9001f1d90b5d1d8bef682a10f75b7d6f10e7e05eb24e6162831226e9e8ede68e1980160690d88dd3d3cd08efc76fa69844197f79e1caf6868ad6c6ae683149100c10d0961b098351e26519f581daba911cefd4228fe974fbedf4e40dac45544302f9a20bd7a03c69220721e7a15c2463c13f8a8c81e149f6f276334a798404b493c735edd4c62117c605e7f868d551a033fc6a63e3dfffe5d97b89ff9716b681be25ff67f1cc1bbf19f6453d3caa073b0145ea20f1d95ee71d9e4f5f357bf664d279a7080ddec217b96b4f77376d72cdc48d76a87d7ab88912fe9d781bcf71a6de3cfc09b32d00208a7d3db12295a6b9a15bd15e4521b20639ef067a078f0813c8e77051fcfcdd71223aaca0f115288c523079eda017ead5e67605d6eac7ce0b8c738a5a14903a23767b4b148640c063d40e45f2de550624c416088197e47711d202cffc27e9f1662e11a98a1de66438f5db18b62497c0b30881943f87af3972e2db74e222c5d6ffee3a01a843d8b97269f68293d35164302c5919cdfcad6f909da5cef141403ae6dfbd3c56867c0fdaefc890a4d4a4bdcf22876d19f313e1b1a5bd859a2b215af7d09a2fb3830a5f9d9b5146cdc1e38e7067f3646392d44b6264cd84ee64b452bde80a69dc27d2b6b1bc72419b6f58fa475c6b3c7c4cded2ea9a2e927548c4a0fbb7700e73ae92d011eb070c7e6bfbf9648b24ee3b0cc4e12d8f6413ec860e2ab911905be9d162a7e254744a4f759f8a8b4179ad6b5235b5243f70a79fa58d5f92610907d09497512d6510171e1f6bc327bfb77fccec736e1e8412fd6293681a8d6bcd51dd46ac6df587473a2dece76d0af4fadfc2a4718da81ee529de172989fe68fcb0123bd3ff7f8f6577147baeabdd3f3e95b668a0a9c86a34e4fe918d6e9226c389ce38fa5c75187086a628f60786d7beeb2f20f1f4f66b7516e902560357705b48cbceedae2fd66842904a28555b1b86b185301f8e62fabb2ab26066b1e99606c99760a04113f3c8c4bd1c77d618bf7a40d72c946f45f5aa49077aaa65ad11fb9422f27efe76a947af0fd8e48f5dd87494d405ee42d0c4d1b32ef99e7f8b6f0592776ffa22a62ce2055b4733b72a64952c4b785bee20ce2979f3e08f80408c7053855761ef1112a15c2855863aa4986123662248775fa9dd134d5c6758aea0725f61280b1e060adb29f5f41e9960dfecc911791c69f2dcdd13306db1df24bc474d47742fee43d6c71af1dfc4e5cd3821be519e7e7a9fb0def6f422b11e2ecd8298de7d6f9eb9f6391c0f23c3120be8dc95038b2fc89d5e6f2c2094c9012a9fcb85feddf52ac9f7e553fee95447ef4c42574bb7de004a687631dcc9bbe8d7bb303143e5483032035b3e9d75b5d0fed3251401be894ede89a6432593b081abd47f235d14d7593d2dfeb096e6550b988691fdb6d105c0a1e94802b21933891a931d96d6e082a34d7e3401a267f284931af6438ecde89f443331985ae4d46ba5b2a89c5ec1fb9a1dc24c3ee5ba11109a037d06763633935e0ab082f598b0e138bf6683459727bc7fb64c2cde5f8dc173679e4a2361306939ebc28dcc2aa1021b97681a430288937ea94bff88836eb81fc21f7595239541aa2bd4f5eecb610493eb043ececb68c55d37e535ed4ea88789005aba70ec37a402caad72ac8dc61dad7ab98b202a43c0224327534e939aa8218d460f79e17745fc877f64436de85650db92c7d14433b0d77889a904ec9e644d79c5c0e56e893854ba629a3e780ac40cb22fcbacf9a272a52d8113ad19ffefbe195eb460955b57304bb61e88ef9be0268acf32aa08377c823dc6630c2ea6cfc3fe9602b889e06fa89b951d3ebabf03457b4266717c8da44cb288bc013d9e8b5550504db752b1062a81efd1c88f46df1e309626f8cd6afd8ff2826b2d26d3226e3aad41012d629d1f2edaee57c11fb9d5715a1bcecf6aec56279644a76ca73730622cae783f06c7572af1f202ed4cbe9bfa6db358841662e4135d712570123b43db85fe24e2f081763583878b8105483a749363882e34c20bfcd165b6329eb16e54bad7b0b4e175e2e52790b803db152a5c7540f68ecc437407f55e734a2ba37bc030bb17c4ba5cf3381419b9927fd5ddee988ad2961ddaa193b60c7e702d55cd9c3a2deea93cd4b6afcbb6ea8f15392bd9849461b9a9dcdcbfdf929359611237ab2ea2ed59072ac3da856db12e823820ae26e58144821ba52fa7aa17d4532abc403b650259243c08a6e3efbcfad447bdcdc3d072f299bdceb9af4c6d3503e3c31a6b3e2d3df2af0362dfc9e4f949f4b14381a609f64ce814b8dd42fafd9b9ca75fe2c32b0848b4c85bffaf1102e0046210e50c0d9bfed57760c74ad12aaae1c6941bfc206d49c91e0b91dd97c0d2d5e04e2572b8161dd264c0cea4ed24addeda392917ad2d868ab4f5517f17914c81daa730d4d0a3fe416bb3365d29e6a9ce35064a0ef76a36a6aa2d8bef29b2a24498d7e31ae99318df476319c2fb0f276abb622dc3e88b09a3f8cb69b6dccce133becdae1730e7ac465a959b48d28c885c0986c9aa2a96b3e55aa10313d28cfbe92640cf3cccbd46d46d3339b747876369e18dfaa7dbd346e41c9cb742a10193d18f08ce23089bbb6e14f2955bafd0ec5263cbceafd992a29eb9278b364624c978af3355df4be61d34264883e866df084866e39ca2512e1a0151ad354a9b9a670f0f73ff7f937d58bcb1aefbebeb025db8b05202d8e5155ad8e0e9a7e148b5b36e29fdd3e8878226837ed20f8be1bdc9e702e6c05c1ee2c5633e97d21802c16676264d93cfa2e77d028c70df1d428e4b609e6f1a2c19c2c640c58255680765f5b507d1d923fe211e81e219dd12f6f016e77b21ee728f462c8d05768a5a197fadf8c04104a193392d2c5dfaaff9ea6b8d802c058f6710fc40649c85dd946d7b57ad83e7f752b51b66426b7f46ad740e53bc9c4047e46f12a0e1538aa6d8723ab2956dcb0da6762313cadf5ad808a9ac4731940a305a6ad0c285b058b4802e6be9e2fa204dd25227076c9b7737981b47f4d814edb02c0279c65dbdb5c2bdf3c0d89e324352218a407c73e719936dd97b752e9f30f09dd5e0bd4f4caf2bf8c4bda784fa475c79d2e2bef7355139c6a5bec53c3b76844116af40b1d3d871da769d630eaf11f0f30100b8af3202cc599f42abdd822fabad215753c444d5525a189909c5b5fe10d3fd624c647e81dc4aa1fbc7287579e49abd57b198f4c51f465f32768eef283fb2aa077ad9a0544b892b9600505c7f29a0025255db8d87541a27af57a25632570d85c6250e4d83d35ebde956a4f2d37e2f49e346f873864cce1c98e091153fd144947304d0685ce4442620b60a5152450b0d3b48a4aa30d87afcea79b730f9bb334f1a6a23cae99f9491488252d84aee16ad4007dcd8b521c82656347e45c35bd5b74894814a0f3f322c7c95819abf58af13884d2159da494d1cc8ac120ac49652392efdd84c726f3a4c6823460db25d9858ae0b4ecaf3c5b5c7503f9a1f72a9f55cbbfecbbdd5aae47d17615d4fd47086838d0a9d1be9c7e33c2a5c66a22793ba26e0c582997de4f6b9691540594c29e3e64f486c9c438f5b404d5c7ec91c582489ed5cd125fad46d9f6d240d4ab03ffab958618436dd960f17d08077975a737f3f690e3753af5eaa59392d7102b32ef7eea3282e2c521e332dc80ac45cdf1f0aad8cf0b7df4cbf9267499431787d635f0a2dc65a8f6c4013510a5efb8366d8966ac75424f09b9d6db0aa6e2163598547f0c29dfb928005b1f123661e7cc50b3bd11e0d5419d7cc96863e0cd5a70a6681e8d4de26880093fa120cc695af907a7c26f9dbaeb2cd04b0778c4a48abef6992bf6460862d9f1a66cbee92b0455a16dc815c5f8d8c26b64d296c055cbb988aa4f50507419d7881b3a244b5f55bcb065f211c52190a71608da24712d47e869f0ef9a5bfed362c195fbfcc703a0c770460ac27a05949cc085a9858324a02d32d94e3a675f040829459dd5ab64e284c315388b0630631611fceb1b37ce282a9c4a3ffc1aedab8ee92ab25d271f46dcb48abd7abc56d2f26c90b3ca961165bdd6b767d1a450549f4e03541dead60001a2cd63609be6a6488d566d6c109cfb2d4de141ddd1dfe7bd8e6b0c503e1457edd6fa8355d455f4aa7ceeb5426bf9b17c31587df6d1a2e47e177f687a48bbc10cbd4edd0a4bf836441c55858d8a38a25483946954b40b0e91238b6a1c88cda2a4739c61c1285e7e405624e4c79d8dc15b4097cca5740a419b39caea517e7c94839e76bf54e75614e7cd04aa1d8d89272ebe12e7a5569b681ffdfacefcacef7403523a4238093c00455a59b9e35622203e85cfc82fde3cc2d9bc1d9dd6ebdea5bef32a0d456165ab9641e39bd506be33a5b5ff11ce9c4b021f2df60ced9c5005dd18314a6f8c055884718f087e9f6b2e46af0767966b7fc701c370d1a779b9ddc621f091c4c640f455121768ab20938727028ee1b685646700ad8b50e5daeed86a4d37fe329c39d14d89d9b160baf848a08d11d4c00fc367e3004041ec226ae988d152a595c3e754b21a38664a5d6922432a55a6f5afc6e3389c1ff00d53c8a2d552bbe1975ab5b17b084f6f92be4c800bcd20e33d61420baf33edffe9f1e896fc6450e609a147dcb5d6d37060f7825d1a4e022c6dcf4f4abe3dbfe13c5ed8c88925b15af7a43c373b6e8bbe19ad574cb03deef5bfebd6805773ad94e08fe648359a400ed00f6034a84d8d0d1d3b8b533ea743a928a44686a8eecaa7102743f683aee46896d46afdd415f943657a2b9a462cf941218c69a569555505f0ce921eda218933a0039c9210151388e4409a0d582deb905916d9628ba836ddd7f72d11ab00cd7b4d76c6cb196c2891928c86d53b4ab01f5fda6c608c70505427586940e538e8baaad55c9cb7773fcda7aee4afa7269999ae669606ff0eb213eae803b15378d9e28c6f35f76eac6a13ad7fbe35c5f63ef75ff46b0351803f0f6881732f7b9883d3d3dfb0e4f9a16afcd93ea99416b9a3b4deba1dbfbe053a24c54428c39421c6d0e996b035ed7f667f0f16938b51016525f41173f0d62c434fdd4cdd9fbc0fdacd96ff4f27cc63ecc1fbdba577affbc0e9a4969b2d56ad448df5c854f5d945cf0e493b4803297246447d573338c9fe6759084f23bea6d181d5621844fccdd688aa4d07b4338fadfe37fed0d5109456df05f2e06209cf970db98ac198218390a3ba9712e364b555fc9e4f650513b70ca1ece296d201f58bed7978c8a08d56e117b6c7ea80720c7506e8dae8339db8b65e79771564587d100e0a0778d42c2f9480419d6fdaafc12e08e3a7217dddf7f7673467b6517c2ac44de801b4560fbde9cea18ecf9e66a0554ef516555f6ae11a04bec7c751c86a34cd998c661484a931ae8ac9a063e8670a40f14c9c677a531f4d38e4cfe4767dc2a62154f5c5972921fce72cf5951e1a8159207bd56cdee07321d160b6de8b0e5c033a94f08afcdeff824844b93df4c174ff95bfa73fc6ef4452fb9a5438e07102cff15d58fa99891f93c6421df5dd419a2b877c602730142d7624ef28750c490e9abd4352f2f45292eef9fbb99eb974cb3f22cb56100ff758f4fa65686b9beeea72fec6fd8e80e6f84533a535a01ceedecd029feff62f3f21fefb1eb1fd3d44ff91c6353ac02feed2c5724650b922160b954632c5b191491b1e91add506357fc25a46d5b3da2a0bdf7ad9e55dd58054b77dfb753e3bb85b706ac97d0e47ec2382e2b25d8a76d60a361bcfd1187e5052222fafd308927c599262b0c40f033b6b44cdc91ed44ff9afc755367693190aae18c7f12b52c90c602bac010b5c32f9c92440ccc635cea258e539b6f9d6c3e15bbebc5f2e4634fdf8229c4c78898d8b46b966e4f2eb2e41a8279da26847507c91e5df9bf53240056af5b63dbfbee80ed43d3c16c59ff2968ba14e2f59bae55564745416ca04ef8c2a754ba4e6fb9f98372cdf3a95f031bb283b3627443bd469d697ccd3546f698f1494b82e3a14a1b8f26482742ec8897d1dee639e402bd97af91fd4ca1ae55368be300e1ff27297d1f1e35992c1f6122210833021589fbf429899dd0079f9899e9502164bc81b6bf5f802ce7d621d75ad19ab8ef3667a4cce10f1df9bb30a543bfc1d5739d6eaea2313a4394205f146c1d91b8bd5b6d57a8576de2ed89d383cbe70bd5dddf541a75f9803695ad62996d4d44c275639b9d4d165a4cf196970b56747b358d02b52206e66ec9b49553c7bb137925ce58b8be2fd11b78943f602e71763a6581c08aebab2a8398f96e52d3b2ad8304694fc495f55fa1bc8cd97e82c90212583f120377d5067157a5f54885c95d5bd9b612056f8e0e8c2f530ac379b87dbd2282f79b7f4e47e8bcae59871cb66bfdcdf5dca54bfd090bbdb77f689b93b3bb933b7d908dbdf9f9354ec202c50f85cb69bbe991806b9d10af02f68349607385afee4381f8d4ffa550d8557989436f342e228aa927fea69fe73189357f73ea6b939dcb743ca0328a023738b7d1a71266a692fa7cbc482770bb3f507fa9ad38dc487a79386af1a64550f8dc748d04eeb076b836ee1f57415b2f555bf364cd047a196b78447c118790f49627f14e9301119394f31980a04b9f072e608a7c069579ac493b9a82086dcbcec2b01602eecac445bc2dcbd6a64f8d988395717a076ba04e99daab2d5ec01ab639ec9c6232a3645cd2253076a88a8aec12d36c02c9b01646d1c9f888507ff7bd15509840719c19e05ecc1c9a1b0045b19c307e777f7998f494e7b5d9938243505729bb0eafc921b1acf87ba5e0475207976ab37345fac576121a9bc3eed88aa1099d3d6a93e0af54d013b0d774517e0cbc5dac3024c0628750515230971806aed165ec341059824743cff16eed01f93d1c7d6467ee92fab19277552b512035908f82ac2e596e07184ca167804506a1c38a1be4c0651eb0c6c356691f5dd484950cfd8e41ab6921edce6d23d072c48fbc89f51e9d6635ad046e1c25f433ae59b5660575564712242b153d86c79a6aed9b6892ec488ca663a72c9f41537cd2bbfb54fc5c17c8d080cdad074a86ec60fb1d53626e17bf9c72ecc8b01bb666edae5a0c024e40ed33069e4a7960a52a0c925d7b8637c73b2e3be19af32f02d45d3d3b1728fbe93eaaee2912d2aa4b45e616ad14bb4d106b654de5102a1badd935f017404d4c54d6d087a0a3fd67a4f188213d7b7f8cb62283eb6c4dbfaa905671be7db17038adb0d72557501d2e5f3a1e20a1205ffa441c9fb92594ab72a6a302ee968f3979eaeb9b8f93c47ce60981276dad1bb4eb5b7f7b7da80e3f87602f3e8ab5d834f3e25edf160766fb92e158254aa8e7bed288cfb95a59c7cbe45a12d564d0775970ff4dba02a354c5f3b0b766045869c7c9549f7eb164ce9e587a523d8d39dbcada78a0d3ffd6bb3483a9a8299636ad48a5846de727ebf5c18ee83d96ea50b7aeece4a16e6cbb2019be2197762eb38954b474cf63dc504c14720fb2013644db01cb729f92c95750264e2687bde87d7b4f84545bd3b22542c0167b760291e79b6881278f2b3ddf07ce61d2bc945f90419aef841ae2ddf13987f41f01ae5fc98df26b2b44b990962cc11f52ae059c172b1f2772bd1cbd784114d40f893133175d3ea8039d2fda7606c58028a13f210366bfec05b44df773748eeff0d95b6e244319ba10ab852f311b4de4c4e8c56f12d504b91f936afc1d27cb103e41000d59df795da06dcef952494206a778d1217bb1cbd22cf0c689258af623aa6915c8503b68950c0aa172296f2c2e1d76c08df9fc1395568312f59ef55f6a7e821effd9bb2a9d46ccc1ed916ce51e00216fbc87f46cb6ac5c3650fcbbd626ed1187ad422a3d1bc2d4a84258e0e7734614549eb32c6da596dcf279ff03881055111b3e4cdff8f8beab727b2cca52a7de0c698718cd9ea190a65e5a2d5d7c0c5cdfaea93a206167d27a424278788e54f1f162f7921c9ee7b46a3775d6e80608c6553e57f39732775e61f1607191466b78a549d6002da3995bc8531a08c0889fa10aba7138233231472306c759c9f0f3dc07401f32a2c190d15c277d431ba20710be2ab2abd3add55fe2dcb026b07857d6891a2904f4e57085decd3359e9db66f55ccabbd5e8b7e34194c0e93cd19726d67375cb623ca5d19cbb4fa8cf65123426817266f3ba0bd11487e54c180513577b84b48a9220a58fd32f0b82d7863165b3d7c3e4d741452ced3e7f3caa5513c8433d6a63a15ec7f28c48d5d608637106c1d0429697d4f17fabd47efa0bb979093a326d79b2a235009661f1caf3dfbf6b6d2d2fbef7dd07bab466be202f68d0b1a7bb2615f3271ced3b6f326ce691a7bf113e7cc1777076f1155a9f5e5063e8b35cc6edc0fe58d64111be959a33e33987dd39347b48991c38f3f872262fb7b0db793f45fba1396c88e07df0c313fe131b81ebb9639bd13edf460ba76b58990918e6119c37eeaa54fdb51bccba6380b0c716bdfb26ee6c8259f71b808bffcc9dbd789fd595afb4e3e9fd7c812e5a8339e1bc47671bedd05c9bbcaf072da67b04f19ea37aa934f0421e81335d2666807adda6933fa3762123768e545340925a857560e3e6dac68f4e7702aa324cfa2bb55c652bf955c4edbde94458eae2ee241c94e3da844fbeb98307be8aee31e172034fc7624eae304a5ededb724c07eaea03bb55987b70e8c140f0346765a72809de5b24ad6923168ef88b8c607545b494966dfb1a48141d4dd1c6a6ccf268c9047deb9d8b4d5d3ee7d483106b5b68e65c0b1bb2cf6ffc3f5ac9e62eed883b62269054b45e429288d42c6c57d93f3e2f6c4655a4621f47c7f7ae14c8414ccbee8449d70d9434bab4f75953dda05c72556fb527047665afdebd407d88c49310a097cd6ab84f437421c28bdb25df32bcc39919430f183d6e13949316e6b870c7260c02f14257c1dbfe8a0f9477f14b16aa4ea14ee4b279c9f0f5d4799e8fa3ac3ca26f6a023c98ea410bc36a89b5aae407c6fd26b40e83ed16b850483d5e3c558ba8f08d0dac46f241773e750450e2bad91ae8f3140b435640446959c6417c4a58ca0978f0e619cfc3818821a54792171110e8b91cb6a5a47ad7de3f7f3e32de3ab7fbf33b7624e6453142b74d4863975d8bbbe2d29d311930f5276121c25c772412613e2b210e50519e272550a2d01a69b3b933d2d0b4d24d1fbcc72074ef084fff4ecccf100cd7926b8916cfc03412caebe35d8d7727f8f15ef3861e8ba176e1d31fa1089d4eaa02b5faabbc45debd6faa82732c9b9c3b26b9b8c76cccc7fd66f7175b0ae19721d52dc0a04417392f1e399248ad198a8ed6d2eb9bf22765e3a05eb4a4a17577ccc6dff3e81ffd7d62a2882be78f911d532d5513ed18999f9a1925fa349c81012511c333b84384055562445c315b3b68aecbe6b123944c135cf2028958d30f584a3517ff2fa4d2ac2f9816aac206f9535da5e3511f3210308d5772b86ee9e5e0596d61ecd7ce9853d3aa2da5073d035b47962857ce82d40e713ed6e0b4e45580020867aa65d1e2d08b386929d0cd93d29796afacacdc98a8474df1a63539c19d56b9b4803e4434a63ce2f1c694794c91f0b5ec36b83d1c9f75447be543c6d5edac50c16828cc4d375864d97006a6fe18607bd865063ecb53184cbfe78a6f6f0c1f4753ae89377b04515ea8f7725f96117520b41c2ae084dbb46256bceeb71972c534a53d249e4cab40f4aeeb5aebb733ee400bc8c5f754667085ad8c31d920be8de69ca60fb646d57a3b538d9ab5d5ed25019ecdca7e2e97465f4391bd2dc53186cc8d9926b852506f5dfb49bdc283560d2f384d39b92599739dca4190ca6b332239f37664dc432e26f446f12c3ec0a7ad2e14bb67f2ba748189a62a9a2858157318f78175c4a5e703542a41c1cb58f5be89bfad69d72f774cfd34247c3a4f23ea314a5a382ec0c56fa6372719def60a0f2b89f0e5fe40fc7f3edf4ab3c2ecbd11725f9572e6497529b349e57e4304e0f26f820bdbaf090bd2204489ae23f9a135fac662ccdbcef1dbf463f29e25baa790924333dc381c2ce78c9a5d17dac30795f906ad33dbce0281779e4e626083dcf5f954e72246a30c23e50c1951bf86afa2e165872516802a8b3faf547d141cfb5547874f810cc39b4c405ea51a36acb936427617b31b9607d2de87236765c8eab93b631c0ef36784591f6d54d6a61a371780da8a301883e40750e9860c42d25f06f9fb426a593e0f07cf28a571921a4f32dd790fa52ce6aee455935527d5a3a54015843c50c1a726169ea6af7138904432c59faadf45f95fcfbca2b9933d8714b2646663047de50b133c2f01d9ac19c3bf7894c64f2bbfe6231573cc7b96934d0d8b5e18da7c1e5541a00e77fc905224ffa245a5cac6d375381f569c82d8c9e6ceda140ceb369efb5aadae07295ee63b8a80301712371692854a1178f4f888975403a6c343f935946ae346f9e904ea9d99f9ac13e94a0367ba6e9b945edb343691dc4685707b2422551b86bab68f9f0f6ea618300e5dd65d49f7574f5f8ee357b7bb46e7facccef9339323ba9b2791373ad18015e5266d68e09b9799eee0e5eaf308b7a01b2c6ee59e589935039897bfddb37fce424a02a8f930f62687c015fe1a3a5fd26562793b050745ff73b8f42282f5b5598e604a0cbf5b87ed1f8fc93d8ed19cf5276885570ff87ae2782c61e9684e52cb95485fc7a83d517ae19e728835b302c51f9881380adb9076bdac156b3263df12ef4c7f52a8fe8ba40b6c8b697290ed363d667b2fe61be7aed16f34af9f1d16fd5495552184b9aa5c9246862d88b1b53c60b78b1527452760b3d784473317f239fac24ac2debe4cf792e35fb18921a1cd0e3f895cdd7a76d9ca9228d9e8f3f6b8f240f8476fc101e71af19b1cbea83653f64c32e398df2b40777e8dab10456dfab588d4b6dfbc2dac3c46e6434ac972d577b25ee20dc9fd71ebb802a7837c1211b1668ca65fb2b2a77dd41c333ff3268b5a6254dc93eb9f977427d68be1163e80aa51cb99c028af74b1ac7fe8336aca07f30a67354b7616e3a2b88eba126d42dea3bbe9d8ad9be5ea2a9ba1509add0413d07b0b389ae177141d4fda23018b04c3c634fd018e1c79b5f6704b659df3972da9141b309b5e63a1823d536af95118369e5cae26e7ca94cf195d405a18f712c75667a929384673662b965450cc2f5733d83137034534f71d4848f64e6a37b4fe199d9a82e9b7117bbf81566c12e39bd7e6c85c2548a98704320a1b05417ad3486bfe09efdc74ba154015cf99b1b9be2d7c27679695a22889b82dc2d0ab1af394f9ef9b083f90d52ff77990c876d18382f6c9a7bd1ce12f3eea50a5e4cff9aa7407c6d971a5c58f4ea3dfc60e3dd661a7e33e47007d3fde69a8aa3c02f42f384ef1fdf6e16fc0c3e71ba09f9439814bc30e377dbbfa7820b75c3a123dee912cb6f01742ccf1badc4b0df42642b275ee8aee333ebfc8d21f87eaaba9ede297b8b746184d7edd2daabecc990a53a1abf05a58da9c47bca033f31aad013920ebd249a10dba050cb1adb2769b88c1304eaee97dbb10101edd82575e30ab9c0e5374f02400e275c0487cd5e19ff2fab3277ce9af8df8a860ddf6c326a9659147d130af89a3daa3f2812dc58377e474c9a1908391e874792a0f79f027a5b484412000c8051dfc2421e0d0a4c25cb770be7974f7673e13a74b94f56432cba8621b1560757882fc83456ecf2f46571d879bf103e29cb15ebe42dd2d112727399201d07c15100d92008bdd053eeb8701f1fd02a4091a7e835a9eaa23b299aefb4bf3c11bba18f84fb70d06aa6a1a5799c130fe9b084f0461dd2938d139031519ac79529e690001a3771cd48cdc1b0b865830daeb892e87067120d1f9da0f4146b7c06e0e9ff6a042e018f556b1a04a92a7221fca2d5fa33c2d3c3bf4ebc35f0be2470673b0c49fed159dc11e62b2cacce026497e61692513dd7b117ab7cb9747cce3a949fb5337152ff914072c785e59191c789bb87288e128a6eb20893465a01ebbff9ca7529350bdeaec43bb9354426e721b2ab081525c45f1a1d8c4a11e892dd0c6d7dd6075dd30960bc9b3a185a3eb4adf2e5770c99dcb141266088e4cf3a70624102c1d70dcda7165d7309ac5aab2b50215ebbdc5209e2d599a18cc161d60154255079006779849b568337cfe0b0230a9d0b74053cbf561a8032f2fde7874eab9dc186d013d1696de0216386f12cd15c24087a6cea913c957fa21f11a51702c061724b18b18eb439632c6001b95b8bcff3c230e443530e8bc3d38a124c29b349eef61ca9d3dea10afe35fd4a53bf98c548ad2209fb781e50af939404bf752b6f1202625580717616c4a4b9ea520345fa3a02a9df5578a6a40e748c4cf0487ae1e8780adb41c480fbfc81ff7d8fd6f6d442e870ee8e2ebfa341a355fea74f3ead7007b47bd5bfe7903c25138d9202dc5564086bba98df8fa1c0294ae73987dbd2f846cf0a16415355ac91895d755b4d492317427372ae0d3743affb45f33fbc1a4bbdba30c2fa4161cd60c4932c10e43ab13a62694dde2204329e45902cbbcc711b5acc24469444e335d1de8ad746f9574aa12e8e4d8f9cde8abff757010b3a9f103943c38f0b0cbfbb197a8831c42bc992ec9a9942d3b9c9079884d0716197f46638e9d8ad3de10f968f88592957e4267006f39ad0cf80e4359fea9ab7513ad4a52abb7da5a47da4343f21a1b046eaad305b326eb4b9ab55f64b461237ebf3ebc5ef47a9d6d2c650fb2c7dcaa897db3d30b0758903d79f1ec54553ac3e4ad757e48d39829ebdbb1307b318e2af0e03b4c695e6925f978373c246f6f33073f1f2565205ee593bb9c1cc9d5a7a79f7d8421caac14a838cabc26590641d281d7212ba7f05e8538250d476695da20fbdd3aeaa7732aeb7e2d05755875331ff5117780686d34821435b68ef44d9538fab3c27aaff22a9edf7d1b7a73aa3a3337e5b4b29c0c4ccf9dbddf73a649cf973472ee0372902e0480f37e7d837c9d94deda8c804f52b6dd6ef2e173dcfab92c25e65b5f7d22d9f1ab914b1362896beb594c4f156b8760971369ed3602f52abd59ae07a613e28c3d99e1ffb764d02d3145663e5aa55eb41ee665185cf2f85e81173b9b70b092a44da8461a68de2d9627e8fd70f5d8e5514f7c012d9e09a4a87ece33ef52c109ecff0ae280cb2ea75a44a44990b9296127500ca4d24851548e27b4a492174b6daab34cd167ff209cf7f722aeb26780e5a8a06ab0259cb508a33fe509998e7811e67976373f6ac7874b55d30c3817461b01f9c19b9899dabdd1ee7c249a55deb700284b9ec742e47ceffb288423e09a794ef7806c79d47ad72ebd9e45d4d8a13ff66c8ed315bff5b15817bd4612e513e6d28be97b7f176f3d0413acf1e49d95c854db0b3a8db05d1de4bc54ae6d6e9af984622005ecae3d8396ac1522ba477b98a454e50b986d3d021c360d357cde629bd843cfac37a995b4ef3c20b74e10611d891da059a0a13b4f28db4ee1696316192b42989b5357b0093810b7072ea5a49eabefdf86e5c4b54183514231b45b412b567e9b204b3e7c3bfe18b2f9b010521eb1879d14084e4be5ba6307ca0079ab33d844f4d4c327802018f9dea33c20c222b4b0bda6742cc3b62b8817a1ecd60706be68e93d92e17be750ec9a0b9787afbbbbf4dd799ebfbbb313319514d47252b961bf87c1dce1019e204af638531cd89c02b5a8e87b026c3c1a353b5fe790f9df9b46a01a09e0431c06f89e92c8124e9c385a6177319c6bcf062047a14a61a94273bc3f33de9879db8d45a4c0b30c57e9ed76b6c84769cd7af81e68bc40d31a155556c0acc2cf1c8062c6cb4b1bf8e4879b3113f40711a7c1d60ed8c038d1975c9a8fced23aa845a34e6bb8a3597542e48f67afcc155f928dfac51377b28d02707fe22fa6c00daa82f215bb1625fb77e5b62a2c4a63c62bd3815755e6b82a03043b78f91113e3dae1acc74c430a649f5c4cefea41cfb4954c3752d3db74baa85253866ef1f320ac926baefe40202ddda6bf2246fe9e595511f438a39b74e92a900f2f550151acf958c37d6e39bffea6c90670a2db41e154babf6e59c1d12a29692283869546fd526fbf126c2069a71de63d6188a7c0fd4eaddc2993ef23572ce1eea7ae6023f5a4d59c1458cb93e6f59051816778ae524f2cb9ea551df9f8d8fdd4620526a92a20e4495ffe095716621e7e9d67fbbe3336f86ef377665bc6c86a35c4f29243b3cd42b7a2277b7fc180b3ffec86caf5340cfff84efbcbbfe58c00c216e1553ae77762552baa1b749479c289dfcb582ba57e3195199861e4ead03bece966cc32fb828b18f679dbc56f96b7c08b4b0638751baf0032b24d9c69f3ef4a589e5d66c41fafa213f2a3166aa8a0e9352fa6948192a3a0213a041c8c7d7443ab91b61d82cdb690e0f53d4c80527819e87bf90c304af67639e0154a346493e6d94e2adbf82f05cde435aab1d2e72e56618a44c07ba05e37150ef2557ece78ea2fc55e56078592c8d32dd15f48b7c3868b344b65ec6e63c2490d52047a3519f01e34042d0c8544a5bc075ff3075fa61b59f17a00ed490df68bc93eccb8831f10f42c0899b4f8b1279469b0599f85e9e804c4b87b304ff2ed2f54f5a067870922ecfb5113926501f5818e1c737acc05fc30f590e42eabf714d523602bd227b05e8fdf2b13c1975c5f6f8395565f510345500a442648f50ce3e947b0a12116640b34892b325ed202fd37be9d25635e2d7b231dcdbd3f50c2b3db86e82b157c79681588d9e5c37cf060f1d41e4893638938b897604b2fc3b12fd08ff340e234dabe2d9623290be9f8e6addb813210a01e18d2e079739d4a954de5527b3702979dd8fc160e301419c9ac30da42c1713a79dad4a9dfd6a7e457f52ef0c151687dedae114364ee438b6039612948f8273007dfa132b5b8e630fed9d203465edddb127a87a30aa2df8b6da03081a6cce6f5bbd34e179e9fc39e781b4ddd390d93d9e0c9d161cc93679310da9f291fa74e55da33b27de931f0927a230d653428b2d0443440eb3c66a556bfc41226bc5e80852221cc0930484248fd1657db93e4f9097a1489d92a28aedb3c2235251485856356aa67193994b1d8f3cb12241cd5e3415d855ca8bd364af50dad43497f3119c8927df5f4a397915de9fcb5d7aa709c3eb3edb390b91dc9ac26294f433494203c2c1ba3b021e13a953c2dd19574b41697c7d57f6bce59e77b08d8fc98697f07a70d2a6321bb4de12d02f476c40dad94a4bdf37a55bbfbde7201b4b28dfa0b01b5fcc2223afe203f990d9cd4bda5f412cc34ba1fd538bdebb1cbe142ddeae339235e0247fa427a8b523b55a862f40a1fbe1929708776695bc8b63c9e1ca41a0e2317b5112fcf2b91ccfef6d9c5e3c99718d3ba55faf18566578e76f6c893a8249e2f80691e650f24613232a4e40689677bede88a3050d3e78b7624dc3ec7f692ffc24c3d29b1c3208e13b66717c679f28184f246ca7c11f5f06d4983cacd72bdc63d85a13afe069e199429fffe9928ee407ddc1b25078d4d1d92ab6dc8530d7ab9961a1db2c4ae601ba72bb4a67e6b03a38aca90f49d890cfb3e7af8221768757b389d7b63bac24fd30d161dd054b1fa81fd684a209432d5001c981403cfa616186fa06ca5734256c5d31fe270050a0e3d2c54884cba29acedc93ceaf9575f4602587527d0de371d679c65a4dd2dcc2f2c80734d3730121d36f173e04752859e1fe0afa37ec9c1c0fadcef3c095a07823148c2ea729e8a5e7184cc9a4a6e52fe115a13f5ee5bf8e6eb65a42fff23b5112b83a3b74640c5ffd2b9dac5135ce2c3f3ae97a35f9597ac00529f56e94e35057227e4c4dd07d20c0e969c18cf95b5de70a037b573424f3faef001c5e7a2615909cb4d85981031c702d4199f451c0ec167713d31afdcbe9b3801932d764e414b265d5235557febb42ac1d28aa7a6e85afb34df17d7b787891afa838cda1f51893e92375af198a8c539aae8cf6565df6eb2c5aa8fd7b7cc26fe345c288778115e00b6d17d10fc80a28ff694de8aaad53bf1631d62fe046e9af7311a06ce93946135fa02d5876a4e498fa85487e479291dfefb514730bfb7e51bf5a21dbcc8e9acb5f2f3c9ef065614d07629d956de750d718bf1fe079ceb33d69c27386390d55526756f222d23715f68fb257ca3d87476a0b72a5c0c1a6c68012aaf69cda5e1e31b00a772bcc3b42b196173e0c1605e12d6319d0dfc7e96e25ce695863aacb5666374a166205b07d8f2dc597c612b5d46b7795be3f639f925f95e56492c3f245e77355d663b5d6cf16f9b5a404d179d3ca539c90089e648d65a272495c4f311f696c0eddd3eaea9d0457e4799a2a0bf9d62f65272193a8c82eb810b1382697fdcabcac17bebc84e39af8038db274b0acf37eb15de71eed26d68f2a5c75db40153cb79e3c8b92b620701d62c6563df41f4219d23db95b9dec41aa4f5003e47a47a299b17df1fcaa5928a853240acb554e932ddf599161aca938db53b21e3bfc7efe6dba04deb1a9b8f1ca5943de2691c4fb9d74a2ea8069fe2d87dc42e2be8f70c47edace02942e9ee7ed9f41501c7d59fdb5b7955dc33d4845e1f6c7e12afdb3bc19a28d793c2804d43402d8da993e6a88ea83a8f93f28e6d47a76a5384462c9f69d12ddf35fe22427ce7b7b335886c7dbec348f042154acac265d0df294f9719f70eb6359a22875cf72143d98f626be39c8a6f68201b5daaaf10776f27a0cbf3c961fbdd87ff3e3340ca2491896ff25adba71633fdbfe63b1abd167d9ac9359584fdad16f33b585751c190533b0ae6633df076a722f79367adfe9d2086a3bc0eeb299057d2a1ffef3af0907d2ca90c91553d5edec9156c99ffe2d3ed0a052c293ebea6df41c23b80add41feaaea5a7584c3cec0af9aad855357ee8442d084a44c1748faf7a5150aeeb8a4fc769ffad5bf309d4f014202c4d7cf49d9605d9a8f41328a0b8a8c610d44b037b05614b8f13dbca7c2c1c921c9d0f5780d55ca48a38b678af21462812aa17a8abbf6bce20a2a7246f18992af3e7ce60b88aab055c8faf12eb66b5709af14fc9ffa5017ee198494c507a9619dbd374142dcee338a660616f3378261fb9f41204bb7d2595d007193ba043d18c3c79ee044cb346b2c0361addd67aa7f52e875b1cf9489db29a9b8a163bfb1f50222247072adcb5af0d4c43d114c72f2434a36958988654566b71f6a8ba8ecc623ecb563d18615b1f4f54dda7744d72e43b6ddb2edaea8125f4e45c88097fe8b2ec7bddeb14a4eb06d86dac75c130f027a92aed912a84d580126f22a2fc71a91daf421a2c7c5d9e3c3971df89c97b7df23ce7b166c88f3734efc214262af0476d004ad2fb31d62e0c9fc03cd2b2a53f4f31a25e0dfa81d3e89ed46544e584862b5e3a1b034cbd70336ef0c2e5071da0b5c68f573812156b0bee6a59fa6825f10a4e18434794474e75407e62a24d4ad344b7bb6afa3cc13309a156e8d48cd663eb0e50408baea3ea890d180c2bf3f02d708f5dde827989ce04a6d42a431a85440ce6e2c467e487fa65c6c229c99c08be711f4a655c3225d96dce58041ea89895c91abe2b5d2e176f16faf1cbdb3b604a4f5fd56e0969af816039333f6873ff1b4093901e4abb147025029274164a9c10fa885593c3ff4df047b6b22e9b315902bd2aca3fcedbe5d547418179f4e40cf70d10ac3519d1345e8cb7e3b7ee7c8aa5ccf1bf5595f9aa84ce4f2337dfe76f0c7eaa5aae81cc2999f34217eb4293c7aec08e6877ff1d6f1ba31672f24a4f9f4992a8d6f94f8624a643197b73a730b61205b69cff9e178f1968da9860be54eddda210b51e164a992b467efb087eb80b096f736d915679e5abf3bf5799e6e46a33b088ef4818d8a9b6f1149132667b9d5ccdab5cae06a17b32ba1e95e546f906a175e54f55457be67e709be7edfe342a2fa2fa0f3d71a84dd09ad80c7a27b5fe9c667e4f94e0c41c3dae8c50e97fc18c90331c11bcccc5c46d0b207583482f7b744c6b8d6c2d49896bc2fdd6dcd9e8c33b8983a49c561e7dd5a4646cf7783fac05ee5d5134038c1584a3e0c16dd60749fce9c71c31bd0d481a27d26f61240de2218667216ef9d5ab6e2c3bc0a6c87c55910325c3a8880377d189e68a510ebee85b2013327509f2e78b3f581da3ccc0e06a2ce0854b932627e8027b62dfbdad2657507228d688c3b4269905bcc24385fe3de47b3801de42e8e6acc65645d6fe350ec26e1ee6a103ee57b9a35e6c070cd218f4b60055958c64bf3d7de981d6d74986d3c198ad7ee85692f334034280a2ba54153a57b404269caaa44160572679bd0df8a7627bc39044e974be9fe6e78aa884660303ab4aa6a136f0c0ce11833b13f82d83b597d2ab62d2dbe9cf3bd61f8005c03919cdbab2ceb6b9c63fac35b61df89c0f1dd171e07231aec08e540d5ebd7d55523b5d5dd48a85643fca53a52f096e1b5545e098ba2408b8380807ff52a4b026325d11887cea7c8bddd7adefe59ecb3fba5a469cee05ce2584d95cc7b77046a79f4d7af51bf2fb9d9714c8714acfa5e89691f78a24785141fde75299edd6c3f0f4b2a265d0ebce850efe427c32b02bf87047ceebd13b1aa9b1b6ad7d5f5219ba75fa6f9aac72f820de3f8f5169bcf343679410e1027656dd5f74c6af4be37c3c67397c1785be68943e15862e36498e907e12949ae65e6778f96b280d56b5c5d07b45b8aae26933ad6fb3b67da683da2912c89e21f2aa8bdddfdcc1b56355564da74055f60ecaec86fb690317cf956376a059e7c1807af195b8219dcee3991f53d37560273883bdd5e560f51c7266ab849ac04ebe3feaf48cd4a3d811f02b77b4413907cf1a29a173f7cd112c3dccea69ab19dae2b529c9413a74351f2f604a0fad2ba5351cc5ead9421ef60c3d509890abdd28f145ed6277c3f09ea96b6beca1db233ec18241a65b98e5807faa0d10f7ac52e67d051fcef5c4eb729604a7d5c21d6045846cd88577d70b4ba5ba7c5b69e37da048c2b2cac5463de270ba3ceefbb8415c4afe4769fed74c40ff288630a18197aaf0dfa9802b97b83c67075aff4ac4ac6e3b07701bf6a3d3b1e141e54f9bd67c465d0b1e35c2b2f639bdf09c13f69886a9c8f49114b560f8bce46a1189b3fce76711d423187b02f9875827b6bd4e449ab38fbc87c01b9fd2ba5d39a0f0c17bf45868320eef17a6e42e8c6e71fd44c1ccc1c57528e8fe344507099728d88c6eea6fafb7e4d7be86fd9bb07f4b67af27d6fc760b4d6c218ae7f8ab4152f7fd04f1e3d0cb3457ab98e7efbfb585f708db8e4cdc6125da9dac10df99c9cbbf2df916e8f218748b8857ad00b784fbc4c1e3943edec74ad8dfcd3ff42091d2ab8086ff1073e1f981b85d3ddf5eae1b2aa282b94ddd067e3ff65d4a21d1324981cfd81981b2d6a41e2654cac0eef84d7c0d0b534a89dda634fbc8a0a4b16b24157a26760bfcffe0d5805ae99d2131951ea4355150f9bc57a6c44082e1fb9cea514ff2046a100a86950e14eaf66c7b6ed595af46fcf3e538a8eb1fd73a58799bb0186468d8c41b60ff37a8140a8726f39a256c5b02f7abeb98132969b6fe355c617db9f7fb478abe09b31f716178ece506a999ae3d13fe9d2d2bc09fe55bf5fe333b71327a6ac1065c4599b678ce5d0acd59082aa8281d0e3435c4403838f8c8392996cbcfeca054082844dba96f0b718613e6be032ca856b45d1104bf15b1ed69b3b1315dcb0d528f01d81edca3217fee17d05517a52d9701ae57cc02700f40128de77a79b92bd1deb293c2fef44751bd7de50d0d74cd13d5feffe598c908e64b5779f5fccfad66bcdd1608b962c396f320d6f414f18b885ab0f9d16903343aa268d731e6207bc5558ec891f1d5059e6658597a1fad1faf154ef539c78c9e78cc8ecdc9f181e8cc8e1a8a2021c8347b3ab88f4c6e73d7e787b345fd6f9ae889b7b848e8f10632809283174f8ecc990fae41f27bc2d1a875c783b54eb3a04d24a39245ac69590cef24ce47c0560639c57eda2669e29a7ddcfa45e66f1b8d6aceeecaeaf30bd4f8fb8f8620578bd0b6c42c75448a69fcb25226c80cda4642bc465104f87780dfa0d08428f021c00fd16cfb312fbdf9b3fcad73996a2e14a487424994b982ec5505eace65db735073f91125e0c8db1eb71a9484d70db40606a4df39d8a5bcdadfa2c22d5907bf1d1f7eb131ddc093cb09a6b64263e0d81884607ec869df21c2106d0f0b4cea90609a7b31277c6a0b6242fe6ea1a8ffd41db6ca0811e56a097bd2580aaa71ad5686e1e0f1652710eb4d54a5355fdc3c226dff8fce61c1888fd77cc82690da4f202356ccc54db92b1588d3d8b0d5a82f74c6cb66a30d780c0fe60193419b049f9d95d7b48aeaef2d7a73f219bf9939923f6168ae58caa1b42510eb72c43e5a93716c894729b1dad5d6736fbfed45b456a79a8e2637587f8bae7240891aabb38d280bc795f277052a39766ac058267eef123c89b017868f986f425fe73667b6ae9902415e6e18077b34dd4ecafb56325e92f99c95c5ce178a394495fed309ce1837bf9f8328d825ea60df9f153fe605d37be1afb2f73ab5e6e5ce92703f02b4aa514ff30d3face9079faaf33453b612e7dd599e19e0d9a6b06e06c9175d55e3ef9cc9b2502e8f53278b0e06981f7072ec77e9905e0b188c062d000a9b580dc7e6ada36d72db7cda70d44228d2b9c64abcfecb9cb3141dbde1ee98a64dfb9cef30e5236a862777869b7d5fd9fd28ade336a9e36ae3128f520faf84939ef5d614cc562736408fe2d94fef1d350b91676d01ecdc469a1cd62f359b4a84309989be38518cabe1c8e11f5d1d3fbf0b57a7633b65ead018995550c7436fba399169bda060aa89c01c1eb1a8145a3b86352584d89b44d584b09a311a8d62aa517ceefb6454ce5e37d4f1f35a4dfbf92f7f0ed1057e418a275ecf79efafa920125916ba356dc21938446d646d0fdac360a61f5de95bffe1d7110c40ab7e9243f79ae1606a4c1362ddd983b54cd345eeeee03ef9111547e625ad6be2f0c3646bb70a74dea46669093406a4dfb0445f25e3a1d1404cd02dcd1622b726be38df7968768b47d36d50e66ab0b4fa214b5617be8269d9671bc6ad2b081371d5756c46a92d32bf7c17fc9b14135f8626fe9c394e238d042cbdf67a7a4f4e8bde4acc61a52d3c18c7db6d0acacaa66f754f4444fd70fd9be5781c801da8aef6e5acbe198e221f2a02cac1b7f5c631ec63be97ada4712072ec004455ff651ad0d76ff97a7c1f82f25665c3539654f14695e887b8d7f69f08217d18bcb9a1afd62d70166e11e88fa20d88491fe4cbb0ebaccfed764a752a27779feb44635cd638fd42305fa1ca4c0d9105c675c9b1b1fd747ffc1009f34664fcd90d78607c2f6f7e36ceea3fc06e56dff902cddc404300faa8d7b49270b45f66c45e86315872f9cd06af55e0bbf4a933ab2e5b060d3e4029153ac4d8c5076f0172cd1bc9d0231d874d784b8c096561698e923a16b379f6388a53ddc468287d8765ff4fe898b3999f88264e3afa3a3a26ca7a145ef3fc35848b93b26a8a218d906ff834cf8d76a4ce2fe553bd799ddf28c4b482fbbc295deb0fb1e4389a9ae57fc28dd35124088627c2a30be9e4a48e9e2688a8553e36f222d48d1fb05475597eaae6da401fd74916af8d32d2971fc97640adf0be3fe3e45b4e239287809e7f26a310cd27d2d4f3a5bbd51f0ad3d3206741ec3ed7e689fe5ebe52da4537953da0c954704df6a9873209f3d8d389d0f5e0ca3bab26ed9c9e2779034a65fc9e0a3ef23df103fdec9eebc6e3a1cee137b1274739f3396e14a72c846bfe94f2718ccb2bc3465fb1881fcbf3213f34a963543ae45006d86a66389f24b0a9512bb4706351fd56c54a9256adf7ccde4d190ac264775831cf84fec7e8db5dc01e4044dfa5b4860f67979a0b3b5a83accd04e75398b69d74512d816ef050ef38708da1544dfaa5d6c0adc183881ad5d87ca27022a5393b950f41111f3d263a1d2b037ca594ea66482e3339a4de3c7b18f421b27e9da5c850071a179ab9bbbb84ddf61ff824f80f775bd36344f1b462c96d2c3688022b48e7072a54a85872c65b455cd02cf3adca6268c0fd5e87a505e87d57fa891bef5e10290baef35e7a6c82938e34146893bad41aaade00367cc2de1ec22f026f6f56867748668056466b178d67f0cecb9d7a25165ce98f7939ebf4d6445784b914e0f70915a4dbb0e64b629ceabe178de1c0342f34f489569ae27bcb32044df1d1a0c1e5a17e795865cf5c00d0fa5b9c0a2b28d5428a61efe294624c19f52666bc02edf5aed4ecea41194b636f3dcbb69f609f1ee819e60db8140348a6a9b18dd3b4778145797f2e699c8a12a89f40a0ea2cdeff3aae3ffa7cdb49ae383a29a42971bd38a2d124b1cd06ad1e67970d21b0391aa3ab190ddb4979f03ccdac73582bd04043cf69f924ca4d604e9329895d41669088f76c7584e1214a4883f39d0bdb886b80b4f34a3c2ba4b094af2cc672dabd6a4cade390a0f87d3ca2304a58ad0f7b908bed6577a7b86582d9326d002bbc3aabba4a1a927fb09da7d748b8219ba2662fe47a19cc7d83cb6b903da69cbe53b774584805f3e6e63e2446fed53368e3eb700c36db0b5d7679216ac5f22e1249addd65e111b6966a344b76a5ce937c6646b716b74caffac78252b652df582b07cb26937846d08b6b846917500d36d935d850668c20b4e4de0390a926cfec20af51036046cedd6c6e78505ea10075c7738bf43193955786dbea06e7fa71f8e96195c6a6f350c44f352e660e474191f0523dfb6a09206c40e68fe21f517787a90b0eec15292a47b25e30f037386c52840cf76676e5c4b0467150895ba2f01fdec1a54a4b46e54d0d72d8d0ab84489257291ee71ce9f8a490f7cded38c99ea71d4b9dbe158fcca308d8fba5b48539b24ab568038ca26bfa6c7a90a54767d317b8348b2719609c19410c4f0e09231a75e88c9cf10b928ed76f66cc297ff86d6bf80f44af40e46b6b6509a6a61db4f941089a3d4413608b1fc5f906ab24d82988c9b4e0d9b39ca83f28f206b88d4a5c4e86c66e67bd7c9655a376b53d7c8f14ea24d4a28502f1bee0ee38dfd7e966b31818920baf0b2ce90d62771a913985a9e588f6b3ac602ce6929cae3e46b92dfa70d8bff808e19817b46392bbff80c4691657ba9b7775baf63e24a37c125a9dfd01ab20ed89bbd74e50d65c783d59ff5b42de53c491f4f3819feaa653434d301347b0c79f6da05a7b1d31d3723776c38d85e387b8e10dad02724c8a644b8a5abda8cd11802f205bb4f26566a2fbcfcd6e03f6c7c7946a142869d2b0229706ed82ce250f138181014d9594533c1d89b34dad2e3ae163e9f6f597a4dd2d63139b9f0fd31fe8ea2f9ec1d0a09ca08ade0b24badf1fb1ecbb2af8bb1b65afdf8fbe3d45ece824cfad2c1a93073ef2978cab571bda433750e1a2d62bc7c76925ae916659891b9e864f6f35007be1600f4f39a04580c41744bf6a67ce703528e6eda99d5909ab9e4fa86c4cd65873f2cdecc1b9b22b7c8c3d88e1b6dbd75ced76db2abf1495040593a0b460f3b134a895803479b39c5a5cf3301349bd028143845f411e2f2a6a96743c60867c00a7108e760221cf7921c5979ea548eeca30040f0c8f8cf7a575ec7aa8ffd54d9e6f2c0c56343ecd6b9db684564ff0a8a049ca926c4254e2ca4bcddfed008a547332ff01ebed021a1bb8501d3f9997e0c48c42fc1428bda14c5897e3f9edd02885a0df5b51f7ff7abb6b984d99cd4626be326cc9a22d37286fb5918b8f78306178ade19bf102e20eb97739e387e2cc7f3279584f61ee648337dce96fb9459519669feb3541b37d4bda65b0320991fa3324175dda1d328db2dd88a2538618f5ee7cb4df48e8cc21aa73dcb3ecae90bc96b1aa8bc491b5b56e8650c8b37fd348b1b90d44a2af707e51682f5051b5b39ecd0bfb55f72d8de18e08406b11a9d09a95d103c51c70136700c42f43c45e786da7838d96b97948ce1295715b87242136b838460efe5964e111e5f8b157463f55deaa8d1720f8efffbece83505c49e21f9bbb08826032b894fcc7915c408d008d2dc348fe9a366e7dc23af162fa2a08cd4f24a8fcf243ac39884f1b6ef5c3fd7e3f631f0be1632f57cc43ea1c9df70b583e03fa0436ba1095d7b8cdd03622ec48457ac0da0e491bf33bc3f8675ba0aa00d3f1b60bb70f94b8662479904c0ca99c008dad0d14dabe8e01cd240b636955e276c50f342535ed27d16f38e61aa22c373cde423d9d4cd3b37ec9788d113ff29913992e464213415df212f5aa31a820ddfa34c9534394c7329e9b130e6d923451a995e66920fcab74c5b46e8b9b9ea37c005c899c2a4a68965312d50ffce2d66a3c24dd247b638ae3c3ccc6464748f3cabdda1c0e09155b0a63d3d6bf7854d15a4365f91c8251f7572ba4f8eb9fdb3a4c3db5b04c759c9c19f3676402d7dd50b59dd4c353582d452c9e746203ad7619e091141517b45cdcec5c8780f4ee9ce8b9e30fcdfebf7b7ad236af9fc928c1765a6b131af8dea787d500e5f6d4574c320f489e68ec9f209fb7326188014b518560ec7e238994ce48331705c894831abc5f08081115ca1e0df09f27ca7c6ec1c475414ebd3355d63d3c821032690a0d90ed23152db8e423733559304b46401fe314d5de1dd1723a033d40153ff1d6b701e9d31a321c6d70666e30e51462a63fdc31597827cfa11e8016d5411972a15e21a127d7de482eaa79014117b67bf03abb91ef010decf8d4dfcf27dcf33eba563a6168fd494f5e4c7f0a43965241b4d92d265690db600da44df40516eb570b18c3c38b3d4f113cee589f3b5162af5eef0bf91a528ed0c0e6fc294205edeaa5a834c736925bc1af059a94e44c7fd40968cf0163feb6a10f2286ce4fae96574decda02654eb9328b30ca517e453c50126b88513ca68f7f14f6000242ac8093af66ca0bee39b2262a889c3c5ae341c9cda62bf1f58dceaf10625cd5ec89c46292e676c0d98416c67e0a6b50a9c30f44e68f64bf0f8ec4586078b0a47fd3a7bb142854208883407cf991d46e1f9bfaaf6c31202b33fc7d4db0d7dab8ed00b6fadc71059b3d1c08c7368615f15e5a1fee4a80c7a780988bd8602e2341f8ed71a32ccea842107da6ff2509cc27b92b88959a52b7048358594d5280f64dcb5f2ece586df98beb97ebc80f6709efa80877281196c9d0845960c74d35cff7293a93333166e70fc729ac76705c685b1e32fb4e8cd25ab2dd9a5ae9d133b65ee9ca19d63958b8b3984bfc354d6500c141f23dfc9fc6e047bdd3f3f9673ce4f0d8163742c980cff32ca8f43c790052522a8f77ac4f0c8a95e1e8ae63d3d2f864ea2edc6ccdce2c81601ba158f9358b0abd6536c2be224bc6bf587498ed2d915397d8d6665e7b7bea12c718909467c34f8f21937f32f394dcacb53c4dcf11c9eae292015b6b54577c5efc99c57f1ca1390827c5ad94f8c87e9637a28db4efa755d2d52146710dd066d8ee3e424461f5736be19deca57e6dca66a9b69bb34c939b590709b78ae698aa563147c83a9da2ed99374b0243cd0eae0cd5ba586cf6461c87b6ad88a17491d45880609a011aa535f375b30ae1a44df51029028a21dbea82bc25bf654f3e60a69053f319b2b267c578629c0660af0e5737df6d034d0e3917f16a5dffd60344ad9539f1c1d6dc122b09cc2bf808de1423a99337d529aa31e83cb3286cb4ed26f1cd13d5f384fbae09712e2e3e7661e03216283f28654f2a0ce6f3e8f4662449321c30b937858b59a976e12bd6631633fc64887058f72207aa0165bb7ab2f0b7990fe8c3a20a9c289e2ebb588b3effbda400374437ffddaf8a1faf88c325993f2c5f9a0e9a105ae653bcd99d15e4d51462b79d3925701680eb945028004fcde2408b99e5686fe7dd582cd10b2eb4d1da585e2aa8955a45516d7126552759c0566f3a33397f15687072db13cfaed20160584935c4d965624f29756f6fad974ff512a15b244e4317b7c05b0edbc8f068d40f771a3f877d7fbf8a320ac6755b69314784b15b138c4a659322e24c1f2c9b3e870770d4488952a29c155d7323853308acfdced41ad97492edebdd4cc6eccad88f4d3efa4a9c447126b3d57db685625eb400f17017be06a047808da6439cf9bbd51b6f8f16fdfa341c96db172eefcb4018282919c112c821b2427adc971b02f6036a3bebb23e2efa5f9fa21dacc684ceefb30dfb917f14bc26dad564a0805ea4827318a1f3970ada8efd9fd7215883fc978a1d1db0f359293cb9fb7a77179d3d9540494f232626ed548193292e473e0ff6f8e91f7aced8bf7b8826747155c1720f25b2a841fab4951f27f4fbb8e8b8973a4fe8a97bb6102e2ae955229c5e8e6b5342e536dac22c78618752c60059e429550b0e01d53618761d179471d001e4714e01094467b9f6517d2fc7f1e477cd3aa57b8e319e3a6923c4f6ea34a856b2386f42a0cb2150297ebe46b1d94baff24b10981276a0d7e6302dbb5937ed595b5c3d309143af31aeb4196ce6cf6e0659d2b70e504efb81fc9cc24e81a6eae0d69a42d4033a4d537f459294015bc524fd00175e43d9b780ad530056b5bf99083c5e3c6ac0df6a7931a07173e5aecd6e2d17b31b7fb8c1e125876b641e5299c31c82528c051e4c96e8cd6cd46a0c54554e320655d4e0069605f10096fa57bf407ca2386bd3e8ef2ff16ce38a310e1757e7ad2a1481650a1d0a8be1fc36b34bd3ec93861343695b7f1b7096fe6f5822ffa40bb4e33fc9490f3b105e0899afe153ed6b93d9f118d13ddd27ca454da5bd97b6a43c7d435e2598bb09ff28ac529a497042da5036a4d1948173dc8c9cc517f0ecd58c9a0df53d1c106149137c726a523ff157127be8a737885fbe45eb831678f189ac1a58baa152857ea526c4c34effe9751fec3f915de2c1f6ebbad0bf7df6ef8ad9c261f5bcd3390dadbe8299babb0e4a24cb5bc8ad4fbfaf973639efdd620d790b2acaf42ed7d1ab2f118f88c8ce3d675f41826e6b37c38ed642b6c9eaab8e28077537e526d30264a25642d7f5511eb78013c01117b1e78d5a4d30581ca13fac469b03dd363afdbda3791f609987a6c88816a1fbf594ff2b3d6c0f3d7ed02f0efe8aed635065bc535aa2dbe5663e494d08c8ac7c473be9292f25f3f3bcf901aab3255cf0d99955a14f501a9ddcfe6b6549ca3c79fe60bedab8e15c025397f51edb93af2a79da3eaccb203933c6f2a276291dbd650ea9de74adeadb16d3c4eef545ba4285e49099d3c1705a1a8d3c08abd1415ea3bd69bebdce8a0e734b5c3e6474c883060f8eabe90d620ff23888f76ba3d86d8354f922e9212b8305ac230152f46f254512549684ac7b329a7cf6908f0eed8bef5b28484a440e7957b2020c8a14460ca93d05938232ed383932e67ec7c2c5ac38aa1e2eaee945c3880a39fa5b9f25a7f7b928d5ea19aed573989ceaf17479e8b89dbf5bf40070890d028d32132a8c02d633053f9aa8881b6dbb99547309c9b25a90f8ce8cc850448ed8c19e954c94bb0c8a0131d6cc201735291357dae79e6b174bc6e06685ca8260bf1a7524bf8f34f16be4a8cc32d90ec82bbbc5a27efc57ce59e8d0f7a25c9b12b55bb8018b82368083aa31c1436716914af8e34fc06b3af149e500f17a819b5f39db23f269554f9bc9cdded6ff5fcef77f31a027e2cc6d6095c39a6472d0a789755c819b08cd14ca45b8a16ceb68a2a59a39391faa7281b94aecbfb1e27ce7e62f84f65571e742e50e96daf083de2a7a4021c2df71c92dab8fa74c05fc50f1678f50721d9f1a35bab6ac1ba240989ffe896239cb95357faef35de7057d72a429450368dac1878b0ad8509810b5434093ddc78490444c4444c950d6100c5a77e17e97c041bd06c5d4c810e7e940418f60c25f08a8c814dad91ad7e8c6af84147ccd5847324c8701a593d0b3743cab3a50eafb15ee9051d0c7e24670747fb2b0d96e6e0c36488acabb91bbb48c0c81dd8cdd3b5728f082d22770b70f04dfee43942183d7a92093253396f1c11d56aea3786666245a418679002962cafed850b2adffec3b967c098c43af3dbf4fccb685477232fbe66ad2d9f5aa8346c0b8d1c3d6f1c0382f91ea121451148d201f649218912b479b5304b412dea7f0ac7ad6018b3ff84f4f3e95aa3903595b07f45a529b1f04410a2bb920b1dcdf75518fd2365f79496eec304c53ac7c6fd8ff4e2aeb0e05a869fa4add3f7e3057b8d6a67192d3ca0ffcb14c1ef7abb9f368aae7b73575ff3dd804e596c4aaaa6a3058780cb2ec20b615aa6c427e23323dfabe8d5292a74656cb5888956d86f35f26cd344853c80bfb52822a70c80becc82297c6d5abeaf98c759452fb2bb4a341b542e9052d76f45691b5ac16dbbc3fd93378583f3bc361b08955ba94a70f36e9c3b70a763108909655f8375ac679836c4ea49abf90cad45fee14b12e5fdfe72077d5d269167f044a17ab06a728c9c0ed3926356ef24ce7e948fabbf4779d4e643c479dc0011d188ad94889847386422fb53a46f71463bf731ea4871f97ad049646f4a1d1621a1e19e61dbc460592c3eca6e21e593b9b64d9ced6de5738d241f9fa0d26f6c8167af1423c89823feb01c5c65707d472362fec341f3ca3898075d5526bc9c70ceb49a3840757266dbd6d74bc9798a314a544bdb638b504311d62823e8c71894d351a988016e478b3eebcaf51173e609c6db63e899c312d8b05b79383725e0658bc35803386cdab962717d06192dea046d92b9f43ded7c83330fdc747e3dd6d206cf166df5e3fc2c6235438b22c1b98675d4e3dacbf69a9cd2ea5e36f8b38a216eadb4f0bc18b205f381164297d16d48fe533563b34b35daf946a13fe43e8b4229ad795dfb5f041a823a5ff01eb6098a01537751aa59e3669e3febf5ae208e383831ec3fb8495efa03afa9bb427289ac075fd8491cfd0f63f1b5f458906a2369d15499778c74563bf18437fbeed420cf6a9425173f759d4cc6d042ad062a0fac18954e3d29d397cd66cae1f6775d32eafa87fad41e00af6842dfe6d2048868db719cb4adaae79da192d81b3fe879287743d9d262080478502e77cb07e98d82c977e9f861412ff6f3596c139366a18d89516e0fd660d3ebcc5d7378d5bfd1c3507fcd40ef4cacef9320b9cbeda576cf1969a5f38ffade49bd5501f7bf16e0396d11edeef154a3e35fdf2699020fe079c02f7cb327d1ed9252d7a32ecc044cedb4436cd2f9807a6974e78ab33d402610bff8c591d08a28189f5adbad5370bbcc463e7a3390700450c94a85d1d30614ecaebad265ab4cb4de42dae3b875213cd6acfa9342f6695624af99fe70d2f29ec9642c7060a147cb7dff092b114d77f1146daf85457853fb8a9dcdb3e3d8946081fee122ca7e70b18aebc5efea75c4ed5b6379c695f076c07475dd86f965a59bc57a9f4f64725255e804a6ff0547059af72225136faae7049cd581dffe5044d21bc4fcc2faf8610aa1a1aa3520c3023d1f83c33782a804b5805a5e84819091c113e4369edf39e6dffc4192aa535a8edb59e5795d6dd157752c45314ccdcc94b4f76827a77cccbeb04eb927197b2bef6e170a0f94fefa120292f7f9e88743d95f10de04a6debf4e48e49864c3bb745a959345c00a550035a41ef7ee81399a9ac3801fbeecadb943b9eb20c23ee56543970d49af65f81e83d2e2732ce6915565a91bbe20eba4e081863605b017678e326216838d7b597f1b17a888a9d66b224b3b486fe8f8a0583a4edda62b70f4472b244214dd0e535be0bf92d21ccdf5248b6ab7ca5418a61576b03362fdb41f72640b81ca2a628d6e76843ce1fa841d8d54a7358ea3c0c78230fa8075452a3a38f84b683a894dd218e57748a0fe6087e758a071d86b1fd2eb828fb55ad983e4e0c23b9c3c691f15eb2d2b2456bfc4c33458cd5bd2ad4f8d6c167e130713525b0a9e6f05153720f0af6a78d8aa7d700a0e88621067e8eeae374fb020d770e969b9e35af33dcf26692f396d01f383f998215f0adc4177ddbf7352574d809871e1a7f0f39364403d5841075f9ab7080eafb41f65462f106b19f01777fdd4e6173071088e89580cb2052e966188e6e97dbdfdfc900172a6f9059c876b76063cfa56010f43e9d7309e00922e36ff1f1a37896ef7373aa74a9164cff989d995b25334cfe1b6a5561a2eb6ee3d302e6f1f8e4fa1ee1fc376d7b50ebf914121e60a7c6a7327009fdcf21185dcab7530c2b381448506780bb79649af1404a4ebad6c664112c251ceda748e2a3cf38449ca59c8aba3482cefc8a481939bc829a436bbe10574be3cbcea7ce9a99495255ea9837cc530d59fbb499903de2ba86176c68a209fd202ad5f19350eb5c417ac95068d92dfca579d56f358f4f7e1277dd05952cdf9a10595e1c2a99a8731d276799f689ae1dfbadc4d0834787ab6e1ebff34413aaeca0d949a35a1296e3015a62fbdb898bff9d245ecb50c06bea9c81fcf5d3b6e70d17bea6672b8aacf0002b6445f90a5a35fdc10aaf112814e46d4cf5c68d1b5f1d40561d8be530a0081196b9da45e3535fd7b0ca8621c109184a2e26db6f843a02929282b6be4136ae93dfe956818f786df460a86324723d2f1beff19c9165604d665aa51737f17647e45742844df7df1ed666b6cef45f4524b05513d2d309ce5ca686946ef57335abf9c67ae064f0b870e378163a0874ad3cf3896851556fcf04e1f37862c76e4006ce08109f47d2a534949728268842c807d5dfd269ad43c25d8e04c689f93087ec5b046680186dff9c45e15bd610e80f900ab13b79a92e788d231e6856a4729b94ad3e39cf6c29eb0458e92a596a4310b159e36ef35a00e10ece7f7ffeaa4ac17ee9a654122582acb9b3f81d9204887a98557461b117e1bcd84810f60273eaabed4aafa9e61fc5823d730e6a1a54adbd8a61f28914fe4036a22eb6dceef6d36b20d6a2efda8927e3a05fded211d1d5694428fa2860f2560c0a6bd80b08e8e1662517eac69a0a969173ef29fafa276d0399abd63c1a9fbeeb4b17ca759d89084368142257561c7538414f7b38c2dd36da7df06a23bc1567cea4255753368bae04734d405835c479fb72791f1db443a48677c7f456548aeb1288f5499714d7749136ab986056e912757a65bcdf5ada749519ac786c6571895059acf8d9cbcd2703c582dd73be3c5f48c26acc7cd51cb8abaade74eb2a2e5e0f7aadc29b518b327b1d069b2414b9c8e31964314237fe4594fb555a813be92b4a333c274dbe47273abc9567f061d8683ddf090b21e8d250e9a626934d0a4582fe524f99f72a318e41f5a8824cb25c96785e63288282968d935f50c1155f6ff1425eedaa01b9e342616f6b7659a99bb100b642b2e25d5aaa4fc49aef2ba8f0adcf3a57c8d168c78408eb11573a7d2a4edef1bae3d76b634b40a920cede6ac4c1c523b231b0be0af6928589a129300d4dd119fd71b40765932dbfc2c3857f47313c9dc13e4616f85e867de4981904b21f16d09436c887fbc808fc1fd50f32604ca7c33bc236cc581d11f8d84f33fb613b1f9f123ce8e83ba4afe0d5ebf4d4bf15e246a8bd0c514889eea0c696ad3757d7a5d9d7078cac3e5c54adeec12e58297dbdeca62f5e62e8221be70e3b139ad82d226c01a93dfc03e28f9a5ab75059d767cfef30d6f011275e8baa6f1a32a9f63f5bc6b083bc78ddf6c7cc46a558989940ec7db09cda0ba16c6a6ebb16b1cda239020bf69d5ba602cd5b9056678b52f749822c724f35dbc7ce68ca3b786e4a3ae6b842690e62d4ce834c9b3eac1cddd301595c336c8d04b2e82e137686037a8959927223c92011a91f002b028d5faf4608ec49f972e1360ad4eaed4f6ef948130493e3e6af42f51e7d05174a5a32e6faaa6c912340bccf8ad052ebae4f0a3e7efcbed2da57e4d9866ef806122032b3d03f55f31cc0e665f898b2c6adbe29bf53dbade4af5a23ca5a11f3d252b6f42991419211f3dbf9f997286bed74f6f641976d60678870461c4c6f3e16f92a5fa5a308ff3a861b22779b0b85d963d8a0c009aee065011bffd27d073d98ade66f1e04df0a14fe028a73fc3ac858b9baf8c2078c4249a4e2e3d7930c728322b78b7bf8088eade0f113bf658089314ee73598388116389909ee8d07318a8395e5dd544c730430290fc8e4be0eb3744810cc8e3d6848c77ac4052aea8dfbd6ebb0dcc0638ce869e84d759472ebef29fe5b4abc0f146f2786ea485f756f5d29402be78769c7a264bc32291dc2ce3bca938032d57e72ea76f31889c4ada549a0a09454aaf375996578f0f87518db600f1b93280025b76b7b3c5efc7ff4bef946ea662abbf47c1e893eac1d30b6edcabb5c9b4061de6e75b2723a9e99a8ffa602394ce471e5783467e9152eca9b0de1034a69a4d2960cf9db27161d2ab0f0f960684881761e06e0548d7cd20fd3b503137be2965ab3b0fc694d8584585b1e7c694b9020ef83f78ef62a2aa8b35548195c73fa58f8ea0aa1b8c5c894529afd003e8841c19f0188df8382310152547b4c3aa1c6ab162aaca30314ecac5d5f03f21fe189b95740705d76c024166258b2e1265abfd73b4f38791cfd0dc25bee498a8b547e093fd10808ecaf1ada9de87d71499e74af9e7fb666d28843199348ef3e75b7344cb97345b85fe06db9f7d05938e633ccf6f5dfc6c4bf82c5ccde8478eba0c1e6d38ac3b73d252710127f3f4bb57ffb7aac1a443e120e215856f37c57232f270b1540c4759685b3740811ce11ad535b0eb343944f189130660466adec8a7bdfe28565c6f163bfd698cd4f4d50b6f3f2cea6358c9764c1424b12fa3bf628b3e751c07eb6fd63fd4eb61440128081a4a6600e9a888c9d0bd5ea7c7b936d43a0ec51e5ce6e156673abac5be58604996751e9e7c4b859ded1ef4ac36379df37d43c2e5626c9a803c744995272b7c8d00a34124877ff5095a08ea9156d4949c46f144f58316f9be3c440e16303fe09b2bfb0e8660444a0c4f61c3282a5c7697219cbf1c93940e648167e7b8f21091195008c0272894d70f2692c84549dcf774f7a9f38ab6faa568a4be6dbc4dad97334e8d4acfd73ec623f553e525621ca878fab483363660bb943415b4bdec7cd3c876666a77263733595f6872567e83701ab18c39e30337471a3e7cc7570f138b56d4f1c71f48462def4ce245d56990b062347d4ad3b076685e7fd379c1259e88d6eb1297e24e232a9ce1495d6fd223df335fdf70cf6d9c7f7b8aff294686f9edfee35689f72eac1d0c57c63232a681cec81e9879d4a23be02590f2b4b10d8e764f40c7c9dbe222f45af31461fb2b6984f5454fef8e6be201ceb3c465249f244a695c563a935ecdb1eab881dd3e1c866320f1c2741db5525badca9dbfd798334e6ff33bb873df40583fdbb4c21427edb0bd97d4cd8b69b24e4e89bf3527c97db1f1cc649ce2714432e33bb1966e6836675ccdfc9d06fbadbef391d5ad8532ff94234018c00ffe079d891d280a4f84eecfc4d6c457174507c6eef8e34deecae4c123c151ab40b851a962d807bace0e923af04c4cae0afe462e266a78a067aec29f8c2adb6e5eb8630b1a523153247c4710021d4937f8fd54f1d3b4e36369fee11440bafe5601dc5ba8803e188f50a995e153aa1a4a4ec8853186453595296743aec059bc2f683a23207e156eb3898bcb8e58ec11be8b601114631c2badac7ca8505c5c1167fca5f135099c221fc9d60b7c6e5f49bc8c524f047fb6924a5f6847e73097805eef4de72887b1be283d80ba0d743516d99bf363deb433cbec5c0b24f70b185635f263d1df6cc68a621fb5098f08c147eebd8c0100d9e35bc74a9de8a2568a57769ef8fb52eb117e26aa3c7815d14b7477c46434bfbca3ffdf5c1819ecd9f01a5bc0aa581537c2a50c185a4a37b7c0400f3be40659f8d465d6dc0ef7bd07fd87f6620984bb76525f07ed9ed2ff5eca5c5eb65f2890fa018837c10aa32b5fef3359cee9ab0113e55ac33a8ff06158693564ebca86dc212512828952d62c8d1d988ee43b995be9e2b18ef140309bd4d5d44baaa52a6f5cd32f7efede2dc14371899cc655988ee28ea07964b1b04c5eb3bcc226dda9f3e53c524b0de2aa05301a9334b7615cf3339f741ebbff93dddeedfb32647823fff0f70b8eeb5e4e927ad1d8acd465cbd565b9d3fdc81f22cb42b1eb5f3a60762903aed51e1f8a7c39f08fc69eaee1ed946f1c6cd8ff2c0769ba636ff40a416e0eb0a2d08b42479eee2f08281979fe21275cdb647af3bb5d53a92ded16358c31a36e47853397e084fe56c4976b91f2beff6f107231201061013ebe0db1f16f2daf80bb0e282688d2449a1c96e3530fc6381c7f128a3e767a02ab17c6b9efb73b6c61470014a29c05af90743d9d5d16cb7994b0f63533ca6ddcb09654b4266feb09c6ee240593e20c998d279e0ae06369b45a77f7219b87cd5ddde88a55aeae1a06eff86073b19b19646aa676dc02c4b50f3d40f2a85a0d2b056ddfaee01ccb809d6576d2b5333c1c157fdbf8cbc7bedfaccaaa4eb5b9885f1a099a9d37938a5ac36d683dd92ca3858cbea823f0209518270c5c806d3cfdecd098a17f93496f6e5ce7f1afd7ab0346f1132ab871d10d218913cc3e07c4bfac54ad8c7e91bb8c13e620cc3c8a85dd798f914fe38dcd67a6211707fe43a9ae439cc670462c7a0f86f57b7543cea463c96c713aa2e82f4eef34b95eae32499c7355e4e5b69ba36c9b53e5ef76851ffecee7a215454242825b2ade10fa449c9979c26487926ccecb789c374752b1642b4a7b1a65572a29b1b422c3590c31f9ce5f8031b786509861b0051af50c543d7113d46a45b4198918b8e172eddf1512b70eedfef16ffa7e880f5ccc60694aa20a52eb898264d4bdb3852d012c36cc191ba3a6f6278912579c8dede833a82fd625b81dbed824d74b26b03712f9bcf53a65e94cc4a90bc1f741f117d209dee8432e6e102e9946c5633079564073a18a97c5821e3ec06bfa2ed04f61c970f771c8a08ffb4f52e0513537ae6a3867c9c4ec2ce059d57fa6d463c1bbe0c5a772c99aa9f4ababccb8bfdfef7664f1b37b29eb0b0767e18af7dcc44d15d15e9630fb7d28b5534cac87627c01472311ca8509fc1d4470300f7a1d82eeb720fa9ad6f2b401fc428ec15e4cf02f9d699bfa3e22efc0a7257ab6c871128840f8a51186e2a6079f40f1b885bd4c69257ce724782eb8f17cef1289f20fc690337a5a3fca61b928ac3cc46704293576a820ec2c19b96c16c7f8520925d95e4da65671ad1c494669451e87aee8d76e3f6275131a7fb419de9953087862559a0766f9f9fadb462a46a57cfb730fdbf3dc249c585895d9996020d2139733d52e3c928975822532b331e1e1af17aa8c7802993761f370ca9be9d83a5cc466c384ef19a7b00f15879cc3696033b7a04c3f3dd29bf07bd6fe7338f4eb120d893dc4ca1fb3688081e517efb65cf1c007fe9252041a17005cc13ec485329187322cb2b5f2a2902e038ad9b9c21aa12140e3c8cb810d8f0be1066731194a88f894e2aa9bdfce1cb6d5cd820d05d34caceee076462e3a0bfe8fee6981662986c5657b6b1b7c82147902648ed8138fb76b00627eecb8af41d8170c131e44bd1c9affdf515baf69ce19d770524d24ba8a2aaa13be06c02ac5b6d3f2fba5118c71ac720621604d9fb85ddd8db7bdef0ea086d176dec31a5423e3732017b5c5702d66060ac89c7f94a6de45709495d0ecadba89e30ba6a81220c4d38124ac405d1dd9f820b9441edb1e94854542d6a24e11e5c02283c94ed60ff9b069b38fc0354eebb336fa9626e93b0ef317322bdae45a69f5708832b5816b510415d7995c9ef7ae59b44ab0c6d9d753c1fd5c89e7221c214ae11868057ecdc408fbf88e39da3ebc4ba0f98f8de9b497f0ab0a2131736734005b94acf72170bc5333ec3aca533c692374defb23cc5299e7a494ee14de7a121d6085f514c65406e1f1e136542f1082d6ab507b1c6498a1c988dac1709c8e07588c1f33b2947c5a167918f19eab3ebd547fd670b85daaee58fc5daeec3049800d99ce6b3d1e22bf5c116fc6cddce694e2ef93ad45ff403f5febdcbbad94b38c635a4d7441357b07a21014b5d172c322bd54789286f8172c49ea81daf87dd13e7c8cf5cc1ab19f097ce5c44b1b50376f93dfa28188829bf2ec9efb4de7d91c621093c8db85b6106425c020292566df2437e908911723918e3b056289e3327ba85a7036d0c4fd8ddb100742ad868393992bba937d7bc2f9f55a8afc08a30d22943838e684fc6814b472011e23bb957731b7f032bd2e7fa69440fa6fa81087e28ba4e7ea11d06acf7ba1872acb4f84081df3025f11917d5b4f3ee70458ad03bc1fc528ef2b5578c61228a68716c47269076202abbc2f48270ab5b544775d2023bfcc737bc275f3f2b783281e942117cb6d76285ad905800a21b29f93d213aefa79bbb0dfc5c2fe311647bbd52948255c20736a37008699181fdba5044559b5eae729da929818a2da8ddfe2d58d9627020cc970111c69faa7a47565f94bb94ae21c9404d0fe1362b297dd81f68d391ec6a50af5d7c8f4bb15ab0f72a38a8d6ee498c7ac850fea6332f257897eae2558db89e75b6037da43ef99ef12514c6b977b14b207b0bc838188b68e6a65360634ff107c0cd3b45ced66ea7f5538d3e08e90a202d11e49620f61b605d6618f05636bc88b475af9477fdf036bec7f587666f904d604dbcf5504cebecc04ec5c8dee5d956456f4ba461137f1fa7ed5af21e867c4aea4b124cec5d2137f30c913ce934e624f04c2ffce5243cb2ca8b8c5967e88b905d19531b2390abdf71f49ea4f3f9caf4d97207f9c82a6d6820d58a71c3ef66bae5ffb1ce75f90465bd549cdddc2b3674b6e25c42eab73b6060814442e1bc78130b5e43d42ba3d2bef2c2d376d176f6f0d51214607663a6d8da958a94f30cf1c50860748949ca1db0cca87de9b15c333863fd1c1dfb19ff4dedca05827a9d78b6c9164b1ab21a01661d4ba47987157592ebc7c30142cec7fb7b149025211500f5900aa58224de35d269cd9bfc539d3fb00bd9be5b1a1358fafbcf5397e81b71683d80378d7619205a7e6ad1ccd91fb0bf80e0acec12a68c76bfbbbe9642645579710928557aee3b0c38ca9e7e4523a6813dd4dfdf6a3b1b39ffab6e58b39ac36b2fb0e59cda46491d4b85d70b6afe4295599633e12fdaec637c373ac03d70545fd59ca683e95d17e1e64a3947a41ad7251ecf04b2537a4d71b61f32edc65fdf718c49d2f779c464ff87029212f767e4ae0bb4088a8cf024b87341a4ad17374acbec7529f6f722d54a65900196749ea539a8fe327b44af88440ba57112be47fec42a72fd0e9be71ad7f00e183079f32146c221d321642ca2a7c7d6837936c20f0009d350c3e15a47a6db9d0ee984f46d0c831be1c74c96ab29e80ac955bba7470c5244cd32c075e52be0f5cd694cb8083b543d3698f2dd323908e5d11d99bb475f98fc50576d79cb387b7120e9cb19a72df64ecc6db557e2d6baf8f88fc4003ebc60ef78a5da98131dd171d4fb7474c0ed46b1c95358d79c0c55a8983319cdd97be0186452ad84f80e41666e9c5ab7f203b0289746523b295a8d34c32535bd377da3c661eab7d7139ae378d86e438e1f0e392c7f2494cbe00dfadbe234cfcff06996f3ae11445f0a734fa55988bc34c4a276d53590a9d4dfe485e2ffbf8579304418799e62b3213208c886ab31dbb81921cbbd80a99dd9a0132e419f78fa333087a9c7ea0a42b7e4dcaedf0f87d67312aea660bdb12a81a0b1fae9f7567f3e2bcc07da897e6df8b5c1f9c273b3966c1d0dc3e76271008df90d34f130baf953efc191a5b22a80293c881de2dcf3fe442fd2cc7bcc375a74e41f0ad37d69cdb5176529f4834145fdb7ae8794b7f30cfe82f4d2907341be8dd0bc99ba86ff87fad204f8cfb7e5e7f10fd217c1b38d622e190790c4db0be68c63dd865f6089b1187c45313d6434f1ee938d9a9e47c5f03a784b6e791ae9d3828897e9e2a82e55618d65f42e71009a242085772e9973701a595d76ae963530d33b814a66d5fbb3375f7efa55113569a1c24a97141aefcc96b7b299e765b271b578f908fe90b930a53770538c1cb5672b4ad2500df613d74d36adc8636302f5a58873279932776d5842e09b8d457cb7391c423752af63924046a4f3d4792e1b3f5b463d74b3714e2f30b811401d1a29ee29226999acc64eb6bbe19e04f4a32415e81457792d4028d05bea78982a7c9d89cea326dce732b342ebd6dd613f71176b7a0be254454b3c9c5b09a7276006a5ebd22a6f0d24cb2929b7e93c2f38cf691272dec0e69e81888cb2e4c8d98ee42461c18250e1737af62ac30975b59949bda904968133c4b33c57409147cbb4bd4251288faf77c6cb03780f1f0dbe49832aa338198245d91393b1ffe1e5856470a638bc6f1ea9b12da2f7a51bf6859e780b56450cac2d2620921822ebeb53de8a1e44249bef80831908632804401c4aec1d5c397f3a2cbbeb75bbfb375aa164bc5bff381ea75fe2367e7d7e52b927df9a7c44340a6b98cdb37f3481d361056c9f5e11df3d85cde530d35a3f56c98c279cfe69d38263309a7772dafb0be3a5596b2bf3ff085681998886669cae67396b327dd471f2bc1fe67e018392f2e6ca96a59b1fea6a7c3ad309aad0e9b181feb27ef843763f07b12e83211146be8013fc286fdd8028e724149d0cf9d3b47b69f2ee0d7dd7caf33b122f056f9b6529cbb80adeffb62a1647c4c5321f10dba34f6e42edce5c83c9438f603881baaca604ec41e370f17dd8d3193d3ff4b94bd026e5302a36e621248609c74cf83547d3b142c8db32078d2ebd22ef3b417ea4e7b158416d1bd4e334604c4b8c24bb21bd9ab372bd088c405691f210f5d98a4b3e55c946cb4208b805129e4d4fb54ffcaf9e9b77d3818fc76bb467c3b85619b1879601cec18ab00ace02897887349276842821e6dd207b04b529552d335497edb8e19aa6d8773a575c165c4f697cbd10c372918e988bdaf89b3f24fb1f54e12a4b76cbb6dbb26c316e17291907d24f5981d8ef6b3f43dba76c89903b781b853e4141b2f050c62bd0f89bd6c8ca73461ae2259825277f768740e5c7f331629761d9df695cf296ffce0e0454bea0c046e2b6c0028381e75093858ea4caedd3acddfd8947b1b85cf49af5771ceb9962f5894bf5353d9f6a32edd7dcd787b9c4bc2746120f65eb686485b8dba50ec26a2b90f2ab3edf0d051aaacb76a608c2f83c1b8481303e5969336ae6f3a7a327b0a8815c414c5b6f733496608503553ecb773f9d8c550aedce5c09cc800d0ba54181e818b5bd4321c72d962d6fc8ddb5b8e75e1f20e963a5cd17907353e1712a7a0d262051efffa7cb78e5e5afc2b25b4494916289b10862b497d55594368bc7757d3a6ae71a8fccfbcec46dd9c573cc7e8481763e3f0896e7b558124421ec19f1532376fe4c84fae9a4efd34e2ed6edbf847da6d060b2bc2440899d5228eb21b8373fbed9d352f19ca41994f87e842cc89b7ad55f600b6aecfa321c27ec5b1340d7e08be128d49667b434f3cf59f172ba0c6fd7cb31b88736ec4300ccf0361d69d0a13b950fc82d17849b11d9c2e825c87c66eea3e92d01b4eb7b6c02f393bc14e06367d681fcbbbc976653d58e21a77eea9a3aec92f89b5c773239aa58d821134fdd9d75923b7605e1675832a8fafece565b2cfa5ffbfe4e6aed5aeee75c8fdecec3fa69954e7a0516728813ca8c2dc76add78bc1ac4a09da6cd51cf36ba6f804bfb48604b85cbefa2bac06a3273d339d0010836d8b82a90a317f025f07c45d6d89afeaf9e8515aa33ebd8a6beeacc2712ab1bbb649383baa247be11fa35d2c4d5effb4e34b9d39b7a14cf962161d6e491bd84f30b21351918d6c3e016808d4301c9133d988e7e98e3d8c90655db5ca2e6e5933176adc9a352b4880c8aca1cb0a6f28cafe0de84cde7c686e3c725e4685f3577c335a4b058159828563f518719b98870667b181cfbb8b8fb845bfad09ded49063f797140095a657bfd7e8745a3f11d42b547bb53dd3e8c836e3a6329a015ff50b8f5af4c8b7fb4ec63c6a5920651a7121637cd4ed1ac158f536b2602680d76eb1c67c9b8ca5cc4c8d96664d66e2b0d65a137cc22a35182a7d1775ecec58dc013dc2c8a1a2df0fbb28f8bc5f9760de5d8e8982438b464e7336b104929497e30880ada5cbbb67c4d767dc5a81f4629ad5d736ca940107990fcff03275c7a8bf9c774d438498a0117afec50cd126a8e6212785e57f5ebe09b010cf6882715143aabe5838197ee865705d2c5782c638a29fa7925e3c7c50109e4aea9635f3495f86b59c605f132c52db78ecfcffe6ac329fafab3506c6ff9312e7bab6416b291858821b0b7385238a0798bc7696d4502eea074547cc63623d866c0cb9c25f4d7aa39aa5c648c5e08a20949e387e1b77582ef063b2b8998904c67e72b7bfeed4d97df82db07c5765096fb0956d6ccf951644ff20a1449b88e7304b6237e2970be99bd4ef67897b6740065cf32f516cc6db241020d75ad055360aba37601c16ac9b0f3179b406041224f92c0419b60f79d2f3540fc356ff5893b459b9f00cb5596ae6316eed6d9e7a0e6c44df9770ff105526d716ff4218238ede6b50266ccb5e0e89e53cf3f92209016eed8ed4780ea7f4e59c40be45f63527cba265f91207e9ef0c40df95e91ee63a0202f5a0e05d1dde61f09a7c0b991dc782caa7948608e36a6b443771fb6465a497138f5d579bf9c0ef07fa036e697dbaf212fdf6e37ca9ae583179cdf0d3e91c9ab83ddf2e3358e687a019dd6628990b55038a62670a780a3133ea74051ff11086ea0e1c1da968de60f72dec2d151a38e0f392312076e0487b24b9393b3cb8f0dc30fad0276bbc4b14accbb0df60f915c9cfde4ecbd7bbcd55b65309378b55601202d63d46fb46311dcb7e043a5bb7208ec256e1e0465ec4202cbe47f27f5d8793b21ad7ba66644c4a42cd81ce068accc75d152f6ddb85b5ee9bc72891bb50c05a09fea3d8645aac3ada7ddfdffd516e8ff95a69b79e4532d70d71a1f309edc971e26d885ef97577ba57568a16fb3e5c347a034f616e4bec90a89503d179c686e9934d1427c4edea38f295f4db7249ef1df27153f93e9434aa37e03ab21d3cd424516f2d78f2c6d67245547028f724bcefed7eeae0c0447a62be916d4d7ecbaaadae538385d6f97b965c17e3333034f433e265bbd658c5fc549808db703905f87bdc8646a5e7c6e1c9fa185c69a9b4b6ac66f10ae91ffae8d497e5d08d50f3bb318c72203f7bd92482ceac05426ed14db0f52695cbc315c89e437599fb66d5a171c973552078df1d03529f2ccbdffb0cec1c3e9c8716fc2d7374d98aee7351195db113a88847fe7b7637759e92c9dd4cf69835ef6b2909b7597003c8e44f30f7d0b9f8b261b98d65dd3949d46e7f1723ea7f350ae1c52988a67dbe0f2eff9f621703e243355b4ae4c59ea139dceaaf4a963a53b1100d30ab67944c23f7a6782d920545fdfddc61149665bf4aa2300decbc9ceac3a8a452e0b2d6181b51ddf9516accb8756ed83f47b89e83734e570b91202cb5b1e6299134292477d602e036fc6794033538dfe86d663e4849d95ecc116fe18b8daf9bd903c07a6f34b7b4eca9d4b4fe1fe170643dd8431bff61ff2b9a7b4c4c08c90579294f9919a1318b3632e10ed92e41c1295bc9ee3cb40c82ff06b80b57ed228561c9cf9d9745e24aaf58fba1390a73a85c23d308c445123429ca483e9ffaf6990586927092730d4bc1c614e9e55f8c34667f99488d505253897720a419e60e2b5ada18efbfdafd4c07a3f9d9577184d5fc3849a00bee1c7e13e26fd4a7f80111e5d0219ed9410eed75811d07d8f7509d998badbe5c6095ec0cfda8accd4347d5253fac0cfa76d753df9b372431e65f9ea32e01e6be8b499eedc4e1bf36b3079ce577c1451ebad8edaa0aab92efa20b9011f515b3cc44634391c3cadf28d5f2d19710f859b89035826f93859ba7e569b54a12492802f12ac60cd6e046f94b93725f33b761ccc2436021e76bde9b0b91a49e97ab05d6e823e38a97d55164925ceb9f201c80c5a8b9be7556846f6683735983d5a5f4e1ba0d8cb6cfb215a2de556c9e86a8be2891168f360f08f0a6341e31aefe89e9ed6424c43dc06cf6637a25e43e1131b6045ba798544aad7f91740cbb38649f97cd26712f1fc2dfdb32823dde348eb5c33de5d9fff9b1b102d7d8a0a6462fd38db52c2a1a1efdb12b865d0001810a3ab057fa861267144c3bcffbb8d5f1a1669979c7da0321c2e2ea495f15e456832a90d1ef0a2fd63443b42b5f1f33649342aa84aebcc5fd039eb90a34516e3b67d240135080a2cea0dfe38b14bbca61ef0a856c24966f577b24b8247dcd23ce6ec05c45beae6db5bc9bfb3ac73edc4a1003a1b09faca3f83874f757ba8fc8a5a442f6f68d813a9736f47c2dc426a66b9b6ffc7572422a4b39ae137e35c48daae580b6bfd4f7d156c5e8c54b7f2d6ea349883b820eab12fd13871806db20f3ee2bf9705f52f30ddc5cfe6cb37176dfcd90e8fe5dd2c5d0bc0ea61f51a473a58ebdddc2815963c9020249fd11d35a6fe17922bc01e4cc5558d7308887327ff5ad906e820c65e4e51ec0d08ead46f23807c7b474a40f68d780f1991175f20e4f9f8488c2177773450fdce43b1155292ebc40a416e288468f425cec3acc2c571fa8050c74e767e0214a9d4c49e5421a8762282f13ed93effd0ee08c0f5d23f464f6bd67fa2f27224a251e1e4588cb677d083ff6674f2a0ea0b999ee9ec6fd1759ebb20b281f0fb6f6b3fac47ed4bf4131b23b86ca3c3f30dc2e5d5615013f2bf4fe93b4276579a105c982e42555213ad9211faed32edef1b6799e81d41bfc21e4ff272a665abe1c712da3f0f0502d0733cb32c8af7ff77286b5d47e08a37cde80603126cfcd2a6b08bcc1fd5613858d529660b427c46819ca47e2143253484010cab4547a9494e920c1fe578e3e92dd34b63671357eaaae45e73af8c988f4154f8771783f30381833e3231b37ed020756353796e041b819883f4508a9d5e3c8d49c7d0916b6f024a87d7c184075754272a716fa212aca9dfe595914a96ea8fae46130795822849723cea96d07273e9e3d504f7fec7933ca86c1e019d6bff35f2978fd7568067cdba389ca54c13936caf871d9602332292090725598d6c4da698afe1912e931444d37f1e51b9e00fbb0b3c38f65fd3f42c6580e2401b1734948d9d07b6e5e1905227f7cfb3ba95ace9bf1b78a9e975aed687b7530093894cea70d1abe2151d1e67dba80f0558abaa2b5177aca5bf8f49fce4c98eb9cbba928f0a0e84a53b77925a7ec808f01e4f9e68eaddef9b3a9069b2535823bb814c86d36065e106bf92adba441cb0a188e6296a4afddea59edebe9730629891b6ee52dda962bca8d6c8d54d269739fa0090f3d0e15ef627853529cb128e0ecea13b99eb37f49d2c54d97b8b7fca5cef2c7a38df3fbd5ccaa1191fdf0eca3b5feb09d240f1f0a435c1361db5e891fb731b449f828334d8b30c4fb597e35af2611e170a7b50f9e82bede572bb790990fad22d99c39d039843b58e338d1c0b8ccdd400a024bf519aea41972942bf37ec3e838a88de399084e79df7dbfa6cbbae6f7dcf17b079e3f9cd50009295b1374725e09b2f2f96ed8587babca57b53b1122642b213787c5fcae8150a1b0a9f3f821e21e3931fad57bfe8749b735d648fb8b787b9d56edcc591551ffc133e53f29d7d5e4a55d3207080543d0c117079e7ef3858533c3d733454de2e2466225d83fbeccead72c71b7d4560c0c3fd770893362d17875f665651be5b1b5735efd4fd9f197dee1c777309b5ba4e8152fcef183b2708af07b156ca8460b3e6a3908b1aa830169dd40bf5009268a4d12346d3f8b348ab61e4e51dfff8ebc6d466c3acfb6304a3c53ba6bacded82d6781718e27294db6c3a2f001050b242bac227661cfc6860382765773aadbad1243107f9c397e8e7b1b1aa931924c6691d6c13cfb762857431893d689de546f751041fdc35faa277669688bccb4628d57623171109f71557d7dda532036260d2e4eb8e32d760f6231a13c9addd4863c743bf4e97c35acbeba6351940a1aa3a9bd612bf040beb7efa4af37b429d207ee7bf1e38a8d6fd864e079431ae0a6629612bef1582f7ea8eb27c793bba37f8b7eff18617699c5a67136fbfd66e5148d2cf679faba626e1bbce073f62b39405f800d5c2c18446865cc2b00aa37e240f63cebf030da3698b281379b5e03b9c3f5388eb03503e54f0c2d6fce8c6eaf61f259e84a1cc0fe1f2c4146acf48921ec70bd01d551fa89dd5da3adab8abe6cdb29cf2daffb0a7b6d18c17bb977e68e0d3bba60daa2441c9e94158a5b4333b5230c48181610417a17f559d328c8a1f5ea04674fb633a302ba94b84c21b1d1eb18feec3c6f21f26030a2fe594e28b668392559d633bcd282f3448a6bd06496a184989a3c7d5935e6de74d504de3d215b3e2eb0b4cb84860d58622cdc9a44d5bd66fd36fdeb11e92041a68341aebdcd9ed0bcde3e335e33e864359d91b36aa038e3f3bd45535c66554d4ede1ab3ca3a7a538f436294ca0902939d08606fe4a4bb4f14006d7cb966069d54b0f77a6321db02e2abe87369750c683937d865d93e3781a775947d2be8909214312e58dd356791bb01b1c38e050209e48da9537ceae37f74a0af153986488770b74974ae081a69a80c1af65a913175a935a19cba8ad23ab2c3d22c4f40b4cb9a32765233eaaa769b58851870a3776b20d1a9e8a608b79b58082e9cd1a98d320fb807b4581b136ad03440aca2592ebe1a4a4506f475d33fe26d97caa5a05ad7bed6eebef6d8d2269160389b0e435ad53663940e62b4a6b6bdd6cdd3d7f48a2c49e1b88d39de89e20d8779f873f4c76d9fd8d173a7203105c76a080d41124d18b89071c7a25228e66d7da2d907bdd36e46027475c5d260122d3cc8a1e8d3c3717f305e64f60f6779a00cd2a49b6ffc37bfb8be65d1a47a70fee7524243ff339672746e96828b84f923e5ca7b3d78c2bfd276efdc859356bb7b66f1169a135e680363e1660514d2f6244889f7b5975e0da70205dcbf9da359947e25d36d129537e3737549e3ce9a24583519067e6e1097f4cb9bd4856489b6da1683546a5a18c964af9cc7bb4ae887ffe363b9f506f5bc752aa76206fae9b5c3ef4239a9c6848e8455cf67d90d8ef5bea38c7f02c3687d7b904913f769ed483cf2ec9b0ea458d30e71d495152286d3a44f9768b748edf80327bf5818c7bd65b0f48baf540a83715a2becbaeaf51dc56c90fc8b5c12b9b832506f215d716a6d597908069635e975679327e2ffafc6c87a15b178870a4ac6a85e4fb0d7eb277fb01c802ed53adf08118ce7385468d2ef42a182632bfd2dd6c5b50615499145c55930c8aef1eef3832edf331a21c3579a06801451d675e7774230dec6bfd15b94f91b0b4bf04bba0099b3afe1c8403cd32a49b0199a140f838b4bfe9811203754c7bc8dc01a01e52b7b4f171436d1b8d7a2393c6e393a8b657f462d7903b78e162d2b6c24c437bbc18621b7ad9dbc9afcd9d0d4eca94aed7718eb64b7925a07f53f0e80f01fb977af22af58428e3250ab371a023d43001da98557f23869ebce3c9304f88c71f69884259299169214bfaf980674f64428b1f37d43d2858263343e0e2216b90cb0ebfa6c347d2f167dc0844d48cc7598f9dd9a55e0483bccb16e81acf42b335f2af9cbafbb55c0155d9356431e81ad06cfc67a468feef5665dbc5aaefe511c70a12734d5a1d120ced9aa37a555512dc83303e3ce4814311a4efd1b2407b2ba91d7eff9c84efd81a5a8a629962161e168cb621dc5875278c59c7b8e2e74d7cd964102a470ece5cfc6506065a2fe8cd8c5ac4f945a0037dda6d6a10dfe937250872224e40096b9b1bb1062bac3b5157d00ebae2ff562628897ca1dc2842ddaccc32d8ac0fa3404950c894fa08333118720f96b999099d8cea100e437b06643bf6df268030e6804099239fdded36c5a0f20a3c3ba79558e4484e273b187e40d16024dad704e05faa7401eee221b65ff55f393fec0414b05caee82ac2a9e8e7e9503b95b614a71be4f596553877c0a9b17dba9476444021ab6f93b0b02d17363e11fbd3e606ae4018dfeb1a6b84267e7e227c51084b13fe78c6177aa660a83df397ade545ff39d3d6eb4c98b411a587dbb8a98d12d4cf66cbef7737c56fdb8ad3fd95f9ff72d618c177fad3e4f0373ca5d011b3823fef97be6ced40afe1d79daeacf3ed7798be24cd4ad60ce910179fe54f84c91f100b6c5d348c21f01704907649fa8a48317ac83737a53ca2daf95570f0c7b7d59d28d8a32abc91aa450f51aff818ad5205b104b7c65433ba7a0896cbda87508e748f6aa67779078e34597a258a4007bd5e09c10c5731afad550bed97a69364d6530c8ff5855b5395e06a6ad266e1a4da63349071c4c29f081138258aaf3382360bc967735302a8891cc3203a0c3f0af52d19d33b4cf45db5c4cc2d9ed7ad780e04f348277f59a4333209ab504e816fe59cf5c3d42ff3bdfd526e1e6e74c86bec3405750be61ddae719f8bb118290b219ebcc50be1e5082b27d948cedc454d2edde03d5ffc1d5b0c2c73d15a814211bd519fa5ec5394096dff71bf73dfdbea789855fa11d505c266f796828885a2807c18674cfb8eb5a5e8bd4ae71076201f58ba5cda45b245195ae9131bf105f8262669a60a69cfcb894041364f08ff8c82288aaf4811453e994e7a6ae966cad4e6d4b48723e403eeda46f583ec7a124e9ef6708842e661e5c85ba84711b8821d2a82da15e8e2690eb03aa846432bf4d0fe60c69f4b6e55840b2de1bb201643333644511bf5c05421150ea9e066d07fe13098a2b72b218320ee198b19536ddcecae8e17954daf77029b544a99cc97008c7c5500635f9613ce6a600e5aaf42d885d9d37e7136b6375b3fec53683eef5cb908aa1115bdc705c42fd7db67a027eed63db1bb3e2fd6be64a8dc7d3eb3351db4bd216fccac21c8ac42df9b8e56c8f4db34abe212dbb53c37a503152eb2a6a07ded28eb2d85c5cce4491f31c7a3ee057a0881f4be863d6f4ba47ebab7cac1a08092772be82e5</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>技术/博客</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo写作技巧</title>
    <url>/2018/02/09/hexo-writing-skills/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">请输入密码以阅读这篇私密文章。</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="6febbc3b5688c74f9c57bf7c23f35f2b45688d15a68bfc8c5ec17d0778442c64">04b96cf03f1b5d00286d72390b6bf2e0817acbfddb7147d2fcc01912c7f5c0f9713c9c317ba53b9347fde83c930f8c77af411014f8ec84eef7465f6027f6e563b20763efbf9fac1db105face649d36b82b8e5a28894e0322accb07eba0f38491487fddc38b18732e21e4d5a09a208486db90f1b471e152ae582639c98996b3d9545b516ad74403d379a378e897878b9754f5f3c9a9c1cbf034ea3b155b6217c7c2a8ce65fc5458e94d70325ea68e520fea1f3d22f56b6349aee20af7ed199e2c05d5058ef826f483bf40a5fd1d5f80699b8219f40947ecaa012188919bc2fd0944b2b5f8ef475b2f9e253d4f72a6606a1c758ab965e388a3f5f738ddba60d11df6633ca126fc2c4a451982124862d23264d570529db35abb1b751e2dffd5670a5cd5cda9ce5f7383dace45cc07c15de907fa244376f834ac253bcaa2e59897750ef4b4d9c9dfe28d221c72c8a26715aa8ec83d72fc0f43077ab0828ba4233e0c76d781496082cb1d82db37990136ca0e9cc4667ea66ad6d9da7a3268f028a373459ee12ac21be7121d827e304487bd466fb5d245e4a5d8e631dc778052153b1749330c6a4180eddb9c8db21a9b8c063ab5841cad12a45d7ef48cdb4609ba83ac061e8bc5d332f995699eea655084a131e9777fae8edab489b81c9f24691d0813144668c49782f5b3413490e5f8c626883454e8da7a8348537ec7806bb94338ac692345d9c86511f7a390f4c001804a8c3956154ffbdb6ce6750ce5714cb4cdbdb6eb172638f428883e6931a56308bb0c32f5713fc29d225ae2ce26de454942a38e21ccb8ef1c979f046002edcfc16de78d5d575f4382d559d78dce1c3dc6f94a33c8c81f40c2a01a38b8d36c0c18eb5efbedebdc45eeb979fcad808cf7415633034e593a968616ae03b4fcd896e6497b216269a22964fcc068e168cc22974afbbc1167d01603d975f9405837cbbc8c2901205a950ad3b4e510ba8f54daa87bad015378c0625216cabb9b1f4054e0db2a7820cd70925d9456eab62173978d3b23ee02001029f4d91c8dacf07238c064a7e3ff25f4bbb75e6daac3c99f54639843a33111ace5e75f88d3c318ef4409486738aad523ba453c922367e4eee5762b0646689764e28f4fa435733d930e655c81a58027bd3532ea9001f51104d21e7f5c8a80d25f0eec1f165cca84004a36473b3f15ccf2d3e0d62eb7aa8e641e3206c1549a98e1effa02203368b84f8113e5e7c607a74ee1efbd6ab02fa5a3f6a1a9c46dcf36c63d439f407a174b0407fe186449c22edaa63b0f8249555e26e5be60cf07617ef627c04002c4c7859bd6fcde62b70aed76abb33503dc5da4d853abd31c9701215cc2ac4ff890338b8ab44889d344abca3f032249ff35c527568b1c8112cc10d46e96f0d53f50f8620f4b8471a3432152e335aff2a7510018679796f007d6c996f3ae974c56169465e4ddf8455bfabe1e0baef3e26663e6c6d56530b9893644698bd18e0353943e05bcbdcaeb40e82d7f50edc59b7aad3f1608df9f3edb515751975f3f6ceb73a8bce2ae6102de1e082d99461c5862b3d30f2fbd093b7e95051e5853618e8244432cefaf1997f62884179d8039bdfdd23ace9c369ed3a7c5f0aaca7a1fe261c993431d775a613eeea41528b907d739637d44382077cdedefde8d8c70735df4742b8ef6ac71cdee4af711b1e131dc2418ab22b7f5283cec02403c8a11ae47726e60e4d37ebaba7b636927b55bbf631a9eb9ec6aaed178c99a0757b889cb4e444e1cd5a272958cd2cfab59892cddb6b87d3f4201e6e196b82f46d774d6ca682fb385a33a0f6b9df3c0d27eaf9f7d972b54f350888d25b874ad1a355653f4d1bdbf06d0a74fcd003e48586353f54b91fc922edfc41c04bfb4f3b0d4eb502452cd5bea5cccdd9a1a523a2df761d552bb2912556e0388a058bc07dcc11ed35eb1764cbd7db4a2587412daca535e3bd5ae513a63432fb79cbc97884de914790330a7b9dcdf3cc8afdb643b9bde3c861bba8edc74e847133a313a86c3bd09c3308322a6b6a130479bc28c415ff55cabd571927cf93386a14fd611d528f3f8f481ca397631b9814509aeaf6a3e92f9ff62b6a89a2d3771555ab5e6ca0c1707a524e3be295c3b31ee6af60569b629d48177673b16ef059fd0d50acb678f2e58145d4fdcf22944cbcf9fed52e0f7b7304efd6c3c9bfb0cbff90467c9c5af4ce84d03201f57c753e04ebd64c0c6df55d6b7b9b96dd6e0451e03ee3fce781e0d0051447cc71dc9d08cbd3dacbddcbdf4cc1bc4f5b46c190894ac8450641b25894c21f2266a5ec0c4dfc0a5cee9d9da0a931df376611a0ccdd5b38dc85b9519e6497f67d2c0d945b859e3adc0821f262e59d57f29d9d8b3638c11a825b9d9d6121b8185c477a663451abab6e92df1b6f66445dee9be039459f674f7cbfa2486554b818fa050769109add3d69a1efebf18ca8aca454f47b1dddb99cca6fedb2be981073d7f3242aaf4948a1ba4e0f28853181f3453558b5c99e87e10f3c3679db9171d23d4b41a9558a6df4e3164ae771d443cb220f5f64dc06d5ec5d1dabf46abc1f025fb9fcd690766e4355f8dad17ec75327774f1851f570a9808f828eea1e6a26ad9f0c492cf0e52a3a03ce9be42e9a2482764d2ebc1ff5f4bcf83f9d51646b749475c6a939258724fcba73c9a8d92cbde902d3f99dfbbe27379a007ef1c3ca73c39c6ed7afd82b87037f2a90275b8eebd21135958ac05c194dd7e8638bb55c031b3beb44b530ea44c2dc2a64650d4f8d76cbdbb6a53d341a3a3018f233c69370c7f477b0022a43d074f585469932ce0647ea1374fe659b06a66852a5da93a0f22b03650ccc9e0f973cd79a900ce70fe777dfce6c3715ad2c24822890c26917cbc6dd75b90a9b46263608d6e029b02b24ca064ebc82008a4fa22ef8fd3c7ab612a0e0ef44079518b0a77167d5c42e4bd247ea97d2618b40a31fac5ca5634ac361b1aab3f2c3bede1f30eebaad9722131813a3357b90d0eaca93d5e5182cb42d300ce0e52455b8fd5f79f260618a7562cce68b7781ff694236945c049c0ccb9a24282a0c0964d9d827f1b59df40ca3c2cb77a4c148d37ccb39cf7f4ec455e5c39cd588c1cf650dcb4958a167a52955da9dbb63696f19d2defd85262d86a66098f46ac662159d4c3b53eb63513a1323acbf40a627f7ee89c3417ad973b1fa62a0e3ab76b773681e62b37d3fb7ced87c956703c95ae6738b122aeaf44904bbd11e71fa117a72d8562d41b88beedc1b9c04ed2d2a16e3df1c1e6cb012f7dbc2610e3fa865d4af849299db3a57242776bdea1feee689cb4204b004bc3076d8ae8df4d338758fc21142066a6c2dd5c2e9ed2f37d2d8d8765ff85cca8906b9772542ca7d4352a40eefc6d90084e4dfc6b815679b86d19e2cf990bd62b0f04b930f3235dc3feb3c2543271b4b71506fc8cc0ca3bd34f5d7496fabfc7e14a7b674c937bc1cd5a5add2aa8cfa8ed53edf1fe64bfe3e07c4b573b062ef6078eb6ab310eb84f9e8f2990f0c363ed9ed65d7ea2a972403a15eacac6b6f1cc6114e5480164b2157e9488bc6facb4518016855da286d5812dcc6a0ba0f3ddd266fedfa1c48f9a4a47f1bd06b70e39d204dcb396768c6f169371f3c8389a7bb516a94f430cdb0983e9738419a47f88938031cf5935bbd0b983243631c4173a3ab841ec7b760c843ca00d0460e9374654393f2707e6bff799ef20d12c17b3ca74796ee69439aeae0798541e8fa6eabd06f27fb4c03beb876554564ce5182bc8b11ca1e850cbcfa05a75e34a0120a04aab9374687e2a964e4a57d95d424d8d7378f1c839b2d3067337dd29056ef738be56da76769fbbd9229387701bbddbefe6d471f63d6900d6dcf9e72762571f420a027436983c8e468656e011e333d20a6394eb3df07cf9ff0ce8d2f6d603c72f5cf9c080015480c9e712041aec1ff95093a4cb5dbf1a077303cf3dd9fcb785f0156b310e57017b806836841ff6f7974ab889807273b04251f86961f324ee86092c8a71457c8dea95025f5a11eca9114915c0f4d473446d91d7e92ace995dbd4029341f0680915d8be2d59548efa87be5625fb75794eaf8b48d947318ab31b7a39e4d3b32b0dea951feab2031f4ea78fc36a1b5ab0af384b0488ed235e445400e1c8a968dec9db1a8fbfbf61086cda9c6ccf49c5502f75aa7741669669a7c7ce516f49ad1c3e2e1c0610228c5273c8362f73abc217d82e38f90a8da95e76370794430085b50ba888b90f54f440c2c4c548fef83e74fb7dc8b1979f4b6acac0898d251d98dbc915c2354656a74311e4af81a1d4c20046ad9b2b3efc8c5774889a112f45bac23db22b863ad3a7eb765814bdb0a48ffda9fea35b515ec059d38c19a1298cb99fde6bbeac63d84e8a9bc66cfd99ed5a6a3330dbe540a12af7fa54867d8e7918d7410760d135000f0ad409cedb567333b4fd633bd8ab4944d9518bf0163e4cb7b1c546e8bba9286c812fdf6bb86b16b3144d5073f7731d5a4f8aa17619322ffa091181efa5df5cdcbaaea8be3ffbe63bbed8ab77585889c9e4ea0c68e908408d18826553e7f1f42c87020bfc23b6a3b0ccc1a832a60647605298d71cad9f59196988354d209850ad0132f53c8f163c6f81b2074ebeb99a4750860e927fd0d30c2bbd68855d31706e15f0d4044c5139daf1cacd4103c05341775d55bc0e39dbd01e3e2faa8d676554d8feb1ce0d738945ffa42e2ad928174f7aaa87fa9d041573c4d0174e7ab3a1106b6bf7f3e5b26c3f8deffd58554626d6017e1d18250b63a2650a13c97dd2def53e4293b49a01cf48e89b7bffa90d1d70d121fc9b7aae994b7baa0fd5ca2887eb4f45816cc2225fea711e55c8642e1559a59468aa64fd3a926d8676e4a31f7088d279b88fdca9dce18ff1408ca1b000a3428bd9d5dc327847e4e4ed8eedde1de17baab74b5b4e95f318ca4facec2b26f30e10c0f2b1f39400298b1ffee035289454a4e6c7ccbbeb233ed437c3b9b961c306d2e1e1d13c0ea7f83fd05dc1555321d02e289f999c8bc0cc977a6d36c68c226604c085f3a00d521ab629848bb1cd70140ce8f77b87c5604b483ef77503a46caaa0f95b6131f035efba5905c576c68a104ac4ace38d8cd0dfae329ad0712ab29f32216a37330c38d4f979a8e6d4425a27f17844e7a31e55718a00a7d23a94088b73b4310bf85898ef4ae631a8212835ba3c0b141963538c4ce2d3069fb3549d6505ee4a4eef0b671eba95f59c0bee6a54056432756232f0da11e91e9d5cdb0801e58812461941e436e8cd0a875eb04e3dc1f2114dd1c9d4ec19de9aab4f059fb05d091e74993af5cc84b3ccdbb5d019cd9cf89e8291e8806195330796ebdd8fcea3894047f870bceb2e0705d6953960bac5c154e829b26a0f78a3f42619f52c72272d217b9e7a6ac31ffdf163a0878b1753e0ce771f9465d5ec5b20763dbf5ae55dbec040fd8e77ef7ef70ca8014ced38e97b37ea8b1d5df52242584c92e26d1271eb92f00c056fc2d59b14161c451c3a5a228204b93c20186ffe755161c584860dccc67e902fb2d65e3bede2f5c374a2878999e830191223fe42f2c2ca31e3d99f7faa0f880800c2a23d3518a85ce123887991f1045dff57215271f42c052f5e3f1a30122a2b37eebe0ae90b6dcd78a01156d2df71c5ac0d8f57ca5f178b60319099dfe472b78e5ca8afd68f9638e553a3f70218a52b011a7a00ad969878d080420ced82d817b29f5f2368450574fe273ed27ea2a83099c6b97946738dee8d9e898932a1625e765d67fc0aa48a3d33d2d982d219118c99f31dc5e8f2d1b12ce4548b9b49059dbab92bdbf9de24e8c0000c7ae5bc6ef5eaf24d0a248d0e18ead6f8264c65772d4292f2368210bb07e69c42450b10fe5cbab422f0a149aac0dfa33148437a0fc7c2e164d43a9d69a51999126dfeff2983fccc34285079539d2f1e592fe33fed5329594703b563e8a6f8370724745544224432d3792ebf181ec6daaaa926d77221e177a60ed5dd3c177a129b45bb80e7613c8adbd1de87c4675191e18c563eba1e564b719d98dabd72f5a44f22beba8353eea62c4160af72da964b99fc1e7e99d51899f0783de118fa0f77aae1cb1912b3569ef2f46eabc1c8109400e97d322071e675f28fad67881e3a1cb56da2b4370d27db8156e4193f02c712aee405cf3828fbab4c4e7e723f091c86d08f1737d82ab4f3258aa68de40ca0f8335261cdf56c62d8032640844f10803666cba285f8bfd3504a227a5aefeb6fc1902d9dc5a6cde49ba6a12a8c3bc20f63a6e3858b56d82f15eb28ed7bdde7adb09babf361f716bfe4edbc5c525158bb34e2fa9a1cd813d520a3f8ba6f42fa871910443eb1f95e82e6a7672356a1a1caa0bf864ee265330e0aed5c0d330a89fa9241c5ad81bfa5bc227ab0d0fb99b15ca7f2e30842af5c2dad4979e2b5115cd2bfe4b14d227d166e08f41edd6dbb59c04d4b662f696c8a4200179c241dc0cf7c43de6b097a9179e0b71c60e3463705adfe6415d57d0644fa393ecfae440507395864b0791f1db3a120125b9a1d167509cf15f861e47ea0bedb8ae17b8a84facd6f4fcc6ac7aa011d887d003e9cf61016bc7e775ea12c94af52160e09940accac8608870be46c7329ce2919f5c7aa07b155459c805ae7e5752009b6007b20e8cf9428010bca4275d43a66840a8fc5ed418744c7b4a153199b5161d2ccbd5fcb030c6e44463eff21e8490ba760735bf7407f810ded3915d9ea5b2f5538559eef8313ed4c524ebb4deea7316b9f42ebf2c0dd4110d25bc3e87b3e28b40a04c64d3d8cd1ecf4b2ef0c31663c297d220aa49099f468ba1bd48337f4d0bc17c564a7f8c39394601230fd6736be98ee8da91d235c465acce1307504ab26ea4e94bbb55253f88b3a0110ee8a342dfd7b4c4d22e6680705831afeaf486aad049991d85a3ee9b28ee868d190ca33508f56872464d19070c9a90b1f081e4e2618376762324f33f8a523e5b7c009a944d7f8d99e03978adc175a0da2646dd1ee181f8f5c8b6347c11a11eae60661d01e9f9846a2a6f141c46814cec98c3c331abbccf6f7bc30659ef8405d144962382979e7fe5b0be76451fd852110e439faeee99502ff40d252809a9ca09823c24d958970afe699f992da99faf029c9ea9da12b89970121a64169acc219192d084e77afedead2c2ed448708b949196c7f0dcd396b68be3f0f7b9870db3296fff7bbf2811cb526191ba126d700a69b3313aac728f93d080ebfe0e196d950ea7985d6cb43e770cd64d2456a075cd16284b2bc51669fdf753534943388134f2a4537458d0490e7c08619abc725abf3cbbbbfa6388a0d37bedce267bd4ef86f496734d494284a83812a367c1e930ecab8d5882b9254b1bd06003d9df1dc8d9df0e281275aba567ec7e7b7c6fa2a46b67b3b7a57ffe3d5d50f748f63aaa4d21ad4a88d26b21d7822af57ffabda660d04a1e66918300be46985314b12b2bbd660fd9343fb66317b9553a1353303205ab46f474925739421969a0d719dd3daf39bfd29fec0d5be9e676ff8e865cd084efec4590eadcdd7b966df108d1c8137dc8773e1290f47a2133b1ddcdbc281f99134decb4e2a09e760b5433d59fdcb871b7f9c59bbb0fae7630a291563b619a82cc821157a24dcf75730da243305afb7a5e89c7d5edd964642d2d19ab0e27364218459cebf2074df16b5aa3fced5b3537b53341e00449d81583b5336ef9a452ceaeb8577a4e740622a978ba6798614bacad9a5a8d2f715de05d2e45ce41b333460472a2b0ac7808884dcfd08e77a167ed34e2b2e4ae3f378c208689841856233ada0ba39ac0b65d10b93ce371b18eba6db3e930d336a016ba286da06d19190ed4acf66ba497d922ef302af596e1fa02c0d55b9569bcc9e4497ee5bed95f4d8e12b80982d14acb6f11586da2a0ab481fb09f2db30cc2bf14c48da3caf0020091bebf1408b40cbae717ae7a6559c51945daad47c6b7b4b987d81787101afd951b78a5e6c38c4861987adb388a12284488e1b221afc303a6d22ace90c6b7e3c738c41fbb1f0e8e23afe198c91b0bbeb9a42e48fa4718559f192d0e29d602d4fec9cc4577a59a3950309d9f18c7d258d68153e12da9303ff9360103e43ef72cdd4f3ad67e48e91757aba65dc01a22bbfce863d096650de96b3b89508a413deb286c667767b9949e1a2f9e2e6552bc625dd16e43aab45021e1a1ab500b0d5e5856ac405b392fb05553dd6ddb00c93f2da5849fd20505a6c0a19311592b914db375ad8963d834ba68a4a658b95a08f6ab54330657acc7f5c15042755f50c2319cf73346c89f3011f81b31fd8fc69d05f0d877303d5ca39928927ab4fc43cdacc128619a9380fb95106d0b4d5154ad5c801988794e950c5ea87cfad6d584baf0183352a38af0c7224ba73a216a1cb67c3c6b7da56c4cf724944c8e347178f1c652def07a7f85d83f2b46d2d8cffaf5e928948cd059b4ee8d73a4c023760ee3bdc380b2dcf8f9142a9ff5864acfb7c42c2792eaff36911b3ea05527888301fd5b766468b133d8f7e36d47b48cae5005f43b804eda71b95a04b26751c4ac79c79c5e0c9bd057b12bee96575e749872fbbf8b4aac9e243384b9159a83aa328c208d4b1ee9333ddce635d07b2be4761e68105ff5b40f72d4bf9a71ba613c25fa0a7d038025696b3f7f0858fbe084d68a5bb82e10147ef3965aacab2887453aad94e0cf66b27ee6ed52a7e72243fd2af0652208fa72675969810a16b3a1f8ed48750db8bdc08120d4e5a5341e0679896cdd8e2cf518533df573a101a5ddc832548ae76602d9d1aa1c57dcd1d77f98df747b6fb4e8a30c4ef4eed1b670cb29353f907eff3175f496bb25fd6d995493f93162292301cd510f984f62d7f2ca3ee28f73d642e3c14b4fe689a59f6074a0a79c139f2444e38e3d48c25fcf640d01fc9c96b03cb4243a550066fe8de8ed65b30b2036c5d9392140f37c424a157441db028d7ad574e8e1ba887054f1806680e37db7f153019c3501b3d635ed0a62ef2122721116de7650fd954dbc5df811560a50e02162377ebee5b3a20d3975ea553c9acfad7c9b15e0eb351b2bac583952c34a2e6594b856b79ff61e94ecdea884d8e53e3b05cd9d4ab28872e70003e7116d016da303ccc729b67d763fa24626d4713ba7457ff8fdce878eaa0fc00c703c5dc8b9423ce5ee29408b73ae00ea23052cec69e8bc2b1674c56cca02606e81a051f98291be961984fc8d1df267d628ce73fe91554fba94d4acec3ff845c491555d35f83b2cc20aa06e07b23aa22742d14c9e50d763e48cde9cc3f2319f5a358052bf25d7a9e23f8b90639d7d907889acd67f37bbf0a0dba4e8c2c6a09a1966f6a09668f14e640c6025fcd3ff6adc23076c4e3635d77c4d0edc817c50256a47cf9809e2861c926d139f21a93255dd73584f104b9aa6bfe437c40d58fb138c71a6221ecdc0711df27a0e72a848fb239c7fa3c1e7615e061db2a3dd9df34c84ea4fd5fa5282fffebe02673c719e7d7bc577e2896aa63db492645ab556f3a1eb68173d747efa57d20a7a28a77a0520163bce8fd8b2f6166c37f3d1ed98e32906734e6178a6298d9bad1e26271387ef232b11dbb5505f03183abf8c82ccc437c4740c5364a622c4273652cb752a836f37dbc4196d285a14c6bd427b91292029dd74ce327df9a72ba8a21526787067ccbf468caef8369c7bb923183fa82d28623d755746df8953805d9e69c81d434a60cab4b3a27385dec4b6251f380a0f6ab790aaa65c35e435cf6663f8710d6787eebe7f64a4a7c7cacecb3614d0bbbd59f76c9beff4422fdfd218c8a96ad902bffa07c4640112e35383b34e09f0ee94727f374df70d4688bac51fd707785bf6f58de525845913d2ec43dcff5597c5c4763080d4adc9bf36d3fb946596243580709ca7647dbcadea3483931f43b796640acefc9f011505f4c2f6aef66461b1875f290d79463964c5d80169c9f0337526613b788e93ff84639281d31a7b97f48f4d9fee36567f2f36eef478f599855bcd2bf864fff5bb6c2a4d516c7536fad1135f3a017df92726677b1253c8b42bda230a2febf0b755c1ebcec4b2b3cf3786ff4dd4f8c87cf0ca18a52f24c66bf23a8bf1cffa7f687c9183009423b7ecd7f2ec09a6fdc4d3fedbfab35f9c843078684ef84b1e80dcf62ada5d62924642b14899b076e9682864057b3806bfdfa7311b3c44ed51df4aba9520ce9e9d73ab0148070f43a08b49296396bb65b79964e4ecd942d91ff9611f602e8a0185939e5e8cd5b6ed8e00a008046d5f964287c34c06c9913d3a4af94e7d7826aaae11f5afd083d7a3e9c3eecaf7713b0c666e58cabed647c7a194cfeed569465e9f93e3ecc22a52ab379daa559987ce9656e4de152246e5d52e72ce74e565765fbe9ca250a53b9919e716783ff03a286830f25618ba7027ba1fabce86639ca9a689e56d0b19890f52c83c3048e29b580dddd1eb1cca19b771036bdd72d311b1a67a10b6fe42cb252d0b16b3892aa18a8032c26449bf5f5e2c3c0606a9d83c71b1e79cb4c9ef8404a95645ee75a2b87656423254f45e8ec1997bf79fa57883237b0f03659c4171b2fe9615835b261d80b7f045f0ab6c9b519e4c933af955f6888bf43c7a00a2784636554b82d9506c3a6f1ac256d77f77667af850c5cc06b233aa45dfa11f77387f09383b70c7aa3959f12388c480071b5f89acf16b81daff800b710f4c37b9b96e3cc54a1960f29363d08ed6285f3960d1e509b7ab7cc149203962fc1c9587f3e7af23bd1e7cf737a14b07e9708a0e0229c35c84c7ae31b1737ddc9c57fcd51693e41a2fd5c92dfe853d2b3e94bc2c2670585cf461efdfb172c1bfe515c77ad18c9e5d0bb496b289808665a02ee4237b29cda92313c1c17405b4f0ec25d9e74059125dd56006aa8bca1eaed0519f51e8570c88872d544dd9ce86a7210e02832e6a7925a3a9cd993a077eaa9a109f0749c192cb58153c84a454f29607a81ef008b8c77fca184e0b600ad18bc0ff15f02fe2c78b880e6fbe657a7c3b28a722afd7e859701a1b3ce83f62c660258f862fb48876a22b304eff85f54158cd6b7d469c212d6d5a25574af89efeedcfb3b1680fd931b8640cc9ca77ad7a2042fb359612157a6c0c7ec72772b91e2068b0445ebb46ad384bc2e8ab7a38edcd50787a4e63911ecdd4e12a52e8fdd2f2fb69cf8045f282c9ba10e12a531437169afd677495033e34caa585838f763f2eb1b3005b5c5d0937c03a1335851a57dea4e9ab7961ec3e44ff658548b3aded3a1c5f477656a693e2f22f580d0917d152ae97bb0c4ee110de35f375d6cd85caadd9d62bb9981b33f6396d6060e44077dd4f1a28ad5e4dafdc9cc1ea7ae3a8d48ba3fb93053d54767dc5665bd70abafe69d9d64ca1e090585caf2b0b717e602b972e9d4ff5e32715bdd6cdc1831f7eb7d1deddc4046f8899a84a6d231a2a4adbc3cc1323985ddf3c828f1c1c9417513138b2bd91f3d09155464e0d6e2cb7d25f3bf51fa5af90a5b102ceb0b981f08701bb867e10d473008139ec5e09bbac52a55e644f426d50762e3c6754c55be90a599e79eb591e497e3d2b67877b51897a409864ff587582cdf9eed396e140a37da077a56eb1b04aea1f8094a65dbee80503458e4e7a25bd1c43b210e8094103c055925fc9723e6972baef799465754609a26e86383dfe4384eeb3ce1299818e73c923985e9bd96b8c15f6477131964fb43df04eee1ef0621e2d6cf3278018a214e94cbb230b6fedde0a1477cbf2129d89f7283972ce6e6e227f4571429a34c869e5da31744c88c01e65e6dad25b2aa23db25960f62b9fdf9e8ec152ffb6cd0071e307935dc84ebd2c59d8ff72a0b5505887f429c1ada4f3b223c32843baebbdf49924ee8f6c19dfb18ace71cfe8577fbfcea5ef81e338ec466749b4934a6af199ab98a21008275a9de1a6f78e17ebf18ef51f705019a526a22f7a0e2a71c87695b4307da18292ceacd53daf5b4f468e8fdc571a97c127b04c852fef970b45f2f37df33b960d008654ebc8680ecee9e4c78368fef7ffc2df030ffde87bfe7b15d6ee3a006a1d0e66195028264a1317482af67e7870cd3b4e0c5f7e134f1c216f4d1c25f8755af6af7c34832baa77ffa339cfffb3fe5d0871fb1d7c9f8f4f00d15c3b7312c1cdad2e830bce1a7a3a61c3065e14336bc2ab54220af89d79e4c93f59b598c31b7a6a03046054115427fa5f93fec979e852914e60f4c3a0791faa8593cf421aa7da161472ca6d36bdee95d12fc7b0652bb50d0fb13591e9a45aab379f50cfbc38d16e70750aadb80c038ef5ac262f2964fa8c839356a24f30605119a95a8f515323dd3044e7379dbcda323c26e899e0968349fdf3fecd46bc3ea56131f586d565a9f1d0eb2d5414574b37369c86404dd43e5bb1a869cb955b095a50a38408a935b447ef0441145f236a87b8e1649853b92e191f4ad817d4f6985e58b02fbf5e17ebb968abe2af19f2a770f7b063268f86a0f6c1324acbd5a69faa823459c7b21180e8bbecefbde6f6d4935082a625170f620337eb6a608fd5d47a89ec88d0fc5249da6c4ba44c3f09ef49e3879d720f9c47b05a95e4410d1c3d473cf34897959ef177bfe24442b9fb595792d3fb69917881148d7edbd62cb94a84fb1c336575b8b8ec210b20c494c40dd9c153beb5f37038325b0ed81c0fbb572f0e286b9e9ae5e96364c418cb34073ef85ef42133a7b4fe780cd6f9eef78f1fd89d03f4f695d79bb4e19237fc82fbdc0db3c83f62c350d5ef15db2711d1835d6d80cdbd428875e39c5f01f115ba62714719d202604a09bb2a6964f8cd50557775af82d8dd5609fd45cd2d0e129eb95988de8efe6067244fa3309a44be75a96f1730aacfdf234751c570d09f31445cca4476700c8e5df29aa007956a8cf179801a86d5b0ed277a9e24eac17fe65faa949b60430c053b209e3a16d103cf9b14a7f83504a8335255688bb5d90197eaf586dd5441570d28675df33d7271fa8f68fbd6631fa89b14dfbb3561c2b914bcbba06524bbe2db7bb9121c14c85d96f488540da6d09295d6a534afe3811080f18272e9f5d36e2bb19dcf339d3ad87aff87ec82e60e31b2171d7ef36cab0379f27aaa70459450a5f039b503c78c69aa51384d80f342c1681830ae5ad7e4753a915da43b26b8020c21562e9436632d37ed654f850648ae8a8ffde80d4f1d1379163cc7e31fca29ad9c93b42252c42e030d8fc3958cc89592342eab2582f0510e5802c73fcc50055faf9bc20bf9aaa92e9b9b9d0821433a45c416570b9258dcb1e3081dcf442172d15703efa51ef09f657a31eab2950286ade77b5abe64bc462c4867f41f78828f49ec7b342e100badf45ee9dc3d798efd1346c2fcbdca189dff90193c9ac1279b4eb1fb105769721507c0ea2faf01465410f377c89555ec4cf79175b3df5b9e6ca0b90474f97e8db842a3165bf64725731c76dd9732c51cbcc9a657ee60426b5d026e56031e54a541632ace50b0b5cb9453e25e9fb1b88e68a66257aec3cca0f1d86bb66b98f99f13ed61114e978a0ff8e7e24c9b61725cae6e1c8070dcbedeaf4a17c6c950545614b2b176833d28682b1e1f544edddcb26ddb8b0e3a8652c229b4d835c6a7d0ca5457cef07c9ef8f3cfe6d6bc2ebad124c774203bbfef868c7f332fb3e90147465870828aae1620cd2c6fbfbb515d09cf34c70238d9489a419474a99a134b5225a010fbcc4ef52b938c3f1504079902f93e2cd3fe4eb9652bf86408bdc63d387d24f533214a48ff182d0f28b0ff77708ae80f9805fbf418ec9e03d9f96bdbc418a298684601e8dc94d07493e205e78832d1af0ffb435bffadc3d50faa8585c18438dc81e8d757f2663dbb8fc1af9ac50106302f9cbaa3c09546b1de16785ca6856d3a9a4780b60f0315a99689f4386e5ca5f677c22007aed3342bd4b720cfad35afe393bc5c4909055de6f25a0812b1a3ea3f23bbce16a47cdde25b1e7a719347d786475a7da9ced8fe6346a57909e475d24babfdd8c6308b812e581c3d41b5c1cd448e794daffbf97aa4c352309196baf2160223da47d8a6318fbcf790db0b1ec70597900c678e908268b024b0304e7232eb1ae9a31c68bd654c9405cef61909f33e0db036c3d9af0698c38df5e6520af0974204ea8b39ca95e74cfa18234fcf98c8318ec8a0b688bf9d16db78c77d7d961d42d517202311c152e89be9b194a53190d9bc1764cb0af7a488f1273589b1313f070651f0ca3c529054b6e382db120dcda9074a1bf3510512f9ebd9c8914865b751e376fe9d9cb3ed43faa79e1d5c624d8e43d732410c7b30072d70a7eba1afe66c781df420a84fb378b6097821892e9ca51c9378e43b74d6110e7ecb6d8bf5f3442e5ae654a125a96309c3de080f21531ab2b0f09f25ab94a6fbacf44da073f9e3d8d92e5d96a99a484cf3639c413052d40c64eade4e425184b9fc898e4f9c783795095e1c160fffc46c45457df9f9e57f9d129becc2392c7c6d9acc4f361dfe670b0a7932626a34e79f73c9255b9853a56fa40258d04b31b519229ccbcc0725003f46d1d832fe4756e9f86fc9c7c50f4e76f0adf5b814cf21e18ed69cb7647ae3ef7f517dedf7ecbb7c50c7af1dac435db89b5fef9ca372c206b50795e80ac959f7a8d58ff836b9a42fff8d6678730c21ac27dedf67ed4de54b892618ffbf1dc46ef9eab6a80f959d138f4b75acdcb97b98e1d760d21e4ba24b1c437984b18f72796668cf358e717467cef04ab03b09d7ff645ea569c1ded3b0a08be31f85684ad9d99ce2b718afd7d0a025932b777cfff61954cf33a8767dbcab126aad7cc36f582f419e5dc31e82af0827bba77b5c59b749094d5e5c3c106dfe9b28800720363ab07a7f3e36cb8f22fbf2e196000d6b8fdb334e238dbbfeeba4895de472cdfd3dbfc8791cd28f83db66b5896543cdb8c52439e04437974a4e5515b6a4928880f8780e12902fba6696ccc6f4225cf7e58273db72ec1be8ba8595824f20a6219d97ac97c4e68be9ef17ade30fd181fe9302855ac12dc25e4979c1f630bc53622f42edb2b78118319fe36ad6285adae91cbf8680a8c63b98eb38896ae5c39222d31404e99999e4716d26ca0f0ae124acf006be2b8a008033dce127203cf7e0007f42b129024fd6b4cd2b4159a679e7418f79291c38a8564b93e7b39a200213309043fa9f5f4288fabdb5faba2f500dbcf2cba5d164e51aff0fd5938a4bf1dcc333da13c6408e2c580d05fa089b469b62b164bb258bdfc6e19160789302a08985e4bc3f0cd8b68e0228218af2cd51fd1f9197288187800b30a1475f512c9cfc6f46162563a8a8a23990c2ab7c396e11d3153954098bb560e3ade495579c83fce93826248050f7c38ae0938c61d220ba68f3f023aee22d11c91d50c747dd2f5f1916e3dab4031139ed51c357c056d21c152493c7c732ac8f410ba6a17ce69cf1c06551cd7f7403ef80e46e1fa171cd44cb082e1725aa95f37723b3a987a2007fffd807f2fadc67ea7c1affdac6cc784aebb374fe1f28d38a8a82036388e07e0b6550e665b6a5a2314c794dfdacea572e33f2c609b55f31b102a316ed3f10619866b80579c5744e304aee6d8e0774eebf1774f56ac233ade43555bdc7e0c2e0b7cd4cd6dc733cc8b4e2289ee8170195efc6ce019c1be797403aa85f5f2510e9d734441f3cf19eccfd0faae8325efd24966b6bc3e8fe1eb8279556488ca79b899b6fa21493e95ade14bc2542cd5d56d4cb9673b3e7bea152e3e269f91c7593d45914132cd6b3622b9c67d9031937c651c2fb4bf544647669672160f7c4f0164417071c4e63d159d2ad3b9e8d07d62afbc84b9f478f15118e778d8bc187a86a1795ce462fbc2bf01d7af814881a6be08df41578b1a69728ab4189378787d17a91a315ecaaf2c551f0f747fee5b4166568f854c4883eca1465af96282c062b08365c71984a73b256dd19237209f434b9a9b741cf5a239dba5ac84cf1654a1db4c98dbf9de2886048a2578242e363d804c821f95db4434d3ac3cbabfb2f0bd7a3258abd974a32b3aef5a20a6a2681ec6a1cc79fa9e7c85b79acbe1bb22b143e75248f7335a3a164e9ed1f13ff92441cb1f3c94974cb6f3ba4b4902bd4db9e755bc4eda27d0fd58292ac7a38721e3109cc2365afde6fa5e876150e3b3deca62666a3c6cd3451f8dbfd58f423488c2cf18b82371de5809bffd8187d2a41b96cb26ce48575f72e31b1c57b64885217f81b0d5b412ae6f18f96618712415242b760a9cfed120556c975dbd2a683f00e754f0859778906acbf93f6360564e4d5be3790053ea598c7bc911ef9c366966a70c3aa7bac628d245a6f2259ce85ceac2a9d98d778bdaad7d8da13e8906018e37763b9c85a8923dd5521bc6506adad396d85cb9242d3a2810aafd54ec455a73a68a6d623adfdddb1d3f7cf39f7d8d0fc95c27973833b23a166edabca5b9e6e71f7d500b02c6b4bdb7e6f0dec252525364a3c3b9417c624976277aa472b833c769f9b96d17ec5e4398edf59fe3de8c763d3919d91a4ab4c09c7c7f3e6d80d42ae49181739f4c2c1cf65caade165a9ef3952b78bc598ad386ffe8b47026fa5261c18008c8dddbe92ee4fba219d8f99324aa8347d4b106594f3e4321ae1386a3c2655858fb9dc17966d34555b9f8e03c4f5bf6ac724158965138cc7f64eb9eaed87d31d86d53e8c07406d6c4b17731ab250273c8056197e8a6217bf611be78485a2becb310a635fce7ff10c3f472458ec744dc39cfa7f5a557273d210fc54026d0eb8d42a3ef6774d153f434a47e709c2c2a10fac9f00f91eede28673958a6ee0785d5ff21a8b8bce8cc581d9efcca558012847a85975245d5a899d05498ae5869ec3aca41facfcbc3b947c24023d28445ba151a461cf757a6533b505f91b2e091d49328d2939cc4b4cb5e1548850059c82b7cf6c1855591bc53d1dd90edcf21f31b85bd0d1ef771280f887631f7fa402034e62fcfc5b6dbb4c05885d657caea505f787609e55eb9746ee7e4dd65340a0d25cb41e42f63f9dab35f0fd8b3abdd5af84f79e4dbf36ab8ddf78d1a64ac3032790b6451e16d9dd9ab87419e362659ac015be8caba3a0fafba0b6ecea271e620dca4a900e5d1245cbd0fd9bb20e52c91895cabba4ab917a6d5228a9fe1a562f232884e848b4cc3a162e812859451023c8f33eacb519ab3afe5b19aaf708c296bcf3724b7775771a2888424f64b129e0ad770de9e3c3d3c5e000c48d089e67c13996780bcdfc11546e963c670aee0948e179377d4c78419873a6b1c53ffb9e40941c436b0d4a34b3579dced47e88255dafebd1073aeca354b5e64e886a9c6f69eb958c9930c6e083c77aaa6a78a4298eb745a2ba59cdb127d4949b6fd0522057e606c56e7c31f991e5a870cbef340db6ca86fa1a986a710455dd8874d1bd62b1e331029dbb618e66506bd753c7f188bee0a9a429a277ce59067b1bcce279150336fe81056089bf8c71113215a135beb735008e5425d204ea41bde53aab141d68dc4008e51caf553db9e696a8f0c2baa789b81bfb933ec8dce13f35c8180b01aa1f3e9c71253c637d02c58e495d36149c45cc21a64253adc6447146c296e39334473bc53a6c2d04d3f4e2f5f41804ddce7d0e2f2df3d10ce7af9d8b69c9534222343b93b747be2b95570378095ceb5c0879e9c1375a613954cba380d47f903d78b14b1b6cb8add71c36f7ab4ee3bcbd934e69b5f09fdf2f18063f5d46c471046896a66297bc24905a403db65d8989e09e4c7fcaefcbbe9243df91ec5d9505d685ee24b1965c3a066e4a56599dbaad61ec9071b3126c46be4aec009e52b6e8b524c137efe4647327ccd1fda6ee182e0d36a984ede6e6ee39c17c00492825d4ab911e44778f68c7a9eef2084f13fe290784c8b80f9060664d98bc552d8692faa378636c1fae47012880e204a7a914d46d81b7da3500870112af566bb7ded7964f94c33026fd149b68838105b863792096d0ddb1b62f3a8bbfc975db2afd2a5e8ebaec059e1fb103c643d5eed58dd2ecf977ee3abc2fbedb3dd5f2548a73f8997b87b22af008561b4219ddb8f862d726bae7edf86b0ce75d1b6b99c73e1229bf06e2ee3be086b9dfa5f73dce7d119c745b71f77962dd30930aa89013811a1e09fb841ab011c3d35d4edb6bc06c25790315c1d87ea8a8625b58775d3f076af24427fa914669ad61677435af53174d01158820e6af62c99599ba53bb9829a9a6a476d88c6f75acad813fbb248a1d24b1e9aa38b45dc1b7a1042c182de67348bdc219e4c8e5a6d0e84f13b38aa199897d4c6bd72445c2592ff95be659850dd5ab7c9202bef64260b0c6e3e7213858b37cb1ed174e8958b7766e4d4a4ff977957e15c4ccfe3db5332780640cfcef0e2a7c0cc5d734afd9d69acda3be31aa570d4710901273c24676b5e187135ea8f90a91fd32c2d9703e1e1694010ef3c847f719eac195597642f25be06d9dfcd3f60a89d9790685326737dce0de76ac365daf8ec692f08771e6c439f5c7d2197189dd929880601861b235cbc90f5306ae9424c66e72f514f8da295b59083163dae8c4a5fb46e547040f99a717f804d08bade8104a55d713ba4da25afcc8279865aa07a28b988dcec900d782a26a4b222222e186ed889cd2e4881986c1bd1bfd0e50d2ea45bf049332cc439e32a722ec1b1fbacd0de8d1662d9b254c5b2cb15f6e6366dc36e3dc9d7c42de6a1b3c6855775cc819c4060fba41b9ed6e2ae11ee5734d5a1887d1d451d133f656b6c4c50e160f1dd703835262a27f100aac9ecf3ccb261e72676ad72d57c705d344dcb364464786115eb612867df9c55bb6605999a553fdce4b687b8bae0fd0554ea53b720af99042c7ce7443afbddd15a1b6ab22785b9238cf7f44544fd4719872cb0d9be8a356c88fdbc3949d84879e2cdc7ccf2cc2f625834d21048a779f71f388d5f40d0057e864cf3ca83a9d1c78cda3c08fc72635b6522d3322ec6cc78365fbc9aa50fd0cc22b78ffc2fc26aeefcb8896d92a47fd0717f13256ea9f3a617aa5c49ea74655418eaa2c74b487b6948b3441d58d106d911016b443a57e7fe0b64759a57eb7297f3bfc72aec1795d0a26263c4a929db53ca7d71c03002e1293a7b7ac7f4929b8a554bbe6bf884d9561da0772bb15339726c1d6d9654fc38bda9bdb9091450196956d244f00bbb514fcc088df048ffa51ec580b977c6b60906e979506b86a3662ae91d08cffa9bcc77a7301962c47e9729ba94cb9cebc30e89edbc53b5666b0ee0fe78b4b2227b133004373fe7e4c70ebcf14458b11d00577f30c70f7adec7441aa3eca833c593a1565da8963273fa557aa896412c3a9c7d666e5c9e57a4e9797b980c47e435b7d596606e066ad54c23ed29bd3a2eed1f65cfea61321a5b4fd89464c21e3765fbfc6ca0e423269a6ce97d8b34c974d5ef926a82fec72e07db2e562507bc81887631e81786d37f54bc404bb86d72c7ac7be34772a6f5008a6573236a26d704bc6117ed5ca7e5b132876dbccfc73f2ca1b49e47490b0a7ce8eb479e8f095654fb5a507b519910ee55947565789b740070800cfc519eb8e959500c5476d2f77ef0c7b7e55a4c7e20a460770637f7b83af5b403453b9870e663673ce8e1152efc1e91d1f5aeb73efe9fd6c13fff69154fefcb62671d131e9cec771191590d997fadbdf4a1b0ad2198de08302935d7bd116e010663e12a57e27e507732f025c41efd678a16b74a617689ae013a82e8cb21e240ce7d4fdb1a62af094b0f70c6f6aa05cd2ec0c1b4d1b367adad956efec8e3a4bb9aec0b90b05b52a9f2fdc4b9a916b436dd8f95e62fd5e5314a20684d7fab2bbef9baef8ac51ca060ab2d2be7e37aff1d9cb613adb2163fbfb23c52f8dbbf916d20e28a34f7da9a633ab90b79a16b0b5e8a19458f56a8315e9760599debf4b3169509469bf6b611234e1adb157d72029ade77cb41bf4209949782096667f3152a2b311c8254b9a9064734868543c0914134e8f38a450bbe08401363ca976e63001affa7fb44d0e8ac52a06d12e159d010f83dfe4e50183616a06369af1a75d584e1deca4a6e4e013c46345138382abb20479460796373d48397c56b77645cbcfe312b7aaf5a224ace6bfab2de33cd06db4dcde3c57b619021a316059bba6e867eec98dc59731740533d35c09f1001295b977f851bba1600595253a0c58480c6846d1e460f838b36055b8cde960789d2c2d47aeb00c493cacf4d55a03c3e651d7bc07ece11b89e3709f80cf647bf3a9811508660bd5e24de4563edf1926f84ad64d12eea205ef5277e3b97011374f60061b06430c8c1816ddc92fdda1b4f25b6554aa1f094df8e67c726751b8af6202e0ee61bf29c777c4a9f291f40721c62d3dc3975390f3cd792bd993fc3ca8f250c665667fc3e06e51db7f209dc2372f0e9d14a35fed7f0ffc017b2769900b27dfcd07f3b660ed84145eaad52831ec156a87a39ed55479d76d16273f8e8e762f7988a8b4d47956420935240868e169a51c0437241e85ae02182c845b19231f138d64f69f282fd1c3d3149222b03d287a3eb42dfc3f4afe53e9685d07def1819239bb7fc11afd3d59fe2b637c0c1e62f58de7c5c04634eaba08fc677af1daa355f163ed2ddd98395094fdb1e91be72bc803016da2d203b7483cee78d5192d33a4af88f77257dcc32ab80d8ce6d402578b01d202df82366fcd5d347f9afc74df4bb5e8a6e86f7c203bbbca9911aecbba9a929ed8048d12971eb56bce1f02e34f8c06f9cbb9cd8a8605189b362ba8f25dbbce3a0f8293ea29efe62448a83079c94efe140ff8f7575b5d3a04038a64523b7f2cf90ac1dfe5f5d06564b52c06dab9c2260b55441a02cb5cfb594853bb5468bb40b8eb0b67a640920522e2213e5902f6e6b48f4fc39b60e411866ce1db0c71698b74aad22390635ecf0b1f9ea17ea398215397047e9e358ee4faa45a66bd795f541be27e0e4a4c8172e5a79443867bafdd71a5ae9f04fa728a5da8c55633f7d0d800256339978b9cdd91a7831f7e38badda26879ab035d532ef51e07bc006624f0ab1f6d45a05b9a124be9cdb3f0e1ec2e6a0a5caa09d90bea70ec723df80cb60ca207135ce1eda8238ae0f9401f9b032edf6e175adf8aedb03205bf8bfcc158164f5bc0daf1554e26412ed7c14fcb47a982ac653484916123d07825ec707ed73a02240afec267375eeca13c2903c30b9c5496eafcccd8a0fae1c61ce1ece1a11c1c8aebfcf4e0770e2289399ee2ef7c722bb0733fdca6a98b082bc782353d00de5a975039d0a9ffed1036ac61c30143e0f782cb93f9f5fc60ab1795c6d12da3352e488fffead6dffe4dbabf6b22808e53b3a355a7f7da127f2c96b64929da8777ede1a22c8655be1ba23c8f3694a6eced925a5b878f8e6d7d1ca59380496e316643fba6bbec884bcf06d6089a99971f94912ab9ee55b3c3fddbb91915e4e77c699b37d8bbd04257e28a2ace6d42769f391ca6ca077e33eb30d554088b2ef94aa83c07c4784fdde68a007efc5778ce5024c2df1dd43cf480bf74bbb880529c3efd9df0edee9b8228e78907063123b0ca76b7edb839e6322e4172c32b4408658429a91d872610d5c9d826d15b01ecf917428f77147b7e61323d9166f004065af862654131b7898b516184c4f3f36718b351bea9bcb223c7d5174fa1017c4f32d447eaf4b4d46f27b6851b9e432da19b37ac24c7f6c1cefe3b0c5293d2499b935f487aaa5482d40f45c7a34cfc9d55c241bb23f34c9fd261d533cd2677f47bd13bc25a548b0a1da74160c4eed1d52e632932f4d2c59549e6c3135b94c28a386855848a329a42130ca96f919cc8856b0cbb3f1117176e7686bf764e489dd511e2639412194a3d01851eb218a41d56be12a81cc060e2ffe029eb287c3c1bff384db19ba623cef98b17f46f97ba562bcad1fe043c74b1b219034da6f8c0433585c724f15623f113d8e5d2f976e55f149283e63fc81d78274a7f782705d18feb816491f9ddd81016f8bbfe8d430da01bc5d43d0ba2241a67ecad5f2825d08161e97a5e5312868e8a1a7b5d263012db6aaad99c1e7272ac28fa6fc81b611779537e66f5134ba6906479a53226a56863b1438f878dbacee259ab43bcc0b3fede9c8dcfd298e67896a8c3779801d46dddf7bc15b83ee4c3dace416d116a8b250b743fde04392388d5fbc316b41deaf5faea8b4fa8ddaeba270701453f43f4ea96b3f095cd87d3bcad031553c9298d3354bb149f1adc63896ab7487229c275e86c68ed229cf36ced003e1725b9e7da4f589a85f51a3260348669580889d7e7451cbb522fa7d1e44b92e107d7618bbc51570a7bd0fbdb77faac6b56253fdb0ee9dacce62cb02a639a28ba8215b896aa24fc649e2abbcc5c29aade4edb255d1059debd57ca59c41cfb6180db5e369bd1ac2bf4476bc907a59c32dac99f5b9481fe304c544c2eba4fc64b8d8204209a10bad9d780c831c1ec0b20aeb26ecf7c5c14fd36c163a662315374e19c914b10a394465475ae11e5c0d0dcc2ed43e033f988b1642029e0ed495b53d1c48530e9d83644edb8ccc7b3a6d55d9f0cd6f7e728b76656c7dd511d1a5dd24a09bd12a9de30031941a82ea5f491dba0d6976b9d961054f904fadb9df3ecfd81dc2604c94f2d86766658e2326b79c5fa81cdada9f9490b1f895d2b34b1cfe49e027cb2b7e739bac79c28ef27f1a7f1833a12427b5f42946daa4a6ae5df7cb72f4d94e76c6d2115e4ee46194d2e42fb29b137bbca917a4cad58d28d85a5387a6ee29c596773c92493074556fd22c53991facc39383af222a9cc5e0dbfafac17600935dac7b486f175e68562988bcbad3026751975d83ee8cb68e58ca407bf64369a7ce4a272339ef7643dd89329f513734e2f5f6583c25541492142ffae9d3ac8f67156326c530d9f28e2f671c0f2fb1833f13b90582efcf8768d5ad90dd7afcfa2d678b84a2c12ec37a4992e64b5250e0e28fb8dbe07e965384fd564c7d8cd7ceefaa1e333dd82ff5131468a469cdbbd3f5a6714db1e6262267b0cd0a64a63880408000856d4f00bd026a7ea99b6d74ea15d431cfbb745e79349ab88168aac9c375d2443cfc7f6ecfb1d3bedeb3b9eccbaf1490dcdacbd7597f632175ba8b5f5bfbb5a769c1b3f0901a5c19ce5c12ba4f586b1299371f968ff06702edde8636b735bbf688385f3cc4905b76a3d95040850598ca661fa66cd8f168092cbb3e4d477a8ba0db4b76eccfaa78392e658559539790729e2036f4ebb14676b87c9de4f7e951ffdc71b4f7933de4df7d818da17b14acd7fcb5171e6f40fc386de7e385727b0d7364028400d61b360a9cb8217dc815cac3b14fe11b126ab3e66532f4e6e73be24c4e1d71374a5d6dd826073eb6617ae374ceac2488b22b6f4a89939548dad8aeb4f137540aebe3e5bff7bcddc888498908f3571a80ce0be510cedfda82274004283966cfad36d40a8c1870a2b7e3cafe30e21ecc55e384fa95541fce51771dd7e522867773722bed998f4bacea4b6543397014033401fe2d050697a461534f44999c7cfa0673c831a95af6531ceb6a66d7ed6af7c1c5dc5572bdf6758f0fd75bdd8189084f95415db9f22ba0f9a75af5459722561c6340a6d74373d5713c64545024c31ff6af78c3972051646edc14401baf77a35aff0870882d58d1ba898df42b841e0e70b91a9747a3a4593c02e42ff1d2db6371424d3701765c853573af794ea92d5697a2a3696eb71750a1bdd43516343d934057edabb29821afe50a7c48e2579a44f8d87dfe95df091e50b7700b808bfb59de1c4e384e8ce1e291a5757e5ce87b91874075650a0361cd188e1807fd868a628dd9d049c9f7882cd6bee914d642212c992294fa46a7305ee2373e27351ead36b159f35d4bfee8a2712335e7ecd91697ae8c7ddcfdf9d7821b131b874911c1bcccdf1158672622cc18f820d420644ccee2208d12842c32eddd01068720a1bafc462ac1edb7f131e216341a6fe541f3bae62df5ebb1ca922519cc1269efb2e5716f31604aaac9f82bffc2b2ffc0c14bf78390e0cb32fbe0852ce874ad248ac7773002c21ea78ad3a5bd47b420ecc38d8454efba85dc917d5bb08b6ab85a55c8135912ca221a98cec1aac98d44c66894a6bef36ef072e1f1fc50ea479dd484a6f609eadd06fcec92ca28f3fe594c540ed4b1eb4d36c9d2197b2ae9c665511bce4b2684c56509678ea073e98ff16f1da964c4d980fe62cb7ffcb74c82de5c93789073be84efa96f987938e66e1537b6543a5acb91a6dec2c19bca0b466b982d8682b89649b9e0b4a00297b52eeaeab1088caf39067d78fe79363daa444b84c3b1c8b2e8ed7b813887ac189fdd993bd6ee1fc5e9b44d40d01315374eab2d199eb7da3576f6893199c06e118854165d34e0fb8cb231dd3f97b858c29a29a8d302f05fd32936dd8a7da84c7b9f3f9c35caeacaae4f0d203d61e39443f3a7d8194b0949d4612c4a3255597f0eb3a87cd97884f7a37c524b5af29b87cd8bbf287f8c60987fa241634629e63f49f92c08df154acac72c3edaec70f24f2a307c26c78373fd6c595f967563ee4daed2e273eeb61a560846c9b18f7d7e133771c78e83fcbbbc48c37296bf62dbeee1da6f9a537bb6107db39342f20c42c8c7685bdfa59f36234f511685592966b4e7660269c5b863261bbd4222e8422c0fdeb289188217bd8fdc32eefb0360c220eaf2ebc1e3d5045e9ba7a91e76e80f88ae9a25c1f5bdbc02a2c2192e1046953f53c3d480af9d8687f6ccef08f8e4bbd234afd72b06e6039f87255e90c433efe699b2d232154d506507a9bc98dea9190c6f81a00b06a6319a4a5b064367a1b33b718bf94fbcc75e01ad1d7a600e5c765ca5b9ade218b12c55c6433aadff0983235415cee28ac0890596a16b5a4c7c696cf3ca7dc5d0cc320bd853c372631f7d90bce6e95934cb95027116c38cc8a018cdef8db16a0e91f31feef088414ce95ed7e60529d3b70617546ddb27b3e8721cc4df6d3f6452416bb8e501284de33ad5ff16a99564b6fb042a86abc603a0bf1d4c46766c40e9f5ccfee8ebd463e0aa4efead36a92fd7107661ed13333ba8ca4879399ce2380b8d56094127754bb75d083a78aa8fb99f0f42391b44799498e2eea2ced1854cfd9e63699db9b6402db44c5107eb4e8bbb8a17e2b1b36a16541072593784167d0c56f71632250a1a79790a8913d1eae4a93b387e8ccea5ba0e29ad2a8a6a91c60bd6d633cdb98f54d97cfb8d0a334ed4f8c40016f14c1898d9bbf3d331fa9787d752301eba1cff7092a785f80ad2103fd70f03d5fdd3ef1246e5e8655a04db80dda2dd92e85bdfe2c5a159db4bd5e35ecaadd5cf33a9ff5c931b4fc0c0211ee609aa8ecb9b9b00ff311c2d7122742c0bac763b55656334b400be4c884f8de45e3c155df9a953d936e04fd27db8606f25763589f6db08830888d896bc999b5218239865e0b2ddd1651e6e0aaab8d286cf5abe2605e1ac8aa97b26d71a31dd93d746be36fda3816cea1fdf30288a3c3dd08e81d1cd4f437a9f5e24b5c71c8e405e7062ab2775ad88314763ba1aa3f87a8e995053464fd87ed9be683794dca7068aa1fc0e747ea192f3e0cd1c6e64aa22883ef92d55e25596e0bf015b5bc63f2342c8c94fa54a7907f47741bc12b0b779ea993e08d10ff6f251b0ac9ad14af5fb2f61d2a0a4df24bc1f25bc56e32c9377bdd7f2cc770d29d8496610e7322b2ffbfd051771a9e124662ede59a13213f1e951632dc120b7d1957a97d40443fd0e6bd081179f3c5c5815ce4c832be6bc190ca5bcb46c31dd229a3cfcfdf84156611d0f8db1960138dbf73b3f8d147275f48a307b706b17aed0266b495053530c40700923ae93a2fbefcaa26289d317d2b364544902fa93a16e1320d799d6ea62886c258ee9b2b155b57a89607fee108a664279fd87fda055c0a79bb614c213a4afbb1586eabb2e2ad95ec8ce8df1e69f24eb6cbda0a39f13786569c8dbaa47b1ef408fc11ac055b8d03e8a63483fdec48680a35db297b5fd8dfee39f34ed193d5385b0c77ac48b7a29e258fafa88933b92c18866e4896b7beaa7cc12d19ff789b197bb4e0cfda3ec60923893a6fccdb502d1806c2f361669dc9fe1a74ed7cdeabc73cf1a1f1a1c52840cb77eea7e4d39645158fc3cf9f1824e7d8cf21fe61a83348e9d91c7dc2c33d98bd503b17c55ce910a86e00e4dbe4cf1273b93c953089cd2dbaa1d2f48fa773a73463f54b374f3a6813af0f29461b944f4ae701a5febd1b10faa9cd26691614c70b156aa2e4c9829bba24625b366dd4e6cb6218e9480252dd0ff4f72f37533cbdcae515c2b0de4bc231cc2770c094db5f6d268299ba7999956df18e395362b0d7fe0746c2913c31b819769d1b5aa0c58196e90418f04c0d64932c2996588910485b0ceddbdf95f71c8632be789c395ef24a5511df84d12d287879379063ab399d899c983817f6637cff3c149cc1125d7c60d871c205e1de828aa611dc6861746965506812d0b3e7c7b8cf2838db1b0ab2186cc8f8d2bc485d4dcf89b2c1f4fc7d52e4f7481cd71b75994b579bde8c8d639913849f472c62b45504b2a0b2841eb790f63153e6db854f56cb918866fb95adab17e9913f92129f49b48745095857e1b735119228ab5c64359e5647c109e7440f3f754a0ef88c103f75092e49a9266d3db0dbb8c0139a178a91b34fd93229a130071185f183dfdd975b0fb1585c8304e0573e5b345e22037445a8f60b79eec31f717fd8d46f21b46763b27127a8dd44e2121e60f5769a055a7fac579089c605445ac8d2db6075f705f1b2fc097133993c6f7211cf1e9322c5bc0b2f624da10a18175422b60cfad5dd49a9e1c9ec5aa1c0b7259c3f6b9d82f47f8c096b802b812b015acf0e7ef13209824239f8c8899cdd6e6f927dd190e2a42a0e66d68722b7ab9a991c01bdf04cb8affb1cdf33f1c3e076af3b7dee372f04a43b6681802c5010f91b00237ba39a42bdcf0fa5bc1bbe4ceff057615154b11824d947f8fad2a8b857d01bb49d7c969a9ab3cab9970f3f180bd69a74add5a359024226b229be4a458ed4d955905fdb8376ba4fbd9af1d7fbba6ee701dc2495e264520637e01b42be4d962a90a84bedf448ca29001e3f2658d9c0608f55da6c3bdceb39499b494dcf88e9396be798ab76642c811ee2d5c438b03eb71b1c20fd89706ffebb4c101497fac1fdccb2bcee1afd0b35ee347c540068760e9728eb743cffa1c75c5179bb8f1de53e5f64484b858dbef1b99efdebe17e98b57ce52dcfe652aedadd41855eaf4e35c1527d13ad8e689dba9b6b03e3ae0b923b73afbba561eaba1c70c0f1b14e823b79ddd88769bd02f0acc5695dc4dbe1bb331ad6c88d95a7c803c3f37ffc02eab03d8f838e560b24538fe7bbf161bdc157a3ad565bca9f08fdd842525b0e88da0fd0bbe11a83f1f574054e214ae4b02c177567a019d8ea8983c83b76465f011cab777df48b4f7ddc78cee829ec61bb2ada1f7d87ce83b2ef3c00d4a83054f0421f610952892c78d7d24d4ff39b89a1e3634af3bb39045dcd021230cb80fe1503a3bf864685b9101d4814142e7482ab62480a8e0436a0fa281cae4bc5d1dba44bc0e0df64e328d908c68b8d17d5c56bc92b3ad0ef82ac70c86d94e122f0226be7b43e93541130a81a8bd76479d020124253f1f7cbc315d27407352c47f672bed0bc52c80e65c3d5bd76a0f505b33deaa94dfd222bdfc790804f505016c3632409fbc72e631312fcdba609306165901ea678e47c8721883548284b3d6fc9b88928f71c305d512395ca8c94fa210cc5dc6a019d6aecee4eb9edefb9bc3337e0111576164edf861e73a94d906e3c6182d7e90c122dac9c2d073fe940e446564dcb0f3b6a19f106319e1feb953e274f970b7b1a1b24b2db710afc06ff3bb4c6655da276b3c595432daf9472362601c7acb6ab01364899dc5836cd9f47b51a6c368911424953df205d534b59d0e92c844e8ea5d90f84ffd407cc354ce68842d722fade283aee2e37bd0f7d40d96151a7233f4ce29f10d0da79c8d1cf089ae2690420d852e935f7bc2a0247b3b7e6f68ed2477da93f264978a944be35abfc8ea6b361c65f9c89925adb906d297de5377777f6ac36999c75e7e6e3389e04e0ea5d61c2ef4a09deadf97fce51912e9c5073ecc058c2004c329a575efa7f514f61e5b4b9ae39d649e08acbfdab43de9958ce2c809b09b4b398db6f72d3da177f7f6abd72331a264100c9fcc7369d23fa0da5ed17e92f7de0dab12155973866275e40e00f7612bed2b2d09a08d69daea4f0c884e4dc7dc84d16ca7b292e96f7f1e73562c17a64e7c993f32177686ec31b8511e1b6a4e831bedcb71081fa3cef0012196c65e6b5a8a57cb0c20a6ae797e3acbf9bb5ff19260d0c925bf7b6fde3291965b43283fd2a2d0069e04516500a2e47bc13d770e6e6515299d1bc7645633f4d85a6f0d752fb8994fb38690f9b19f8330509c6d623380147d965c2e79a40a347abee6a329c5d9ccd298ec14d1ff92ba6bd0814452d0f0b8f7489f016f124215f73f1afc6ae3a889a36ff03824f230aa99002d665bc77359cf1d5caaf28b914fb2ade2d4078be1004f6cd504926934dae8a5f1e6505dcea8826521506c8509e9f9c202ce96dee8c6eea90408c6240b44fc94f73e127e730aa1964fd4d27c5fa762c79975801411760bedb2b50f7ebd4f74d0fd3a192f77c341ad4fc3b4ae25e16b4e4a92f4a18c8fd03cb24563798ebc3c4ac07b5ee53365274ae8873ff7744f29f8957264a5d00f44581b1425afd5e6f6d1ebc0c8ece226346105f75e8583628e25d324b525bd16614bbb08cf0b328075c789cf24f7d0d7648eae9f35943abc0107c523e3a9eeb40260ca4c4081bcdbdc52ebb620fe7589334d0547efe3b9c609b3245374e1d7025dfa342663a7a9cf69c9035bb1f239b8e7aa4b700b1c353f47698c8e80e9272983c6e781f40fbb72db8dfa8705ecf265c8bd0cc8c13454e292d33ce371d06bdb5e1aaee3265489f8d3e9526ae94899a20eb1d030b256f45752a713497c94e48ea116015b671533459770750e920f1cb33b45ef7b62e8c18c83f83a0d05ad109214321ed759e3bf0af49dd4d96c49d2064d7ac6dae88fdb05d0f73e10dac23e1585ed28a60c3d53a8dfcb715ded159b8d5900749a63c000518fd3bc696f3c05a3b427e751b129c5be08a6f6d90f3d62dc9f96f0842bd3fe7b31c75199828e9161ee1bbe1de3a640adadac7577edc4f3fe595f72da34e6403e268bca6234f7f898a8241d34d10273ad786d9fc0cd9d6add7a71ba76ba97e072eb3c3bef0f64fd0ce3e8a356129b4ea4631e26dfb8e356ce66119aa2c6884c48b768c5b7557b78611286d98c972a8c0817a5022766bc83e28d07351f15c3bc7ab54083987fb694d23c4fc11a5b1fc52b2d73158e7467aa5e40a21035293b2649823211f1f6e5a0f52c2bd1eed81e52d75426c3e1629f7847ad559b59704038d9ddb5c314f557e7de14a79fbae2d004d0496d39eb55595caba46f3c2d41c9bcb9d10435889e2cba03435b39f8039bcd4fb66932c50dda07d691740cf8c65393f6d88642c81b5b3ee546f0cb223aca5696750b9638836a0ae81804fceb37ea1965293b06d01eb8e5bde0901f472e870ac153287c4c55ebd05de7539ded435519736865853c5e1e71d6f054785edbfceb6c5be8533a5812691b4c48f230b687d87a9d2ba62482a5a1338e6068b5cb14a8e929d190c41027fdf531ba44d9b3e84f7b6dea4aba6763feca24c2f619767ccb0a21c2edfe520121bf19d7703b1d2bb4625a4efe0cda9c6be6a146fb92f41a453af88124224872d5985c85425756fae2a522d6b5b1079ef2129f948bdbfcb9fa4a6185a54dbcedc0d5fea6d5a51ba0d99f25636b985cb917adb5eaa88586802b3a0f9ddf27ea871d101ef3d3beb928e7db2bb010f6c5584011d26a23d72350970f4efdd921b18a1a1f2ca463c0577cb1b6a85e98943544011414042afc70c9b7977917583cec8a76768623b1a0470d03c9ca2950d3477ab77fd6bc4a2aae7c83d48f1bdd385abac12a63d7b746df2eac36f419e9f8b10aa8a5a32b8b183c4e5d061676b99354d3273ab7014a1d0df0c2dd275c3d5c998a7804142798485cb98e216430f8e9ffab31738f6600d63d5f7ed13b7327db832bdcdd744d9c13a7d8cfbd5c9ec84192572097d458a68242cfe030bd0e9e8168959cfe904fbf2a8f9e34c3e76f269316f15b1c0fd3cd2429a313f38001bbb2361f40974dc202198c4d576f756e56302a353995e3d5d47a13c1d871f93703ea9ac839e3d2e05a486211a0abc1076334777a124f11d67edfa4e5c5a942e78ea672b2f0b130bbd9ccd8b19ca7d4abeb80b168a48144291e9d543e3a50c41a204bd2e697cbe9d8bf4e04fd803841ebd996aaea25d823fc22628ed5b91bb7d6426b93166cfd5449fa58d853b2ede44557adb7341640ab3ba19bf7b4e41c79f2bbbb76fe4619a1a98a5633ced8fa25864c8d5a9b78ab47cd2372d771c06df36ed09dabd081951ba5ffb073b876997d25b228f9ea7d04a9f83f64e0c5f516d1511248f4d057bf05f07583fb94a8d23761d6e9bc93721f3ad4f482b906ed2995c7373fbb2bfb844e7ee216269d71b01c3c506c0a45e23e1404958a45adad5d489d85f147036a37325654513c6d6afe87ad098443c9d27291dde0e5df4837d90ac19fbbb79bfcf8c5669f2ba5d0edfb85c0d3ca8971c8806fe9c030ed8476577163b7a1f9edc7aed3c23aaf9ab3e2cd464fa84f8825b64dda62668c88ba8476139c54510f092ff8f640b20fb5e2c826601f61ef51d81c14edd70a7d806e02168ea6c637f1196e6129019313880def146aedb7391106f1c6925b9ff9305cfe73d02eabfcd020bd20fd4c741be4e77438fc3064013a124da4eea2f53231db1be8df928554cf0002730d1d37732dd8c18c692da30b5feebd980e29c519a9dc7fac2a1eeac8cb37f57df2e9ef6ff8a1c5fd995e93cc8755739e1d9db0b1686ed97ddf9ab3ea265f8f1688a96758b6bd03183ea53d8988a61321556e163c6dfecae56bdbb2073e47a00e7d59ccd8a8118149477aa8ff03cdf87c27cc9688e0fa8d6cc68ddc8f5a956177da089282bad0572308ddd84131651239f4d7f8a560a3867d88c5dbb2e5209f900f5e716d2ce4cb6267637e11b03fed9f94e4257b655dbd3698710dd55ee0487ee1088266275570c2f0d2e831597f1310c97df6e6303fff13ac0e6a200687b8d7db4c0a8ef0d0922e31633c45abce84aaff9310030d566d87b0496829628d624ffd13d44308b5e469d5d0ef8dd18885122ac4605ea07b545354621983c5b10c89a5366762376ec99be90d4ee4a62e7c4259d2ef1bcfd764582e54be832b1fc4d6585f3d6a50bb7986a94cf2c1e3a3cb0fd546238c420d5cf4ff7196464afb580dfdc44e9ab48748b091262c67a1d54d932668d3bfadaf1b034e8f9f4913e33e568a9e8ec6e74e7c94838cc7194b9689aea232ef1d0ad01c901094bafaa2f85ad8338f8f3305fa5a7c71db1928d1ef2c6cf2cf3cd50dce3750d5dec08478c2220a4db835e29689745c6fd00c6a4a663b5ce16053af12e0c7bda560e21c3b6ce5e39820a6bec2889641c3214ab5af634932fec340d996091c54d5baebb143ee8fd2b739f270a6abc0e0d4ebbff0ab1460b88a5460e0e5ef17600474e8a97fd66305040a80d1d72818f65e4beca17b64dec7ee2b58d4956446efbc7b6605979cdb6e1d49d72af9e17e4389995ed8d348aee8b64d119fff23ff236c0fff0f3467a368fa25890904860650c16a880c47696e20245cf50f30b75114f4d0e346a8523edf00898377b6cb72a8892494303452248ba2fce91c74571886dd9be0d1aab81de8062bc3e896ffb428d0dc8f5549b6e7efd5c990c443bbaa1e23b8de8f947817b7f69b314fc2fe824dfefe7bf2fe2e1d907685991cc0fd24d77af957e42c4bfa83a30d7ba9d172453b360075ea4fa993903378a6f8db1ddfd19ce086ee0348e0b86f61d5db056a21db3e93287dad1af8051c5683036b8b250aee92d2f973afccee7b60c0f6c2a56498d8014f1bc5fc317c524f81f0f21177aff0cf2b6b31507a67e1052310c88672cc8513df0f338b09cd3a8a6793cd3e62d08ff3165a93e8c183d905afb90c4aeb33d2cded35550c6d9de1b7e05e42b56b1b3915499ace9a66afa1db33d3cbddc2b3b6ac64cbc2b8bce285c18f0d7369c4b27eeea00f6bb3ad5c019d7b6d4f0460e2020ab73a1bf06fbd6f768361b199b609356374e4944d63d34f6848767316feb733e9e7872aabbb07fc37e5cd4c3800ce23a0b64839f304b8890491b06b89b3494a1d3c0da7fe6fd9a155a129d08f73a3c659f945607fcd2135580263fcbdc166f4ea031e80486a7a4fd7e9a5b5ad46d3d60188dbc31b691317c0d0c3ea8504d9029ff4a633dc40a1aefeaae684e66e7847076b8bf631000248cb5c336f2dc4855b98f101a15940b1cbac1c799067f5a37d3f34d22280d1ebc97c2d442c550cfcda19b98e60b9de3e7f25c8d9c7d7ae44adbaed33cc01eb2d3c33d0547a38f241f79d364239a99dd3908ac4d228280dabe59ff2a308ed3e303d2e57df447af397730b97daaf499423544ed5e21b6ee9d66db64796cac24232d3470b8f1ca9d8d08f9a685e4e8b71718ff961da90ce3f971bcc0969982f129ee72b185e2bec013d0077c87d1dc3f71376bc3d8ff66b95d779124563e182066ee1c06a94f92cdf13c468db70fb3b4592c42935f7cb45abf3d8ff7645930954b02c77a16d793b7ecb1f0f69f6ac249d8390570aa953284b13cc3cf61e5aae9eeb71082672292fdda5d6c64ecdff169ccad768a68b906fd90db1f77448459ec3710ff6b549f0ec10664a65a9a392f628b97aa50afa037da0014115122d2d4fd3938f11f05492fe64e8810679eefa1ad0cf11143468af60db73421ebc66e6e67ff0a7681d2d3bc58a30b7dde22b78397e2786ff13d71c6d8c869374117d960b561e58673436ea57a838ecb7383a1780cdb5667f94de6389a5970f47d0fbe326888d43fbf226755ef51d41c6b3a26d1f19eb4ba35c4079ab418e7a5bda79058f111a6cff22f98ca7fb35d9981a368ced26ce9c9be2af7f89c0e62d4bffa1a107b4be17a5c2dddaec3b36fae0fae7d5dcae39c0d096228ce3a4e7b0e1703df3a23448bf8c76e7243aa498b7fd0ab6ac4e62ba5d517f07a6105657e24773c80cbe409921807465be59ff6cb6009aa2c6183cbfd2044bc1c7b5bc7e0bd5994eb356c67a881c4a934522f4ce284d2e592ad53844f3f3cd0e9d52e0b5099d1c464d696178093fa61170a70f733a81e34512513670593f30871df8254c0012725e95d75fed66a992511c523b106aae17cdf84ebf015d4582c8285b963f4b086ba63975a2bc2ce679dfa1829a0601bcffa386e32c191b191de99994fbbd6d4512fb28c73a5e06a7b812db908a1d0fea94db61831025a570fe8eaf51b26a7a8cc8f4449d27668a44a2d3374ac134387d2367666c4d4fa793b961517de3c0798cb7579608e49ee5031fef26a327835f2f8532d7b5619433eefd3a252ce57111ff35f9a3fe0b4133138fa9f09c55be3be3b1ec167b6ceac991c188fd2288910311efdaa3229a34a61e58c0e4bbae4984f75437530e98cfbac4e5563c1900f54b01ab2a60a7455964f3423e09ca0202072b9b25fd59d81bb84da3aaa36e0b7727080a4822ef78a3b908fa3a46dc6afffce672bef01954c6c5e4b9654847f3b414087f68ac275554e57ad408835c80364bf92136748593484fadbd2be635973629a49b8acd48597ba9a08b8792bbe0fdf1b28b8d6e1b871aa6dcac4334d05a436af0fa1a18199b43797179bdbd0942b2ae6bfa23747d143518f38dcfcf2a6c398faf2ef0d0317ab1da3876ade81244db37711dad287b6b2dd862851a172415494f5c49fe188392f506109fd5217af0dbc71cbc3c9d13ca6cecdc6e479a25aa5dbe289e03f7323e9feb1ecb68e5a184c95ef4f83c96d0522dbee2a93ca34a6de6370c5d85300ef789986c347e76ebd1708305b17e1f8f3bb2976c62e402aea331f81149251d097e398c284bdd679a86e6559e10052b5466ad790006ffb253090e23b896d6780421e86c162d25a42294ce88c41a8689d123ca1c49dfc013a9b98320b14e4fb8ed6f0819f07354a5799819d7377afa9a478764358d9ca9b4010aaa74a2cd118bb15ac6f7fd6165a970cad45cdafbbeefcb3dfa08ee17edbaac1832870bfdbc9abd0212e549e34abf1d02cbf7d5532a33f73890409975d50b5427dc19851dcf8e795511d081ecd200a04bf462e2a0a5fa450d2ad1c94c20b5eb884bd1c5e016b4a725b66a52b1c66b09e6f2239f8598505900b359744219063d414c4551553bac6e9024590092dc68c8b29dacb50daa477004ea632a0c34938822bca3266724e8eaf3ea8ad72e67ebfd569d95e880d514b52d1b814a6e754fe9648df16d497d5635c3d08b887caae714901a267f778336b970a5063f92789415d9ac4859477b4a86bac5f01ba39fd466341098cd2115c15569c9f11f53e50438423a2ac57fe59473ab09aba4c28acf9cbb7367d22f3d36b6f943003bde88c9cd89da2254e38ec9c7393ef43fbc7c6a2e016c7ddb7ce3d65f2fc3cfd2db42a970b4dd78ffbc234aae817d7ac1fd43cdefa431df0e333850846d908e9434604d0cc3256487ad92a312aaed474c4d95c969f385c7c9b5b90531e39742b8bc9dffed78e5efdc5dfc02029f180f5bd841b57b36dd64ac215d271a220b61b873157ce1c61962e9de8179ebe4f07dfa72ed9d657bde23bdf5241dd0a0cf2ea4b101a5f1e77a0fb6a43c3983bf88fe129d395b1d252f0fbedaacfc5343fc4e1cc7cabaea25a06e5bdf5ee4f7d7a5a363cee1297fe97a5d4252e6f6563c9481232298ec01dac4f2365a146bd35a45189bfc5d985feb8e89b692c35efe29d1b1c09576fe97776a9a887ba51fc72a4475944251731c89047bf2aa5c3de9a17898ceb29375444beb4a380edc438997b013ec7a91183de6120bc28d7c85f4899fa904c9d58a881c5a7ba8ff574eee9350492455ae1a84cc8bdd319d2a39daa5fcb4f40888e89585515624877a4b60a71e89761ad6dbe99b47be23da59e89250e9b4b6f72e3f8bbf3c74ddd695d48b5a75997cd22d42defc5e18b15492ec9c4cd175919943b83e8e6e588b9564b1a83febbc863121088008e831050e7a4537b5f35e360d1ea1cea8dc2a6d32ae733d70135acefc0ae03db5ff12bde9c47ccfc4ea765a72faa8ff9bd0da77becea4fd3a129974b5f514dd36c8232373d7d842478b4b3a7f5827e5efee2a1de2752a085fd198883b8be22cd2ad6f68cfd81c33fd5d849ae23aa8773c844bb3b45a40425a5e2ea62a9f012a15f17b0b3eb1c6b342c00d411f3954ef6fdad718a589f5fbaaefa8cd4694a0c930fc4995084f9d436919c21f3fb4f0ab863cbca7700ca3ad6789838360a335523ea32ea71c739bdd7982358be1da2847749b77cb7904d5f85ab618b0736dafe4aa391733423e20ea16cd7c6ac48f0c16338bf4a84952fb06ce1822a6221869f33152a780e2fbe49569fe47cd19c9174deee775500e8ad71442e074c727c8e14ea7c29d45d0fe935478784951493372c47cf759f6a23f1442b81ee202b32b0f8701ee1f311ebd8f66a1e9afa560635b120abdb6fe50009a68c7715812b3154b0d2fe0b101dd3f99d4bba52e9f0890ef1d2ad354927e99abc770e3b5c6760edede01f60359b76424caf450bff968feb30389617b388b360feabad9060065757eff864b22d85f0ce14c043a8d83c00adb2aba1d9398a60e9efe95e8e0450ae50dc3a597f60c40953b589cc04d8187300a512c70a8408f53357d11922d7f669c2be092c32d0470deeaf45dae5374510cb1969b61f93583ebfb2d4862963e24fefc5438607a55b7d0446ce2a6d7aa232b7d188165688eb7c30aaf7e2f061776b16d1265a53594cb05a963b15b39e1a1fb433f38702456a32d8aaf678a86450fc0f6eb21a2652092e5698e1bded10c2d15ad4d35b7220f2648028ae453d0df10a012aadc283b6b11868af41e7f92787f2f9eb4bdf2eac230b58a77189554f6a9f4a0114e2d2c4c662067dc7ac3b8a1b1dae213b34bd38550406fd871eb03fa7346bccc6557e7281b047341e06ea973487c9ec3fd175d0724687346a8478f47172efe58d0b73a88aeff9a53bd67b8149e0f8b3582fc473049888966eccd4e79c7612ad404d260a124509f759176cc9c860c47d687457cad2ead185537a0ef2dff59f4878f2b8aacb1f2da706ada2be5eaec159d2d1bf1c5f11ffe082b8fb614a58da4793c5dca286ba33b28fc157d79bdd7c9f11dc64923cdd00f016e27dcbce2f1373273c8770b41f40ba95e7ebb5ecfc96980beccb51ed83505842c14c4eb5a0fcb5186ae3507fdd6f104d2f871b9153c52b90495b2d062cc63396f33cdb158459082121ad45c579bd4cae45798deb8270b782d6fce0b5a11378376e4c1b374f208eb13f08312a29497d530acf1d5cd7da52eed17dfa3a8e9014686dbee4ca0fc2f1202f2e0c2d64de6c744eae83a64cc262e0a6cc5f1d2742b989ce666ed9bc89c26352be046a0724730eae7f393ed9f11495f22fb0092241fd122ff92b45179793dbd685ee37fe4a57b3d3b5e687e45f863952a1113e6a8e61a902f640531014231edaf620d3d212562b0c5ee427d93bf41315cad72ecad24c97cd568dc9eedf1fd16f8b72d65cf9b592d5b6d912dd3570feb7f63131aafdcaef6e9dedbc30f371ed3addb971dc47c0524211b5aaea39705b7c22b6774af59184ff9d82868a153dff15066ca8e557effd880ce3112b749a63fcb736271e90b7a78f1ec6542b85afd957c3b85914d2dd08b4c8549d2076072bdbf261f54b060c25aed0056ab38f5d1bcb2849cf97e5d4ee16a648780461d7201977d3b34d7bfc6b64f0763ea84574ce458dc8aaee9c7fa31d785b06d6fbc3eeef1407aac138ea4f12051c27afa27bb71cd002496a06afd138a3508dc7d832c6539fea2c6c3b27ed0c03aa0a31d61f6cf12535a913b713c58b57826bf4917e5fda2e2698b926e1d55d90bb601a638918e3c81b8555b41b2f5f3460d59ce6df7fc57dddba03240f14983d3bd87e7826877186d465d9755ce65ac7cc12635953b18d158557552d7da47f7f4458e4468f1d93dd395d44f57d4d49c98288b3eea055f440f7894e8c47c1b6481be091f88718e8eef2d0b4836d16e4843d37dec49aa27e3792b107462aa0dc38c431bf166ec9823ae622461dcb58dda0fcbe71f4b351f617a78e90e7919c6eb4762aa593e11fc087dc5902aa36d340c4f615cc951c0be293f4891d2e6d62c0858c8d8a6f447f49a381f741e6e63970ad519878cc58c4c716badf304f53825c2c538c63223f1ea4fe775f92c8c0141e761f1730b51819c934b5dfc48770415d35cbe4f51e5c09a1ac29a90be4d954f5d3a85989bfcb348f8d05d23621a0ff1eca7c453e35e535e5dc85e51e892005c151c59c277e3a7ca362df1227bb613178d6f91e62c3138deeb634606612584417b62e17fe31a64cf6c647fc450bb2040c533a57eb19145189d95a5e9b4cc099bfaaab44e5aee224ef852220306bb6fb79de6cd26d88591618a7b1b09e508ef8ed8d25887592fb6c357c19f93667bdcb00f74fe1191322e1bef52c532efdf1fd1b13e9479e3aaace0e315e4c90f83268cfe3f6f41ec81e88408824565a649e52bdae6a377e7439fcd5bdd7a201e1b4539cf877e979ae32e2beebd7d9e2f86e456695799c9619fb425ce5c57fb5027a07e63729dc72bf7339315315f3e381dc8d9ca7d878c0128e3f56ccb461202e56f348132d94eb635b40f15d96c8e01e68c612f3d3af7ae6746ad541da26e259ceb611461119d4caf4c27125d3234e53c831232f8d5e28efdab9ad00fd6c79525a83c56903c60cd4ac294db73c9ebd7bcb9ace029a55d5f8c383d313ef6dc67631fca8e9234148246954e265323d4530c77a0089372768abef56e15adcb3853f9cf9fe2be5b75bf907be94f9ff643b9034e135c3de7a67274582771180c5f2a410686a343d6a856062ddf8622eafa55dfdbe7d86336c2c6ba8f2cdcebcb3a26b3cc7ed46e163526c345f21dbabcfdb1d2a57d5b14c7878e4b31e5259d46e164affc01c67840af3157874b7ae432c8494e4eb624c537eb75b5a169a421e990dfdf5bfb50a6f9a8268fae32ae1e9960cfb2c0061170103eb27428deee7cbc887e67f4fdaf0a39068eecc8bb7b2136bb35e3a4bb15ed50a0eb9fa6e5ded75215ca622acd24caa15118cf5cd6f5dade6629561cf89dc6efdc9782fc21e302f8503c5686663dbdaa984ef5fa550cd7d2c7be5d3d6065c5a8cdf651be418cda7339136a9b9dddd9ff58e0becaddf0145ab8db6c1519ccec75765f7486df55cefdf3fd3dc885765987305a408d383dc81cdc8d84b97f0d3d10613fb8f1ff52f1366710267224c22c883467564ee3632158a18d38dcbc02ff6a5835ebd13e8ee82b7e48ee030be185e0cd7881b71d261db3fb679833c9d5325a24a94835f8c68ec70c378aac14e96885c71ca1e5ff1f071d822165b86f272d1b6fbe2b16de2fb0a01ef55045a45d4500ed2550ef780c272a64f9fac51eaf83cc62c5a93ef669085cf9945da4c868d521d1232226dde499b104a9d104eef3b2106217824b7495406c6f462bf37bafb7298d9f18d846c964535b44f22ce6c6b0414896698ffae51d3f933f39f2a502efa7d7d715ff02fe906b09fbf3bcfffa3944b3f25bf8049657e7d567530f4f591d50cb2e2cb367e5be4aeaeb85c810c147f35ead5f409782649adbcb4a59fac24d18030b99172441dd5b8175f91314011bc9fdc6189c67daaeaa8a95c02c637906557e6cdad443dfe69ea30ca8c41793c7ad53e89328aed3adab08a0f29dcc4dac2a35257087f9746e281a90905a85263ad6d38ca0a6b5cf7c0eefd966d6e3d73532c3e1d6466c5cdf4cf3ada81b67cd033927714f2fdbc995cf28c88cc677faf3da021f20ae6e278c57245091f850dde03ee7f22161cae8437f4d99c9002544e765ac3dd343d3d451da87269df6f185546eb5d71cb38d965bd4b9cbe63e311c0bb2b437bb4a07b20c8169cc2e57aa20b1d76ee0d88db9cc31804fd47837b5617d15f8c3272aae8c19d92a6208145ce73b6fc6c311e1182151ed32836b98ee82625a39c3e78d529d01849b868feaf9862443732bafb09ea3670da70f68304fda0b0e71a6bfa1201b8ff4d07377cfc9efffb35020f7c089fe767ebd39b0f780ec4868fb287349058ab394bba63d64a64225b8378783101c53284d8a084e2057c211895aca6797cba63721dbc4e78e509fcf35596a5f0eb23b2ce66ee12f06a335aeb1e315f53e580445604b7d5eea2836045193cb538769bd700a4debd9ffd56769038b5d2888a0a5344d7a8c2cec384b1da8a9e83dc8b2204114d081d3eb01d14106bafd351da7a85dfe1d8d4993f4829409f19fe97914366c9461fcea0c8cab5f3cf634a303161c825a1118a898d25c3188eecbc9996ce2e518a82b9ac1da4dfda17cfef1d8cdfd76294671bc2368efdd79f17927d1d81c127b33d6c61d26af1f89822838131a4e86e9b56c777fb961c7bf57af60b42a8ccb0828b62e1ab1aa8c8323dd9d5b403a6c3adc6cebabe336d97ae85866ba628fb31f55c90c5b18f0279e75806cdaa1bb863d84d1168ae5999acf84d91ae7961e202e870c8d83d860381f609f7e001d0bea145b94d6c8cf874c5f8d8c0a4eafad5303b6959a86337da09d5fe4541a2966e8eae0e0ed617ced1c463377f9c6389bc5ce5f4accd0476a6161a5d6306dcd3852e29a9c3f4476db9fde2eb1712d25362e1d721583e2352ffabb8d57c83217423728f448392483541eff348dd8cbabb934e31893c7672f860598e09c624e6258fe431f987e46d85f7b69965a7b9d1e84c36d21ccdd9859c1c53c0b5939dc712f9eb18979e9aafec2af17e2d797442fdb6b00dc141590ec1dff663ee7854cade7b93d7dcbe666dd5039cca7ecb840b52f13349eb264b61e78a825839c87ba32d3324dc83bfb4f04352f7c6751489e67496db194c04ebb113c990b2ba7f6b4bbbf199bf8c2d0936bdb77bed84d6e91632bc655535515824a6efa7ee4a4d26f02b65d6034c8a6aabedb48cf07d5c2e199409532e4b24e8dbe00f50ca55dde2b98f4a50ef604200ede014b06c2bee47fefedc387e0ba3206b3aa0cc2b2c2a2d7f27eb0b787ec6d86a315ee40c3c1b9d7bfef47fd6b323679b568fdd6fda2b0da30969e4e1fa66725eab29d824059af792b091b518ba30e3742cb180f0c4a600c9dc4012698ae60ad31491c54aa683028e0f91d597be9870f89d4e86017c7241e5068a7fa9ed10255fe7b7d355ae66f0534b02cba81dfb93bbdca461566331508cab031dbbbacd8bda717ef4cc109c5cf487f6c7b71c3437d6ed52fe6795226da9a4a3a78676e2308848d46f238704b059ce6124ff569479a5e900a4612905532a8949a773803f69f7a2257f4062140717d81aa36e717d48186e6c606b1be96c37d1dc9c5e86795e733980379604878ba5ad108b15f643f402d592452005079f009f7b728fbf3bf95da739c5c1c280c3040f051dc8e8e65de497143c6d3e39fef98ea97ef03cb85644a3aaa570c057b4e274f2c1cac1f19bba89d12718d85d1318ea0a4b68eef4409d51b0834397cb554667e3af507c478b09504adf737ba456260b64abdf6a760711d80913817255e680cd58747a77b17a7950f4551c8d0125a3fd0c6fdfdeba472c717652974e94c3f5543ac31b4cad4c5626c052055d2978875bbfc99245b4ca1f62d2e45c4aa80363f996e608f502f979782b231afa6e8483fdc91ad187c75a97fe25a243bc9bf5809723e11afbd090c22a11b87058adbea2ad9bb91f6ca7de34591d004dae8f52990e63cd22d21df348edc5aa4ae260ba8ca3027eab25ac9e3e0b518c84a538bf983cc9d935674f29d699f3c71262132b0f5f99e0b6aee3fbae8441f2d7eebd7aec9b313e3516268276c916e18d3018a360c60c2225060817060b0e2ce56b84357dec4289fb448dc1b47b45f401308bc4d7f5d6e75962329fa7c54bb82fde74d1a8f87890d6ae117e21f389a856823216cf76ba71a6feff5e7f5539d279b0fc7b9e84baefa0ec287ef90ad33111cb97a9e517e7eebc5758aea61fb3f4c07922b794e81f4c4ca0b01972b3dfe9b806cc3b0d4709e3b6f3e498c86ebbb4e22b6f9178e1112d366f9dea87b12fe2275cc4261029df7d3a27cc9f97de463da0450b4f24d6afa2b51931544b6c70f0c054942b58306c72923461fafce276071b3ef1a37b102283ba3c1acc459b113c720b336c1ebb8e5e719d992591b4827df76b9f6c6a3150fb02ab53c94cf8c8e6e0c7c7870f7f725606623c839b43f9d49903ae96817264ebac2f69c5fc892bb25d04a45ee3e4f8dc1740182ca3a31fd8dc875cef7f40ef8f82ed6f71fa9ea2452b7609e2fff2bb6ce4ad1d24cd1e25722f31e2a1560b34af3bd91e41c45847759448a8f975d7a7b83fd2c67837a486d057cb6cf42791cb8f998f18d8ee8001e6689232935340d783bd55ed7840fc056e8ded820d75ab3dc94bce932973fa5b0d337ee84a3a090a95442315c3231a13ef8b30c52a90cffb2eb3c375ae38fc6cccba47d0f1b875ef5900c2b1dee6de29ae90a5dac0393ac907f30fe1fb150d8d65ab93b1f213016bd2c133d1bdd0cfae4d8c86f1bbfcaebf36b29a4f1dec19ced474041c3bfd415b816323fb5b73a13c51122a87f3a5ef297187d3d3cc83561552e633a4801f76c748d10e35e751bfef1c629caed4fb0fcaecab884a05bcba70b1c4b95bffa10c47b2afe0012e41d75cbf7744c01d2b1d89febbaa00d4c68c175335965ec7e0eeb0a473b14739449fb81cbdcca7def4afa837063ebfa04a98b8eda0883c5682cb184a7289746a1e09c63753c150eaeb17223cd44d0023921df34268dbd7b013ca343576919380d577f73e2654ed65df10f9e18a704c7ad1f723c9ee8788b7399930b2ff28a2b016311a2304fccdeeb9f9b709b971b6c41cf5a4ffcc5dc304b810240dbdf4203a25a13dde46fd6b118fa8f7257e8743cca57c97ebaabc718039d6fb863622adc1805a01d9bf0cbcdc7a8fbac0796fb16ee57031881b79aae8d6c1485f2c63d4b22be8a4b57da7567702bdcb2579c9c4fc4e585d2fc0758489ebe0627ef63c525e1676accce6c6a7c22305aa4386b5f223b041c360103e61887c66fa30ce40700333efb3d225ab4457dfbbcdb4a7b461eb3db868a1538684a382effc5675cec5d45fdcff9bd45bdb9041062219b89ed3d0ce8bc619d65bb53f940a7634067c38f0178add8b6ecfab85b97778069f13602592d1e3669365edbdfa58deda2c09390a48ee0c6026d75b97906dcc46a843c20509b727aa66fa83adf045ca99f8e01fafef08f865250be5bee99678e4f1ce9abf6927b10cf6f12fdb14c3045cd383b198e4cf1d144a032d0d6c99da9ef786f949d3c3b6c278e105cdb12aa0044ab0797c522daea81adf187f72811a62c723b4be467dad231f0f849e0b7482a1cbb30de82ab3439b313a456c5b57c8fbb4e62991f8bf2252ad610c6789ba317ec86a6fb3cc42196c42c215aa5b4a79c35852b33982933b7e69b38f2e166d0115e35eb5bc52f1ec1874baa2f62d15848761472e5151f8856c090b938886c1031bb81377b3762827da0f6934a1b3c798e04fe1b39ed89cd9c7ce6b9274b9dd79100fc9d3f82b42086a3340b72e82128de1650ab8a0556907d5fe84f78a635ba057c19a8bf10df68e789b64f1f304a52227463c2c950ffdfbecdae91554a2fff551da94ab5f72851435eaff766a20e9f3611aa7a3e4569bcff05e0520193297f2d984afc966d82d2629574466b037fa322b9ed1c82fcbfedeefad4b34e77c511e9575e236e3175799e2fbce6446c531eabbaea55cef664a13e436b5f960b553c19cdd51bee9f77bb5009c72cb5941af9ba6d201060be505e8b922327f83cca76a0e9015ab67f4cdb3d18a757645468321537f607a5384962e97ce4a8a0ec8b1ce6af48ebb312f707e6f9789259091f38c57da888cb5bf89617a3f425e64e7a3caf8e62c020f73c1c8994c2e4aa37eacbf74ff87f105106ec01f53163ec005cc1c436cb8d3667bfb918d146ec2eb2edb1622857d56f21e149fa1e6101ddb2c59641c32cf0896782dc6be9456348dd5e4d8a4b64f93c96d3d7eaa810afbf89fb7f42ba11643962cb79bcbec4e88ae11b53d8e125765b6c8c38f70188644d4909ae91b37fe0d53950ff9d23e51fc3dffe7ad555d479736cd630fde420c9cd92b481f572e75b08ed0d37d28d03b88ab28b7e9e0ee35b9506a680ab4f9d983a43c3717012f34d663d3057f5c0b2f22184291c959155c8726ae704f72b3f08b3981cfe839ef761319a6eb77cb581fdd9010d8abb94dbd0dbe73346abd6a308f037710ff1277265dbe59027c51568037b61350f0e11e35152d243fcdeac6ad8afe580a5ca7b1776f739d408abc60756c74d38926ebde99673e5c4ab9f6f68001a3100dc2ea83cf69dd161229c34737d0eae656aff4eeca0ba25d95f88b855712e0e6a4637ea45ae523e179a5367021e73712e4443a934e0faf35cbd65d344615c957b4fa4b602d6d12aefab013b6ea73260768ba12fabb854db5e67a555038c7fd236642b249e8ebd93da30f5e29c6c961c588fe2ebf54f8adec45bd3dc30044de10dffc571d740f35b1f70b862d724f10205c3e282b0f1d621eb7d7450065ac65be2ec045112f66b2257b49bf424ce8d3d53e4e933b3ad009173a564f65fd9ecbb6c53d1053a6407d380f5861b76fe2ad5385ef2b4fa5e2fc49c2b0aed72d03ed9a7d0b33a0f9d146115852196947995af5b4ab53a0980e86ac7dc20de6f7856448d4d322fd37129cf0f10ec50b3168fb3871bceae013be7c4ef34afbd4844426f42427f8106bac520d029f5124927f91185de8cafc74fd74ff0df903b8e1340ff396a2602f74cede05fe870e6429202a4c6e219d87576627b9247021c75826caa312e68620f9ebeb9863dee6b4684e51dfa93378dc7a0a41ec32c6ca96eb46f611e26fb9a6379ee8fa08e1dbb197038f10aa3fb11fe2326c2ceccccf15dd698c63314c1cfc91dff52c0da72389a05681beb4d9d40e93349d4f0fad5bf2d00dedf8fe5eed87419458e506dae1184af0537dc83c5c1d9e5716929bb6e1c8314b6dad97cf21b249667983dcd45a36a3b5840e8913304311c6874bedb33098a71b2e4c04def2a2b50d236f11e21fb87bd36211c440b9349acb74fc2a7c0d46e823940c3aab81af2ced35b98738640ec8dd2ed08346a603e070aa7d87fc2cd36d71415b77bf8b0da72cd00837f730bd3c07d394588ed95ec48c411d75faf52157a68c72a7391cc8b9c866a69c88aa0eaeb834473842141cb88d76548eb328b1b6a70f0e6927ec8164be4228eef2c4d9e2e83b385fd3a09e5d2c7dd09823b3c1bb0eabeeb759c0679bc3ab7919de0b8a32a11dd4c5e2639714a479a313c8c91fbd78e7832df25925a418c694492a252d761430394523540933fb5a8d9fd41c2e67a51e76d23a1c615350f410adc67c75c7365c69fd9a3c660aa6038dcd2047d84f7460cc872b9f0350451438b61e44ded90de8c7dcdef19826f5bc8618f9802b81c563d595fab4a2daace812ef278ba401225bbdeb03bed0c77a0a541c8a66265c609beae886bd7c00c2d5390a1a3a3784a1c2e48bb11b1913f5c72b6a0a49267805bd15d509b18f034bbdbb31836051f098e0c0a86e9981f8452c00b03a0d9feede0fc77c546fe5224741a1daa60a481ccccdb4fce2d94a59253a93d073bef8b083d6e49ddf316fb9c7b0f234786fc91e0372a37ba0097cc332c5a219d8ebe93f7f6c9e74f47aae83a619ad9ceabf123cc1050c877050083610ec264bfbe8170574769b85a921a0c3c6d8d28ee5f805d15a8323e7a616a9a0d5141bfe485ba8ef103f6f387767e3b688124bb6259fb4ec29b771004b8d89b504f0c9fdbb44f510202ade8e04a9568a380eb037a2264762180d00a767e28eb90c941f51ab2367dcb9a2a4e70f90b100017004990f29b1853ca90b1c40ed8ed68b9a2f3748a9afa0eacbed677e1af9e18e904367791b3c8506f6842abdad9414922e782db386c0e1fd9933cefb833de63a27277d47d94eecb4b49f3a6f801c8006afdbe2bc3b2e62b4fae0b5f5d2fc75e84c5644d73c5fcaa3ea50c83de5f5eeba243e7c81decddab6032cb6b023c280b92a3964b5022cae7bb6cc297e1dc76af6f2be4ce1b664c9817210ffdc0aff951a44e2203ef8caed8dc30101ef5608e6a332e6ea97b7f24fc8798f682ee15f1d5b01b45af0339d098018412d2399b2a080d3fc6fb834ef54e561dd61cdb124c4d25e2d71b4d9f3dda012b366058c696aa4ea4efd856fbbbc4af944ba5190a4012726e10962af753116cd8fa212d818c572fa6f69768cf5c6af6a4bfd26b18ca2cfac8e0c3f05a2fda0e47c8c1f01fe3fc8791371eea505de2896c47faba6ffc17282b8241250a0efe0ea4e3502523797e437d6d3c8611ed5ce7216e8654c1aa890fdc0a0b03aab597fe0704c34316ccaa75d90706f06a34cf7a3dc608ef00bd2d557c2dd4d5db5726c632527658eaddca0c61b5e63f524758ede93946ad63369ae26110969076e37fa45fe8d7933d17ca30b0c21b10f7be698b803cdbf9e9f56ba5e0bea556b8295d1236cbb1eb960f994514bded69bf4c21a2f514c7aaf9fddaed358141dee06ceef596d166a2f4b542199e6ad91f4e0f286ff44f95f83077fef648695108d9c51e334576a6dce0a7f963402ea12791a2b44e2e0f3962db025200205b0846433b8319d3a3808a5367004b04f84874f26e2105564001d8eabeb0c7f22bc570472b777cdf27045e9a52dc64606cfea238328d33c0c28a488b89857b316283f5420015cf72cf76c31f8b0cd97a74b78892197e85fb0fd93354a81742134c45607c15ef1415e7e2d17d128dab8a8da767d745cfba65df35351c24d8ce8cdc6cc4acfd142a37c2b9476d56bdacbd4c614c9fbd5615882c41a198c0f0a186cc50ba9d7a47a6c8669e03320798d7e3d2f71ab4b841c5bc7e2fe07082f5c8465bda251e4f02b5e2c81aa0b14b1b2258c97631c641d3d1a12cb30dbcd01db369f51b69eb82a09bce35269e049f7669f477c9e598473fc291e3bf8ea55a7a5ec79197f39d5c08c341fefb4452c99a8ecf6185cf98a09cf350efd0c729eb0aa66a59fe3ed0f4fe85babe9a51f7b1b99b9d6c01c904d3f1b718a641b4f96aaf27baf31d7d085d7ba2fccabbdf910668b9994f1a1ed1521c33caaaa0fb24f9b1b160735cfb75781d937d6b55d120fc74ed28a289c4f834361a9b733ae4a27df8c854691715a1b365c18c81b832ccf4c6a023ff9f68dce3913fc80509932a4bae00b4a20e8ba90d547e624b2170a0e8bcb4360435e5ed0002d4b2f899f05a0e7c1467d2a9449c8dd43c0c14a408a3dda4aa2d29e1b0ec449bb14365b1c8dc4d51eda394aa538a54009c98cdf84bc15c3452f774a5ad04081520af81e657afe3359593b68d7f0d65199cb195925a3fdb8e11663cbf5c8d623490312da58162d7904cee7f41da0142dd2c784bdd1b3165d3035bb230ee84f65e571d5518534220fd990bad7cebf620047ce240373e2a00feb66febfea612e59720dd41381442f53aa21301a261f1bf5a622fecaa9c35028291607faf92cae3ba7387dd1297512edbfdd0dedfd09cea60a2d2bde92247914bc145513b2e8067ca744bd9afd94267bf1c637c9ef4d668aa54993572b4e7fe745fd07f61f0787d8e7ae25245077d53fd34c76c4f824df3ac1243e1e6f379b6ceeda1b3501c41446ae3fddaf56d828acdaa1e4681fd4965a590df5ac4b031a3edee425319e1f229189d5141d45ce046aeb716a5db46b85b0451b574b1fd2f648711f0146551cb4d3f1b07c2ed85d29f34f82cd34f24d98489fd744b03c0872bf38d42929126b491356422e4351ff5e885160013fc137997ff482b83d3d73d74b4adb5b924a6b6f18ae8a146ae314c68c599150ad465059fc17145be90768b71630f89b6bf90dba31786ef51eae57e6c7ddac565f40700d9ea41559fc1ec19b5a24f77b4bd5ddf6d6b0c745f8fa48563bbb794da7a5040fbe95a4b932cfaf1057a05fd0d6df24e05fa4407e592f7a80bbd15b37e0d35cc78305397f7680f7cbd4cb54a0773e73d0b1bb61dc2be80faa6dbd5cbb675eea1dfacb8d0bbebefa8a5c2c65bbecf58fb069975fa4299cbfaee14c21242d14dc60c3505090941d11c4e54ebf0553547fecb3de684db28063317664db93ce18f99f440b226af40ba7f340f0f0495e24c8134ce4b9ca9846fd9259557cec3645d3cf5175d803671407e8dd9d366a56329ec8397453749956f460ba43d2bfbbdda4033c79ca4c61b40b13a21e566248d7821327b46445eba0f2b06a557ffde88746d66e3528d81dcf0bdb209d0d980c8c8ecc82ff2c002a66bfd85b38a2ab405526dc88629292c030cadc063d074e9d77229cfa7ac2a190ced55cc32f8064dc79422ae52bcab8a78a64f0ff0f72a7fb60b55919667390e41fc5474e24721f64599f8b6d7b06331e9a3ba8ed2708a289da24dfa1061180833f93b4bfd60aeae32579c6c0a3754b90b339921b8eef0aa0304c2a2711a53edb41cc9bb51bff89da7492ba19ed54d5da12a5dcaf16f41ef927788e1bd9d59315f5422201f6a99bc27f02bb5b792a6aa8f506338a8e4397be520420244b06943889032ed0ff40544ac7e3d8aa43f82a629c5d1ba2bd71e034ea264948eb07e1f86716b7f1b5d1bbd5aee6c311d0ed209244c07eba623cc1d91b5ca862667219ca3320759180449a3322b9dd0c43db2a108879f5b272fc9ae83f2e6fc9191e3aa2541a8303fa1a9eb09f5b916a26b00e0b0c8aa299e0f38e114ba5b8239542eeb35e44cb50f34e125335fc8803790710d2d706f4751c6a5a7e793b32913d3e99a0af4db24af338d285069a28e386b6030deaee57c07eed20756bba913f9cde42da51f7fe17a0dd3df55496557875c18885c058e4b6d37f32a48ef00000c647d10ead387c614a2b65aa4e9bf5845bd2aa5de46c81a1db1d65ee83817af4cf689ccffae3ed6fc7530c0e366719d30185989d14ec0f2225ebe1640bb660dbc2b2786fad18a5f9e1514485b6d843476281c722807fdd2797ec9d6f1a6a128d38691a715f099ddb121e59e01437cd06c70f60fe248cdada6b53929f269840cfba7dbeae1536056bff10d239b2a6203f6bae9342bd7b8012f01e97aa16cf3d97d4c423b935c8baf5a550efb9c2deb8cd268ca2532df5cb38f25e351d3a4cb5f174e780574bec2f163ea9462df667b3b1535749de33323afe1a9b46d0bf8c7503ca7a3d2fb86de28ee735fe85151fdbaf89f11c5a596196427bfdf7aebdfcbb5915cde25f78ffbebcf2546c15623a490d4dc1d07c5f5423e7d9625608baf6361ae1901857d32c7808508389272b55a5c6401ead0e5e5f76bd7718aaf3028e2cf2edd3a65be04967d979c5ab1df44b04dd7fbbc7ba7309c7c5237448eb1125b86c4f490629e2e4aa87cf1f8ba5dbc808319729fd6b924a7badfe8e8577f4d2cdc0de9146b4e59775396707d9f74c7c8c62b1aab05196261e24957f31ae90b7c69f213ef7e214a8bcda012ac6d13e6a44e335cdfa3ba70ce49d6c37ece5e10ae5bfb82d938efbc593816731a21585e216c5600fe275cad0ef6a5835560de7df0a2d2172f26a213150770d5cc676efc8cd4830416263a3792af9523cf2fd26f8db5d8685be6f02d6b0f95a6515e7fc1f810febfa8a14fc14edc0e627b2f5dd649d265aaf8225bed220daf247660132d5ab7b9563fb68e99be847136bb20495ce77e7d16926bb6d3acd4eee1f661a44f92e5feeef631fd457459414ae03bc318f91d3c3f28c8339f7b513157e5790bbffb8e8dfded7cdc9ae4f37b31c2769ec5a46fa758d8649d11a9e53a6db348fe9c4e56e3aac9870525484490eace5f186f0f1292bd76302e61d30c120a7dfc1e7164c289296a3d011570abc36e1593a1ab2deec82ce16d072244471f02192c4305f05dbf1d14edee8d6c0b0399ff75cc6be171a504520b3f29d4af621195d8478e7a866f281e5d88da32ed32afb1aae0868af5b00125d3406db58cd2f8d037a8fa6afd20bd5344e33a7ec1aec77e48a1e0dd6ab68811ab423ad6817cf696474b35488c549db03ccf32db9cacc56d9015c047ae01179ed99679413d0a87bc42311a8f84c0d1ae70e82eff9a6980ce37acf9fcc1270445664ad70ac01ff71b93004d39c92cbf2b21f372adf900dc53da192a64e5f82143464e7e54526337f126ea7d1568f610d637becc638259051f0982a795b5eb74899941f5373124c570d5070f6b8beaecd56fc79a493e28065f8e7392990b76b80d45f2f541997b8e0aa776bb6feea7266eed480a21b30db44dfc2bf83f9ce53f5cc398ea8a827118b2eb8b9aac128a5b20869e661b6922dd52c25c51b3872d96342a923288747104548d5f0d692703afdade9b9dd82d85f0adf9192c693197c4d084a17f8281350f48c5c8d5f010a3ae092164599195f449a3913f7944f691a02b1d4ac3b81244764f767b93278304b2f80c8561535b35be61d34b92104cccb11591bb669c5bed13e9bb6ec7074f23a132dc5dda18a2f5cff69d9b997283aceaa870500b66cea046f3d12454f947643b5968c1d57acf9784ae342d39059aed8936d261ead221bc8bb5b53b9c42d1ad6af410f0e1ab9726bf2aba994feeac44a43bbff140e27b99c2570e2239256b879bfc036bb01734c064823ad67b71632715c1013ca7fecfd1940555311f14f16f40745eb99fdbc50467f7fb8572deeacfda37cee445f7d5739e09f87fce4102c0ffeb32255a33280bd068f04f8ada6475ff4b2eb70ec647302b87bfd1bd38bf6d9bfd7b7c31912a190084214801d89562333a2702ee7ffcb791c4f3e8b6d2b50990b6512d95a141c54aeea23602eb758e725b0350b8c354965307d80c0836515c2f06d70490dcaf80a5ba09f7200086bd43603e18437c5f467d54d938d23df3bfd19943481ccbc43fb45fbcccb5332b50c470a9cef7bdf6a03e2458cc876f6fdb650adfe6b2a394e9add66f0fb63b781059571e8f14a89871818317336626654f9d439dfceb106a88d7de91d36bbaf3ccf346bbd53278c2e345e4dab6c56072fe3b0df73fe18d5c29d487495a5e109f3a3497af9ab0d9d25c76627aff0764180c727ff295de8e95cc7d45ade4dc126cadf538bd547cc8c69dab5c42a787219d12e75328e0efe1fdd0aea0fdfed24f32480f97b31bc647d781063e419f71cc3fb42e682545204eb0a237560a4662a282704e675fa5f7d9f451981ae636362736f9a42d4a4f056207ebba3017a1efee41def09984f5515f3600fd2c876c1ccc196adfe77ece31eae9f31a15488334a02781df216273cebe306559c6b7dbdfdf3218255a2fd0fd4d0495a3a830cfaf83fd504e56df3fbe4ea30221c0458451151dbfea5b37acbaae0c1b48994c56a86d59e0620a693fe54de7f0298e0e583f4b7ecb30b9d6adffe01da900c679742551b430954c06bed056ebb8a08136a35e471153a92d3bfa2298e6d18002e49fa42e40ec7f750bf59a5974a019a27ca3b6909bdc4ef56caf96a792879e76a16459eb860dd8aa41e43adc626d0c05ff783471d5d1363ba0887989f22c02fe96def679b68c0493a1a23327e4e32723305b349d1633b187186fbb3db90a1f21a9aa186ef246700d457f8b835a44c63d3b91ca2363e43e36634febbbb06ee2be7b77eaeea97496d00353502b8c749021794a5bf80a77f3aa07fba96aa4f862c3d5a3dbca633618aa1e77014ace8969a746ce58aeb5d8b2b787fb606772646cdd012daff4c185d8b5eb724b9b3a843f309b8e01ca28893019ad541341d142bd2f2021c0fdc6d6a610580308767b9e1553b39d7960cfe9b96a805e52e87a702b90dcf26c16049cebb77ebc37347dc2f96a25ab088b2f3ef9eee7a03aef8d87d9bd74bf2663771bd9377515ccdabfbea83ce320c16fa1912639880f92951119478598fa423b732aef4a782061454ff3d452c1c041ddffebda3769d3c7fc5a920f4dd6cc0651ba84c96776532fa3340ae01b391e6ba7295bc4b0f56f6cb1de34acd3d1e42d67d27d8df60ffef0d1231917d761bc635cb566da6aa131adc8c10b616204cf4f3eb2852da8c6447899e6994befbdf32739409585d811ba3c4f9617e9bbf16501cad4ff8409996fb1aa69342b5625e3bcd116edf7eb4e55c6bd7dc8d7ebe29abcd6744fb43376712ed4e181b940bc609d65e6430d8ac800971ec61a2cebeb70eb20fc514950e7c727dad80739ced9a6e3e157c687ee6f799926f4f301f8b8e535d4f8a03b7092413ad638fae6686b78ca90195c872613e401c18bb4c31122e0151a7589edd9cfda8c091ee185f546747a3cab90f9e02aebd55e269f147acc7d6bb44fe5151827a6bcd284bf17106f7f894b8039724a0fa74e016a5972f1e9605ffdc778f789622d769ba6c18ce8e3ed7fd180acf20cd19e6b771ed849e64f413a712b252fb7df4338b9748a1499646406ee46a326b5e455f6275b9a044c3b2ed863053756a390eed2ca8b3a7d9f0c2fef083ca84821756062f59e14a7a6394dc2f5aa3224de255f847be91547f4a737d5e6f733f84efb080bd99a199755714abcc5ee574cf9e4a18571e6d20c3312d218eb5b6cf53dcb5a273caa0ed552ef5d3cf42f9ad34d28803247bf05b5228eb7d467fe18056639b11df7f4c767fd3b6a47f13711ad02bef5617e1654d70cebb43ce1e834d0bb975719f4fa276097e3ee0441519f98d64cf1709f286ec5453edabccf9685c5e59bc4a09cff95567943aaf824c9b71d00e91aea4ee3dcda99df85e00226a8da0b5f9eae83809fc59bc3613134e97258a9c268ecd34d38618552c6522925c0143746240f0a6ef4afb70f544aef4a71118e3db3d022aa9be6237154276eb664ad41e4aa2df3d17afd75038fb0b815b495504ab869f321d4d30fa12ba10e2ea03f41a5ed045018667af8fc2b91e9589ef76f3eab11b3be7b3f8940cba2330bcb70433726f965d1d22440f4d1213394df020648d036231269ced03fd725b2d0b94f434dfa3e0f85a8506bc5d66fa167dcf18e3d02c5719a2b33808aa82bb3afcb16370b8b033158fee47cf03124eb5dbb6ce6d1ec4a86aba5d8ad3dc58bf455fdfa2464f2d0b54843200cbb77b1ee7d773577601a3e8282e6c248a28dc899a82574bea15a69ec6ab0a1bf1e4d0fb493c47861ca52bac75685b60fff846a0f6f73a276848fe5d5cd24352fea90bf4ffe456b216e425cbd9e2c76acb5f230324875fb147a72eeec2f61072b21853bc166a3a8eb7c7056e8116e881287dd9fb85609aa134e1d603352f5ebf4d7c2496ac006e09e6e507b8093f658d443589e6756cc53d85e1c7a5b40ed9721f358541c9757032f1a9fcbee26c794fcee0f29d39398f0b450353f26a3d51a90622e73b673955ac2656db1c578787899d84e1fec4914d2e9ca71ffeda74252c90d820c28d3f785300047700aa9fbc1ed63e0fc6338b9fe03ab913500d932ef518a46d1fc98d8a15eebf6317285c246cb76915e28fb524a8cad5d24dc07d7f98146ec0b0737802208003420a658fad3ed5bb2c9cf1ce3423aef2af04b38071e6d52280c7285effb2034a953450baea0057cc73c8b10720b45d72a5877a4ccdda28bb35d7f863908bb20f3df42dd03f50cb931215e5693debca1802db5d71dbf0a2740f428c9961e66ba7646e61f94476c76a8c7b449973ebd48e0ceae524ce2e4aed1da18e74c8eceed778553a3acf85e71df1f7b24fa0a0f02d2ae7d164ce10c66f444824c473133f4e0ef09022876bd1c528112c86fe9f271cfec3e344806c7aea5d9d3e9498329a1e9aeaa2838edee5ed368107bc4dfc81a1184ac3fc7eed1a9908d2739ecf374aaaedcdb5f10ff94a2a96fe2a660b46ae5c02628ed4452b6e094e6b94c5ff117241f5767aa9edc457b86344c945e77f5df911572c1805701a8d0301388a0e99a12daa19ef1372c7fcd3a82219729577c85dfe807901baeeae2858378d77d0a0621c67fb7843cbb48d85992f3d030c5ec804f59e1d1ee7b76e9087df142a83a07198bbe655bc3e004ec7b5d132589006bfb4afa9e6611c356565d6cb38afe31584c94b07f6781b92a07ae3d9a93c65e96bf330cd051301198a43058a892a2caf8f5a2c12c70c8669c6270e1a1a030bd9346a4727f07013b9968cbd56ed8d7b073d17eaef6efb01acbf32f1057fe566ea01790d9ac9fdd2ce44cada6f76c24ce1987af169555a9bd95fb0c7f70fe6e5f795907cd896ce7aad3988707ec60633789e6beb0d253c032ff5a91de4bbe7245442b5d9fd74e740dd61e88fe8a102d6bb90a33ae7296a02cf09f701cbaf53d5a287bb7feceea73cd8152ac8fa6b96c50dcc4418e0260e3342e221cdf23be77a70ad39f1e5700f22852db5dd037efd5df193e3b076b670a13269effe0fc6d68dd90e05079ade48c0befa20915363594c5d09511f32bb142168e834474b5f1367766120c3b39ebeb6328f7c3a47660ae9ea6407c8d1c48638b3d82f4733f8d3af2559d72d7c8db86eea71bf7f354989059b5408591ea0b79df14d592f31d620ef4959bd17df03987bcf757f537ef37f9228dacbb8e2851991dea9f607517bfb7e284b55390bc251f4fbe495de922ed0c87c96024b397cef46d3e51c6bfa3f63987f277e07891487791f8bc0018854014a7b5651b76db3fbbfdad5f9ea7458bb7fbbeb508d3aa8d864dfc806bd7f45108b85f459bc3ecba350e0c1b1b0c67c9421ccc9d0038b756199b9c6988a3301d1be65de58e90497cd0a575b2204bb9956f9040216c5e6e1ba837addcb14857e667159533803c1c80259e94932367a34bc76dd5e9644122a61830df8fe36c3139a77be2872d3c399f7011e78c5b3cae95af0c96a7ce414249825c5622d644109c43485dfd563b1aa689be1e5e06938ae05dbb4c0863cbd6b645afab5ca555ba3ffd4cf7878d221eaa040adad215df56ed905363be9015497e84478fee70163d0607f5f9deb00f76eebf96299b39310472585df72ba16143da1cf2e4185b748db49e1db47e801baeee6212359931050941251dcf4629a1483c33e7a433ebe57cba31ecfef2375e85982c0aaf9bfd71d5ecc48fd07f3ab672da0e76278d91bb321877183398ce2af6e0e48d9c6173436121ac438567d0ebedaa9b9de055e6619f6570e64ecb8ab44f72395482a9d33e672600ff33ace5b7089a7cc525c00c65d85772baef1b6edaba4189a36d3f94e0535e556d9d6d77be07d0027924f4a9c2cec9bad6d8cb7edf3d98f487815ec76331458da4dcca470569ae82e8888d4d49a0736c10383e668aaee1994224fa9ac9209fe7ca44b9ea883bbddbd4ab6b2f4211405bc22e21c58c5131116e0229fc6f52b17f7d6bdc06170c37f958bdefff44adcf61af3f79952abf530be7909dc0373889b7d49b0da6916f610864bcfbd0154144bbe342ab59c70040c72b4b99c6a7cdf959d2a202d65e4f683835bb0211df07f6dc1c8ed03a50cf6e8b5a82f5b89c41c467742e41530be0ee5558d3d0894eebfe340cf6b3b6b986cd33737791ffc679c9a67d98e226a62e13e2de08db2b2a83592c98c1e3459092ef4ae9a6099b99a22babc412e541a2d1d7ad64b91f1927875e8f3562af1c1983e9932f4cb71e2a70f314798257156f9fd45ff8dfaa83cb54e5b7e4d7bb077c7f7a4146a76d47251c0f513167990c3d94195fb2d96fad0b636bce183904a5cd9dfd041ede30cb489dc0a51e201303d5a258f67e16c087157c8575f7b7383d0a8201e44263ac6fe096a6c42b1c74a7d4f87b778e0ad5aaec4a240282194620b142d652afdd88f03a96c66d5029d79b39b0525e3db8347822f79d237eb2e7e5d3525630ffd14ff0aeec559b4bdb59f2fec803eb9925ef2a56fc796ac61c7c23166cd5f671653b94df16a5a9a70d8d6f5566599f645bdb5878b557ca356636efc18afdc200933744497bebca95269c049e6b61eb6307815de518f3268c16768be986b5bce2230f18a0d61a5950c42d635a84e8a413fc1072d76fe68758a7f0e0b8191783232ff70cc4b38b59fd501d57540034c7ae053fb4c7d80e16a6c19144f928ffbeed1f9d39df5578c60f616dbcd0309a6ca9b253c090af7aa5cebb2b54fe991444006a470c1e0cd89e137358281b3ce7d5c439829311f0c6d6a3bfb90367a6e0add0c8d8eb432ed86b690d05b368a17d702685b28f01252bbb94506ce3fbe2e1f0f29b77321b6e66693206eb975208d8988544a0295285ef806f35eb8a37ceb023d80f3d40d5df2a190cc697c9ddadadbf57033685e26f1e036f38c4141a073cb64134e6b5d808f24a3724b5d5c2ec0bba7de7a3bf58ab92b41529dde3dbe99085bfb53c03e12279bfe208b918fd68ddf5345bf6b07830d6866262a4c201b436b6805ea5da4ccfc6b1b8d29a93bb87f96551a6701e5f0870774056e7ad036a7073459199b85715562ad59c00cfafb54cb01e6ac054bc184fed5b2897ac55c2c268504b76d618eaf444681585b8512133edfedc7b073654e437f1919cc87ac70217e0269932acd8c3e7967fe86ae2318f40611e80d7ccf9079a4ac8ab6080c67108d13d5cde46718c2d8011bf183eaf5564e20366760c6c4e97bf4f8f1be35f0978d1d15fae11a29a5b454c195ac0d375e882a56d8bddc39480fe8aa92697b980e075aec713f08c3698c2a8461d3ee4fe1c051e5629a57d9a2d52107aada82fe5f317c0d543438811b89c065dc1c55b217d71a40c3731bb7ca6f72aa02f691a3375a4f30ea837b232696a2dcc09d2de64f6f6da3fc6cea2794820c82d920f46d67823d33ec28d71e5bce7ac68f2c8e10d10b42e161ed86fb4d175ebb91d89be25646523347fdf75e34a03649d7fa495c5b3f8dc67133d6f7040ec6918f7cf847bf3ff46d91fa7be2050fd19f4c24c948c942c5cf9e1fc7722f361118b75cb4be62dca6ef5431569ca639396f6d579268fcc5723f31f6bac2e7df760c2f7151bafcb2d8865425b4cd987721077e919c4b1fd7f5f230a22d991f3894d0ba82c7ed56e09eb32ecf781ef083111eb5f7c5da48a715e4b86cb388daa3dd889a552fea4c2529bbe19c74c0df0dd7cd73837acbe8c941f14bdaf8554bee3c03949056b74f5374ae5ae9b6fbd7f3f314888cac11c999d6b9bdf1589b0a62052a579c09ebd28322519f5a75cc88f443de7e431d57826ff64bb7b7762bccd61abbc0e03cc93fe3632905ab0fc88525f2f40aa303f05bf12411d43fae94741cab2829729d7ebcfec37fb6d6eab77fc23fc954e82fb2505a5c4064148d5a2b6d3d4fada29edcea765d358fc42f2f27591d09ef8851bde94a98be758b7802efcc4c166876983b5f4aa012e71f931c5611875b2fcab55b735f4dd53aeac5dd68d4d3e070b8f3c1aadd47a5fa0a89936e76a5728d2adb15d1bc6759079d228704f6182baaace21901510284193e07d63c9570306ed2ee2ec334f9da8b10799479f0e762931953a478822f9ff7e62f51f06243189faaa316dfa1636ea3704bbc2f3e561cce9400466700ab86f9223f650c0d537b82932d45c75d1d0c74ab837090b608e3563f357639d64671f195302f0e8757f4008c623be3671c49a05f9c11c3346f88743493256a62c6049b06c329e2b1c01dca117e9e37e54297c54d7415ddd45f5a5656cb96e0a22e858567cd83cc5ca634e7b82828f43b92d9deff0b23079dc33bacb45fefce2e6263fd55d1ad9d4fdd96e821ff4ee8cb361764847a8c9e8d743d27d4457bcc1223d9f0fc64c6af0f110a9609b73685b6b62a7e7da2d4ecfd77f313d8abfdd3c3706fd776137ebdc808eace129c9014a3322a29e46f44609037aac2362c4faf673993f933523147f51281cb6dd037d8cb14ffe2581cbd903af171e34bf9abba543b34c60d75ac8cb8c04760f315d4473d2651f7d0f049e4066afee777017d5ecd8ef764bf6c4e8532a446d2e897ca043706389a5d20619a864c1df65e421ea8fdfd3787c750fe6a31754a01cf697175877ec496503c3084b7a3dc7e41c760ad18cc11f067379bea01f043193d111e534e799d6417a69b061d732a699035886138ed827a428240c5dded57ea785147b2337bdb5ef3fb432d915dab7b3175301338c61c6d043d961fded8e0915dd2eec87abef9c811b53c4b7d1a658ebb39e37acce78dcfa563c66aa75ff146938eaa45f82d8d917ca20568879bdc42bc97a2cdbd9a885e129797e4fdb2390400d06299c9f147422c5200d97a6b04a58b1531482650d3172d72e03811be0f2c0c7e06dd848882732fe55f6809f70b5b5c5817869405913181965d728f06180d5af683b4a3d2a9202b87b2cbcbde3da15705f7b0bfb62cbcc7d29c51b2443cb4ff067e598b791f36dfe4c69402fb9ebb582044aabca3805a10296ee38c44fe76cad1972e925904410a04a3e796f10284ce0d841557f7271cd122f29c6deef8207ef57ef95df18b2e3f18c7176f33c18bcc6810900b9f613536fcf75342bc806e8489a88a2255e7d4c2ef8ed736ef01bed21e81cf908365735d19c866f716a26b1b76abb0414537f6ee3fe38cb0843ba3b015e41734a8cb92213b14544fec811a8132601461ca8b15f4e8f11ab69dd6eef055fd649d2d98aac3a8f3aa95431226c30158dcfd1511609be32d1ae2a63888c6027fa939563688cd363ac4879f85e15f19b2d959e85ff9cc55d92c7e0a3c1f7bfecbafc476ac99245745bb9ad95878bb49cf1a6830bb3683b6f3f62f317e25805bb875356edde09e756066b9f00f32f21193a7a76a123b565231bbea174f2a20071853ac4362478f3e499761d3cdfdf3e79a5fe56d436663310d8f152fe9a772548e53466366ff7d01ce0eeb5f1abf809c0138e7c9b1c31e1af5761af2e327e1b8b437c9a65a42aff36dea4838656cdab1a4ed2c9571a384967bddfc7f1067e85248834e520e363ed50522cf463bed729ee97a4c98333b0dd9c767ba4cbd4924ff2e622de675aaf216d46ca2760160c0befa9a8b4b0b488494c25a0ce5000453531b69f43aa9cd21a3e1d7eeaa15e1079d0865c4316f16aefca230eed4da15dd35a7c11b1e9fe7d97804d72548789d740a2ead3137b266a7696922640e9b7a205a7af53e196db2b8c149735d810c59418ee2f8a201c4c102561280667060dcaa78233f136465e315f2e1dea492d41287119e159a4b351882fb24c85e5ae65c71d1d7b2d3495bda6ba1fb28b45a03ee0b7ba5b42bfdb0e9b1cf21733b20aee517380a710e454acca0802bc2810ef1e921a365282a151a4132977d6b0485773ae721982fd25753aa6176cc278322249c97e2126d0f0b29d23c5a577eb520251be4051f8d5b49c4740a0b636fa14e0cef672fc74b1288a24bda76e56dddb8f453f91d85d2af954c2748506e98b58489874ac4d85d044dbbf7210806a2c24ccabacb83928775e69633f0cbae73d1e047c45036bfa9a54d1fe2e3f8aa4324062e32934ba0001e7b387912ee68ddcf805572a3a3eea8eee29375462da7ead8eeddcb54abb70b4d7d041b7868875a47f08e7c8f4873dd17fe717b4b5618d4715ca57240545fb178ef3bfa8db7cd7896dc8d7eb3525ca8f5d9ed41e8b99772f479eeb3ca04aa790f68af56b5fd5eea329339d062edeca623bb0a5bcbec81c2260a8ca55bdd35c148b1c3edb4e2415f567a0f37946b92eb5552a73be151f056c19f12472fc29050fed574ebd961ccc03f59ee596f6e6a35750355969a1ff9dbbf751b22dc67207d41084a3349df8c5a08a1d55d53175f41b752da3b6adeba2c2995431bcee09b6b19f7148929207cb6327f4a17f986f0efde31e7d0f328ce99557820eb2e22127c78f8bf439d6f7245c259baaeaa7f61d1d875f793526ed453e07e7a0c9f66bce24bbc7917c9499240090523ab70bf34a1dda159f2196c7822f83f26d357fa1dd36135d8bebc279d98d0119ad3a444f9c8bcc84cea34e9a19b2481b3a035d57b03bf9dfe1887e1d69ad1839d5bf856d939cb27ed0016c02accceaf22d1ea911a75b879d73bf904ea5b70efe6801481c88974cd6ca98bebc5bc691d53d6033d500c036153de5c3ee04f084fb730e4adb76dfa94dcba16930a3e697efa81b9d2df38f9b47c08f1a2662441c650b5b337fa989ce45e2785a6f79cee325372f554028f589d8af69da407a8be78ea1bcd5f8ef05fffb576cec850f168612f9543268684766b7e21d8d9f152f2e8deb964e5e21d382d6a585bcb76fba1b53f3a1330c51b8b7a74e42e29382731728c8b2971d66489ab65ffa44b8367040975861d6e22204b3fa1fc03164b34900540a9f4cc0b8376ab8261e93bc34ae6ebc1cb934fa87c4e44cd251ec0931886f98aa0d393a3ff9e9c92b941fea21064ced6eaecd3ad1bc7fd6a955975fa773c9fe5a4a9e8feca87948531982c604da0887926f0712caf336ccdf217bf15336eb82dd4b29a5074a3c347f9bb21c6fb4e51d0843730ad3707226d5ec418ca03341bc1e1d80bc9e6c2dc6aab1c530da96e0e1af3bb1d1c7b74f8ebe75fa799a6efa59ae77aba865054666d273a45be066944ae9d7dd2dc72f56f459d89f911361066e91b0249269d251b0110d4844c8a9d46c7366103c777b8331f33128dcddb0f0eed76cfacb951d1fe37874ec709c94bf382a89a26cce8d68658c18d36e02858e0f67f6fe5c5449e034c44735a55c6e5e8a983541c9f62edeb0fd453695b679d7d5b8186d58490ee0dd9b4a51695b085d22d1b7a6969652f01f3310967b0d0ccbaceb2332dc857b6ef481d4dce86d50a4b41ee7cea426d29de267ed337b88fe9ca4ec427786c31463d80e10b6db40eac61304021aa09429cf239036344a5f0efed11d3c223c97a781ce7e5eb47f9eb285309b5a8f2fa4f30436b5e55f8f5cc785dd0f8945ce3ee4865709cd6aa8d55ff91d6cfd9fc62053e49d6dd61793e9901a05d43b5e10d1fb56c05b1f55b639b2bc5e58d9453f09b7d63b65185dd37a35e67eebc4aef334a3f2045847a1ec42714edfbcb1b0c0a099110f570d889f9ed0b4cdc972e66fe321bcad858336bc48d89d7d8889b3b70934e569f6d3184f867604930bab6af349a387832673387e2d8d39542f8ecc7605b885969c220df251b394cdf4bba4abd717d0a8d82bdf14d23fcb8d9a0142ca2826944ddcc3053aa36441de599e1f338942b1e89f4ae91d095a4efb7c31392bdad869aa4bc138db0a1f21e590fa138f51777fcd11897faa12766b791ce7a3b85b6c0401cb30edd7ffa7093671f8f840a0dcf7cc68a3818a11cfaab3876e032b05ddc97bc2edb54d10c3a3e56e68cfe7eb39d930e6a348ba3abd86c3cbe79b66f293514b781040938f6562312fdde7e127f93e3cedf442222ce1835cd51c31be5f0a02a212fb88a5b01d85c06b1ae096a8437b6b86902a60faa12acaddc850bce7e7b82b58e3e893e8138ea45a6b22b1765fd25fb6880923a245d5e7035b20e7701871f484b19154fef6c7505a2b6ccea788573e18a779621b3b650eb54e8d77bd5755c3c2bab5e0fb4b47d23138d611dd3766adf0816084bf4dcb52af442470c684967b3b779444751213baefbf6c98c3cd6f05b830caf88a725a3136fa11ae1ed4e8bc596305958f2f680b1827ed39bc76a82dbcbbff7783eb457427b049dd2326d2ba70f16fdc95e41d926a5d2655b90604d3d87afda3349499c6165882f02d7d701da2002bb8633fa1bcea038089c44615e0bcc3878bdee30a354fd82b7d571fba5d052b3e611f18aa436805ca3c0967b057d7e9eb9038ea3f64f93daf63d90eb9d6c120204b5c9615ca6d76565552c8f86038984ed1a7cee768ee2508250a790f07635bbf2cd6c824058c8a54ed266f305faa10d36b6cfd8561ff56f18cb3f5a492dc34885df90977d1b1efcb84c0d7b5a055cd5346059d1458231514d2633351fcbbff3b61ef75001873a785ca75d9b64784e7a706b41801f526b4a1df6424c3b7f2d3d91c4e57652f23a90ceafee67810d1f2d947b36992872269c5c6a25def635e498020d0eab6684c526ef39b7a0ebcc9c84662bd4e4ce1e4ce3d9f47affb123e092da5f37a982e1003d0b7fc62c0ebf67204c3431f833b96f2575393383afd341f8773f37236ca557fb323b7ee8126647347c6f106abe32e572bb77d0ab7bf203325a764d8f9facf642f285eff64b92456b356fcecca46b4cca4711dc4e6e3ece52888613060dfb4406befc3f1218589f2508472b669537125e958aff78c015f39fe6d943da46af867b3975efac6ddd50bb2391a970ba15ab9b98cebc3e38b2d6caac9707b8d074eb6c65379253a100d978bea4ac612607387f916f6cfced3b6bc12ec287c62a603910516452a5eef5e9235360033cb25df6a286bfd247e676c6d186c82f250ecbb9dbc59c63dd10b79dbd6d1129e14c8643b0914738daeea96ffa64af95732088a53c1cfbe6cd728c17469ead169eeba36f385b23858531330290be18d0864cf10149f1312dac96818a8cf1f42dce3ff1b31fdbd299bf75115d3a8f58050dfa2df8a7a4f77df0d5f6d26b70df45a6a2a7140306135f2a9e5d89e21ffc4c04abfa5e035a8261e7b1cf7fb8d63ef465a091deab8a1e50bdec8950e3e321b6cd08263631f051d5d17f1291dbeab80b72a7b37eb8e3bf2406f4371d13ece081b58b6c9a44868de9a5ec37e66aab879043a6a1395a5fde8fec98a5070360ba964af6499d5357735ab3fcdb253eae3cec0850053aec9bfec6938a90473f786f3a08d35b8063bc7724297d4327d7ae1236a1e8734377192d056311febf6c358ae09bf328f9845ba589c4499c0bb560b53ee60ad3de7feb91bbf9697554c7f8a04b46fbd8152d400da2e4430478d8b36af6c65cfa606a2300643dfe21cabc24fbef6a26f15365f8bd9cc85307cfc8e75e311e84f0b3b10c2278e22bb9db15e561255fb9a4d6bdaa4a6077101528a51d6c14a18ae6aad3d64ab66d33e7e3b29fb679422cf23b7246a7dc4f7342bb0d48ab081ffc81adfb2f7dfdc884af3d27af513d9357171d15e7449a4fbad6de053a4dd021bf3763995bebc062a897b6dafa45829924f7dafb992f7ae5a76cf246bb9efb24447f14191f32d24599f0d6eb77f0393e8401e745e4e071a6e9e909ac5b640f3de5149d4a4f8a57f3542756e59ce8b596bf08bbc9a98b33281c137ffe54016376a57a35f71483e5e1c2273a9a636588adf86a2c052bed6d99a3212062f6c2e5b9463f3f97de92821595f540ffccbb64179122d4825728b3e4331eb558000fb7318040b8f08e1f6955c53c0aa54318a96595d5b9c9df591e9909744fd9e09bc731186ff1aa88c19eb696b593decd52095ce38c9fdaf54bfce3f2eaac5c2d3aa21e23c0dad47d496aff8c03b82e9f7896f5</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>技术/博客</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>writing skills</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo基础建站</title>
    <url>/2018/02/09/hexo-get-start/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">请输入密码以阅读这篇私密文章。</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="877864de143ccaa4077ee2075f360eae4c446c9c5909d9d22e8bd748fb204b4c">04b96cf03f1b5d00286d72390b6bf2e0817acbfddb7147d2fcc01912c7f5c0f9713c9c317ba53b9347fde83c930f8c77af411014f8ec84eef7465f6027f6e563b20763efbf9fac1db105face649d36b82b8e5a28894e0322accb07eba0f38491487fddc38b18732e21e4d5a09a208486db90f1b471e152ae582639c98996b3d9545b516ad74403d379a378e897878b9754f5f3c9a9c1cbf034ea3b155b6217c7c2a8ce65fc5458e94d70325ea68e520fea1f3d22f56b6349aee20af7ed199e2c05d5058ef826f483bf40a5fd1d5f8069bf4ba16532f28cfd952ce82641688eb2454a48968a19553e4d540a08770cd7275d70f6da201c8ff25a2d2c4f75e3e011f0a320241da7602220fba21756d81e6b573983db5148b6496f0fabe1c76e252587586a5761fc556b66262570cf7984483cebae9e2a6034d958c028d056c6140c9ad006ad52fe13044393d3a4db740fe9e5664b921ef2e056dd5a96741ceb1ab88c39ad5c1e9d0c7e3d972d9e879309aa9868a49bea583040e8e0e581005b0481cd06ff7dbbfdb1e75f157768759c318f96434061db48975c5d2e074d0cb21bbaab80b1987d226602ffc695f08f5cdb86c57a21e6e03eb5e1e567067f9d5f43ef226afcc9de3bab01844360e33f4d0276f2fc8ca69eea86139350d4a261ad89a483d2d10305f1867be3595f53486fb3204de59558f6d9027a3ef6e59e2930d9e8e2fa87a9385f05f48f99afb2205266d1f016b93f7a8cce08ae652767600314d8ea151364272fd8daab3fff78541fe3998a76cc30105c6294d505c34547e9e835e878f116e1aef4ca207cc804274ca52b407d6b89daa74c9da09b23031a4b4b0752eb43ba922d72df5a293ef8f89e2f5d1dcb4c8b8599c045207a67614682e7a027492c5b089fbc769e4c8d69f7c91d3ce7a24c3103db00e46a1e996dde2edc346de517ee7effef788b7afd308dfc1602f56136fd20a4b1ab4a61dc2a4c96bdc95f87d5a2bfa0df27931cc22959c61e1facd7f3e2718a93a8a70159a97057f1e9b3d791d3b76772d39cc72e5a9b54f1ae1b68c1e993b314434146d28d3ee05afbdeb8d492abecb37c67932141f8a6963cfc58c63e33fab4477240eecaf27d56669aafe1ec5af81417517f78227195e2aa5d6b8e01585d54fdd317559a955477a272721acf09cfbac7510c598e1f7128e6217714ba326edef11af672b59f6588ab91159db638a1dbb0884ce8f40535fe5fa2b3551a66508c281d54152acd3a1f54248ce24e4b4fadcfab371893a392b4e158b07c618f4eefa8c50e5c497e081845591932b0a4c2aafbba24a79731e894761a45eebffaa9346347f0a5ca579b5f34fe6369d7cb9c0da87c44ee4440507fac40585750d0157c3d64d3eae41ba4cad29daba360f7ac329f475f9f8e272f7591d95f9763dc4701632d54beabb59ab874080baf861dfd627776c78fb7499e107f2f245e6c30f1fd5c596652e6108241646a9318445f468943b82a51daa6167672b746a4b3307ce94ed6d8b5c8f7c1b2eb43aeaa0078d8283832055ad755d8aa1a602c007e0337504c60a6bc514a07972005b43e78f14ed000523adc6c3e636758b6169547d5c4eabecc66bc2ece5f6c54e33d49f822d1d1a6f161602a2babe300875fb51db8220946e06f81942a66b3f9e793e0f7849cd4a9c0453c2d9bf62a1f1a6232ef39331a6bb856b94824335c7bb165ed9b1ced3c0e7231ab2a73d57a94e6545a8d206d943661cbd2c035a83403f433639059c7c2e6093d824c9ab4344d29df81712ee70c8ecf26b09f76f59a2b940da1942245970b194801a4a6cd8ae1980d43d2e82d69319bb18f24f0cc4fa3e72a417f0b3932298aa2f95b7efc4b639b69758f8d0621d8dc2ca4e6408f8d8a28584ccf2547b25d41da4bf1d8ee821ac221cf5057046cd68198aee444788f4584384a7339a9b0442694318d7e344871e36b12a53d03e040b32cc5bf027cd13ecf0181ea49d078edc9e7876c7ff682b0ea5e9ec2695b9f231f4ffd5ab36d3b59acafc4cd3cf962b480923e3fe22968c7aa2bc8894d3997aa6f42feb01ffcd3087df8a29d3f7f8cfb314cd98f43684a64a634c6e5410d6e3392f7523dc02ae0b547bd4a97822a07c8cd594e584106f0a5980c79fda720298937dae9c2ab3eac3b34a2c3127484920105ea7e5a4058d177285079ebb4c7c2bd17d001e964cfa35d0a08b9814d78475bc11f295a263548aeed634c0fff7bbb8106cd21157f70793edf4d6ccc7c2f74c1f9607e4d762885e4c416f6c4dce6436a6eefdfad2119e490c416ae864f2e5fd98daaf9c906728ffe16a9096ac2397f26f1a8d0b65761df9f24be2b8faaa0d6fb3782e11dba5d423c022dbc43cba85fef75b17752ab94ef7232667002087b947970f5475ccd9083335be21bd9e23100c4c37f6ded68bee348368abb7ba1bc7493d875dfb12128d45e4433483c15a3f01f3abbeb9054008023ad220fb92fd9a9a470cf4d035b621f3f80eca160b0b2c0a78eccf6b0cb63c93ea5c97f8aa5f4b25a0ee2a9584e759973e5ed3417ef9889017a9088cb99e678062ae28f17febac3bbabc5007af03ca9993036c6d15eb52948ae23193ea3ef9ba38b408204750b67254cd7414ae306108ecaa5ec89118c637388b07952d31236796f24d24c14f87602602a4c1e290758bc6c40ad0fa429018fd45f9c6a1bbd252bc508543efe49884566b4985e0a12bec22d2082609703e8a7e5d7835381a425a701684a16bdeea7d2590f4dc10717ad83bbc69ed51bf00b4116c2c95062eabbe84ecede75e49fabd9dfbd5ba235b8624b93312e2f7737e9fb4733e5b61c61905151e5750dec7c490c34d1dea8e0cc38fd2aa55a11e40c91b628dbf59c79f26ef0f0dcaa5fff218d0b327b763aad4cd68390ea4fa75cc25478b67b421922dc7120342757171dfc2edbf5354c369e32902a02c6b78f6a07e7af2140a1e182684e75ffbde2e55d7e0e9842409c4c5dc6542363e7de2e8983cb27e09760eda4f2db7243c058e4236385940174e00fddadc5a7220594e8fdf1f81e6724e8ce18d1e38a13d17bb10a16104bb33daf8765fb4775c725f799b6e487921736350260c7d3ce6d1451103c9cf73c9d58e0956b716b841362720af377904d413f6c88a4b0c039b5239c7529c9efc458a26f691eddf4eaf42d5bad14d466fb5a53d51f7df00e03b97148cbe33312c78f3dc5cc326f513ca99d3d7f4957306e00b7b68b731a18382232f9b99acdd57ed1e8d4eeab61a59927e09336ca4142a6e497f93b5018e001da0bee8c658aaf0b45a94e45fbcef8b58ee090262c224401683fd0c2ad39fd5456e0c90f2dfbad949d400a9b7ea8b178a05a7d69034de2fcec4d40aeb878bbccb381b3b935d200c0dbea67a388cf433769b38da53c91b5c296e0b92822dc8cbe7fd1972853c1efe4613e7936a381c04e837fcdf06b8e1b693178393f8d57413541b77452de649ad2c5eefc9c36ba09eb48093874f9350a2de79c05e8300ed445199459f362161d487158e5213437ecb6ea1d694c3f3daf89152891150ffa6913f9e95ff191a057240e22aac2770fdf49f65d8f7bf7f731cc7c23ea33877225efb759ad61b4ccde7834f0f2f392f0a28b88aefcc54c31d1b6073c510a0ada532753dac5a218917bc9a5a447a35c2234bfe1f8695c3a531022e316dc3e1eb5235864e149d0c80f12dc09a49225ffd7d75345bd4b8d56a849fcdea10563ff03ce514dc4ad79036bcb5b1a28e18af19589d5dc59fa3681e96371f6cf2dbcb7fb6a249d1e1439e9acadda99f0b356e62b331c4b8fedd9913d7e1153d225770e65f87ee2f5e90c8d94ef967ecc98c893682baa280789ce766742e505d664738d58da36c9d39cd82a7b3f2a5a706fda297033bedc707bc28ac305bff66ae5baaabef47d12afb6fc5ed79e67c13b21b607731a85250b861a4c23958ffa6aa93d21c1303ff4f6328a4eb1b24391b64095944751b8fdb85a0817c1e89c8a1ea1f972661a46898a7dd7abaabfecc2be73f4c9796a575dd4649b12864e7a4277f44603fbf273092574e1676ab072ceaca49a38922f43dec374c7dd03fd5e7902de897f25e63e8b06b936fdf08d797f55c3ef057e03e111d0dbd1e44094576510ef7fb7451da4d84ef03cb41a1edcfcd104b70cb56a7b76da5342b5bde74fdc101a7790b80d86866bc555cec6d698865ce42c98ebf2414228a56f623f26dc09ced8fa4dcc0a78de44ddab466428fb743fcc1bd37534b3a256fea0bd86b641c6749f06d26a21235b184e76d34f3698aefbba6a5ecebbc579a25e86bb277863641f2d586293cc6a38f1a23c6118a2539982cc447a165ea862d87c03f8ddedfd3306e210d21361c1ec238b22af2c7217ccc3cbabf963d026d3a6cab9177778f05e4e46035c3da2f95485c996552366288d726d7f90697f692ec1cb9e4dd7ced74434fdd8edd4e3fe9fb1ae24013c2d498865a9869df6dd8362dd3ffd834361dac3b5899480181f1f95bd2a2a10b09502ca17173528d0a3f3cd4563fe802ead366ab9007a8540d6fd959daffde9003823e80ea1fb38010cb5bb4b8a2574be191e9db78b020dd9668b57b14a5de6ea4f5214665ff0f4c2dc3aaa97a80db5b80fc74f2a7734c4149392d157e3efb109258ecdfca433d86648cbd0faaabba6b104a23a31b935269d6214a10ad42b721e54743557e7d51e360f816f1d523db30e48be3d6cd1eb9fdde1dc4c4a2274519e23d5794f08d2433aca127bf406e7664b91dfb6c00a01433f63075cc395631303a95b2002a506b144e67ad6c22cd37439a3730da7822b61e70fc9ceeceed23de497d7074b72bb16340fb60871d592351e1ca415b46d4fe82551e04ec36c7afba760e51276836b70a7a27852117fe1f21df979bfbd39d0305991899b48fed4230ec750410dc5bdfaa6c43d590ea7e00d85d99285285db82fe2b645d146c43f2c3a843117d37af619c97bd7e44bf96b2d4f7e10ce50dcf496bb42467728014e42ebad6b93aabe846f5024c81555174e8da573e1530a63044194c277f2829f2615fb09684b098fef3f4130c5408fe913271be47fdca049ca523167289e974c6403046951c22adc748cdf5ce2cf558357e6d50075054565387d40ec557ee665dff8735a1016b9a44d084559b5bdf28802602f1735a849f89f9bd88451c57921df7fc828f4cc58f632cc4e6a6ba168fdac8e738c4b6fa9afef130110ddfab7761f9bcb2ae899f434ada17d8d59a3f6bed27a94eeabfe42eeb48057d2b5103de13a440a47512d26df367c5a13c42fcf9aaf7695e731852ee379eddca8b0548093573a94ef0565ad66c66852205828a552368c1db9c7d2a039702b1af56d57009d3e5a48722a176c80baad07be3f7bc5e5b431e448c21b2b497cedff041cb52ec6796eb263293dc2d5c5cb5d28aba45fdc50c7c6cf9c34987bd428ae5783abeb54a0351a1cce812b7f155688615b5da83bb476ccd4c76abb2ece7bc52167e8c98121ba0cfdbad2ff4ad093315e64b4fa26b371b7fc01ddb2fe6346703874b17f33bb3ac9a917a691248b63c81480063e95552668d09cfde57972cc575f6ff8aeb6ce376e33961fb9cefc5de545cfb1f80f7646740541258c906ae22ed9a073165d2ccaa747fb76f39541dd792f63af69e3ccd7a4e17cf36c0a052fab8bf3f0225764e881b48b75fcfb04a8e5edba83d123820c4c8df08996ff3d189a04550486f621eaf8190765f07441f42d4c2ed78defe2d1832ff3dfa4be46ed05bb2eaf967b1535b0699f5da5f1d8cc1e1c354e9ea257bb830480d04ed681ac1aecbc4634102750f635da5d817ae208969276fb49a42c0630027e9f46fff812166a1fd12d3537de2ee6de327bdf0bb0323d830d885606f15e73b12d5ad663df20be13f50c7d58f8f32d2895d071ff1003354602ced38b03dead9750ebdfa11a58cf1112f03985cedef4b1cfcefd4573907c1ecdc634b221b44dfd475970efe0bb63a2c7993f5acbc2faa7642e69c9e43741ea60c24de9cc018738bd81373742ed8a1951a6f3379c91b0f4f809fd01a231f4378f3dc64aa3ddc33b40cad7277208f11f0a4cce30c08b79ec2617d35816662f319b3da4107d810a41a32820af31eb70a47cabc79cb343239b37e8140281b6e704a2d7fef95f8aa0a95287b5c33db2cdec9fb6f37b3456eac5c252cdfeef7401ba19c40e59e8731043447b55908c096f952d135ba2ecd35a0355597ef74973510070e671185d191003e9e0e88cfd8ef2192f6b986a70c8035caf933be61b8cdd31f85b873af06edacc1a0cdab9489a3220f27aca0d9a3894503753ac9a0ec1f48c7607a4fb965f15bf0b7ed33bef9cdf37be925faa924ba4706d49bff38abc6187ab47195b34e1d259cbb83f172e9e4aeedde80c830d61e9c6dd278f43cbcab88b4733f279fb59eb8110006579487854c49bceb307417d2d5f7b787e094bdcc42716a4edf234e208c5f4bd4179b2b168a6a46ba262eb04fe424a460244e6c282fbb277b11ace1f9105cfa0711dfd0499cf676215b6a0c3b7e4e77510ecf301a161e125fe420a615414543c997723e6074f0049aafb9a8fea2f5a49aef40ff5ffb3c9ffb29d4fafa4d4928e76b3eaf8ce91ff29f59d2d607ce28850074a3917bd1dcacd644f6b8b32b3ffc4a9ef9c9cc280920b553537f48c6df81286d9d378df296d9b4d5de22baea9b4e887895a82e04b6fd0942df439cb44237fb9e40b4876886baa2937db28c4353b952f01805b94aa6dd3d448ccb895dcf0b344ed7bbdaaa982c361c71d928b629478a73504833332ded54d9291a872b87a389761a684d45ad563c9cec3203d586a7b4380b1802ab60f60533702c373e39a793b301905adb1f44d0210f8099fea627112a0701c8db33b7d9eeca2a49070d175ae8c1047d90a2a5996855a8f007eeab1e2bdf4b00ea0280f587804163307b7b6c8bea087755fb2914d7bc1b46f2560e89ab302f1e8218a831f288cf069eda22a8c2d2667ff5ba7fe0814bf012e0a52cac9ee7055503e3714cf71b7766517aefa5a2f3dc42b19a2a4ea012f5aac9d385a4e53770fa6ecf3ff415c104c8620cb634f9d9e36878c6d3fa3d221e7dca3a557aef19688eb92be73885f12cb1f8a8425ecbca87d0ab4aa6eb0f1d132f1dbd2426009f5a730cb841cacfca7afaeab6213eb2be0d17c2a8c18df9dbe67d1e626785654f28c2d79655aac9d4b371f23ad6cf8d0d5cfe5c90fb6af7824ac75c4eb4c07af06d72d044ba2fa96a864dd81d5d6a93ac3b3740dfaf586a0d0ba924379833182e285c474e4584f20616a0a742e4207b1f5b1815084573477b8a46c0725d2e00b3634c84b49025ab406014cdba2ab7cfcde8a6544ae7972e2991c785c3b661a401bd3dd301176e6962c11cd3ab714f54d26f9478b2e3369df900b8a9bc43eb00dd1f64a2609d2f79c883c3d6e4bc4f101ae13c8239e73c435fe9a47e068f239fa66330bc0c3f812698a9bbeec0ff359463e133dfe34fdabeb0206b299b6f007855d7901552ce985c959be6f60d6bb10bf526b5b7303d96e375579243ae4f2e4ad2549301c9fc56947bce1f119ed9bc760a3c0aad565d706169a86b80ca3581dcfbe94a00d6b6e6f72e681c84e3474d3362b799fa507d23bf1df41d74eaf09ec1b9956e56cf510c50b7b2cce01495de8da8eb040f814be9cc4b7b314fcdee515fb59f20366f3fe5d8bdfc4b74d06a548d83be474951e5d02e46f44f96e6282b7c75fcde3733309dc48ca043d1fe88c817bfdb03628f0a8807a60ea4701f714bff768e8aebe69be60f15f0fcd88b2d88d4134de181f83aa12a65df66a3c4a1498b047733470234fec385af9d30ab00c6e8cf831c3036a006966502876d08e4b417ed94012dfc51b593bf23604463805870970c75815c41f7d4cd20c4205fe38082a21e07542f4f3c37dae3d5e45b3ff90c77ef96b1cda8ba0e55f15bf6572857ee26144c681e12b6a5b30eb8644ee3805bf2c0200798b55849476d6c6aec5b0157c7954b150d0cf6f8aa3217ecf778904e1b969be20a06a20b0b5f23a5c65e626a61bc2ac83769adf4f48b9ef7984c4cf7f138a841fbcd911d058a132f7d069bd51c6c9613b5256355de19535b76e972b9a80c5e55690eb6bad83a0c5d75c89669974cc030e671045fdd0376c75a5e9c32a975414539e2afb3b9337e5ac226a0bb5d02b30020aab47d085159ccbd6247e2bdc0397fc2ddaa634ea3be474c598ea2229e0da1db39cfa2c4a0b94bde246f3df9bb1c5d360fc00ff1e2a631dd9044d569bbd5e18f345d7d564c866bf17072a9bf39464282e77bc0cc5dc90da9f74789fb7388d073e58c4516feeedf4b637199ca437f2b16bacef5b321d0fa821e29dcdf9982dc78c31de2f7bd336ff6782295c5a164fb1dce7117d1cb2f288320030ba36495c236f9996335567990a67ba7095cf8c09924285c2a0aa007de602be8e176c2f1b3e41462b56934fece6822556c12666e7fa299d4d558b602fb975e4120939c884f381e1fd1130ef98545d2b1134e5d0aeb069799016abd73fc5c076fd0768658a9cfe1042fe6bf1713afb571a81d0fc85ed8746b8b5bdf292ca453c674f605a684c2e194eda07a69a2ce5e3542c8db2414636a9ecadeb20dbc63d004f9627e00e157c3ec82ee03fc33d9a98e341fc1a4ce0d1a2953cf4f8f688b0d124ea127c4fc99c66c63b402db860cc5d5537c1cd3ab09d2ebe276af185abfdcc45d0f345934426456f8d0a27333c29aaf17e85b44d4906a55dced2e1bc90e6b33b2a0cd578b6008028e96840a1270062887417db31691c5d44393fee74e6f620dbe920eea8062b9c22c26b74dbccf82d139db402b0b0b7708bc3b5879ad6c7a778ffc9a994dcb8f2654e296e5dc2dceb7707dcbbcb34c66d249de9f64715a499c9d8aff07d7b2642e96f5c18691f39fdaa481d5d22a7370972b55b5481e68ce3be2bade036082667689419d692e1d970d4c122b6ec13e831b23975890ed5b8ce7738bc3bc4416dd2468c6f4709c704889ee465a0e347c5bca59b9d2a37945bb1ab2785744f1230af0d880844ca0a35af2116b281dcb31f5504ba000d5a81ffbcb4b022e44c5a98281793e6dd3ee99b9c81b7171c344d8f08ccd8f1108b34af287dd35b203b1a9074ecb7e462a5cdb739f8af43e3f69a6a97c37c29dbb7eaa54147cc188f757d33f51b624881b2a81ad0c582158ec2d2bd7857e903e0ab75fd84f6a2c67813594b9dfa0a2746587ed2200a8a2f6428da95e2ecb8a7c6dd67e53e03547c2e0e0e20f2ac5fa5a9715c85987f231ae1ca2e34650ce3d3cd8bd1744363654a98c28d55f8ec5883518d2284b31d5a5519f4c6ca54669a2a6268d17fcf6e2f66b94ea3fb162df235af3926a11f5f2a1b4dcd38a4d1e8f6ee35c7715a0d62479ba47a00f20a8fd9a1bc960807d8957f7cd133bf11724809b0d45d979c7dd7d363f8ef271039ee6a30bd30c4200d8546921f577df298a9bfd0b3e0f7937609e9f549174edc4482186d1bf15314ad5627cd86c34e0ed61c56afc3c0a6f60067bc1dc4ceb51719dff7d3fa6978ea83585468a8ac866953204d09563c26a7e5b62903e00b0d6c856d1c9d32412da5e30a749da3329ab904743f8dbc0d8a40579b97248ee4d6da3128bca49f7ef5bbad68cea98a4ee01ba0da6f28f3ac241ec8c6b202f16b2154b9714d196ac83690cad92f9e25053d4bc5caff5545d56f7de324a80e391f4fcfb07e0f6dbfd25625f66db70b25c2752d18f80a04d8f13c5428d83a5826fec55436b6db98bbbeb0789f51a7e3fee5ab337d7170aa07607b16115167e90a72f91903a0615c5771d551a9d974bb1b58164e4c31215689068d6b7f479da094b741a821eb1fb2834d08708a035d59bb267238aa14b25d8581133522040ee0948181e23c2f9506d97a26810ed72fcf9ebceb7cf9db6bc3ca97da97eceb042581e8f0f82bac1ca97e000fdd9764d528ab4f6c515549c6f938df8ecb6eedc8f0e5eda68848e76a4d1f884133f9bb127dcddbdb35d94efc868e3026b4c13900635ef506c8c571f8e86a1e8f9ea09e072e56c48193d7d3e4d7f929f8e1803ae3588ca4c41fef935d2f6c3c2dce33062c78b850099e4529cfbfc2cf579b0d19adac2465aaf41a2edf0dc9874d3a13e7e870aa67327a3544521782522acc1e046bf8ae97c6934ffa18995764c05d265a78f95cb8456384306003dd5238e84ef47bcc18a2383d2ce4fe1e16480fc3d9617013fd2f6b630a00979eed4b84bf85481fb2aba3c719519c361d2153bab50c72023e9e4da38252ba6e99b098d15ff2bd104af01634629c39429c930f5f490057c6721a0b118201db136b617a8946997611f5e9d2fde32f592a5ee6b912b5d07ed7dad763c71ab1dbbf9fa53f4073bd726d94a67c5eddb9d705fc89259638cfe312347a3a57aca77755c070b85b280e07453fbb2814c38f200d97b6753d3f835a5ae91c9874cd39785e07ed48861f4812d43e45ed78da4e2e956b764e8984ed68d974a102bb5548416a19d26fdd0a40bc79eb85a17f5eb8132e813fd833bdf736d6c174ec6273f65546e9320cc5d3824a5f3e3e1409f78b6ce40c84cfdb7a087f850df84bb8122b66d4e98ba1ed9c4b380769fdd38c2c3ea3c7adfaa73779ed9526b7504c8299840b5884658caa08f3d86acce72ca74fdd0ac6aaf59c11d1816e760234b11504a70e34a8e76721c4847f2882d9bb99a59dc4db14db82b4630d02bccdb0d13b257801239ee9c29fe68055f341e621077ceab492b18870f6a92c1b5b01dfc493f56e240ad4da2a934755c8d97afe17eb6abfdfea782e490d6723308927666f253645690b5ef758655c6d35ca8ed43a3ccbb51b6847fe71c4bface3608de046ccf30e894ad979ed977859defa24352ab0eb97feaa6fc6d771db3c6153ee23d8fc8c57091f94672512693c4b47ee7b71337cc071d9de79fefd55e70ef097a5495e0526dc88dec9a3a49767cfd793c1296c9656800a0936aa41a6987277384668e74fa203d56c002311f90ba9f3371dd43b5b1377db0b04a4003a66395f4b3ebed72de261846f586e8b8472f7f6b5670107189849ebd1602d7bf8dd1b0fd72d51f9184fdd78fdb41a2208648f556a4b158d7fe4f4d7fa910b9cd47681bfd3fbabf8f2ef5ff7fa249bc9c2e8d0ea9c92bb89735c83d0f3776bf255149b455d06f7e66c881911c7fe0703c25aba7899f57d23eea6ae14f1c96bb68cdebf752d7ac8629957fc74ac59cb0af7e87e17bc9457ccb14b40cadc4e32298ad246ea547fc502199f4509a81d60d9a8c31cafe19180644b678a8335e3f42b9717019ca2a1e8f6bc9eb8563e3666bd4bbcc3b9b965b0798bdd89daa7984b00de78405ec171392044be570c4c4d7f30b83cd4c306134fc471a5b47a63d15b93dde603b0acd168aa1d53ce0cb008381bdc8bf4a8073478895e79962e551a24c3c21f0f1bbdadae7900a02ff7c9ec8a4da84a3917934c180af38f7d25f6133c0be4d935d7e251a0286285bb26aea0da8e9ee68d9a3f33b0d870e1d15a38a7d363c723c8180d5125f4a08d89aef673dcf0adbe8bb5a59500aacc087d1d3a68f5d44ba9803e9fdefb257514844cb8645c1fd026077a30a6f480fb35e5cece3a472dd2673728f2edab9eac9ea20bf59d9a19248cb78af35044c0f4064ce13f8f40d7569a861e7d2e21bdedc012fa9c6fd28c17fba2e209a20e197cbf4c53eeb36cfbdf2dc2290d17efbd0a42ea6770311b8d35e778af8ffd1ac30c8b20acd531721fb65fb8f2ce00307eb4ca9a5f97615a44fa0eca7a089cea65298d1d431765d5b66026ca74c213e26032ffcafa54186cce83b038d517e1c1ac72d95d2c2610c5e2c0564eec191767f49853c4e236b1797fefbef4ff5b0f42fc63f16c7f5a916f1610e9148df5facbf8abed39fcdf29fbac55c06040882015e298be5948cf6d560ff72f2ac01ea2ce19f29f16c323a286b5491e21b762dc36cb1aa02d0bb32a2a1781f1504bef941f0db6baecdeae9f63bb2da425d059444212efb78075004958e43cc71dce7aa102a8b57300b4f7bb4dc7072b0be8a4c12cf6f589a4a4506f00b1454d2ac4f4614a1a5444be12b0a53af1a82984410988547c5554babf6b134a2e30651f2425433a99760e36005d66a931161d0c2140fd4e2b0d596bf24dadd2b5a6a7e386225777557c52959651e217b8f99041d8480fbf22ed8d9514c38a2dff59dcb2cd183a2393c666a051c8e3bf3b86b25a6e2ec7f991a17a091d65a343ce999d087580a7ed981eda3c2cca5e85a72865be56ffda7790c0189fd9dc48061d1c4a6970e5ae1c342c6837da1921eaaed26fae8478aee882e3c8209d39ea0ed5d293b48598625ead98f05f823a54a0a9f96726646378b35506941a9943a45b298bcd8bdc4d1a6a544f4b3f458f484afb7c8ab7d8a456ebd3a315af7a6851aa47fec80395b5b44296ec81a649a5004ae03bf3910e04bf16452cde01a39e49fc796fbc9a46b22be73a74e83d5bdc257057fa05def3ed00569d7f1bc1aa940fe54f64dcb24c27644f3c53f5f1a459e41b235d1989b00fcdf537bc76292280f5779453938efa5ca96bbb7dd630e46c0a9b079862326c3ea15fb943c3b4d28b7033aa9624533263280b29e7b35f3e7c7348715d3cdfaabd0b7b5af4e8cde1be05c5f3acdf4afac4d6db4c18fbdb0cc9cb1f270c5c58b9289ed992e726232c331f0b91c54b5ddbc9ef7fb8470a3992efb29239a5663b6ae110fcfec42078ba307cefae438aeea983b898b32c26a03c2a1b3c7dab175fa218aa14eb151766947de8ac91be73f2df25d59654cbe8ba0132e7a3b7e8766754c7c35b20385321d3687299d042c5fc0b2c5763b04838be4475e45bb7ca76f20c28b118b79555f364673907253ed87653603893c604892e162d494748aeee06f1131ccc82b655a8f1a947dd3f47b3bf2460c5d600f732b026939071af85d5fb3637d17607c9e54b84fe531e50934a3e28de3770502259c6c52a0046f2d4062b7b513a7c685e5d2a598d00b00ba2304aaecef6e29b930d7b009152aa0cb902566d1a9fcb58a250624216a6546fb3e1ff92ad00b9d18edc6d0b8af01e610e09872a3a4882d922ab94ac6f6bc5cb27c9f354f7dceaac3e2b2a0576e96e427d441445abdea2dbcba04ae8f1bdd8a84bdc3f0e7de3e27520f6e4d31be00586279740bbbc6a17a8794d2e5e7148935c0e974b89e8db6783b369630a05f5a7f753c0ea8f97d7155eb42d4a5c2be6fe23509509816f6ff4ed55751aa6930d27428c7bd83a64ae270c0231effb06e06acbb582bec8c7386296a610b13b0f517f72e1ee856d84d43838aa9cfb37d63b84ab5349ccb3ef73b590cf5d97367f8a238b911d24d2b7a588dee7bc8fc9657883909f682d942e02a5629dc960286be89f220e6fdebc6c5225b4451a0ac55aa9c1a0e01f523a64a8c6c8ec6b08a3d60bc84906b1705c542b2660faab51c23546118574f8bd88f24ffe92611a936700465f753731915653c481ad8d130eae17bd76e485fb300f7c454b5191cea48f7228df385f2bbfe058a8f9f421bb61907575e7c2f9f40ed7e631dc00a012705fcf61d1347c3a8cc1e7be01591af0a21f55f0f6d21db312e2dc860b64633bd2e363bbee929f4ffff8d8a0afcaa26feb3880a9d44a9dcb06bf08015beed75c0ce92f624297b4b655a334e6557247a3660e001fe03295de77262cc7a8e8e214171281577cd8c3e35775657ef2054fd9bf8305a7119ebe66b70f1a15c7f30cc92d4595fb7c4973adbb64b054ee99ed1f85102925b252677b75617e169fc235180dd0afa019ba8cbd0c1f4a6ac2c7dedce4570e8851441df68689e6296551cbc4b8460ea61069777f428be6dc8f06d4cdd0cdbe04d6180625b387098088065d0ca6e163b449899aac4fecdfa38b0cdf1cf0f76ed048589044e4d91760b509b70b45100abd3cde298439b95f9b9d0d93d91b3b1ecb632078f86901006efb66f19a138beaa6cdb2f79d2a37e6f03d75b74f42c1645257f5d6bcf9694d1e0154e25bcf7d6c4886c38a2c4831dc6409b8f3bb09b9c6abeaee0f87add1ed9a82661018d1d8c4aea8fdfcfb06a32fc922f1c3906b87b63e255990af2cb42bfc8a9be56ce77f9762e79f3bec002cc8c5d00fe13253c8aceb67c7a9b8bc97ecc89f8ab9939a55107bb62c1e252331bf1de645cd80760f3f70553be3c419ed6e0bf22afec6bdfdc13e582e863b3053ac806d5ec9357d35922a6842eeb615bd38d7200acacc71f1d99f7eca3a3393ee73a7bb45bbdc0896bf13830f2aa8719b09d228a8751ad38173ceaf5c3595805a7b4fa35a5f6b04ee3b2e965aa8bbf00a92bbf715965110b93ff9e7f34ee9f4cdd00f7089d75159da19ec6f4012597311d42e495d7253446d3ee57153e15fbfbcaec9499d89fdb578c42a0eb226f7bf06988e3fe1e7a868852aa5b1bceffcb8dc0849afe17d2c9372abe29881fe4d32cebd2c91d37f5987c28a5e9a4e37992a576d6c8598625477bb929ffd046382b38eabde87a8dfa2abcb674b013bd056bd7f1acf1f96121024052f7d5baa30f0c1c1b7f2e6daf1a58e12088cb50cc088e5ed767c6ddea5cb99aabacad48cad49b6f333cd29bec322ae4562a64915caee4f385cb67bc07c955a644fbf0d0e70afa89ada9f13df25c4cdcecafd9edb5f66241c1bfa280e5b3a3a127dbcdf51d02f93c85d4b5f223585bcb1f931c9b26f6ade7d61dd0400433bfeb4aaa96a104287a07be2f96ace2709e09fcbc00c8dda895edfd33f093e71bb1fbee7f1f7186531069821808c48f1be7633bb9c8545e6a90b8fd6d6d7427da13a6a19aff548e866f9729e6b4fa0cd85b11c55eec5685708ea7e88586ae0ca329ec430ce507d167bc301b5b9725bb60633fa088d0458776366b34d1e9c377179e27480d1ab2e11ccc1473e8aadf3fa3bc27501e45105a4d4cf051f1841494d0d628b0dd663e5af16b4def53dd38f04484e33cf53c3618100b717f41a8db6c9350b95ec5b8c2c3ec9e6d767c899325d5f69567363a6762a0566c6aa147b1aca9a1c5b127136b8c4dbab33aade694062d6e16a901193716ce9e52a597de294c2d65d8d8b05eff34b0d7f2eff5b0fa878b91a2c8684fba370bea777c02566dbe7a1ce2e5be6071e169217eb8d877b88c286e4d7a6f01d9cf56fea22115be53c96fdeb6f6c5be6c1cabb20c66f2404200548e73df209bdaab4bd90454fc0593c4b6726864cdbf6413bfe25b13beaac1a6aeb38f5247b02735a054681735bc9e285a6dbc975075c9c2544bf3f936dcc00e7e5e06a81a53fa0c3f8809cf2415fb762df02e1c2f4481d221fc72fc9c7e4f7aa78d5e05234e28325dc2adf7a537f41c60f06ea938ff05421a01565702f57f7909b2eb7d751e1b7a117aaf007d55ba57427a9b087d5cee3c38c89bda10bbfc369efb966a9507e304751acac02bc15862082940e9d7c265bd77671214606723292b089f044022aba80e2b968a204f409544963c6c3342aa526a066eaf71924328648acd4127d238f3edddb2fd3dedd50ed5c99f741c285e65847a04319fadf25befcd94d60a6d7241d99f54cee3eb87248d63febeb7c6e8e6557881937c249f690246e4748f09e437d1c292d4452b834ef07a9c6d8d90459c65026b3272a39b924931a088683cd521c83b929a1c44b8e967b3e07ebde39b06b44e7950b1dff2161c3d370fdabd85e007c0245e4079c7443fb66fafb1f8e59b259c9d00395f38c9c667c73b13d2f736f230fcea401d07683ca5b15f55f23df569e03c4212c92a58c34c4c2a6b09830cfdc402bd311559f9f75a93df57d8429cddddc6a954bf6831641178792680af2aa9770900942944a7a13287c0b298b6952580ab8af806e44962b1a89e7264f68e2a943ebc19c137e42316b5091a0002fcec162bb7913e1b96dc6c01ea15dbe27208b4764306abe20d4c5fd6c53d38c3906866910099d0a0ccb1eff233c3afa269cbabe8f53f62ef437087df1df345c3fa67d20c429c2287129d4411413aaa4cb4de4c3abb0599232978291526bb83d6f34d5d3f82b8784f4385689303278c1af1bd2e4c4f2ac1be8c1427f09341e51b4eee83c3087f31bf1145b0db3e95b2245dfd8a36affd281920574ab9e21541d23f0d8716ab2a83c39fbb152dcf951af89810b6c30c4103ed67e496e04a6e5ba17f660e5042b2e6547397dff48dccb504f009e58aa4a601f691ad9b2564562fa920f5feeebf92bc07233c3df718d7253a03d6a1e0de85428678efd4668af8da67b6d2d2b4accebe9d07b56bd0b112b0d8d1b13214d9a53785fe4325a02d8ce44a5ca3ab7c46005cb674af0a90b54c7268cc4062fac95698366f5ee1de992365894f19a6848f7a2f88c41aef487cbf607009f986c7835120db9c67eb33d6ed3601cfb9ad25feea52eaf71c9a95f1e941a95dc731d126b07a36857d3200b8d1618afa79cb6497e8188a8159ee1afeba5d064ab3d4df4c9e9f48ffef138ed57f30d6f856b6fba39dafa058aa9b031375810ae0a2d72425e0d87c4dc80cd179c8224a18ad52d5018cd347a3e779b27d89832ca7a03f4002424fcae7a02c6b487082ab9feb0bdd8123d7a3cbf376651086e9c6e4e92d3aedd18a4ba4706a7d2d5f839a1b97319d5160de8e6dc1448ae30195b8d4f85f033712949be7c3f8493f2f22c37aa1b1bccc2d755841fd06dfda2beb89964525a962ed07d9787bfca0bca13408435b234d12f20fbb42afb49cc32dcefd194df6f29062e7f8253d02d1d92e2a93b8bd0019316637c798ac5475d6be746348893e54d604a23909ae5d892b5b2fceb26aa640005067d8ccfb50e76ced9a1a06c205226f8333a3927f67e0920b69dc3bcea2cafe6047d380a663fcc57c2eeae8c575867e10b048db302e8363e216f1c8e1d9e8973a2c106cf4c1ffe16a244e80dac0027361f5eee4e6cf0b7f371353bc8b32ebfd316e3f04192220bd8e607e65ae31dcf83702afb11027cf6c8456f9ed5dba2db3563cd1dd84fe961f2a6d605bae4592eb0441fee8a6dcf0b7d948ba6bf7d796f9df25e2fe9f153655aa31e4ad573d5286ff0400da06f3023a131bf283a6a0d8f4017fb98b8f12752e11663ea5c297c15418aa5b614da3b1db23245e362b40b355953eec7a08aee0298baf2e05864d5a7ca3976dc54dcd66a033962626859ca42a4c8ee9473738f1efdd4f96c36259d3afad76f22b44aa7818c15c3ade2eec98c16ec4f4ddab632cf8a450217c6fc872589f26e47a271d448113c618e18f60efa37229e4017c265bad0b975351bb8e97977133839ce8e82599b6f98202af452f5f1acd4e53a46fffd22c16095981994ce7d39caba0783b14676698cd84921eef1d420cf86c150152a692a90747bea4007e21f860f8a7c42a3dd3e3ead19c9fd352213889da72b205846668588d8b443374e43a7bce7c28f7e53d27a81764b2ad77d50148c98983945fcc7971f038c460115bbc64e2d11c581e24db4e20d3e7cc12c81b2a468201ae314053aac917b172c10b567b67b6b3120f1923c456e6e6320297a7c3ab59c123bf14cf64c67b8bcfcdbf9693bc9a76d9fc5cc10961ee7997e3d0d8b5b99bf5f5648b6be126eb65eb1d1c51f3e5ce8b1ae69f4a40d1f4dc0d775e36f405ce1756b3ae14604c96c09a21f14a35084e224d12d5f1f2bb30d6c5c87fdaaad2655c0190023abb1eb7ee4937c7b79d22b743b1f4df215cc00847bc578709996eaf998916220e9f716bd52e63639bf6c3477a73d070bc8fa467ce47a80a57839cb17cfabeefe2970eb70d463e4f0dc1eb8f7d51aabb0b2c4a64ebc023abe9d1570681b7258e88993554530fbdc1946cb753318cfe30fb11ab234a67cc2d9d6d16968189b0a375446e526385a66997011940e3a090e2b0ae1145455b3ffb2246e725ba2c396a1a3ba12b6a453921b8bdeabbc780b6a3114db3ec4291957b67c0a535bea71073ce518e921b8036a77acfa367861c5e08e1d20acd9301ba7905bd69df7ede3e31e4039517508f2d14445aac6f2fde11dcc3f4c337e8adfbe8e97625c2f1135931a442fb894763400b3b91444860bd5d44f510eaee4f6d6e72c9b629f09ce832e031e773a6fc2d244ce7dc90fc3533e6a9adba3fe5c2fd655daedf5e57b16a67f50181f313ffee605cea079eb8da71835e66e2733675df6c7afc57ddc6415bd7c7a8044be6bbe986e9390586bf44cd9a49ab65b80173833baf14ac30f858ef7c392253ce03daa5bbf11beadc954defd5a5097ecd04fa03c34c75cadda8cf846882e27f1231aabeda626f7b758e03affb24e5a2203a1be3979c21893b7d739cdf78abf7d15e5ee01e263633771ae532637c804add844d20d1ba780e05fe394f9bb9327a13143c98ed9898b819dd2911d4adc9a7c03c4e393e75aa78eae729329842327de9c5c7aa611c70aadac92cc7e4a0cb9686f511e178664abe23440674505421eacd4349a7896b16a2c89a631f146b21c89d9fd91546e953c54392fffd520906ad2b473becc50e049f7b73f6477649b084239d26958c257b0e5b705647bfb6a44b20d7421fc861ad0db79fe6a9e5b75fd6918623dc83aa3327e184517ace365c316503bd69d9d91983986219e50581a69d124a4bdb6da64e4b258f8e5d403ed31d0be41a0497ec3ff14989f96fcbb6f595fc54b15a0ef8137d5585858787619f11214d1bf89fb5679a7e2007fc8b0d87a29f185f7d34e6c64040924d0e55f85c040dde821ea736057806085538f40e455b3f946c97181ca7c0bbc845658b202cbfe4f15aaa5e04a2aa87ac14a9133e2c090a630dbd7cd4d898574983637522908ea55329b177d4a15425b141522b0c3d6eb70b1290a5252ad630ff4ee978edad0aa353afff51cf1ecc478707420f0e957878b8aec0f282a1e3b3c3a9e22c938154c6eb67f7f253ccb87076b2a543c30a2645765f3ae8060d772839eef3dc5af6489379921967a9422527ae37d1954f12734b32a1a7817e19cf6a0d54d79e8576c861694ca77221d5dc4946d1de5241a7c05ece30010923a418cc81d8d1c8b6eef6d46018355f7c1f2ad17ae788be3d4280c5668741345e44ec8c761d31195cc8f9725d735f2d4145b63556ce5c19cbfd0f20543b7b1fc8072dbba4527ee02aee823502ebd551fa49cd31e7af3806bce31cbd8125515e9dee10ddc14c1f437963540bf5c10987fa07647c51e0dd0b96a14b3c33c96167413d73ea1430957d293d259720bd206f42c46b1efe174e9a8169ba3265bf68603dd91542165302cade3c1bf77ec5eeca5e061320c4208d08ee5610c62a32f013e3ac7be65980d36120663dd38dd45b35bbf4e4e8250b57397fb4e2353e8b8162476a7761a7edf4ca7dec0bb1f882242fcd06ae05fd32968444e082b02f82450f6edac974929978fdcb69ca845c34de9210361d0458d0a41d13430343798f9f3bde86f6a48d7059f5d5068d68c49e582e708640f1cd9f0f1a4d9ec57427e4c3e4f514f231d3582b390a19e75829a5da68759d2b445135296f1831057dde048225fb8984d02080ebf7fecde1ec16a925edb554d44bb3873e0a9df293f549e460a713a814658ac6fc8019accb69c9d46a14a94a839e71fe4df9a737b5d10de350b8e886a7cfafc6064f942f99a0231be97148bc7246d8b1d1266434b81609ef875487f20c272fcd387a824bc93aff19074d6b1d4508a01e63bd280547b054d2c2c912158ca61b1da0de7c7c74caafe286d83ee2f196bf873f28ae378df2b2bb5aff069e6874de9fd3fc9d261cd280b79b324f90a01e53c168e437a3e9fa82cc0d89d4b9edef452baec7af7602d2247224fac53fc8cc1200357c0aa871ad8d26686fc239418c34a8fa10e770fc5ee1fefe1f6c6923ebb95d405835524442b8dc9ea9bee937cbbc29d121c04eaa52cb2937f9ab8ab900cfc725ba63d0821f3b52b39d369cf8ce90dc1fbcf488bcf1786040a006dbbb7dac3c500697b72dae968d532e5f58e373db0d7ed78012ab74e510c03324e654beb04fe5dc9ba61f93bd162509612e2837b42f9ec4e8ddbc805231334776a5dcc7021b1244f06843e7bdbd074f37969f6b9d72ab46ee92e1b193a077524e3108aef1e70d727dac5841f2d6b389fd06a9c5b1c74db67773aeb2c7f685c50c7b0918a4ce517195a2e94d8b0ee783bf1554fb53339ae9f223f4bd9c117a7536600907a2210282436d4c8ae7a2f02bd411688535715f73668a015593bd1b96fa83199fd434c2037efdbda18b01d1055f8f6b573b91607efbe791563598e77c8c23c89ff330d60d357755935562087063bac2a885b55b09ed4d4c5c8d9bb0492a43de4c3d597d8fffb3e706ffaab8fb11b9cb1556ddc31559fdf9bab67c7749fa899db5a08e4aa58ba500daa6c7e27503fa3f56db90b568c672cdad9c0fa29c1ee138ea40a7d02ec1b0d561ee58f99c02b276458c57a58d76603b72c95eed2a1eeb16a9690bb37b039324dce6bce928d5eae52783f5e4feba9eaa7b91ebb2550a53c0e3fa58434a6c513a9bb196a835f12d79b5816bb4ad24f4901bd70cd0feb34a75f2eb51fc2cf1cf4da48f36a7fcb0adb2fe8bc13beba1611cde64313c868ad86070e80f5827932ca4007822e7c1fc347a443f9285588b755c013f97002192268b68fb4a1809ca8b19e29dd61336840492030df3096b6247724df29f63625c0b3a002ddb17fd958ef40b5573f25f4c7737219fb677ccb4727ec001b4c891eb244139be4a03df59fbbc372b0a64f6d8d184c4ca111cb5d9b069eba472337c658f5d8b1540185e3619ad45d4b6cf82f35a7f926a6142845eacba62ab012c21dd07369fc4d31fe5b4b23f93ebf5ec4bc41b7e12722045295c09e48de04f49bb299a94077ea7cb8579e5a557568f945209d15d0ec2944635346cfe0be01e6eb96ebb41ff5b189b5f96836d782000621ede734280db9f0fe0ebf3b690fbd5a7abad262d5faaf0e62edf353c1eeb6e641669d7d44cca80582370cf3e4f61469b971a098178af10afd5f233d990789575bfc6f6149949a828f4cf526d71b821cad385607f7979dfda295ef6c45d15f8ba2ae4cc882fba1a28e3942ff91ee0ddaa94d54c31ed5ccf1ee633d35ca1248d9ae0ccf491f01560b635c343401e5b049a0cc66f425f2b916897c36746bdae4e653a89ecb28a8a62bc1484ef5d5e2b6a7132c5554e96ea8d86057f62c5dc7b537505f34aeaa2be496a6fa2a14887d7a286d1f20cece839a31d9b7521df70ac4e8a5e1a3779f429708e86b3e76f245f5a3961c76dd378bd9d7b0e2169ef9ea1141549e85b3113b679bf4b4cac62ac40c469253e889c3b463cc5d5e253799895214f8d926be9c1e61ee54b5124891c74738e919e4445ee09982c4bfef1487a4b8f5ce865557b3f0969db7f5eb9df4dce8818001d9caf36910566d9b4d36567530b6d7e34531e67984be120ff55282f2d0c29bc3df7922792ae0fa5066e881f8cdc28c4a7ee7a86ca2cebec05e7a1d20744c5aa9da5eb504bf05f148a4a78796d80ebb07a6229532e9a619ac356b786922ad1b0b9647ed96d461ef17b146b4026bdf825a92c8d23cdf48d6349279634e7cf222c4d3c1c0a588fa02f538aa8530893b648aa64d90170c3b5deba28f6a04b1db5b1fb208bc8dfa422945b9fd9f964c0ebf83c5fe4fafa8972d31bfc4ca5a4524202b5ccc9403326bb018651fc42a4db81d991ddaee0e35ffc1b75042efaf40856b57098f227602ce36f4086a3fb43e1d23d137b328c166f9462c6a62d1f25de13cd1500d5dac2e05a8dd22a4bb12a627fb3b34b7add004c12bd9a02a3249d43399f232bb750ad485b0dba80c82966d9db5b6b8e76440ec26cb8fc99f8be175e3d14802942f00221e30a63ee616e52b28967df8199d9dd5ece43ac1cbc3268e397f9a3020413e1b2ef97863f0988ce2e9d352a3614952f3a2bd3e0df63ebcfff780c024cc1cbfa82b423699ec1dd23764a1fbdea26df7f6df6510328cf82f5832e3d1c7beeef998359ae43b9904f0fb55b40e0c01e1192065e450e025f5149a0be15faf01b4c2a7fd265f3a8cc539df54094c73f9fe58caa318a971a74d0297fefe0878179ea2864e3edf5b42f8608c3a2a23e1a3387abb7b99fe156c684ac48087589ab40988501638c1169d5b7517afcde087983acbd0939a080c06aaf1f76a8b14d55c32853e1afa9e2e0c1fa3f12baacfd0a301b67b407fe2ebe6aed20eb8e696dc53ca20bd1888fa7766f14ff47f3982ab40020f3338c863398321cb08a3d9f657a58f57ee8501eeadc42ed486332b38b86ccdb9e968d8f218587cb7ea0f7e657b1d3913fa299a6f816c5819f543abf99472fe242de0bad00a0fd4b322940e68bfbcedc184615aae677a1d6eab190c46551ba876f101bf7d3a7e487c7eaf885687fe0d64e465d8044dce5817f4426b85360786b3cd7566e1b905f7d3dcf50dc5fdfabacb33730fa4a436ce7fdf748ee8a7846c145a2e9601dc18fdad15e26d91144394c73e127c38f28133719f2576f2c68d8b3dd57d0979d92a0ff868e81f6ade77f6e0f814f1d4355f9fd6907effb9c079b212f5e5cc9d30b12a142f8a6187f751fb328a71e3ad118c3f1607b6d77eb5a323dfa8d5910d97fcea64525fc47ccd306c66a9a57dbbed8dc3cb11c667a2a18aa3d06a06ce6894ec78e7fb8a8fdd00b7afac6f3a2393a06557f120032256613353e3c825292f9a5b46032137ef44d29140cefa34da405081aa002c86393460242109c0ccab84c8e0cf9d10949d35e8536d1e8013d34a80c586d7527e3708498b216873fdd8e1973eebc26c28ea5f49a26e16fb84c68d5ee35350c7b4711bf66421eaf7beb3c5ce4f712f9ce2d62111a737c0587162840ec44c28c1bef0f28df9f87b1c9563fc92a929860cab8a7fd446dec2043bfda170c00824682f593c1a8c9bf9fdb3521f3dbac9845f6790fb055a8d7a64838a28fd4f5cbdee713b5e3245ba2f7da7a950426e19d61081b5486847f67b6c1543a36dfd6633a4dc4baa168919e32772a4c46f8861c1bb0c37f8bd270b2bb14254251d196ca7afc2e1ff03d2aec4cc2d4f0960b345cca373e2789fded4777cb432af3439ac7a76c2c83c58aec44733915a0d28316be63a8632308fcf8b1bf090c4a0005889de1f87e5e2c322535b172207ba29512290b95e39931d107d2e19c73ed05a870a7939b5ad2b3271bee04c12750d059fd1eddf395cc891ff197b85e54106b67e353c561f8ee6e8d9d0c184a09d6bb2e12edd11f1af4a3b1ca333d59da565a89b5810f44dd7a59ed3ad83b0d2d1b8fbf68e607be540b0ee0fdeb18ab69adb947105e03d39208b896b484c31aa0ac103a91b1fc806fc1dca367920ac3995bcb18ea731b1e5581f3da7a5969f21757e58714ffd18649ea89f246a736cd0f30421badf175909dd827816cbd16450f9cac88186c0902787c4ad7d6ccda3701ec726efa22cd45a549382bd943f1d32b93e20c8abc2b683d5956cf43918877ffb6c2de8a324eeddab6f3ab7e918d4611337bcaa8342cbc892a5a0e55ae4a5d188eadab8db5abe2cb268dbcc9359a457a5b140d90e5ef0a06a2a6b9e23605b44a93c2632060389888571171291549ef511a72e7e2f12f37f8d5267dd1622792ccd07692908ddf503bdb0dc0f299d21165b8cdc62bc1b0e6383ccaab8f59505a5654d832fb35ce74030f1df0efe93aed1afda5f36986b96226e8c8ecd787ca63eba0d1ba1fb644dfc620155cead029720085a7ea1ffa6e7df9240b36b2733df0657c69a4aee9a1adb4205fb2ccd22687f6f39b1e1f6b6c6470c3e15063cbab8468371cba49880666db0948d93ee89beb07b94e60e9d93c5204f43eb30d5e9d0d401e31ea96c81617d1735025725d92770986e584a7445e574579af39b010d3a4b5ce7db4039f0a6eb6bfe4aed2b7c8795a3f09c05d45bcdf2056ab1c05bef09b4b147a8ab3f8d6f4ab8211909216128edf8df2308e5cbe7b7847d6009d6ffcb0fe159cf6d67c0c7feb725773fbf2b133552f5270a2b045939a9de0d9474adc431ce40cc199ac02db9d024b1176397866cc46ff33ad60899e6ebf704d0ba7aceea6f9b73f3005302a658c09f713dae6868e9894c19641362da9a868e31a8cd2bbefe7cb9b46f4b6ba8a0b722a2b17680e910e7fc7725b050717c1598da80829104e2c8a43dbd9ff7094990d5cc789e48228d5ad59e7fc0607d2cb90163c31e6bd22feae507357cd4eb72a5461dfaf22a2cb1f3d115a124e7b5858e808102eb60025bf72304319915e9a10192e9d3ce15d4352d433203b8d00a281eee89355241d9a93ba66b81da41c69a66622fa0565762b83a254da979f0a0aa68f0b6a134359236da02c622cf6ac470d6b0c0f5783ce6768987fd2c20f7d9b5eb414de6391565729ee9193a60ee6f3c9140edbc3715c6bcc634b767b794641bd1f3338ac7615f26f0c52bf8f0af548864df9f1bc3820b342f5812c3d85ad09ee714a46c476a536e2170b0b4c14088f6a6399a7051a573237c482a5b4066af0f2d6c0a930ee7a4313047b224a6d684582e8701698e3d4b1c18c3fc5f9b875d698ac0b7d4699c7922bdc2b5501052814216d9a834da23cbc57d99c1b3653ece8b5e3855df4a920dc560c53d70edf698908a6a4bfa27e6905d0a879a225adcc5db4b252d6ec47e11b6c987465c8beda2454f5e53a396cc96121404b3bd5a311d18964229604691872be3a7a02a7a2fc125a9a07f7751824ca5abbc6f92ed25f423451b3f2567db8013551c8add4208d69bfb60e08efa663504573b289bafe4638ea44128bc7a1d2def75fef31d7b51a92ef8f31f0a4c58233eb0bd6a646f6d95333ab8d36e4e5ef0356e307a70cb6dbecf0f240a749d2f9da9861c50e64210417a1c09931fecd45088acd7750f67cf8b1505b31f41f1ff21cb60ff9582a99b9b11971739552c357bf876eef90d6f6b5928e3397bd00bf400d08a33915419fc9ad3725339dc1d2d1a83d975dc0ed96b84b5328761fc49d714836709db368eef06cc14b2545d15b5494b2ba4cc92d7b193e29b98d5b6f2610d4ae78c4768f18b5fff53d148936307a499bfe29112f2791a398fc1be12a0a5d13344fc717bae19454fc9211c868543c3ac7f826e74dfac3c52da91e9fabdee4c1e76152ee602973874ada718149460f9ac3a9ef8d7d3732760d11efd0d21722717c7cccd47fefcd920b5e0409ff42c4e920eb87555935d6a9fc4638599c7ca1b5231366d3e1566cd7a40172e8b5df467e4969f3ab9c382e5beb8a45461919630d08c3e1044b4363d7289561d940a116d48df6622af9e7a233379bce65a421a868ec7577a1efc08cbc180c6c03539d30c1174484b5f9ea4d00bf6ae9d7b98cd8818d6da198b42c2397116e1f6ddf399e2c5d471a395a08e909cde980e67cbef44aee0a0acae8da980573fa22e6360c74aa1b04892172fa911282e7d017e64b08261b51c44d1eca1c80e9a057bf9e9367f518f9cd60439d377deae7e7ac0f77dc033590e2a28e0b412828c3319f5df725620a1027611e2bb460fb3acebeb906474fc292cdbdb65dd3cc424236d6c695f3de62f1b435b3f0e9fcaee58348cf40fad20a02c9cd03c996b41f4da261f1bf8c1af80e42f2959b70a23b6b8575b9300f59d39a35c6f2c25f6b9fc6f3971ee25e30a08f6b73e02fee14f2fcf135b987291907adfba1931474e4916a186ea80737a1aa5d079e2da00fe58a6103b39cc77f4354f3508d394096ccc4b7bee2eaf96ff5584920ab6819b3231fd81fe65dac4232d8ebd5a6e977b3ff8999ed08c49568fee1809e10d27d2a05aa0df5c026aadbe5d7ce231994f3b8ea613fcec2638ac922a73b751b83dc91da0c6a7263d496d05286389e7fbdfff427f4c47af43963a4c2e196e0a53195836e67d2e165aad8e00484aae60381c2a1fce8751e2646364f3147804d1577c592ab00439b087ca48f7f60e5a4c4523d77bc8251f21683a53c8e36ac14f3f76c8a2e6fa9fa794ddccb677c917c965ae59bef1cf6788d5ce6f9dfce4e87963ccc30fec1f38af407a35655cfb8d8d301c52a8a6d2cb69a5b3e0c55c127b5846dbbe6b8f6acff5a133801a5d5de1a75e990eed06dd5d906d0ee4097660e3ff3f8abf406e9522bb2932029a86c015c16e880314c0ab67d16dc4e3c368de23ecbbfb7284770bc8f64a67abdcb09b1f17c9b5dabc18aa29084ca7ade13bea83194d28eddf9c627e849a9909abc605943044d1eb8d8450d7e3e27a8daf4388aee759173946048aeec7b117f0d265d703f1805b922c7f65ff184c11e2b3812b2cbdda48cf822ad81cd2d1552bd8cf5b26505377bd0a1c670831a5f63df56b5e427ad745e7f39c284e81d52c05905390bbedc96a36bb413f701c43e0c0ea5815cdabba8de7c12c583b92d540240b7564c5ea2bde1977736d6c47aa0540f44cc900671419e793c37f0a4071a84aa884e28790a11c7a178544806383dbec120192dacd41e7d81aebeecd92392b060d2e6ec8309fd6364c1803a76ac802a850351f52609cbcb9d1eb3d747d13e59aba0dbec1c0db45c31d5fc856213dd84d278fe9b46188f95bfd9b584806e3fa93eb8dd2f41a84cb34569840ffb9f7037101aade61057b7e68b2f0f042cf64115131cf405fcabd5beb133bc29b4c4fcb2d96cd3ee0eb26344ffa291811396af99250435996fc383dd6a4233cc700dc765b85fed52c7717ccbf5d0d5e7b1d065326946bb8b0caf60e0f349abcb1a1c49670c618408d9ee35c295ff51da1338168b6a4c3d3b99f6ad5984d84a4dc6576fef2f751eaa74aa1e29c1acb61903680d8fc5e8d3ab48b9faabb8af77814973c2f4c1fd3879ba9639c54ec38e4ce76700ca19ad3ed813324dfe925e77f99a25a334b0bd2c637a1d43a4218a897536932191f91e2cb27862ba21b4d016be616c74533713d064ad32087f0cb9646449edac987ecb92a004b482e2b6edef4f20b39dce24dbd0f6cde7711678dc145c9fd3086f9eb49973db08c980f44c9ac00494ca26db401aaa905646f449ad8dea521287625ddbe152105c8b65dd5af4e1cf2bf1032769908bab4294849b1a1e4ae65be5d2229f4995ffa1ade2e447d1647a08fd30f354e531ce643d86f327f26cc5b7c483eb2fdde48aa5023d250b50eee37da687d3e0ada0364c7b398bf591e787f002f776015d6d78599cf3f08d4dd8dc77022a3e0b19e32eed838894eb688138fa1b5784d16eb770e4854c2000996252bf94ae45f924918e4021b967ac254952340ebb99d10a2f26d4a595fb5ef0ffb5b08be532ce9aa5ac420fc829c6e6256daafdc8e49456c5e3b64c90b17b0fd30c472de0c1dac4f6f0c26532b7c1bfdf0f41404adc626792811c15ba63121848580f8faebaa0cc61f789f48eb3d88a33ea3f5dcfc71e70753845493458e78fd0a41034a0f5dfb04f5ddc5cf0c656022341342577931c0de4fe5c057358fb76dbdaa49884adc30c15d1e05171b137e6b1ff9ab38f1c864ed9ffc3622fc9a9c0dc989672e675125b6731ccb3d51b4be7e44f09590470f43cab7a80fbf67a91dc3d633acff254191074e2c8fd8bb28144758c5e4df514854ace74763c50ca5d819f442b5827c48d53e3076317bc8ec2d366d67bfe23b08879009cc88e7eb3c69710e5ec1a529bbe620cd3996899fe7aa8d8598b83e46b1d793ee6662857f8b9db9333a1514a2b9bfcae81ff11db42ec3af8d5e8fd460b7bbb951459feb6a1c979cc4ece31a9c682f03a6ba6a8cc4cc5b6c888883af7b8703ab7e7fddaf9ff44c06d7ac2ab60cf8f219b5223b51cd7b5e5143eb376ebc543ba43d4d39460ba8cceace89e008e6967b71dcb27a87b7aa49fbf9eccc7a2321814e3204f292330a03c84698c4254a923029b8c11571461f1d940184705f44cfd8dc19c87d02b35a886ff2d85c65bd0772c029e423aaf7caa4f6a978d9a411c0782f404304f207cae2a19d13ebc5ccb9b1410cac4a363a5c890eadaa23f6a9157764d01e6bbb4265af58867ce09d6bb74db12dc47e5155181d844769f1e2d553312aa7e0be91f27685d4ad5df123487ae4dc092ca93516af0a33d887b9f11a0a4c3bba0853eb86fc06377ea8d39f6e67acca5970c021d2253b5a69a85979cf59fb709fea1aafb4bf51d7b0d4a9ab8398b1f0496c451f7a614b1bae5a1d58bf11c4f4957ac271ccfb3cf94a1360e5b24c588dada588471a5f0f8a85265e897dadb6e854b028d6174fd9cd94f8631cc8a7b62b9d3ec58d2730b38cdf597d30d4ced52bcfff34fef6189724f08aa7eeb22e193ee195cd8d21caff1443a8265191a35f20a8c14be5179461ee7852241201ba96392d3a43a2bce28ec739ffeecae07eadedb0704c4380555adf84c86e722d6ff6d2c69486159deb6de3ee8926499508cf39c5a46df72923f4aff97f481ff8b975ea0cc178c83218f9881f7e6379c35a0dbc9ded5856d14b1ac6fdf698dcd55487a78b8cdfeaca2574a7aab84203179afa60d3a28a49233f432c5b3a59c6d33490b55594de023521632a1b41c8575cbdb9ec21ede5d8fe5eb89e9f22ace24de92ba6dccce2d59de9e3be08eb3e56395adc7e3fb0a753114b566003ffc1366aa85d7bd5b1099df4758d5932d588b609e8c95b20addc164fa754942fe7326b75a204f4e59c836e82b8b9fd7d2763980ab2627dd103bebe0c4d5997539c3af203d94546a275b1d052ca566b79404e53d3bed3b028db48a2859b87452f4c0f2025ed5765179034407a7e761bccc4bb456bb0b6c48a99c9a7dacf326657565ce1fe2b9c1be6542226d898aaa626add10a8a6345b5dac737c65ef9591280a741bf6442dbd5208862a96a3c20bcd541c169509430e63a0e91089b95445de1540923848aa8b80c2af47ff520415497e53dc79938384cd21560db8ef2099b36180a59f334d23a9add2b814d16de0eed8f71413dec2478ece8a47b0cc94849c4bf15260d75815ebf0b8fbb21920058e06a6ff18ff6d588d276c52bad2c3136a49081277c8958eeb7cb77816b387b4a31204a29386485f7aabb5f84d6f23f9f94072b34bcf1f89f2d100b3539583f229199c2348766dfb5783c4e06e1c2f22bab3039813e844527b9f8d5a115d0c06fd5c7b9850c45ea51608b0c053dbd822402fcd75e597792efbfb0d081290f6d10d9d99e1acce3e587a63ac4e7670df1ad5c1c43e651e55e8bbcdba16768ffc745af3ade6a9c418f0766054f2e2d5172b1aa26431a201745784af1ed469fba4932d6639d04c4027cd48c232da37d9a1c2e82900054ddf6a6333a268a8a28b04899a5d4c480e4e1d8ef9a9aaea62eb99afc8dc2f4c2e4a8f8a0f6742b230b666a4f917ffb99ec837586883e3eca23b1bc8bd1ad573d7fda48ea0db406850088e51e7c171768d75b640740000f528886fb7ee2b63760c33dfe54247081fcadc4ed64282206ea01f40b6b8be03e0401f83f8247687167783544cd48f0c3893629d28a1c5569afe89fd3eaed64f8a144a649cdafddedd410c0bf6d65f3afbaff5eccead92baf6a8f74aee98dec844048513347be2377ab8983965cc9733b7bd3c4944376f7c64b14b56b8ff29bf8cf5b1e4c20e7427b44eebaebf6db11a43dab7419a9e9e9a831121df9de48330938e993b5ae511625f4916e67e00e996887c1863d941d8b77e0546233ab150449871b71e5cb6d41f066de356e0d0acdc3ca538fbced35f28ff45601ac4a9e4e70ba08a881c15eb7d0fc1420a6afe140622e9fc162802bfa4d8b74cf617cb02199ee716500648eac5ff645fa20750722d7dd133a9a6d9a33c9a916630e06caeebc19e0d7a4d0808d82dae747a7c0ea52df96c16c92e9571d711bde865a60861f08f8000e92bae42d2230de60fafc796cfe560f8d3e90f2bf3e2dac660c478f190290054d3321a2955ab90dfa61df2ad8963a4533afb22ae1db44be008e597b880e4dd73db92692e57238c353a1688bfbc2ef0a2c767cf91c09cf1a2c7f6110dc737c16f1e2d1c0e5e7ed2d2318e1368183cb038d209ac2b5861c08c05aad1204794ee96a5f21a4f0d6da42563d434a5f916bb3ff7aabb3f6276134bc13b9521fd05acd7551a14f24d58afe1820ade4e6e1e920c002b6326bdbbadba738ba84ee1479cefe3e51d92f9709da5a787aec7262e19d4434ceac5d9f3a4f650e9d998a96973f8ad967ad3f359fd0f193cb7588b74e910bc4a22f4a70bdf2de1c829ae4f61bea50f0a0185e1cf11083ab4fcd58539134d5da2a4fcf16dbbecfc359184766d66b02b57a4e992d51434faddc82f7f4865800497f411da554b77d710e281d2368bd0ed4c102377fa1390898cfa2922d5df5809ebd60c1d487cfd9c230f2c76045e6198eba0631827a85a2aad403f503649d316f95bda98cf298d367ee284ae96c1491c48a7651cd16c4dae61b3647e8a6f1a4189dce953142abc81ece037c6e05f5bf247340e6e94a3404f6412fb32b0ff316b2eecec538abd9051802d6aee4324439d7a44ceb7e0056379c410ba9c0d959486849c286cbb96f18d93f3a58c49f58de04433a4c6490ebeee78bdee3ecaac6ebb1456eaeaf2570a38c8a42461e2382d7cd23c0fc15bb46adbb66b4408bc454617a371ca5f996a226a1c0794d85b9dfed1e430c153df94fcc78e845d0003bf2d50c9cb6c9cd05788820f201ba83cd47d9010db6f005fb8310cc2c83ddab5ad103ddd4d103c9f45c08702f203a0a88c8e37a8bf50de2d80c7381306d5dc3eb895d2fd6c427962200514203d6d959a1ac7899a4d3094a8856d73774b41f690994949dc8d3074c4f2ecebb4dc685a0cf127b6195317b3de8ff74817b3c4495e34d08f826ac814b2a8bf3126cc71aa7fdd78fec4bf8108964859385ad0b00dbeb589d21b7feb8ccfd4320b5b59cdb374ef2dfab3780595d30957138b3b1e5ebd87205645c99d4d0b873868c8b6680bf4fbd5f077c8a10e4207fc83c524812057f5e75aa32841708ea87aa076ece108aab3607c9bc36cfe78cc311c9f45027893d5bc4a21aac63f5b8258e2c4e0cf25cc0ea09d8f7e29ac73afaa409277f5f7e631791c9efe805c6a0cbc467f84d9864718e36bb0aa869618267e5373ae07c51e4e75113bfb41315d7158a2876fed82e113c5769c011d94ac31f7ec10635a865989455b30a76c01f329dd781415e6d0176e45806788f9fbd9fbc64e36312404f193ca06cfff71b5ba41678ed382777cce6e2272cc1326ceabac4454cf51d9223bc4d116d9d36a51968571f4dbead24c36992710d7871af83edc6e8536b557b5501e3e6683580aecf4ecf0182b946786cd5fc31beca391b3ca464d200826715b981303e760659c5ca1fd648dc5eb7e471f8ba33773fff6d78d91b0e4a227c18934595d5921a8cc72875d2ae39136a8deec3145e144d0883a5dfcd57560113faec91201d6f82959bd850c2a1b54d53736f07ac9c42fc66f9137d64d894e129ab980d05ae787ccd79e3ea07a85ad2cf1a1854f9af5579688ee84f87e049ff1eab313760191d52578ea3c8a5844dad5165afaad73aedd645d09ae7939cb13086f776202c7a7d78924206921b8a60d7a50a0c0fd0133ef24a45f6bfd4c9aaf61fbcd22fe4a687987d50ae4ee2c52336381e92c07031986bc908d8ff0e90f7e073b11609eaf8cb839e7980dc99f775a32c25ed52dff377812b50f5bc6735789e755906b5090fa36397cd85a7a361f9ac58354e288c79f4b1586fd99b764e5a206b461eeb0b58c295111d429757e9cd57155d23232897e1b9677ac2c043e1aaeaad5dafa9934abef7beee1f255486881a5a2c7eac6b04ec1328a14950ad829b30978323c808b570d19ec079088ab9044fcc331614c231a1fd9daf1dfc2debb28736021877e3970d5f752a7852007a11615d062d28edf8c3d8cdbaccd7cc189604fe10b25ec3d910042d3157eb76e1baca1f4cc14fa5e22aafb511a347df5869328c24dcaa534013e98c77ac97abc3fd89a0c44061e5b7f5c3bddf61613378703ba7370d808034c5930ee108aee3af55c3d52342b27e960f7909a69f57f84c1f4ed37da3755b8fdb039c660aa3d35aa28cdbe72dd5b9cc1c5bf9d4405b2e3afaf785b06d1f7cd45ff532c11b7fa6281bd96115a46396cdd9cdaab4185fbc5ce56d2a3c0f3bf665baea8ea5d434ffbf43c46daaee53542f8692afa6317e4e456b88dc3125747869069255b52cca10a343669e1fdd0a83caf4e7a94d0fd3f1aa4f78e836379c150f9c859e36ee3aa9bb0b7fa33da1236d0e1f3c4e6550894f521798c0b861da7bd9631d9d1d76f5a423efda2d0f1d9db29fb3acb72f0c7314c1d5c466868b76dcaaa2ebf36fe0918910d16c6077c4134b18baa32b7b38de879c215ab51425d1f8ac993373f42dd075896d4051220b151d7c2e17f0b08e8704d7cfab933a04dffe717b845fe7c79ff39199913b4c41104b8f7a99e4f6d9e78025020e524c6614abc42a39f4cfdf8e53c32a45d16224a11c45c637f302f309efc34b8e31ab6011eb4c476a29f2945b21c6fb63a556f424a173e1f8fbbd10edd1097b03c629236732f9d7d536eb7ee197f8587c6fdba26b73866fb54939b949c50626e152289e51746be060a173ba0c58c0005acd2f197d9f07bbad81b09c68fbc9abe189149d398e1efb0186237ecdc5d3fe4ab0af43e70eedc1421738750f326285356e133e5505d31a2c449feb2cbca6efd572512dca41adec87038f7aed15e22f4e0432ba789bf490b23dcede0883de08b25b758c400f3554bf5db983e99d4a8e8cfb71b9597389e34b78ac24ce2d4b2d5e719c819f07ec6b57ad40af4ca4ede50ac84f339cd7acdc486f06870fb9095cf5e8f16eadc47aeab07ca5b1fee9e84996266a8735f9f57f201ef4739827a95f6cc995130fd390ad4947674fbfa39003f9f994584ffbe61a123a4f38023563d568f0dc9aa287d3ccf8f57b41f04349b64e3b4d1d31ffcf9e7e254477e7b8a0c08fac0350ad58d347c586d3becf4e0eade4ee33d99111f48f97eaff79bf3ae68db6b8047de4f115c1113d40547e1a83d933942f895799294b5ac75158fdea5c39f6daebfc40dc89cf01889e55d8d4aee7fc513c2253a04702a7fce7161e0255b2d62ea478ef668eec8536faeaa05a9a35decc3669d53c6f7041708e2834f6b7bce906e73f0bf5757966257dc4c960ef5205363b7258c6b844c5694d9193e430f4c905a4f74d6c7b303ef69dc0c787aba4a89039ca6eb3888f158a4471848bb60d858b2bf418ec20e9c934e5256e9eaa85d1c8b3b21859ca9f73ee1e924431a26ab02f00fddecb73d32c334f67ee5034061b1752cf5d39af6c00cbfe526014d24fab729667a62a2d8c55feb257c6e426d57d792414775536d540e26fe3f4d3d2dcf5023f415ed9a97500e0de5105c08ac04711427c5fe7c0471767453d93e73632b252bde05edcb27f5ce3a9ef43f70e5086f475a1a5e62d13050257f3b3c40505ec46f4835b221b4bad50fd13a525b4a5e39e1445cedfda99be2bcb85f4876acf0f1fbdfc8c15c926c48bd4b2291c170260c7a29691e3e3007ee6aabd38561f6ccd8575701e8b4e38d0dcc4118d25221e1b590274465e6cc52c079837bc740b8d5595cc1efa9607e83df1906ddd2b3b93cc9c27356d9fdad053a7db2619344728c0d7024bb16be52acdaa2dee3213f5d1be11296b5ad46523c1f6bf5144043f81038c9b1c01e9d1598af2d594be03b182d45a2b0d19650c5d77f51cb3becda1de58c234beb76f88d8debe92d270d42f23de7647a4ab7bb467fe29f54f46f8452676e5155942dd45f14eead5926f854dc0ea6c5466144f38c664f96fade8a0dc9939fa474c33527ba346b41a44233c6d56a7a4724dd8e5a7ca0b0ea8acfe7e9304748b3e92ed315d1e8d3e1d6d88c94179c4de207f3d9542a8893d9f169b9ec396ab0e76f15c6432c37a2cf6236dc3c32d4bb135385f02f7cc830cc9037cb5960d34cbc3e5b6163328054d4a75e6ca5a9e5041f9d98bb4a329df670b84a3598b357e0c34d7538b9396065be39702c8351abfe9a04ffebf9d5a68439bc29cd8f08a6b03c5560c51bf6ab7d2eb6df8522f1d5016a5da51264ea2e3ce2c27c18f8d9ed102daac9ce7e1e8403bea241b1d8419da5130b447970e59fcc387a1d010bbc2c77cdf70196de7b62787926db0fb9afd10616462c90c572e9f31854621676ad6a5f5e9b9b078cc63f0dfb44eeb8ecb3cbad70afb48e14c0b3507a813ff70f8c9e3c446b991655ed0a25411cb9a10e4af2f90aed6bd62cbb7cfb126f6f646cba4c4fcbf001930f53571c8a051eaa4852390cc861d3ef69d47f71418f0ed7474a5f27e39b896dcbda3b19c6a4dc78a93eace62e027ad56d5926379099217162c08c3983ee49555f1c9e20790f01776c913f9268fdd0d3f11e7043477c5d7424249aa02f997e427f7f1bfa8e57eec443ab54a7e9d136ed3debacc3bcac1060337d7970472bf0167c10170e0d12a12a66921b3f5f2381488f6967e6f3379d7a12118264acad445a2bea41f00c990f6b38d7f67f7012718fe79ae5acb60ef53ee686caa72c70b79635f0d28aea10cb72b70913991fce98bba8742f50b3bca19eaea17f4bb57c5bcbeab0dcc5f2a7e03cc522ffd761ea1fd436aa8a91c4fea85287ce529fbd48567e72b1f9cb6772e4a6287bd7a6c8056b78b1f04606f64bc069a5878698dc2e6488a33cc4e046fb4017198fe2813e5059f693cd7d4b1418375e9053e82729a4f53c69c5f743404eac732a0604512873d1becb8ba8d902a8ee170b1d929ed7fdbcad462f903e759dc68b87a7b5a2550ca1a1378f4c6750347a6acacd3180c37924f7b88c16e922f8cb1a9c3522504b460b57cdb3de7edb468a07dba38271305107409263825354af3d9386037517c8189335104734fb9e6e743a32172126dc7d458e798ecd9f135eb87f2d29338c081adf016ae3c7013586f816f44cd0d877269c5fd872e27b17bf697705cf444ae6d7931fea53e7c6519ed9842f844547eeb98c7d591eddf9321b236049c53cbcbfca84c809e1538d7bd85cea425d85b6429912d43c4cbc7cd81a5d906bf300d8a8cf636f67a66f3519e3ef4bf371b6ee3152ca068848502d13e2cfe478e608ba435cd83de5c40b33cda526517ba5a851117d5714826e6622c7745dcf91be4297ea507115d1a15123f278fe2a2f6b621d5eeeae39657fbd9af34a9b47d0cf58accd8f7495954bf1d46d56cd9ecb4c998894292ae662fd795bdf6d0a282ed16e8c468638d45b5c4ba44d4019628ef22c8f3dc330a0520dfb6e8cee27fb2c027bcb49c8059a592fd3cc6c9a1939f25d30361de2c9912e7bf8650b25d759f758f5f54064b9217b47397a579760fa911d94531be5098738fc7b210ea6aeaf0f8aeb7f373639a3a01e7df47b4870b470093cabca1743b5152bdfd8fa92bb624b977a10940610cd2b385c9354ae2cabef9bf63f918e60f73bcb2272a97a3ca05472cc6985721702863590001d446d4e935044dc550249de4d474b1cb1d8b8a56b2163321fd808a45c41aa2d4b58b9155e6fdfe719f9ded6d48d370a7b9547c7750090b27ef2b88df4675d14f8216017edc7767b0bd7697a4a3ec691eabd8c3130bd7841db4fdb88fe169c7753fb9994009dc62cb7675f7bd9cab8fbf0fc1d8ea8a1824a0e1c95769031148e54c871bd903eb775d2a1ae737b8de3665434c3cb99520788c0cbcda63cc6eb4495b4998a5007101c4a345ae8c9acf546c2617977e0d62f18524558f400107a115f89b2ce1522b61194ab94e2e56d18ca4051dee901f8260e41148f54395c222f4b8572d42ff1b89a029aee6fb0c5b750d6015f22714cb31da17c283f0284ef35c9b478f508bc267ed9c24150677a2ab0e7060312c669e021eea4b6fb839b21f94b2a76c1ae67f420384ccf0834fc74455d35820651fd420f544862d0958b589bc26b4eb26b9c3e42689099fb80c46e369997e7ffc6bc3827d327e0b8d75f935659a134958762d0b40af3ae3b178123421abd5532f7c3504ff39c4f4ac4a84c33613c30851ea7dd48fbd1b52b81ab3847c06d4ee1f4835fe4ac1d28c4ca29938ba740bf628afdab04455ecb6e1b322ba259510f47c2480f5e38f4fb7ccf9ef874eb606bb6ab806a7394a0ed161a032f475f33457b36c5be569926afcf937279d8038e1978416d23b0eb2dd4db88cf8d1a9c2d00b24de351d81b3968fb89cda898a3c165e168e59022999122394e4a09d18f8302e7955a5840fe194f724b9cbee4ed7da2d5706ac9eaccce3bd9d112b0b83087d94514a5611ac5ab5de5af6e59b715447b1f7e18eeb68433188ccce9ff33caa8205e31748d1b64153afccd64f5ef39ea676ae4fc816a54e50abd7b89a6c641dd5dd3e0ac3a5173b220123f87541e9b65c9050c63b288e3d5bd419529dbb96de04ae76c34a958403ecd1ee81e8b22ca2e75d18515078da3cc1f94a194f3357abd0db05ad57b80b437b4661cd7493868b8367cfd031d25b41580acccd6f2df78a9223524ccd7341dc4e49cf63e4a2634574932ea67a2c864f641d5186b7066aee42966cc0a8afa15b563eed7bd6fcdc99b96806f19f4f3e3c1bab7652f6b4af2c13e987db7b70726e10ba3f93c65ac2ccef65f23c07c26e83a5f2a648586ac6507c3902a5bf8b7523e698e91c8aaaa2d5abd331e6bd59d6883e4505e1e76a6e59b825c0a55294d66b0edfb9ee77805f6c7c2652bf44cb8a2b1528bfb9d6afee409c66d71b877a50352d4fe1c7202dcaec6453610d5ddce16354349529190df2ccbec3dcd823f6d591723e70076bb29f3547e38fe8c14d2636c4657914d0c10d4d47053217f614692de70cb466b13d0fc691ce92028ffb3226b2f5224cd1c1989d915f0274fd95e3762fadc816a795cad6c0fe9ac7eb8eff61c6d6b668a7e2bf0fa17ab6511f53570ce99b9afd9a182e77f3bcfca41ca20f542fc341196f4acb9d12d25a925d0184270e96d6660f6cc57ecf4c27a179448e20b8a889c6137b380cfb37a75adb353f6354b7a7201ba9740b288fdd4e21cbe8094b4b1d6b89780cb66c</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>技术/博客</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>next</tag>
      </tags>
  </entry>
</search>
